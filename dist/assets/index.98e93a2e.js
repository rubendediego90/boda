(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const b of document.querySelectorAll('link[rel="modulepreload"]'))y(b);new MutationObserver(b=>{for(const E of b)if(E.type==="childList")for(const A of E.addedNodes)A.tagName==="LINK"&&A.rel==="modulepreload"&&y(A)}).observe(document,{childList:!0,subtree:!0});function p(b){const E={};return b.integrity&&(E.integrity=b.integrity),b.referrerpolicy&&(E.referrerPolicy=b.referrerpolicy),b.crossorigin==="use-credentials"?E.credentials="include":b.crossorigin==="anonymous"?E.credentials="omit":E.credentials="same-origin",E}function y(b){if(b.ep)return;b.ep=!0;const E=p(b);fetch(b.href,E)}})();function F_(r,h){const p=Object.create(null),y=r.split(",");for(let b=0;b<y.length;b++)p[y[b]]=!0;return h?b=>!!p[b.toLowerCase()]:b=>!!p[b]}const w2="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",T2=F_(w2);function j0(r){return!!r||r===""}function O_(r){if(vi(r)){const h={};for(let p=0;p<r.length;p++){const y=r[p],b=qn(y)?C2(y):O_(y);if(b)for(const E in b)h[E]=b[E]}return h}else{if(qn(r))return r;if(wn(r))return r}}const E2=/;(?![^(]*\))/g,S2=/:(.+)/;function C2(r){const h={};return r.split(E2).forEach(p=>{if(p){const y=p.split(S2);y.length>1&&(h[y[0].trim()]=y[1].trim())}}),h}function V_(r){let h="";if(qn(r))h=r;else if(vi(r))for(let p=0;p<r.length;p++){const y=V_(r[p]);y&&(h+=y+" ")}else if(wn(r))for(const p in r)r[p]&&(h+=p+" ");return h.trim()}const ta=r=>qn(r)?r:r==null?"":vi(r)||wn(r)&&(r.toString===Z0||!Si(r.toString))?JSON.stringify(r,q0,2):String(r),q0=(r,h)=>h&&h.__v_isRef?q0(r,h.value):wc(h)?{[`Map(${h.size})`]:[...h.entries()].reduce((p,[y,b])=>(p[`${y} =>`]=b,p),{})}:$0(h)?{[`Set(${h.size})`]:[...h.values()]}:wn(h)&&!vi(h)&&!W0(h)?String(h):h,un={},bc=[],xo=()=>{},A2=()=>!1,M2=/^on[^a-z]/,ep=r=>M2.test(r),U_=r=>r.startsWith("onUpdate:"),or=Object.assign,N_=(r,h)=>{const p=r.indexOf(h);p>-1&&r.splice(p,1)},I2=Object.prototype.hasOwnProperty,Ui=(r,h)=>I2.call(r,h),vi=Array.isArray,wc=r=>tp(r)==="[object Map]",$0=r=>tp(r)==="[object Set]",Si=r=>typeof r=="function",qn=r=>typeof r=="string",j_=r=>typeof r=="symbol",wn=r=>r!==null&&typeof r=="object",G0=r=>wn(r)&&Si(r.then)&&Si(r.catch),Z0=Object.prototype.toString,tp=r=>Z0.call(r),k2=r=>tp(r).slice(8,-1),W0=r=>tp(r)==="[object Object]",q_=r=>qn(r)&&r!=="NaN"&&r[0]!=="-"&&""+parseInt(r,10)===r,zf=F_(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),ip=r=>{const h=Object.create(null);return p=>h[p]||(h[p]=r(p))},z2=/-(\w)/g,Ac=ip(r=>r.replace(z2,(h,p)=>p?p.toUpperCase():"")),P2=/\B([A-Z])/g,zc=ip(r=>r.replace(P2,"-$1").toLowerCase()),H0=ip(r=>r.charAt(0).toUpperCase()+r.slice(1)),Hm=ip(r=>r?`on${H0(r)}`:""),Ah=(r,h)=>!Object.is(r,h),wh=(r,h)=>{for(let p=0;p<r.length;p++)r[p](h)},Ff=(r,h,p)=>{Object.defineProperty(r,h,{configurable:!0,enumerable:!1,value:p})},X0=r=>{const h=parseFloat(r);return isNaN(h)?r:h};let ix;const D2=()=>ix||(ix=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});let jo;class L2{constructor(h=!1){this.active=!0,this.effects=[],this.cleanups=[],!h&&jo&&(this.parent=jo,this.index=(jo.scopes||(jo.scopes=[])).push(this)-1)}run(h){if(this.active){const p=jo;try{return jo=this,h()}finally{jo=p}}}on(){jo=this}off(){jo=this.parent}stop(h){if(this.active){let p,y;for(p=0,y=this.effects.length;p<y;p++)this.effects[p].stop();for(p=0,y=this.cleanups.length;p<y;p++)this.cleanups[p]();if(this.scopes)for(p=0,y=this.scopes.length;p<y;p++)this.scopes[p].stop(!0);if(this.parent&&!h){const b=this.parent.scopes.pop();b&&b!==this&&(this.parent.scopes[this.index]=b,b.index=this.index)}this.active=!1}}}function B2(r,h=jo){h&&h.active&&h.effects.push(r)}const $_=r=>{const h=new Set(r);return h.w=0,h.n=0,h},K0=r=>(r.w&aa)>0,Y0=r=>(r.n&aa)>0,R2=({deps:r})=>{if(r.length)for(let h=0;h<r.length;h++)r[h].w|=aa},F2=r=>{const{deps:h}=r;if(h.length){let p=0;for(let y=0;y<h.length;y++){const b=h[y];K0(b)&&!Y0(b)?b.delete(r):h[p++]=b,b.w&=~aa,b.n&=~aa}h.length=p}},p_=new WeakMap;let yh=0,aa=1;const m_=30;let _o;const hl=Symbol(""),__=Symbol("");class G_{constructor(h,p=null,y){this.fn=h,this.scheduler=p,this.active=!0,this.deps=[],this.parent=void 0,B2(this,y)}run(){if(!this.active)return this.fn();let h=_o,p=oa;for(;h;){if(h===this)return;h=h.parent}try{return this.parent=_o,_o=this,oa=!0,aa=1<<++yh,yh<=m_?R2(this):nx(this),this.fn()}finally{yh<=m_&&F2(this),aa=1<<--yh,_o=this.parent,oa=p,this.parent=void 0,this.deferStop&&this.stop()}}stop(){_o===this?this.deferStop=!0:this.active&&(nx(this),this.onStop&&this.onStop(),this.active=!1)}}function nx(r){const{deps:h}=r;if(h.length){for(let p=0;p<h.length;p++)h[p].delete(r);h.length=0}}let oa=!0;const J0=[];function Pc(){J0.push(oa),oa=!1}function Dc(){const r=J0.pop();oa=r===void 0?!0:r}function jr(r,h,p){if(oa&&_o){let y=p_.get(r);y||p_.set(r,y=new Map);let b=y.get(p);b||y.set(p,b=$_()),Q0(b)}}function Q0(r,h){let p=!1;yh<=m_?Y0(r)||(r.n|=aa,p=!K0(r)):p=!r.has(_o),p&&(r.add(_o),_o.deps.push(r))}function gs(r,h,p,y,b,E){const A=p_.get(r);if(!A)return;let s=[];if(h==="clear")s=[...A.values()];else if(p==="length"&&vi(r))A.forEach((D,V)=>{(V==="length"||V>=y)&&s.push(D)});else switch(p!==void 0&&s.push(A.get(p)),h){case"add":vi(r)?q_(p)&&s.push(A.get("length")):(s.push(A.get(hl)),wc(r)&&s.push(A.get(__)));break;case"delete":vi(r)||(s.push(A.get(hl)),wc(r)&&s.push(A.get(__)));break;case"set":wc(r)&&s.push(A.get(hl));break}if(s.length===1)s[0]&&g_(s[0]);else{const D=[];for(const V of s)V&&D.push(...V);g_($_(D))}}function g_(r,h){const p=vi(r)?r:[...r];for(const y of p)y.computed&&rx(y);for(const y of p)y.computed||rx(y)}function rx(r,h){(r!==_o||r.allowRecurse)&&(r.scheduler?r.scheduler():r.run())}const O2=F_("__proto__,__v_isRef,__isVue"),e1=new Set(Object.getOwnPropertyNames(Symbol).filter(r=>r!=="arguments"&&r!=="caller").map(r=>Symbol[r]).filter(j_)),V2=Z_(),U2=Z_(!1,!0),N2=Z_(!0),ox=j2();function j2(){const r={};return["includes","indexOf","lastIndexOf"].forEach(h=>{r[h]=function(...p){const y=Li(this);for(let E=0,A=this.length;E<A;E++)jr(y,"get",E+"");const b=y[h](...p);return b===-1||b===!1?y[h](...p.map(Li)):b}}),["push","pop","shift","unshift","splice"].forEach(h=>{r[h]=function(...p){Pc();const y=Li(this)[h].apply(this,p);return Dc(),y}}),r}function Z_(r=!1,h=!1){return function(y,b,E){if(b==="__v_isReactive")return!r;if(b==="__v_isReadonly")return r;if(b==="__v_isShallow")return h;if(b==="__v_raw"&&E===(r?h?rE:o1:h?r1:n1).get(y))return y;const A=vi(y);if(!r&&A&&Ui(ox,b))return Reflect.get(ox,b,E);const s=Reflect.get(y,b,E);return(j_(b)?e1.has(b):O2(b))||(r||jr(y,"get",b),h)?s:mr(s)?A&&q_(b)?s:s.value:wn(s)?r?s1(s):go(s):s}}const q2=t1(),$2=t1(!0);function t1(r=!1){return function(p,y,b,E){let A=p[y];if(Mc(A)&&mr(A)&&!mr(b))return!1;if(!r&&(!Of(b)&&!Mc(b)&&(A=Li(A),b=Li(b)),!vi(p)&&mr(A)&&!mr(b)))return A.value=b,!0;const s=vi(p)&&q_(y)?Number(y)<p.length:Ui(p,y),D=Reflect.set(p,y,b,E);return p===Li(E)&&(s?Ah(b,A)&&gs(p,"set",y,b):gs(p,"add",y,b)),D}}function G2(r,h){const p=Ui(r,h);r[h];const y=Reflect.deleteProperty(r,h);return y&&p&&gs(r,"delete",h,void 0),y}function Z2(r,h){const p=Reflect.has(r,h);return(!j_(h)||!e1.has(h))&&jr(r,"has",h),p}function W2(r){return jr(r,"iterate",vi(r)?"length":hl),Reflect.ownKeys(r)}const i1={get:V2,set:q2,deleteProperty:G2,has:Z2,ownKeys:W2},H2={get:N2,set(r,h){return!0},deleteProperty(r,h){return!0}},X2=or({},i1,{get:U2,set:$2}),W_=r=>r,np=r=>Reflect.getPrototypeOf(r);function gf(r,h,p=!1,y=!1){r=r.__v_raw;const b=Li(r),E=Li(h);p||(h!==E&&jr(b,"get",h),jr(b,"get",E));const{has:A}=np(b),s=y?W_:p?K_:Mh;if(A.call(b,h))return s(r.get(h));if(A.call(b,E))return s(r.get(E));r!==b&&r.get(h)}function yf(r,h=!1){const p=this.__v_raw,y=Li(p),b=Li(r);return h||(r!==b&&jr(y,"has",r),jr(y,"has",b)),r===b?p.has(r):p.has(r)||p.has(b)}function vf(r,h=!1){return r=r.__v_raw,!h&&jr(Li(r),"iterate",hl),Reflect.get(r,"size",r)}function sx(r){r=Li(r);const h=Li(this);return np(h).has.call(h,r)||(h.add(r),gs(h,"add",r,r)),this}function ax(r,h){h=Li(h);const p=Li(this),{has:y,get:b}=np(p);let E=y.call(p,r);E||(r=Li(r),E=y.call(p,r));const A=b.call(p,r);return p.set(r,h),E?Ah(h,A)&&gs(p,"set",r,h):gs(p,"add",r,h),this}function lx(r){const h=Li(this),{has:p,get:y}=np(h);let b=p.call(h,r);b||(r=Li(r),b=p.call(h,r)),y&&y.call(h,r);const E=h.delete(r);return b&&gs(h,"delete",r,void 0),E}function cx(){const r=Li(this),h=r.size!==0,p=r.clear();return h&&gs(r,"clear",void 0,void 0),p}function xf(r,h){return function(y,b){const E=this,A=E.__v_raw,s=Li(A),D=h?W_:r?K_:Mh;return!r&&jr(s,"iterate",hl),A.forEach((V,N)=>y.call(b,D(V),D(N),E))}}function bf(r,h,p){return function(...y){const b=this.__v_raw,E=Li(b),A=wc(E),s=r==="entries"||r===Symbol.iterator&&A,D=r==="keys"&&A,V=b[r](...y),N=p?W_:h?K_:Mh;return!h&&jr(E,"iterate",D?__:hl),{next(){const{value:F,done:q}=V.next();return q?{value:F,done:q}:{value:s?[N(F[0]),N(F[1])]:N(F),done:q}},[Symbol.iterator](){return this}}}}function Ys(r){return function(...h){return r==="delete"?!1:this}}function K2(){const r={get(E){return gf(this,E)},get size(){return vf(this)},has:yf,add:sx,set:ax,delete:lx,clear:cx,forEach:xf(!1,!1)},h={get(E){return gf(this,E,!1,!0)},get size(){return vf(this)},has:yf,add:sx,set:ax,delete:lx,clear:cx,forEach:xf(!1,!0)},p={get(E){return gf(this,E,!0)},get size(){return vf(this,!0)},has(E){return yf.call(this,E,!0)},add:Ys("add"),set:Ys("set"),delete:Ys("delete"),clear:Ys("clear"),forEach:xf(!0,!1)},y={get(E){return gf(this,E,!0,!0)},get size(){return vf(this,!0)},has(E){return yf.call(this,E,!0)},add:Ys("add"),set:Ys("set"),delete:Ys("delete"),clear:Ys("clear"),forEach:xf(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(E=>{r[E]=bf(E,!1,!1),p[E]=bf(E,!0,!1),h[E]=bf(E,!1,!0),y[E]=bf(E,!0,!0)}),[r,p,h,y]}const[Y2,J2,Q2,eE]=K2();function H_(r,h){const p=h?r?eE:Q2:r?J2:Y2;return(y,b,E)=>b==="__v_isReactive"?!r:b==="__v_isReadonly"?r:b==="__v_raw"?y:Reflect.get(Ui(p,b)&&b in y?p:y,b,E)}const tE={get:H_(!1,!1)},iE={get:H_(!1,!0)},nE={get:H_(!0,!1)},n1=new WeakMap,r1=new WeakMap,o1=new WeakMap,rE=new WeakMap;function oE(r){switch(r){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function sE(r){return r.__v_skip||!Object.isExtensible(r)?0:oE(k2(r))}function go(r){return Mc(r)?r:X_(r,!1,i1,tE,n1)}function aE(r){return X_(r,!1,X2,iE,r1)}function s1(r){return X_(r,!0,H2,nE,o1)}function X_(r,h,p,y,b){if(!wn(r)||r.__v_raw&&!(h&&r.__v_isReactive))return r;const E=b.get(r);if(E)return E;const A=sE(r);if(A===0)return r;const s=new Proxy(r,A===2?y:p);return b.set(r,s),s}function Tc(r){return Mc(r)?Tc(r.__v_raw):!!(r&&r.__v_isReactive)}function Mc(r){return!!(r&&r.__v_isReadonly)}function Of(r){return!!(r&&r.__v_isShallow)}function a1(r){return Tc(r)||Mc(r)}function Li(r){const h=r&&r.__v_raw;return h?Li(h):r}function rp(r){return Ff(r,"__v_skip",!0),r}const Mh=r=>wn(r)?go(r):r,K_=r=>wn(r)?s1(r):r;function l1(r){oa&&_o&&(r=Li(r),Q0(r.dep||(r.dep=$_())))}function c1(r,h){r=Li(r),r.dep&&g_(r.dep)}function mr(r){return!!(r&&r.__v_isRef===!0)}function Rt(r){return lE(r,!1)}function lE(r,h){return mr(r)?r:new cE(r,h)}class cE{constructor(h,p){this.__v_isShallow=p,this.dep=void 0,this.__v_isRef=!0,this._rawValue=p?h:Li(h),this._value=p?h:Mh(h)}get value(){return l1(this),this._value}set value(h){const p=this.__v_isShallow||Of(h)||Mc(h);h=p?h:Li(h),Ah(h,this._rawValue)&&(this._rawValue=h,this._value=p?h:Mh(h),c1(this))}}function Y_(r){return mr(r)?r.value:r}const uE={get:(r,h,p)=>Y_(Reflect.get(r,h,p)),set:(r,h,p,y)=>{const b=r[h];return mr(b)&&!mr(p)?(b.value=p,!0):Reflect.set(r,h,p,y)}};function u1(r){return Tc(r)?r:new Proxy(r,uE)}var h1;class hE{constructor(h,p,y,b){this._setter=p,this.dep=void 0,this.__v_isRef=!0,this[h1]=!1,this._dirty=!0,this.effect=new G_(h,()=>{this._dirty||(this._dirty=!0,c1(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!b,this.__v_isReadonly=y}get value(){const h=Li(this);return l1(h),(h._dirty||!h._cacheable)&&(h._dirty=!1,h._value=h.effect.run()),h._value}set value(h){this._setter(h)}}h1="__v_isReadonly";function dE(r,h,p=!1){let y,b;const E=Si(r);return E?(y=r,b=xo):(y=r.get,b=r.set),new hE(y,b,E||!b,p)}function sa(r,h,p,y){let b;try{b=y?r(...y):r()}catch(E){op(E,h,p)}return b}function Qr(r,h,p,y){if(Si(r)){const E=sa(r,h,p,y);return E&&G0(E)&&E.catch(A=>{op(A,h,p)}),E}const b=[];for(let E=0;E<r.length;E++)b.push(Qr(r[E],h,p,y));return b}function op(r,h,p,y=!0){const b=h?h.vnode:null;if(h){let E=h.parent;const A=h.proxy,s=p;for(;E;){const V=E.ec;if(V){for(let N=0;N<V.length;N++)if(V[N](r,A,s)===!1)return}E=E.parent}const D=h.appContext.config.errorHandler;if(D){sa(D,null,10,[r,A,s]);return}}fE(r,p,b,y)}function fE(r,h,p,y=!0){console.error(r)}let Ih=!1,y_=!1;const pr=[];let Go=0;const Ec=[];let fs=null,ol=0;const d1=Promise.resolve();let J_=null;function fn(r){const h=J_||d1;return r?h.then(this?r.bind(this):r):h}function pE(r){let h=Go+1,p=pr.length;for(;h<p;){const y=h+p>>>1;kh(pr[y])<r?h=y+1:p=y}return h}function Q_(r){(!pr.length||!pr.includes(r,Ih&&r.allowRecurse?Go+1:Go))&&(r.id==null?pr.push(r):pr.splice(pE(r.id),0,r),f1())}function f1(){!Ih&&!y_&&(y_=!0,J_=d1.then(m1))}function mE(r){const h=pr.indexOf(r);h>Go&&pr.splice(h,1)}function _E(r){vi(r)?Ec.push(...r):(!fs||!fs.includes(r,r.allowRecurse?ol+1:ol))&&Ec.push(r),f1()}function ux(r,h=Ih?Go+1:0){for(;h<pr.length;h++){const p=pr[h];p&&p.pre&&(pr.splice(h,1),h--,p())}}function p1(r){if(Ec.length){const h=[...new Set(Ec)];if(Ec.length=0,fs){fs.push(...h);return}for(fs=h,fs.sort((p,y)=>kh(p)-kh(y)),ol=0;ol<fs.length;ol++)fs[ol]();fs=null,ol=0}}const kh=r=>r.id==null?1/0:r.id,gE=(r,h)=>{const p=kh(r)-kh(h);if(p===0){if(r.pre&&!h.pre)return-1;if(h.pre&&!r.pre)return 1}return p};function m1(r){y_=!1,Ih=!0,pr.sort(gE);const h=xo;try{for(Go=0;Go<pr.length;Go++){const p=pr[Go];p&&p.active!==!1&&sa(p,null,14)}}finally{Go=0,pr.length=0,p1(),Ih=!1,J_=null,(pr.length||Ec.length)&&m1()}}function yE(r,h,...p){if(r.isUnmounted)return;const y=r.vnode.props||un;let b=p;const E=h.startsWith("update:"),A=E&&h.slice(7);if(A&&A in y){const N=`${A==="modelValue"?"model":A}Modifiers`,{number:F,trim:q}=y[N]||un;q&&(b=p.map(H=>H.trim())),F&&(b=p.map(X0))}let s,D=y[s=Hm(h)]||y[s=Hm(Ac(h))];!D&&E&&(D=y[s=Hm(zc(h))]),D&&Qr(D,r,6,b);const V=y[s+"Once"];if(V){if(!r.emitted)r.emitted={};else if(r.emitted[s])return;r.emitted[s]=!0,Qr(V,r,6,b)}}function _1(r,h,p=!1){const y=h.emitsCache,b=y.get(r);if(b!==void 0)return b;const E=r.emits;let A={},s=!1;if(!Si(r)){const D=V=>{const N=_1(V,h,!0);N&&(s=!0,or(A,N))};!p&&h.mixins.length&&h.mixins.forEach(D),r.extends&&D(r.extends),r.mixins&&r.mixins.forEach(D)}return!E&&!s?(wn(r)&&y.set(r,null),null):(vi(E)?E.forEach(D=>A[D]=null):or(A,E),wn(r)&&y.set(r,A),A)}function sp(r,h){return!r||!ep(h)?!1:(h=h.slice(2).replace(/Once$/,""),Ui(r,h[0].toLowerCase()+h.slice(1))||Ui(r,zc(h))||Ui(r,h))}let yo=null,g1=null;function Vf(r){const h=yo;return yo=r,g1=r&&r.type.__scopeId||null,h}function cn(r,h=yo,p){if(!h||r._n)return r;const y=(...b)=>{y._d&&bx(-1);const E=Vf(h),A=r(...b);return Vf(E),y._d&&bx(1),A};return y._n=!0,y._c=!0,y._d=!0,y}function Xm(r){const{type:h,vnode:p,proxy:y,withProxy:b,props:E,propsOptions:[A],slots:s,attrs:D,emit:V,render:N,renderCache:F,data:q,setupState:H,ctx:de,inheritAttrs:ye}=r;let ze,He;const we=Vf(r);try{if(p.shapeFlag&4){const Ne=b||y;ze=qo(N.call(Ne,Ne,F,E,H,q,de)),He=D}else{const Ne=h;ze=qo(Ne.length>1?Ne(E,{attrs:D,slots:s,emit:V}):Ne(E,null)),He=h.props?D:vE(D)}}catch(Ne){Sh.length=0,op(Ne,r,1),ze=Ft(wo)}let Le=ze;if(He&&ye!==!1){const Ne=Object.keys(He),{shapeFlag:Te}=Le;Ne.length&&Te&7&&(A&&Ne.some(U_)&&(He=xE(He,A)),Le=ys(Le,He))}return p.dirs&&(Le=ys(Le),Le.dirs=Le.dirs?Le.dirs.concat(p.dirs):p.dirs),p.transition&&(Le.transition=p.transition),ze=Le,Vf(we),ze}const vE=r=>{let h;for(const p in r)(p==="class"||p==="style"||ep(p))&&((h||(h={}))[p]=r[p]);return h},xE=(r,h)=>{const p={};for(const y in r)(!U_(y)||!(y.slice(9)in h))&&(p[y]=r[y]);return p};function bE(r,h,p){const{props:y,children:b,component:E}=r,{props:A,children:s,patchFlag:D}=h,V=E.emitsOptions;if(h.dirs||h.transition)return!0;if(p&&D>=0){if(D&1024)return!0;if(D&16)return y?hx(y,A,V):!!A;if(D&8){const N=h.dynamicProps;for(let F=0;F<N.length;F++){const q=N[F];if(A[q]!==y[q]&&!sp(V,q))return!0}}}else return(b||s)&&(!s||!s.$stable)?!0:y===A?!1:y?A?hx(y,A,V):!0:!!A;return!1}function hx(r,h,p){const y=Object.keys(h);if(y.length!==Object.keys(r).length)return!0;for(let b=0;b<y.length;b++){const E=y[b];if(h[E]!==r[E]&&!sp(p,E))return!0}return!1}function wE({vnode:r,parent:h},p){for(;h&&h.subTree===r;)(r=h.vnode).el=p,h=h.parent}const y1=r=>r.__isSuspense;function TE(r,h){h&&h.pendingBranch?vi(r)?h.effects.push(...r):h.effects.push(r):_E(r)}function Lc(r,h){if(rr){let p=rr.provides;const y=rr.parent&&rr.parent.provides;y===p&&(p=rr.provides=Object.create(y)),p[r]=h}}function bo(r,h,p=!1){const y=rr||yo;if(y){const b=y.parent==null?y.vnode.appContext&&y.vnode.appContext.provides:y.parent.provides;if(b&&r in b)return b[r];if(arguments.length>1)return p&&Si(h)?h.call(y.proxy):h}}const dx={};function ri(r,h,p){return v1(r,h,p)}function v1(r,h,{immediate:p,deep:y,flush:b,onTrack:E,onTrigger:A}=un){const s=rr;let D,V=!1,N=!1;if(mr(r)?(D=()=>r.value,V=Of(r)):Tc(r)?(D=()=>r,y=!0):vi(r)?(N=!0,V=r.some(He=>Tc(He)||Of(He)),D=()=>r.map(He=>{if(mr(He))return He.value;if(Tc(He))return ll(He);if(Si(He))return sa(He,s,2)})):Si(r)?h?D=()=>sa(r,s,2):D=()=>{if(!(s&&s.isUnmounted))return F&&F(),Qr(r,s,3,[q])}:D=xo,h&&y){const He=D;D=()=>ll(He())}let F,q=He=>{F=ze.onStop=()=>{sa(He,s,4)}};if(Ph)return q=xo,h?p&&Qr(h,s,3,[D(),N?[]:void 0,q]):D(),xo;let H=N?[]:dx;const de=()=>{if(!!ze.active)if(h){const He=ze.run();(y||V||(N?He.some((we,Le)=>Ah(we,H[Le])):Ah(He,H)))&&(F&&F(),Qr(h,s,3,[He,H===dx?void 0:H,q]),H=He)}else ze.run()};de.allowRecurse=!!h;let ye;b==="sync"?ye=de:b==="post"?ye=()=>ir(de,s&&s.suspense):(de.pre=!0,s&&(de.id=s.uid),ye=()=>Q_(de));const ze=new G_(D,ye);return h?p?de():H=ze.run():b==="post"?ir(ze.run.bind(ze),s&&s.suspense):ze.run(),()=>{ze.stop(),s&&s.scope&&N_(s.scope.effects,ze)}}function EE(r,h,p){const y=this.proxy,b=qn(r)?r.includes(".")?x1(y,r):()=>y[r]:r.bind(y,y);let E;Si(h)?E=h:(E=h.handler,p=h);const A=rr;Ic(this);const s=v1(b,E.bind(y),p);return A?Ic(A):dl(),s}function x1(r,h){const p=h.split(".");return()=>{let y=r;for(let b=0;b<p.length&&y;b++)y=y[p[b]];return y}}function ll(r,h){if(!wn(r)||r.__v_skip||(h=h||new Set,h.has(r)))return r;if(h.add(r),mr(r))ll(r.value,h);else if(vi(r))for(let p=0;p<r.length;p++)ll(r[p],h);else if($0(r)||wc(r))r.forEach(p=>{ll(p,h)});else if(W0(r))for(const p in r)ll(r[p],h);return r}function SE(){const r={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return sr(()=>{r.isMounted=!0}),_n(()=>{r.isUnmounting=!0}),r}const Xr=[Function,Array],CE={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Xr,onEnter:Xr,onAfterEnter:Xr,onEnterCancelled:Xr,onBeforeLeave:Xr,onLeave:Xr,onAfterLeave:Xr,onLeaveCancelled:Xr,onBeforeAppear:Xr,onAppear:Xr,onAfterAppear:Xr,onAppearCancelled:Xr},setup(r,{slots:h}){const p=Oi(),y=SE();let b;return()=>{const E=h.default&&T1(h.default(),!0);if(!E||!E.length)return;let A=E[0];if(E.length>1){for(const ye of E)if(ye.type!==wo){A=ye;break}}const s=Li(r),{mode:D}=s;if(y.isLeaving)return Km(A);const V=fx(A);if(!V)return Km(A);const N=v_(V,s,y,p);Uf(V,N);const F=p.subTree,q=F&&fx(F);let H=!1;const{getTransitionKey:de}=V.type;if(de){const ye=de();b===void 0?b=ye:ye!==b&&(b=ye,H=!0)}if(q&&q.type!==wo&&(!sl(V,q)||H)){const ye=v_(q,s,y,p);if(Uf(q,ye),D==="out-in")return y.isLeaving=!0,ye.afterLeave=()=>{y.isLeaving=!1,p.update()},Km(A);D==="in-out"&&V.type!==wo&&(ye.delayLeave=(ze,He,we)=>{const Le=w1(y,q);Le[String(q.key)]=q,ze._leaveCb=()=>{He(),ze._leaveCb=void 0,delete N.delayedLeave},N.delayedLeave=we})}return A}}},b1=CE;function w1(r,h){const{leavingVNodes:p}=r;let y=p.get(h.type);return y||(y=Object.create(null),p.set(h.type,y)),y}function v_(r,h,p,y){const{appear:b,mode:E,persisted:A=!1,onBeforeEnter:s,onEnter:D,onAfterEnter:V,onEnterCancelled:N,onBeforeLeave:F,onLeave:q,onAfterLeave:H,onLeaveCancelled:de,onBeforeAppear:ye,onAppear:ze,onAfterAppear:He,onAppearCancelled:we}=h,Le=String(r.key),Ne=w1(p,r),Te=(De,Ke)=>{De&&Qr(De,y,9,Ke)},Pe=(De,Ke)=>{const Ue=Ke[1];Te(De,Ke),vi(De)?De.every(nt=>nt.length<=1)&&Ue():De.length<=1&&Ue()},xe={mode:E,persisted:A,beforeEnter(De){let Ke=s;if(!p.isMounted)if(b)Ke=ye||s;else return;De._leaveCb&&De._leaveCb(!0);const Ue=Ne[Le];Ue&&sl(r,Ue)&&Ue.el._leaveCb&&Ue.el._leaveCb(),Te(Ke,[De])},enter(De){let Ke=D,Ue=V,nt=N;if(!p.isMounted)if(b)Ke=ze||D,Ue=He||V,nt=we||N;else return;let $e=!1;const Ge=De._enterCb=Ye=>{$e||($e=!0,Ye?Te(nt,[De]):Te(Ue,[De]),xe.delayedLeave&&xe.delayedLeave(),De._enterCb=void 0)};Ke?Pe(Ke,[De,Ge]):Ge()},leave(De,Ke){const Ue=String(r.key);if(De._enterCb&&De._enterCb(!0),p.isUnmounting)return Ke();Te(F,[De]);let nt=!1;const $e=De._leaveCb=Ge=>{nt||(nt=!0,Ke(),Ge?Te(de,[De]):Te(H,[De]),De._leaveCb=void 0,Ne[Ue]===r&&delete Ne[Ue])};Ne[Ue]=r,q?Pe(q,[De,$e]):$e()},clone(De){return v_(De,h,p,y)}};return xe}function Km(r){if(ap(r))return r=ys(r),r.children=null,r}function fx(r){return ap(r)?r.children?r.children[0]:void 0:r}function Uf(r,h){r.shapeFlag&6&&r.component?Uf(r.component.subTree,h):r.shapeFlag&128?(r.ssContent.transition=h.clone(r.ssContent),r.ssFallback.transition=h.clone(r.ssFallback)):r.transition=h}function T1(r,h=!1,p){let y=[],b=0;for(let E=0;E<r.length;E++){let A=r[E];const s=p==null?A.key:String(p)+String(A.key!=null?A.key:E);A.type===wr?(A.patchFlag&128&&b++,y=y.concat(T1(A.children,h,s))):(h||A.type!==wo)&&y.push(s!=null?ys(A,{key:s}):A)}if(b>1)for(let E=0;E<y.length;E++)y[E].patchFlag=-2;return y}function AE(r){return Si(r)?{setup:r,name:r.name}:r}const Th=r=>!!r.type.__asyncLoader,ap=r=>r.type.__isKeepAlive,ME={name:"KeepAlive",__isKeepAlive:!0,props:{include:[String,RegExp,Array],exclude:[String,RegExp,Array],max:[String,Number]},setup(r,{slots:h}){const p=Oi(),y=p.ctx;if(!y.renderer)return()=>{const we=h.default&&h.default();return we&&we.length===1?we[0]:we};const b=new Map,E=new Set;let A=null;const s=p.suspense,{renderer:{p:D,m:V,um:N,o:{createElement:F}}}=y,q=F("div");y.activate=(we,Le,Ne,Te,Pe)=>{const xe=we.component;V(we,Le,Ne,0,s),D(xe.vnode,we,Le,Ne,xe,s,Te,we.slotScopeIds,Pe),ir(()=>{xe.isDeactivated=!1,xe.a&&wh(xe.a);const De=we.props&&we.props.onVnodeMounted;De&&Yr(De,xe.parent,we)},s)},y.deactivate=we=>{const Le=we.component;V(we,q,null,1,s),ir(()=>{Le.da&&wh(Le.da);const Ne=we.props&&we.props.onVnodeUnmounted;Ne&&Yr(Ne,Le.parent,we),Le.isDeactivated=!0},s)};function H(we){Ym(we),N(we,p,s,!0)}function de(we){b.forEach((Le,Ne)=>{const Te=Ex(Le.type);Te&&(!we||!we(Te))&&ye(Ne)})}function ye(we){const Le=b.get(we);!A||Le.type!==A.type?H(Le):A&&Ym(A),b.delete(we),E.delete(we)}ri(()=>[r.include,r.exclude],([we,Le])=>{we&&de(Ne=>vh(we,Ne)),Le&&de(Ne=>!vh(Le,Ne))},{flush:"post",deep:!0});let ze=null;const He=()=>{ze!=null&&b.set(ze,Jm(p.subTree))};return sr(He),ig(He),_n(()=>{b.forEach(we=>{const{subTree:Le,suspense:Ne}=p,Te=Jm(Le);if(we.type===Te.type){Ym(Te);const Pe=Te.component.da;Pe&&ir(Pe,Ne);return}H(we)})}),()=>{if(ze=null,!h.default)return null;const we=h.default(),Le=we[0];if(we.length>1)return A=null,we;if(!qf(Le)||!(Le.shapeFlag&4)&&!(Le.shapeFlag&128))return A=null,Le;let Ne=Jm(Le);const Te=Ne.type,Pe=Ex(Th(Ne)?Ne.type.__asyncResolved||{}:Te),{include:xe,exclude:De,max:Ke}=r;if(xe&&(!Pe||!vh(xe,Pe))||De&&Pe&&vh(De,Pe))return A=Ne,Le;const Ue=Ne.key==null?Te:Ne.key,nt=b.get(Ue);return Ne.el&&(Ne=ys(Ne),Le.shapeFlag&128&&(Le.ssContent=Ne)),ze=Ue,nt?(Ne.el=nt.el,Ne.component=nt.component,Ne.transition&&Uf(Ne,Ne.transition),Ne.shapeFlag|=512,E.delete(Ue),E.add(Ue)):(E.add(Ue),Ke&&E.size>parseInt(Ke,10)&&ye(E.values().next().value)),Ne.shapeFlag|=256,A=Ne,y1(Le.type)?Le:Ne}}},IE=ME;function vh(r,h){return vi(r)?r.some(p=>vh(p,h)):qn(r)?r.split(",").includes(h):r.test?r.test(h):!1}function lp(r,h){E1(r,"a",h)}function Bc(r,h){E1(r,"da",h)}function E1(r,h,p=rr){const y=r.__wdc||(r.__wdc=()=>{let b=p;for(;b;){if(b.isDeactivated)return;b=b.parent}return r()});if(cp(h,y,p),p){let b=p.parent;for(;b&&b.parent;)ap(b.parent.vnode)&&kE(y,h,p,b),b=b.parent}}function kE(r,h,p,y){const b=cp(h,r,y,!0);up(()=>{N_(y[h],b)},p)}function Ym(r){let h=r.shapeFlag;h&256&&(h-=256),h&512&&(h-=512),r.shapeFlag=h}function Jm(r){return r.shapeFlag&128?r.ssContent:r}function cp(r,h,p=rr,y=!1){if(p){const b=p[r]||(p[r]=[]),E=h.__weh||(h.__weh=(...A)=>{if(p.isUnmounted)return;Pc(),Ic(p);const s=Qr(h,p,r,A);return dl(),Dc(),s});return y?b.unshift(E):b.push(E),E}}const xs=r=>(h,p=rr)=>(!Ph||r==="sp")&&cp(r,(...y)=>h(...y),p),eg=xs("bm"),sr=xs("m"),tg=xs("bu"),ig=xs("u"),_n=xs("bum"),up=xs("um"),zE=xs("sp"),PE=xs("rtg"),DE=xs("rtc");function LE(r,h=rr){cp("ec",r,h)}function ng(r,h){const p=yo;if(p===null)return r;const y=dp(p)||p.proxy,b=r.dirs||(r.dirs=[]);for(let E=0;E<h.length;E++){let[A,s,D,V=un]=h[E];Si(A)&&(A={mounted:A,updated:A}),A.deep&&ll(s),b.push({dir:A,instance:y,value:s,oldValue:void 0,arg:D,modifiers:V})}return r}function el(r,h,p,y){const b=r.dirs,E=h&&h.dirs;for(let A=0;A<b.length;A++){const s=b[A];E&&(s.oldValue=E[A].value);let D=s.dir[y];D&&(Pc(),Qr(D,p,8,[r.el,s,r,h]),Dc())}}const BE=Symbol(),x_=r=>r?B1(r)?dp(r)||r.proxy:x_(r.parent):null,Nf=or(Object.create(null),{$:r=>r,$el:r=>r.vnode.el,$data:r=>r.data,$props:r=>r.props,$attrs:r=>r.attrs,$slots:r=>r.slots,$refs:r=>r.refs,$parent:r=>x_(r.parent),$root:r=>x_(r.root),$emit:r=>r.emit,$options:r=>rg(r),$forceUpdate:r=>r.f||(r.f=()=>Q_(r.update)),$nextTick:r=>r.n||(r.n=fn.bind(r.proxy)),$watch:r=>EE.bind(r)}),RE={get({_:r},h){const{ctx:p,setupState:y,data:b,props:E,accessCache:A,type:s,appContext:D}=r;let V;if(h[0]!=="$"){const H=A[h];if(H!==void 0)switch(H){case 1:return y[h];case 2:return b[h];case 4:return p[h];case 3:return E[h]}else{if(y!==un&&Ui(y,h))return A[h]=1,y[h];if(b!==un&&Ui(b,h))return A[h]=2,b[h];if((V=r.propsOptions[0])&&Ui(V,h))return A[h]=3,E[h];if(p!==un&&Ui(p,h))return A[h]=4,p[h];b_&&(A[h]=0)}}const N=Nf[h];let F,q;if(N)return h==="$attrs"&&jr(r,"get",h),N(r);if((F=s.__cssModules)&&(F=F[h]))return F;if(p!==un&&Ui(p,h))return A[h]=4,p[h];if(q=D.config.globalProperties,Ui(q,h))return q[h]},set({_:r},h,p){const{data:y,setupState:b,ctx:E}=r;return b!==un&&Ui(b,h)?(b[h]=p,!0):y!==un&&Ui(y,h)?(y[h]=p,!0):Ui(r.props,h)||h[0]==="$"&&h.slice(1)in r?!1:(E[h]=p,!0)},has({_:{data:r,setupState:h,accessCache:p,ctx:y,appContext:b,propsOptions:E}},A){let s;return!!p[A]||r!==un&&Ui(r,A)||h!==un&&Ui(h,A)||(s=E[0])&&Ui(s,A)||Ui(y,A)||Ui(Nf,A)||Ui(b.config.globalProperties,A)},defineProperty(r,h,p){return p.get!=null?r._.accessCache[h]=0:Ui(p,"value")&&this.set(r,h,p.value,null),Reflect.defineProperty(r,h,p)}};let b_=!0;function FE(r){const h=rg(r),p=r.proxy,y=r.ctx;b_=!1,h.beforeCreate&&px(h.beforeCreate,r,"bc");const{data:b,computed:E,methods:A,watch:s,provide:D,inject:V,created:N,beforeMount:F,mounted:q,beforeUpdate:H,updated:de,activated:ye,deactivated:ze,beforeDestroy:He,beforeUnmount:we,destroyed:Le,unmounted:Ne,render:Te,renderTracked:Pe,renderTriggered:xe,errorCaptured:De,serverPrefetch:Ke,expose:Ue,inheritAttrs:nt,components:$e,directives:Ge,filters:Ye}=h;if(V&&OE(V,y,null,r.appContext.config.unwrapInjectedRef),A)for(const ot in A){const At=A[ot];Si(At)&&(y[ot]=At.bind(p))}if(b){const ot=b.call(p,p);wn(ot)&&(r.data=go(ot))}if(b_=!0,E)for(const ot in E){const At=E[ot],di=Si(At)?At.bind(p,p):Si(At.get)?At.get.bind(p,p):xo,Oe=!Si(At)&&Si(At.set)?At.set.bind(p):xo,_t=be({get:di,set:Oe});Object.defineProperty(y,ot,{enumerable:!0,configurable:!0,get:()=>_t.value,set:xt=>_t.value=xt})}if(s)for(const ot in s)S1(s[ot],y,p,ot);if(D){const ot=Si(D)?D.call(p):D;Reflect.ownKeys(ot).forEach(At=>{Lc(At,ot[At])})}N&&px(N,r,"c");function Ht(ot,At){vi(At)?At.forEach(di=>ot(di.bind(p))):At&&ot(At.bind(p))}if(Ht(eg,F),Ht(sr,q),Ht(tg,H),Ht(ig,de),Ht(lp,ye),Ht(Bc,ze),Ht(LE,De),Ht(DE,Pe),Ht(PE,xe),Ht(_n,we),Ht(up,Ne),Ht(zE,Ke),vi(Ue))if(Ue.length){const ot=r.exposed||(r.exposed={});Ue.forEach(At=>{Object.defineProperty(ot,At,{get:()=>p[At],set:di=>p[At]=di})})}else r.exposed||(r.exposed={});Te&&r.render===xo&&(r.render=Te),nt!=null&&(r.inheritAttrs=nt),$e&&(r.components=$e),Ge&&(r.directives=Ge)}function OE(r,h,p=xo,y=!1){vi(r)&&(r=w_(r));for(const b in r){const E=r[b];let A;wn(E)?"default"in E?A=bo(E.from||b,E.default,!0):A=bo(E.from||b):A=bo(E),mr(A)&&y?Object.defineProperty(h,b,{enumerable:!0,configurable:!0,get:()=>A.value,set:s=>A.value=s}):h[b]=A}}function px(r,h,p){Qr(vi(r)?r.map(y=>y.bind(h.proxy)):r.bind(h.proxy),h,p)}function S1(r,h,p,y){const b=y.includes(".")?x1(p,y):()=>p[y];if(qn(r)){const E=h[r];Si(E)&&ri(b,E)}else if(Si(r))ri(b,r.bind(p));else if(wn(r))if(vi(r))r.forEach(E=>S1(E,h,p,y));else{const E=Si(r.handler)?r.handler.bind(p):h[r.handler];Si(E)&&ri(b,E,r)}}function rg(r){const h=r.type,{mixins:p,extends:y}=h,{mixins:b,optionsCache:E,config:{optionMergeStrategies:A}}=r.appContext,s=E.get(h);let D;return s?D=s:!b.length&&!p&&!y?D=h:(D={},b.length&&b.forEach(V=>jf(D,V,A,!0)),jf(D,h,A)),wn(h)&&E.set(h,D),D}function jf(r,h,p,y=!1){const{mixins:b,extends:E}=h;E&&jf(r,E,p,!0),b&&b.forEach(A=>jf(r,A,p,!0));for(const A in h)if(!(y&&A==="expose")){const s=VE[A]||p&&p[A];r[A]=s?s(r[A],h[A]):h[A]}return r}const VE={data:mx,props:rl,emits:rl,methods:rl,computed:rl,beforeCreate:br,created:br,beforeMount:br,mounted:br,beforeUpdate:br,updated:br,beforeDestroy:br,beforeUnmount:br,destroyed:br,unmounted:br,activated:br,deactivated:br,errorCaptured:br,serverPrefetch:br,components:rl,directives:rl,watch:NE,provide:mx,inject:UE};function mx(r,h){return h?r?function(){return or(Si(r)?r.call(this,this):r,Si(h)?h.call(this,this):h)}:h:r}function UE(r,h){return rl(w_(r),w_(h))}function w_(r){if(vi(r)){const h={};for(let p=0;p<r.length;p++)h[r[p]]=r[p];return h}return r}function br(r,h){return r?[...new Set([].concat(r,h))]:h}function rl(r,h){return r?or(or(Object.create(null),r),h):h}function NE(r,h){if(!r)return h;if(!h)return r;const p=or(Object.create(null),r);for(const y in h)p[y]=br(r[y],h[y]);return p}function jE(r,h,p,y=!1){const b={},E={};Ff(E,hp,1),r.propsDefaults=Object.create(null),C1(r,h,b,E);for(const A in r.propsOptions[0])A in b||(b[A]=void 0);p?r.props=y?b:aE(b):r.type.props?r.props=b:r.props=E,r.attrs=E}function qE(r,h,p,y){const{props:b,attrs:E,vnode:{patchFlag:A}}=r,s=Li(b),[D]=r.propsOptions;let V=!1;if((y||A>0)&&!(A&16)){if(A&8){const N=r.vnode.dynamicProps;for(let F=0;F<N.length;F++){let q=N[F];if(sp(r.emitsOptions,q))continue;const H=h[q];if(D)if(Ui(E,q))H!==E[q]&&(E[q]=H,V=!0);else{const de=Ac(q);b[de]=T_(D,s,de,H,r,!1)}else H!==E[q]&&(E[q]=H,V=!0)}}}else{C1(r,h,b,E)&&(V=!0);let N;for(const F in s)(!h||!Ui(h,F)&&((N=zc(F))===F||!Ui(h,N)))&&(D?p&&(p[F]!==void 0||p[N]!==void 0)&&(b[F]=T_(D,s,F,void 0,r,!0)):delete b[F]);if(E!==s)for(const F in E)(!h||!Ui(h,F)&&!0)&&(delete E[F],V=!0)}V&&gs(r,"set","$attrs")}function C1(r,h,p,y){const[b,E]=r.propsOptions;let A=!1,s;if(h)for(let D in h){if(zf(D))continue;const V=h[D];let N;b&&Ui(b,N=Ac(D))?!E||!E.includes(N)?p[N]=V:(s||(s={}))[N]=V:sp(r.emitsOptions,D)||(!(D in y)||V!==y[D])&&(y[D]=V,A=!0)}if(E){const D=Li(p),V=s||un;for(let N=0;N<E.length;N++){const F=E[N];p[F]=T_(b,D,F,V[F],r,!Ui(V,F))}}return A}function T_(r,h,p,y,b,E){const A=r[p];if(A!=null){const s=Ui(A,"default");if(s&&y===void 0){const D=A.default;if(A.type!==Function&&Si(D)){const{propsDefaults:V}=b;p in V?y=V[p]:(Ic(b),y=V[p]=D.call(null,h),dl())}else y=D}A[0]&&(E&&!s?y=!1:A[1]&&(y===""||y===zc(p))&&(y=!0))}return y}function A1(r,h,p=!1){const y=h.propsCache,b=y.get(r);if(b)return b;const E=r.props,A={},s=[];let D=!1;if(!Si(r)){const N=F=>{D=!0;const[q,H]=A1(F,h,!0);or(A,q),H&&s.push(...H)};!p&&h.mixins.length&&h.mixins.forEach(N),r.extends&&N(r.extends),r.mixins&&r.mixins.forEach(N)}if(!E&&!D)return wn(r)&&y.set(r,bc),bc;if(vi(E))for(let N=0;N<E.length;N++){const F=Ac(E[N]);_x(F)&&(A[F]=un)}else if(E)for(const N in E){const F=Ac(N);if(_x(F)){const q=E[N],H=A[F]=vi(q)||Si(q)?{type:q}:q;if(H){const de=vx(Boolean,H.type),ye=vx(String,H.type);H[0]=de>-1,H[1]=ye<0||de<ye,(de>-1||Ui(H,"default"))&&s.push(F)}}}const V=[A,s];return wn(r)&&y.set(r,V),V}function _x(r){return r[0]!=="$"}function gx(r){const h=r&&r.toString().match(/^\s*function (\w+)/);return h?h[1]:r===null?"null":""}function yx(r,h){return gx(r)===gx(h)}function vx(r,h){return vi(h)?h.findIndex(p=>yx(p,r)):Si(h)&&yx(h,r)?0:-1}const M1=r=>r[0]==="_"||r==="$stable",og=r=>vi(r)?r.map(qo):[qo(r)],$E=(r,h,p)=>{if(h._n)return h;const y=cn((...b)=>og(h(...b)),p);return y._c=!1,y},I1=(r,h,p)=>{const y=r._ctx;for(const b in r){if(M1(b))continue;const E=r[b];if(Si(E))h[b]=$E(b,E,y);else if(E!=null){const A=og(E);h[b]=()=>A}}},k1=(r,h)=>{const p=og(h);r.slots.default=()=>p},GE=(r,h)=>{if(r.vnode.shapeFlag&32){const p=h._;p?(r.slots=Li(h),Ff(h,"_",p)):I1(h,r.slots={})}else r.slots={},h&&k1(r,h);Ff(r.slots,hp,1)},ZE=(r,h,p)=>{const{vnode:y,slots:b}=r;let E=!0,A=un;if(y.shapeFlag&32){const s=h._;s?p&&s===1?E=!1:(or(b,h),!p&&s===1&&delete b._):(E=!h.$stable,I1(h,b)),A=h}else h&&(k1(r,h),A={default:1});if(E)for(const s in b)!M1(s)&&!(s in A)&&delete b[s]};function z1(){return{app:null,config:{isNativeTag:A2,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let WE=0;function HE(r,h){return function(y,b=null){Si(y)||(y=Object.assign({},y)),b!=null&&!wn(b)&&(b=null);const E=z1(),A=new Set;let s=!1;const D=E.app={_uid:WE++,_component:y,_props:b,_container:null,_context:E,_instance:null,version:pS,get config(){return E.config},set config(V){},use(V,...N){return A.has(V)||(V&&Si(V.install)?(A.add(V),V.install(D,...N)):Si(V)&&(A.add(V),V(D,...N))),D},mixin(V){return E.mixins.includes(V)||E.mixins.push(V),D},component(V,N){return N?(E.components[V]=N,D):E.components[V]},directive(V,N){return N?(E.directives[V]=N,D):E.directives[V]},mount(V,N,F){if(!s){const q=Ft(y,b);return q.appContext=E,N&&h?h(q,V):r(q,V,F),s=!0,D._container=V,V.__vue_app__=D,dp(q.component)||q.component.proxy}},unmount(){s&&(r(null,D._container),delete D._container.__vue_app__)},provide(V,N){return E.provides[V]=N,D}};return D}}function E_(r,h,p,y,b=!1){if(vi(r)){r.forEach((q,H)=>E_(q,h&&(vi(h)?h[H]:h),p,y,b));return}if(Th(y)&&!b)return;const E=y.shapeFlag&4?dp(y.component)||y.component.proxy:y.el,A=b?null:E,{i:s,r:D}=r,V=h&&h.r,N=s.refs===un?s.refs={}:s.refs,F=s.setupState;if(V!=null&&V!==D&&(qn(V)?(N[V]=null,Ui(F,V)&&(F[V]=null)):mr(V)&&(V.value=null)),Si(D))sa(D,s,12,[A,N]);else{const q=qn(D),H=mr(D);if(q||H){const de=()=>{if(r.f){const ye=q?N[D]:D.value;b?vi(ye)&&N_(ye,E):vi(ye)?ye.includes(E)||ye.push(E):q?(N[D]=[E],Ui(F,D)&&(F[D]=N[D])):(D.value=[E],r.k&&(N[r.k]=D.value))}else q?(N[D]=A,Ui(F,D)&&(F[D]=A)):H&&(D.value=A,r.k&&(N[r.k]=A))};A?(de.id=-1,ir(de,p)):de()}}}const ir=TE;function XE(r){return KE(r)}function KE(r,h){const p=D2();p.__VUE__=!0;const{insert:y,remove:b,patchProp:E,createElement:A,createText:s,createComment:D,setText:V,setElementText:N,parentNode:F,nextSibling:q,setScopeId:H=xo,insertStaticContent:de}=r,ye=(ue,Ee,Re,ct=null,ut=null,bt=null,Mt=!1,gt=null,Xe=!!Ee.dynamicChildren)=>{if(ue===Ee)return;ue&&!sl(ue,Ee)&&(ct=Yt(ue),xt(ue,ut,bt,!0),ue=null),Ee.patchFlag===-2&&(Xe=!1,Ee.dynamicChildren=null);const{type:ht,ref:qt,shapeFlag:Nt}=Ee;switch(ht){case ag:ze(ue,Ee,Re,ct);break;case wo:He(ue,Ee,Re,ct);break;case Pf:ue==null&&we(Ee,Re,ct,Mt);break;case wr:$e(ue,Ee,Re,ct,ut,bt,Mt,gt,Xe);break;default:Nt&1?Te(ue,Ee,Re,ct,ut,bt,Mt,gt,Xe):Nt&6?Ge(ue,Ee,Re,ct,ut,bt,Mt,gt,Xe):(Nt&64||Nt&128)&&ht.process(ue,Ee,Re,ct,ut,bt,Mt,gt,Xe,Et)}qt!=null&&ut&&E_(qt,ue&&ue.ref,bt,Ee||ue,!Ee)},ze=(ue,Ee,Re,ct)=>{if(ue==null)y(Ee.el=s(Ee.children),Re,ct);else{const ut=Ee.el=ue.el;Ee.children!==ue.children&&V(ut,Ee.children)}},He=(ue,Ee,Re,ct)=>{ue==null?y(Ee.el=D(Ee.children||""),Re,ct):Ee.el=ue.el},we=(ue,Ee,Re,ct)=>{[ue.el,ue.anchor]=de(ue.children,Ee,Re,ct,ue.el,ue.anchor)},Le=({el:ue,anchor:Ee},Re,ct)=>{let ut;for(;ue&&ue!==Ee;)ut=q(ue),y(ue,Re,ct),ue=ut;y(Ee,Re,ct)},Ne=({el:ue,anchor:Ee})=>{let Re;for(;ue&&ue!==Ee;)Re=q(ue),b(ue),ue=Re;b(Ee)},Te=(ue,Ee,Re,ct,ut,bt,Mt,gt,Xe)=>{Mt=Mt||Ee.type==="svg",ue==null?Pe(Ee,Re,ct,ut,bt,Mt,gt,Xe):Ke(ue,Ee,ut,bt,Mt,gt,Xe)},Pe=(ue,Ee,Re,ct,ut,bt,Mt,gt)=>{let Xe,ht;const{type:qt,props:Nt,shapeFlag:Zt,transition:ti,dirs:mi}=ue;if(Xe=ue.el=A(ue.type,bt,Nt&&Nt.is,Nt),Zt&8?N(Xe,ue.children):Zt&16&&De(ue.children,Xe,null,ct,ut,bt&&qt!=="foreignObject",Mt,gt),mi&&el(ue,null,ct,"created"),Nt){for(const si in Nt)si!=="value"&&!zf(si)&&E(Xe,si,null,Nt[si],bt,ue.children,ct,ut,Kt);"value"in Nt&&E(Xe,"value",null,Nt.value),(ht=Nt.onVnodeBeforeMount)&&Yr(ht,ct,ue)}xe(Xe,ue,ue.scopeId,Mt,ct),mi&&el(ue,null,ct,"beforeMount");const zi=(!ut||ut&&!ut.pendingBranch)&&ti&&!ti.persisted;zi&&ti.beforeEnter(Xe),y(Xe,Ee,Re),((ht=Nt&&Nt.onVnodeMounted)||zi||mi)&&ir(()=>{ht&&Yr(ht,ct,ue),zi&&ti.enter(Xe),mi&&el(ue,null,ct,"mounted")},ut)},xe=(ue,Ee,Re,ct,ut)=>{if(Re&&H(ue,Re),ct)for(let bt=0;bt<ct.length;bt++)H(ue,ct[bt]);if(ut){let bt=ut.subTree;if(Ee===bt){const Mt=ut.vnode;xe(ue,Mt,Mt.scopeId,Mt.slotScopeIds,ut.parent)}}},De=(ue,Ee,Re,ct,ut,bt,Mt,gt,Xe=0)=>{for(let ht=Xe;ht<ue.length;ht++){const qt=ue[ht]=gt?ia(ue[ht]):qo(ue[ht]);ye(null,qt,Ee,Re,ct,ut,bt,Mt,gt)}},Ke=(ue,Ee,Re,ct,ut,bt,Mt)=>{const gt=Ee.el=ue.el;let{patchFlag:Xe,dynamicChildren:ht,dirs:qt}=Ee;Xe|=ue.patchFlag&16;const Nt=ue.props||un,Zt=Ee.props||un;let ti;Re&&tl(Re,!1),(ti=Zt.onVnodeBeforeUpdate)&&Yr(ti,Re,Ee,ue),qt&&el(Ee,ue,Re,"beforeUpdate"),Re&&tl(Re,!0);const mi=ut&&Ee.type!=="foreignObject";if(ht?Ue(ue.dynamicChildren,ht,gt,Re,ct,mi,bt):Mt||At(ue,Ee,gt,null,Re,ct,mi,bt,!1),Xe>0){if(Xe&16)nt(gt,Ee,Nt,Zt,Re,ct,ut);else if(Xe&2&&Nt.class!==Zt.class&&E(gt,"class",null,Zt.class,ut),Xe&4&&E(gt,"style",Nt.style,Zt.style,ut),Xe&8){const zi=Ee.dynamicProps;for(let si=0;si<zi.length;si++){const Ai=zi[si],hn=Nt[Ai],_r=Zt[Ai];(_r!==hn||Ai==="value")&&E(gt,Ai,hn,_r,ut,ue.children,Re,ct,Kt)}}Xe&1&&ue.children!==Ee.children&&N(gt,Ee.children)}else!Mt&&ht==null&&nt(gt,Ee,Nt,Zt,Re,ct,ut);((ti=Zt.onVnodeUpdated)||qt)&&ir(()=>{ti&&Yr(ti,Re,Ee,ue),qt&&el(Ee,ue,Re,"updated")},ct)},Ue=(ue,Ee,Re,ct,ut,bt,Mt)=>{for(let gt=0;gt<Ee.length;gt++){const Xe=ue[gt],ht=Ee[gt],qt=Xe.el&&(Xe.type===wr||!sl(Xe,ht)||Xe.shapeFlag&70)?F(Xe.el):Re;ye(Xe,ht,qt,null,ct,ut,bt,Mt,!0)}},nt=(ue,Ee,Re,ct,ut,bt,Mt)=>{if(Re!==ct){if(Re!==un)for(const gt in Re)!zf(gt)&&!(gt in ct)&&E(ue,gt,Re[gt],null,Mt,Ee.children,ut,bt,Kt);for(const gt in ct){if(zf(gt))continue;const Xe=ct[gt],ht=Re[gt];Xe!==ht&&gt!=="value"&&E(ue,gt,ht,Xe,Mt,Ee.children,ut,bt,Kt)}"value"in ct&&E(ue,"value",Re.value,ct.value)}},$e=(ue,Ee,Re,ct,ut,bt,Mt,gt,Xe)=>{const ht=Ee.el=ue?ue.el:s(""),qt=Ee.anchor=ue?ue.anchor:s("");let{patchFlag:Nt,dynamicChildren:Zt,slotScopeIds:ti}=Ee;ti&&(gt=gt?gt.concat(ti):ti),ue==null?(y(ht,Re,ct),y(qt,Re,ct),De(Ee.children,Re,qt,ut,bt,Mt,gt,Xe)):Nt>0&&Nt&64&&Zt&&ue.dynamicChildren?(Ue(ue.dynamicChildren,Zt,Re,ut,bt,Mt,gt),(Ee.key!=null||ut&&Ee===ut.subTree)&&sg(ue,Ee,!0)):At(ue,Ee,Re,qt,ut,bt,Mt,gt,Xe)},Ge=(ue,Ee,Re,ct,ut,bt,Mt,gt,Xe)=>{Ee.slotScopeIds=gt,ue==null?Ee.shapeFlag&512?ut.ctx.activate(Ee,Re,ct,Mt,Xe):Ye(Ee,Re,ct,ut,bt,Mt,Xe):Ot(ue,Ee,Xe)},Ye=(ue,Ee,Re,ct,ut,bt,Mt)=>{const gt=ue.component=lS(ue,ct,ut);if(ap(ue)&&(gt.ctx.renderer=Et),cS(gt),gt.asyncDep){if(ut&&ut.registerDep(gt,Ht),!ue.el){const Xe=gt.subTree=Ft(wo);He(null,Xe,Ee,Re)}return}Ht(gt,ue,Ee,Re,ut,bt,Mt)},Ot=(ue,Ee,Re)=>{const ct=Ee.component=ue.component;if(bE(ue,Ee,Re))if(ct.asyncDep&&!ct.asyncResolved){ot(ct,Ee,Re);return}else ct.next=Ee,mE(ct.update),ct.update();else Ee.el=ue.el,ct.vnode=Ee},Ht=(ue,Ee,Re,ct,ut,bt,Mt)=>{const gt=()=>{if(ue.isMounted){let{next:qt,bu:Nt,u:Zt,parent:ti,vnode:mi}=ue,zi=qt,si;tl(ue,!1),qt?(qt.el=mi.el,ot(ue,qt,Mt)):qt=mi,Nt&&wh(Nt),(si=qt.props&&qt.props.onVnodeBeforeUpdate)&&Yr(si,ti,qt,mi),tl(ue,!0);const Ai=Xm(ue),hn=ue.subTree;ue.subTree=Ai,ye(hn,Ai,F(hn.el),Yt(hn),ue,ut,bt),qt.el=Ai.el,zi===null&&wE(ue,Ai.el),Zt&&ir(Zt,ut),(si=qt.props&&qt.props.onVnodeUpdated)&&ir(()=>Yr(si,ti,qt,mi),ut)}else{let qt;const{el:Nt,props:Zt}=Ee,{bm:ti,m:mi,parent:zi}=ue,si=Th(Ee);if(tl(ue,!1),ti&&wh(ti),!si&&(qt=Zt&&Zt.onVnodeBeforeMount)&&Yr(qt,zi,Ee),tl(ue,!0),Nt&&Tn){const Ai=()=>{ue.subTree=Xm(ue),Tn(Nt,ue.subTree,ue,ut,null)};si?Ee.type.__asyncLoader().then(()=>!ue.isUnmounted&&Ai()):Ai()}else{const Ai=ue.subTree=Xm(ue);ye(null,Ai,Re,ct,ue,ut,bt),Ee.el=Ai.el}if(mi&&ir(mi,ut),!si&&(qt=Zt&&Zt.onVnodeMounted)){const Ai=Ee;ir(()=>Yr(qt,zi,Ai),ut)}(Ee.shapeFlag&256||zi&&Th(zi.vnode)&&zi.vnode.shapeFlag&256)&&ue.a&&ir(ue.a,ut),ue.isMounted=!0,Ee=Re=ct=null}},Xe=ue.effect=new G_(gt,()=>Q_(ht),ue.scope),ht=ue.update=()=>Xe.run();ht.id=ue.uid,tl(ue,!0),ht()},ot=(ue,Ee,Re)=>{Ee.component=ue;const ct=ue.vnode.props;ue.vnode=Ee,ue.next=null,qE(ue,Ee.props,ct,Re),ZE(ue,Ee.children,Re),Pc(),ux(),Dc()},At=(ue,Ee,Re,ct,ut,bt,Mt,gt,Xe=!1)=>{const ht=ue&&ue.children,qt=ue?ue.shapeFlag:0,Nt=Ee.children,{patchFlag:Zt,shapeFlag:ti}=Ee;if(Zt>0){if(Zt&128){Oe(ht,Nt,Re,ct,ut,bt,Mt,gt,Xe);return}else if(Zt&256){di(ht,Nt,Re,ct,ut,bt,Mt,gt,Xe);return}}ti&8?(qt&16&&Kt(ht,ut,bt),Nt!==ht&&N(Re,Nt)):qt&16?ti&16?Oe(ht,Nt,Re,ct,ut,bt,Mt,gt,Xe):Kt(ht,ut,bt,!0):(qt&8&&N(Re,""),ti&16&&De(Nt,Re,ct,ut,bt,Mt,gt,Xe))},di=(ue,Ee,Re,ct,ut,bt,Mt,gt,Xe)=>{ue=ue||bc,Ee=Ee||bc;const ht=ue.length,qt=Ee.length,Nt=Math.min(ht,qt);let Zt;for(Zt=0;Zt<Nt;Zt++){const ti=Ee[Zt]=Xe?ia(Ee[Zt]):qo(Ee[Zt]);ye(ue[Zt],ti,Re,null,ut,bt,Mt,gt,Xe)}ht>qt?Kt(ue,ut,bt,!0,!1,Nt):De(Ee,Re,ct,ut,bt,Mt,gt,Xe,Nt)},Oe=(ue,Ee,Re,ct,ut,bt,Mt,gt,Xe)=>{let ht=0;const qt=Ee.length;let Nt=ue.length-1,Zt=qt-1;for(;ht<=Nt&&ht<=Zt;){const ti=ue[ht],mi=Ee[ht]=Xe?ia(Ee[ht]):qo(Ee[ht]);if(sl(ti,mi))ye(ti,mi,Re,null,ut,bt,Mt,gt,Xe);else break;ht++}for(;ht<=Nt&&ht<=Zt;){const ti=ue[Nt],mi=Ee[Zt]=Xe?ia(Ee[Zt]):qo(Ee[Zt]);if(sl(ti,mi))ye(ti,mi,Re,null,ut,bt,Mt,gt,Xe);else break;Nt--,Zt--}if(ht>Nt){if(ht<=Zt){const ti=Zt+1,mi=ti<qt?Ee[ti].el:ct;for(;ht<=Zt;)ye(null,Ee[ht]=Xe?ia(Ee[ht]):qo(Ee[ht]),Re,mi,ut,bt,Mt,gt,Xe),ht++}}else if(ht>Zt)for(;ht<=Nt;)xt(ue[ht],ut,bt,!0),ht++;else{const ti=ht,mi=ht,zi=new Map;for(ht=mi;ht<=Zt;ht++){const gn=Ee[ht]=Xe?ia(Ee[ht]):qo(Ee[ht]);gn.key!=null&&zi.set(gn.key,ht)}let si,Ai=0;const hn=Zt-mi+1;let _r=!1,Cn=0;const kn=new Array(hn);for(ht=0;ht<hn;ht++)kn[ht]=0;for(ht=ti;ht<=Nt;ht++){const gn=ue[ht];if(Ai>=hn){xt(gn,ut,bt,!0);continue}let zn;if(gn.key!=null)zn=zi.get(gn.key);else for(si=mi;si<=Zt;si++)if(kn[si-mi]===0&&sl(gn,Ee[si])){zn=si;break}zn===void 0?xt(gn,ut,bt,!0):(kn[zn-mi]=ht+1,zn>=Cn?Cn=zn:_r=!0,ye(gn,Ee[zn],Re,null,ut,bt,Mt,gt,Xe),Ai++)}const qr=_r?YE(kn):bc;for(si=qr.length-1,ht=hn-1;ht>=0;ht--){const gn=mi+ht,zn=Ee[gn],Pr=gn+1<qt?Ee[gn+1].el:ct;kn[ht]===0?ye(null,zn,Re,Pr,ut,bt,Mt,gt,Xe):_r&&(si<0||ht!==qr[si]?_t(zn,Re,Pr,2):si--)}}},_t=(ue,Ee,Re,ct,ut=null)=>{const{el:bt,type:Mt,transition:gt,children:Xe,shapeFlag:ht}=ue;if(ht&6){_t(ue.component.subTree,Ee,Re,ct);return}if(ht&128){ue.suspense.move(Ee,Re,ct);return}if(ht&64){Mt.move(ue,Ee,Re,Et);return}if(Mt===wr){y(bt,Ee,Re);for(let Nt=0;Nt<Xe.length;Nt++)_t(Xe[Nt],Ee,Re,ct);y(ue.anchor,Ee,Re);return}if(Mt===Pf){Le(ue,Ee,Re);return}if(ct!==2&&ht&1&&gt)if(ct===0)gt.beforeEnter(bt),y(bt,Ee,Re),ir(()=>gt.enter(bt),ut);else{const{leave:Nt,delayLeave:Zt,afterLeave:ti}=gt,mi=()=>y(bt,Ee,Re),zi=()=>{Nt(bt,()=>{mi(),ti&&ti()})};Zt?Zt(bt,mi,zi):zi()}else y(bt,Ee,Re)},xt=(ue,Ee,Re,ct=!1,ut=!1)=>{const{type:bt,props:Mt,ref:gt,children:Xe,dynamicChildren:ht,shapeFlag:qt,patchFlag:Nt,dirs:Zt}=ue;if(gt!=null&&E_(gt,null,Re,ue,!0),qt&256){Ee.ctx.deactivate(ue);return}const ti=qt&1&&Zt,mi=!Th(ue);let zi;if(mi&&(zi=Mt&&Mt.onVnodeBeforeUnmount)&&Yr(zi,Ee,ue),qt&6)Ci(ue.component,Re,ct);else{if(qt&128){ue.suspense.unmount(Re,ct);return}ti&&el(ue,null,Ee,"beforeUnmount"),qt&64?ue.type.remove(ue,Ee,Re,ut,Et,ct):ht&&(bt!==wr||Nt>0&&Nt&64)?Kt(ht,Ee,Re,!1,!0):(bt===wr&&Nt&384||!ut&&qt&16)&&Kt(Xe,Ee,Re),ct&&Lt(ue)}(mi&&(zi=Mt&&Mt.onVnodeUnmounted)||ti)&&ir(()=>{zi&&Yr(zi,Ee,ue),ti&&el(ue,null,Ee,"unmounted")},Re)},Lt=ue=>{const{type:Ee,el:Re,anchor:ct,transition:ut}=ue;if(Ee===wr){pi(Re,ct);return}if(Ee===Pf){Ne(ue);return}const bt=()=>{b(Re),ut&&!ut.persisted&&ut.afterLeave&&ut.afterLeave()};if(ue.shapeFlag&1&&ut&&!ut.persisted){const{leave:Mt,delayLeave:gt}=ut,Xe=()=>Mt(Re,bt);gt?gt(ue.el,bt,Xe):Xe()}else bt()},pi=(ue,Ee)=>{let Re;for(;ue!==Ee;)Re=q(ue),b(ue),ue=Re;b(Ee)},Ci=(ue,Ee,Re)=>{const{bum:ct,scope:ut,update:bt,subTree:Mt,um:gt}=ue;ct&&wh(ct),ut.stop(),bt&&(bt.active=!1,xt(Mt,ue,Ee,Re)),gt&&ir(gt,Ee),ir(()=>{ue.isUnmounted=!0},Ee),Ee&&Ee.pendingBranch&&!Ee.isUnmounted&&ue.asyncDep&&!ue.asyncResolved&&ue.suspenseId===Ee.pendingId&&(Ee.deps--,Ee.deps===0&&Ee.resolve())},Kt=(ue,Ee,Re,ct=!1,ut=!1,bt=0)=>{for(let Mt=bt;Mt<ue.length;Mt++)xt(ue[Mt],Ee,Re,ct,ut)},Yt=ue=>ue.shapeFlag&6?Yt(ue.component.subTree):ue.shapeFlag&128?ue.suspense.next():q(ue.anchor||ue.el),Jt=(ue,Ee,Re)=>{ue==null?Ee._vnode&&xt(Ee._vnode,null,null,!0):ye(Ee._vnode||null,ue,Ee,null,null,null,Re),ux(),p1(),Ee._vnode=ue},Et={p:ye,um:xt,m:_t,r:Lt,mt:Ye,mc:De,pc:At,pbc:Ue,n:Yt,o:r};let Bi,Tn;return h&&([Bi,Tn]=h(Et)),{render:Jt,hydrate:Bi,createApp:HE(Jt,Bi)}}function tl({effect:r,update:h},p){r.allowRecurse=h.allowRecurse=p}function sg(r,h,p=!1){const y=r.children,b=h.children;if(vi(y)&&vi(b))for(let E=0;E<y.length;E++){const A=y[E];let s=b[E];s.shapeFlag&1&&!s.dynamicChildren&&((s.patchFlag<=0||s.patchFlag===32)&&(s=b[E]=ia(b[E]),s.el=A.el),p||sg(A,s))}}function YE(r){const h=r.slice(),p=[0];let y,b,E,A,s;const D=r.length;for(y=0;y<D;y++){const V=r[y];if(V!==0){if(b=p[p.length-1],r[b]<V){h[y]=b,p.push(y);continue}for(E=0,A=p.length-1;E<A;)s=E+A>>1,r[p[s]]<V?E=s+1:A=s;V<r[p[E]]&&(E>0&&(h[y]=p[E-1]),p[E]=y)}}for(E=p.length,A=p[E-1];E-- >0;)p[E]=A,A=h[A];return p}const JE=r=>r.__isTeleport,Eh=r=>r&&(r.disabled||r.disabled===""),xx=r=>typeof SVGElement<"u"&&r instanceof SVGElement,S_=(r,h)=>{const p=r&&r.to;return qn(p)?h?h(p):null:p},QE={__isTeleport:!0,process(r,h,p,y,b,E,A,s,D,V){const{mc:N,pc:F,pbc:q,o:{insert:H,querySelector:de,createText:ye,createComment:ze}}=V,He=Eh(h.props);let{shapeFlag:we,children:Le,dynamicChildren:Ne}=h;if(r==null){const Te=h.el=ye(""),Pe=h.anchor=ye("");H(Te,p,y),H(Pe,p,y);const xe=h.target=S_(h.props,de),De=h.targetAnchor=ye("");xe&&(H(De,xe),A=A||xx(xe));const Ke=(Ue,nt)=>{we&16&&N(Le,Ue,nt,b,E,A,s,D)};He?Ke(p,Pe):xe&&Ke(xe,De)}else{h.el=r.el;const Te=h.anchor=r.anchor,Pe=h.target=r.target,xe=h.targetAnchor=r.targetAnchor,De=Eh(r.props),Ke=De?p:Pe,Ue=De?Te:xe;if(A=A||xx(Pe),Ne?(q(r.dynamicChildren,Ne,Ke,b,E,A,s),sg(r,h,!0)):D||F(r,h,Ke,Ue,b,E,A,s,!1),He)De||wf(h,p,Te,V,1);else if((h.props&&h.props.to)!==(r.props&&r.props.to)){const nt=h.target=S_(h.props,de);nt&&wf(h,nt,null,V,0)}else De&&wf(h,Pe,xe,V,1)}},remove(r,h,p,y,{um:b,o:{remove:E}},A){const{shapeFlag:s,children:D,anchor:V,targetAnchor:N,target:F,props:q}=r;if(F&&E(N),(A||!Eh(q))&&(E(V),s&16))for(let H=0;H<D.length;H++){const de=D[H];b(de,h,p,!0,!!de.dynamicChildren)}},move:wf,hydrate:eS};function wf(r,h,p,{o:{insert:y},m:b},E=2){E===0&&y(r.targetAnchor,h,p);const{el:A,anchor:s,shapeFlag:D,children:V,props:N}=r,F=E===2;if(F&&y(A,h,p),(!F||Eh(N))&&D&16)for(let q=0;q<V.length;q++)b(V[q],h,p,2);F&&y(s,h,p)}function eS(r,h,p,y,b,E,{o:{nextSibling:A,parentNode:s,querySelector:D}},V){const N=h.target=S_(h.props,D);if(N){const F=N._lpa||N.firstChild;if(h.shapeFlag&16)if(Eh(h.props))h.anchor=V(A(r),h,s(r),p,y,b,E),h.targetAnchor=F;else{h.anchor=A(r);let q=F;for(;q;)if(q=A(q),q&&q.nodeType===8&&q.data==="teleport anchor"){h.targetAnchor=q,N._lpa=h.targetAnchor&&A(h.targetAnchor);break}V(F,h,N,p,y,b,E)}}return h.anchor&&A(h.anchor)}const tS=QE,wr=Symbol(void 0),ag=Symbol(void 0),wo=Symbol(void 0),Pf=Symbol(void 0),Sh=[];let vo=null;function nr(r=!1){Sh.push(vo=r?null:[])}function iS(){Sh.pop(),vo=Sh[Sh.length-1]||null}let zh=1;function bx(r){zh+=r}function P1(r){return r.dynamicChildren=zh>0?vo||bc:null,iS(),zh>0&&vo&&vo.push(r),r}function ca(r,h,p,y,b,E){return P1(Ei(r,h,p,y,b,E,!0))}function ps(r,h,p,y,b){return P1(Ft(r,h,p,y,b,!0))}function qf(r){return r?r.__v_isVNode===!0:!1}function sl(r,h){return r.type===h.type&&r.key===h.key}const hp="__vInternal",D1=({key:r})=>r!=null?r:null,Df=({ref:r,ref_key:h,ref_for:p})=>r!=null?qn(r)||mr(r)||Si(r)?{i:yo,r,k:h,f:!!p}:r:null;function Ei(r,h=null,p=null,y=0,b=null,E=r===wr?0:1,A=!1,s=!1){const D={__v_isVNode:!0,__v_skip:!0,type:r,props:h,key:h&&D1(h),ref:h&&Df(h),scopeId:g1,slotScopeIds:null,children:p,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:E,patchFlag:y,dynamicProps:b,dynamicChildren:null,appContext:null};return s?(lg(D,p),E&128&&r.normalize(D)):p&&(D.shapeFlag|=qn(p)?8:16),zh>0&&!A&&vo&&(D.patchFlag>0||E&6)&&D.patchFlag!==32&&vo.push(D),D}const Ft=nS;function nS(r,h=null,p=null,y=0,b=null,E=!1){if((!r||r===BE)&&(r=wo),qf(r)){const s=ys(r,h,!0);return p&&lg(s,p),zh>0&&!E&&vo&&(s.shapeFlag&6?vo[vo.indexOf(r)]=s:vo.push(s)),s.patchFlag|=-2,s}if(fS(r)&&(r=r.__vccOpts),h){h=rS(h);let{class:s,style:D}=h;s&&!qn(s)&&(h.class=V_(s)),wn(D)&&(a1(D)&&!vi(D)&&(D=or({},D)),h.style=O_(D))}const A=qn(r)?1:y1(r)?128:JE(r)?64:wn(r)?4:Si(r)?2:0;return Ei(r,h,p,y,b,A,E,!0)}function rS(r){return r?a1(r)||hp in r?or({},r):r:null}function ys(r,h,p=!1){const{props:y,ref:b,patchFlag:E,children:A}=r,s=h?oS(y||{},h):y;return{__v_isVNode:!0,__v_skip:!0,type:r.type,props:s,key:s&&D1(s),ref:h&&h.ref?p&&b?vi(b)?b.concat(Df(h)):[b,Df(h)]:Df(h):b,scopeId:r.scopeId,slotScopeIds:r.slotScopeIds,children:A,target:r.target,targetAnchor:r.targetAnchor,staticCount:r.staticCount,shapeFlag:r.shapeFlag,patchFlag:h&&r.type!==wr?E===-1?16:E|16:E,dynamicProps:r.dynamicProps,dynamicChildren:r.dynamicChildren,appContext:r.appContext,dirs:r.dirs,transition:r.transition,component:r.component,suspense:r.suspense,ssContent:r.ssContent&&ys(r.ssContent),ssFallback:r.ssFallback&&ys(r.ssFallback),el:r.el,anchor:r.anchor}}function ms(r=" ",h=0){return Ft(ag,null,r,h)}function L1(r,h){const p=Ft(Pf,null,r);return p.staticCount=h,p}function pc(r="",h=!1){return h?(nr(),ps(wo,null,r)):Ft(wo,null,r)}function qo(r){return r==null||typeof r=="boolean"?Ft(wo):vi(r)?Ft(wr,null,r.slice()):typeof r=="object"?ia(r):Ft(ag,null,String(r))}function ia(r){return r.el===null&&r.patchFlag!==-1||r.memo?r:ys(r)}function lg(r,h){let p=0;const{shapeFlag:y}=r;if(h==null)h=null;else if(vi(h))p=16;else if(typeof h=="object")if(y&65){const b=h.default;b&&(b._c&&(b._d=!1),lg(r,b()),b._c&&(b._d=!0));return}else{p=32;const b=h._;!b&&!(hp in h)?h._ctx=yo:b===3&&yo&&(yo.slots._===1?h._=1:(h._=2,r.patchFlag|=1024))}else Si(h)?(h={default:h,_ctx:yo},p=32):(h=String(h),y&64?(p=16,h=[ms(h)]):p=8);r.children=h,r.shapeFlag|=p}function oS(...r){const h={};for(let p=0;p<r.length;p++){const y=r[p];for(const b in y)if(b==="class")h.class!==y.class&&(h.class=V_([h.class,y.class]));else if(b==="style")h.style=O_([h.style,y.style]);else if(ep(b)){const E=h[b],A=y[b];A&&E!==A&&!(vi(E)&&E.includes(A))&&(h[b]=E?[].concat(E,A):A)}else b!==""&&(h[b]=y[b])}return h}function Yr(r,h,p,y=null){Qr(r,h,7,[p,y])}const sS=z1();let aS=0;function lS(r,h,p){const y=r.type,b=(h?h.appContext:r.appContext)||sS,E={uid:aS++,vnode:r,type:y,parent:h,appContext:b,root:null,next:null,subTree:null,effect:null,update:null,scope:new L2(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:h?h.provides:Object.create(b.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:A1(y,b),emitsOptions:_1(y,b),emit:null,emitted:null,propsDefaults:un,inheritAttrs:y.inheritAttrs,ctx:un,data:un,props:un,attrs:un,slots:un,refs:un,setupState:un,setupContext:null,suspense:p,suspenseId:p?p.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return E.ctx={_:E},E.root=h?h.root:E,E.emit=yE.bind(null,E),r.ce&&r.ce(E),E}let rr=null;const Oi=()=>rr||yo,Ic=r=>{rr=r,r.scope.on()},dl=()=>{rr&&rr.scope.off(),rr=null};function B1(r){return r.vnode.shapeFlag&4}let Ph=!1;function cS(r,h=!1){Ph=h;const{props:p,children:y}=r.vnode,b=B1(r);jE(r,p,b,h),GE(r,y);const E=b?uS(r,h):void 0;return Ph=!1,E}function uS(r,h){const p=r.type;r.accessCache=Object.create(null),r.proxy=rp(new Proxy(r.ctx,RE));const{setup:y}=p;if(y){const b=r.setupContext=y.length>1?dS(r):null;Ic(r),Pc();const E=sa(y,r,0,[r.props,b]);if(Dc(),dl(),G0(E)){if(E.then(dl,dl),h)return E.then(A=>{wx(r,A,h)}).catch(A=>{op(A,r,0)});r.asyncDep=E}else wx(r,E,h)}else R1(r,h)}function wx(r,h,p){Si(h)?r.type.__ssrInlineRender?r.ssrRender=h:r.render=h:wn(h)&&(r.setupState=u1(h)),R1(r,p)}let Tx;function R1(r,h,p){const y=r.type;if(!r.render){if(!h&&Tx&&!y.render){const b=y.template||rg(r).template;if(b){const{isCustomElement:E,compilerOptions:A}=r.appContext.config,{delimiters:s,compilerOptions:D}=y,V=or(or({isCustomElement:E,delimiters:s},A),D);y.render=Tx(b,V)}}r.render=y.render||xo}Ic(r),Pc(),FE(r),Dc(),dl()}function hS(r){return new Proxy(r.attrs,{get(h,p){return jr(r,"get","$attrs"),h[p]}})}function dS(r){const h=y=>{r.exposed=y||{}};let p;return{get attrs(){return p||(p=hS(r))},slots:r.slots,emit:r.emit,expose:h}}function dp(r){if(r.exposed)return r.exposeProxy||(r.exposeProxy=new Proxy(u1(rp(r.exposed)),{get(h,p){if(p in h)return h[p];if(p in Nf)return Nf[p](r)}}))}function Ex(r,h=!0){return Si(r)?r.displayName||r.name:r.name||h&&r.__name}function fS(r){return Si(r)&&"__vccOpts"in r}const be=(r,h)=>dE(r,h,Ph);function Ie(r,h,p){const y=arguments.length;return y===2?wn(h)&&!vi(h)?qf(h)?Ft(r,null,[h]):Ft(r,h):Ft(r,null,h):(y>3?p=Array.prototype.slice.call(arguments,2):y===3&&qf(p)&&(p=[p]),Ft(r,h,p))}const pS="3.2.40",mS="http://www.w3.org/2000/svg",al=typeof document<"u"?document:null,Sx=al&&al.createElement("template"),_S={insert:(r,h,p)=>{h.insertBefore(r,p||null)},remove:r=>{const h=r.parentNode;h&&h.removeChild(r)},createElement:(r,h,p,y)=>{const b=h?al.createElementNS(mS,r):al.createElement(r,p?{is:p}:void 0);return r==="select"&&y&&y.multiple!=null&&b.setAttribute("multiple",y.multiple),b},createText:r=>al.createTextNode(r),createComment:r=>al.createComment(r),setText:(r,h)=>{r.nodeValue=h},setElementText:(r,h)=>{r.textContent=h},parentNode:r=>r.parentNode,nextSibling:r=>r.nextSibling,querySelector:r=>al.querySelector(r),setScopeId(r,h){r.setAttribute(h,"")},insertStaticContent(r,h,p,y,b,E){const A=p?p.previousSibling:h.lastChild;if(b&&(b===E||b.nextSibling))for(;h.insertBefore(b.cloneNode(!0),p),!(b===E||!(b=b.nextSibling)););else{Sx.innerHTML=y?`<svg>${r}</svg>`:r;const s=Sx.content;if(y){const D=s.firstChild;for(;D.firstChild;)s.appendChild(D.firstChild);s.removeChild(D)}h.insertBefore(s,p)}return[A?A.nextSibling:h.firstChild,p?p.previousSibling:h.lastChild]}};function gS(r,h,p){const y=r._vtc;y&&(h=(h?[h,...y]:[...y]).join(" ")),h==null?r.removeAttribute("class"):p?r.setAttribute("class",h):r.className=h}function yS(r,h,p){const y=r.style,b=qn(p);if(p&&!b){for(const E in p)C_(y,E,p[E]);if(h&&!qn(h))for(const E in h)p[E]==null&&C_(y,E,"")}else{const E=y.display;b?h!==p&&(y.cssText=p):h&&r.removeAttribute("style"),"_vod"in r&&(y.display=E)}}const Cx=/\s*!important$/;function C_(r,h,p){if(vi(p))p.forEach(y=>C_(r,h,y));else if(p==null&&(p=""),h.startsWith("--"))r.setProperty(h,p);else{const y=vS(r,h);Cx.test(p)?r.setProperty(zc(y),p.replace(Cx,""),"important"):r[y]=p}}const Ax=["Webkit","Moz","ms"],Qm={};function vS(r,h){const p=Qm[h];if(p)return p;let y=Ac(h);if(y!=="filter"&&y in r)return Qm[h]=y;y=H0(y);for(let b=0;b<Ax.length;b++){const E=Ax[b]+y;if(E in r)return Qm[h]=E}return h}const Mx="http://www.w3.org/1999/xlink";function xS(r,h,p,y,b){if(y&&h.startsWith("xlink:"))p==null?r.removeAttributeNS(Mx,h.slice(6,h.length)):r.setAttributeNS(Mx,h,p);else{const E=T2(h);p==null||E&&!j0(p)?r.removeAttribute(h):r.setAttribute(h,E?"":p)}}function bS(r,h,p,y,b,E,A){if(h==="innerHTML"||h==="textContent"){y&&A(y,b,E),r[h]=p==null?"":p;return}if(h==="value"&&r.tagName!=="PROGRESS"&&!r.tagName.includes("-")){r._value=p;const D=p==null?"":p;(r.value!==D||r.tagName==="OPTION")&&(r.value=D),p==null&&r.removeAttribute(h);return}let s=!1;if(p===""||p==null){const D=typeof r[h];D==="boolean"?p=j0(p):p==null&&D==="string"?(p="",s=!0):D==="number"&&(p=0,s=!0)}try{r[h]=p}catch{}s&&r.removeAttribute(h)}const[F1,wS]=(()=>{let r=Date.now,h=!1;if(typeof window<"u"){Date.now()>document.createEvent("Event").timeStamp&&(r=performance.now.bind(performance));const p=navigator.userAgent.match(/firefox\/(\d+)/i);h=!!(p&&Number(p[1])<=53)}return[r,h]})();let A_=0;const TS=Promise.resolve(),ES=()=>{A_=0},SS=()=>A_||(TS.then(ES),A_=F1());function CS(r,h,p,y){r.addEventListener(h,p,y)}function AS(r,h,p,y){r.removeEventListener(h,p,y)}function MS(r,h,p,y,b=null){const E=r._vei||(r._vei={}),A=E[h];if(y&&A)A.value=y;else{const[s,D]=IS(h);if(y){const V=E[h]=kS(y,b);CS(r,s,V,D)}else A&&(AS(r,s,A,D),E[h]=void 0)}}const Ix=/(?:Once|Passive|Capture)$/;function IS(r){let h;if(Ix.test(r)){h={};let y;for(;y=r.match(Ix);)r=r.slice(0,r.length-y[0].length),h[y[0].toLowerCase()]=!0}return[r[2]===":"?r.slice(3):zc(r.slice(2)),h]}function kS(r,h){const p=y=>{const b=y.timeStamp||F1();(wS||b>=p.attached-1)&&Qr(zS(y,p.value),h,5,[y])};return p.value=r,p.attached=SS(),p}function zS(r,h){if(vi(h)){const p=r.stopImmediatePropagation;return r.stopImmediatePropagation=()=>{p.call(r),r._stopped=!0},h.map(y=>b=>!b._stopped&&y&&y(b))}else return h}const kx=/^on[a-z]/,PS=(r,h,p,y,b=!1,E,A,s,D)=>{h==="class"?gS(r,y,b):h==="style"?yS(r,p,y):ep(h)?U_(h)||MS(r,h,p,y,A):(h[0]==="."?(h=h.slice(1),!0):h[0]==="^"?(h=h.slice(1),!1):DS(r,h,y,b))?bS(r,h,y,E,A,s,D):(h==="true-value"?r._trueValue=y:h==="false-value"&&(r._falseValue=y),xS(r,h,y,b))};function DS(r,h,p,y){return y?!!(h==="innerHTML"||h==="textContent"||h in r&&kx.test(h)&&Si(p)):h==="spellcheck"||h==="draggable"||h==="translate"||h==="form"||h==="list"&&r.tagName==="INPUT"||h==="type"&&r.tagName==="TEXTAREA"||kx.test(h)&&qn(p)?!1:h in r}const Js="transition",dh="animation",vs=(r,{slots:h})=>Ie(b1,LS(r),h);vs.displayName="Transition";const O1={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};vs.props=or({},b1.props,O1);const il=(r,h=[])=>{vi(r)?r.forEach(p=>p(...h)):r&&r(...h)},zx=r=>r?vi(r)?r.some(h=>h.length>1):r.length>1:!1;function LS(r){const h={};for(const $e in r)$e in O1||(h[$e]=r[$e]);if(r.css===!1)return h;const{name:p="v",type:y,duration:b,enterFromClass:E=`${p}-enter-from`,enterActiveClass:A=`${p}-enter-active`,enterToClass:s=`${p}-enter-to`,appearFromClass:D=E,appearActiveClass:V=A,appearToClass:N=s,leaveFromClass:F=`${p}-leave-from`,leaveActiveClass:q=`${p}-leave-active`,leaveToClass:H=`${p}-leave-to`}=r,de=BS(b),ye=de&&de[0],ze=de&&de[1],{onBeforeEnter:He,onEnter:we,onEnterCancelled:Le,onLeave:Ne,onLeaveCancelled:Te,onBeforeAppear:Pe=He,onAppear:xe=we,onAppearCancelled:De=Le}=h,Ke=($e,Ge,Ye)=>{nl($e,Ge?N:s),nl($e,Ge?V:A),Ye&&Ye()},Ue=($e,Ge)=>{$e._isLeaving=!1,nl($e,F),nl($e,H),nl($e,q),Ge&&Ge()},nt=$e=>(Ge,Ye)=>{const Ot=$e?xe:we,Ht=()=>Ke(Ge,$e,Ye);il(Ot,[Ge,Ht]),Px(()=>{nl(Ge,$e?D:E),Qs(Ge,$e?N:s),zx(Ot)||Dx(Ge,y,ye,Ht)})};return or(h,{onBeforeEnter($e){il(He,[$e]),Qs($e,E),Qs($e,A)},onBeforeAppear($e){il(Pe,[$e]),Qs($e,D),Qs($e,V)},onEnter:nt(!1),onAppear:nt(!0),onLeave($e,Ge){$e._isLeaving=!0;const Ye=()=>Ue($e,Ge);Qs($e,F),OS(),Qs($e,q),Px(()=>{!$e._isLeaving||(nl($e,F),Qs($e,H),zx(Ne)||Dx($e,y,ze,Ye))}),il(Ne,[$e,Ye])},onEnterCancelled($e){Ke($e,!1),il(Le,[$e])},onAppearCancelled($e){Ke($e,!0),il(De,[$e])},onLeaveCancelled($e){Ue($e),il(Te,[$e])}})}function BS(r){if(r==null)return null;if(wn(r))return[e_(r.enter),e_(r.leave)];{const h=e_(r);return[h,h]}}function e_(r){return X0(r)}function Qs(r,h){h.split(/\s+/).forEach(p=>p&&r.classList.add(p)),(r._vtc||(r._vtc=new Set)).add(h)}function nl(r,h){h.split(/\s+/).forEach(y=>y&&r.classList.remove(y));const{_vtc:p}=r;p&&(p.delete(h),p.size||(r._vtc=void 0))}function Px(r){requestAnimationFrame(()=>{requestAnimationFrame(r)})}let RS=0;function Dx(r,h,p,y){const b=r._endId=++RS,E=()=>{b===r._endId&&y()};if(p)return setTimeout(E,p);const{type:A,timeout:s,propCount:D}=FS(r,h);if(!A)return y();const V=A+"end";let N=0;const F=()=>{r.removeEventListener(V,q),E()},q=H=>{H.target===r&&++N>=D&&F()};setTimeout(()=>{N<D&&F()},s+1),r.addEventListener(V,q)}function FS(r,h){const p=window.getComputedStyle(r),y=de=>(p[de]||"").split(", "),b=y(Js+"Delay"),E=y(Js+"Duration"),A=Lx(b,E),s=y(dh+"Delay"),D=y(dh+"Duration"),V=Lx(s,D);let N=null,F=0,q=0;h===Js?A>0&&(N=Js,F=A,q=E.length):h===dh?V>0&&(N=dh,F=V,q=D.length):(F=Math.max(A,V),N=F>0?A>V?Js:dh:null,q=N?N===Js?E.length:D.length:0);const H=N===Js&&/\b(transform|all)(,|$)/.test(p[Js+"Property"]);return{type:N,timeout:F,propCount:q,hasTransform:H}}function Lx(r,h){for(;r.length<h.length;)r=r.concat(r);return Math.max(...h.map((p,y)=>Bx(p)+Bx(r[y])))}function Bx(r){return Number(r.slice(0,-1).replace(",","."))*1e3}function OS(){return document.body.offsetHeight}const VS=or({patchProp:PS},_S);let Rx;function US(){return Rx||(Rx=XE(VS))}const NS=(...r)=>{const h=US().createApp(...r),{mount:p}=h;return h.mount=y=>{const b=jS(y);if(!b)return;const E=h._component;!Si(E)&&!E.render&&!E.template&&(E.template=b.innerHTML),b.innerHTML="";const A=p(b,!1,b instanceof SVGElement);return b instanceof Element&&(b.removeAttribute("v-cloak"),b.setAttribute("data-v-app","")),A},h};function jS(r){return qn(r)?document.querySelector(r):r}function fp(r,h,p,y){return Object.defineProperty(r,h,{get:p,set:y,enumerable:!0}),r}const To=Rt(!1);let pp;function qS(r,h){const p=/(edg|edge|edga|edgios)\/([\w.]+)/.exec(r)||/(opr)[\/]([\w.]+)/.exec(r)||/(vivaldi)[\/]([\w.]+)/.exec(r)||/(chrome|crios)[\/]([\w.]+)/.exec(r)||/(version)(applewebkit)[\/]([\w.]+).*(safari)[\/]([\w.]+)/.exec(r)||/(webkit)[\/]([\w.]+).*(version)[\/]([\w.]+).*(safari)[\/]([\w.]+)/.exec(r)||/(firefox|fxios)[\/]([\w.]+)/.exec(r)||/(webkit)[\/]([\w.]+)/.exec(r)||/(opera)(?:.*version|)[\/]([\w.]+)/.exec(r)||[];return{browser:p[5]||p[3]||p[1]||"",version:p[2]||p[4]||"0",versionNumber:p[4]||p[2]||"0",platform:h[0]||""}}function $S(r){return/(ipad)/.exec(r)||/(ipod)/.exec(r)||/(windows phone)/.exec(r)||/(iphone)/.exec(r)||/(kindle)/.exec(r)||/(silk)/.exec(r)||/(android)/.exec(r)||/(win)/.exec(r)||/(mac)/.exec(r)||/(linux)/.exec(r)||/(cros)/.exec(r)||/(playbook)/.exec(r)||/(bb)/.exec(r)||/(blackberry)/.exec(r)||[]}const V1="ontouchstart"in window||window.navigator.maxTouchPoints>0;function GS(r){pp={is:{...r}},delete r.mac,delete r.desktop;const h=Math.min(window.innerHeight,window.innerWidth)>414?"ipad":"iphone";Object.assign(r,{mobile:!0,ios:!0,platform:h,[h]:!0})}function ZS(r){const h=r.toLowerCase(),p=$S(h),y=qS(h,p),b={};y.browser&&(b[y.browser]=!0,b.version=y.version,b.versionNumber=parseInt(y.versionNumber,10)),y.platform&&(b[y.platform]=!0);const E=b.android||b.ios||b.bb||b.blackberry||b.ipad||b.iphone||b.ipod||b.kindle||b.playbook||b.silk||b["windows phone"];return E===!0||h.indexOf("mobile")>-1?(b.mobile=!0,b.edga||b.edgios?(b.edge=!0,y.browser="edge"):b.crios?(b.chrome=!0,y.browser="chrome"):b.fxios&&(b.firefox=!0,y.browser="firefox")):b.desktop=!0,(b.ipod||b.ipad||b.iphone)&&(b.ios=!0),b["windows phone"]&&(b.winphone=!0,delete b["windows phone"]),(b.chrome||b.opr||b.safari||b.vivaldi||b.mobile===!0&&b.ios!==!0&&E!==!0)&&(b.webkit=!0),b.edg&&(y.browser="edgechromium",b.edgeChromium=!0),(b.safari&&b.blackberry||b.bb)&&(y.browser="blackberry",b.blackberry=!0),b.safari&&b.playbook&&(y.browser="playbook",b.playbook=!0),b.opr&&(y.browser="opera",b.opera=!0),b.safari&&b.android&&(y.browser="android",b.android=!0),b.safari&&b.kindle&&(y.browser="kindle",b.kindle=!0),b.safari&&b.silk&&(y.browser="silk",b.silk=!0),b.vivaldi&&(y.browser="vivaldi",b.vivaldi=!0),b.name=y.browser,b.platform=y.platform,h.indexOf("electron")>-1?b.electron=!0:document.location.href.indexOf("-extension://")>-1?b.bex=!0:(window.Capacitor!==void 0?(b.capacitor=!0,b.nativeMobile=!0,b.nativeMobileWrapper="capacitor"):(window._cordovaNative!==void 0||window.cordova!==void 0)&&(b.cordova=!0,b.nativeMobile=!0,b.nativeMobileWrapper="cordova"),V1===!0&&b.mac===!0&&(b.desktop===!0&&b.safari===!0||b.nativeMobile===!0&&b.android!==!0&&b.ios!==!0&&b.ipad!==!0)&&GS(b)),b}const Fx=navigator.userAgent||navigator.vendor||window.opera,WS={has:{touch:!1,webStorage:!1},within:{iframe:!1}},pn={userAgent:Fx,is:ZS(Fx),has:{touch:V1},within:{iframe:window.self!==window.top}},$f={install(r){const{$q:h}=r;To.value===!0?(r.onSSRHydrated.push(()=>{To.value=!1,Object.assign(h.platform,pn),pp=void 0}),h.platform=go(this)):h.platform=this}};{let r;fp(pn.has,"webStorage",()=>{if(r!==void 0)return r;try{if(window.localStorage)return r=!0,!0}catch{}return r=!1,!1}),pn.is.ios===!0&&window.navigator.vendor.toLowerCase().indexOf("apple"),To.value===!0?Object.assign($f,pn,pp,WS):Object.assign($f,pn)}const mp=(r,h)=>{const p=go(r);for(const y in r)fp(h,y,()=>p[y],b=>{p[y]=b});return h},Bn={hasPassive:!1,passiveCapture:!0,notPassiveCapture:!0};try{const r=Object.defineProperty({},"passive",{get(){Object.assign(Bn,{hasPassive:!0,passive:{passive:!0},notPassive:{passive:!1},passiveCapture:{passive:!0,capture:!0},notPassiveCapture:{passive:!1,capture:!0}})}});window.addEventListener("qtest",null,r),window.removeEventListener("qtest",null,r)}catch{}function Wo(){}function HS(r){return r.button===0}function Gf(r){return r.touches&&r.touches[0]?r=r.touches[0]:r.changedTouches&&r.changedTouches[0]?r=r.changedTouches[0]:r.targetTouches&&r.targetTouches[0]&&(r=r.targetTouches[0]),{top:r.clientY,left:r.clientX}}function XS(r){if(r.path)return r.path;if(r.composedPath)return r.composedPath();const h=[];let p=r.target;for(;p;){if(h.push(p),p.tagName==="HTML")return h.push(document),h.push(window),h;p=p.parentElement}}function $o(r){r.stopPropagation()}function Nr(r){r.cancelable!==!1&&r.preventDefault()}function xn(r){r.cancelable!==!1&&r.preventDefault(),r.stopPropagation()}function t_(r,h){if(r===void 0||h===!0&&r.__dragPrevented===!0)return;const p=h===!0?y=>{y.__dragPrevented=!0,y.addEventListener("dragstart",Nr,Bn.notPassiveCapture)}:y=>{delete y.__dragPrevented,y.removeEventListener("dragstart",Nr,Bn.notPassiveCapture)};r.querySelectorAll("a, img").forEach(p)}function cl(r,h,p){const y=`__q_${h}_evt`;r[y]=r[y]!==void 0?r[y].concat(p):p,p.forEach(b=>{b[0].addEventListener(b[1],r[b[2]],Bn[b[3]])})}function Ch(r,h){const p=`__q_${h}_evt`;r[p]!==void 0&&(r[p].forEach(y=>{y[0].removeEventListener(y[1],r[y[2]],Bn[y[3]])}),r[p]=void 0)}function cg(r,h=250,p){let y;function b(){const E=arguments,A=()=>{y=void 0,p!==!0&&r.apply(this,E)};clearTimeout(y),p===!0&&y===void 0&&r.apply(this,E),y=setTimeout(A,h)}return b.cancel=()=>{clearTimeout(y)},b}const i_=["sm","md","lg","xl"],{passive:Ox}=Bn,KS=mp({width:0,height:0,name:"xs",sizes:{sm:600,md:1024,lg:1440,xl:1920},lt:{sm:!0,md:!0,lg:!0,xl:!0},gt:{xs:!1,sm:!1,md:!1,lg:!1},xs:!0,sm:!1,md:!1,lg:!1,xl:!1},{setSizes:Wo,setDebounce:Wo,install({$q:r,onSSRHydrated:h}){if(r.screen=this,this.__installed===!0){r.config.screen!==void 0&&(r.config.screen.bodyClasses===!1?document.body.classList.remove(`screen--${this.name}`):this.__update(!0));return}const{visualViewport:p}=window,y=p||window,b=document.scrollingElement||document.documentElement,E=p===void 0||pn.is.mobile===!0?()=>[Math.max(window.innerWidth,b.clientWidth),Math.max(window.innerHeight,b.clientHeight)]:()=>[p.width*p.scale+window.innerWidth-b.clientWidth,p.height*p.scale+window.innerHeight-b.clientHeight],A=r.config.screen!==void 0&&r.config.screen.bodyClasses===!0;this.__update=F=>{const[q,H]=E();if(H!==this.height&&(this.height=H),q!==this.width)this.width=q;else if(F!==!0)return;let de=this.sizes;this.gt.xs=q>=de.sm,this.gt.sm=q>=de.md,this.gt.md=q>=de.lg,this.gt.lg=q>=de.xl,this.lt.sm=q<de.sm,this.lt.md=q<de.md,this.lt.lg=q<de.lg,this.lt.xl=q<de.xl,this.xs=this.lt.sm,this.sm=this.gt.xs===!0&&this.lt.md===!0,this.md=this.gt.sm===!0&&this.lt.lg===!0,this.lg=this.gt.md===!0&&this.lt.xl===!0,this.xl=this.gt.lg,de=this.xs===!0&&"xs"||this.sm===!0&&"sm"||this.md===!0&&"md"||this.lg===!0&&"lg"||"xl",de!==this.name&&(A===!0&&(document.body.classList.remove(`screen--${this.name}`),document.body.classList.add(`screen--${de}`)),this.name=de)};let s,D={},V=16;this.setSizes=F=>{i_.forEach(q=>{F[q]!==void 0&&(D[q]=F[q])})},this.setDebounce=F=>{V=F};const N=()=>{const F=getComputedStyle(document.body);F.getPropertyValue("--q-size-sm")&&i_.forEach(q=>{this.sizes[q]=parseInt(F.getPropertyValue(`--q-size-${q}`),10)}),this.setSizes=q=>{i_.forEach(H=>{q[H]&&(this.sizes[H]=q[H])}),this.__update(!0)},this.setDebounce=q=>{s!==void 0&&y.removeEventListener("resize",s,Ox),s=q>0?cg(this.__update,q):this.__update,y.addEventListener("resize",s,Ox)},this.setDebounce(V),Object.keys(D).length>0?(this.setSizes(D),D=void 0):this.__update(),A===!0&&this.name==="xs"&&document.body.classList.add("screen--xs")};To.value===!0?h.push(N):N()}}),fr=mp({isActive:!1,mode:!1},{__media:void 0,set(r){fr.mode=r,r==="auto"?(fr.__media===void 0&&(fr.__media=window.matchMedia("(prefers-color-scheme: dark)"),fr.__updateMedia=()=>{fr.set("auto")},fr.__media.addListener(fr.__updateMedia)),r=fr.__media.matches):fr.__media!==void 0&&(fr.__media.removeListener(fr.__updateMedia),fr.__media=void 0),fr.isActive=r===!0,document.body.classList.remove(`body--${r===!0?"light":"dark"}`),document.body.classList.add(`body--${r===!0?"dark":"light"}`)},toggle(){fr.set(fr.isActive===!1)},install({$q:r,onSSRHydrated:h,ssrContext:p}){const{dark:y}=r.config;if(r.dark=this,this.__installed===!0&&y===void 0)return;this.isActive=y===!0;const b=y!==void 0?y:!1;if(To.value===!0){const E=s=>{this.__fromSSR=s},A=this.set;this.set=E,E(b),h.push(()=>{this.set=A,this.set(this.__fromSSR)})}else this.set(b)}}),U1=()=>!0;function YS(r){return typeof r=="string"&&r!==""&&r!=="/"&&r!=="#/"}function JS(r){return r.startsWith("#")===!0&&(r=r.substring(1)),r.startsWith("/")===!1&&(r="/"+r),r.endsWith("/")===!0&&(r=r.substring(0,r.length-1)),"#"+r}function QS(r){if(r.backButtonExit===!1)return()=>!1;if(r.backButtonExit==="*")return U1;const h=["#/"];return Array.isArray(r.backButtonExit)===!0&&h.push(...r.backButtonExit.filter(YS).map(JS)),()=>h.includes(window.location.hash)}const Dh={__history:[],add:Wo,remove:Wo,install({$q:r}){if(this.__installed===!0)return;const{cordova:h,capacitor:p}=pn.is;if(h!==!0&&p!==!0)return;const y=r.config[h===!0?"cordova":"capacitor"];if(y!==void 0&&y.backButton===!1||p===!0&&(window.Capacitor===void 0||window.Capacitor.Plugins.App===void 0))return;this.add=A=>{A.condition===void 0&&(A.condition=U1),this.__history.push(A)},this.remove=A=>{const s=this.__history.indexOf(A);s>=0&&this.__history.splice(s,1)};const b=QS(Object.assign({backButtonExit:!0},y)),E=()=>{if(this.__history.length){const A=this.__history[this.__history.length-1];A.condition()===!0&&(this.__history.pop(),A.handler())}else b()===!0?navigator.app.exitApp():window.history.back()};h===!0?document.addEventListener("deviceready",()=>{document.addEventListener("backbutton",E,!1)}):window.Capacitor.Plugins.App.addListener("backButton",E)}},Vx={isoName:"en-US",nativeName:"English (US)",label:{clear:"Clear",ok:"OK",cancel:"Cancel",close:"Close",set:"Set",select:"Select",reset:"Reset",remove:"Remove",update:"Update",create:"Create",search:"Search",filter:"Filter",refresh:"Refresh",expand:r=>r?`Expand "${r}"`:"Expand",collapse:r=>r?`Collapse "${r}"`:"Collapse"},date:{days:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),daysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),firstDayOfWeek:0,format24h:!1,pluralDay:"days"},table:{noData:"No data available",noResults:"No matching records found",loading:"Loading...",selectedRecords:r=>r===1?"1 record selected.":(r===0?"No":r)+" records selected.",recordsPerPage:"Records per page:",allRows:"All",pagination:(r,h,p)=>r+"-"+h+" of "+p,columns:"Columns"},editor:{url:"URL",bold:"Bold",italic:"Italic",strikethrough:"Strikethrough",underline:"Underline",unorderedList:"Unordered List",orderedList:"Ordered List",subscript:"Subscript",superscript:"Superscript",hyperlink:"Hyperlink",toggleFullscreen:"Toggle Fullscreen",quote:"Quote",left:"Left align",center:"Center align",right:"Right align",justify:"Justify align",print:"Print",outdent:"Decrease indentation",indent:"Increase indentation",removeFormat:"Remove formatting",formatting:"Formatting",fontSize:"Font Size",align:"Align",hr:"Insert Horizontal Rule",undo:"Undo",redo:"Redo",heading1:"Heading 1",heading2:"Heading 2",heading3:"Heading 3",heading4:"Heading 4",heading5:"Heading 5",heading6:"Heading 6",paragraph:"Paragraph",code:"Code",size1:"Very small",size2:"A bit small",size3:"Normal",size4:"Medium-large",size5:"Big",size6:"Very big",size7:"Maximum",defaultFont:"Default Font",viewSource:"View Source"},tree:{noNodes:"No nodes available",noResults:"No matching nodes found"}};function Ux(){const r=Array.isArray(navigator.languages)===!0&&navigator.languages.length>0?navigator.languages[0]:navigator.language;if(typeof r=="string")return r.split(/[-_]/).map((h,p)=>p===0?h.toLowerCase():p>1||h.length<4?h.toUpperCase():h[0].toUpperCase()+h.slice(1).toLowerCase()).join("-")}const na=mp({__langPack:{}},{getLocale:Ux,set(r=Vx,h){const p={...r,rtl:r.rtl===!0,getLocale:Ux};{const y=document.documentElement;y.setAttribute("dir",p.rtl===!0?"rtl":"ltr"),y.setAttribute("lang",p.isoName),p.set=na.set,Object.assign(na.__langPack,p),na.props=p,na.isoName=p.isoName,na.nativeName=p.nativeName}},install({$q:r,lang:h,ssrContext:p}){r.lang=na.__langPack,this.__installed===!0?h!==void 0&&this.set(h):this.set(h||Vx)}});function eC(r,h,p=document.body){if(typeof r!="string")throw new TypeError("Expected a string as propName");if(typeof h!="string")throw new TypeError("Expected a string as value");if(!(p instanceof Element))throw new TypeError("Expected a DOM element");p.style.setProperty(`--q-${r}`,h)}let N1=!1;function tC(r){N1=r.isComposing===!0}function ug(r){return N1===!0||r!==Object(r)||r.isComposing===!0||r.qKeyEvent===!0}function la(r,h){return ug(r)===!0?!1:[].concat(h).includes(r.keyCode)}function iC(r){if(r.ios===!0)return"ios";if(r.android===!0)return"android"}function nC({is:r,has:h,within:p},y){const b=[r.desktop===!0?"desktop":"mobile",`${h.touch===!1?"no-":""}touch`];if(r.mobile===!0){const E=iC(r);E!==void 0&&b.push("platform-"+E)}if(r.nativeMobile===!0){const E=r.nativeMobileWrapper;b.push(E),b.push("native-mobile"),r.ios===!0&&(y[E]===void 0||y[E].iosStatusBarPadding!==!1)&&b.push("q-ios-padding")}else r.electron===!0?b.push("electron"):r.bex===!0&&b.push("bex");return p.iframe===!0&&b.push("within-iframe"),b}function rC(){const r=document.body.className;let h=r;pp!==void 0&&(h=h.replace("desktop","platform-ios mobile")),pn.has.touch===!0&&(h=h.replace("no-touch","touch")),pn.within.iframe===!0&&(h+=" within-iframe"),r!==h&&(document.body.className=h)}function oC(r){for(const h in r)eC(h,r[h])}const sC={install(r){if(this.__installed!==!0){if(To.value===!0)rC();else{const{$q:h}=r;h.config.brand!==void 0&&oC(h.config.brand);const p=nC(pn,h.config);document.body.classList.add.apply(document.body.classList,p)}pn.is.ios===!0&&document.body.addEventListener("touchstart",Wo),window.addEventListener("keydown",tC,!0)}}},aC={name:"material-icons",type:{positive:"check_circle",negative:"warning",info:"info",warning:"priority_high"},arrow:{up:"arrow_upward",right:"arrow_forward",down:"arrow_downward",left:"arrow_back",dropdown:"arrow_drop_down"},chevron:{left:"chevron_left",right:"chevron_right"},colorPicker:{spectrum:"gradient",tune:"tune",palette:"style"},pullToRefresh:{icon:"refresh"},carousel:{left:"chevron_left",right:"chevron_right",up:"keyboard_arrow_up",down:"keyboard_arrow_down",navigationIcon:"lens"},chip:{remove:"cancel",selected:"check"},datetime:{arrowLeft:"chevron_left",arrowRight:"chevron_right",now:"access_time",today:"today"},editor:{bold:"format_bold",italic:"format_italic",strikethrough:"strikethrough_s",underline:"format_underlined",unorderedList:"format_list_bulleted",orderedList:"format_list_numbered",subscript:"vertical_align_bottom",superscript:"vertical_align_top",hyperlink:"link",toggleFullscreen:"fullscreen",quote:"format_quote",left:"format_align_left",center:"format_align_center",right:"format_align_right",justify:"format_align_justify",print:"print",outdent:"format_indent_decrease",indent:"format_indent_increase",removeFormat:"format_clear",formatting:"text_format",fontSize:"format_size",align:"format_align_left",hr:"remove",undo:"undo",redo:"redo",heading:"format_size",code:"code",size:"format_size",font:"font_download",viewSource:"code"},expansionItem:{icon:"keyboard_arrow_down",denseIcon:"arrow_drop_down"},fab:{icon:"add",activeIcon:"close"},field:{clear:"cancel",error:"error"},pagination:{first:"first_page",prev:"keyboard_arrow_left",next:"keyboard_arrow_right",last:"last_page"},rating:{icon:"grade"},stepper:{done:"check",active:"edit",error:"warning"},tabs:{left:"chevron_left",right:"chevron_right",up:"keyboard_arrow_up",down:"keyboard_arrow_down"},table:{arrowUp:"arrow_upward",warning:"warning",firstPage:"first_page",prevPage:"chevron_left",nextPage:"chevron_right",lastPage:"last_page"},tree:{icon:"play_arrow"},uploader:{done:"done",clear:"clear",add:"add_box",upload:"cloud_upload",removeQueue:"clear_all",removeUploaded:"done_all"}},Zf=mp({iconMapFn:null,__icons:{}},{set(r,h){const p={...r,rtl:r.rtl===!0};p.set=Zf.set,Object.assign(Zf.__icons,p)},install({$q:r,iconSet:h,ssrContext:p}){r.config.iconMapFn!==void 0&&(this.iconMapFn=r.config.iconMapFn),r.iconSet=this.__icons,fp(r,"iconMapFn",()=>this.iconMapFn,y=>{this.iconMapFn=y}),this.__installed===!0?h!==void 0&&this.set(h):this.set(h||aC)}}),j1="_q_",q1="_q_t_",Fh="_q_l_",lC="_q_pc_",$1="_q_f_",G1="_q_fo_",Wf={};let Z1=!1;function cC(){Z1=!0}function ra(r,h){if(r===h)return!0;if(r!==null&&h!==null&&typeof r=="object"&&typeof h=="object"){if(r.constructor!==h.constructor)return!1;let p,y;if(r.constructor===Array){if(p=r.length,p!==h.length)return!1;for(y=p;y--!==0;)if(ra(r[y],h[y])!==!0)return!1;return!0}if(r.constructor===Map){if(r.size!==h.size)return!1;for(y=r.entries().next();y.done!==!0;){if(h.has(y.value[0])!==!0)return!1;y=y.next()}for(y=r.entries().next();y.done!==!0;){if(ra(y.value[1],h.get(y.value[0]))!==!0)return!1;y=y.next()}return!0}if(r.constructor===Set){if(r.size!==h.size)return!1;for(y=r.entries().next();y.done!==!0;){if(h.has(y.value[0])!==!0)return!1;y=y.next()}return!0}if(r.buffer!=null&&r.buffer.constructor===ArrayBuffer){if(p=r.length,p!==h.length)return!1;for(y=p;y--!==0;)if(r[y]!==h[y])return!1;return!0}if(r.constructor===RegExp)return r.source===h.source&&r.flags===h.flags;if(r.valueOf!==Object.prototype.valueOf)return r.valueOf()===h.valueOf();if(r.toString!==Object.prototype.toString)return r.toString()===h.toString();const b=Object.keys(r).filter(E=>r[E]!==void 0);if(p=b.length,p!==Object.keys(h).filter(E=>h[E]!==void 0).length)return!1;for(y=p;y--!==0;){const E=b[y];if(ra(r[E],h[E])!==!0)return!1}return!0}return r!==r&&h!==h}function Nx(r){return r!==null&&typeof r=="object"&&Array.isArray(r)!==!0}function uC(r){return typeof r=="number"&&isFinite(r)}const jx=[$f,sC,fr,KS,Dh,na,Zf];function qx(r,h){h.forEach(p=>{p.install(r),p.__installed=!0})}function hC(r,h,p){r.config.globalProperties.$q=p.$q,r.provide(j1,p.$q),qx(p,jx),h.components!==void 0&&Object.values(h.components).forEach(y=>{Nx(y)===!0&&y.name!==void 0&&r.component(y.name,y)}),h.directives!==void 0&&Object.values(h.directives).forEach(y=>{Nx(y)===!0&&y.name!==void 0&&r.directive(y.name,y)}),h.plugins!==void 0&&qx(p,Object.values(h.plugins).filter(y=>typeof y.install=="function"&&jx.includes(y)===!1)),To.value===!0&&(p.$q.onSSRHydrated=()=>{p.onSSRHydrated.forEach(y=>{y()}),p.$q.onSSRHydrated=()=>{}})}const dC=function(r,h={}){const p={version:"2.9.2"};Z1===!1?(h.config!==void 0&&Object.assign(Wf,h.config),p.config={...Wf},cC()):p.config=h.config||{},hC(r,h,{parentApp:r,$q:p,lang:h.lang,iconSet:h.iconSet,onSSRHydrated:[]})},fC={version:"2.9.2",install:dC,lang:na,iconSet:Zf};const M_={xs:18,sm:24,md:32,lg:38,xl:46},_p={size:String};function gp(r,h=M_){return be(()=>r.size!==void 0?{fontSize:r.size in h?`${h[r.size]}px`:r.size}:null)}const pC={size:{type:[Number,String],default:"1em"},color:String};function mC(r){return{cSize:be(()=>r.size in M_?`${M_[r.size]}px`:r.size),classes:be(()=>"q-spinner"+(r.color?` text-${r.color}`:""))}}const $i=r=>rp(AE(r)),hg=r=>rp(r),dg=$i({name:"QSpinner",props:{...pC,thickness:{type:Number,default:5}},setup(r){const{cSize:h,classes:p}=mC(r);return()=>Ie("svg",{class:p.value+" q-spinner-mat",width:h.value,height:h.value,viewBox:"25 25 50 50"},[Ie("circle",{class:"path",cx:"50",cy:"50",r:"20",fill:"none",stroke:"currentColor","stroke-width":r.thickness,"stroke-miterlimit":"10"})])}}),_C={ratio:[String,Number]};function gC(r,h){return be(()=>{const p=Number(r.ratio||(h!==void 0?h.value:void 0));return isNaN(p)!==!0&&p>0?{paddingBottom:`${100/p}%`}:null})}function bn(r,h){return r!==void 0&&r()||h}function fg(r,h){if(r!==void 0){const p=r();if(p!=null)return p.slice()}return h}function Jr(r,h){return r!==void 0?h.concat(r()):h}function yC(r,h){return r===void 0?h:h!==void 0?h.concat(r()):r()}function W1(r,h,p,y,b,E){h.key=y+b;const A=Ie(r,h,p);return b===!0?ng(A,E()):A}const vC=16/9,xC=$i({name:"QImg",props:{..._C,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:vC},placeholderSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(r,{slots:h,emit:p}){const y=Rt(r.initialRatio),b=gC(r,y);let E;const A=[Rt(null),Rt(r.placeholderSrc!==void 0?{src:r.placeholderSrc}:null)],s=Rt(0),D=Rt(!1),V=Rt(!1),N=be(()=>`q-img q-img--${r.noNativeMenu===!0?"no-":""}menu`),F=be(()=>({width:r.width,height:r.height})),q=be(()=>`q-img__image ${r.imgClass!==void 0?r.imgClass+" ":""}q-img__image--with${r.noTransition===!0?"out":""}-transition`),H=be(()=>({...r.imgStyle,objectFit:r.fit,objectPosition:r.position}));ri(()=>de(),ye);function de(){return r.src||r.srcset||r.sizes?{src:r.src,srcset:r.srcset,sizes:r.sizes}:null}function ye(xe){if(clearTimeout(E),V.value=!1,xe===null){D.value=!1,A[0].value=null,A[1].value=null;return}D.value=!0,A[s.value].value=xe}function ze({target:xe}){E!==null&&(clearTimeout(E),y.value=xe.naturalHeight===0?.5:xe.naturalWidth/xe.naturalHeight,He(xe,1))}function He(xe,De){E===null||De===1e3||(xe.complete===!0?we(xe):E=setTimeout(()=>{He(xe,De+1)},50))}function we(xe){E!==null&&(s.value=s.value===1?0:1,A[s.value].value=null,D.value=!1,V.value=!1,p("load",xe.currentSrc||xe.src))}function Le(xe){clearTimeout(E),D.value=!1,V.value=!0,A[0].value=null,A[1].value=null,p("error",xe)}function Ne(xe,De){return Ie("div",{class:"q-img__container absolute-full",key:xe},De)}function Te(xe){const De=A[xe].value,Ke={key:"img_"+xe,class:q.value,style:H.value,crossorigin:r.crossorigin,decoding:r.decoding,referrerpolicy:r.referrerpolicy,height:r.height,width:r.width,loading:r.loading,fetchpriority:r.fetchpriority,"aria-hidden":"true",draggable:r.draggable,...De};return s.value===xe?(Ke.class+=" q-img__image--waiting",Object.assign(Ke,{onLoad:ze,onError:Le})):Ke.class+=" q-img__image--loaded",Ne("img"+xe,Ie("img",Ke))}function Pe(){return D.value!==!0?Ie("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},bn(h[V.value===!0?"error":"default"])):Ie("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},h.loading!==void 0?h.loading():r.noSpinner===!0?void 0:[Ie(dg,{color:r.spinnerColor,size:r.spinnerSize})])}return ye(de()),_n(()=>{clearTimeout(E),E=null}),()=>{const xe=[];return b.value!==null&&xe.push(Ie("div",{key:"filler",style:b.value})),V.value!==!0&&(A[0].value!==null&&xe.push(Te(0)),A[1].value!==null&&xe.push(Te(1))),xe.push(Ie(vs,{name:"q-transition--fade"},Pe)),Ie("div",{class:N.value,style:F.value,role:"img","aria-label":r.alt},xe)}}});function bC(){const r=Rt(!To.value);return r.value===!1&&sr(()=>{r.value=!0}),r}const H1=typeof ResizeObserver<"u",$x=H1===!0?{}:{style:"display:block;position:absolute;top:0;left:0;right:0;bottom:0;height:100%;width:100%;overflow:hidden;pointer-events:none;z-index:-1;",url:"about:blank"},Hf=$i({name:"QResizeObserver",props:{debounce:{type:[String,Number],default:100}},emits:["resize"],setup(r,{emit:h}){let p=null,y,b={width:-1,height:-1};function E(N){N===!0||r.debounce===0||r.debounce==="0"?A():p===null&&(p=setTimeout(A,r.debounce))}function A(){if(clearTimeout(p),p=null,y){const{offsetWidth:N,offsetHeight:F}=y;(N!==b.width||F!==b.height)&&(b={width:N,height:F},h("resize",b))}}const{proxy:s}=Oi();if(H1===!0){let N;return sr(()=>{fn(()=>{y=s.$el.parentNode,y&&(N=new ResizeObserver(E),N.observe(y),A())})}),_n(()=>{clearTimeout(p),N!==void 0&&(N.disconnect!==void 0?N.disconnect():y&&N.unobserve(y))}),Wo}else{let q=function(){clearTimeout(p),F!==void 0&&(F.removeEventListener!==void 0&&F.removeEventListener("resize",E,Bn.passive),F=void 0)},H=function(){q(),y&&y.contentDocument&&(F=y.contentDocument.defaultView,F.addEventListener("resize",E,Bn.passive),A())};var D=q,V=H;const N=bC();let F;return sr(()=>{fn(()=>{y=s.$el,y&&H()})}),_n(q),s.trigger=E,()=>{if(N.value===!0)return Ie("object",{style:$x.style,tabindex:-1,type:"text/html",data:$x.url,"aria-hidden":"true",onLoad:H})}}}}),wC=$i({name:"QHeader",props:{modelValue:{type:Boolean,default:!0},reveal:Boolean,revealOffset:{type:Number,default:250},bordered:Boolean,elevated:Boolean,heightHint:{type:[String,Number],default:50}},emits:["reveal","focusin"],setup(r,{slots:h,emit:p}){const{proxy:{$q:y}}=Oi(),b=bo(Fh,()=>{console.error("QHeader needs to be child of QLayout")}),E=Rt(parseInt(r.heightHint,10)),A=Rt(!0),s=be(()=>r.reveal===!0||b.view.value.indexOf("H")>-1||y.platform.is.ios&&b.isContainer.value===!0),D=be(()=>{if(r.modelValue!==!0)return 0;if(s.value===!0)return A.value===!0?E.value:0;const we=E.value-b.scroll.value.position;return we>0?we:0}),V=be(()=>r.modelValue!==!0||s.value===!0&&A.value!==!0),N=be(()=>r.modelValue===!0&&V.value===!0&&r.reveal===!0),F=be(()=>"q-header q-layout__section--marginal "+(s.value===!0?"fixed":"absolute")+"-top"+(r.bordered===!0?" q-header--bordered":"")+(V.value===!0?" q-header--hidden":"")+(r.modelValue!==!0?" q-layout--prevent-focus":"")),q=be(()=>{const we=b.rows.value.top,Le={};return we[0]==="l"&&b.left.space===!0&&(Le[y.lang.rtl===!0?"right":"left"]=`${b.left.size}px`),we[2]==="r"&&b.right.space===!0&&(Le[y.lang.rtl===!0?"left":"right"]=`${b.right.size}px`),Le});function H(we,Le){b.update("header",we,Le)}function de(we,Le){we.value!==Le&&(we.value=Le)}function ye({height:we}){de(E,we),H("size",we)}function ze(we){N.value===!0&&de(A,!0),p("focusin",we)}ri(()=>r.modelValue,we=>{H("space",we),de(A,!0),b.animate()}),ri(D,we=>{H("offset",we)}),ri(()=>r.reveal,we=>{we===!1&&de(A,r.modelValue)}),ri(A,we=>{b.animate(),p("reveal",we)}),ri(b.scroll,we=>{r.reveal===!0&&de(A,we.direction==="up"||we.position<=r.revealOffset||we.position-we.inflectionPoint<100)});const He={};return b.instances.header=He,r.modelValue===!0&&H("size",E.value),H("space",r.modelValue),H("offset",D.value),_n(()=>{b.instances.header===He&&(b.instances.header=void 0,H("size",0),H("offset",0),H("space",!1))}),()=>{const we=fg(h.default,[]);return r.elevated===!0&&we.push(Ie("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),we.push(Ie(Hf,{debounce:0,onResize:ye})),Ie("header",{class:F.value,style:q.value,onFocusin:ze},we)}}}),TC={position:{type:String,default:"bottom-right",validator:r=>["top-right","top-left","bottom-right","bottom-left","top","right","bottom","left"].includes(r)},offset:{type:Array,validator:r=>r.length===2},expand:Boolean};function EC(){const{props:r,proxy:{$q:h}}=Oi(),p=bo(Fh,()=>{console.error("QPageSticky needs to be child of QLayout")}),y=be(()=>{const F=r.position;return{top:F.indexOf("top")>-1,right:F.indexOf("right")>-1,bottom:F.indexOf("bottom")>-1,left:F.indexOf("left")>-1,vertical:F==="top"||F==="bottom",horizontal:F==="left"||F==="right"}}),b=be(()=>p.header.offset),E=be(()=>p.right.offset),A=be(()=>p.footer.offset),s=be(()=>p.left.offset),D=be(()=>{let F=0,q=0;const H=y.value,de=h.lang.rtl===!0?-1:1;H.top===!0&&b.value!==0?q=`${b.value}px`:H.bottom===!0&&A.value!==0&&(q=`${-A.value}px`),H.left===!0&&s.value!==0?F=`${de*s.value}px`:H.right===!0&&E.value!==0&&(F=`${-de*E.value}px`);const ye={transform:`translate(${F}, ${q})`};return r.offset&&(ye.margin=`${r.offset[1]}px ${r.offset[0]}px`),H.vertical===!0?(s.value!==0&&(ye[h.lang.rtl===!0?"right":"left"]=`${s.value}px`),E.value!==0&&(ye[h.lang.rtl===!0?"left":"right"]=`${E.value}px`)):H.horizontal===!0&&(b.value!==0&&(ye.top=`${b.value}px`),A.value!==0&&(ye.bottom=`${A.value}px`)),ye}),V=be(()=>`q-page-sticky row flex-center fixed-${r.position} q-page-sticky--${r.expand===!0?"expand":"shrink"}`);function N(F){const q=bn(F.default);return Ie("div",{class:V.value,style:D.value},r.expand===!0?q:[Ie("div",q)])}return{$layout:p,getStickyContent:N}}const SC=$i({name:"QPageSticky",props:TC,setup(r,{slots:h}){const{getStickyContent:p}=EC();return()=>p(h)}}),CC=$i({name:"QPageContainer",setup(r,{slots:h}){const{proxy:{$q:p}}=Oi(),y=bo(Fh,()=>{console.error("QPageContainer needs to be child of QLayout")});Lc(lC,!0);const b=be(()=>{const E={};return y.header.space===!0&&(E.paddingTop=`${y.header.size}px`),y.right.space===!0&&(E[`padding${p.lang.rtl===!0?"Left":"Right"}`]=`${y.right.size}px`),y.footer.space===!0&&(E.paddingBottom=`${y.footer.size}px`),y.left.space===!0&&(E[`padding${p.lang.rtl===!0?"Right":"Left"}`]=`${y.left.size}px`),E});return()=>Ie("div",{class:"q-page-container",style:b.value},bn(h.default))}});function Lf(r){if(Object(r.$parent)===r.$parent)return r.$parent;let{parent:h}=r.$;for(;Object(h)===h;){if(Object(h.proxy)===h.proxy)return h.proxy;h=h.parent}}function X1(r,h){typeof h.type=="symbol"?Array.isArray(h.children)===!0&&h.children.forEach(p=>{X1(r,p)}):r.add(h)}function K1(r){const h=new Set;return r.forEach(p=>{X1(h,p)}),Array.from(h)}function pg(r){return r.appContext.config.globalProperties.$router!==void 0}function mg(r){return r.isUnmounted===!0||r.isDeactivated===!0}const Gx=$i({name:"QChatMessage",props:{sent:Boolean,label:String,bgColor:String,textColor:String,name:String,avatar:String,text:Array,stamp:String,size:String,labelHtml:Boolean,nameHtml:Boolean,textHtml:Boolean,stampHtml:Boolean},setup(r,{slots:h}){const p=be(()=>r.sent===!0?"sent":"received"),y=be(()=>`q-message-text-content q-message-text-content--${p.value}`+(r.textColor!==void 0?` text-${r.textColor}`:"")),b=be(()=>`q-message-text q-message-text--${p.value}`+(r.bgColor!==void 0?` text-${r.bgColor}`:"")),E=be(()=>"q-message-container row items-end no-wrap"+(r.sent===!0?" reverse":"")),A=be(()=>r.size!==void 0?`col-${r.size}`:""),s=be(()=>({msg:r.textHtml===!0?"innerHTML":"textContent",stamp:r.stampHtml===!0?"innerHTML":"textContent",name:r.nameHtml===!0?"innerHTML":"textContent",label:r.labelHtml===!0?"innerHTML":"textContent"}));function D(N){return h.stamp!==void 0?[N,Ie("div",{class:"q-message-stamp"},h.stamp())]:r.stamp?[N,Ie("div",{class:"q-message-stamp",[s.value.stamp]:r.stamp})]:[N]}function V(N,F){const q=F===!0?N.length>1?H=>H:H=>Ie("div",[H]):H=>Ie("div",{[s.value.msg]:H});return N.map((H,de)=>Ie("div",{key:de,class:b.value},[Ie("div",{class:y.value},D(q(H)))]))}return()=>{const N=[];h.avatar!==void 0?N.push(h.avatar()):r.avatar!==void 0&&N.push(Ie("img",{class:`q-message-avatar q-message-avatar--${p.value}`,src:r.avatar,"aria-hidden":"true"}));const F=[];h.name!==void 0?F.push(Ie("div",{class:`q-message-name q-message-name--${p.value}`},h.name())):r.name!==void 0&&F.push(Ie("div",{class:`q-message-name q-message-name--${p.value}`,[s.value.name]:r.name})),h.default!==void 0?F.push(V(K1(h.default()),!0)):r.text!==void 0&&F.push(V(r.text)),N.push(Ie("div",{class:A.value},F));const q=[];return h.label!==void 0?q.push(Ie("div",{class:"q-message-label"},h.label())):r.label!==void 0&&q.push(Ie("div",{class:"q-message-label",[s.value.label]:r.label})),q.push(Ie("div",{class:E.value},N)),Ie("div",{class:`q-message q-message-${p.value}`},q)}}}),AC=$i({name:"QToolbar",props:{inset:Boolean},setup(r,{slots:h}){const p=be(()=>"q-toolbar row no-wrap items-center"+(r.inset===!0?" q-toolbar--inset":""));return()=>Ie("div",{class:p.value},bn(h.default))}}),MC=$i({name:"QFooter",props:{modelValue:{type:Boolean,default:!0},reveal:Boolean,bordered:Boolean,elevated:Boolean,heightHint:{type:[String,Number],default:50}},emits:["reveal","focusin"],setup(r,{slots:h,emit:p}){const{proxy:{$q:y}}=Oi(),b=bo(Fh,()=>{console.error("QFooter needs to be child of QLayout")}),E=Rt(parseInt(r.heightHint,10)),A=Rt(!0),s=Rt(To.value===!0||b.isContainer.value===!0?0:window.innerHeight),D=be(()=>r.reveal===!0||b.view.value.indexOf("F")>-1||y.platform.is.ios&&b.isContainer.value===!0),V=be(()=>b.isContainer.value===!0?b.containerHeight.value:s.value),N=be(()=>{if(r.modelValue!==!0)return 0;if(D.value===!0)return A.value===!0?E.value:0;const Te=b.scroll.value.position+V.value+E.value-b.height.value;return Te>0?Te:0}),F=be(()=>r.modelValue!==!0||D.value===!0&&A.value!==!0),q=be(()=>r.modelValue===!0&&F.value===!0&&r.reveal===!0),H=be(()=>"q-footer q-layout__section--marginal "+(D.value===!0?"fixed":"absolute")+"-bottom"+(r.bordered===!0?" q-footer--bordered":"")+(F.value===!0?" q-footer--hidden":"")+(r.modelValue!==!0?" q-layout--prevent-focus"+(D.value!==!0?" hidden":""):"")),de=be(()=>{const Te=b.rows.value.bottom,Pe={};return Te[0]==="l"&&b.left.space===!0&&(Pe[y.lang.rtl===!0?"right":"left"]=`${b.left.size}px`),Te[2]==="r"&&b.right.space===!0&&(Pe[y.lang.rtl===!0?"left":"right"]=`${b.right.size}px`),Pe});function ye(Te,Pe){b.update("footer",Te,Pe)}function ze(Te,Pe){Te.value!==Pe&&(Te.value=Pe)}function He({height:Te}){ze(E,Te),ye("size",Te)}function we(){if(r.reveal!==!0)return;const{direction:Te,position:Pe,inflectionPoint:xe}=b.scroll.value;ze(A,Te==="up"||Pe-xe<100||b.height.value-V.value-Pe-E.value<300)}function Le(Te){q.value===!0&&ze(A,!0),p("focusin",Te)}ri(()=>r.modelValue,Te=>{ye("space",Te),ze(A,!0),b.animate()}),ri(N,Te=>{ye("offset",Te)}),ri(()=>r.reveal,Te=>{Te===!1&&ze(A,r.modelValue)}),ri(A,Te=>{b.animate(),p("reveal",Te)}),ri([E,b.scroll,b.height],we),ri(()=>y.screen.height,Te=>{b.isContainer.value!==!0&&ze(s,Te)});const Ne={};return b.instances.footer=Ne,r.modelValue===!0&&ye("size",E.value),ye("space",r.modelValue),ye("offset",N.value),_n(()=>{b.instances.footer===Ne&&(b.instances.footer=void 0,ye("size",0),ye("offset",0),ye("space",!1))}),()=>{const Te=Jr(h.default,[Ie(Hf,{debounce:0,onResize:He})]);return r.elevated===!0&&Te.push(Ie("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),Ie("footer",{class:H.value,style:de.value,onFocusin:Le},Te)}}});function I_(r,h){const p=r.style;for(const y in h)p[y]=h[y]}function IC(r){if(r==null)return;if(typeof r=="string")try{return document.querySelector(r)||void 0}catch{return}const h=Y_(r);if(h)return h.$el||h}function Y1(r,h){if(r==null||r.contains(h)===!0)return!0;for(let p=r.nextElementSibling;p!==null;p=p.nextElementSibling)if(p.contains(h))return!0;return!1}const kC=[null,document,document.body,document.scrollingElement,document.documentElement];function J1(r,h){let p=IC(h);if(p===void 0){if(r==null)return window;p=r.closest(".scroll,.scroll-y,.overflow-auto")}return kC.includes(p)?window:p}function Q1(r){return r===window?window.pageYOffset||window.scrollY||document.body.scrollTop||0:r.scrollTop}function eb(r){return r===window?window.pageXOffset||window.scrollX||document.body.scrollLeft||0:r.scrollLeft}let Tf;function Bf(){if(Tf!==void 0)return Tf;const r=document.createElement("p"),h=document.createElement("div");I_(r,{width:"100%",height:"200px"}),I_(h,{position:"absolute",top:"0px",left:"0px",visibility:"hidden",width:"200px",height:"150px",overflow:"hidden"}),h.appendChild(r),document.body.appendChild(h);const p=r.offsetWidth;h.style.overflow="scroll";let y=r.offsetWidth;return p===y&&(y=h.clientWidth),h.remove(),Tf=p-y,Tf}function zC(r,h=!0){return!r||r.nodeType!==Node.ELEMENT_NODE?!1:h?r.scrollHeight>r.clientHeight&&(r.classList.contains("scroll")||r.classList.contains("overflow-auto")||["auto","scroll"].includes(window.getComputedStyle(r)["overflow-y"])):r.scrollWidth>r.clientWidth&&(r.classList.contains("scroll")||r.classList.contains("overflow-auto")||["auto","scroll"].includes(window.getComputedStyle(r)["overflow-x"]))}const{passive:Zx}=Bn,PC=["both","horizontal","vertical"],DC=$i({name:"QScrollObserver",props:{axis:{type:String,validator:r=>PC.includes(r),default:"vertical"},debounce:[String,Number],scrollTarget:{default:void 0}},emits:["scroll"],setup(r,{emit:h}){const p={position:{top:0,left:0},direction:"down",directionChanged:!1,delta:{top:0,left:0},inflectionPoint:{top:0,left:0}};let y=null,b,E;ri(()=>r.scrollTarget,()=>{D(),s()});function A(){y!==null&&y();const F=Math.max(0,Q1(b)),q=eb(b),H={top:F-p.position.top,left:q-p.position.left};if(r.axis==="vertical"&&H.top===0||r.axis==="horizontal"&&H.left===0)return;const de=Math.abs(H.top)>=Math.abs(H.left)?H.top<0?"up":"down":H.left<0?"left":"right";p.position={top:F,left:q},p.directionChanged=p.direction!==de,p.delta=H,p.directionChanged===!0&&(p.direction=de,p.inflectionPoint=p.position),h("scroll",{...p})}function s(){b=J1(E,r.scrollTarget),b.addEventListener("scroll",V,Zx),V(!0)}function D(){b!==void 0&&(b.removeEventListener("scroll",V,Zx),b=void 0)}function V(F){if(F===!0||r.debounce===0||r.debounce==="0")A();else if(y===null){const[q,H]=r.debounce?[setTimeout(A,r.debounce),clearTimeout]:[requestAnimationFrame(A),cancelAnimationFrame];y=()=>{H(q),y=null}}}const{proxy:N}=Oi();return sr(()=>{E=N.$el.parentNode,s()}),_n(()=>{y!==null&&y(),D()}),Object.assign(N,{trigger:V,getPosition:()=>p}),Wo}}),LC=$i({name:"QLayout",props:{container:Boolean,view:{type:String,default:"hhh lpr fff",validator:r=>/^(h|l)h(h|r) lpr (f|l)f(f|r)$/.test(r.toLowerCase())},onScroll:Function,onScrollHeight:Function,onResize:Function},setup(r,{slots:h,emit:p}){const{proxy:{$q:y}}=Oi(),b=Rt(null),E=Rt(y.screen.height),A=Rt(r.container===!0?0:y.screen.width),s=Rt({position:0,direction:"down",inflectionPoint:0}),D=Rt(0),V=Rt(To.value===!0?0:Bf()),N=be(()=>"q-layout q-layout--"+(r.container===!0?"containerized":"standard")),F=be(()=>r.container===!1?{minHeight:y.screen.height+"px"}:null),q=be(()=>V.value!==0?{[y.lang.rtl===!0?"left":"right"]:`${V.value}px`}:null),H=be(()=>V.value!==0?{[y.lang.rtl===!0?"right":"left"]:0,[y.lang.rtl===!0?"left":"right"]:`-${V.value}px`,width:`calc(100% + ${V.value}px)`}:null);function de(xe){if(r.container===!0||document.qScrollPrevented!==!0){const De={position:xe.position.top,direction:xe.direction,directionChanged:xe.directionChanged,inflectionPoint:xe.inflectionPoint.top,delta:xe.delta.top};s.value=De,r.onScroll!==void 0&&p("scroll",De)}}function ye(xe){const{height:De,width:Ke}=xe;let Ue=!1;E.value!==De&&(Ue=!0,E.value=De,r.onScrollHeight!==void 0&&p("scroll-height",De),He()),A.value!==Ke&&(Ue=!0,A.value=Ke),Ue===!0&&r.onResize!==void 0&&p("resize",xe)}function ze({height:xe}){D.value!==xe&&(D.value=xe,He())}function He(){if(r.container===!0){const xe=E.value>D.value?Bf():0;V.value!==xe&&(V.value=xe)}}let we;const Le={instances:{},view:be(()=>r.view),isContainer:be(()=>r.container),rootRef:b,height:E,containerHeight:D,scrollbarWidth:V,totalWidth:be(()=>A.value+V.value),rows:be(()=>{const xe=r.view.toLowerCase().split(" ");return{top:xe[0].split(""),middle:xe[1].split(""),bottom:xe[2].split("")}}),header:go({size:0,offset:0,space:!1}),right:go({size:300,offset:0,space:!1}),footer:go({size:0,offset:0,space:!1}),left:go({size:300,offset:0,space:!1}),scroll:s,animate(){we!==void 0?clearTimeout(we):document.body.classList.add("q-body--layout-animate"),we=setTimeout(()=>{document.body.classList.remove("q-body--layout-animate"),we=void 0},155)},update(xe,De,Ke){Le[xe][De]=Ke}};if(Lc(Fh,Le),Bf()>0){let Ke=function(){xe=null,De.classList.remove("hide-scrollbar")},Ue=function(){if(xe===null){if(De.scrollHeight>y.screen.height)return;De.classList.add("hide-scrollbar")}else clearTimeout(xe);xe=setTimeout(Ke,300)},nt=function($e){xe!==null&&$e==="remove"&&(clearTimeout(xe),Ke()),window[`${$e}EventListener`]("resize",Ue)};var Ne=Ke,Te=Ue,Pe=nt;let xe=null;const De=document.body;ri(()=>r.container!==!0?"add":"remove",nt),r.container!==!0&&nt("add"),up(()=>{nt("remove")})}return()=>{const xe=Jr(h.default,[Ie(DC,{onScroll:de}),Ie(Hf,{onResize:ye})]),De=Ie("div",{class:N.value,style:F.value,ref:r.container===!0?void 0:b,tabindex:-1},xe);return r.container===!0?Ie("div",{class:"q-layout-container overflow-hidden",ref:b},[Ie(Hf,{onResize:ze}),Ie("div",{class:"absolute-full",style:q.value},[Ie("div",{class:"scroll",style:H.value},[De])])]):De}}}),Wx="0 0 24 24",Hx=r=>r,n_=r=>`ionicons ${r}`,tb={"mdi-":r=>`mdi ${r}`,"icon-":Hx,"bt-":r=>`bt ${r}`,"eva-":r=>`eva ${r}`,"ion-md":n_,"ion-ios":n_,"ion-logo":n_,"iconfont ":Hx,"ti-":r=>`themify-icon ${r}`,"bi-":r=>`bootstrap-icons ${r}`},ib={o_:"-outlined",r_:"-round",s_:"-sharp"},nb={sym_o_:"-outlined",sym_r_:"-rounded",sym_s_:"-sharp"},BC=new RegExp("^("+Object.keys(tb).join("|")+")"),RC=new RegExp("^("+Object.keys(ib).join("|")+")"),Xx=new RegExp("^("+Object.keys(nb).join("|")+")"),FC=/^[Mm]\s?[-+]?\.?\d/,OC=/^img:/,VC=/^svguse:/,UC=/^ion-/,NC=/^(fa-(solid|regular|light|brands|duotone|thin)|[lf]a[srlbdk]?) /,jn=$i({name:"QIcon",props:{..._p,tag:{type:String,default:"i"},name:String,color:String,left:Boolean,right:Boolean},setup(r,{slots:h}){const{proxy:{$q:p}}=Oi(),y=gp(r),b=be(()=>"q-icon"+(r.left===!0?" on-left":"")+(r.right===!0?" on-right":"")+(r.color!==void 0?` text-${r.color}`:"")),E=be(()=>{let A,s=r.name;if(s==="none"||!s)return{none:!0};if(p.iconMapFn!==null){const N=p.iconMapFn(s);if(N!==void 0)if(N.icon!==void 0){if(s=N.icon,s==="none"||!s)return{none:!0}}else return{cls:N.cls,content:N.content!==void 0?N.content:" "}}if(FC.test(s)===!0){const[N,F=Wx]=s.split("|");return{svg:!0,viewBox:F,nodes:N.split("&&").map(q=>{const[H,de,ye]=q.split("@@");return Ie("path",{style:de,d:H,transform:ye})})}}if(OC.test(s)===!0)return{img:!0,src:s.substring(4)};if(VC.test(s)===!0){const[N,F=Wx]=s.split("|");return{svguse:!0,src:N.substring(7),viewBox:F}}let D=" ";const V=s.match(BC);if(V!==null)A=tb[V[1]](s);else if(NC.test(s)===!0)A=s;else if(UC.test(s)===!0)A=`ionicons ion-${p.platform.is.ios===!0?"ios":"md"}${s.substring(3)}`;else if(Xx.test(s)===!0){A="notranslate material-symbols";const N=s.match(Xx);N!==null&&(s=s.substring(6),A+=nb[N[1]]),D=s}else{A="notranslate material-icons";const N=s.match(RC);N!==null&&(s=s.substring(2),A+=ib[N[1]]),D=s}return{cls:A,content:D}});return()=>{const A={class:b.value,style:y.value,"aria-hidden":"true",role:"presentation"};return E.value.none===!0?Ie(r.tag,A,bn(h.default)):E.value.img===!0?Ie("span",A,Jr(h.default,[Ie("img",{src:E.value.src})])):E.value.svg===!0?Ie("span",A,Jr(h.default,[Ie("svg",{viewBox:E.value.viewBox||"0 0 24 24"},E.value.nodes)])):E.value.svguse===!0?Ie("span",A,Jr(h.default,[Ie("svg",{viewBox:E.value.viewBox},[Ie("use",{"xlink:href":E.value.src})])])):(E.value.cls!==void 0&&(A.class+=" "+E.value.cls),Ie(r.tag,A,Jr(h.default,[E.value.content])))}}});function jC(r,h=250){let p=!1,y;return function(){return p===!1&&(p=!0,setTimeout(()=>{p=!1},h),y=r.apply(this,arguments)),y}}function Kx(r,h,p,y){p.modifiers.stop===!0&&$o(r);const b=p.modifiers.color;let E=p.modifiers.center;E=E===!0||y===!0;const A=document.createElement("span"),s=document.createElement("span"),D=Gf(r),{left:V,top:N,width:F,height:q}=h.getBoundingClientRect(),H=Math.sqrt(F*F+q*q),de=H/2,ye=`${(F-H)/2}px`,ze=E?ye:`${D.left-V-de}px`,He=`${(q-H)/2}px`,we=E?He:`${D.top-N-de}px`;s.className="q-ripple__inner",I_(s,{height:`${H}px`,width:`${H}px`,transform:`translate3d(${ze},${we},0) scale3d(.2,.2,1)`,opacity:0}),A.className=`q-ripple${b?" text-"+b:""}`,A.setAttribute("dir","ltr"),A.appendChild(s),h.appendChild(A);const Le=()=>{A.remove(),clearTimeout(Ne)};p.abort.push(Le);let Ne=setTimeout(()=>{s.classList.add("q-ripple__inner--enter"),s.style.transform=`translate3d(${ye},${He},0) scale3d(1,1,1)`,s.style.opacity=.2,Ne=setTimeout(()=>{s.classList.remove("q-ripple__inner--enter"),s.classList.add("q-ripple__inner--leave"),s.style.opacity=0,Ne=setTimeout(()=>{A.remove(),p.abort.splice(p.abort.indexOf(Le),1)},275)},250)},50)}function Yx(r,{modifiers:h,value:p,arg:y}){const b=Object.assign({},r.cfg.ripple,h,p);r.modifiers={early:b.early===!0,stop:b.stop===!0,center:b.center===!0,color:b.color||y,keyCodes:[].concat(b.keyCodes||13)}}const rb=hg({name:"ripple",beforeMount(r,h){const p=h.instance.$.appContext.config.globalProperties.$q.config||{};if(p.ripple===!1)return;const y={cfg:p,enabled:h.value!==!1,modifiers:{},abort:[],start(b){y.enabled===!0&&b.qSkipRipple!==!0&&b.type===(y.modifiers.early===!0?"pointerdown":"click")&&Kx(b,r,y,b.qKeyEvent===!0)},keystart:jC(b=>{y.enabled===!0&&b.qSkipRipple!==!0&&la(b,y.modifiers.keyCodes)===!0&&b.type===`key${y.modifiers.early===!0?"down":"up"}`&&Kx(b,r,y,!0)},300)};Yx(y,h),r.__qripple=y,cl(y,"main",[[r,"pointerdown","start","passive"],[r,"click","start","passive"],[r,"keydown","keystart","passive"],[r,"keyup","keystart","passive"]])},updated(r,h){if(h.oldValue!==h.value){const p=r.__qripple;p!==void 0&&(p.enabled=h.value!==!1,p.enabled===!0&&Object(h.value)===h.value&&Yx(p,h))}},beforeUnmount(r){const h=r.__qripple;h!==void 0&&(h.abort.forEach(p=>{p()}),Ch(h,"main"),delete r._qripple)}}),ob={left:"start",center:"center",right:"end",between:"between",around:"around",evenly:"evenly",stretch:"stretch"},qC=Object.keys(ob),$C={align:{type:String,validator:r=>qC.includes(r)}};function GC(r){return be(()=>{const h=r.align===void 0?r.vertical===!0?"stretch":"left":r.align;return`${r.vertical===!0?"items":"justify"}-${ob[h]}`})}function Jx(r){return r?r.aliasOf?r.aliasOf.path:r.path:""}function Qx(r,h){return(r.aliasOf||r)===(h.aliasOf||h)}function ZC(r,h){for(const p in h){const y=h[p],b=r[p];if(typeof y=="string"){if(y!==b)return!1}else if(Array.isArray(b)===!1||b.length!==y.length||y.some((E,A)=>E!==b[A]))return!1}return!0}function e0(r,h){return Array.isArray(h)===!0?r.length===h.length&&r.every((p,y)=>p===h[y]):r.length===1&&r[0]===h}function WC(r,h){return Array.isArray(r)===!0?e0(r,h):Array.isArray(h)===!0?e0(h,r):r===h}function HC(r,h){if(Object.keys(r).length!==Object.keys(h).length)return!1;for(const p in r)if(WC(r[p],h[p])===!1)return!1;return!0}const sb={to:[String,Object],replace:Boolean,exact:Boolean,activeClass:{type:String,default:"q-router-link--active"},exactActiveClass:{type:String,default:"q-router-link--exact-active"},href:String,target:String,disable:Boolean};function ab({fallbackTag:r,useDisableForRouterLinkProps:h=!0}={}){const p=Oi(),{props:y,proxy:b,emit:E}=p,A=pg(p),s=be(()=>y.disable!==!0&&y.href!==void 0),D=be(h===!0?()=>A===!0&&y.disable!==!0&&s.value!==!0&&y.to!==void 0&&y.to!==null&&y.to!=="":()=>A===!0&&s.value!==!0&&y.to!==void 0&&y.to!==null&&y.to!==""),V=be(()=>D.value===!0?we(y.to):null),N=be(()=>V.value!==null),F=be(()=>s.value===!0||N.value===!0),q=be(()=>y.type==="a"||F.value===!0?"a":y.tag||r||"div"),H=be(()=>s.value===!0?{href:y.href,target:y.target}:N.value===!0?{href:V.value.href,target:y.target}:{}),de=be(()=>{if(N.value===!1)return-1;const{matched:Te}=V.value,{length:Pe}=Te,xe=Te[Pe-1];if(xe===void 0)return-1;const De=b.$route.matched;if(De.length===0)return-1;const Ke=De.findIndex(Qx.bind(null,xe));if(Ke>-1)return Ke;const Ue=Jx(Te[Pe-2]);return Pe>1&&Jx(xe)===Ue&&De[De.length-1].path!==Ue?De.findIndex(Qx.bind(null,Te[Pe-2])):Ke}),ye=be(()=>N.value===!0&&de.value!==-1&&ZC(b.$route.params,V.value.params)),ze=be(()=>ye.value===!0&&de.value===b.$route.matched.length-1&&HC(b.$route.params,V.value.params)),He=be(()=>N.value===!0?ze.value===!0?` ${y.exactActiveClass} ${y.activeClass}`:y.exact===!0?"":ye.value===!0?` ${y.activeClass}`:"":"");function we(Te){try{return b.$router.resolve(Te)}catch{}return null}function Le(Te,{returnRouterError:Pe,to:xe=y.to,replace:De=y.replace}={}){if(y.disable===!0)return Te.preventDefault(),Promise.resolve(!1);if(Te.metaKey||Te.altKey||Te.ctrlKey||Te.shiftKey||Te.button!==void 0&&Te.button!==0||y.target==="_blank")return Promise.resolve(!1);Te.preventDefault();const Ke=b.$router[De===!0?"replace":"push"](xe);return Pe===!0?Ke:Ke.then(()=>{}).catch(()=>{})}function Ne(Te){if(N.value===!0){const Pe=xe=>Le(Te,xe);E("click",Te,Pe),Te.defaultPrevented!==!0&&Pe()}else E("click",Te)}return{hasRouterLink:N,hasHrefLink:s,hasLink:F,linkTag:q,resolvedLink:V,linkIsActive:ye,linkIsExactActive:ze,linkClass:He,linkAttrs:H,getLink:we,navigateToRouterLink:Le,navigateOnClick:Ne}}const t0={none:0,xs:4,sm:8,md:16,lg:24,xl:32},XC={xs:8,sm:10,md:14,lg:20,xl:24},KC=["button","submit","reset"],YC=/[^\s]\/[^\s]/,JC={..._p,...sb,type:{type:String,default:"button"},label:[Number,String],icon:String,iconRight:String,round:Boolean,square:Boolean,outline:Boolean,flat:Boolean,unelevated:Boolean,rounded:Boolean,push:Boolean,glossy:Boolean,size:String,fab:Boolean,fabMini:Boolean,padding:String,color:String,textColor:String,noCaps:Boolean,noWrap:Boolean,dense:Boolean,tabindex:[Number,String],ripple:{type:[Boolean,Object],default:!0},align:{...$C.align,default:"center"},stack:Boolean,stretch:Boolean,loading:{type:Boolean,default:null},disable:Boolean};function QC(r){const h=gp(r,XC),p=GC(r),{hasRouterLink:y,hasLink:b,linkTag:E,linkAttrs:A,navigateOnClick:s}=ab({fallbackTag:"button"}),D=be(()=>{const ze=r.fab===!1&&r.fabMini===!1?h.value:{};return r.padding!==void 0?Object.assign({},ze,{padding:r.padding.split(/\s+/).map(He=>He in t0?t0[He]+"px":He).join(" "),minWidth:"0",minHeight:"0"}):ze}),V=be(()=>r.rounded===!0||r.fab===!0||r.fabMini===!0),N=be(()=>r.disable!==!0&&r.loading!==!0),F=be(()=>N.value===!0?r.tabindex||0:-1),q=be(()=>r.flat===!0?"flat":r.outline===!0?"outline":r.push===!0?"push":r.unelevated===!0?"unelevated":"standard"),H=be(()=>{const ze={tabindex:F.value};return b.value===!0?Object.assign(ze,A.value):KC.includes(r.type)===!0&&(ze.type=r.type),E.value==="a"?(r.disable===!0?ze["aria-disabled"]="true":ze.href===void 0&&(ze.role="button"),y.value!==!0&&YC.test(r.type)===!0&&(ze.type=r.type)):r.disable===!0&&(ze.disabled="",ze["aria-disabled"]="true"),r.loading===!0&&r.percentage!==void 0&&Object.assign(ze,{role:"progressbar","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":r.percentage}),ze}),de=be(()=>{let ze;r.color!==void 0?r.flat===!0||r.outline===!0?ze=`text-${r.textColor||r.color}`:ze=`bg-${r.color} text-${r.textColor||"white"}`:r.textColor&&(ze=`text-${r.textColor}`);const He=r.round===!0?"round":`rectangle${V.value===!0?" q-btn--rounded":r.square===!0?" q-btn--square":""}`;return`q-btn--${q.value} q-btn--${He}`+(ze!==void 0?" "+ze:"")+(N.value===!0?" q-btn--actionable q-focusable q-hoverable":r.disable===!0?" disabled":"")+(r.fab===!0?" q-btn--fab":r.fabMini===!0?" q-btn--fab-mini":"")+(r.noCaps===!0?" q-btn--no-uppercase":"")+(r.dense===!0?" q-btn--dense":"")+(r.stretch===!0?" no-border-radius self-stretch":"")+(r.glossy===!0?" glossy":"")+(r.square?" q-btn--square":"")}),ye=be(()=>p.value+(r.stack===!0?" column":" row")+(r.noWrap===!0?" no-wrap text-no-wrap":"")+(r.loading===!0?" q-btn__content--hidden":""));return{classes:de,style:D,innerClasses:ye,attributes:H,hasLink:b,linkTag:E,navigateOnClick:s,isActionable:N}}const{passiveCapture:Kr}=Bn;let mc=null,_c=null,gc=null;const Zo=$i({name:"QBtn",props:{...JC,percentage:Number,darkPercentage:Boolean,onTouchstart:[Function,Array]},emits:["click","keydown","mousedown","keyup"],setup(r,{slots:h,emit:p}){const{proxy:y}=Oi(),{classes:b,style:E,innerClasses:A,attributes:s,hasLink:D,linkTag:V,navigateOnClick:N,isActionable:F}=QC(r),q=Rt(null),H=Rt(null);let de=null,ye,ze;const He=be(()=>r.label!==void 0&&r.label!==null&&r.label!==""),we=be(()=>r.disable===!0||r.ripple===!1?!1:{keyCodes:D.value===!0?[13,32]:[13],...r.ripple===!0?{}:r.ripple}),Le=be(()=>({center:r.round})),Ne=be(()=>{const Ye=Math.max(0,Math.min(100,r.percentage));return Ye>0?{transition:"transform 0.6s",transform:`translateX(${Ye-100}%)`}:{}}),Te=be(()=>{if(r.loading===!0)return{onMousedown:Ge,onTouchstart:Ge,onClick:Ge,onKeydown:Ge,onKeyup:Ge};if(F.value===!0){const Ye={onClick:xe,onKeydown:De,onMousedown:Ue};if(y.$q.platform.has.touch===!0){const Ot=r.onTouchstart!==void 0?"":"Passive";Ye[`onTouchstart${Ot}`]=Ke}return Ye}return{onClick:xn}}),Pe=be(()=>({ref:q,class:"q-btn q-btn-item non-selectable no-outline "+b.value,style:E.value,...s.value,...Te.value}));function xe(Ye){if(q.value!==null){if(Ye!==void 0){if(Ye.defaultPrevented===!0)return;const Ot=document.activeElement;if(r.type==="submit"&&Ot!==document.body&&q.value.contains(Ot)===!1&&Ot.contains(q.value)===!1){q.value.focus();const Ht=()=>{document.removeEventListener("keydown",xn,!0),document.removeEventListener("keyup",Ht,Kr),q.value!==null&&q.value.removeEventListener("blur",Ht,Kr)};document.addEventListener("keydown",xn,!0),document.addEventListener("keyup",Ht,Kr),q.value.addEventListener("blur",Ht,Kr)}}N(Ye)}}function De(Ye){q.value!==null&&(p("keydown",Ye),la(Ye,[13,32])===!0&&_c!==q.value&&(_c!==null&&$e(),Ye.defaultPrevented!==!0&&(q.value.focus(),_c=q.value,q.value.classList.add("q-btn--active"),document.addEventListener("keyup",nt,!0),q.value.addEventListener("blur",nt,Kr)),xn(Ye)))}function Ke(Ye){q.value!==null&&(p("touchstart",Ye),Ye.defaultPrevented!==!0&&(mc!==q.value&&(mc!==null&&$e(),mc=q.value,de=Ye.target,de.addEventListener("touchcancel",nt,Kr),de.addEventListener("touchend",nt,Kr)),ye=!0,clearTimeout(ze),ze=setTimeout(()=>{ye=!1},200)))}function Ue(Ye){q.value!==null&&(Ye.qSkipRipple=ye===!0,p("mousedown",Ye),Ye.defaultPrevented!==!0&&gc!==q.value&&(gc!==null&&$e(),gc=q.value,q.value.classList.add("q-btn--active"),document.addEventListener("mouseup",nt,Kr)))}function nt(Ye){if(q.value!==null&&!(Ye!==void 0&&Ye.type==="blur"&&document.activeElement===q.value)){if(Ye!==void 0&&Ye.type==="keyup"){if(_c===q.value&&la(Ye,[13,32])===!0){const Ot=new MouseEvent("click",Ye);Ot.qKeyEvent=!0,Ye.defaultPrevented===!0&&Nr(Ot),Ye.cancelBubble===!0&&$o(Ot),q.value.dispatchEvent(Ot),xn(Ye),Ye.qKeyEvent=!0}p("keyup",Ye)}$e()}}function $e(Ye){const Ot=H.value;Ye!==!0&&(mc===q.value||gc===q.value)&&Ot!==null&&Ot!==document.activeElement&&(Ot.setAttribute("tabindex",-1),Ot.focus()),mc===q.value&&(de!==null&&(de.removeEventListener("touchcancel",nt,Kr),de.removeEventListener("touchend",nt,Kr)),mc=de=null),gc===q.value&&(document.removeEventListener("mouseup",nt,Kr),gc=null),_c===q.value&&(document.removeEventListener("keyup",nt,!0),q.value!==null&&q.value.removeEventListener("blur",nt,Kr),_c=null),q.value!==null&&q.value.classList.remove("q-btn--active")}function Ge(Ye){xn(Ye),Ye.qSkipRipple=!0}return _n(()=>{$e(!0)}),Object.assign(y,{click:xe}),()=>{let Ye=[];r.icon!==void 0&&Ye.push(Ie(jn,{name:r.icon,left:r.stack===!1&&He.value===!0,role:"img","aria-hidden":"true"})),He.value===!0&&Ye.push(Ie("span",{class:"block"},[r.label])),Ye=Jr(h.default,Ye),r.iconRight!==void 0&&r.round===!1&&Ye.push(Ie(jn,{name:r.iconRight,right:r.stack===!1&&He.value===!0,role:"img","aria-hidden":"true"}));const Ot=[Ie("span",{class:"q-focus-helper",ref:H})];return r.loading===!0&&r.percentage!==void 0&&Ot.push(Ie("span",{class:"q-btn__progress absolute-full overflow-hidden"+(r.darkPercentage===!0?" q-btn__progress--dark":"")},[Ie("span",{class:"q-btn__progress-indicator fit block",style:Ne.value})])),Ot.push(Ie("span",{class:"q-btn__content text-center col items-center q-anchor--skip "+A.value},Ye)),r.loading!==null&&Ot.push(Ie(vs,{name:"q-transition--fade"},()=>r.loading===!0?[Ie("span",{key:"loading",class:"absolute-full flex flex-center"},h.loading!==void 0?h.loading():[Ie(dg)])]:null)),ng(Ie(V.value,Pe.value,Ot),[[rb,we.value,void 0,Le.value]])}}}),eA=["top","right","bottom","left"],lb={type:{type:String,default:"a"},outline:Boolean,push:Boolean,flat:Boolean,unelevated:Boolean,color:String,textColor:String,glossy:Boolean,square:Boolean,padding:String,label:{type:[String,Number],default:""},labelPosition:{type:String,default:"right",validator:r=>eA.includes(r)},externalLabel:Boolean,hideLabel:{type:Boolean},labelClass:[Array,String,Object],labelStyle:[Array,String,Object],disable:Boolean,tabindex:[Number,String]};function cb(r,h){return{formClass:be(()=>`q-fab--form-${r.square===!0?"square":"rounded"}`),stacked:be(()=>r.externalLabel===!1&&["top","bottom"].includes(r.labelPosition)),labelProps:be(()=>{if(r.externalLabel===!0){const p=r.hideLabel===null?h.value===!1:r.hideLabel;return{action:"push",data:{class:[r.labelClass,`q-fab__label q-tooltip--style q-fab__label--external q-fab__label--external-${r.labelPosition}`+(p===!0?" q-fab__label--external-hidden":"")],style:r.labelStyle}}}return{action:["left","top"].includes(r.labelPosition)?"unshift":"push",data:{class:[r.labelClass,`q-fab__label q-fab__label--internal q-fab__label--internal-${r.labelPosition}`+(r.hideLabel===!0?" q-fab__label--internal-hidden":"")],style:r.labelStyle}}})}}const ub={start:"self-end",center:"self-center",end:"self-start"},tA=Object.keys(ub),yc=$i({name:"QFabAction",props:{...lb,icon:{type:String,default:""},anchor:{type:String,validator:r=>tA.includes(r)},to:[String,Object],replace:Boolean},emits:["click"],setup(r,{slots:h,emit:p}){const y=bo($1,()=>({showing:{value:!0},onChildClick:Wo})),{formClass:b,labelProps:E}=cb(r,y.showing),A=be(()=>{const F=ub[r.anchor];return b.value+(F!==void 0?` ${F}`:"")}),s=be(()=>r.disable===!0||y.showing.value!==!0);function D(F){y.onChildClick(F),p("click",F)}function V(){const F=[];return h.icon!==void 0?F.push(h.icon()):r.icon!==""&&F.push(Ie(jn,{name:r.icon})),(r.label!==""||h.label!==void 0)&&F[E.value.action](Ie("div",E.value.data,h.label!==void 0?h.label():[r.label])),Jr(h.default,F)}const N=Oi();return Object.assign(N.proxy,{click:D}),()=>Ie(Zo,{class:A.value,...r,noWrap:!0,stack:r.stacked,icon:void 0,label:void 0,noCaps:!0,fabMini:!0,disable:s.value,onClick:D},V)}}),_g={modelValue:{type:Boolean,default:null},"onUpdate:modelValue":[Function,Array]},gg=["before-show","show","before-hide","hide"];function yg({showing:r,canShow:h,hideOnRouteChange:p,handleShow:y,handleHide:b,processOnMount:E}){const A=Oi(),{props:s,emit:D,proxy:V}=A;let N;function F(we){r.value===!0?de(we):q(we)}function q(we){if(s.disable===!0||we!==void 0&&we.qAnchorHandled===!0||h!==void 0&&h(we)!==!0)return;const Le=s["onUpdate:modelValue"]!==void 0;Le===!0&&(D("update:modelValue",!0),N=we,fn(()=>{N===we&&(N=void 0)})),(s.modelValue===null||Le===!1)&&H(we)}function H(we){r.value!==!0&&(r.value=!0,D("before-show",we),y!==void 0?y(we):D("show",we))}function de(we){if(s.disable===!0)return;const Le=s["onUpdate:modelValue"]!==void 0;Le===!0&&(D("update:modelValue",!1),N=we,fn(()=>{N===we&&(N=void 0)})),(s.modelValue===null||Le===!1)&&ye(we)}function ye(we){r.value!==!1&&(r.value=!1,D("before-hide",we),b!==void 0?b(we):D("hide",we))}function ze(we){s.disable===!0&&we===!0?s["onUpdate:modelValue"]!==void 0&&D("update:modelValue",!1):we===!0!==r.value&&(we===!0?H:ye)(N)}ri(()=>s.modelValue,ze),p!==void 0&&pg(A)===!0&&ri(()=>V.$route.fullPath,()=>{p.value===!0&&r.value===!0&&de()}),E===!0&&sr(()=>{ze(s.modelValue)});const He={show:q,hide:de,toggle:F};return Object.assign(V,He),He}let r_,Ef=0;const tr=new Array(256);for(let r=0;r<256;r++)tr[r]=(r+256).toString(16).substring(1);const iA=(()=>{const r=typeof crypto<"u"?crypto:typeof window<"u"?window.crypto||window.msCrypto:void 0;if(r!==void 0){if(r.randomBytes!==void 0)return r.randomBytes;if(r.getRandomValues!==void 0)return h=>{const p=new Uint8Array(h);return r.getRandomValues(p),p}}return h=>{const p=[];for(let y=h;y>0;y--)p.push(Math.floor(Math.random()*256));return p}})(),i0=4096;function hb(){(r_===void 0||Ef+16>i0)&&(Ef=0,r_=iA(i0));const r=Array.prototype.slice.call(r_,Ef,Ef+=16);return r[6]=r[6]&15|64,r[8]=r[8]&63|128,tr[r[0]]+tr[r[1]]+tr[r[2]]+tr[r[3]]+"-"+tr[r[4]]+tr[r[5]]+"-"+tr[r[6]]+tr[r[7]]+"-"+tr[r[8]]+tr[r[9]]+"-"+tr[r[10]]+tr[r[11]]+tr[r[12]]+tr[r[13]]+tr[r[14]]+tr[r[15]]}const nA=["up","right","down","left"],rA=["left","center","right"],oA=$i({name:"QFab",props:{...lb,..._g,icon:String,activeIcon:String,hideIcon:Boolean,hideLabel:{default:null},direction:{type:String,default:"right",validator:r=>nA.includes(r)},persistent:Boolean,verticalActionsAlign:{type:String,default:"center",validator:r=>rA.includes(r)}},emits:gg,setup(r,{slots:h}){const p=Rt(null),y=Rt(r.modelValue===!0),b=hb(),{proxy:{$q:E}}=Oi(),{formClass:A,labelProps:s}=cb(r,y),D=be(()=>r.persistent!==!0),{hide:V,toggle:N}=yg({showing:y,hideOnRouteChange:D}),F=be(()=>({opened:y.value})),q=be(()=>`q-fab z-fab row inline justify-center q-fab--align-${r.verticalActionsAlign} ${A.value}`+(y.value===!0?" q-fab--opened":" q-fab--closed")),H=be(()=>`q-fab__actions flex no-wrap inline q-fab__actions--${r.direction} q-fab__actions--${y.value===!0?"opened":"closed"}`),de=be(()=>{const we={id:b};return y.value===!0?we.role="menu":we["aria-hidden"]="true",we}),ye=be(()=>`q-fab__icon-holder  q-fab__icon-holder--${y.value===!0?"opened":"closed"}`);function ze(we,Le){const Ne=h[we],Te=`q-fab__${we} absolute-full`;return Ne===void 0?Ie(jn,{class:Te,name:r[Le]||E.iconSet.fab[Le]}):Ie("div",{class:Te},Ne(F.value))}function He(){const we=[];return r.hideIcon!==!0&&we.push(Ie("div",{class:ye.value},[ze("icon","icon"),ze("active-icon","activeIcon")])),(r.label!==""||h.label!==void 0)&&we[s.value.action](Ie("div",s.value.data,h.label!==void 0?h.label(F.value):[r.label])),Jr(h.tooltip,we)}return Lc($1,{showing:y,onChildClick(we){V(we),p.value!==null&&p.value.$el.focus()}}),()=>Ie("div",{class:q.value},[Ie(Zo,{ref:p,class:A.value,...r,noWrap:!0,stack:r.stacked,align:void 0,icon:void 0,label:void 0,noCaps:!0,fab:!0,"aria-expanded":y.value===!0?"true":"false","aria-haspopup":"true","aria-controls":b,"aria-owns":b,onClick:N},He),Ie("div",{class:H.value,...de.value},bn(h.default))])}}),sA={__name:"ButtonDesplegable",emits:["handleTabSelected"],setup(r,{emit:h}){return(p,y)=>(nr(),ps(oA,{"vertical-actions-align":"left","label-position":"bottom",glossy:"",color:"black",padding:"5px",icon:"menu",direction:"down","text-color":"white","label-style":{color:"white",width:"75px"}},{default:cn(()=>[Ft(yc,{onClick:y[0]||(y[0]=b=>p.$emit("handleTabSelected","Inicio")),color:"warning",icon:"favorite",label:"Inicio","label-style":{color:"white",width:"60px",fontSize:"80%",padding:0},padding:"5px"}),Ft(yc,{onClick:y[1]||(y[1]=b=>p.$emit("handleTabSelected","Lugar")),color:"accent",icon:"room",label:"Lugar","label-style":{color:"white",width:"60px",fontSize:"80%",padding:0},padding:"5px"}),Ft(yc,{onClick:y[2]||(y[2]=b=>p.$emit("handleTabSelected","Asistencia")),color:"warning",icon:"group_add",label:"Asistencia","label-style":{color:"white",width:"60px",fontSize:"80%",padding:0},padding:"5px"}),Ft(yc,{onClick:y[3]||(y[3]=b=>p.$emit("handleTabSelected","Itinerario")),color:"accent",icon:"alarm",label:"Itinerario","label-style":{color:"white",width:"60px",fontSize:"80%",padding:0},padding:"5px"}),Ft(yc,{onClick:y[4]||(y[4]=b=>p.$emit("handleTabSelected","Regalos")),color:"warning",icon:"card_giftcard",label:"Regalos","label-style":{color:"white",width:"60px",fontSize:"80%",padding:0},padding:"5px"}),Ft(yc,{onClick:y[5]||(y[5]=b=>p.$emit("handleTabSelected","M\xFAsica")),color:"accent",icon:"music_note",label:"M\xFAsica","label-style":{color:"white",width:"60px",fontSize:"80%",padding:0},padding:"5px"})]),_:1}))}},aA="/assets/manos.293ea533.jpg",ua={dark:{type:Boolean,default:null}};function ha(r,h){return be(()=>r.dark===null?h.dark.isActive:r.dark)}function lA({validate:r,resetValidation:h,requiresQForm:p}){const y=bo(G1,!1);if(y!==!1){const{props:b,proxy:E}=Oi();Object.assign(E,{validate:r,resetValidation:h}),ri(()=>b.disable,A=>{A===!0?(typeof h=="function"&&h(),y.unbindComponent(E)):y.bindComponent(E)}),sr(()=>{b.disable!==!0&&y.bindComponent(E)}),_n(()=>{b.disable!==!0&&y.unbindComponent(E)})}else p===!0&&console.error("Parent QForm not found on useFormChild()!")}const n0=/^#[0-9a-fA-F]{3}([0-9a-fA-F]{3})?$/,r0=/^#[0-9a-fA-F]{4}([0-9a-fA-F]{4})?$/,o0=/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{4}|[0-9a-fA-F]{6}|[0-9a-fA-F]{8})$/,Sf=/^rgb\(((0|[1-9][\d]?|1[\d]{0,2}|2[\d]?|2[0-4][\d]|25[0-5]),){2}(0|[1-9][\d]?|1[\d]{0,2}|2[\d]?|2[0-4][\d]|25[0-5])\)$/,Cf=/^rgba\(((0|[1-9][\d]?|1[\d]{0,2}|2[\d]?|2[0-4][\d]|25[0-5]),){2}(0|[1-9][\d]?|1[\d]{0,2}|2[\d]?|2[0-4][\d]|25[0-5]),(0|0\.[0-9]+[1-9]|0\.[1-9]+|1)\)$/,o_={date:r=>/^-?[\d]+\/[0-1]\d\/[0-3]\d$/.test(r),time:r=>/^([0-1]?\d|2[0-3]):[0-5]\d$/.test(r),fulltime:r=>/^([0-1]?\d|2[0-3]):[0-5]\d:[0-5]\d$/.test(r),timeOrFulltime:r=>/^([0-1]?\d|2[0-3]):[0-5]\d(:[0-5]\d)?$/.test(r),email:r=>/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(r),hexColor:r=>n0.test(r),hexaColor:r=>r0.test(r),hexOrHexaColor:r=>o0.test(r),rgbColor:r=>Sf.test(r),rgbaColor:r=>Cf.test(r),rgbOrRgbaColor:r=>Sf.test(r)||Cf.test(r),hexOrRgbColor:r=>n0.test(r)||Sf.test(r),hexaOrRgbaColor:r=>r0.test(r)||Cf.test(r),anyColor:r=>o0.test(r)||Sf.test(r)||Cf.test(r)},cA=[!0,!1,"ondemand"],uA={modelValue:{},error:{type:Boolean,default:null},errorMessage:String,noErrorIcon:Boolean,rules:Array,reactiveRules:Boolean,lazyRules:{type:[Boolean,String],validator:r=>cA.includes(r)}};function hA(r,h){const{props:p,proxy:y}=Oi(),b=Rt(!1),E=Rt(null),A=Rt(null);lA({validate:de,resetValidation:H});let s=0,D;const V=be(()=>p.rules!==void 0&&p.rules!==null&&p.rules.length>0),N=be(()=>p.disable!==!0&&V.value===!0),F=be(()=>p.error===!0||b.value===!0),q=be(()=>typeof p.errorMessage=="string"&&p.errorMessage.length>0?p.errorMessage:E.value);ri(()=>p.modelValue,()=>{ye()}),ri(()=>p.reactiveRules,He=>{He===!0?D===void 0&&(D=ri(()=>p.rules,()=>{ye(!0)})):D!==void 0&&(D(),D=void 0)},{immediate:!0}),ri(r,He=>{He===!0?A.value===null&&(A.value=!1):A.value===!1&&(A.value=!0,N.value===!0&&p.lazyRules!=="ondemand"&&h.value===!1&&ze())});function H(){s++,h.value=!1,A.value=null,b.value=!1,E.value=null,ze.cancel()}function de(He=p.modelValue){if(N.value!==!0)return!0;const we=++s,Le=h.value!==!0?()=>{A.value=!0}:()=>{},Ne=(Pe,xe)=>{Pe===!0&&Le(),b.value=Pe,E.value=xe||null,h.value=!1},Te=[];for(let Pe=0;Pe<p.rules.length;Pe++){const xe=p.rules[Pe];let De;if(typeof xe=="function"?De=xe(He,o_):typeof xe=="string"&&o_[xe]!==void 0&&(De=o_[xe](He)),De===!1||typeof De=="string")return Ne(!0,De),!1;De!==!0&&De!==void 0&&Te.push(De)}return Te.length===0?(Ne(!1),!0):(h.value=!0,Promise.all(Te).then(Pe=>{if(Pe===void 0||Array.isArray(Pe)===!1||Pe.length===0)return we===s&&Ne(!1),!0;const xe=Pe.find(De=>De===!1||typeof De=="string");return we===s&&Ne(xe!==void 0,xe),xe===void 0},Pe=>(we===s&&(console.error(Pe),Ne(!0)),!1)))}function ye(He){N.value===!0&&p.lazyRules!=="ondemand"&&(A.value===!0||p.lazyRules!==!0&&He!==!0)&&ze()}const ze=cg(de,0);return _n(()=>{D!==void 0&&D(),ze.cancel()}),Object.assign(y,{resetValidation:H,validate:de}),fp(y,"hasError",()=>F.value),{isDirtyModel:A,hasRules:V,hasError:F,errorMessage:q,validate:de,resetValidation:H}}const s0=/^on[A-Z]/;function dA(r,h){const p={listeners:Rt({}),attributes:Rt({})};function y(){const b={},E={};for(const A in r)A!=="class"&&A!=="style"&&s0.test(A)===!1&&(b[A]=r[A]);for(const A in h.props)s0.test(A)===!0&&(E[A]=h.props[A]);p.attributes.value=b,p.listeners.value=E}return tg(y),y(),p}let ul=[],Lh=[];function db(r){Lh=Lh.filter(h=>h!==r)}function fA(r){db(r),Lh.push(r)}function a0(r){db(r),Lh.length===0&&ul.length>0&&(ul[ul.length-1](),ul=[])}function Oh(r){Lh.length===0?r():ul.push(r)}function pA(r){ul=ul.filter(h=>h!==r)}function k_(r){return r===void 0?`f_${hb()}`:r}function Bh(r){return r!=null&&(""+r).length>0}const yp={...ua,...uA,label:String,stackLabel:Boolean,hint:String,hideHint:Boolean,prefix:String,suffix:String,labelColor:String,color:String,bgColor:String,filled:Boolean,outlined:Boolean,borderless:Boolean,standout:[Boolean,String],square:Boolean,loading:Boolean,labelSlot:Boolean,bottomSlots:Boolean,hideBottomSpace:Boolean,rounded:Boolean,dense:Boolean,itemAligned:Boolean,counter:Boolean,clearable:Boolean,clearIcon:String,disable:Boolean,readonly:Boolean,autofocus:Boolean,for:String,maxlength:[Number,String]},vg=["update:modelValue","clear","focus","blur","popup-show","popup-hide"];function xg(){const{props:r,attrs:h,proxy:p,vnode:y}=Oi();return{isDark:ha(r,p.$q),editable:be(()=>r.disable!==!0&&r.readonly!==!0),innerLoading:Rt(!1),focused:Rt(!1),hasPopupOpen:!1,splitAttrs:dA(h,y),targetUid:Rt(k_(r.for)),rootRef:Rt(null),targetRef:Rt(null),controlRef:Rt(null)}}function bg(r){const{props:h,emit:p,slots:y,attrs:b,proxy:E}=Oi(),{$q:A}=E;let s;r.hasValue===void 0&&(r.hasValue=be(()=>Bh(h.modelValue))),r.emitValue===void 0&&(r.emitValue=ot=>{p("update:modelValue",ot)}),r.controlEvents===void 0&&(r.controlEvents={onFocusin:Ke,onFocusout:Ue}),Object.assign(r,{clearValue:nt,onControlFocusin:Ke,onControlFocusout:Ue,focus:xe}),r.computedCounter===void 0&&(r.computedCounter=be(()=>{if(h.counter!==!1){const ot=typeof h.modelValue=="string"||typeof h.modelValue=="number"?(""+h.modelValue).length:Array.isArray(h.modelValue)===!0?h.modelValue.length:0,At=h.maxlength!==void 0?h.maxlength:h.maxValues;return ot+(At!==void 0?" / "+At:"")}}));const{isDirtyModel:D,hasRules:V,hasError:N,errorMessage:F,resetValidation:q}=hA(r.focused,r.innerLoading),H=r.floatingLabel!==void 0?be(()=>h.stackLabel===!0||r.focused.value===!0||r.floatingLabel.value===!0):be(()=>h.stackLabel===!0||r.focused.value===!0||r.hasValue.value===!0),de=be(()=>h.bottomSlots===!0||h.hint!==void 0||V.value===!0||h.counter===!0||h.error!==null),ye=be(()=>h.filled===!0?"filled":h.outlined===!0?"outlined":h.borderless===!0?"borderless":h.standout?"standout":"standard"),ze=be(()=>`q-field row no-wrap items-start q-field--${ye.value}`+(r.fieldClass!==void 0?` ${r.fieldClass.value}`:"")+(h.rounded===!0?" q-field--rounded":"")+(h.square===!0?" q-field--square":"")+(H.value===!0?" q-field--float":"")+(we.value===!0?" q-field--labeled":"")+(h.dense===!0?" q-field--dense":"")+(h.itemAligned===!0?" q-field--item-aligned q-item-type":"")+(r.isDark.value===!0?" q-field--dark":"")+(r.getControl===void 0?" q-field--auto-height":"")+(r.focused.value===!0?" q-field--focused":"")+(N.value===!0?" q-field--error":"")+(N.value===!0||r.focused.value===!0?" q-field--highlighted":"")+(h.hideBottomSpace!==!0&&de.value===!0?" q-field--with-bottom":"")+(h.disable===!0?" q-field--disabled":h.readonly===!0?" q-field--readonly":"")),He=be(()=>"q-field__control relative-position row no-wrap"+(h.bgColor!==void 0?` bg-${h.bgColor}`:"")+(N.value===!0?" text-negative":typeof h.standout=="string"&&h.standout.length>0&&r.focused.value===!0?` ${h.standout}`:h.color!==void 0?` text-${h.color}`:"")),we=be(()=>h.labelSlot===!0||h.label!==void 0),Le=be(()=>"q-field__label no-pointer-events absolute ellipsis"+(h.labelColor!==void 0&&N.value!==!0?` text-${h.labelColor}`:"")),Ne=be(()=>({id:r.targetUid.value,editable:r.editable.value,focused:r.focused.value,floatingLabel:H.value,modelValue:h.modelValue,emitValue:r.emitValue})),Te=be(()=>{const ot={for:r.targetUid.value};return h.disable===!0?ot["aria-disabled"]="true":h.readonly===!0&&(ot["aria-readonly"]="true"),ot});ri(()=>h.for,ot=>{r.targetUid.value=k_(ot)});function Pe(){const ot=document.activeElement;let At=r.targetRef!==void 0&&r.targetRef.value;At&&(ot===null||ot.id!==r.targetUid.value)&&(At.hasAttribute("tabindex")===!0||(At=At.querySelector("[tabindex]")),At&&At!==ot&&At.focus({preventScroll:!0}))}function xe(){Oh(Pe)}function De(){pA(Pe);const ot=document.activeElement;ot!==null&&r.rootRef.value.contains(ot)&&ot.blur()}function Ke(ot){clearTimeout(s),r.editable.value===!0&&r.focused.value===!1&&(r.focused.value=!0,p("focus",ot))}function Ue(ot,At){clearTimeout(s),s=setTimeout(()=>{document.hasFocus()===!0&&(r.hasPopupOpen===!0||r.controlRef===void 0||r.controlRef.value===null||r.controlRef.value.contains(document.activeElement)!==!1)||(r.focused.value===!0&&(r.focused.value=!1,p("blur",ot)),At!==void 0&&At())})}function nt(ot){xn(ot),A.platform.is.mobile!==!0?(r.targetRef!==void 0&&r.targetRef.value||r.rootRef.value).focus():r.rootRef.value.contains(document.activeElement)===!0&&document.activeElement.blur(),h.type==="file"&&(r.inputRef.value.value=null),p("update:modelValue",null),p("clear",h.modelValue),fn(()=>{q(),A.platform.is.mobile!==!0&&(D.value=!1)})}function $e(){const ot=[];return y.prepend!==void 0&&ot.push(Ie("div",{class:"q-field__prepend q-field__marginal row no-wrap items-center",key:"prepend",onClick:Nr},y.prepend())),ot.push(Ie("div",{class:"q-field__control-container col relative-position row no-wrap q-anchor--skip"},Ge())),N.value===!0&&h.noErrorIcon===!1&&ot.push(Ot("error",[Ie(jn,{name:A.iconSet.field.error,color:"negative"})])),h.loading===!0||r.innerLoading.value===!0?ot.push(Ot("inner-loading-append",y.loading!==void 0?y.loading():[Ie(dg,{color:h.color})])):h.clearable===!0&&r.hasValue.value===!0&&r.editable.value===!0&&ot.push(Ot("inner-clearable-append",[Ie(jn,{class:"q-field__focusable-action",tag:"button",name:h.clearIcon||A.iconSet.field.clear,tabindex:0,type:"button","aria-hidden":null,role:null,onClick:nt})])),y.append!==void 0&&ot.push(Ie("div",{class:"q-field__append q-field__marginal row no-wrap items-center",key:"append",onClick:Nr},y.append())),r.getInnerAppend!==void 0&&ot.push(Ot("inner-append",r.getInnerAppend())),r.getControlChild!==void 0&&ot.push(r.getControlChild()),ot}function Ge(){const ot=[];return h.prefix!==void 0&&h.prefix!==null&&ot.push(Ie("div",{class:"q-field__prefix no-pointer-events row items-center"},h.prefix)),r.getShadowControl!==void 0&&r.hasShadow.value===!0&&ot.push(r.getShadowControl()),r.getControl!==void 0?ot.push(r.getControl()):y.rawControl!==void 0?ot.push(y.rawControl()):y.control!==void 0&&ot.push(Ie("div",{ref:r.targetRef,class:"q-field__native row",tabindex:-1,...r.splitAttrs.attributes.value,"data-autofocus":h.autofocus===!0||void 0},y.control(Ne.value))),we.value===!0&&ot.push(Ie("div",{class:Le.value},bn(y.label,h.label))),h.suffix!==void 0&&h.suffix!==null&&ot.push(Ie("div",{class:"q-field__suffix no-pointer-events row items-center"},h.suffix)),ot.concat(bn(y.default))}function Ye(){let ot,At;N.value===!0?F.value!==null?(ot=[Ie("div",{role:"alert"},F.value)],At=`q--slot-error-${F.value}`):(ot=bn(y.error),At="q--slot-error"):(h.hideHint!==!0||r.focused.value===!0)&&(h.hint!==void 0?(ot=[Ie("div",h.hint)],At=`q--slot-hint-${h.hint}`):(ot=bn(y.hint),At="q--slot-hint"));const di=h.counter===!0||y.counter!==void 0;if(h.hideBottomSpace===!0&&di===!1&&ot===void 0)return;const Oe=Ie("div",{key:At,class:"q-field__messages col"},ot);return Ie("div",{class:"q-field__bottom row items-start q-field__bottom--"+(h.hideBottomSpace!==!0?"animated":"stale"),onClick:Nr},[h.hideBottomSpace===!0?Oe:Ie(vs,{name:"q-transition--field-message"},()=>Oe),di===!0?Ie("div",{class:"q-field__counter"},y.counter!==void 0?y.counter():r.computedCounter.value):null])}function Ot(ot,At){return At===null?null:Ie("div",{key:ot,class:"q-field__append q-field__marginal row no-wrap items-center q-anchor--skip"},At)}let Ht=!1;return Bc(()=>{Ht=!0}),lp(()=>{Ht===!0&&h.autofocus===!0&&E.focus()}),sr(()=>{To.value===!0&&h.for===void 0&&(r.targetUid.value=k_()),h.autofocus===!0&&E.focus()}),_n(()=>{clearTimeout(s)}),Object.assign(E,{focus:xe,blur:De}),function(){const At=r.getControl===void 0&&y.control===void 0?{...r.splitAttrs.attributes.value,"data-autofocus":h.autofocus===!0||void 0,...Te.value}:Te.value;return Ie("label",{ref:r.rootRef,class:[ze.value,b.class],style:b.style,...At},[y.before!==void 0?Ie("div",{class:"q-field__before q-field__marginal row no-wrap items-center",onClick:Nr},y.before()):null,Ie("div",{class:"q-field__inner relative-position col self-stretch"},[Ie("div",{ref:r.controlRef,class:He.value,tabindex:-1,...r.controlEvents},$e()),de.value===!0?Ye():null]),y.after!==void 0?Ie("div",{class:"q-field__after q-field__marginal row no-wrap items-center",onClick:Nr},y.after()):null])}}const l0={date:"####/##/##",datetime:"####/##/## ##:##",time:"##:##",fulltime:"##:##:##",phone:"(###) ### - ####",card:"#### #### #### ####"},Xf={"#":{pattern:"[\\d]",negate:"[^\\d]"},S:{pattern:"[a-zA-Z]",negate:"[^a-zA-Z]"},N:{pattern:"[0-9a-zA-Z]",negate:"[^0-9a-zA-Z]"},A:{pattern:"[a-zA-Z]",negate:"[^a-zA-Z]",transform:r=>r.toLocaleUpperCase()},a:{pattern:"[a-zA-Z]",negate:"[^a-zA-Z]",transform:r=>r.toLocaleLowerCase()},X:{pattern:"[0-9a-zA-Z]",negate:"[^0-9a-zA-Z]",transform:r=>r.toLocaleUpperCase()},x:{pattern:"[0-9a-zA-Z]",negate:"[^0-9a-zA-Z]",transform:r=>r.toLocaleLowerCase()}},fb=Object.keys(Xf);fb.forEach(r=>{Xf[r].regex=new RegExp(Xf[r].pattern)});const mA=new RegExp("\\\\([^.*+?^${}()|([\\]])|([.*+?^${}()|[\\]])|(["+fb.join("")+"])|(.)","g"),c0=/[.*+?^${}()|[\]\\]/g,Nn=String.fromCharCode(1),_A={mask:String,reverseFillMask:Boolean,fillMask:[Boolean,String],unmaskedValue:Boolean};function gA(r,h,p,y){let b,E,A,s;const D=Rt(null),V=Rt(F());function N(){return r.autogrow===!0||["textarea","text","search","url","tel","password"].includes(r.type)}ri(()=>r.type+r.autogrow,H),ri(()=>r.mask,Pe=>{if(Pe!==void 0)de(V.value,!0);else{const xe=Ne(V.value);H(),r.modelValue!==xe&&h("update:modelValue",xe)}}),ri(()=>r.fillMask+r.reverseFillMask,()=>{D.value===!0&&de(V.value,!0)}),ri(()=>r.unmaskedValue,()=>{D.value===!0&&de(V.value)});function F(){if(H(),D.value===!0){const Pe=we(Ne(r.modelValue));return r.fillMask!==!1?Te(Pe):Pe}return r.modelValue}function q(Pe){if(Pe<b.length)return b.slice(-Pe);let xe="",De=b;const Ke=De.indexOf(Nn);if(Ke>-1){for(let Ue=Pe-De.length;Ue>0;Ue--)xe+=Nn;De=De.slice(0,Ke)+xe+De.slice(Ke)}return De}function H(){if(D.value=r.mask!==void 0&&r.mask.length>0&&N(),D.value===!1){s=void 0,b="",E="";return}const Pe=l0[r.mask]===void 0?r.mask:l0[r.mask],xe=typeof r.fillMask=="string"&&r.fillMask.length>0?r.fillMask.slice(0,1):"_",De=xe.replace(c0,"\\$&"),Ke=[],Ue=[],nt=[];let $e=r.reverseFillMask===!0,Ge="",Ye="";Pe.replace(mA,(At,di,Oe,_t,xt)=>{if(_t!==void 0){const Lt=Xf[_t];nt.push(Lt),Ye=Lt.negate,$e===!0&&(Ue.push("(?:"+Ye+"+)?("+Lt.pattern+"+)?(?:"+Ye+"+)?("+Lt.pattern+"+)?"),$e=!1),Ue.push("(?:"+Ye+"+)?("+Lt.pattern+")?")}else if(Oe!==void 0)Ge="\\"+(Oe==="\\"?"":Oe),nt.push(Oe),Ke.push("([^"+Ge+"]+)?"+Ge+"?");else{const Lt=di!==void 0?di:xt;Ge=Lt==="\\"?"\\\\\\\\":Lt.replace(c0,"\\\\$&"),nt.push(Lt),Ke.push("([^"+Ge+"]+)?"+Ge+"?")}});const Ot=new RegExp("^"+Ke.join("")+"("+(Ge===""?".":"[^"+Ge+"]")+"+)?["+Ge+"]*$"),Ht=Ue.length-1,ot=Ue.map((At,di)=>di===0&&r.reverseFillMask===!0?new RegExp("^"+De+"*"+At):di===Ht?new RegExp("^"+At+"("+(Ye===""?".":Ye)+"+)?"+(r.reverseFillMask===!0?"$":De+"*")):new RegExp("^"+At));A=nt,s=At=>{const di=Ot.exec(At);di!==null&&(At=di.slice(1).join(""));const Oe=[],_t=ot.length;for(let xt=0,Lt=At;xt<_t;xt++){const pi=ot[xt].exec(Lt);if(pi===null)break;Lt=Lt.slice(pi.shift().length),Oe.push(...pi)}return Oe.length>0?Oe.join(""):At},b=nt.map(At=>typeof At=="string"?At:Nn).join(""),E=b.split(Nn).join(xe)}function de(Pe,xe,De){const Ke=y.value,Ue=Ke.selectionEnd,nt=Ke.value.length-Ue,$e=Ne(Pe);xe===!0&&H();const Ge=we($e),Ye=r.fillMask!==!1?Te(Ge):Ge,Ot=V.value!==Ye;Ke.value!==Ye&&(Ke.value=Ye),Ot===!0&&(V.value=Ye),document.activeElement===Ke&&fn(()=>{if(Ye===E){const ot=r.reverseFillMask===!0?E.length:0;Ke.setSelectionRange(ot,ot,"forward");return}if(De==="insertFromPaste"&&r.reverseFillMask!==!0){const ot=Ue-1;ze.right(Ke,ot,ot);return}if(["deleteContentBackward","deleteContentForward"].indexOf(De)>-1){const ot=r.reverseFillMask===!0?Ue===0?Ye.length>Ge.length?1:0:Math.max(0,Ye.length-(Ye===E?0:Math.min(Ge.length,nt)+1))+1:Ue;Ke.setSelectionRange(ot,ot,"forward");return}if(r.reverseFillMask===!0)if(Ot===!0){const ot=Math.max(0,Ye.length-(Ye===E?0:Math.min(Ge.length,nt+1)));ot===1&&Ue===1?Ke.setSelectionRange(ot,ot,"forward"):ze.rightReverse(Ke,ot,ot)}else{const ot=Ye.length-nt;Ke.setSelectionRange(ot,ot,"backward")}else if(Ot===!0){const ot=Math.max(0,b.indexOf(Nn),Math.min(Ge.length,Ue)-1);ze.right(Ke,ot,ot)}else{const ot=Ue-1;ze.right(Ke,ot,ot)}});const Ht=r.unmaskedValue===!0?Ne(Ye):Ye;String(r.modelValue)!==Ht&&p(Ht,!0)}function ye(Pe,xe,De){const Ke=we(Ne(Pe.value));xe=Math.max(0,b.indexOf(Nn),Math.min(Ke.length,xe)),Pe.setSelectionRange(xe,De,"forward")}const ze={left(Pe,xe,De,Ke){const Ue=b.slice(xe-1).indexOf(Nn)===-1;let nt=Math.max(0,xe-1);for(;nt>=0;nt--)if(b[nt]===Nn){xe=nt,Ue===!0&&xe++;break}if(nt<0&&b[xe]!==void 0&&b[xe]!==Nn)return ze.right(Pe,0,0);xe>=0&&Pe.setSelectionRange(xe,Ke===!0?De:xe,"backward")},right(Pe,xe,De,Ke){const Ue=Pe.value.length;let nt=Math.min(Ue,De+1);for(;nt<=Ue;nt++)if(b[nt]===Nn){De=nt;break}else b[nt-1]===Nn&&(De=nt);if(nt>Ue&&b[De-1]!==void 0&&b[De-1]!==Nn)return ze.left(Pe,Ue,Ue);Pe.setSelectionRange(Ke?xe:De,De,"forward")},leftReverse(Pe,xe,De,Ke){const Ue=q(Pe.value.length);let nt=Math.max(0,xe-1);for(;nt>=0;nt--)if(Ue[nt-1]===Nn){xe=nt;break}else if(Ue[nt]===Nn&&(xe=nt,nt===0))break;if(nt<0&&Ue[xe]!==void 0&&Ue[xe]!==Nn)return ze.rightReverse(Pe,0,0);xe>=0&&Pe.setSelectionRange(xe,Ke===!0?De:xe,"backward")},rightReverse(Pe,xe,De,Ke){const Ue=Pe.value.length,nt=q(Ue),$e=nt.slice(0,De+1).indexOf(Nn)===-1;let Ge=Math.min(Ue,De+1);for(;Ge<=Ue;Ge++)if(nt[Ge-1]===Nn){De=Ge,De>0&&$e===!0&&De--;break}if(Ge>Ue&&nt[De-1]!==void 0&&nt[De-1]!==Nn)return ze.leftReverse(Pe,Ue,Ue);Pe.setSelectionRange(Ke===!0?xe:De,De,"forward")}};function He(Pe){if(ug(Pe)===!0)return;const xe=y.value,De=xe.selectionStart,Ke=xe.selectionEnd;if(Pe.keyCode===37||Pe.keyCode===39){const Ue=ze[(Pe.keyCode===39?"right":"left")+(r.reverseFillMask===!0?"Reverse":"")];Pe.preventDefault(),Ue(xe,De,Ke,Pe.shiftKey)}else Pe.keyCode===8&&r.reverseFillMask!==!0&&De===Ke?ze.left(xe,De,Ke,!0):Pe.keyCode===46&&r.reverseFillMask===!0&&De===Ke&&ze.rightReverse(xe,De,Ke,!0)}function we(Pe){if(Pe==null||Pe==="")return"";if(r.reverseFillMask===!0)return Le(Pe);const xe=A;let De=0,Ke="";for(let Ue=0;Ue<xe.length;Ue++){const nt=Pe[De],$e=xe[Ue];if(typeof $e=="string")Ke+=$e,nt===$e&&De++;else if(nt!==void 0&&$e.regex.test(nt))Ke+=$e.transform!==void 0?$e.transform(nt):nt,De++;else return Ke}return Ke}function Le(Pe){const xe=A,De=b.indexOf(Nn);let Ke=Pe.length-1,Ue="";for(let nt=xe.length-1;nt>=0&&Ke>-1;nt--){const $e=xe[nt];let Ge=Pe[Ke];if(typeof $e=="string")Ue=$e+Ue,Ge===$e&&Ke--;else if(Ge!==void 0&&$e.regex.test(Ge))do Ue=($e.transform!==void 0?$e.transform(Ge):Ge)+Ue,Ke--,Ge=Pe[Ke];while(De===nt&&Ge!==void 0&&$e.regex.test(Ge));else return Ue}return Ue}function Ne(Pe){return typeof Pe!="string"||s===void 0?typeof Pe=="number"?s(""+Pe):Pe:s(Pe)}function Te(Pe){return E.length-Pe.length<=0?Pe:r.reverseFillMask===!0&&Pe.length>0?E.slice(0,-Pe.length)+Pe:Pe+E.slice(Pe.length)}return{innerValue:V,hasMask:D,moveCursorForPaste:ye,updateMaskValue:de,onMaskedKeydown:He}}const wg={name:String};function yA(r={}){return(h,p,y)=>{h[p](Ie("input",{class:"hidden"+(y||""),...r.value}))}}function pb(r){return be(()=>r.name||r.for)}function vA(r,h){function p(){const y=r.modelValue;try{const b="DataTransfer"in window?new DataTransfer:"ClipboardEvent"in window?new ClipboardEvent("").clipboardData:void 0;return Object(y)===y&&("length"in y?Array.from(y):[y]).forEach(E=>{b.items.add(E)}),{files:b.files}}catch{return{files:void 0}}}return be(h===!0?()=>{if(r.type==="file")return p()}:p)}const xA=/[\u3000-\u303f\u3040-\u309f\u30a0-\u30ff\uff00-\uff9f\u4e00-\u9faf\u3400-\u4dbf]/,bA=/[\u4e00-\u9fff\u3400-\u4dbf\u{20000}-\u{2a6df}\u{2a700}-\u{2b73f}\u{2b740}-\u{2b81f}\u{2b820}-\u{2ceaf}\uf900-\ufaff\u3300-\u33ff\ufe30-\ufe4f\uf900-\ufaff\u{2f800}-\u{2fa1f}]/u,wA=/[\u3131-\u314e\u314f-\u3163\uac00-\ud7a3]/,TA=/[a-z0-9_ -]$/i;function mb(r){return function(p){if(p.type==="compositionend"||p.type==="change"){if(p.target.qComposing!==!0)return;p.target.qComposing=!1,r(p)}else p.type==="compositionupdate"&&p.target.qComposing!==!0&&typeof p.data=="string"&&(pn.is.firefox===!0?TA.test(p.data)===!1:xA.test(p.data)===!0||bA.test(p.data)===!0||wA.test(p.data)===!0)===!0&&(p.target.qComposing=!0)}}const Af=$i({name:"QInput",inheritAttrs:!1,props:{...yp,..._A,...wg,modelValue:{required:!1},shadowText:String,type:{type:String,default:"text"},debounce:[String,Number],autogrow:Boolean,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...vg,"paste","change"],setup(r,{emit:h,attrs:p}){const{proxy:y}=Oi(),{$q:b}=y,E={};let A=NaN,s,D,V,N;const F=Rt(null),q=pb(r),{innerValue:H,hasMask:de,moveCursorForPaste:ye,updateMaskValue:ze,onMaskedKeydown:He}=gA(r,h,Ye,F),we=vA(r,!0),Le=be(()=>Bh(H.value)),Ne=mb(Ge),Te=xg(),Pe=be(()=>r.type==="textarea"||r.autogrow===!0),xe=be(()=>Pe.value===!0||["text","search","url","tel","password"].includes(r.type)),De=be(()=>{const Oe={...Te.splitAttrs.listeners.value,onInput:Ge,onPaste:$e,onChange:Ht,onBlur:ot,onFocus:$o};return Oe.onCompositionstart=Oe.onCompositionupdate=Oe.onCompositionend=Ne,de.value===!0&&(Oe.onKeydown=He),r.autogrow===!0&&(Oe.onAnimationend=Ot),Oe}),Ke=be(()=>{const Oe={tabindex:0,"data-autofocus":r.autofocus===!0||void 0,rows:r.type==="textarea"?6:void 0,"aria-label":r.label,name:q.value,...Te.splitAttrs.attributes.value,id:Te.targetUid.value,maxlength:r.maxlength,disabled:r.disable===!0,readonly:r.readonly===!0};return Pe.value===!1&&(Oe.type=r.type),r.autogrow===!0&&(Oe.rows=1),Oe});ri(()=>r.type,()=>{F.value&&(F.value.value=r.modelValue)}),ri(()=>r.modelValue,Oe=>{if(de.value===!0){if(D===!0&&(D=!1,String(Oe)===A))return;ze(Oe)}else H.value!==Oe&&(H.value=Oe,r.type==="number"&&E.hasOwnProperty("value")===!0&&(s===!0?s=!1:delete E.value));r.autogrow===!0&&fn(Ot)}),ri(()=>r.autogrow,Oe=>{Oe===!0?fn(Ot):F.value!==null&&p.rows>0&&(F.value.style.height="auto")}),ri(()=>r.dense,()=>{r.autogrow===!0&&fn(Ot)});function Ue(){Oh(()=>{const Oe=document.activeElement;F.value!==null&&F.value!==Oe&&(Oe===null||Oe.id!==Te.targetUid.value)&&F.value.focus({preventScroll:!0})})}function nt(){F.value!==null&&F.value.select()}function $e(Oe){if(de.value===!0&&r.reverseFillMask!==!0){const _t=Oe.target;ye(_t,_t.selectionStart,_t.selectionEnd)}h("paste",Oe)}function Ge(Oe){if(!Oe||!Oe.target)return;if(r.type==="file"){h("update:modelValue",Oe.target.files);return}const _t=Oe.target.value;if(Oe.target.qComposing===!0){E.value=_t;return}if(de.value===!0)ze(_t,!1,Oe.inputType);else if(Ye(_t),xe.value===!0&&Oe.target===document.activeElement){const{selectionStart:xt,selectionEnd:Lt}=Oe.target;xt!==void 0&&Lt!==void 0&&fn(()=>{Oe.target===document.activeElement&&_t.indexOf(Oe.target.value)===0&&Oe.target.setSelectionRange(xt,Lt)})}r.autogrow===!0&&Ot()}function Ye(Oe,_t){N=()=>{r.type!=="number"&&E.hasOwnProperty("value")===!0&&delete E.value,r.modelValue!==Oe&&A!==Oe&&(A=Oe,_t===!0&&(D=!0),h("update:modelValue",Oe),fn(()=>{A===Oe&&(A=NaN)})),N=void 0},r.type==="number"&&(s=!0,E.value=Oe),r.debounce!==void 0?(clearTimeout(V),E.value=Oe,V=setTimeout(N,r.debounce)):N()}function Ot(){requestAnimationFrame(()=>{const Oe=F.value;if(Oe!==null){const _t=Oe.parentNode.style,{overflow:xt}=Oe.style;b.platform.is.firefox!==!0&&(Oe.style.overflow="hidden"),Oe.style.height="1px",_t.marginBottom=Oe.scrollHeight-1+"px",Oe.style.height=Oe.scrollHeight+"px",Oe.style.overflow=xt,_t.marginBottom=""}})}function Ht(Oe){Ne(Oe),clearTimeout(V),N!==void 0&&N(),h("change",Oe.target.value)}function ot(Oe){Oe!==void 0&&$o(Oe),clearTimeout(V),N!==void 0&&N(),s=!1,D=!1,delete E.value,r.type!=="file"&&setTimeout(()=>{F.value!==null&&(F.value.value=H.value!==void 0?H.value:"")})}function At(){return E.hasOwnProperty("value")===!0?E.value:H.value!==void 0?H.value:""}_n(()=>{ot()}),sr(()=>{r.autogrow===!0&&Ot()}),Object.assign(Te,{innerValue:H,fieldClass:be(()=>`q-${Pe.value===!0?"textarea":"input"}`+(r.autogrow===!0?" q-textarea--autogrow":"")),hasShadow:be(()=>r.type!=="file"&&typeof r.shadowText=="string"&&r.shadowText.length>0),inputRef:F,emitValue:Ye,hasValue:Le,floatingLabel:be(()=>Le.value===!0||Bh(r.displayValue)),getControl:()=>Ie(Pe.value===!0?"textarea":"input",{ref:F,class:["q-field__native q-placeholder",r.inputClass],style:r.inputStyle,...Ke.value,...De.value,...r.type!=="file"?{value:At()}:we.value}),getShadowControl:()=>Ie("div",{class:"q-field__native q-field__shadow absolute-bottom no-pointer-events"+(Pe.value===!0?"":" text-no-wrap")},[Ie("span",{class:"invisible"},At()),Ie("span",r.shadowText)])});const di=bg(Te);return Object.assign(y,{focus:Ue,select:nt,getNativeElement:()=>F.value}),di}}),EA=$i({name:"QField",inheritAttrs:!1,props:yp,emits:vg,setup(){return bg(xg())}}),SA={xs:8,sm:10,md:14,lg:20,xl:24},CA=$i({name:"QChip",props:{...ua,..._p,dense:Boolean,icon:String,iconRight:String,iconRemove:String,iconSelected:String,label:[String,Number],color:String,textColor:String,modelValue:{type:Boolean,default:!0},selected:{type:Boolean,default:null},square:Boolean,outline:Boolean,clickable:Boolean,removable:Boolean,removeAriaLabel:String,tabindex:[String,Number],disable:Boolean,ripple:{type:[Boolean,Object],default:!0}},emits:["update:modelValue","update:selected","remove","click"],setup(r,{slots:h,emit:p}){const{proxy:{$q:y}}=Oi(),b=ha(r,y),E=gp(r,SA),A=be(()=>r.selected===!0||r.icon!==void 0),s=be(()=>r.selected===!0?r.iconSelected||y.iconSet.chip.selected:r.icon),D=be(()=>r.iconRemove||y.iconSet.chip.remove),V=be(()=>r.disable===!1&&(r.clickable===!0||r.selected!==null)),N=be(()=>{const ze=r.outline===!0&&r.color||r.textColor;return"q-chip row inline no-wrap items-center"+(r.outline===!1&&r.color!==void 0?` bg-${r.color}`:"")+(ze?` text-${ze} q-chip--colored`:"")+(r.disable===!0?" disabled":"")+(r.dense===!0?" q-chip--dense":"")+(r.outline===!0?" q-chip--outline":"")+(r.selected===!0?" q-chip--selected":"")+(V.value===!0?" q-chip--clickable cursor-pointer non-selectable q-hoverable":"")+(r.square===!0?" q-chip--square":"")+(b.value===!0?" q-chip--dark q-dark":"")}),F=be(()=>r.disable===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:r.tabindex||0,role:"button","aria-hidden":"false","aria-label":r.removeAriaLabel||y.lang.label.remove});function q(ze){ze.keyCode===13&&H(ze)}function H(ze){r.disable||(p("update:selected",!r.selected),p("click",ze))}function de(ze){(ze.keyCode===void 0||ze.keyCode===13)&&(xn(ze),r.disable===!1&&(p("update:modelValue",!1),p("remove")))}function ye(){const ze=[];V.value===!0&&ze.push(Ie("div",{class:"q-focus-helper"})),A.value===!0&&ze.push(Ie(jn,{class:"q-chip__icon q-chip__icon--left",name:s.value}));const He=r.label!==void 0?[Ie("div",{class:"ellipsis"},[r.label])]:void 0;return ze.push(Ie("div",{class:"q-chip__content col row no-wrap items-center q-anchor--skip"},yC(h.default,He))),r.iconRight&&ze.push(Ie(jn,{class:"q-chip__icon q-chip__icon--right",name:r.iconRight})),r.removable===!0&&ze.push(Ie(jn,{class:"q-chip__icon q-chip__icon--remove cursor-pointer",name:D.value,...F.value,onClick:de,onKeyup:de})),ze}return()=>{if(r.modelValue===!1)return;const ze={class:N.value,style:E.value};return V.value===!0&&Object.assign(ze,F.value,{onClick:H,onKeyup:q}),W1("div",ze,ye(),"ripple",r.ripple!==!1&&r.disable!==!0,()=>[[rb,r.ripple]])}}}),AA=$i({name:"QItem",props:{...ua,...sb,tag:{type:String,default:"div"},active:{type:Boolean,default:null},clickable:Boolean,dense:Boolean,insetLevel:Number,tabindex:[String,Number],focused:Boolean,manualFocus:Boolean},emits:["click","keyup"],setup(r,{slots:h,emit:p}){const{proxy:{$q:y}}=Oi(),b=ha(r,y),{hasLink:E,linkAttrs:A,linkClass:s,linkTag:D,navigateOnClick:V}=ab(),N=Rt(null),F=Rt(null),q=be(()=>r.clickable===!0||E.value===!0||r.tag==="label"),H=be(()=>r.disable!==!0&&q.value===!0),de=be(()=>"q-item q-item-type row no-wrap"+(r.dense===!0?" q-item--dense":"")+(b.value===!0?" q-item--dark":"")+(E.value===!0&&r.active===null?s.value:r.active===!0?` q-item--active${r.activeClass!==void 0?` ${r.activeClass}`:""}`:"")+(r.disable===!0?" disabled":"")+(H.value===!0?" q-item--clickable q-link cursor-pointer "+(r.manualFocus===!0?"q-manual-focusable":"q-focusable q-hoverable")+(r.focused===!0?" q-manual-focusable--focused":""):"")),ye=be(()=>{if(r.insetLevel===void 0)return null;const Le=y.lang.rtl===!0?"Right":"Left";return{["padding"+Le]:16+r.insetLevel*56+"px"}});function ze(Le){H.value===!0&&(F.value!==null&&(Le.qKeyEvent!==!0&&document.activeElement===N.value?F.value.focus():document.activeElement===F.value&&N.value.focus()),V(Le))}function He(Le){if(H.value===!0&&la(Le,13)===!0){xn(Le),Le.qKeyEvent=!0;const Ne=new MouseEvent("click",Le);Ne.qKeyEvent=!0,N.value.dispatchEvent(Ne)}p("keyup",Le)}function we(){const Le=fg(h.default,[]);return H.value===!0&&Le.unshift(Ie("div",{class:"q-focus-helper",tabindex:-1,ref:F})),Le}return()=>{const Le={ref:N,class:de.value,style:ye.value,onClick:ze,onKeyup:He};return H.value===!0?(Le.tabindex=r.tabindex||"0",Object.assign(Le,A.value)):q.value===!0&&(Le["aria-disabled"]="true"),Ie(D.value,Le,we())}}}),MA=$i({name:"QItemSection",props:{avatar:Boolean,thumbnail:Boolean,side:Boolean,top:Boolean,noWrap:Boolean},setup(r,{slots:h}){const p=be(()=>`q-item__section column q-item__section--${r.avatar===!0||r.side===!0||r.thumbnail===!0?"side":"main"}`+(r.top===!0?" q-item__section--top justify-start":" justify-center")+(r.avatar===!0?" q-item__section--avatar":"")+(r.thumbnail===!0?" q-item__section--thumbnail":"")+(r.noWrap===!0?" q-item__section--nowrap":""));return()=>Ie("div",{class:p.value},bn(h.default))}}),IA=$i({name:"QItemLabel",props:{overline:Boolean,caption:Boolean,header:Boolean,lines:[Number,String]},setup(r,{slots:h}){const p=be(()=>parseInt(r.lines,10)),y=be(()=>"q-item__label"+(r.overline===!0?" q-item__label--overline text-overline":"")+(r.caption===!0?" q-item__label--caption text-caption":"")+(r.header===!0?" q-item__label--header":"")+(p.value===1?" ellipsis":"")),b=be(()=>r.lines!==void 0&&p.value>1?{overflow:"hidden",display:"-webkit-box","-webkit-box-orient":"vertical","-webkit-line-clamp":p.value}:null);return()=>Ie("div",{style:b.value,class:y.value},bn(h.default))}});function _b(){if(window.getSelection!==void 0){const r=window.getSelection();r.empty!==void 0?r.empty():r.removeAllRanges!==void 0&&(r.removeAllRanges(),$f.is.mobile!==!0&&r.addRange(document.createRange()))}else document.selection!==void 0&&document.selection.empty()}const kA={target:{default:!0},noParentEvent:Boolean,contextMenu:Boolean};function zA({showing:r,avoidEmit:h,configureAnchorEl:p}){const{props:y,proxy:b,emit:E}=Oi(),A=Rt(null);let s;function D(H){return A.value===null?!1:H===void 0||H.touches===void 0||H.touches.length<=1}const V={};p===void 0&&(Object.assign(V,{hide(H){b.hide(H)},toggle(H){b.toggle(H),H.qAnchorHandled=!0},toggleKey(H){la(H,13)===!0&&V.toggle(H)},contextClick(H){b.hide(H),Nr(H),fn(()=>{b.show(H),H.qAnchorHandled=!0})},prevent:Nr,mobileTouch(H){if(V.mobileCleanup(H),D(H)!==!0)return;b.hide(H),A.value.classList.add("non-selectable");const de=H.target;cl(V,"anchor",[[de,"touchmove","mobileCleanup","passive"],[de,"touchend","mobileCleanup","passive"],[de,"touchcancel","mobileCleanup","passive"],[A.value,"contextmenu","prevent","notPassive"]]),s=setTimeout(()=>{b.show(H),H.qAnchorHandled=!0},300)},mobileCleanup(H){A.value.classList.remove("non-selectable"),clearTimeout(s),r.value===!0&&H!==void 0&&_b()}}),p=function(H=y.contextMenu){if(y.noParentEvent===!0||A.value===null)return;let de;H===!0?b.$q.platform.is.mobile===!0?de=[[A.value,"touchstart","mobileTouch","passive"]]:de=[[A.value,"mousedown","hide","passive"],[A.value,"contextmenu","contextClick","notPassive"]]:de=[[A.value,"click","toggle","passive"],[A.value,"keyup","toggleKey","passive"]],cl(V,"anchor",de)});function N(){Ch(V,"anchor")}function F(H){for(A.value=H;A.value.classList.contains("q-anchor--skip");)A.value=A.value.parentNode;p()}function q(){if(y.target===!1||y.target===""||b.$el.parentNode===null)A.value=null;else if(y.target===!0)F(b.$el.parentNode);else{let H=y.target;if(typeof y.target=="string")try{H=document.querySelector(y.target)}catch{H=void 0}H!=null?(A.value=H.$el||H,p()):(A.value=null,console.error(`Anchor: target "${y.target}" not found`))}}return ri(()=>y.contextMenu,H=>{A.value!==null&&(N(),p(H))}),ri(()=>y.target,()=>{A.value!==null&&N(),q()}),ri(()=>y.noParentEvent,H=>{A.value!==null&&(H===!0?N():p())}),sr(()=>{q(),h!==!0&&y.modelValue===!0&&A.value===null&&E("update:modelValue",!1)}),_n(()=>{clearTimeout(s),N()}),{anchorEl:A,canShow:D,anchorEvents:V}}function PA(r,h){const p=Rt(null);let y;function b(s,D){const V=`${D!==void 0?"add":"remove"}EventListener`,N=D!==void 0?D:y;s!==window&&s[V]("scroll",N,Bn.passive),window[V]("scroll",N,Bn.passive),y=D}function E(){p.value!==null&&(b(p.value),p.value=null)}const A=ri(()=>r.noParentEvent,()=>{p.value!==null&&(E(),h())});return _n(A),{localScrollTarget:p,unconfigureScrollTarget:E,changeScrollEvent:b}}let DA=document.body;function LA(r){const h=document.createElement("div");if(r!==void 0&&(h.id=r),Wf.globalNodes!==void 0){const p=Wf.globalNodes.class;p!==void 0&&(h.className=p)}return DA.appendChild(h),h}function BA(r){r.remove()}const Sc=[];function RA(r){return Sc.find(h=>h.__qPortalInnerRef.value!==null&&h.__qPortalInnerRef.value.contains(r))}function gb(r,h){do{if(r.$options.name==="QMenu"){if(r.hide(h),r.$props.separateClosePopup===!0)return Lf(r)}else if(r.__qPortalInnerRef!==void 0){const p=Lf(r);return p!==void 0&&p.$options.name==="QPopupProxy"?(r.hide(h),p):r}r=Lf(r)}while(r!=null)}function FA(r,h,p){for(;p!==0&&r!==void 0&&r!==null;){if(r.__qPortalInnerRef!==void 0){if(p--,r.$options.name==="QMenu"){r=gb(r,h);continue}r.hide(h)}r=Lf(r)}}function OA(r){for(r=r.parent;r!=null;){if(r.type.name==="QGlobalDialog")return!0;if(r.type.name==="QDialog"||r.type.name==="QMenu")return!1;r=r.parent}return!1}function yb(r,h,p,y){const b=Rt(!1),E=Rt(!1);let A=null;const s={},D=y===!0&&OA(r);function V(F){if(F===!0){a0(s),E.value=!0;return}E.value=!1,b.value===!1&&(D===!1&&A===null&&(A=LA()),b.value=!0,Sc.push(r.proxy),fA(s))}function N(F){if(E.value=!1,F!==!0)return;a0(s),b.value=!1;const q=Sc.indexOf(r.proxy);q!==-1&&Sc.splice(q,1),A!==null&&(BA(A),A=null)}return up(()=>{N(!0)}),r.proxy.__qPortalInnerRef=h,{showPortal:V,hidePortal:N,portalIsActive:b,portalIsAccessible:E,renderPortal:()=>D===!0?p():b.value===!0?[Ie(tS,{to:A},p())]:void 0}}const vb={transitionShow:{type:String,default:"fade"},transitionHide:{type:String,default:"fade"},transitionDuration:{type:[String,Number],default:300}};function VA(r,h){const p=Rt(h.value);return ri(h,y=>{fn(()=>{p.value=y})}),{transition:be(()=>"q-transition--"+(p.value===!0?r.transitionHide:r.transitionShow)),transitionStyle:be(()=>`--q-transition-duration: ${r.transitionDuration}ms`)}}function xb(){let r;const h=Oi();function p(){r=void 0}return Bc(p),_n(p),{removeTick:p,registerTick(y){r=y,fn(()=>{r===y&&(mg(h)===!1&&r(),r=void 0)})}}}function bb(){let r;const h=Oi();function p(){clearTimeout(r)}return Bc(p),_n(p),{removeTimeout:p,registerTimeout(y,b){clearTimeout(r),mg(h)===!1&&(r=setTimeout(y,b))}}}const fl=[];let kc;function UA(r){kc=r.keyCode===27}function NA(){kc===!0&&(kc=!1)}function jA(r){kc===!0&&(kc=!1,la(r,27)===!0&&fl[fl.length-1](r))}function wb(r){window[r]("keydown",UA),window[r]("blur",NA),window[r]("keyup",jA),kc=!1}function Tb(r){pn.is.desktop===!0&&(fl.push(r),fl.length===1&&wb("addEventListener"))}function Kf(r){const h=fl.indexOf(r);h>-1&&(fl.splice(h,1),fl.length===0&&wb("removeEventListener"))}const pl=[];function Eb(r){pl[pl.length-1](r)}function Sb(r){pn.is.desktop===!0&&(pl.push(r),pl.length===1&&document.body.addEventListener("focusin",Eb))}function z_(r){const h=pl.indexOf(r);h>-1&&(pl.splice(h,1),pl.length===0&&document.body.removeEventListener("focusin",Eb))}let Cb;const{notPassiveCapture:Yf}=Bn,ml=[];function Jf(r){clearTimeout(Cb);const h=r.target;if(h===void 0||h.nodeType===8||h.classList.contains("no-pointer-events")===!0)return;let p=Sc.length-1;for(;p>=0;){const y=Sc[p].$;if(y.type.name!=="QDialog")break;if(y.props.seamless!==!0)return;p--}for(let y=ml.length-1;y>=0;y--){const b=ml[y];if((b.anchorEl.value===null||b.anchorEl.value.contains(h)===!1)&&(h===document.body||b.innerRef.value!==null&&b.innerRef.value.contains(h)===!1))r.qClickOutside=!0,b.onClickOutside(r);else return}}function qA(r){ml.push(r),ml.length===1&&(document.addEventListener("mousedown",Jf,Yf),document.addEventListener("touchstart",Jf,Yf))}function u0(r){const h=ml.findIndex(p=>p===r);h>-1&&(ml.splice(h,1),ml.length===0&&(clearTimeout(Cb),document.removeEventListener("mousedown",Jf,Yf),document.removeEventListener("touchstart",Jf,Yf)))}let h0,d0;function f0(r){const h=r.split(" ");return h.length!==2?!1:["top","center","bottom"].includes(h[0])!==!0?(console.error("Anchor/Self position must start with one of top/center/bottom"),!1):["left","middle","right","start","end"].includes(h[1])!==!0?(console.error("Anchor/Self position must end with one of left/middle/right/start/end"),!1):!0}function $A(r){return r?!(r.length!==2||typeof r[0]!="number"||typeof r[1]!="number"):!0}const P_={"start#ltr":"left","start#rtl":"right","end#ltr":"right","end#rtl":"left"};["left","middle","right"].forEach(r=>{P_[`${r}#ltr`]=r,P_[`${r}#rtl`]=r});function p0(r,h){const p=r.split(" ");return{vertical:p[0],horizontal:P_[`${p[1]}#${h===!0?"rtl":"ltr"}`]}}function GA(r,h){let{top:p,left:y,right:b,bottom:E,width:A,height:s}=r.getBoundingClientRect();return h!==void 0&&(p-=h[1],y-=h[0],E+=h[1],b+=h[0],A+=h[0],s+=h[1]),{top:p,left:y,right:b,bottom:E,width:A,height:s,middle:y+(b-y)/2,center:p+(E-p)/2}}function ZA(r){return{top:0,center:r.offsetHeight/2,bottom:r.offsetHeight,left:0,middle:r.offsetWidth/2,right:r.offsetWidth}}function WA(r){if(pn.is.ios===!0&&window.visualViewport!==void 0){const s=document.body.style,{offsetLeft:D,offsetTop:V}=window.visualViewport;D!==h0&&(s.setProperty("--q-pe-left",D+"px"),h0=D),V!==d0&&(s.setProperty("--q-pe-top",V+"px"),d0=V)}let h;const{scrollLeft:p,scrollTop:y}=r.el;if(r.absoluteOffset===void 0)h=GA(r.anchorEl,r.cover===!0?[0,0]:r.offset);else{const{top:s,left:D}=r.anchorEl.getBoundingClientRect(),V=s+r.absoluteOffset.top,N=D+r.absoluteOffset.left;h={top:V,left:N,width:1,height:1,right:N+1,center:V,middle:N,bottom:V+1}}let b={maxHeight:r.maxHeight,maxWidth:r.maxWidth,visibility:"visible"};(r.fit===!0||r.cover===!0)&&(b.minWidth=h.width+"px",r.cover===!0&&(b.minHeight=h.height+"px")),Object.assign(r.el.style,b);const E=ZA(r.el),A={top:h[r.anchorOrigin.vertical]-E[r.selfOrigin.vertical],left:h[r.anchorOrigin.horizontal]-E[r.selfOrigin.horizontal]};HA(A,h,E,r.anchorOrigin,r.selfOrigin),b={top:A.top+"px",left:A.left+"px"},A.maxHeight!==void 0&&(b.maxHeight=A.maxHeight+"px",h.height>A.maxHeight&&(b.minHeight=b.maxHeight)),A.maxWidth!==void 0&&(b.maxWidth=A.maxWidth+"px",h.width>A.maxWidth&&(b.minWidth=b.maxWidth)),Object.assign(r.el.style,b),r.el.scrollTop!==y&&(r.el.scrollTop=y),r.el.scrollLeft!==p&&(r.el.scrollLeft=p)}function HA(r,h,p,y,b){const E=p.bottom,A=p.right,s=Bf(),D=window.innerHeight-s,V=document.body.clientWidth;if(r.top<0||r.top+E>D)if(b.vertical==="center")r.top=h[y.vertical]>D/2?Math.max(0,D-E):0,r.maxHeight=Math.min(E,D);else if(h[y.vertical]>D/2){const N=Math.min(D,y.vertical==="center"?h.center:y.vertical===b.vertical?h.bottom:h.top);r.maxHeight=Math.min(E,N),r.top=Math.max(0,N-E)}else r.top=Math.max(0,y.vertical==="center"?h.center:y.vertical===b.vertical?h.top:h.bottom),r.maxHeight=Math.min(E,D-r.top);if(r.left<0||r.left+A>V)if(r.maxWidth=Math.min(A,V),b.horizontal==="middle")r.left=h[y.horizontal]>V/2?Math.max(0,V-A):0;else if(h[y.horizontal]>V/2){const N=Math.min(V,y.horizontal==="middle"?h.middle:y.horizontal===b.horizontal?h.right:h.left);r.maxWidth=Math.min(A,N),r.left=Math.max(0,N-r.maxWidth)}else r.left=Math.max(0,y.horizontal==="middle"?h.middle:y.horizontal===b.horizontal?h.left:h.right),r.maxWidth=Math.min(A,V-r.left)}const XA=$i({name:"QMenu",inheritAttrs:!1,props:{...kA,..._g,...ua,...vb,persistent:Boolean,autoClose:Boolean,separateClosePopup:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,fit:Boolean,cover:Boolean,square:Boolean,anchor:{type:String,validator:f0},self:{type:String,validator:f0},offset:{type:Array,validator:$A},scrollTarget:{default:void 0},touchPosition:Boolean,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null}},emits:[...gg,"click","escape-key"],setup(r,{slots:h,emit:p,attrs:y}){let b=null,E,A,s;const D=Oi(),{proxy:V}=D,{$q:N}=V,F=Rt(null),q=Rt(!1),H=be(()=>r.persistent!==!0&&r.noRouteDismiss!==!0),de=ha(r,N),{registerTick:ye,removeTick:ze}=xb(),{registerTimeout:He}=bb(),{transition:we,transitionStyle:Le}=VA(r,q),{localScrollTarget:Ne,changeScrollEvent:Te,unconfigureScrollTarget:Pe}=PA(r,Lt),{anchorEl:xe,canShow:De}=zA({showing:q}),{hide:Ke}=yg({showing:q,canShow:De,handleShow:Oe,handleHide:_t,hideOnRouteChange:H,processOnMount:!0}),{showPortal:Ue,hidePortal:nt,renderPortal:$e}=yb(D,F,Jt),Ge={anchorEl:xe,innerRef:F,onClickOutside(Et){if(r.persistent!==!0&&q.value===!0)return Ke(Et),(Et.type==="touchstart"||Et.target.classList.contains("q-dialog__backdrop"))&&xn(Et),!0}},Ye=be(()=>p0(r.anchor||(r.cover===!0?"center middle":"bottom start"),N.lang.rtl)),Ot=be(()=>r.cover===!0?Ye.value:p0(r.self||"top start",N.lang.rtl)),Ht=be(()=>(r.square===!0?" q-menu--square":"")+(de.value===!0?" q-menu--dark q-dark":"")),ot=be(()=>r.autoClose===!0?{onClick:pi}:{}),At=be(()=>q.value===!0&&r.persistent!==!0);ri(At,Et=>{Et===!0?(Tb(Kt),qA(Ge)):(Kf(Kt),u0(Ge))});function di(){Oh(()=>{let Et=F.value;Et&&Et.contains(document.activeElement)!==!0&&(Et=Et.querySelector("[autofocus], [data-autofocus]")||Et,Et.focus({preventScroll:!0}))})}function Oe(Et){if(b=r.noRefocus===!1?document.activeElement:null,Sb(Ci),Ue(),Lt(),E=void 0,Et!==void 0&&(r.touchPosition||r.contextMenu)){const Bi=Gf(Et);if(Bi.left!==void 0){const{top:Tn,left:ue}=xe.value.getBoundingClientRect();E={left:Bi.left-ue,top:Bi.top-Tn}}}A===void 0&&(A=ri(()=>N.screen.width+"|"+N.screen.height+"|"+r.self+"|"+r.anchor+"|"+N.lang.rtl,Yt)),r.noFocus!==!0&&document.activeElement.blur(),ye(()=>{Yt(),r.noFocus!==!0&&di()}),He(()=>{N.platform.is.ios===!0&&(s=r.autoClose,F.value.click()),Yt(),Ue(!0),p("show",Et)},r.transitionDuration)}function _t(Et){ze(),nt(),xt(!0),b!==null&&(Et===void 0||Et.qClickOutside!==!0)&&(b.focus(),b=null),He(()=>{nt(!0),p("hide",Et)},r.transitionDuration)}function xt(Et){E=void 0,A!==void 0&&(A(),A=void 0),(Et===!0||q.value===!0)&&(z_(Ci),Pe(),u0(Ge),Kf(Kt)),Et!==!0&&(b=null)}function Lt(){(xe.value!==null||r.scrollTarget!==void 0)&&(Ne.value=J1(xe.value,r.scrollTarget),Te(Ne.value,Yt))}function pi(Et){s!==!0?(gb(V,Et),p("click",Et)):s=!1}function Ci(Et){At.value===!0&&r.noFocus!==!0&&Y1(F.value,Et.target)!==!0&&di()}function Kt(Et){p("escape-key"),Ke(Et)}function Yt(){const Et=F.value;Et===null||xe.value===null||WA({el:Et,offset:r.offset,anchorEl:xe.value,anchorOrigin:Ye.value,selfOrigin:Ot.value,absoluteOffset:E,fit:r.fit,cover:r.cover,maxHeight:r.maxHeight,maxWidth:r.maxWidth})}function Jt(){return Ie(vs,{name:we.value,appear:!0},()=>q.value===!0?Ie("div",{role:"menu",...y,ref:F,tabindex:-1,class:["q-menu q-position-engine scroll"+Ht.value,y.class],style:[y.style,Le.value],...ot.value},bn(h.default)):null)}return _n(xt),Object.assign(V,{focus:di,updatePosition:Yt}),$e}});function KA(r,h,p){let y;function b(){y!==void 0&&(Dh.remove(y),y=void 0)}return _n(()=>{r.value===!0&&b()}),{removeFromHistory:b,addToHistory(){y={condition:()=>p.value===!0,handler:h},Dh.add(y)}}}let fh=0,s_,a_,xh,l_=!1,m0,_0,vc;function YA(r){JA(r)&&xn(r)}function JA(r){if(r.target===document.body||r.target.classList.contains("q-layout__backdrop"))return!0;const h=XS(r),p=r.shiftKey&&!r.deltaX,y=!p&&Math.abs(r.deltaX)<=Math.abs(r.deltaY),b=p||y?r.deltaY:r.deltaX;for(let E=0;E<h.length;E++){const A=h[E];if(zC(A,y))return y?b<0&&A.scrollTop===0?!0:b>0&&A.scrollTop+A.clientHeight===A.scrollHeight:b<0&&A.scrollLeft===0?!0:b>0&&A.scrollLeft+A.clientWidth===A.scrollWidth}return!0}function g0(r){r.target===document&&(document.scrollingElement.scrollTop=document.scrollingElement.scrollTop)}function Mf(r){l_!==!0&&(l_=!0,requestAnimationFrame(()=>{l_=!1;const{height:h}=r.target,{clientHeight:p,scrollTop:y}=document.scrollingElement;(xh===void 0||h!==window.innerHeight)&&(xh=p-h,document.scrollingElement.scrollTop=y),y>xh&&(document.scrollingElement.scrollTop-=Math.ceil((y-xh)/8))}))}function y0(r){const h=document.body,p=window.visualViewport!==void 0;if(r==="add"){const{overflowY:y,overflowX:b}=window.getComputedStyle(h);s_=eb(window),a_=Q1(window),m0=h.style.left,_0=h.style.top,h.style.left=`-${s_}px`,h.style.top=`-${a_}px`,b!=="hidden"&&(b==="scroll"||h.scrollWidth>window.innerWidth)&&h.classList.add("q-body--force-scrollbar-x"),y!=="hidden"&&(y==="scroll"||h.scrollHeight>window.innerHeight)&&h.classList.add("q-body--force-scrollbar-y"),h.classList.add("q-body--prevent-scroll"),document.qScrollPrevented=!0,pn.is.ios===!0&&(p===!0?(window.scrollTo(0,0),window.visualViewport.addEventListener("resize",Mf,Bn.passiveCapture),window.visualViewport.addEventListener("scroll",Mf,Bn.passiveCapture),window.scrollTo(0,0)):window.addEventListener("scroll",g0,Bn.passiveCapture))}pn.is.desktop===!0&&pn.is.mac===!0&&window[`${r}EventListener`]("wheel",YA,Bn.notPassive),r==="remove"&&(pn.is.ios===!0&&(p===!0?(window.visualViewport.removeEventListener("resize",Mf,Bn.passiveCapture),window.visualViewport.removeEventListener("scroll",Mf,Bn.passiveCapture)):window.removeEventListener("scroll",g0,Bn.passiveCapture)),h.classList.remove("q-body--prevent-scroll"),h.classList.remove("q-body--force-scrollbar-x"),h.classList.remove("q-body--force-scrollbar-y"),document.qScrollPrevented=!1,h.style.left=m0,h.style.top=_0,window.scrollTo(s_,a_),xh=void 0)}function QA(r){let h="add";if(r===!0){if(fh++,vc!==void 0){clearTimeout(vc),vc=void 0;return}if(fh>1)return}else{if(fh===0||(fh--,fh>0))return;if(h="remove",pn.is.ios===!0&&pn.is.nativeMobile===!0){clearTimeout(vc),vc=setTimeout(()=>{y0(h),vc=void 0},100);return}}y0(h)}function eM(){let r;return{preventBodyScroll(h){h!==r&&(r!==void 0||h===!0)&&(r=h,QA(h))}}}let If=0;const tM={standard:"fixed-full flex-center",top:"fixed-top justify-center",bottom:"fixed-bottom justify-center",right:"fixed-right items-center",left:"fixed-left items-center"},v0={standard:["scale","scale"],top:["slide-down","slide-up"],bottom:["slide-up","slide-down"],right:["slide-left","slide-right"],left:["slide-right","slide-left"]},D_=$i({name:"QDialog",inheritAttrs:!1,props:{..._g,...vb,transitionShow:String,transitionHide:String,persistent:Boolean,autoClose:Boolean,allowFocusOutside:Boolean,noEscDismiss:Boolean,noBackdropDismiss:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,noShake:Boolean,seamless:Boolean,maximized:Boolean,fullWidth:Boolean,fullHeight:Boolean,square:Boolean,position:{type:String,default:"standard",validator:r=>r==="standard"||["top","bottom","left","right"].includes(r)}},emits:[...gg,"shake","click","escape-key"],setup(r,{slots:h,emit:p,attrs:y}){const b=Oi(),E=Rt(null),A=Rt(!1),s=Rt(!1),D=Rt(!1);let V,N=null,F,q;const H=be(()=>r.persistent!==!0&&r.noRouteDismiss!==!0&&r.seamless!==!0),{preventBodyScroll:de}=eM(),{registerTimeout:ye}=bb(),{registerTick:ze,removeTick:He}=xb(),{showPortal:we,hidePortal:Le,portalIsAccessible:Ne,renderPortal:Te}=yb(b,E,Yt,!0),{hide:Pe}=yg({showing:A,hideOnRouteChange:H,handleShow:ot,handleHide:At,processOnMount:!0}),{addToHistory:xe,removeFromHistory:De}=KA(A,Pe,H),Ke=be(()=>`q-dialog__inner flex no-pointer-events q-dialog__inner--${r.maximized===!0?"maximized":"minimized"} q-dialog__inner--${r.position} ${tM[r.position]}`+(D.value===!0?" q-dialog__inner--animating":"")+(r.fullWidth===!0?" q-dialog__inner--fullwidth":"")+(r.fullHeight===!0?" q-dialog__inner--fullheight":"")+(r.square===!0?" q-dialog__inner--square":"")),Ue=be(()=>"q-transition--"+(r.transitionShow===void 0?v0[r.position][0]:r.transitionShow)),nt=be(()=>"q-transition--"+(r.transitionHide===void 0?v0[r.position][1]:r.transitionHide)),$e=be(()=>s.value===!0?nt.value:Ue.value),Ge=be(()=>`--q-transition-duration: ${r.transitionDuration}ms`),Ye=be(()=>A.value===!0&&r.seamless!==!0),Ot=be(()=>r.autoClose===!0?{onClick:pi}:{}),Ht=be(()=>[`q-dialog fullscreen no-pointer-events q-dialog--${Ye.value===!0?"modal":"seamless"}`,y.class]);ri(A,Jt=>{fn(()=>{s.value=Jt})}),ri(()=>r.maximized,Jt=>{A.value===!0&&Lt(Jt)}),ri(Ye,Jt=>{de(Jt),Jt===!0?(Sb(Kt),Tb(_t)):(z_(Kt),Kf(_t))});function ot(Jt){xe(),N=r.noRefocus===!1&&document.activeElement!==null?document.activeElement:null,Lt(r.maximized),we(),D.value=!0,r.noFocus!==!0?(document.activeElement!==null&&document.activeElement.blur(),ze(di)):He(),ye(()=>{if(b.proxy.$q.platform.is.ios===!0){if(r.seamless!==!0&&document.activeElement){const{top:Et,bottom:Bi}=document.activeElement.getBoundingClientRect(),{innerHeight:Tn}=window,ue=window.visualViewport!==void 0?window.visualViewport.height:Tn;Et>0&&Bi>ue/2&&(document.scrollingElement.scrollTop=Math.min(document.scrollingElement.scrollHeight-ue,Bi>=Tn?1/0:Math.ceil(document.scrollingElement.scrollTop+Bi-ue/2))),document.activeElement.scrollIntoView()}q=!0,E.value.click(),q=!1}we(!0),D.value=!1,p("show",Jt)},r.transitionDuration)}function At(Jt){He(),De(),xt(!0),D.value=!0,Le(),N!==null&&(N.focus(),N=null),ye(()=>{Le(!0),D.value=!1,p("hide",Jt)},r.transitionDuration)}function di(Jt){Oh(()=>{let Et=E.value;Et===null||Et.contains(document.activeElement)===!0||(Et=Et.querySelector(Jt||"[autofocus], [data-autofocus]")||Et,Et.focus({preventScroll:!0}))})}function Oe(){di(),p("shake");const Jt=E.value;Jt!==null&&(Jt.classList.remove("q-animate--scale"),Jt.classList.add("q-animate--scale"),clearTimeout(V),V=setTimeout(()=>{E.value!==null&&(Jt.classList.remove("q-animate--scale"),di())},170))}function _t(){r.seamless!==!0&&(r.persistent===!0||r.noEscDismiss===!0?r.maximized!==!0&&r.noShake!==!0&&Oe():(p("escape-key"),Pe()))}function xt(Jt){clearTimeout(V),(Jt===!0||A.value===!0)&&(Lt(!1),r.seamless!==!0&&(de(!1),z_(Kt),Kf(_t))),Jt!==!0&&(N=null)}function Lt(Jt){Jt===!0?F!==!0&&(If<1&&document.body.classList.add("q-body--dialog"),If++,F=!0):F===!0&&(If<2&&document.body.classList.remove("q-body--dialog"),If--,F=!1)}function pi(Jt){q!==!0&&(Pe(Jt),p("click",Jt))}function Ci(Jt){r.persistent!==!0&&r.noBackdropDismiss!==!0?Pe(Jt):r.noShake!==!0&&Oe()}function Kt(Jt){r.allowFocusOutside!==!0&&Ne.value===!0&&Y1(E.value,Jt.target)!==!0&&di('[tabindex]:not([tabindex="-1"])')}Object.assign(b.proxy,{focus:di,shake:Oe,__updateRefocusTarget(Jt){N=Jt||null}}),_n(xt);function Yt(){return Ie("div",{"aria-modal":"true",...y,class:Ht.value},[Ie(vs,{name:"q-transition--fade",appear:!0},()=>Ye.value===!0?Ie("div",{class:"q-dialog__backdrop fixed-full",style:Ge.value,"aria-hidden":"true",onMousedown:Ci}):null),Ie(vs,{name:$e.value,appear:!0},()=>A.value===!0?Ie("div",{ref:E,class:Ke.value,style:Ge.value,tabindex:-1,...Ot.value},bn(h.default)):null)])}return Te}});let Qf=!1;{const r=document.createElement("div");r.setAttribute("dir","rtl"),Object.assign(r.style,{width:"1px",height:"1px",overflow:"auto"});const h=document.createElement("div");Object.assign(h.style,{width:"1000px",height:"1px"}),document.body.appendChild(r),r.appendChild(h),r.scrollLeft=-1e3,Qf=r.scrollLeft>=0,r.remove()}const mo=1e3,iM=["start","center","end","start-force","center-force","end-force"],Ab=Array.prototype.filter,nM=window.getComputedStyle(document.body).overflowAnchor===void 0?Wo:function(r,h){r!==null&&(cancelAnimationFrame(r._qOverflowAnimationFrame),r._qOverflowAnimationFrame=requestAnimationFrame(()=>{if(r===null)return;const p=r.children||[];Ab.call(p,b=>b.dataset&&b.dataset.qVsAnchor!==void 0).forEach(b=>{delete b.dataset.qVsAnchor});const y=p[h];y&&y.dataset&&(y.dataset.qVsAnchor="")}))};function Cc(r,h){return r+h}function c_(r,h,p,y,b,E,A,s){const D=r===window?document.scrollingElement||document.documentElement:r,V=b===!0?"offsetWidth":"offsetHeight",N={scrollStart:0,scrollViewSize:-A-s,scrollMaxSize:0,offsetStart:-A,offsetEnd:-s};if(b===!0?(r===window?(N.scrollStart=window.pageXOffset||window.scrollX||document.body.scrollLeft||0,N.scrollViewSize+=document.documentElement.clientWidth):(N.scrollStart=D.scrollLeft,N.scrollViewSize+=D.clientWidth),N.scrollMaxSize=D.scrollWidth,E===!0&&(N.scrollStart=(Qf===!0?N.scrollMaxSize-N.scrollViewSize:0)-N.scrollStart)):(r===window?(N.scrollStart=window.pageYOffset||window.scrollY||document.body.scrollTop||0,N.scrollViewSize+=document.documentElement.clientHeight):(N.scrollStart=D.scrollTop,N.scrollViewSize+=D.clientHeight),N.scrollMaxSize=D.scrollHeight),p!==null)for(let F=p.previousElementSibling;F!==null;F=F.previousElementSibling)F.classList.contains("q-virtual-scroll--skip")===!1&&(N.offsetStart+=F[V]);if(y!==null)for(let F=y.nextElementSibling;F!==null;F=F.nextElementSibling)F.classList.contains("q-virtual-scroll--skip")===!1&&(N.offsetEnd+=F[V]);if(h!==r){const F=D.getBoundingClientRect(),q=h.getBoundingClientRect();b===!0?(N.offsetStart+=q.left-F.left,N.offsetEnd-=q.width):(N.offsetStart+=q.top-F.top,N.offsetEnd-=q.height),r!==window&&(N.offsetStart+=N.scrollStart),N.offsetEnd+=N.scrollMaxSize-N.offsetStart}return N}function x0(r,h,p,y){h==="end"&&(h=(r===window?document.body:r)[p===!0?"scrollWidth":"scrollHeight"]),r===window?p===!0?(y===!0&&(h=(Qf===!0?document.body.scrollWidth-document.documentElement.clientWidth:0)-h),window.scrollTo(h,window.pageYOffset||window.scrollY||document.body.scrollTop||0)):window.scrollTo(window.pageXOffset||window.scrollX||document.body.scrollLeft||0,h):p===!0?(y===!0&&(h=(Qf===!0?r.scrollWidth-r.offsetWidth:0)-h),r.scrollLeft=h):r.scrollTop=h}function ph(r,h,p,y){if(p>=y)return 0;const b=h.length,E=Math.floor(p/mo),A=Math.floor((y-1)/mo)+1;let s=r.slice(E,A).reduce(Cc,0);return p%mo!==0&&(s-=h.slice(E*mo,p).reduce(Cc,0)),y%mo!==0&&y!==b&&(s-=h.slice(y,A*mo).reduce(Cc,0)),s}const rM={virtualScrollSliceSize:{type:[Number,String],default:null},virtualScrollSliceRatioBefore:{type:[Number,String],default:1},virtualScrollSliceRatioAfter:{type:[Number,String],default:1},virtualScrollItemSize:{type:[Number,String],default:24},virtualScrollStickySizeStart:{type:[Number,String],default:0},virtualScrollStickySizeEnd:{type:[Number,String],default:0},tableColspan:[Number,String]},oM={virtualScrollHorizontal:Boolean,onVirtualScroll:Function,...rM};function sM({virtualScrollLength:r,getVirtualScrollTarget:h,getVirtualScrollEl:p,virtualScrollItemSizeComputed:y}){const b=Oi(),{props:E,emit:A,proxy:s}=b,{$q:D}=s;let V,N,F,q=[],H;const de=Rt(0),ye=Rt(0),ze=Rt({}),He=Rt(null),we=Rt(null),Le=Rt(null),Ne=Rt({from:0,to:0}),Te=be(()=>E.tableColspan!==void 0?E.tableColspan:100);y===void 0&&(y=be(()=>E.virtualScrollItemSize));const Pe=be(()=>y.value+";"+E.virtualScrollHorizontal),xe=be(()=>Pe.value+";"+E.virtualScrollSliceRatioBefore+";"+E.virtualScrollSliceRatioAfter);ri(xe,()=>{Ht()}),ri(Pe,De);function De(){Ot(N,!0)}function Ke(_t){Ot(_t===void 0?N:_t)}function Ue(_t,xt){const Lt=h();if(Lt==null||Lt.nodeType===8)return;const pi=c_(Lt,p(),He.value,we.value,E.virtualScrollHorizontal,D.lang.rtl,E.virtualScrollStickySizeStart,E.virtualScrollStickySizeEnd);F!==pi.scrollViewSize&&Ht(pi.scrollViewSize),$e(Lt,pi,Math.min(r.value-1,Math.max(0,parseInt(_t,10)||0)),0,iM.indexOf(xt)>-1?xt:N>-1&&_t>N?"end":"start")}function nt(){const _t=h();if(_t==null||_t.nodeType===8)return;const xt=c_(_t,p(),He.value,we.value,E.virtualScrollHorizontal,D.lang.rtl,E.virtualScrollStickySizeStart,E.virtualScrollStickySizeEnd),Lt=r.value-1,pi=xt.scrollMaxSize-xt.offsetStart-xt.offsetEnd-ye.value;if(V===xt.scrollStart)return;if(xt.scrollMaxSize<=0){$e(_t,xt,0,0);return}F!==xt.scrollViewSize&&Ht(xt.scrollViewSize),Ge(Ne.value.from);const Ci=Math.floor(xt.scrollMaxSize-Math.max(xt.scrollViewSize,xt.offsetEnd)-Math.min(H[Lt],xt.scrollViewSize/2));if(Ci>0&&Math.ceil(xt.scrollStart)>=Ci){$e(_t,xt,Lt,xt.scrollMaxSize-xt.offsetEnd-q.reduce(Cc,0));return}let Kt=0,Yt=xt.scrollStart-xt.offsetStart,Jt=Yt;if(Yt<=pi&&Yt+xt.scrollViewSize>=de.value)Yt-=de.value,Kt=Ne.value.from,Jt=Yt;else for(let Et=0;Yt>=q[Et]&&Kt<Lt;Et++)Yt-=q[Et],Kt+=mo;for(;Yt>0&&Kt<Lt;)Yt-=H[Kt],Yt>-xt.scrollViewSize?(Kt++,Jt=Yt):Jt=H[Kt]+Yt;$e(_t,xt,Kt,Jt)}function $e(_t,xt,Lt,pi,Ci){const Kt=typeof Ci=="string"&&Ci.indexOf("-force")>-1,Yt=Kt===!0?Ci.replace("-force",""):Ci,Jt=Yt!==void 0?Yt:"start";let Et=Math.max(0,Lt-ze.value[Jt]),Bi=Et+ze.value.total;Bi>r.value&&(Bi=r.value,Et=Math.max(0,Bi-ze.value.total)),V=xt.scrollStart;const Tn=Et!==Ne.value.from||Bi!==Ne.value.to;if(Tn===!1&&Yt===void 0){At(Lt);return}const{activeElement:ue}=document,Ee=Le.value;Tn===!0&&Ee!==null&&Ee!==ue&&Ee.contains(ue)===!0&&(Ee.addEventListener("focusout",Ye),setTimeout(()=>{Ee!==null&&Ee.removeEventListener("focusout",Ye)})),nM(Ee,Lt-Et);const Re=Yt!==void 0?H.slice(Et,Lt).reduce(Cc,0):0;if(Tn===!0){const ct=Bi>=Ne.value.from&&Et<=Ne.value.to?Ne.value.to:Bi;Ne.value={from:Et,to:ct},de.value=ph(q,H,0,Et),ye.value=ph(q,H,Bi,r.value),requestAnimationFrame(()=>{Ne.value.to!==Bi&&V===xt.scrollStart&&(Ne.value={from:Ne.value.from,to:Bi},ye.value=ph(q,H,Bi,r.value))})}requestAnimationFrame(()=>{if(V!==xt.scrollStart)return;Tn===!0&&Ge(Et);const ct=H.slice(Et,Lt).reduce(Cc,0),ut=ct+xt.offsetStart+de.value,bt=ut+H[Lt];let Mt=ut+pi;if(Yt!==void 0){const gt=ct-Re,Xe=xt.scrollStart+gt;Mt=Kt!==!0&&Xe<ut&&bt<Xe+xt.scrollViewSize?Xe:Yt==="end"?bt-xt.scrollViewSize:ut-(Yt==="start"?0:Math.round((xt.scrollViewSize-H[Lt])/2))}V=Mt,x0(_t,Mt,E.virtualScrollHorizontal,D.lang.rtl),At(Lt)})}function Ge(_t){const xt=Le.value;if(xt){const Lt=Ab.call(xt.children,Et=>Et.classList&&Et.classList.contains("q-virtual-scroll--skip")===!1),pi=Lt.length,Ci=E.virtualScrollHorizontal===!0?Et=>Et.getBoundingClientRect().width:Et=>Et.offsetHeight;let Kt=_t,Yt,Jt;for(let Et=0;Et<pi;){for(Yt=Ci(Lt[Et]),Et++;Et<pi&&Lt[Et].classList.contains("q-virtual-scroll--with-prev")===!0;)Yt+=Ci(Lt[Et]),Et++;Jt=Yt-H[Kt],Jt!==0&&(H[Kt]+=Jt,q[Math.floor(Kt/mo)]+=Jt),Kt++}}}function Ye(){Le.value!==null&&Le.value!==void 0&&Le.value.focus()}function Ot(_t,xt){const Lt=1*y.value;(xt===!0||Array.isArray(H)===!1)&&(H=[]);const pi=H.length;H.length=r.value;for(let Kt=r.value-1;Kt>=pi;Kt--)H[Kt]=Lt;const Ci=Math.floor((r.value-1)/mo);q=[];for(let Kt=0;Kt<=Ci;Kt++){let Yt=0;const Jt=Math.min((Kt+1)*mo,r.value);for(let Et=Kt*mo;Et<Jt;Et++)Yt+=H[Et];q.push(Yt)}N=-1,V=void 0,de.value=ph(q,H,0,Ne.value.from),ye.value=ph(q,H,Ne.value.to,r.value),_t>=0?(Ge(Ne.value.from),fn(()=>{Ue(_t)})):di()}function Ht(_t){if(_t===void 0&&typeof window<"u"){const Yt=h();Yt!=null&&Yt.nodeType!==8&&(_t=c_(Yt,p(),He.value,we.value,E.virtualScrollHorizontal,D.lang.rtl,E.virtualScrollStickySizeStart,E.virtualScrollStickySizeEnd).scrollViewSize)}F=_t;const xt=parseFloat(E.virtualScrollSliceRatioBefore)||0,Lt=parseFloat(E.virtualScrollSliceRatioAfter)||0,pi=1+xt+Lt,Ci=_t===void 0||_t<=0?1:Math.ceil(_t/y.value),Kt=Math.max(1,Ci,Math.ceil((E.virtualScrollSliceSize>0?E.virtualScrollSliceSize:10)/pi));ze.value={total:Math.ceil(Kt*pi),start:Math.ceil(Kt*xt),center:Math.ceil(Kt*(.5+xt)),end:Math.ceil(Kt*(1+xt)),view:Ci}}function ot(_t,xt){const Lt=E.virtualScrollHorizontal===!0?"width":"height",pi={["--q-virtual-scroll-item-"+Lt]:y.value+"px"};return[_t==="tbody"?Ie(_t,{class:"q-virtual-scroll__padding",key:"before",ref:He},[Ie("tr",[Ie("td",{style:{[Lt]:`${de.value}px`,...pi},colspan:Te.value})])]):Ie(_t,{class:"q-virtual-scroll__padding",key:"before",ref:He,style:{[Lt]:`${de.value}px`,...pi}}),Ie(_t,{class:"q-virtual-scroll__content",key:"content",ref:Le,tabindex:-1},xt.flat()),_t==="tbody"?Ie(_t,{class:"q-virtual-scroll__padding",key:"after",ref:we},[Ie("tr",[Ie("td",{style:{[Lt]:`${ye.value}px`,...pi},colspan:Te.value})])]):Ie(_t,{class:"q-virtual-scroll__padding",key:"after",ref:we,style:{[Lt]:`${ye.value}px`,...pi}})]}function At(_t){N!==_t&&(E.onVirtualScroll!==void 0&&A("virtual-scroll",{index:_t,from:Ne.value.from,to:Ne.value.to-1,direction:_t<N?"decrease":"increase",ref:s}),N=_t)}Ht();const di=cg(nt,D.platform.is.ios===!0?120:35);eg(()=>{Ht()});let Oe=!1;return Bc(()=>{Oe=!0}),lp(()=>{if(Oe!==!0)return;const _t=h();V!==void 0&&_t!==void 0&&_t!==null&&_t.nodeType!==8?x0(_t,V,E.virtualScrollHorizontal,D.lang.rtl):Ue(N)}),_n(()=>{di.cancel()}),Object.assign(s,{scrollTo:Ue,reset:De,refresh:Ke}),{virtualScrollSliceRange:Ne,virtualScrollSliceSizeComputed:ze,setVirtualScrollSize:Ht,onVirtualScrollEvt:di,localResetVirtualScroll:Ot,padVirtualScroll:ot,scrollTo:Ue,reset:De,refresh:Ke}}function b0(r,h,p){if(p<=h)return h;const y=p-h+1;let b=h+(r-h)%y;return b<h&&(b=y+b),b===0?0:b}const w0=r=>["add","add-unique","toggle"].includes(r),aM=".*+?^${}()|[]\\",lM=Object.keys(yp),T0=$i({name:"QSelect",inheritAttrs:!1,props:{...oM,...wg,...yp,modelValue:{required:!0},multiple:Boolean,displayValue:[String,Number],displayValueHtml:Boolean,dropdownIcon:String,options:{type:Array,default:()=>[]},optionValue:[Function,String],optionLabel:[Function,String],optionDisable:[Function,String],hideSelected:Boolean,hideDropdownIcon:Boolean,fillInput:Boolean,maxValues:[Number,String],optionsDense:Boolean,optionsDark:{type:Boolean,default:null},optionsSelectedClass:String,optionsHtml:Boolean,optionsCover:Boolean,menuShrink:Boolean,menuAnchor:String,menuSelf:String,menuOffset:Array,popupContentClass:String,popupContentStyle:[String,Array,Object],useInput:Boolean,useChips:Boolean,newValueMode:{type:String,validator:w0},mapOptions:Boolean,emitValue:Boolean,inputDebounce:{type:[Number,String],default:500},inputClass:[Array,String,Object],inputStyle:[Array,String,Object],tabindex:{type:[String,Number],default:0},autocomplete:String,transitionShow:String,transitionHide:String,transitionDuration:[String,Number],behavior:{type:String,validator:r=>["default","menu","dialog"].includes(r),default:"default"},virtualScrollItemSize:{type:[Number,String],default:void 0},onNewValue:Function,onFilter:Function},emits:[...vg,"add","remove","input-value","new-value","keyup","keypress","keydown","filter-abort"],setup(r,{slots:h,emit:p}){const{proxy:y}=Oi(),{$q:b}=y,E=Rt(!1),A=Rt(!1),s=Rt(-1),D=Rt(""),V=Rt(!1),N=Rt(!1);let F,q,H,de,ye,ze,He,we,Le;const Ne=Rt(null),Te=Rt(null),Pe=Rt(null),xe=Rt(null),De=Rt(null),Ke=pb(r),Ue=mb(to),nt=be(()=>Array.isArray(r.options)?r.options.length:0),$e=be(()=>r.virtualScrollItemSize===void 0?r.optionsDense===!0?24:48:r.virtualScrollItemSize),{virtualScrollSliceRange:Ge,virtualScrollSliceSizeComputed:Ye,localResetVirtualScroll:Ot,padVirtualScroll:Ht,onVirtualScrollEvt:ot,scrollTo:At,setVirtualScrollSize:di}=sM({virtualScrollLength:nt,getVirtualScrollTarget:ws,getVirtualScrollEl:Ho,virtualScrollItemSizeComputed:$e}),Oe=xg(),_t=be(()=>{const ce=r.mapOptions===!0&&r.multiple!==!0,vt=r.modelValue!==void 0&&(r.modelValue!==null||ce===!0)?r.multiple===!0&&Array.isArray(r.modelValue)?r.modelValue:[r.modelValue]:[];if(r.mapOptions===!0&&Array.isArray(r.options)===!0){const Ze=r.mapOptions===!0&&q!==void 0?q:[],Ce=vt.map(wi=>_r(wi,Ze));return r.modelValue===null&&ce===!0?Ce.filter(wi=>wi!==null):Ce}return vt}),xt=be(()=>{const ce={};return lM.forEach(vt=>{const Ze=r[vt];Ze!==void 0&&(ce[vt]=Ze)}),ce}),Lt=be(()=>r.optionsDark===null?Oe.isDark.value:r.optionsDark),pi=be(()=>Bh(_t.value)),Ci=be(()=>{let ce="q-field__input q-placeholder col";return r.hideSelected===!0||_t.value.length===0?[ce,r.inputClass]:(ce+=" q-field__input--padding",r.inputClass===void 0?ce:[ce,r.inputClass])}),Kt=be(()=>(r.virtualScrollHorizontal===!0?"q-virtual-scroll--horizontal":"")+(r.popupContentClass?" "+r.popupContentClass:"")),Yt=be(()=>nt.value===0),Jt=be(()=>_t.value.map(ce=>Xe.value(ce)).join(", ")),Et=be(()=>r.optionsHtml===!0?()=>!0:ce=>ce!=null&&ce.html===!0),Bi=be(()=>r.displayValueHtml===!0||r.displayValue===void 0&&(r.optionsHtml===!0||_t.value.some(Et.value))),Tn=be(()=>Oe.focused.value===!0?r.tabindex:-1),ue=be(()=>({tabindex:r.tabindex,role:"combobox","aria-label":r.label,"aria-readonly":r.readonly===!0?"true":"false","aria-autocomplete":r.useInput===!0?"list":"none","aria-expanded":E.value===!0?"true":"false","aria-owns":`${Oe.targetUid.value}_lb`,"aria-controls":`${Oe.targetUid.value}_lb`})),Ee=be(()=>{const ce={id:`${Oe.targetUid.value}_lb`,role:"listbox","aria-multiselectable":r.multiple===!0?"true":"false"};return s.value>=0&&(ce["aria-activedescendant"]=`${Oe.targetUid.value}_${s.value}`),ce}),Re=be(()=>_t.value.map((ce,vt)=>({index:vt,opt:ce,html:Et.value(ce),selected:!0,removeAtIndex:mi,toggleOption:si,tabindex:Tn.value}))),ct=be(()=>{if(nt.value===0)return[];const{from:ce,to:vt}=Ge.value;return r.options.slice(ce,vt).map((Ze,Ce)=>{const wi=ht.value(Ze)===!0,ni=ce+Ce,Gi={clickable:!0,active:!1,activeClass:Mt.value,manualFocus:!0,focused:!1,disable:wi,tabindex:-1,dense:r.optionsDense,dark:Lt.value,role:"option",id:`${Oe.targetUid.value}_${ni}`,onClick:()=>{si(Ze)}};return wi!==!0&&(kn(Ze)===!0&&(Gi.active=!0),s.value===ni&&(Gi.focused=!0),Gi["aria-selected"]=Gi.active===!0?"true":"false",b.platform.is.desktop===!0&&(Gi.onMousemove=()=>{E.value===!0&&Ai(ni)})),{index:ni,opt:Ze,html:Et.value(Ze),label:Xe.value(Ze),selected:Gi.active,focused:Gi.focused,toggleOption:si,setOptionIndex:Ai,itemProps:Gi}})}),ut=be(()=>r.dropdownIcon!==void 0?r.dropdownIcon:b.iconSet.arrow.dropdown),bt=be(()=>r.optionsCover===!1&&r.outlined!==!0&&r.standout!==!0&&r.borderless!==!0&&r.rounded!==!0),Mt=be(()=>r.optionsSelectedClass!==void 0?r.optionsSelectedClass:r.color!==void 0?`text-${r.color}`:""),gt=be(()=>Cn(r.optionValue,"value")),Xe=be(()=>Cn(r.optionLabel,"label")),ht=be(()=>Cn(r.optionDisable,"disable")),qt=be(()=>_t.value.map(ce=>gt.value(ce))),Nt=be(()=>{const ce={onInput:to,onChange:Ue,onKeydown:Eo,onKeyup:zn,onKeypress:Pr,onFocus:qr,onClick(vt){H===!0&&$o(vt)}};return ce.onCompositionstart=ce.onCompositionupdate=ce.onCompositionend=Ue,ce});ri(_t,ce=>{q=ce,r.useInput===!0&&r.fillInput===!0&&r.multiple!==!0&&Oe.innerLoading.value!==!0&&(A.value!==!0&&E.value!==!0||pi.value!==!0)&&(de!==!0&&st(),(A.value===!0||E.value===!0)&&Er(""))},{immediate:!0}),ri(()=>r.fillInput,st),ri(E,$t),ri(nt,Xt);function Zt(ce){return r.emitValue===!0?gt.value(ce):ce}function ti(ce){if(ce>-1&&ce<_t.value.length)if(r.multiple===!0){const vt=r.modelValue.slice();p("remove",{index:ce,value:vt.splice(ce,1)[0]}),p("update:modelValue",vt)}else p("update:modelValue",null)}function mi(ce){ti(ce),Oe.focus()}function zi(ce,vt){const Ze=Zt(ce);if(r.multiple!==!0){r.fillInput===!0&&An(Xe.value(ce),!0,!0),p("update:modelValue",Ze);return}if(_t.value.length===0){p("add",{index:0,value:Ze}),p("update:modelValue",r.multiple===!0?[Ze]:Ze);return}if(vt===!0&&kn(ce)===!0||r.maxValues!==void 0&&r.modelValue.length>=r.maxValues)return;const Ce=r.modelValue.slice();p("add",{index:Ce.length,value:Ze}),Ce.push(Ze),p("update:modelValue",Ce)}function si(ce,vt){if(Oe.editable.value!==!0||ce===void 0||ht.value(ce)===!0)return;const Ze=gt.value(ce);if(r.multiple!==!0){vt!==!0&&(An(r.fillInput===!0?Xe.value(ce):"",!0,!0),Ct()),Te.value!==null&&Te.value.focus(),(_t.value.length===0||ra(gt.value(_t.value[0]),Ze)!==!0)&&p("update:modelValue",r.emitValue===!0?Ze:ce);return}if((H!==!0||V.value===!0)&&Oe.focus(),qr(),_t.value.length===0){const ni=r.emitValue===!0?Ze:ce;p("add",{index:0,value:ni}),p("update:modelValue",r.multiple===!0?[ni]:ni);return}const Ce=r.modelValue.slice(),wi=qt.value.findIndex(ni=>ra(ni,Ze));if(wi>-1)p("remove",{index:wi,value:Ce.splice(wi,1)[0]});else{if(r.maxValues!==void 0&&Ce.length>=r.maxValues)return;const ni=r.emitValue===!0?Ze:ce;p("add",{index:Ce.length,value:ni}),Ce.push(ni)}p("update:modelValue",Ce)}function Ai(ce){if(b.platform.is.desktop!==!0)return;const vt=ce>-1&&ce<nt.value?ce:-1;s.value!==vt&&(s.value=vt)}function hn(ce=1,vt){if(E.value===!0){let Ze=s.value;do Ze=b0(Ze+ce,-1,nt.value-1);while(Ze!==-1&&Ze!==s.value&&ht.value(r.options[Ze])===!0);s.value!==Ze&&(Ai(Ze),At(Ze),vt!==!0&&r.useInput===!0&&r.fillInput===!0&&io(Ze>=0?Xe.value(r.options[Ze]):ze))}}function _r(ce,vt){const Ze=Ce=>ra(gt.value(Ce),ce);return r.options.find(Ze)||vt.find(Ze)||ce}function Cn(ce,vt){const Ze=ce!==void 0?ce:vt;return typeof Ze=="function"?Ze:Ce=>Ce!==null&&typeof Ce=="object"&&Ze in Ce?Ce[Ze]:Ce}function kn(ce){const vt=gt.value(ce);return qt.value.find(Ze=>ra(Ze,vt))!==void 0}function qr(ce){r.useInput===!0&&Te.value!==null&&(ce===void 0||Te.value===ce.target&&ce.target.value===Jt.value)&&Te.value.select()}function gn(ce){la(ce,27)===!0&&E.value===!0&&($o(ce),Ct(),st()),p("keyup",ce)}function zn(ce){const{value:vt}=ce.target;if(ce.keyCode!==void 0){gn(ce);return}if(ce.target.value="",clearTimeout(F),st(),typeof vt=="string"&&vt.length>0){const Ze=vt.toLocaleLowerCase(),Ce=ni=>{const Gi=r.options.find(Mn=>ni.value(Mn).toLocaleLowerCase()===Ze);return Gi===void 0?!1:(_t.value.indexOf(Gi)===-1?si(Gi):Ct(),!0)},wi=ni=>{Ce(gt)!==!0&&(Ce(Xe)===!0||ni===!0||Er(vt,!0,()=>wi(!0)))};wi()}else Oe.clearValue(ce)}function Pr(ce){p("keypress",ce)}function Eo(ce){if(p("keydown",ce),ug(ce)===!0)return;const vt=D.value.length>0&&(r.newValueMode!==void 0||r.onNewValue!==void 0),Ze=ce.shiftKey!==!0&&r.multiple!==!0&&(s.value>-1||vt===!0);if(ce.keyCode===27){Nr(ce);return}if(ce.keyCode===9&&Ze===!1){ke();return}if(ce.target===void 0||ce.target.id!==Oe.targetUid.value)return;if(ce.keyCode===40&&Oe.innerLoading.value!==!0&&E.value===!1){xn(ce),Qe();return}if(ce.keyCode===8&&r.hideSelected!==!0&&D.value.length===0){r.multiple===!0&&Array.isArray(r.modelValue)===!0?ti(r.modelValue.length-1):r.multiple!==!0&&r.modelValue!==null&&p("update:modelValue",null);return}(ce.keyCode===35||ce.keyCode===36)&&(typeof D.value!="string"||D.value.length===0)&&(xn(ce),s.value=-1,hn(ce.keyCode===36?1:-1,r.multiple)),(ce.keyCode===33||ce.keyCode===34)&&Ye.value!==void 0&&(xn(ce),s.value=Math.max(-1,Math.min(nt.value,s.value+(ce.keyCode===33?-1:1)*Ye.value.view)),hn(ce.keyCode===33?1:-1,r.multiple)),(ce.keyCode===38||ce.keyCode===40)&&(xn(ce),hn(ce.keyCode===38?-1:1,r.multiple));const Ce=nt.value;if((we===void 0||Le<Date.now())&&(we=""),Ce>0&&r.useInput!==!0&&ce.key!==void 0&&ce.key.length===1&&ce.altKey===ce.ctrlKey&&(ce.keyCode!==32||we.length>0)){E.value!==!0&&Qe(ce);const wi=ce.key.toLocaleLowerCase(),ni=we.length===1&&we[0]===wi;Le=Date.now()+1500,ni===!1&&(xn(ce),we+=wi);const Gi=new RegExp("^"+we.split("").map(Kn=>aM.indexOf(Kn)>-1?"\\"+Kn:Kn).join(".*"),"i");let Mn=s.value;if(ni===!0||Mn<0||Gi.test(Xe.value(r.options[Mn]))!==!0)do Mn=b0(Mn+1,-1,Ce-1);while(Mn!==s.value&&(ht.value(r.options[Mn])===!0||Gi.test(Xe.value(r.options[Mn]))!==!0));s.value!==Mn&&fn(()=>{Ai(Mn),At(Mn),Mn>=0&&r.useInput===!0&&r.fillInput===!0&&io(Xe.value(r.options[Mn]))});return}if(!(ce.keyCode!==13&&(ce.keyCode!==32||r.useInput===!0||we!=="")&&(ce.keyCode!==9||Ze===!1))){if(ce.keyCode!==9&&xn(ce),s.value>-1&&s.value<Ce){si(r.options[s.value]);return}if(vt===!0){const wi=(ni,Gi)=>{if(Gi){if(w0(Gi)!==!0)return}else Gi=r.newValueMode;if(ni==null)return;An("",r.multiple!==!0,!0),(Gi==="toggle"?si:zi)(ni,Gi==="add-unique"),r.multiple!==!0&&(Te.value!==null&&Te.value.focus(),Ct())};if(r.onNewValue!==void 0?p("new-value",D.value,wi):wi(D.value),r.multiple!==!0)return}E.value===!0?ke():Oe.innerLoading.value!==!0&&Qe()}}function Ho(){return H===!0?De.value:Pe.value!==null&&Pe.value.__qPortalInnerRef.value!==null?Pe.value.__qPortalInnerRef.value:void 0}function ws(){return Ho()}function da(){return r.hideSelected===!0?[]:h["selected-item"]!==void 0?Re.value.map(ce=>h["selected-item"](ce)).slice():h.selected!==void 0?[].concat(h.selected()):r.useChips===!0?Re.value.map((ce,vt)=>Ie(CA,{key:"option-"+vt,removable:Oe.editable.value===!0&&ht.value(ce.opt)!==!0,dense:!0,textColor:r.color,tabindex:Tn.value,onRemove(){ce.removeAtIndex(vt)}},()=>Ie("span",{class:"ellipsis",[ce.html===!0?"innerHTML":"textContent"]:Xe.value(ce.opt)}))):[Ie("span",{[Bi.value===!0?"innerHTML":"textContent"]:r.displayValue!==void 0?r.displayValue:Jt.value})]}function Dr(){if(Yt.value===!0)return h["no-option"]!==void 0?h["no-option"]({inputValue:D.value}):void 0;const ce=h.option!==void 0?h.option:Ze=>Ie(AA,{key:Ze.index,...Ze.itemProps},()=>Ie(MA,()=>Ie(IA,()=>Ie("span",{[Ze.html===!0?"innerHTML":"textContent"]:Ze.label}))));let vt=Ht("div",ct.value.map(ce));return h["before-options"]!==void 0&&(vt=h["before-options"]().concat(vt)),Jr(h["after-options"],vt)}function Lr(ce,vt){const Ze=vt===!0?{...ue.value,...Oe.splitAttrs.attributes.value}:void 0,Ce={ref:vt===!0?Te:void 0,key:"i_t",class:Ci.value,style:r.inputStyle,value:D.value!==void 0?D.value:"",type:"search",...Ze,id:vt===!0?Oe.targetUid.value:void 0,maxlength:r.maxlength,autocomplete:r.autocomplete,"data-autofocus":ce!==!0&&r.autofocus===!0||void 0,disabled:r.disable===!0,readonly:r.readonly===!0,...Nt.value};return ce!==!0&&H===!0&&(Array.isArray(Ce.class)===!0?Ce.class=[...Ce.class,"no-pointer-events"]:Ce.class+=" no-pointer-events"),Ie("input",Ce)}function to(ce){clearTimeout(F),!(ce&&ce.target&&ce.target.qComposing===!0)&&(io(ce.target.value||""),de=!0,ze=D.value,Oe.focused.value!==!0&&(H!==!0||V.value===!0)&&Oe.focus(),r.onFilter!==void 0&&(F=setTimeout(()=>{Er(D.value)},r.inputDebounce)))}function io(ce){D.value!==ce&&(D.value=ce,p("input-value",ce))}function An(ce,vt,Ze){de=Ze!==!0,r.useInput===!0&&(io(ce),(vt===!0||Ze!==!0)&&(ze=ce),vt!==!0&&Er(ce))}function Er(ce,vt,Ze){if(r.onFilter===void 0||vt!==!0&&Oe.focused.value!==!0)return;Oe.innerLoading.value===!0?p("filter-abort"):(Oe.innerLoading.value=!0,N.value=!0),ce!==""&&r.multiple!==!0&&_t.value.length>0&&de!==!0&&ce===Xe.value(_t.value[0])&&(ce="");const Ce=setTimeout(()=>{E.value===!0&&(E.value=!1)},10);clearTimeout(ye),ye=Ce,p("filter",ce,(wi,ni)=>{(vt===!0||Oe.focused.value===!0)&&ye===Ce&&(clearTimeout(ye),typeof wi=="function"&&wi(),N.value=!1,fn(()=>{Oe.innerLoading.value=!1,Oe.editable.value===!0&&(vt===!0?E.value===!0&&Ct():E.value===!0?$t(!0):E.value=!0),typeof ni=="function"&&fn(()=>{ni(y)}),typeof Ze=="function"&&fn(()=>{Ze(y)})}))},()=>{Oe.focused.value===!0&&ye===Ce&&(clearTimeout(ye),Oe.innerLoading.value=!1,N.value=!1),E.value===!0&&(E.value=!1)})}function Q(){return Ie(XA,{ref:Pe,class:Kt.value,style:r.popupContentStyle,modelValue:E.value,fit:r.menuShrink!==!0,cover:r.optionsCover===!0&&Yt.value!==!0&&r.useInput!==!0,anchor:r.menuAnchor,self:r.menuSelf,offset:r.menuOffset,dark:Lt.value,noParentEvent:!0,noRefocus:!0,noFocus:!0,square:bt.value,transitionShow:r.transitionShow,transitionHide:r.transitionHide,transitionDuration:r.transitionDuration,separateClosePopup:!0,...Ee.value,onScrollPassive:ot,onBeforeShow:Qt,onBeforeHide:B,onShow:O},Dr)}function B(ce){ci(ce),ke()}function O(){di()}function J(ce){$o(ce),Te.value!==null&&Te.value.focus(),V.value=!0,window.scrollTo(window.pageXOffset||window.scrollX||document.body.scrollLeft||0,0)}function ne(ce){$o(ce),fn(()=>{V.value=!1})}function _e(){const ce=[Ie(EA,{class:`col-auto ${Oe.fieldClass.value}`,...xt.value,for:Oe.targetUid.value,dark:Lt.value,square:!0,loading:N.value,itemAligned:!1,filled:!0,stackLabel:D.value.length>0,...Oe.splitAttrs.listeners.value,onFocus:J,onBlur:ne},{...h,rawControl:()=>Oe.getControl(!0),before:void 0,after:void 0})];return E.value===!0&&ce.push(Ie("div",{ref:De,class:Kt.value+" scroll",style:r.popupContentStyle,...Ee.value,onClick:Nr,onScrollPassive:ot},Dr())),Ie(D_,{ref:xe,modelValue:A.value,position:r.useInput===!0?"top":void 0,transitionShow:He,transitionHide:r.transitionHide,transitionDuration:r.transitionDuration,onBeforeShow:Qt,onBeforeHide:Me,onHide:Se,onShow:ge},()=>Ie("div",{class:"q-select__dialog"+(Lt.value===!0?" q-select__dialog--dark q-dark":"")+(V.value===!0?" q-select__dialog--focused":"")},ce))}function Me(ce){ci(ce),xe.value!==null&&xe.value.__updateRefocusTarget(Oe.rootRef.value.querySelector(".q-field__native > [tabindex]:last-child")),Oe.focused.value=!1}function Se(ce){Ct(),Oe.focused.value===!1&&p("blur",ce),st()}function ge(){const ce=document.activeElement;(ce===null||ce.id!==Oe.targetUid.value)&&Te.value!==null&&Te.value!==ce&&Te.value.focus(),di()}function ke(){A.value!==!0&&(s.value=-1,E.value===!0&&(E.value=!1),Oe.focused.value===!1&&(clearTimeout(ye),ye=void 0,Oe.innerLoading.value===!0&&(p("filter-abort"),Oe.innerLoading.value=!1,N.value=!1)))}function Qe(ce){Oe.editable.value===!0&&(H===!0?(Oe.onControlFocusin(ce),A.value=!0,fn(()=>{Oe.focus()})):Oe.focus(),r.onFilter!==void 0?Er(D.value):(Yt.value!==!0||h["no-option"]!==void 0)&&(E.value=!0))}function Ct(){A.value=!1,ke()}function st(){r.useInput===!0&&An(r.multiple!==!0&&r.fillInput===!0&&_t.value.length>0&&Xe.value(_t.value[0])||"",!0,!0)}function $t(ce){let vt=-1;if(ce===!0){if(_t.value.length>0){const Ze=gt.value(_t.value[0]);vt=r.options.findIndex(Ce=>ra(gt.value(Ce),Ze))}Ot(vt)}Ai(vt)}function Xt(ce,vt){E.value===!0&&Oe.innerLoading.value===!1&&(Ot(-1,!0),fn(()=>{E.value===!0&&Oe.innerLoading.value===!1&&(ce>vt?Ot():$t(!0))}))}function jt(){A.value===!1&&Pe.value!==null&&Pe.value.updatePosition()}function Qt(ce){ce!==void 0&&$o(ce),p("popup-show",ce),Oe.hasPopupOpen=!0,Oe.onControlFocusin(ce)}function ci(ce){ce!==void 0&&$o(ce),p("popup-hide",ce),Oe.hasPopupOpen=!1,Oe.onControlFocusout(ce)}function Pi(){H=b.platform.is.mobile!==!0&&r.behavior!=="dialog"?!1:r.behavior!=="menu"&&(r.useInput===!0?h["no-option"]!==void 0||r.onFilter!==void 0||Yt.value===!1:!0),He=b.platform.is.ios===!0&&H===!0&&r.useInput===!0?"fade":r.transitionShow}return tg(Pi),ig(jt),Pi(),_n(()=>{clearTimeout(F)}),Object.assign(y,{showPopup:Qe,hidePopup:Ct,removeAtIndex:ti,add:zi,toggleOption:si,getOptionIndex:()=>s.value,setOptionIndex:Ai,moveOptionSelection:hn,filter:Er,updateMenuPosition:jt,updateInputValue:An,isOptionSelected:kn,getEmittingOptionValue:Zt,isOptionDisabled:(...ce)=>ht.value.apply(null,ce)===!0,getOptionValue:(...ce)=>gt.value.apply(null,ce),getOptionLabel:(...ce)=>Xe.value.apply(null,ce)}),Object.assign(Oe,{innerValue:_t,fieldClass:be(()=>`q-select q-field--auto-height q-select--with${r.useInput!==!0?"out":""}-input q-select--with${r.useChips!==!0?"out":""}-chips q-select--${r.multiple===!0?"multiple":"single"}`),inputRef:Ne,targetRef:Te,hasValue:pi,showPopup:Qe,floatingLabel:be(()=>r.hideSelected!==!0&&pi.value===!0||typeof D.value=="number"||D.value.length>0||Bh(r.displayValue)),getControlChild:()=>{if(Oe.editable.value!==!1&&(A.value===!0||Yt.value!==!0||h["no-option"]!==void 0))return H===!0?_e():Q();Oe.hasPopupOpen===!0&&(Oe.hasPopupOpen=!1)},controlEvents:{onFocusin(ce){Oe.onControlFocusin(ce)},onFocusout(ce){Oe.onControlFocusout(ce,()=>{st(),ke()})},onClick(ce){if(Nr(ce),H!==!0&&E.value===!0){ke(),Te.value!==null&&Te.value.focus();return}Qe(ce)}},getControl:ce=>{const vt=da(),Ze=ce===!0||A.value!==!0||H!==!0;if(r.useInput===!0)vt.push(Lr(ce,Ze));else if(Oe.editable.value===!0){const wi=Ze===!0?ue.value:void 0;vt.push(Ie("input",{ref:Ze===!0?Te:void 0,key:"d_t",class:"q-select__focus-target",id:Ze===!0?Oe.targetUid.value:void 0,readonly:!0,"data-autofocus":ce!==!0&&r.autofocus===!0||void 0,...wi,onKeydown:Eo,onKeyup:gn,onKeypress:Pr})),Ze===!0&&typeof r.autocomplete=="string"&&r.autocomplete.length>0&&vt.push(Ie("input",{class:"q-select__autocomplete-input",autocomplete:r.autocomplete,tabindex:-1,onKeyup:zn}))}if(Ke.value!==void 0&&r.disable!==!0&&qt.value.length>0){const wi=qt.value.map(ni=>Ie("option",{value:ni,selected:!0}));vt.push(Ie("select",{class:"hidden",name:Ke.value,multiple:r.multiple},wi))}const Ce=r.useInput===!0||Ze!==!0?void 0:Oe.splitAttrs.attributes.value;return Ie("div",{class:"q-field__native row items-center",...Ce},vt)},getInnerAppend:()=>r.loading!==!0&&N.value!==!0&&r.hideDropdownIcon!==!0?[Ie(jn,{class:"q-select__dropdown-icon"+(E.value===!0?" rotate-180":""),name:ut.value})]:null}),bg(Oe)}});function cM(r,h){const p=Rt(null),y=be(()=>r.disable===!0?null:Ie("span",{ref:p,class:"no-outline",tabindex:-1}));function b(E){const A=h.value;E!==void 0&&E.type.indexOf("key")===0?A!==null&&document.activeElement!==A&&A.contains(document.activeElement)===!0&&A.focus():p.value!==null&&(E===void 0||A!==null&&A.contains(E.target)===!0)&&p.value.focus()}return{refocusTargetEl:y,refocusTarget:b}}const uM={xs:30,sm:35,md:40,lg:50,xl:60},hM={...ua,..._p,...wg,modelValue:{required:!0,default:null},val:{},trueValue:{default:!0},falseValue:{default:!1},indeterminateValue:{default:null},checkedIcon:String,uncheckedIcon:String,indeterminateIcon:String,toggleOrder:{type:String,validator:r=>r==="tf"||r==="ft"},toggleIndeterminate:Boolean,label:String,leftLabel:Boolean,color:String,keepColor:Boolean,dense:Boolean,disable:Boolean,tabindex:[String,Number]},dM=["update:modelValue"];function fM(r,h){const{props:p,slots:y,emit:b,proxy:E}=Oi(),{$q:A}=E,s=ha(p,A),D=Rt(null),{refocusTargetEl:V,refocusTarget:N}=cM(p,D),F=gp(p,uM),q=be(()=>p.val!==void 0&&Array.isArray(p.modelValue)),H=be(()=>{const $e=Li(p.val);return q.value===!0?p.modelValue.findIndex(Ge=>Li(Ge)===$e):-1}),de=be(()=>q.value===!0?H.value>-1:Li(p.modelValue)===Li(p.trueValue)),ye=be(()=>q.value===!0?H.value===-1:Li(p.modelValue)===Li(p.falseValue)),ze=be(()=>de.value===!1&&ye.value===!1),He=be(()=>p.disable===!0?-1:p.tabindex||0),we=be(()=>`q-${r} cursor-pointer no-outline row inline no-wrap items-center`+(p.disable===!0?" disabled":"")+(s.value===!0?` q-${r}--dark`:"")+(p.dense===!0?` q-${r}--dense`:"")+(p.leftLabel===!0?" reverse":"")),Le=be(()=>{const $e=de.value===!0?"truthy":ye.value===!0?"falsy":"indet",Ge=p.color!==void 0&&(p.keepColor===!0||(r==="toggle"?de.value===!0:ye.value!==!0))?` text-${p.color}`:"";return`q-${r}__inner relative-position non-selectable q-${r}__inner--${$e}${Ge}`}),Ne=be(()=>{const $e={type:"checkbox"};return p.name!==void 0&&Object.assign($e,{"^checked":de.value===!0?"checked":void 0,name:p.name,value:q.value===!0?p.val:p.trueValue}),$e}),Te=yA(Ne),Pe=be(()=>{const $e={tabindex:He.value,role:"checkbox","aria-label":p.label,"aria-checked":ze.value===!0?"mixed":de.value===!0?"true":"false"};return p.disable===!0&&($e["aria-disabled"]="true"),$e});function xe($e){$e!==void 0&&(xn($e),N($e)),p.disable!==!0&&b("update:modelValue",De(),$e)}function De(){if(q.value===!0){if(de.value===!0){const $e=p.modelValue.slice();return $e.splice(H.value,1),$e}return p.modelValue.concat([p.val])}if(de.value===!0){if(p.toggleOrder!=="ft"||p.toggleIndeterminate===!1)return p.falseValue}else if(ye.value===!0){if(p.toggleOrder==="ft"||p.toggleIndeterminate===!1)return p.trueValue}else return p.toggleOrder!=="ft"?p.trueValue:p.falseValue;return p.indeterminateValue}function Ke($e){($e.keyCode===13||$e.keyCode===32)&&xn($e)}function Ue($e){($e.keyCode===13||$e.keyCode===32)&&xe($e)}const nt=h(de,ze);return Object.assign(E,{toggle:xe}),()=>{const $e=nt();p.disable!==!0&&Te($e,"unshift",` q-${r}__native absolute q-ma-none q-pa-none`);const Ge=[Ie("div",{class:Le.value,style:F.value,"aria-hidden":"true"},$e)];V.value!==null&&Ge.push(V.value);const Ye=p.label!==void 0?Jr(y.default,[p.label]):bn(y.default);return Ye!==void 0&&Ge.push(Ie("div",{class:`q-${r}__label q-anchor--skip`},Ye)),Ie("div",{ref:D,class:we.value,...Pe.value,onClick:xe,onKeydown:Ke,onKeyup:Ue},Ge)}}const pM=$i({name:"QToggle",props:{...hM,icon:String,iconColor:String},emits:dM,setup(r){function h(p,y){const b=be(()=>(p.value===!0?r.checkedIcon:y.value===!0?r.indeterminateIcon:r.uncheckedIcon)||r.icon),E=be(()=>p.value===!0?r.iconColor:null);return()=>[Ie("div",{class:"q-toggle__track"}),Ie("div",{class:"q-toggle__thumb absolute flex flex-center no-wrap"},b.value!==void 0?[Ie(jn,{name:b.value,color:E.value})]:void 0)]}return fM("toggle",h)}}),mM=$i({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validation-success","validation-error"],setup(r,{slots:h,emit:p}){const y=Oi(),b=Rt(null);let E=0;const A=[];function s(H){const de=typeof H=="boolean"?H:r.noErrorFocus!==!0,ye=++E,ze=(Le,Ne)=>{p("validation-"+(Le===!0?"success":"error"),Ne)},He=Le=>{const Ne=Le.validate();return typeof Ne.then=="function"?Ne.then(Te=>({valid:Te,comp:Le}),Te=>({valid:!1,comp:Le,err:Te})):Promise.resolve({valid:Ne,comp:Le})};return(r.greedy===!0?Promise.all(A.map(He)).then(Le=>Le.filter(Ne=>Ne.valid!==!0)):A.reduce((Le,Ne)=>Le.then(()=>He(Ne).then(Te=>{if(Te.valid===!1)return Promise.reject(Te)})),Promise.resolve()).catch(Le=>[Le])).then(Le=>{if(Le===void 0||Le.length===0)return ye===E&&ze(!0),!0;if(ye===E){const{comp:Ne,err:Te}=Le[0];if(Te!==void 0&&console.error(Te),ze(!1,Ne),de===!0){const Pe=Le.find(({comp:xe})=>typeof xe.focus=="function"&&mg(xe.$)===!1);Pe!==void 0&&Pe.comp.focus()}}return!1})}function D(){E++,A.forEach(H=>{typeof H.resetValidation=="function"&&H.resetValidation()})}function V(H){H!==void 0&&xn(H);const de=E+1;s().then(ye=>{de===E&&ye===!0&&(r.onSubmit!==void 0?p("submit",H):H!==void 0&&H.target!==void 0&&typeof H.target.submit=="function"&&H.target.submit())})}function N(H){H!==void 0&&xn(H),p("reset"),fn(()=>{D(),r.autofocus===!0&&r.noResetFocus!==!0&&F()})}function F(){Oh(()=>{if(b.value===null)return;const H=b.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(b.value.querySelectorAll("[tabindex]"),de=>de.tabIndex>-1);H!=null&&H.focus({preventScroll:!0})})}Lc(G1,{bindComponent(H){A.push(H)},unbindComponent(H){const de=A.indexOf(H);de>-1&&A.splice(de,1)}});let q=!1;return Bc(()=>{q=!0}),lp(()=>{q===!0&&r.autofocus===!0&&F()}),sr(()=>{r.autofocus===!0&&F()}),Object.assign(y.proxy,{validate:s,resetValidation:D,submit:V,reset:N,focus:F,getValidationComponents:()=>A}),()=>Ie("form",{class:"q-form",ref:b,onSubmit:V,onReset:N},bn(h.default))}}),_M=Ie("div",{class:"q-space"}),E0=$i({name:"QSpace",setup(){return()=>_M}}),u_=$i({name:"QCardSection",props:{tag:{type:String,default:"div"},horizontal:Boolean},setup(r,{slots:h}){const p=be(()=>`q-card__section q-card__section--${r.horizontal===!0?"horiz row no-wrap":"vert"}`);return()=>Ie(r.tag,{class:p.value},bn(h.default))}}),S0=$i({name:"QCard",props:{...ua,tag:{type:String,default:"div"},square:Boolean,flat:Boolean,bordered:Boolean},setup(r,{slots:h}){const{proxy:{$q:p}}=Oi(),y=ha(r,p),b=be(()=>"q-card"+(y.value===!0?" q-card--dark q-dark":"")+(r.bordered===!0?" q-card--bordered":"")+(r.square===!0?" q-card--square no-border-radius":"")+(r.flat===!0?" q-card--flat no-shadow":""));return()=>Ie(r.tag,{class:b.value},bn(h.default))}});function C0(r){if(r===!1)return 0;if(r===!0||r===void 0)return 1;const h=parseInt(r,10);return isNaN(h)?0:h}const gM=hg({name:"close-popup",beforeMount(r,{value:h}){const p={depth:C0(h),handler(y){p.depth!==0&&setTimeout(()=>{const b=RA(r);b!==void 0&&FA(b,y,p.depth)})},handlerKey(y){la(y,13)===!0&&p.handler(y)}};r.__qclosepopup=p,r.addEventListener("click",p.handler),r.addEventListener("keyup",p.handlerKey)},updated(r,{value:h,oldValue:p}){h!==p&&(r.__qclosepopup.depth=C0(h))},beforeUnmount(r){const h=r.__qclosepopup;r.removeEventListener("click",h.handler),r.removeEventListener("keyup",h.handlerKey),delete r.__qclosepopup}});const yM={style:{display:"flex","justify-content":"center","align-items":"center"}},vM={class:"title"},Vh={__name:"Title",props:{title:{type:String,default:!1}},setup(r){return(h,p)=>(nr(),ca("div",yM,[Ei("p",vM,ta(r.title),1)]))}};function xM(){return bo(j1)}function Mb(r,h){return function(){return r.apply(h,arguments)}}const{toString:Ib}=Object.prototype,{getPrototypeOf:Tg}=Object,Eg=(r=>h=>{const p=Ib.call(h);return r[p]||(r[p]=p.slice(8,-1).toLowerCase())})(Object.create(null)),bs=r=>(r=r.toLowerCase(),h=>Eg(h)===r),vp=r=>h=>typeof h===r,{isArray:Uh}=Array,L_=vp("undefined");function bM(r){return r!==null&&!L_(r)&&r.constructor!==null&&!L_(r.constructor)&&Rc(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const kb=bs("ArrayBuffer");function wM(r){let h;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?h=ArrayBuffer.isView(r):h=r&&r.buffer&&kb(r.buffer),h}const TM=vp("string"),Rc=vp("function"),zb=vp("number"),Pb=r=>r!==null&&typeof r=="object",EM=r=>r===!0||r===!1,Rf=r=>{if(Eg(r)!=="object")return!1;const h=Tg(r);return(h===null||h===Object.prototype||Object.getPrototypeOf(h)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},SM=bs("Date"),CM=bs("File"),AM=bs("Blob"),MM=bs("FileList"),IM=r=>Pb(r)&&Rc(r.pipe),kM=r=>{const h="[object FormData]";return r&&(typeof FormData=="function"&&r instanceof FormData||Ib.call(r)===h||Rc(r.toString)&&r.toString()===h)},zM=bs("URLSearchParams"),PM=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function xp(r,h,{allOwnKeys:p=!1}={}){if(r===null||typeof r>"u")return;let y,b;if(typeof r!="object"&&(r=[r]),Uh(r))for(y=0,b=r.length;y<b;y++)h.call(null,r[y],y,r);else{const E=p?Object.getOwnPropertyNames(r):Object.keys(r),A=E.length;let s;for(y=0;y<A;y++)s=E[y],h.call(null,r[s],s,r)}}function B_(){const r={},h=(p,y)=>{Rf(r[y])&&Rf(p)?r[y]=B_(r[y],p):Rf(p)?r[y]=B_({},p):Uh(p)?r[y]=p.slice():r[y]=p};for(let p=0,y=arguments.length;p<y;p++)arguments[p]&&xp(arguments[p],h);return r}const DM=(r,h,p,{allOwnKeys:y}={})=>(xp(h,(b,E)=>{p&&Rc(b)?r[E]=Mb(b,p):r[E]=b},{allOwnKeys:y}),r),LM=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),BM=(r,h,p,y)=>{r.prototype=Object.create(h.prototype,y),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:h.prototype}),p&&Object.assign(r.prototype,p)},RM=(r,h,p,y)=>{let b,E,A;const s={};if(h=h||{},r==null)return h;do{for(b=Object.getOwnPropertyNames(r),E=b.length;E-- >0;)A=b[E],(!y||y(A,r,h))&&!s[A]&&(h[A]=r[A],s[A]=!0);r=p!==!1&&Tg(r)}while(r&&(!p||p(r,h))&&r!==Object.prototype);return h},FM=(r,h,p)=>{r=String(r),(p===void 0||p>r.length)&&(p=r.length),p-=h.length;const y=r.indexOf(h,p);return y!==-1&&y===p},OM=r=>{if(!r)return null;if(Uh(r))return r;let h=r.length;if(!zb(h))return null;const p=new Array(h);for(;h-- >0;)p[h]=r[h];return p},VM=(r=>h=>r&&h instanceof r)(typeof Uint8Array<"u"&&Tg(Uint8Array)),UM=(r,h)=>{const y=(r&&r[Symbol.iterator]).call(r);let b;for(;(b=y.next())&&!b.done;){const E=b.value;h.call(r,E[0],E[1])}},NM=(r,h)=>{let p;const y=[];for(;(p=r.exec(h))!==null;)y.push(p);return y},jM=bs("HTMLFormElement"),qM=r=>r.toLowerCase().replace(/[_-\s]([a-z\d])(\w*)/g,function(p,y,b){return y.toUpperCase()+b}),A0=(({hasOwnProperty:r})=>(h,p)=>r.call(h,p))(Object.prototype),$M=bs("RegExp"),Db=(r,h)=>{const p=Object.getOwnPropertyDescriptors(r),y={};xp(p,(b,E)=>{h(b,E,r)!==!1&&(y[E]=b)}),Object.defineProperties(r,y)},GM=r=>{Db(r,(h,p)=>{const y=r[p];if(!!Rc(y)){if(h.enumerable=!1,"writable"in h){h.writable=!1;return}h.set||(h.set=()=>{throw Error("Can not read-only method '"+p+"'")})}})},ZM=(r,h)=>{const p={},y=b=>{b.forEach(E=>{p[E]=!0})};return Uh(r)?y(r):y(String(r).split(h)),p},WM=()=>{},HM=(r,h)=>(r=+r,Number.isFinite(r)?r:h),pt={isArray:Uh,isArrayBuffer:kb,isBuffer:bM,isFormData:kM,isArrayBufferView:wM,isString:TM,isNumber:zb,isBoolean:EM,isObject:Pb,isPlainObject:Rf,isUndefined:L_,isDate:SM,isFile:CM,isBlob:AM,isRegExp:$M,isFunction:Rc,isStream:IM,isURLSearchParams:zM,isTypedArray:VM,isFileList:MM,forEach:xp,merge:B_,extend:DM,trim:PM,stripBOM:LM,inherits:BM,toFlatObject:RM,kindOf:Eg,kindOfTest:bs,endsWith:FM,toArray:OM,forEachEntry:UM,matchAll:NM,isHTMLForm:jM,hasOwnProperty:A0,hasOwnProp:A0,reduceDescriptors:Db,freezeMethods:GM,toObjectSet:ZM,toCamelCase:qM,noop:WM,toFiniteNumber:HM};function Hi(r,h,p,y,b){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",h&&(this.code=h),p&&(this.config=p),y&&(this.request=y),b&&(this.response=b)}pt.inherits(Hi,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const Lb=Hi.prototype,Bb={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{Bb[r]={value:r}});Object.defineProperties(Hi,Bb);Object.defineProperty(Lb,"isAxiosError",{value:!0});Hi.from=(r,h,p,y,b,E)=>{const A=Object.create(Lb);return pt.toFlatObject(r,A,function(D){return D!==Error.prototype},s=>s!=="isAxiosError"),Hi.call(A,r.message,h,p,y,b),A.cause=r,A.name=r.name,E&&Object.assign(A,E),A};var XM=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},KM=typeof self=="object"?self.FormData:window.FormData;function R_(r){return pt.isPlainObject(r)||pt.isArray(r)}function Rb(r){return pt.endsWith(r,"[]")?r.slice(0,-2):r}function M0(r,h,p){return r?r.concat(h).map(function(b,E){return b=Rb(b),!p&&E?"["+b+"]":b}).join(p?".":""):h}function YM(r){return pt.isArray(r)&&!r.some(R_)}const JM=pt.toFlatObject(pt,{},null,function(h){return/^is[A-Z]/.test(h)});function QM(r){return r&&pt.isFunction(r.append)&&r[Symbol.toStringTag]==="FormData"&&r[Symbol.iterator]}function bp(r,h,p){if(!pt.isObject(r))throw new TypeError("target must be an object");h=h||new(KM||FormData),p=pt.toFlatObject(p,{metaTokens:!0,dots:!1,indexes:!1},!1,function(ye,ze){return!pt.isUndefined(ze[ye])});const y=p.metaTokens,b=p.visitor||N,E=p.dots,A=p.indexes,D=(p.Blob||typeof Blob<"u"&&Blob)&&QM(h);if(!pt.isFunction(b))throw new TypeError("visitor must be a function");function V(de){if(de===null)return"";if(pt.isDate(de))return de.toISOString();if(!D&&pt.isBlob(de))throw new Hi("Blob is not supported. Use a Buffer instead.");return pt.isArrayBuffer(de)||pt.isTypedArray(de)?D&&typeof Blob=="function"?new Blob([de]):Buffer.from(de):de}function N(de,ye,ze){let He=de;if(de&&!ze&&typeof de=="object"){if(pt.endsWith(ye,"{}"))ye=y?ye:ye.slice(0,-2),de=JSON.stringify(de);else if(pt.isArray(de)&&YM(de)||pt.isFileList(de)||pt.endsWith(ye,"[]")&&(He=pt.toArray(de)))return ye=Rb(ye),He.forEach(function(Le,Ne){!pt.isUndefined(Le)&&h.append(A===!0?M0([ye],Ne,E):A===null?ye:ye+"[]",V(Le))}),!1}return R_(de)?!0:(h.append(M0(ze,ye,E),V(de)),!1)}const F=[],q=Object.assign(JM,{defaultVisitor:N,convertValue:V,isVisitable:R_});function H(de,ye){if(!pt.isUndefined(de)){if(F.indexOf(de)!==-1)throw Error("Circular reference detected in "+ye.join("."));F.push(de),pt.forEach(de,function(He,we){(!pt.isUndefined(He)&&b.call(h,He,pt.isString(we)?we.trim():we,ye,q))===!0&&H(He,ye?ye.concat(we):[we])}),F.pop()}}if(!pt.isObject(r))throw new TypeError("data must be an object");return H(r),h}function I0(r){const h={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(y){return h[y]})}function Sg(r,h){this._pairs=[],r&&bp(r,this,h)}const Fb=Sg.prototype;Fb.append=function(h,p){this._pairs.push([h,p])};Fb.toString=function(h){const p=h?function(y){return h.call(this,y,I0)}:I0;return this._pairs.map(function(b){return p(b[0])+"="+p(b[1])},"").join("&")};function eI(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Ob(r,h,p){if(!h)return r;const y=r.indexOf("#");y!==-1&&(r=r.slice(0,y));const b=p&&p.encode||eI,E=pt.isURLSearchParams(h)?h.toString():new Sg(h,p).toString(b);return E&&(r+=(r.indexOf("?")===-1?"?":"&")+E),r}class k0{constructor(){this.handlers=[]}use(h,p,y){return this.handlers.push({fulfilled:h,rejected:p,synchronous:y?y.synchronous:!1,runWhen:y?y.runWhen:null}),this.handlers.length-1}eject(h){this.handlers[h]&&(this.handlers[h]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(h){pt.forEach(this.handlers,function(y){y!==null&&h(y)})}}const Vb={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},tI=typeof URLSearchParams<"u"?URLSearchParams:Sg,iI=FormData,nI=(()=>{let r;return typeof navigator<"u"&&((r=navigator.product)==="ReactNative"||r==="NativeScript"||r==="NS")?!1:typeof window<"u"&&typeof document<"u"})(),_s={isBrowser:!0,classes:{URLSearchParams:tI,FormData:iI,Blob},isStandardBrowserEnv:nI,protocols:["http","https","file","blob","url","data"]};function rI(r,h){return bp(r,new _s.classes.URLSearchParams,Object.assign({visitor:function(p,y,b,E){return _s.isNode&&pt.isBuffer(p)?(this.append(y,p.toString("base64")),!1):E.defaultVisitor.apply(this,arguments)}},h))}function oI(r){return pt.matchAll(/\w+|\[(\w*)]/g,r).map(h=>h[0]==="[]"?"":h[1]||h[0])}function sI(r){const h={},p=Object.keys(r);let y;const b=p.length;let E;for(y=0;y<b;y++)E=p[y],h[E]=r[E];return h}function Ub(r){function h(p,y,b,E){let A=p[E++];const s=Number.isFinite(+A),D=E>=p.length;return A=!A&&pt.isArray(b)?b.length:A,D?(pt.hasOwnProp(b,A)?b[A]=[b[A],y]:b[A]=y,!s):((!b[A]||!pt.isObject(b[A]))&&(b[A]=[]),h(p,y,b[A],E)&&pt.isArray(b[A])&&(b[A]=sI(b[A])),!s)}if(pt.isFormData(r)&&pt.isFunction(r.entries)){const p={};return pt.forEachEntry(r,(y,b)=>{h(oI(y),b,p,0)}),p}return null}function aI(r,h,p){const y=p.config.validateStatus;!p.status||!y||y(p.status)?r(p):h(new Hi("Request failed with status code "+p.status,[Hi.ERR_BAD_REQUEST,Hi.ERR_BAD_RESPONSE][Math.floor(p.status/100)-4],p.config,p.request,p))}const lI=_s.isStandardBrowserEnv?function(){return{write:function(p,y,b,E,A,s){const D=[];D.push(p+"="+encodeURIComponent(y)),pt.isNumber(b)&&D.push("expires="+new Date(b).toGMTString()),pt.isString(E)&&D.push("path="+E),pt.isString(A)&&D.push("domain="+A),s===!0&&D.push("secure"),document.cookie=D.join("; ")},read:function(p){const y=document.cookie.match(new RegExp("(^|;\\s*)("+p+")=([^;]*)"));return y?decodeURIComponent(y[3]):null},remove:function(p){this.write(p,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function cI(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function uI(r,h){return h?r.replace(/\/+$/,"")+"/"+h.replace(/^\/+/,""):r}function Nb(r,h){return r&&!cI(h)?uI(r,h):h}const hI=_s.isStandardBrowserEnv?function(){const h=/(msie|trident)/i.test(navigator.userAgent),p=document.createElement("a");let y;function b(E){let A=E;return h&&(p.setAttribute("href",A),A=p.href),p.setAttribute("href",A),{href:p.href,protocol:p.protocol?p.protocol.replace(/:$/,""):"",host:p.host,search:p.search?p.search.replace(/^\?/,""):"",hash:p.hash?p.hash.replace(/^#/,""):"",hostname:p.hostname,port:p.port,pathname:p.pathname.charAt(0)==="/"?p.pathname:"/"+p.pathname}}return y=b(window.location.href),function(A){const s=pt.isString(A)?b(A):A;return s.protocol===y.protocol&&s.host===y.host}}():function(){return function(){return!0}}();function Nh(r,h,p){Hi.call(this,r==null?"canceled":r,Hi.ERR_CANCELED,h,p),this.name="CanceledError"}pt.inherits(Nh,Hi,{__CANCEL__:!0});function dI(r){const h=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return h&&h[1]||""}const fI=pt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),pI=r=>{const h={};let p,y,b;return r&&r.split(`
`).forEach(function(A){b=A.indexOf(":"),p=A.substring(0,b).trim().toLowerCase(),y=A.substring(b+1).trim(),!(!p||h[p]&&fI[p])&&(p==="set-cookie"?h[p]?h[p].push(y):h[p]=[y]:h[p]=h[p]?h[p]+", "+y:y)}),h},z0=Symbol("internals"),jb=Symbol("defaults");function bh(r){return r&&String(r).trim().toLowerCase()}function kf(r){return r===!1||r==null?r:String(r)}function mI(r){const h=Object.create(null),p=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let y;for(;y=p.exec(r);)h[y[1]]=y[2];return h}function P0(r,h,p,y){if(pt.isFunction(y))return y.call(this,h,p);if(!!pt.isString(h)){if(pt.isString(y))return h.indexOf(y)!==-1;if(pt.isRegExp(y))return y.test(h)}}function _I(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(h,p,y)=>p.toUpperCase()+y)}function gI(r,h){const p=pt.toCamelCase(" "+h);["get","set","has"].forEach(y=>{Object.defineProperty(r,y+p,{value:function(b,E,A){return this[y].call(this,h,b,E,A)},configurable:!0})})}function mh(r,h){h=h.toLowerCase();const p=Object.keys(r);let y=p.length,b;for(;y-- >0;)if(b=p[y],h===b.toLowerCase())return b;return null}function eo(r,h){r&&this.set(r),this[jb]=h||null}Object.assign(eo.prototype,{set:function(r,h,p){const y=this;function b(E,A,s){const D=bh(A);if(!D)throw new Error("header name must be a non-empty string");const V=mh(y,D);V&&s!==!0&&(y[V]===!1||s===!1)||(pt.isArray(E)?E=E.map(kf):E=kf(E),y[V||A]=E)}return pt.isPlainObject(r)?pt.forEach(r,(E,A)=>{b(E,A,h)}):b(h,r,p),this},get:function(r,h){if(r=bh(r),!r)return;const p=mh(this,r);if(p){const y=this[p];if(!h)return y;if(h===!0)return mI(y);if(pt.isFunction(h))return h.call(this,y,p);if(pt.isRegExp(h))return h.exec(y);throw new TypeError("parser must be boolean|regexp|function")}},has:function(r,h){if(r=bh(r),r){const p=mh(this,r);return!!(p&&(!h||P0(this,this[p],p,h)))}return!1},delete:function(r,h){const p=this;let y=!1;function b(E){if(E=bh(E),E){const A=mh(p,E);A&&(!h||P0(p,p[A],A,h))&&(delete p[A],y=!0)}}return pt.isArray(r)?r.forEach(b):b(r),y},clear:function(){return Object.keys(this).forEach(this.delete.bind(this))},normalize:function(r){const h=this,p={};return pt.forEach(this,(y,b)=>{const E=mh(p,b);if(E){h[E]=kf(y),delete h[b];return}const A=r?_I(b):String(b).trim();A!==b&&delete h[b],h[A]=kf(y),p[A]=!0}),this},toJSON:function(){const r=Object.create(null);return pt.forEach(Object.assign({},this[jb]||null,this),(h,p)=>{h==null||h===!1||(r[p]=pt.isArray(h)?h.join(", "):h)}),r}});Object.assign(eo,{from:function(r){return pt.isString(r)?new this(pI(r)):r instanceof this?r:new this(r)},accessor:function(r){const p=(this[z0]=this[z0]={accessors:{}}).accessors,y=this.prototype;function b(E){const A=bh(E);p[A]||(gI(y,E),p[A]=!0)}return pt.isArray(r)?r.forEach(b):b(r),this}});eo.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent"]);pt.freezeMethods(eo.prototype);pt.freezeMethods(eo);function yI(r,h){r=r||10;const p=new Array(r),y=new Array(r);let b=0,E=0,A;return h=h!==void 0?h:1e3,function(D){const V=Date.now(),N=y[E];A||(A=V),p[b]=D,y[b]=V;let F=E,q=0;for(;F!==b;)q+=p[F++],F=F%r;if(b=(b+1)%r,b===E&&(E=(E+1)%r),V-A<h)return;const H=N&&V-N;return H?Math.round(q*1e3/H):void 0}}function D0(r,h){let p=0;const y=yI(50,250);return b=>{const E=b.loaded,A=b.lengthComputable?b.total:void 0,s=E-p,D=y(s),V=E<=A;p=E;const N={loaded:E,total:A,progress:A?E/A:void 0,bytes:s,rate:D||void 0,estimated:D&&A&&V?(A-E)/D:void 0};N[h?"download":"upload"]=!0,r(N)}}function L0(r){return new Promise(function(p,y){let b=r.data;const E=eo.from(r.headers).normalize(),A=r.responseType;let s;function D(){r.cancelToken&&r.cancelToken.unsubscribe(s),r.signal&&r.signal.removeEventListener("abort",s)}pt.isFormData(b)&&_s.isStandardBrowserEnv&&E.setContentType(!1);let V=new XMLHttpRequest;if(r.auth){const H=r.auth.username||"",de=r.auth.password?unescape(encodeURIComponent(r.auth.password)):"";E.set("Authorization","Basic "+btoa(H+":"+de))}const N=Nb(r.baseURL,r.url);V.open(r.method.toUpperCase(),Ob(N,r.params,r.paramsSerializer),!0),V.timeout=r.timeout;function F(){if(!V)return;const H=eo.from("getAllResponseHeaders"in V&&V.getAllResponseHeaders()),ye={data:!A||A==="text"||A==="json"?V.responseText:V.response,status:V.status,statusText:V.statusText,headers:H,config:r,request:V};aI(function(He){p(He),D()},function(He){y(He),D()},ye),V=null}if("onloadend"in V?V.onloadend=F:V.onreadystatechange=function(){!V||V.readyState!==4||V.status===0&&!(V.responseURL&&V.responseURL.indexOf("file:")===0)||setTimeout(F)},V.onabort=function(){!V||(y(new Hi("Request aborted",Hi.ECONNABORTED,r,V)),V=null)},V.onerror=function(){y(new Hi("Network Error",Hi.ERR_NETWORK,r,V)),V=null},V.ontimeout=function(){let de=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const ye=r.transitional||Vb;r.timeoutErrorMessage&&(de=r.timeoutErrorMessage),y(new Hi(de,ye.clarifyTimeoutError?Hi.ETIMEDOUT:Hi.ECONNABORTED,r,V)),V=null},_s.isStandardBrowserEnv){const H=(r.withCredentials||hI(N))&&r.xsrfCookieName&&lI.read(r.xsrfCookieName);H&&E.set(r.xsrfHeaderName,H)}b===void 0&&E.setContentType(null),"setRequestHeader"in V&&pt.forEach(E.toJSON(),function(de,ye){V.setRequestHeader(ye,de)}),pt.isUndefined(r.withCredentials)||(V.withCredentials=!!r.withCredentials),A&&A!=="json"&&(V.responseType=r.responseType),typeof r.onDownloadProgress=="function"&&V.addEventListener("progress",D0(r.onDownloadProgress,!0)),typeof r.onUploadProgress=="function"&&V.upload&&V.upload.addEventListener("progress",D0(r.onUploadProgress)),(r.cancelToken||r.signal)&&(s=H=>{!V||(y(!H||H.type?new Nh(null,r,V):H),V.abort(),V=null)},r.cancelToken&&r.cancelToken.subscribe(s),r.signal&&(r.signal.aborted?s():r.signal.addEventListener("abort",s)));const q=dI(N);if(q&&_s.protocols.indexOf(q)===-1){y(new Hi("Unsupported protocol "+q+":",Hi.ERR_BAD_REQUEST,r));return}V.send(b||null)})}const B0={http:L0,xhr:L0},R0={getAdapter:r=>{if(pt.isString(r)){const h=B0[r];if(!r)throw Error(pt.hasOwnProp(r)?`Adapter '${r}' is not available in the build`:`Can not resolve adapter '${r}'`);return h}if(!pt.isFunction(r))throw new TypeError("adapter is not a function");return r},adapters:B0},vI={"Content-Type":"application/x-www-form-urlencoded"};function xI(){let r;return typeof XMLHttpRequest<"u"?r=R0.getAdapter("xhr"):typeof process<"u"&&pt.kindOf(process)==="process"&&(r=R0.getAdapter("http")),r}function bI(r,h,p){if(pt.isString(r))try{return(h||JSON.parse)(r),pt.trim(r)}catch(y){if(y.name!=="SyntaxError")throw y}return(p||JSON.stringify)(r)}const Fc={transitional:Vb,adapter:xI(),transformRequest:[function(h,p){const y=p.getContentType()||"",b=y.indexOf("application/json")>-1,E=pt.isObject(h);if(E&&pt.isHTMLForm(h)&&(h=new FormData(h)),pt.isFormData(h))return b&&b?JSON.stringify(Ub(h)):h;if(pt.isArrayBuffer(h)||pt.isBuffer(h)||pt.isStream(h)||pt.isFile(h)||pt.isBlob(h))return h;if(pt.isArrayBufferView(h))return h.buffer;if(pt.isURLSearchParams(h))return p.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),h.toString();let s;if(E){if(y.indexOf("application/x-www-form-urlencoded")>-1)return rI(h,this.formSerializer).toString();if((s=pt.isFileList(h))||y.indexOf("multipart/form-data")>-1){const D=this.env&&this.env.FormData;return bp(s?{"files[]":h}:h,D&&new D,this.formSerializer)}}return E||b?(p.setContentType("application/json",!1),bI(h)):h}],transformResponse:[function(h){const p=this.transitional||Fc.transitional,y=p&&p.forcedJSONParsing,b=this.responseType==="json";if(h&&pt.isString(h)&&(y&&!this.responseType||b)){const A=!(p&&p.silentJSONParsing)&&b;try{return JSON.parse(h)}catch(s){if(A)throw s.name==="SyntaxError"?Hi.from(s,Hi.ERR_BAD_RESPONSE,this,null,this.response):s}}return h}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:_s.classes.FormData,Blob:_s.classes.Blob},validateStatus:function(h){return h>=200&&h<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};pt.forEach(["delete","get","head"],function(h){Fc.headers[h]={}});pt.forEach(["post","put","patch"],function(h){Fc.headers[h]=pt.merge(vI)});function h_(r,h){const p=this||Fc,y=h||p,b=eo.from(y.headers);let E=y.data;return pt.forEach(r,function(s){E=s.call(p,E,b.normalize(),h?h.status:void 0)}),b.normalize(),E}function qb(r){return!!(r&&r.__CANCEL__)}function d_(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new Nh}function F0(r){return d_(r),r.headers=eo.from(r.headers),r.data=h_.call(r,r.transformRequest),(r.adapter||Fc.adapter)(r).then(function(y){return d_(r),y.data=h_.call(r,r.transformResponse,y),y.headers=eo.from(y.headers),y},function(y){return qb(y)||(d_(r),y&&y.response&&(y.response.data=h_.call(r,r.transformResponse,y.response),y.response.headers=eo.from(y.response.headers))),Promise.reject(y)})}function Rh(r,h){h=h||{};const p={};function y(V,N){return pt.isPlainObject(V)&&pt.isPlainObject(N)?pt.merge(V,N):pt.isPlainObject(N)?pt.merge({},N):pt.isArray(N)?N.slice():N}function b(V){if(pt.isUndefined(h[V])){if(!pt.isUndefined(r[V]))return y(void 0,r[V])}else return y(r[V],h[V])}function E(V){if(!pt.isUndefined(h[V]))return y(void 0,h[V])}function A(V){if(pt.isUndefined(h[V])){if(!pt.isUndefined(r[V]))return y(void 0,r[V])}else return y(void 0,h[V])}function s(V){if(V in h)return y(r[V],h[V]);if(V in r)return y(void 0,r[V])}const D={url:E,method:E,data:E,baseURL:A,transformRequest:A,transformResponse:A,paramsSerializer:A,timeout:A,timeoutMessage:A,withCredentials:A,adapter:A,responseType:A,xsrfCookieName:A,xsrfHeaderName:A,onUploadProgress:A,onDownloadProgress:A,decompress:A,maxContentLength:A,maxBodyLength:A,beforeRedirect:A,transport:A,httpAgent:A,httpsAgent:A,cancelToken:A,socketPath:A,responseEncoding:A,validateStatus:s};return pt.forEach(Object.keys(r).concat(Object.keys(h)),function(N){const F=D[N]||b,q=F(N);pt.isUndefined(q)&&F!==s||(p[N]=q)}),p}const $b="1.1.2",Cg={};["object","boolean","number","function","string","symbol"].forEach((r,h)=>{Cg[r]=function(y){return typeof y===r||"a"+(h<1?"n ":" ")+r}});const O0={};Cg.transitional=function(h,p,y){function b(E,A){return"[Axios v"+$b+"] Transitional option '"+E+"'"+A+(y?". "+y:"")}return(E,A,s)=>{if(h===!1)throw new Hi(b(A," has been removed"+(p?" in "+p:"")),Hi.ERR_DEPRECATED);return p&&!O0[A]&&(O0[A]=!0,console.warn(b(A," has been deprecated since v"+p+" and will be removed in the near future"))),h?h(E,A,s):!0}};function wI(r,h,p){if(typeof r!="object")throw new Hi("options must be an object",Hi.ERR_BAD_OPTION_VALUE);const y=Object.keys(r);let b=y.length;for(;b-- >0;){const E=y[b],A=h[E];if(A){const s=r[E],D=s===void 0||A(s,E,r);if(D!==!0)throw new Hi("option "+E+" must be "+D,Hi.ERR_BAD_OPTION_VALUE);continue}if(p!==!0)throw new Hi("Unknown option "+E,Hi.ERR_BAD_OPTION)}}const Gb={assertOptions:wI,validators:Cg},xc=Gb.validators;class _l{constructor(h){this.defaults=h,this.interceptors={request:new k0,response:new k0}}request(h,p){typeof h=="string"?(p=p||{},p.url=h):p=h||{},p=Rh(this.defaults,p);const y=p.transitional;y!==void 0&&Gb.assertOptions(y,{silentJSONParsing:xc.transitional(xc.boolean),forcedJSONParsing:xc.transitional(xc.boolean),clarifyTimeoutError:xc.transitional(xc.boolean)},!1),p.method=(p.method||this.defaults.method||"get").toLowerCase();const b=p.headers&&pt.merge(p.headers.common,p.headers[p.method]);b&&pt.forEach(["delete","get","head","post","put","patch","common"],function(H){delete p.headers[H]}),p.headers=new eo(p.headers,b);const E=[];let A=!0;this.interceptors.request.forEach(function(H){typeof H.runWhen=="function"&&H.runWhen(p)===!1||(A=A&&H.synchronous,E.unshift(H.fulfilled,H.rejected))});const s=[];this.interceptors.response.forEach(function(H){s.push(H.fulfilled,H.rejected)});let D,V=0,N;if(!A){const q=[F0.bind(this),void 0];for(q.unshift.apply(q,E),q.push.apply(q,s),N=q.length,D=Promise.resolve(p);V<N;)D=D.then(q[V++],q[V++]);return D}N=E.length;let F=p;for(V=0;V<N;){const q=E[V++],H=E[V++];try{F=q(F)}catch(de){H.call(this,de);break}}try{D=F0.call(this,F)}catch(q){return Promise.reject(q)}for(V=0,N=s.length;V<N;)D=D.then(s[V++],s[V++]);return D}getUri(h){h=Rh(this.defaults,h);const p=Nb(h.baseURL,h.url);return Ob(p,h.params,h.paramsSerializer)}}pt.forEach(["delete","get","head","options"],function(h){_l.prototype[h]=function(p,y){return this.request(Rh(y||{},{method:h,url:p,data:(y||{}).data}))}});pt.forEach(["post","put","patch"],function(h){function p(y){return function(E,A,s){return this.request(Rh(s||{},{method:h,headers:y?{"Content-Type":"multipart/form-data"}:{},url:E,data:A}))}}_l.prototype[h]=p(),_l.prototype[h+"Form"]=p(!0)});class Ag{constructor(h){if(typeof h!="function")throw new TypeError("executor must be a function.");let p;this.promise=new Promise(function(E){p=E});const y=this;this.promise.then(b=>{if(!y._listeners)return;let E=y._listeners.length;for(;E-- >0;)y._listeners[E](b);y._listeners=null}),this.promise.then=b=>{let E;const A=new Promise(s=>{y.subscribe(s),E=s}).then(b);return A.cancel=function(){y.unsubscribe(E)},A},h(function(E,A,s){y.reason||(y.reason=new Nh(E,A,s),p(y.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(h){if(this.reason){h(this.reason);return}this._listeners?this._listeners.push(h):this._listeners=[h]}unsubscribe(h){if(!this._listeners)return;const p=this._listeners.indexOf(h);p!==-1&&this._listeners.splice(p,1)}static source(){let h;return{token:new Ag(function(b){h=b}),cancel:h}}}function TI(r){return function(p){return r.apply(null,p)}}function EI(r){return pt.isObject(r)&&r.isAxiosError===!0}function Zb(r){const h=new _l(r),p=Mb(_l.prototype.request,h);return pt.extend(p,_l.prototype,h,{allOwnKeys:!0}),pt.extend(p,h,null,{allOwnKeys:!0}),p.create=function(b){return Zb(Rh(r,b))},p}const Tr=Zb(Fc);Tr.Axios=_l;Tr.CanceledError=Nh;Tr.CancelToken=Ag;Tr.isCancel=qb;Tr.VERSION=$b;Tr.toFormData=bp;Tr.AxiosError=Hi;Tr.Cancel=Tr.CanceledError;Tr.all=function(h){return Promise.all(h)};Tr.spread=TI;Tr.isAxiosError=EI;Tr.formToJSON=r=>Ub(pt.isHTMLForm(r)?new FormData(r):r);const SI=()=>Tr.create({baseURL:"https://bear-express-delta.vercel.app/api/"}),CI=async()=>await SI().get("guest"),AI=async r=>await Tr.post("https://bear-express-delta.vercel.app/api/guest",r),MI={class:"row",style:{"justify-content":"center","align-items":"center"}},II=Ei("span",{class:"text-weight-bold text-deep-orange"},"*",-1),kI=Ei("span",{class:"text-weight-bold text-deep-orange"},"*",-1),zI=Ei("span",{class:"text-weight-bold text-deep-orange"},"*",-1),PI={style:{display:"flex","justify-content":"space-between"}},DI={style:{display:"flex","align-items":"center"}},LI=Ei("p",{style:{color:"grey","font-size":"120%",padding:"0",margin:"0"}},"\xBFIr\xE1s en el autobus?",-1),BI={style:{display:"flex","justify-content":"center"}},RI=Ei("br",null,null,-1),FI=Ei("div",{style:{"font-weight":"900",display:"flex","justify-content":"center"}},[Ei("p",null," \xBFDeseas enviar la informaci\xF3n? ")],-1),OI={style:{display:"flex","justify-content":"space-around"}},VI=Ei("div",{style:{"font-weight":"900"}},"\xA1ok!",-1),UI=Ei("p",null,"Enviado correctamente",-1),NI={__name:"Asistencia",setup(r){xM();const h=go({nombre:null,acompaniantesNombre:null,numAdultos:null,numNinios:null,alergias:null,bus:!1,observaciones:null}),p=go({...h}),y=[0,1,2,3,4,5,6,7,8,9],b=Rt(!1),E=Rt(!1),A=N=>b.value=N,s=async()=>{try{(await AI(p)).status===200?E.value=!0:console.log("error")}catch(N){console.error(N)}A(!1)},D=()=>{A(!0)},V=N=>N===null?" - ":N;return(N,F)=>(nr(),ca(wr,null,[Ft(Vh,{title:"Asistencia"}),Ei("div",MI,[Ft(mM,{onSubmit:D,class:"q-gutter-lg",style:{width:"90%",display:"flex","flex-direction":"column"}},{default:cn(()=>[Ft(Af,{color:"blue-12",modelValue:p.nombre,"onUpdate:modelValue":F[0]||(F[0]=q=>p.nombre=q),"lazy-rules":"","label-slot":"",rules:[q=>q&&q.length>0||"Campo obligatorio"]},{prepend:cn(()=>[Ft(jn,{name:"person"})]),label:cn(()=>[ms(" Nombre y apellidos "),II]),_:1},8,["modelValue","rules"]),Ft(Af,{modelValue:p.acompaniantesNombre,"onUpdate:modelValue":F[1]||(F[1]=q=>p.acompaniantesNombre=q),type:"textarea",label:"Nombre y apellidos de acompa\xF1antes"},{prepend:cn(()=>[Ft(jn,{name:"group"})]),_:1},8,["modelValue"]),Ft(T0,{color:"blue-12",modelValue:p.numAdultos,"onUpdate:modelValue":F[2]||(F[2]=q=>p.numAdultos=q),options:y,"lazy-rules":"","label-slot":"",rules:[q=>q!==null&&q!==""||"Campo obligatorio"]},{prepend:cn(()=>[Ft(jn,{name:"restaurant_menu"})]),label:cn(()=>[ms(" Menus adulto "),kI]),_:1},8,["modelValue","rules"]),Ft(T0,{color:"blue-12",modelValue:p.numNinios,"onUpdate:modelValue":F[3]||(F[3]=q=>p.numNinios=q),options:y,"lazy-rules":"","label-slot":"",rules:[q=>q!==null&&q!==""||"Campo obligatorio"]},{prepend:cn(()=>[Ft(jn,{name:"local_pizza"})]),label:cn(()=>[ms(" Menus ni\xF1o "),zI]),_:1},8,["modelValue","rules"]),Ft(Af,{modelValue:p.alergias,"onUpdate:modelValue":F[4]||(F[4]=q=>p.alergias=q),label:"Alergias e intolerancias"},{prepend:cn(()=>[Ft(jn,{name:"bug_report"})]),_:1},8,["modelValue"]),Ei("div",PI,[Ei("div",DI,[Ft(jn,{style:{color:"grey","font-size":"140%","padding-right":"1.2rem"},name:"directions_bus"}),LI]),Ft(pM,{modelValue:p.bus,"onUpdate:modelValue":F[5]||(F[5]=q=>p.bus=q),"checked-icon":"check",color:"green","unchecked-icon":"clear"},null,8,["modelValue"])]),Ft(Af,{modelValue:p.observaciones,"onUpdate:modelValue":F[6]||(F[6]=q=>p.observaciones=q),type:"textarea",label:"\xBFQuieres a\xF1adir algo m\xE1s?"},{prepend:cn(()=>[Ft(jn,{name:"contact_support"})]),_:1},8,["modelValue"]),Ei("div",BI,[Ft(Zo,{style:{width:"45%"},type:"submit",color:"black",icon:"mail_outline",label:"Enviar",rounded:""})]),RI]),_:1})]),Ft(D_,{modelValue:b.value,"onUpdate:modelValue":F[9]||(F[9]=q=>b.value=q)},{default:cn(()=>[Ft(S0,null,{default:cn(()=>[Ft(u_,null,{default:cn(()=>[Ei("div",null,[Ei("p",null,ta(`Nombre y apellidos:${p.nombre}`),1),Ei("p",null,ta(`Nombre y apellidos de acompa\xF1antes:${V(p.acompaniantesNombre)}`),1),Ei("p",null,ta(`N\xFAmero de menus de adulto:${p.numAdultos}`),1),Ei("p",null,ta(`N\xFAmero de menus de ni\xF1o:${p.numNinios}`),1),Ei("p",null,ta(`Alergias e intolerancias:${V(p.alergias)}`),1),Ei("p",null,ta(`Ir\xE1s en autobus:${p.bus?"S\xED":"No"}`),1),Ei("p",null,ta(`Otra informaci\xF3n:${V(p.observaciones)}`),1)]),FI,Ft(E0),Ei("div",OI,[Ft(Zo,{style:{width:"40%"},color:"black",icon:"cancel",label:"No",rounded:"",onClick:F[7]||(F[7]=q=>A(!1))}),Ft(Zo,{style:{width:"40%"},color:"black",icon:"mail_outline",label:"S\xED",rounded:"",onClick:F[8]||(F[8]=q=>s())})])]),_:1})]),_:1})]),_:1},8,["modelValue"]),Ft(D_,{modelValue:E.value,"onUpdate:modelValue":F[10]||(F[10]=q=>E.value=q)},{default:cn(()=>[Ft(S0,null,{default:cn(()=>[Ft(u_,{class:"row items-center q-pb-none"},{default:cn(()=>[VI,Ft(E0),ng(Ft(Zo,{icon:"close",flat:"",round:"",dense:""},null,512),[[gM]])]),_:1}),Ft(u_,null,{default:cn(()=>[UI]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},Mg={left:!0,right:!0,up:!0,down:!0,horizontal:!0,vertical:!0},jI=Object.keys(Mg);Mg.all=!0;function V0(r){const h={};for(const p of jI)r[p]===!0&&(h[p]=!0);return Object.keys(h).length===0?Mg:(h.horizontal===!0?h.left=h.right=!0:h.left===!0&&h.right===!0&&(h.horizontal=!0),h.vertical===!0?h.up=h.down=!0:h.up===!0&&h.down===!0&&(h.vertical=!0),h.horizontal===!0&&h.vertical===!0&&(h.all=!0),h)}function U0(r,h){return h.event===void 0&&r.target!==void 0&&r.target.draggable!==!0&&typeof h.handler=="function"&&r.target.nodeName.toUpperCase()!=="INPUT"&&(r.qClonedBy===void 0||r.qClonedBy.indexOf(h.uid)===-1)}function qI(r){const h=[.06,6,50];return typeof r=="string"&&r.length&&r.split(":").forEach((p,y)=>{const b=parseFloat(p);b&&(h[y]=b)}),h}const $I=hg({name:"touch-swipe",beforeMount(r,{value:h,arg:p,modifiers:y}){if(y.mouse!==!0&&pn.has.touch!==!0)return;const b=y.mouseCapture===!0?"Capture":"",E={handler:h,sensitivity:qI(p),direction:V0(y),noop:Wo,mouseStart(A){U0(A,E)&&HS(A)&&(cl(E,"temp",[[document,"mousemove","move",`notPassive${b}`],[document,"mouseup","end","notPassiveCapture"]]),E.start(A,!0))},touchStart(A){if(U0(A,E)){const s=A.target;cl(E,"temp",[[s,"touchmove","move","notPassiveCapture"],[s,"touchcancel","end","notPassiveCapture"],[s,"touchend","end","notPassiveCapture"]]),E.start(A)}},start(A,s){pn.is.firefox===!0&&t_(r,!0);const D=Gf(A);E.event={x:D.left,y:D.top,time:Date.now(),mouse:s===!0,dir:!1}},move(A){if(E.event===void 0)return;if(E.event.dir!==!1){xn(A);return}const s=Date.now()-E.event.time;if(s===0)return;const D=Gf(A),V=D.left-E.event.x,N=Math.abs(V),F=D.top-E.event.y,q=Math.abs(F);if(E.event.mouse!==!0){if(N<E.sensitivity[1]&&q<E.sensitivity[1]){E.end(A);return}}else if(N<E.sensitivity[2]&&q<E.sensitivity[2])return;const H=N/s,de=q/s;E.direction.vertical===!0&&N<q&&N<100&&de>E.sensitivity[0]&&(E.event.dir=F<0?"up":"down"),E.direction.horizontal===!0&&N>q&&q<100&&H>E.sensitivity[0]&&(E.event.dir=V<0?"left":"right"),E.direction.up===!0&&N<q&&F<0&&N<100&&de>E.sensitivity[0]&&(E.event.dir="up"),E.direction.down===!0&&N<q&&F>0&&N<100&&de>E.sensitivity[0]&&(E.event.dir="down"),E.direction.left===!0&&N>q&&V<0&&q<100&&H>E.sensitivity[0]&&(E.event.dir="left"),E.direction.right===!0&&N>q&&V>0&&q<100&&H>E.sensitivity[0]&&(E.event.dir="right"),E.event.dir!==!1?(xn(A),E.event.mouse===!0&&(document.body.classList.add("no-pointer-events--children"),document.body.classList.add("non-selectable"),_b(),E.styleCleanup=ye=>{E.styleCleanup=void 0,document.body.classList.remove("non-selectable");const ze=()=>{document.body.classList.remove("no-pointer-events--children")};ye===!0?setTimeout(ze,50):ze()}),E.handler({evt:A,touch:E.event.mouse!==!0,mouse:E.event.mouse,direction:E.event.dir,duration:s,distance:{x:N,y:q}})):E.end(A)},end(A){E.event!==void 0&&(Ch(E,"temp"),pn.is.firefox===!0&&t_(r,!1),E.styleCleanup!==void 0&&E.styleCleanup(!0),A!==void 0&&E.event.dir!==!1&&xn(A),E.event=void 0)}};if(r.__qtouchswipe=E,y.mouse===!0){const A=y.mouseCapture===!0||y.mousecapture===!0?"Capture":"";cl(E,"main",[[r,"mousedown","mouseStart",`passive${A}`]])}pn.has.touch===!0&&cl(E,"main",[[r,"touchstart","touchStart",`passive${y.capture===!0?"Capture":""}`],[r,"touchmove","noop","notPassiveCapture"]])},updated(r,h){const p=r.__qtouchswipe;p!==void 0&&(h.oldValue!==h.value&&(typeof h.value!="function"&&p.end(),p.handler=h.value),p.direction=V0(h.modifiers))},beforeUnmount(r){const h=r.__qtouchswipe;h!==void 0&&(Ch(h,"main"),Ch(h,"temp"),pn.is.firefox===!0&&t_(r,!1),h.styleCleanup!==void 0&&h.styleCleanup(),delete r.__qtouchswipe)}});function GI(){const r=new Map;return{getCache:function(h,p){return r[h]===void 0?r[h]=p:r[h]},getCacheWithFn:function(h,p){return r[h]===void 0?r[h]=p():r[h]}}}const ZI={name:{required:!0},disable:Boolean},N0={setup(r,{slots:h}){return()=>Ie("div",{class:"q-panel scroll",role:"tabpanel"},bn(h.default))}},WI={modelValue:{required:!0},animated:Boolean,infinite:Boolean,swipeable:Boolean,vertical:Boolean,transitionPrev:String,transitionNext:String,transitionDuration:{type:[String,Number],default:300},keepAlive:Boolean,keepAliveInclude:[String,Array,RegExp],keepAliveExclude:[String,Array,RegExp],keepAliveMax:Number},HI=["update:modelValue","before-transition","transition"];function XI(){const{props:r,emit:h,proxy:p}=Oi(),{getCacheWithFn:y}=GI();let b,E;const A=Rt(null),s=Rt(null);function D(Ge){const Ye=r.vertical===!0?"up":"left";xe((p.$q.lang.rtl===!0?-1:1)*(Ge.direction===Ye?1:-1))}const V=be(()=>[[$I,D,void 0,{horizontal:r.vertical!==!0,vertical:r.vertical,mouse:!0}]]),N=be(()=>r.transitionPrev||`slide-${r.vertical===!0?"down":"right"}`),F=be(()=>r.transitionNext||`slide-${r.vertical===!0?"up":"left"}`),q=be(()=>`--q-transition-duration: ${r.transitionDuration}ms`),H=be(()=>typeof r.modelValue=="string"||typeof r.modelValue=="number"?r.modelValue:String(r.modelValue)),de=be(()=>({include:r.keepAliveInclude,exclude:r.keepAliveExclude,max:r.keepAliveMax})),ye=be(()=>r.keepAliveInclude!==void 0||r.keepAliveExclude!==void 0);ri(()=>r.modelValue,(Ge,Ye)=>{const Ot=Le(Ge)===!0?Ne(Ge):-1;E!==!0&&Pe(Ot===-1?0:Ot<Ne(Ye)?-1:1),A.value!==Ot&&(A.value=Ot,h("before-transition",Ge,Ye),fn(()=>{h("transition",Ge,Ye)}))});function ze(){xe(1)}function He(){xe(-1)}function we(Ge){h("update:modelValue",Ge)}function Le(Ge){return Ge!=null&&Ge!==""}function Ne(Ge){return b.findIndex(Ye=>Ye.props.name===Ge&&Ye.props.disable!==""&&Ye.props.disable!==!0)}function Te(){return b.filter(Ge=>Ge.props.disable!==""&&Ge.props.disable!==!0)}function Pe(Ge){const Ye=Ge!==0&&r.animated===!0&&A.value!==-1?"q-transition--"+(Ge===-1?N.value:F.value):null;s.value!==Ye&&(s.value=Ye)}function xe(Ge,Ye=A.value){let Ot=Ye+Ge;for(;Ot>-1&&Ot<b.length;){const Ht=b[Ot];if(Ht!==void 0&&Ht.props.disable!==""&&Ht.props.disable!==!0){Pe(Ge),E=!0,h("update:modelValue",Ht.props.name),setTimeout(()=>{E=!1});return}Ot+=Ge}r.infinite===!0&&b.length>0&&Ye!==-1&&Ye!==b.length&&xe(Ge,Ge===-1?b.length:-1)}function De(){const Ge=Ne(r.modelValue);return A.value!==Ge&&(A.value=Ge),!0}function Ke(){const Ge=Le(r.modelValue)===!0&&De()&&b[A.value];return r.keepAlive===!0?[Ie(IE,de.value,[Ie(ye.value===!0?y(H.value,()=>({...N0,name:H.value})):N0,{key:H.value,style:q.value},()=>Ge)])]:[Ie("div",{class:"q-panel scroll",style:q.value,key:H.value,role:"tabpanel"},[Ge])]}function Ue(){if(b.length!==0)return r.animated===!0?[Ie(vs,{name:s.value},Ke)]:Ke()}function nt(Ge){return b=K1(bn(Ge.default,[])).filter(Ye=>Ye.props!==null&&Ye.props.slot===void 0&&Le(Ye.props.name)===!0),b.length}function $e(){return b}return Object.assign(p,{next:ze,previous:He,goTo:we}),{panelIndex:A,panelDirectives:V,updatePanelsList:nt,updatePanelIndex:De,getPanelContent:Ue,getEnabledPanels:Te,getPanels:$e,isValidPanelName:Le,keepAliveProps:de,needsUniqueKeepAliveWrapper:ye,goToPanelByOffset:xe,goToPanel:we,nextPanel:ze,previousPanel:He}}const ea=$i({name:"QCarouselSlide",props:{...ZI,imgSrc:String},setup(r,{slots:h}){const p=be(()=>r.imgSrc?{backgroundImage:`url("${r.imgSrc}")`}:{});return()=>Ie("div",{class:"q-carousel__slide",style:p.value},bn(h.default))}});let _h=0;const KI={fullscreen:Boolean,noRouteFullscreenExit:Boolean},YI=["update:fullscreen","fullscreen"];function JI(){const r=Oi(),{props:h,emit:p,proxy:y}=r;let b,E,A;const s=Rt(!1);pg(r)===!0&&ri(()=>y.$route.fullPath,()=>{h.noRouteFullscreenExit!==!0&&N()}),ri(()=>h.fullscreen,F=>{s.value!==F&&D()}),ri(s,F=>{p("update:fullscreen",F),p("fullscreen",F)});function D(){s.value===!0?N():V()}function V(){s.value!==!0&&(s.value=!0,A=y.$el.parentNode,A.replaceChild(E,y.$el),document.body.appendChild(y.$el),_h++,_h===1&&document.body.classList.add("q-body--fullscreen-mixin"),b={handler:N},Dh.add(b))}function N(){s.value===!0&&(b!==void 0&&(Dh.remove(b),b=void 0),A.replaceChild(y.$el,E),s.value=!1,_h=Math.max(0,_h-1),_h===0&&(document.body.classList.remove("q-body--fullscreen-mixin"),y.$el.scrollIntoView!==void 0&&setTimeout(()=>{y.$el.scrollIntoView()})))}return eg(()=>{E=document.createElement("span")}),sr(()=>{h.fullscreen===!0&&V()}),_n(N),Object.assign(y,{toggleFullscreen:D,setFullscreen:V,exitFullscreen:N}),{inFullscreen:s,toggleFullscreen:D}}const QI=["top","right","bottom","left"],ek=["regular","flat","outline","push","unelevated"],tk=$i({name:"QCarousel",props:{...ua,...WI,...KI,transitionPrev:{type:String,default:"fade"},transitionNext:{type:String,default:"fade"},height:String,padding:Boolean,controlColor:String,controlTextColor:String,controlType:{type:String,validator:r=>ek.includes(r),default:"flat"},autoplay:[Number,Boolean],arrows:Boolean,prevIcon:String,nextIcon:String,navigation:Boolean,navigationPosition:{type:String,validator:r=>QI.includes(r)},navigationIcon:String,navigationActiveIcon:String,thumbnails:Boolean},emits:[...YI,...HI],setup(r,{slots:h}){const{proxy:{$q:p}}=Oi(),y=ha(r,p);let b,E;const{updatePanelsList:A,getPanelContent:s,panelDirectives:D,goToPanel:V,previousPanel:N,nextPanel:F,getEnabledPanels:q,panelIndex:H}=XI(),{inFullscreen:de}=JI(),ye=be(()=>de.value!==!0&&r.height!==void 0?{height:r.height}:{}),ze=be(()=>r.vertical===!0?"vertical":"horizontal"),He=be(()=>`q-carousel q-panel-parent q-carousel--with${r.padding===!0?"":"out"}-padding`+(de.value===!0?" fullscreen":"")+(y.value===!0?" q-carousel--dark q-dark":"")+(r.arrows===!0?` q-carousel--arrows-${ze.value}`:"")+(r.navigation===!0?` q-carousel--navigation-${Te.value}`:"")),we=be(()=>{const Ue=[r.prevIcon||p.iconSet.carousel[r.vertical===!0?"up":"left"],r.nextIcon||p.iconSet.carousel[r.vertical===!0?"down":"right"]];return r.vertical===!1&&p.lang.rtl===!0?Ue.reverse():Ue}),Le=be(()=>r.navigationIcon||p.iconSet.carousel.navigationIcon),Ne=be(()=>r.navigationActiveIcon||Le.value),Te=be(()=>r.navigationPosition||(r.vertical===!0?"right":"bottom")),Pe=be(()=>({color:r.controlColor,textColor:r.controlTextColor,round:!0,[r.controlType]:!0,dense:!0}));ri(()=>r.modelValue,()=>{r.autoplay&&(clearInterval(b),xe())}),ri(()=>r.autoplay,Ue=>{Ue?xe():clearInterval(b)});function xe(){const Ue=uC(r.autoplay)===!0?r.autoplay:5e3;b=setTimeout(Ue>=0?F:N,Math.abs(Ue))}sr(()=>{r.autoplay&&xe()}),_n(()=>{clearInterval(b)});function De(Ue,nt){return Ie("div",{class:`q-carousel__control q-carousel__navigation no-wrap absolute flex q-carousel__navigation--${Ue} q-carousel__navigation--${Te.value}`+(r.controlColor!==void 0?` text-${r.controlColor}`:"")},[Ie("div",{class:"q-carousel__navigation-inner flex flex-center no-wrap"},q().map(nt))])}function Ke(){const Ue=[];if(r.navigation===!0){const nt=h["navigation-icon"]!==void 0?h["navigation-icon"]:Ge=>Ie(Zo,{key:"nav"+Ge.name,class:`q-carousel__navigation-icon q-carousel__navigation-icon--${Ge.active===!0?"":"in"}active`,...Ge.btnProps,onClick:Ge.onClick}),$e=E-1;Ue.push(De("buttons",(Ge,Ye)=>{const Ot=Ge.props.name,Ht=H.value===Ye;return nt({index:Ye,maxIndex:$e,name:Ot,active:Ht,btnProps:{icon:Ht===!0?Ne.value:Le.value,size:"sm",...Pe.value},onClick:()=>{V(Ot)}})}))}else if(r.thumbnails===!0){const nt=r.controlColor!==void 0?` text-${r.controlColor}`:"";Ue.push(De("thumbnails",$e=>{const Ge=$e.props;return Ie("img",{key:"tmb#"+Ge.name,class:`q-carousel__thumbnail q-carousel__thumbnail--${Ge.name===r.modelValue?"":"in"}active`+nt,src:Ge.imgSrc||Ge["img-src"],onClick:()=>{V(Ge.name)}})}))}return r.arrows===!0&&H.value>=0&&((r.infinite===!0||H.value>0)&&Ue.push(Ie("div",{key:"prev",class:`q-carousel__control q-carousel__arrow q-carousel__prev-arrow q-carousel__prev-arrow--${ze.value} absolute flex flex-center`},[Ie(Zo,{icon:we.value[0],...Pe.value,onClick:N})])),(r.infinite===!0||H.value<E-1)&&Ue.push(Ie("div",{key:"next",class:`q-carousel__control q-carousel__arrow q-carousel__next-arrow q-carousel__next-arrow--${ze.value} absolute flex flex-center`},[Ie(Zo,{icon:we.value[1],...Pe.value,onClick:F})]))),Jr(h.control,Ue)}return()=>(E=A(h),Ie("div",{class:He.value,style:ye.value},[W1("div",{class:"q-carousel__slides-container"},s(),"sl-cont",r.swipeable,()=>D.value)].concat(Ke())))}}),ik="/assets/restaurante.6e2a3953.jpeg",nk="/assets/boda-ali.232ec7ae.jpeg",rk="/assets/boda-ana.8e21094f.jpeg",ok="/assets/cala.f0770073.jpeg",sk="/assets/gorra-verde.9b93d1c2.jpeg",ak="/assets/monte.3968e21c.jpeg",lk="/assets/thor.f22c0701.jpeg",ck="/assets/terrorista.3f475105.jpeg",uk=Ei("div",{class:"col-12 column",style:{padding:"1rem"}},[Ei("p",{class:"text-justify"},"\xA1Bienvenid@s! Despu\xE9s de vivir juntos en Madrid, pasar un confinamiento extricto, comprar una casa en Alcal\xE1 de Henares, el nacimiento de Iv\xE1n, retrasar una boda por su llegada e ir a cinco bodas de las cuales ninguna ha sido la nuestra... "),Ei("p",{class:"text-justify"},[ms("Nos complace anunciar que el pr\xF3ximo d\xEDa s\xE1bado "),Ei("strong",null,[Ei("u",null,"27 de Mayo de 2023")]),ms(" celebraremos nuestro matrimonio junto a nuestros seres queridos.")])],-1),hk={__name:"Inicio",setup(r){const h=Rt(1),p=Rt(!0);return(y,b)=>(nr(),ca(wr,null,[Ft(Vh,{title:"Inicio"}),uk,Ft(tk,{swipeable:"",animated:"",modelValue:h.value,"onUpdate:modelValue":b[0]||(b[0]=E=>h.value=E),thumbnails:"",autoplay:p.value,infinite:"","transition-prev":"slide-right","transition-next":"slide-left",onMouseenter:b[1]||(b[1]=E=>p.value=!1),onMouseleave:b[2]||(b[2]=E=>p.value=!0)},{default:cn(()=>[Ft(ea,{name:1,"img-src":ik}),Ft(ea,{name:2,"img-src":nk}),Ft(ea,{name:3,"img-src":rk}),Ft(ea,{name:4,"img-src":ok}),Ft(ea,{name:5,"img-src":sk}),Ft(ea,{name:6,"img-src":ak}),Ft(ea,{name:7,"img-src":lk}),Ft(ea,{name:8,"img-src":ck}),ms(" > ")]),_:1},8,["modelValue","autoplay"])],64))}},gh=$i({name:"QTimelineEntry",props:{heading:Boolean,tag:{type:String,default:"h3"},side:{type:String,default:"right",validator:r=>["left","right"].includes(r)},icon:String,avatar:String,color:String,title:String,subtitle:String,body:String},setup(r,{slots:h}){const p=bo(q1,()=>{console.error("QTimelineEntry needs to be child of QTimeline")}),y=be(()=>`q-timeline__entry q-timeline__entry--${r.side}`+(r.icon!==void 0||r.avatar!==void 0?" q-timeline__entry--icon":"")),b=be(()=>`q-timeline__dot text-${r.color||p.color}`),E=be(()=>p.layout==="comfortable"&&p.side==="left");return()=>{const A=fg(h.default,[]);if(r.body!==void 0&&A.unshift(r.body),r.heading===!0){const V=[Ie("div"),Ie("div"),Ie(r.tag,{class:"q-timeline__heading-title"},A)];return Ie("div",{class:"q-timeline__heading"},E.value===!0?V.reverse():V)}let s;r.icon!==void 0?s=[Ie(jn,{class:"row items-center justify-center",name:r.icon})]:r.avatar!==void 0&&(s=[Ie("img",{class:"q-timeline__dot-img",src:r.avatar})]);const D=[Ie("div",{class:"q-timeline__subtitle"},[Ie("span",{},bn(h.subtitle,[r.subtitle]))]),Ie("div",{class:b.value},s),Ie("div",{class:"q-timeline__content"},[Ie("h6",{class:"q-timeline__title"},bn(h.title,[r.title]))].concat(A))];return Ie("li",{class:y.value},E.value===!0?D.reverse():D)}}}),dk=$i({name:"QTimeline",props:{...ua,color:{type:String,default:"primary"},side:{type:String,default:"right",validator:r=>["left","right"].includes(r)},layout:{type:String,default:"dense",validator:r=>["dense","comfortable","loose"].includes(r)}},setup(r,{slots:h}){const p=Oi(),y=ha(r,p.proxy.$q);Lc(q1,r);const b=be(()=>`q-timeline q-timeline--${r.layout} q-timeline--${r.layout}--${r.side}`+(y.value===!0?" q-timeline--dark":""));return()=>Ie("ul",{class:b.value},bn(h.default))}}),fk={class:"col-12 column",style:{padding:"1rem"}},pk={class:"q-px-lg q-pb-md"},mk={__name:"Itinerario",setup(r){return(h,p)=>(nr(),ca(wr,null,[Ft(Vh,{title:"Itinerario"}),Ei("div",fk,[Ei("div",pk,[Ft(dk,{color:"secondary"},{default:cn(()=>[Ft(gh,{title:"Ceremonia",subtitle:"13:30H",icon:"church",body:"Un ofreciante dedicar\xE1 unas palabras. Adem\xE1s hablaran amigos y familiares de los novios.",color:"pink"}),Ft(gh,{title:"Coctel",subtitle:"14:30H",icon:"tapas",body:"Se servir\xE1 un magn\xEDfico coctel de bienvenida, en el cual habr\xE1 comida y bebida."}),Ft(gh,{title:"Comida",subtitle:"16:00",icon:"restaurant",color:"green",body:"Momento de disfrutar del men\xFA, cuanta con dos platos y postre."}),Ft(gh,{title:"Fiesta",subtitle:"18:00",icon:"nightlife",body:"Ser\xE1 hora de bailar y brindar para celebrar el matrimonio.",color:"red"}),Ft(gh,{title:"Recena",subtitle:"21:00",color:"orange",icon:"lunch_dining",body:"Una hora antes de finalizar la fiesta habr\xE1 una peque\xF1a sorpresa para cenar."})]),_:1})])])],64))}};var Wb={exports:{}};(function(r,h){(function(p,y){r.exports=y()})(XM,function(){var p,y,b;function E(s,D){if(!p)p=D;else if(!y)y=D;else{var V="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+p+")(sharedChunk); ("+y+")(sharedChunk); self.onerror = null;",N={};p(N),b=D(N),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(b.workerUrl=window.URL.createObjectURL(new Blob([V],{type:"text/javascript"})))}}E(["exports"],function(s){var D=typeof self<"u"?self:{},V=N;function N(i,e,t,o){this.cx=3*i,this.bx=3*(t-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=o,this.p2x=t,this.p2y=o}N.prototype.sampleCurveX=function(i){return((this.ax*i+this.bx)*i+this.cx)*i},N.prototype.sampleCurveY=function(i){return((this.ay*i+this.by)*i+this.cy)*i},N.prototype.sampleCurveDerivativeX=function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},N.prototype.solveCurveX=function(i,e){var t,o,l,u,f;for(e===void 0&&(e=1e-6),l=i,f=0;f<8;f++){if(u=this.sampleCurveX(l)-i,Math.abs(u)<e)return l;var m=this.sampleCurveDerivativeX(l);if(Math.abs(m)<1e-6)break;l-=u/m}if((l=i)<(t=0))return t;if(l>(o=1))return o;for(;t<o;){if(u=this.sampleCurveX(l),Math.abs(u-i)<e)return l;i>u?t=l:o=l,l=.5*(o-t)+t}return l},N.prototype.solve=function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))};var F=q;function q(i,e){this.x=i,this.y=e}q.prototype={clone:function(){return new q(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,t=i.y-this.y;return e*e+t*t},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),t=Math.sin(i),o=t*this.x+e*this.y;return this.x=e*this.x-t*this.y,this.y=o,this},_rotateAround:function(i,e){var t=Math.cos(i),o=Math.sin(i),l=e.y+o*(this.x-e.x)+t*(this.y-e.y);return this.x=e.x+t*(this.x-e.x)-o*(this.y-e.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},q.convert=function(i){return i instanceof q?i:Array.isArray(i)?new q(i[0],i[1]):i};const H=Math.PI/180,de=180/Math.PI;function ye(i){return i*H}function ze(i){return i*de}const He=[[0,0],[1,0],[1,1],[0,1]];function we(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,t=e*i;return 4*(i<.5?t:3*(i-e)+t-.75)}function Le(i,e,t,o){const l=new V(i,e,t,o);return function(u){return l.solve(u)}}const Ne=Le(.25,.1,.25,1);function Te(i,e,t){return Math.min(t,Math.max(e,i))}function Pe(i,e,t){return(t=Te((t-i)/(e-i),0,1))*t*(3-2*t)}function xe(i,e,t){const o=t-e,l=((i-e)%o+o)%o+e;return l===e?t:l}function De(i,e,t){if(!i.length)return t(null,[]);let o=i.length;const l=new Array(i.length);let u=null;i.forEach((f,m)=>{e(f,(v,x)=>{v&&(u=v),l[m]=x,--o==0&&t(u,l)})})}function Ke(i){const e=[];for(const t in i)e.push(i[t]);return e}function Ue(i,...e){for(const t of e)for(const o in t)i[o]=t[o];return i}let nt=1;function $e(){return nt++}function Ge(){return function i(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function Ye(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function Ot(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function Ht(i,e){i.forEach(t=>{e[t]&&(e[t]=e[t].bind(e))})}function ot(i,e){return i.indexOf(e,i.length-e.length)!==-1}function At(i,e,t){const o={};for(const l in i)o[l]=e.call(t||this,i[l],l,i);return o}function di(i,e,t){const o={};for(const l in i)e.call(t||this,i[l],l,i)&&(o[l]=i[l]);return o}function Oe(i){return Array.isArray(i)?i.map(Oe):typeof i=="object"&&i?At(i,Oe):i}const _t={};function xt(i){_t[i]||(typeof console<"u"&&console.warn(i),_t[i]=!0)}function Lt(i,e,t){return(t.y-i.y)*(e.x-i.x)>(e.y-i.y)*(t.x-i.x)}function pi(i){let e=0;for(let t,o,l=0,u=i.length,f=u-1;l<u;f=l++)t=i[l],o=i[f],e+=(o.x-t.x)*(t.y+o.y);return e}function Ci(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Kt(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(t,o,l,u)=>{const f=l||u;return e[o]=!f||f.toLowerCase(),""}),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e}let Yt=null;function Jt(i){if(Yt==null){const e=i.navigator?i.navigator.userAgent:null;Yt=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Yt}function Et(i){try{const e=D[i];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Bi(i,e){return[i[4*e],i[4*e+1],i[4*e+2],i[4*e+3]]}const Tn=D.performance;function ue(i){const e=i?i.url.toString():void 0;return Tn.getEntriesByName(e)}var Ee="2.10.0";let Re,ct,ut,bt;const Mt={now:()=>ut!==void 0?ut:D.performance.now(),setNow(i){ut=i},restoreNow(){ut=void 0},frame(i){const e=D.requestAnimationFrame(i);return{cancel:()=>D.cancelAnimationFrame(e)}},getImageData(i,e=0){const{width:t,height:o}=i;bt||(bt=D.document.createElement("canvas"));const l=bt.getContext("2d");if(!l)throw new Error("failed to create canvas 2d context");return(t>bt.width||o>bt.height)&&(bt.width=t,bt.height=o),l.clearRect(-e,-e,t+2*e,o+2*e),l.drawImage(i,0,0,t,o),l.getImageData(-e,-e,t+2*e,o+2*e)},resolveURL:i=>(Re||(Re=D.document.createElement("a")),Re.href=i,Re.href),get devicePixelRatio(){return D.devicePixelRatio},get prefersReducedMotion(){return!!D.matchMedia&&(ct==null&&(ct=D.matchMedia("(prefers-reduced-motion: reduce)")),ct.matches)}};let gt;const Xe={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(gt==null){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{gt=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):i}catch{gt=i}}return gt},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ht={supported:!1,testSupport:function(i){!Zt&&Nt&&(ti?mi(i):qt=i)}};let qt,Nt,Zt=!1,ti=!1;function mi(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,Nt),i.isContextLost())return;ht.supported=!0}catch{}i.deleteTexture(e),Zt=!0}D.document&&(Nt=D.document.createElement("img"),Nt.onload=function(){qt&&mi(qt),qt=null,ti=!0},Nt.onerror=function(){Zt=!0,qt=null},Nt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const zi="01",si="NO_ACCESS_TOKEN";function Ai(i){return i.indexOf("mapbox:")===0}function hn(i){return Xe.API_URL_REGEX.test(i)}const _r=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Cn(i){const e=i.match(_r);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function kn(i){const e=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${e}`}function qr(i){if(!i)return null;const e=i.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(D.atob(e[1]).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class gn{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const t=qr(Xe.ACCESS_TOKEN);let o="";return o=t&&t.u?D.btoa(encodeURIComponent(t.u).replace(/%([0-9A-F]{2})/g,(l,u)=>String.fromCharCode(Number("0x"+u)))):Xe.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${o}`:`mapbox.eventData:${o}`}fetchEventData(){const e=Et("localStorage"),t=this.getStorageKey(),o=this.getStorageKey("uuid");if(e)try{const l=D.localStorage.getItem(t);l&&(this.eventData=JSON.parse(l));const u=D.localStorage.getItem(o);u&&(this.anonId=u)}catch{xt("Unable to read from LocalStorage")}}saveEventData(){const e=Et("localStorage"),t=this.getStorageKey(),o=this.getStorageKey("uuid");if(e)try{D.localStorage.setItem(o,this.anonId),Object.keys(this.eventData).length>=1&&D.localStorage.setItem(t,JSON.stringify(this.eventData))}catch{xt("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,t,o,l){if(!Xe.EVENTS_URL)return;const u=Cn(Xe.EVENTS_URL);u.params.push(`access_token=${l||Xe.ACCESS_TOKEN||""}`);const f={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:Ee,skuId:zi,userId:this.anonId},m=t?Ue(f,t):f,v={url:kn(u),headers:{"Content-Type":"text/plain"},body:JSON.stringify([m])};this.pendingRequest=Qe(v,x=>{this.pendingRequest=null,o(x),this.saveEventData(),this.processRequests(l)})}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const zn=new class extends gn{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,e){Xe.EVENTS_URL&&Xe.ACCESS_TOKEN&&Array.isArray(i)&&i.some(t=>Ai(t)||hn(t))&&this.queueRequest(Date.now(),e)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=qr(Xe.ACCESS_TOKEN),t=e?e.u:Xe.ACCESS_TOKEN;let o=t!==this.eventData.tokenU;Ot(this.anonId)||(this.anonId=Ge(),o=!0);const l=this.queue.shift();if(this.eventData.lastSuccess){const u=new Date(this.eventData.lastSuccess),f=new Date(l),m=(l-this.eventData.lastSuccess)/864e5;o=o||m>=1||m<-1||u.getDate()!==f.getDate()}else o=!0;o?this.postEvent(l,{"enabled.telemetry":!1},u=>{u||(this.eventData.lastSuccess=l,this.eventData.tokenU=t)},i):this.processRequests()}},Pr=zn.postTurnstileEvent.bind(zn),Eo=new class extends gn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,e,t,o){this.skuToken=e,this.errorCb=o,Xe.EVENTS_URL&&(t||Xe.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},t):this.errorCb(new Error(si)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:t}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Ot(this.anonId)||(this.anonId=Ge()),this.postEvent(t,{skuToken:this.skuToken},o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},i))}},Ho=Eo.postMapLoadEvent.bind(Eo),ws=new class extends gn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,e,t,o){if(!Xe.API_URL||!Xe.SESSION_PATH)return;const l=Cn(Xe.API_URL+Xe.SESSION_PATH);l.params.push(`sku=${e||""}`),l.params.push(`access_token=${o||Xe.ACCESS_TOKEN||""}`);const u={url:kn(l),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Ct(u,f=>{this.pendingRequest=null,t(f),this.saveEventData(),this.processRequests(o)})}getSessionAPI(i,e,t,o){this.skuToken=e,this.errorCb=o,Xe.SESSION_PATH&&Xe.API_URL&&(t||Xe.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},t):this.errorCb(new Error(si)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:t}=this.queue.shift();e&&this.success[e]||this.getSession(t,this.skuToken,o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},i)}},da=ws.getSessionAPI.bind(ws),Dr=new Set;let Lr,to=500,io=50,An={};function Er(i){const e=O(i);let t,o;e&&e.forEach(u=>{const f=u.split("=");f[0]==="language"?t=f[1]:f[0]==="worldview"&&(o=f[1])});let l="mapbox-tiles";return t&&(l+=`-${t}`),o&&(l+=`-${o}`),l}function Q(){try{return D.caches}catch{}}function B(i){const e=Q();e&&!An[i]&&(An[i]=e.open(i))}function O(i){const e=i.indexOf("?");return e>0?i.slice(e+1).split("&"):[]}function J(i){const e=i.indexOf("?");if(e<0)return i;const t=O(i).filter(o=>{const l=o.split("=");return l[0]==="language"||l[0]==="worldview"});return t.length?`${i.slice(0,e)}?${t.join("&")}`:i.slice(0,e)}let ne=1/0;const _e={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(_e);class Me extends Error{constructor(e,t,o){t===401&&hn(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Se=Ci()?()=>self.worker&&self.worker.referrer:()=>(D.location.protocol==="blob:"?D.parent:D).location.href,ge=function(i,e){if(!(/^file:/.test(t=i.url)||/^file:/.test(Se())&&!/^\w+:/.test(t))){if(D.fetch&&D.Request&&D.AbortController&&D.Request.prototype.hasOwnProperty("signal"))return function(o,l){const u=new D.AbortController,f=new D.Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:Se(),signal:u.signal});let m=!1,v=!1;const x=(S=f.url).indexOf("sku=")>0&&hn(S);var S;o.type==="json"&&f.headers.set("Accept","application/json");const M=(P,L,U)=>{if(v)return;if(P&&P.message!=="SecurityError"&&xt(P),L&&U)return I(L);const $=Date.now();D.fetch(f).then(ee=>{if(ee.ok){const se=x?ee.clone():null;return I(ee,se,$)}return l(new Me(ee.statusText,ee.status,o.url))}).catch(ee=>{ee.code!==20&&l(new Error(ee.message))})},I=(P,L,U)=>{(o.type==="arrayBuffer"?P.arrayBuffer():o.type==="json"?P.json():P.text()).then($=>{v||(L&&U&&function(ee,se,ie){const re=Er(ee.url);if(B(re),!An[re])return;const me={status:se.status,statusText:se.statusText,headers:new D.Headers};se.headers.forEach((Fe,We)=>me.headers.set(We,Fe));const ae=Kt(se.headers.get("Cache-Control")||"");if(ae["no-store"])return;ae["max-age"]&&me.headers.set("Expires",new Date(ie+1e3*ae["max-age"]).toUTCString());const Ve=me.headers.get("Expires");Ve&&(new Date(Ve).getTime()-ie<42e4||function(Fe,We){if(Lr===void 0)try{new Response(new ReadableStream),Lr=!0}catch{Lr=!1}Lr?We(Fe.body):Fe.blob().then(We)}(se,Fe=>{const We=new D.Response(Fe,me);B(re),An[re]&&An[re].then(yt=>yt.put(J(ee.url),We)).catch(yt=>xt(yt.message))}))}(f,L,U),m=!0,l(null,$,P.headers.get("Cache-Control"),P.headers.get("Expires")))}).catch($=>{v||l(new Error($.message))})};return x?function(P,L){const U=Er(P.url);if(B(U),!An[U])return L(null);const $=J(P.url);An[U].then(ee=>{ee.match($).then(se=>{const ie=function(re){if(!re)return!1;const me=new Date(re.headers.get("Expires")||0),ae=Kt(re.headers.get("Cache-Control")||"");return me>Date.now()&&!ae["no-cache"]}(se);ee.delete($),ie&&ee.put($,se.clone()),L(null,se,ie)}).catch(L)}).catch(L)}(f,M):M(null,null),{cancel:()=>{v=!0,m||u.abort()}}}(i,e);if(Ci()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var t;return function(o,l){const u=new D.XMLHttpRequest;u.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(const f in o.headers)u.setRequestHeader(f,o.headers[f]);return o.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=o.credentials==="include",u.onerror=()=>{l(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let f=u.response;if(o.type==="json")try{f=JSON.parse(u.response)}catch(m){return l(m)}l(null,f,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else l(new Me(u.statusText,u.status,o.url))},u.send(o.body),{cancel:()=>u.abort()}}(i,e)},ke=function(i,e){return ge(Ue(i,{type:"arrayBuffer"}),e)},Qe=function(i,e){return ge(Ue(i,{method:"POST"}),e)},Ct=function(i,e){return ge(Ue(i,{method:"GET"}),e)};function st(i){const e=D.document.createElement("a");return e.href=i,e.protocol===D.document.location.protocol&&e.host===D.document.location.host}const $t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Xt,jt;Xt=[],jt=0;const Qt=function(i,e){if(ht.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),jt>=Xe.MAX_PARALLEL_IMAGE_REQUESTS){const u={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Xt.push(u),u}jt++;let t=!1;const o=()=>{if(!t)for(t=!0,jt--;Xt.length&&jt<Xe.MAX_PARALLEL_IMAGE_REQUESTS;){const u=Xt.shift(),{requestParameters:f,callback:m,cancelled:v}=u;v||(u.cancel=Qt(f,m).cancel)}},l=ke(i,(u,f,m,v)=>{o(),u?e(u):f&&(D.createImageBitmap?function(x,S){const M=new D.Blob([new Uint8Array(x)],{type:"image/png"});D.createImageBitmap(M).then(I=>{S(null,I)}).catch(I=>{S(new Error(`Could not load image because of ${I.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(f,(x,S)=>e(x,S,m,v)):function(x,S){const M=new D.Image,I=D.URL;M.onload=()=>{S(null,M),I.revokeObjectURL(M.src),M.onload=null,D.requestAnimationFrame(()=>{M.src=$t})},M.onerror=()=>S(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const P=new D.Blob([new Uint8Array(x)],{type:"image/png"});M.src=x.byteLength?I.createObjectURL(P):$t}(f,(x,S)=>e(x,S,m,v)))});return{cancel:()=>{l.cancel(),o()}}};function ci(i,e,t){t[i]&&t[i].indexOf(e)!==-1||(t[i]=t[i]||[],t[i].push(e))}function Pi(i,e,t){if(t&&t[i]){const o=t[i].indexOf(e);o!==-1&&t[i].splice(o,1)}}class ce{constructor(e,t={}){Ue(this,t),this.type=e}}class vt extends ce{constructor(e,t={}){super("error",Ue({error:e},t))}}class Ze{on(e,t){return this._listeners=this._listeners||{},ci(e,t,this._listeners),this}off(e,t){return Pi(e,t,this._listeners),Pi(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},ci(e,t,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,t){typeof e=="string"&&(e=new ce(e,t||{}));const o=e.type;if(this.listens(o)){e.target=this;const l=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const m of l)m.call(this,e);const u=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const m of u)Pi(o,m,this._oneTimeListeners),m.call(this,e);const f=this._eventedParent;f&&(Ue(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),f.fire(e))}else e instanceof vt&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}var Ce=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function wi(i,...e){for(const t of e)for(const o in t)i[o]=t[o];return i}function ni(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Gi(i){if(Array.isArray(i))return i.map(Gi);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const t in i)e[t]=Gi(i[t]);return e}return ni(i)}class Mn extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}var Kn=Mn;class gl{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[o,l]of t)this.bindings[o]=l}concat(e){return new gl(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var wp=gl;const Ts={kind:"null"},zt={kind:"number"},gi={kind:"string"},yi={kind:"boolean"},Br={kind:"color"},Rr={kind:"object"},ui={kind:"value"},fa={kind:"collator"},pa={kind:"formatted"},ma={kind:"resolvedImage"};function gr(i,e){return{kind:"array",itemType:i,N:e}}function sn(i){if(i.kind==="array"){const e=sn(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const jh=[Ts,zt,gi,yi,Br,pa,Rr,gr(ui),ma];function Es(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Es(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const t of jh)if(!Es(t,e))return null}}return`Expected ${sn(i)} but found ${sn(e)} instead.`}function yl(i,e){return e.some(t=>t.kind===i.kind)}function So(i,e){return e.some(t=>t==="null"?i===null:t==="array"?Array.isArray(i):t==="object"?i&&!Array.isArray(i)&&typeof i=="object":t===typeof i)}function Oc(i){var e={exports:{}};return i(e,e.exports),e.exports}var Co=Oc(function(i,e){var t={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function o(m){return(m=Math.round(m))<0?0:m>255?255:m}function l(m){return o(m[m.length-1]==="%"?parseFloat(m)/100*255:parseInt(m))}function u(m){return(v=m[m.length-1]==="%"?parseFloat(m)/100:parseFloat(m))<0?0:v>1?1:v;var v}function f(m,v,x){return x<0?x+=1:x>1&&(x-=1),6*x<1?m+(v-m)*x*6:2*x<1?v:3*x<2?m+(v-m)*(2/3-x)*6:m}try{e.parseCSSColor=function(m){var v,x=m.replace(/ /g,"").toLowerCase();if(x in t)return t[x].slice();if(x[0]==="#")return x.length===4?(v=parseInt(x.substr(1),16))>=0&&v<=4095?[(3840&v)>>4|(3840&v)>>8,240&v|(240&v)>>4,15&v|(15&v)<<4,1]:null:x.length===7&&(v=parseInt(x.substr(1),16))>=0&&v<=16777215?[(16711680&v)>>16,(65280&v)>>8,255&v,1]:null;var S=x.indexOf("("),M=x.indexOf(")");if(S!==-1&&M+1===x.length){var I=x.substr(0,S),P=x.substr(S+1,M-(S+1)).split(","),L=1;switch(I){case"rgba":if(P.length!==4)return null;L=u(P.pop());case"rgb":return P.length!==3?null:[l(P[0]),l(P[1]),l(P[2]),L];case"hsla":if(P.length!==4)return null;L=u(P.pop());case"hsl":if(P.length!==3)return null;var U=(parseFloat(P[0])%360+360)%360/360,$=u(P[1]),ee=u(P[2]),se=ee<=.5?ee*($+1):ee+$-ee*$,ie=2*ee-se;return[o(255*f(ie,se,U+1/3)),o(255*f(ie,se,U)),o(255*f(ie,se,U-1/3)),L];default:return null}}return null}}catch{}});class Yn{constructor(e,t,o,l=1){this.r=e,this.g=t,this.b=o,this.a=l}static parse(e){if(!e)return;if(e instanceof Yn)return e;if(typeof e!="string")return;const t=Co.parseCSSColor(e);return t?new Yn(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3]):void 0}toString(){const[e,t,o,l]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(o)},${l})`}toArray(){const{r:e,g:t,b:o,a:l}=this;return l===0?[0,0,0,0]:[255*e/l,255*t/l,255*o/l,l]}toArray01(){const{r:e,g:t,b:o,a:l}=this;return l===0?[0,0,0,0]:[e/l,t/l,o/l,l]}toArray01PremultipliedAlpha(){const{r:e,g:t,b:o,a:l}=this;return[e,t,o,l]}}Yn.black=new Yn(0,0,0,1),Yn.white=new Yn(1,1,1,1),Yn.transparent=new Yn(0,0,0,0),Yn.red=new Yn(1,0,0,1),Yn.blue=new Yn(0,0,1,1);var Ni=Yn;class Vc{constructor(e,t,o){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class _a{constructor(e,t,o,l,u){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=o,this.fontStack=l,this.textColor=u}}class ar{constructor(e){this.sections=e}static fromString(e){return new ar([new _a(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof ar?e:ar.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.name]);continue}e.push(t.text);const o={};t.fontStack&&(o["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(o["font-scale"]=t.scale),t.textColor&&(o["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(o)}return e}}class lr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new lr({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Uc(i,e,t,o){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[i,e,t,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[i,e,t,o]:[i,e,t]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ao(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Ni||i instanceof Vc||i instanceof ar||i instanceof lr)return!0;if(Array.isArray(i)){for(const e of i)if(!Ao(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!Ao(i[e]))return!1;return!0}return!1}function yn(i){if(i===null)return Ts;if(typeof i=="string")return gi;if(typeof i=="boolean")return yi;if(typeof i=="number")return zt;if(i instanceof Ni)return Br;if(i instanceof Vc)return fa;if(i instanceof ar)return pa;if(i instanceof lr)return ma;if(Array.isArray(i)){const e=i.length;let t;for(const o of i){const l=yn(o);if(t){if(t===l)continue;t=ui;break}t=l}return gr(t||ui,e)}return Rr}function ga(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof Ni||i instanceof ar||i instanceof lr?i.toString():JSON.stringify(i)}class Nc{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(e.length!==2)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ao(e[1]))return t.error("invalid value");const o=e[1];let l=yn(o);const u=t.expectedType;return l.kind!=="array"||l.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(l=u),new Nc(l,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ni?["rgba"].concat(this.value.toArray()):this.value instanceof ar?this.value.serialize():this.value}}var ya=Nc,Dn=class{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}};const va={string:gi,number:zt,boolean:yi,object:Rr};class jc{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let o,l=1;const u=e[0];if(u==="array"){let m,v;if(e.length>2){const x=e[1];if(typeof x!="string"||!(x in va)||x==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);m=va[x],l++}else m=ui;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);v=e[2],l++}o=gr(m,v)}else o=va[u];const f=[];for(;l<e.length;l++){const m=t.parse(e[l],l,ui);if(!m)return null;f.push(m)}return new jc(o,f)}evaluate(e){for(let t=0;t<this.args.length;t++){const o=this.args[t].evaluate(e);if(!Es(this.type,yn(o)))return o;if(t===this.args.length-1)throw new Dn(`Expected value to be of type ${sn(this.type)}, but found ${sn(yn(o))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,t=[e.kind];if(e.kind==="array"){const o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){t.push(o.kind);const l=e.N;(typeof l=="number"||this.args.length>1)&&t.push(l)}}return t.concat(this.args.map(o=>o.serialize()))}}var Sr=jc;class xa{constructor(e){this.type=pa,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return t.error("First argument must be an image or text section.");const l=[];let u=!1;for(let f=1;f<=e.length-1;++f){const m=e[f];if(u&&typeof m=="object"&&!Array.isArray(m)){u=!1;let v=null;if(m["font-scale"]&&(v=t.parse(m["font-scale"],1,zt),!v))return null;let x=null;if(m["text-font"]&&(x=t.parse(m["text-font"],1,gr(gi)),!x))return null;let S=null;if(m["text-color"]&&(S=t.parse(m["text-color"],1,Br),!S))return null;const M=l[l.length-1];M.scale=v,M.font=x,M.textColor=S}else{const v=t.parse(e[f],1,ui);if(!v)return null;const x=v.type.kind;if(x!=="string"&&x!=="value"&&x!=="null"&&x!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,l.push({content:v,scale:null,font:null,textColor:null})}}return new xa(l)}evaluate(e){return new ar(this.sections.map(t=>{const o=t.content.evaluate(e);return yn(o)===ma?new _a("",o,null,null,null):new _a(ga(o),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const o={};t.scale&&(o["font-scale"]=t.scale.serialize()),t.font&&(o["text-font"]=t.font.serialize()),t.textColor&&(o["text-color"]=t.textColor.serialize()),e.push(o)}return e}}class vl{constructor(e){this.type=ma,this.input=e}static parse(e,t){if(e.length!==2)return t.error("Expected two arguments.");const o=t.parse(e[1],1,gi);return o?new vl(o):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),o=lr.fromString(t);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(t)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Tp={"to-boolean":yi,"to-color":Br,"to-number":zt,"to-string":gi};class qc{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const o=e[0];if((o==="to-boolean"||o==="to-string")&&e.length!==2)return t.error("Expected one argument.");const l=Tp[o],u=[];for(let f=1;f<e.length;f++){const m=t.parse(e[f],f,ui);if(!m)return null;u.push(m)}return new qc(l,u)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let t,o;for(const l of this.args){if(t=l.evaluate(e),o=null,t instanceof Ni)return t;if(typeof t=="string"){const u=e.parseColor(t);if(u)return u}else if(Array.isArray(t)&&(o=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:Uc(t[0],t[1],t[2],t[3]),!o))return new Ni(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Dn(o||`Could not parse color from value '${typeof t=="string"?t:String(JSON.stringify(t))}'`)}if(this.type.kind==="number"){let t=null;for(const o of this.args){if(t=o.evaluate(e),t===null)return 0;const l=Number(t);if(!isNaN(l))return l}throw new Dn(`Could not convert ${JSON.stringify(t)} to number.`)}return this.type.kind==="formatted"?ar.fromString(ga(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?lr.fromString(ga(this.args[0].evaluate(e))):ga(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new xa([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new vl(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(t=>{e.push(t.serialize())}),e}}var Ss=qc;const Ep=["Unknown","Point","LineString","Polygon"];var qh=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ep[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const i=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:t,y:o}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(t*e-i[0])+this.featureDistanceData.bearing[1]*(o*e-i[1])}return 0}parseColor(i){let e=this._parseColorCache[i];return e||(e=this._parseColorCache[i]=Ni.parse(i)),e}};class Xo{constructor(e,t,o,l){this.name=e,this.type=t,this._evaluate=o,this.args=l}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,t){const o=e[0],l=Xo.definitions[o];if(!l)return t.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const u=Array.isArray(l)?l[0]:l.type,f=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,m=f.filter(([x])=>!Array.isArray(x)||x.length===e.length-1);let v=null;for(const[x,S]of m){v=new Yo(t.registry,t.path,null,t.scope);const M=[];let I=!1;for(let P=1;P<e.length;P++){const L=e[P],U=Array.isArray(x)?x[P-1]:x.type,$=v.parse(L,1+M.length,U);if(!$){I=!0;break}M.push($)}if(!I)if(Array.isArray(x)&&x.length!==M.length)v.error(`Expected ${x.length} arguments, but found ${M.length} instead.`);else{for(let P=0;P<M.length;P++){const L=Array.isArray(x)?x[P]:x.type,U=M[P];v.concat(P+1).checkSubtype(L,U.type)}if(v.errors.length===0)return new Xo(o,u,S,M)}}if(m.length===1)t.errors.push(...v.errors);else{const x=(m.length?m:f).map(([M])=>{return I=M,Array.isArray(I)?`(${I.map(sn).join(", ")})`:`(${sn(I.type)}...)`;var I}).join(" | "),S=[];for(let M=1;M<e.length;M++){const I=t.parse(e[M],1+S.length);if(!I)return null;S.push(sn(I.type))}t.error(`Expected arguments of type ${x}, but found (${S.join(", ")}) instead.`)}return null}static register(e,t){Xo.definitions=t;for(const o in t)e[o]=Xo}}var Fr=Xo;class xl{constructor(e,t,o){this.type=fa,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(e.length!==2)return t.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return t.error("Collator options argument must be an object.");const l=t.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,yi);if(!l)return null;const u=t.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,yi);if(!u)return null;let f=null;return o.locale&&(f=t.parse(o.locale,1,gi),!f)?null:new xl(l,u,f)}evaluate(e){return new Vc(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Mo=8192;function $c(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function bl(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function Sp(i,e){const t=(180+i[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(t*l*Mo),Math.round(o*l*Mo)]}function Cp(i,e,t){const o=i[0]-e[0],l=i[1]-e[1],u=i[0]-t[0],f=i[1]-t[1];return o*f-u*l==0&&o*u<=0&&l*f<=0}function wl(i,e){let t=!1;for(let f=0,m=e.length;f<m;f++){const v=e[f];for(let x=0,S=v.length;x<S-1;x++){if(Cp(i,v[x],v[x+1]))return!1;(l=v[x])[1]>(o=i)[1]!=(u=v[x+1])[1]>o[1]&&o[0]<(u[0]-l[0])*(o[1]-l[1])/(u[1]-l[1])+l[0]&&(t=!t)}}var o,l,u;return t}function Tl(i,e){for(let t=0;t<e.length;t++)if(wl(i,e[t]))return!0;return!1}function $h(i,e,t,o){const l=o[0]-t[0],u=o[1]-t[1],f=(i[0]-t[0])*u-l*(i[1]-t[1]),m=(e[0]-t[0])*u-l*(e[1]-t[1]);return f>0&&m<0||f<0&&m>0}function Ap(i,e,t){for(const x of t)for(let S=0;S<x.length-1;++S)if((m=[(f=x[S+1])[0]-(u=x[S])[0],f[1]-u[1]])[0]*(v=[(l=e)[0]-(o=i)[0],l[1]-o[1]])[1]-m[1]*v[0]!=0&&$h(o,l,u,f)&&$h(u,f,o,l))return!0;var o,l,u,f,m,v;return!1}function Gh(i,e){for(let t=0;t<i.length;++t)if(!wl(i[t],e))return!1;for(let t=0;t<i.length-1;++t)if(Ap(i[t],i[t+1],e))return!1;return!0}function Mp(i,e){for(let t=0;t<e.length;t++)if(Gh(i,e[t]))return!0;return!1}function Cr(i,e,t){const o=[];for(let l=0;l<i.length;l++){const u=[];for(let f=0;f<i[l].length;f++){const m=Sp(i[l][f],t);$c(e,m),u.push(m)}o.push(u)}return o}function Gc(i,e,t){const o=[];for(let l=0;l<i.length;l++){const u=Cr(i[l],e,t);o.push(u)}return o}function Zc(i,e,t,o){if(i[0]<t[0]||i[0]>t[2]){const l=.5*o;let u=i[0]-t[0]>l?-o:t[0]-i[0]>l?o:0;u===0&&(u=i[0]-t[2]>l?-o:t[2]-i[0]>l?o:0),i[0]+=u}$c(e,i)}function Wc(i,e,t,o){const l=Math.pow(2,o.z)*Mo,u=[o.x*Mo,o.y*Mo],f=[];if(!i)return f;for(const m of i)for(const v of m){const x=[v.x+u[0],v.y+u[1]];Zc(x,e,t,l),f.push(x)}return f}function Hc(i,e,t,o){const l=Math.pow(2,o.z)*Mo,u=[o.x*Mo,o.y*Mo],f=[];if(!i)return f;for(const v of i){const x=[];for(const S of v){const M=[S.x+u[0],S.y+u[1]];$c(e,M),x.push(M)}f.push(x)}if(e[2]-e[0]<=l/2){(m=e)[0]=m[1]=1/0,m[2]=m[3]=-1/0;for(const v of f)for(const x of v)Zc(x,e,t,l)}var m;return f}class Cs{constructor(e,t){this.type=yi,this.geojson=e,this.geometries=t}static parse(e,t){if(e.length!==2)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ao(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let l=0;l<o.features.length;++l){const u=o.features[l].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Cs(o,o.features[l].geometry)}else if(o.type==="Feature"){const l=o.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new Cs(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Cs(o,o)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(t,o){const l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],f=t.canonicalID();if(!f)return!1;if(o.type==="Polygon"){const m=Cr(o.coordinates,u,f),v=Wc(t.geometry(),l,u,f);if(!bl(l,u))return!1;for(const x of v)if(!wl(x,m))return!1}if(o.type==="MultiPolygon"){const m=Gc(o.coordinates,u,f),v=Wc(t.geometry(),l,u,f);if(!bl(l,u))return!1;for(const x of v)if(!Tl(x,m))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(t,o){const l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],f=t.canonicalID();if(!f)return!1;if(o.type==="Polygon"){const m=Cr(o.coordinates,u,f),v=Hc(t.geometry(),l,u,f);if(!bl(l,u))return!1;for(const x of v)if(!Gh(x,m))return!1}if(o.type==="MultiPolygon"){const m=Gc(o.coordinates,u,f),v=Hc(t.geometry(),l,u,f);if(!bl(l,u))return!1;for(const x of v)if(!Mp(x,m))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var El=Cs;function Ko(i){if(i instanceof Fr&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof El)return!1;let e=!0;return i.eachChild(t=>{e&&!Ko(t)&&(e=!1)}),e}function Io(i){if(i instanceof Fr&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(t=>{e&&!Io(t)&&(e=!1)}),e}function ba(i,e){if(i instanceof Fr&&e.indexOf(i.name)>=0)return!1;let t=!0;return i.eachChild(o=>{t&&!ba(o,e)&&(t=!1)}),t}class Sl{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");const o=e[1];return t.scope.has(o)?new Sl(o,t.scope.get(o)):t.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Cl=Sl;class Al{constructor(e,t=[],o,l=new wp,u=[]){this.registry=e,this.path=t,this.key=t.map(f=>`[${f}]`).join(""),this.scope=l,this.errors=u,this.expectedType=o}parse(e,t,o,l,u={}){return t?this.concat(t,o,l)._parse(e,u):this._parse(e,u)}_parse(e,t){function o(l,u,f){return f==="assert"?new Sr(u,[l]):f==="coerce"?new Ss(u,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=e[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const u=this.registry[l];if(u){let f=u.parse(e,this);if(!f)return null;if(this.expectedType){const m=this.expectedType,v=f.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||v.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(m,v))return null}else f=o(f,m,t.typeAnnotation||"coerce");else f=o(f,m,t.typeAnnotation||"assert")}if(!(f instanceof ya)&&f.type.kind!=="resolvedImage"&&Di(f)){const m=new qh;try{f=new ya(f.type,f.evaluate(m))}catch(v){return this.error(v.message),null}}return f}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,o){const l=typeof e=="number"?this.path.concat(e):this.path,u=o?this.scope.concat(o):this.scope;return new Al(this.registry,l,t||null,u,this.errors)}error(e,...t){const o=`${this.key}${t.map(l=>`[${l}]`).join("")}`;this.errors.push(new Kn(o,e))}checkSubtype(e,t){const o=Es(e,t);return o&&this.error(o),o}}var Yo=Al;function Di(i){if(i instanceof Cl)return Di(i.boundExpression);if(i instanceof Fr&&i.name==="error"||i instanceof xl||i instanceof El)return!1;const e=i instanceof Ss||i instanceof Sr;let t=!0;return i.eachChild(o=>{t=e?t&&Di(o):t&&o instanceof ya}),!!t&&Ko(i)&&ba(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Ml(i,e){const t=i.length-1;let o,l,u=0,f=t,m=0;for(;u<=f;)if(m=Math.floor((u+f)/2),o=i[m],l=i[m+1],o<=e){if(m===t||e<l)return m;u=m+1}else{if(!(o>e))throw new Dn("Input is not a number.");f=m-1}return 0}class Xc{constructor(e,t,o){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[l,u]of o)this.labels.push(l),this.outputs.push(u)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const o=t.parse(e[1],1,zt);if(!o)return null;const l=[];let u=null;t.expectedType&&t.expectedType.kind!=="value"&&(u=t.expectedType);for(let f=1;f<e.length;f+=2){const m=f===1?-1/0:e[f],v=e[f+1],x=f,S=f+1;if(typeof m!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',x);if(l.length&&l[l.length-1][0]>=m)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',x);const M=t.parse(v,S,u);if(!M)return null;u=u||M.type,l.push([m,M])}return new Xc(u,o,l)}evaluate(e){const t=this.labels,o=this.outputs;if(t.length===1)return o[0].evaluate(e);const l=this.input.evaluate(e);if(l<=t[0])return o[0].evaluate(e);const u=t.length;return l>=t[u-1]?o[u-1].evaluate(e):o[Ml(t,l)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var Kc=Xc;function Mi(i,e,t){return i*(1-t)+e*t}function As(i,e,t){return i.map((o,l)=>Mi(o,e[l],t))}var wa=Object.freeze({__proto__:null,number:Mi,color:function(i,e,t){return new Ni(Mi(i.r,e.r,t),Mi(i.g,e.g,t),Mi(i.b,e.b,t),Mi(i.a,e.a,t))},array:As});const Yc=.95047,Jc=1.08883,Qc=4/29,ko=6/29,Ta=3*ko*ko,Ip=Math.PI/180,eu=180/Math.PI;function Il(i){return i>.008856451679035631?Math.pow(i,1/3):i/Ta+Qc}function tu(i){return i>ko?i*i*i:Ta*(i-Qc)}function iu(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function kl(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Zh(i){const e=kl(i.r),t=kl(i.g),o=kl(i.b),l=Il((.4124564*e+.3575761*t+.1804375*o)/Yc),u=Il((.2126729*e+.7151522*t+.072175*o)/1);return{l:116*u-16,a:500*(l-u),b:200*(u-Il((.0193339*e+.119192*t+.9503041*o)/Jc)),alpha:i.a}}function nu(i){let e=(i.l+16)/116,t=isNaN(i.a)?e:e+i.a/500,o=isNaN(i.b)?e:e-i.b/200;return e=1*tu(e),t=Yc*tu(t),o=Jc*tu(o),new Ni(iu(3.2404542*t-1.5371385*e-.4985314*o),iu(-.969266*t+1.8760108*e+.041556*o),iu(.0556434*t-.2040259*e+1.0572252*o),i.alpha)}function Wh(i,e,t){const o=e-i;return i+t*(o>180||o<-180?o-360*Math.round(o/360):o)}const Ea={forward:Zh,reverse:nu,interpolate:function(i,e,t){return{l:Mi(i.l,e.l,t),a:Mi(i.a,e.a,t),b:Mi(i.b,e.b,t),alpha:Mi(i.alpha,e.alpha,t)}}},Ms={forward:function(i){const{l:e,a:t,b:o}=Zh(i),l=Math.atan2(o,t)*eu;return{h:l<0?l+360:l,c:Math.sqrt(t*t+o*o),l:e,alpha:i.a}},reverse:function(i){const e=i.h*Ip,t=i.c;return nu({l:i.l,a:Math.cos(e)*t,b:Math.sin(e)*t,alpha:i.alpha})},interpolate:function(i,e,t){return{h:Wh(i.h,e.h,t),c:Mi(i.c,e.c,t),l:Mi(i.l,e.l,t),alpha:Mi(i.alpha,e.alpha,t)}}};var Hh=Object.freeze({__proto__:null,lab:Ea,hcl:Ms});class Sa{constructor(e,t,o,l,u){this.type=e,this.operator=t,this.interpolation=o,this.input=l,this.labels=[],this.outputs=[];for(const[f,m]of u)this.labels.push(f),this.outputs.push(m)}static interpolationFactor(e,t,o,l){let u=0;if(e.name==="exponential")u=zl(t,e.base,o,l);else if(e.name==="linear")u=zl(t,1,o,l);else if(e.name==="cubic-bezier"){const f=e.controlPoints;u=new V(f[0],f[1],f[2],f[3]).solve(zl(t,1,o,l))}return u}static parse(e,t){let[o,l,u,...f]=e;if(!Array.isArray(l)||l.length===0)return t.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const x=l[1];if(typeof x!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:x}}else{if(l[0]!=="cubic-bezier")return t.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const x=l.slice(1);if(x.length!==4||x.some(S=>typeof S!="number"||S<0||S>1))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:x}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(u=t.parse(u,2,zt),!u)return null;const m=[];let v=null;o==="interpolate-hcl"||o==="interpolate-lab"?v=Br:t.expectedType&&t.expectedType.kind!=="value"&&(v=t.expectedType);for(let x=0;x<f.length;x+=2){const S=f[x],M=f[x+1],I=x+3,P=x+4;if(typeof S!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(m.length&&m[m.length-1][0]>=S)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',I);const L=t.parse(M,P,v);if(!L)return null;v=v||L.type,m.push([S,L])}return v.kind==="number"||v.kind==="color"||v.kind==="array"&&v.itemType.kind==="number"&&typeof v.N=="number"?new Sa(v,o,l,u,m):t.error(`Type ${sn(v)} is not interpolatable.`)}evaluate(e){const t=this.labels,o=this.outputs;if(t.length===1)return o[0].evaluate(e);const l=this.input.evaluate(e);if(l<=t[0])return o[0].evaluate(e);const u=t.length;if(l>=t[u-1])return o[u-1].evaluate(e);const f=Ml(t,l),m=Sa.interpolationFactor(this.interpolation,l,t[f],t[f+1]),v=o[f].evaluate(e),x=o[f+1].evaluate(e);return this.operator==="interpolate"?wa[this.type.kind.toLowerCase()](v,x,m):this.operator==="interpolate-hcl"?Ms.reverse(Ms.interpolate(Ms.forward(v),Ms.forward(x),m)):Ea.reverse(Ea.interpolate(Ea.forward(v),Ea.forward(x),m))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let o=0;o<this.labels.length;o++)t.push(this.labels[o],this.outputs[o].serialize());return t}}function zl(i,e,t,o){const l=o-t,u=i-t;return l===0?0:e===1?u/l:(Math.pow(e,u)-1)/(Math.pow(e,l)-1)}var $r=Sa;class ru{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let o=null;const l=t.expectedType;l&&l.kind!=="value"&&(o=l);const u=[];for(const m of e.slice(1)){const v=t.parse(m,1+u.length,o,void 0,{typeAnnotation:"omit"});if(!v)return null;o=o||v.type,u.push(v)}const f=l&&u.some(m=>Es(l,m.type));return new ru(f?ui:o,u)}evaluate(e){let t,o=null,l=0;for(const u of this.args){if(l++,o=u.evaluate(e),o&&o instanceof lr&&!o.available&&(t||(t=o),o=null,l===this.args.length))return t;if(o!==null)break}return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var Xh=ru;class ou{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let u=1;u<e.length-1;u+=2){const f=e[u];if(typeof f!="string")return t.error(`Expected string, but found ${typeof f} instead.`,u);if(/[^a-zA-Z0-9_]/.test(f))return t.error("Variable names must contain only alphanumeric characters or '_'.",u);const m=t.parse(e[u+1],u+1);if(!m)return null;o.push([f,m])}const l=t.parse(e[e.length-1],e.length-1,t.expectedType,o);return l?new ou(o,l):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,o]of this.bindings)e.push(t,o.serialize());return e.push(this.result.serialize()),e}}var Kh=ou;class su{constructor(e,t,o){this.type=e,this.index=t,this.input=o}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=t.parse(e[1],1,zt),l=t.parse(e[2],2,gr(t.expectedType||ui));return o&&l?new su(l.type.itemType,o,l):null}evaluate(e){const t=this.index.evaluate(e),o=this.input.evaluate(e);if(t<0)throw new Dn(`Array index out of bounds: ${t} < 0.`);if(t>=o.length)throw new Dn(`Array index out of bounds: ${t} > ${o.length-1}.`);if(t!==Math.floor(t))throw new Dn(`Array index must be an integer, but found ${t} instead.`);return o[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Yh=su;class au{constructor(e,t){this.type=yi,this.needle=e,this.haystack=t}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=t.parse(e[1],1,ui),l=t.parse(e[2],2,ui);return o&&l?yl(o.type,[yi,gi,zt,Ts,ui])?new au(o,l):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${sn(o.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(o==null)return!1;if(!So(t,["boolean","string","number","null"]))throw new Dn(`Expected first argument to be of type boolean, string, number or null, but found ${sn(yn(t))} instead.`);if(!So(o,["string","array"]))throw new Dn(`Expected second argument to be of type array or string, but found ${sn(yn(o))} instead.`);return o.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var kp=au;class Pl{constructor(e,t,o){this.type=zt,this.needle=e,this.haystack=t,this.fromIndex=o}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=t.parse(e[1],1,ui),l=t.parse(e[2],2,ui);if(!o||!l)return null;if(!yl(o.type,[yi,gi,zt,Ts,ui]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${sn(o.type)} instead`);if(e.length===4){const u=t.parse(e[3],3,zt);return u?new Pl(o,l,u):null}return new Pl(o,l)}evaluate(e){const t=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!So(t,["boolean","string","number","null"]))throw new Dn(`Expected first argument to be of type boolean, string, number or null, but found ${sn(yn(t))} instead.`);if(!So(o,["string","array"]))throw new Dn(`Expected second argument to be of type array or string, but found ${sn(yn(o))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(e);return o.indexOf(t,l)}return o.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var zp=Pl;class Dl{constructor(e,t,o,l,u,f){this.inputType=e,this.type=t,this.input=o,this.cases=l,this.outputs=u,this.otherwise=f}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let o,l;t.expectedType&&t.expectedType.kind!=="value"&&(l=t.expectedType);const u={},f=[];for(let x=2;x<e.length-1;x+=2){let S=e[x];const M=e[x+1];Array.isArray(S)||(S=[S]);const I=t.concat(x);if(S.length===0)return I.error("Expected at least one branch label.");for(const L of S){if(typeof L!="number"&&typeof L!="string")return I.error("Branch labels must be numbers or strings.");if(typeof L=="number"&&Math.abs(L)>Number.MAX_SAFE_INTEGER)return I.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof L=="number"&&Math.floor(L)!==L)return I.error("Numeric branch labels must be integer values.");if(o){if(I.checkSubtype(o,yn(L)))return null}else o=yn(L);if(u[String(L)]!==void 0)return I.error("Branch labels must be unique.");u[String(L)]=f.length}const P=t.parse(M,x,l);if(!P)return null;l=l||P.type,f.push(P)}const m=t.parse(e[1],1,ui);if(!m)return null;const v=t.parse(e[e.length-1],e.length-1,l);return v?m.type.kind!=="value"&&t.concat(1).checkSubtype(o,m.type)?null:new Dl(o,l,m,u,f,v):null}evaluate(e){const t=this.input.evaluate(e);return(yn(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),o=[],l={};for(const f of t){const m=l[this.cases[f]];m===void 0?(l[this.cases[f]]=o.length,o.push([this.cases[f],[f]])):o[m][1].push(f)}const u=f=>this.inputType.kind==="number"?Number(f):f;for(const[f,m]of o)e.push(m.length===1?u(m[0]):m.map(u)),e.push(this.outputs[f].serialize());return e.push(this.otherwise.serialize()),e}}var Jh=Dl;class Ll{constructor(e,t,o){this.type=e,this.branches=t,this.otherwise=o}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let o;t.expectedType&&t.expectedType.kind!=="value"&&(o=t.expectedType);const l=[];for(let f=1;f<e.length-1;f+=2){const m=t.parse(e[f],f,yi);if(!m)return null;const v=t.parse(e[f+1],f+1,o);if(!v)return null;l.push([m,v]),o=o||v.type}const u=t.parse(e[e.length-1],e.length-1,o);return u?new Ll(o,l,u):null}evaluate(e){for(const[t,o]of this.branches)if(t.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,o]of this.branches)e(t),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,t])=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var Pp=Ll;class Bl{constructor(e,t,o,l){this.type=e,this.input=t,this.beginIndex=o,this.endIndex=l}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=t.parse(e[1],1,ui),l=t.parse(e[2],2,zt);if(!o||!l)return null;if(!yl(o.type,[gr(ui),gi,ui]))return t.error(`Expected first argument to be of type array or string, but found ${sn(o.type)} instead`);if(e.length===4){const u=t.parse(e[3],3,zt);return u?new Bl(o.type,o,l,u):null}return new Bl(o.type,o,l)}evaluate(e){const t=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!So(t,["string","array"]))throw new Dn(`Expected first argument to be of type array or string, but found ${sn(yn(t))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(e);return t.slice(o,l)}return t.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Qh=Bl;function lu(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function cu(i,e,t,o){return o.compare(e,t)===0}function Is(i,e,t){const o=i!=="=="&&i!=="!=";return class Hb{constructor(u,f,m){this.type=yi,this.lhs=u,this.rhs=f,this.collator=m,this.hasUntypedArgument=u.type.kind==="value"||f.type.kind==="value"}static parse(u,f){if(u.length!==3&&u.length!==4)return f.error("Expected two or three arguments.");const m=u[0];let v=f.parse(u[1],1,ui);if(!v)return null;if(!lu(m,v.type))return f.concat(1).error(`"${m}" comparisons are not supported for type '${sn(v.type)}'.`);let x=f.parse(u[2],2,ui);if(!x)return null;if(!lu(m,x.type))return f.concat(2).error(`"${m}" comparisons are not supported for type '${sn(x.type)}'.`);if(v.type.kind!==x.type.kind&&v.type.kind!=="value"&&x.type.kind!=="value")return f.error(`Cannot compare types '${sn(v.type)}' and '${sn(x.type)}'.`);o&&(v.type.kind==="value"&&x.type.kind!=="value"?v=new Sr(x.type,[v]):v.type.kind!=="value"&&x.type.kind==="value"&&(x=new Sr(v.type,[x])));let S=null;if(u.length===4){if(v.type.kind!=="string"&&x.type.kind!=="string"&&v.type.kind!=="value"&&x.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(S=f.parse(u[3],3,fa),!S)return null}return new Hb(v,x,S)}evaluate(u){const f=this.lhs.evaluate(u),m=this.rhs.evaluate(u);if(o&&this.hasUntypedArgument){const v=yn(f),x=yn(m);if(v.kind!==x.kind||v.kind!=="string"&&v.kind!=="number")throw new Dn(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${v.kind}, ${x.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const v=yn(f),x=yn(m);if(v.kind!=="string"||x.kind!=="string")return e(u,f,m)}return this.collator?t(u,f,m,this.collator.evaluate(u)):e(u,f,m)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){const u=[i];return this.eachChild(f=>{u.push(f.serialize())}),u}}}const Dp=Is("==",function(i,e,t){return e===t},cu),Lp=Is("!=",function(i,e,t){return e!==t},function(i,e,t,o){return!cu(0,e,t,o)}),Bp=Is("<",function(i,e,t){return e<t},function(i,e,t,o){return o.compare(e,t)<0}),Rl=Is(">",function(i,e,t){return e>t},function(i,e,t,o){return o.compare(e,t)>0}),ed=Is("<=",function(i,e,t){return e<=t},function(i,e,t,o){return o.compare(e,t)<=0}),td=Is(">=",function(i,e,t){return e>=t},function(i,e,t,o){return o.compare(e,t)>=0});class uu{constructor(e,t,o,l,u,f){this.type=gi,this.number=e,this.locale=t,this.currency=o,this.unit=l,this.minFractionDigits=u,this.maxFractionDigits=f}static parse(e,t){if(e.length!==3)return t.error("Expected two arguments.");const o=t.parse(e[1],1,zt);if(!o)return null;const l=e[2];if(typeof l!="object"||Array.isArray(l))return t.error("NumberFormat options argument must be an object.");let u=null;if(l.locale&&(u=t.parse(l.locale,1,gi),!u))return null;let f=null;if(l.currency&&(f=t.parse(l.currency,1,gi),!f))return null;let m=null;if(l.unit&&(m=t.parse(l.unit,1,gi),!m))return null;let v=null;if(l["min-fraction-digits"]&&(v=t.parse(l["min-fraction-digits"],1,zt),!v))return null;let x=null;return l["max-fraction-digits"]&&(x=t.parse(l["max-fraction-digits"],1,zt),!x)?null:new uu(o,u,f,m,v,x)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class hu{constructor(e){this.type=zt,this.input=e}static parse(e,t){if(e.length!==2)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=t.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?t.error(`Expected argument of type string or array, but found ${sn(o.type)} instead.`):new hu(o):null}evaluate(e){const t=this.input.evaluate(e);if(typeof t=="string"||Array.isArray(t))return t.length;throw new Dn(`Expected value to be of type string or array, but found ${sn(yn(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(t=>{e.push(t.serialize())}),e}}const id={"==":Dp,"!=":Lp,">":Rl,"<":Bp,">=":td,"<=":ed,array:Sr,at:Yh,boolean:Sr,case:Pp,coalesce:Xh,collator:xl,format:xa,image:vl,in:kp,"index-of":zp,interpolate:$r,"interpolate-hcl":$r,"interpolate-lab":$r,length:hu,let:Kh,literal:ya,match:Jh,number:Sr,"number-format":uu,object:Sr,slice:Qh,step:Kc,string:Sr,"to-boolean":Ss,"to-color":Ss,"to-number":Ss,"to-string":Ss,var:Cl,within:El};function du(i,[e,t,o,l]){e=e.evaluate(i),t=t.evaluate(i),o=o.evaluate(i);const u=l?l.evaluate(i):1,f=Uc(e,t,o,u);if(f)throw new Dn(f);return new Ni(e/255*u,t/255*u,o/255*u,u)}function fu(i,e){return i in e}function Fl(i,e){const t=e[i];return t===void 0?null:t}function no(i){return{type:i}}Fr.register(id,{error:[{kind:"error"},[gi],(i,[e])=>{throw new Dn(e.evaluate(i))}],typeof:[gi,[ui],(i,[e])=>sn(yn(e.evaluate(i)))],"to-rgba":[gr(zt,4),[Br],(i,[e])=>e.evaluate(i).toArray()],rgb:[Br,[zt,zt,zt],du],rgba:[Br,[zt,zt,zt,zt],du],has:{type:yi,overloads:[[[gi],(i,[e])=>fu(e.evaluate(i),i.properties())],[[gi,Rr],(i,[e,t])=>fu(e.evaluate(i),t.evaluate(i))]]},get:{type:ui,overloads:[[[gi],(i,[e])=>Fl(e.evaluate(i),i.properties())],[[gi,Rr],(i,[e,t])=>Fl(e.evaluate(i),t.evaluate(i))]]},"feature-state":[ui,[gi],(i,[e])=>Fl(e.evaluate(i),i.featureState||{})],properties:[Rr,[],i=>i.properties()],"geometry-type":[gi,[],i=>i.geometryType()],id:[ui,[],i=>i.id()],zoom:[zt,[],i=>i.globals.zoom],pitch:[zt,[],i=>i.globals.pitch||0],"distance-from-center":[zt,[],i=>i.distanceFromCenter()],"heatmap-density":[zt,[],i=>i.globals.heatmapDensity||0],"line-progress":[zt,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[zt,[],i=>i.globals.skyRadialProgress||0],accumulated:[ui,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[zt,no(zt),(i,e)=>{let t=0;for(const o of e)t+=o.evaluate(i);return t}],"*":[zt,no(zt),(i,e)=>{let t=1;for(const o of e)t*=o.evaluate(i);return t}],"-":{type:zt,overloads:[[[zt,zt],(i,[e,t])=>e.evaluate(i)-t.evaluate(i)],[[zt],(i,[e])=>-e.evaluate(i)]]},"/":[zt,[zt,zt],(i,[e,t])=>e.evaluate(i)/t.evaluate(i)],"%":[zt,[zt,zt],(i,[e,t])=>e.evaluate(i)%t.evaluate(i)],ln2:[zt,[],()=>Math.LN2],pi:[zt,[],()=>Math.PI],e:[zt,[],()=>Math.E],"^":[zt,[zt,zt],(i,[e,t])=>Math.pow(e.evaluate(i),t.evaluate(i))],sqrt:[zt,[zt],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[zt,[zt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[zt,[zt],(i,[e])=>Math.log(e.evaluate(i))],log2:[zt,[zt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[zt,[zt],(i,[e])=>Math.sin(e.evaluate(i))],cos:[zt,[zt],(i,[e])=>Math.cos(e.evaluate(i))],tan:[zt,[zt],(i,[e])=>Math.tan(e.evaluate(i))],asin:[zt,[zt],(i,[e])=>Math.asin(e.evaluate(i))],acos:[zt,[zt],(i,[e])=>Math.acos(e.evaluate(i))],atan:[zt,[zt],(i,[e])=>Math.atan(e.evaluate(i))],min:[zt,no(zt),(i,e)=>Math.min(...e.map(t=>t.evaluate(i)))],max:[zt,no(zt),(i,e)=>Math.max(...e.map(t=>t.evaluate(i)))],abs:[zt,[zt],(i,[e])=>Math.abs(e.evaluate(i))],round:[zt,[zt],(i,[e])=>{const t=e.evaluate(i);return t<0?-Math.round(-t):Math.round(t)}],floor:[zt,[zt],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[zt,[zt],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[yi,[gi,ui],(i,[e,t])=>i.properties()[e.value]===t.value],"filter-id-==":[yi,[ui],(i,[e])=>i.id()===e.value],"filter-type-==":[yi,[gi],(i,[e])=>i.geometryType()===e.value],"filter-<":[yi,[gi,ui],(i,[e,t])=>{const o=i.properties()[e.value],l=t.value;return typeof o==typeof l&&o<l}],"filter-id-<":[yi,[ui],(i,[e])=>{const t=i.id(),o=e.value;return typeof t==typeof o&&t<o}],"filter->":[yi,[gi,ui],(i,[e,t])=>{const o=i.properties()[e.value],l=t.value;return typeof o==typeof l&&o>l}],"filter-id->":[yi,[ui],(i,[e])=>{const t=i.id(),o=e.value;return typeof t==typeof o&&t>o}],"filter-<=":[yi,[gi,ui],(i,[e,t])=>{const o=i.properties()[e.value],l=t.value;return typeof o==typeof l&&o<=l}],"filter-id-<=":[yi,[ui],(i,[e])=>{const t=i.id(),o=e.value;return typeof t==typeof o&&t<=o}],"filter->=":[yi,[gi,ui],(i,[e,t])=>{const o=i.properties()[e.value],l=t.value;return typeof o==typeof l&&o>=l}],"filter-id->=":[yi,[ui],(i,[e])=>{const t=i.id(),o=e.value;return typeof t==typeof o&&t>=o}],"filter-has":[yi,[ui],(i,[e])=>e.value in i.properties()],"filter-has-id":[yi,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[yi,[gr(gi)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[yi,[gr(ui)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[yi,[gi,gr(ui)],(i,[e,t])=>t.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[yi,[gi,gr(ui)],(i,[e,t])=>function(o,l,u,f){for(;u<=f;){const m=u+f>>1;if(l[m]===o)return!0;l[m]>o?f=m-1:u=m+1}return!1}(i.properties()[e.value],t.value,0,t.value.length-1)],all:{type:yi,overloads:[[[yi,yi],(i,[e,t])=>e.evaluate(i)&&t.evaluate(i)],[no(yi),(i,e)=>{for(const t of e)if(!t.evaluate(i))return!1;return!0}]]},any:{type:yi,overloads:[[[yi,yi],(i,[e,t])=>e.evaluate(i)||t.evaluate(i)],[no(yi),(i,e)=>{for(const t of e)if(t.evaluate(i))return!0;return!1}]]},"!":[yi,[yi],(i,[e])=>!e.evaluate(i)],"is-supported-script":[yi,[gi],(i,[e])=>{const t=i.globals&&i.globals.isSupportedScript;return!t||t(e.evaluate(i))}],upcase:[gi,[gi],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[gi,[gi],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[gi,no(ui),(i,e)=>e.map(t=>ga(t.evaluate(i))).join("")],"resolved-locale":[gi,[fa],(i,[e])=>e.evaluate(i).resolvedLocale()]});var Ca=id;function nd(i){return{result:"success",value:i}}function ks(i){return{result:"error",value:i}}function zs(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function rd(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function pu(i){return!!i.expression&&i.expression.interpolated}function Ri(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Aa(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function od(i){return i}function Ma(i,e){const t=e.type==="color",o=i.stops&&typeof i.stops[0][0]=="object",l=o||!(o||i.property!==void 0),u=i.type||(pu(e)?"exponential":"interval");if(t&&((i=wi({},i)).stops&&(i.stops=i.stops.map(x=>[x[0],Ni.parse(x[1])])),i.default=Ni.parse(i.default?i.default:e.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!Hh[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let f,m,v;if(u==="exponential")f=mu;else if(u==="interval")f=zo;else if(u==="categorical"){f=Rp,m=Object.create(null);for(const x of i.stops)m[x[0]]=x[1];v=typeof i.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);f=Ps}if(o){const x={},S=[];for(let P=0;P<i.stops.length;P++){const L=i.stops[P],U=L[0].zoom;x[U]===void 0&&(x[U]={zoom:U,type:i.type,property:i.property,default:i.default,stops:[]},S.push(U)),x[U].stops.push([L[0].value,L[1]])}const M=[];for(const P of S)M.push([x[P].zoom,Ma(x[P],e)]);const I={name:"linear"};return{kind:"composite",interpolationType:I,interpolationFactor:$r.interpolationFactor.bind(void 0,I),zoomStops:M.map(P=>P[0]),evaluate:({zoom:P},L)=>mu({stops:M,base:i.base},e,P).evaluate(P,L)}}if(l){const x=u==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:x,interpolationFactor:$r.interpolationFactor.bind(void 0,x),zoomStops:i.stops.map(S=>S[0]),evaluate:({zoom:S})=>f(i,e,S,m,v)}}return{kind:"source",evaluate(x,S){const M=S&&S.properties?S.properties[i.property]:void 0;return M===void 0?Ia(i.default,e.default):f(i,e,M,m,v)}}}function Ia(i,e,t){return i!==void 0?i:e!==void 0?e:t!==void 0?t:void 0}function Rp(i,e,t,o,l){return Ia(typeof t===l?o[t]:void 0,i.default,e.default)}function zo(i,e,t){if(Ri(t)!=="number")return Ia(i.default,e.default);const o=i.stops.length;if(o===1||t<=i.stops[0][0])return i.stops[0][1];if(t>=i.stops[o-1][0])return i.stops[o-1][1];const l=Ml(i.stops.map(u=>u[0]),t);return i.stops[l][1]}function mu(i,e,t){const o=i.base!==void 0?i.base:1;if(Ri(t)!=="number")return Ia(i.default,e.default);const l=i.stops.length;if(l===1||t<=i.stops[0][0])return i.stops[0][1];if(t>=i.stops[l-1][0])return i.stops[l-1][1];const u=Ml(i.stops.map(S=>S[0]),t),f=function(S,M,I,P){const L=P-I,U=S-I;return L===0?0:M===1?U/L:(Math.pow(M,U)-1)/(Math.pow(M,L)-1)}(t,o,i.stops[u][0],i.stops[u+1][0]),m=i.stops[u][1],v=i.stops[u+1][1];let x=wa[e.type]||od;if(i.colorSpace&&i.colorSpace!=="rgb"){const S=Hh[i.colorSpace];x=(M,I)=>S.reverse(S.interpolate(S.forward(M),S.forward(I),f))}return typeof m.evaluate=="function"?{evaluate(...S){const M=m.evaluate.apply(void 0,S),I=v.evaluate.apply(void 0,S);if(M!==void 0&&I!==void 0)return x(M,I,f)}}:x(m,v,f)}function Ps(i,e,t){return e.type==="color"?t=Ni.parse(t):e.type==="formatted"?t=ar.fromString(t.toString()):e.type==="resolvedImage"?t=lr.fromString(t.toString()):Ri(t)===e.type||e.type==="enum"&&e.values[t]||(t=void 0),Ia(t,i.default,e.default)}class _u{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new qh,this._defaultValue=t?function(o){return o.type==="color"&&(Aa(o.default)||Array.isArray(o.default))?new Ni(0,0,0,0):o.type==="color"?Ni.parse(o.default)||null:o.default===void 0?null:o.default}(t):null,this._enumValues=t&&t.type==="enum"?t.values:null}evaluateWithoutErrorHandling(e,t,o,l,u,f,m,v){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=o,this._evaluator.canonical=l||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=f,this._evaluator.featureTileCoord=m||null,this._evaluator.featureDistanceData=v||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,o,l,u,f,m,v){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=o||null,this._evaluator.canonical=l||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=f||null,this._evaluator.featureTileCoord=m||null,this._evaluator.featureDistanceData=v||null;try{const x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new Dn(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(x)} instead.`);return x}catch(x){return this._warningHistory[x.message]||(this._warningHistory[x.message]=!0,typeof console<"u"&&console.warn(x.message)),this._defaultValue}}}function Ol(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Ca}function Ds(i,e){const t=new Yo(Ca,[],e?function(l){const u={color:Br,string:gi,number:zt,enum:gi,boolean:yi,formatted:pa,resolvedImage:ma};return l.type==="array"?gr(u[l.value]||ui,l.length):u[l.type]}(e):void 0),o=t.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?nd(new _u(o,e)):ks(t.errors)}class gu{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!Io(t.expression)}evaluateWithoutErrorHandling(e,t,o,l,u,f){return this._styleExpression.evaluateWithoutErrorHandling(e,t,o,l,u,f)}evaluate(e,t,o,l,u,f){return this._styleExpression.evaluate(e,t,o,l,u,f)}}class ka{constructor(e,t,o,l){this.kind=e,this.zoomStops=o,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!Io(t.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,t,o,l,u,f){return this._styleExpression.evaluateWithoutErrorHandling(e,t,o,l,u,f)}evaluate(e,t,o,l,u,f){return this._styleExpression.evaluate(e,t,o,l,u,f)}interpolationFactor(e,t,o){return this.interpolationType?$r.interpolationFactor(this.interpolationType,e,t,o):0}}function yu(i,e){if((i=Ds(i,e)).result==="error")return i;const t=i.value.expression,o=Ko(t);if(!o&&!zs(e))return ks([new Kn("","data expressions not supported")]);const l=ba(t,["zoom","pitch","distance-from-center"]);if(!l&&!rd(e))return ks([new Kn("","zoom expressions not supported")]);const u=Bs(t);return u||l?u instanceof Kn?ks([u]):u instanceof $r&&!pu(e)?ks([new Kn("",'"interpolate" expressions cannot be used with this property')]):nd(u?new ka(o?"camera":"composite",i.value,u.labels,u instanceof $r?u.interpolation:void 0):new gu(o?"constant":"source",i.value)):ks([new Kn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ls{constructor(e,t){this._parameters=e,this._specification=t,wi(this,Ma(this._parameters,this._specification))}static deserialize(e){return new Ls(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Bs(i){let e=null;if(i instanceof Kh)e=Bs(i.result);else if(i instanceof Xh){for(const t of i.args)if(e=Bs(t),e)break}else(i instanceof Kc||i instanceof $r)&&i.input instanceof Fr&&i.input.name==="zoom"&&(e=i);return e instanceof Kn||i.eachChild(t=>{const o=Bs(t);o instanceof Kn?e=o:!e&&o?e=new Kn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new Kn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class Pt{constructor(e,t,o,l){this.message=(e?`${e}: `:"")+o,l&&(this.identifier=l),t!=null&&t.__line__&&(this.line=t.__line__)}}function yr(i){const e=i.key,t=i.value,o=i.valueSpec||{},l=i.objectElementValidators||{},u=i.style,f=i.styleSpec;let m=[];const v=Ri(t);if(v!=="object")return[new Pt(e,t,`object expected, ${v} found`)];for(const x in t){const S=x.split(".")[0],M=o[S]||o["*"];let I;l[S]?I=l[S]:o[S]?I=Rn:l["*"]?I=l["*"]:o["*"]&&(I=Rn),I?m=m.concat(I({key:(e&&`${e}.`)+x,value:t[x],valueSpec:M,style:u,styleSpec:f,object:t,objectKey:x},t)):m.push(new Pt(e,t[x],`unknown property "${x}"`))}for(const x in o)l[x]||o[x].required&&o[x].default===void 0&&t[x]===void 0&&m.push(new Pt(e,t,`missing required property "${x}"`));return m}function vu(i){const e=i.value,t=i.valueSpec,o=i.style,l=i.styleSpec,u=i.key,f=i.arrayElementValidator||Rn;if(Ri(e)!=="array")return[new Pt(u,e,`array expected, ${Ri(e)} found`)];if(t.length&&e.length!==t.length)return[new Pt(u,e,`array length ${t.length} expected, length ${e.length} found`)];if(t["min-length"]&&e.length<t["min-length"])return[new Pt(u,e,`array length at least ${t["min-length"]} expected, length ${e.length} found`)];let m={type:t.value,values:t.values,minimum:t.minimum,maximum:t.maximum,function:void 0};l.$version<7&&(m.function=t.function),Ri(t.value)==="object"&&(m=t.value);let v=[];for(let x=0;x<e.length;x++)v=v.concat(f({array:e,arrayIndex:x,value:e[x],valueSpec:m,style:o,styleSpec:l,key:`${u}[${x}]`}));return v}function xu(i){const e=i.key,t=i.value,o=i.valueSpec;let l=Ri(t);if(l==="number"&&t!=t&&(l="NaN"),l!=="number")return[new Pt(e,t,`number expected, ${l} found`)];if("minimum"in o){let u=o.minimum;if(Ri(o.minimum)==="array"&&(u=o.minimum[i.arrayIndex]),t<u)return[new Pt(e,t,`${t} is less than the minimum value ${u}`)]}if("maximum"in o){let u=o.maximum;if(Ri(o.maximum)==="array"&&(u=o.maximum[i.arrayIndex]),t>u)return[new Pt(e,t,`${t} is greater than the maximum value ${u}`)]}return[]}function za(i){const e=i.valueSpec,t=ni(i.value.type);let o,l,u,f={};const m=t!=="categorical"&&i.value.property===void 0,v=!m,x=Ri(i.value.stops)==="array"&&Ri(i.value.stops[0])==="array"&&Ri(i.value.stops[0][0])==="object",S=yr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(P){if(t==="identity")return[new Pt(P.key,P.value,'identity function may not have a "stops" property')];let L=[];const U=P.value;return L=L.concat(vu({key:P.key,value:U,valueSpec:P.valueSpec,style:P.style,styleSpec:P.styleSpec,arrayElementValidator:M})),Ri(U)==="array"&&U.length===0&&L.push(new Pt(P.key,U,"array must have at least one stop")),L},default:function(P){return Rn({key:P.key,value:P.value,valueSpec:e,style:P.style,styleSpec:P.styleSpec})}}});return t==="identity"&&m&&S.push(new Pt(i.key,i.value,'missing required property "property"')),t==="identity"||i.value.stops||S.push(new Pt(i.key,i.value,'missing required property "stops"')),t==="exponential"&&i.valueSpec.expression&&!pu(i.valueSpec)&&S.push(new Pt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(v&&!zs(i.valueSpec)?S.push(new Pt(i.key,i.value,"property functions not supported")):m&&!rd(i.valueSpec)&&S.push(new Pt(i.key,i.value,"zoom functions not supported"))),t!=="categorical"&&!x||i.value.property!==void 0||S.push(new Pt(i.key,i.value,'"property" property is required')),S;function M(P){let L=[];const U=P.value,$=P.key;if(Ri(U)!=="array")return[new Pt($,U,`array expected, ${Ri(U)} found`)];if(U.length!==2)return[new Pt($,U,`array length 2 expected, length ${U.length} found`)];if(x){if(Ri(U[0])!=="object")return[new Pt($,U,`object expected, ${Ri(U[0])} found`)];if(U[0].zoom===void 0)return[new Pt($,U,"object stop key must have zoom")];if(U[0].value===void 0)return[new Pt($,U,"object stop key must have value")];const ee=ni(U[0].zoom);if(typeof ee!="number")return[new Pt($,U[0].zoom,"stop zoom values must be numbers")];if(u&&u>ee)return[new Pt($,U[0].zoom,"stop zoom values must appear in ascending order")];ee!==u&&(u=ee,l=void 0,f={}),L=L.concat(yr({key:`${$}[0]`,value:U[0],valueSpec:{zoom:{}},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{zoom:xu,value:I}}))}else L=L.concat(I({key:`${$}[0]`,value:U[0],valueSpec:{},style:P.style,styleSpec:P.styleSpec},U));return Ol(Gi(U[1]))?L.concat([new Pt(`${$}[1]`,U[1],"expressions are not allowed in function stops.")]):L.concat(Rn({key:`${$}[1]`,value:U[1],valueSpec:e,style:P.style,styleSpec:P.styleSpec}))}function I(P,L){const U=Ri(P.value),$=ni(P.value),ee=P.value!==null?P.value:L;if(o){if(U!==o)return[new Pt(P.key,ee,`${U} stop domain type must match previous stop domain type ${o}`)]}else o=U;if(U!=="number"&&U!=="string"&&U!=="boolean"&&typeof $!="number"&&typeof $!="string"&&typeof $!="boolean")return[new Pt(P.key,ee,"stop domain value must be a number, string, or boolean")];if(U!=="number"&&t!=="categorical"){let se=`number expected, ${U} found`;return zs(e)&&t===void 0&&(se+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Pt(P.key,ee,se)]}return t!=="categorical"||U!=="number"||typeof $=="number"&&isFinite($)&&Math.floor($)===$?t!=="categorical"&&U==="number"&&typeof $=="number"&&typeof l=="number"&&l!==void 0&&$<l?[new Pt(P.key,ee,"stop domain values must appear in ascending order")]:(l=$,t==="categorical"&&$ in f?[new Pt(P.key,ee,"stop domain values must be unique")]:(f[$]=!0,[])):[new Pt(P.key,ee,`integer expected, found ${String($)}`)]}}function Or(i){const e=(i.expressionContext==="property"?yu:Ds)(Gi(i.value),i.valueSpec);if(e.result==="error")return e.value.map(o=>new Pt(`${i.key}${o.key}`,i.value,o.message));const t=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!t.outputDefined())return[new Pt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Io(t))return[new Pt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter")return bu(t,i);if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!ba(t,["zoom","feature-state"]))return[new Pt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Ko(t))return[new Pt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function bu(i,e){const t=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const l of e.valueSpec.expression.parameters)t.delete(l);if(t.size===0)return[];const o=[];return i instanceof Fr&&t.has(i.name)?[new Pt(e.key,e.value,`["${i.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(i.eachChild(l=>{o.push(...bu(l,e))}),o)}function Pa(i){const e=i.key,t=i.value,o=i.valueSpec,l=[];return Array.isArray(o.values)?o.values.indexOf(ni(t))===-1&&l.push(new Pt(e,t,`expected one of [${o.values.join(", ")}], ${JSON.stringify(t)} found`)):Object.keys(o.values).indexOf(ni(t))===-1&&l.push(new Pt(e,t,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(t)} found`)),l}function Da(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!Da(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function La(i,e="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Da(i)||(i=Vl(i));const t=i;let o=!0;try{o=function(x){if(!ro(x))return x;let S=Gi(x);return wu(S),S=sd(S),S}(t)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(t,null,2)}
        `)}const l=Ce[`filter_${e}`],u=Ds(o,l);let f=null;if(u.result==="error")throw new Error(u.value.map(x=>`${x.key}: ${x.message}`).join(", "));f=(x,S,M)=>u.value.evaluate(x,S,{},M);let m=null,v=null;if(o!==t){const x=Ds(t,l);if(x.result==="error")throw new Error(x.value.map(S=>`${S.key}: ${S.message}`).join(", "));m=(S,M,I,P,L)=>x.value.evaluate(S,M,{},I,void 0,void 0,P,L),v=!Ko(x.value.expression)}return f=f,{filter:f,dynamicFilter:m||void 0,needGeometry:ad(o),needFeature:!!v}}function sd(i){if(!Array.isArray(i))return i;const e=function(t){if(Fp.has(t[0])){for(let o=1;o<t.length;o++)if(ro(t[o]))return!0}return t}(i);return e===!0?e:e.map(t=>sd(t))}function wu(i){let e=!1;const t=[];if(i[0]==="case"){for(let o=1;o<i.length-1;o+=2)e=e||ro(i[o]),t.push(i[o+1]);t.push(i[i.length-1])}else if(i[0]==="match"){e=e||ro(i[1]);for(let o=2;o<i.length-1;o+=2)t.push(i[o+1]);t.push(i[i.length-1])}else if(i[0]==="step"){e=e||ro(i[1]);for(let o=1;o<i.length-1;o+=2)t.push(i[o+1])}e&&(i.length=0,i.push("any",...t));for(let o=1;o<i.length;o++)wu(i[o])}function ro(i){if(!Array.isArray(i))return!1;if((e=i[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let t=1;t<i.length;t++)if(ro(i[t]))return!0;return!1}const Fp=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Op(i,e){return i<e?-1:i>e?1:0}function ad(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(ad(i[e]))return!0;return!1}function Vl(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?Tu(i[1],i[2],"=="):e==="!="?$n(Tu(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Tu(i[1],i[2],e):e==="any"?(t=i.slice(1),["any"].concat(t.map(Vl))):e==="all"?["all"].concat(i.slice(1).map(Vl)):e==="none"?["all"].concat(i.slice(1).map(Vl).map($n)):e==="in"?Ba(i[1],i.slice(2)):e==="!in"?$n(Ba(i[1],i.slice(2))):e==="has"?Ra(i[1]):e==="!has"?$n(Ra(i[1])):e!=="within"||i;var t}function Tu(i,e,t){switch(i){case"$type":return[`filter-type-${t}`,e];case"$id":return[`filter-id-${t}`,e];default:return[`filter-${t}`,i,e]}}function Ba(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(t=>typeof t!=typeof e[0])?["filter-in-large",i,["literal",e.sort(Op)]]:["filter-in-small",i,["literal",e]]}}function Ra(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function $n(i){return["!",i]}function Rs(i){return Da(Gi(i.value))?Or(wi({},i,{expressionContext:"filter",valueSpec:i.styleSpec[`filter_${i.layerType||"fill"}`]})):ld(i)}function ld(i){const e=i.value,t=i.key;if(Ri(e)!=="array")return[new Pt(t,e,`array expected, ${Ri(e)} found`)];const o=i.styleSpec;let l,u=[];if(e.length<1)return[new Pt(t,e,"filter array must have at least 1 element")];switch(u=u.concat(Pa({key:`${t}[0]`,value:e[0],valueSpec:o.filter_operator,style:i.style,styleSpec:i.styleSpec})),ni(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&ni(e[1])==="$type"&&u.push(new Pt(t,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&u.push(new Pt(t,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(l=Ri(e[1]),l!=="string"&&u.push(new Pt(`${t}[1]`,e[1],`string expected, ${l} found`)));for(let f=2;f<e.length;f++)l=Ri(e[f]),ni(e[1])==="$type"?u=u.concat(Pa({key:`${t}[${f}]`,value:e[f],valueSpec:o.geometry_type,style:i.style,styleSpec:i.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&u.push(new Pt(`${t}[${f}]`,e[f],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let f=1;f<e.length;f++)u=u.concat(ld({key:`${t}[${f}]`,value:e[f],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":l=Ri(e[1]),e.length!==2?u.push(new Pt(t,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="string"&&u.push(new Pt(`${t}[1]`,e[1],`string expected, ${l} found`));break;case"within":l=Ri(e[1]),e.length!==2?u.push(new Pt(t,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="object"&&u.push(new Pt(`${t}[1]`,e[1],`object expected, ${l} found`))}return u}function cd(i,e){const t=i.key,o=i.style,l=i.styleSpec,u=i.value,f=i.objectKey,m=l[`${e}_${i.layerType}`];if(!m)return[];const v=f.match(/^(.*)-transition$/);if(e==="paint"&&v&&m[v[1]]&&m[v[1]].transition)return Rn({key:t,value:u,valueSpec:l.transition,style:o,styleSpec:l});const x=i.valueSpec||m[f];if(!x)return[new Pt(t,u,`unknown property "${f}"`)];let S;if(Ri(u)==="string"&&zs(x)&&!x.tokens&&(S=/^{([^}]+)}$/.exec(u)))return[new Pt(t,u,`"${f}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(S[1])} }\`.`)];const M=[];return i.layerType==="symbol"&&(f==="text-field"&&o&&!o.glyphs&&M.push(new Pt(t,u,'use of "text-field" requires a style "glyphs" property')),f==="text-font"&&Aa(Gi(u))&&ni(u.type)==="identity"&&M.push(new Pt(t,u,'"text-font" does not support identity functions'))),M.concat(Rn({key:i.key,value:u,valueSpec:x,style:o,styleSpec:l,expressionContext:"property",propertyType:e,propertyKey:f}))}function ud(i){return cd(i,"paint")}function hd(i){return cd(i,"layout")}function Ul(i){let e=[];const t=i.value,o=i.key,l=i.style,u=i.styleSpec;t.type||t.ref||e.push(new Pt(o,t,'either "type" or "ref" is required'));let f=ni(t.type);const m=ni(t.ref);if(t.id){const v=ni(t.id);for(let x=0;x<i.arrayIndex;x++){const S=l.layers[x];ni(S.id)===v&&e.push(new Pt(o,t.id,`duplicate layer id "${t.id}", previously used at line ${S.id.__line__}`))}}if("ref"in t){let v;["type","source","source-layer","filter","layout"].forEach(x=>{x in t&&e.push(new Pt(o,t[x],`"${x}" is prohibited for ref layers`))}),l.layers.forEach(x=>{ni(x.id)===m&&(v=x)}),v?v.ref?e.push(new Pt(o,t.ref,"ref cannot reference another ref layer")):f=ni(v.type):typeof m=="string"&&e.push(new Pt(o,t.ref,`ref layer "${m}" not found`))}else if(f!=="background"&&f!=="sky")if(t.source){const v=l.sources&&l.sources[t.source],x=v&&ni(v.type);v?x==="vector"&&f==="raster"?e.push(new Pt(o,t.source,`layer "${t.id}" requires a raster source`)):x==="raster"&&f!=="raster"?e.push(new Pt(o,t.source,`layer "${t.id}" requires a vector source`)):x!=="vector"||t["source-layer"]?x==="raster-dem"&&f!=="hillshade"?e.push(new Pt(o,t.source,"raster-dem source can only be used with layer type 'hillshade'.")):f!=="line"||!t.paint||!t.paint["line-gradient"]&&!t.paint["line-trim-offset"]||x==="geojson"&&v.lineMetrics||e.push(new Pt(o,t,`layer "${t.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Pt(o,t,`layer "${t.id}" must specify a "source-layer"`)):e.push(new Pt(o,t.source,`source "${t.source}" not found`))}else e.push(new Pt(o,t,'missing required property "source"'));return e=e.concat(yr({key:o,value:t,valueSpec:u.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Rn({key:`${o}.type`,value:t.type,valueSpec:u.layer.type,style:i.style,styleSpec:i.styleSpec,object:t,objectKey:"type"}),filter:v=>Rs(wi({layerType:f},v)),layout:v=>yr({layer:t,key:v.key,value:v.value,valueSpec:{},style:v.style,styleSpec:v.styleSpec,objectElementValidators:{"*":x=>hd(wi({layerType:f},x))}}),paint:v=>yr({layer:t,key:v.key,value:v.value,valueSpec:{},style:v.style,styleSpec:v.styleSpec,objectElementValidators:{"*":x=>ud(wi({layerType:f},x))}})}})),e}function Fs(i){const e=i.value,t=i.key,o=Ri(e);return o!=="string"?[new Pt(t,e,`string expected, ${o} found`)]:[]}const Nl={promoteId:function({key:i,value:e}){if(Ri(e)==="string")return Fs({key:i,value:e});{const t=[];for(const o in e)t.push(...Fs({key:`${i}.${o}`,value:e[o]}));return t}}};function dd(i){const e=i.value,t=i.key,o=i.styleSpec,l=i.style;if(!e.type)return[new Pt(t,e,'"type" is required')];const u=ni(e.type);let f;switch(u){case"vector":case"raster":case"raster-dem":return f=yr({key:t,value:e,valueSpec:o[`source_${u.replace("-","_")}`],style:i.style,styleSpec:o,objectElementValidators:Nl}),f;case"geojson":if(f=yr({key:t,value:e,valueSpec:o.source_geojson,style:l,styleSpec:o,objectElementValidators:Nl}),e.cluster)for(const m in e.clusterProperties){const[v,x]=e.clusterProperties[m],S=typeof v=="string"?[v,["accumulated"],["get",m]]:v;f.push(...Or({key:`${t}.${m}.map`,value:x,expressionContext:"cluster-map"})),f.push(...Or({key:`${t}.${m}.reduce`,value:S,expressionContext:"cluster-reduce"}))}return f;case"video":return yr({key:t,value:e,valueSpec:o.source_video,style:l,styleSpec:o});case"image":return yr({key:t,value:e,valueSpec:o.source_image,style:l,styleSpec:o});case"canvas":return[new Pt(t,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Pa({key:`${t}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:l,styleSpec:o})}}function fd(i){const e=i.value,t=i.styleSpec,o=t.light,l=i.style;let u=[];const f=Ri(e);if(e===void 0)return u;if(f!=="object")return u=u.concat([new Pt("light",e,`object expected, ${f} found`)]),u;for(const m in e){const v=m.match(/^(.*)-transition$/);u=u.concat(v&&o[v[1]]&&o[v[1]].transition?Rn({key:m,value:e[m],valueSpec:t.transition,style:l,styleSpec:t}):o[m]?Rn({key:m,value:e[m],valueSpec:o[m],style:l,styleSpec:t}):[new Pt(m,e[m],`unknown property "${m}"`)])}return u}function jl(i){const e=i.value,t=i.key,o=i.style,l=i.styleSpec,u=l.terrain;let f=[];const m=Ri(e);if(e===void 0)return f;if(m!=="object")return f=f.concat([new Pt("terrain",e,`object expected, ${m} found`)]),f;for(const v in e){const x=v.match(/^(.*)-transition$/);f=f.concat(x&&u[x[1]]&&u[x[1]].transition?Rn({key:v,value:e[v],valueSpec:l.transition,style:o,styleSpec:l}):u[v]?Rn({key:v,value:e[v],valueSpec:u[v],style:o,styleSpec:l}):[new Pt(v,e[v],`unknown property "${v}"`)])}if(e.source){const v=o.sources&&o.sources[e.source],x=v&&ni(v.type);v?x!=="raster-dem"&&f.push(new Pt(t,e.source,`terrain cannot be used with a source of type ${String(x)}, it only be used with a "raster-dem" source type`)):f.push(new Pt(t,e.source,`source "${e.source}" not found`))}else f.push(new Pt(t,e,'terrain is missing required property "source"'));return f}function pd(i){const e=i.value,t=i.style,o=i.styleSpec,l=o.fog;let u=[];const f=Ri(e);if(e===void 0)return u;if(f!=="object")return u=u.concat([new Pt("fog",e,`object expected, ${f} found`)]),u;for(const m in e){const v=m.match(/^(.*)-transition$/);u=u.concat(v&&l[v[1]]&&l[v[1]].transition?Rn({key:m,value:e[m],valueSpec:o.transition,style:t,styleSpec:o}):l[m]?Rn({key:m,value:e[m],valueSpec:l[m],style:t,styleSpec:o}):[new Pt(m,e[m],`unknown property "${m}"`)])}return u}const Eu={"*":()=>[],array:vu,boolean:function(i){const e=i.value,t=i.key,o=Ri(e);return o!=="boolean"?[new Pt(t,e,`boolean expected, ${o} found`)]:[]},number:xu,color:function(i){const e=i.key,t=i.value,o=Ri(t);return o!=="string"?[new Pt(e,t,`color expected, ${o} found`)]:Co.parseCSSColor(t)===null?[new Pt(e,t,`color expected, "${t}" found`)]:[]},enum:Pa,filter:Rs,function:za,layer:Ul,object:yr,source:dd,light:fd,terrain:jl,fog:pd,string:Fs,formatted:function(i){return Fs(i).length===0?[]:Or(i)},resolvedImage:function(i){return Fs(i).length===0?[]:Or(i)},projection:function(i){const e=i.value,t=i.styleSpec,o=t.projection,l=i.style;let u=[];const f=Ri(e);if(f==="object")for(const m in e)u=u.concat(Rn({key:m,value:e[m],valueSpec:o[m],style:l,styleSpec:t}));else f!=="string"&&(u=u.concat([new Pt("projection",e,`object or string expected, ${f} found`)]));return u}};function Rn(i){const e=i.value,t=i.valueSpec,o=i.styleSpec;return t.expression&&Aa(ni(e))?za(i):t.expression&&Ol(Gi(e))?Or(i):t.type&&Eu[t.type]?Eu[t.type](i):yr(wi({},i,{valueSpec:t.type?o[t.type]:t}))}function Vp(i){const e=i.value,t=i.key,o=Fs(i);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new Pt(t,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new Pt(t,e,'"glyphs" url must include a "{range}" token'))),o}function ql(i,e=Ce){return oo(Rn({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:Vp,"*":()=>[]}}))}const $l=i=>oo(ud(i)),md=i=>oo(hd(i));function oo(i){return i.slice().sort((e,t)=>e.line&&t.line?e.line-t.line:0)}function Su(i,e){let t=!1;if(e&&e.length)for(const o of e)i.fire(new vt(new Error(o.message))),t=!0;return t}var Os=Ar;function Ar(i,e,t){var o=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var l=new Int32Array(this.arrayBuffer);i=l[0],this.d=(e=l[1])+2*(t=l[2]);for(var u=0;u<this.d*this.d;u++){var f=l[3+u],m=l[3+u+1];o.push(f===m?null:l.subarray(f,m))}var v=l[3+o.length+1];this.keys=l.subarray(l[3+o.length],v),this.bboxes=l.subarray(v),this.insert=this._insertReadonly}else{this.d=e+2*t;for(var x=0;x<this.d*this.d;x++)o.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=i,this.padding=t,this.scale=e/i,this.uid=0;var S=t/e*i;this.min=-S,this.max=i+S}Ar.prototype.insert=function(i,e,t,o,l){this._forEachCell(e,t,o,l,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(e),this.bboxes.push(t),this.bboxes.push(o),this.bboxes.push(l)},Ar.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ar.prototype._insertCell=function(i,e,t,o,l,u){this.cells[l].push(u)},Ar.prototype.query=function(i,e,t,o,l){var u=this.min,f=this.max;if(i<=u&&e<=u&&f<=t&&f<=o&&!l)return Array.prototype.slice.call(this.keys);var m=[];return this._forEachCell(i,e,t,o,this._queryCell,m,{},l),m},Ar.prototype._queryCell=function(i,e,t,o,l,u,f,m){var v=this.cells[l];if(v!==null)for(var x=this.keys,S=this.bboxes,M=0;M<v.length;M++){var I=v[M];if(f[I]===void 0){var P=4*I;(m?m(S[P+0],S[P+1],S[P+2],S[P+3]):i<=S[P+2]&&e<=S[P+3]&&t>=S[P+0]&&o>=S[P+1])?(f[I]=!0,u.push(x[I])):f[I]=!1}}},Ar.prototype._forEachCell=function(i,e,t,o,l,u,f,m){for(var v=this._convertToCellCoord(i),x=this._convertToCellCoord(e),S=this._convertToCellCoord(t),M=this._convertToCellCoord(o),I=v;I<=S;I++)for(var P=x;P<=M;P++){var L=this.d*P+I;if((!m||m(this._convertFromCellCoord(I),this._convertFromCellCoord(P),this._convertFromCellCoord(I+1),this._convertFromCellCoord(P+1)))&&l.call(this,i,e,t,o,L,u,f,m))return}},Ar.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},Ar.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},Ar.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,e=3+this.cells.length+1+1,t=0,o=0;o<this.cells.length;o++)t+=this.cells[o].length;var l=new Int32Array(e+t+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;for(var u=e,f=0;f<i.length;f++){var m=i[f];l[3+f]=u,l.set(m,u),u+=m.length}return l[3+i.length]=u,l.set(this.keys,u),l[3+i.length+1]=u+=this.keys.length,l.set(this.bboxes,u),u+=this.bboxes.length,l.buffer};const Gl={};function Bt(i,e,t={}){Object.defineProperty(i,"_classRegistryKey",{value:e,writeable:!1}),Gl[e]={klass:i,omit:t.omit||[]}}Bt(Object,"Object"),Os.serialize=function(i,e){const t=i.toArrayBuffer();return e&&e.push(t),{buffer:t}},Os.deserialize=function(i){return new Os(i.buffer)},Object.defineProperty(Os,"name",{value:"Grid"}),Bt(Os,"Grid"),Bt(Ni,"Color"),Bt(Error,"Error"),Bt(Me,"AJAXError"),Bt(lr,"ResolvedImage"),Bt(Ls,"StylePropertyFunction"),Bt(_u,"StyleExpression",{omit:["_evaluator"]}),Bt(ka,"ZoomDependentExpression"),Bt(gu,"ZoomConstantExpression"),Bt(Fr,"CompoundExpression",{omit:["_evaluate"]});for(const i in Ca)Gl[Ca[i]._classRegistryKey]||Bt(Ca[i],`Expression${i}`);function _d(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function gd(i){return D.ImageBitmap&&i instanceof D.ImageBitmap}function Vs(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(_d(i)||gd(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const t=i;return e&&e.push(t.buffer),t}if(i instanceof D.ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const t=[];for(const o of i)t.push(Vs(o,e));return t}if(typeof i=="object"){const t=i.constructor,o=t._classRegistryKey;if(!o)throw new Error(`can't serialize object of unregistered class ${o}`);const l=t.serialize?t.serialize(i,e):{};if(!t.serialize){for(const u in i)i.hasOwnProperty(u)&&(Gl[o].omit.indexOf(u)>=0||(l[u]=Vs(i[u],e)));i instanceof Error&&(l.message=i.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(l.$name=o),l}throw new Error("can't serialize object of type "+typeof i)}function Fa(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||_d(i)||gd(i)||ArrayBuffer.isView(i)||i instanceof D.ImageData)return i;if(Array.isArray(i))return i.map(Fa);if(typeof i=="object"){const e=i.$name||"Object",{klass:t}=Gl[e];if(!t)throw new Error(`can't deserialize unregistered class ${e}`);if(t.deserialize)return t.deserialize(i);const o=Object.create(t.prototype);for(const l of Object.keys(i))l!=="$name"&&(o[l]=Fa(i[l]));return o}throw new Error("can't deserialize object of type "+typeof i)}class yd{constructor(){this.first=!0}update(e,t){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}const vd=i=>i>=1536&&i<=1791,xd=i=>i>=1872&&i<=1919,bd=i=>i>=2208&&i<=2303,wd=i=>i>=11904&&i<=12031,Td=i=>i>=12032&&i<=12255,Oa=i=>i>=12272&&i<=12287,Zl=i=>i>=12288&&i<=12351,Cu=i=>i>=12352&&i<=12447,Jo=i=>i>=12448&&i<=12543,Ed=i=>i>=12544&&i<=12591,Au=i=>i>=12704&&i<=12735,Sd=i=>i>=12736&&i<=12783,Mu=i=>i>=12784&&i<=12799,Iu=i=>i>=12800&&i<=13055,ku=i=>i>=13056&&i<=13311,zu=i=>i>=13312&&i<=19903,Va=i=>i>=19968&&i<=40959,Wl=i=>i>=40960&&i<=42127,Cd=i=>i>=42128&&i<=42191,Ad=i=>i>=44032&&i<=55215,Md=i=>i>=63744&&i<=64255,Ua=i=>i>=64336&&i<=65023,Id=i=>i>=65040&&i<=65055,Pu=i=>i>=65072&&i<=65103,kd=i=>i>=65104&&i<=65135,Du=i=>i>=65136&&i<=65279,Lu=i=>i>=65280&&i<=65519;function Hl(i){for(const e of i)if(Xl(e.charCodeAt(0)))return!0;return!1}function Up(i){for(const e of i)if(!Np(e.charCodeAt(0)))return!1;return!0}function Np(i){return!(vd(i)||xd(i)||bd(i)||Ua(i)||Du(i))}function Xl(i){return!(i!==746&&i!==747&&(i<4352||!(Au(i)||Ed(i)||Pu(i)&&!(i>=65097&&i<=65103)||Md(i)||ku(i)||wd(i)||Sd(i)||!(!Zl(i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||zu(i)||Va(i)||Iu(i)||(e=>e>=12592&&e<=12687)(i)||(e=>e>=43360&&e<=43391)(i)||(e=>e>=55216&&e<=55295)(i)||(e=>e>=4352&&e<=4607)(i)||Ad(i)||Cu(i)||Oa(i)||(e=>e>=12688&&e<=12703)(i)||Td(i)||Mu(i)||Jo(i)&&i!==12540||!(!Lu(i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!kd(i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||(e=>e>=5120&&e<=5759)(i)||(e=>e>=6320&&e<=6399)(i)||Id(i)||(e=>e>=19904&&e<=19967)(i)||Wl(i)||Cd(i))))}function Na(i){return!(Xl(i)||function(e){return!!((t=>t>=128&&t<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(t=>t>=8192&&t<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(t=>t>=8448&&t<=8527)(e)||(t=>t>=8528&&t<=8591)(e)||(t=>t>=8960&&t<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(t=>t>=9216&&t<=9279)(e)&&e!==9251||(t=>t>=9280&&t<=9311)(e)||(t=>t>=9312&&t<=9471)(e)||(t=>t>=9632&&t<=9727)(e)||(t=>t>=9728&&t<=9983)(e)&&!(e>=9754&&e<=9759)||(t=>t>=11008&&t<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Zl(e)||Jo(e)||(t=>t>=57344&&t<=63743)(e)||Pu(e)||kd(e)||Lu(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function c(i){return i>=1424&&i<=2303||Ua(i)||Du(i)}function n(i,e){return!(!e&&c(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||(t=>t>=6016&&t<=6143)(i))}function a(i){for(const e of i)if(c(e.charCodeAt(0)))return!0;return!1}const d="deferred",_="loading",g="loaded";let w=null,T="unavailable",C=null;const k=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(T="error"),w&&w(i)};function z(){R.fire(new ce("pluginStateChange",{pluginStatus:T,pluginURL:C}))}const R=new Ze,j=function(){return T},K=function(){if(T!==d||!C)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");T=_,z(),C&&ke({url:C},i=>{i?k(i):(T=g,z())})},Z={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>T===g||Z.applyArabicShaping!=null,isLoading:()=>T===_,setState(i){T=i.pluginStatus,C=i.pluginURL},isParsed:()=>Z.applyArabicShaping!=null&&Z.processBidirectionalText!=null&&Z.processStyledBidirectionalText!=null,getPluginURL:()=>C};class W{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition,this.pitch=t.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new yd,this.transition={},this.pitch=0)}isSupportedScript(e){return function(t,o){for(const l of t)if(!n(l.charCodeAt(0),o))return!1;return!0}(e,Z.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,t=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*t}}}class X{constructor(e,t){this.property=e,this.value=t,this.expression=function(o,l){if(Aa(o))return new Ls(o,l);if(Ol(o)){const u=yu(o,l);if(u.result==="error")throw new Error(u.value.map(f=>`${f.key}: ${f.message}`).join(", "));return u.value}{let u=o;return typeof o=="string"&&l.type==="color"&&(u=Ni.parse(o)),{kind:"constant",evaluate:()=>u}}}(t===void 0?e.specification.default:t,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,t,o){return this.property.possiblyEvaluate(this,e,t,o)}}class G{constructor(e){this.property=e,this.value=new X(e,void 0)}transitioned(e,t){return new Y(this.property,this.value,t,Ue({},e.transition,this.transition),e.now)}untransitioned(){return new Y(this.property,this.value,null,{},0)}}class te{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Oe(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new G(this._values[e].property)),this._values[e].value=new X(this._values[e].property,t===null?void 0:Oe(t))}getTransition(e){return Oe(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new G(this._values[e].property)),this._values[e].transition=Oe(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const o=this.getValue(t);o!==void 0&&(e[t]=o);const l=this.getTransition(t);l!==void 0&&(e[`${t}-transition`]=l)}return e}transitioned(e,t){const o=new pe(this._properties);for(const l of Object.keys(this._values))o._values[l]=this._values[l].transitioned(e,t._values[l]);return o}untransitioned(){const e=new pe(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class Y{constructor(e,t,o,l,u){const f=l.delay||0,m=l.duration||0;u=u||0,this.property=e,this.value=t,this.begin=u+f,this.end=this.begin+m,e.specification.transition&&(l.delay||l.duration)&&(this.prior=o)}possiblyEvaluate(e,t,o){const l=e.now||0,u=this.value.possiblyEvaluate(e,t,o),f=this.prior;if(f){if(l>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(l<this.begin)return f.possiblyEvaluate(e,t,o);{const m=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,t,o),u,we(m))}}return u}}class pe{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,o){const l=new fe(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(e,t,o);return l}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class he{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Oe(this._values[e].value)}setValue(e,t){this._values[e]=new X(this._values[e].property,t===null?void 0:Oe(t))}serialize(){const e={};for(const t of Object.keys(this._values)){const o=this.getValue(t);o!==void 0&&(e[t]=o)}return e}possiblyEvaluate(e,t,o){const l=new fe(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(e,t,o);return l}}class oe{constructor(e,t,o){this.property=e,this.value=t,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,t,o,l){return this.property.evaluate(this.value,this.parameters,e,t,o,l)}}class fe{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class le{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,o){const l=wa[this.specification.type];return l?l(e,t,o):e}}class ve{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,o,l){return new oe(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(t,null,{},o,l)}:e.expression,t)}interpolate(e,t,o){if(e.value.kind!=="constant"||t.value.kind!=="constant")return e;if(e.value.value===void 0||t.value.value===void 0)return new oe(this,{kind:"constant",value:void 0},e.parameters);const l=wa[this.specification.type];return l?new oe(this,{kind:"constant",value:l(e.value.value,t.value.value,o)},e.parameters):e}evaluate(e,t,o,l,u,f){return e.kind==="constant"?e.value:e.evaluate(t,o,l,u,f)}}class Be extends ve{possiblyEvaluate(e,t,o,l){if(e.value===void 0)return new oe(this,{kind:"constant",value:void 0},t);if(e.expression.kind==="constant"){const u=e.expression.evaluate(t,null,{},o,l),f=e.property.specification.type==="resolvedImage"&&typeof u!="string"?u.name:u,m=this._calculate(f,f,f,t);return new oe(this,{kind:"constant",value:m},t)}if(e.expression.kind==="camera"){const u=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t);return new oe(this,{kind:"constant",value:u},t)}return new oe(this,e.expression,t)}evaluate(e,t,o,l,u,f){if(e.kind==="source"){const m=e.evaluate(t,o,l,u,f);return this._calculate(m,m,m,t)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},o,l),e.evaluate({zoom:Math.floor(t.zoom)},o,l),e.evaluate({zoom:Math.floor(t.zoom)+1},o,l),t):e.value}_calculate(e,t,o,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:t,other:o}:{from:o,to:t,other:e}}interpolate(e){return e}}class dt{constructor(e){this.specification=e}possiblyEvaluate(e,t,o,l){if(e.value!==void 0){if(e.expression.kind==="constant"){const u=e.expression.evaluate(t,null,{},o,l);return this._calculate(u,u,u,t)}return this._calculate(e.expression.evaluate(new W(Math.floor(t.zoom-1),t)),e.expression.evaluate(new W(Math.floor(t.zoom),t)),e.expression.evaluate(new W(Math.floor(t.zoom+1),t)),t)}}_calculate(e,t,o,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:o,to:t}}interpolate(e){return e}}class Ae{constructor(e){this.specification=e}possiblyEvaluate(e,t,o,l){return!!e.expression.evaluate(t,null,{},o,l)}interpolate(){return!1}}class Je{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new W(0,{});for(const o in e){const l=e[o];l.specification.overridable&&this.overridableProperties.push(o);const u=this.defaultPropertyValues[o]=new X(l,void 0),f=this.defaultTransitionablePropertyValues[o]=new G(l);this.defaultTransitioningPropertyValues[o]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=u.possiblyEvaluate(t)}}}function rt(i,e){return 256*(i=Te(Math.floor(i),0,255))+Te(Math.floor(e),0,255)}Bt(ve,"DataDrivenProperty"),Bt(le,"DataConstantProperty"),Bt(Be,"CrossFadedDataDrivenProperty"),Bt(dt,"CrossFadedProperty"),Bt(Ae,"ColorRampProperty");const wt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class qe{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class mt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function it(i,e=1){let t=0,o=0;return{members:i.map(l=>{const u=wt[l.type].BYTES_PER_ELEMENT,f=t=It(t,Math.max(e,u)),m=l.components||1;return o=Math.max(o,u),t+=u*m,{name:l.name,type:l.type,components:m,offset:f}}),size:It(t,Math.max(o,e)),alignment:e}}function It(i,e){return Math.ceil(i/e)*e}class St extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const o=this.length;return this.resize(o+1),this.emplace(o,e,t)}emplace(e,t,o){const l=2*e;return this.int16[l+0]=t,this.int16[l+1]=o,e}}St.prototype.bytesPerElement=4,Bt(St,"StructArrayLayout2i4");class Vt extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,t,o)}emplace(e,t,o,l){const u=3*e;return this.int16[u+0]=t,this.int16[u+1]=o,this.int16[u+2]=l,e}}Vt.prototype.bytesPerElement=6,Bt(Vt,"StructArrayLayout3i6");class Wt extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,o,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,o,l)}emplace(e,t,o,l,u){const f=4*e;return this.int16[f+0]=t,this.int16[f+1]=o,this.int16[f+2]=l,this.int16[f+3]=u,e}}Wt.prototype.bytesPerElement=8,Bt(Wt,"StructArrayLayout4i8");class ii extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,o,l,u,f,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,t,o,l,u,f,m)}emplace(e,t,o,l,u,f,m,v){const x=6*e,S=12*e,M=3*e;return this.int16[x+0]=t,this.int16[x+1]=o,this.uint8[S+4]=l,this.uint8[S+5]=u,this.uint8[S+6]=f,this.uint8[S+7]=m,this.float32[M+2]=v,e}}ii.prototype.bytesPerElement=12,Bt(ii,"StructArrayLayout2i4ub1f12");class xi extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,o,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,o,l)}emplace(e,t,o,l,u){const f=4*e;return this.float32[f+0]=t,this.float32[f+1]=o,this.float32[f+2]=l,this.float32[f+3]=u,e}}xi.prototype.bytesPerElement=16,Bt(xi,"StructArrayLayout4f16");class Ut extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,o,l,u,f,m,v,x,S){const M=this.length;return this.resize(M+1),this.emplace(M,e,t,o,l,u,f,m,v,x,S)}emplace(e,t,o,l,u,f,m,v,x,S,M){const I=10*e;return this.uint16[I+0]=t,this.uint16[I+1]=o,this.uint16[I+2]=l,this.uint16[I+3]=u,this.uint16[I+4]=f,this.uint16[I+5]=m,this.uint16[I+6]=v,this.uint16[I+7]=x,this.uint16[I+8]=S,this.uint16[I+9]=M,e}}Ut.prototype.bytesPerElement=20,Bt(Ut,"StructArrayLayout10ui20");class ai extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,o,l,u,f,m,v){const x=this.length;return this.resize(x+1),this.emplace(x,e,t,o,l,u,f,m,v)}emplace(e,t,o,l,u,f,m,v,x){const S=8*e;return this.uint16[S+0]=t,this.uint16[S+1]=o,this.uint16[S+2]=l,this.uint16[S+3]=u,this.uint16[S+4]=f,this.uint16[S+5]=m,this.uint16[S+6]=v,this.uint16[S+7]=x,e}}ai.prototype.bytesPerElement=16,Bt(ai,"StructArrayLayout8ui16");class Ii extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,o,l,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,t,o,l,u,f)}emplace(e,t,o,l,u,f,m){const v=6*e;return this.int16[v+0]=t,this.int16[v+1]=o,this.int16[v+2]=l,this.int16[v+3]=u,this.int16[v+4]=f,this.int16[v+5]=m,e}}Ii.prototype.bytesPerElement=12,Bt(Ii,"StructArrayLayout6i12");class Qi extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,o,l,u,f,m,v,x,S,M,I){const P=this.length;return this.resize(P+1),this.emplace(P,e,t,o,l,u,f,m,v,x,S,M,I)}emplace(e,t,o,l,u,f,m,v,x,S,M,I,P){const L=12*e;return this.int16[L+0]=t,this.int16[L+1]=o,this.int16[L+2]=l,this.int16[L+3]=u,this.uint16[L+4]=f,this.uint16[L+5]=m,this.uint16[L+6]=v,this.uint16[L+7]=x,this.int16[L+8]=S,this.int16[L+9]=M,this.int16[L+10]=I,this.int16[L+11]=P,e}}Qi.prototype.bytesPerElement=24,Bt(Qi,"StructArrayLayout4i4ui4i24");class dn extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,o,l,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,t,o,l,u,f)}emplace(e,t,o,l,u,f,m){const v=10*e,x=5*e;return this.int16[v+0]=t,this.int16[v+1]=o,this.int16[v+2]=l,this.float32[x+2]=u,this.float32[x+3]=f,this.float32[x+4]=m,e}}dn.prototype.bytesPerElement=20,Bt(dn,"StructArrayLayout3i3f20");class ji extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}ji.prototype.bytesPerElement=4,Bt(ji,"StructArrayLayout1ul4");class Fn extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,o,l,u,f,m,v,x,S,M,I,P){const L=this.length;return this.resize(L+1),this.emplace(L,e,t,o,l,u,f,m,v,x,S,M,I,P)}emplace(e,t,o,l,u,f,m,v,x,S,M,I,P,L){const U=20*e,$=10*e;return this.int16[U+0]=t,this.int16[U+1]=o,this.int16[U+2]=l,this.int16[U+3]=u,this.int16[U+4]=f,this.float32[$+3]=m,this.float32[$+4]=v,this.float32[$+5]=x,this.float32[$+6]=S,this.int16[U+14]=M,this.uint32[$+8]=I,this.uint16[U+18]=P,this.uint16[U+19]=L,e}}Fn.prototype.bytesPerElement=40,Bt(Fn,"StructArrayLayout5i4f1i1ul2ui40");class Vr extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,o,l,u,f,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,t,o,l,u,f,m)}emplace(e,t,o,l,u,f,m,v){const x=8*e;return this.int16[x+0]=t,this.int16[x+1]=o,this.int16[x+2]=l,this.int16[x+4]=u,this.int16[x+5]=f,this.int16[x+6]=m,this.int16[x+7]=v,e}}Vr.prototype.bytesPerElement=16,Bt(Vr,"StructArrayLayout3i2i2i16");class so extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,o,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,t,o,l,u)}emplace(e,t,o,l,u,f){const m=4*e,v=8*e;return this.float32[m+0]=t,this.float32[m+1]=o,this.float32[m+2]=l,this.int16[v+6]=u,this.int16[v+7]=f,e}}so.prototype.bytesPerElement=16,Bt(so,"StructArrayLayout2f1f2i16");class en extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,o,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,o,l)}emplace(e,t,o,l,u){const f=12*e,m=3*e;return this.uint8[f+0]=t,this.uint8[f+1]=o,this.float32[m+1]=l,this.float32[m+2]=u,e}}en.prototype.bytesPerElement=12,Bt(en,"StructArrayLayout2ub2f12");class nn extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,t,o)}emplace(e,t,o,l){const u=3*e;return this.float32[u+0]=t,this.float32[u+1]=o,this.float32[u+2]=l,e}}nn.prototype.bytesPerElement=12,Bt(nn,"StructArrayLayout3f12");class _i extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,t,o)}emplace(e,t,o,l){const u=3*e;return this.uint16[u+0]=t,this.uint16[u+1]=o,this.uint16[u+2]=l,e}}_i.prototype.bytesPerElement=6,Bt(_i,"StructArrayLayout3ui6");class En extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,o,l,u,f,m,v,x,S,M,I,P,L,U,$,ee,se,ie,re,me){const ae=this.length;return this.resize(ae+1),this.emplace(ae,e,t,o,l,u,f,m,v,x,S,M,I,P,L,U,$,ee,se,ie,re,me)}emplace(e,t,o,l,u,f,m,v,x,S,M,I,P,L,U,$,ee,se,ie,re,me,ae){const Ve=30*e,Fe=15*e,We=60*e;return this.int16[Ve+0]=t,this.int16[Ve+1]=o,this.int16[Ve+2]=l,this.float32[Fe+2]=u,this.float32[Fe+3]=f,this.uint16[Ve+8]=m,this.uint16[Ve+9]=v,this.uint32[Fe+5]=x,this.uint32[Fe+6]=S,this.uint32[Fe+7]=M,this.uint16[Ve+16]=I,this.uint16[Ve+17]=P,this.uint16[Ve+18]=L,this.float32[Fe+10]=U,this.float32[Fe+11]=$,this.uint8[We+48]=ee,this.uint8[We+49]=se,this.uint8[We+50]=ie,this.uint32[Fe+13]=re,this.int16[Ve+28]=me,this.uint8[We+58]=ae,e}}En.prototype.bytesPerElement=60,Bt(En,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Gn extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,o,l,u,f,m,v,x,S,M,I,P,L,U,$,ee,se,ie,re,me,ae,Ve,Fe,We,yt,je,et,at,tt){const ft=this.length;return this.resize(ft+1),this.emplace(ft,e,t,o,l,u,f,m,v,x,S,M,I,P,L,U,$,ee,se,ie,re,me,ae,Ve,Fe,We,yt,je,et,at,tt)}emplace(e,t,o,l,u,f,m,v,x,S,M,I,P,L,U,$,ee,se,ie,re,me,ae,Ve,Fe,We,yt,je,et,at,tt,ft){const lt=38*e,kt=19*e;return this.int16[lt+0]=t,this.int16[lt+1]=o,this.int16[lt+2]=l,this.float32[kt+2]=u,this.float32[kt+3]=f,this.int16[lt+8]=m,this.int16[lt+9]=v,this.int16[lt+10]=x,this.int16[lt+11]=S,this.int16[lt+12]=M,this.int16[lt+13]=I,this.uint16[lt+14]=P,this.uint16[lt+15]=L,this.uint16[lt+16]=U,this.uint16[lt+17]=$,this.uint16[lt+18]=ee,this.uint16[lt+19]=se,this.uint16[lt+20]=ie,this.uint16[lt+21]=re,this.uint16[lt+22]=me,this.uint16[lt+23]=ae,this.uint16[lt+24]=Ve,this.uint16[lt+25]=Fe,this.uint16[lt+26]=We,this.uint16[lt+27]=yt,this.uint16[lt+28]=je,this.uint32[kt+15]=et,this.float32[kt+16]=at,this.float32[kt+17]=tt,this.float32[kt+18]=ft,e}}Gn.prototype.bytesPerElement=76,Bt(Gn,"StructArrayLayout3i2f6i15ui1ul3f76");class Xi extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}Xi.prototype.bytesPerElement=4,Bt(Xi,"StructArrayLayout1f4");class Zn extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,o,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,t,o,l,u)}emplace(e,t,o,l,u,f){const m=5*e;return this.float32[m+0]=t,this.float32[m+1]=o,this.float32[m+2]=l,this.float32[m+3]=u,this.float32[m+4]=f,e}}Zn.prototype.bytesPerElement=20,Bt(Zn,"StructArrayLayout5f20");class Qo extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,o,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,o,l)}emplace(e,t,o,l,u){const f=6*e;return this.uint32[3*e+0]=t,this.uint16[f+2]=o,this.uint16[f+3]=l,this.uint16[f+4]=u,e}}Qo.prototype.bytesPerElement=12,Bt(Qo,"StructArrayLayout1ul3ui12");class Jn extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const o=this.length;return this.resize(o+1),this.emplace(o,e,t)}emplace(e,t,o){const l=2*e;return this.uint16[l+0]=t,this.uint16[l+1]=o,e}}Jn.prototype.bytesPerElement=4,Bt(Jn,"StructArrayLayout2ui4");class es extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}es.prototype.bytesPerElement=2,Bt(es,"StructArrayLayout1ui2");class ts extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const o=this.length;return this.resize(o+1),this.emplace(o,e,t)}emplace(e,t,o){const l=2*e;return this.float32[l+0]=t,this.float32[l+1]=o,e}}ts.prototype.bytesPerElement=8,Bt(ts,"StructArrayLayout2f8");class is extends qe{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}is.prototype.size=12;class Qn extends Ii{get(e){return new is(this,e)}}Bt(Qn,"FillExtrusionExtArray");class ns extends qe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ns.prototype.size=40;class Po extends Fn{get(e){return new ns(this,e)}}Bt(Po,"CollisionBoxArray");class ja extends qe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}ja.prototype.size=60;class Ig extends En{get(e){return new ja(this,e)}}Bt(Ig,"PlacedSymbolArray");class kg extends qe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}kg.prototype.size=76;class zg extends Gn{get(e){return new kg(this,e)}}Bt(zg,"SymbolInstanceArray");class Pg extends Xi{getoffsetX(e){return this.float32[1*e+0]}}Bt(Pg,"GlyphOffsetArray");class Dg extends Vt{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Bt(Dg,"SymbolLineVertexArray");class Lg extends qe{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Lg.prototype.size=12;class Bg extends Qo{get(e){return new Lg(this,e)}}Bt(Bg,"FeatureIndexArray");class Rg extends qe{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Rg.prototype.size=4;class Fg extends Jn{get(e){return new Rg(this,e)}}Bt(Fg,"FillExtrusionCentroidArray");class Og extends qe{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Og.prototype.size=12;class Vg extends Ii{get(e){return new Og(this,e)}}Bt(Vg,"CircleGlobeExtArray");const Yb=it([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Jb=it([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Ug=Oc(function(i){i.exports=function(e,t){var o,l,u,f,m,v,x,S;for(l=e.length-(o=3&e.length),u=t,m=3432918353,v=461845907,S=0;S<l;)x=255&e.charCodeAt(S)|(255&e.charCodeAt(++S))<<8|(255&e.charCodeAt(++S))<<16|(255&e.charCodeAt(++S))<<24,++S,u=27492+(65535&(f=5*(65535&(u=(u^=x=(65535&(x=(x=(65535&x)*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*v+(((x>>>16)*v&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(x=0,o){case 3:x^=(255&e.charCodeAt(S+2))<<16;case 2:x^=(255&e.charCodeAt(S+1))<<8;case 1:u^=x=(65535&(x=(x=(65535&(x^=255&e.charCodeAt(S)))*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*v+(((x>>>16)*v&65535)<<16)&4294967295}return u^=e.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0}}),Qb=Oc(function(i){i.exports=function(e,t){for(var o,l=e.length,u=t^l,f=0;l>=4;)o=1540483477*(65535&(o=255&e.charCodeAt(f)|(255&e.charCodeAt(++f))<<8|(255&e.charCodeAt(++f))<<16|(255&e.charCodeAt(++f))<<24))+((1540483477*(o>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),l-=4,++f;switch(l){case 3:u^=(255&e.charCodeAt(f+2))<<16;case 2:u^=(255&e.charCodeAt(f+1))<<8;case 1:u=1540483477*(65535&(u^=255&e.charCodeAt(f)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0}}),Bu=Ug,ew=Qb;Bu.murmur3=Ug,Bu.murmur2=ew;class zd{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,o,l){this.ids.push(Ng(e)),this.positions.push(t,o,l)}getPositions(e){const t=Ng(e);let o=0,l=this.ids.length-1;for(;o<l;){const f=o+l>>1;this.ids[f]>=t?l=f:o=f+1}const u=[];for(;this.ids[o]===t;)u.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return u}static serialize(e,t){const o=new Float64Array(e.ids),l=new Uint32Array(e.positions);return jp(o,l,0,o.length-1),t&&t.push(o.buffer,l.buffer),{ids:o,positions:l}}static deserialize(e){const t=new zd;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function Ng(i){const e=+i;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Bu(String(i))}function jp(i,e,t,o){for(;t<o;){const l=i[t+o>>1];let u=t-1,f=o+1;for(;;){do u++;while(i[u]<l);do f--;while(i[f]>l);if(u>=f)break;Pd(i,u,f),Pd(e,3*u,3*f),Pd(e,3*u+1,3*f+1),Pd(e,3*u+2,3*f+2)}f-t<o-f?(jp(i,e,t,f),t=f+1):(jp(i,e,f+1,o),o=f)}}function Pd(i,e,t){const o=i[e];i[e]=i[t],i[t]=o}Bt(zd,"FeaturePositionMap");class rs{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}}class Dd extends rs{constructor(e){super(e),this.current=0}set(e,t,o){this.fetchUniformLocation(e,t)&&this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class jg extends rs{constructor(e){super(e),this.current=[0,0,0,0]}set(e,t,o){this.fetchUniformLocation(e,t)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3])))}}class qg extends rs{constructor(e){super(e),this.current=Ni.transparent}set(e,t,o){this.fetchUniformLocation(e,t)&&(o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a)))}}const tw=new Float32Array(16),iw=new Float32Array(9),nw=new Float32Array(4);function qp(i){return[rt(255*i.r,255*i.g),rt(255*i.b,255*i.a)]}class Ru{constructor(e,t,o){this.value=e,this.uniformNames=t.map(l=>`u_${l}`),this.type=o}setUniform(e,t,o,l,u){t.set(e,u,l.constantOr(this.value))}getBinding(e,t){return this.type==="color"?new qg(e):new Dd(e)}}class Kl{constructor(e,t){this.uniformNames=t.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,t){this.pixelRatioFrom=t.pixelRatio||1,this.pixelRatioTo=e.pixelRatio||1,this.patternFrom=t.tl.concat(t.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,t,o,l,u){const f=u==="u_pattern_to"||u==="u_dash_to"?this.patternTo:u==="u_pattern_from"||u==="u_dash_from"?this.patternFrom:u==="u_pixel_ratio_to"?this.pixelRatioTo:u==="u_pixel_ratio_from"?this.pixelRatioFrom:null;f&&t.set(e,u,f)}getBinding(e,t){return t==="u_pattern_from"||t==="u_pattern_to"||t==="u_dash_from"||t==="u_dash_to"?new jg(e):new Dd(e)}}class os{constructor(e,t,o,l){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=t.map(u=>({name:`a_${u}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(e,t,o,l,u,f){const m=this.paintVertexArray.length,v=this.expression.evaluate(new W(0),t,{},u,l,f);this.paintVertexArray.resize(e),this._setPaintValue(m,e,v)}updatePaintArray(e,t,o,l,u){const f=this.expression.evaluate({zoom:0},o,l,void 0,u);this._setPaintValue(e,t,f)}_setPaintValue(e,t,o){if(this.type==="color"){const l=qp(o);for(let u=e;u<t;u++)this.paintVertexArray.emplace(u,l[0],l[1])}else{for(let l=e;l<t;l++)this.paintVertexArray.emplace(l,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ao{constructor(e,t,o,l,u,f){this.expression=e,this.uniformNames=t.map(m=>`u_${m}_t`),this.type=o,this.useIntegerZoom=l,this.zoom=u,this.maxValue=0,this.paintVertexAttributes=t.map(m=>({name:`a_${m}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,t,o,l,u,f){const m=this.expression.evaluate(new W(this.zoom),t,{},u,l,f),v=this.expression.evaluate(new W(this.zoom+1),t,{},u,l,f),x=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(x,e,m,v)}updatePaintArray(e,t,o,l,u){const f=this.expression.evaluate({zoom:this.zoom},o,l,void 0,u),m=this.expression.evaluate({zoom:this.zoom+1},o,l,void 0,u);this._setPaintValue(e,t,f,m)}_setPaintValue(e,t,o,l){if(this.type==="color"){const u=qp(o),f=qp(l);for(let m=e;m<t;m++)this.paintVertexArray.emplace(m,u[0],u[1],f[0],f[1])}else{for(let u=e;u<t;u++)this.paintVertexArray.emplace(u,o,l);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t,o,l,u){const f=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,m=Te(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);t.set(e,u,m)}getBinding(e,t){return new Dd(e)}}class Us{constructor(e,t,o,l,u,f,m){this.expression=e,this.type=o,this.useIntegerZoom=l,this.zoom=u,this.layerId=m,this.paintVertexAttributes=(o==="array"?Jb:Yb).members;for(let v=0;v<t.length;++v);this.zoomInPaintVertexArray=new f,this.zoomOutPaintVertexArray=new f}populatePaintArray(e,t,o){const l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(l,e,t.patterns&&t.patterns[this.layerId],o)}updatePaintArray(e,t,o,l,u,f){this._setPaintValues(e,t,o.patterns&&o.patterns[this.layerId],f)}_setPaintValues(e,t,o,l){if(!l||!o)return;const{min:u,mid:f,max:m}=o,v=l[u],x=l[f],S=l[m];if(v&&x&&S)for(let M=e;M<t;M++)this._setPaintValue(this.zoomInPaintVertexArray,M,x,v),this._setPaintValue(this.zoomOutPaintVertexArray,M,x,S)}_setPaintValue(e,t,o,l){e.emplace(t,o.tl[0],o.tl[1],o.br[0],o.br[1],l.tl[0],l.tl[1],l.br[0],l.br[1],o.pixelRatio,l.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ns{constructor(e,t,o=()=>!0){this.binders={},this._buffers=[];const l=[];for(const u in e.paint._values){if(!o(u))continue;const f=e.paint.get(u);if(!(f instanceof oe&&zs(f.property.specification)))continue;const m=ow(u,e.type),v=f.value,x=f.property.specification.type,S=f.property.useIntegerZoom,M=f.property.specification["property-type"],I=M==="cross-faded"||M==="cross-faded-data-driven",P=String(u)==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(v.kind!=="constant"||P)if(v.kind==="source"||P||I){const L=$g(u,x,"source");this.binders[u]=I?new Us(v,m,x,S,t,L,e.id):new os(v,m,x,L),l.push(`/a_${u}`)}else{const L=$g(u,x,"composite");this.binders[u]=new ao(v,m,x,S,t,L),l.push(`/z_${u}`)}else this.binders[u]=I?new Kl(v.value,m):new Ru(v.value,m,x),l.push(`/u_${u}`)}this.cacheKey=l.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof os||t instanceof ao?t.maxValue:0}populatePaintArrays(e,t,o,l,u,f){for(const m in this.binders){const v=this.binders[m];(v instanceof os||v instanceof ao||v instanceof Us)&&v.populatePaintArray(e,t,o,l,u,f)}}setConstantPatternPositions(e,t){for(const o in this.binders){const l=this.binders[o];l instanceof Kl&&l.setConstantPatternPositions(e,t)}}updatePaintArrays(e,t,o,l,u,f){let m=!1;for(const v in e){const x=t.getPositions(v);for(const S of x){const M=o.feature(S.index);for(const I in this.binders){const P=this.binders[I];if((P instanceof os||P instanceof ao||P instanceof Us)&&P.expression.isStateDependent===!0){const L=l.paint.get(I);P.expression=L.value,P.updatePaintArray(S.start,S.end,M,e[v],u,f),m=!0}}}}return m}defines(){const e=[];for(const t in this.binders){const o=this.binders[t];(o instanceof Ru||o instanceof Kl)&&e.push(...o.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const o=this.binders[t];if(o instanceof os||o instanceof ao||o instanceof Us)for(let l=0;l<o.paintVertexAttributes.length;l++)e.push(o.paintVertexAttributes[l].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const o=this.binders[t];if(o instanceof Ru||o instanceof Kl||o instanceof ao)for(const l of o.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const t=[];for(const o in this.binders){const l=this.binders[o];if(l instanceof Ru||l instanceof Kl||l instanceof ao)for(const u of l.uniformNames)t.push({name:u,property:o,binding:l.getBinding(e,u)})}return t}setUniforms(e,t,o,l,u){for(const{name:f,property:m,binding:v}of o)this.binders[m].setUniform(e,v,u,l.get(m),f)}updatePaintBuffers(e){this._buffers=[];for(const t in this.binders){const o=this.binders[t];if(e&&o instanceof Us){const l=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(o instanceof os||o instanceof ao)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const t in this.binders){const o=this.binders[t];(o instanceof os||o instanceof ao||o instanceof Us)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof os||t instanceof ao||t instanceof Us)&&t.destroy()}}}class qa{constructor(e,t,o=()=>!0){this.programConfigurations={};for(const l of e)this.programConfigurations[l.id]=new Ns(l,t,o);this.needsUpload=!1,this._featureMap=new zd,this._bufferOffset=0}populatePaintArrays(e,t,o,l,u,f,m){for(const v in this.programConfigurations)this.programConfigurations[v].populatePaintArrays(e,t,l,u,f,m);t.id!==void 0&&this._featureMap.add(t.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,o,l,u){for(const f of o)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(e,this._featureMap,t,f,l,u)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const rw={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function ow(i,e){return rw[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}const sw={"line-pattern":{source:Ut,composite:Ut},"fill-pattern":{source:Ut,composite:Ut},"fill-extrusion-pattern":{source:Ut,composite:Ut},"line-dasharray":{source:ai,composite:ai}},aw={color:{source:ts,composite:xi},number:{source:Xi,composite:ts}};function $g(i,e,t){const o=sw[i];return o&&o[t]||aw[e][t]}Bt(Ru,"ConstantBinder"),Bt(Kl,"CrossFadedConstantBinder"),Bt(os,"SourceExpressionBinder"),Bt(Us,"CrossFadedCompositeBinder"),Bt(ao,"CompositeExpressionBinder"),Bt(Ns,"ProgramConfiguration",{omit:["_buffers"]}),Bt(qa,"ProgramConfigurationSet");const Ld="-transition";class lo extends Ze{constructor(e,t){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),t.layout&&(this._unevaluatedLayout=new he(t.layout)),t.paint)){this._transitionablePaint=new te(t.paint);for(const o in e.paint)this.setPaintProperty(o,e.paint[o],{validate:!1});for(const o in e.layout)this.setLayoutProperty(o,e.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new fe(t.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,o={}){t!=null&&this._validate(md,`layers.${this.id}.layout.${e}`,e,t,o)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}getPaintProperty(e){return ot(e,Ld)?this._transitionablePaint.getTransition(e.slice(0,-Ld.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,o={}){if(t!=null&&this._validate($l,`layers.${this.id}.paint.${e}`,e,t,o))return!1;if(ot(e,Ld))return this._transitionablePaint.setTransition(e.slice(0,-Ld.length),t||void 0),!1;{const l=this._transitionablePaint._values[e],u=l.property.specification["property-type"]==="cross-faded-data-driven",f=l.value.isDataDriven(),m=l.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);const v=this._transitionablePaint._values[e].value;return v.isDataDriven()||f||u||this._handleOverridablePaintPropertyUpdate(e,m,v)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,t,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),di(e,(t,o)=>!(t===void 0||o==="layout"&&!Object.keys(t).length||o==="paint"&&!Object.keys(t).length))}_validate(e,t,o,l,u={}){return(!u||u.validate!==!1)&&Su(this,e.call(ql,{key:t,layerType:this.type,objectKey:o,value:l,styleSpec:Ce,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof oe&&zs(t.property.specification)&&(t.value.kind==="source"||t.value.kind==="composite")&&t.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=La(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const lw=it([{name:"a_pos",components:2,type:"Int16"}],4),cw=it([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class In{constructor(e=[]){this.segments=e}prepareSegment(e,t,o,l){let u=this.segments[this.segments.length-1];return e>In.MAX_VERTEX_ARRAY_LENGTH&&xt(`Max vertices per segment is ${In.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!u||u.vertexLength+e>In.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==l)&&(u={vertexOffset:t.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},l!==void 0&&(u.sortKey=l),this.segments.push(u)),u}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,o,l){return new In([{vertexOffset:e,primitiveOffset:t,vertexLength:o,primitiveLength:l,vaos:{},sortKey:0}])}}In.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Bt(In,"SegmentVector");var ei=8192;class js{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Vi?new Vi(e.lng,e.lat):Vi.convert(e),this}setSouthWest(e){return this._sw=e instanceof Vi?new Vi(e.lng,e.lat):Vi.convert(e),this}extend(e){const t=this._sw,o=this._ne;let l,u;if(e instanceof Vi)l=e,u=e;else{if(!(e instanceof js))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(js.convert(e)):this.extend(Vi.convert(e)):this;if(l=e._sw,u=e._ne,!l||!u)return this}return t||o?(t.lng=Math.min(l.lng,t.lng),t.lat=Math.min(l.lat,t.lat),o.lng=Math.max(u.lng,o.lng),o.lat=Math.max(u.lat,o.lat)):(this._sw=new Vi(l.lng,l.lat),this._ne=new Vi(u.lng,u.lat)),this}getCenter(){return new Vi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Vi(this.getWest(),this.getNorth())}getSouthEast(){return new Vi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:o}=Vi.convert(e);let l=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&l}static convert(e){return!e||e instanceof js?e:new js(e)}}const $p=63710088e-1;class Vi{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Vi(xe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,o=this.lat*t,l=e.lat*t,u=Math.sin(o)*Math.sin(l)+Math.cos(o)*Math.cos(l)*Math.cos((e.lng-this.lng)*t);return $p*Math.acos(Math.min(u,1))}toBounds(e=0){const t=360*e/40075017,o=t/Math.cos(Math.PI/180*this.lat);return new js(new Vi(this.lng-o,this.lat-t),new Vi(this.lng+o,this.lat+t))}static convert(e){if(e instanceof Vi)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Vi(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Vi(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Gg=2*Math.PI*$p;function Gp(i){return Gg*Math.cos(i*Math.PI/180)}function Do(i){return(180+i)/360}function ss(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Gr(i,e){return i/Gp(e)}function Zr(i){return 360*i-180}function Wn(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function Zg(i,e){return i*Gp(Wn(e))}const Lo=85.051129;function Wg(i){return 1/Math.cos(i*Math.PI/180)}class Yl{constructor(e,t,o=0){this.x=+e,this.y=+t,this.z=+o}static fromLngLat(e,t=0){const o=Vi.convert(e);return new Yl(Do(o.lng),ss(o.lat),Gr(t,o.lat))}toLngLat(){return new Vi(Zr(this.x),Wn(this.y))}toAltitude(){return Zg(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Gg*Wg(Wn(this.y))}}function Zp(i,e,t,o,l,u,f,m,v){const x=(e+o)/2,S=(t+l)/2,M=new F(x,S);m(M),function(I,P,L,U,$,ee){const se=L-$,ie=U-ee;return Math.abs((U-P)*se-(L-I)*ie)/Math.hypot(se,ie)}(M.x,M.y,u.x,u.y,f.x,f.y)>=v?(Zp(i,e,t,x,S,u,M,m,v),Zp(i,x,S,o,l,M,f,m,v)):i.push(f)}function Hg(i,e,t){let o=i[0],l=o.x,u=o.y;e(o);const f=[o];for(let m=1;m<i.length;m++){const v=i[m],{x,y:S}=v;e(v),Zp(f,l,u,x,S,o,v,e,t),l=x,u=S,o=v}return f}function Wp(i,e,t,o,l){if(l(e,t)){const u=e.add(t).mult(.5);o(u),Wp(i,e,u,o,l),Wp(i,u,t,o,l)}else i.push(t)}function uw(i,e,t){let o=i[0];e(o);const l=[o];for(let u=1;u<i.length;u++){const f=i[u];e(f),Wp(l,o,f,e,t),o=f}return l}const Hp=Math.pow(2,14)-1,Xg=-Hp-1;function hw(i,e){const t=Math.round(i.x*e),o=Math.round(i.y*e);return i.x=Te(t,Xg,Hp),i.y=Te(o,Xg,Hp),(t<i.x||t>i.x+1||o<i.y||o>i.y+1)&&xt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function as(i,e,t){const o=i.loadGeometry(),l=i.extent,u=ei/l;if(e&&t&&t.projection.isReprojectedInTileSpace){const f=1<<e.z,{scale:m,x:v,y:x,projection:S}=t,M=I=>{const P=Zr((e.x+I.x/l)/f),L=Wn((e.y+I.y/l)/f),U=S.project(P,L);I.x=(U.x*m-v)*l,I.y=(U.y*m-x)*l};for(let I=0;I<o.length;I++)if(i.type!==1)o[I]=Hg(o[I],M,1);else{const P=[];for(const L of o[I])L.x<0||L.x>=l||L.y<0||L.y>=l||(M(L),P.push(L));o[I]=P}}for(const f of o)for(const m of f)hw(m,u);return o}function $a(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?as(i):[]}}function Bd(i,e,t,o,l){i.emplaceBack(2*e+(o+1)/2,2*t+(l+1)/2)}function Rd(i,e,t){i.emplaceBack(e.x,e.y,e.z,t[0]*16384,t[1]*16384,t[2]*16384)}class Xp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new St,this.indexArray=new _i,this.segments=new In,this.programConfigurations=new qa(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(e,t,o,l){const u=this.layers[0],f=[];let m=null;u.type==="circle"&&(m=u.layout.get("circle-sort-key"));for(const{feature:x,id:S,index:M,sourceLayerIndex:I}of e){const P=this.layers[0]._featureFilter.needGeometry,L=$a(x,P);if(!this.layers[0]._featureFilter.filter(new W(this.zoom),L,o))continue;const U=m?m.evaluate(L,{},o):void 0,$={id:S,properties:x.properties,type:x.type,sourceLayerIndex:I,index:M,geometry:P?L.geometry:as(x,o,l),patterns:{},sortKey:U};f.push($)}m&&f.sort((x,S)=>x.sortKey-S.sortKey);let v=null;l.projection.name==="globe"&&(this.globeExtVertexArray=new Vg,v=l.projection);for(const x of f){const{geometry:S,index:M,sourceLayerIndex:I}=x,P=e[M].feature;this.addFeature(x,S,M,t.availableImages,o,v),t.featureIndex.insert(P,S,M,I,this.index)}}update(e,t,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,o,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,lw.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,cw.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,t,o,l,u,f){for(const m of t)for(const v of m){const x=v.x,S=v.y;if(x<0||x>=ei||S<0||S>=ei)continue;if(f){const P=f.projectTilePoint(x,S,u),L=f.upVector(u,x,S),U=this.globeExtVertexArray;Rd(U,P,L),Rd(U,P,L),Rd(U,P,L),Rd(U,P,L)}const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),I=M.vertexLength;Bd(this.layoutVertexArray,x,S,-1,-1),Bd(this.layoutVertexArray,x,S,1,-1),Bd(this.layoutVertexArray,x,S,1,1),Bd(this.layoutVertexArray,x,S,-1,1),this.indexArray.emplaceBack(I,I+1,I+2),this.indexArray.emplaceBack(I,I+2,I+3),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},l,u)}}function Kg(i,e){for(let t=0;t<i.length;t++)if(Ga(e,i[t]))return!0;for(let t=0;t<e.length;t++)if(Ga(i,e[t]))return!0;return!!Kp(i,e)}function dw(i,e,t){return!!Ga(i,e)||!!Yp(e,i,t)}function Yg(i,e){if(i.length===1)return Qg(e,i[0]);for(let t=0;t<e.length;t++){const o=e[t];for(let l=0;l<o.length;l++)if(Ga(i,o[l]))return!0}for(let t=0;t<i.length;t++)if(Qg(e,i[t]))return!0;for(let t=0;t<e.length;t++)if(Kp(i,e[t]))return!0;return!1}function fw(i,e,t){if(i.length>1){if(Kp(i,e))return!0;for(let o=0;o<e.length;o++)if(Yp(e[o],i,t))return!0}for(let o=0;o<i.length;o++)if(Yp(i[o],e,t))return!0;return!1}function Kp(i,e){if(i.length===0||e.length===0)return!1;for(let t=0;t<i.length-1;t++){const o=i[t],l=i[t+1];for(let u=0;u<e.length-1;u++)if(pw(o,l,e[u],e[u+1]))return!0}return!1}function pw(i,e,t,o){return Lt(i,t,o)!==Lt(e,t,o)&&Lt(i,e,t)!==Lt(i,e,o)}function Yp(i,e,t){const o=t*t;if(e.length===1)return i.distSqr(e[0])<o;for(let l=1;l<e.length;l++)if(Jg(i,e[l-1],e[l])<o)return!0;return!1}function Jg(i,e,t){const o=e.distSqr(t);if(o===0)return i.distSqr(e);const l=((i.x-e.x)*(t.x-e.x)+(i.y-e.y)*(t.y-e.y))/o;return i.distSqr(l<0?e:l>1?t:t.sub(e)._mult(l)._add(e))}function Qg(i,e){let t,o,l,u=!1;for(let f=0;f<i.length;f++){t=i[f];for(let m=0,v=t.length-1;m<t.length;v=m++)o=t[m],l=t[v],o.y>e.y!=l.y>e.y&&e.x<(l.x-o.x)*(e.y-o.y)/(l.y-o.y)+o.x&&(u=!u)}return u}function Ga(i,e){let t=!1;for(let o=0,l=i.length-1;o<i.length;l=o++){const u=i[o],f=i[l];u.y>e.y!=f.y>e.y&&e.x<(f.x-u.x)*(e.y-u.y)/(f.y-u.y)+u.x&&(t=!t)}return t}function ey(i,e,t,o,l){for(const f of i)if(e<=f.x&&t<=f.y&&o>=f.x&&l>=f.y)return!0;const u=[new F(e,t),new F(e,l),new F(o,l),new F(o,t)];if(i.length>2){for(const f of u)if(Ga(i,f))return!0}for(let f=0;f<i.length-1;f++)if(mw(i[f],i[f+1],u))return!0;return!1}function mw(i,e,t){const o=t[0],l=t[2];if(i.x<o.x&&e.x<o.x||i.x>l.x&&e.x>l.x||i.y<o.y&&e.y<o.y||i.y>l.y&&e.y>l.y)return!1;const u=Lt(i,e,t[0]);return u!==Lt(i,e,t[1])||u!==Lt(i,e,t[2])||u!==Lt(i,e,t[3])}function Jl(i,e,t){const o=e.paint.get(i).value;return o.kind==="constant"?o.value:t.programConfigurations.get(e.id).getMaxValue(i)}function Fd(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function ty(i,e,t,o,l){if(!e[0]&&!e[1])return i;const u=F.convert(e)._mult(l);t==="viewport"&&u._rotate(-o);const f=[];for(let m=0;m<i.length;m++)f.push(i[m].sub(u));return f}function iy(i,e,t,o){const l=F.convert(i)._mult(o);return e==="viewport"&&l._rotate(-t),l}Bt(Xp,"CircleBucket",{omit:["layers"]});const _w=new Je({"circle-sort-key":new ve(Ce.layout_circle["circle-sort-key"])});var gw={paint:new Je({"circle-radius":new ve(Ce.paint_circle["circle-radius"]),"circle-color":new ve(Ce.paint_circle["circle-color"]),"circle-blur":new ve(Ce.paint_circle["circle-blur"]),"circle-opacity":new ve(Ce.paint_circle["circle-opacity"]),"circle-translate":new le(Ce.paint_circle["circle-translate"]),"circle-translate-anchor":new le(Ce.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new le(Ce.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new le(Ce.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ve(Ce.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ve(Ce.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ve(Ce.paint_circle["circle-stroke-opacity"])}),layout:_w},Od=1e-6,Mr=typeof Float32Array<"u"?Float32Array:Array;function ny(){var i=new Mr(9);return Mr!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function Bo(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Jp(i,e){var t=e[0],o=e[1],l=e[2],u=e[3],f=e[4],m=e[5],v=e[6],x=e[7],S=e[8],M=e[9],I=e[10],P=e[11],L=e[12],U=e[13],$=e[14],ee=e[15],se=t*m-o*f,ie=t*v-l*f,re=t*x-u*f,me=o*v-l*m,ae=o*x-u*m,Ve=l*x-u*v,Fe=S*U-M*L,We=S*$-I*L,yt=S*ee-P*L,je=M*$-I*U,et=M*ee-P*U,at=I*ee-P*$,tt=se*at-ie*et+re*je+me*yt-ae*We+Ve*Fe;return tt?(i[0]=(m*at-v*et+x*je)*(tt=1/tt),i[1]=(l*et-o*at-u*je)*tt,i[2]=(U*Ve-$*ae+ee*me)*tt,i[3]=(I*ae-M*Ve-P*me)*tt,i[4]=(v*yt-f*at-x*We)*tt,i[5]=(t*at-l*yt+u*We)*tt,i[6]=($*re-L*Ve-ee*ie)*tt,i[7]=(S*Ve-I*re+P*ie)*tt,i[8]=(f*et-m*yt+x*Fe)*tt,i[9]=(o*yt-t*et-u*Fe)*tt,i[10]=(L*ae-U*re+ee*se)*tt,i[11]=(M*re-S*ae-P*se)*tt,i[12]=(m*We-f*je-v*Fe)*tt,i[13]=(t*je-o*We+l*Fe)*tt,i[14]=(U*ie-L*me-$*se)*tt,i[15]=(S*me-M*ie+I*se)*tt,i):null}function Ql(i,e,t){var o=e[0],l=e[1],u=e[2],f=e[3],m=e[4],v=e[5],x=e[6],S=e[7],M=e[8],I=e[9],P=e[10],L=e[11],U=e[12],$=e[13],ee=e[14],se=e[15],ie=t[0],re=t[1],me=t[2],ae=t[3];return i[0]=ie*o+re*m+me*M+ae*U,i[1]=ie*l+re*v+me*I+ae*$,i[2]=ie*u+re*x+me*P+ae*ee,i[3]=ie*f+re*S+me*L+ae*se,i[4]=(ie=t[4])*o+(re=t[5])*m+(me=t[6])*M+(ae=t[7])*U,i[5]=ie*l+re*v+me*I+ae*$,i[6]=ie*u+re*x+me*P+ae*ee,i[7]=ie*f+re*S+me*L+ae*se,i[8]=(ie=t[8])*o+(re=t[9])*m+(me=t[10])*M+(ae=t[11])*U,i[9]=ie*l+re*v+me*I+ae*$,i[10]=ie*u+re*x+me*P+ae*ee,i[11]=ie*f+re*S+me*L+ae*se,i[12]=(ie=t[12])*o+(re=t[13])*m+(me=t[14])*M+(ae=t[15])*U,i[13]=ie*l+re*v+me*I+ae*$,i[14]=ie*u+re*x+me*P+ae*ee,i[15]=ie*f+re*S+me*L+ae*se,i}function Fu(i,e,t){var o,l,u,f,m,v,x,S,M,I,P,L,U=t[0],$=t[1],ee=t[2];return e===i?(i[12]=e[0]*U+e[4]*$+e[8]*ee+e[12],i[13]=e[1]*U+e[5]*$+e[9]*ee+e[13],i[14]=e[2]*U+e[6]*$+e[10]*ee+e[14],i[15]=e[3]*U+e[7]*$+e[11]*ee+e[15]):(l=e[1],u=e[2],f=e[3],m=e[4],v=e[5],x=e[6],S=e[7],M=e[8],I=e[9],P=e[10],L=e[11],i[0]=o=e[0],i[1]=l,i[2]=u,i[3]=f,i[4]=m,i[5]=v,i[6]=x,i[7]=S,i[8]=M,i[9]=I,i[10]=P,i[11]=L,i[12]=o*U+m*$+M*ee+e[12],i[13]=l*U+v*$+I*ee+e[13],i[14]=u*U+x*$+P*ee+e[14],i[15]=f*U+S*$+L*ee+e[15]),i}function Za(i,e,t){var o=t[0],l=t[1],u=t[2];return i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i[3]=e[3]*o,i[4]=e[4]*l,i[5]=e[5]*l,i[6]=e[6]*l,i[7]=e[7]*l,i[8]=e[8]*u,i[9]=e[9]*u,i[10]=e[10]*u,i[11]=e[11]*u,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function Qp(i,e,t){var o=Math.sin(t),l=Math.cos(t),u=e[4],f=e[5],m=e[6],v=e[7],x=e[8],S=e[9],M=e[10],I=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=u*l+x*o,i[5]=f*l+S*o,i[6]=m*l+M*o,i[7]=v*l+I*o,i[8]=x*l-u*o,i[9]=S*l-f*o,i[10]=M*l-m*o,i[11]=I*l-v*o,i}function Vd(i,e,t){var o=Math.sin(t),l=Math.cos(t),u=e[0],f=e[1],m=e[2],v=e[3],x=e[8],S=e[9],M=e[10],I=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=u*l-x*o,i[1]=f*l-S*o,i[2]=m*l-M*o,i[3]=v*l-I*o,i[8]=u*o+x*l,i[9]=f*o+S*l,i[10]=m*o+M*l,i[11]=v*o+I*l,i}function ry(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function oy(i,e,t){var o,l,u,f=t[0],m=t[1],v=t[2],x=Math.hypot(f,m,v);return x<Od?null:(f*=x=1/x,m*=x,v*=x,o=Math.sin(e),l=Math.cos(e),i[0]=f*f*(u=1-l)+l,i[1]=m*f*u+v*o,i[2]=v*f*u-m*o,i[3]=0,i[4]=f*m*u-v*o,i[5]=m*m*u+l,i[6]=v*m*u+f*o,i[7]=0,i[8]=f*v*u+m*o,i[9]=m*v*u-f*o,i[10]=v*v*u+l,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var yw=Ql;function em(){var i=new Mr(3);return Mr!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function sy(i){var e=new Mr(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e}function Ou(i){return Math.hypot(i[0],i[1],i[2])}function ec(i,e,t){var o=new Mr(3);return o[0]=i,o[1]=e,o[2]=t,o}function qs(i,e,t){return i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i}function tm(i,e,t){return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i}function ay(i,e,t){return i[0]=e[0]*t[0],i[1]=e[1]*t[1],i[2]=e[2]*t[2],i}function im(i,e,t){return i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.min(e[2],t[2]),i}function nm(i,e,t){return i[0]=Math.max(e[0],t[0]),i[1]=Math.max(e[1],t[1]),i[2]=Math.max(e[2],t[2]),i}function co(i,e,t){return i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i}function Ud(i,e,t,o){return i[0]=e[0]+t[0]*o,i[1]=e[1]+t[1]*o,i[2]=e[2]+t[2]*o,i}function cr(i,e){var t=e[0],o=e[1],l=e[2],u=t*t+o*o+l*l;return u>0&&(u=1/Math.sqrt(u)),i[0]=e[0]*u,i[1]=e[1]*u,i[2]=e[2]*u,i}function Wr(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function rm(i,e,t){var o=e[0],l=e[1],u=e[2],f=t[0],m=t[1],v=t[2];return i[0]=l*v-u*m,i[1]=u*f-o*v,i[2]=o*m-l*f,i}function Pn(i,e,t){var o=e[0],l=e[1],u=e[2],f=t[3]*o+t[7]*l+t[11]*u+t[15];return i[0]=(t[0]*o+t[4]*l+t[8]*u+t[12])/(f=f||1),i[1]=(t[1]*o+t[5]*l+t[9]*u+t[13])/f,i[2]=(t[2]*o+t[6]*l+t[10]*u+t[14])/f,i}function ly(i,e,t){var o=t[0],l=t[1],u=t[2],f=e[0],m=e[1],v=e[2],x=l*v-u*m,S=u*f-o*v,M=o*m-l*f,I=l*M-u*S,P=u*x-o*M,L=o*S-l*x,U=2*t[3];return S*=U,M*=U,P*=2,L*=2,i[0]=f+(x*=U)+(I*=2),i[1]=m+S+P,i[2]=v+M+L,i}var Vu,uo=tm,vw=ay,xw=Ou;function cy(i,e,t){return i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i}function Wa(i,e,t){var o=e[0],l=e[1],u=e[2],f=e[3];return i[0]=t[0]*o+t[4]*l+t[8]*u+t[12]*f,i[1]=t[1]*o+t[5]*l+t[9]*u+t[13]*f,i[2]=t[2]*o+t[6]*l+t[10]*u+t[14]*f,i[3]=t[3]*o+t[7]*l+t[11]*u+t[15]*f,i}function uy(){var i=new Mr(4);return Mr!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function hy(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function dy(i,e,t){t*=.5;var o=e[0],l=e[1],u=e[2],f=e[3],m=Math.sin(t),v=Math.cos(t);return i[0]=o*v+f*m,i[1]=l*v+u*m,i[2]=u*v-l*m,i[3]=f*v-o*m,i}function fy(i,e,t){t*=.5;var o=e[0],l=e[1],u=e[2],f=e[3],m=Math.sin(t),v=Math.cos(t);return i[0]=o*v-u*m,i[1]=l*v+f*m,i[2]=u*v+o*m,i[3]=f*v-l*m,i}em(),Vu=new Mr(4),Mr!=Float32Array&&(Vu[0]=0,Vu[1]=0,Vu[2]=0,Vu[3]=0),em(),ec(1,0,0),ec(0,1,0),uy(),uy(),ny();class om{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,o){const l=Wr(t,this.dir);if(Math.abs(l)<1e-6)return!1;const u=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1]+(e[2]-this.pos[2])*t[2])/l;return o[0]=this.pos[0]+this.dir[0]*u,o[1]=this.pos[1]+this.dir[1]*u,o[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(e,t,o){if(function(P,L){var U=P[0],$=P[1],ee=P[2],se=L[0],ie=L[1],re=L[2];return Math.abs(U-se)<=Od*Math.max(1,Math.abs(U),Math.abs(se))&&Math.abs($-ie)<=Od*Math.max(1,Math.abs($),Math.abs(ie))&&Math.abs(ee-re)<=Od*Math.max(1,Math.abs(ee),Math.abs(re))}(this.pos,e)||t===0)return o[0]=o[1]=o[2]=0,!1;const[l,u,f]=this.dir,m=this.pos[0]-e[0],v=this.pos[1]-e[1],x=this.pos[2]-e[2],S=l*l+u*u+f*f,M=2*(m*l+v*u+x*f),I=M*M-4*S*(m*m+v*v+x*x-t*t);if(I<0){const P=Math.max(-M/2,0),L=m+l*P,U=v+u*P,$=x+f*P,ee=Math.hypot(L,U,$);return o[0]=L*t/ee,o[1]=U*t/ee,o[2]=$*t/ee,!1}{const P=(-M-Math.sqrt(I))/(2*S);if(P<0){const L=Math.hypot(m,v,x);return o[0]=m*t/L,o[1]=v*t/L,o[2]=x*t/L,!1}return o[0]=m+l*P,o[1]=v+u*P,o[2]=x+f*P,!0}}}class sm{constructor(e,t,o,l,u){this.TL=e,this.TR=t,this.BR=o,this.BL=l,this.horizon=u}static fromInvProjectionMatrix(e,t,o){const l=[-1,1,1],u=[1,1,1],f=[1,-1,1],m=[-1,-1,1],v=Pn(l,l,e),x=Pn(u,u,e),S=Pn(f,f,e),M=Pn(m,m,e);return new sm(v,x,S,M,t/o)}}class am{constructor(e,t){this.points=e,this.planes=t}static fromInvProjectionMatrix(e,t,o,l){const u=Math.pow(2,o),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(v=>{const x=Wa([],v,e),S=1/x[3]/t*u;return function(M,I,P){return M[0]=I[0]*P[0],M[1]=I[1]*P[1],M[2]=I[2]*P[2],M[3]=I[3]*P[3],M}(x,x,[S,S,l?1/x[3]:S,S])}),m=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(v=>{const x=cr([],rm([],uo([],f[v[0]],f[v[1]]),uo([],f[v[2]],f[v[1]]))),S=-Wr(x,f[v[1]]);return x.concat(S)});return new am(f,m)}}class vr{static fromPoints(e){const t=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],o=[Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE];for(const l of e)t[0]=Math.min(t[0],l[0]),t[1]=Math.min(t[1],l[1]),t[2]=Math.min(t[2],l[2]),o[0]=Math.max(o[0],l[0]),o[1]=Math.max(o[1],l[1]),o[2]=Math.max(o[2],l[2]);return new vr(t,o)}constructor(e,t){this.min=e,this.max=t,this.center=co([],qs([],this.min,this.max),.5)}quadrant(e){const t=[e%2==0,e<2],o=sy(this.min),l=sy(this.max);for(let u=0;u<t.length;u++)o[u]=t[u]?this.min[u]:this.center[u],l[u]=t[u]?this.center[u]:this.max[u];return l[2]=this.max[2],new vr(o,l)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){const t=this.getCorners();let o=!0;for(let l=0;l<e.planes.length;l++){const u=e.planes[l];let f=0;for(let m=0;m<t.length;m++)f+=Wr(u,t[m])+u[3]>=0;if(f===0)return 0;f!==t.length&&(o=!1)}if(o)return 2;for(let l=0;l<3;l++){let u=Number.MAX_VALUE,f=-Number.MAX_VALUE;for(let m=0;m<e.points.length;m++){const v=e.points[m][l]-this.min[l];u=Math.min(u,v),f=Math.max(f,v)}if(f<0||u>this.max[l]-this.min[l])return 0}return 1}}function py(i,e,t,o,l,u,f,m,v){if(u&&i.queryGeometry.isAboveHorizon)return!1;u&&(v*=i.pixelToTileUnitsFactor);const x=i.tileID.canonical,S=t.projection.upVectorScale(x,t.center.lat,t.worldSize).metersToTile;for(const M of e)for(const I of M){const P=I.add(m),L=l&&t.elevation?t.elevation.exaggeration()*l.getElevationAt(P.x,P.y,!0):0,U=t.projection.projectTilePoint(P.x,P.y,x);if(L>0){const ie=t.projection.upVector(x,P.x,P.y);U.x+=ie[0]*S*L,U.y+=ie[1]*S*L,U.z+=ie[2]*S*L}const $=u?P:bw(U.x,U.y,U.z,o),ee=u?i.tilespaceRays.map(ie=>Tw(ie,L)):i.queryGeometry.screenGeometry,se=Wa([],[U.x,U.y,U.z,1],o);if(!f&&u?v*=se[3]/t.cameraToCenterDistance:f&&!u&&(v*=t.cameraToCenterDistance/se[3]),u){const ie=Wn((I.y/ei+x.y)/(1<<x.z));v/=t.projection.pixelsPerMeter(ie,1)/Gr(1,ie)}if(dw(ee,$,v))return!0}return!1}function bw(i,e,t,o){const l=Wa([],[i,e,t,1],o);return new F(l[0]/l[3],l[1]/l[3])}const my=ec(0,0,0),ww=ec(0,0,1);function Tw(i,e){const t=em();return my[2]=e,i.intersectsPlane(my,ww,t),new F(t[0],t[1])}class _y extends Xp{}function gy(i,{width:e,height:t},o,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*t*o)throw new RangeError("mismatched image size")}else l=new Uint8Array(e*t*o);return i.width=e,i.height=t,i.data=l,i}function yy(i,e,t){const{width:o,height:l}=e;o===i.width&&l===i.height||(lm(i,e,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,o),height:Math.min(i.height,l)},t),i.width=o,i.height=l,i.data=e.data)}function lm(i,e,t,o,l,u){if(l.width===0||l.height===0)return e;if(l.width>i.width||l.height>i.height||t.x>i.width-l.width||t.y>i.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||o.x>e.width-l.width||o.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const f=i.data,m=e.data;for(let v=0;v<l.height;v++){const x=((t.y+v)*i.width+t.x)*u,S=((o.y+v)*e.width+o.x)*u;for(let M=0;M<l.width*u;M++)m[S+M]=f[x+M]}return e}Bt(_y,"HeatmapBucket",{omit:["layers"]});class ls{constructor(e,t){gy(this,e,1,t)}resize(e){yy(this,new ls(e),1)}clone(){return new ls({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,o,l,u){lm(e,t,o,l,u,1)}}class Ir{constructor(e,t){gy(this,e,4,t)}resize(e){yy(this,new Ir(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ir({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,o,l,u){lm(e,t,o,l,u,4)}}Bt(ls,"AlphaImage"),Bt(Ir,"RGBAImage");var Ew={paint:new Je({"heatmap-radius":new ve(Ce.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ve(Ce.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new le(Ce.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ae(Ce.paint_heatmap["heatmap-color"]),"heatmap-opacity":new le(Ce.paint_heatmap["heatmap-opacity"])})};function cm(i){const e={},t=i.resolution||256,o=i.clips?i.clips.length:1,l=i.image||new Ir({width:t,height:o}),u=(f,m,v)=>{e[i.evaluationKey]=v;const x=i.expression.evaluate(e);l.data[f+m+0]=Math.floor(255*x.r/x.a),l.data[f+m+1]=Math.floor(255*x.g/x.a),l.data[f+m+2]=Math.floor(255*x.b/x.a),l.data[f+m+3]=Math.floor(255*x.a)};if(i.clips)for(let f=0,m=0;f<o;++f,m+=4*t)for(let v=0,x=0;v<t;v++,x+=4){const S=v/(t-1),{start:M,end:I}=i.clips[f];u(m,x,M*(1-S)+I*S)}else for(let f=0,m=0;f<t;f++,m+=4)u(0,m,f/(t-1));return l}var Sw={paint:new Je({"hillshade-illumination-direction":new le(Ce.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new le(Ce.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new le(Ce.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new le(Ce.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new le(Ce.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new le(Ce.paint_hillshade["hillshade-accent-color"])})};const Cw=it([{name:"a_pos",components:2,type:"Int16"}],4),{members:Aw}=Cw;var Nd=jd,Mw=jd;function jd(i,e,t){t=t||2;var o,l,u,f,m,v,x,S=e&&e.length,M=S?e[0]*t:i.length,I=vy(i,0,M,t,!0),P=[];if(!I||I.next===I.prev)return P;if(S&&(I=function(U,$,ee,se){var ie,re,me,ae=[];for(ie=0,re=$.length;ie<re;ie++)(me=vy(U,$[ie]*se,ie<re-1?$[ie+1]*se:U.length,se,!1))===me.next&&(me.steiner=!0),ae.push(Rw(me));for(ae.sort(Dw),ie=0;ie<ae.length;ie++)ee=Lw(ae[ie],ee);return ee}(i,e,I,t)),i.length>80*t){o=u=i[0],l=f=i[1];for(var L=t;L<M;L+=t)(m=i[L])<o&&(o=m),(v=i[L+1])<l&&(l=v),m>u&&(u=m),v>f&&(f=v);x=(x=Math.max(u-o,f-l))!==0?32767/x:0}return Uu(I,P,t,o,l,x,0),P}function vy(i,e,t,o,l){var u,f;if(l===dm(i,e,t,o)>0)for(u=e;u<t;u+=o)f=wy(u,i[u],i[u+1],f);else for(u=t-o;u>=e;u-=o)f=wy(u,i[u],i[u+1],f);return f&&qd(f,f.next)&&(ju(f),f=f.next),f}function Ha(i,e){if(!i)return i;e||(e=i);var t,o=i;do if(t=!1,o.steiner||!qd(o,o.next)&&Sn(o.prev,o,o.next)!==0)o=o.next;else{if(ju(o),(o=e=o.prev)===o.next)break;t=!0}while(t||o!==e);return e}function Uu(i,e,t,o,l,u,f){if(i){!f&&u&&function(S,M,I,P){var L=S;do L.z===0&&(L.z=um(L.x,L.y,M,I,P)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==S);L.prevZ.nextZ=null,L.prevZ=null,function(U){var $,ee,se,ie,re,me,ae,Ve,Fe=1;do{for(ee=U,U=null,re=null,me=0;ee;){for(me++,se=ee,ae=0,$=0;$<Fe&&(ae++,se=se.nextZ);$++);for(Ve=Fe;ae>0||Ve>0&&se;)ae!==0&&(Ve===0||!se||ee.z<=se.z)?(ie=ee,ee=ee.nextZ,ae--):(ie=se,se=se.nextZ,Ve--),re?re.nextZ=ie:U=ie,ie.prevZ=re,re=ie;ee=se}re.nextZ=null,Fe*=2}while(me>1)}(L)}(i,o,l,u);for(var m,v,x=i;i.prev!==i.next;)if(m=i.prev,v=i.next,u?kw(i,o,l,u):Iw(i))e.push(m.i/t|0),e.push(i.i/t|0),e.push(v.i/t|0),ju(i),i=v.next,x=v.next;else if((i=v)===x){f?f===1?Uu(i=zw(Ha(i),e,t),e,t,o,l,u,2):f===2&&Pw(i,e,t,o,l,u):Uu(Ha(i),e,t,o,l,u,1);break}}}function Iw(i){var e=i.prev,t=i,o=i.next;if(Sn(e,t,o)>=0)return!1;for(var l=e.x,u=t.x,f=o.x,m=e.y,v=t.y,x=o.y,S=l<u?l<f?l:f:u<f?u:f,M=m<v?m<x?m:x:v<x?v:x,I=l>u?l>f?l:f:u>f?u:f,P=m>v?m>x?m:x:v>x?v:x,L=o.next;L!==e;){if(L.x>=S&&L.x<=I&&L.y>=M&&L.y<=P&&tc(l,m,u,v,f,x,L.x,L.y)&&Sn(L.prev,L,L.next)>=0)return!1;L=L.next}return!0}function kw(i,e,t,o){var l=i.prev,u=i,f=i.next;if(Sn(l,u,f)>=0)return!1;for(var m=l.x,v=u.x,x=f.x,S=l.y,M=u.y,I=f.y,P=m<v?m<x?m:x:v<x?v:x,L=S<M?S<I?S:I:M<I?M:I,U=m>v?m>x?m:x:v>x?v:x,$=S>M?S>I?S:I:M>I?M:I,ee=um(P,L,e,t,o),se=um(U,$,e,t,o),ie=i.prevZ,re=i.nextZ;ie&&ie.z>=ee&&re&&re.z<=se;){if(ie.x>=P&&ie.x<=U&&ie.y>=L&&ie.y<=$&&ie!==l&&ie!==f&&tc(m,S,v,M,x,I,ie.x,ie.y)&&Sn(ie.prev,ie,ie.next)>=0||(ie=ie.prevZ,re.x>=P&&re.x<=U&&re.y>=L&&re.y<=$&&re!==l&&re!==f&&tc(m,S,v,M,x,I,re.x,re.y)&&Sn(re.prev,re,re.next)>=0))return!1;re=re.nextZ}for(;ie&&ie.z>=ee;){if(ie.x>=P&&ie.x<=U&&ie.y>=L&&ie.y<=$&&ie!==l&&ie!==f&&tc(m,S,v,M,x,I,ie.x,ie.y)&&Sn(ie.prev,ie,ie.next)>=0)return!1;ie=ie.prevZ}for(;re&&re.z<=se;){if(re.x>=P&&re.x<=U&&re.y>=L&&re.y<=$&&re!==l&&re!==f&&tc(m,S,v,M,x,I,re.x,re.y)&&Sn(re.prev,re,re.next)>=0)return!1;re=re.nextZ}return!0}function zw(i,e,t){var o=i;do{var l=o.prev,u=o.next.next;!qd(l,u)&&xy(l,o,o.next,u)&&Nu(l,u)&&Nu(u,l)&&(e.push(l.i/t|0),e.push(o.i/t|0),e.push(u.i/t|0),ju(o),ju(o.next),o=i=u),o=o.next}while(o!==i);return Ha(o)}function Pw(i,e,t,o,l,u){var f=i;do{for(var m=f.next.next;m!==f.prev;){if(f.i!==m.i&&Fw(f,m)){var v=by(f,m);return f=Ha(f,f.next),v=Ha(v,v.next),Uu(f,e,t,o,l,u,0),void Uu(v,e,t,o,l,u,0)}m=m.next}f=f.next}while(f!==i)}function Dw(i,e){return i.x-e.x}function Lw(i,e){var t=function(l,u){var f,m=u,v=l.x,x=l.y,S=-1/0;do{if(x<=m.y&&x>=m.next.y&&m.next.y!==m.y){var M=m.x+(x-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(M<=v&&M>S&&(S=M,f=m.x<m.next.x?m:m.next,M===v))return f}m=m.next}while(m!==u);if(!f)return null;var I,P=f,L=f.x,U=f.y,$=1/0;m=f;do v>=m.x&&m.x>=L&&v!==m.x&&tc(x<U?v:S,x,L,U,x<U?S:v,x,m.x,m.y)&&(I=Math.abs(x-m.y)/(v-m.x),Nu(m,l)&&(I<$||I===$&&(m.x>f.x||m.x===f.x&&Bw(f,m)))&&(f=m,$=I)),m=m.next;while(m!==P);return f}(i,e);if(!t)return e;var o=by(t,i);return Ha(o,o.next),Ha(t,t.next)}function Bw(i,e){return Sn(i.prev,i,e.prev)<0&&Sn(e.next,i,i.next)<0}function um(i,e,t,o,l){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-t)*l|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*l|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Rw(i){var e=i,t=i;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==i);return t}function tc(i,e,t,o,l,u,f,m){return(l-f)*(e-m)>=(i-f)*(u-m)&&(i-f)*(o-m)>=(t-f)*(e-m)&&(t-f)*(u-m)>=(l-f)*(o-m)}function Fw(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(t,o){var l=t;do{if(l.i!==t.i&&l.next.i!==t.i&&l.i!==o.i&&l.next.i!==o.i&&xy(l,l.next,t,o))return!0;l=l.next}while(l!==t);return!1}(i,e)&&(Nu(i,e)&&Nu(e,i)&&function(t,o){var l=t,u=!1,f=(t.x+o.x)/2,m=(t.y+o.y)/2;do l.y>m!=l.next.y>m&&l.next.y!==l.y&&f<(l.next.x-l.x)*(m-l.y)/(l.next.y-l.y)+l.x&&(u=!u),l=l.next;while(l!==t);return u}(i,e)&&(Sn(i.prev,i,e.prev)||Sn(i,e.prev,e))||qd(i,e)&&Sn(i.prev,i,i.next)>0&&Sn(e.prev,e,e.next)>0)}function Sn(i,e,t){return(e.y-i.y)*(t.x-e.x)-(e.x-i.x)*(t.y-e.y)}function qd(i,e){return i.x===e.x&&i.y===e.y}function xy(i,e,t,o){var l=Gd(Sn(i,e,t)),u=Gd(Sn(i,e,o)),f=Gd(Sn(t,o,i)),m=Gd(Sn(t,o,e));return l!==u&&f!==m||!(l!==0||!$d(i,t,e))||!(u!==0||!$d(i,o,e))||!(f!==0||!$d(t,i,o))||!(m!==0||!$d(t,e,o))}function $d(i,e,t){return e.x<=Math.max(i.x,t.x)&&e.x>=Math.min(i.x,t.x)&&e.y<=Math.max(i.y,t.y)&&e.y>=Math.min(i.y,t.y)}function Gd(i){return i>0?1:i<0?-1:0}function Nu(i,e){return Sn(i.prev,i,i.next)<0?Sn(i,e,i.next)>=0&&Sn(i,i.prev,e)>=0:Sn(i,e,i.prev)<0||Sn(i,i.next,e)<0}function by(i,e){var t=new hm(i.i,i.x,i.y),o=new hm(e.i,e.x,e.y),l=i.next,u=e.prev;return i.next=e,e.prev=i,t.next=l,l.prev=t,o.next=t,t.prev=o,u.next=o,o.prev=u,o}function wy(i,e,t,o){var l=new hm(i,e,t);return o?(l.next=o.next,l.prev=o,o.next.prev=l,o.next=l):(l.prev=l,l.next=l),l}function ju(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function hm(i,e,t){this.i=i,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function dm(i,e,t,o){for(var l=0,u=e,f=t-o;u<t;u+=o)l+=(i[f]-i[u])*(i[u+1]+i[f+1]),f=u;return l}function Ow(i,e,t,o,l){Ty(i,e,t||0,o||i.length-1,l||Vw)}function Ty(i,e,t,o,l){for(;o>t;){if(o-t>600){var u=o-t+1,f=e-t+1,m=Math.log(u),v=.5*Math.exp(2*m/3),x=.5*Math.sqrt(m*v*(u-v)/u)*(f-u/2<0?-1:1);Ty(i,e,Math.max(t,Math.floor(e-f*v/u+x)),Math.min(o,Math.floor(e+(u-f)*v/u+x)),l)}var S=i[e],M=t,I=o;for(qu(i,t,e),l(i[o],S)>0&&qu(i,t,o);M<I;){for(qu(i,M,I),M++,I--;l(i[M],S)<0;)M++;for(;l(i[I],S)>0;)I--}l(i[t],S)===0?qu(i,t,I):qu(i,++I,o),I<=e&&(t=I+1),e<=I&&(o=I-1)}}function qu(i,e,t){var o=i[e];i[e]=i[t],i[t]=o}function Vw(i,e){return i<e?-1:i>e?1:0}function fm(i,e){const t=i.length;if(t<=1)return[i];const o=[];let l,u;for(let f=0;f<t;f++){const m=pi(i[f]);m!==0&&(i[f].area=Math.abs(m),u===void 0&&(u=m<0),u===m<0?(l&&o.push(l),l=[i[f]]):l.push(i[f]))}if(l&&o.push(l),e>1)for(let f=0;f<o.length;f++)o[f].length<=e||(Ow(o[f],e,1,o[f].length-1,Uw),o[f]=o[f].slice(0,e));return o}function Uw(i,e){return e.area-i.area}function pm(i,e,t){const o=t.patternDependencies;let l=!1;for(const u of e){const f=u.paint.get(`${i}-pattern`);f.isConstant()||(l=!0);const m=f.constantOr(null);m&&(l=!0,o[m.to]=!0,o[m.from]=!0)}return l}function mm(i,e,t,o,l){const u=l.patternDependencies;for(const f of e){const m=f.paint.get(`${i}-pattern`).value;if(m.kind!=="constant"){let v=m.evaluate({zoom:o-1},t,{},l.availableImages),x=m.evaluate({zoom:o},t,{},l.availableImages),S=m.evaluate({zoom:o+1},t,{},l.availableImages);v=v&&v.name?v.name:v,x=x&&x.name?x.name:x,S=S&&S.name?S.name:S,u[v]=!0,u[x]=!0,u[S]=!0,t.patterns[f.id]={min:v,mid:x,max:S}}}return t}jd.deviation=function(i,e,t,o){var l=e&&e.length,u=Math.abs(dm(i,0,l?e[0]*t:i.length,t));if(l)for(var f=0,m=e.length;f<m;f++)u-=Math.abs(dm(i,e[f]*t,f<m-1?e[f+1]*t:i.length,t));var v=0;for(f=0;f<o.length;f+=3){var x=o[f]*t,S=o[f+1]*t,M=o[f+2]*t;v+=Math.abs((i[x]-i[M])*(i[S+1]-i[x+1])-(i[x]-i[S])*(i[M+1]-i[x+1]))}return u===0&&v===0?0:Math.abs((v-u)/u)},jd.flatten=function(i){for(var e=i[0][0].length,t={vertices:[],holes:[],dimensions:e},o=0,l=0;l<i.length;l++){for(var u=0;u<i[l].length;u++)for(var f=0;f<e;f++)t.vertices.push(i[l][u][f]);l>0&&t.holes.push(o+=i[l-1].length)}return t},Nd.default=Mw;class Zd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new St,this.indexArray=new _i,this.indexArray2=new Jn,this.programConfigurations=new qa(e.layers,e.zoom),this.segments=new In,this.segments2=new In,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.projection=e.projection}populate(e,t,o,l){this.hasPattern=pm("fill",this.layers,t);const u=this.layers[0].layout.get("fill-sort-key"),f=[];for(const{feature:m,id:v,index:x,sourceLayerIndex:S}of e){const M=this.layers[0]._featureFilter.needGeometry,I=$a(m,M);if(!this.layers[0]._featureFilter.filter(new W(this.zoom),I,o))continue;const P=u?u.evaluate(I,{},o,t.availableImages):void 0,L={id:v,properties:m.properties,type:m.type,sourceLayerIndex:S,index:x,geometry:M?I.geometry:as(m,o,l),patterns:{},sortKey:P};f.push(L)}u&&f.sort((m,v)=>m.sortKey-v.sortKey);for(const m of f){const{geometry:v,index:x,sourceLayerIndex:S}=m;if(this.hasPattern){const M=mm("fill",this.layers,m,this.zoom,t);this.patternFeatures.push(M)}else this.addFeature(m,v,x,o,{},t.availableImages);t.featureIndex.insert(e[x].feature,v,x,S,this.index)}}update(e,t,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,o,l)}addFeatures(e,t,o,l,u){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,t,o,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Aw),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,o,l,u,f=[]){for(const m of fm(t,500)){let v=0;for(const L of m)v+=L.length;const x=this.segments.prepareSegment(v,this.layoutVertexArray,this.indexArray),S=x.vertexLength,M=[],I=[];for(const L of m){if(L.length===0)continue;L!==m[0]&&I.push(M.length/2);const U=this.segments2.prepareSegment(L.length,this.layoutVertexArray,this.indexArray2),$=U.vertexLength;this.layoutVertexArray.emplaceBack(L[0].x,L[0].y),this.indexArray2.emplaceBack($+L.length-1,$),M.push(L[0].x),M.push(L[0].y);for(let ee=1;ee<L.length;ee++)this.layoutVertexArray.emplaceBack(L[ee].x,L[ee].y),this.indexArray2.emplaceBack($+ee-1,$+ee),M.push(L[ee].x),M.push(L[ee].y);U.vertexLength+=L.length,U.primitiveLength+=L.length}const P=Nd(M,I);for(let L=0;L<P.length;L+=3)this.indexArray.emplaceBack(S+P[L],S+P[L+1],S+P[L+2]);x.vertexLength+=v,x.primitiveLength+=P.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,u,f,l)}}Bt(Zd,"FillBucket",{omit:["layers","patternFeatures"]});const Nw=new Je({"fill-sort-key":new ve(Ce.layout_fill["fill-sort-key"])});var jw={paint:new Je({"fill-antialias":new le(Ce.paint_fill["fill-antialias"]),"fill-opacity":new ve(Ce.paint_fill["fill-opacity"]),"fill-color":new ve(Ce.paint_fill["fill-color"]),"fill-outline-color":new ve(Ce.paint_fill["fill-outline-color"]),"fill-translate":new le(Ce.paint_fill["fill-translate"]),"fill-translate-anchor":new le(Ce.paint_fill["fill-translate-anchor"]),"fill-pattern":new Be(Ce.paint_fill["fill-pattern"])}),layout:Nw};const qw=it([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),$w=it([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Gw=it([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Zw}=qw;var Ey=ic;function ic(i,e,t,o,l){this.properties={},this.extent=t,this.type=0,this._pbf=i,this._geometry=-1,this._keys=o,this._values=l,i.readFields(Ww,this,e)}function Ww(i,e,t){i==1?e.id=t.readVarint():i==2?function(o,l){for(var u=o.readVarint()+o.pos;o.pos<u;){var f=l._keys[o.readVarint()],m=l._values[o.readVarint()];l.properties[f]=m}}(t,e):i==3?e.type=t.readVarint():i==4&&(e._geometry=t.pos)}function Hw(i){for(var e,t,o=0,l=0,u=i.length,f=u-1;l<u;f=l++)o+=((t=i[f]).x-(e=i[l]).x)*(e.y+t.y);return o}ic.types=["Unknown","Point","LineString","Polygon"],ic.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,t=i.readVarint()+i.pos,o=1,l=0,u=0,f=0,m=[];i.pos<t;){if(l<=0){var v=i.readVarint();o=7&v,l=v>>3}if(l--,o===1||o===2)u+=i.readSVarint(),f+=i.readSVarint(),o===1&&(e&&m.push(e),e=[]),e.push(new F(u,f));else{if(o!==7)throw new Error("unknown command "+o);e&&e.push(e[0].clone())}}return e&&m.push(e),m},ic.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,t=1,o=0,l=0,u=0,f=1/0,m=-1/0,v=1/0,x=-1/0;i.pos<e;){if(o<=0){var S=i.readVarint();t=7&S,o=S>>3}if(o--,t===1||t===2)(l+=i.readSVarint())<f&&(f=l),l>m&&(m=l),(u+=i.readSVarint())<v&&(v=u),u>x&&(x=u);else if(t!==7)throw new Error("unknown command "+t)}return[f,v,m,x]},ic.prototype.toGeoJSON=function(i,e,t){var o,l,u=this.extent*Math.pow(2,t),f=this.extent*i,m=this.extent*e,v=this.loadGeometry(),x=ic.types[this.type];function S(P){for(var L=0;L<P.length;L++){var U=P[L];P[L]=[360*(U.x+f)/u-180,360/Math.PI*Math.atan(Math.exp((180-360*(U.y+m)/u)*Math.PI/180))-90]}}switch(this.type){case 1:var M=[];for(o=0;o<v.length;o++)M[o]=v[o][0];S(v=M);break;case 2:for(o=0;o<v.length;o++)S(v[o]);break;case 3:for(v=function(P){var L=P.length;if(L<=1)return[P];for(var U,$,ee=[],se=0;se<L;se++){var ie=Hw(P[se]);ie!==0&&($===void 0&&($=ie<0),$===ie<0?(U&&ee.push(U),U=[P[se]]):U.push(P[se]))}return U&&ee.push(U),ee}(v),o=0;o<v.length;o++)for(l=0;l<v[o].length;l++)S(v[o][l])}v.length===1?v=v[0]:x="Multi"+x;var I={type:"Feature",geometry:{type:x,coordinates:v},properties:this.properties};return"id"in this&&(I.id=this.id),I};var Sy=Cy;function Cy(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Xw,this,e),this.length=this._features.length}function Xw(i,e,t){i===15?e.version=t.readVarint():i===1?e.name=t.readString():i===5?e.extent=t.readVarint():i===2?e._features.push(t.pos):i===3?e._keys.push(t.readString()):i===4&&e._values.push(function(o){for(var l=null,u=o.readVarint()+o.pos;o.pos<u;){var f=o.readVarint()>>3;l=f===1?o.readString():f===2?o.readFloat():f===3?o.readDouble():f===4?o.readVarint64():f===5?o.readVarint():f===6?o.readSVarint():f===7?o.readBoolean():null}return l}(t))}function Kw(i,e,t){if(i===3){var o=new Sy(t,t.readVarint()+t.pos);o.length&&(e[o.name]=o)}}Cy.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new Ey(this._pbf,e,this.extent,this._keys,this._values)};var Xa={VectorTile:function(i,e){this.layers=i.readFields(Kw,{},e)},VectorTileFeature:Ey,VectorTileLayer:Sy};function Wd(i,e,t,o){const l=[],u=o===0?(f,m,v,x,S,M)=>{f.push(new F(M,v+(M-m)/(x-m)*(S-v)))}:(f,m,v,x,S,M)=>{f.push(new F(m+(M-v)/(S-v)*(x-m),M))};for(const f of i){const m=[];for(const v of f){if(v.length<=2)continue;const x=[];for(let I=0;I<v.length-1;I++){const P=v[I].x,L=v[I].y,U=v[I+1].x,$=v[I+1].y,ee=o===0?P:L,se=o===0?U:$;ee<e?se>e&&u(x,P,L,U,$,e):ee>t?se<t&&u(x,P,L,U,$,t):x.push(v[I]),se<e&&ee>=e&&u(x,P,L,U,$,e),se>t&&ee<=t&&u(x,P,L,U,$,t)}let S=v[v.length-1];const M=o===0?S.x:S.y;M>=e&&M<=t&&x.push(S),x.length&&(S=x[x.length-1],x[0].x===S.x&&x[0].y===S.y||x.push(x[0]),m.push(x))}m.length&&l.push(m)}return l}const Yw=Xa.VectorTileFeature.types,Jw=Math.pow(2,13);function $u(i,e,t,o,l,u,f,m){i.emplaceBack((e<<1)+f,(t<<1)+u,(Math.floor(o*Jw)<<1)+l,Math.round(m))}function Gu(i,e,t){i.emplaceBack(e.x,e.y,e.z,t[0]*16384,t[1]*16384,t[2]*16384)}class Ay{constructor(){this.acc=new F(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new F(e.x,e.y),this.max=new F(e.x,e.y))}append(e,t){this.currentPolyCount.edges++,this.acc._add(e);const o=this.min,l=this.max;e.x<o.x?o.x=e.x:e.x>l.x&&(l.x=e.x),e.y<o.y?o.y=e.y:e.y>l.y&&(l.y=e.y),((e.x===0||e.x===ei)&&e.x===t.x)!=((e.y===0||e.y===ei)&&e.y===t.y)&&this.processBorderOverlap(e,t),t.x<0!=e.x<0&&this.addBorderIntersection(0,Mi(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>ei!=e.x>ei&&this.addBorderIntersection(1,Mi(t.y,e.y,(ei-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,Mi(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>ei!=e.y>ei&&this.addBorderIntersection(3,Mi(t.x,e.x,(ei-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const o=this.borders[e];t<o[0]&&(o[0]=t),t>o[1]&&(o[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const o=e.x===0?0:1;this.addBorderIntersection(o,t.y),this.addBorderIntersection(o,e.y)}else{const o=e.y===0?2:3;this.addBorderIntersection(o,t.x),this.addBorderIntersection(o,e.x)}}centroid(){const e=this.polyCount.reduce((t,o)=>t+o.edges,0);return e!==0?this.acc.div(e)._round():new F(0,0)}span(){return new F(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,t)=>e+ +(t[0]!==Number.MAX_VALUE),0)}}class Zu{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new Wt,this.centroidVertexArray=new Fg,this.indexArray=new _i,this.programConfigurations=new qa(e.layers,e.zoom),this.segments=new In,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.enableTerrain=e.enableTerrain}populate(e,t,o,l){this.features=[],this.hasPattern=pm("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(u){const f=Math.exp(Math.PI*(1-u.y/(1<<u.z)*2));return 80150034*f/(f*f+1)/ei/(1<<u.z)}(o),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:u,id:f,index:m,sourceLayerIndex:v}of e){const x=this.layers[0]._featureFilter.needGeometry,S=$a(u,x);if(!this.layers[0]._featureFilter.filter(new W(this.zoom),S,o))continue;const M={id:f,sourceLayerIndex:v,index:m,geometry:x?S.geometry:as(u,o,l),properties:u.properties,type:u.type,patterns:{}},I=this.layoutVertexArray.length;this.hasPattern?this.features.push(mm("fill-extrusion",this.layers,M,this.zoom,t)):this.addFeature(M,M.geometry,m,o,{},t.availableImages,l),t.featureIndex.insert(u,M.geometry,m,v,this.index,I)}this.sortBorders()}addFeatures(e,t,o,l,u){for(const f of this.features){const{geometry:m}=f;this.addFeature(f,m,f.index,t,o,l,u)}this.sortBorders()}update(e,t,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,o,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Zw),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Gw.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,$w.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,o,l,u,f,m){const v=[new F(0,0),new F(ei,ei)],x=m.projection,S=x.name==="globe",M=this.enableTerrain&&!S?new Ay:null,I=Yw[e.type]==="Polygon";S&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Qn);const P=fm(t,500);for(let ee=P.length-1;ee>=0;ee--){const se=P[ee];(se.length===0||(L=se[0]).every(ie=>ie.x<=0)||L.every(ie=>ie.x>=ei)||L.every(ie=>ie.y<=0)||L.every(ie=>ie.y>=ei))&&P.splice(ee,1)}var L;let U;if(S)U=Ly(P,v,l);else{U=[];for(const ee of P)U.push({polygon:ee,bounds:v})}const $=I?this.edgeRadius:0;for(const{polygon:ee,bounds:se}of U){let ie=0,re=0;for(const ae of ee)I&&!ae[0].equals(ae[ae.length-1])&&ae.push(ae[0]),re+=I?ae.length-1:ae.length;const me=this.segments.prepareSegment((I?5:4)*re,this.layoutVertexArray,this.indexArray);if(I){const ae=[],Ve=[];ie=me.vertexLength;for(const We of ee){let yt,je;We.length&&We!==ee[0]&&Ve.push(ae.length/2),yt=We[1].sub(We[0])._perp()._unit();for(let et=1;et<We.length;et++){const at=We[et],tt=We[et===We.length-1?1:et+1];let{x:ft,y:lt}=at;if($){je=tt.sub(at)._perp()._unit();const kt=yt.add(je)._unit(),li=$*Math.min(4,1/(yt.x*kt.x+yt.y*kt.y));ft+=li*kt.x,lt+=li*kt.y,yt=je}$u(this.layoutVertexArray,ft,lt,0,0,1,1,0),me.vertexLength++,ae.push(at.x,at.y),S&&Gu(this.layoutVertexExtArray,x.projectTilePoint(ft,lt,l),x.upVector(l,ft,lt))}}const Fe=Nd(ae,Ve);for(let We=0;We<Fe.length;We+=3)this.indexArray.emplaceBack(ie+Fe[We],ie+Fe[We+2],ie+Fe[We+1]),me.primitiveLength++}for(const ae of ee){M&&ae.length&&M.startRing(ae[0]);let Ve,Fe,We,yt=ae.length>4&&zy(ae[ae.length-2],ae[0],ae[1]),je=$?Qw(ae[ae.length-2],ae[0],ae[1],$):0;Fe=ae[1].sub(ae[0])._perp()._unit();for(let et=1,at=0;et<ae.length;et++){let tt=ae[et-1],ft=ae[et];const lt=ae[et===ae.length-1?1:et+1];if(M&&I&&M.currentPolyCount.top++,ky(ft,tt,se)){$&&(Fe=lt.sub(ft)._perp()._unit());continue}M&&M.append(ft,tt);const kt=ft.sub(tt)._perp(),li=kt.x/(Math.abs(kt.x)+Math.abs(kt.y)),hi=kt.y>0?1:0,Gt=tt.dist(ft);if(at+Gt>32768&&(at=0),$){We=lt.sub(ft)._perp()._unit();let Dt=Iy(tt,ft,lt,My(Fe,We),$);isNaN(Dt)&&(Dt=0);const Yi=ft.sub(tt)._unit();tt=tt.add(Yi.mult(je))._round(),ft=ft.add(Yi.mult(-Dt))._round(),je=Dt,Fe=We}const Tt=me.vertexLength,bi=ae.length>4&&zy(tt,ft,lt);let oi=Py(at,yt,!0);if($u(this.layoutVertexArray,tt.x,tt.y,li,hi,0,0,oi),$u(this.layoutVertexArray,tt.x,tt.y,li,hi,0,1,oi),at+=Gt,oi=Py(at,bi,!1),yt=bi,$u(this.layoutVertexArray,ft.x,ft.y,li,hi,0,0,oi),$u(this.layoutVertexArray,ft.x,ft.y,li,hi,0,1,oi),me.vertexLength+=4,this.indexArray.emplaceBack(Tt+0,Tt+1,Tt+2),this.indexArray.emplaceBack(Tt+1,Tt+3,Tt+2),me.primitiveLength+=2,$){const Dt=ie+(et===1?ae.length-2:et-2),Yi=et===1?ie:Dt+1;if(this.indexArray.emplaceBack(Tt+1,Dt,Tt+3),this.indexArray.emplaceBack(Dt,Yi,Tt+3),me.primitiveLength+=2,Ve===void 0&&(Ve=Tt),!ky(lt,ae[et],se)){const Zi=et===ae.length-1?Ve:me.vertexLength;this.indexArray.emplaceBack(Tt+2,Tt+3,Zi),this.indexArray.emplaceBack(Tt+3,Zi+1,Zi),this.indexArray.emplaceBack(Tt+3,Yi,Zi+1),me.primitiveLength+=3}}if(S){const Dt=this.layoutVertexExtArray,Yi=x.projectTilePoint(tt.x,tt.y,l),Zi=x.projectTilePoint(ft.x,ft.y,l),rn=x.upVector(l,tt.x,tt.y),fi=x.upVector(l,ft.x,ft.y);Gu(Dt,Yi,rn),Gu(Dt,Yi,rn),Gu(Dt,Zi,fi),Gu(Dt,Zi,fi)}}I&&(ie+=ae.length-1)}}if(M&&M.polyCount.length>0){if(M.borders){M.vertexArrayOffset=this.centroidVertexArray.length;const ee=M.borders,se=this.featuresOnBorder.push(M)-1;for(let ie=0;ie<4;ie++)ee[ie][0]!==Number.MAX_VALUE&&this.borders[ie].push(se)}this.encodeCentroid(M.borders?void 0:M.centroid(),M)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,u,f,l)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((t,o)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[o].borders[e][0])}encodeCentroid(e,t,o=!0){let l,u;if(e)if(e.y!==0){const m=t.span()._mult(this.tileToMeter);l=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(m.x/10)),u=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(m.y/10))}else l=Math.ceil(7*(e.x+450)),u=0;else l=0,u=+o;let f=o?this.centroidVertexArray.length:t.vertexArrayOffset;for(const m of t.polyCount){o&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*m.edges+m.top);for(let v=0;v<m.top;v++)this.centroidVertexArray.emplace(f++,l,u);for(let v=0;v<2*m.edges;v++)this.centroidVertexArray.emplace(f++,0,u),this.centroidVertexArray.emplace(f++,l,u)}}}function My(i,e){const t=i.add(e)._unit();return i.x*t.x+i.y*t.y}function Qw(i,e,t,o){const l=e.sub(i)._perp()._unit(),u=t.sub(e)._perp()._unit();return Iy(i,e,t,My(l,u),o)}function Iy(i,e,t,o,l){const u=Math.sqrt(1-o*o);return Math.min(i.dist(e)/3,e.dist(t)/3,l*u/o)}function ky(i,e,t){return i.x<t[0].x&&e.x<t[0].x||i.x>t[1].x&&e.x>t[1].x||i.y<t[0].y&&e.y<t[0].y||i.y>t[1].y&&e.y>t[1].y}function zy(i,e,t){if(i.x<0||i.x>=ei||e.x<0||e.x>=ei||t.x<0||t.x>=ei)return!1;const o=t.sub(e),l=o.perp(),u=i.sub(e);return(o.x*u.x+o.y*u.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(u.x*u.x+u.y*u.y))>-.866&&l.x*u.x+l.y*u.y<0}function Py(i,e,t){const o=e?2|i:-3&i;return t?1|o:-2&o}function Dy(){const i=Math.PI/32,e=Math.tan(i),t=$p;return t*Math.sqrt(1+2*e*e)-t}function Ly(i,e,t){const o=1<<t.z,l=Zr(t.x/o),u=Zr((t.x+1)/o),f=Wn(t.y/o),m=Wn((t.y+1)/o);return function(v,x,S,M,I=0,P){const L=[];if(!v.length||!S||!M)return L;const U=(ae,Ve)=>{for(const Fe of ae)L.push({polygon:Fe,bounds:Ve})},$=Math.ceil(Math.log2(S)),ee=Math.ceil(Math.log2(M)),se=$-ee,ie=[];for(let ae=0;ae<Math.abs(se);ae++)ie.push(se>0?0:1);for(let ae=0;ae<Math.min($,ee);ae++)ie.push(0),ie.push(1);let re=v;if(re=Wd(re,x[0].y-I,x[1].y+I,1),re=Wd(re,x[0].x-I,x[1].x+I,0),!re.length)return L;const me=[];for(ie.length?me.push({polygons:re,bounds:x,depth:0}):U(re,x);me.length;){const ae=me.pop(),Ve=ae.depth,Fe=ie[Ve],We=ae.bounds[0],yt=ae.bounds[1],je=Fe===0?We.x:We.y,et=Fe===0?yt.x:yt.y,at=P?P(Fe,je,et):.5*(je+et),tt=Wd(ae.polygons,je-I,at+I,Fe),ft=Wd(ae.polygons,at-I,et+I,Fe);if(tt.length){const lt=[We,new F(Fe===0?at:yt.x,Fe===1?at:yt.y)];ie.length>Ve+1?me.push({polygons:tt,bounds:lt,depth:Ve+1}):U(tt,lt)}if(ft.length){const lt=[new F(Fe===0?at:We.x,Fe===1?at:We.y),yt];ie.length>Ve+1?me.push({polygons:ft,bounds:lt,depth:Ve+1}):U(ft,lt)}}return L}(i,e,Math.ceil((u-l)/11.25),Math.ceil((f-m)/11.25),1,(v,x,S)=>{if(v===0)return .5*(x+S);{const M=Wn((t.y+x/ei)/o);return(ss(.5*(Wn((t.y+S/ei)/o)+M))*o-t.y)*ei}})}Bt(Zu,"FillExtrusionBucket",{omit:["layers","features"]}),Bt(Ay,"PartMetadata");const eT=new Je({"fill-extrusion-edge-radius":new le(Ce["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var tT={paint:new Je({"fill-extrusion-opacity":new le(Ce["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ve(Ce["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new le(Ce["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new le(Ce["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Be(Ce["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ve(Ce["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ve(Ce["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new le(Ce["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new le(Ce["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new le(Ce["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:eT};function By(i,e,t){var o=2*Math.PI*6378137/256/Math.pow(2,t);return[i*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class Hd{constructor(e,t,o){this.z=e,this.x=t,this.y=o,this.key=Wu(0,e,e,t,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){const o=function(u,f,m){var v=By(256*u,256*(f=Math.pow(2,m)-f-1),m),x=By(256*(u+1),256*(f+1),m);return v[0]+","+v[1]+","+x[0]+","+x[1]}(this.x,this.y,this.z),l=function(u,f,m){let v,x="";for(let S=u;S>0;S--)v=1<<S-1,x+=(f&v?1:0)+(m&v?2:0);return x}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(t==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ry{constructor(e,t){this.wrap=e,this.canonical=t,this.key=Wu(e,t.z,t.z,t.x,t.y)}}class ur{constructor(e,t,o,l,u){this.overscaledZ=e,this.wrap=t,this.canonical=new Hd(o,+l,+u),this.key=t===0&&e===o?this.canonical.key:Wu(t,e,o,l,u)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new ur(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ur(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t=!0){if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return Wu(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const o=this.canonical.z-e;return Wu(this.wrap*+t,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new ur(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,o=2*this.canonical.x,l=2*this.canonical.y;return[new ur(t,this.wrap,t,o,l),new ur(t,this.wrap,t,o+1,l),new ur(t,this.wrap,t,o,l+1),new ur(t,this.wrap,t,o+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ur(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ur(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ry(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Wu(i,e,t,o,l){const u=1<<Math.min(t,22);let f=u*(l%u)+o%u;return i&&t<22&&(f+=u*u*((i<0?-2*i-1:2*i)%(1<<2*(22-t)))),16*(32*f+t)+(e-t)}function Hu(i,e){return i.x*e.x+i.y*e.y}function Fy(i,e){if(i.length===1){let t=0;const o=e[t++];let l;for(;!l||o.equals(l);)if(l=e[t++],!l)return 1/0;for(;t<e.length;t++){const u=e[t],f=i[0],m=l.sub(o),v=u.sub(o),x=f.sub(o),S=Hu(m,m),M=Hu(m,v),I=Hu(v,v),P=Hu(x,m),L=Hu(x,v),U=S*I-M*M,$=(I*P-M*L)/U,ee=(S*L-M*P)/U,se=o.z*(1-$-ee)+l.z*$+u.z*ee;if(isFinite(se))return se}return 1/0}{let t=1/0;for(const o of e)t=Math.min(t,o.z);return t}}function Xd(i){const e=new F(i[0],i[1]);return e.z=i[2],e}function Oy(i,e,t,o,l,u,f,m){const v=f*l.getElevationAt(i,e,!0,!0),x=u[0]!==0,S=x?u[1]===0?f*(u[0]/7-450):f*function(M,I,P){const L=Math.floor(I[0]/8),U=Math.floor(I[1]/8),$=10*(I[0]-8*L),ee=10*(I[1]-8*U),se=M.getElevationAt(L,U,!0,!0),ie=M.getMeterToDEM(P),re=Math.floor(.5*($*ie-1)),me=Math.floor(.5*(ee*ie-1)),ae=M.tileCoordToPixel(L,U),Ve=2*re+1,Fe=2*me+1,We=function(ft,lt,kt,li,hi){return[ft.getElevationAtPixel(lt,kt,!0),ft.getElevationAtPixel(lt+hi,kt,!0),ft.getElevationAtPixel(lt,kt+hi,!0),ft.getElevationAtPixel(lt+li,kt+hi,!0)]}(M,ae.x-re,ae.y-me,Ve,Fe),yt=Math.abs(We[0]-We[1]),je=Math.abs(We[2]-We[3]),et=Math.abs(We[0]-We[2])+Math.abs(We[1]-We[3]),at=Math.min(.25,.5*ie*(yt+je)/Ve),tt=Math.min(.25,.5*ie*et/Fe);return se+Math.max(at*$,tt*ee)}(l,u,m):v;return{base:v+(t===0)?-1:t,top:x?Math.max(S+o,v+t+2):v+o}}Bt(Hd,"CanonicalTileID"),Bt(ur,"OverscaledTileID",{omit:["projMatrix"]});const iT=it([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:nT}=iT,rT=it([{name:"a_packed",components:4,type:"Float32"}]),{members:oT}=rT,sT=Xa.VectorTileFeature.types,aT=Math.cos(Math.PI/180*37.5);class Kd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(t=>{this.gradients[t.id]={}}),this.layoutVertexArray=new ii,this.layoutVertexArray2=new xi,this.indexArray=new _i,this.programConfigurations=new qa(e.layers,e.zoom),this.segments=new In,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(e,t,o,l){this.hasPattern=pm("line",this.layers,t);const u=this.layers[0].layout.get("line-sort-key"),f=[];for(const{feature:S,id:M,index:I,sourceLayerIndex:P}of e){const L=this.layers[0]._featureFilter.needGeometry,U=$a(S,L);if(!this.layers[0]._featureFilter.filter(new W(this.zoom),U,o))continue;const $=u?u.evaluate(U,{},o):void 0,ee={id:M,properties:S.properties,type:S.type,sourceLayerIndex:P,index:I,geometry:L?U.geometry:as(S,o,l),patterns:{},sortKey:$};f.push(ee)}u&&f.sort((S,M)=>S.sortKey-M.sortKey);const{lineAtlas:m,featureIndex:v}=t,x=this.addConstantDashes(m);for(const S of f){const{geometry:M,index:I,sourceLayerIndex:P}=S;if(x&&this.addFeatureDashes(S,m),this.hasPattern){const L=mm("line",this.layers,S,this.zoom,t);this.patternFeatures.push(L)}else this.addFeature(S,M,I,o,m.positions,t.availableImages);v.insert(e[I].feature,M,I,P,this.index)}}addConstantDashes(e){let t=!1;for(const o of this.layers){const l=o.paint.get("line-dasharray").value,u=o.layout.get("line-cap").value;if(l.kind!=="constant"||u.kind!=="constant")t=!0;else{const f=u.value,m=l.value;if(!m)continue;e.addDash(m.from,f),e.addDash(m.to,f),m.other&&e.addDash(m.other,f)}}return t}addFeatureDashes(e,t){const o=this.zoom;for(const l of this.layers){const u=l.paint.get("line-dasharray").value,f=l.layout.get("line-cap").value;if(u.kind==="constant"&&f.kind==="constant")continue;let m,v,x,S,M,I;if(u.kind==="constant"){const $=u.value;if(!$)continue;m=$.other||$.to,v=$.to,x=$.from}else m=u.evaluate({zoom:o-1},e),v=u.evaluate({zoom:o},e),x=u.evaluate({zoom:o+1},e);f.kind==="constant"?S=M=I=f.value:(S=f.evaluate({zoom:o-1},e),M=f.evaluate({zoom:o},e),I=f.evaluate({zoom:o+1},e)),t.addDash(m,S),t.addDash(v,M),t.addDash(x,I);const P=t.getKey(m,S),L=t.getKey(v,M),U=t.getKey(x,I);e.patterns[l.id]={min:P,mid:L,max:U}}}update(e,t,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,o,l)}addFeatures(e,t,o,l,u){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,t,o,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,oT)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,nT),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,o,l,u,f){const m=this.layers[0].layout,v=m.get("line-join").evaluate(e,{}),x=m.get("line-cap").evaluate(e,{}),S=m.get("line-miter-limit"),M=m.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const I of t)this.addLine(I,e,v,x,S,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,u,f,l)}addLine(e,t,o,l,u,f){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ee=0;ee<e.length-1;ee++)this.totalDistance+=e[ee].dist(e[ee+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const m=sT[t.type]==="Polygon";let v=e.length;for(;v>=2&&e[v-1].equals(e[v-2]);)v--;let x=0;for(;x<v-1&&e[x].equals(e[x+1]);)x++;if(v<(m?3:2))return;o==="bevel"&&(u=1.05);const S=this.overscaling<=16?122880/(512*this.overscaling):0,M=this.segments.prepareSegment(10*v,this.layoutVertexArray,this.indexArray);let I,P,L,U,$;this.e1=this.e2=-1,m&&(I=e[v-2],$=e[x].sub(I)._unit()._perp());for(let ee=x;ee<v;ee++){if(L=ee===v-1?m?e[x+1]:void 0:e[ee+1],L&&e[ee].equals(L))continue;$&&(U=$),I&&(P=I),I=e[ee],$=L?L.sub(I)._unit()._perp():U,U=U||$;let se=U.add($);se.x===0&&se.y===0||se._unit();const ie=U.x*$.x+U.y*$.y,re=se.x*$.x+se.y*$.y,me=re!==0?1/re:1/0,ae=2*Math.sqrt(2-2*re),Ve=re<aT&&P&&L,Fe=U.x*$.y-U.y*$.x>0;if(Ve&&ee>x){const je=I.dist(P);if(je>2*S){const et=I.sub(I.sub(P)._mult(S/je)._round());this.updateDistance(P,et),this.addCurrentVertex(et,U,0,0,M),P=et}}const We=P&&L;let yt=We?o:m?"butt":l;if(We&&yt==="round"&&(me<f?yt="miter":me<=2&&(yt="fakeround")),yt==="miter"&&me>u&&(yt="bevel"),yt==="bevel"&&(me>2&&(yt="flipbevel"),me<u&&(yt="miter")),P&&this.updateDistance(P,I),yt==="miter")se._mult(me),this.addCurrentVertex(I,se,0,0,M);else if(yt==="flipbevel"){if(me>100)se=$.mult(-1);else{const je=me*U.add($).mag()/U.sub($).mag();se._perp()._mult(je*(Fe?-1:1))}this.addCurrentVertex(I,se,0,0,M),this.addCurrentVertex(I,se.mult(-1),0,0,M)}else if(yt==="bevel"||yt==="fakeround"){const je=-Math.sqrt(me*me-1),et=Fe?je:0,at=Fe?0:je;if(P&&this.addCurrentVertex(I,U,et,at,M),yt==="fakeround"){const tt=Math.round(180*ae/Math.PI/20);for(let ft=1;ft<tt;ft++){let lt=ft/tt;if(lt!==.5){const li=lt-.5;lt+=lt*li*(lt-1)*((1.0904+ie*(ie*(3.55645-1.43519*ie)-3.2452))*li*li+(.848013+ie*(.215638*ie-1.06021)))}const kt=$.sub(U)._mult(lt)._add(U)._unit()._mult(Fe?-1:1);this.addHalfVertex(I,kt.x,kt.y,!1,Fe,0,M)}}L&&this.addCurrentVertex(I,$,-et,-at,M)}else if(yt==="butt")this.addCurrentVertex(I,se,0,0,M);else if(yt==="square"){const je=P?1:-1;P||this.addCurrentVertex(I,se,je,je,M),this.addCurrentVertex(I,se,0,0,M),P&&this.addCurrentVertex(I,se,je,je,M)}else yt==="round"&&(P&&(this.addCurrentVertex(I,U,0,0,M),this.addCurrentVertex(I,U,1,1,M,!0)),L&&(this.addCurrentVertex(I,$,-1,-1,M,!0),this.addCurrentVertex(I,$,0,0,M)));if(Ve&&ee<v-1){const je=I.dist(L);if(je>2*S){const et=I.add(L.sub(I)._mult(S/je)._round());this.updateDistance(I,et),this.addCurrentVertex(et,$,0,0,M),I=et}}}}addCurrentVertex(e,t,o,l,u,f=!1){const m=t.y*l-t.x,v=-t.y-t.x*l;this.addHalfVertex(e,t.x+t.y*o,t.y-t.x*o,f,!1,o,u),this.addHalfVertex(e,m,v,f,!0,-l,u)}addHalfVertex({x:e,y:t},o,l,u,f,m,v){this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(t<<1)+(f?1:0),Math.round(63*o)+128,Math.round(63*l)+128,1+(m===0?0:m<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const x=v.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,x),v.primitiveLength++),f?this.e2=x:this.e1=x}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}Bt(Kd,"LineBucket",{omit:["layers","patternFeatures"]});const lT=new Je({"line-cap":new ve(Ce.layout_line["line-cap"]),"line-join":new ve(Ce.layout_line["line-join"]),"line-miter-limit":new le(Ce.layout_line["line-miter-limit"]),"line-round-limit":new le(Ce.layout_line["line-round-limit"]),"line-sort-key":new ve(Ce.layout_line["line-sort-key"])});var Vy={paint:new Je({"line-opacity":new ve(Ce.paint_line["line-opacity"]),"line-color":new ve(Ce.paint_line["line-color"]),"line-translate":new le(Ce.paint_line["line-translate"]),"line-translate-anchor":new le(Ce.paint_line["line-translate-anchor"]),"line-width":new ve(Ce.paint_line["line-width"]),"line-gap-width":new ve(Ce.paint_line["line-gap-width"]),"line-offset":new ve(Ce.paint_line["line-offset"]),"line-blur":new ve(Ce.paint_line["line-blur"]),"line-dasharray":new Be(Ce.paint_line["line-dasharray"]),"line-pattern":new Be(Ce.paint_line["line-pattern"]),"line-gradient":new Ae(Ce.paint_line["line-gradient"]),"line-trim-offset":new le(Ce.paint_line["line-trim-offset"])}),layout:lT};const Uy=new class extends ve{possiblyEvaluate(i,e){return e=new W(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,t,o){return e=Ue({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,t,o)}}(Vy.paint.properties["line-width"].specification);function Ny(i,e){return e>0?e+2*i:i}Uy.useIntegerZoom=!0;const cT=it([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),uT=it([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),hT=it([{name:"a_projected_pos",components:4,type:"Float32"}],4);it([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const dT=it([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),fT=it([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);it([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const jy=it([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),pT=it([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);it([{name:"triangle",components:3,type:"Uint16"}]),it([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),it([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),it([{type:"Float32",name:"offsetX"}]),it([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Hn=24;const Ro=128;function _m(i,e){const{expression:t}=e;if(t.kind==="constant")return{kind:"constant",layoutSize:t.evaluate(new W(i+1))};if(t.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:l}=t;let u=0;for(;u<o.length&&o[u]<=i;)u++;u=Math.max(0,u-1);let f=u;for(;f<o.length&&o[f]<i+1;)f++;f=Math.min(o.length-1,f);const m=o[u],v=o[f];return t.kind==="composite"?{kind:"composite",minZoom:m,maxZoom:v,interpolationType:l}:{kind:"camera",minZoom:m,maxZoom:v,minSize:t.evaluate(new W(m)),maxSize:t.evaluate(new W(v)),interpolationType:l}}}function Yd(i,{uSize:e,uSizeT:t},{lowerSize:o,upperSize:l}){return i.kind==="source"?o/Ro:i.kind==="composite"?Mi(o/Ro,l/Ro,t):e}function nc(i,e){let t=0,o=0;if(i.kind==="constant")o=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:l,minZoom:u,maxZoom:f}=i,m=l?Te($r.interpolationFactor(l,e,u,f),0,1):0;i.kind==="camera"?o=Mi(i.minSize,i.maxSize,m):t=m}return{uSizeT:t,uSize:o}}var mT=Object.freeze({__proto__:null,getSizeData:_m,evaluateSizeForFeature:Yd,evaluateSizeForZoom:nc,SIZE_PACK_FACTOR:Ro});function _T(i,e,t){return i.sections.forEach(o=>{o.text=function(l,u,f){const m=u.layout.get("text-transform").evaluate(f,{});return m==="uppercase"?l=l.toLocaleUpperCase():m==="lowercase"&&(l=l.toLocaleLowerCase()),Z.applyArabicShaping&&(l=Z.applyArabicShaping(l)),l}(o.text,e,t)}),i}const Xu={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function gT(i){return i==="\uFE36"||i==="\uFE48"||i==="\uFE38"||i==="\uFE44"||i==="\uFE42"||i==="\uFE3E"||i==="\uFE3C"||i==="\uFE3A"||i==="\uFE18"||i==="\uFE40"||i==="\uFE10"||i==="\uFE13"||i==="\uFE14"||i==="\uFF40"||i==="\uFFE3"||i==="\uFE11"||i==="\uFE12"}function yT(i){return i==="\uFE35"||i==="\uFE47"||i==="\uFE37"||i==="\uFE43"||i==="\uFE41"||i==="\uFE3D"||i==="\uFE3B"||i==="\uFE39"||i==="\uFE17"||i==="\uFE3F"}var qy=function(i,e,t,o,l){var u,f,m=8*l-o-1,v=(1<<m)-1,x=v>>1,S=-7,M=t?l-1:0,I=t?-1:1,P=i[e+M];for(M+=I,u=P&(1<<-S)-1,P>>=-S,S+=m;S>0;u=256*u+i[e+M],M+=I,S-=8);for(f=u&(1<<-S)-1,u>>=-S,S+=o;S>0;f=256*f+i[e+M],M+=I,S-=8);if(u===0)u=1-x;else{if(u===v)return f?NaN:1/0*(P?-1:1);f+=Math.pow(2,o),u-=x}return(P?-1:1)*f*Math.pow(2,u-o)},$y=function(i,e,t,o,l,u){var f,m,v,x=8*u-l-1,S=(1<<x)-1,M=S>>1,I=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,P=o?0:u-1,L=o?1:-1,U=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(m=isNaN(e)?1:0,f=S):(f=Math.floor(Math.log(e)/Math.LN2),e*(v=Math.pow(2,-f))<1&&(f--,v*=2),(e+=f+M>=1?I/v:I*Math.pow(2,1-M))*v>=2&&(f++,v/=2),f+M>=S?(m=0,f=S):f+M>=1?(m=(e*v-1)*Math.pow(2,l),f+=M):(m=e*Math.pow(2,M-1)*Math.pow(2,l),f=0));l>=8;i[t+P]=255&m,P+=L,m/=256,l-=8);for(f=f<<l|m,x+=l;x>0;i[t+P]=255&f,P+=L,f/=256,x-=8);i[t+P-L]|=128*U},Ku=Ki;function Ki(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Ki.Varint=0,Ki.Fixed64=1,Ki.Bytes=2,Ki.Fixed32=5;var gm=4294967296,Gy=1/gm,Zy=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function cs(i){return i.type===Ki.Bytes?i.readVarint()+i.pos:i.pos+1}function rc(i,e,t){return t?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Wy(i,e,t){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));t.realloc(o);for(var l=t.pos-1;l>=i;l--)t.buf[l+o]=t.buf[l]}function vT(i,e){for(var t=0;t<i.length;t++)e.writeVarint(i[t])}function xT(i,e){for(var t=0;t<i.length;t++)e.writeSVarint(i[t])}function bT(i,e){for(var t=0;t<i.length;t++)e.writeFloat(i[t])}function wT(i,e){for(var t=0;t<i.length;t++)e.writeDouble(i[t])}function TT(i,e){for(var t=0;t<i.length;t++)e.writeBoolean(i[t])}function ET(i,e){for(var t=0;t<i.length;t++)e.writeFixed32(i[t])}function ST(i,e){for(var t=0;t<i.length;t++)e.writeSFixed32(i[t])}function CT(i,e){for(var t=0;t<i.length;t++)e.writeFixed64(i[t])}function AT(i,e){for(var t=0;t<i.length;t++)e.writeSFixed64(i[t])}function Jd(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function oc(i,e,t){i[t]=e,i[t+1]=e>>>8,i[t+2]=e>>>16,i[t+3]=e>>>24}function Hy(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function MT(i,e,t){e.glyphs=[],i===1&&t.readMessage(IT,e)}function IT(i,e,t){if(i===3){const{id:o,bitmap:l,width:u,height:f,left:m,top:v,advance:x}=t.readMessage(kT,{});e.glyphs.push({id:o,bitmap:new ls({width:u+6,height:f+6},l),metrics:{width:u,height:f,left:m,top:v,advance:x}})}else i===4?e.ascender=t.readSVarint():i===5&&(e.descender=t.readSVarint())}function kT(i,e,t){i===1?e.id=t.readVarint():i===2?e.bitmap=t.readBytes():i===3?e.width=t.readVarint():i===4?e.height=t.readVarint():i===5?e.left=t.readSVarint():i===6?e.top=t.readSVarint():i===7&&(e.advance=t.readVarint())}function ym(i){let e=0,t=0;for(const f of i)e+=f.w*f.h,t=Math.max(t,f.w);i.sort((f,m)=>m.h-f.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),t),h:1/0}];let l=0,u=0;for(const f of i)for(let m=o.length-1;m>=0;m--){const v=o[m];if(!(f.w>v.w||f.h>v.h)){if(f.x=v.x,f.y=v.y,u=Math.max(u,f.y+f.h),l=Math.max(l,f.x+f.w),f.w===v.w&&f.h===v.h){const x=o.pop();m<o.length&&(o[m]=x)}else f.h===v.h?(v.x+=f.w,v.w-=f.w):f.w===v.w?(v.y+=f.h,v.h-=f.h):(o.push({x:v.x+f.w,y:v.y,w:v.w-f.w,h:f.h}),v.y+=f.h,v.h-=f.h);break}}return{w:l,h:u,fill:e/(l*u)||0}}Ki.prototype={destroy:function(){this.buf=null},readFields:function(i,e,t){for(t=t||this.length;this.pos<t;){var o=this.readVarint(),l=o>>3,u=this.pos;this.type=7&o,i(l,e,this),this.pos===u&&this.skip(o)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=Jd(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Hy(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Jd(this.buf,this.pos)+Jd(this.buf,this.pos+4)*gm;return this.pos+=8,i},readSFixed64:function(){var i=Jd(this.buf,this.pos)+Hy(this.buf,this.pos+4)*gm;return this.pos+=8,i},readFloat:function(){var i=qy(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=qy(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,t,o=this.buf;return e=127&(t=o[this.pos++]),t<128?e:(e|=(127&(t=o[this.pos++]))<<7,t<128?e:(e|=(127&(t=o[this.pos++]))<<14,t<128?e:(e|=(127&(t=o[this.pos++]))<<21,t<128?e:function(l,u,f){var m,v,x=f.buf;if(m=(112&(v=x[f.pos++]))>>4,v<128||(m|=(127&(v=x[f.pos++]))<<3,v<128)||(m|=(127&(v=x[f.pos++]))<<10,v<128)||(m|=(127&(v=x[f.pos++]))<<17,v<128)||(m|=(127&(v=x[f.pos++]))<<24,v<128)||(m|=(1&(v=x[f.pos++]))<<31,v<128))return rc(l,m,u);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(t=o[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&Zy?function(t,o,l){return Zy.decode(t.subarray(o,l))}(this.buf,e,i):function(t,o,l){for(var u="",f=o;f<l;){var m,v,x,S=t[f],M=null,I=S>239?4:S>223?3:S>191?2:1;if(f+I>l)break;I===1?S<128&&(M=S):I===2?(192&(m=t[f+1]))==128&&(M=(31&S)<<6|63&m)<=127&&(M=null):I===3?(v=t[f+2],(192&(m=t[f+1]))==128&&(192&v)==128&&((M=(15&S)<<12|(63&m)<<6|63&v)<=2047||M>=55296&&M<=57343)&&(M=null)):I===4&&(v=t[f+2],x=t[f+3],(192&(m=t[f+1]))==128&&(192&v)==128&&(192&x)==128&&((M=(15&S)<<18|(63&m)<<12|(63&v)<<6|63&x)<=65535||M>=1114112)&&(M=null)),M===null?(M=65533,I=1):M>65535&&(M-=65536,u+=String.fromCharCode(M>>>10&1023|55296),M=56320|1023&M),u+=String.fromCharCode(M),f+=I}return u}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Ki.Bytes)return i.push(this.readVarint(e));var t=cs(this);for(i=i||[];this.pos<t;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Ki.Bytes)return i.push(this.readSVarint());var e=cs(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Ki.Bytes)return i.push(this.readBoolean());var e=cs(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Ki.Bytes)return i.push(this.readFloat());var e=cs(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Ki.Bytes)return i.push(this.readDouble());var e=cs(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Ki.Bytes)return i.push(this.readFixed32());var e=cs(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Ki.Bytes)return i.push(this.readSFixed32());var e=cs(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Ki.Bytes)return i.push(this.readFixed64());var e=cs(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Ki.Bytes)return i.push(this.readSFixed64());var e=cs(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Ki.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ki.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ki.Fixed32)this.pos+=4;else{if(e!==Ki.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var t=new Uint8Array(e);t.set(this.buf),this.buf=t,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),oc(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),oc(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),oc(this.buf,-1&i,this.pos),oc(this.buf,Math.floor(i*Gy),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),oc(this.buf,-1&i,this.pos),oc(this.buf,Math.floor(i*Gy),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,t){var o,l;if(e>=0?(o=e%4294967296|0,l=e/4294967296|0):(l=~(-e/4294967296),4294967295^(o=~(-e%4294967296))?o=o+1|0:(o=0,l=l+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(u,f,m){m.buf[m.pos++]=127&u|128,u>>>=7,m.buf[m.pos++]=127&u|128,u>>>=7,m.buf[m.pos++]=127&u|128,u>>>=7,m.buf[m.pos++]=127&u|128,m.buf[m.pos]=127&(u>>>=7)}(o,0,t),function(u,f){var m=(7&u)<<4;f.buf[f.pos++]|=m|((u>>>=3)?128:0),u&&(f.buf[f.pos++]=127&u|((u>>>=7)?128:0),u&&(f.buf[f.pos++]=127&u|((u>>>=7)?128:0),u&&(f.buf[f.pos++]=127&u|((u>>>=7)?128:0),u&&(f.buf[f.pos++]=127&u|((u>>>=7)?128:0),u&&(f.buf[f.pos++]=127&u)))))}(l,t)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(o,l,u){for(var f,m,v=0;v<l.length;v++){if((f=l.charCodeAt(v))>55295&&f<57344){if(!m){f>56319||v+1===l.length?(o[u++]=239,o[u++]=191,o[u++]=189):m=f;continue}if(f<56320){o[u++]=239,o[u++]=191,o[u++]=189,m=f;continue}f=m-55296<<10|f-56320|65536,m=null}else m&&(o[u++]=239,o[u++]=191,o[u++]=189,m=null);f<128?o[u++]=f:(f<2048?o[u++]=f>>6|192:(f<65536?o[u++]=f>>12|224:(o[u++]=f>>18|240,o[u++]=f>>12&63|128),o[u++]=f>>6&63|128),o[u++]=63&f|128)}return u}(this.buf,i,this.pos);var t=this.pos-e;t>=128&&Wy(e,t,this),this.pos=e-1,this.writeVarint(t),this.pos+=t},writeFloat:function(i){this.realloc(4),$y(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),$y(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var t=0;t<e;t++)this.buf[this.pos++]=i[t]},writeRawMessage:function(i,e){this.pos++;var t=this.pos;i(e,this);var o=this.pos-t;o>=128&&Wy(t,o,this),this.pos=t-1,this.writeVarint(o),this.pos+=o},writeMessage:function(i,e,t){this.writeTag(i,Ki.Bytes),this.writeRawMessage(e,t)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,vT,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,xT,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,TT,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,bT,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,wT,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,ET,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,ST,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,CT,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,AT,e)},writeBytesField:function(i,e){this.writeTag(i,Ki.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Ki.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Ki.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Ki.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Ki.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Ki.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Ki.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Ki.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Ki.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Ki.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,Boolean(e))}};class vm{constructor(e,{pixelRatio:t,version:o,stretchX:l,stretchY:u,content:f}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=l,this.stretchY=u,this.content=f,this.version=o}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Xy{constructor(e,t){const o={},l={};this.haveRenderCallbacks=[];const u=[];this.addImages(e,o,u),this.addImages(t,l,u);const{w:f,h:m}=ym(u),v=new Ir({width:f||1,height:m||1});for(const x in e){const S=e[x],M=o[x].paddedRect;Ir.copy(S.data,v,{x:0,y:0},{x:M.x+1,y:M.y+1},S.data)}for(const x in t){const S=t[x],M=l[x].paddedRect,I=M.x+1,P=M.y+1,L=S.data.width,U=S.data.height;Ir.copy(S.data,v,{x:0,y:0},{x:I,y:P},S.data),Ir.copy(S.data,v,{x:0,y:U-1},{x:I,y:P-1},{width:L,height:1}),Ir.copy(S.data,v,{x:0,y:0},{x:I,y:P+U},{width:L,height:1}),Ir.copy(S.data,v,{x:L-1,y:0},{x:I-1,y:P},{width:1,height:U}),Ir.copy(S.data,v,{x:0,y:0},{x:I+L,y:P},{width:1,height:U})}this.image=v,this.iconPositions=o,this.patternPositions=l}addImages(e,t,o){for(const l in e){const u=e[l],f={x:0,y:0,w:u.data.width+2,h:u.data.height+2};o.push(f),t[l]=new vm(f,u),u.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(e,t){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(o=>e.hasImage(o)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),t),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),t)}patchUpdatedImage(e,t,o){if(!e||!t||e.version===t.version)return;e.version=t.version;const[l,u]=e.tl;o.update(t.data,void 0,{x:l,y:u})}}Bt(vm,"ImagePosition"),Bt(Xy,"ImageAtlas");const Ur={horizontal:1,vertical:2,horizontalOnly:3};class Yu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const o=new Yu;return o.scale=e||1,o.fontStack=t,o}static forImage(e){const t=new Yu;return t.imageName=e,t}}class sc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const o=new sc;for(let l=0;l<e.sections.length;l++){const u=e.sections[l];u.image?o.addImageSection(u):o.addTextSection(u,t)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(t,o){let l="";for(let u=0;u<t.length;u++){const f=t.charCodeAt(u+1)||null,m=t.charCodeAt(u-1)||null;l+=!o&&(f&&Na(f)&&!Xu[t[u+1]]||m&&Na(m)&&!Xu[t[u-1]])||!Xu[t[u]]?t[u]:Xu[t[u]]}return l}(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&Qd[this.text.charCodeAt(o)];o++)e++;let t=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&Qd[this.text.charCodeAt(o)];o--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const o=new sc;return o.text=this.text.substring(e,t),o.sectionIndex=this.sectionIndex.slice(e,t),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,t)=>Math.max(e,this.sections[t].scale),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(Yu.forText(e.scale,e.fontStack||t));const o=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(o)}addImageSection(e){const t=e.image?e.image.name:"";if(t.length===0)return void xt("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(Yu.forImage(t)),this.sectionIndex.push(this.sections.length-1)):xt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function xm(i,e,t,o,l,u,f,m,v,x,S,M,I,P,L,U){const $=sc.fromFeature(i,l);let ee;M===Ur.vertical&&$.verticalizePunctuation(I);const{processBidirectionalText:se,processStyledBidirectionalText:ie}=Z;if(se&&$.sections.length===1){ee=[];const ae=se($.toString(),bm($,x,u,e,o,P,L));for(const Ve of ae){const Fe=new sc;Fe.text=Ve,Fe.sections=$.sections;for(let We=0;We<Ve.length;We++)Fe.sectionIndex.push(0);ee.push(Fe)}}else if(ie){ee=[];const ae=ie($.text,$.sectionIndex,bm($,x,u,e,o,P,L));for(const Ve of ae){const Fe=new sc;Fe.text=Ve[0],Fe.sectionIndex=Ve[1],Fe.sections=$.sections,ee.push(Fe)}}else ee=function(ae,Ve){const Fe=[],We=ae.text;let yt=0;for(const je of Ve)Fe.push(ae.substring(yt,je)),yt=je;return yt<We.length&&Fe.push(ae.substring(yt,We.length)),Fe}($,bm($,x,u,e,o,P,L));const re=[],me={positionedLines:re,text:$.toString(),top:S[1],bottom:S[1],left:S[0],right:S[0],writingMode:M,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ae,Ve,Fe,We,yt,je,et,at,tt,ft,lt,kt){let li=0,hi=0,Gt=0;const Tt=at==="right"?1:at==="left"?0:.5;let bi=!1;for(const fi of yt){const ki=fi.getSections();for(const Ji of ki){if(Ji.imageName)continue;const Wi=Ve[Ji.fontStack];if(Wi&&(bi=Wi.ascender!==void 0&&Wi.descender!==void 0,!bi))break}if(!bi)break}let oi=0;for(const fi of yt){fi.trim();const ki=fi.getMaxScale(),Ji=(ki-1)*Hn,Wi={positionedGlyphs:[],lineOffset:0};ae.positionedLines[oi]=Wi;const qi=Wi.positionedGlyphs;let tn=0;if(!fi.length()){hi+=je,++oi;continue}let an=0,On=0;for(let Ti=0;Ti<fi.length();Ti++){const mn=fi.getSection(Ti),er=fi.getSectionIndex(Ti),Fi=fi.getCharCode(Ti);let ln=mn.scale,hr=null,on=null,vn=null,Vn=Hn,Ln=0;const Xn=!(tt===Ur.horizontal||!lt&&!Xl(Fi)||lt&&(Qd[Fi]||(Dt=Fi,vd(Dt)||xd(Dt)||bd(Dt)||Ua(Dt)||Du(Dt))));if(mn.imageName){const dr=We[mn.imageName];if(!dr)continue;vn=mn.imageName,ae.iconsInText=ae.iconsInText||!0,on=dr.paddedRect;const Un=dr.displaySize;ln=ln*Hn/kt,hr={width:Un[0],height:Un[1],left:1,top:-3,advance:Xn?Un[1]:Un[0],localGlyph:!1},Ln=bi?-hr.height*ln:ki*Hn-17-Un[1]*ln,Vn=hr.advance;const ds=(Xn?Un[0]:Un[1])*ln-Hn*ki;ds>0&&ds>tn&&(tn=ds)}else{const dr=Fe[mn.fontStack];if(!dr)continue;dr[Fi]&&(on=dr[Fi]);const Un=Ve[mn.fontStack];if(!Un)continue;const ds=Un.glyphs[Fi];if(!ds)continue;if(hr=ds.metrics,Vn=Fi!==8203?Hn:0,bi){const fc=Un.ascender!==void 0?Math.abs(Un.ascender):0,ch=Un.descender!==void 0?Math.abs(Un.descender):0,uh=(fc+ch)*ln;an<uh&&(an=uh,On=(fc-ch)/2*ln),Ln=-fc*ln}else Ln=(ki-ln)*Hn-17}Xn?(ae.verticalizable=!0,qi.push({glyph:Fi,imageName:vn,x:li,y:hi+Ln,vertical:Xn,scale:ln,localGlyph:hr.localGlyph,fontStack:mn.fontStack,sectionIndex:er,metrics:hr,rect:on}),li+=Vn*ln+ft):(qi.push({glyph:Fi,imageName:vn,x:li,y:hi+Ln,vertical:Xn,scale:ln,localGlyph:hr.localGlyph,fontStack:mn.fontStack,sectionIndex:er,metrics:hr,rect:on}),li+=hr.advance*ln+ft)}qi.length!==0&&(Gt=Math.max(li-ft,Gt),bi?ev(qi,Tt,tn,On,je*ki/2):ev(qi,Tt,tn,0,je/2)),li=0;const xr=je*ki+tn;Wi.lineOffset=Math.max(tn,Ji),hi+=xr,++oi}var Dt;const Yi=hi,{horizontalAlign:Zi,verticalAlign:rn}=wm(et);(function(fi,ki,Ji,Wi,qi,tn){const an=(ki-Ji)*qi,On=-tn*Wi;for(const xr of fi)for(const Ti of xr.positionedGlyphs)Ti.x+=an,Ti.y+=On})(ae.positionedLines,Tt,Zi,rn,Gt,Yi),ae.top+=-rn*Yi,ae.bottom=ae.top+Yi,ae.left+=-Zi*Gt,ae.right=ae.left+Gt,ae.hasBaseline=bi}(me,e,t,o,ee,f,m,v,M,x,I,U),!function(ae){for(const Ve of ae)if(Ve.positionedGlyphs.length!==0)return!1;return!0}(re)&&me}const Qd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},zT={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ky(i,e,t,o,l,u){if(e.imageName){const f=o[e.imageName];return f?f.displaySize[0]*e.scale*Hn/u+l:0}{const f=t[e.fontStack],m=f&&f.glyphs[i];return m?m.metrics.advance*e.scale+l:0}}function Yy(i,e,t,o){const l=Math.pow(i-e,2);return o?i<e?l/2:2*l:l+Math.abs(t)*t}function PT(i,e,t){let o=0;return i===10&&(o-=1e4),t&&(o+=150),i!==40&&i!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function Jy(i,e,t,o,l,u){let f=null,m=Yy(e,t,l,u);for(const v of o){const x=Yy(e-v.x,t,l,u)+v.badness;x<=m&&(f=v,m=x)}return{index:i,x:e,priorBreak:f,badness:m}}function Qy(i){return i?Qy(i.priorBreak).concat(i.index):[]}function bm(i,e,t,o,l,u,f){if(u!=="point")return[];if(!i)return[];const m=[],v=function(I,P,L,U,$,ee){let se=0;for(let ie=0;ie<I.length();ie++){const re=I.getSection(ie);se+=Ky(I.getCharCode(ie),re,U,$,P,ee)}return se/Math.max(1,Math.ceil(se/L))}(i,e,t,o,l,f),x=i.text.indexOf("\u200B")>=0;let S=0;for(let I=0;I<i.length();I++){const P=i.getSection(I),L=i.getCharCode(I);if(Qd[L]||(S+=Ky(L,P,o,l,e,f)),I<i.length()-1){const U=!((M=L)<11904||!(Au(M)||Ed(M)||Pu(M)||Md(M)||ku(M)||wd(M)||Sd(M)||Zl(M)||zu(M)||Va(M)||Iu(M)||Lu(M)||Cu(M)||Oa(M)||Td(M)||Mu(M)||Jo(M)||Id(M)||Cd(M)||Wl(M)));(zT[L]||U||P.imageName)&&m.push(Jy(I+1,S,v,m,PT(L,i.getCharCode(I+1),U&&x),!1))}}var M;return Qy(Jy(i.length(),S,v,m,0,!0))}function wm(i){let e=.5,t=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":t=1;break;case"top":case"top-right":case"top-left":t=0}return{horizontalAlign:e,verticalAlign:t}}function ev(i,e,t,o,l){if(!(e||t||o||l))return;const u=i.length-1,f=i[u],m=(f.x+f.metrics.advance*f.scale)*e;for(let v=0;v<=u;v++)i[v].x-=m,i[v].y+=t+o+l}function DT(i,e,t){const{horizontalAlign:o,verticalAlign:l}=wm(t),u=e[0]-i.displaySize[0]*o,f=e[1]-i.displaySize[1]*l;return{image:i,top:f,bottom:f+i.displaySize[1],left:u,right:u+i.displaySize[0]}}function tv(i,e,t,o,l,u){const f=i.image;let m;if(f.content){const $=f.content,ee=f.pixelRatio||1;m=[$[0]/ee,$[1]/ee,f.displaySize[0]-$[2]/ee,f.displaySize[1]-$[3]/ee]}const v=e.left*u,x=e.right*u;let S,M,I,P;t==="width"||t==="both"?(P=l[0]+v-o[3],M=l[0]+x+o[1]):(P=l[0]+(v+x-f.displaySize[0])/2,M=P+f.displaySize[0]);const L=e.top*u,U=e.bottom*u;return t==="height"||t==="both"?(S=l[1]+L-o[0],I=l[1]+U+o[2]):(S=l[1]+(L+U-f.displaySize[1])/2,I=S+f.displaySize[1]),{image:f,top:S,right:M,bottom:I,left:P,collisionPadding:m}}class us extends F{constructor(e,t,o,l,u){super(e,t),this.angle=l,this.z=o,u!==void 0&&(this.segment=u)}clone(){return new us(this.x,this.y,this.z,this.angle,this.segment)}}function iv(i,e,t,o,l){if(e.segment===void 0)return!0;let u=e,f=e.segment+1,m=0;for(;m>-t/2;){if(f--,f<0)return!1;m-=i[f].dist(u),u=i[f]}m+=i[f].dist(i[f+1]),f++;const v=[];let x=0;for(;m<t/2;){const S=i[f],M=i[f+1];if(!M)return!1;let I=i[f-1].angleTo(S)-S.angleTo(M);for(I=Math.abs((I+3*Math.PI)%(2*Math.PI)-Math.PI),v.push({distance:m,angleDelta:I}),x+=I;m-v[0].distance>o;)x-=v.shift().angleDelta;if(x>l)return!1;f++,m+=S.dist(M)}return!0}function nv(i){let e=0;for(let t=0;t<i.length-1;t++)e+=i[t].dist(i[t+1]);return e}function rv(i,e,t){return i?.6*e*t:0}function ov(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function LT(i,e,t,o,l,u){const f=rv(t,l,u),m=ov(t,o)*u;let v=0;const x=nv(i)/2;for(let S=0;S<i.length-1;S++){const M=i[S],I=i[S+1],P=M.dist(I);if(v+P>x){const L=(x-v)/P,U=Mi(M.x,I.x,L),$=Mi(M.y,I.y,L),ee=new us(U,$,0,I.angleTo(M),S);return!f||iv(i,ee,m,f,e)?ee:void 0}v+=P}}function BT(i,e,t,o,l,u,f,m,v){const x=rv(o,u,f),S=ov(o,l),M=S*f,I=i[0].x===0||i[0].x===v||i[0].y===0||i[0].y===v;return e-M<e/4&&(e=M+e/4),sv(i,I?e/2*m%e:(S/2+2*u)*f*m%e,e,x,t,M,I,!1,v)}function sv(i,e,t,o,l,u,f,m,v){const x=u/2,S=nv(i);let M=0,I=e-t,P=[];for(let L=0;L<i.length-1;L++){const U=i[L],$=i[L+1],ee=U.dist($),se=$.angleTo(U);for(;I+t<M+ee;){I+=t;const ie=(I-M)/ee,re=Mi(U.x,$.x,ie),me=Mi(U.y,$.y,ie);if(re>=0&&re<v&&me>=0&&me<v&&I-x>=0&&I+x<=S){const ae=new us(re,me,0,se,L);ae._round(),o&&!iv(i,ae,u,o,l)||P.push(ae)}}M+=ee}return m||P.length||f||(P=sv(i,M/2,t,o,l,u,f,!0,v)),P}function av(i,e,t,o,l){const u=[];for(let f=0;f<i.length;f++){const m=i[f];let v;for(let x=0;x<m.length-1;x++){let S=m[x],M=m[x+1];S.x<e&&M.x<e||(S.x<e?S=new F(e,S.y+(e-S.x)/(M.x-S.x)*(M.y-S.y))._round():M.x<e&&(M=new F(e,S.y+(e-S.x)/(M.x-S.x)*(M.y-S.y))._round()),S.y<t&&M.y<t||(S.y<t?S=new F(S.x+(t-S.y)/(M.y-S.y)*(M.x-S.x),t)._round():M.y<t&&(M=new F(S.x+(t-S.y)/(M.y-S.y)*(M.x-S.x),t)._round()),S.x>=o&&M.x>=o||(S.x>=o?S=new F(o,S.y+(o-S.x)/(M.x-S.x)*(M.y-S.y))._round():M.x>=o&&(M=new F(o,S.y+(o-S.x)/(M.x-S.x)*(M.y-S.y))._round()),S.y>=l&&M.y>=l||(S.y>=l?S=new F(S.x+(l-S.y)/(M.y-S.y)*(M.x-S.x),l)._round():M.y>=l&&(M=new F(S.x+(l-S.y)/(M.y-S.y)*(M.x-S.x),l)._round()),v&&S.equals(v[v.length-1])||(v=[S],u.push(v)),v.push(M)))))}}return u}Bt(us,"Anchor");const Ju=1e20;function lv(i,e,t,o,l,u,f,m,v){for(let x=e;x<e+o;x++)cv(i,t*u+x,u,l,f,m,v);for(let x=t;x<t+l;x++)cv(i,x*u+e,1,o,f,m,v)}function cv(i,e,t,o,l,u,f){u[0]=0,f[0]=-Ju,f[1]=Ju,l[0]=i[e];for(let m=1,v=0,x=0;m<o;m++){l[m]=i[e+m*t];const S=m*m;do{const M=u[v];x=(l[m]-l[M]+S-M*M)/(m-M)/2}while(x<=f[v]&&--v>-1);v++,u[v]=m,f[v]=x,f[v+1]=Ju}for(let m=0,v=0;m<o;m++){for(;f[v+1]<m;)v++;const x=u[v],S=m-x;i[e+m*t]=l[x]+S*S}}const Tm={none:0,ideographs:1,all:2};class ac{constructor(e,t,o){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=o,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,t){const o=[];for(const l in e)for(const u of e[l])o.push({stack:l,id:u});De(o,({stack:l,id:u},f)=>{let m=this.entries[l];m||(m=this.entries[l]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let v=m.glyphs[u];if(v!==void 0)return void f(null,{stack:l,id:u,glyph:v});if(v=this._tinySDF(m,l,u),v)return m.glyphs[u]=v,void f(null,{stack:l,id:u,glyph:v});const x=Math.floor(u/256);if(256*x>65535)return void f(new Error("glyphs > 65535 not supported"));if(m.ranges[x])return void f(null,{stack:l,id:u,glyph:v});let S=m.requests[x];S||(S=m.requests[x]=[],ac.loadGlyphRange(l,x,this.url,this.requestManager,(M,I)=>{if(I){m.ascender=I.ascender,m.descender=I.descender;for(const P in I.glyphs)this._doesCharSupportLocalGlyph(+P)||(m.glyphs[+P]=I.glyphs[+P]);m.ranges[x]=!0}for(const P of S)P(M,I);delete m.requests[x]})),S.push((M,I)=>{M?f(M):I&&f(null,{stack:l,id:u,glyph:I.glyphs[u]||null})})},(l,u)=>{if(l)t(l);else if(u){const f={};for(const{stack:m,id:v,glyph:x}of u)f[m]===void 0&&(f[m]={}),f[m].glyphs===void 0&&(f[m].glyphs={}),f[m].glyphs[v]=x&&{id:x.id,bitmap:x.bitmap.clone(),metrics:x.metrics},f[m].ascender=this.entries[m].ascender,f[m].descender=this.entries[m].descender;t(null,f)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Tm.none&&(this.localGlyphMode===Tm.all?!!this.localFontFamily:!!this.localFontFamily&&(Va(e)||Ad(e)||Cu(e)||Jo(e)||Zl(e)))}_tinySDF(e,t,o){const l=this.localFontFamily;if(!l||!this._doesCharSupportLocalGlyph(o))return;let u=e.tinySDF;if(!u){let U="400";/bold/i.test(t)?U="900":/medium/i.test(t)?U="500":/light/i.test(t)&&(U="200"),u=e.tinySDF=new ac.TinySDF({fontFamily:l,fontWeight:U,fontSize:48,buffer:6,radius:16}),u.fontWeight=U}if(this.localGlyphs[u.fontWeight][o])return this.localGlyphs[u.fontWeight][o];const f=String.fromCharCode(o),{data:m,width:v,height:x,glyphWidth:S,glyphHeight:M,glyphLeft:I,glyphTop:P,glyphAdvance:L}=u.draw(f);return this.localGlyphs[u.fontWeight][o]={id:o,bitmap:new ls({width:v,height:x},m),metrics:{width:S/2,height:M/2,left:I/2,top:P/2-27,advance:L/2,localGlyph:!0}}}}function uv(i,e,t,o){const l=[],u=i.image,f=u.pixelRatio,m=u.paddedRect.w-2,v=u.paddedRect.h-2,x=i.right-i.left,S=i.bottom-i.top,M=u.stretchX||[[0,m]],I=u.stretchY||[[0,v]],P=(je,et)=>je+et[1]-et[0],L=M.reduce(P,0),U=I.reduce(P,0),$=m-L,ee=v-U;let se=0,ie=L,re=0,me=U,ae=0,Ve=$,Fe=0,We=ee;if(u.content&&o){const je=u.content;se=ef(M,0,je[0]),re=ef(I,0,je[1]),ie=ef(M,je[0],je[2]),me=ef(I,je[1],je[3]),ae=je[0]-se,Fe=je[1]-re,Ve=je[2]-je[0]-ie,We=je[3]-je[1]-me}const yt=(je,et,at,tt)=>{const ft=tf(je.stretch-se,ie,x,i.left),lt=nf(je.fixed-ae,Ve,je.stretch,L),kt=tf(et.stretch-re,me,S,i.top),li=nf(et.fixed-Fe,We,et.stretch,U),hi=tf(at.stretch-se,ie,x,i.left),Gt=nf(at.fixed-ae,Ve,at.stretch,L),Tt=tf(tt.stretch-re,me,S,i.top),bi=nf(tt.fixed-Fe,We,tt.stretch,U),oi=new F(ft,kt),Dt=new F(hi,kt),Yi=new F(hi,Tt),Zi=new F(ft,Tt),rn=new F(lt/f,li/f),fi=new F(Gt/f,bi/f),ki=e*Math.PI/180;if(ki){const qi=Math.sin(ki),tn=Math.cos(ki),an=[tn,-qi,qi,tn];oi._matMult(an),Dt._matMult(an),Zi._matMult(an),Yi._matMult(an)}const Ji=je.stretch+je.fixed,Wi=et.stretch+et.fixed;return{tl:oi,tr:Dt,bl:Zi,br:Yi,tex:{x:u.paddedRect.x+1+Ji,y:u.paddedRect.y+1+Wi,w:at.stretch+at.fixed-Ji,h:tt.stretch+tt.fixed-Wi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:rn,pixelOffsetBR:fi,minFontScaleX:Ve/f/x,minFontScaleY:We/f/S,isSDF:t}};if(o&&(u.stretchX||u.stretchY)){const je=hv(M,$,L),et=hv(I,ee,U);for(let at=0;at<je.length-1;at++){const tt=je[at],ft=je[at+1];for(let lt=0;lt<et.length-1;lt++)l.push(yt(tt,et[lt],ft,et[lt+1]))}}else l.push(yt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:m+1},{fixed:0,stretch:v+1}));return l}function ef(i,e,t){let o=0;for(const l of i)o+=Math.max(e,Math.min(t,l[1]))-Math.max(e,Math.min(t,l[0]));return o}function hv(i,e,t){const o=[{fixed:-1,stretch:0}];for(const[l,u]of i){const f=o[o.length-1];o.push({fixed:l-f.stretch,stretch:f.stretch}),o.push({fixed:l-f.stretch,stretch:f.stretch+(u-l)})}return o.push({fixed:e+1,stretch:t}),o}function tf(i,e,t,o){return i/e*t+o}function nf(i,e,t,o){return i-e*t/o}function RT(i,e,t,o){const l=e+i.positionedLines[o].lineOffset;return o===0?t+l/2:t+(l+(e+i.positionedLines[o-1].lineOffset))/2}ac.loadGlyphRange=function(i,e,t,o,l){const u=256*e,f=u+255,m=o.transformRequest(o.normalizeGlyphsURL(t).replace("{fontstack}",i).replace("{range}",`${u}-${f}`),_e.Glyphs);ke(m,(v,x)=>{if(v)l(v);else if(x){const S={},M=function(I){return new Ku(I).readFields(MT,{})}(x);for(const I of M.glyphs)S[I.id]=I;l(null,{glyphs:S,ascender:M.ascender,descender:M.descender})}})},ac.TinySDF=class{constructor({fontSize:i=24,buffer:e=3,radius:t=8,cutoff:o=.25,fontFamily:l="sans-serif",fontWeight:u="normal",fontStyle:f="normal"}={}){this.buffer=e,this.cutoff=o,this.radius=t;const m=this.size=i+4*e,v=this._createCanvas(m),x=this.ctx=v.getContext("2d",{willReadFrequently:!0});x.font=`${f} ${u} ${i}px ${l}`,x.textBaseline="alphabetic",x.textAlign="left",x.fillStyle="black",this.gridOuter=new Float64Array(m*m),this.gridInner=new Float64Array(m*m),this.f=new Float64Array(m),this.z=new Float64Array(m+1),this.v=new Uint16Array(m)}_createCanvas(i){const e=document.createElement("canvas");return e.width=e.height=i,e}draw(i){const{width:e,actualBoundingBoxAscent:t,actualBoundingBoxDescent:o,actualBoundingBoxLeft:l,actualBoundingBoxRight:u}=this.ctx.measureText(i),f=Math.ceil(t),m=Math.min(this.size-this.buffer,Math.ceil(u-l)),v=Math.min(this.size-this.buffer,f+Math.ceil(o)),x=m+2*this.buffer,S=v+2*this.buffer,M=Math.max(x*S,0),I=new Uint8ClampedArray(M),P={data:I,width:x,height:S,glyphWidth:m,glyphHeight:v,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(m===0||v===0)return P;const{ctx:L,buffer:U,gridInner:$,gridOuter:ee}=this;L.clearRect(U,U,m,v),L.fillText(i,U,U+f);const se=L.getImageData(U,U,m,v);ee.fill(Ju,0,M),$.fill(0,0,M);for(let ie=0;ie<v;ie++)for(let re=0;re<m;re++){const me=se.data[4*(ie*m+re)+3]/255;if(me===0)continue;const ae=(ie+U)*x+re+U;if(me===1)ee[ae]=0,$[ae]=Ju;else{const Ve=.5-me;ee[ae]=Ve>0?Ve*Ve:0,$[ae]=Ve<0?Ve*Ve:0}}lv(ee,0,0,x,S,x,this.f,this.v,this.z),lv($,U,U,m,v,x,this.f,this.v,this.z);for(let ie=0;ie<M;ie++){const re=Math.sqrt(ee[ie])-Math.sqrt($[ie]);I[ie]=Math.round(255-255*(re/this.radius+this.cutoff))}return P}};class FT{constructor(e=[],t=OT){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:o}=this,l=t[e];for(;e>0;){const u=e-1>>1,f=t[u];if(o(l,f)>=0)break;t[e]=f,e=u}t[e]=l}_down(e){const{data:t,compare:o}=this,l=this.length>>1,u=t[e];for(;e<l;){let f=1+(e<<1),m=t[f];const v=f+1;if(v<this.length&&o(t[v],m)<0&&(f=v,m=t[v]),o(m,u)>=0)break;t[e]=m,e=f}t[e]=u}}function OT(i,e){return i<e?-1:i>e?1:0}function VT(i,e=1,t=!1){let o=1/0,l=1/0,u=-1/0,f=-1/0;const m=i[0];for(let P=0;P<m.length;P++){const L=m[P];(!P||L.x<o)&&(o=L.x),(!P||L.y<l)&&(l=L.y),(!P||L.x>u)&&(u=L.x),(!P||L.y>f)&&(f=L.y)}const v=Math.min(u-o,f-l);let x=v/2;const S=new FT([],UT);if(v===0)return new F(o,l);for(let P=o;P<u;P+=v)for(let L=l;L<f;L+=v)S.push(new lc(P+x,L+x,x,i));let M=function(P){let L=0,U=0,$=0;const ee=P[0];for(let se=0,ie=ee.length,re=ie-1;se<ie;re=se++){const me=ee[se],ae=ee[re],Ve=me.x*ae.y-ae.x*me.y;U+=(me.x+ae.x)*Ve,$+=(me.y+ae.y)*Ve,L+=3*Ve}return new lc(U/L,$/L,0,P)}(i),I=S.length;for(;S.length;){const P=S.pop();(P.d>M.d||!M.d)&&(M=P,t&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,I)),P.max-M.d<=e||(x=P.h/2,S.push(new lc(P.p.x-x,P.p.y-x,x,i)),S.push(new lc(P.p.x+x,P.p.y-x,x,i)),S.push(new lc(P.p.x-x,P.p.y+x,x,i)),S.push(new lc(P.p.x+x,P.p.y+x,x,i)),I+=4)}return t&&(console.log(`num probes: ${I}`),console.log(`best distance: ${M.d}`)),M.p}function UT(i,e){return e.max-i.max}function lc(i,e,t,o){this.p=new F(i,e),this.h=t,this.d=function(l,u){let f=!1,m=1/0;for(let v=0;v<u.length;v++){const x=u[v];for(let S=0,M=x.length,I=M-1;S<M;I=S++){const P=x[S],L=x[I];P.y>l.y!=L.y>l.y&&l.x<(L.x-P.x)*(l.y-P.y)/(L.y-P.y)+P.x&&(f=!f),m=Math.min(m,Jg(l,P,L))}}return(f?1:-1)*Math.sqrt(m)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}const Em=Number.POSITIVE_INFINITY,NT=Math.sqrt(2);function dv(i,e){return e[1]!==Em?function(t,o,l){let u=0,f=0;switch(o=Math.abs(o),l=Math.abs(l),t){case"top-right":case"top-left":case"top":f=l-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-l}switch(t){case"top-right":case"bottom-right":case"right":u=-o;break;case"top-left":case"bottom-left":case"left":u=o}return[u,f]}(i,e[0],e[1]):function(t,o){let l=0,u=0;o<0&&(o=0);const f=o/NT;switch(t){case"top-right":case"top-left":u=f-7;break;case"bottom-right":case"bottom-left":u=7-f;break;case"bottom":u=7-o;break;case"top":u=o-7}switch(t){case"top-right":case"bottom-right":l=-f;break;case"top-left":case"bottom-left":l=f;break;case"left":l=o;break;case"right":l=-o}return[l,u]}(i,e[0])}function jT(i,e,t,o,l,u,f,m,v,x){i.createArrays(),i.tilePixelRatio=ei/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const S=i.layers[0].layout,M=i.layers[0]._unevaluatedLayout._values,I={};if(i.textSizeData.kind==="composite"){const{minZoom:U,maxZoom:$}=i.textSizeData;I.compositeTextSizes=[M["text-size"].possiblyEvaluate(new W(U),m),M["text-size"].possiblyEvaluate(new W($),m)]}if(i.iconSizeData.kind==="composite"){const{minZoom:U,maxZoom:$}=i.iconSizeData;I.compositeIconSizes=[M["icon-size"].possiblyEvaluate(new W(U),m),M["icon-size"].possiblyEvaluate(new W($),m)]}I.layoutTextSize=M["text-size"].possiblyEvaluate(new W(v+1),m),I.layoutIconSize=M["icon-size"].possiblyEvaluate(new W(v+1),m),I.textMaxSize=M["text-size"].possiblyEvaluate(new W(18),m);const P=S.get("text-rotation-alignment")==="map"&&S.get("symbol-placement")!=="point",L=S.get("text-size");for(const U of i.features){const $=S.get("text-font").evaluate(U,{},m).join(","),ee=L.evaluate(U,{},m),se=I.layoutTextSize.evaluate(U,{},m),ie=(I.layoutIconSize.evaluate(U,{},m),{horizontal:{},vertical:void 0}),re=U.text;let me,ae=[0,0];if(re){const We=re.toString(),yt=S.get("text-letter-spacing").evaluate(U,{},m)*Hn,je=S.get("text-line-height").evaluate(U,{},m)*Hn,et=Up(We)?yt:0,at=S.get("text-anchor").evaluate(U,{},m),tt=S.get("text-variable-anchor");if(!tt){const Gt=S.get("text-radial-offset").evaluate(U,{},m);ae=Gt?dv(at,[Gt*Hn,Em]):S.get("text-offset").evaluate(U,{},m).map(Tt=>Tt*Hn)}let ft=P?"center":S.get("text-justify").evaluate(U,{},m);const lt=S.get("symbol-placement"),kt=lt==="point",li=lt==="point"?S.get("text-max-width").evaluate(U,{},m)*Hn:0,hi=Gt=>{i.allowVerticalPlacement&&Hl(We)&&(ie.vertical=xm(re,e,t,l,$,li,je,at,Gt,et,ae,Ur.vertical,!0,lt,se,ee))};if(!P&&tt){const Gt=ft==="auto"?tt.map(bi=>Sm(bi)):[ft];let Tt=!1;for(let bi=0;bi<Gt.length;bi++){const oi=Gt[bi];if(!ie.horizontal[oi])if(Tt)ie.horizontal[oi]=ie.horizontal[0];else{const Dt=xm(re,e,t,l,$,li,je,"center",oi,et,ae,Ur.horizontal,!1,lt,se,ee);Dt&&(ie.horizontal[oi]=Dt,Tt=Dt.positionedLines.length===1)}}hi("left")}else{if(ft==="auto"&&(ft=Sm(at)),kt||S.get("text-writing-mode").indexOf("horizontal")>=0||!Hl(We)){const Gt=xm(re,e,t,l,$,li,je,at,ft,et,ae,Ur.horizontal,!1,lt,se,ee);Gt&&(ie.horizontal[ft]=Gt)}hi(lt==="point"?"left":ft)}}let Ve=!1;if(U.icon&&U.icon.name){const We=o[U.icon.name];We&&(me=DT(l[U.icon.name],S.get("icon-offset").evaluate(U,{},m),S.get("icon-anchor").evaluate(U,{},m)),Ve=We.sdf,i.sdfIcons===void 0?i.sdfIcons=We.sdf:i.sdfIcons!==We.sdf&&xt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(We.pixelRatio!==i.pixelRatio||S.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const Fe=pv(ie.horizontal)||ie.vertical;i.iconsInText||(i.iconsInText=!!Fe&&Fe.iconsInText),(Fe||me)&&qT(i,U,ie,me,o,I,se,0,ae,Ve,f,m,x)}u&&i.generateCollisionDebugBuffers(v,i.collisionBoxArray)}function Sm(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function qT(i,e,t,o,l,u,f,m,v,x,S,M,I){let P=u.textMaxSize.evaluate(e,{},M);P===void 0&&(P=f);const L=i.layers[0].layout,U=L.get("icon-offset").evaluate(e,{},M),$=pv(t.horizontal)||t.vertical,ee=I.name==="globe",se=f/24,ie=i.tilePixelRatio*P/24,re=(et=i.overscaling,i.zoom>18&&et>2&&(et>>=1),Math.max(ei/(512*et),1)*L.get("symbol-spacing")),me=L.get("text-padding")*i.tilePixelRatio,ae=L.get("icon-padding")*i.tilePixelRatio,Ve=ye(L.get("text-max-angle")),Fe=L.get("text-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",We=L.get("icon-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",yt=L.get("symbol-placement"),je=re/2;var et;const at=L.get("icon-text-fit");let tt;o&&at!=="none"&&(i.allowVerticalPlacement&&t.vertical&&(tt=tv(o,t.vertical,at,L.get("icon-text-fit-padding"),U,se)),$&&(o=tv(o,$,at,L.get("icon-text-fit-padding"),U,se)));const ft=(lt,kt,li)=>{if(kt.x<0||kt.x>=ei||kt.y<0||kt.y>=ei)return;let hi=null;if(ee){const{x:Gt,y:Tt,z:bi}=I.projectTilePoint(kt.x,kt.y,li);hi={anchor:new us(Gt,Tt,bi,0,void 0),up:I.upVector(li,kt.x,kt.y)}}(function(Gt,Tt,bi,oi,Dt,Yi,Zi,rn,fi,ki,Ji,Wi,qi,tn,an,On,xr,Ti,mn,er,Fi,ln,hr,on,vn){const Vn=Gt.addToLineVertexArray(Tt,oi);let Ln,Xn,dr,Un,ds,fc,ch,uh=0,Yv=0,Jv=0,Qv=0,jm=-1,qm=-1;const No={};let ex=Bu("");const Ja=bi?bi.anchor:Tt;let $m=0,Gm=0;if(fi._unevaluatedLayout.getValue("text-radial-offset")===void 0?[$m,Gm]=fi.layout.get("text-offset").evaluate(Fi,{},vn).map(kr=>kr*Hn):($m=fi.layout.get("text-radial-offset").evaluate(Fi,{},vn)*Hn,Gm=Em),Gt.allowVerticalPlacement&&Dt.vertical){const kr=Dt.vertical;if(an)fc=Cm(kr),rn&&(ch=Cm(rn));else{const zr=fi.layout.get("text-rotate").evaluate(Fi,{},vn)+90;dr=rf(ki,Ja,Tt,Ji,Wi,qi,kr,tn,zr,On),rn&&(Un=rf(ki,Ja,Tt,Ji,Wi,qi,rn,Ti,zr))}}if(Yi){const kr=fi.layout.get("icon-rotate").evaluate(Fi,{},vn),zr=fi.layout.get("icon-text-fit")!=="none",hh=uv(Yi,kr,hr,zr),Wm=rn?uv(rn,kr,hr,zr):void 0;Xn=rf(ki,Ja,Tt,Ji,Wi,qi,Yi,Ti,kr),uh=4*hh.length;const tx=Gt.iconSizeData;let Qa=null;tx.kind==="source"?(Qa=[Ro*fi.layout.get("icon-size").evaluate(Fi,{},vn)],Qa[0]>$s&&xt(`${Gt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):tx.kind==="composite"&&(Qa=[Ro*ln.compositeIconSizes[0].evaluate(Fi,{},vn),Ro*ln.compositeIconSizes[1].evaluate(Fi,{},vn)],(Qa[0]>$s||Qa[1]>$s)&&xt(`${Gt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Gt.addSymbols(Gt.icon,hh,Qa,er,mn,Fi,!1,bi,Tt,Vn.lineStartIndex,Vn.lineLength,-1,on,vn),jm=Gt.icon.placedSymbolArray.length-1,Wm&&(Yv=4*Wm.length,Gt.addSymbols(Gt.icon,Wm,Qa,er,mn,Fi,Ur.vertical,bi,Tt,Vn.lineStartIndex,Vn.lineLength,-1,on,vn),qm=Gt.icon.placedSymbolArray.length-1)}for(const kr in Dt.horizontal){const zr=Dt.horizontal[kr];Ln||(ex=Bu(zr.text),an?ds=Cm(zr):Ln=rf(ki,Ja,Tt,Ji,Wi,qi,zr,tn,fi.layout.get("text-rotate").evaluate(Fi,{},vn),On));const hh=zr.positionedLines.length===1;if(Jv+=fv(Gt,bi,Tt,zr,Zi,fi,an,Fi,On,Vn,Dt.vertical?Ur.horizontal:Ur.horizontalOnly,hh?Object.keys(Dt.horizontal):[kr],No,jm,ln,on,vn),hh)break}Dt.vertical&&(Qv+=fv(Gt,bi,Tt,Dt.vertical,Zi,fi,an,Fi,On,Vn,Ur.vertical,["vertical"],No,qm,ln,on,vn));let Ks=-1;const Zm=(kr,zr)=>kr?Math.max(kr,zr):zr;Ks=Zm(ds,Ks),Ks=Zm(fc,Ks),Ks=Zm(ch,Ks);const b2=Ks>-1?1:0;Gt.glyphOffsetArray.length>=Zs.MAX_GLYPHS&&xt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Fi.sortKey!==void 0&&Gt.addToSortKeyRanges(Gt.symbolInstances.length,Fi.sortKey),Gt.symbolInstances.emplaceBack(Ja.x,Ja.y,Ja.z,Tt.x,Tt.y,No.right>=0?No.right:-1,No.center>=0?No.center:-1,No.left>=0?No.left:-1,No.vertical>=0?No.vertical:-1,jm,qm,ex,Ln!==void 0?Ln:Gt.collisionBoxArray.length,Ln!==void 0?Ln+1:Gt.collisionBoxArray.length,dr!==void 0?dr:Gt.collisionBoxArray.length,dr!==void 0?dr+1:Gt.collisionBoxArray.length,Xn!==void 0?Xn:Gt.collisionBoxArray.length,Xn!==void 0?Xn+1:Gt.collisionBoxArray.length,Un||Gt.collisionBoxArray.length,Un?Un+1:Gt.collisionBoxArray.length,Ji,Jv,Qv,uh,Yv,b2,0,$m,Gm,Ks)})(i,kt,hi,lt,t,o,l,tt,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,me,Fe,v,0,ae,We,U,e,u,x,S,M)};if(yt==="line")for(const lt of av(e.geometry,0,0,ei,ei)){const kt=BT(lt,re,Ve,t.vertical||$,o,24,ie,i.overscaling,ei);for(const li of kt){const hi=$;hi&&$T(i,hi.text,je,li)||ft(lt,li,M)}}else if(yt==="line-center"){for(const lt of e.geometry)if(lt.length>1){const kt=LT(lt,Ve,t.vertical||$,o,24,ie);kt&&ft(lt,kt,M)}}else if(e.type==="Polygon")for(const lt of fm(e.geometry,0)){const kt=VT(lt,16);ft(lt[0],new us(kt.x,kt.y,0,0,void 0),M)}else if(e.type==="LineString")for(const lt of e.geometry)ft(lt,new us(lt[0].x,lt[0].y,0,0,void 0),M);else if(e.type==="Point")for(const lt of e.geometry)for(const kt of lt)ft([kt],new us(kt.x,kt.y,0,0,void 0),M)}const $s=32640;function fv(i,e,t,o,l,u,f,m,v,x,S,M,I,P,L,U,$){const ee=function(re,me,ae,Ve,Fe,We,yt,je){const et=[];if(me.positionedLines.length===0)return et;const at=Ve.layout.get("text-rotate").evaluate(We,{})*Math.PI/180,tt=function(hi){const Gt=hi[0],Tt=hi[1],bi=Gt*Tt;return bi>0?[Gt,-Tt]:bi<0?[-Gt,Tt]:Gt===0?[Tt,Gt]:[Tt,-Gt]}(ae);let ft=Math.abs(me.top-me.bottom);for(const hi of me.positionedLines)ft-=hi.lineOffset;const lt=me.positionedLines.length,kt=ft/lt;let li=me.top-ae[1];for(let hi=0;hi<lt;++hi){const Gt=me.positionedLines[hi];li=RT(me,kt,li,hi);for(const Tt of Gt.positionedGlyphs){if(!Tt.rect)continue;const bi=Tt.rect||{};let oi=4,Dt=!0,Yi=1,Zi=0;if(Tt.imageName){const on=yt[Tt.imageName];if(!on)continue;if(on.sdf){xt("SDF images are not supported in formatted text and will be ignored.");continue}Dt=!1,Yi=on.pixelRatio,oi=1/Yi}const rn=(Fe||je)&&Tt.vertical,fi=Tt.metrics.advance*Tt.scale/2,ki=Tt.metrics,Ji=Tt.rect;if(Ji===null)continue;je&&me.verticalizable&&(Zi=Tt.imageName?fi-Tt.metrics.width*Tt.scale/2:0);const Wi=Fe?[Tt.x+fi,Tt.y]:[0,0];let qi=[0,0],tn=[0,0],an=!1;Fe||(rn?(tn=[Tt.x+fi+tt[0],Tt.y+tt[1]-Zi],an=!0):qi=[Tt.x+fi+ae[0],Tt.y+ae[1]-Zi]);const On=Ji.w*Tt.scale/(Yi*(Tt.localGlyph?2:1)),xr=Ji.h*Tt.scale/(Yi*(Tt.localGlyph?2:1));let Ti,mn,er,Fi;if(rn){const on=Tt.y-li,vn=new F(-fi,fi-on),Vn=-Math.PI/2,Ln=new F(...tn);Ti=new F(-fi+qi[0],qi[1]),Ti._rotateAround(Vn,vn)._add(Ln),Ti.x+=-on+fi,Ti.y-=(ki.left-oi)*Tt.scale;const Xn=Tt.imageName?ki.advance*Tt.scale:Hn*Tt.scale,dr=String.fromCharCode(Tt.glyph);gT(dr)?Ti.x+=(1-oi)*Tt.scale:yT(dr)?Ti.x+=Xn-ki.height*Tt.scale+(-oi-1)*Tt.scale:Ti.x+=Tt.imageName||ki.width+2*oi===Ji.w&&ki.height+2*oi===Ji.h?(Xn-xr)/2:(Xn-(ki.height+2*oi)*Tt.scale)/2,mn=new F(Ti.x,Ti.y-On),er=new F(Ti.x+xr,Ti.y),Fi=new F(Ti.x+xr,Ti.y-On)}else{const on=(ki.left-oi)*Tt.scale-fi+qi[0],vn=(-ki.top-oi)*Tt.scale+qi[1],Vn=on+On,Ln=vn+xr;Ti=new F(on,vn),mn=new F(Vn,vn),er=new F(on,Ln),Fi=new F(Vn,Ln)}if(at){let on;on=Fe?new F(0,0):an?new F(tt[0],tt[1]):new F(ae[0],ae[1]),Ti._rotateAround(at,on),mn._rotateAround(at,on),er._rotateAround(at,on),Fi._rotateAround(at,on)}const ln=new F(0,0),hr=new F(0,0);et.push({tl:Ti,tr:mn,bl:er,br:Fi,tex:bi,writingMode:me.writingMode,glyphOffset:Wi,sectionIndex:Tt.sectionIndex,isSDF:Dt,pixelOffsetTL:ln,pixelOffsetBR:hr,minFontScaleX:0,minFontScaleY:0})}}return et}(0,o,v,u,f,m,l,i.allowVerticalPlacement),se=i.textSizeData;let ie=null;se.kind==="source"?(ie=[Ro*u.layout.get("text-size").evaluate(m,{},$)],ie[0]>$s&&xt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):se.kind==="composite"&&(ie=[Ro*L.compositeTextSizes[0].evaluate(m,{},$),Ro*L.compositeTextSizes[1].evaluate(m,{},$)],(ie[0]>$s||ie[1]>$s)&&xt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,ee,ie,v,f,m,S,e,t,x.lineStartIndex,x.lineLength,P,U,$);for(const re of M)I[re]=i.text.placedSymbolArray.length-1;return 4*ee.length}function pv(i){for(const e in i)return i[e];return null}function rf(i,e,t,o,l,u,f,m,v,x){let S=f.top,M=f.bottom,I=f.left,P=f.right;const L=f.collisionPadding;if(L&&(I-=L[0],S-=L[1],P+=L[2],M+=L[3]),v){const U=new F(I,S),$=new F(P,S),ee=new F(I,M),se=new F(P,M),ie=ye(v);let re=new F(0,0);x&&(re=new F(x[0],x[1])),U._rotateAround(ie,re),$._rotateAround(ie,re),ee._rotateAround(ie,re),se._rotateAround(ie,re),I=Math.min(U.x,$.x,ee.x,se.x),P=Math.max(U.x,$.x,ee.x,se.x),S=Math.min(U.y,$.y,ee.y,se.y),M=Math.max(U.y,$.y,ee.y,se.y)}return i.emplaceBack(e.x,e.y,e.z,t.x,t.y,I,S,P,M,m,o,l,u),i.length-1}function Cm(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const e=i.bottom-i.top;return e>0?Math.max(10,e):null}function $T(i,e,t,o){const l=i.compareText;if(e in l){const u=l[e];for(let f=u.length-1;f>=0;f--)if(o.dist(u[f])<t)return!0}else l[e]=[];return l[e].push(o),!1}const GT=it([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:mv}=GT,_v=it([{name:"a_pos_3",components:3,type:"Int16"}]);var Qu=it([{name:"a_pos",type:"Int16",components:2}]);const hs=ei/Math.PI/2,Am=2*Gr(1,0)*hs*Math.PI,cc=[64,32,16],ho=-hs,fo=hs,ZT=[new vr([ho,ho,ho],[fo,fo,fo]),new vr([ho,ho,ho],[0,0,fo]),new vr([0,ho,ho],[fo,0,fo]),new vr([ho,0,ho],[0,fo,fo]),new vr([0,0,ho],[fo,fo,fo])];function gv(i,e,t,o=!0){const l=co([],i._camera.position,i.worldSize),u=[e,t,1,1];Wa(u,u,i.pixelMatrixInverse),cy(u,u,1/u[3]);const f=cr([],uo([],u,l)),m=i.globeMatrix,v=[m[12],m[13],m[14]],x=uo([],v,l),S=Ou(x),M=cr([],x),I=i.worldSize/(2*Math.PI),P=Wr(M,f),L=Math.asin(I/S);if(L<Math.acos(P)){if(!o)return null;const yt=[],je=[];co(yt,f,S/P),cr(je,uo(je,yt,x)),cr(f,qs(f,x,co(f,je,Math.tan(L)*S)))}const U=[];new om(l,f).closestPointOnSphere(v,I,U);const $=cr([],Bi(m,0)),ee=cr([],Bi(m,1)),se=cr([],Bi(m,2)),ie=Wr($,U),re=Wr(ee,U),me=Wr(se,U),ae=ze(Math.asin(-re/I));let Ve=ze(Math.atan2(ie,me));Ve=i.center.lng+function(yt,je){const et=(je-yt+180)%360-180;return et<-180?et+360:et}(i.center.lng,Ve);const Fe=Do(Ve),We=Te(ss(ae),0,1);return new Yl(Fe,We)}class WT{constructor(e,t,o){this.a=uo([],e,o),this.b=uo([],t,o),this.center=o;const l=cr([],this.a),u=cr([],this.b);this.angle=Math.acos(Wr(l,u))}}function Mm(i,e){if(i.angle===0)return null;let t;return t=i.a[e]===0?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[e]/i.a[e]/Math.sin(i.angle)-1/Math.tan(i.angle)),t<0||t>1?null:function(o,l,u,f){const m=Math.sin(u);return o*(Math.sin((1-f)*u)/m)+l*(Math.sin(f*u)/m)}(i.a[e],i.b[e],i.angle,Te(t,0,1))+i.center[e]}function Fo(i){if(i.z<=1)return ZT[i.z+2*i.y+i.x];const e=Im(of(i));return vr.fromPoints(e)}function yv(i,e){const t=ih(e.zoom);if(t===0)return Fo(i);const o=of(i),l=Im(o),u=Do(o.getWest())*e.worldSize,f=Do(o.getEast())*e.worldSize,m=ss(o.getNorth())*e.worldSize,v=ss(o.getSouth())*e.worldSize,x=[u,m,0],S=[f,m,0],M=[u,v,0],I=[f,v,0],P=Jp([],e.globeMatrix);return Pn(x,x,P),Pn(S,S,P),Pn(M,M,P),Pn(I,I,P),l[0]=As(l[0],M,t),l[1]=As(l[1],I,t),l[2]=As(l[2],S,t),l[3]=As(l[3],x,t),vr.fromPoints(l)}function vv(i,e,t,o,l){for(const u of t)Pn(u,u,o),co(u,u,l),im(i,i,u),nm(e,e,u)}function HT(i,e,t){const o=e/i.worldSize,l=Number.MAX_VALUE,u=[-l,-l,-l],f=[l,l,l],m=i.globeMatrix;if(t.z<=1)return vv(f,u,Fo(t).getCorners(),m,o),new vr(f,u);const v=of(t),x=Im(v);if(vv(f,u,x,m,o),v.contains(i.center)){u[2]=0;const Ve=i.point,Fe=[Ve.x*o,Ve.y*o,0];return im(f,f,Fe),nm(u,u,Fe),new vr(f,u)}const S=[m[12]*o,m[13]*o,m[14]*o],M=v.getCenter(),I=Te(i.center.lat,-85.051129,Lo),P=Te(M.lat,-85.051129,Lo),L=Do(i.center.lng),U=ss(I);let $=L-Do(M.lng);const ee=U-ss(P);$>.5?$-=1:$<-.5&&($+=1);let se=0;Math.abs($)>Math.abs(ee)?se=$>=0?1:3:(se=ee>=0?0:2,Ud(S,S,[m[4]*o,m[5]*o,m[6]*o],-Math.sin(ye(ee>=0?v.getSouth():v.getNorth()))*hs));const ie=x[se],re=x[(se+1)%4],me=new WT(ie,re,S),ae=[Mm(me,0)||ie[0],Mm(me,1)||ie[1],Mm(me,2)||ie[2]];return f[2]=Math.min(ie[2],re[2]),im(f,f,ae),nm(u,u,ae),new vr(f,u)}function of({x:i,y:e,z:t}){const o=1/(1<<t),l=new Vi(Zr(i*o),Wn((e+1)*o)),u=new Vi(Zr((i+1)*o),Wn(e*o));return new js(l,u)}function Im(i){const e=ye(i.getNorth()),t=ye(i.getSouth()),o=Math.cos(e),l=Math.cos(t),u=Math.sin(e),f=Math.sin(t),m=i.getWest(),v=i.getEast();return[uc(l,f,m),uc(l,f,v),uc(o,u,v),uc(o,u,m)]}function uc(i,e,t,o=hs){return t=ye(t),[i*Math.sin(t)*o,-e*o,i*Math.cos(t)*o]}function sf(i,e,t){return uc(Math.cos(ye(i)),Math.sin(ye(i)),e,t)}function eh(i,e,t,o){const l=1<<t.z,u=(i/ei+t.x)/l;return sf(Wn((e/ei+t.y)/l),Zr(u),o)}function af({min:i,max:e}){return 16383/Math.max(e[0]-i[0],e[1]-i[1],e[2]-i[2])}const xv=new Float64Array(16);function th(i){const e=af(i),t=ry(xv,[e,e,e]);return Fu(t,t,((o=[])[0]=-(l=i.min)[0],o[1]=-l[1],o[2]=-l[2],o));var o,l}function km(i){const e=(o=i.min,(t=xv)[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=o[0],t[13]=o[1],t[14]=o[2],t[15]=1,t);var t,o;const l=1/af(i);return Za(e,e,[l,l,l])}function bv(i,e,t,o,l){const u=function(v){const x=ei/(2*Math.PI);return v/(2*Math.PI)/x}(t),f=[i,e,-t/(2*Math.PI)],m=Bo(new Float64Array(16));return Fu(m,m,f),Za(m,m,[u,u,u]),Qp(m,m,ye(-l)),Vd(m,m,ye(-o)),m}function ih(i){return Pe(5,6,i)}function wv(i,e){const t=sf(e.lat,e.lng);return u=(o=tm([],function(P){const L=sf(P._center.lat,P._center.lng);let U=rm([],ec(0,1,0),L);const $=oy([],-P.angle,L);U=Pn(U,U,$),oy($,-P._pitch,U);const ee=cr([],L);return co(ee,ee,P.cameraToCenterDistance/P.pixelsPerMeter*Am),Pn(ee,ee,$),qs([],L,ee)}(i),t))[0],f=o[1],m=o[2],v=(l=t)[0],x=l[1],S=l[2],I=(M=Math.sqrt(u*u+f*f+m*m)*Math.sqrt(v*v+x*x+S*S))&&Wr(o,l)/M,Math.acos(Math.min(Math.max(I,-1),1));var o,l,u,f,m,v,x,S,M,I}const Tv=ye(85),XT=Math.cos(Tv),KT=Math.sin(Tv);function Ev(i,e){const t=i.fovAboveCenter,o=i.elevation?i.elevation.getMinElevationBelowMSL()*e:0,l=(i._camera.position[2]*i.worldSize-o)/Math.cos(i._pitch),u=Math.sin(t)*l/Math.sin(Math.max(Math.PI/2-i._pitch-t,.01)),f=Math.sin(i._pitch)*u+l;return Math.min(1.01*f,l*(1/i._horizonShift))}function Ka(i,e){if(!e.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:e};const t=Math.pow(2,-i.z),o=i.x*t,l=(i.x+1)*t,u=i.y*t,f=(i.y+1)*t,m=Zr(o),v=Zr(l),x=Wn(u),S=Wn(f),M=e.project(m,x),I=e.project(v,x),P=e.project(v,S),L=e.project(m,S);let U=Math.min(M.x,I.x,P.x,L.x),$=Math.min(M.y,I.y,P.y,L.y),ee=Math.max(M.x,I.x,P.x,L.x),se=Math.max(M.y,I.y,P.y,L.y);const ie=t/16;function re(ae,Ve,Fe,We,yt,je){const et=(Fe+yt)/2,at=(We+je)/2,tt=e.project(Zr(et),Wn(at)),ft=Math.max(0,U-tt.x,$-tt.y,tt.x-ee,tt.y-se);U=Math.min(U,tt.x),ee=Math.max(ee,tt.x),$=Math.min($,tt.y),se=Math.max(se,tt.y),ft>ie&&(re(ae,tt,Fe,We,et,at),re(tt,Ve,et,at,yt,je))}re(M,I,o,u,l,u),re(I,P,l,u,l,f),re(P,L,l,f,o,f),re(L,M,o,f,o,u),U-=ie,$-=ie,ee+=ie,se+=ie;const me=1/Math.max(ee-U,se-$);return{scale:me,x:U*me,y:$*me,x2:ee*me,y2:se*me,projection:e}}const YT=Bo(new Float32Array(16));class Gs{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new Vi(0,0)}projectTilePoint(e,t,o){return{x:e,y:t,z:0}}locationPoint(e,t,o=!0){return e._coordinatePoint(e.locationCoordinate(t),o)}pixelsPerMeter(e,t){return Gr(1,e)*t}pixelSpaceConversion(e,t,o){return 1}farthestPixelDistance(e){return Ev(e,e.pixelsPerMeter)}pointCoordinate(e,t,o,l){const u=e.horizonLineFromTop(!1),f=new F(t,Math.max(u,o));return e.rayIntersectionCoordinate(e.pointRayIntersection(f,l))}pointCoordinate3D(e,t,o){const l=new F(t,o);if(e.elevation)return e.elevation.pointCoordinate(l);{const u=this.pointCoordinate(e,l.x,l.y,0);return[u.x,u.y,u.z]}}isPointAboveHorizon(e,t){if(e.elevation)return!this.pointCoordinate3D(e,t.x,t.y);const o=e.horizonLineFromTop();return t.y<o}createInversionMatrix(e,t){return YT}createTileMatrix(e,t,o){let l,u,f;const m=o.canonical,v=Bo(new Float64Array(16));if(this.isReprojectedInTileSpace){const x=Ka(m,this);l=1,u=x.x+o.wrap*x.scale,f=x.y,Za(v,v,[l/x.scale,l/x.scale,e.pixelsPerMeter/t])}else l=t/e.zoomScale(m.z),u=(m.x+Math.pow(2,m.z)*o.wrap)*l,f=m.y*l;return Fu(v,v,[u,f,0]),Za(v,v,[l/ei,l/ei,1]),v}upVector(e,t,o){return[0,0,1]}upVectorScale(e,t,o){return{metersToTile:1}}}class JT extends Gs{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,o]=this.parallels=e.parallels||[29.5,45.5],l=Math.sin(ye(t));this.n=(l+Math.sin(ye(o)))/2,this.c=1+l*(2*this.n-l),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n:o,c:l,r0:u}=this,f=ye(e-this.center[0]),m=ye(t),v=Math.sqrt(l-2*o*Math.sin(m))/o;return{x:v*Math.sin(f*o),y:v*Math.cos(f*o)-u,z:0}}unproject(e,t){const{n:o,c:l,r0:u}=this,f=u+t;let m=Math.atan2(e,Math.abs(f))*Math.sign(f);f*o<0&&(m-=Math.PI*Math.sign(e)*Math.sign(f));const v=ye(this.center[0])*o;m=xe(m,-Math.PI-v,Math.PI-v);const x=ze(m/o)+this.center[0],S=Math.asin(Te((l-(e*e+f*f)*o*o)/(2*o),-1,1)),M=Te(ze(S),-85.051129,Lo);return new Vi(x,M)}}const nh=1.340264,rh=-.081106,oh=893e-6,sh=.003796,lf=Math.sqrt(3)/2;class QT extends Gs{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const o=Math.asin(lf*Math.sin(t)),l=o*o,u=l*l*l;return{x:.5*(e*Math.cos(o)/(lf*(nh+3*rh*l+u*(7*oh+9*sh*l)))/Math.PI+.5),y:1-.5*(o*(nh+rh*l+u*(oh+sh*l))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let o=t=(2*(1-t)-1)*Math.PI,l=o*o,u=l*l*l;for(let S,M,I,P=0;P<12&&(M=o*(nh+rh*l+u*(oh+sh*l))-t,I=nh+3*rh*l+u*(7*oh+9*sh*l),S=M/I,o=Te(o-S,-Math.PI/3,Math.PI/3),l=o*o,u=l*l*l,!(Math.abs(S)<1e-12));++P);const f=lf*e*(nh+3*rh*l+u*(7*oh+9*sh*l))/Math.cos(o),m=Math.asin(Math.sin(o)/lf),v=Te(180*f/Math.PI,-180,180),x=Te(180*m/Math.PI,-85.051129,Lo);return new Vi(v,x)}}class e2 extends Gs{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const o=360*(e-.5),l=Te(360*(.5-t),-85.051129,Lo);return new Vi(o,l)}}const hc=Math.PI/2;function cf(i){return Math.tan((hc+i)/2)}class t2 extends Gs{constructor(e){super(e),this.center=e.center||[0,30];const[t,o]=this.parallels=e.parallels||[30,30],l=ye(t),u=ye(o),f=Math.cos(l);this.n=l===u?Math.sin(l):Math.log(f/Math.cos(u))/Math.log(cf(u)/cf(l)),this.f=f*Math.pow(cf(l),this.n)/this.n}project(e,t){t=ye(t),e=ye(e-this.center[0]);const o=1e-6,{n:l,f:u}=this;u>0?t<-hc+o&&(t=-hc+o):t>hc-o&&(t=hc-o);const f=u/Math.pow(cf(t),l),m=f*Math.sin(l*e),v=u-f*Math.cos(l*e);return{x:.5*(m/Math.PI+.5),y:1-.5*(v/Math.PI+.5),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,t=(2*(1-t)-.5)*Math.PI;const{n:o,f:l}=this,u=l-t,f=Math.sign(u),m=Math.sign(o)*Math.sqrt(e*e+u*u);let v=Math.atan2(e,Math.abs(u))*f;u*o<0&&(v-=Math.PI*Math.sign(e)*f);const x=Te(ze(v/o)+this.center[0],-180,180),S=Te(ze(2*Math.atan(Math.pow(l/m,1/o))-hc),-85.051129,Lo);return new Vi(x,S)}}class Sv extends Gs{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:Do(e),y:ss(t),z:0}}unproject(e,t){const o=Zr(e),l=Wn(t);return new Vi(o,l)}}const Cv=ye(Lo);class i2 extends Gs{project(e,t){const o=(t=ye(t))*t,l=o*o;return{x:.5*((e=ye(e))*(.8707-.131979*o+l*(l*(.003971*o-.001529*l)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+o*(.015085+l*(.028874*o-.044475-.005916*l)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let o=t=(2*(1-t)-1)*Math.PI,l=25,u=0,f=o*o;do{f=o*o;const x=f*f;u=(o*(1.007226+f*(.015085+x*(.028874*f-.044475-.005916*x)))-t)/(1.007226+f*(.045255+x*(.259866*f-.311325-.005916*11*x))),o=Te(o-u,-Cv,Cv)}while(Math.abs(u)>1e-6&&--l>0);f=o*o;const m=Te(ze(e/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),v=ze(o);return new Vi(m,v)}}const Av=ye(Lo);class n2 extends Gs{project(e,t){t=ye(t),e=ye(e);const o=Math.cos(t),l=2/Math.PI,u=Math.acos(o*Math.cos(e/2)),f=Math.sin(u)/u,m=.5*(e*l+2*o*Math.sin(e/2)/f)||0,v=.5*(t+Math.sin(t)/f)||0;return{x:.5*(m/Math.PI+.5),y:1-.5*(v/Math.PI+1),z:0}}unproject(e,t){let o=e=(2*e-.5)*Math.PI,l=t=(2*(1-t)-1)*Math.PI,u=25;const f=1e-6;let m=0,v=0;do{const x=Math.cos(l),S=Math.sin(l),M=2*S*x,I=S*S,P=x*x,L=Math.cos(o/2),U=Math.sin(o/2),$=2*L*U,ee=U*U,se=1-P*L*L,ie=se?1/se:0,re=se?Math.acos(x*L)*Math.sqrt(1/se):0,me=.5*(2*re*x*U+2*o/Math.PI)-e,ae=.5*(re*S+l)-t,Ve=.5*ie*(P*ee+re*x*L*I)+1/Math.PI,Fe=ie*($*M/4-re*S*U),We=.125*ie*(M*U-re*S*P*$),yt=.5*ie*(I*L+re*ee*x)+.5,je=Fe*We-yt*Ve;m=(ae*Fe-me*yt)/je,v=(me*We-ae*Ve)/je,o=Te(o-m,-Math.PI,Math.PI),l=Te(l-v,-Av,Av)}while((Math.abs(m)>f||Math.abs(v)>f)&&--u>0);return new Vi(ze(o),ze(l))}}class Mv extends Gs{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ye(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:o,cosPhi:l}=this;return{x:ye(e)*l*o+.5,y:-Math.sin(ye(t))/l*o+.5,z:0}}unproject(e,t){const{scale:o,cosPhi:l}=this,u=-(t-.5)/o,f=Te(ze((e-.5)/o)/l,-180,180),m=Math.asin(Te(u*l,-1,1)),v=Te(ze(m),-85.051129,Lo);return new Vi(f,v)}}class r2 extends Sv{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,t,o){const l=eh(e,t,o);return Pn(l,l,th(Fo(o))),{x:l[0],y:l[1],z:l[2]}}locationPoint(e,t){const o=sf(t.lat,t.lng),l=cr([],o),u=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(t),e._centerAltitude):e._centerAltitude;Ud(o,o,l,Gr(1,0)*ei*u);const f=Bo(new Float64Array(16));return Ql(f,e.pixelMatrix,e.globeMatrix),Pn(o,o,f),new F(o[0],o[1])}pixelsPerMeter(e,t){return Gr(1,0)*t}pixelSpaceConversion(e,t,o){const l=Mi(Gr(1,45)*t,Gr(1,e)*t,o);return this.pixelsPerMeter(e,t)/l}createTileMatrix(e,t,o){const l=km(Fo(o.canonical));return Ql(new Float64Array(16),e.globeMatrix,l)}createInversionMatrix(e,t){const{center:o}=e,l=th(Fo(t));return Vd(l,l,ye(o.lng)),Qp(l,l,ye(o.lat)),Za(l,l,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(l)}pointCoordinate(e,t,o,l){return gv(e,t,o,!0)||new Yl(0,0)}pointCoordinate3D(e,t,o){const l=this.pointCoordinate(e,t,o,0);return[l.x,l.y,l.z]}isPointAboveHorizon(e,t){return!gv(e,t.x,t.y,!1)}farthestPixelDistance(e){const t=function(l,u){const f=l.cameraToCenterDistance,m=l._centerAltitude*u,v=l._camera,x=l._camera.forward(),S=qs([],co([],x,-f),[0,0,m]),M=l.worldSize/(2*Math.PI),I=[0,0,-M],P=l.width/l.height,L=Math.tan(l.fovAboveCenter),U=co([],v.up(),L),$=co([],v.right(),L*P),ee=cr([],qs([],qs([],x,U),$)),se=[];let ie;if(new om(S,ee).closestPointOnSphere(I,M,se)){const re=qs([],se,I),me=uo([],re,S);ie=Math.cos(l.fovAboveCenter)*Ou(me)}else{const re=uo([],S,I),me=uo([],I,S);cr(me,me);const ae=Ou(re)-M;ie=Math.sqrt(ae*(ae+2*M));const Ve=Math.acos(ie/(M+ae))-Math.acos(Wr(x,me));ie*=Math.cos(Ve)}return 1.01*ie}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),o=ih(e.zoom);if(o>0){const l=Ev(e,Gr(1,e.center.lat)*e.worldSize),u=e.worldSize/(2*Math.PI),f=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Mi(t,l+u*(1-Math.cos(f)),Math.pow(o,10))}return t}upVector(e,t,o){return eh(t,o,e,1)}upVectorScale(e){return{metersToTile:Am*af(Fo(e))}}}function Iv(i){const e=i.parallels,t=!!e&&Math.abs(e[0]+e[1])<.01;switch(i.name){case"mercator":return new Sv(i);case"equirectangular":return new e2(i);case"naturalEarth":return new i2(i);case"equalEarth":return new QT(i);case"winkelTripel":return new n2(i);case"albers":return t?new Mv(i):new JT(i);case"lambertConformalConic":return t?new Mv(i):new t2(i);case"globe":return new r2(i)}throw new Error(`Invalid projection name: ${i.name}`)}const o2=Xa.VectorTileFeature.types,s2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function uf(i,e,t,o,l,u,f,m,v,x,S,M,I){const P=m?Math.min($s,Math.round(m[0])):0,L=m?Math.min($s,Math.round(m[1])):0;i.emplaceBack(e,t,Math.round(32*o),Math.round(32*l),u,f,(P<<1)+(v?1:0),L,16*x,16*S,256*M,256*I)}function hf(i,e,t,o,l,u,f){i.emplaceBack(e,t,o,l,u,f)}function df(i,e,t,o,l){i.emplaceBack(e,t,o,l),i.emplaceBack(e,t,o,l),i.emplaceBack(e,t,o,l),i.emplaceBack(e,t,o,l)}function a2(i){for(const e of i.sections)if(a(e.text))return!0;return!1}class zm{constructor(e){this.layoutVertexArray=new Qi,this.indexArray=new _i,this.programConfigurations=e,this.segments=new In,this.dynamicLayoutVertexArray=new xi,this.opacityVertexArray=new ji,this.placedSymbolArray=new Ig,this.globeExtVertexArray=new dn}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,t,o,l){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,cT.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,hT.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,s2,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,uT.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Bt(zm,"SymbolBuffers");class Pm{constructor(e,t,o){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new o,this.segments=new In,this.collisionVertexArray=new en,this.collisionVertexArrayExt=new nn}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,dT.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,fT.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Bt(Pm,"CollisionBuffers");class Zs{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(f=>f.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Bo([]),this.placementViewportMatrix=Bo([]);const t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=_m(this.zoom,t["text-size"]),this.iconSizeData=_m(this.zoom,t["icon-size"]);const o=this.layers[0].layout,l=o.get("symbol-sort-key"),u=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&l.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(f=>Ur[f]),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new zm(new qa(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new zm(new qa(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Pg,this.lineVertexArray=new Dg,this.symbolInstances=new zg}calculateGlyphDependencies(e,t,o,l,u){for(let f=0;f<e.length;f++)if(t[e.charCodeAt(f)]=!0,l&&u){const m=Xu[e.charAt(f)];m&&(t[m.charCodeAt(0)]=!0)}}populate(e,t,o,l){const u=this.layers[0],f=u.layout,m=this.projection.name==="globe",v=f.get("text-font"),x=f.get("text-field"),S=f.get("icon-image"),M=(x.value.kind!=="constant"||x.value.value instanceof ar&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),I=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,P=f.get("symbol-sort-key");if(this.features=[],!M&&!I)return;const L=t.iconDependencies,U=t.glyphDependencies,$=t.availableImages,ee=new W(this.zoom);for(const{feature:se,id:ie,index:re,sourceLayerIndex:me}of e){const ae=u._featureFilter.needGeometry,Ve=$a(se,ae);if(!u._featureFilter.filter(ee,Ve,o))continue;if(ae||(Ve.geometry=as(se,o,l)),m&&se.type!==1&&o.z<=5){const je=Ve.geometry,et=.98078528056;for(let at=0;at<je.length;at++)je[at]=uw(je[at],tt=>tt,(tt,ft)=>Wr(eh(tt.x,tt.y,o,1),eh(ft.x,ft.y,o,1))<et)}let Fe,We;if(M){const je=u.getValueAndResolveTokens("text-field",Ve,o,$),et=ar.factory(je);a2(et)&&(this.hasRTLText=!0),(!this.hasRTLText||j()==="unavailable"||this.hasRTLText&&Z.isParsed())&&(Fe=_T(et,u,Ve))}if(I){const je=u.getValueAndResolveTokens("icon-image",Ve,o,$);We=je instanceof lr?je:lr.fromString(je)}if(!Fe&&!We)continue;const yt=this.sortFeaturesByKey?P.evaluate(Ve,{},o):void 0;if(this.features.push({id:ie,text:Fe,icon:We,index:re,sourceLayerIndex:me,geometry:Ve.geometry,properties:se.properties,type:o2[se.type],sortKey:yt}),We&&(L[We.name]=!0),Fe){const je=v.evaluate(Ve,{},o).join(","),et=f.get("text-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ur.vertical)>=0;for(const at of Fe.sections)if(at.image)L[at.image.name]=!0;else{const tt=Hl(Fe.toString()),ft=at.fontStack||je,lt=U[ft]=U[ft]||{};this.calculateGlyphDependencies(at.text,lt,et,this.allowVerticalPlacement,tt)}}}f.get("symbol-placement")==="line"&&(this.features=function(se){const ie={},re={},me=[];let ae=0;function Ve(je){me.push(se[je]),ae++}function Fe(je,et,at){const tt=re[je];return delete re[je],re[et]=tt,me[tt].geometry[0].pop(),me[tt].geometry[0]=me[tt].geometry[0].concat(at[0]),tt}function We(je,et,at){const tt=ie[et];return delete ie[et],ie[je]=tt,me[tt].geometry[0].shift(),me[tt].geometry[0]=at[0].concat(me[tt].geometry[0]),tt}function yt(je,et,at){const tt=at?et[0][et[0].length-1]:et[0][0];return`${je}:${tt.x}:${tt.y}`}for(let je=0;je<se.length;je++){const et=se[je],at=et.geometry,tt=et.text?et.text.toString():null;if(!tt){Ve(je);continue}const ft=yt(tt,at),lt=yt(tt,at,!0);if(ft in re&&lt in ie&&re[ft]!==ie[lt]){const kt=We(ft,lt,at),li=Fe(ft,lt,me[kt].geometry);delete ie[ft],delete re[lt],re[yt(tt,me[li].geometry,!0)]=li,me[kt].geometry=null}else ft in re?Fe(ft,lt,at):lt in ie?We(ft,lt,at):(Ve(je),ie[ft]=ae-1,re[lt]=ae-1)}return me.filter(je=>je.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((se,ie)=>se.sortKey-ie.sortKey)}update(e,t,o,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,o,l),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,o,l))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Iv(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const o=this.lineVertexArray.length,l=e.segment;if(l!==void 0){let u=e.dist(t[l+1]),f=e.dist(t[l]);const m={};for(let v=l+1;v<t.length;v++)m[v]={x:t[v].x,y:t[v].y,tileUnitDistanceFromAnchor:u},v<t.length-1&&(u+=t[v+1].dist(t[v]));for(let v=l||0;v>=0;v--)m[v]={x:t[v].x,y:t[v].y,tileUnitDistanceFromAnchor:f},v>0&&(f+=t[v-1].dist(t[v]));for(let v=0;v<t.length;v++){const x=m[v];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,t,o,l,u,f,m,v,x,S,M,I,P,L){const U=e.indexArray,$=e.layoutVertexArray,ee=e.globeExtVertexArray,se=e.segments.prepareSegment(4*t.length,$,U,this.canOverlap?f.sortKey:void 0),ie=this.glyphOffsetArray.length,re=se.vertexLength,me=this.allowVerticalPlacement&&m===Ur.vertical?Math.PI/2:0,ae=f.text&&f.text.sections;for(let Fe=0;Fe<t.length;Fe++){const{tl:We,tr:yt,bl:je,br:et,tex:at,pixelOffsetTL:tt,pixelOffsetBR:ft,minFontScaleX:lt,minFontScaleY:kt,glyphOffset:li,isSDF:hi,sectionIndex:Gt}=t[Fe],Tt=se.vertexLength,bi=li[1];if(uf($,x.x,x.y,We.x,bi+We.y,at.x,at.y,o,hi,tt.x,tt.y,lt,kt),uf($,x.x,x.y,yt.x,bi+yt.y,at.x+at.w,at.y,o,hi,ft.x,tt.y,lt,kt),uf($,x.x,x.y,je.x,bi+je.y,at.x,at.y+at.h,o,hi,tt.x,ft.y,lt,kt),uf($,x.x,x.y,et.x,bi+et.y,at.x+at.w,at.y+at.h,o,hi,ft.x,ft.y,lt,kt),v){const oi=v.anchor,Dt=v.up;hf(ee,oi.x,oi.y,oi.z,Dt[0],Dt[1],Dt[2]),hf(ee,oi.x,oi.y,oi.z,Dt[0],Dt[1],Dt[2]),hf(ee,oi.x,oi.y,oi.z,Dt[0],Dt[1],Dt[2]),hf(ee,oi.x,oi.y,oi.z,Dt[0],Dt[1],Dt[2]),df(e.dynamicLayoutVertexArray,oi.x,oi.y,oi.z,me)}else df(e.dynamicLayoutVertexArray,x.x,x.y,x.z,me);U.emplaceBack(Tt,Tt+1,Tt+2),U.emplaceBack(Tt+1,Tt+2,Tt+3),se.vertexLength+=4,se.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(li[0]),Fe!==t.length-1&&Gt===t[Fe+1].sectionIndex||e.programConfigurations.populatePaintArrays($.length,f,f.index,{},P,L,ae&&ae[Gt])}const Ve=v?v.anchor:x;e.placedSymbolArray.emplaceBack(Ve.x,Ve.y,Ve.z,x.x,x.y,ie,this.glyphOffsetArray.length-ie,re,S,M,x.segment,o?o[0]:0,o?o[1]:0,l[0],l[1],m,0,!1,0,I,0)}_commitLayoutVertex(e,t,o,l,u,f,m){e.emplaceBack(t,o,l,u,f,Math.round(m.x),Math.round(m.y))}_addCollisionDebugVertices(e,t,o,l,u,f,m){const v=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),x=v.vertexLength,S=m.tileAnchorX,M=m.tileAnchorY;for(let P=0;P<4;P++)o.collisionVertexArray.emplaceBack(0,0,0,0);o.collisionVertexArrayExt.emplaceBack(t,-e.padding,-e.padding),o.collisionVertexArrayExt.emplaceBack(t,e.padding,-e.padding),o.collisionVertexArrayExt.emplaceBack(t,e.padding,e.padding),o.collisionVertexArrayExt.emplaceBack(t,-e.padding,e.padding),this._commitLayoutVertex(o.layoutVertexArray,l,u,f,S,M,new F(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,l,u,f,S,M,new F(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,l,u,f,S,M,new F(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,l,u,f,S,M,new F(e.x1,e.y2)),v.vertexLength+=4;const I=o.indexArray;I.emplaceBack(x,x+1),I.emplaceBack(x+1,x+2),I.emplaceBack(x+2,x+3),I.emplaceBack(x+3,x),v.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,o,l,u,f){for(let m=l;m<u;m++){const v=o.get(m),x=this.getSymbolInstanceTextSize(e,f,t,m);this._addCollisionDebugVertices(v,x,this.textCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,f)}}_addIconDebugCollisionBoxes(e,t,o,l,u,f){for(let m=l;m<u;m++){const v=o.get(m),x=this.getSymbolInstanceIconSize(e,t,m);this._addCollisionDebugVertices(v,x,this.iconCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,f)}}generateCollisionDebugBuffers(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Pm(Vr,jy.members,Jn),this.iconCollisionBox=new Pm(Vr,jy.members,Jn);const o=nc(this.iconSizeData,e),l=nc(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){const f=this.symbolInstances.get(u);this._addTextDebugCollisionBoxes(l,e,t,f.textBoxStartIndex,f.textBoxEndIndex,f),this._addTextDebugCollisionBoxes(l,e,t,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f),this._addIconDebugCollisionBoxes(o,e,t,f.iconBoxStartIndex,f.iconBoxEndIndex,f),this._addIconDebugCollisionBoxes(o,e,t,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f)}}getSymbolInstanceTextSize(e,t,o,l){const u=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:l),f=Yd(this.textSizeData,e,u)/Hn;return this.tilePixelRatio*f}getSymbolInstanceIconSize(e,t,o){const l=this.icon.placedSymbolArray.get(o),u=Yd(this.iconSizeData,e,l);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(e,t,o){e.emplaceBack(t,-o,-o),e.emplaceBack(t,o,-o),e.emplaceBack(t,o,o),e.emplaceBack(t,-o,o)}_updateTextDebugCollisionBoxes(e,t,o,l,u,f){for(let m=l;m<u;m++){const v=o.get(m),x=this.getSymbolInstanceTextSize(e,f,t,m);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,x,v.padding)}}_updateIconDebugCollisionBoxes(e,t,o,l,u){for(let f=l;f<u;f++){const m=o.get(f),v=this.getSymbolInstanceIconSize(e,t,f);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,v,m.padding)}}updateCollisionDebugBuffers(e,t){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const o=nc(this.iconSizeData,e),l=nc(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){const f=this.symbolInstances.get(u);this._updateTextDebugCollisionBoxes(l,e,t,f.textBoxStartIndex,f.textBoxEndIndex,f),this._updateTextDebugCollisionBoxes(l,e,t,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f),this._updateIconDebugCollisionBoxes(o,e,t,f.iconBoxStartIndex,f.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(o,e,t,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,o,l,u,f,m,v,x){const S={};for(let M=t;M<o;M++){const I=e.get(M);S.textBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,padding:I.padding,projectedAnchorX:I.projectedAnchorX,projectedAnchorY:I.projectedAnchorY,projectedAnchorZ:I.projectedAnchorZ,tileAnchorX:I.tileAnchorX,tileAnchorY:I.tileAnchorY},S.textFeatureIndex=I.featureIndex;break}for(let M=l;M<u;M++){const I=e.get(M);S.verticalTextBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,padding:I.padding,projectedAnchorX:I.projectedAnchorX,projectedAnchorY:I.projectedAnchorY,projectedAnchorZ:I.projectedAnchorZ,tileAnchorX:I.tileAnchorX,tileAnchorY:I.tileAnchorY},S.verticalTextFeatureIndex=I.featureIndex;break}for(let M=f;M<m;M++){const I=e.get(M);S.iconBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,padding:I.padding,projectedAnchorX:I.projectedAnchorX,projectedAnchorY:I.projectedAnchorY,projectedAnchorZ:I.projectedAnchorZ,tileAnchorX:I.tileAnchorX,tileAnchorY:I.tileAnchorY},S.iconFeatureIndex=I.featureIndex;break}for(let M=v;M<x;M++){const I=e.get(M);S.verticalIconBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,padding:I.padding,projectedAnchorX:I.projectedAnchorX,projectedAnchorY:I.projectedAnchorY,projectedAnchorZ:I.projectedAnchorZ,tileAnchorX:I.tileAnchorX,tileAnchorY:I.tileAnchorY},S.verticalIconFeatureIndex=I.featureIndex;break}return S}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const o=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,t){const o=e.placedSymbolArray.get(t),l=o.vertexStartIndex+4*o.numGlyphs;for(let u=o.vertexStartIndex;u<l;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const t=Math.sin(e),o=Math.cos(e),l=[],u=[],f=[];for(let m=0;m<this.symbolInstances.length;++m){f.push(m);const v=this.symbolInstances.get(m);l.push(0|Math.round(t*v.tileAnchorX+o*v.tileAnchorY)),u.push(v.featureIndex)}return f.sort((m,v)=>l[m]-l[v]||u[v]-u[m]),f}addToSortKeyRanges(e,t){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===t?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const o=this.symbolInstances.get(t);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((l,u,f)=>{l>=0&&f.indexOf(l)===u&&this.addIndicesForPlacedSymbol(this.text,l)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Bt(Zs,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Zs.MAX_GLYPHS=65535,Zs.addDynamicAttributes=df;const l2=new Je({"symbol-placement":new le(Ce.layout_symbol["symbol-placement"]),"symbol-spacing":new le(Ce.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new le(Ce.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ve(Ce.layout_symbol["symbol-sort-key"]),"symbol-z-order":new le(Ce.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new le(Ce.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new le(Ce.layout_symbol["icon-ignore-placement"]),"icon-optional":new le(Ce.layout_symbol["icon-optional"]),"icon-rotation-alignment":new le(Ce.layout_symbol["icon-rotation-alignment"]),"icon-size":new ve(Ce.layout_symbol["icon-size"]),"icon-text-fit":new le(Ce.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new le(Ce.layout_symbol["icon-text-fit-padding"]),"icon-image":new ve(Ce.layout_symbol["icon-image"]),"icon-rotate":new ve(Ce.layout_symbol["icon-rotate"]),"icon-padding":new le(Ce.layout_symbol["icon-padding"]),"icon-keep-upright":new le(Ce.layout_symbol["icon-keep-upright"]),"icon-offset":new ve(Ce.layout_symbol["icon-offset"]),"icon-anchor":new ve(Ce.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new le(Ce.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new le(Ce.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new le(Ce.layout_symbol["text-rotation-alignment"]),"text-field":new ve(Ce.layout_symbol["text-field"]),"text-font":new ve(Ce.layout_symbol["text-font"]),"text-size":new ve(Ce.layout_symbol["text-size"]),"text-max-width":new ve(Ce.layout_symbol["text-max-width"]),"text-line-height":new ve(Ce.layout_symbol["text-line-height"]),"text-letter-spacing":new ve(Ce.layout_symbol["text-letter-spacing"]),"text-justify":new ve(Ce.layout_symbol["text-justify"]),"text-radial-offset":new ve(Ce.layout_symbol["text-radial-offset"]),"text-variable-anchor":new le(Ce.layout_symbol["text-variable-anchor"]),"text-anchor":new ve(Ce.layout_symbol["text-anchor"]),"text-max-angle":new le(Ce.layout_symbol["text-max-angle"]),"text-writing-mode":new le(Ce.layout_symbol["text-writing-mode"]),"text-rotate":new ve(Ce.layout_symbol["text-rotate"]),"text-padding":new le(Ce.layout_symbol["text-padding"]),"text-keep-upright":new le(Ce.layout_symbol["text-keep-upright"]),"text-transform":new ve(Ce.layout_symbol["text-transform"]),"text-offset":new ve(Ce.layout_symbol["text-offset"]),"text-allow-overlap":new le(Ce.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new le(Ce.layout_symbol["text-ignore-placement"]),"text-optional":new le(Ce.layout_symbol["text-optional"])});var Dm={paint:new Je({"icon-opacity":new ve(Ce.paint_symbol["icon-opacity"]),"icon-color":new ve(Ce.paint_symbol["icon-color"]),"icon-halo-color":new ve(Ce.paint_symbol["icon-halo-color"]),"icon-halo-width":new ve(Ce.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ve(Ce.paint_symbol["icon-halo-blur"]),"icon-translate":new le(Ce.paint_symbol["icon-translate"]),"icon-translate-anchor":new le(Ce.paint_symbol["icon-translate-anchor"]),"text-opacity":new ve(Ce.paint_symbol["text-opacity"]),"text-color":new ve(Ce.paint_symbol["text-color"],{runtimeType:Br,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new ve(Ce.paint_symbol["text-halo-color"]),"text-halo-width":new ve(Ce.paint_symbol["text-halo-width"]),"text-halo-blur":new ve(Ce.paint_symbol["text-halo-blur"]),"text-translate":new le(Ce.paint_symbol["text-translate"]),"text-translate-anchor":new le(Ce.paint_symbol["text-translate-anchor"])}),layout:l2};class kv{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Ts,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Bt(kv,"FormatSectionOverride",{omit:["defaultValue"]});class ff extends lo{constructor(e){super(e,Dm)}recalculate(e,t){super.recalculate(e,t),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const o=this.layout.get("text-writing-mode");if(o){const l=[];for(const u of o)l.indexOf(u)<0&&l.push(u);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,t,o,l){const u=this.layout.get(e).evaluate(t,{},o,l),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||Ol(f.value)||!u?u:function(m,v){return v.replace(/{([^{}]+)}/g,(x,S)=>S in m?String(m[S]):"")}(t.properties,u)}createBucket(e){return new Zs(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Dm.paint.overridableProperties){if(!ff.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),o=new kv(t),l=new _u(o,t.property.specification);let u=null;u=t.value.kind==="constant"||t.value.kind==="source"?new gu("source",l):new ka("composite",l,t.value.zoomStops,t.value._interpolationType),this.paint._values[e]=new oe(t.property,u,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,o){return!(!this.layout||t.isDataDriven()||o.isDataDriven())&&ff.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const o=e.get("text-field"),l=Dm.paint.properties[t];let u=!1;const f=m=>{for(const v of m)if(l.overrides&&l.overrides.hasOverride(v))return void(u=!0)};if(o.value.kind==="constant"&&o.value.value instanceof ar)f(o.value.value.sections);else if(o.value.kind==="source"){const m=x=>{u||(x instanceof ya&&yn(x.value)===pa?f(x.value.sections):x instanceof xa?f(x.sections):x.eachChild(m))},v=o.value;v._styleExpression&&m(v._styleExpression.expression)}return u}getProgramConfiguration(e){return new Ns(this,e)}}var c2={paint:new Je({"background-color":new le(Ce.paint_background["background-color"]),"background-pattern":new dt(Ce.paint_background["background-pattern"]),"background-opacity":new le(Ce.paint_background["background-opacity"])})},u2={paint:new Je({"raster-opacity":new le(Ce.paint_raster["raster-opacity"]),"raster-hue-rotate":new le(Ce.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new le(Ce.paint_raster["raster-brightness-min"]),"raster-brightness-max":new le(Ce.paint_raster["raster-brightness-max"]),"raster-saturation":new le(Ce.paint_raster["raster-saturation"]),"raster-contrast":new le(Ce.paint_raster["raster-contrast"]),"raster-resampling":new le(Ce.paint_raster["raster-resampling"]),"raster-fade-duration":new le(Ce.paint_raster["raster-fade-duration"])})};class h2 extends lo{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var d2={paint:new Je({"sky-type":new le(Ce.paint_sky["sky-type"]),"sky-atmosphere-sun":new le(Ce.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new le(Ce.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new le(Ce.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new le(Ce.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ae(Ce.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new le(Ce.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new le(Ce.paint_sky["sky-atmosphere-color"]),"sky-opacity":new le(Ce.paint_sky["sky-opacity"])})};function Lm(i,e,t){const o=[0,0,1],l=hy([]);return fy(l,l,t?-ye(i)+Math.PI:ye(i)),dy(l,l,-ye(e)),ly(o,o,l),cr(o,o)}const f2={circle:class extends lo{constructor(i){super(i,gw)}createBucket(i){return new Xp(i)}queryRadius(i){const e=i;return Jl("circle-radius",this,e)+Jl("circle-stroke-width",this,e)+Fd(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,t,o,l,u,f,m){const v=iy(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),x=this.paint.get("circle-radius").evaluate(e,t)+this.paint.get("circle-stroke-width").evaluate(e,t);return py(i,o,u,f,m,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",v,x)}getProgramIds(){return["circle"]}getProgramConfiguration(i){return new Ns(this,i)}},heatmap:class extends lo{createBucket(i){return new _y(i)}constructor(i){super(i,Ew),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=cm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return Jl("heatmap-radius",this,i)}queryIntersectsFeature(i,e,t,o,l,u,f,m){const v=this.paint.get("heatmap-radius").evaluate(e,t);return py(i,o,u,f,m,!0,!0,new F(0,0),v)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(i){return new Ns(this,i)}},hillshade:class extends lo{constructor(i){super(i,Sw)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends lo{constructor(i){super(i,jw)}getProgramIds(){const i=this.paint.get("fill-pattern"),e=i&&i.constantOr(1),t=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&t.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),t}getProgramConfiguration(i){return new Ns(this,i)}recalculate(i,e){super.recalculate(i,e);const t=this.paint._values["fill-outline-color"];t.value.kind==="constant"&&t.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Zd(i)}queryRadius(){return Fd(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,t,o,l,u){return!i.queryGeometry.isAboveHorizon&&Yg(ty(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),o)}isTileClipped(){return!0}},"fill-extrusion":class extends lo{constructor(i){super(i,tT)}createBucket(i){return new Zu(i)}queryRadius(){return Fd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(i){return new Ns(this,i)}queryIntersectsFeature(i,e,t,o,l,u,f,m,v){const x=iy(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),S=this.paint.get("fill-extrusion-height").evaluate(e,t),M=this.paint.get("fill-extrusion-base").evaluate(e,t),I=[0,0],P=m&&u.elevation,L=u.elevation?u.elevation.exaggeration():1,U=i.tile.getBucket(this);if(P&&U instanceof Zu){const se=U.centroidVertexArray,ie=v+1;if(ie<se.length){const re=se.get(ie);I[0]=re.a_centroid_pos0,I[1]=re.a_centroid_pos1}}if(I[0]===0&&I[1]===1)return!1;u.projection.name==="globe"&&(o=Ly([o],[new F(0,0),new F(ei,ei)],i.tileID.canonical).map(se=>se.polygon).flat());const $=function(se,ie,re,me,ae,Ve,Fe,We,yt,je,et){return se.projection.name==="globe"?function(at,tt,ft,lt,kt,li,hi,Gt,Tt,bi,oi){const Dt=[],Yi=[],Zi=at.projection.upVectorScale(oi,at.center.lat,at.worldSize).metersToTile,rn=[0,0,0,1],fi=[0,0,0,1],ki=(Wi,qi,tn,an)=>{Wi[0]=qi,Wi[1]=tn,Wi[2]=an,Wi[3]=1},Ji=Dy();ft>0&&(ft+=Ji),lt+=Ji;for(const Wi of tt){const qi=[],tn=[];for(const an of Wi){const On=an.x+kt.x,xr=an.y+kt.y,Ti=at.projection.projectTilePoint(On,xr,oi),mn=at.projection.upVector(oi,an.x,an.y);let er=ft,Fi=lt;if(hi){const ln=Oy(On,xr,ft,lt,hi,Gt,Tt,bi);er+=ln.base,Fi+=ln.top}ft!==0?ki(rn,Ti.x+mn[0]*Zi*er,Ti.y+mn[1]*Zi*er,Ti.z+mn[2]*Zi*er):ki(rn,Ti.x,Ti.y,Ti.z),ki(fi,Ti.x+mn[0]*Zi*Fi,Ti.y+mn[1]*Zi*Fi,Ti.z+mn[2]*Zi*Fi),Pn(rn,rn,li),Pn(fi,fi,li),qi.push(Xd(rn)),tn.push(Xd(fi))}Dt.push(qi),Yi.push(tn)}return[Dt,Yi]}(se,ie,re,me,ae,Ve,Fe,We,yt,je,et):Fe?function(at,tt,ft,lt,kt,li,hi,Gt,Tt){const bi=[],oi=[],Dt=[0,0,0,1];for(const Yi of at){const Zi=[],rn=[];for(const fi of Yi){const ki=fi.x+lt.x,Ji=fi.y+lt.y,Wi=Oy(ki,Ji,tt,ft,li,hi,Gt,Tt);Dt[0]=ki,Dt[1]=Ji,Dt[2]=Wi.base,Dt[3]=1,Wa(Dt,Dt,kt),Dt[3]=Math.max(Dt[3],1e-5);const qi=Xd([Dt[0]/Dt[3],Dt[1]/Dt[3],Dt[2]/Dt[3]]);Dt[0]=ki,Dt[1]=Ji,Dt[2]=Wi.top,Dt[3]=1,Wa(Dt,Dt,kt),Dt[3]=Math.max(Dt[3],1e-5);const tn=Xd([Dt[0]/Dt[3],Dt[1]/Dt[3],Dt[2]/Dt[3]]);Zi.push(qi),rn.push(tn)}bi.push(Zi),oi.push(rn)}return[bi,oi]}(ie,re,me,ae,Ve,Fe,We,yt,je):function(at,tt,ft,lt,kt){const li=[],hi=[],Gt=kt[8]*tt,Tt=kt[9]*tt,bi=kt[10]*tt,oi=kt[11]*tt,Dt=kt[8]*ft,Yi=kt[9]*ft,Zi=kt[10]*ft,rn=kt[11]*ft;for(const fi of at){const ki=[],Ji=[];for(const Wi of fi){const qi=Wi.x+lt.x,tn=Wi.y+lt.y,an=kt[0]*qi+kt[4]*tn+kt[12],On=kt[1]*qi+kt[5]*tn+kt[13],xr=kt[2]*qi+kt[6]*tn+kt[14],Ti=kt[3]*qi+kt[7]*tn+kt[15],mn=an+Gt,er=On+Tt,Fi=xr+bi,ln=Math.max(Ti+oi,1e-5),hr=an+Dt,on=On+Yi,vn=xr+Zi,Vn=Math.max(Ti+rn,1e-5),Ln=new F(mn/ln,er/ln);Ln.z=Fi/ln,ki.push(Ln);const Xn=new F(hr/Vn,on/Vn);Xn.z=vn/Vn,Ji.push(Xn)}li.push(ki),hi.push(Ji)}return[li,hi]}(ie,re,me,ae,Ve)}(u,o,M,S,x,f,P?m:null,I,L,u.center.lat,i.tileID.canonical),ee=i.queryGeometry;return function(se,ie,re){let me=1/0;Yg(re,ie)&&(me=Fy(re,ie[0]));for(let ae=0;ae<ie.length;ae++){const Ve=ie[ae],Fe=se[ae];for(let We=0;We<Ve.length-1;We++){const yt=Ve[We],je=[yt,Ve[We+1],Fe[We+1],Fe[We],yt];Kg(re,je)&&(me=Math.min(me,Fy(re,je)))}}return me!==1/0&&me}($[0],$[1],ee.isPointQuery()?ee.screenBounds:ee.screenGeometry)}},line:class extends lo{constructor(i){super(i,Vy),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Kc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=Uy.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Kd(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(i){return new Ns(this,i)}queryRadius(i){const e=i,t=Ny(Jl("line-width",this,e),Jl("line-gap-width",this,e)),o=Jl("line-offset",this,e);return t/2+Math.abs(o)+Fd(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,t,o,l,u){if(i.queryGeometry.isAboveHorizon)return!1;const f=ty(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),m=i.pixelToTileUnitsFactor/2*Ny(this.paint.get("line-width").evaluate(e,t),this.paint.get("line-gap-width").evaluate(e,t)),v=this.paint.get("line-offset").evaluate(e,t);return v&&(o=function(x,S){const M=[],I=new F(0,0);for(let P=0;P<x.length;P++){const L=x[P],U=[];for(let $=0;$<L.length;$++){const ee=L[$-1],se=L[$],ie=L[$+1],re=$===0?I:se.sub(ee)._unit()._perp(),me=$===L.length-1?I:ie.sub(se)._unit()._perp(),ae=re._add(me)._unit();ae._mult(1/(ae.x*me.x+ae.y*me.y)),U.push(ae._mult(S)._add(se))}M.push(U)}return M}(o,v*i.pixelToTileUnitsFactor)),function(x,S,M){for(let I=0;I<S.length;I++){const P=S[I];if(x.length>=3){for(let L=0;L<P.length;L++)if(Ga(x,P[L]))return!0}if(fw(x,P,M))return!0}return!1}(f,o,m)}isTileClipped(){return!0}},symbol:ff,background:class extends lo{constructor(i){super(i,c2)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends lo{constructor(i){super(i,u2)}getProgramIds(){return["raster"]}},sky:class extends lo{constructor(i){super(i,d2),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=cm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(i,e){if(this.paint.get("sky-type")==="atmosphere"){const o=this.paint.get("sky-atmosphere-sun"),l=!o,u=i.style.light,f=u.properties.get("position");return l&&u.properties.get("anchor")==="viewport"&&xt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),l?Lm(f.azimuthal,90-f.polar,e):Lm(o[0],90-o[1],e)}const t=this.paint.get("sky-gradient-center");return Lm(t[0],90-t[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}}};class ah{constructor(e,t,o,l){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(t,l)}update(e,t,o){const{width:l,height:u}=e,{context:f}=this,{gl:m}=f,{HTMLImageElement:v,HTMLCanvasElement:x,HTMLVideoElement:S,ImageData:M,ImageBitmap:I}=D;if(m.bindTexture(m.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===m.RGBA&&(!t||t.premultiply!==!1)),o||this.size&&this.size[0]===l&&this.size[1]===u){const{x:P,y:L}=o||{x:0,y:0};e instanceof v||e instanceof x||e instanceof S||e instanceof M||I&&e instanceof I?m.texSubImage2D(m.TEXTURE_2D,0,P,L,m.RGBA,m.UNSIGNED_BYTE,e):m.texSubImage2D(m.TEXTURE_2D,0,P,L,l,u,m.RGBA,m.UNSIGNED_BYTE,e.data)}else this.size=[l,u],e instanceof v||e instanceof x||e instanceof S||e instanceof M||I&&e instanceof I?m.texImage2D(m.TEXTURE_2D,0,this.format,this.format,m.UNSIGNED_BYTE,e):m.texImage2D(m.TEXTURE_2D,0,this.format,l,u,0,this.format,m.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(t&&t.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&m.generateMipmap(m.TEXTURE_2D)}bind(e,t){const{context:o}=this,{gl:l}=o;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.filter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,this.useMipmap?e===l.NEAREST?l.NEAREST_MIPMAP_NEAREST:l.LINEAR_MIPMAP_NEAREST:e),this.filter=e),t!==this.wrap&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,t),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,t),this.wrap=t)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Bm{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new ls({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const o=this.getKey(e,t);return this.positions[o]}trim(){const e=this.width,t=this.height=Ye(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,o){const l=[];let u=e.length%2==1?-e[e.length-1]*o:0,f=e[0]*o,m=!0;l.push({left:u,right:f,isDash:m,zeroLength:e[0]===0});let v=e[0];for(let x=1;x<e.length;x++){m=!m;const S=e[x];u=v*o,v+=S,f=v*o,l.push({left:u,right:f,isDash:m,zeroLength:S===0})}return l}addRoundDash(e,t,o){const l=t/2;for(let u=-o;u<=o;u++){const f=this.width*(this.nextRow+o+u);let m=0,v=e[m];for(let x=0;x<this.width;x++){x/v.right>1&&(v=e[++m]);const S=Math.abs(x-v.left),M=Math.abs(x-v.right),I=Math.min(S,M);let P;const L=u/o*(l+1);if(v.isDash){const U=l-Math.abs(L);P=Math.sqrt(I*I+U*U)}else P=l-Math.sqrt(I*I+L*L);this.image.data[f+x]=Math.max(0,Math.min(255,P+128))}}}addRegularDash(e,t){for(let v=e.length-1;v>=0;--v){const x=e[v],S=e[v+1];x.zeroLength?e.splice(v,1):S&&S.isDash===x.isDash&&(S.left=x.left,e.splice(v,1))}const o=e[0],l=e[e.length-1];o.isDash===l.isDash&&(o.left=l.left-this.width,l.right=o.right+this.width);const u=this.width*this.nextRow;let f=0,m=e[f];for(let v=0;v<this.width;v++){v/m.right>1&&(m=e[++f]);const x=Math.abs(v-m.left),S=Math.abs(v-m.right),M=Math.min(x,S);this.image.data[u+v]=Math.max(0,Math.min(255,(m.isDash?M:-M)+t+128))}}addDash(e,t){const o=this.getKey(e,t);if(this.positions[o])return this.positions[o];const l=t==="round",u=l?7:0,f=2*u+1;if(this.nextRow+f>this.height)return xt("LineAtlas out of space"),null;e.length===0&&e.push(1);let m=0;for(let S=0;S<e.length;S++)e[S]<0&&(xt("Negative value is found in line dasharray, replacing values with 0"),e[S]=0),m+=e[S];if(m!==0){const S=this.width/m,M=this.getDashRanges(e,this.width,S);l?this.addRoundDash(M,S,u):this.addRegularDash(M,t==="square"?.5*S:0)}const v=this.nextRow+u;this.nextRow+=f;const x={tl:[v,u],br:[m,0]};return this.positions[o]=x,x}}Bt(Bm,"LineAtlas");class p2{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class m2{constructor(){this.tasks={},this.taskQueue=[],Ht(["process"],this),this.invoker=new p2(this.process),this.nextId=0}add(e,t){const o=this.nextId++,l=function({type:u,isSymbolTile:f,zoom:m}){return m=m||0,u==="message"?0:u!=="maybePrepare"||f?u!=="parseTile"||f?u==="parseTile"&&f?300-m:u==="maybePrepare"&&f?400-m:500:200-m:100-m}(t);if(l===0){Ci();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[o]={fn:e,metadata:t,priority:l,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){Ci();try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let l=0;l<this.taskQueue.length;l++){const u=this.tasks[this.taskQueue[l]];u.priority<t&&(t=u.priority,e=l)}if(e===null)return null;const o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}class zv{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const o=e[t];this._stringToNumber[o]=t,this._numberToString[t]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const _2=["tile","layer","source","sourceLayer","state"];class Pv{constructor(e,t,o,l,u){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=o,this._y=l,this.properties=e.properties,this.id=u}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const t of _2)this[t]!==void 0&&(e[t]=this[t]);return e}}const Hr=32,Oo=33,Ws=new Uint16Array(8184);for(let i=0;i<2046;i++){let e=i+2,t=0,o=0,l=0,u=0,f=0,m=0;for(1&e?l=u=f=Hr:t=o=m=Hr;(e>>=1)>1;){const x=t+l>>1,S=o+u>>1;1&e?(l=t,u=o,t=f,o=m):(t=l,o=u,l=f,u=m),f=x,m=S}const v=4*i;Ws[v+0]=t,Ws[v+1]=o,Ws[v+2]=l,Ws[v+3]=u}const Vo=new Uint16Array(2178),Hs=new Uint8Array(1089),pf=new Uint16Array(1089);function Dv(i){return i===0?-.03125:i===32?.03125:0}var Lv=it([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Bv={type:2,extent:ei,loadGeometry:()=>[[new F(0,0),new F(8193,0),new F(8193,8193),new F(0,8193),new F(0,0)]]};class Rm{constructor(e,t,o,l,u){this.tileID=e,this.uid=$e(),this.uses=0,this.tileSize=t,this.tileZoom=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=u,this.expiredRequestCount=0,this.state="loading",l&&l.transform&&(this.projection=l.transform.projection)}registerFadeDuration(e){const t=e+this.timeAdded;t<Mt.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Ka(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,t,o){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(l,u){const f={};if(!u)return f;for(const m of l){const v=m.layerIds.map(x=>u.getLayer(x)).filter(Boolean);if(v.length!==0){m.layers=v,m.stateDependentLayerIds&&(m.stateDependentLayers=m.stateDependentLayerIds.map(x=>v.filter(S=>S.id===x)[0]));for(const x of v)f[x.id]=m}}return f}(e.buckets,t.style),this.hasSymbolBuckets=!1;for(const l in this.buckets){const u=this.buckets[l];if(u instanceof Zs){if(this.hasSymbolBuckets=!0,!o)break;u.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const l in this.buckets){const u=this.buckets[l];if(u instanceof Zs&&u.hasRTLText){this.hasRTLText=!0,Z.isLoading()||Z.isLoaded()||j()!=="deferred"||K();break}}this.queryPadding=0;for(const l in this.buckets){const u=this.buckets[l];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(l).queryRadius(u))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Po}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const o in this.buckets){const l=this.buckets[o];l.uploadPending()&&l.upload(e)}const t=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ah(e,this.imageAtlas.image,t.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ah(e,this.glyphAtlasImage,t.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new ah(e,this.lineAtlas.image,t.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,t,o,l,u,f,m,v){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:l,pixelPosMatrix:m,transform:f,params:u,tileTransform:this.tileTransform},e,t,o):{}}querySourceFeatures(e,t){const o=this.latestFeatureIndex;if(!o||!o.rawTileData)return;const l=o.loadVTLayers(),u=t?t.sourceLayer:"",f=l._geojsonTileLayer||l[u];if(!f)return;const m=La(t&&t.filter),{z:v,x,y:S}=this.tileID.canonical,M={z:v,x,y:S};for(let I=0;I<f.length;I++){const P=f.feature(I);if(m.needGeometry){const $=$a(P,!0);if(!m.filter(new W(this.tileID.overscaledZ),$,this.tileID.canonical))continue}else if(!m.filter(new W(this.tileID.overscaledZ),P))continue;const L=o.getId(P,u),U=new Pv(P,v,x,S,L);U.tile=M,e.push(U)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const t=this.expirationTime;if(e.cacheControl){const o=Kt(e.cacheControl);o["max-age"]&&(this.expirationTime=Date.now()+1e3*o["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const o=Date.now();let l=!1;if(this.expirationTime>o)l=!1;else if(t)if(this.expirationTime<t)l=!0;else{const u=this.expirationTime-t;u?this.expirationTime=o+Math.max(u,3e4):l=!0}else l=!0;l?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!t)return;const o=this.latestFeatureIndex.loadVTLayers(),l=t.style.listImages();for(const u in this.buckets){if(!t.style.hasLayer(u))continue;const f=this.buckets[u],m=f.layers[0].sourceLayer||"_geojsonTileLayer",v=o[m],x=e[m];if(!v||!x||Object.keys(x).length===0)continue;if(f.update(x,v,l,this.imageAtlas&&this.imageAtlas.patternPositions||{}),f instanceof Kd||f instanceof Zd){const M=t.style._getSourceCache(f.layers[0].source);t._terrain&&t._terrain.enabled&&M&&f.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(M.id,this.tileID)}const S=t&&t.style&&t.style.getLayer(u);S&&(this.queryPadding=Math.max(this.queryPadding,S.queryRadius(f)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Mt.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Mt.now()+e}setTexture(e,t){const o=t.context,l=o.gl;this.texture=t.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new ah(o,e,l.RGBA,{useMipmap:!0}),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),o.extTextureFilterAnisotropic&&l.texParameterf(l.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax))}setDependencies(e,t){const o={};for(const l of t)o[l]=!0;this.dependencies[e]=o}hasDependency(e,t){for(const o of e){const l=this.dependencies[o];if(l){for(const u of t)if(l[u])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,t){if(!t||t.name==="mercator"||this._tileDebugBuffer)return;const o=as(Bv,this.tileID.canonical,this.tileTransform)[0],l=new St,u=new es;for(let f=0;f<o.length;f++){const{x:m,y:v}=o[f];l.emplaceBack(m,v),u.emplaceBack(f)}u.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(u),this._tileDebugBuffer=e.createVertexBuffer(l,Qu.members),this._tileDebugSegments=In.simpleSegment(0,0,l.length,u.length)}_makeTileBoundsBuffers(e,t){if(this._tileBoundsBuffer||!t||t.name==="mercator")return;const o=as(Bv,this.tileID.canonical,this.tileTransform)[0];let l,u;if(this.isRaster){const f=function(m,v){const x=Ka(m,v),S=Math.pow(2,m.z);for(let $=0;$<Oo;$++)for(let ee=0;ee<Oo;ee++){const se=Zr((m.x+(ee+Dv(ee))/Hr)/S),ie=Wn((m.y+($+Dv($))/Hr)/S),re=v.project(se,ie),me=$*Oo+ee;Vo[2*me+0]=Math.round((re.x*x.scale-x.x)*ei),Vo[2*me+1]=Math.round((re.y*x.scale-x.y)*ei)}Hs.fill(0),pf.fill(0);for(let $=2045;$>=0;$--){const ee=4*$,se=Ws[ee+0],ie=Ws[ee+1],re=Ws[ee+2],me=Ws[ee+3],ae=se+re>>1,Ve=ie+me>>1,Fe=ae+Ve-ie,We=Ve+se-ae,yt=ie*Oo+se,je=me*Oo+re,et=Ve*Oo+ae,at=Math.hypot((Vo[2*yt+0]+Vo[2*je+0])/2-Vo[2*et+0],(Vo[2*yt+1]+Vo[2*je+1])/2-Vo[2*et+1])>=16;if(Hs[et]=Hs[et]||(at?1:0),$<1022){const tt=(ie+We>>1)*Oo+(se+Fe>>1),ft=(me+We>>1)*Oo+(re+Fe>>1);Hs[et]=Hs[et]||Hs[tt]||Hs[ft]}}const M=new Wt,I=new _i;let P=0;function L($,ee){const se=ee*Oo+$;return pf[se]===0&&(M.emplaceBack(Vo[2*se+0],Vo[2*se+1],$*ei/Hr,ee*ei/Hr),pf[se]=++P),pf[se]-1}function U($,ee,se,ie,re,me){const ae=$+se>>1,Ve=ee+ie>>1;if(Math.abs($-re)+Math.abs(ee-me)>1&&Hs[Ve*Oo+ae])U(re,me,$,ee,ae,Ve),U(se,ie,re,me,ae,Ve);else{const Fe=L($,ee),We=L(se,ie),yt=L(re,me);I.emplaceBack(Fe,We,yt)}}return U(0,0,Hr,Hr,Hr,0),U(Hr,Hr,0,0,0,Hr),{vertices:M,indices:I}}(this.tileID.canonical,t);l=f.vertices,u=f.indices}else{l=new Wt,u=new _i;for(const{x:m,y:v}of o)l.emplaceBack(m,v,0,0);const f=Nd(l.int16,void 0,4);for(let m=0;m<f.length;m+=3)u.emplaceBack(f[m],f[m+1],f[m+2])}this._tileBoundsBuffer=e.createVertexBuffer(l,Lv.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(u),this._tileBoundsSegments=In.simpleSegment(0,0,l.length,u.length)}_makeGlobeTileDebugBuffers(e,t){const o=t.projection;if(!o||o.name!=="globe"||t.freezeTileCoverage)return;const l=this.tileID.canonical,u=th(yv(l,t)),f=ih(t.zoom);let m;f>0&&(m=Jp(new Float64Array(16),t.globeMatrix));const v=(l.x+.5)/(1<<l.z)-Do(t.center.lng);let x=0;v>.5?x=-1:v<-.5&&(x=1),this._makeGlobeTileDebugBorderBuffer(e,l,t,u,m,f,x),this._makeGlobeTileDebugTextBuffer(e,l,t,u,m,f,x)}_globePoint(e,t,o,l,u,f,m,v){let x=eh(e,t,o);if(f){const S=1<<o.z,M=[((e/ei+o.x)/S+v)*l,(t/ei+o.y)/S*l,0];Pn(M,M,f),x=As(x,M,m)}return Pn(x,x,u)}_makeGlobeTileDebugBorderBuffer(e,t,o,l,u,f,m){const v=new St,x=new es,S=new Vt,M=(P,L,U,$,ee)=>{const se=(U-P)/(ee-1),ie=($-L)/(ee-1),re=v.length;for(let me=0;me<ee;me++){const ae=P+me*se,Ve=L+me*ie;v.emplaceBack(ae,Ve);const Fe=this._globePoint(ae,Ve,t,o.worldSize,l,u,f,m);S.emplaceBack(Fe[0],Fe[1],Fe[2]),x.emplaceBack(re+me)}},I=ei;M(0,0,I,0,16),M(I,0,I,I,16),M(I,I,0,I,16),M(0,I,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(x),this._tileDebugBuffer=e.createVertexBuffer(v,Qu.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(S,_v.members),this._tileDebugSegments=In.simpleSegment(0,0,v.length,x.length)}_makeGlobeTileDebugTextBuffer(e,t,o,l,u,f,m){const v=new St,x=new _i,S=new Vt,M=25;x.reserve(32),v.reserve(M),S.reserve(M);const I=(P,L)=>M*P+L;for(let P=0;P<M;P++){const L=2048*P;for(let U=0;U<M;U++){const $=2048*U;v.emplaceBack($,L);const ee=this._globePoint($,L,t,o.worldSize,l,u,f,m);S.emplaceBack(ee[0],ee[1],ee[2])}}for(let P=0;P<4;P++)for(let L=0;L<4;L++){const U=I(P,L),$=I(P,L+1),ee=I(P+1,L),se=I(P+1,L+1);x.emplaceBack(U,$,ee),x.emplaceBack(ee,$,se)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(x),this._tileDebugTextBuffer=e.createVertexBuffer(v,Qu.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(S,_v.members),this._tileDebugTextSegments=In.simpleSegment(0,0,M,32)}}class g2{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,t,o){const l=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][l]=this.stateChanges[e][l]||{},Ue(this.stateChanges[e][l],o),this.deletedStates[e]===null){this.deletedStates[e]={};for(const u in this.state[e])u!==l&&(this.deletedStates[e][u]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][l]===null){this.deletedStates[e][l]={};for(const u in this.state[e][l])o[u]||(this.deletedStates[e][l][u]=null)}else for(const u in o)this.deletedStates[e]&&this.deletedStates[e][l]&&this.deletedStates[e][l][u]===null&&delete this.deletedStates[e][l][u]}removeFeatureState(e,t,o){if(this.deletedStates[e]===null)return;const l=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},o&&t!==void 0)this.deletedStates[e][l]!==null&&(this.deletedStates[e][l]=this.deletedStates[e][l]||{},this.deletedStates[e][l][o]=null);else if(t!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][l])for(o in this.deletedStates[e][l]={},this.stateChanges[e][l])this.deletedStates[e][l][o]=null;else this.deletedStates[e][l]=null;else this.deletedStates[e]=null}getState(e,t){const o=String(t),l=Ue({},(this.state[e]||{})[o],(this.stateChanges[e]||{})[o]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const u=this.deletedStates[e][t];if(u===null)return{};for(const f in u)delete l[f]}return l}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,t){const o={};for(const l in this.stateChanges){this.state[l]=this.state[l]||{};const u={};for(const f in this.stateChanges[l])this.state[l][f]||(this.state[l][f]={}),Ue(this.state[l][f],this.stateChanges[l][f]),u[f]=this.state[l][f];o[l]=u}for(const l in this.deletedStates){this.state[l]=this.state[l]||{};const u={};if(this.deletedStates[l]===null)for(const f in this.state[l])u[f]={},this.state[l][f]={};else for(const f in this.deletedStates[l]){if(this.deletedStates[l][f]===null)this.state[l][f]={};else for(const m of Object.keys(this.deletedStates[l][f]))delete this.state[l][f][m];u[f]=this.state[l][f]}o[l]=o[l]||{},Ue(o[l],u)}if(this.stateChanges={},this.deletedStates={},Object.keys(o).length!==0)for(const l in e)e[l].setFeatureState(o,t)}}class Rv{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const o=this.toIdx(e,t);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function Fv(i,e,t,o){let l=0,u=Number.MAX_VALUE;for(let f=0;f<3;f++)if(Math.abs(o[f])<1e-15){if(t[f]<i[f]||t[f]>e[f])return null}else{const m=1/o[f];let v=(i[f]-t[f])*m,x=(e[f]-t[f])*m;if(v>x){const S=v;v=x,x=S}if(v>l&&(l=v),x<u&&(u=x),l>u)return null}return l}function Ov(i,e,t,o,l,u,f,m,v,x,S){const M=o-i,I=l-e,P=u-t,L=f-i,U=m-e,$=v-t,ee=S[1]*$-S[2]*U,se=S[2]*L-S[0]*$,ie=S[0]*U-S[1]*L,re=M*ee+I*se+P*ie;if(Math.abs(re)<1e-15)return null;const me=1/re,ae=x[0]-i,Ve=x[1]-e,Fe=x[2]-t,We=(ae*ee+Ve*se+Fe*ie)*me;if(We<0||We>1)return null;const yt=Ve*P-Fe*I,je=Fe*M-ae*P,et=ae*I-Ve*M,at=(S[0]*yt+S[1]*je+S[2]*et)*me;return at<0||We+at>1?null:(L*yt+U*je+$*et)*me}function Vv(i,e,t){return(i-e)/(t-e)}function Uv(i,e,t,o,l,u,f,m,v){const x=1<<t,S=u-o,M=f-l,I=(i+1)/x*S+o,P=(e+0)/x*M+l,L=(e+1)/x*M+l;m[0]=(i+0)/x*S+o,m[1]=P,v[0]=I,v[1]=L}class Nv{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(u){const f=Math.ceil(Math.log2(u.dim/8)),m=[];let v=Math.ceil(Math.pow(2,f));const x=1/v,S=(P,L,U,$,ee)=>{const se=$?1:0,ie=(P+1)*U-se,re=L*U,me=(L+1)*U-se;ee[0]=P*U,ee[1]=re,ee[2]=ie,ee[3]=me};let M=new Rv(v);const I=[];for(let P=0;P<v*v;P++){S(P%v,Math.floor(P/v),x,!1,I);const L=Xs(I[0],I[1],u),U=Xs(I[2],I[1],u),$=Xs(I[2],I[3],u),ee=Xs(I[0],I[3],u);M.minimums.push(Math.min(L,U,$,ee)),M.maximums.push(Math.max(L,U,$,ee)),M.leaves.push(1)}for(m.push(M),v/=2;v>=1;v/=2){const P=m[m.length-1];M=new Rv(v);for(let L=0;L<v*v;L++){S(L%v,Math.floor(L/v),2,!0,I);const U=P.getElevation(I[0],I[1]),$=P.getElevation(I[2],I[1]),ee=P.getElevation(I[2],I[3]),se=P.getElevation(I[0],I[3]),ie=P.isLeaf(I[0],I[1]),re=P.isLeaf(I[2],I[1]),me=P.isLeaf(I[2],I[3]),ae=P.isLeaf(I[0],I[3]),Ve=Math.min(U.min,$.min,ee.min,se.min),Fe=Math.max(U.max,$.max,ee.max,se.max),We=ie&&re&&me&&ae;M.maximums.push(Fe),M.minimums.push(Ve),M.leaves.push(Fe-Ve<=5&&We?1:0)}m.push(M)}return m}(this.dem),o=t.length-1,l=t[o];this._addNode(l.minimums[0],l.maximums[0],l.leaves[0]),this._construct(t,0,0,o,0)}raycastRoot(e,t,o,l,u,f,m=1){return Fv([e,t,-100],[o,l,this.maximums[0]*m],u,f)}raycast(e,t,o,l,u,f,m=1){if(!this.nodeCount)return null;const v=this.raycastRoot(e,t,o,l,u,f,m);if(v==null)return null;const x=[],S=[],M=[],I=[],P=[{idx:0,t:v,nodex:0,nodey:0,depth:0}];for(;P.length>0;){const{idx:L,t:U,nodex:$,nodey:ee,depth:se}=P.pop();if(this.leaves[L]){Uv($,ee,se,e,t,o,l,M,I);const re=1<<se,me=($+0)/re,ae=($+1)/re,Ve=(ee+0)/re,Fe=(ee+1)/re,We=Xs(me,Ve,this.dem)*m,yt=Xs(ae,Ve,this.dem)*m,je=Xs(ae,Fe,this.dem)*m,et=Xs(me,Fe,this.dem)*m,at=Ov(M[0],M[1],We,I[0],M[1],yt,I[0],I[1],je,u,f),tt=Ov(I[0],I[1],je,M[0],I[1],et,M[0],M[1],We,u,f),ft=Math.min(at!==null?at:Number.MAX_VALUE,tt!==null?tt:Number.MAX_VALUE);if(ft!==Number.MAX_VALUE)return ft;{const lt=Ud([],u,f,U);if(jv(We,yt,et,je,Vv(lt[0],M[0],I[0]),Vv(lt[1],M[1],I[1]))>=lt[2])return U}continue}let ie=0;for(let re=0;re<this._siblingOffset.length;re++){Uv(($<<1)+this._siblingOffset[re][0],(ee<<1)+this._siblingOffset[re][1],se+1,e,t,o,l,M,I),M[2]=-100,I[2]=this.maximums[this.childOffsets[L]+re]*m;const me=Fv(M,I,u,f);if(me!=null){const ae=me;x[re]=ae;let Ve=!1;for(let Fe=0;Fe<ie&&!Ve;Fe++)ae>=x[S[Fe]]&&(S.splice(Fe,0,re),Ve=!0);Ve||(S[ie]=re),ie++}}for(let re=0;re<ie;re++){const me=S[re];P.push({idx:this.childOffsets[L]+me,t:x[me],nodex:($<<1)+this._siblingOffset[me][0],nodey:(ee<<1)+this._siblingOffset[me][1],depth:se+1})}}return null}_addNode(e,t,o){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,o,l,u){if(e[l].isLeaf(t,o)===1)return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);const f=l-1,m=e[f];let v=0,x=0;for(let S=0;S<this._siblingOffset.length;S++){const M=2*t+this._siblingOffset[S][0],I=2*o+this._siblingOffset[S][1],P=m.getElevation(M,I),L=m.isLeaf(M,I),U=this._addNode(P.min,P.max,L);L&&(v|=1<<S),x||(x=U)}for(let S=0;S<this._siblingOffset.length;S++)v&1<<S||this._construct(e,2*t+this._siblingOffset[S][0],2*o+this._siblingOffset[S][1],f,x+S)}}function jv(i,e,t,o,l,u){return Mi(Mi(i,t,u),Mi(e,o,u),l)}function Xs(i,e,t){const o=t.dim,l=Te(i*o-.5,0,o-1),u=Te(e*o-.5,0,o-1),f=Math.floor(l),m=Math.floor(u),v=Math.min(f+1,o-1),x=Math.min(m+1,o-1);return jv(t.get(f,m),t.get(v,m),t.get(f,x),t.get(v,x),l-f,u-m)}const qv={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class mf{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,o,l=!1,u=!1){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return xt(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=t.height;const f=this.dim=t.height-2,m=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.encoding=o||"mapbox",this.borderReady=l,!l){for(let v=0;v<f;v++)m[this._idx(-1,v)]=m[this._idx(0,v)],m[this._idx(f,v)]=m[this._idx(f-1,v)],m[this._idx(v,-1)]=m[this._idx(v,0)],m[this._idx(v,f)]=m[this._idx(v,f-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(f,-1)]=m[this._idx(f-1,0)],m[this._idx(-1,f)]=m[this._idx(0,f-1)],m[this._idx(f,f)]=m[this._idx(f-1,f-1)],u&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Nv(this)}get(e,t,o=!1){o&&(e=Te(e,-1,this.dim),t=Te(t,-1,this.dim));const l=4*this._idx(e,t);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[l],this.pixels[l+1],this.pixels[l+2])}static getUnpackVector(e){return qv[e]}get unpackVector(){return qv[this.encoding]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}_unpackMapbox(e,t,o){return(256*e*256+256*t+o)/10-1e4}_unpackTerrarium(e,t,o){return 256*e+t+o/256-32768}static pack(e,t){const o=[0,0,0,0],l=mf.getUnpackVector(t);let u=Math.floor((e+l[3])/l[2]);return o[2]=u%256,u=Math.floor(u/256),o[1]=u%256,u=Math.floor(u/256),o[0]=u,o}getPixels(){return new Ir({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=t*this.dim,u=t*this.dim+this.dim,f=o*this.dim,m=o*this.dim+this.dim;switch(t){case-1:l=u-1;break;case 1:u=l+1}switch(o){case-1:f=m-1;break;case 1:m=f+1}const v=-t*this.dim,x=-o*this.dim;for(let S=f;S<m;S++)for(let M=l;M<u;M++){const I=4*this._idx(M,S),P=4*this._idx(M+v,S+x);this.pixels[I+0]=e.pixels[P+0],this.pixels[I+1]=e.pixels[P+1],this.pixels[I+2]=e.pixels[P+2],this.pixels[I+3]=e.pixels[P+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Bt(mf,"DEMData"),Bt(Nv,"DemMinMaxQuadTree",{omit:["dem"]});class y2{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,o){const l=e.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const u={value:t,timeout:void 0};if(o!==void 0&&(u.timeout=setTimeout(()=>{this.remove(e,u)},o)),this.data[l].push(u),this.order.push(l),this.order.length>this.max){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const o=e.wrapped().key,l=t===void 0?0:this.data[o].indexOf(t),u=this.data[o][l];return this.data[o].splice(l,1),u.timeout&&clearTimeout(u.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(u.value),this.order.splice(this.order.indexOf(o),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(e){const t=[];for(const o in this.data)for(const l of this.data[o])e(l.value)||t.push(l);for(const o of t)this.remove(o.value.tileID,o)}}class dc{constructor(e,t,o){this.func=e,this.mask=t,this.range=o}}dc.ReadOnly=!1,dc.ReadWrite=!0,dc.disabled=new dc(519,dc.ReadOnly,[0,1]);const Fm=7680;class Om{constructor(e,t,o,l,u,f){this.test=e,this.ref=t,this.mask=o,this.fail=l,this.depthFail=u,this.pass=f}}Om.disabled=new Om({func:519,mask:0},0,0,Fm,Fm,Fm);class Uo{constructor(e,t,o){this.blendFunction=e,this.blendColor=t,this.mask=o}}Uo.Replace=[1,0],Uo.disabled=new Uo(Uo.Replace,Ni.transparent,[!1,!1,!1,!1]),Uo.unblended=new Uo(Uo.Replace,Ni.transparent,[!0,!0,!0,!0]),Uo.alphaBlended=new Uo([1,771],Ni.transparent,[!0,!0,!0,!0]);const Vm=1029,Um=2305;class po{constructor(e,t,o){this.enable=e,this.mode=t,this.frontFace=o}}po.disabled=new po(!1,Vm,Um),po.backCCW=new po(!0,Vm,Um),po.backCW=new po(!0,Vm,2304),po.frontCW=new po(!0,1028,2304),po.frontCCW=new po(!0,1028,Um);class Ya extends Ze{constructor(e,t,o){super(),this.id=e,this._onlySymbols=o,t.on("data",l=>{l.dataType==="source"&&l.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&l.dataType==="source"&&l.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),t.on("error",()=>{this._sourceErrored=!0}),this._source=t,this._tiles={},this._cache=new y2(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new g2,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const t=this._tiles[e];if(t.state!=="loaded"&&t.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const t in this._tiles){const o=this._tiles[t];this._source.prepareTile(o)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,o.tileID),o.upload(e),o.prepare(this.map.style.imageManager)}else for(const t in this._tiles){const o=this._tiles[t];o.upload(e),o.prepare(this.map.style.imageManager)}}getIds(){return Ke(this._tiles).map(e=>e.tileID).sort($v).map(e=>e.key)}getRenderableIds(e){const t=[];for(const o in this._tiles)this._isIdRenderable(+o,e)&&t.push(this._tiles[o]);return e?t.sort((o,l)=>{const u=o.tileID,f=l.tileID,m=new F(u.canonical.x,u.canonical.y)._rotate(this.transform.angle),v=new F(f.canonical.x,f.canonical.y)._rotate(this.transform.angle);return u.overscaledZ-f.overscaledZ||v.y-m.y||v.x-m.x}).map(o=>o.tileID.key):t.map(o=>o.tileID).sort($v).map(o=>o.key)}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const o=this._tiles[e];o&&(o.state!=="loading"&&(o.state=t),this._loadTile(o,this._tileLoaded.bind(this,o,e,t)))}_tileLoaded(e,t,o,l){if(l)if(e.state="errored",l.status!==404)this._source.fire(new vt(l,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const u=this.map.painter.terrain;this.update(this.transform,u.getScaledDemTileSize(),!0),u.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Mt.now(),o==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new ce("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let l=0;l<t.length;l++){const u=t[l];if(e.neighboringTiles&&e.neighboringTiles[u]){const f=this.getTileByID(u);o(e,f),o(f,e)}}function o(l,u){if(!l.dem||l.dem.borderReady)return;l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0;let f=u.tileID.canonical.x-l.tileID.canonical.x;const m=u.tileID.canonical.y-l.tileID.canonical.y,v=Math.pow(2,l.tileID.canonical.z),x=u.tileID.key;f===0&&m===0||Math.abs(m)>1||(Math.abs(f)>1&&(Math.abs(f+v)===1?f+=v:Math.abs(f-v)===1&&(f-=v)),u.dem&&l.dem&&(l.dem.backfillBorder(u.dem,f,m),l.neighboringTiles&&l.neighboringTiles[x]&&(l.neighboringTiles[x].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,o,l){for(const u in this._tiles){let f=this._tiles[u];if(l[u]||!f.hasData()||f.tileID.overscaledZ<=t||f.tileID.overscaledZ>o)continue;let m=f.tileID;for(;f&&f.tileID.overscaledZ>t+1;){const x=f.tileID.scaledTo(f.tileID.overscaledZ-1);f=this._tiles[x.key],f&&f.hasData()&&(m=x)}let v=m;for(;v.overscaledZ>t;)if(v=v.scaledTo(v.overscaledZ-1),e[v.key]){l[m.key]=m;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const o=this._loadedParentTiles[e.key];return o&&o.tileID.overscaledZ>=t?o:null}for(let o=e.overscaledZ-1;o>=t;o--){const l=e.scaledTo(o),u=this._getLoadedTile(l);if(u)return u}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const o=Math.ceil(e.width/t)+1,l=Math.ceil(e.height/t)+1,u=Math.floor(o*l*5),f=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,u):u,m=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,f):f;this._cache.setMaxSize(m)}handleWrapJump(e){const t=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,t){const o={};for(const l in this._tiles){const u=this._tiles[l];u.tileID=u.tileID.unwrapTo(u.tileID.wrap+t),o[u.tileID.key]=u}this._tiles=o;for(const l in this._timers)clearTimeout(this._timers[l]),delete this._timers[l];for(const l in this._tiles)this._setTileReloadTimer(+l,this._tiles[l])}}update(e,t,o){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!o)return;let l;this.updateCacheSize(e,t),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(m=>new ur(m.canonical.z,m.wrap,m.canonical.z,m.canonical.x,m.canonical.y)):(l=e.coveringTiles({tileSize:t||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!o,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(l=l.filter(m=>this._source.hasTile(m)))):l=[];const u=this._updateRetainedTiles(l);if(Gv(this._source.type)&&l.length!==0){const m={},v={},x=Object.keys(u);for(const M of x){const I=u[M],P=this._tiles[M];if(!P||P.fadeEndTime&&P.fadeEndTime<=Mt.now())continue;const L=this.findLoadedParent(I,Math.max(I.overscaledZ-Ya.maxOverzooming,this._source.minzoom));L&&(this._addTile(L.tileID),m[L.tileID.key]=L.tileID),v[M]=I}const S=l[l.length-1].overscaledZ;for(const M in this._tiles){const I=this._tiles[M];if(u[M]||!I.hasData())continue;let P=I.tileID;for(;P.overscaledZ>S;){P=P.scaledTo(P.overscaledZ-1);const L=this._tiles[P.key];if(L&&L.hasData()&&v[P.key]){u[M]=I.tileID;break}}}for(const M in m)u[M]||(this._coveredTiles[M]=!0,u[M]=m[M])}for(const m in u)this._tiles[m].clearFadeHold();const f=function(m,v){const x=[];for(const S in m)S in v||x.push(S);return x}(this._tiles,u);for(const m of f){const v=this._tiles[m];v.hasSymbolBuckets&&!v.holdingForFade()?v.setHoldDuration(this.map._fadeDuration):v.hasSymbolBuckets&&!v.symbolFadeFinished()||this._removeTile(+m)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(e.length===0)return t;const o={},l=e.reduce((x,S)=>Math.min(x,S.overscaledZ),1/0),u=e[0].overscaledZ,f=Math.max(u-Ya.maxOverzooming,this._source.minzoom),m=Math.max(u+Ya.maxUnderzooming,this._source.minzoom),v={};for(const x of e){const S=this._addTile(x);t[x.key]=x,S.hasData()||l<this._source.maxzoom&&(v[x.key]=x)}this._retainLoadedChildren(v,l,m,t);for(const x of e){let S=this._tiles[x.key];if(S.hasData())continue;if(x.canonical.z>=this._source.maxzoom){const I=x.children(this._source.maxzoom)[0],P=this.getTile(I);if(P&&P.hasData()){t[I.key]=I;continue}}else{const I=x.children(this._source.maxzoom);if(t[I[0].key]&&t[I[1].key]&&t[I[2].key]&&t[I[3].key])continue}let M=S.wasRequested();for(let I=x.overscaledZ-1;I>=f;--I){const P=x.scaledTo(I);if(o[P.key]||(o[P.key]=!0,S=this.getTile(P),!S&&M&&(S=this._addTile(P)),S&&(t[P.key]=P,M=S.wasRequested(),S.hasData())))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let o,l=this._tiles[e].tileID;for(;l.overscaledZ>0;){if(l.key in this._loadedParentTiles){o=this._loadedParentTiles[l.key];break}t.push(l.key);const u=l.scaledTo(l.overscaledZ-1);if(o=this._getLoadedTile(u),o)break;l=u}for(const u of t)this._loadedParentTiles[u]=o}}_addTile(e){let t=this._tiles[e.key];if(t)return this._source.prepareTile&&this._source.prepareTile(t),t;t=this._cache.getAndRemove(e),t&&(this._setTileReloadTimer(e.key,t),t.tileID=e,this._state.initializeTileState(t,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t)));const o=Boolean(t);if(!o){const l=this.map?this.map.painter:null;t=new Rm(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,l,this._isRaster),this._source.prepareTile&&this._source.prepareTile(t)||this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))}return t?(t.uses++,this._tiles[e.key]=t,o||this._source.fire(new ce("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const o=t.getExpiryTimeout();o&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},o))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&t.state!=="reloading"?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,t,o){const l=[],u=this.transform;if(!u)return l;const f=u.projection.name==="globe",m=Do(u.center.lng);for(const v in this._tiles){const x=this._tiles[v];if(o&&x.clearQueryDebugViz(),x.holdingForFade())continue;let S;if(f){const M=x.tileID.canonical;if(M.z===0){const I=[Math.abs(Te(m,...lh(M,-1))-m),Math.abs(Te(m,...lh(M,1))-m)];S=[0,2*I.indexOf(Math.min(...I))-1]}else{const I=[Math.abs(Te(m,...lh(M,-1))-m),Math.abs(Te(m,...lh(M,0))-m),Math.abs(Te(m,...lh(M,1))-m)];S=[I.indexOf(Math.min(...I))-1]}}else S=[0];for(const M of S){const I=e.containsTile(x,u,t,M);I&&l.push(I)}}return l}getVisibleCoordinates(e){const t=this.getRenderableIds(e).map(o=>this._tiles[o].tileID);for(const o of t)o.projMatrix=this.transform.calculateProjMatrix(o.toUnwrapped());return t}hasTransition(){if(this._source.hasTransition())return!0;if(Gv(this._source.type))for(const e in this._tiles){const t=this._tiles[e];if(t.fadeEndTime!==void 0&&t.fadeEndTime>=Mt.now())return!0}return!1}setFeatureState(e,t,o){this._state.updateState(e=e||"_geojsonTileLayer",t,o)}removeFeatureState(e,t,o){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,o)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,o){const l=this._tiles[e];l&&l.setDependencies(t,o)}reloadTilesForDependencies(e,t){for(const o in this._tiles)this._tiles[o].hasDependency(e,t)&&this._reloadTile(+o,"reloading");this._cache.filter(o=>!o.hasDependency(e,t))}_preloadTiles(e,t){const o=new Map,l=Array.isArray(e)?e:[e],u=this.map.painter.terrain,f=this.usedForTerrain&&u?u.getScaledDemTileSize():this._source.tileSize;for(const m of l){const v=m.coveringTiles({tileSize:f,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const x of v)o.set(x.key,x);this.usedForTerrain&&m.updateElevation(!1)}De(Array.from(o.values()),(m,v)=>{const x=new Rm(m,this._source.tileSize*m.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(x,S=>{this._source.type==="raster-dem"&&x.dem&&this._backfillDEM(x),v(S,x)})},t)}}function $v(i,e){const t=Math.abs(2*i.wrap)-+(i.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||o-t||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x}function Gv(i){return i==="raster"||i==="image"||i==="video"}function lh(i,e){const t=1<<i.z;return[i.x/t+e,(i.x+1)/t+e]}Ya.maxOverzooming=10,Ya.maxUnderzooming=3;class _f{constructor(e,t,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=o}static create(e,t,o){const l=o||e.findDEMTileFor(t);if(!l||!l.dem)return;const u=l.dem,f=l.tileID,m=1<<t.canonical.z-f.canonical.z;return new _f(l,l.tileSize/ei/m,[(t.canonical.x/m-f.canonical.x)*u.dim,(t.canonical.y/m-f.canonical.y)*u.dim])}tileCoordToPixel(e,t){const o=t*this._scale+this._offset[1],l=Math.floor(e*this._scale+this._offset[0]),u=Math.floor(o);return new F(l,u)}getElevationAt(e,t,o,l){const u=e*this._scale+this._offset[0],f=t*this._scale+this._offset[1],m=Math.floor(u),v=Math.floor(f),x=this._dem;return l=!!l,o?Mi(Mi(x.get(m,v,l),x.get(m,v+1,l),f-v),Mi(x.get(m+1,v,l),x.get(m+1,v+1,l),f-v),u-m):x.get(m,v,l)}getElevationAtPixel(e,t,o){return this._dem.get(e,t,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Gr(1,e)*this._dem.stride}}class Zv{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Os(ei,16,0),this.featureIndexArray=new Bg,this.promoteId=t}insert(e,t,o,l,u,f=0){const m=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,l,u,f);const v=this.grid;for(let x=0;x<t.length;x++){const S=t[x],M=[1/0,1/0,-1/0,-1/0];for(let I=0;I<S.length;I++){const P=S[I];M[0]=Math.min(M[0],P.x),M[1]=Math.min(M[1],P.y),M[2]=Math.max(M[2],P.x),M[3]=Math.max(M[3],P.y)}M[0]<ei&&M[1]<ei&&M[2]>=0&&M[3]>=0&&v.insert(m,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Xa.VectorTile(new Ku(this.rawTileData)).layers,this.sourceLayerCoder=new zv(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t,o,l){this.loadVTLayers();const u=e.params||{},f=La(u.filter),m=e.tileResult,v=e.transform,x=m.bufferedTilespaceBounds,S=this.grid.query(x.min.x,x.min.y,x.max.x,x.max.y,(L,U,$,ee)=>ey(m.bufferedTilespaceGeometry,L,U,$,ee));S.sort(v2);let M=null;v.elevation&&S.length>0&&(M=_f.create(v.elevation,this.tileID));const I={};let P;for(let L=0;L<S.length;L++){const U=S[L];if(U===P)continue;P=U;const $=this.featureIndexArray.get(U);let ee=null;this.loadMatchingFeature(I,$,f,u.layers,u.availableImages,t,o,l,(se,ie,re,me=0)=>(ee||(ee=as(se,this.tileID.canonical,e.tileTransform)),ie.queryIntersectsFeature(m,se,re,ee,this.z,e.transform,e.pixelPosMatrix,M,me)))}return I}loadMatchingFeature(e,t,o,l,u,f,m,v,x){const{featureIndex:S,bucketIndex:M,sourceLayerIndex:I,layoutVertexArrayOffset:P}=t,L=this.bucketLayerIDs[M];if(l&&!function(se,ie){for(let re=0;re<se.length;re++)if(ie.indexOf(se[re])>=0)return!0;return!1}(l,L))return;const U=this.sourceLayerCoder.decode(I),$=this.vtLayers[U].feature(S);if(o.needGeometry){const se=$a($,!0);if(!o.filter(new W(this.tileID.overscaledZ),se,this.tileID.canonical))return}else if(!o.filter(new W(this.tileID.overscaledZ),$))return;const ee=this.getId($,U);for(let se=0;se<L.length;se++){const ie=L[se];if(l&&l.indexOf(ie)<0)continue;const re=f[ie];if(!re)continue;let me={};ee!==void 0&&v&&(me=v.getState(re.sourceLayer||"_geojsonTileLayer",ee));const ae=Ue({},m[ie]);ae.paint=Wv(ae.paint,re.paint,$,me,u),ae.layout=Wv(ae.layout,re.layout,$,me,u);const Ve=!x||x($,re,me,P);if(!Ve)continue;const Fe=new Pv($,this.z,this.x,this.y,ee);Fe.layer=ae;let We=e[ie];We===void 0&&(We=e[ie]=[]),We.push({featureIndex:S,feature:Fe,intersectionZ:Ve})}}lookupSymbolFeatures(e,t,o,l,u,f,m,v){const x={};this.loadVTLayers();const S=La(u);for(const M of e)this.loadMatchingFeature(x,{bucketIndex:o,sourceLayerIndex:l,featureIndex:M,layoutVertexArrayOffset:0},S,f,m,v,t);return x}loadFeature(e){const{featureIndex:t,sourceLayerIndex:o}=e;this.loadVTLayers();const l=this.sourceLayerCoder.decode(o),u=this.vtFeatures[l];if(u[t])return u[t];const f=this.vtLayers[l].feature(t);return u[t]=f,f}hasLayer(e){for(const t of this.bucketLayerIDs)for(const o of t)if(e===o)return!0;return!1}getId(e,t){let o=e.id;return this.promoteId&&(o=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[t]],typeof o=="boolean"&&(o=Number(o))),o}}function Wv(i,e,t,o,l){return At(i,(u,f)=>{const m=e instanceof fe?e.get(f):null;return m&&m.evaluate?m.evaluate(t,o,l):m})}function v2(i,e){return e-i}Bt(Zv,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Hv{constructor(e){const t={},o=[];for(const m in e){const v=e[m],x=t[m]={};for(const S in v.glyphs){const M=v.glyphs[+S];if(!M||M.bitmap.width===0||M.bitmap.height===0)continue;const I=M.metrics.localGlyph?2:1,P={x:0,y:0,w:M.bitmap.width+2*I,h:M.bitmap.height+2*I};o.push(P),x[S]=P}}const{w:l,h:u}=ym(o),f=new ls({width:l||1,height:u||1});for(const m in e){const v=e[m];for(const x in v.glyphs){const S=v.glyphs[+x];if(!S||S.bitmap.width===0||S.bitmap.height===0)continue;const M=t[m][x],I=S.metrics.localGlyph?2:1;ls.copy(S.bitmap,f,{x:0,y:0},{x:M.x+I,y:M.y+I},S.bitmap)}}this.image=f,this.positions=t}}Bt(Hv,"GlyphAtlas");class x2{constructor(e){this.tileID=new ur(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Ka(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,t,o,l,u){this.status="parsing",this.data=e,this.collisionBoxArray=new Po;const f=new zv(Object.keys(e.layers).sort()),m=new Zv(this.tileID,this.promoteId);m.bucketLayerIDs=[];const v={},x=new Bm(256,256),S={featureIndex:m,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:x,availableImages:o},M=t.familiesBySource[this.source];for(const me in M){const ae=e.layers[me];if(!ae)continue;let Ve=!1,Fe=!1;for(const je of M[me])je[0].type==="symbol"?Ve=!0:Fe=!0;if(this.isSymbolTile===!0&&!Ve||this.isSymbolTile===!1&&!Fe)continue;ae.version===1&&xt(`Vector tile source "${this.source}" layer "${me}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const We=f.encode(me),yt=[];for(let je=0;je<ae.length;je++){const et=ae.feature(je),at=m.getId(et,me);yt.push({feature:et,id:at,index:je,sourceLayerIndex:We})}for(const je of M[me]){const et=je[0];this.isSymbolTile!==void 0&&et.type==="symbol"!==this.isSymbolTile||et.minzoom&&this.zoom<Math.floor(et.minzoom)||et.maxzoom&&this.zoom>=et.maxzoom||et.visibility!=="none"&&(Nm(je,this.zoom,o),(v[et.id]=et.createBucket({index:m.bucketLayerIDs.length,layers:je,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:We,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:o})).populate(yt,S,this.tileID.canonical,this.tileTransform),m.bucketLayerIDs.push(je.map(at=>at.id)))}}let I,P,L,U;x.trim();const $={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ee=At(S.glyphDependencies,me=>Object.keys(me).map(Number));Object.keys(ee).length?l.send("getGlyphs",{uid:this.uid,stacks:ee},(me,ae)=>{I||(I=me,P=ae,re.call(this))},void 0,!1,$):P={};const se=Object.keys(S.iconDependencies);se.length?l.send("getImages",{icons:se,source:this.source,tileID:this.tileID,type:"icons"},(me,ae)=>{I||(I=me,L=ae,re.call(this))},void 0,!1,$):L={};const ie=Object.keys(S.patternDependencies);function re(){if(I)return u(I);if(P&&L&&U){const me=new Hv(P),ae=new Xy(L,U);for(const Ve in v){const Fe=v[Ve];Fe instanceof Zs?(Nm(Fe.layers,this.zoom,o),jT(Fe,P,me.positions,L,ae.iconPositions,this.showCollisionBoxes,o,this.tileID.canonical,this.tileZoom,this.projection)):Fe.hasPattern&&(Fe instanceof Kd||Fe instanceof Zd||Fe instanceof Zu)&&(Nm(Fe.layers,this.zoom,o),Fe.addFeatures(S,this.tileID.canonical,ae.patternPositions,o,this.tileTransform))}this.status="done",u(null,{buckets:Ke(v).filter(Ve=>!Ve.isEmpty()),featureIndex:m,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:me.image,lineAtlas:x,imageAtlas:ae,glyphMap:this.returnDependencies?P:null,iconMap:this.returnDependencies?L:null,glyphPositions:this.returnDependencies?me.positions:null})}}ie.length?l.send("getImages",{icons:ie,source:this.source,tileID:this.tileID,type:"patterns"},(me,ae)=>{I||(I=me,U=ae,re.call(this))},void 0,!1,$):U={},re.call(this)}}function Nm(i,e,t){const o=new W(e);for(const l of i)l.recalculate(o,t)}class Xv{constructor(e){this.entries={},this.scheduler=e}request(e,t,o,l){const u=this.entries[e]=this.entries[e]||{callbacks:[]};if(u.result){const[f,m]=u.result;return this.scheduler?this.scheduler.add(()=>{l(f,m)},t):l(f,m),()=>{}}return u.callbacks.push(l),u.cancel||(u.cancel=o((f,m)=>{u.result=[f,m];for(const v of u.callbacks)this.scheduler?this.scheduler.add(()=>{v(f,m)},t):v(f,m);setTimeout(()=>delete this.entries[e],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(f=>f!==l),u.callbacks.length||(u.cancel(),delete this.entries[e]))}}}function Kv(i,e,t){const o=JSON.stringify(i.request);return i.data&&(this.deduped.entries[o]={result:[null,i.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},l=>{const u=ke(i.request,(f,m,v,x)=>{f?l(f):m&&l(null,{vectorTile:t?void 0:new Xa.VectorTile(new Ku(m)),rawData:m,cacheControl:v,expires:x})});return()=>{u.cancel(),l()}},e)}s.ARRAY_TYPE=Mr,s.AUTH_ERR_MSG=si,s.Aabb=vr,s.Actor=class{constructor(i,e,t){this.target=i,this.parent=e,this.mapId=t,this.callbacks={},this.cancelCallbacks={},Ht(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ci()?i:D,this.scheduler=new m2}send(i,e,t,o,l=!1,u){const f=Math.round(1e18*Math.random()).toString(36).substring(0,10);t&&(t.metadata=u,this.callbacks[f]=t);const m=Jt(this.globalScope)?void 0:[];return this.target.postMessage({id:f,type:i,hasCallback:!!t,targetMapId:o,mustQueue:l,sourceMapId:this.mapId,data:Vs(e,m)},m),{cancel:()=>{t&&delete this.callbacks[f],this.target.postMessage({id:f,type:"<cancel>",targetMapId:o,sourceMapId:this.mapId})}}}receive(i){const e=i.data,t=e.id;if(t&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const o=this.cancelCallbacks[t];delete this.cancelCallbacks[t],o&&o.cancel()}else if(e.mustQueue||Ci()){const o=this.callbacks[t];this.cancelCallbacks[t]=this.scheduler.add(()=>this.processTask(t,e),o&&o.metadata||{type:"message"})}else this.processTask(t,e)}processTask(i,e){if(e.type==="<response>"){const t=this.callbacks[i];delete this.callbacks[i],t&&(e.error?t(Fa(e.error)):t(null,Fa(e.data)))}else{const t=Jt(this.globalScope)?void 0:[],o=e.hasCallback?(u,f)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:u?Vs(u):null,data:Vs(f,t)},t)}:u=>{},l=Fa(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,l,o);else if(this.parent.getWorkerSource){const u=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,u[0],l.source)[u[1]](l,o)}else o(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.CanonicalTileID=Hd,s.Color=Ni,s.ColorMode=Uo,s.CullFaceMode=po,s.DEMData=mf,s.DataConstantProperty=le,s.DedupedRequest=Xv,s.DepthMode=dc,s.EXTENT=ei,s.Elevation=class{isDataAvailableAtPoint(i){const e=this._source();if(!e||i.y<0||i.y>1)return!1;const t=e.getSource().maxzoom,o=1<<t,l=Math.floor(i.x),u=Math.floor((i.x-l)*o),f=Math.floor(i.y*o),m=this.findDEMTileFor(new ur(t,l,t,u,f));return!(!m||!m.dem)}getAtPointOrZero(i,e=0){return this.getAtPoint(i,e)||0}getAtPoint(i,e,t=!0){e==null&&(e=null);const o=this._source();if(!o||i.y<0||i.y>1)return e;const l=o.getSource().maxzoom,u=1<<l,f=Math.floor(i.x),m=i.x-f,v=new ur(l,f,l,Math.floor(m*u),Math.floor(i.y*u)),x=this.findDEMTileFor(v);if(!x||!x.dem)return e;const S=x.dem,M=1<<x.tileID.canonical.z,I=(m*M-x.tileID.canonical.x)*S.dim,P=(i.y*M-x.tileID.canonical.y)*S.dim,L=Math.floor(I),U=Math.floor(P);return(t?this.exaggeration():1)*Mi(Mi(S.get(L,U),S.get(L,U+1),P-U),Mi(S.get(L+1,U),S.get(L+1,U+1),P-U),I-L)}getAtTileOffset(i,e,t){const o=1<<i.canonical.z;return this.getAtPointOrZero(new Yl(i.wrap+(i.canonical.x+e/ei)/o,(i.canonical.y+t/ei)/o))}getAtTileOffsetFunc(i,e,t,o){return l=>{const u=this.getAtTileOffset(i,l.x,l.y),f=o.upVector(i.canonical,l.x,l.y);return co(f,f,u*o.upVectorScale(i.canonical,e,t).metersToTile),f}}getForTilePoints(i,e,t,o){const l=_f.create(this,i,o);return!!l&&(e.forEach(u=>{u[2]=this.exaggeration()*l.getElevationAt(u[0],u[1],t)}),!0)}getMinMaxForTile(i){const e=this.findDEMTileFor(i);if(!e||!e.dem)return null;const t=e.dem.tree,o=e.tileID,l=1<<i.canonical.z-o.canonical.z;let u=i.canonical.x/l-o.canonical.x,f=i.canonical.y/l-o.canonical.y,m=0;for(let v=0;v<i.canonical.z-o.canonical.z&&!t.leaves[m];v++){u*=2,f*=2;const x=2*Math.floor(f)+Math.floor(u);m=t.childOffsets[m]+x,u%=1,f%=1}return{min:this.exaggeration()*t.minimums[m],max:this.exaggeration()*t.maximums[m]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,e,t){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},s.ErrorEvent=vt,s.EvaluationParameters=W,s.Event=ce,s.Evented=Ze,s.FillExtrusionBucket=Zu,s.Frustum=am,s.FrustumCorners=sm,s.GLOBE_METERS_TO_ECEF=Am,s.GLOBE_RADIUS=hs,s.GLOBE_SCALE_MATCH_LATITUDE=45,s.GLOBE_ZOOM_THRESHOLD_MAX=6,s.GLOBE_ZOOM_THRESHOLD_MIN=5,s.GlobeSharedBuffers=class{constructor(i){this._createGrid(i),this._createPoles(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const i of this._poleSegments)i.destroy();for(const i of this._gridSegments)i.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const i of this._wireframeSegments)i.destroy()}}_createGrid(i){const e=new St,t=new _i,o=65;for(let l=0;l<o;l++)for(let u=0;u<o;u++)e.emplaceBack(u,l);this._gridSegments=[];for(let l=0,u=0;l<cc.length;l++){const f=cc[l];for(let v=0;v<f;v++)for(let x=0;x<64;x++){const S=v*o+x;t.emplaceBack(S+1,S,S+o),t.emplaceBack(S+o,S+o+1,S+1)}const m=64*f*2;this._gridSegments.push(In.simpleSegment(0,u,(f+1)*o,m)),u+=m}this._gridBuffer=i.createVertexBuffer(e,Qu.members),this._gridIndexBuffer=i.createIndexBuffer(t,!0)}_createPoles(i){const e=new _i;for(let l=0;l<=64;l++)e.emplaceBack(0,l+1,l+2);this._poleIndexBuffer=i.createIndexBuffer(e,!0);const t=new Zn,o=new Zn;this._poleSegments=[];for(let l=0,u=0;l<5;l++){const f=360/(1<<l);t.emplaceBack(0,-hs,0,.5,0),o.emplaceBack(0,-hs,0,.5,1);for(let m=0;m<=64;m++){const v=m/64,x=Mi(0,f,v),[S,M,I]=uc(XT,KT,x,hs);t.emplaceBack(S,M,I,v,0),o.emplaceBack(S,M,I,v,1)}this._poleSegments.push(In.simpleSegment(u,0,66,64)),u+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(t,mv,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(o,mv,!1)}getGridBuffers(i){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[i]]}getPoleBuffers(i){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}getWirefameBuffers(i,e){if(!this._wireframeSegments){const t=new Jn,o=64,l=o+1;this._wireframeSegments=[];for(let u=0,f=0;u<cc.length;u++){const m=cc[u];for(let x=0;x<m;x++)for(let S=0;S<o;S++){const M=x*l+S;t.emplaceBack(M,M+1),t.emplaceBack(M,M+l),t.emplaceBack(M,M+l+1)}const v=m*o*3;this._wireframeSegments.push(In.simpleSegment(0,f,(m+1)*l,v)),f+=v}this._wireframeIndexBuffer=i.createIndexBuffer(t)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},s.GlyphManager=ac,s.ImagePosition=vm,s.LineAtlas=Bm,s.LngLat=Vi,s.LngLatBounds=js,s.LocalGlyphMode=Tm,s.MAX_MERCATOR_LATITUDE=Lo,s.MercatorCoordinate=Yl,s.ONE_EM=Hn,s.OverscaledTileID=ur,s.Properties=Je,s.RGBAImage=Ir,s.Ray=om,s.RequestManager=class{constructor(i,e,t){this._transformRequestFn=i,this._customAccessToken=e,this._silenceAuthErrors=!!t,this._createSkuToken()}_createSkuToken(){const i=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",zi,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,e){return this._transformRequestFn&&this._transformRequestFn(i,e)||{url:i}}normalizeStyleURL(i,e){if(!Ai(i))return i;const t=Cn(i);return t.path=`/styles/v1${t.path}`,this._makeAPIURL(t,this._customAccessToken||e)}normalizeGlyphsURL(i,e){if(!Ai(i))return i;const t=Cn(i);return t.path=`/fonts/v1${t.path}`,this._makeAPIURL(t,this._customAccessToken||e)}normalizeSourceURL(i,e,t,o){if(!Ai(i))return i;const l=Cn(i);return l.path=`/v4/${l.authority}.json`,l.params.push("secure"),t&&l.params.push(`language=${t}`),o&&l.params.push(`worldview=${o}`),this._makeAPIURL(l,this._customAccessToken||e)}normalizeSpriteURL(i,e,t,o){const l=Cn(i);return Ai(i)?(l.path=`/styles/v1${l.path}/sprite${e}${t}`,this._makeAPIURL(l,this._customAccessToken||o)):(l.path+=`${e}${t}`,kn(l))}normalizeTileURL(i,e,t){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!Ai(i))return i;const o=Cn(i);o.path=o.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||t&&o.authority!=="raster"&&t===512?"@2x":""}${ht.supported?".webp":"$1"}`),o.authority==="raster"?o.path=`/${Xe.RASTER_URL_PREFIX}${o.path}`:(o.path=o.path.replace(/^.+\/v4\//,"/"),o.path=`/${Xe.TILE_URL_VERSION}${o.path}`);const l=this._customAccessToken||function(u){for(const f of u){const m=f.match(/^access_token=(.*)$/);if(m)return m[1]}return null}(o.params)||Xe.ACCESS_TOKEN;return Xe.REQUIRE_ACCESS_TOKEN&&l&&this._skuToken&&o.params.push(`sku=${this._skuToken}`),this._makeAPIURL(o,l)}canonicalizeTileURL(i,e){const t=Cn(i);if(!t.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!t.path.match(/\.[\w]+$/))return i;let o="mapbox://";t.path.match(/^\/raster\/v1\//)?o+=`raster/${t.path.replace(`/${Xe.RASTER_URL_PREFIX}/`,"")}`:o+=`tiles/${t.path.replace(`/${Xe.TILE_URL_VERSION}/`,"")}`;let l=t.params;return e&&(l=l.filter(u=>!u.match(/^access_token=/))),l.length&&(o+=`?${l.join("&")}`),o}canonicalizeTileset(i,e){const t=!!e&&Ai(e),o=[];for(const l of i.tiles||[])hn(l)?o.push(this.canonicalizeTileURL(l,t)):o.push(l);return o}_makeAPIURL(i,e){const t="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",o=Cn(Xe.API_URL);if(i.protocol=o.protocol,i.authority=o.authority,i.protocol==="http"){const l=i.params.indexOf("secure");l>=0&&i.params.splice(l,1)}if(o.path!=="/"&&(i.path=`${o.path}${i.path}`),!Xe.REQUIRE_ACCESS_TOKEN)return kn(i);if(e=e||Xe.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${t}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${t}`)}return i.params=i.params.filter(l=>l.indexOf("access_token")===-1),i.params.push(`access_token=${e||""}`),kn(i)}},s.ResourceType=_e,s.SegmentVector=In,s.SourceCache=Ya,s.StencilMode=Om,s.StructArrayLayout1ui2=es,s.StructArrayLayout2f1f2i16=so,s.StructArrayLayout2i4=St,s.StructArrayLayout2ui4=Jn,s.StructArrayLayout3f12=nn,s.StructArrayLayout3ui6=_i,s.StructArrayLayout4i8=Wt,s.StructArrayLayout5f20=Zn,s.Texture=ah,s.Tile=Rm,s.Transitionable=te,s.Uniform1f=Dd,s.Uniform1i=class extends rs{constructor(i){super(i),this.current=0}set(i,e,t){this.fetchUniformLocation(i,e)&&this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},s.Uniform2f=class extends rs{constructor(i){super(i),this.current=[0,0]}set(i,e,t){this.fetchUniformLocation(i,e)&&(t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1])))}},s.Uniform3f=class extends rs{constructor(i){super(i),this.current=[0,0,0]}set(i,e,t){this.fetchUniformLocation(i,e)&&(t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2])))}},s.Uniform4f=jg,s.UniformColor=qg,s.UniformMatrix2f=class extends rs{constructor(i){super(i),this.current=nw}set(i,e,t){if(this.fetchUniformLocation(i,e)){for(let o=0;o<4;o++)if(t[o]!==this.current[o]){this.current=t,this.gl.uniformMatrix2fv(this.location,!1,t);break}}}},s.UniformMatrix3f=class extends rs{constructor(i){super(i),this.current=iw}set(i,e,t){if(this.fetchUniformLocation(i,e)){for(let o=0;o<9;o++)if(t[o]!==this.current[o]){this.current=t,this.gl.uniformMatrix3fv(this.location,!1,t);break}}}},s.UniformMatrix4f=class extends rs{constructor(i){super(i),this.current=tw}set(i,e,t){if(this.fetchUniformLocation(i,e)){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let o=1;o<16;o++)if(t[o]!==this.current[o]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}}},s.UnwrappedTileID=Ry,s.ValidationError=Pt,s.VectorTileWorkerSource=class extends Ze{constructor(i,e,t,o,l){super(),this.actor=i,this.layerIndex=e,this.availableImages=t,this.loadVectorData=l||Kv,this.loading={},this.loaded={},this.deduped=new Xv(i.scheduler),this.isSpriteLoaded=o,this.scheduler=i.scheduler}loadTile(i,e){const t=i.uid,o=i&&i.request,l=o&&o.collectResourceTiming,u=this.loading[t]=new x2(i);u.abort=this.loadVectorData(i,(f,m)=>{const v=!this.loading[t];if(delete this.loading[t],v||f||!m)return u.status="done",v||(this.loaded[t]=u),e(f);const x=m.rawData,S={};m.expires&&(S.expires=m.expires),m.cacheControl&&(S.cacheControl=m.cacheControl),u.vectorTile=m.vectorTile||new Xa.VectorTile(new Ku(x));const M=()=>{u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,(I,P)=>{if(I||!P)return e(I);const L={};if(l){const U=ue(o);U.length>0&&(L.resourceTiming=JSON.parse(JSON.stringify(U)))}e(null,Ue({rawTileData:x.slice(0)},P,S,L))})};this.isSpriteLoaded?M():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(M,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):M()}),this.loaded=this.loaded||{},this.loaded[t]=u})}reloadTile(i,e){const t=this.loaded,o=i.uid,l=this;if(t&&t[o]){const u=t[o];u.showCollisionBoxes=i.showCollisionBoxes,u.enableTerrain=!!i.enableTerrain,u.projection=i.projection,u.tileTransform=Ka(i.tileID.canonical,i.projection);const f=(m,v)=>{const x=u.reloadCallback;x&&(delete u.reloadCallback,u.parse(u.vectorTile,l.layerIndex,this.availableImages,l.actor,x)),e(m,v)};u.status==="parsing"?u.reloadCallback=f:u.status==="done"&&(u.vectorTile?u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,f):f())}}abortTile(i,e){const t=i.uid,o=this.loading[t];o&&(o.abort&&o.abort(),delete this.loading[t]),e()}removeTile(i,e){const t=this.loaded,o=i.uid;t&&t[o]&&delete t[o],e()}},s.WritingMode=Ur,s.ZoomHistory=yd,s.add=qs,s.addDynamicAttributes=df,s.adjoint=function(i,e){var t=e[0],o=e[1],l=e[2],u=e[3],f=e[4],m=e[5],v=e[6],x=e[7],S=e[8];return i[0]=f*S-m*x,i[1]=l*x-o*S,i[2]=o*m-l*f,i[3]=m*v-u*S,i[4]=t*S-l*v,i[5]=l*u-t*m,i[6]=u*x-f*v,i[7]=o*v-t*x,i[8]=t*f-o*u,i},s.asyncAll=De,s.bezier=Le,s.bindAll=Ht,s.boundsAttributes=Lv,s.bufferConvexPolygon=function(i,e){const t=[];for(let o=0;o<i.length;o++){const l=xe(o-1,-1,i.length-1),u=xe(o+1,-1,i.length-1),f=i[o],m=i[u],v=i[l].sub(f).unit(),x=m.sub(f).unit(),S=x.angleWithSep(v.x,v.y),M=v.add(x).unit().mult(-1*e/Math.sin(S/2));t.push(f.add(M))}return t},s.cacheEntryPossiblyAdded=function(i){ne++,ne>io&&(i.getActor().send("enforceCacheSizeLimit",to),ne=0)},s.calculateGlobeLabelMatrix=function(i,e){const{x:t,y:o}=i.point,l=bv(t,o,i.worldSize/i._pixelsPerMercatorPixel,0,0);return Ql(l,l,km(Fo(e)))},s.calculateGlobeMatrix=function(i){const{x:e,y:t}=i.point,{lng:o,lat:l}=i._center;return bv(e,t,i.worldSize,o,l)},s.calculateGlobeMercatorMatrix=function(i){const e=i.pixelsPerMeter,t=e/Gr(1,i.center.lat),o=Bo(new Float64Array(16));return Fu(o,o,[i.point.x,i.point.y,0]),Za(o,o,[t,t,e]),Float32Array.from(o)},s.circumferenceAtLatitude=Gp,s.clamp=Te,s.clearTileCache=function(i){const e=Q(),t=[];for(const o in An)e&&t.push(e.delete(o)),delete An[o];i&&Promise.all(t).catch(i).then(()=>i())},s.clipLine=av,s.clone=function(i){var e=new Mr(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},s.clone$1=Oe,s.collisionCircleLayout=pT,s.config=Xe,s.conjugate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i},s.create=function(){var i=new Mr(16);return Mr!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},s.create$1=ny,s.createExpression=Ds,s.createLayout=it,s.createStyleLayer=function(i){return i.type==="custom"?new h2(i):new f2[i.type](i)},s.cross=rm,s.degToRad=ye,s.distance=function(i,e){return Math.hypot(e[0]-i[0],e[1]-i[1],e[2]-i[2])},s.div=function(i,e,t){return i[0]=e[0]/t[0],i[1]=e[1]/t[1],i[2]=e[2]/t[2],i},s.dot=Wr,s.ease=Ne,s.easeCubicInOut=we,s.emitValidationErrors=Su,s.endsWith=ot,s.enforceCacheSizeLimit=function(i){for(const e in An)B(e),An[e].then(t=>{t.keys().then(o=>{for(let l=0;l<o.length-i;l++)t.delete(o[l])})})},s.evaluateSizeForFeature=Yd,s.evaluateSizeForZoom=nc,s.evaluateVariableOffset=dv,s.evented=R,s.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]},s.exactEquals$1=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]},s.exported=Mt,s.exported$1=ht,s.extend=Ue,s.extend$1=wi,s.fillExtrusionHeightLift=Dy,s.filterObject=di,s.fromMat4=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],i},s.fromQuat=function(i,e){var t=e[0],o=e[1],l=e[2],u=e[3],f=t+t,m=o+o,v=l+l,x=t*f,S=o*f,M=o*m,I=l*f,P=l*m,L=l*v,U=u*f,$=u*m,ee=u*v;return i[0]=1-M-L,i[1]=S+ee,i[2]=I-$,i[3]=0,i[4]=S-ee,i[5]=1-x-L,i[6]=P+U,i[7]=0,i[8]=I+$,i[9]=P-U,i[10]=1-x-M,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},s.fromRotation=function(i,e){var t=Math.sin(e),o=Math.cos(e);return i[0]=o,i[1]=t,i[2]=0,i[3]=-t,i[4]=o,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},s.fromScaling=ry,s.furthestTileCorner=function(i){const e=Math.round((i+45+360)%360/90)%4;return He[e]},s.getAABBPointSquareDist=function(i,e,t){let o=0;for(let l=0;l<2;++l){const u=t?t[l]:0;i[l]>u&&(o+=(i[l]-u)*(i[l]-u)),e[l]<u&&(o+=(u-e[l])*(u-e[l]))}return o},s.getAnchorAlignment=wm,s.getAnchorJustification=Sm,s.getBounds=function(i){let e=1/0,t=1/0,o=-1/0,l=-1/0;for(const u of i)e=Math.min(e,u.x),t=Math.min(t,u.y),o=Math.max(o,u.x),l=Math.max(l,u.y);return{min:new F(e,t),max:new F(o,l)}},s.getColumn=Bi,s.getGridMatrix=function(i,e,t){const o=e.getNorth(),l=e.getSouth(),u=e.getWest(),f=.015625;return[0,(e.getEast()-u)*f,1<<i.z,(l-o)/cc[t],0,i.y,o,u,f]},s.getImage=Qt,s.getJSON=function(i,e){return ge(Ue(i,{type:"json"}),e)},s.getLatitudinalLod=function(i){const e=80.051129;i=Te(i,-80.051129,e)/e*90;const t=Math.pow(Math.abs(Math.sin(ye(i))),3);return Math.round(t*(cc.length-1))},s.getMapSessionAPI=da,s.getPerformanceMeasurement=ue,s.getProjection=Iv,s.getRTLTextPluginStatus=j,s.getReferrer=Se,s.getTilePoint=function(i,{x:e,y:t},o=0){return new F(((e-o)*i.scale-i.x)*ei,(t*i.scale-i.y)*ei)},s.getTileVec3=function(i,e,t=0){return ec(((e.x-t)*i.scale-i.x)*ei,(e.y*i.scale-i.y)*ei,Zg(e.z,e.y))},s.getVideo=function(i,e){const t=D.document.createElement("video");t.muted=!0,t.onloadstart=function(){e(null,t)};for(let o=0;o<i.length;o++){const l=D.document.createElement("source");st(i[o])||(t.crossOrigin="Anonymous"),l.src=i[o],t.appendChild(l)}return{cancel:()=>{}}},s.globeCenterToScreenPoint=function(i){const e=[0,0,0],t=Bo(new Float64Array(16));return Ql(t,i.pixelMatrix,i.globeMatrix),Pn(e,e,t),new F(e[0],e[1])},s.globeDenormalizeECEF=km,s.globeECEFOrigin=function(i,e){const t=[0,0,0];return Pn(t,t,th(Fo(e.canonical))),Pn(t,t,i),t},s.globeNormalizeECEF=th,s.globePixelsToTileUnits=function(i,e){return ei/(512*Math.pow(2,i))*af(Fo(e))},s.globePoleMatrixForTile=function(i,e,t){const o=Bo(new Float64Array(16)),l=(e/(1<<i)-.5)*Math.PI*2;return Vd(o,t.globeMatrix,l),Float32Array.from(o)},s.globeTileBounds=Fo,s.globeTiltAtLngLat=wv,s.globeToMercatorTransition=ih,s.globeUseCustomAntiAliasing=function(i,e,t){const o=ih(t.zoom),l=i.style.map._antialias,u=!!e.extStandardDerivatives,f=e.extStandardDerivativesForceOff||i.terrain&&i.terrain.exaggeration()>0;return o===0&&!l&&!f&&u},s.identity=Bo,s.identity$1=hy,s.invert=Jp,s.isFullscreen=function(){return!!D.document.fullscreenElement||!!D.document.webkitFullscreenElement},s.isLngLatBehindGlobe=function(i,e){return wv(i,e)>Math.PI/2*1.01},s.isMapAuthenticated=function(i){return Dr.has(i)},s.isMapboxURL=Ai,s.isSafariWithAntialiasingBug=function(i){const e=i.navigator?i.navigator.userAgent:null;return!!Jt(i)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.latFromMercatorY=Wn,s.len=xw,s.length=Ou,s.length$1=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},s.loadVectorTile=Kv,s.makeRequest=ge,s.mapValue=function(i,e,t,o,l){return Te((i-e)/(t-e)*(l-o)+o,o,l)},s.mercatorScale=Wg,s.mercatorXfromLng=Do,s.mercatorYfromLat=ss,s.mercatorZfromAltitude=Gr,s.mul=yw,s.mul$1=vw,s.multiply=Ql,s.multiply$1=function(i,e,t){var o=e[0],l=e[1],u=e[2],f=e[3],m=e[4],v=e[5],x=e[6],S=e[7],M=e[8],I=t[0],P=t[1],L=t[2],U=t[3],$=t[4],ee=t[5],se=t[6],ie=t[7],re=t[8];return i[0]=I*o+P*f+L*x,i[1]=I*l+P*m+L*S,i[2]=I*u+P*v+L*M,i[3]=U*o+$*f+ee*x,i[4]=U*l+$*m+ee*S,i[5]=U*u+$*v+ee*M,i[6]=se*o+ie*f+re*x,i[7]=se*l+ie*m+re*S,i[8]=se*u+ie*v+re*M,i},s.multiply$2=ay,s.nextPowerOfTwo=Ye,s.normalize=cr,s.normalize$1=function(i,e){var t=e[0],o=e[1],l=e[2],u=e[3],f=t*t+o*o+l*l+u*u;return f>0&&(f=1/Math.sqrt(f)),i[0]=t*f,i[1]=o*f,i[2]=l*f,i[3]=u*f,i},s.number=Mi,s.ortho=function(i,e,t,o,l,u,f){var m=1/(e-t),v=1/(o-l),x=1/(u-f);return i[0]=-2*m,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*v,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*x,i[11]=0,i[12]=(e+t)*m,i[13]=(l+o)*v,i[14]=(f+u)*x,i[15]=1,i},s.pbf=Ku,s.perspective=function(i,e,t,o,l){var u,f=1/Math.tan(e/2);return i[0]=f/t,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=f,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,l!=null&&l!==1/0?(i[10]=(l+o)*(u=1/(o-l)),i[14]=2*l*o*u):(i[10]=-1,i[14]=-2*o),i},s.pick=function(i,e){const t={};for(let o=0;o<e.length;o++){const l=e[o];l in i&&(t[l]=i[l])}return t},s.plugin=Z,s.pointGeometry=F,s.polygonContainsPoint=Ga,s.polygonIntersectsBox=ey,s.polygonIntersectsPolygon=Kg,s.polygonizeBounds=function(i,e,t=0,o=!0){const l=new F(t,t),u=i.sub(l),f=e.add(l),m=[u,new F(f.x,u.y),f,new F(u.x,f.y)];return o&&m.push(u.clone()),m},s.posAttributes=Qu,s.postMapLoadEvent=Ho,s.postTurnstileEvent=Pr,s.potpack=ym,s.prevPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},s.radToDeg=ze,s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.registerForPluginStateChange=function(i){return i({pluginStatus:T,pluginURL:C}),R.on("pluginStateChange",i),i},s.removeAuthState=function(i){Dr.delete(i)},s.renderColorRamp=cm,s.resample=Hg,s.rotateX=Qp,s.rotateX$1=dy,s.rotateY=Vd,s.rotateY$1=fy,s.rotateZ=function(i,e,t){var o=Math.sin(t),l=Math.cos(t),u=e[0],f=e[1],m=e[2],v=e[3],x=e[4],S=e[5],M=e[6],I=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=u*l+x*o,i[1]=f*l+S*o,i[2]=m*l+M*o,i[3]=v*l+I*o,i[4]=x*l-u*o,i[5]=S*l-f*o,i[6]=M*l-m*o,i[7]=I*l-v*o,i},s.rotateZ$1=function(i,e,t){t*=.5;var o=e[0],l=e[1],u=e[2],f=e[3],m=Math.sin(t),v=Math.cos(t);return i[0]=o*v+l*m,i[1]=l*v-o*m,i[2]=u*v+f*m,i[3]=f*v-u*m,i},s.scale=Za,s.scale$1=cy,s.scale$2=co,s.scaleAndAdd=Ud,s.setCacheLimits=function(i,e){to=i,io=e},s.setColumn=function(i,e,t){i[4*e+0]=t[0],i[4*e+1]=t[1],i[4*e+2]=t[2],i[4*e+3]=t[3]},s.setRTLTextPlugin=function(i,e,t=!1){if(T===d||T===_||T===g)throw new Error("setRTLTextPlugin cannot be called multiple times.");C=Mt.resolveURL(i),T=d,w=e,z(),t||K()},s.smoothstep=Pe,s.spec=Ce,s.storeAuthState=function(i,e){e?Dr.add(i):Dr.delete(i)},s.sub=uo,s.subtract=tm,s.symbolSize=mT,s.tileAABB=function(i,e,t,o,l,u,f,m,v){if(v.name==="globe")return HT(i,e,new Hd(t,o,l));const x=Ka({z:t,x:o,y:l},v);return new vr([(u+x.x/x.scale)*e,e*(x.y/x.scale),f],[(u+x.x2/x.scale)*e,e*(x.y2/x.scale),m])},s.tileCornersToBounds=of,s.tileTransform=Ka,s.transformMat3=function(i,e,t){var o=e[0],l=e[1],u=e[2];return i[0]=o*t[0]+l*t[3]+u*t[6],i[1]=o*t[1]+l*t[4]+u*t[7],i[2]=o*t[2]+l*t[5]+u*t[8],i},s.transformMat4=Pn,s.transformMat4$1=Wa,s.transformQuat=ly,s.transitionTileAABBinECEF=yv,s.translate=Fu,s.transpose=function(i,e){if(i===e){var t=e[1],o=e[2],l=e[5];i[1]=e[3],i[2]=e[6],i[3]=t,i[5]=e[7],i[6]=o,i[7]=l}else i[0]=e[0],i[1]=e[3],i[2]=e[6],i[3]=e[1],i[4]=e[4],i[5]=e[7],i[6]=e[2],i[7]=e[5],i[8]=e[8];return i},s.triggerPluginCompletionEvent=k,s.uniqueId=$e,s.updateGlobeVertexNormal=function(i,e,t,o,l){const u=5*e+2;i.float32[u+0]=t,i.float32[u+1]=o,i.float32[u+2]=l},s.validateCustomStyleLayer=function(i){const e=[],t=i.id;return t===void 0&&e.push({message:`layers.${t}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${t}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${t}: property "renderingMode" must be either "2d" or "3d"`}),e},s.validateFilter=i=>oo(Rs(i)),s.validateFog=i=>oo(pd(i)),s.validateLayer=i=>oo(Ul(i)),s.validateLight=i=>oo(fd(i)),s.validateSource=i=>oo(dd(i)),s.validateStyle=ql,s.validateTerrain=i=>oo(jl(i)),s.values=Ke,s.vectorTile=Xa,s.version=Ee,s.warnOnce=xt,s.window=D,s.wrap=xe}),E(["./shared"],function(s){function D(Q){if(typeof Q=="number"||typeof Q=="boolean"||typeof Q=="string"||Q==null)return JSON.stringify(Q);if(Array.isArray(Q)){let O="[";for(const J of Q)O+=`${D(J)},`;return`${O}]`}let B="{";for(const O of Object.keys(Q).sort())B+=`${O}:${D(Q[O])},`;return`${B}}`}function V(Q){let B="";for(const O of s.refProperties)B+=`/${D(Q[O])}`;return B}class N{constructor(B){this.keyCache={},B&&this.replace(B)}replace(B){this._layerConfigs={},this._layers={},this.update(B,[])}update(B,O){for(const ne of B)this._layerConfigs[ne.id]=ne,(this._layers[ne.id]=s.createStyleLayer(ne)).compileFilter(),this.keyCache[ne.id]&&delete this.keyCache[ne.id];for(const ne of O)delete this.keyCache[ne],delete this._layerConfigs[ne],delete this._layers[ne];this.familiesBySource={};const J=function(ne,_e){const Me={};for(let ge=0;ge<ne.length;ge++){const ke=_e&&_e[ne[ge].id]||V(ne[ge]);_e&&(_e[ne[ge].id]=ke);let Qe=Me[ke];Qe||(Qe=Me[ke]=[]),Qe.push(ne[ge])}const Se=[];for(const ge in Me)Se.push(Me[ge]);return Se}(s.values(this._layerConfigs),this.keyCache);for(const ne of J){const _e=ne.map(Ct=>this._layers[Ct.id]),Me=_e[0];if(Me.visibility==="none")continue;const Se=Me.source||"";let ge=this.familiesBySource[Se];ge||(ge=this.familiesBySource[Se]={});const ke=Me.sourceLayer||"_geojsonTileLayer";let Qe=ge[ke];Qe||(Qe=ge[ke]=[]),Qe.push(_e)}}}class F{loadTile(B,O){const{uid:J,encoding:ne,rawImageData:_e,padding:Me,buildQuadTree:Se}=B,ge=s.window.ImageBitmap&&_e instanceof s.window.ImageBitmap?this.getImageData(_e,Me):_e;O(null,new s.DEMData(J,ge,ne,Me<1,Se))}getImageData(B,O){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(B.width,B.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=B.width,this.offscreenCanvas.height=B.height,this.offscreenCanvasContext.drawImage(B,0,0,B.width,B.height);const J=this.offscreenCanvasContext.getImageData(-O,-O,B.width+2*O,B.height+2*O);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),J}}var q=function Q(B,O){var J,ne=B&&B.type;if(ne==="FeatureCollection")for(J=0;J<B.features.length;J++)Q(B.features[J],O);else if(ne==="GeometryCollection")for(J=0;J<B.geometries.length;J++)Q(B.geometries[J],O);else if(ne==="Feature")Q(B.geometry,O);else if(ne==="Polygon")H(B.coordinates,O);else if(ne==="MultiPolygon")for(J=0;J<B.coordinates.length;J++)H(B.coordinates[J],O);return B};function H(Q,B){if(Q.length!==0){de(Q[0],B);for(var O=1;O<Q.length;O++)de(Q[O],!B)}}function de(Q,B){for(var O=0,J=0,ne=0,_e=Q.length,Me=_e-1;ne<_e;Me=ne++){var Se=(Q[ne][0]-Q[Me][0])*(Q[Me][1]+Q[ne][1]),ge=O+Se;J+=Math.abs(O)>=Math.abs(Se)?O-ge+Se:Se-ge+O,O=ge}O+J>=0!=!!B&&Q.reverse()}const ye=s.vectorTile.VectorTileFeature.prototype.toGeoJSON;class ze{constructor(B){this._feature=B,this.extent=s.EXTENT,this.type=B.type,this.properties=B.tags,"id"in B&&!isNaN(B.id)&&(this.id=parseInt(B.id,10))}loadGeometry(){if(this._feature.type===1){const B=[];for(const O of this._feature.geometry)B.push([new s.pointGeometry(O[0],O[1])]);return B}{const B=[];for(const O of this._feature.geometry){const J=[];for(const ne of O)J.push(new s.pointGeometry(ne[0],ne[1]));B.push(J)}return B}}toGeoJSON(B,O,J){return ye.call(this,B,O,J)}}class He{constructor(B){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=B.length,this._features=B}feature(B){return new ze(this._features[B])}}var we=s.vectorTile.VectorTileFeature,Le=Ne;function Ne(Q,B){this.options=B||{},this.features=Q,this.length=Q.length}function Te(Q,B){this.id=typeof Q.id=="number"?Q.id:void 0,this.type=Q.type,this.rawGeometry=Q.type===1?[Q.geometry]:Q.geometry,this.properties=Q.tags,this.extent=B||4096}Ne.prototype.feature=function(Q){return new Te(this.features[Q],this.options.extent)},Te.prototype.loadGeometry=function(){var Q=this.rawGeometry;this.geometry=[];for(var B=0;B<Q.length;B++){for(var O=Q[B],J=[],ne=0;ne<O.length;ne++)J.push(new s.pointGeometry(O[ne][0],O[ne][1]));this.geometry.push(J)}return this.geometry},Te.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Q=this.geometry,B=1/0,O=-1/0,J=1/0,ne=-1/0,_e=0;_e<Q.length;_e++)for(var Me=Q[_e],Se=0;Se<Me.length;Se++){var ge=Me[Se];B=Math.min(B,ge.x),O=Math.max(O,ge.x),J=Math.min(J,ge.y),ne=Math.max(ne,ge.y)}return[B,J,O,ne]},Te.prototype.toGeoJSON=we.prototype.toGeoJSON;var Pe=De,xe=Le;function De(Q){var B=new s.pbf;return function(O,J){for(var ne in O.layers)J.writeMessage(3,Ke,O.layers[ne])}(Q,B),B.finish()}function Ke(Q,B){var O;B.writeVarintField(15,Q.version||1),B.writeStringField(1,Q.name||""),B.writeVarintField(5,Q.extent||4096);var J={keys:[],values:[],keycache:{},valuecache:{}};for(O=0;O<Q.length;O++)J.feature=Q.feature(O),B.writeMessage(2,Ue,J);var ne=J.keys;for(O=0;O<ne.length;O++)B.writeStringField(3,ne[O]);var _e=J.values;for(O=0;O<_e.length;O++)B.writeMessage(4,Ot,_e[O])}function Ue(Q,B){var O=Q.feature;O.id!==void 0&&B.writeVarintField(1,O.id),B.writeMessage(2,nt,Q),B.writeVarintField(3,O.type),B.writeMessage(4,Ye,O)}function nt(Q,B){var O=Q.feature,J=Q.keys,ne=Q.values,_e=Q.keycache,Me=Q.valuecache;for(var Se in O.properties){var ge=O.properties[Se],ke=_e[Se];if(ge!==null){ke===void 0&&(J.push(Se),_e[Se]=ke=J.length-1),B.writeVarint(ke);var Qe=typeof ge;Qe!=="string"&&Qe!=="boolean"&&Qe!=="number"&&(ge=JSON.stringify(ge));var Ct=Qe+":"+ge,st=Me[Ct];st===void 0&&(ne.push(ge),Me[Ct]=st=ne.length-1),B.writeVarint(st)}}}function $e(Q,B){return(B<<3)+(7&Q)}function Ge(Q){return Q<<1^Q>>31}function Ye(Q,B){for(var O=Q.loadGeometry(),J=Q.type,ne=0,_e=0,Me=O.length,Se=0;Se<Me;Se++){var ge=O[Se],ke=1;J===1&&(ke=ge.length),B.writeVarint($e(1,ke));for(var Qe=J===3?ge.length-1:ge.length,Ct=0;Ct<Qe;Ct++){Ct===1&&J!==1&&B.writeVarint($e(2,Qe-1));var st=ge[Ct].x-ne,$t=ge[Ct].y-_e;B.writeVarint(Ge(st)),B.writeVarint(Ge($t)),ne+=st,_e+=$t}J===3&&B.writeVarint($e(7,1))}}function Ot(Q,B){var O=typeof Q;O==="string"?B.writeStringField(1,Q):O==="boolean"?B.writeBooleanField(7,Q):O==="number"&&(Q%1!=0?B.writeDoubleField(3,Q):Q<0?B.writeSVarintField(6,Q):B.writeVarintField(5,Q))}function Ht(Q,B,O,J,ne,_e){if(ne-J<=O)return;const Me=J+ne>>1;ot(Q,B,Me,J,ne,_e%2),Ht(Q,B,O,J,Me-1,_e+1),Ht(Q,B,O,Me+1,ne,_e+1)}function ot(Q,B,O,J,ne,_e){for(;ne>J;){if(ne-J>600){const ke=ne-J+1,Qe=O-J+1,Ct=Math.log(ke),st=.5*Math.exp(2*Ct/3),$t=.5*Math.sqrt(Ct*st*(ke-st)/ke)*(Qe-ke/2<0?-1:1);ot(Q,B,O,Math.max(J,Math.floor(O-Qe*st/ke+$t)),Math.min(ne,Math.floor(O+(ke-Qe)*st/ke+$t)),_e)}const Me=B[2*O+_e];let Se=J,ge=ne;for(At(Q,B,J,O),B[2*ne+_e]>Me&&At(Q,B,J,ne);Se<ge;){for(At(Q,B,Se,ge),Se++,ge--;B[2*Se+_e]<Me;)Se++;for(;B[2*ge+_e]>Me;)ge--}B[2*J+_e]===Me?At(Q,B,J,ge):(ge++,At(Q,B,ge,ne)),ge<=O&&(J=ge+1),O<=ge&&(ne=ge-1)}}function At(Q,B,O,J){di(Q,O,J),di(B,2*O,2*J),di(B,2*O+1,2*J+1)}function di(Q,B,O){const J=Q[B];Q[B]=Q[O],Q[O]=J}function Oe(Q,B,O,J){const ne=Q-O,_e=B-J;return ne*ne+_e*_e}Pe.fromVectorTileJs=De,Pe.fromGeojsonVt=function(Q,B){B=B||{};var O={};for(var J in Q)O[J]=new Le(Q[J].features,B),O[J].name=J,O[J].version=B.version,O[J].extent=B.extent;return De({layers:O})},Pe.GeoJSONWrapper=xe;const _t=Q=>Q[0],xt=Q=>Q[1];class Lt{constructor(B,O=_t,J=xt,ne=64,_e=Float64Array){this.nodeSize=ne,this.points=B;const Me=B.length<65536?Uint16Array:Uint32Array,Se=this.ids=new Me(B.length),ge=this.coords=new _e(2*B.length);for(let ke=0;ke<B.length;ke++)Se[ke]=ke,ge[2*ke]=O(B[ke]),ge[2*ke+1]=J(B[ke]);Ht(Se,ge,ne,0,Se.length-1,0)}range(B,O,J,ne){return function(_e,Me,Se,ge,ke,Qe,Ct){const st=[0,_e.length-1,0],$t=[];let Xt,jt;for(;st.length;){const Qt=st.pop(),ci=st.pop(),Pi=st.pop();if(ci-Pi<=Ct){for(let Ze=Pi;Ze<=ci;Ze++)Xt=Me[2*Ze],jt=Me[2*Ze+1],Xt>=Se&&Xt<=ke&&jt>=ge&&jt<=Qe&&$t.push(_e[Ze]);continue}const ce=Math.floor((Pi+ci)/2);Xt=Me[2*ce],jt=Me[2*ce+1],Xt>=Se&&Xt<=ke&&jt>=ge&&jt<=Qe&&$t.push(_e[ce]);const vt=(Qt+1)%2;(Qt===0?Se<=Xt:ge<=jt)&&(st.push(Pi),st.push(ce-1),st.push(vt)),(Qt===0?ke>=Xt:Qe>=jt)&&(st.push(ce+1),st.push(ci),st.push(vt))}return $t}(this.ids,this.coords,B,O,J,ne,this.nodeSize)}within(B,O,J){return function(ne,_e,Me,Se,ge,ke){const Qe=[0,ne.length-1,0],Ct=[],st=ge*ge;for(;Qe.length;){const $t=Qe.pop(),Xt=Qe.pop(),jt=Qe.pop();if(Xt-jt<=ke){for(let vt=jt;vt<=Xt;vt++)Oe(_e[2*vt],_e[2*vt+1],Me,Se)<=st&&Ct.push(ne[vt]);continue}const Qt=Math.floor((jt+Xt)/2),ci=_e[2*Qt],Pi=_e[2*Qt+1];Oe(ci,Pi,Me,Se)<=st&&Ct.push(ne[Qt]);const ce=($t+1)%2;($t===0?Me-ge<=ci:Se-ge<=Pi)&&(Qe.push(jt),Qe.push(Qt-1),Qe.push(ce)),($t===0?Me+ge>=ci:Se+ge>=Pi)&&(Qe.push(Qt+1),Qe.push(Xt),Qe.push(ce))}return Ct}(this.ids,this.coords,B,O,J,this.nodeSize)}}const pi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Q=>Q},Ci=Math.fround||(Kt=new Float32Array(1),Q=>(Kt[0]=+Q,Kt[0]));var Kt;class Yt{constructor(B){this.options=ct(Object.create(pi),B),this.trees=new Array(this.options.maxZoom+1)}load(B){const{log:O,minZoom:J,maxZoom:ne,nodeSize:_e}=this.options;O&&console.time("total time");const Me=`prepare ${B.length} points`;O&&console.time(Me),this.points=B;let Se=[];for(let ge=0;ge<B.length;ge++)B[ge].geometry&&Se.push(Et(B[ge],ge));this.trees[ne+1]=new Lt(Se,ut,bt,_e,Float32Array),O&&console.timeEnd(Me);for(let ge=ne;ge>=J;ge--){const ke=+Date.now();Se=this._cluster(Se,ge),this.trees[ge]=new Lt(Se,ut,bt,_e,Float32Array),O&&console.log("z%d: %d clusters in %dms",ge,Se.length,+Date.now()-ke)}return O&&console.timeEnd("total time"),this}getClusters(B,O){let J=((B[0]+180)%360+360)%360-180;const ne=Math.max(-90,Math.min(90,B[1]));let _e=B[2]===180?180:((B[2]+180)%360+360)%360-180;const Me=Math.max(-90,Math.min(90,B[3]));if(B[2]-B[0]>=360)J=-180,_e=180;else if(J>_e){const Qe=this.getClusters([J,ne,180,Me],O),Ct=this.getClusters([-180,ne,_e,Me],O);return Qe.concat(Ct)}const Se=this.trees[this._limitZoom(O)],ge=Se.range(ue(J),Ee(Me),ue(_e),Ee(ne)),ke=[];for(const Qe of ge){const Ct=Se.points[Qe];ke.push(Ct.numPoints?Bi(Ct):this.points[Ct.index])}return ke}getChildren(B){const O=this._getOriginId(B),J=this._getOriginZoom(B),ne="No cluster with the specified id.",_e=this.trees[J];if(!_e)throw new Error(ne);const Me=_e.points[O];if(!Me)throw new Error(ne);const Se=this.options.radius/(this.options.extent*Math.pow(2,J-1)),ge=_e.within(Me.x,Me.y,Se),ke=[];for(const Qe of ge){const Ct=_e.points[Qe];Ct.parentId===B&&ke.push(Ct.numPoints?Bi(Ct):this.points[Ct.index])}if(ke.length===0)throw new Error(ne);return ke}getLeaves(B,O,J){const ne=[];return this._appendLeaves(ne,B,O=O||10,J=J||0,0),ne}getTile(B,O,J){const ne=this.trees[this._limitZoom(B)],_e=Math.pow(2,B),{extent:Me,radius:Se}=this.options,ge=Se/Me,ke=(J-ge)/_e,Qe=(J+1+ge)/_e,Ct={features:[]};return this._addTileFeatures(ne.range((O-ge)/_e,ke,(O+1+ge)/_e,Qe),ne.points,O,J,_e,Ct),O===0&&this._addTileFeatures(ne.range(1-ge/_e,ke,1,Qe),ne.points,_e,J,_e,Ct),O===_e-1&&this._addTileFeatures(ne.range(0,ke,ge/_e,Qe),ne.points,-1,J,_e,Ct),Ct.features.length?Ct:null}getClusterExpansionZoom(B){let O=this._getOriginZoom(B)-1;for(;O<=this.options.maxZoom;){const J=this.getChildren(B);if(O++,J.length!==1)break;B=J[0].properties.cluster_id}return O}_appendLeaves(B,O,J,ne,_e){const Me=this.getChildren(O);for(const Se of Me){const ge=Se.properties;if(ge&&ge.cluster?_e+ge.point_count<=ne?_e+=ge.point_count:_e=this._appendLeaves(B,ge.cluster_id,J,ne,_e):_e<ne?_e++:B.push(Se),B.length===J)break}return _e}_addTileFeatures(B,O,J,ne,_e,Me){for(const Se of B){const ge=O[Se],ke=ge.numPoints;let Qe,Ct,st;if(ke)Qe=Tn(ge),Ct=ge.x,st=ge.y;else{const jt=this.points[ge.index];Qe=jt.properties,Ct=ue(jt.geometry.coordinates[0]),st=Ee(jt.geometry.coordinates[1])}const $t={type:1,geometry:[[Math.round(this.options.extent*(Ct*_e-J)),Math.round(this.options.extent*(st*_e-ne))]],tags:Qe};let Xt;ke?Xt=ge.id:this.options.generateId?Xt=ge.index:this.points[ge.index].id&&(Xt=this.points[ge.index].id),Xt!==void 0&&($t.id=Xt),Me.features.push($t)}}_limitZoom(B){return Math.max(this.options.minZoom,Math.min(+B,this.options.maxZoom+1))}_cluster(B,O){const J=[],{radius:ne,extent:_e,reduce:Me,minPoints:Se}=this.options,ge=ne/(_e*Math.pow(2,O));for(let ke=0;ke<B.length;ke++){const Qe=B[ke];if(Qe.zoom<=O)continue;Qe.zoom=O;const Ct=this.trees[O+1],st=Ct.within(Qe.x,Qe.y,ge),$t=Qe.numPoints||1;let Xt=$t;for(const jt of st){const Qt=Ct.points[jt];Qt.zoom>O&&(Xt+=Qt.numPoints||1)}if(Xt>$t&&Xt>=Se){let jt=Qe.x*$t,Qt=Qe.y*$t,ci=Me&&$t>1?this._map(Qe,!0):null;const Pi=(ke<<5)+(O+1)+this.points.length;for(const ce of st){const vt=Ct.points[ce];if(vt.zoom<=O)continue;vt.zoom=O;const Ze=vt.numPoints||1;jt+=vt.x*Ze,Qt+=vt.y*Ze,vt.parentId=Pi,Me&&(ci||(ci=this._map(Qe,!0)),Me(ci,this._map(vt)))}Qe.parentId=Pi,J.push(Jt(jt/Xt,Qt/Xt,Pi,Xt,ci))}else if(J.push(Qe),Xt>1)for(const jt of st){const Qt=Ct.points[jt];Qt.zoom<=O||(Qt.zoom=O,J.push(Qt))}}return J}_getOriginId(B){return B-this.points.length>>5}_getOriginZoom(B){return(B-this.points.length)%32}_map(B,O){if(B.numPoints)return O?ct({},B.properties):B.properties;const J=this.points[B.index].properties,ne=this.options.map(J);return O&&ne===J?ct({},ne):ne}}function Jt(Q,B,O,J,ne){return{x:Ci(Q),y:Ci(B),zoom:1/0,id:O,parentId:-1,numPoints:J,properties:ne}}function Et(Q,B){const[O,J]=Q.geometry.coordinates;return{x:Ci(ue(O)),y:Ci(Ee(J)),zoom:1/0,index:B,parentId:-1}}function Bi(Q){return{type:"Feature",id:Q.id,properties:Tn(Q),geometry:{type:"Point",coordinates:[(B=Q.x,360*(B-.5)),Re(Q.y)]}};var B}function Tn(Q){const B=Q.numPoints,O=B>=1e4?`${Math.round(B/1e3)}k`:B>=1e3?Math.round(B/100)/10+"k":B;return ct(ct({},Q.properties),{cluster:!0,cluster_id:Q.id,point_count:B,point_count_abbreviated:O})}function ue(Q){return Q/360+.5}function Ee(Q){const B=Math.sin(Q*Math.PI/180),O=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return O<0?0:O>1?1:O}function Re(Q){const B=(180-360*Q)*Math.PI/180;return 360*Math.atan(Math.exp(B))/Math.PI-90}function ct(Q,B){for(const O in B)Q[O]=B[O];return Q}function ut(Q){return Q.x}function bt(Q){return Q.y}function Mt(Q,B,O,J){for(var ne,_e=J,Me=O-B>>1,Se=O-B,ge=Q[B],ke=Q[B+1],Qe=Q[O],Ct=Q[O+1],st=B+3;st<O;st+=3){var $t=gt(Q[st],Q[st+1],ge,ke,Qe,Ct);if($t>_e)ne=st,_e=$t;else if($t===_e){var Xt=Math.abs(st-Me);Xt<Se&&(ne=st,Se=Xt)}}_e>J&&(ne-B>3&&Mt(Q,B,ne,J),Q[ne+2]=_e,O-ne>3&&Mt(Q,ne,O,J))}function gt(Q,B,O,J,ne,_e){var Me=ne-O,Se=_e-J;if(Me!==0||Se!==0){var ge=((Q-O)*Me+(B-J)*Se)/(Me*Me+Se*Se);ge>1?(O=ne,J=_e):ge>0&&(O+=Me*ge,J+=Se*ge)}return(Me=Q-O)*Me+(Se=B-J)*Se}function Xe(Q,B,O,J){var ne={id:Q===void 0?null:Q,type:B,geometry:O,tags:J,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(_e){var Me=_e.geometry,Se=_e.type;if(Se==="Point"||Se==="MultiPoint"||Se==="LineString")ht(_e,Me);else if(Se==="Polygon"||Se==="MultiLineString")for(var ge=0;ge<Me.length;ge++)ht(_e,Me[ge]);else if(Se==="MultiPolygon")for(ge=0;ge<Me.length;ge++)for(var ke=0;ke<Me[ge].length;ke++)ht(_e,Me[ge][ke])}(ne),ne}function ht(Q,B){for(var O=0;O<B.length;O+=3)Q.minX=Math.min(Q.minX,B[O]),Q.minY=Math.min(Q.minY,B[O+1]),Q.maxX=Math.max(Q.maxX,B[O]),Q.maxY=Math.max(Q.maxY,B[O+1])}function qt(Q,B,O,J){if(B.geometry){var ne=B.geometry.coordinates,_e=B.geometry.type,Me=Math.pow(O.tolerance/((1<<O.maxZoom)*O.extent),2),Se=[],ge=B.id;if(O.promoteId?ge=B.properties[O.promoteId]:O.generateId&&(ge=J||0),_e==="Point")Nt(ne,Se);else if(_e==="MultiPoint")for(var ke=0;ke<ne.length;ke++)Nt(ne[ke],Se);else if(_e==="LineString")Zt(ne,Se,Me,!1);else if(_e==="MultiLineString"){if(O.lineMetrics){for(ke=0;ke<ne.length;ke++)Zt(ne[ke],Se=[],Me,!1),Q.push(Xe(ge,"LineString",Se,B.properties));return}ti(ne,Se,Me,!1)}else if(_e==="Polygon")ti(ne,Se,Me,!0);else{if(_e!=="MultiPolygon"){if(_e==="GeometryCollection"){for(ke=0;ke<B.geometry.geometries.length;ke++)qt(Q,{id:ge,geometry:B.geometry.geometries[ke],properties:B.properties},O,J);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ke=0;ke<ne.length;ke++){var Qe=[];ti(ne[ke],Qe,Me,!0),Se.push(Qe)}}Q.push(Xe(ge,_e,Se,B.properties))}}function Nt(Q,B){B.push(mi(Q[0])),B.push(zi(Q[1])),B.push(0)}function Zt(Q,B,O,J){for(var ne,_e,Me=0,Se=0;Se<Q.length;Se++){var ge=mi(Q[Se][0]),ke=zi(Q[Se][1]);B.push(ge),B.push(ke),B.push(0),Se>0&&(Me+=J?(ne*ke-ge*_e)/2:Math.sqrt(Math.pow(ge-ne,2)+Math.pow(ke-_e,2))),ne=ge,_e=ke}var Qe=B.length-3;B[2]=1,Mt(B,0,Qe,O),B[Qe+2]=1,B.size=Math.abs(Me),B.start=0,B.end=B.size}function ti(Q,B,O,J){for(var ne=0;ne<Q.length;ne++){var _e=[];Zt(Q[ne],_e,O,J),B.push(_e)}}function mi(Q){return Q/360+.5}function zi(Q){var B=Math.sin(Q*Math.PI/180),O=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return O<0?0:O>1?1:O}function si(Q,B,O,J,ne,_e,Me,Se){if(J/=B,_e>=(O/=B)&&Me<J)return Q;if(Me<O||_e>=J)return null;for(var ge=[],ke=0;ke<Q.length;ke++){var Qe=Q[ke],Ct=Qe.geometry,st=Qe.type,$t=ne===0?Qe.minX:Qe.minY,Xt=ne===0?Qe.maxX:Qe.maxY;if($t>=O&&Xt<J)ge.push(Qe);else if(!(Xt<O||$t>=J)){var jt=[];if(st==="Point"||st==="MultiPoint")Ai(Ct,jt,O,J,ne);else if(st==="LineString")hn(Ct,jt,O,J,ne,!1,Se.lineMetrics);else if(st==="MultiLineString")Cn(Ct,jt,O,J,ne,!1);else if(st==="Polygon")Cn(Ct,jt,O,J,ne,!0);else if(st==="MultiPolygon")for(var Qt=0;Qt<Ct.length;Qt++){var ci=[];Cn(Ct[Qt],ci,O,J,ne,!0),ci.length&&jt.push(ci)}if(jt.length){if(Se.lineMetrics&&st==="LineString"){for(Qt=0;Qt<jt.length;Qt++)ge.push(Xe(Qe.id,st,jt[Qt],Qe.tags));continue}st!=="LineString"&&st!=="MultiLineString"||(jt.length===1?(st="LineString",jt=jt[0]):st="MultiLineString"),st!=="Point"&&st!=="MultiPoint"||(st=jt.length===3?"Point":"MultiPoint"),ge.push(Xe(Qe.id,st,jt,Qe.tags))}}}return ge.length?ge:null}function Ai(Q,B,O,J,ne){for(var _e=0;_e<Q.length;_e+=3){var Me=Q[_e+ne];Me>=O&&Me<=J&&(B.push(Q[_e]),B.push(Q[_e+1]),B.push(Q[_e+2]))}}function hn(Q,B,O,J,ne,_e,Me){for(var Se,ge,ke=_r(Q),Qe=ne===0?qr:gn,Ct=Q.start,st=0;st<Q.length-3;st+=3){var $t=Q[st],Xt=Q[st+1],jt=Q[st+2],Qt=Q[st+3],ci=Q[st+4],Pi=ne===0?$t:Xt,ce=ne===0?Qt:ci,vt=!1;Me&&(Se=Math.sqrt(Math.pow($t-Qt,2)+Math.pow(Xt-ci,2))),Pi<O?ce>O&&(ge=Qe(ke,$t,Xt,Qt,ci,O),Me&&(ke.start=Ct+Se*ge)):Pi>J?ce<J&&(ge=Qe(ke,$t,Xt,Qt,ci,J),Me&&(ke.start=Ct+Se*ge)):kn(ke,$t,Xt,jt),ce<O&&Pi>=O&&(ge=Qe(ke,$t,Xt,Qt,ci,O),vt=!0),ce>J&&Pi<=J&&(ge=Qe(ke,$t,Xt,Qt,ci,J),vt=!0),!_e&&vt&&(Me&&(ke.end=Ct+Se*ge),B.push(ke),ke=_r(Q)),Me&&(Ct+=Se)}var Ze=Q.length-3;$t=Q[Ze],Xt=Q[Ze+1],jt=Q[Ze+2],(Pi=ne===0?$t:Xt)>=O&&Pi<=J&&kn(ke,$t,Xt,jt),Ze=ke.length-3,_e&&Ze>=3&&(ke[Ze]!==ke[0]||ke[Ze+1]!==ke[1])&&kn(ke,ke[0],ke[1],ke[2]),ke.length&&B.push(ke)}function _r(Q){var B=[];return B.size=Q.size,B.start=Q.start,B.end=Q.end,B}function Cn(Q,B,O,J,ne,_e){for(var Me=0;Me<Q.length;Me++)hn(Q[Me],B,O,J,ne,_e,!1)}function kn(Q,B,O,J){Q.push(B),Q.push(O),Q.push(J)}function qr(Q,B,O,J,ne,_e){var Me=(_e-B)/(J-B);return Q.push(_e),Q.push(O+(ne-O)*Me),Q.push(1),Me}function gn(Q,B,O,J,ne,_e){var Me=(_e-O)/(ne-O);return Q.push(B+(J-B)*Me),Q.push(_e),Q.push(1),Me}function zn(Q,B){for(var O=[],J=0;J<Q.length;J++){var ne,_e=Q[J],Me=_e.type;if(Me==="Point"||Me==="MultiPoint"||Me==="LineString")ne=Pr(_e.geometry,B);else if(Me==="MultiLineString"||Me==="Polygon"){ne=[];for(var Se=0;Se<_e.geometry.length;Se++)ne.push(Pr(_e.geometry[Se],B))}else if(Me==="MultiPolygon")for(ne=[],Se=0;Se<_e.geometry.length;Se++){for(var ge=[],ke=0;ke<_e.geometry[Se].length;ke++)ge.push(Pr(_e.geometry[Se][ke],B));ne.push(ge)}O.push(Xe(_e.id,Me,ne,_e.tags))}return O}function Pr(Q,B){var O=[];O.size=Q.size,Q.start!==void 0&&(O.start=Q.start,O.end=Q.end);for(var J=0;J<Q.length;J+=3)O.push(Q[J]+B,Q[J+1],Q[J+2]);return O}function Eo(Q,B){if(Q.transformed)return Q;var O,J,ne,_e=1<<Q.z,Me=Q.x,Se=Q.y;for(O=0;O<Q.features.length;O++){var ge=Q.features[O],ke=ge.geometry,Qe=ge.type;if(ge.geometry=[],Qe===1)for(J=0;J<ke.length;J+=2)ge.geometry.push(Ho(ke[J],ke[J+1],B,_e,Me,Se));else for(J=0;J<ke.length;J++){var Ct=[];for(ne=0;ne<ke[J].length;ne+=2)Ct.push(Ho(ke[J][ne],ke[J][ne+1],B,_e,Me,Se));ge.geometry.push(Ct)}}return Q.transformed=!0,Q}function Ho(Q,B,O,J,ne,_e){return[Math.round(O*(Q*J-ne)),Math.round(O*(B*J-_e))]}function ws(Q,B,O,J,ne){for(var _e=B===ne.maxZoom?0:ne.tolerance/((1<<B)*ne.extent),Me={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:O,y:J,z:B,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Se=0;Se<Q.length;Se++){Me.numFeatures++,da(Me,Q[Se],_e,ne);var ge=Q[Se].minX,ke=Q[Se].minY,Qe=Q[Se].maxX,Ct=Q[Se].maxY;ge<Me.minX&&(Me.minX=ge),ke<Me.minY&&(Me.minY=ke),Qe>Me.maxX&&(Me.maxX=Qe),Ct>Me.maxY&&(Me.maxY=Ct)}return Me}function da(Q,B,O,J){var ne=B.geometry,_e=B.type,Me=[];if(_e==="Point"||_e==="MultiPoint")for(var Se=0;Se<ne.length;Se+=3)Me.push(ne[Se]),Me.push(ne[Se+1]),Q.numPoints++,Q.numSimplified++;else if(_e==="LineString")Dr(Me,ne,Q,O,!1,!1);else if(_e==="MultiLineString"||_e==="Polygon")for(Se=0;Se<ne.length;Se++)Dr(Me,ne[Se],Q,O,_e==="Polygon",Se===0);else if(_e==="MultiPolygon")for(var ge=0;ge<ne.length;ge++){var ke=ne[ge];for(Se=0;Se<ke.length;Se++)Dr(Me,ke[Se],Q,O,!0,Se===0)}if(Me.length){var Qe=B.tags||null;if(_e==="LineString"&&J.lineMetrics){for(var Ct in Qe={},B.tags)Qe[Ct]=B.tags[Ct];Qe.mapbox_clip_start=ne.start/ne.size,Qe.mapbox_clip_end=ne.end/ne.size}var st={geometry:Me,type:_e==="Polygon"||_e==="MultiPolygon"?3:_e==="LineString"||_e==="MultiLineString"?2:1,tags:Qe};B.id!==null&&(st.id=B.id),Q.features.push(st)}}function Dr(Q,B,O,J,ne,_e){var Me=J*J;if(J>0&&B.size<(ne?Me:J))O.numPoints+=B.length/3;else{for(var Se=[],ge=0;ge<B.length;ge+=3)(J===0||B[ge+2]>Me)&&(O.numSimplified++,Se.push(B[ge]),Se.push(B[ge+1])),O.numPoints++;ne&&function(ke,Qe){for(var Ct=0,st=0,$t=ke.length,Xt=$t-2;st<$t;Xt=st,st+=2)Ct+=(ke[st]-ke[Xt])*(ke[st+1]+ke[Xt+1]);if(Ct>0===Qe)for(st=0,$t=ke.length;st<$t/2;st+=2){var jt=ke[st],Qt=ke[st+1];ke[st]=ke[$t-2-st],ke[st+1]=ke[$t-1-st],ke[$t-2-st]=jt,ke[$t-1-st]=Qt}}(Se,_e),Q.push(Se)}}function Lr(Q,B){var O=(B=this.options=function(ne,_e){for(var Me in _e)ne[Me]=_e[Me];return ne}(Object.create(this.options),B)).debug;if(O&&console.time("preprocess data"),B.maxZoom<0||B.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(B.promoteId&&B.generateId)throw new Error("promoteId and generateId cannot be used together.");var J=function(ne,_e){var Me=[];if(ne.type==="FeatureCollection")for(var Se=0;Se<ne.features.length;Se++)qt(Me,ne.features[Se],_e,Se);else qt(Me,ne.type==="Feature"?ne:{geometry:ne},_e);return Me}(Q,B);this.tiles={},this.tileCoords=[],O&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",B.indexMaxZoom,B.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(J=function(ne,_e){var Me=_e.buffer/_e.extent,Se=ne,ge=si(ne,1,-1-Me,Me,0,-1,2,_e),ke=si(ne,1,1-Me,2+Me,0,-1,2,_e);return(ge||ke)&&(Se=si(ne,1,-Me,1+Me,0,-1,2,_e)||[],ge&&(Se=zn(ge,1).concat(Se)),ke&&(Se=Se.concat(zn(ke,-1)))),Se}(J,B)).length&&this.splitTile(J,0,0,0),O&&(J.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function to(Q,B,O){return 32*((1<<Q)*O+B)+Q}function io(Q,B){const O=Q.tileID.canonical;if(!this._geoJSONIndex)return B(null,null);const J=this._geoJSONIndex.getTile(O.z,O.x,O.y);if(!J)return B(null,null);const ne=new He(J.features);let _e=Pe(ne);_e.byteOffset===0&&_e.byteLength===_e.buffer.byteLength||(_e=new Uint8Array(_e)),B(null,{vectorTile:ne,rawData:_e.buffer})}Lr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Lr.prototype.splitTile=function(Q,B,O,J,ne,_e,Me){for(var Se=[Q,B,O,J],ge=this.options,ke=ge.debug;Se.length;){J=Se.pop(),O=Se.pop(),B=Se.pop(),Q=Se.pop();var Qe=1<<B,Ct=to(B,O,J),st=this.tiles[Ct];if(!st&&(ke>1&&console.time("creation"),st=this.tiles[Ct]=ws(Q,B,O,J,ge),this.tileCoords.push({z:B,x:O,y:J}),ke)){ke>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",B,O,J,st.numFeatures,st.numPoints,st.numSimplified),console.timeEnd("creation"));var $t="z"+B;this.stats[$t]=(this.stats[$t]||0)+1,this.total++}if(st.source=Q,ne){if(B===ge.maxZoom||B===ne)continue;var Xt=1<<ne-B;if(O!==Math.floor(_e/Xt)||J!==Math.floor(Me/Xt))continue}else if(B===ge.indexMaxZoom||st.numPoints<=ge.indexMaxPoints)continue;if(st.source=null,Q.length!==0){ke>1&&console.time("clipping");var jt,Qt,ci,Pi,ce,vt,Ze=.5*ge.buffer/ge.extent,Ce=.5-Ze,wi=.5+Ze,ni=1+Ze;jt=Qt=ci=Pi=null,ce=si(Q,Qe,O-Ze,O+wi,0,st.minX,st.maxX,ge),vt=si(Q,Qe,O+Ce,O+ni,0,st.minX,st.maxX,ge),Q=null,ce&&(jt=si(ce,Qe,J-Ze,J+wi,1,st.minY,st.maxY,ge),Qt=si(ce,Qe,J+Ce,J+ni,1,st.minY,st.maxY,ge),ce=null),vt&&(ci=si(vt,Qe,J-Ze,J+wi,1,st.minY,st.maxY,ge),Pi=si(vt,Qe,J+Ce,J+ni,1,st.minY,st.maxY,ge),vt=null),ke>1&&console.timeEnd("clipping"),Se.push(jt||[],B+1,2*O,2*J),Se.push(Qt||[],B+1,2*O,2*J+1),Se.push(ci||[],B+1,2*O+1,2*J),Se.push(Pi||[],B+1,2*O+1,2*J+1)}}},Lr.prototype.getTile=function(Q,B,O){var J=this.options,ne=J.extent,_e=J.debug;if(Q<0||Q>24)return null;var Me=1<<Q,Se=to(Q,B=(B%Me+Me)%Me,O);if(this.tiles[Se])return Eo(this.tiles[Se],ne);_e>1&&console.log("drilling down to z%d-%d-%d",Q,B,O);for(var ge,ke=Q,Qe=B,Ct=O;!ge&&ke>0;)ke--,Qe=Math.floor(Qe/2),Ct=Math.floor(Ct/2),ge=this.tiles[to(ke,Qe,Ct)];return ge&&ge.source?(_e>1&&console.log("found parent tile z%d-%d-%d",ke,Qe,Ct),_e>1&&console.time("drilling down"),this.splitTile(ge.source,ke,Qe,Ct,Q,B,O),_e>1&&console.timeEnd("drilling down"),this.tiles[Se]?Eo(this.tiles[Se],ne):null):null};class An extends s.VectorTileWorkerSource{constructor(B,O,J,ne,_e){super(B,O,J,ne,io),_e&&(this.loadGeoJSON=_e)}loadData(B,O){const J=B&&B.request,ne=J&&J.collectResourceTiming;this.loadGeoJSON(B,(_e,Me)=>{if(_e||!Me)return O(_e);if(typeof Me!="object")return O(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`));{q(Me,!0);try{if(B.filter){const ge=s.createExpression(B.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ge.result==="error")throw new Error(ge.value.map(Qe=>`${Qe.key}: ${Qe.message}`).join(", "));const ke=Me.features.filter(Qe=>ge.value.evaluate({zoom:0},Qe));Me={type:"FeatureCollection",features:ke}}this._geoJSONIndex=B.cluster?new Yt(function({superclusterOptions:ge,clusterProperties:ke}){if(!ke||!ge)return ge;const Qe={},Ct={},st={accumulated:null,zoom:0},$t={properties:null},Xt=Object.keys(ke);for(const jt of Xt){const[Qt,ci]=ke[jt],Pi=s.createExpression(ci),ce=s.createExpression(typeof Qt=="string"?[Qt,["accumulated"],["get",jt]]:Qt);Qe[jt]=Pi.value,Ct[jt]=ce.value}return ge.map=jt=>{$t.properties=jt;const Qt={};for(const ci of Xt)Qt[ci]=Qe[ci].evaluate(st,$t);return Qt},ge.reduce=(jt,Qt)=>{$t.properties=Qt;for(const ci of Xt)st.accumulated=jt[ci],jt[ci]=Ct[ci].evaluate(st,$t)},ge}(B)).load(Me.features):function(ge,ke){return new Lr(ge,ke)}(Me,B.geojsonVtOptions)}catch(ge){return O(ge)}this.loaded={};const Se={};if(ne){const ge=s.getPerformanceMeasurement(J);ge&&(Se.resourceTiming={},Se.resourceTiming[B.source]=JSON.parse(JSON.stringify(ge)))}O(null,Se)}})}reloadTile(B,O){const J=this.loaded;return J&&J[B.uid]?super.reloadTile(B,O):this.loadTile(B,O)}loadGeoJSON(B,O){if(B.request)s.getJSON(B.request,O);else{if(typeof B.data!="string")return O(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`));try{return O(null,JSON.parse(B.data))}catch{return O(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(B,O){try{O(null,this._geoJSONIndex.getClusterExpansionZoom(B.clusterId))}catch(J){O(J)}}getClusterChildren(B,O){try{O(null,this._geoJSONIndex.getChildren(B.clusterId))}catch(J){O(J)}}getClusterLeaves(B,O){try{O(null,this._geoJSONIndex.getLeaves(B.clusterId,B.limit,B.offset))}catch(J){O(J)}}}class Er{constructor(B){this.self=B,this.actor=new s.Actor(B,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.getProjection({name:"mercator"}),this.workerSourceTypes={vector:s.VectorTileWorkerSource,geojson:An},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(O,J)=>{if(this.workerSourceTypes[O])throw new Error(`Worker source with name "${O}" already registered.`);this.workerSourceTypes[O]=J},this.self.registerRTLTextPlugin=O=>{if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=O.applyArabicShaping,s.plugin.processBidirectionalText=O.processBidirectionalText,s.plugin.processStyledBidirectionalText=O.processStyledBidirectionalText}}clearCaches(B,O,J){delete this.layerIndexes[B],delete this.availableImages[B],delete this.workerSources[B],delete this.demWorkerSources[B],J()}checkIfReady(B,O,J){J()}setReferrer(B,O){this.referrer=O}spriteLoaded(B,O){this.isSpriteLoaded[B]=O;for(const J in this.workerSources[B]){const ne=this.workerSources[B][J];for(const _e in ne)ne[_e]instanceof s.VectorTileWorkerSource&&(ne[_e].isSpriteLoaded=O,ne[_e].fire(new s.Event("isSpriteLoaded")))}}setImages(B,O,J){this.availableImages[B]=O;for(const ne in this.workerSources[B]){const _e=this.workerSources[B][ne];for(const Me in _e)_e[Me].availableImages=O}J()}enableTerrain(B,O,J){this.terrain=O,J()}setProjection(B,O){this.projections[B]=s.getProjection(O)}setLayers(B,O,J){this.getLayerIndex(B).replace(O),J()}updateLayers(B,O,J){this.getLayerIndex(B).update(O.layers,O.removedIds),J()}loadTile(B,O,J){const ne=this.enableTerrain?s.extend({enableTerrain:this.terrain},O):O;ne.projection=this.projections[B]||this.defaultProjection,this.getWorkerSource(B,O.type,O.source).loadTile(ne,J)}loadDEMTile(B,O,J){const ne=this.enableTerrain?s.extend({buildQuadTree:this.terrain},O):O;this.getDEMWorkerSource(B,O.source).loadTile(ne,J)}reloadTile(B,O,J){const ne=this.enableTerrain?s.extend({enableTerrain:this.terrain},O):O;ne.projection=this.projections[B]||this.defaultProjection,this.getWorkerSource(B,O.type,O.source).reloadTile(ne,J)}abortTile(B,O,J){this.getWorkerSource(B,O.type,O.source).abortTile(O,J)}removeTile(B,O,J){this.getWorkerSource(B,O.type,O.source).removeTile(O,J)}removeSource(B,O,J){if(!this.workerSources[B]||!this.workerSources[B][O.type]||!this.workerSources[B][O.type][O.source])return;const ne=this.workerSources[B][O.type][O.source];delete this.workerSources[B][O.type][O.source],ne.removeSource!==void 0?ne.removeSource(O,J):J()}loadWorkerSource(B,O,J){try{this.self.importScripts(O.url),J()}catch(ne){J(ne.toString())}}syncRTLPluginState(B,O,J){try{s.plugin.setState(O);const ne=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&ne!=null){this.self.importScripts(ne);const _e=s.plugin.isParsed();J(_e?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ne}`),_e)}}catch(ne){J(ne.toString())}}getAvailableImages(B){let O=this.availableImages[B];return O||(O=[]),O}getLayerIndex(B){let O=this.layerIndexes[B];return O||(O=this.layerIndexes[B]=new N),O}getWorkerSource(B,O,J){return this.workerSources[B]||(this.workerSources[B]={}),this.workerSources[B][O]||(this.workerSources[B][O]={}),this.workerSources[B][O][J]||(this.workerSources[B][O][J]=new this.workerSourceTypes[O]({send:(ne,_e,Me,Se,ge,ke)=>{this.actor.send(ne,_e,Me,B,ge,ke)},scheduler:this.actor.scheduler},this.getLayerIndex(B),this.getAvailableImages(B),this.isSpriteLoaded[B])),this.workerSources[B][O][J]}getDEMWorkerSource(B,O){return this.demWorkerSources[B]||(this.demWorkerSources[B]={}),this.demWorkerSources[B][O]||(this.demWorkerSources[B][O]=new F),this.demWorkerSources[B][O]}enforceCacheSizeLimit(B,O){s.enforceCacheSizeLimit(O)}getWorkerPerformanceMetrics(B,O,J){J(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Er(self)),Er}),E(["./shared"],function(s){function D(c,n){if(Array.isArray(c)){if(!Array.isArray(n)||c.length!==n.length)return!1;for(let a=0;a<c.length;a++)if(!D(c[a],n[a]))return!1;return!0}if(typeof c=="object"&&c!==null&&n!==null){if(typeof n!="object"||Object.keys(c).length!==Object.keys(n).length)return!1;for(const a in c)if(!D(c[a],n[a]))return!1;return!0}return c===n}var V=N;function N(c){return!function(n){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var d,_,g=new Blob([""],{type:"text/javascript"}),w=URL.createObjectURL(g);try{_=new Worker(w),d=!0}catch{d=!1}return _&&_.terminate(),URL.revokeObjectURL(w),d}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var d=document.createElement("canvas");d.width=d.height=1;var _=d.getContext("2d");if(!_)return!1;var g=_.getImageData(0,0,1,1);return g&&g.width===d.width}()?(F[a=n&&n.failIfMajorPerformanceCaveat]===void 0&&(F[a]=function(d){var _,g=function(w){var T=document.createElement("canvas"),C=Object.create(N.webGLContextAttributes);return C.failIfMajorPerformanceCaveat=w,T.getContext("webgl",C)||T.getContext("experimental-webgl",C)}(d);if(!g)return!1;try{_=g.createShader(g.VERTEX_SHADER)}catch{return!1}return!(!_||g.isContextLost())&&(g.shaderSource(_,"void main() {}"),g.compileShader(_),g.getShaderParameter(_,g.COMPILE_STATUS)===!0)}(a)),F[a]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var a}(c)}var F={};function q(c,n,a){const d=s.window.document.createElement(c);return n!==void 0&&(d.className=n),a&&a.appendChild(d),d}function H(c,n,a){const d=s.window.document.createElementNS("http://www.w3.org/2000/svg",c);for(const _ of Object.keys(n))d.setAttributeNS(null,_,n[_]);return a&&a.appendChild(d),d}N.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const de=s.window.document&&s.window.document.documentElement.style,ye=de&&de.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ze;function He(){de&&ye&&(ze=de[ye],de[ye]="none")}function we(){de&&ye&&(de[ye]=ze)}function Le(c){c.preventDefault(),c.stopPropagation(),s.window.removeEventListener("click",Le,!0)}function Ne(){s.window.addEventListener("click",Le,!0),s.window.setTimeout(()=>{s.window.removeEventListener("click",Le,!0)},0)}function Te(c,n){const a=c.getBoundingClientRect();return De(c,a,n)}function Pe(c,n){const a=c.getBoundingClientRect(),d=[];for(let _=0;_<n.length;_++)d.push(De(c,a,n[_]));return d}function xe(c){return s.window.InstallTrigger!==void 0&&c.button===2&&c.ctrlKey&&s.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:c.button}function De(c,n,a){const d=c.offsetWidth===n.width?1:c.offsetWidth/n.width;return new s.pointGeometry((a.clientX-n.left)*d,(a.clientY-n.top)*d)}function Ke(c,n){var a=n[0],d=n[1],_=n[2],g=n[3],w=a*g-_*d;return w?(c[0]=g*(w=1/w),c[1]=-d*w,c[2]=-_*w,c[3]=a*w,c):null}function Ue(c){const{userImage:n}=c;return!!(n&&n.render&&n.render())&&(c.data.replace(new Uint8Array(n.data.buffer)),!0)}class nt extends s.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:a,callback:d}of this.requestors)this._notify(a,d);this.requestors=[]}}hasImage(n){return!!this.getImage(n)}getImage(n){return this.images[n]}addImage(n,a){this._validate(n,a)&&(this.images[n]=a)}_validate(n,a){let d=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new s.ErrorEvent(new Error(`Image "${n}" has invalid "stretchX" value`))),d=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new s.ErrorEvent(new Error(`Image "${n}" has invalid "stretchY" value`))),d=!1),this._validateContent(a.content,a)||(this.fire(new s.ErrorEvent(new Error(`Image "${n}" has invalid "content" value`))),d=!1),d}_validateStretch(n,a){if(!n)return!0;let d=0;for(const _ of n){if(_[0]<d||_[1]<_[0]||a<_[1])return!1;d=_[1]}return!0}_validateContent(n,a){return!(n&&(n.length!==4||n[0]<0||a.data.width<n[0]||n[1]<0||a.data.height<n[1]||n[2]<0||a.data.width<n[2]||n[3]<0||a.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,a){a.version=this.images[n].version+1,this.images[n]=a,this.updatedImages[n]=!0}removeImage(n){const a=this.images[n];delete this.images[n],delete this.patterns[n],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,a){let d=!0;if(!this.isLoaded())for(const _ of n)this.images[_]||(d=!1);this.isLoaded()||d?this._notify(n,a):this.requestors.push({ids:n,callback:a})}_notify(n,a){const d={};for(const _ of n){this.images[_]||this.fire(new s.Event("styleimagemissing",{id:_}));const g=this.images[_];g?d[_]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,hasRenderCallback:Boolean(g.userImage&&g.userImage.render)}:s.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}a(null,d)}getPixelSize(){const{width:n,height:a}=this.atlasImage;return{width:n,height:a}}getPattern(n){const a=this.patterns[n],d=this.getImage(n);if(!d)return null;if(a&&a.position.version===d.version)return a.position;if(a)a.position.version=d.version;else{const _={w:d.data.width+2,h:d.data.height+2,x:0,y:0},g=new s.ImagePosition(_,d);this.patterns[n]={bin:_,position:g}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const a=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.Texture(n,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const g in this.patterns)n.push(this.patterns[g].bin);const{w:a,h:d}=s.potpack(n),_=this.atlasImage;_.resize({width:a||1,height:d||1});for(const g in this.patterns){const{bin:w}=this.patterns[g],T=w.x+1,C=w.y+1,k=this.images[g].data,z=k.width,R=k.height;s.RGBAImage.copy(k,_,{x:0,y:0},{x:T,y:C},{width:z,height:R}),s.RGBAImage.copy(k,_,{x:0,y:R-1},{x:T,y:C-1},{width:z,height:1}),s.RGBAImage.copy(k,_,{x:0,y:0},{x:T,y:C+R},{width:z,height:1}),s.RGBAImage.copy(k,_,{x:z-1,y:0},{x:T-1,y:C},{width:1,height:R}),s.RGBAImage.copy(k,_,{x:0,y:0},{x:T+z,y:C},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const a of n){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const d=this.images[a];Ue(d)&&this.updateImage(a,d)}}}const $e=new s.Properties({anchor:new s.DataConstantProperty(s.spec.light.anchor),position:new class{constructor(){this.specification=s.spec.light.position}possiblyEvaluate(c,n){return function([a,d,_]){const g=s.degToRad(d+90),w=s.degToRad(_);return{x:a*Math.cos(g)*Math.sin(w),y:a*Math.sin(g)*Math.sin(w),z:a*Math.cos(w),azimuthal:d,polar:_}}(c.expression.evaluate(n))}interpolate(c,n,a){return{x:s.number(c.x,n.x,a),y:s.number(c.y,n.y,a),z:s.number(c.z,n.z,a),azimuthal:s.number(c.azimuthal,n.azimuthal,a),polar:s.number(c.polar,n.polar,a)}}},color:new s.DataConstantProperty(s.spec.light.color),intensity:new s.DataConstantProperty(s.spec.light.intensity)}),Ge="-transition";class Ye extends s.Evented{constructor(n){super(),this._transitionable=new s.Transitionable($e),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,a={}){if(!this._validate(s.validateLight,n,a))for(const d in n){const _=n[d];s.endsWith(d,Ge)?this._transitionable.setTransition(d.slice(0,-Ge.length),_):this._transitionable.setValue(d,_)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,d){return(!d||d.validate!==!1)&&s.emitValidationErrors(this,n.call(s.validateStyle,s.extend({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}const Ot=new s.Properties({source:new s.DataConstantProperty(s.spec.terrain.source),exaggeration:new s.DataConstantProperty(s.spec.terrain.exaggeration)}),Ht="-transition";class ot extends s.Evented{constructor(n,a){super(),this._transitionable=new s.Transitionable(Ot),this.set(n),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=a}get(){return this._transitionable.serialize()}set(n){for(const a in n){const d=n[a];s.endsWith(a,Ht)?this._transitionable.setTransition(a.slice(0,-Ht.length),d):this._transitionable.setValue(a,d)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}}function At(c,n,a,d){const _=s.smoothstep(45,65,a),[g,w]=di(c,d),T=s.length(n);let C=1-Math.min(1,Math.exp((T-g)/(w-g)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*_*c.alpha}function di(c,n){const a=.5/Math.tan(.5*n);return[c.range[0]+a,c.range[1]+a]}const Oe=new s.Properties({range:new s.DataConstantProperty(s.spec.fog.range),color:new s.DataConstantProperty(s.spec.fog.color),"high-color":new s.DataConstantProperty(s.spec.fog["high-color"]),"space-color":new s.DataConstantProperty(s.spec.fog["space-color"]),"horizon-blend":new s.DataConstantProperty(s.spec.fog["horizon-blend"]),"star-intensity":new s.DataConstantProperty(s.spec.fog["star-intensity"])}),_t="-transition";class xt extends s.Evented{constructor(n,a){super(),this._transitionable=new s.Transitionable(Oe),this.set(n),this._transitioning=this._transitionable.untransitioned(),this._transform=a}get state(){const n=this._transform,a=n.projection.name==="globe",d=s.globeToMercatorTransition(n.zoom),_=this.properties.get("range"),g=[.5,3];return{range:a?[s.number(g[0],_[0],d),s.number(g[1],_[1],d)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,a={}){if(!this._validate(s.validateFog,n,a)){for(const d of Object.keys(s.spec.fog))n&&n[d]===void 0&&(n[d]=s.spec.fog[d].default);for(const d in n){const _=n[d];s.endsWith(d,_t)?this._transitionable.setTransition(d.slice(0,-_t.length),_):this._transitionable.setValue(d,_)}}}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.smoothstep(45,65,n))*a.a}getOpacityAtLatLng(n,a){return this._transform.projection.supportsFog?function(d,_,g){const w=s.MercatorCoordinate.fromLngLat(_),T=g.elevation?g.elevation.getAtPointOrZero(w):0,C=[w.x,w.y,T];return s.transformMat4(C,C,g.mercatorFogMatrix),At(d,C,g.pitch,g._fov)}(this.state,n,a):0}getFovAdjustedRange(n){return this._transform.projection.supportsFog?di(this.state,n):[0,1]}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,d){return(!d||d.validate!==!1)&&s.emitValidationErrors(this,n.call(s.validateStyle,s.extend({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}class Lt{constructor(n,a){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=s.uniqueId();const d=this.workerPool.acquire(this.id);for(let _=0;_<d.length;_++){const g=new Lt.Actor(d[_],a,this.id);g.name=`Worker ${_}`,this.actors.push(g)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,a,d){s.asyncAll(this.actors,(_,g)=>{_.send(n,a,g)},d=d||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}function pi(c,n,a){return n*(s.EXTENT/(c.tileSize*Math.pow(2,a-c.tileID.overscaledZ)))}Lt.Actor=s.Actor;class Ci{constructor(n,a,d,_){this.screenBounds=n,this.cameraPoint=a,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=d,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(n,a){let d,_;if(n instanceof s.pointGeometry||typeof n[0]=="number"){const g=s.pointGeometry.convert(n);d=[s.pointGeometry.convert(n)],_=a.isPointAboveHorizon(g)}else{const g=s.pointGeometry.convert(n[0]),w=s.pointGeometry.convert(n[1]);d=[g,w],_=s.polygonizeBounds(g,w).every(T=>a.isPointAboveHorizon(T))}return new Ci(d,a.getCameraPoint(),_,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return s.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const a=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new s.pointGeometry(1,1)):this.screenBounds[1],_=s.polygonizeBounds(a,d,0,!1);return this.cameraPoint.y>d.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<d.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=d.x?_[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(_[3]=this.cameraPoint)),s.bufferConvexPolygon(_,n)}bufferedCameraGeometryGlobe(n){const a=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new s.pointGeometry(1,1)):this.screenBounds[1],_=s.polygonizeBounds(a,d,n),g=this.cameraPoint.clone();switch(3*((g.y>a.y)+(g.y>d.y))+((g.x>a.x)+(g.x>d.x))){case 0:_[0]=g,_[4]=g.clone();break;case 1:_.splice(1,0,g);break;case 2:_[1]=g;break;case 3:_.splice(4,0,g);break;case 5:_.splice(2,0,g);break;case 6:_[3]=g;break;case 7:_.splice(3,0,g);break;case 8:_[2]=g}return _}containsTile(n,a,d,_=0){const g=n.queryPadding/a._pixelsPerMercatorPixel+1,w=d?this._bufferedCameraMercator(g,a):this._bufferedScreenMercator(g,a);let T=n.tileID.wrap+(w.unwrapped?_:0);const C=w.polygon.map(X=>s.getTilePoint(n.tileTransform,X,T));if(!s.polygonIntersectsBox(C,0,0,s.EXTENT,s.EXTENT))return;T=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);const k=this.screenGeometryMercator.polygon.map(X=>s.getTileVec3(n.tileTransform,X,T)),z=k.map(X=>new s.pointGeometry(X[0],X[1])),R=a.getFreeCameraOptions().position||new s.MercatorCoordinate(0,0,0),j=s.getTileVec3(n.tileTransform,R,T),K=k.map(X=>{const G=s.sub(X,X,j);return s.normalize(G,G),new s.Ray(j,G)}),Z=pi(n,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:K,bufferedTilespaceGeometry:C,bufferedTilespaceBounds:(W=s.getBounds(C),W.min.x=s.clamp(W.min.x,0,s.EXTENT),W.min.y=s.clamp(W.min.y,0,s.EXTENT),W.max.x=s.clamp(W.max.x,0,s.EXTENT),W.max.y=s.clamp(W.max.y,0,s.EXTENT),W),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:Z};var W}_bufferedScreenMercator(n,a){const d=Jt(n);if(this._screenRaycastCache[d])return this._screenRaycastCache[d];{let _;return _=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),a):{polygon:this.bufferedScreenGeometry(n).map(g=>a.pointCoordinate3D(g)),unwrapped:!0},this._screenRaycastCache[d]=_,_}}_bufferedCameraMercator(n,a){const d=Jt(n);if(this._cameraRaycastCache[d])return this._cameraRaycastCache[d];{let _;return _=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),a):{polygon:this.bufferedCameraGeometry(n).map(g=>a.pointCoordinate3D(g)),unwrapped:!0},this._cameraRaycastCache[d]=_,_}}_projectAndResample(n,a){const d=function(g,w){const T=s.multiply([],w.pixelMatrix,w.globeMatrix),C=[0,-s.GLOBE_RADIUS,0,1],k=[0,s.GLOBE_RADIUS,0,1],z=[0,0,0,1];s.transformMat4$1(C,C,T),s.transformMat4$1(k,k,T),s.transformMat4$1(z,z,T);const R=new s.pointGeometry(C[0]/C[3],C[1]/C[3]),j=new s.pointGeometry(k[0]/k[3],k[1]/k[3]),K=s.polygonContainsPoint(g,R)&&C[3]<z[3],Z=s.polygonContainsPoint(g,j)&&k[3]<z[3];if(!K&&!Z)return null;const W=function(fe,le,ve){for(let Be=1;Be<fe.length;Be++){const dt=Yt(le.pointCoordinate3D(fe[Be-1]).x),Ae=Yt(le.pointCoordinate3D(fe[Be]).x);if(ve<0){if(dt<Ae)return{idx:Be,t:-dt/(Ae-1-dt)}}else if(Ae<dt)return{idx:Be,t:(1-dt)/(Ae+1-dt)}}return null}(g,w,K?-1:1);if(!W)return null;const{idx:X,t:G}=W;let te=X>1?Kt(g.slice(0,X),w):[],Y=X<g.length?Kt(g.slice(X),w):[];te=te.map(fe=>new s.pointGeometry(Yt(fe.x),fe.y)),Y=Y.map(fe=>new s.pointGeometry(Yt(fe.x),fe.y));const pe=[...te];pe.length===0&&pe.push(Y[Y.length-1]);const he=s.number(pe[pe.length-1].y,(Y.length===0?te[0]:Y[0]).y,G);let oe;return oe=K?[new s.pointGeometry(0,he),new s.pointGeometry(0,0),new s.pointGeometry(1,0),new s.pointGeometry(1,he)]:[new s.pointGeometry(1,he),new s.pointGeometry(1,1),new s.pointGeometry(0,1),new s.pointGeometry(0,he)],pe.push(...oe),Y.length===0?pe.push(te[0]):pe.push(...Y),{polygon:pe.map(fe=>new s.MercatorCoordinate(fe.x,fe.y)),unwrapped:!1}}(n,a);if(d)return d;const _=function(g,w){let T=!1,C=-1/0,k=0;for(let R=0;R<g.length-1;R++)g[R].x>C&&(C=g[R].x,k=R);for(let R=0;R<g.length-1;R++){const j=(k+R)%(g.length-1),K=g[j],Z=g[j+1];Math.abs(K.x-Z.x)>.5&&(K.x<Z.x?(K.x+=1,j===0&&(g[g.length-1].x+=1)):(Z.x+=1,j+1===g.length-1&&(g[0].x+=1)),T=!0)}const z=s.mercatorXfromLng(w.center.lng);return T&&z<Math.abs(z-1)&&g.forEach(R=>{R.x-=1}),{polygon:g,unwrapped:T}}(Kt(n,a).map(g=>new s.pointGeometry(Yt(g.x),g.y)),a);return{polygon:_.polygon.map(g=>new s.MercatorCoordinate(g.x,g.y)),unwrapped:_.unwrapped}}}function Kt(c,n){return s.resample(c,a=>{const d=n.pointCoordinate3D(a);a.x=d.x,a.y=d.y},1/256)}function Yt(c){return c<0?1+c%1:c%1}function Jt(c){return 100*c|0}function Et(c,n,a,d,_){const g=function(w,T){if(w)return _(w);if(T){const C=s.pick(s.extend(T,c),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);T.vector_layers&&(C.vectorLayers=T.vector_layers,C.vectorLayerIds=C.vectorLayers.map(k=>k.id)),T.language_options&&(C.languageOptions=T.language_options),T.language&&T.language[T.id]&&(C.language=T.language[T.id]),T.worldview_options&&(C.worldviewOptions=T.worldview_options),T.worldview?C.worldview=T.worldview[T.id]:T.worldview_default&&(C.worldview=T.worldview_default),C.tiles=n.canonicalizeTileset(C,c.url),_(null,C)}};return c.url?s.getJSON(n.transformRequest(n.normalizeSourceURL(c.url,null,a,d),s.ResourceType.Source),g):s.exported.frame(()=>g(null,c))}class Bi{constructor(n,a,d){this.bounds=s.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=a||0,this.maxzoom=d||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const a=Math.pow(2,n.z),d=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*a),_=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*a),g=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*a),w=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*a);return n.x>=d&&n.x<g&&n.y>=_&&n.y<w}}class Tn{constructor(n,a,d){this.context=n;const _=n.gl;this.buffer=_.createBuffer(),this.dynamicDraw=Boolean(d),this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ue={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ee{constructor(n,a,d,_){this.length=a.length,this.attributes=d,this.itemSize=a.bytesPerElement,this.dynamicDraw=_,this.context=n;const g=n.gl;this.buffer=g.createBuffer(),n.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,a){for(let d=0;d<this.attributes.length;d++){const _=a.attributes[this.attributes[d].name];_!==void 0&&n.enableVertexAttribArray(_)}}setVertexAttribPointers(n,a,d){for(let _=0;_<this.attributes.length;_++){const g=this.attributes[_],w=a.attributes[g.name];w!==void 0&&n.vertexAttribPointer(w,g.components,n[ue[g.type]],!1,this.itemSize,g.offset+this.itemSize*(d||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Re{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ct extends Re{getDefault(){return s.Color.transparent}set(n){const a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class ut extends Re{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class bt extends Re{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Mt extends Re{getDefault(){return[!0,!0,!0,!0]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class gt extends Re{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Xe extends Re{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class ht extends Re{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const a=this.current;(n.func!==a.func||n.ref!==a.ref||n.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class qt extends Re{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Nt extends Re{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=n,this.dirty=!1}}class Zt extends Re{getDefault(){return[0,1]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class ti extends Re{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=n,this.dirty=!1}}class mi extends Re{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class zi extends Re{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.BLEND):a.disable(a.BLEND),this.current=n,this.dirty=!1}}class si extends Re{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class Ai extends Re{getDefault(){return s.Color.transparent}set(n){const a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class hn extends Re{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class _r extends Re{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=n,this.dirty=!1}}class Cn extends Re{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class kn extends Re{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}class qr extends Re{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}}class gn extends Re{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class zn extends Re{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Pr extends Re{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class Eo extends Re{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Ho extends Re{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class ws extends Re{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class da extends Re{getDefault(){return null}set(n){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Dr extends Re{constructor(n){super(n),this.vao=n.extVertexArrayObject}getDefault(){return null}set(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)}}class Lr extends Re{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class to extends Re{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class io extends Re{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class An extends Re{constructor(n,a){super(n),this.context=n,this.parent=a}getDefault(){return null}}class Er extends An{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Q extends An{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class B extends Q{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class O{constructor(n,a,d,_){this.context=n,this.width=a,this.height=d;const g=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new Er(n,g),_&&(this.depthAttachment=new Q(n,g))}destroy(){const n=this.context.gl,a=this.colorAttachment.get();if(a&&n.deleteTexture(a),this.depthAttachment){const d=this.depthAttachment.get();d&&n.deleteRenderbuffer(d)}n.deleteFramebuffer(this.framebuffer)}}class J{constructor(n){this.gl=n,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ct(this),this.clearDepth=new ut(this),this.clearStencil=new bt(this),this.colorMask=new Mt(this),this.depthMask=new gt(this),this.stencilMask=new Xe(this),this.stencilFunc=new ht(this),this.stencilOp=new qt(this),this.stencilTest=new Nt(this),this.depthRange=new Zt(this),this.depthTest=new ti(this),this.depthFunc=new mi(this),this.blend=new zi(this),this.blendFunc=new si(this),this.blendColor=new Ai(this),this.blendEquation=new hn(this),this.cullFace=new _r(this),this.cullFaceSide=new Cn(this),this.frontFace=new kn(this),this.program=new qr(this),this.activeTexture=new gn(this),this.viewport=new zn(this),this.bindFramebuffer=new Pr(this),this.bindRenderbuffer=new Eo(this),this.bindTexture=new Ho(this),this.bindVertexBuffer=new ws(this),this.bindElementBuffer=new da(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Dr(this),this.pixelStoreUnpack=new Lr(this),this.pixelStoreUnpackPremultiplyAlpha=new to(this),this.pixelStoreUnpackFlipY=new io(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extTextureHalfFloat=n.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(n.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=n.getExtension("OES_standard_derivatives"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,a){return new Tn(this,n,a)}createVertexBuffer(n,a,d){return new Ee(this,n,a,d)}createRenderbuffer(n,a,d){const _=this.gl,g=_.createRenderbuffer();return this.bindRenderbuffer.set(g),_.renderbufferStorage(_.RENDERBUFFER,n,a,d),this.bindRenderbuffer.set(null),g}createFramebuffer(n,a,d){return new O(this,n,a,d)}clear({color:n,depth:a,stencil:d}){const _=this.gl;let g=0;n&&(g|=_.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(g|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),d!==void 0&&(g|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),_.clear(g)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){D(n.blendFunction,s.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ne extends s.Evented{constructor(n,a,d,_){super(),this.id=n,this.dispatcher=d,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},a),s.extend(this,s.pick(a,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Et(this._options,this.map._requestManager,null,null,(n,a)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new s.ErrorEvent(n)):a&&(s.extend(this,a),a.bounds&&(this.tileBounds=new Bi(a.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(a.tiles),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return s.extend({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,a){const d=s.exported.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),d,this.tileSize);n.request=s.getImage(this.map._requestManager.transformRequest(_,s.ResourceType.Tile),(g,w,T,C)=>(delete n.request,n.aborted?(n.state="unloaded",a(null)):g?(n.state="errored",a(g)):w?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:T,expires:C}),n.setTexture(w,this.map.painter),n.state="loaded",s.cacheEntryPossiblyAdded(this.dispatcher),void a(null)):a(null)))}static loadTileData(n,a,d){n.setTexture(a,d)}static unloadTileData(n,a){n.texture&&a.saveTileTexture(n.texture)}abortTile(n,a){n.request&&(n.request.cancel(),delete n.request),a()}unloadTile(n,a){n.texture&&this.map.painter.saveTileTexture(n.texture),a()}hasTransition(){return!1}}let _e;function Me(c,n,a,d,_,g,w,T){const C=[c,a,_,n,d,g,1,1,1],k=[w,T,1],z=s.adjoint([],C),[R,j,K]=s.transformMat3(k,k,s.transpose(z,z));return s.multiply$1(C,[R,0,0,0,j,0,0,0,K],C)}class Se extends s.Evented{constructor(n,a,d,_){super(),this.id=n,this.dispatcher=d,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=a}load(n,a){this._loaded=a||!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),(d,_)=>{if(this._loaded=!0,d)this.fire(new s.ErrorEvent(d));else if(_){const{HTMLImageElement:g}=s.window;this.image=_ instanceof g?s.exported.getImageData(_):_,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading()}})}loaded(){return this._loaded}updateImage(n){return this.image&&n.url?(this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(n){this.coordinates=n,this._boundsArray=void 0;const a=n.map(s.MercatorCoordinate.fromLngLat);return this.tileID=function(d){let _=1/0,g=1/0,w=-1/0,T=-1/0;for(const R of d)_=Math.min(_,R.x),g=Math.min(g,R.y),w=Math.max(w,R.x),T=Math.max(T,R.y);const C=Math.max(w-_,T-g),k=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),z=Math.pow(2,k);return new s.CanonicalTileID(k,Math.floor((_+w)/2*z),Math.floor((g+T)/2*z))}(a),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(n){for(const C in this.tiles){const k=this.tiles[C];k.state!=="loaded"&&(k.state="loaded",k.texture=this.texture)}if(this._boundsArray)return;const a=s.tileTransform(this.tileID,this.map.transform.projection),[d,_,g,w]=this.coordinates.map(C=>{const k=a.projection.project(C[0],C[1]);return s.getTilePoint(a,k)._round()});this.perspectiveTransform=function(C,k,z,R,j,K,Z,W,X,G){const te=Me(0,0,C,0,0,k,C,k),Y=Me(z,R,j,K,Z,W,X,G);return s.multiply$1(Y,s.adjoint(te,te),Y),[Y[6]/Y[8]*C/s.EXTENT,Y[7]/Y[8]*k/s.EXTENT]}(this.width,this.height,d.x,d.y,_.x,_.y,w.x,w.y,g.x,g.y);const T=this._boundsArray=new s.StructArrayLayout4i8;T.emplaceBack(d.x,d.y,0,0),T.emplaceBack(_.x,_.y,s.EXTENT,0),T.emplaceBack(w.x,w.y,0,s.EXTENT),T.emplaceBack(g.x,g.y,s.EXTENT,s.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=n.createVertexBuffer(T,s.boundsAttributes.members),this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const n=this.map.painter.context,a=n.gl;this.texture?this.texture.update(this.image):(this.texture=new s.Texture(n,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._prepareData(n)}loadTile(n,a){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},a(null)):(n.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ge={vector:class extends s.Evented{constructor(c,n,a,d){if(super(),this.id=c,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(n,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d),this._tileWorkers={},this._deduped=new s.DedupedRequest}load(c){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"}));const n=this.language||this.map._language,a=this.worldview||this.map._worldview;this._tileJSONRequest=Et(this._options,this.map._requestManager,n,a,(d,_)=>{this._tileJSONRequest=null,this._loaded=!0,d?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code. Found: ${n}`),a&&a.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new s.ErrorEvent(d))):_&&(s.extend(this,_),_.bounds&&(this.tileBounds=new Bi(_.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(_.tiles,this.map._requestManager._customAccessToken),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(d)})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}setSourceProperty(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.load(()=>{const n=this.map.style._getSourceCaches(this.id);for(const a of n)a.clearTiles()})}setTiles(c){return this.setSourceProperty(()=>{this._options.tiles=c}),this}setUrl(c){return this.setSourceProperty(()=>{this.url=c,this._options.url=c}),this}_setLanguage(c){return c===this.language||this.setSourceProperty(()=>{this.language=c}),this}_setWorldview(c){return c===this.worldview?this:this.worldviewOptions&&c&&!this.worldviewOptions[c]?(console.warn(`Vector tile source "${this.id}" does not support worldview "${c}".`),this):(this.setSourceProperty(()=>{this.worldview=c}),this)}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return s.extend({},this._options)}loadTile(c,n){const a=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(a,s.ResourceType.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:c.isSymbolTile};if(d.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired")c.state==="loading"?c.reloadCallback=n:c.request=c.actor.send("reloadTile",d,_.bind(this));else if(c.actor=this._tileWorkers[a]=this._tileWorkers[a]||this.dispatcher.getActor(),this.dispatcher.ready)c.request=c.actor.send("loadTile",d,_.bind(this),void 0,!0);else{const g=s.loadVectorTile.call({deduped:this._deduped},d,(w,T)=>{w||!T?_.call(this,w):(d.data={cacheControl:T.cacheControl,expires:T.expires,rawData:T.rawData.slice(0)},c.actor&&c.actor.send("loadTile",d,_.bind(this),void 0,!0))},!0);c.request={cancel:g}}function _(g,w){return delete c.request,c.aborted?n(null):g&&g.status!==404?n(g):(w&&w.resourceTiming&&(c.resourceTiming=w.resourceTiming),this.map._refreshExpiredTiles&&w&&c.setExpiryData(w),c.loadVectorData(w,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id})}unloadTile(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:ne,"raster-dem":class extends ne{constructor(c,n,a,d){super(c,n,a,d),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(c,n){const a=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function d(_,g){_&&(c.state="errored",n(_)),g&&(c.dem=g,c.dem.onDeserialize(),c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0,c.state="loaded",n(null))}c.request=s.getImage(this.map._requestManager.transformRequest(a,s.ResourceType.Tile),function(_,g,w,T){if(delete c.request,c.aborted)c.state="unloaded",n(null);else if(_)c.state="errored",n(_);else if(g){this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:w,expires:T});const C=s.window.ImageBitmap&&g instanceof s.window.ImageBitmap&&(_e==null&&(_e=s.window.OffscreenCanvas&&new s.window.OffscreenCanvas(1,1).getContext("2d")&&typeof s.window.createImageBitmap=="function"),_e),k=1-(g.width-s.prevPowerOfTwo(g.width))/2;k<1||c.neighboringTiles||(c.neighboringTiles=this._getNeighboringTiles(c.tileID));const z=C?g:s.exported.getImageData(g,k),R={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:z,encoding:this.encoding,padding:k};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",R,d.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(c){const n=c.canonical,a=Math.pow(2,n.z),d=(n.x-1+a)%a,_=n.x===0?c.wrap-1:c.wrap,g=(n.x+1+a)%a,w=n.x+1===a?c.wrap+1:c.wrap,T={};return T[new s.OverscaledTileID(c.overscaledZ,_,n.z,d,n.y).key]={backfilled:!1},T[new s.OverscaledTileID(c.overscaledZ,w,n.z,g,n.y).key]={backfilled:!1},n.y>0&&(T[new s.OverscaledTileID(c.overscaledZ,_,n.z,d,n.y-1).key]={backfilled:!1},T[new s.OverscaledTileID(c.overscaledZ,c.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},T[new s.OverscaledTileID(c.overscaledZ,w,n.z,g,n.y-1).key]={backfilled:!1}),n.y+1<a&&(T[new s.OverscaledTileID(c.overscaledZ,_,n.z,d,n.y+1).key]={backfilled:!1},T[new s.OverscaledTileID(c.overscaledZ,c.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},T[new s.OverscaledTileID(c.overscaledZ,w,n.z,g,n.y+1).key]={backfilled:!1}),T}unloadTile(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded"}},geojson:class extends s.Evented{constructor(c,n,a,d){super(),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(d),this._data=n.data,this._options=s.extend({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const _=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*_,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*_,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:s.EXTENT,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*_,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(c){this.map=c,this.setData(this._data)}setData(c){return this._data=c,this._updateWorkerData(),this}getClusterExpansionZoom(c,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},n),this}getClusterChildren(c,n){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},n),this}getClusterLeaves(c,n,a,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:n,offset:a},d),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.Event("dataloading",{dataType:"source"})),this._loaded=!1;const c=s.extend({},this.workerOptions),n=this._data;typeof n=="string"?(c.request=this.map._requestManager.transformRequest(s.exported.resolveURL(n),s.ResourceType.Source),c.request.collectResourceTiming=this._collectResourceTiming):c.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,c,(a,d)=>{if(this._loaded=!0,this._pendingLoad=null,a)this.fire(new s.ErrorEvent(a));else{const _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&d&&d.resourceTiming&&d.resourceTiming[this.id]&&(_.resourceTiming=d.resourceTiming[this.id]),this.fire(new s.Event("data",_)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(c,n){const a=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(a,{type:this.type,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(d,_)=>(delete c.request,c.unloadVectorData(),c.aborted?n(null):d?n(d):(c.loadVectorData(_,this.map.painter,a==="reloadTile"),n(null))),void 0,a==="loadTile")}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0}unloadTile(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Se{constructor(c,n,a,d){super(c,n,a,d),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const c=this.options;this.urls=[];for(const n of c.urls)this.urls.push(this.map._requestManager.transformRequest(n,s.ResourceType.Source).url);s.getVideo(this.urls,(n,a)=>{this._loaded=!0,n?this.fire(new s.ErrorEvent(n)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(c){if(this.video){const n=this.video.seekable;c<n.start(0)||c>n.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=c}}getVideo(){return this.video}onAdd(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const c=this.map.painter.context,n=c.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new s.Texture(c,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(c)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Se,canvas:class extends Se{constructor(c,n,a,d){super(c,n,a,d),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(g=>typeof g!="number"))||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${c}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${c}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${c}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof s.window.HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${c}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${c}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof s.window.HTMLCanvasElement?this.options.canvas:s.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.Texture(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const c of[this.canvas.width,this.canvas.height])if(isNaN(c)||c<=0)return!0;return!1}},custom:class extends s.Evented{constructor(c,n,a,d){super(),this.id=c,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=n,this.setEventedParent(d),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Bi(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.coveringTiles=this._coveringTiles.bind(this),s.extend(this,s.pick(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(c){this._map=c,this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(c),this.load()}onRemove(c){this._implementation.onRemove&&this._implementation.onRemove(c)}hasTile(c){if(this._implementation.hasTile){const{x:n,y:a,z:d}=c.canonical;return this._implementation.hasTile({x:n,y:a,z:d})}return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,n){const{x:a,y:d,z:_}=c.tileID.canonical,g=new s.window.AbortController,w=this._implementation.loadTile({x:a,y:d,z:_},{signal:g.signal});if(!w)return this.loadTileData(c,{width:this.tileSize,height:this.tileSize,data:null}),c.state="loaded",n(null);w.cancel=()=>g.abort(),c.request=w.then(function(T){return delete c.request,c.aborted?(c.state="unloaded",n(null)):T?function(C){return C instanceof s.window.ImageData||C instanceof s.window.ImageBitmap||C instanceof s.window.HTMLCanvasElement}(T)?(this.loadTileData(c,T),c.state="loaded",void n(null)):(c.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(c,{width:this.tileSize,height:this.tileSize,data:null}),c.state="loaded",n(null))}.bind(this)).catch(T=>{T.code!==20&&(c.state="errored",n(T))})}loadTileData(c,n){ne.loadTileData(c,n,this._map.painter)}unloadTileData(c){ne.unloadTileData(c,this._map.painter)}prepareTile(c){if(!this._implementation.prepareTile)return null;const{x:n,y:a,z:d}=c.tileID.canonical,_=this._implementation.prepareTile({x:n,y:a,z:d});return _?(this.loadTileData(c,_),c.state="loaded",_):null}unloadTile(c,n){if(this.unloadTileData(c),this._implementation.unloadTile){const{x:a,y:d,z:_}=c.tileID.canonical;this._implementation.unloadTile({x:a,y:d,z:_})}n()}abortTile(c,n){c.request&&c.request.cancel&&(c.request.cancel(),delete c.request),n()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(c=>({x:c.canonical.x,y:c.canonical.y,z:c.canonical.z}))}_update(){this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}}},ke=function(c,n,a,d){const _=new ge[n.type](c,n,a,d);if(_.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${_.id}`);return s.bindAll(["load","abort","unload","serialize","prepare"],_),_};function Qe(c,n){const a=s.identity([]);return s.scale(a,a,[.5*c.width,.5*-c.height,1]),s.translate(a,a,[1,-1,0]),s.multiply(a,a,c.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(a)}function Ct(c,n,a,d,_,g,w,T=!1){const C=c.tilesIn(d,w,T);C.sort($t);const k=[];for(const R of C)k.push({wrappedTileID:R.tile.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(n,a,c._state,R,_,g,Qe(c.transform,R.tile.tileID),T)});const z=function(R){const j={},K={};for(const Z of R){const W=Z.queryResults,X=Z.wrappedTileID,G=K[X]=K[X]||{};for(const te in W){const Y=W[te],pe=G[te]=G[te]||{},he=j[te]=j[te]||[];for(const oe of Y)pe[oe.featureIndex]||(pe[oe.featureIndex]=!0,he.push(oe))}}return j}(k);for(const R in z)z[R].forEach(j=>{const K=j.feature,Z=K.layer;Z&&Z.type!=="background"&&Z.type!=="sky"&&(K.source=Z.source,Z["source-layer"]&&(K.sourceLayer=Z["source-layer"]),K.state=K.id!==void 0?c.getFeatureState(Z["source-layer"],K.id):{})});return z}function st(c,n){const a=c.getRenderableIds().map(g=>c.getTileByID(g)),d=[],_={};for(let g=0;g<a.length;g++){const w=a[g],T=w.tileID.canonical.key;_[T]||(_[T]=!0,w.querySourceFeatures(d,n))}return d}function $t(c,n){const a=c.tileID,d=n.tileID;return a.overscaledZ-d.overscaledZ||a.canonical.y-d.canonical.y||a.wrap-d.wrap||a.canonical.x-d.canonical.x}function Xt(){return Na.workerClass!=null?new Na.workerClass:new s.window.Worker(Na.workerUrl)}const jt="mapboxgl_preloaded_worker_pool";class Qt{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<Qt.workerCount;)this.workers.push(new Xt);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[jt]}numActive(){return Object.keys(this.active).length}}let ci;function Pi(){return ci||(ci=new Qt),ci}function ce(c,n){const a={};for(const d in c)d!=="ref"&&(a[d]=c[d]);return s.refProperties.forEach(d=>{d in n&&(a[d]=n[d])}),a}function vt(c){c=c.slice();const n=Object.create(null);for(let a=0;a<c.length;a++)n[c[a].id]=c[a];for(let a=0;a<c.length;a++)"ref"in c[a]&&(c[a]=ce(c[a],n[c[a].ref]));return c}Qt.workerCount=2;const Ze={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Ce(c,n,a){a.push({command:Ze.addSource,args:[c,n[c]]})}function wi(c,n,a){n.push({command:Ze.removeSource,args:[c]}),a[c]=!0}function ni(c,n,a,d){wi(c,a,d),Ce(c,n,a)}function Gi(c,n,a){let d;for(d in c[a])if(c[a].hasOwnProperty(d)&&d!=="data"&&!D(c[a][d],n[a][d]))return!1;for(d in n[a])if(n[a].hasOwnProperty(d)&&d!=="data"&&!D(c[a][d],n[a][d]))return!1;return!0}function Mn(c,n,a,d,_,g){let w;for(w in n=n||{},c=c||{})c.hasOwnProperty(w)&&(D(c[w],n[w])||a.push({command:g,args:[d,w,n[w],_]}));for(w in n)n.hasOwnProperty(w)&&!c.hasOwnProperty(w)&&(D(c[w],n[w])||a.push({command:g,args:[d,w,n[w],_]}))}function Kn(c){return c.id}function gl(c,n){return c[n.id]=n,c}class wp{constructor(n,a){this.reset(n,a)}reset(n,a){this.points=n||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=s.clamp(n,0,1);let a=1,d=this._distances[a];const _=n*this.paddedLength+this.padding;for(;d<_&&a<this._distances.length;)d=this._distances[++a];const g=a-1,w=this._distances[g],T=d-w,C=T>0?(_-w)/T:0;return this.points[g].mult(1-C).add(this.points[a].mult(C))}}class Ts{constructor(n,a,d){const _=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(n/d),this.yCellCount=Math.ceil(a/d);for(let w=0;w<this.xCellCount*this.yCellCount;w++)_.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=a,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,a,d,_,g){this._forEachCell(a,d,_,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(a),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(g)}insertCircle(n,a,d,_){this._forEachCell(a-_,d-_,a+_,d+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(a),this.circles.push(d),this.circles.push(_)}_insertBoxCell(n,a,d,_,g,w){this.boxCells[g].push(w)}_insertCircleCell(n,a,d,_,g,w){this.circleCells[g].push(w)}_query(n,a,d,_,g,w){if(d<0||n>this.width||_<0||a>this.height)return!g&&[];const T=[];if(n<=0&&a<=0&&this.width<=d&&this.height<=_){if(g)return!0;for(let C=0;C<this.boxKeys.length;C++)T.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const k=this.circles[3*C],z=this.circles[3*C+1],R=this.circles[3*C+2];T.push({key:this.circleKeys[C],x1:k-R,y1:z-R,x2:k+R,y2:z+R})}return w?T.filter(w):T}return this._forEachCell(n,a,d,_,this._queryCell,T,{hitTest:g,seenUids:{box:{},circle:{}}},w),g?T.length>0:T}_queryCircle(n,a,d,_,g){const w=n-d,T=n+d,C=a-d,k=a+d;if(T<0||w>this.width||k<0||C>this.height)return!_&&[];const z=[];return this._forEachCell(w,C,T,k,this._queryCellCircle,z,{hitTest:_,circle:{x:n,y:a,radius:d},seenUids:{box:{},circle:{}}},g),_?z.length>0:z}query(n,a,d,_,g){return this._query(n,a,d,_,!1,g)}hitTest(n,a,d,_,g){return this._query(n,a,d,_,!0,g)}hitTestCircle(n,a,d,_){return this._queryCircle(n,a,d,!0,_)}_queryCell(n,a,d,_,g,w,T,C){const k=T.seenUids,z=this.boxCells[g];if(z!==null){const j=this.bboxes;for(const K of z)if(!k.box[K]){k.box[K]=!0;const Z=4*K;if(n<=j[Z+2]&&a<=j[Z+3]&&d>=j[Z+0]&&_>=j[Z+1]&&(!C||C(this.boxKeys[K]))){if(T.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[K],x1:j[Z],y1:j[Z+1],x2:j[Z+2],y2:j[Z+3]})}}}const R=this.circleCells[g];if(R!==null){const j=this.circles;for(const K of R)if(!k.circle[K]){k.circle[K]=!0;const Z=3*K;if(this._circleAndRectCollide(j[Z],j[Z+1],j[Z+2],n,a,d,_)&&(!C||C(this.circleKeys[K]))){if(T.hitTest)return w.push(!0),!0;{const W=j[Z],X=j[Z+1],G=j[Z+2];w.push({key:this.circleKeys[K],x1:W-G,y1:X-G,x2:W+G,y2:X+G})}}}}}_queryCellCircle(n,a,d,_,g,w,T,C){const k=T.circle,z=T.seenUids,R=this.boxCells[g];if(R!==null){const K=this.bboxes;for(const Z of R)if(!z.box[Z]){z.box[Z]=!0;const W=4*Z;if(this._circleAndRectCollide(k.x,k.y,k.radius,K[W+0],K[W+1],K[W+2],K[W+3])&&(!C||C(this.boxKeys[Z])))return w.push(!0),!0}}const j=this.circleCells[g];if(j!==null){const K=this.circles;for(const Z of j)if(!z.circle[Z]){z.circle[Z]=!0;const W=3*Z;if(this._circlesCollide(K[W],K[W+1],K[W+2],k.x,k.y,k.radius)&&(!C||C(this.circleKeys[Z])))return w.push(!0),!0}}}_forEachCell(n,a,d,_,g,w,T,C){const k=this._convertToXCellCoord(n),z=this._convertToYCellCoord(a),R=this._convertToXCellCoord(d),j=this._convertToYCellCoord(_);for(let K=k;K<=R;K++)for(let Z=z;Z<=j;Z++)if(g.call(this,n,a,d,_,this.xCellCount*Z+K,w,T,C))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,a,d,_,g,w){const T=_-n,C=g-a,k=d+w;return k*k>T*T+C*C}_circleAndRectCollide(n,a,d,_,g,w,T){const C=(w-_)/2,k=Math.abs(n-(_+C));if(k>C+d)return!1;const z=(T-g)/2,R=Math.abs(a-(g+z));if(R>z+d)return!1;if(k<=C||R<=z)return!0;const j=k-C,K=R-z;return j*j+K*K<=d*d}}const zt=Math.tan(85*Math.PI/180);function gi(c,n,a,d,_,g,w){const T=s.create();if(a)if(g.name==="globe"){const C=s.calculateGlobeLabelMatrix(_,n);s.multiply(T,T,C)}else{const C=Ke([],w);T[0]=C[0],T[1]=C[1],T[4]=C[2],T[5]=C[3],d||s.rotateZ(T,T,_.angle)}else s.multiply(T,_.labelPlaneMatrix,c);return T}function yi(c,n,a,d,_,g,w){const T=gi(c,n,a,d,_,g,w);return g.name==="globe"&&a||(T[2]=T[6]=T[10]=T[14]=0),T}function Br(c,n,a,d,_,g,w){if(a){if(g.name==="globe"){const T=gi(c,n,a,d,_,g,w);return s.invert(T,T),s.multiply(T,c,T),T}{const T=s.clone(c),C=s.identity([]);return C[0]=w[0],C[1]=w[1],C[4]=w[2],C[5]=w[3],s.multiply(T,T,C),d||s.rotateZ(T,T,-_.angle),T}}return _.glCoordMatrix}function Rr(c,n,a=0){const d=[c.x,c.y,a,1];a?s.transformMat4$1(d,d,n):Yn(d,d,n);const _=d[3];return{point:[d[0]/_,d[1]/_,d[2]/_],signedDistanceFromCamera:_}}function ui(c,n){const a=[c[0],c[1],c[2],1];s.transformMat4$1(a,a,n);const d=a[3];return{point:[a[0]/d,a[1]/d,a[2]/d],signedDistanceFromCamera:d}}function fa(c,n){return Math.min(.5+c/n*.5,1.5)}function pa(c,n){const a=c[0]/c[3],d=c[1]/c[3];return a>=-n[0]&&a<=n[0]&&d>=-n[1]&&d<=n[1]}function ma(c,n,a,d,_,g,w,T,C,k){const z=a.transform,R=d?c.textSizeData:c.iconSizeData,j=s.evaluateSizeForZoom(R,a.transform.zoom),K=z.projection.name==="globe",Z=[256/a.width*2+1,256/a.height*2+1],W=d?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;W.clear();let X=null;K&&(X=d?c.text.globeExtVertexArray:c.icon.globeExtVertexArray);const G=c.lineVertexArray,te=d?c.text.placedSymbolArray:c.icon.placedSymbolArray,Y=a.transform.width/a.transform.height;let pe=!1;for(let he=0;he<te.length;he++){const oe=te.get(he);if(oe.writingMode!==s.WritingMode.vertical||pe||he!==0&&te.get(he-1).writingMode===s.WritingMode.horizontal||(pe=!0),(oe.hidden||oe.writingMode===s.WritingMode.vertical)&&!pe){Co(oe.numGlyphs,W);continue}pe=!1;const fe=new s.pointGeometry(oe.tileAnchorX,oe.tileAnchorY),le=C?C(fe):[0,0,0],ve=z.projection.projectTilePoint(fe.x,fe.y,k.canonical),Be=[ve.x+le[0],ve.y+le[1],ve.z+le[2]],dt=[...Be,1];if(s.transformMat4$1(dt,dt,n),!pa(dt,Z)){Co(oe.numGlyphs,W);continue}const Ae=fa(a.transform.cameraToCenterDistance,dt[3]),Je=s.evaluateSizeForFeature(R,j,oe),rt=w?Je/Ae:Je*Ae,wt=Rr(new s.pointGeometry(Be[0],Be[1]),_,Be[2]);if(wt.signedDistanceFromCamera<=0){Co(oe.numGlyphs,W);continue}let qe={};const mt=w?null:C,it=jh(oe,rt,!1,T,n,_,g,c.glyphOffsetArray,G,W,X,wt.point,fe,qe,Y,mt,z.projection,k,w);pe=it.useVertical,mt&&it.needsFlipping&&(qe={}),(it.notEnoughRoom||pe||it.needsFlipping&&jh(oe,rt,!0,T,n,_,g,c.glyphOffsetArray,G,W,X,wt.point,fe,qe,Y,mt,z.projection,k,w).notEnoughRoom)&&Co(oe.numGlyphs,W)}d?(c.text.dynamicLayoutVertexBuffer.updateData(W),X&&c.text.globeExtVertexBuffer.updateData(X)):(c.icon.dynamicLayoutVertexBuffer.updateData(W),X&&c.icon.globeExtVertexBuffer.updateData(X))}function gr(c,n,a,d,_,g,w,T,C,k,z,R,j,K,Z,W){const X=T.glyphStartIndex+T.numGlyphs,G=T.lineStartIndex,te=T.lineStartIndex+T.lineLength,Y=n.getoffsetX(T.glyphStartIndex),pe=n.getoffsetX(X-1),he=So(c*Y,a,d,_,g,w,T.segment,G,te,C,k,z,R,j,!0,K,Z,W);if(!he)return null;const oe=So(c*pe,a,d,_,g,w,T.segment,G,te,C,k,z,R,j,!0,K,Z,W);return oe?{first:he,last:oe}:null}function sn(c,n,a,d){return c.writingMode===s.WritingMode.horizontal&&Math.abs(a.y-n.y)>Math.abs(a.x-n.x)*d?{useVertical:!0}:c.writingMode===s.WritingMode.vertical?n.y<a.y?{needsFlipping:!0}:null:c.flipState!==0&&function(_,g,w){const T=(g.x-_.x)*w;return T===0||Math.abs((g.y-_.y)/T)>zt}(n,a,d)?c.flipState===1?{needsFlipping:!0}:null:n.x>a.x?{needsFlipping:!0}:null}function jh(c,n,a,d,_,g,w,T,C,k,z,R,j,K,Z,W,X,G,te){const Y=n/24,pe=c.lineOffsetX*Y,he=c.lineOffsetY*Y;let oe;if(c.numGlyphs>1){const fe=c.glyphStartIndex+c.numGlyphs,le=c.lineStartIndex,ve=c.lineStartIndex+c.lineLength,Be=gr(Y,T,pe,he,a,R,j,c,C,g,K,W,!1,X,G,te);if(!Be)return{notEnoughRoom:!0};const dt=ui(Be.first.point,w).point,Ae=ui(Be.last.point,w).point,Je=new s.pointGeometry(dt[0],dt[1]),rt=new s.pointGeometry(Ae[0],Ae[1]);if(d&&!a){const wt=sn(c,Je,rt,Z);if(c.flipState=wt&&wt.needsFlipping?1:2,wt)return wt}oe=[Be.first];for(let wt=c.glyphStartIndex+1;wt<fe-1;wt++)oe.push(So(Y*T.getoffsetX(wt),pe,he,a,R,j,c.segment,le,ve,C,g,K,W,!1,!1,X,G,te));oe.push(Be.last)}else{if(d&&!a){const le=Rr(j,_).point,ve=c.lineStartIndex+c.segment+1,Be=new s.pointGeometry(C.getx(ve),C.gety(ve)),dt=Rr(Be,_),Ae=dt.signedDistanceFromCamera>0?dt.point:yl(j,Be,le,1,_,void 0,X,G.canonical),Je=sn(c,new s.pointGeometry(le[0],le[1]),new s.pointGeometry(Ae[0],Ae[1]),Z);if(c.flipState=Je&&Je.needsFlipping?1:2,Je)return Je}const fe=So(Y*T.getoffsetX(c.glyphStartIndex),pe,he,a,R,j,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,C,g,K,W,!1,!1,X,G,te);if(!fe)return{notEnoughRoom:!0};oe=[fe]}if(z)for(const fe of oe)s.updateGlobeVertexNormal(z,k.length+0,fe.up[0],fe.up[1],fe.up[2]),s.updateGlobeVertexNormal(z,k.length+1,fe.up[0],fe.up[1],fe.up[2]),s.updateGlobeVertexNormal(z,k.length+2,fe.up[0],fe.up[1],fe.up[2]),s.updateGlobeVertexNormal(z,k.length+3,fe.up[0],fe.up[1],fe.up[2]),s.addDynamicAttributes(k,fe.point[0],fe.point[1],fe.point[2],fe.angle);else for(const fe of oe)s.addDynamicAttributes(k,fe.point[0],fe.point[1],fe.point[2],fe.angle);return{}}function Es(c,n,a,d,_){const g=d.projectTilePoint(c.x,c.y,n);if(!_)return Rr(g,a,g.z);const w=_(c);return Rr(new s.pointGeometry(g.x+w[0],g.y+w[1]),a,g.z+w[2])}function yl(c,n,a,d,_,g,w,T){const C=Es(c.add(c.sub(n)._unit()),T,_,w,g).point,k=s.sub([],a,C);return s.scaleAndAdd([],a,k,d/s.length(k))}function So(c,n,a,d,_,g,w,T,C,k,z,R,j,K,Z,W,X,G){const te=d?c-n:c+n;let Y=te>0?1:-1,pe=0;d&&(Y*=-1,pe=Math.PI),Y<0&&(pe+=Math.PI);let he=Y>0?T+w:T+w+1,oe=_,fe=_,le=0,ve=0;const Be=Math.abs(te),dt=[],Ae=[];let Je=g;const rt=()=>{const Ut=he-Y;return le===0?g:new s.pointGeometry(k.getx(Ut),k.gety(Ut))},wt=()=>yl(rt(),Je,fe,Be-le+1,z,j,W,X.canonical);for(;le+ve<=Be;){if(he+=Y,he<T||he>=C)return null;if(fe=oe,dt.push(oe),K&&Ae.push(Je||rt()),oe=R[he],oe===void 0){Je=new s.pointGeometry(k.getx(he),k.gety(he));const Ut=Es(Je,X.canonical,z,W,j);oe=Ut.signedDistanceFromCamera>0?R[he]=Ut.point:wt()}else Je=null;le+=ve,ve=s.distance(fe,oe)}Je=Je||new s.pointGeometry(k.getx(he),k.gety(he));const qe=rt();Z&&j&&(R[he]=oe=R[he]===void 0?oe:wt(),ve=s.distance(fe,oe));const mt=(Be-le)/ve,it=Je.sub(qe).mult(mt)._add(qe),It=s.sub([],oe,fe),St=s.scaleAndAdd([],fe,It,mt);let Vt=[0,0,1],Wt=It[0],ii=It[1];if(G&&(Vt=W.upVector(X.canonical,it.x,it.y),Vt[0]!==0||Vt[1]!==0||Vt[2]!==1)){const Ut=[1,0,0],ai=[0,1,0];Ut[0]=Vt[2],Ut[1]=0,Ut[2]=-Vt[0],s.cross(ai,Vt,Ut),s.normalize(Ut,Ut),s.normalize(ai,ai),Wt=s.dot(It,Ut),ii=s.dot(It,ai)}if(a){const Ut=s.cross([],Vt,It);s.normalize(Ut,Ut),s.scaleAndAdd(St,St,Ut,a*Y)}const xi=pe+Math.atan2(ii,Wt);return dt.push(St),K&&Ae.push(it),{point:St,angle:xi,path:dt,tilePath:Ae,up:Vt}}const Oc=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Co(c,n){for(let a=0;a<c;a++){const d=n.length;n.resize(d+4),n.float32.set(Oc,4*d)}}function Yn(c,n,a){const d=n[0],_=n[1];return c[0]=a[0]*d+a[4]*_+a[12],c[1]=a[1]*d+a[5]*_+a[13],c[3]=a[3]*d+a[7]*_+a[15],c}const Ni=100;class Vc{constructor(n,a,d=new Ts(n.width+200,n.height+200,25),_=new Ts(n.width+200,n.height+200,25)){this.transform=n,this.grid=d,this.ignoredGrid=_,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+Ni,this.screenBottomBoundary=n.height+Ni,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=a}placeCollisionBox(n,a,d,_,g,w,T,C){let k=d.projectedAnchorX,z=d.projectedAnchorY,R=d.projectedAnchorZ;const j=d.elevation,K=d.tileID;if(j&&K){const he=n.getProjection().upVector(K.canonical,d.tileAnchorX,d.tileAnchorY),oe=n.getProjection().upVectorScale(K.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;k+=he[0]*j*oe,z+=he[1]*j*oe,R+=he[2]*j*oe}const Z=this.projectAndGetPerspectiveRatio(T,[k,z,R],d.tileID,n.projection.name==="globe"||!!j||this.transform.pitch>0,n.getProjection()),W=w*Z.perspectiveRatio,X=(d.x1*a+_.x-d.padding)*W+Z.point.x,G=(d.y1*a+_.y-d.padding)*W+Z.point.y,te=(d.x2*a+_.x+d.padding)*W+Z.point.x,Y=(d.y2*a+_.y+d.padding)*W+Z.point.y,pe=Z.perspectiveRatio<=.55||Z.occluded;return!this.isInsideGrid(X,G,te,Y)||!g&&this.grid.hitTest(X,G,te,Y,C)||pe?{box:[],offscreen:!1,occluded:Z.occluded}:{box:[X,G,te,Y],offscreen:this.isOffscreen(X,G,te,Y),occluded:!1}}placeCollisionCircles(n,a,d,_,g,w,T,C,k,z,R,j,K,Z,W){const X=[],G=this.transform.elevation,te=G?G.getAtTileOffsetFunc(W,this.transform.center.lat,this.transform.worldSize,n.getProjection()):qe=>[0,0,0],Y=new s.pointGeometry(d.tileAnchorX,d.tileAnchorY),pe=n.getProjection().projectTilePoint(d.tileAnchorX,d.tileAnchorY,W.canonical),he=te(Y),oe=[pe.x+he[0],pe.y+he[1],pe.z+he[2]],fe=n.projection.name==="globe",le=this.projectAndGetPerspectiveRatio(T,[oe[0],oe[1],oe[2]],W,fe||!!G||this.transform.pitch>0,n.getProjection()),{perspectiveRatio:ve}=le,Be=(R?w/ve:w*ve)/s.ONE_EM,dt=Rr(new s.pointGeometry(oe[0],oe[1]),C,oe[2]).point,Ae=le.signedDistanceFromCamera>0?gr(Be,g,d.lineOffsetX*Be,d.lineOffsetY*Be,!1,dt,Y,d,_,C,{},G&&!R?te:null,R&&!!G,n.getProjection(),W,R):null;let Je=!1,rt=!1,wt=!0;if(Ae&&!le.occluded){const qe=.5*K*ve+Z,mt=new s.pointGeometry(-100,-100),it=new s.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),It=new wp,St=Ae.first,Vt=Ae.last;let Wt=[];for(let Ut=St.path.length-1;Ut>=1;Ut--)Wt.push(St.path[Ut]);for(let Ut=1;Ut<Vt.path.length;Ut++)Wt.push(Vt.path[Ut]);const ii=2.5*qe;if(k){const Ut=Wt.map(G&&!fe?(ai,Ii)=>{const Qi=te(Ii<St.path.length-1?St.tilePath[St.path.length-1-Ii]:Vt.tilePath[Ii-St.path.length+2]);return ai[2]=Qi[2],ui(ai,k)}:ai=>ui(ai,k));Wt=Ut.some(ai=>ai.signedDistanceFromCamera<=0)?[]:Ut.map(ai=>ai.point)}let xi=[];if(Wt.length>0){const Ut=Wt.map(ji=>new s.pointGeometry(ji[0],ji[1]));let ai=1/0,Ii=-1/0,Qi=1/0,dn=-1/0;for(let ji=0;ji<Ut.length;ji++)ai=Math.min(ai,Ut[ji].x),Qi=Math.min(Qi,Ut[ji].y),Ii=Math.max(Ii,Ut[ji].x),dn=Math.max(dn,Ut[ji].y);xi=ai>=mt.x&&Ii<=it.x&&Qi>=mt.y&&dn<=it.y?[Ut]:Ii<mt.x||ai>it.x||dn<mt.y||Qi>it.y?[]:s.clipLine([Ut],mt.x,mt.y,it.x,it.y)}for(const Ut of xi){It.reset(Ut,.25*qe);let ai=0;ai=It.length<=.5*qe?1:Math.ceil(It.paddedLength/ii)+1;for(let Ii=0;Ii<ai;Ii++){const Qi=Ii/Math.max(ai-1,1),dn=It.lerp(Qi),ji=dn.x+Ni,Fn=dn.y+Ni;X.push(ji,Fn,qe,0);const Vr=ji-qe,so=Fn-qe,en=ji+qe,nn=Fn+qe;if(wt=wt&&this.isOffscreen(Vr,so,en,nn),rt=rt||this.isInsideGrid(Vr,so,en,nn),!a&&this.grid.hitTestCircle(ji,Fn,qe,j)&&(Je=!0,!z))return{circles:[],offscreen:!1,collisionDetected:Je,occluded:!1}}}}return{circles:!z&&Je||!rt?[]:X,offscreen:wt,collisionDetected:Je,occluded:le.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let d=1/0,_=1/0,g=-1/0,w=-1/0;for(const z of n){const R=new s.pointGeometry(z.x+Ni,z.y+Ni);d=Math.min(d,R.x),_=Math.min(_,R.y),g=Math.max(g,R.x),w=Math.max(w,R.y),a.push(R)}const T=this.grid.query(d,_,g,w).concat(this.ignoredGrid.query(d,_,g,w)),C={},k={};for(const z of T){const R=z.key;if(C[R.bucketInstanceId]===void 0&&(C[R.bucketInstanceId]={}),C[R.bucketInstanceId][R.featureIndex])continue;const j=[new s.pointGeometry(z.x1,z.y1),new s.pointGeometry(z.x2,z.y1),new s.pointGeometry(z.x2,z.y2),new s.pointGeometry(z.x1,z.y2)];s.polygonIntersectsPolygon(a,j)&&(C[R.bucketInstanceId][R.featureIndex]=!0,k[R.bucketInstanceId]===void 0&&(k[R.bucketInstanceId]=[]),k[R.bucketInstanceId].push(R.featureIndex))}return k}insertCollisionBox(n,a,d,_,g){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:_,collisionGroupID:g},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,a,d,_,g){const w=a?this.ignoredGrid:this.grid,T={bucketInstanceId:d,featureIndex:_,collisionGroupID:g};for(let C=0;C<n.length;C+=4)w.insertCircle(T,n[C],n[C+1],n[C+2])}projectAndGetPerspectiveRatio(n,a,d,_,g){const w=[a[0],a[1],a[2],1];let T=!1;if(a[2]||this.transform.pitch>0){s.transformMat4$1(w,w,n);const C=g.name==="globe";this.fogState&&d&&!C&&(T=function(k,z,R,j,K,Z){const W=Z.calculateFogTileMatrix(K),X=[z,R,j];return s.transformMat4(X,X,W),At(k,X,Z.pitch,Z._fov)}(this.fogState,a[0],a[1],a[2],d.toUnwrapped(),this.transform)>.9)}else Yn(w,w,n);return{point:new s.pointGeometry((w[0]/w[3]+1)/2*this.transform.width+Ni,(-w[1]/w[3]+1)/2*this.transform.height+Ni),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(g)/w[3]*.5,1.5),signedDistanceFromCamera:w[3],occluded:_&&w[2]>w[3]||T}}isOffscreen(n,a,d,_){return d<Ni||n>=this.screenRightBoundary||_<Ni||a>this.screenBottomBoundary}isInsideGrid(n,a,d,_){return d>=0&&n<this.gridRightBoundary&&_>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const n=s.identity([]);return s.translate(n,n,[-100,-100,0]),n}}function _a(c,n,a){const d=n.createTileMatrix(c,c.worldSize,a.toUnwrapped());return s.multiply(new Float32Array(16),c.projMatrix,d)}function ar(c,n,a){if(n.projection.name===a.projection.name)return c.projMatrix;const d=a.clone();return d.setProjection(n.projection),_a(d,n.getProjection(),c)}function lr(c,n,a){return n.name===a.projection.name?c.projMatrix:_a(a,n,c)}class Uc{constructor(n,a,d,_){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?a:-a))):_&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class Ao{constructor(n,a,d,_,g,w=!1){this.text=new Uc(n?n.text:null,a,d,g),this.icon=new Uc(n?n.icon:null,a,_,g),this.clipped=w}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class yn{constructor(n,a,d,_=!1){this.text=n,this.icon=a,this.skipFade=d,this.clipped=_}}class ga{constructor(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]}}class Nc{constructor(n,a,d,_,g){this.bucketInstanceId=n,this.featureIndex=a,this.sourceLayerIndex=d,this.bucketIndex=_,this.tileID=g}}class ya{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const a=++this.maxGroupID;this.collisionGroups[n]={ID:a,predicate:d=>d.collisionGroupID===a}}return this.collisionGroups[n]}}function Dn(c,n,a,d,_){const{horizontalAlign:g,verticalAlign:w}=s.getAnchorAlignment(c),T=-(g-.5)*n,C=-(w-.5)*a,k=s.evaluateVariableOffset(c,d);return new s.pointGeometry(T+k[0]*_,C+k[1]*_)}function va(c,n,a,d,_){const g=new s.pointGeometry(c,n);return a&&g._rotate(d?_:-_),g}class jc{constructor(n,a,d,_,g){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new Vc(this.transform,g),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new ya(d),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,a,d,_){const g=d.getBucket(a),w=d.latestFeatureIndex;if(!g||!w||a.id!==g.layerIds[0])return;const T=g.layers[0].layout,C=d.collisionBoxArray,k=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),z=d.tileSize/s.EXTENT,R=d.tileID.toUnwrapped();this.transform.setProjection(g.projection);const j=(K=d.tileID,Z=g.getProjection(),W=this.transform,Z.name===this.projection?W.calculateProjMatrix(K.toUnwrapped()):_a(W,Z,K));var K,Z,W;const X=T.get("text-pitch-alignment")==="map",G=T.get("text-rotation-alignment")==="map";a.compileFilter();const te=a.dynamicFilter(),Y=a.dynamicFilterNeedsFeature(),pe=this.transform.calculatePixelsToTileUnitsMatrix(d),he=yi(j,d.tileID.canonical,X,G,this.transform,g.getProjection(),pe);let oe=null;if(X){const ve=Br(j,d.tileID.canonical,X,G,this.transform,g.getProjection(),pe);oe=s.multiply([],this.transform.labelPlaneMatrix,ve)}let fe=null;te&&d.latestFeatureIndex&&(fe={unwrappedTileID:R,dynamicFilter:te,dynamicFilterNeedsFeature:Y,featureIndex:d.latestFeatureIndex}),this.retainedQueryData[g.bucketInstanceId]=new Nc(g.bucketInstanceId,w,g.sourceLayerIndex,g.index,d.tileID);const le={bucket:g,layout:T,posMatrix:j,textLabelPlaneMatrix:he,labelToScreenMatrix:oe,clippingData:fe,scale:k,textPixelRatio:z,holdingForFade:d.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(g.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.evaluateSizeForZoom(g.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(_)for(const ve of g.sortKeyRanges){const{sortKey:Be,symbolInstanceStart:dt,symbolInstanceEnd:Ae}=ve;n.push({sortKey:Be,symbolInstanceStart:dt,symbolInstanceEnd:Ae,parameters:le})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:le})}attemptAnchorPlacement(n,a,d,_,g,w,T,C,k,z,R,j,K,Z,W,X,G,te){const Y=[j.textOffset0,j.textOffset1],pe=Dn(n,d,_,Y,g),he=this.collisionIndex.placeCollisionBox(Z,g,a,va(pe.x,pe.y,w,T,this.transform.angle),R,C,k,z.predicate);if((!X||this.collisionIndex.placeCollisionBox(Z,Z.getSymbolInstanceIconSize(te,this.transform.zoom,K),X,va(pe.x,pe.y,w,T,this.transform.angle),R,C,k,z.predicate).box.length!==0)&&he.box.length>0){let oe;return this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(oe=this.prevPlacement.variableOffsets[j.crossTileID].anchor),this.variableOffsets[j.crossTileID]={textOffset:Y,width:d,height:_,anchor:n,textScale:g,prevAnchor:oe},this.markUsedJustification(Z,n,j,W),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,W,j),this.placedOrientations[j.crossTileID]=W),{shift:pe,placedGlyphBoxes:he}}}placeLayerBucketPart(n,a,d,_){const{bucket:g,layout:w,posMatrix:T,textLabelPlaneMatrix:C,labelToScreenMatrix:k,clippingData:z,textPixelRatio:R,holdingForFade:j,collisionBoxArray:K,partiallyEvaluatedTextSize:Z,partiallyEvaluatedIconSize:W,collisionGroup:X}=n.parameters,G=w.get("text-optional"),te=w.get("icon-optional"),Y=w.get("text-allow-overlap"),pe=w.get("icon-allow-overlap"),he=w.get("text-rotation-alignment")==="map",oe=w.get("text-pitch-alignment")==="map",fe=w.get("icon-text-fit")!=="none",le=w.get("symbol-z-order")==="viewport-y";this.transform.setProjection(g.projection);let ve=Y&&(pe||!g.hasIconData()||te),Be=pe&&(Y||!g.hasTextData()||G);!g.collisionArrays&&K&&g.deserializeCollisionBoxes(K),d&&_&&g.updateCollisionDebugBuffers(this.transform.zoom,K);const dt=(Ae,Je,rt)=>{if(z){const en={zoom:this.transform.zoom,pitch:this.transform.pitch};let nn=null;if(z.dynamicFilterNeedsFeature){const _i=this.retainedQueryData[g.bucketInstanceId];nn=z.featureIndex.loadFeature({featureIndex:Ae.featureIndex,bucketIndex:_i.bucketIndex,sourceLayerIndex:_i.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,z.dynamicFilter)(en,nn,this.retainedQueryData[g.bucketInstanceId].tileID.canonical,new s.pointGeometry(Ae.tileAnchorX,Ae.tileAnchorY),this.transform.calculateDistanceTileData(z.unwrappedTileID)))return this.placements[Ae.crossTileID]=new yn(!1,!1,!1,!0),void(a[Ae.crossTileID]=!0)}if(a[Ae.crossTileID])return;if(j)return void(this.placements[Ae.crossTileID]=new yn(!1,!1,!1));let wt=!1,qe=!1,mt=!0,it=!1,It=!1,St=null,Vt={box:null,offscreen:null,occluded:null},Wt={box:null,offscreen:null,occluded:null},ii=null,xi=null,Ut=null,ai=0,Ii=0,Qi=0;rt.textFeatureIndex?ai=rt.textFeatureIndex:Ae.useRuntimeCollisionCircles&&(ai=Ae.featureIndex),rt.verticalTextFeatureIndex&&(Ii=rt.verticalTextFeatureIndex);const dn=en=>{en.tileID=this.retainedQueryData[g.bucketInstanceId].tileID,(this.transform.elevation||en.elevation)&&(en.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[g.bucketInstanceId].tileID,en.tileAnchorX,en.tileAnchorY):0)},ji=rt.textBox;if(ji){dn(ji);const en=_i=>{let En=s.WritingMode.horizontal;if(g.allowVerticalPlacement&&!_i&&this.prevPlacement){const Gn=this.prevPlacement.placedOrientations[Ae.crossTileID];Gn&&(this.placedOrientations[Ae.crossTileID]=Gn,En=Gn,this.markUsedOrientation(g,En,Ae))}return En},nn=(_i,En)=>{if(g.allowVerticalPlacement&&Ae.numVerticalGlyphVertices>0&&rt.verticalTextBox){for(const Gn of g.writingModes)if(Gn===s.WritingMode.vertical?(Vt=En(),Wt=Vt):Vt=_i(),Vt&&Vt.box&&Vt.box.length)break}else Vt=_i()};if(w.get("text-variable-anchor")){let _i=w.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ae.crossTileID]){const Xi=this.prevPlacement.variableOffsets[Ae.crossTileID];_i.indexOf(Xi.anchor)>0&&(_i=_i.filter(Zn=>Zn!==Xi.anchor),_i.unshift(Xi.anchor))}const En=(Xi,Zn,Qo)=>{const Jn=g.getSymbolInstanceTextSize(Z,Ae,this.transform.zoom,Je),es=(Xi.x2-Xi.x1)*Jn+2*Xi.padding,ts=(Xi.y2-Xi.y1)*Jn+2*Xi.padding,is=fe&&!pe?Zn:null;is&&dn(is);let Qn={box:[],offscreen:!1,occluded:!1};const ns=Y?2*_i.length:_i.length;for(let Po=0;Po<ns;++Po){const ja=this.attemptAnchorPlacement(_i[Po%_i.length],Xi,es,ts,Jn,he,oe,R,T,X,Po>=_i.length,Ae,Je,g,Qo,is,Z,W);if(ja&&(Qn=ja.placedGlyphBoxes,Qn&&Qn.box&&Qn.box.length)){wt=!0,St=ja.shift;break}}return Qn};nn(()=>En(ji,rt.iconBox,s.WritingMode.horizontal),()=>{const Xi=rt.verticalTextBox;return Xi&&dn(Xi),g.allowVerticalPlacement&&!(Vt&&Vt.box&&Vt.box.length)&&Ae.numVerticalGlyphVertices>0&&Xi?En(Xi,rt.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Vt&&(wt=Vt.box,mt=Vt.offscreen,it=Vt.occluded);const Gn=en(Vt&&Vt.box);if(!wt&&this.prevPlacement){const Xi=this.prevPlacement.variableOffsets[Ae.crossTileID];Xi&&(this.variableOffsets[Ae.crossTileID]=Xi,this.markUsedJustification(g,Xi.anchor,Ae,Gn))}}else{const _i=(En,Gn)=>{const Xi=g.getSymbolInstanceTextSize(Z,Ae,this.transform.zoom,Je),Zn=this.collisionIndex.placeCollisionBox(g,Xi,En,new s.pointGeometry(0,0),Y,R,T,X.predicate);return Zn&&Zn.box&&Zn.box.length&&(this.markUsedOrientation(g,Gn,Ae),this.placedOrientations[Ae.crossTileID]=Gn),Zn};nn(()=>_i(ji,s.WritingMode.horizontal),()=>{const En=rt.verticalTextBox;return g.allowVerticalPlacement&&Ae.numVerticalGlyphVertices>0&&En?(dn(En),_i(En,s.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),en(Vt&&Vt.box&&Vt.box.length)}}if(ii=Vt,wt=ii&&ii.box&&ii.box.length>0,mt=ii&&ii.offscreen,it=ii&&ii.occluded,Ae.useRuntimeCollisionCircles){const en=g.text.placedSymbolArray.get(Ae.centerJustifiedTextSymbolIndex>=0?Ae.centerJustifiedTextSymbolIndex:Ae.verticalPlacedTextSymbolIndex),nn=s.evaluateSizeForFeature(g.textSizeData,Z,en),_i=w.get("text-padding");xi=this.collisionIndex.placeCollisionCircles(g,Y,en,g.lineVertexArray,g.glyphOffsetArray,nn,T,C,k,d,oe,X.predicate,Ae.collisionCircleDiameter*nn/s.ONE_EM,_i,this.retainedQueryData[g.bucketInstanceId].tileID),wt=Y||xi.circles.length>0&&!xi.collisionDetected,mt=mt&&xi.offscreen,it=xi.occluded}if(rt.iconFeatureIndex&&(Qi=rt.iconFeatureIndex),rt.iconBox){const en=nn=>{dn(nn);const _i=fe&&St?va(St.x,St.y,he,oe,this.transform.angle):new s.pointGeometry(0,0),En=g.getSymbolInstanceIconSize(W,this.transform.zoom,Je);return this.collisionIndex.placeCollisionBox(g,En,nn,_i,pe,R,T,X.predicate)};Wt&&Wt.box&&Wt.box.length&&rt.verticalIconBox?(Ut=en(rt.verticalIconBox),qe=Ut.box.length>0):(Ut=en(rt.iconBox),qe=Ut.box.length>0),mt=mt&&Ut.offscreen,It=Ut.occluded}const Fn=G||Ae.numHorizontalGlyphVertices===0&&Ae.numVerticalGlyphVertices===0,Vr=te||Ae.numIconVertices===0;if(Fn||Vr?Vr?Fn||(qe=qe&&wt):wt=qe&&wt:qe=wt=qe&&wt,wt&&ii&&ii.box&&this.collisionIndex.insertCollisionBox(ii.box,w.get("text-ignore-placement"),g.bucketInstanceId,Wt&&Wt.box&&Ii?Ii:ai,X.ID),qe&&Ut&&this.collisionIndex.insertCollisionBox(Ut.box,w.get("icon-ignore-placement"),g.bucketInstanceId,Qi,X.ID),xi&&(wt&&this.collisionIndex.insertCollisionCircles(xi.circles,w.get("text-ignore-placement"),g.bucketInstanceId,ai,X.ID),d)){const en=g.bucketInstanceId;let nn=this.collisionCircleArrays[en];nn===void 0&&(nn=this.collisionCircleArrays[en]=new ga);for(let _i=0;_i<xi.circles.length;_i+=4)nn.circles.push(xi.circles[_i+0]),nn.circles.push(xi.circles[_i+1]),nn.circles.push(xi.circles[_i+2]),nn.circles.push(xi.collisionDetected?1:0)}const so=g.projection.name!=="globe";ve=ve&&(so||!it),Be=Be&&(so||!It),this.placements[Ae.crossTileID]=new yn(wt||ve,qe||Be,mt||g.justReloaded),a[Ae.crossTileID]=!0};if(le){const Ae=g.getSortedSymbolIndexes(this.transform.angle);for(let Je=Ae.length-1;Je>=0;--Je){const rt=Ae[Je];dt(g.symbolInstances.get(rt),rt,g.collisionArrays[rt])}}else for(let Ae=n.symbolInstanceStart;Ae<n.symbolInstanceEnd;Ae++)dt(g.symbolInstances.get(Ae),Ae,g.collisionArrays[Ae]);if(d&&g.bucketInstanceId in this.collisionCircleArrays){const Ae=this.collisionCircleArrays[g.bucketInstanceId];s.invert(Ae.invProjMatrix,T),Ae.viewportMatrix=this.collisionIndex.getViewportMatrix()}g.justReloaded=!1}markUsedJustification(n,a,d,_){let g;g=_===s.WritingMode.vertical?d.verticalPlacedTextSymbolIndex:{left:d.leftJustifiedTextSymbolIndex,center:d.centerJustifiedTextSymbolIndex,right:d.rightJustifiedTextSymbolIndex}[s.getAnchorJustification(a)];const w=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex,d.verticalPlacedTextSymbolIndex];for(const T of w)T>=0&&(n.text.placedSymbolArray.get(T).crossTileID=g>=0&&T!==g?0:d.crossTileID)}markUsedOrientation(n,a,d){const _=a===s.WritingMode.horizontal||a===s.WritingMode.horizontalOnly?a:0,g=a===s.WritingMode.vertical?a:0,w=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex];for(const T of w)n.text.placedSymbolArray.get(T).placedOrientation=_;d.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(d.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let d=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const _=a?a.symbolFadeChange(n):1,g=a?a.opacities:{},w=a?a.variableOffsets:{},T=a?a.placedOrientations:{};for(const C in this.placements){const k=this.placements[C],z=g[C];z?(this.opacities[C]=new Ao(z,_,k.text,k.icon,null,k.clipped),d=d||k.text!==z.text.placed||k.icon!==z.icon.placed):(this.opacities[C]=new Ao(null,_,k.text,k.icon,k.skipFade,k.clipped),d=d||k.text||k.icon)}for(const C in g){const k=g[C];if(!this.opacities[C]){const z=new Ao(k,_,!1,!1);z.isHidden()||(this.opacities[C]=z,d=d||k.text.placed||k.icon.placed)}}for(const C in w)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=w[C]);for(const C in T)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=T[C]);d?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:n)}updateLayerOpacities(n,a){const d={};for(const _ of a){const g=_.getBucket(n);g&&_.latestFeatureIndex&&n.id===g.layerIds[0]&&this.updateBucketOpacities(g,d,_.collisionBoxArray)}}updateBucketOpacities(n,a,d){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const _=n.layers[0].layout,g=!!n.layers[0].dynamicFilter(),w=new Ao(null,0,!1,!1,!0),T=_.get("text-allow-overlap"),C=_.get("icon-allow-overlap"),k=_.get("text-variable-anchor"),z=_.get("text-rotation-alignment")==="map",R=_.get("text-pitch-alignment")==="map",j=_.get("icon-text-fit")!=="none",K=new Ao(null,0,T&&(C||!n.hasIconData()||_.get("icon-optional")),C&&(T||!n.hasTextData()||_.get("text-optional")),!0);!n.collisionArrays&&d&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(d);const Z=(X,G,te)=>{for(let Y=0;Y<G/4;Y++)X.opacityVertexArray.emplaceBack(te)};let W=0;for(let X=0;X<n.symbolInstances.length;X++){const G=n.symbolInstances.get(X),{numHorizontalGlyphVertices:te,numVerticalGlyphVertices:Y,crossTileID:pe}=G;let he=this.opacities[pe];a[pe]?he=w:he||(he=K,this.opacities[pe]=he),a[pe]=!0;const oe=te>0||Y>0,fe=G.numIconVertices>0,le=this.placedOrientations[G.crossTileID],ve=le===s.WritingMode.vertical,Be=le===s.WritingMode.horizontal||le===s.WritingMode.horizontalOnly;if(!oe&&!fe||he.isHidden()||W++,oe){const dt=Xo(he.text);Z(n.text,te,ve?Fr:dt),Z(n.text,Y,Be?Fr:dt);const Ae=he.text.isHidden();[G.rightJustifiedTextSymbolIndex,G.centerJustifiedTextSymbolIndex,G.leftJustifiedTextSymbolIndex].forEach(wt=>{wt>=0&&(n.text.placedSymbolArray.get(wt).hidden=Ae||ve?1:0)}),G.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(G.verticalPlacedTextSymbolIndex).hidden=Ae||Be?1:0);const Je=this.variableOffsets[G.crossTileID];Je&&this.markUsedJustification(n,Je.anchor,G,le);const rt=this.placedOrientations[G.crossTileID];rt&&(this.markUsedJustification(n,"left",G,rt),this.markUsedOrientation(n,rt,G))}if(fe){const dt=Xo(he.icon);G.placedIconSymbolIndex>=0&&(Z(n.icon,G.numIconVertices,ve?Fr:dt),n.icon.placedSymbolArray.get(G.placedIconSymbolIndex).hidden=he.icon.isHidden()),G.verticalPlacedIconSymbolIndex>=0&&(Z(n.icon,G.numVerticalIconVertices,Be?Fr:dt),n.icon.placedSymbolArray.get(G.verticalPlacedIconSymbolIndex).hidden=he.icon.isHidden())}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const dt=n.collisionArrays[X];if(dt){let Ae=new s.pointGeometry(0,0),Je=!0;if(dt.textBox||dt.verticalTextBox){if(k){const wt=this.variableOffsets[pe];wt?(Ae=Dn(wt.anchor,wt.width,wt.height,wt.textOffset,wt.textScale),z&&Ae._rotate(R?this.transform.angle:-this.transform.angle)):Je=!1}g&&(Je=!he.clipped),dt.textBox&&Sr(n.textCollisionBox.collisionVertexArray,he.text.placed,!Je||ve,Ae.x,Ae.y),dt.verticalTextBox&&Sr(n.textCollisionBox.collisionVertexArray,he.text.placed,!Je||Be,Ae.x,Ae.y)}const rt=Je&&Boolean(!Be&&dt.verticalIconBox);dt.iconBox&&Sr(n.iconCollisionBox.collisionVertexArray,he.icon.placed,rt,j?Ae.x:0,j?Ae.y:0),dt.verticalIconBox&&Sr(n.iconCollisionBox.collisionVertexArray,he.icon.placed,!rt,j?Ae.x:0,j?Ae.y:0)}}}if(n.fullyClipped=W===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const X=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=X.invProjMatrix,n.placementViewportMatrix=X.viewportMatrix,n.collisionCircleArray=X.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,a){const d=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*d>n}setStale(){this.stale=!0}}function Sr(c,n,a,d,_){c.emplaceBack(n?1:0,a?1:0,d||0,_||0),c.emplaceBack(n?1:0,a?1:0,d||0,_||0),c.emplaceBack(n?1:0,a?1:0,d||0,_||0),c.emplaceBack(n?1:0,a?1:0,d||0,_||0)}const xa=Math.pow(2,25),vl=Math.pow(2,24),Tp=Math.pow(2,17),qc=Math.pow(2,16),Ss=Math.pow(2,9),Ep=Math.pow(2,8),qh=Math.pow(2,1);function Xo(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;const n=c.placed?1:0,a=Math.floor(127*c.opacity);return a*xa+n*vl+a*Tp+n*qc+a*Ss+n*Ep+a*qh+n}const Fr=0;class xl{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(n,a,d,_,g){const w=this._bucketParts;for(;this._currentTileIndex<n.length;)if(a.getBucketParts(w,_,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((T,C)=>T.sortKey-C.sortKey));this._currentPartIndex<w.length;){const T=w[this._currentPartIndex];if(a.placeLayerBucketPart(T,this._seenCrossTileIDs,d,T.symbolInstanceStart===0),this._currentPartIndex++,g())return!0}return!1}}class Mo{constructor(n,a,d,_,g,w,T,C){this.placement=new jc(n,g,w,T,C),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(n,a,d){const _=s.exported.now(),g=()=>{const w=s.exported.now()-_;return!this._forceFullPlacement&&w>2};for(;this._currentPlacementIndex>=0;){const w=a[n[this._currentPlacementIndex]],T=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=T)&&(!w.maxzoom||w.maxzoom>T)){if(this._inProgressLayer||(this._inProgressLayer=new xl(w)),this._inProgressLayer.continuePlacement(d[w.source],this.placement,this._showCollisionBoxes,w,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const $c=512/s.EXTENT/2;class bl{constructor(n,a,d){this.tileID=n,this.indexedSymbolInstances={},this.bucketInstanceId=d;for(let _=0;_<a.length;_++){const g=a.get(_),w=g.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:g.crossTileID,coord:this.getScaledCoordinates(g,n)})}}getScaledCoordinates(n,a){const d=$c/Math.pow(2,a.canonical.z-this.tileID.canonical.z);return{x:Math.floor((a.canonical.x*s.EXTENT+n.tileAnchorX)*d),y:Math.floor((a.canonical.y*s.EXTENT+n.tileAnchorY)*d)}}findMatches(n,a,d){const _=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let g=0;g<n.length;g++){const w=n.get(g);if(w.crossTileID)continue;const T=this.indexedSymbolInstances[w.key];if(!T)continue;const C=this.getScaledCoordinates(w,a);for(const k of T)if(Math.abs(k.coord.x-C.x)<=_&&Math.abs(k.coord.y-C.y)<=_&&!d[k.crossTileID]){d[k.crossTileID]=!0,w.crossTileID=k.crossTileID;break}}}}class Sp{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Cp{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const a=Math.round((n-this.lng)/360);if(a!==0)for(const d in this.indexes){const _=this.indexes[d],g={};for(const w in _){const T=_[w];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+a),g[T.tileID.key]=T}this.indexes[d]=g}this.lng=n}addBucket(n,a,d){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let g=0;g<a.symbolInstances.length;g++)a.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});const _=this.usedCrossTileIDs[n.overscaledZ];for(const g in this.indexes){const w=this.indexes[g];if(Number(g)>n.overscaledZ)for(const T in w){const C=w[T];C.tileID.isChildOf(n)&&C.findMatches(a.symbolInstances,n,_)}else{const T=w[n.scaledTo(Number(g)).key];T&&T.findMatches(a.symbolInstances,n,_)}}for(let g=0;g<a.symbolInstances.length;g++){const w=a.symbolInstances.get(g);w.crossTileID||(w.crossTileID=d.generate(),_[w.crossTileID]=!0)}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new bl(n,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(n,a){for(const d in a.indexedSymbolInstances)for(const _ of a.indexedSymbolInstances[d])delete this.usedCrossTileIDs[n][_.crossTileID]}removeStaleBuckets(n){let a=!1;for(const d in this.indexes){const _=this.indexes[d];for(const g in _)n[_[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,_[g]),delete _[g],a=!0)}return a}}class wl{constructor(){this.layerIndexes={},this.crossTileIDs=new Sp,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,a,d,_){let g=this.layerIndexes[n.id];g===void 0&&(g=this.layerIndexes[n.id]=new Cp);let w=!1;const T={};_.name!=="globe"&&g.handleWrapJump(d);for(const C of a){const k=C.getBucket(n);k&&n.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(C.tileID,k,this.crossTileIDs)&&(w=!0),T[k.bucketInstanceId]=!0)}return g.removeStaleBuckets(T)&&(w=!0),w}pruneUnusedLayers(n){const a={};n.forEach(d=>{a[d]=!0});for(const d in this.layerIndexes)a[d]||delete this.layerIndexes[d]}}const Tl=(c,n)=>s.emitValidationErrors(c,n&&n.filter(a=>a.identifier!=="source.canvas")),$h=s.pick(Ze,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Ap=s.pick(Ze,["setCenter","setZoom","setBearing","setPitch"]),Gh={version:8,layers:[],sources:{}},Mp={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Cr extends s.Evented{constructor(n,a={}){super(),this.map=n,this.dispatcher=new Lt(Pi(),this),this.imageManager=new nt,this.imageManager.setEventedParent(this),this.glyphManager=new s.GlyphManager(n._requestManager,a.localFontFamily?s.LocalGlyphMode.all:a.localIdeographFontFamily?s.LocalGlyphMode.ideographs:s.LocalGlyphMode.none,a.localFontFamily||a.localIdeographFontFamily),this.lineAtlas=new s.LineAtlas(256,512),this.crossTileSymbolIndex=new wl,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new s.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());const d=this;this._rtlTextPluginCallback=Cr.registerForPluginStateChange(_=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(g,w)=>{if(s.triggerPluginCompletionEvent(g),w&&w.every(T=>T))for(const T in d._sourceCaches){const C=d._sourceCaches[T],k=C.getSource().type;k!=="vector"&&k!=="geojson"||C.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const g=this.getSource(_.sourceId);if(g&&g.vectorLayerIds)for(const w in this._layers){const T=this._layers[w];T.source===g.id&&this._validateLayer(T)}})}loadURL(n,a={}){this.fire(new s.Event("dataloading",{dataType:"style"}));const d=typeof a.validate=="boolean"?a.validate:!s.isMapboxURL(n);n=this.map._requestManager.normalizeStyleURL(n,a.accessToken);const _=this.map._requestManager.transformRequest(n,s.ResourceType.Style);this._request=s.getJSON(_,(g,w)=>{this._request=null,g?this.fire(new s.ErrorEvent(g)):w&&this._load(w,d)})}loadJSON(n,a={}){this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.exported.frame(()=>{this._request=null,this._load(n,a.validate!==!1)})}loadEmpty(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(Gh,!1)}_updateLayerCount(n,a){const d=a?1:-1;n.is3D()&&(this._num3DLayers+=d),n.type==="circle"&&(this._numCircleLayers+=d),n.type==="symbol"&&(this._numSymbolLayers+=d)}_load(n,a){if(a&&Tl(this,s.validateStyle(n)))return;this._loaded=!0,this.stylesheet=s.clone$1(n),this._updateMapProjection();for(const _ in n.sources)this.addSource(_,n.sources[_],{validate:!1});this._changed=!1,n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(n.glyphs);const d=vt(this.stylesheet.layers);this._order=d.map(_=>_.id),this._layers={},this._serializedLayers={};for(let _ of d)_=s.createStyleLayer(_),_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ye(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(n){this._spriteRequest=function(a,d,_){let g,w,T;const C=s.exported.devicePixelRatio>1?"@2x":"";let k=s.getJSON(d.transformRequest(d.normalizeSpriteURL(a,C,".json"),s.ResourceType.SpriteJSON),(j,K)=>{k=null,T||(T=j,g=K,R())}),z=s.getImage(d.transformRequest(d.normalizeSpriteURL(a,C,".png"),s.ResourceType.SpriteImage),(j,K)=>{z=null,T||(T=j,w=K,R())});function R(){if(T)_(T);else if(g&&w){const j=s.exported.getImageData(w),K={};for(const Z in g){const{width:W,height:X,x:G,y:te,sdf:Y,pixelRatio:pe,stretchX:he,stretchY:oe,content:fe}=g[Z],le=new s.RGBAImage({width:W,height:X});s.RGBAImage.copy(j,le,{x:G,y:te},{x:0,y:0},{width:W,height:X}),K[Z]={data:le,pixelRatio:pe,sdf:Y,stretchX:he,stretchY:oe,content:fe}}_(null,K)}}return{cancel(){k&&(k.cancel(),k=null),z&&(z.cancel(),z=null)}}}(n,this.map._requestManager,(a,d)=>{if(this._spriteRequest=null,a)this.fire(new s.ErrorEvent(a));else if(d)for(const _ in d)this.imageManager.addImage(_,d[_]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new s.Event("data",{dataType:"style"}))})}_validateLayer(n){const a=this.getSource(n.source);if(!a)return;const d=n.sourceLayer;d&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(d)===-1)&&this.fire(new s.ErrorEvent(new Error(`Source layer "${d}" does not exist on source "${a.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(n){const a=[];for(const d of n){const _=this._layers[d];_.type!=="custom"&&a.push(_.serialize())}return a}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(n){return!!this.terrain&&Mp[n.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(n){if(!this._loaded)return;const a=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(_.length||g.length)&&this._updateWorkerLayers(_,g);for(const w in this._updatedSources){const T=this._updatedSources[w];T==="reload"?this._reloadSource(w):T==="clear"&&this._clearSource(w)}this._updateTilesForChangedImages();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(n);this.light.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._resetUpdates()}const d={};for(const _ in this._sourceCaches){const g=this._sourceCaches[_];d[_]=g.used,g.used=!1}for(const _ of this._order){const g=this._layers[_];if(g.recalculate(n,this._availableImages),!g.isHidden(n.zoom)){const T=this._getLayerSourceCache(g);T&&(T.used=!0)}const w=this.map.painter;if(w){const T=g.getProgramIds();if(!T)continue;const C=g.getProgramConfiguration(n.zoom);for(const k of T)w.useProgram(k,C)}}for(const _ in d){const g=this._sourceCaches[_];d[_]!==g.used&&g.getSource().fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:g.getSource().id}))}this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),a&&this.fire(new s.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const a in this._sourceCaches)this._sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateWorkerLayers(n,a){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(n){if(this._checkLoaded(),Tl(this,s.validateStyle(n)))return!1;(n=s.clone$1(n)).layers=vt(n.layers);const a=function(_,g){if(!_)return[{command:Ze.setStyle,args:[g]}];let w=[];try{if(!D(_.version,g.version))return[{command:Ze.setStyle,args:[g]}];D(_.center,g.center)||w.push({command:Ze.setCenter,args:[g.center]}),D(_.zoom,g.zoom)||w.push({command:Ze.setZoom,args:[g.zoom]}),D(_.bearing,g.bearing)||w.push({command:Ze.setBearing,args:[g.bearing]}),D(_.pitch,g.pitch)||w.push({command:Ze.setPitch,args:[g.pitch]}),D(_.sprite,g.sprite)||w.push({command:Ze.setSprite,args:[g.sprite]}),D(_.glyphs,g.glyphs)||w.push({command:Ze.setGlyphs,args:[g.glyphs]}),D(_.transition,g.transition)||w.push({command:Ze.setTransition,args:[g.transition]}),D(_.light,g.light)||w.push({command:Ze.setLight,args:[g.light]}),D(_.fog,g.fog)||w.push({command:Ze.setFog,args:[g.fog]}),D(_.projection,g.projection)||w.push({command:Ze.setProjection,args:[g.projection]});const T={},C=[];(function(R,j,K,Z){let W;for(W in j=j||{},R=R||{})R.hasOwnProperty(W)&&(j.hasOwnProperty(W)||wi(W,K,Z));for(W in j)j.hasOwnProperty(W)&&(R.hasOwnProperty(W)?D(R[W],j[W])||(R[W].type==="geojson"&&j[W].type==="geojson"&&Gi(R,j,W)?K.push({command:Ze.setGeoJSONSourceData,args:[W,j[W].data]}):ni(W,j,K,Z)):Ce(W,j,K))})(_.sources,g.sources,C,T);const k=[];_.layers&&_.layers.forEach(R=>{R.source&&T[R.source]?w.push({command:Ze.removeLayer,args:[R.id]}):k.push(R)});let z=_.terrain;z&&T[z.source]&&(w.push({command:Ze.setTerrain,args:[void 0]}),z=void 0),w=w.concat(C),D(z,g.terrain)||w.push({command:Ze.setTerrain,args:[g.terrain]}),function(R,j,K){j=j||[];const Z=(R=R||[]).map(Kn),W=j.map(Kn),X=R.reduce(gl,{}),G=j.reduce(gl,{}),te=Z.slice(),Y=Object.create(null);let pe,he,oe,fe,le,ve,Be;for(pe=0,he=0;pe<Z.length;pe++)oe=Z[pe],G.hasOwnProperty(oe)?he++:(K.push({command:Ze.removeLayer,args:[oe]}),te.splice(te.indexOf(oe,he),1));for(pe=0,he=0;pe<W.length;pe++)oe=W[W.length-1-pe],te[te.length-1-pe]!==oe&&(X.hasOwnProperty(oe)?(K.push({command:Ze.removeLayer,args:[oe]}),te.splice(te.lastIndexOf(oe,te.length-he),1)):he++,ve=te[te.length-pe],K.push({command:Ze.addLayer,args:[G[oe],ve]}),te.splice(te.length-pe,0,oe),Y[oe]=!0);for(pe=0;pe<W.length;pe++)if(oe=W[pe],fe=X[oe],le=G[oe],!Y[oe]&&!D(fe,le))if(D(fe.source,le.source)&&D(fe["source-layer"],le["source-layer"])&&D(fe.type,le.type)){for(Be in Mn(fe.layout,le.layout,K,oe,null,Ze.setLayoutProperty),Mn(fe.paint,le.paint,K,oe,null,Ze.setPaintProperty),D(fe.filter,le.filter)||K.push({command:Ze.setFilter,args:[oe,le.filter]}),D(fe.minzoom,le.minzoom)&&D(fe.maxzoom,le.maxzoom)||K.push({command:Ze.setLayerZoomRange,args:[oe,le.minzoom,le.maxzoom]}),fe)fe.hasOwnProperty(Be)&&Be!=="layout"&&Be!=="paint"&&Be!=="filter"&&Be!=="metadata"&&Be!=="minzoom"&&Be!=="maxzoom"&&(Be.indexOf("paint.")===0?Mn(fe[Be],le[Be],K,oe,Be.slice(6),Ze.setPaintProperty):D(fe[Be],le[Be])||K.push({command:Ze.setLayerProperty,args:[oe,Be,le[Be]]}));for(Be in le)le.hasOwnProperty(Be)&&!fe.hasOwnProperty(Be)&&Be!=="layout"&&Be!=="paint"&&Be!=="filter"&&Be!=="metadata"&&Be!=="minzoom"&&Be!=="maxzoom"&&(Be.indexOf("paint.")===0?Mn(fe[Be],le[Be],K,oe,Be.slice(6),Ze.setPaintProperty):D(fe[Be],le[Be])||K.push({command:Ze.setLayerProperty,args:[oe,Be,le[Be]]}))}else K.push({command:Ze.removeLayer,args:[oe]}),ve=te[te.lastIndexOf(oe)+1],K.push({command:Ze.addLayer,args:[le,ve]})}(k,g.layers,w)}catch(T){console.warn("Unable to compute style diff:",T),w=[{command:Ze.setStyle,args:[g]}]}return w}(this.serialize(),n).filter(_=>!(_.command in Ap));if(a.length===0)return!1;const d=a.filter(_=>!(_.command in $h));if(d.length>0)throw new Error(`Unimplemented: ${d.map(_=>_.command).join(", ")}.`);return a.forEach(_=>{_.command!=="setTransition"&&_.command!=="setProjection"&&this[_.command].apply(this,_.args)}),this.stylesheet=n,this._updateMapProjection(),!0}addImage(n,a){return this.getImage(n)?this.fire(new s.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,a),this._afterImageUpdated(n),this)}updateImage(n,a){this.imageManager.updateImage(n,a)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n),this._afterImageUpdated(n),this):this.fire(new s.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(n,a,d={}){if(this._checkLoaded(),this.getSource(n)!==void 0)throw new Error("There is already a source with this ID");if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(s.validateSource,`sources.${n}`,a,null,d))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const _=ke(n,a,this.dispatcher,this);_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(n),source:_.serialize(),sourceId:n}));const g=w=>{const T=(w?"symbol:":"other:")+n,C=this._sourceCaches[T]=new s.SourceCache(T,_,w);(w?this._symbolSourceCaches:this._otherSourceCaches)[n]=C,C.style=this,C.onAdd(this.map)};g(!1),a.type!=="vector"&&a.type!=="geojson"||g(!0),_.onAdd&&_.onAdd(this.map),this._changed=!0}removeSource(n){this._checkLoaded();const a=this.getSource(n);if(!a)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===n)return this.fire(new s.ErrorEvent(new Error(`Source "${n}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.get().source===n)return this.fire(new s.ErrorEvent(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const d=this._getSourceCaches(n);for(const _ of d)delete this._sourceCaches[_.id],delete this._updatedSources[_.id],_.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles();return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(n,a){this._checkLoaded(),this.getSource(n).setData(a),this._changed=!0}getSource(n){const a=this._getSourceCache(n);return a&&a.getSource()}addLayer(n,a,d={}){this._checkLoaded();const _=n.id;if(this.getLayer(_))return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${_}" already exists on this map`)));let g;if(n.type==="custom"){if(Tl(this,s.validateCustomStyleLayer(n)))return;g=s.createStyleLayer(n)}else{if(typeof n.source=="object"&&(this.addSource(_,n.source),n=s.clone$1(n),n=s.extend(n,{source:_})),this._validate(s.validateLayer,`layers.${_}`,n,{arrayIndex:-1},d))return;g=s.createStyleLayer(n),this._validateLayer(g),g.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[g.id]=g.serialize(),this._updateLayerCount(g,!0)}const w=a?this._order.indexOf(a):this._order.length;if(a&&w===-1)return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${a}" does not exist on this map.`)));this._order.splice(w,0,_),this._layerOrderChanged=!0,this._layers[_]=g;const T=this._getLayerSourceCache(g);if(this._removedLayers[_]&&g.source&&T&&g.type!=="custom"){const C=this._removedLayers[_];delete this._removedLayers[_],C.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",T.pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(n,a){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===a)return;const d=this._order.indexOf(n);this._order.splice(d,1);const _=a?this._order.indexOf(a):this._order.length;a&&_===-1?this.fire(new s.ErrorEvent(new Error(`Layer with id "${a}" does not exist on this map.`))):(this._order.splice(_,0,n),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(n){this._checkLoaded();const a=this._layers[n];if(!a)return void this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be removed.`)));a.setEventedParent(null),this._updateLayerCount(a,!1);const d=this._order.indexOf(n);this._order.splice(d,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=a,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],a.onRemove&&a.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(n){return this._layers[n]}hasLayer(n){return n in this._layers}hasLayerType(n){for(const a in this._layers)if(this._layers[a].type===n)return!0;return!1}setLayerZoomRange(n,a,d){this._checkLoaded();const _=this.getLayer(n);_?_.minzoom===a&&_.maxzoom===d||(a!=null&&(_.minzoom=a),d!=null&&(_.maxzoom=d),this._updateLayer(_)):this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(n,a,d={}){this._checkLoaded();const _=this.getLayer(n);if(_){if(!D(_.filter,a))return a==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(s.validateFilter,`layers.${_.id}.filter`,a,{layerType:_.type},d)||(_.filter=s.clone$1(a),this._updateLayer(_)))}else this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be filtered.`)))}getFilter(n){const a=this.getLayer(n);return a&&s.clone$1(a.filter)}setLayoutProperty(n,a,d,_={}){this._checkLoaded();const g=this.getLayer(n);g?D(g.getLayoutProperty(a),d)||(g.setLayoutProperty(a,d,_),this._updateLayer(g)):this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(n,a){const d=this.getLayer(n);if(d)return d.getLayoutProperty(a);this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style.`)))}setPaintProperty(n,a,d,_={}){this._checkLoaded();const g=this.getLayer(n);g?D(g.getPaintProperty(a),d)||(g.setPaintProperty(a,d,_)&&this._updateLayer(g),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(n,a){const d=this.getLayer(n);return d&&d.getPaintProperty(a)}setFeatureState(n,a){this._checkLoaded();const d=n.source,_=n.sourceLayer,g=this.getSource(d);if(!g)return void this.fire(new s.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)));const w=g.type;if(w==="geojson"&&_)return void this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(w==="vector"&&!_)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided.")));const T=this._getSourceCaches(d);for(const C of T)C.setFeatureState(_,n.id,a)}removeFeatureState(n,a){this._checkLoaded();const d=n.source,_=this.getSource(d);if(!_)return void this.fire(new s.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)));const g=_.type,w=g==="vector"?n.sourceLayer:void 0;if(g==="vector"&&!w)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const T=this._getSourceCaches(d);for(const C of T)C.removeFeatureState(w,n.id,a)}getFeatureState(n){this._checkLoaded();const a=n.source,d=n.sourceLayer,_=this.getSource(a);if(_){if(_.type!=="vector"||d)return n.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(a)[0].getFeatureState(d,n.id);this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const n={};for(const a in this._sourceCaches){const d=this._sourceCaches[a].getSource();n[d.id]||(n[d.id]=d.serialize())}return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:n,layers:this._serializeLayers(this._order)},a=>a!==void 0)}_updateLayer(n){this._updatedLayers[n.id]=!0;const a=this._getLayerSourceCache(n);n.source&&!this._updatedSources[n.source]&&a&&a.getSource().type!=="raster"&&(this._updatedSources[n.source]="reload",a.pause()),this._changed=!0,n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const a=w=>this._layers[w].type==="fill-extrusion",d={},_=[];for(let w=this._order.length-1;w>=0;w--){const T=this._order[w];if(a(T)){d[T]=w;for(const C of n){const k=C[T];if(k)for(const z of k)_.push(z)}}}_.sort((w,T)=>T.intersectionZ-w.intersectionZ);const g=[];for(let w=this._order.length-1;w>=0;w--){const T=this._order[w];if(a(T))for(let C=_.length-1;C>=0;C--){const k=_[C].feature;if(d[k.layer.id]<w)break;g.push(k),_.pop()}else for(const C of n){const k=C[T];if(k)for(const z of k)g.push(z.feature)}}return g}queryRenderedFeatures(n,a,d){a&&a.filter&&this._validate(s.validateFilter,"queryRenderedFeatures.filter",a.filter,null,a);const _={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const C of a.layers){const k=this._layers[C];if(!k)return this.fire(new s.ErrorEvent(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];_[k.source]=!0}}const g=[];a.availableImages=this._availableImages;const w=a&&a.layers?a.layers.some(C=>{const k=this.getLayer(C);return k&&k.is3D()}):this.has3DLayers(),T=Ci.createFromScreenPoints(n,d);for(const C in this._sourceCaches){const k=this._sourceCaches[C].getSource().id;a.layers&&!_[k]||g.push(Ct(this._sourceCaches[C],this._layers,this._serializedLayers,T,a,d,w,!!this.map._showQueryGeometry))}return this.placement&&g.push(function(C,k,z,R,j,K,Z){const W={},X=K.queryRenderedSymbols(R),G=[];for(const te of Object.keys(X).map(Number))G.push(Z[te]);G.sort($t);for(const te of G){const Y=te.featureIndex.lookupSymbolFeatures(X[te.bucketInstanceId],k,te.bucketIndex,te.sourceLayerIndex,j.filter,j.layers,j.availableImages,C);for(const pe in Y){const he=W[pe]=W[pe]||[],oe=Y[pe];oe.sort((fe,le)=>{const ve=te.featureSortOrder;if(ve){const Be=ve.indexOf(fe.featureIndex);return ve.indexOf(le.featureIndex)-Be}return le.featureIndex-fe.featureIndex});for(const fe of oe)he.push(fe)}}for(const te in W)W[te].forEach(Y=>{const pe=Y.feature,he=z(C[te]).getFeatureState(pe.layer["source-layer"],pe.id);pe.source=pe.layer.source,pe.layer["source-layer"]&&(pe.sourceLayer=pe.layer["source-layer"]),pe.state=he});return W}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),T.screenGeometry,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(n,a){a&&a.filter&&this._validate(s.validateFilter,"querySourceFeatures.filter",a.filter,null,a);const d=this._getSourceCaches(n);let _=[];for(const g of d)_=_.concat(st(g,a));return _}addSourceType(n,a,d){return Cr.getSourceType(n)?d(new Error(`A source type called "${n}" already exists.`)):(Cr.setSourceType(n,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:a.workerSourceURL},d):d(null,null))}getLight(){return this.light.getLight()}setLight(n,a={}){this._checkLoaded();const d=this.light.getLight();let _=!1;for(const w in n)if(!D(n[w],d[w])){_=!0;break}if(!_)return;const g=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(n,a),this.light.updateTransitions(g)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,a=1){if(this._checkLoaded(),!n)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(a===1){if(typeof n.source=="object"){const d="terrain-dem-src";this.addSource(d,n.source),n=s.clone$1(n),n=s.extend(n,{source:d})}if(this._validate(s.validateTerrain,"terrain",n))return}if(!this.terrain||this.terrain&&a!==this.terrain.drapeRenderMode)this._createTerrain(n,a);else{const d=this.terrain,_=d.get();for(const g of Object.keys(s.spec.terrain))!n.hasOwnProperty(g)&&s.spec.terrain[g].default&&(n[g]=s.spec.terrain[g].default);for(const g in n)if(!D(n[g],_[g])){d.set(n),this.stylesheet.terrain=n;const w=this._setTransitionParameters({duration:0});d.updateTransitions(w);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const a=this.fog=new xt(n,this.map.transform);this.stylesheet.fog=n;const d=this._setTransitionParameters({duration:0});a.updateTransitions(d)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog,d=a.get();Object.keys(n).length===0&&a.set(n);for(const _ in n)if(!D(n[_],d[_])){a.set(n),this.stylesheet.fog=n;const g=this._setTransitionParameters({duration:0});a.updateTransitions(g);break}}else this._createFog(n);this._markersNeedUpdate=!0}_setTransitionParameters(n){return{now:s.exported.now(),transition:s.extend(n,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const n=this._order.filter(d=>this.isLayerDraped(this._layers[d])),a=this._order.filter(d=>!this.isLayerDraped(this._layers[d]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...a)}_createTerrain(n,a){const d=this.terrain=new ot(n,a);this.stylesheet.terrain=n,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const _=this._setTransitionParameters({duration:0});d.updateTransitions(_)}_force3DLayerUpdate(){for(const n in this._layers){const a=this._layers[n];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const a=this._layers[n];a.type==="symbol"&&this._updateLayer(a)}}_validate(n,a,d,_,g={}){return(!g||g.validate!==!1)&&Tl(this,n.call(s.validateStyle,s.extend({key:a,style:this.serialize(),value:d,styleSpec:s.spec},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this._sourceCaches)this._sourceCaches[n].clearTiles(),this._sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(n){const a=this._getSourceCaches(n);for(const d of a)d.clearTiles()}_reloadSource(n){const a=this._getSourceCaches(n);for(const d of a)d.resume(),d.reload()}_updateSources(n){for(const a in this._sourceCaches)this._sourceCaches[a].update(n)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const a=this._sourceCaches[n];a.resume(),a.reload()}}_updatePlacement(n,a,d,_,g=!1){let w=!1,T=!1;const C={};for(const k of this._order){const z=this._layers[k];if(z.type!=="symbol")continue;if(!C[z.source]){const j=this._getLayerSourceCache(z);if(!j)continue;C[z.source]=j.getRenderableIds(!0).map(K=>j.getTileByID(K)).sort((K,Z)=>Z.tileID.overscaledZ-K.tileID.overscaledZ||(K.tileID.isLessThan(Z.tileID)?-1:1))}const R=this.crossTileSymbolIndex.addLayer(z,C[z.source],n.center.lng,n.projection);w=w||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),g=g||this._layerOrderChanged||d===0,this._layerOrderChanged&&this.fire(new s.Event("neworder")),(g||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.exported.now(),n.zoom))&&(this.pauseablePlacement=new Mo(n,this._order,g,a,d,_,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,C),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.exported.now()),T=!0),w&&this.pauseablePlacement.placement.setStale()),T||w)for(const k of this._order){const z=this._layers[k];z.type==="symbol"&&this.placement.updateLayerOpacities(z,C[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.exported.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,a,d){this.imageManager.getImages(a.icons,d),this._updateTilesForChangedImages();const _=g=>{g&&g.setDependencies(a.tileID.key,a.type,a.icons)};_(this._otherSourceCaches[a.source]),_(this._symbolSourceCaches[a.source])}getGlyphs(n,a,d){this.glyphManager.getGlyphs(a.stacks,d)}getResource(n,a,d){return s.makeRequest(a,d)}_getSourceCache(n){return this._otherSourceCaches[n]}_getLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}_getSourceCaches(n){const a=[];return this._otherSourceCaches[n]&&a.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&a.push(this._symbolSourceCaches[n]),a}_isSourceCacheLoaded(n){const a=this._getSourceCaches(n);return a.length===0?(this.fire(new s.ErrorEvent(new Error(`There is no source with ID '${n}'`))),!1):a.every(d=>d.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Cr.getSourceType=function(c){return ge[c]},Cr.setSourceType=function(c,n){ge[c]=n},Cr.registerForPluginStateChange=s.registerForPluginStateChange;var Gc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Zc="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Wc=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Hc=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Cs=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let El={},Ko={};const Io=[];Yo(Gc,Io),Yo(Wc,Io),Yo(Hc,Io),Yo(Cs,Io),El=Di("",Wc),Ko=Di(Cs,Hc);const ba=Di(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Sl=Gc,Cl=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var Al={background:Di(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Di(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Di(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);
#else 
mat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Di("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Di(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Di(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Di("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Di("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Di("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Di(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Di(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Di(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Di(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Di(`uniform lowp vec3 u_lightpos;varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
void main() {vec4 color=v_color;
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color_normal(color.xyz,normalize(v_normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying highp vec3 v_normal;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;vec3 pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_normal=normal;v_depth=gl_Position.w;
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Di(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Di(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Di(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Di(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
highp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);
#else
vec4 out_color=color;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Di(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Di(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Di(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
vec4 offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Di(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
vec4 offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Di(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Di(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Di(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Di(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Zc),skyboxGradient:Di(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Zc),skyboxCapture:Di(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Di(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);vec4 color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
vec4 color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;
#ifdef GLOBE_POLES
vec3 up_vector=normalize(globe_pos)*u_tile_up_scale;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Di(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);
#ifdef PROJECTION_GLOBE_VIEW
float globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));float horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
float horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Yo(c,n){const a=c.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let d of a)if(d=d.trim(),d[0]==="#"&&d.includes("if")&&!d.includes("endif")){d=d.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const _=d.split(" ");for(const g of _)n.includes(g)||n.push(g)}}function Di(c,n){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=n.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),_={},g=[...Io];return Yo(c,g),Yo(n,g),{fragmentSource:c=c.replace(a,(w,T,C,k,z)=>(_[z]=!0,T==="define"?`
#ifndef HAS_UNIFORM_u_${z}
varying ${C} ${k} ${z};
#else
uniform ${C} ${k} u_${z};
#endif
`:`
#ifdef HAS_UNIFORM_u_${z}
    ${C} ${k} ${z} = u_${z};
#endif
`)),vertexSource:n=n.replace(a,(w,T,C,k,z)=>{const R=k==="float"?"vec2":"vec4",j=z.match(/color/)?"color":R;return _[z]?T==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
attribute ${C} ${R} a_${z};
varying ${C} ${k} ${z};
#else
uniform ${C} ${k} u_${z};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = a_${z};
#else
    ${C} ${k} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = unpack_mix_${j}(a_${z}, u_${z}_t);
#else
    ${C} ${k} ${z} = u_${z};
#endif
`:T==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
attribute ${C} ${R} a_${z};
#else
uniform ${C} ${k} u_${z};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${C} ${k} ${z} = a_${z};
#else
    ${C} ${k} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${C} ${k} ${z} = unpack_mix_${j}(a_${z}, u_${z}_t);
#else
    ${C} ${k} ${z} = u_${z};
#endif
`}),staticAttributes:d,usedDefines:g}}class Ml{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,a,d,_,g,w,T){this.context=n;let C=this.boundPaintVertexBuffers.length!==_.length;for(let z=0;!C&&z<_.length;z++)this.boundPaintVertexBuffers[z]!==_[z]&&(C=!0);let k=this.boundDynamicVertexBuffers.length!==T.length;for(let z=0;!k&&z<T.length;z++)this.boundDynamicVertexBuffers[z]!==T[z]&&(k=!0);if(!n.extVertexArrayObject||!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==d||C||k||this.boundIndexBuffer!==g||this.boundVertexOffset!==w)this.freshBind(a,d,_,g,w,T);else{n.bindVertexArrayOES.set(this.vao);for(const z of T)z&&z.bind();g&&g.dynamicDraw&&g.bind()}}freshBind(n,a,d,_,g,w){let T;const C=n.numAttributes,k=this.context,z=k.gl;if(k.extVertexArrayObject)this.vao&&this.destroy(),this.vao=k.extVertexArrayObject.createVertexArrayOES(),k.bindVertexArrayOES.set(this.vao),T=0,this.boundProgram=n,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=_,this.boundVertexOffset=g,this.boundDynamicVertexBuffers=w;else{T=k.currentNumAttributes||0;for(let R=C;R<T;R++)z.disableVertexAttribArray(R)}a.enableAttributes(z,n),a.bind(),a.setVertexAttribPointers(z,n,g);for(const R of d)R.enableAttributes(z,n),R.bind(),R.setVertexAttribPointers(z,n,g);for(const R of w)R&&(R.enableAttributes(z,n),R.bind(),R.setVertexAttribPointers(z,n,g));_&&_.bind(),k.currentNumAttributes=C}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Xc(c,n){const a=Math.pow(2,n.canonical.z),d=n.canonical.y;return[new s.MercatorCoordinate(0,d/a).toLngLat().lat,new s.MercatorCoordinate(0,(d+1)/a).toLngLat().lat]}function Kc(c,n,a,d,_,g,w){const T=c.context,C=T.gl,k=a.fbo;if(!k)return;c.prepareDrawTile();const z=c.useProgram("hillshade");T.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,k.colorAttachment.get());const R=((W,X,G,te)=>{const Y=G.paint.get("hillshade-shadow-color"),pe=G.paint.get("hillshade-highlight-color"),he=G.paint.get("hillshade-accent-color");let oe=G.paint.get("hillshade-illumination-direction")*(Math.PI/180);G.paint.get("hillshade-illumination-anchor")==="viewport"&&(oe-=W.transform.angle);const fe=!W.options.moving;return{u_matrix:te||W.transform.calculateProjMatrix(X.tileID.toUnwrapped(),fe),u_image:0,u_latrange:Xc(0,X.tileID),u_light:[G.paint.get("hillshade-exaggeration"),oe],u_shadow:Y,u_highlight:pe,u_accent:he}})(c,a,d,c.terrain?n.projMatrix:null);c.prepareDrawProgram(T,z,n.toUnwrapped());const{tileBoundsBuffer:j,tileBoundsIndexBuffer:K,tileBoundsSegments:Z}=c.getTileBoundsBuffers(a);z.draw(T,C.TRIANGLES,_,g,w,s.CullFaceMode.disabled,R,d.id,j,K,Z)}function Mi(c,n,a){if(!n.needsDEMTextureUpload)return;const d=c.context,_=d.gl;d.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||c.getTileTexture(a.stride);const g=a.getPixels();n.demTexture?n.demTexture.update(g,{premultiply:!1}):n.demTexture=new s.Texture(d,g,_.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function As(c,n,a,d,_,g){const w=c.context,T=w.gl;if(!n.dem)return;const C=n.dem;if(w.activeTexture.set(T.TEXTURE1),Mi(c,n,C),!n.demTexture)return;n.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE);const k=C.dim;w.activeTexture.set(T.TEXTURE0);let z=n.fbo;if(!z){const Z=new s.Texture(w,{width:k,height:k,data:null},T.RGBA);Z.bind(T.LINEAR,T.CLAMP_TO_EDGE),z=n.fbo=w.createFramebuffer(k,k,!0),z.colorAttachment.set(Z.texture)}w.bindFramebuffer.set(z.framebuffer),w.viewport.set([0,0,k,k]);const{tileBoundsBuffer:R,tileBoundsIndexBuffer:j,tileBoundsSegments:K}=c.getMercatorTileBoundsBuffers();c.useProgram("hillshadePrepare").draw(w,T.TRIANGLES,d,_,g,s.CullFaceMode.disabled,((Z,W)=>{const X=W.stride,G=s.create();return s.ortho(G,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate(G,G,[0,-s.EXTENT,0]),{u_matrix:G,u_image:1,u_dimension:[X,X],u_zoom:Z.overscaledZ,u_unpack:W.unpackVector}})(n.tileID,C),a.id,R,j,K),n.needsHillshadePrepare=!1}const wa=c=>({u_matrix:new s.UniformMatrix4f(c),u_image0:new s.Uniform1i(c),u_skirt_height:new s.Uniform1f(c)}),Yc=(c,n)=>({u_matrix:c,u_image0:0,u_skirt_height:n}),Jc=(c,n,a,d,_,g,w,T,C,k,z,R,j,K)=>({u_proj_matrix:Float32Array.from(c),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(d),u_merc_matrix:a,u_zoom_transition:_,u_merc_center:g,u_image0:0,u_frustum_tl:w,u_frustum_tr:T,u_frustum_br:C,u_frustum_bl:k,u_globe_pos:z,u_globe_radius:R,u_viewport:j,u_grid_matrix:K?Float32Array.from(K):new Float32Array(9)});function Qc(c,n){return c!=null&&n!=null&&!(!c.hasData()||!n.hasData())&&c.demTexture!=null&&n.demTexture!=null&&c.tileID.key!==n.tileID.key}const ko=new class{constructor(){this.operations={}}newMorphing(c,n,a,d,_){if(c in this.operations){const g=this.operations[c];g.to.tileID.key!==a.tileID.key&&(g.queued=a)}else this.operations[c]={startTime:d,phase:0,duration:_,from:n,to:a,queued:null}}getMorphValuesForProxy(c){if(!(c in this.operations))return null;const n=this.operations[c];return{from:n.from,to:n.to,phase:n.phase}}update(c){for(const n in this.operations){const a=this.operations[n];for(a.phase=(c-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,c)){delete this.operations[n];break}}}_nextOp(c,n){return!!c.queued&&(c.from=c.to,c.to=c.queued,c.queued=null,c.phase=0,c.startTime=n,!0)}_validOp(c){return c.from.hasData()&&c.to.hasData()}},Ta={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Ip(c,n){const a=1<<c.z;return!n&&(c.x===0||c.x===a-1)||c.y===0||c.y===a-1}const eu=c=>({u_matrix:c});function Il(c,n,a,d,_){if(_>0){const g=s.exported.now(),w=(g-c.timeAdded)/_,T=n?(g-n.timeAdded)/_:-1,C=a.getSource(),k=d.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),z=!n||Math.abs(n.tileID.overscaledZ-k)>Math.abs(c.tileID.overscaledZ-k),R=z&&c.refreshedUponExpiration?1:s.clamp(z?w:1-T,0,1);return c.refreshedUponExpiration&&w>=1&&(c.refreshedUponExpiration=!1),n?{opacity:1,mix:1-R}:{opacity:R,mix:0}}return{opacity:1,mix:0}}class tu extends s.SourceCache{constructor(n){const a={type:"raster-dem",maxzoom:n.transform.maxZoom},d=new Lt(Pi(),null),_=ke("mock-dem",a,d,n.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,a){n.state="loaded",a(null)}}class iu extends s.SourceCache{constructor(n){const a=ke("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new Lt(Pi(),null),n.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,a,d){if(n.freezeTileCoverage)return;this.transform=n;const _=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((g,w)=>{if(g[w.key]="",!this._tiles[w.key]){const T=new s.Tile(w,this._source.tileSize*w.overscaleFactor(),n.tileZoom);T.state="loaded",this._tiles[w.key]=T}return g},{});for(const g in this._tiles)g in _||(this.freeFBO(g),this._tiles[g].unloadVectorData(),delete this._tiles[g])}freeFBO(n){const a=this.proxyCachedFBO[n];if(a!==void 0){const d=Object.values(a);this.renderCachePool.push(...d),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class kl extends s.OverscaledTileID{constructor(n,a,d){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=a,this.projMatrix=d}}class Zh extends s.Elevation{constructor(n,a){super(),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[d,_,g]=function(C){const k=new s.StructArrayLayout4i8,z=new s.StructArrayLayout3ui6,R=131;k.reserve(17161),z.reserve(33800);const j=s.EXTENT/128,K=s.EXTENT+j/2,Z=K+j;for(let X=-j;X<Z;X+=j)for(let G=-j;G<Z;G+=j){const te=G<0||G>K||X<0||X>K?24575:0,Y=s.clamp(Math.round(G),0,s.EXTENT),pe=s.clamp(Math.round(X),0,s.EXTENT);k.emplaceBack(Y+te,pe,Y,pe)}const W=(X,G)=>{const te=G*R+X;z.emplaceBack(te+1,te,te+R),z.emplaceBack(te+R,te+R+1,te+1)};for(let X=1;X<129;X++)for(let G=1;G<129;G++)W(G,X);return[0,129].forEach(X=>{for(let G=0;G<130;G++)W(G,X),W(X,G)}),[k,z,32768]}(),w=n.context;this.gridBuffer=w.createVertexBuffer(d,s.boundsAttributes.members),this.gridIndexBuffer=w.createIndexBuffer(_),this.gridSegments=s.SegmentVector.simpleSegment(0,0,d.length,_.length),this.gridNoSkirtSegments=s.SegmentVector.simpleSegment(0,0,d.length,g),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new iu(a.map),this.orthoMatrix=s.create(),s.ortho(this.orthoMatrix,0,s.EXTENT,0,s.EXTENT,0,1);const T=w.gl;this._overlapStencilMode=new s.StencilMode({func:T.GEQUAL,mask:255},0,255,T.KEEP,T.KEEP,T.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new tu(a.map)}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),n.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=n,this._checkRenderCacheEfficiency()}update(n,a,d){if(n&&n.terrain){this._style!==n&&(this.style=n),this.enabled=!0;const _=n.terrain.properties;this.sourceCache=n.terrain.drapeRenderMode===0?this._mockSourceCache:n._getSourceCache(_.get("source")),this._exaggeration=_.get("exaggeration");const g=()=>{this.sourceCache.used&&s.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const w=this.getScaledDemTileSize();this.sourceCache.update(a,w,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,g(),this._initializing=!0),g(),a.updateElevation(!d),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const n=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||n.efficiency!==100&&s.warnOnce(`Terrain render cache efficiency is not optimal (${n.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${n.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._sourceCaches)this._style._sourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,d=this.painter.transform;this._initializing&&(this._initializing=d._centerAltitude===0&&this.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(d.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=a.getIds().map(C=>{const k=a.getTileByID(C).tileID;return k.projMatrix=d.calculateProjMatrix(k.toUnwrapped()),k});(function(C,k){const z=k.transform.pointCoordinate(k.transform.getCameraPoint()),R=new s.pointGeometry(z.x,z.y);C.sort((j,K)=>{if(K.overscaledZ-j.overscaledZ)return K.overscaledZ-j.overscaledZ;const Z=new s.pointGeometry(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),W=new s.pointGeometry(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),X=R.mult(1<<j.canonical.z);return X.x-=.5,X.y-=.5,X.distSqr(Z)-X.distSqr(W)})})(_,this.painter),this._previousZoom=d.zoom;const g=this.proxyToSource||{};this.proxyToSource={},_.forEach(C=>{this.proxyToSource[C.key]={}}),this.terrainTileForTile={};const w=this._style._sourceCaches;for(const C in w){const k=w[C];if(!k.used||(k!==this.sourceCache&&this.resetTileLookupCache(k.id),this._setupProxiedCoordsForOrtho(k,n[C],g),k.usedForTerrain))continue;const z=n[C];k.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[a.id]=_.map(C=>new kl(C,C.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(g),this.renderingToTexture=!1,this._updateTimestamp=s.exported.now();const T={};this._visibleDemTiles=[];for(const C of this.proxyCoords){const k=this.terrainTileForTile[C.key];if(!k)continue;const z=k.tileID.key;z in T||(this._visibleDemTiles.push(k),T[z]=z)}}_assignTerrainTiles(n){this._initializing||n.forEach(a=>{if(this.terrainTileForTile[a.key])return;const d=this._findTileCoveringTileID(a,this.sourceCache);d&&(this.terrainTileForTile[a.key]=d)})}_prepareDEMTextures(){const n=this.painter.context,a=n.gl;for(const d in this.terrainTileForTile){const _=this.terrainTileForTile[d],g=_.dem;!g||_.demTexture&&!_.needsDEMTextureUpload||(n.activeTexture.set(a.TEXTURE1),Mi(this.painter,_,g))}}_prepareDemTileUniforms(n,a,d,_){if(!a||a.demTexture==null)return!1;const g=n.tileID.canonical,w=Math.pow(2,a.tileID.canonical.z-g.z),T=_||"";return d[`u_dem_tl${T}`]=[g.x*w%1,g.y*w%1],d[`u_dem_scale${T}`]=w,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,a=n.gl;if(!this._emptyDepthBufferTexture){const d=new s.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new s.Texture(n,d,a.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0;const a=this._visibleDemTiles.reduce((d,_)=>{if(!_.dem)return d;const g=_.dem.tree.minimums[0];return g>0&&n++,d+g},0);return n?a/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,a=n.gl;n.activeTexture.set(a.TEXTURE2);const d=this._getLoadedAreaMinimum(),_=new s.RGBAImage({width:1,height:1},new Uint8Array(s.DEMData.pack(d,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let g=this._emptyDEMTexture;return g?g.update(_,{premultiply:!1}):g=this._emptyDEMTexture=new s.Texture(n,_,a.RGBA,{premultiply:!1}),g}setupElevationDraw(n,a,d){const _=this.painter.context,g=_.gl,w=(T=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:s.DEMData.getUnpackVector(T),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var T;w.u_dem_size=this.sourceCache.getSource().tileSize,w.u_exaggeration=this.exaggeration();const C=this.painter.transform,k=C.projection,z=n.tileID.canonical;w.u_tile_tl_up=k.upVector(z,0,0),w.u_tile_tr_up=k.upVector(z,s.EXTENT,0),w.u_tile_br_up=k.upVector(z,s.EXTENT,s.EXTENT),w.u_tile_bl_up=k.upVector(z,0,s.EXTENT),w.u_tile_up_scale=d&&d.useDenormalizedUpVectorScale?s.GLOBE_METERS_TO_ECEF:k.upVectorScale(z,C.center.lat,C.worldSize).metersToTile;let R=null,j=null,K=1;if(d&&d.morphing&&this._useVertexMorphing){const Z=d.morphing.srcDemTile,W=d.morphing.dstDemTile;K=d.morphing.phase,Z&&W&&(this._prepareDemTileUniforms(n,Z,w,"_prev")&&(j=Z),this._prepareDemTileUniforms(n,W,w)&&(R=W))}if(j&&R?(_.activeTexture.set(g.TEXTURE2),R.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE,g.NEAREST),_.activeTexture.set(g.TEXTURE4),j.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE,g.NEAREST),w.u_dem_lerp=K):(R=this.terrainTileForTile[n.tileID.key],_.activeTexture.set(g.TEXTURE2),(this._prepareDemTileUniforms(n,R,w)?R.demTexture:this.emptyDEMTexture).bind(g.NEAREST,g.CLAMP_TO_EDGE)),_.activeTexture.set(g.TEXTURE3),d&&d.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),this._depthFBO&&(w.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),w.u_depth_size_inv=[1,1]),d&&d.useMeterToDem&&R){const Z=(1<<R.tileID.canonical.z)*s.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;w.u_meter_to_dem=Z}d&&d.labelPlaneMatrixInv&&(w.u_label_plane_matrix_inv=d.labelPlaneMatrixInv),a.setTerrainUniformValues(_,w)}renderToBackBuffer(n){const a=this.painter,d=this.painter.context;n.length!==0&&(d.bindFramebuffer.set(null),d.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,g,w,T,C){if(_.transform.projection.name==="globe")(function(k,z,R,j,K){const Z=k.context,W=Z.gl;let X,G;const te=k.options.showTerrainWireframe?2:0,Y=k.transform,pe=s.globeUseCustomAntiAliasing(k,Z,Y),he=(wt,qe)=>{if(G===wt)return;const mt=[Ta[wt],"PROJECTION_GLOBE_VIEW"];pe&&mt.push("CUSTOM_ANTIALIASING"),qe&&mt.push(Ta[te]),X=k.useProgram("globeRaster",null,mt),G=wt},oe=k.colorModeForRenderPass(),fe=new s.DepthMode(W.LEQUAL,s.DepthMode.ReadWrite,k.depthRangeFor3D);ko.update(K);const le=s.calculateGlobeMercatorMatrix(Y),ve=[s.mercatorXfromLng(Y.center.lng),s.mercatorYfromLat(Y.center.lat)],Be=te?[!1,!0]:[!1],dt=k.globeSharedBuffers,Ae=[Y.width*s.exported.devicePixelRatio,Y.height*s.exported.devicePixelRatio],Je=Float32Array.from(Y.globeMatrix),rt={useDenormalizedUpVectorScale:!0};if(Be.forEach(wt=>{G=-1;const qe=wt?W.LINES:W.TRIANGLES;for(const mt of j){const it=R.getTile(mt),It=s.StencilMode.disabled,St=z.prevTerrainTileForTile[mt.key],Vt=z.terrainTileForTile[mt.key];Qc(St,Vt)&&ko.newMorphing(mt.key,St,Vt,K,250),Z.activeTexture.set(W.TEXTURE0),it.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);const Wt=ko.getMorphValuesForProxy(mt.key),ii=Wt?1:0;Wt&&s.extend$1(rt,{morphing:{srcDemTile:Wt.from,dstDemTile:Wt.to,phase:s.easeCubicInOut(Wt.phase)}});const xi=s.tileCornersToBounds(mt.canonical),Ut=s.getLatitudinalLod(xi.getCenter().lat),ai=s.getGridMatrix(mt.canonical,xi,Ut),Ii=s.globeNormalizeECEF(s.globeTileBounds(mt.canonical)),Qi=Jc(Y.projMatrix,Je,le,Ii,s.globeToMercatorTransition(Y.zoom),ve,Y.frustumCorners.TL,Y.frustumCorners.TR,Y.frustumCorners.BR,Y.frustumCorners.BL,Y.globeCenterInViewSpace,Y.globeRadius,Ae,ai);if(he(ii,wt),z.setupElevationDraw(it,X,rt),k.prepareDrawProgram(Z,X,mt.toUnwrapped()),dt){const[dn,ji,Fn]=wt?dt.getWirefameBuffers(k.context,Ut):dt.getGridBuffers(Ut);X.draw(Z,qe,fe,It,oe,s.CullFaceMode.backCCW,Qi,"globe_raster",dn,ji,Fn)}}}),dt){const wt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];pe&&wt.push("CUSTOM_ANTIALIASING"),X=k.useProgram("globeRaster",null,wt);for(const qe of j){const{x:mt,y:it,z:It}=qe.canonical,St=it===0,Vt=it===(1<<It)-1,[Wt,ii,xi,Ut]=dt.getPoleBuffers(It);if(Ut&&(St||Vt)){const ai=R.getTile(qe);Z.activeTexture.set(W.TEXTURE0),ai.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);let Ii=s.globePoleMatrixForTile(It,mt,Y);const Qi=s.globeNormalizeECEF(s.globeTileBounds(qe.canonical)),dn=(ji,Fn)=>ji.draw(Z,W.TRIANGLES,fe,s.StencilMode.disabled,oe,s.CullFaceMode.disabled,Jc(Y.projMatrix,Ii,Ii,Qi,0,ve,Y.frustumCorners.TL,Y.frustumCorners.TR,Y.frustumCorners.BR,Y.frustumCorners.BL,Y.globeCenterInViewSpace,Y.globeRadius,Ae),"globe_pole_raster",Fn,xi,Ut);z.setupElevationDraw(ai,X,rt),k.prepareDrawProgram(Z,X,qe.toUnwrapped()),St&&dn(X,Wt),Vt&&(Ii=s.scale(s.create(),Ii,[1,-1,1]),dn(X,ii))}}}})(_,g,w,T,C);else{const k=_.context,z=k.gl;let R,j;const K=_.options.showTerrainWireframe?2:0,Z=(Y,pe)=>{if(j===Y)return;const he=[Ta[Y]];pe&&he.push(Ta[K]),R=_.useProgram("terrainRaster",null,he),j=Y},W=_.colorModeForRenderPass(),X=new s.DepthMode(z.LEQUAL,s.DepthMode.ReadWrite,_.depthRangeFor3D);ko.update(C);const G=_.transform,te=6*Math.pow(1.5,22-G.zoom)*g.exaggeration();(K?[!1,!0]:[!1]).forEach(Y=>{j=-1;const pe=Y?z.LINES:z.TRIANGLES,[he,oe]=Y?g.getWirefameBuffer():[g.gridIndexBuffer,g.gridSegments];for(const fe of T){const le=w.getTile(fe),ve=s.StencilMode.disabled,Be=g.prevTerrainTileForTile[fe.key],dt=g.terrainTileForTile[fe.key];Qc(Be,dt)&&ko.newMorphing(fe.key,Be,dt,C,250),k.activeTexture.set(z.TEXTURE0),le.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST);const Ae=ko.getMorphValuesForProxy(fe.key),Je=Ae?1:0;let rt;Ae&&(rt={morphing:{srcDemTile:Ae.from,dstDemTile:Ae.to,phase:s.easeCubicInOut(Ae.phase)}});const wt=Yc(fe.projMatrix,Ip(fe.canonical,G.renderWorldCopies)?te/10:te);Z(Je,Y),g.setupElevationDraw(le,R,rt),_.prepareDrawProgram(k,R,fe.toUnwrapped()),R.draw(k,pe,X,ve,W,s.CullFaceMode.backCCW,wt,"terrain_raster",g.gridBuffer,he,oe)}})}}(a,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const a=this.painter,d=this.painter.context,_=this.proxySourceCache,g=this.proxiedCoords[_.id],w=this._drapedRenderBatches.shift(),T=[],C=a.style.order;let k=0;for(const z of g){const R=_.getTileByID(z.proxyTileKey),j=_.proxyCachedFBO[z.key]?_.proxyCachedFBO[z.key][n]:void 0,K=j!==void 0?_.renderCache[j]:this.pool[k++],Z=j!==void 0;if(R.texture=K.tex,Z&&!K.dirty){T.push(R.tileID);continue}let W;d.bindFramebuffer.set(K.fb.framebuffer),this.renderedToTile=!1,K.dirty&&(d.clear({color:s.Color.transparent,stencil:0}),K.dirty=!1);for(let X=w.start;X<=w.end;++X){const G=a.style._layers[C[X]];if(G.isHidden(a.transform.zoom))continue;const te=a.style._getLayerSourceCache(G),Y=te?this.proxyToSource[z.key][te.id]:[z];if(!Y)continue;const pe=Y;d.viewport.set([0,0,K.fb.width,K.fb.height]),W!==(te?te.id:null)&&(this._setupStencil(K,Y,G,te),W=te?te.id:null),a.renderLayer(a,te,G,pe)}this.renderedToTile?(K.dirty=!0,T.push(R.tileID)):Z||--k,k===5&&(k=0,this.renderToBackBuffer(T))}return this.renderToBackBuffer(T),this.renderingToTexture=!1,d.bindFramebuffer.set(null),d.viewport.set([0,0,a.width,a.height]),w.end+1}postRender(){}renderCacheEfficiency(n){const a=n.order.length;if(a===0)return{efficiency:100};let d,_=0,g=0,w=!1;for(let T=0;T<a;++T){const C=n._layers[n.order[T]];this._style.isLayerDraped(C)?(w&&++_,++g):w||(w=!0,d=C.id)}return g===0?{efficiency:100}:{efficiency:100*(1-_/g),firstUndrapedLayer:d}}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{n=Math.min(n,a.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,a,d){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(g=>g.dem).map(g=>{const w=g.tileID,T=1<<w.overscaledZ,{x:C,y:k}=w.canonical,z=C/T,R=(C+1)/T,j=k/T,K=(k+1)/T;return{minx:z,miny:j,maxx:R,maxy:K,t:g.dem.tree.raycastRoot(z,j,R,K,n,a,d),tile:g}});_.sort((g,w)=>(g.t!==null?g.t:Number.MAX_VALUE)-(w.t!==null?w.t:Number.MAX_VALUE));for(const g of _){if(g.t==null)return null;const w=g.tile.dem.tree.raycast(g.minx,g.miny,g.maxx,g.maxy,n,a,d);if(w!=null)return w}return null}_createFBO(){const n=this.painter.context,a=n.gl,d=this.drapeBufferSize;n.activeTexture.set(a.TEXTURE0);const _=new s.Texture(n,{width:d[0],height:d[1],data:null},a.RGBA);_.bind(a.LINEAR,a.CLAMP_TO_EDGE);const g=n.createFramebuffer(d[0],d[1],!1);return g.colorAttachment.set(_.texture),g.depthAttachment=new B(n,g.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,d[0],d[1]),this._stencilRef=0,g.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):g.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&!n.extTextureFilterAnisotropicForceOff&&a.texParameterf(a.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:g,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const n in this._style._sourceCaches)if(this._style._sourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const a=this._style._layers[n],d=a.isHidden(this.painter.transform.zoom),_=a.getCrossfadeParameters(),g=!!_&&_.t!==1,w=a.hasTransition();return a.type!=="custom"&&!d&&(g||w)})}_clearRasterFadeFromRenderCache(){let n=!1;for(const a in this._style._sourceCaches)if(this._style._sourceCaches[a]._source instanceof ne){n=!0;break}if(n)for(let a=0;a<this._style.order.length;++a){const d=this._style._layers[this._style.order[a]],_=d.isHidden(this.painter.transform.zoom),g=this._style._getLayerSourceCache(d);if(d.type!=="raster"||_||!g)continue;const w=d.paint.get("raster-fade-duration");for(const T of this.proxyCoords){const C=this.proxyToSource[T.key][g.id];if(C)for(const k of C){const z=Il(g.getTile(k),g.findLoadedParent(k,0),g,this.painter.transform,w);(z.opacity!==1||z.mix!==0)&&this._clearRenderCacheForTile(g.id,k)}}}}_setupDrapedRenderBatches(){const n=this._style.order,a=n.length;if(a===0)return;const d=[];let _,g=0,w=this._style._layers[n[g]];for(;!this._style.isLayerDraped(w)&&w.isHidden(this.painter.transform.zoom)&&++g<a;)w=this._style._layers[n[g]];for(;g<a;++g){const T=this._style._layers[n[g]];T.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(T)?_===void 0&&(_=g):_!==void 0&&(d.push({start:_,end:g-1}),_=void 0))}_!==void 0&&d.push({start:_,end:g-1}),this._drapedRenderBatches=d}_setupRenderCache(n){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const w=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let T=0;T<w.length;++T){const C=Object.values(w[T]);a.renderCachePool.push(...C)}}return}this._clearRasterFadeFromRenderCache();const d=this.proxyCoords,_=this._tilesDirty;for(let w=d.length-1;w>=0;w--){const T=d[w];if(a.getTileByID(T.key),a.proxyCachedFBO[T.key]!==void 0){const C=n[T.key],k=this.proxyToSource[T.key];let z=0;for(const R in k){const j=k[R],K=C[R];if(!K||K.length!==j.length||j.some((Z,W)=>Z!==K[W]||_[R]&&_[R].hasOwnProperty(Z.key))){z=-1;break}++z}for(const R in a.proxyCachedFBO[T.key])a.renderCache[a.proxyCachedFBO[T.key][R]].dirty=z<0||z!==Object.values(C).length}}const g=[...this._drapedRenderBatches];g.sort((w,T)=>T.end-T.start-(w.end-w.start));for(const w of g)for(const T of d){if(a.proxyCachedFBO[T.key])continue;let C=a.renderCachePool.pop();C===void 0&&a.renderCache.length<50&&(C=a.renderCache.length,a.renderCache.push(this._createFBO())),C!==void 0&&(a.proxyCachedFBO[T.key]={},a.proxyCachedFBO[T.key][w.start]=C,a.renderCache[C].dirty=!0)}this._tilesDirty={}}_setupStencil(n,a,d,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const g=this.painter.context,w=g.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let T;if(d.isTileClipped())T=a.length,this._overlapStencilMode.test={func:w.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);T=1,this._overlapStencilMode.test={func:w.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+T>255&&(g.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=T,this._overlapStencilMode.ref=this._stencilRef,d.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):s.StencilMode.disabled}_renderTileClippingMasks(n,a){const d=this.painter,_=this.painter.context,g=_.gl;d._tileClippingMaskIDs={},_.setColorMode(s.ColorMode.disabled),_.setDepthMode(s.DepthMode.disabled);const w=d.useProgram("clippingMask");for(const T of n){const C=d._tileClippingMaskIDs[T.key]=--a;w.draw(_,g.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:g.ALWAYS,mask:0},C,255,g.KEEP,g.KEEP,g.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,eu(T.projMatrix),"$clipping",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}pointCoordinate(n){const a=this.painter.transform;if(n.x<0||n.x>a.width||n.y<0||n.y>a.height)return null;const d=[n.x,n.y,1,1];s.transformMat4$1(d,d,a.pixelMatrixInverse),s.scale$1(d,d,1/d[3]),d[0]/=a.worldSize,d[1]/=a.worldSize;const _=a._camera.position,g=s.mercatorZfromAltitude(1,a.center.lat),w=[_[0],_[1],_[2]/g,0],T=s.subtract([],d.slice(0,3),w);s.normalize(T,T);const C=this.raycast(w,T,this._exaggeration);return C!==null&&C?(s.scaleAndAdd(w,w,T,C),w[3]=w[2],w[2]*=g,w):null}drawDepth(){const n=this.painter,a=n.context,d=this.proxySourceCache,_=Math.ceil(n.width),g=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===_&&this._depthFBO.height===g||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const w=a.gl,T=a.createFramebuffer(_,g,!0);a.activeTexture.set(w.TEXTURE0);const C=new s.Texture(a,{width:_,height:g,data:null},w.RGBA);C.bind(w.NEAREST,w.CLAMP_TO_EDGE),T.colorAttachment.set(C.texture);const k=a.createRenderbuffer(a.gl.DEPTH_COMPONENT16,_,g);T.depthAttachment.set(k),this._depthFBO=T,this._depthTexture=C}a.bindFramebuffer.set(this._depthFBO.framebuffer),a.viewport.set([0,0,_,g]),function(w,T,C,k){if(w.transform.projection.name==="globe")return;const z=w.context,R=z.gl;z.clear({depth:1});const j=w.useProgram("terrainDepth"),K=new s.DepthMode(R.LESS,s.DepthMode.ReadWrite,w.depthRangeFor3D);for(const Z of k){const W=C.getTile(Z),X=Yc(Z.projMatrix,0);T.setupElevationDraw(W,j),j.draw(z,R.TRIANGLES,K,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.backCCW,X,"terrain_depth",T.gridBuffer,T.gridIndexBuffer,T.gridNoSkirtSegments)}}(n,this,d,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,a,d){if(n.getSource()instanceof Se)return this._setupProxiedCoordsForImageSource(n,a,d);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const _=this.proxiedCoords[n.id]=[],g=this.proxyCoords;for(let T=0;T<g.length;T++){const C=g[T],k=this._findTileCoveringTileID(C,n);if(k){const z=this._createProxiedId(C,k,d[C.key]&&d[C.key][n.id]);_.push(z),this.proxyToSource[C.key][n.id]=[z]}}let w=!1;for(let T=0;T<a.length;T++){const C=n.getTile(a[T]);if(!C||!C.hasData())continue;const k=this._findTileCoveringTileID(C.tileID,this.proxySourceCache);if(k&&k.tileID.canonical.z!==C.tileID.canonical.z){const z=this.proxyToSource[k.tileID.key][n.id],R=this._createProxiedId(k.tileID,C,d[k.tileID.key]&&d[k.tileID.key][n.id]);z?z.splice(z.length-1,0,R):this.proxyToSource[k.tileID.key][n.id]=[R],_.push(R),w=!0}}this._sourceTilesOverlap[n.id]=w}_setupProxiedCoordsForImageSource(n,a,d){if(!n.getSource().loaded())return;const _=this.proxiedCoords[n.id]=[],g=this.proxyCoords,w=n.getSource(),T=new s.pointGeometry(w.tileID.x,w.tileID.y)._div(1<<w.tileID.z),C=w.coordinates.map(s.MercatorCoordinate.fromLngLat).reduce((z,R)=>(z.min.x=Math.min(z.min.x,R.x-T.x),z.min.y=Math.min(z.min.y,R.y-T.y),z.max.x=Math.max(z.max.x,R.x-T.x),z.max.y=Math.max(z.max.y,R.y-T.y),z),{min:new s.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),k=(z,R)=>{const j=z.wrap+z.canonical.x/(1<<z.canonical.z),K=z.canonical.y/(1<<z.canonical.z),Z=s.EXTENT/(1<<z.canonical.z),W=R.wrap+R.canonical.x/(1<<R.canonical.z),X=R.canonical.y/(1<<R.canonical.z);return j+Z<W+C.min.x||j>W+C.max.x||K+Z<X+C.min.y||K>X+C.max.y};for(let z=0;z<g.length;z++){const R=g[z];for(let j=0;j<a.length;j++){const K=n.getTile(a[j]);if(!K||!K.hasData()||k(R,K.tileID))continue;const Z=this._createProxiedId(R,K,d[R.key]&&d[R.key][n.id]),W=this.proxyToSource[R.key][n.id];W?W.push(Z):this.proxyToSource[R.key][n.id]=[Z],_.push(Z)}}}_createProxiedId(n,a,d){let _=this.orthoMatrix;if(d){const g=d.find(w=>w.key===a.tileID.key);if(g)return g}if(a.tileID.key!==n.key){const g=n.canonical.z-a.tileID.canonical.z;let w,T,C;_=s.create();const k=a.tileID.wrap-n.wrap<<n.overscaledZ;g>0?(w=s.EXTENT>>g,T=w*((a.tileID.canonical.x<<g)-n.canonical.x+k),C=w*((a.tileID.canonical.y<<g)-n.canonical.y)):(w=s.EXTENT<<-g,T=s.EXTENT*(a.tileID.canonical.x-(n.canonical.x+k<<-g)),C=s.EXTENT*(a.tileID.canonical.y-(n.canonical.y<<-g))),s.ortho(_,0,w,0,w,0,1),s.translate(_,_,[T,C,0])}return new kl(a.tileID,n.key,_)}_findTileCoveringTileID(n,a){let d=a.getTile(n);if(d&&d.hasData())return d;const _=this._findCoveringTileCache[a.id],g=_[n.key];if(d=g?a.getTileByID(g):null,d&&d.hasData()||g===null)return d;let w=d?d.tileID:n,T=w.overscaledZ;const C=a.getSource().minzoom,k=[];if(!g){const R=a.getSource().maxzoom;if(n.canonical.z>=R){const j=n.canonical.z-R;a.getSource().reparseOverscaled?(T=Math.max(n.canonical.z+2,a.transform.tileZoom),w=new s.OverscaledTileID(T,n.wrap,R,n.canonical.x>>j,n.canonical.y>>j)):j!==0&&(T=R,w=new s.OverscaledTileID(T,n.wrap,R,n.canonical.x>>j,n.canonical.y>>j))}w.key!==n.key&&(k.push(w.key),d=a.getTile(w))}const z=R=>{k.forEach(j=>{_[j]=R}),k.length=0};for(T-=1;T>=C&&(!d||!d.hasData());T--){d&&z(d.tileID.key);const R=w.calculateScaledKey(T);if(d=a.getTileByID(R),d&&d.hasData())break;const j=_[R];if(j===null)break;j===void 0?k.push(R):d=a.getTileByID(j)}return z(d?d.tileID.key:null),d&&d.hasData()?d:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,a){let d=this._tilesDirty[n];d||(d=this._tilesDirty[n]={}),d[a.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const n=function(a){let d=0;const _=new s.StructArrayLayout2ui4,g=131;for(let w=1;w<129;w++){for(let T=1;T<129;T++)d=w*g+T,_.emplaceBack(d,d+1),_.emplaceBack(d,d+g),_.emplaceBack(d+1,d+g),w===128&&_.emplaceBack(d+g,d+g+1);_.emplaceBack(d+1,d+1+g)}return _}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(n),this.wireframeSegments=s.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,n.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class nu{static cacheKey(n,a,d,_){let g=`${a}${_?_.cacheKey:""}`;for(const w of d)n.usedDefines.includes(w)&&(g+=`/${w}`);return g}constructor(n,a,d,_,g,w){const T=n.gl;this.program=T.createProgram();const C=function(X){const G=[];for(let te=0;te<X.length;te++){if(X[te]===null)continue;const Y=X[te].split(" ");G.push(Y.pop())}return G}(d.staticAttributes),k=_?_.getBinderAttributes():[],z=C.concat(k);let R=_?_.defines():[];R=R.concat(w.map(X=>`#define ${X}`));const j=R.concat(n.extStandardDerivatives?`#extension GL_OES_standard_derivatives : enable
`.concat(Cl):Cl,Cl,Sl,ba.fragmentSource,Ko.fragmentSource,d.fragmentSource).join(`
`),K=R.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Sl,ba.vertexSource,Ko.vertexSource,El.vertexSource,d.vertexSource).join(`
`),Z=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);T.shaderSource(Z,j),T.compileShader(Z),T.attachShader(this.program,Z);const W=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(W,K),T.compileShader(W),T.attachShader(this.program,W),this.attributes={},this.numAttributes=z.length;for(let X=0;X<this.numAttributes;X++)z[X]&&(T.bindAttribLocation(this.program,X,z[X]),this.attributes[z[X]]=X);T.linkProgram(this.program),T.deleteShader(W),T.deleteShader(Z),this.fixedUniforms=g(n),this.binderUniforms=_?_.getUniforms(n):[],w.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=(X=>({u_dem:new s.Uniform1i(X),u_dem_prev:new s.Uniform1i(X),u_dem_unpack:new s.Uniform4f(X),u_dem_tl:new s.Uniform2f(X),u_dem_scale:new s.Uniform1f(X),u_dem_tl_prev:new s.Uniform2f(X),u_dem_scale_prev:new s.Uniform1f(X),u_dem_size:new s.Uniform1f(X),u_dem_lerp:new s.Uniform1f(X),u_exaggeration:new s.Uniform1f(X),u_depth:new s.Uniform1i(X),u_depth_size_inv:new s.Uniform2f(X),u_meter_to_dem:new s.Uniform1f(X),u_label_plane_matrix_inv:new s.UniformMatrix4f(X),u_tile_tl_up:new s.Uniform3f(X),u_tile_tr_up:new s.Uniform3f(X),u_tile_br_up:new s.Uniform3f(X),u_tile_bl_up:new s.Uniform3f(X),u_tile_up_scale:new s.Uniform1f(X)}))(n)),w.indexOf("FOG")!==-1&&(this.fogUniforms=(X=>({u_fog_matrix:new s.UniformMatrix4f(X),u_fog_range:new s.Uniform2f(X),u_fog_color:new s.Uniform4f(X),u_fog_horizon_blend:new s.Uniform1f(X),u_fog_temporal_offset:new s.Uniform1f(X),u_frustum_tl:new s.Uniform3f(X),u_frustum_tr:new s.Uniform3f(X),u_frustum_br:new s.Uniform3f(X),u_frustum_bl:new s.Uniform3f(X),u_globe_pos:new s.Uniform3f(X),u_globe_radius:new s.Uniform1f(X),u_globe_transition:new s.Uniform1f(X),u_is_globe:new s.Uniform1i(X),u_viewport:new s.Uniform2f(X)}))(n))}}setTerrainUniformValues(n,a){if(!this.terrainUniforms)return;const d=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in a)d[_].set(this.program,_,a[_])}}setFogUniformValues(n,a){if(!this.fogUniforms)return;const d=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in a)d[_].set(this.program,_,a[_])}}draw(n,a,d,_,g,w,T,C,k,z,R,j,K,Z,W){const X=n.gl;if(this.failedToCreate)return;n.program.set(this.program),n.setDepthMode(d),n.setStencilMode(_),n.setColorMode(g),n.setCullFace(w);for(const te of Object.keys(this.fixedUniforms))this.fixedUniforms[te].set(this.program,te,T[te]);Z&&Z.setUniforms(this.program,n,this.binderUniforms,j,{zoom:K});const G={[X.LINES]:2,[X.TRIANGLES]:3,[X.LINE_STRIP]:1}[a];for(const te of R.get()){const Y=te.vaos||(te.vaos={});(Y[C]||(Y[C]=new Ml)).bind(n,this,k,Z?Z.getPaintVertexBuffers():[],z,te.vertexOffset,W||[]),X.drawElements(a,te.primitiveLength*G,X.UNSIGNED_SHORT,te.primitiveOffset*G*2)}}}function Wh(c,n,a){const d=1/pi(a,1,n.transform.tileZoom),_=Math.pow(2,a.tileID.overscaledZ),g=a.tileSize*Math.pow(2,n.transform.tileZoom)/_,w=g*(a.tileID.canonical.x+a.tileID.wrap*_),T=g*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[d,c.fromScale,c.toScale],u_fade:c.t,u_pixel_coord_upper:[w>>16,T>>16],u_pixel_coord_lower:[65535&w,65535&T]}}const Ea=s.create(),Ms=(c,n,a,d,_,g,w,T,C,k,z)=>{const R=n.style.light,j=R.properties.get("position"),K=[j.x,j.y,j.z],Z=s.create$1();R.properties.get("anchor")==="viewport"&&(s.fromRotation(Z,-n.transform.angle),s.transformMat3(K,K,Z));const W=R.properties.get("color"),X=n.transform,G={u_matrix:c,u_lightpos:K,u_lightintensity:R.properties.get("intensity"),u_lightcolor:[W.r,W.g,W.b],u_vertical_gradient:+a,u_opacity:d,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ea,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:_,u_edge_radius:g};return X.projection.name==="globe"&&(G.u_tile_id=[w.canonical.x,w.canonical.y,1<<w.canonical.z],G.u_zoom_transition=C,G.u_inv_rot_matrix=z,G.u_merc_center=k,G.u_up_dir=X.projection.upVector(new s.CanonicalTileID(0,0,0),k[0]*s.EXTENT,k[1]*s.EXTENT),G.u_height_lift=T),G},Hh=(c,n,a,d,_,g,w,T,C,k,z,R,j)=>{const K=Ms(c,n,a,d,_,g,w,k,z,R,j),Z={u_height_factor:-Math.pow(2,w.overscaledZ)/C.tileSize/8};return s.extend(K,Wh(T,n,C),Z)},Sa=c=>({u_matrix:c}),zl=(c,n,a,d)=>s.extend(Sa(c),Wh(a,n,d)),$r=(c,n)=>({u_matrix:c,u_world:n}),ru=(c,n,a,d,_)=>s.extend(zl(c,n,a,d),{u_world:_}),Xh=s.create(),ou=(c,n,a,d,_,g)=>{const w=c.transform,T=w.projection.name==="globe";let C;if(g.paint.get("circle-pitch-alignment")==="map")if(T){const z=s.globePixelsToTileUnits(w.zoom,n.canonical)*w._pixelsPerMercatorPixel;C=Float32Array.from([z,0,0,z])}else C=w.calculatePixelsToTileUnitsMatrix(a);else C=new Float32Array([w.pixelsToGLUnits[0],0,0,w.pixelsToGLUnits[1]]);const k={u_camera_to_center_distance:w.cameraToCenterDistance,u_matrix:c.translatePosMatrix(n.projMatrix,a,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_device_pixel_ratio:s.exported.devicePixelRatio,u_extrude_scale:C,u_inv_rot_matrix:Xh,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(T){k.u_inv_rot_matrix=d,k.u_merc_center=_,k.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],k.u_zoom_transition=s.globeToMercatorTransition(w.zoom);const z=_[0]*s.EXTENT,R=_[1]*s.EXTENT;k.u_up_dir=w.projection.upVector(new s.CanonicalTileID(0,0,0),z,R)}return k},Kh=c=>{const n=[];return c.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),c.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n},su=(c,n,a,d)=>{const _=s.EXTENT/a.tileSize;return{u_matrix:c,u_camera_to_center_distance:n.getCameraToCenterDistance(d),u_extrude_scale:[n.pixelsToGLUnits[0]/_,n.pixelsToGLUnits[1]/_]}},Yh=(c,n,a=1)=>({u_matrix:c,u_color:n,u_overlay:0,u_overlay_scale:a}),au=s.create(),kp=(c,n,a,d,_,g,w)=>{const T=c.transform,C=T.projection.name==="globe",k=C?s.globePixelsToTileUnits(T.zoom,n.canonical)*T._pixelsPerMercatorPixel:pi(a,1,g),z={u_matrix:n.projMatrix,u_extrude_scale:k,u_intensity:w,u_inv_rot_matrix:au,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){z.u_inv_rot_matrix=d,z.u_merc_center=_,z.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],z.u_zoom_transition=s.globeToMercatorTransition(T.zoom);const R=_[0]*s.EXTENT,j=_[1]*s.EXTENT;z.u_up_dir=T.projection.upVector(new s.CanonicalTileID(0,0,0),R,j)}return z},Pl=(c,n,a,d,_,g,w,T)=>{const C=c.transform,k=C.calculatePixelsToTileUnitsMatrix(n),z={u_matrix:Jh(c,n,a,_),u_pixels_to_tile_units:k,u_device_pixel_ratio:w,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:g,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:T};if(Ll(a)){const R=Dl(n,c.transform);z.u_texsize=n.lineAtlasTexture.size,z.u_scale=[R,d.fromScale,d.toScale],z.u_mix=d.t}return z},zp=(c,n,a,d,_,g)=>{const w=c.transform,T=Dl(n,w);return{u_matrix:Jh(c,n,a,_),u_texsize:n.imageAtlasTexture.size,u_pixels_to_tile_units:w.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:g,u_image:0,u_scale:[T,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Dl(c,n){return 1/pi(c,1,n.tileZoom)}function Jh(c,n,a,d){return c.translatePosMatrix(d||n.tileID.projMatrix,n,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}function Ll(c){const n=c.paint.get("line-dasharray").value;return n.value||n.kind!=="constant"}const Pp=(c,n,a,d,_,g)=>{return{u_matrix:c,u_tl_parent:n,u_scale_parent:a,u_fade_t:d.mix,u_opacity:d.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(T=_.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(w=_.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:Bl(_.paint.get("raster-hue-rotate")),u_perspective_transform:g};var w,T};function Bl(c){c*=Math.PI/180;const n=Math.sin(c),a=Math.cos(c);return[(2*a+1)/3,(-Math.sqrt(3)*n-a+1)/3,(Math.sqrt(3)*n-a+1)/3]}const Qh=s.create(),lu=(c,n,a,d,_,g,w,T,C,k,z,R,j,K,Z,W)=>{const X=_.transform,G={u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:X.cameraToCenterDistance,u_rotate_symbol:+a,u_aspect_ratio:X.width/X.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:g,u_label_plane_matrix:w,u_coord_matrix:T,u_is_text:+C,u_pitch_with_map:+d,u_texsize:k,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Qh,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Qh,u_up_vector:[0,-1,0]};return W.name==="globe"&&(G.u_tile_id=[z.canonical.x,z.canonical.y,1<<z.canonical.z],G.u_zoom_transition=R,G.u_inv_rot_matrix=K,G.u_merc_center=j,G.u_camera_forward=X._camera.forward(),G.u_ecef_origin=s.globeECEFOrigin(X.globeMatrix,z.toUnwrapped()),G.u_tile_matrix=Float32Array.from(X.globeMatrix),G.u_up_vector=Z),G},cu=(c,n,a,d,_,g,w,T,C,k,z,R,j,K,Z,W,X)=>s.extend(lu(c,n,a,d,_,g,w,T,C,k,R,j,K,Z,W,X),{u_gamma_scale:d?_.transform.cameraToCenterDistance*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:s.exported.devicePixelRatio,u_is_halo:+z}),Is=(c,n,a,d,_,g,w,T,C,k,z,R,j,K,Z,W)=>s.extend(cu(c,n,a,d,_,g,w,T,!0,C,!0,z,R,j,K,Z,W),{u_texsize_icon:k,u_texture_icon:1}),Dp=(c,n,a)=>({u_matrix:c,u_opacity:n,u_color:a}),Lp=(c,n,a,d,_,g)=>s.extend(function(w,T,C,k){const z=C.imageManager.getPattern(w.from.toString()),R=C.imageManager.getPattern(w.to.toString()),{width:j,height:K}=C.imageManager.getPixelSize(),Z=Math.pow(2,k.tileID.overscaledZ),W=k.tileSize*Math.pow(2,C.transform.tileZoom)/Z,X=W*(k.tileID.canonical.x+k.tileID.wrap*Z),G=W*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:R.tl,u_pattern_br_b:R.br,u_texsize:[j,K],u_mix:T.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:R.displaySize,u_scale_a:T.fromScale,u_scale_b:T.toScale,u_tile_units_to_pixels:1/pi(k,1,C.transform.tileZoom),u_pixel_coord_upper:[X>>16,G>>16],u_pixel_coord_lower:[65535&X,65535&G]}}(d,g,a,_),{u_matrix:c,u_opacity:n}),Bp={fillExtrusion:c=>({u_matrix:new s.UniformMatrix4f(c),u_lightpos:new s.Uniform3f(c),u_lightintensity:new s.Uniform1f(c),u_lightcolor:new s.Uniform3f(c),u_vertical_gradient:new s.Uniform1f(c),u_opacity:new s.Uniform1f(c),u_edge_radius:new s.Uniform1f(c),u_ao:new s.Uniform2f(c),u_tile_id:new s.Uniform3f(c),u_zoom_transition:new s.Uniform1f(c),u_inv_rot_matrix:new s.UniformMatrix4f(c),u_merc_center:new s.Uniform2f(c),u_up_dir:new s.Uniform3f(c),u_height_lift:new s.Uniform1f(c)}),fillExtrusionPattern:c=>({u_matrix:new s.UniformMatrix4f(c),u_lightpos:new s.Uniform3f(c),u_lightintensity:new s.Uniform1f(c),u_lightcolor:new s.Uniform3f(c),u_vertical_gradient:new s.Uniform1f(c),u_height_factor:new s.Uniform1f(c),u_edge_radius:new s.Uniform1f(c),u_ao:new s.Uniform2f(c),u_tile_id:new s.Uniform3f(c),u_zoom_transition:new s.Uniform1f(c),u_inv_rot_matrix:new s.UniformMatrix4f(c),u_merc_center:new s.Uniform2f(c),u_up_dir:new s.Uniform3f(c),u_height_lift:new s.Uniform1f(c),u_image:new s.Uniform1i(c),u_texsize:new s.Uniform2f(c),u_pixel_coord_upper:new s.Uniform2f(c),u_pixel_coord_lower:new s.Uniform2f(c),u_scale:new s.Uniform3f(c),u_fade:new s.Uniform1f(c),u_opacity:new s.Uniform1f(c)}),fill:c=>({u_matrix:new s.UniformMatrix4f(c)}),fillPattern:c=>({u_matrix:new s.UniformMatrix4f(c),u_image:new s.Uniform1i(c),u_texsize:new s.Uniform2f(c),u_pixel_coord_upper:new s.Uniform2f(c),u_pixel_coord_lower:new s.Uniform2f(c),u_scale:new s.Uniform3f(c),u_fade:new s.Uniform1f(c)}),fillOutline:c=>({u_matrix:new s.UniformMatrix4f(c),u_world:new s.Uniform2f(c)}),fillOutlinePattern:c=>({u_matrix:new s.UniformMatrix4f(c),u_world:new s.Uniform2f(c),u_image:new s.Uniform1i(c),u_texsize:new s.Uniform2f(c),u_pixel_coord_upper:new s.Uniform2f(c),u_pixel_coord_lower:new s.Uniform2f(c),u_scale:new s.Uniform3f(c),u_fade:new s.Uniform1f(c)}),circle:c=>({u_camera_to_center_distance:new s.Uniform1f(c),u_extrude_scale:new s.UniformMatrix2f(c),u_device_pixel_ratio:new s.Uniform1f(c),u_matrix:new s.UniformMatrix4f(c),u_inv_rot_matrix:new s.UniformMatrix4f(c),u_merc_center:new s.Uniform2f(c),u_tile_id:new s.Uniform3f(c),u_zoom_transition:new s.Uniform1f(c),u_up_dir:new s.Uniform3f(c)}),collisionBox:c=>({u_matrix:new s.UniformMatrix4f(c),u_camera_to_center_distance:new s.Uniform1f(c),u_extrude_scale:new s.Uniform2f(c)}),collisionCircle:c=>({u_matrix:new s.UniformMatrix4f(c),u_inv_matrix:new s.UniformMatrix4f(c),u_camera_to_center_distance:new s.Uniform1f(c),u_viewport_size:new s.Uniform2f(c)}),debug:c=>({u_color:new s.UniformColor(c),u_matrix:new s.UniformMatrix4f(c),u_overlay:new s.Uniform1i(c),u_overlay_scale:new s.Uniform1f(c)}),clippingMask:c=>({u_matrix:new s.UniformMatrix4f(c)}),heatmap:c=>({u_extrude_scale:new s.Uniform1f(c),u_intensity:new s.Uniform1f(c),u_matrix:new s.UniformMatrix4f(c),u_inv_rot_matrix:new s.UniformMatrix4f(c),u_merc_center:new s.Uniform2f(c),u_tile_id:new s.Uniform3f(c),u_zoom_transition:new s.Uniform1f(c),u_up_dir:new s.Uniform3f(c)}),heatmapTexture:c=>({u_image:new s.Uniform1i(c),u_color_ramp:new s.Uniform1i(c),u_opacity:new s.Uniform1f(c)}),hillshade:c=>({u_matrix:new s.UniformMatrix4f(c),u_image:new s.Uniform1i(c),u_latrange:new s.Uniform2f(c),u_light:new s.Uniform2f(c),u_shadow:new s.UniformColor(c),u_highlight:new s.UniformColor(c),u_accent:new s.UniformColor(c)}),hillshadePrepare:c=>({u_matrix:new s.UniformMatrix4f(c),u_image:new s.Uniform1i(c),u_dimension:new s.Uniform2f(c),u_zoom:new s.Uniform1f(c),u_unpack:new s.Uniform4f(c)}),line:c=>({u_matrix:new s.UniformMatrix4f(c),u_pixels_to_tile_units:new s.UniformMatrix2f(c),u_device_pixel_ratio:new s.Uniform1f(c),u_units_to_pixels:new s.Uniform2f(c),u_dash_image:new s.Uniform1i(c),u_gradient_image:new s.Uniform1i(c),u_image_height:new s.Uniform1f(c),u_texsize:new s.Uniform2f(c),u_scale:new s.Uniform3f(c),u_mix:new s.Uniform1f(c),u_alpha_discard_threshold:new s.Uniform1f(c),u_trim_offset:new s.Uniform2f(c)}),linePattern:c=>({u_matrix:new s.UniformMatrix4f(c),u_texsize:new s.Uniform2f(c),u_pixels_to_tile_units:new s.UniformMatrix2f(c),u_device_pixel_ratio:new s.Uniform1f(c),u_image:new s.Uniform1i(c),u_units_to_pixels:new s.Uniform2f(c),u_scale:new s.Uniform3f(c),u_fade:new s.Uniform1f(c),u_alpha_discard_threshold:new s.Uniform1f(c)}),raster:c=>({u_matrix:new s.UniformMatrix4f(c),u_tl_parent:new s.Uniform2f(c),u_scale_parent:new s.Uniform1f(c),u_fade_t:new s.Uniform1f(c),u_opacity:new s.Uniform1f(c),u_image0:new s.Uniform1i(c),u_image1:new s.Uniform1i(c),u_brightness_low:new s.Uniform1f(c),u_brightness_high:new s.Uniform1f(c),u_saturation_factor:new s.Uniform1f(c),u_contrast_factor:new s.Uniform1f(c),u_spin_weights:new s.Uniform3f(c),u_perspective_transform:new s.Uniform2f(c)}),symbolIcon:c=>({u_is_size_zoom_constant:new s.Uniform1i(c),u_is_size_feature_constant:new s.Uniform1i(c),u_size_t:new s.Uniform1f(c),u_size:new s.Uniform1f(c),u_camera_to_center_distance:new s.Uniform1f(c),u_rotate_symbol:new s.Uniform1i(c),u_aspect_ratio:new s.Uniform1f(c),u_fade_change:new s.Uniform1f(c),u_matrix:new s.UniformMatrix4f(c),u_label_plane_matrix:new s.UniformMatrix4f(c),u_coord_matrix:new s.UniformMatrix4f(c),u_is_text:new s.Uniform1i(c),u_pitch_with_map:new s.Uniform1i(c),u_texsize:new s.Uniform2f(c),u_tile_id:new s.Uniform3f(c),u_zoom_transition:new s.Uniform1f(c),u_inv_rot_matrix:new s.UniformMatrix4f(c),u_merc_center:new s.Uniform2f(c),u_camera_forward:new s.Uniform3f(c),u_tile_matrix:new s.UniformMatrix4f(c),u_up_vector:new s.Uniform3f(c),u_ecef_origin:new s.Uniform3f(c),u_texture:new s.Uniform1i(c)}),symbolSDF:c=>({u_is_size_zoom_constant:new s.Uniform1i(c),u_is_size_feature_constant:new s.Uniform1i(c),u_size_t:new s.Uniform1f(c),u_size:new s.Uniform1f(c),u_camera_to_center_distance:new s.Uniform1f(c),u_rotate_symbol:new s.Uniform1i(c),u_aspect_ratio:new s.Uniform1f(c),u_fade_change:new s.Uniform1f(c),u_matrix:new s.UniformMatrix4f(c),u_label_plane_matrix:new s.UniformMatrix4f(c),u_coord_matrix:new s.UniformMatrix4f(c),u_is_text:new s.Uniform1i(c),u_pitch_with_map:new s.Uniform1i(c),u_texsize:new s.Uniform2f(c),u_texture:new s.Uniform1i(c),u_gamma_scale:new s.Uniform1f(c),u_device_pixel_ratio:new s.Uniform1f(c),u_tile_id:new s.Uniform3f(c),u_zoom_transition:new s.Uniform1f(c),u_inv_rot_matrix:new s.UniformMatrix4f(c),u_merc_center:new s.Uniform2f(c),u_camera_forward:new s.Uniform3f(c),u_tile_matrix:new s.UniformMatrix4f(c),u_up_vector:new s.Uniform3f(c),u_ecef_origin:new s.Uniform3f(c),u_is_halo:new s.Uniform1i(c)}),symbolTextAndIcon:c=>({u_is_size_zoom_constant:new s.Uniform1i(c),u_is_size_feature_constant:new s.Uniform1i(c),u_size_t:new s.Uniform1f(c),u_size:new s.Uniform1f(c),u_camera_to_center_distance:new s.Uniform1f(c),u_rotate_symbol:new s.Uniform1i(c),u_aspect_ratio:new s.Uniform1f(c),u_fade_change:new s.Uniform1f(c),u_matrix:new s.UniformMatrix4f(c),u_label_plane_matrix:new s.UniformMatrix4f(c),u_coord_matrix:new s.UniformMatrix4f(c),u_is_text:new s.Uniform1i(c),u_pitch_with_map:new s.Uniform1i(c),u_texsize:new s.Uniform2f(c),u_texsize_icon:new s.Uniform2f(c),u_texture:new s.Uniform1i(c),u_texture_icon:new s.Uniform1i(c),u_gamma_scale:new s.Uniform1f(c),u_device_pixel_ratio:new s.Uniform1f(c),u_is_halo:new s.Uniform1i(c)}),background:c=>({u_matrix:new s.UniformMatrix4f(c),u_opacity:new s.Uniform1f(c),u_color:new s.UniformColor(c)}),backgroundPattern:c=>({u_matrix:new s.UniformMatrix4f(c),u_opacity:new s.Uniform1f(c),u_image:new s.Uniform1i(c),u_pattern_tl_a:new s.Uniform2f(c),u_pattern_br_a:new s.Uniform2f(c),u_pattern_tl_b:new s.Uniform2f(c),u_pattern_br_b:new s.Uniform2f(c),u_texsize:new s.Uniform2f(c),u_mix:new s.Uniform1f(c),u_pattern_size_a:new s.Uniform2f(c),u_pattern_size_b:new s.Uniform2f(c),u_scale_a:new s.Uniform1f(c),u_scale_b:new s.Uniform1f(c),u_pixel_coord_upper:new s.Uniform2f(c),u_pixel_coord_lower:new s.Uniform2f(c),u_tile_units_to_pixels:new s.Uniform1f(c)}),terrainRaster:wa,terrainDepth:wa,skybox:c=>({u_matrix:new s.UniformMatrix4f(c),u_sun_direction:new s.Uniform3f(c),u_cubemap:new s.Uniform1i(c),u_opacity:new s.Uniform1f(c),u_temporal_offset:new s.Uniform1f(c)}),skyboxGradient:c=>({u_matrix:new s.UniformMatrix4f(c),u_color_ramp:new s.Uniform1i(c),u_center_direction:new s.Uniform3f(c),u_radius:new s.Uniform1f(c),u_opacity:new s.Uniform1f(c),u_temporal_offset:new s.Uniform1f(c)}),skyboxCapture:c=>({u_matrix_3f:new s.UniformMatrix3f(c),u_sun_direction:new s.Uniform3f(c),u_sun_intensity:new s.Uniform1f(c),u_color_tint_r:new s.Uniform4f(c),u_color_tint_m:new s.Uniform4f(c),u_luminance:new s.Uniform1f(c)}),globeRaster:c=>({u_proj_matrix:new s.UniformMatrix4f(c),u_globe_matrix:new s.UniformMatrix4f(c),u_normalize_matrix:new s.UniformMatrix4f(c),u_merc_matrix:new s.UniformMatrix4f(c),u_zoom_transition:new s.Uniform1f(c),u_merc_center:new s.Uniform2f(c),u_image0:new s.Uniform1i(c),u_grid_matrix:new s.UniformMatrix3f(c),u_frustum_tl:new s.Uniform3f(c),u_frustum_tr:new s.Uniform3f(c),u_frustum_br:new s.Uniform3f(c),u_frustum_bl:new s.Uniform3f(c),u_globe_pos:new s.Uniform3f(c),u_globe_radius:new s.Uniform1f(c),u_viewport:new s.Uniform2f(c)}),globeAtmosphere:c=>({u_frustum_tl:new s.Uniform3f(c),u_frustum_tr:new s.Uniform3f(c),u_frustum_br:new s.Uniform3f(c),u_frustum_bl:new s.Uniform3f(c),u_horizon:new s.Uniform1f(c),u_transition:new s.Uniform1f(c),u_fadeout_range:new s.Uniform1f(c),u_color:new s.Uniform4f(c),u_high_color:new s.Uniform4f(c),u_space_color:new s.Uniform4f(c),u_star_intensity:new s.Uniform1f(c),u_star_density:new s.Uniform1f(c),u_star_size:new s.Uniform1f(c),u_temporal_offset:new s.Uniform1f(c),u_horizon_angle:new s.Uniform1f(c),u_rotation_matrix:new s.UniformMatrix4f(c)})};let Rl;function ed(c,n,a,d,_,g,w){const T=c.context,C=T.gl,k=c.transform,z=c.useProgram("collisionBox"),R=[];let j=0,K=0;for(let pe=0;pe<d.length;pe++){const he=d[pe],oe=n.getTile(he),fe=oe.getBucket(a);if(!fe)continue;const le=ar(he,fe,k);let ve=le;_[0]===0&&_[1]===0||(ve=c.translatePosMatrix(le,oe,_,g));const Be=w?fe.textCollisionBox:fe.iconCollisionBox,dt=fe.collisionCircleArray;if(dt.length>0){const Ae=s.create(),Je=ve;s.mul(Ae,fe.placementInvProjMatrix,k.glCoordMatrix),s.mul(Ae,Ae,fe.placementViewportMatrix),R.push({circleArray:dt,circleOffset:K,transform:Je,invTransform:Ae,projection:fe.getProjection()}),j+=dt.length/4,K=j}Be&&(c.terrain&&c.terrain.setupElevationDraw(oe,z),z.draw(T,C.LINES,s.DepthMode.disabled,s.StencilMode.disabled,c.colorModeForRenderPass(),s.CullFaceMode.disabled,su(ve,k,oe,fe.getProjection()),a.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,null,k.zoom,null,[Be.collisionVertexBuffer,Be.collisionVertexBufferExt]))}if(!w||!R.length)return;const Z=c.useProgram("collisionCircle"),W=new s.StructArrayLayout2f1f2i16;W.resize(4*j),W._trim();let X=0;for(const pe of R)for(let he=0;he<pe.circleArray.length/4;he++){const oe=4*he,fe=pe.circleArray[oe+0],le=pe.circleArray[oe+1],ve=pe.circleArray[oe+2],Be=pe.circleArray[oe+3];W.emplace(X++,fe,le,ve,Be,0),W.emplace(X++,fe,le,ve,Be,1),W.emplace(X++,fe,le,ve,Be,2),W.emplace(X++,fe,le,ve,Be,3)}(!Rl||Rl.length<2*j)&&(Rl=function(pe){const he=2*pe,oe=new s.StructArrayLayout3ui6;oe.resize(he),oe._trim();for(let fe=0;fe<he;fe++){const le=6*fe;oe.uint16[le+0]=4*fe+0,oe.uint16[le+1]=4*fe+1,oe.uint16[le+2]=4*fe+2,oe.uint16[le+3]=4*fe+2,oe.uint16[le+4]=4*fe+3,oe.uint16[le+5]=4*fe+0}return oe}(j));const G=T.createIndexBuffer(Rl,!0),te=T.createVertexBuffer(W,s.collisionCircleLayout.members,!0);for(const pe of R){const he={u_matrix:pe.transform,u_inv_matrix:pe.invTransform,u_camera_to_center_distance:(Y=k).getCameraToCenterDistance(pe.projection),u_viewport_size:[Y.width,Y.height]};Z.draw(T,C.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,c.colorModeForRenderPass(),s.CullFaceMode.disabled,he,a.id,te,G,s.SegmentVector.simpleSegment(0,2*pe.circleOffset,pe.circleArray.length,pe.circleArray.length/2),null,k.zoom)}var Y;te.destroy(),G.destroy()}const td=s.create();function uu(c,n,a,d,_,g){const{horizontalAlign:w,verticalAlign:T}=s.getAnchorAlignment(c),C=-(w-.5)*n,k=-(T-.5)*a,z=s.evaluateVariableOffset(c,d);return new s.pointGeometry((C/_+z[0])*g,(k/_+z[1])*g)}function hu(c,n,a,d,_,g,w,T,C,k,z){const R=c.text.placedSymbolArray,j=c.text.dynamicLayoutVertexArray,K=c.icon.dynamicLayoutVertexArray,Z={},W=lr(T,c.getProjection(),g),X=g.elevation,G=c.getProjection().upVectorScale(T.canonical,g.center.lat,g.worldSize);j.clear();for(let te=0;te<R.length;te++){const Y=R.get(te),pe=c.allowVerticalPlacement&&!Y.placedOrientation,he=Y.hidden||!Y.crossTileID||pe?null:d[Y.crossTileID];if(he){const oe=new s.pointGeometry(Y.tileAnchorX,Y.tileAnchorY),fe=c.getProjection().upVector(T.canonical,oe.x,oe.y),le=X?X.getAtTileOffset(T,oe.x,oe.y):0,ve=ui([Y.projectedAnchorX+le*fe[0]*G.metersToTile,Y.projectedAnchorY+le*fe[1]*G.metersToTile,Y.projectedAnchorZ+le*fe[2]*G.metersToTile],a?W:w),Be=fa(g.getCameraToCenterDistance(c.getProjection()),ve.signedDistanceFromCamera);let dt=_.evaluateSizeForFeature(c.textSizeData,k,Y)*Be/s.ONE_EM;a&&(dt*=c.tilePixelRatio/C);const{width:Ae,height:Je,anchor:rt,textOffset:wt,textScale:qe}=he,mt=uu(rt,Ae,Je,wt,qe,dt);let it;if(a){const St=oe.add(mt),{x:Vt,y:Wt,z:ii}=c.getProjection().projectTilePoint(St.x,St.y,T.canonical);it=ui([Vt+le*fe[0]*G.metersToTile,Wt+le*fe[1]*G.metersToTile,ii+le*fe[2]*G.metersToTile],w).point}else{const St=n?mt.rotate(-g.angle):mt;it=[ve.point[0]+St.x,ve.point[1]+St.y,0]}const It=c.allowVerticalPlacement&&Y.placedOrientation===s.WritingMode.vertical?Math.PI/2:0;for(let St=0;St<Y.numGlyphs;St++)s.addDynamicAttributes(j,it[0],it[1],it[2],It);z&&Y.associatedIconIndex>=0&&(Z[Y.associatedIconIndex]={shiftedAnchor:it,angle:It})}else Co(Y.numGlyphs,j)}if(z){K.clear();const te=c.icon.placedSymbolArray;for(let Y=0;Y<te.length;Y++){const pe=te.get(Y);if(pe.hidden)Co(pe.numGlyphs,K);else{const he=Z[Y];if(he)for(let oe=0;oe<pe.numGlyphs;oe++)s.addDynamicAttributes(K,he.shiftedAnchor[0],he.shiftedAnchor[1],he.shiftedAnchor[2],he.angle);else Co(pe.numGlyphs,K)}}c.icon.dynamicLayoutVertexBuffer.updateData(K)}c.text.dynamicLayoutVertexBuffer.updateData(j)}function id(c,n,a){return a.iconsInText&&n?"symbolTextAndIcon":c?"symbolSDF":"symbolIcon"}function du(c,n,a,d,_,g,w,T,C,k,z,R){const j=c.context,K=j.gl,Z=c.transform,W=T==="map",X=C==="map",G=W&&a.layout.get("symbol-placement")!=="point",te=W&&!X&&!G,Y=a.layout.get("symbol-sort-key").constantOr(1)!==void 0;let pe=!1;const he=c.depthModeForSublayer(0,s.DepthMode.ReadOnly),oe=[s.mercatorXfromLng(Z.center.lng),s.mercatorYfromLat(Z.center.lat)],fe=a.layout.get("text-variable-anchor"),le=Z.projection.name==="globe",ve=[],Be=[0,-1,0];let dt=Be;!le&&!Z.mercatorFromTransition||W||(dt=function(Ae){const Je=Ae._camera.getWorldToCamera(Ae.worldSize,1),rt=s.multiply([],Je,Ae.globeMatrix);s.invert(rt,rt);const wt=[0,0,0],qe=[0,1,0,0];return s.transformMat4$1(qe,qe,rt),wt[0]=qe[0],wt[1]=qe[1],wt[2]=qe[2],s.normalize(wt,wt),wt}(Z));for(const Ae of d){const Je=n.getTile(Ae),rt=Je.getBucket(a);if(!rt||rt.projection.name==="mercator"&&le)continue;const wt=_?rt.text:rt.icon;if(!wt||rt.fullyClipped||!wt.segments.get().length)continue;const qe=wt.programConfigurations.get(a.id),mt=_||rt.sdfIcons,it=_?rt.textSizeData:rt.iconSizeData,It=X||Z.pitch!==0,St=s.evaluateSizeForZoom(it,Z.zoom);let Vt,Wt,ii,xi,Ut=[0,0],ai=null;if(_){if(Wt=Je.glyphAtlasTexture,ii=K.LINEAR,Vt=Je.glyphAtlasTexture.size,rt.iconsInText){Ut=Je.imageAtlasTexture.size,ai=Je.imageAtlasTexture;const Qn=it.kind==="composite"||it.kind==="camera";xi=It||c.options.rotating||c.options.zooming||Qn?K.LINEAR:K.NEAREST}}else{const Qn=a.layout.get("icon-size").constantOr(0)!==1||rt.iconsNeedLinear;Wt=Je.imageAtlasTexture,ii=mt||c.options.rotating||c.options.zooming||Qn||It?K.LINEAR:K.NEAREST,Vt=Je.imageAtlasTexture.size}const Ii=rt.projection.name==="globe",Qi=Ii?dt:Be,dn=Ii?s.globeToMercatorTransition(Z.zoom):0,ji=lr(Ae,rt.getProjection(),Z),Fn=Z.calculatePixelsToTileUnitsMatrix(Je),Vr=gi(ji,Je.tileID.canonical,X,W,Z,rt.getProjection(),Fn),so=c.terrain&&X&&G?s.invert(s.create(),Vr):td,en=Br(ji,Je.tileID.canonical,X,W,Z,rt.getProjection(),Fn),nn=fe&&rt.hasTextData(),_i=a.layout.get("icon-text-fit")!=="none"&&nn&&rt.hasIconData();if(G){const Qn=Z.elevation,ns=Qn?Qn.getAtTileOffsetFunc(Ae,Z.center.lat,Z.worldSize,rt.getProjection()):ja=>[0,0,0],Po=yi(ji,Je.tileID.canonical,X,W,Z,rt.getProjection(),Fn);ma(rt,ji,c,_,Po,en,X,k,ns,Ae)}const En=G||_&&fe||_i,Gn=c.translatePosMatrix(ji,Je,g,w),Xi=En?td:Vr,Zn=c.translatePosMatrix(en,Je,g,w,!0),Qo=rt.getProjection().createInversionMatrix(Z,Ae.canonical),Jn=[];c.terrain&&X&&Jn.push("PITCH_WITH_MAP_TERRAIN"),Ii&&Jn.push("PROJECTION_GLOBE_VIEW"),En&&Jn.push("PROJECTED_POS_ON_VIEWPORT");const es=mt&&a.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ts;ts=mt?rt.iconsInText?Is(it.kind,St,te,X,c,Gn,Xi,Zn,Vt,Ut,Ae,dn,oe,Qo,Qi,rt.getProjection()):cu(it.kind,St,te,X,c,Gn,Xi,Zn,_,Vt,!0,Ae,dn,oe,Qo,Qi,rt.getProjection()):lu(it.kind,St,te,X,c,Gn,Xi,Zn,_,Vt,Ae,dn,oe,Qo,Qi,rt.getProjection());const is={program:c.useProgram(id(mt,_,rt),qe,Jn),buffers:wt,uniformValues:ts,atlasTexture:Wt,atlasTextureIcon:ai,atlasInterpolation:ii,atlasInterpolationIcon:xi,isSDF:mt,hasHalo:es,tile:Je,labelPlaneMatrixInv:so};if(Y&&rt.canOverlap){pe=!0;const Qn=wt.segments.get();for(const ns of Qn)ve.push({segments:new s.SegmentVector([ns]),sortKey:ns.sortKey,state:is})}else ve.push({segments:wt.segments,sortKey:0,state:is})}pe&&ve.sort((Ae,Je)=>Ae.sortKey-Je.sortKey);for(const Ae of ve){const Je=Ae.state;if(c.terrain&&c.terrain.setupElevationDraw(Je.tile,Je.program,{useDepthForOcclusion:!le,labelPlaneMatrixInv:Je.labelPlaneMatrixInv}),j.activeTexture.set(K.TEXTURE0),Je.atlasTexture.bind(Je.atlasInterpolation,K.CLAMP_TO_EDGE),Je.atlasTextureIcon&&(j.activeTexture.set(K.TEXTURE1),Je.atlasTextureIcon&&Je.atlasTextureIcon.bind(Je.atlasInterpolationIcon,K.CLAMP_TO_EDGE)),Je.isSDF){const rt=Je.uniformValues;Je.hasHalo&&(rt.u_is_halo=1,fu(Je.buffers,Ae.segments,a,c,Je.program,he,z,R,rt)),rt.u_is_halo=0}fu(Je.buffers,Ae.segments,a,c,Je.program,he,z,R,Je.uniformValues)}}function fu(c,n,a,d,_,g,w,T,C){const k=d.context,z=[c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer,c.globeExtVertexBuffer];_.draw(k,k.gl.TRIANGLES,g,w,T,s.CullFaceMode.disabled,C,a.id,c.layoutVertexBuffer,c.indexBuffer,n,a.paint,d.transform.zoom,c.programConfigurations.get(a.id),z)}function Fl(c,n,a,d,_,g,w){const T=c.context.gl,C=a.paint.get("fill-pattern"),k=C&&C.constantOr(1),z=a.getCrossfadeParameters();let R,j,K,Z,W;w?(j=k&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=T.LINES):(j=k?"fillPattern":"fill",R=T.TRIANGLES);for(const X of d){const G=n.getTile(X);if(k&&!G.patternsLoaded())continue;const te=G.getBucket(a);if(!te)continue;c.prepareDrawTile();const Y=te.programConfigurations.get(a.id),pe=c.useProgram(j,Y);k&&(c.context.activeTexture.set(T.TEXTURE0),G.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),Y.updatePaintBuffers(z));const he=C.constantOr(null);if(he&&G.imageAtlas){const fe=G.imageAtlas,le=fe.patternPositions[he.to.toString()],ve=fe.patternPositions[he.from.toString()];le&&ve&&Y.setConstantPatternPositions(le,ve)}const oe=c.translatePosMatrix(X.projMatrix,G,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(w){Z=te.indexBuffer2,W=te.segments2;const fe=c.terrain&&c.terrain.renderingToTexture?c.terrain.drapeBufferSize:[T.drawingBufferWidth,T.drawingBufferHeight];K=j==="fillOutlinePattern"&&k?ru(oe,c,z,G,fe):$r(oe,fe)}else Z=te.indexBuffer,W=te.segments,K=k?zl(oe,c,z,G):Sa(oe);c.prepareDrawProgram(c.context,pe,X.toUnwrapped()),pe.draw(c.context,R,_,c.stencilModeForClipping(X),g,s.CullFaceMode.disabled,K,a.id,te.layoutVertexBuffer,Z,W,a.paint,c.transform.zoom,Y)}}function no(c,n,a,d,_,g,w){const T=c.context,C=T.gl,k=c.transform,z=a.paint.get("fill-extrusion-pattern"),R=z.constantOr(1),j=a.getCrossfadeParameters(),K=a.paint.get("fill-extrusion-opacity"),Z=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),a.paint.get("fill-extrusion-ambient-occlusion-radius")],W=a.layout.get("fill-extrusion-edge-radius"),X=k.projection.name==="globe"?s.fillExtrusionHeightLift():0,G=k.projection.name==="globe",te=G?s.globeToMercatorTransition(k.zoom):0,Y=[s.mercatorXfromLng(k.center.lng),s.mercatorYfromLat(k.center.lat)],pe=[];G&&(pe.push("PROJECTION_GLOBE_VIEW"),c.style.terrainSetForDrapingOnly()&&pe.push("TERRAIN")),Z[0]>0&&pe.push("FAUX_AO");for(const he of d){const oe=n.getTile(he),fe=oe.getBucket(a);if(!fe||fe.projection.name!==k.projection.name)continue;const le=fe.programConfigurations.get(a.id),ve=c.useProgram(R?"fillExtrusionPattern":"fillExtrusion",le,pe);if(c.terrain){const qe=c.terrain;if(c.style.terrainSetForDrapingOnly())qe.setupElevationDraw(oe,ve,{useMeterToDem:!0});else{if(!fe.enableTerrain)continue;if(qe.setupElevationDraw(oe,ve,{useMeterToDem:!0}),Ca(T,n,he,fe,a,qe),!fe.centroidVertexBuffer){const mt=ve.attributes.a_centroid_pos;mt!==void 0&&C.vertexAttrib2f(mt,0,0)}}}R&&(c.context.activeTexture.set(C.TEXTURE0),oe.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),le.updatePaintBuffers(j));const Be=z.constantOr(null);if(Be&&oe.imageAtlas){const qe=oe.imageAtlas,mt=qe.patternPositions[Be.to.toString()],it=qe.patternPositions[Be.from.toString()];mt&&it&&le.setConstantPatternPositions(mt,it)}const dt=c.translatePosMatrix(he.projMatrix,oe,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Ae=k.projection.createInversionMatrix(k,he.canonical),Je=a.paint.get("fill-extrusion-vertical-gradient"),rt=R?Hh(dt,c,Je,K,Z,W,he,j,oe,X,te,Y,Ae):Ms(dt,c,Je,K,Z,W,he,X,te,Y,Ae);c.prepareDrawProgram(T,ve,he.toUnwrapped());const wt=[];c.terrain&&wt.push(fe.centroidVertexBuffer),G&&wt.push(fe.layoutVertexExtBuffer),ve.draw(T,T.gl.TRIANGLES,_,g,w,s.CullFaceMode.backCCW,rt,a.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,a.paint,c.transform.zoom,le,wt)}}function Ca(c,n,a,d,_,g){const w=[G=>{let te=G.canonical.x-1,Y=G.wrap;return te<0&&(te=(1<<G.canonical.z)-1,Y--),new s.OverscaledTileID(G.overscaledZ,Y,G.canonical.z,te,G.canonical.y)},G=>{let te=G.canonical.x+1,Y=G.wrap;return te===1<<G.canonical.z&&(te=0,Y++),new s.OverscaledTileID(G.overscaledZ,Y,G.canonical.z,te,G.canonical.y)},G=>new s.OverscaledTileID(G.overscaledZ,G.wrap,G.canonical.z,G.canonical.x,(G.canonical.y===0?1<<G.canonical.z:G.canonical.y)-1),G=>new s.OverscaledTileID(G.overscaledZ,G.wrap,G.canonical.z,G.canonical.x,G.canonical.y===(1<<G.canonical.z)-1?0:G.canonical.y+1)],T=G=>{const te=n.getSource().minzoom,Y=he=>{const oe=n.getTileByID(he);if(oe&&oe.hasData())return oe.getBucket(_)},pe=[0,-1,1];for(const he of pe){if(G.overscaledZ+he<te)continue;const oe=Y(G.calculateScaledKey(G.overscaledZ+he));if(oe)return oe}},C=[0,0,0],k=(G,te)=>(C[0]=Math.min(G.min.y,te.min.y),C[1]=Math.max(G.max.y,te.max.y),C[2]=s.EXTENT-te.min.x>G.max.x?te.min.x-s.EXTENT:G.max.x,C),z=(G,te)=>(C[0]=Math.min(G.min.x,te.min.x),C[1]=Math.max(G.max.x,te.max.x),C[2]=s.EXTENT-te.min.y>G.max.y?te.min.y-s.EXTENT:G.max.y,C),R=[(G,te)=>k(G,te),(G,te)=>k(te,G),(G,te)=>z(G,te),(G,te)=>z(te,G)],j=new s.pointGeometry(0,0);let K,Z,W;const X=(G,te,Y,pe,he)=>{const oe=[[pe?Y:G,pe?G:Y,0],[pe?Y:te,pe?te:Y,0]],fe=he<0?s.EXTENT+he:he,le=[pe?fe:(G+te)/2,pe?(G+te)/2:fe,0];return Y===0&&he<0||Y!==0&&he>0?g.getForTilePoints(W,[le],!0,Z):oe.push(le),g.getForTilePoints(a,oe,!0,K),Math.max(oe[0][2],oe[1][2],le[2])/g.exaggeration()};for(let G=0;G<4;G++){const te=(G<2?1:5)-G,Y=d.borders[G];if(Y.length===0)continue;const pe=W=w[G](a),he=T(pe);if(!(he&&he instanceof s.FillExtrusionBucket&&he.enableTerrain)||d.borderDoneWithNeighborZ[G]===he.canonical.z&&he.borderDoneWithNeighborZ[te]===d.canonical.z||(Z=g.findDEMTileFor(pe),!Z||!Z.dem))continue;if(!K){const ve=g.findDEMTileFor(a);if(!ve||!ve.dem)return;K=ve}const oe=he.borders[te];let fe=0;const le=he.borderDoneWithNeighborZ[te]!==d.canonical.z;if(d.canonical.z===he.canonical.z){for(let ve=0;ve<Y.length;ve++){const Be=d.featuresOnBorder[Y[ve]],dt=Be.borders[G];let Ae;for(;fe<oe.length&&(Ae=he.featuresOnBorder[oe[fe]],!(Ae.borders[te][1]>dt[0]+3));)le&&he.encodeCentroid(void 0,Ae,!1),fe++;if(Ae&&fe<oe.length){const Je=fe;let rt=0;for(;!(Ae.borders[te][0]>dt[1]-3)&&(rt++,++fe!==oe.length);)Ae=he.featuresOnBorder[oe[fe]];if(Ae=he.featuresOnBorder[oe[Je]],Be.intersectsCount()>1||Ae.intersectsCount()>1||rt!==1){rt!==1&&(fe=Je),d.encodeCentroid(void 0,Be,!1),le&&he.encodeCentroid(void 0,Ae,!1);continue}const wt=R[G](Be,Ae),qe=G%2?s.EXTENT-1:0;j.x=X(wt[0],Math.min(s.EXTENT-1,wt[1]),qe,G<2,wt[2]),j.y=0,d.encodeCentroid(j,Be,!1),le&&he.encodeCentroid(j,Ae,!1)}else d.encodeCentroid(void 0,Be,!1)}d.borderDoneWithNeighborZ[G]=he.canonical.z,d.needsCentroidUpdate=!0,le&&(he.borderDoneWithNeighborZ[te]=d.canonical.z,he.needsCentroidUpdate=!0)}else{for(const ve of Y)d.encodeCentroid(void 0,d.featuresOnBorder[ve],!1);if(le){for(const ve of oe)he.encodeCentroid(void 0,he.featuresOnBorder[ve],!1);he.borderDoneWithNeighborZ[te]=d.canonical.z,he.needsCentroidUpdate=!0}d.borderDoneWithNeighborZ[G]=he.canonical.z,d.needsCentroidUpdate=!0}}(d.needsCentroidUpdate||!d.centroidVertexBuffer&&d.centroidVertexArray.length!==0)&&d.uploadCentroid(c)}const nd=new s.Color(1,0,0,1),ks=new s.Color(0,1,0,1),zs=new s.Color(0,0,1,1),rd=new s.Color(1,0,1,1),pu=new s.Color(0,1,1,1);function Ri(c,n,a){const d=c.context,_=c.transform,g=d.gl,w=_.projection.name==="globe",T=w?["PROJECTION_GLOBE_VIEW"]:null;let C=a.projMatrix;if(w&&s.globeToMercatorTransition(_.zoom)>0){const Be=s.transitionTileAABBinECEF(a.canonical,_),dt=s.globeDenormalizeECEF(Be);C=s.multiply(new Float32Array(16),_.globeMatrix,dt),s.multiply(C,_.projMatrix,C)}const k=c.useProgram("debug",null,T),z=n.getTileByID(a.key);c.terrain&&c.terrain.setupElevationDraw(z,k);const R=s.DepthMode.disabled,j=s.StencilMode.disabled,K=c.colorModeForRenderPass(),Z="$debug";d.activeTexture.set(g.TEXTURE0),c.emptyTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),w?z._makeGlobeTileDebugBuffers(c.context,_):z._makeDebugTileBoundsBuffers(c.context,_.projection);const W=z._tileDebugBuffer||c.debugBuffer,X=z._tileDebugIndexBuffer||c.debugIndexBuffer,G=z._tileDebugSegments||c.debugSegments;k.draw(d,g.LINE_STRIP,R,j,K,s.CullFaceMode.disabled,Yh(C,s.Color.red),Z,W,X,G,null,null,null,[z._globeTileDebugBorderBuffer]);const te=z.latestRawTileData,Y=Math.floor((te&&te.byteLength||0)/1024),pe=n.getTile(a).tileSize,he=512/Math.min(pe,512)*(a.overscaledZ/_.zoom)*.5;let oe=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(oe+=` => ${a.overscaledZ}`),oe+=` ${Y}kb`,function(Be,dt){Be.initDebugOverlayCanvas();const Ae=Be.debugOverlayCanvas,Je=Be.context.gl,rt=Be.debugOverlayCanvas.getContext("2d");rt.clearRect(0,0,Ae.width,Ae.height),rt.shadowColor="white",rt.shadowBlur=2,rt.lineWidth=1.5,rt.strokeStyle="white",rt.textBaseline="top",rt.font="bold 36px Open Sans, sans-serif",rt.fillText(dt,5,5),rt.strokeText(dt,5,5),Be.debugOverlayTexture.update(Ae),Be.debugOverlayTexture.bind(Je.LINEAR,Je.CLAMP_TO_EDGE)}(c,oe);const fe=z._tileDebugTextBuffer||c.debugBuffer,le=z._tileDebugTextIndexBuffer||c.quadTriangleIndexBuffer,ve=z._tileDebugTextSegments||c.debugSegments;k.draw(d,g.TRIANGLES,R,j,s.ColorMode.alphaBlended,s.CullFaceMode.disabled,Yh(C,s.Color.transparent,he),Z,fe,le,ve,null,null,null,[z._globeTileDebugTextBuffer])}function Aa(c,n,a,d){Ma(c,0,n+a/2,c.transform.width,a,d)}function od(c,n,a,d){Ma(c,n-a/2,0,a,c.transform.height,d)}function Ma(c,n,a,d,_,g){const w=c.context,T=w.gl;T.enable(T.SCISSOR_TEST),T.scissor(n*s.exported.devicePixelRatio,a*s.exported.devicePixelRatio,d*s.exported.devicePixelRatio,_*s.exported.devicePixelRatio),w.clear({color:g}),T.disable(T.SCISSOR_TEST)}const Ia=s.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Rp}=Ia;function zo(c,n,a,d){c.emplaceBack(n,a,d)}class mu{constructor(n){this.vertexArray=new s.StructArrayLayout3f12,this.indices=new s.StructArrayLayout3ui6,zo(this.vertexArray,-1,-1,1),zo(this.vertexArray,1,-1,1),zo(this.vertexArray,-1,1,1),zo(this.vertexArray,1,1,1),zo(this.vertexArray,-1,-1,-1),zo(this.vertexArray,1,-1,-1),zo(this.vertexArray,-1,1,-1),zo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,Rp),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=s.SegmentVector.simpleSegment(0,0,36,12)}}function Ps(c,n,a,d,_,g){const w=c.gl,T=n.paint.get("sky-atmosphere-color"),C=n.paint.get("sky-atmosphere-halo-color"),k=n.paint.get("sky-atmosphere-sun-intensity"),z=((R,j,K,Z,W)=>({u_matrix_3f:R,u_sun_direction:j,u_sun_intensity:K,u_color_tint_r:[Z.r,Z.g,Z.b,Z.a],u_color_tint_m:[W.r,W.g,W.b,W.a],u_luminance:5e-5}))(s.fromMat4(s.create$1(),d),_,k,T,C);w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+g,n.skyboxTexture,0),a.draw(c,w.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.frontCW,z,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const _u=s.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ol{constructor(n){const a=new s.StructArrayLayout5f20;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);const d=new s.StructArrayLayout3ui6;d.emplaceBack(0,1,2),d.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(a,_u.members),this.indexBuffer=n.createIndexBuffer(d),this.segments=s.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Ds={symbol:function(c,n,a,d,_){if(c.renderPass!=="translucent")return;const g=s.StencilMode.disabled,w=c.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(T,C,k,z,R,j,K){const Z=C.transform,W=R==="map",X=j==="map";for(const G of T){const te=z.getTile(G),Y=te.getBucket(k);if(!Y||!Y.text||!Y.text.segments.get().length)continue;const pe=s.evaluateSizeForZoom(Y.textSizeData,Z.zoom),he=lr(G,Y.getProjection(),Z),oe=Z.calculatePixelsToTileUnitsMatrix(te),fe=gi(he,te.tileID.canonical,X,W,Z,Y.getProjection(),oe),le=k.layout.get("icon-text-fit")!=="none"&&Y.hasIconData();if(pe){const ve=Math.pow(2,Z.zoom-te.tileID.overscaledZ);hu(Y,W,X,K,s.symbolSize,Z,fe,G,ve,pe,le)}}}(d,c,a,n,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),_),a.paint.get("icon-opacity").constantOr(1)!==0&&du(c,n,a,d,!1,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),a.layout.get("icon-rotation-alignment"),a.layout.get("icon-pitch-alignment"),a.layout.get("icon-keep-upright"),g,w),a.paint.get("text-opacity").constantOr(1)!==0&&du(c,n,a,d,!0,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),a.layout.get("text-keep-upright"),g,w),n.map.showCollisionBoxes&&(ed(c,n,a,d,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),ed(c,n,a,d,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(c,n,a,d){if(c.renderPass!=="translucent")return;const _=a.paint.get("circle-opacity"),g=a.paint.get("circle-stroke-width"),w=a.paint.get("circle-stroke-opacity"),T=a.layout.get("circle-sort-key").constantOr(1)!==void 0;if(_.constantOr(1)===0&&(g.constantOr(1)===0||w.constantOr(1)===0))return;const C=c.context,k=C.gl,z=c.transform,R=c.depthModeForSublayer(0,s.DepthMode.ReadOnly),j=s.StencilMode.disabled,K=c.colorModeForRenderPass(),Z=z.projection.name==="globe",W=[s.mercatorXfromLng(z.center.lng),s.mercatorYfromLat(z.center.lat)],X=[];for(let te=0;te<d.length;te++){const Y=d[te],pe=n.getTile(Y),he=pe.getBucket(a);if(!he||he.projection.name!==z.projection.name)continue;const oe=he.programConfigurations.get(a.id),fe=Kh(a);Z&&fe.push("PROJECTION_GLOBE_VIEW");const le=c.useProgram("circle",oe,fe),ve=he.layoutVertexBuffer,Be=he.globeExtVertexBuffer,dt=he.indexBuffer,Ae=z.projection.createInversionMatrix(z,Y.canonical),Je={programConfiguration:oe,program:le,layoutVertexBuffer:ve,globeExtVertexBuffer:Be,indexBuffer:dt,uniformValues:ou(c,Y,pe,Ae,W,a),tile:pe};if(T){const rt=he.segments.get();for(const wt of rt)X.push({segments:new s.SegmentVector([wt]),sortKey:wt.sortKey,state:Je})}else X.push({segments:he.segments,sortKey:0,state:Je})}T&&X.sort((te,Y)=>te.sortKey-Y.sortKey);const G={useDepthForOcclusion:!Z};for(const te of X){const{programConfiguration:Y,program:pe,layoutVertexBuffer:he,globeExtVertexBuffer:oe,indexBuffer:fe,uniformValues:le,tile:ve}=te.state,Be=te.segments;c.terrain&&c.terrain.setupElevationDraw(ve,pe,G),c.prepareDrawProgram(C,pe,ve.tileID.toUnwrapped()),pe.draw(C,k.TRIANGLES,R,j,K,s.CullFaceMode.disabled,le,a.id,he,fe,Be,a.paint,z.zoom,Y,[oe])}},heatmap:function(c,n,a,d){if(a.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){const _=c.context,g=_.gl,w=s.StencilMode.disabled,T=new s.ColorMode([g.ONE,g.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(K,Z,W,X){const G=K.gl,te=Z.width*X,Y=Z.height*X;K.activeTexture.set(G.TEXTURE1),K.viewport.set([0,0,te,Y]);let pe=W.heatmapFbo;if(!pe||pe&&(pe.width!==te||pe.height!==Y)){pe&&pe.destroy();const he=G.createTexture();G.bindTexture(G.TEXTURE_2D,he),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MAG_FILTER,G.LINEAR),pe=W.heatmapFbo=K.createFramebuffer(te,Y,!1),function(oe,fe,le,ve,Be,dt){const Ae=oe.gl;Ae.texImage2D(Ae.TEXTURE_2D,0,Ae.RGBA,Be,dt,0,Ae.RGBA,oe.extRenderToTextureHalfFloat?oe.extTextureHalfFloat.HALF_FLOAT_OES:Ae.UNSIGNED_BYTE,null),ve.colorAttachment.set(le)}(K,0,he,pe,te,Y)}else G.bindTexture(G.TEXTURE_2D,pe.colorAttachment.get()),K.bindFramebuffer.set(pe.framebuffer)})(_,c,a,c.transform.projection.name==="globe"?.5:.25),_.clear({color:s.Color.transparent});const C=c.transform,k=C.projection.name==="globe",z=k?["PROJECTION_GLOBE_VIEW"]:null,R=k?s.CullFaceMode.frontCCW:s.CullFaceMode.disabled,j=[s.mercatorXfromLng(C.center.lng),s.mercatorYfromLat(C.center.lat)];for(let K=0;K<d.length;K++){const Z=d[K];if(n.hasRenderableParent(Z))continue;const W=n.getTile(Z),X=W.getBucket(a);if(!X||X.projection.name!==C.projection.name)continue;const G=X.programConfigurations.get(a.id),te=c.useProgram("heatmap",G,z),{zoom:Y}=c.transform;c.terrain&&c.terrain.setupElevationDraw(W,te),c.prepareDrawProgram(_,te,Z.toUnwrapped());const pe=C.projection.createInversionMatrix(C,Z.canonical);te.draw(_,g.TRIANGLES,s.DepthMode.disabled,w,T,R,kp(c,Z,W,pe,j,Y,a.paint.get("heatmap-intensity")),a.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,a.paint,c.transform.zoom,G,k?[X.globeExtVertexBuffer]:null)}_.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(_,g){const w=_.context,T=w.gl,C=g.heatmapFbo;if(!C)return;w.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,C.colorAttachment.get()),w.activeTexture.set(T.TEXTURE1);let k=g.colorRampTexture;k||(k=g.colorRampTexture=new s.Texture(w,g.colorRamp,T.RGBA)),k.bind(T.LINEAR,T.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(w,T.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,_.colorModeForRenderPass(),s.CullFaceMode.disabled,((z,R,j,K)=>({u_image:0,u_color_ramp:1,u_opacity:R.paint.get("heatmap-opacity")}))(0,g),g.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,g.paint,_.transform.zoom)}(c,a))},line:function(c,n,a,d){if(c.renderPass!=="translucent")return;const _=a.paint.get("line-opacity"),g=a.paint.get("line-width");if(_.constantOr(1)===0||g.constantOr(1)===0)return;const w=c.depthModeForSublayer(0,s.DepthMode.ReadOnly),T=c.colorModeForRenderPass(),C=c.terrain&&c.terrain.renderingToTexture?1:s.exported.devicePixelRatio,k=a.paint.get("line-dasharray"),z=k.constantOr(1),R=a.layout.get("line-cap"),j=a.paint.get("line-pattern"),K=j.constantOr(1),Z=a.paint.get("line-gradient"),W=a.getCrossfadeParameters(),X=K?"linePattern":"line",G=c.context,te=G.gl,Y=(he=>{const oe=[];Ll(he)&&oe.push("RENDER_LINE_DASH"),he.paint.get("line-gradient")&&oe.push("RENDER_LINE_GRADIENT");const fe=he.paint.get("line-trim-offset");fe[0]===0&&fe[1]===0||oe.push("RENDER_LINE_TRIM_OFFSET");const le=he.paint.get("line-pattern").constantOr(1),ve=he.paint.get("line-opacity").constantOr(1)!==1;return!le&&ve&&oe.push("RENDER_LINE_ALPHA_DISCARD"),oe})(a);let pe=Y.includes("RENDER_LINE_ALPHA_DISCARD");c.terrain&&c.terrain.clipOrMaskOverlapStencilType()&&(pe=!1);for(const he of d){const oe=n.getTile(he);if(K&&!oe.patternsLoaded())continue;const fe=oe.getBucket(a);if(!fe)continue;c.prepareDrawTile();const le=fe.programConfigurations.get(a.id),ve=c.useProgram(X,le,Y),Be=j.constantOr(null);if(Be&&oe.imageAtlas){const it=oe.imageAtlas,It=it.patternPositions[Be.to.toString()],St=it.patternPositions[Be.from.toString()];It&&St&&le.setConstantPatternPositions(It,St)}const dt=k.constantOr(null),Ae=R.constantOr(null);if(!K&&dt&&Ae&&oe.lineAtlas){const it=oe.lineAtlas,It=it.getDash(dt.to,Ae),St=it.getDash(dt.from,Ae);It&&St&&le.setConstantPatternPositions(It,St)}let[Je,rt]=a.paint.get("line-trim-offset");(Ae==="round"||Ae==="square")&&Je!==rt&&(Je===0&&(Je-=1),rt===1&&(rt+=1));const wt=c.terrain?he.projMatrix:null,qe=K?zp(c,oe,a,W,wt,C):Pl(c,oe,a,W,wt,fe.lineClipsArray.length,C,[Je,rt]);if(Z){const it=fe.gradients[a.id];let It=it.texture;if(a.gradientVersion!==it.version){let St=256;if(a.stepInterpolant){const Vt=n.getSource().maxzoom,Wt=he.canonical.z===Vt?Math.ceil(1<<c.transform.maxZoom-he.canonical.z):1;St=s.clamp(s.nextPowerOfTwo(fe.maxLineLength/s.EXTENT*1024*Wt),256,G.maxTextureSize)}it.gradient=s.renderColorRamp({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:St,image:it.gradient||void 0,clips:fe.lineClipsArray}),it.texture?it.texture.update(it.gradient):it.texture=new s.Texture(G,it.gradient,te.RGBA),it.version=a.gradientVersion,It=it.texture}G.activeTexture.set(te.TEXTURE1),It.bind(a.stepInterpolant?te.NEAREST:te.LINEAR,te.CLAMP_TO_EDGE)}z&&(G.activeTexture.set(te.TEXTURE0),oe.lineAtlasTexture.bind(te.LINEAR,te.REPEAT),le.updatePaintBuffers(W)),K&&(G.activeTexture.set(te.TEXTURE0),oe.imageAtlasTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE),le.updatePaintBuffers(W)),c.prepareDrawProgram(G,ve,he.toUnwrapped());const mt=it=>{ve.draw(G,te.TRIANGLES,w,it,T,s.CullFaceMode.disabled,qe,a.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,a.paint,c.transform.zoom,le,[fe.layoutVertexBuffer2])};if(pe){const it=c.stencilModeForClipping(he).ref;it===0&&c.terrain&&G.clear({stencil:0});const It={func:te.EQUAL,mask:255};qe.u_alpha_discard_threshold=.8,mt(new s.StencilMode(It,it,255,te.KEEP,te.KEEP,te.INVERT)),qe.u_alpha_discard_threshold=0,mt(new s.StencilMode(It,it,255,te.KEEP,te.KEEP,te.KEEP))}else mt(c.stencilModeForClipping(he))}pe&&(c.resetStencilClippingMasks(),c.terrain&&G.clear({stencil:0}))},fill:function(c,n,a,d){const _=a.paint.get("fill-color"),g=a.paint.get("fill-opacity");if(g.constantOr(1)===0)return;const w=c.colorModeForRenderPass(),T=a.paint.get("fill-pattern"),C=c.opaquePassEnabledForLayer()&&!T.constantOr(1)&&_.constantOr(s.Color.transparent).a===1&&g.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===C){const k=c.depthModeForSublayer(1,c.renderPass==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly);Fl(c,n,a,d,k,w,!1)}if(c.renderPass==="translucent"&&a.paint.get("fill-antialias")){const k=c.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,s.DepthMode.ReadOnly);Fl(c,n,a,d,k,w,!0)}},"fill-extrusion":function(c,n,a,d){const _=a.paint.get("fill-extrusion-opacity");if(_!==0&&c.renderPass==="translucent"){const g=new s.DepthMode(c.context.gl.LEQUAL,s.DepthMode.ReadWrite,c.depthRangeFor3D);if(_!==1||a.paint.get("fill-extrusion-pattern").constantOr(1))no(c,n,a,d,g,s.StencilMode.disabled,s.ColorMode.disabled),no(c,n,a,d,g,c.stencilModeFor3D(),c.colorModeForRenderPass()),c.resetStencilClippingMasks();else{const w=c.colorModeForRenderPass();no(c,n,a,d,g,s.StencilMode.disabled,w)}}},hillshade:function(c,n,a,d){if(c.renderPass!=="offscreen"&&c.renderPass!=="translucent")return;const _=c.context,g=c.depthModeForSublayer(0,s.DepthMode.ReadOnly),w=c.colorModeForRenderPass(),T=c.terrain&&c.terrain.renderingToTexture,[C,k]=c.renderPass!=="translucent"||T?[{},d]:c.stencilConfigForOverlap(d);for(const z of k){const R=n.getTile(z);if(R.needsHillshadePrepare&&c.renderPass==="offscreen")As(c,R,a,g,s.StencilMode.disabled,w);else if(c.renderPass==="translucent"){const j=T&&c.terrain?c.terrain.stencilModeForRTTOverlap(z):C[z.overscaledZ];Kc(c,z,R,a,g,j,w)}}_.viewport.set([0,0,c.width,c.height]),c.resetStencilClippingMasks()},raster:function(c,n,a,d,_,g){if(c.renderPass!=="translucent"||a.paint.get("raster-opacity")===0||!d.length)return;const w=c.context,T=w.gl,C=n.getSource(),k=c.useProgram("raster"),z=c.colorModeForRenderPass(),R=c.terrain&&c.terrain.renderingToTexture,[j,K]=C instanceof Se||R?[{},d]:c.stencilConfigForOverlap(d),Z=K[K.length-1].overscaledZ,W=!c.options.moving;for(const X of K){const G=R?s.DepthMode.disabled:c.depthModeForSublayer(X.overscaledZ-Z,a.paint.get("raster-opacity")===1?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly,T.LESS),te=X.toUnwrapped(),Y=n.getTile(X);if(R&&(!Y||!Y.hasData()))continue;const pe=R?X.projMatrix:c.transform.calculateProjMatrix(te,W),he=c.terrain&&R?c.terrain.stencilModeForRTTOverlap(X):j[X.overscaledZ],oe=g?0:a.paint.get("raster-fade-duration");Y.registerFadeDuration(oe);const fe=n.findLoadedParent(X,0),le=Il(Y,fe,n,c.transform,oe);let ve,Be;c.terrain&&c.terrain.prepareDrawTile();const dt=a.paint.get("raster-resampling")==="nearest"?T.NEAREST:T.LINEAR;w.activeTexture.set(T.TEXTURE0),Y.texture.bind(dt,T.CLAMP_TO_EDGE),w.activeTexture.set(T.TEXTURE1),fe?(fe.texture.bind(dt,T.CLAMP_TO_EDGE),ve=Math.pow(2,fe.tileID.overscaledZ-Y.tileID.overscaledZ),Be=[Y.tileID.canonical.x*ve%1,Y.tileID.canonical.y*ve%1]):Y.texture.bind(dt,T.CLAMP_TO_EDGE);const Ae=Pp(pe,Be||[0,0],ve||1,le,a,C instanceof Se?C.perspectiveTransform:[0,0]);if(c.prepareDrawProgram(w,k,te),C instanceof Se)C.boundsBuffer&&C.boundsSegments&&k.draw(w,T.TRIANGLES,G,s.StencilMode.disabled,z,s.CullFaceMode.disabled,Ae,a.id,C.boundsBuffer,c.quadTriangleIndexBuffer,C.boundsSegments);else{const{tileBoundsBuffer:Je,tileBoundsIndexBuffer:rt,tileBoundsSegments:wt}=c.getTileBoundsBuffers(Y);k.draw(w,T.TRIANGLES,G,he,z,s.CullFaceMode.disabled,Ae,a.id,Je,rt,wt)}}c.resetStencilClippingMasks()},background:function(c,n,a,d){const _=a.paint.get("background-color"),g=a.paint.get("background-opacity");if(g===0)return;const w=c.context,T=w.gl,C=c.transform,k=C.tileSize,z=a.paint.get("background-pattern");if(c.isPatternMissing(z))return;const R=!z&&_.a===1&&g===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass!==R)return;const j=s.StencilMode.disabled,K=c.depthModeForSublayer(0,R==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly),Z=c.colorModeForRenderPass(),W=c.useProgram(z?"backgroundPattern":"background");let X,G=d;G||(X=c.getBackgroundTiles(),G=Object.values(X).map(Y=>Y.tileID)),z&&(w.activeTexture.set(T.TEXTURE0),c.imageManager.bind(c.context));const te=a.getCrossfadeParameters();for(const Y of G){const pe=Y.toUnwrapped(),he=d?Y.projMatrix:c.transform.calculateProjMatrix(pe);c.prepareDrawTile();const oe=n?n.getTile(Y):X?X[Y.key]:new s.Tile(Y,k,C.zoom,c),fe=z?Lp(he,g,c,z,{tileID:Y,tileSize:k},te):Dp(he,g,_);c.prepareDrawProgram(w,W,pe);const{tileBoundsBuffer:le,tileBoundsIndexBuffer:ve,tileBoundsSegments:Be}=c.getTileBoundsBuffers(oe);W.draw(w,T.TRIANGLES,K,j,Z,s.CullFaceMode.disabled,fe,a.id,le,ve,Be)}},sky:function(c,n,a){const d=c.transform,_=d.projection.name==="mercator"||d.projection.name==="globe"?1:s.smoothstep(7,8,d.zoom),g=a.paint.get("sky-opacity")*_;if(g===0)return;const w=c.context,T=a.paint.get("sky-type"),C=new s.DepthMode(w.gl.LEQUAL,s.DepthMode.ReadOnly,[0,1]),k=c.frameCounter/1e3%1;T==="atmosphere"?c.renderPass==="offscreen"?a.needsSkyboxCapture(c)&&(function(z,R,j,K){const Z=z.context,W=Z.gl;let X=R.skyboxFbo;if(!X){X=R.skyboxFbo=Z.createFramebuffer(32,32,!1),R.skyboxGeometry=new mu(Z),R.skyboxTexture=Z.gl.createTexture(),W.bindTexture(W.TEXTURE_CUBE_MAP,R.skyboxTexture),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MAG_FILTER,W.LINEAR);for(let pe=0;pe<6;++pe)W.texImage2D(W.TEXTURE_CUBE_MAP_POSITIVE_X+pe,0,W.RGBA,32,32,0,W.RGBA,W.UNSIGNED_BYTE,null)}Z.bindFramebuffer.set(X.framebuffer),Z.viewport.set([0,0,32,32]);const G=R.getCenter(z,!0),te=z.useProgram("skyboxCapture"),Y=new Float64Array(16);s.identity(Y),s.rotateY(Y,Y,.5*-Math.PI),Ps(Z,R,te,Y,G,0),s.identity(Y),s.rotateY(Y,Y,.5*Math.PI),Ps(Z,R,te,Y,G,1),s.identity(Y),s.rotateX(Y,Y,.5*-Math.PI),Ps(Z,R,te,Y,G,2),s.identity(Y),s.rotateX(Y,Y,.5*Math.PI),Ps(Z,R,te,Y,G,3),s.identity(Y),Ps(Z,R,te,Y,G,4),s.identity(Y),s.rotateY(Y,Y,Math.PI),Ps(Z,R,te,Y,G,5),Z.viewport.set([0,0,z.width,z.height])}(c,a),a.markSkyboxValid(c)):c.renderPass==="sky"&&function(z,R,j,K,Z){const W=z.context,X=W.gl,G=z.transform,te=z.useProgram("skybox");W.activeTexture.set(X.TEXTURE0),X.bindTexture(X.TEXTURE_CUBE_MAP,R.skyboxTexture);const Y=((pe,he,oe,fe,le)=>({u_matrix:pe,u_sun_direction:he,u_cubemap:0,u_opacity:fe,u_temporal_offset:le}))(G.skyboxMatrix,R.getCenter(z,!1),0,K,Z);z.prepareDrawProgram(W,te),te.draw(W,X.TRIANGLES,j,s.StencilMode.disabled,z.colorModeForRenderPass(),s.CullFaceMode.backCW,Y,"skybox",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(c,a,C,g,k):T==="gradient"&&c.renderPass==="sky"&&function(z,R,j,K,Z){const W=z.context,X=W.gl,G=z.transform,te=z.useProgram("skyboxGradient");R.skyboxGeometry||(R.skyboxGeometry=new mu(W)),W.activeTexture.set(X.TEXTURE0);let Y=R.colorRampTexture;Y||(Y=R.colorRampTexture=new s.Texture(W,R.colorRamp,X.RGBA)),Y.bind(X.LINEAR,X.CLAMP_TO_EDGE);const pe=((he,oe,fe,le,ve)=>({u_matrix:he,u_color_ramp:0,u_center_direction:oe,u_radius:s.degToRad(fe),u_opacity:le,u_temporal_offset:ve}))(G.skyboxMatrix,R.getCenter(z,!1),R.paint.get("sky-gradient-radius"),K,Z);z.prepareDrawProgram(W,te),te.draw(W,X.TRIANGLES,j,s.StencilMode.disabled,z.colorModeForRenderPass(),s.CullFaceMode.backCW,pe,"skyboxGradient",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(c,a,C,g,k)},debug:function(c,n,a){for(let d=0;d<a.length;d++)Ri(c,n,a[d])},custom:function(c,n,a){const d=c.context,_=a.implementation;if(c.transform.projection.unsupportedLayers&&c.transform.projection.unsupportedLayers.includes("custom"))s.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(c.renderPass==="offscreen"){const g=_.prerender;g&&(c.setCustomLayerDefaults(),d.setColorMode(c.colorModeForRenderPass()),g.call(_,d.gl,c.transform.customLayerMatrix()),d.setDirty(),c.setBaseState())}else if(c.renderPass==="translucent"){c.setCustomLayerDefaults(),d.setColorMode(c.colorModeForRenderPass()),d.setStencilMode(s.StencilMode.disabled);const g=_.renderingMode==="3d"?new s.DepthMode(c.context.gl.LEQUAL,s.DepthMode.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,s.DepthMode.ReadOnly);d.setDepthMode(g),_.render(d.gl,c.transform.customLayerMatrix()),d.setDirty(),c.setBaseState(),d.bindFramebuffer.set(null)}}};class gu{constructor(n,a){this.context=new J(n),this.transform=a,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=s.SourceCache.maxUnderzooming+s.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new wl,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(n,a){const d=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(d||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Zh(this,n));const _=this._terrain;this.transform.elevation=d?_:null,_.update(n,this.transform,a)}_updateFog(n){const a=n.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[d,_]=a.getFovAdjustedRange(this.transform._fov);if(d>_)return void(this.transform.fogCullDistSq=null);const g=d+.78*(_-d);this.transform.fogCullDistSq=g*g}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(n,a){if(this.width=n*s.exported.devicePixelRatio,this.height=a*s.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style.order)this.style._layers[d].resize()}setup(){const n=this.context,a=new s.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(s.EXTENT,0),a.emplaceBack(0,s.EXTENT),a.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(a,s.posAttributes.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);const d=new s.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(s.EXTENT,0),d.emplaceBack(0,s.EXTENT),d.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=n.createVertexBuffer(d,s.posAttributes.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);const _=new s.StructArrayLayout2i4;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(_,s.posAttributes.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);const g=new s.StructArrayLayout4i8;g.emplaceBack(0,0,0,0),g.emplaceBack(s.EXTENT,0,s.EXTENT,0),g.emplaceBack(0,s.EXTENT,0,s.EXTENT),g.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.mercatorBoundsBuffer=n.createVertexBuffer(g,s.boundsAttributes.members),this.mercatorBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);const w=new s.StructArrayLayout3ui6;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(w);const T=new s.StructArrayLayout1ui2;for(const k of[0,1,3,2,0])T.emplaceBack(k);this.debugIndexBuffer=n.createIndexBuffer(T),this.emptyTexture=new s.Texture(n,new s.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA),this.identityMat=s.create();const C=this.context.gl;this.stencilClearMode=new s.StencilMode({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.loadTimeStamps.push(s.window.performance.now()),this.atmosphereBuffer=new Ol(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context,a=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(n,a.TRIANGLES,s.DepthMode.disabled,this.stencilClearMode,s.ColorMode.disabled,s.CullFaceMode.disabled,eu(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,a,d){if(!a||this.currentStencilSource===a.id||!n.isTileClipped()||!d||d.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let T=!1;for(const C of d)if(this._tileClippingMaskIDs[C.key]===void 0){T=!0;break}if(!T)return}this.currentStencilSource=a.id;const _=this.context,g=_.gl;this.nextStencilID+d.length>256&&this.clearStencil(),_.setColorMode(s.ColorMode.disabled),_.setDepthMode(s.DepthMode.disabled);const w=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const T of d){const C=a.getTile(T),k=this._tileClippingMaskIDs[T.key]=this.nextStencilID++,{tileBoundsBuffer:z,tileBoundsIndexBuffer:R,tileBoundsSegments:j}=this.getTileBoundsBuffers(C);w.draw(_,g.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:g.ALWAYS,mask:0},k,255,g.KEEP,g.KEEP,g.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,eu(T.projMatrix),"$clipping",z,R,j)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,a=this.context.gl;return new s.StencilMode({func:a.NOTEQUAL,mask:255},n,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const a=this.context.gl;return new s.StencilMode({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(n){const a=this.context.gl,d=n.sort((w,T)=>T.overscaledZ-w.overscaledZ),_=d[d.length-1].overscaledZ,g=d[0].overscaledZ-_+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const w={};for(let T=0;T<g;T++)w[T+_]=new s.StencilMode({func:a.GEQUAL,mask:255},T+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=g,[w,d]}return[{[_]:s.StencilMode.disabled},d]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new s.ColorMode([n.CONSTANT_COLOR,n.ONE],new s.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?s.ColorMode.unblended:s.ColorMode.alphaBlended}depthModeForSublayer(n,a,d){if(!this.opaquePassEnabledForLayer())return s.DepthMode.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new s.DepthMode(d||this.context.gl.LEQUAL,a,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,a){this.style=n,this.options=a,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(s.exported.now()),this.imageManager.beginFrame();const d=this.style.order,_=this.style._sourceCaches;for(const C in _){const k=_[C];k.used&&k.prepare(this.context)}const g={},w={},T={};for(const C in _){const k=_[C];g[C]=k.getVisibleCoordinates(),w[C]=g[C].slice().reverse(),T[C]=k.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let C=0;C<d.length;C++)if(this.style._layers[d[C]].is3D()){this.opaquePassCutoff=C;break}if(this.terrain&&(this.terrain.updateTileBinding(T),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.GlobeSharedBuffers(this.context)),s.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const C of d){const k=this.style._layers[C],z=n._getLayerSourceCache(k);if(!k.hasOffscreenPass()||k.isHidden(this.transform.zoom))continue;const R=z?w[z.id]:void 0;(k.type==="custom"||k.isSky()||R&&R.length)&&this.renderLayer(this,z,k,R)}if(this.depthRangeFor3D=[0,1-(n.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:a.showOverdrawInspector?s.Color.black:s.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){const C=this.style._layers[d[this.currentLayer]],k=n._getLayerSourceCache(C);if(C.isSky())continue;const z=k?w[k.id]:void 0;this._renderTileClippingMasks(C,k,z),this.renderLayer(this,k,C,z)}if(this.style.fog&&this.transform.projection.supportsFog&&function(C,k){const z=C.context,R=z.gl,j=C.transform,K=new s.DepthMode(R.LEQUAL,s.DepthMode.ReadOnly,[0,1]),Z=C.useProgram("globeAtmosphere",null,j.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),W=s.globeToMercatorTransition(j.zoom),X=k.properties.get("color").toArray01(),G=k.properties.get("high-color").toArray01(),te=k.properties.get("space-color").toArray01PremultipliedAlpha(),Y=s.identity$1([]);s.rotateY$1(Y,Y,-s.degToRad(j._center.lng)),s.rotateX$1(Y,Y,s.degToRad(j._center.lat)),s.rotateZ$1(Y,Y,j.angle),s.rotateX$1(Y,Y,-j._pitch);const pe=s.fromQuat(new Float32Array(16),Y),he=s.mapValue(k.properties.get("star-intensity"),0,1,0,.25),oe=5e-4,fe=s.mapValue(k.properties.get("horizon-blend"),0,1,oe,.25),le=s.globeUseCustomAntiAliasing(C,z,j)&&fe===oe?j.worldSize/(2*Math.PI*1.025)-1:j.globeRadius,ve=C.frameCounter/1e3%1,Be=s.length(j.globeCenterInViewSpace),dt=Math.sqrt(Math.pow(Be,2)-Math.pow(le,2)),Ae=Math.acos(dt/Be),Je=((wt,qe,mt,it,It,St,Vt,Wt,ii,xi,Ut,ai,Ii,Qi)=>({u_frustum_tl:wt,u_frustum_tr:qe,u_frustum_br:mt,u_frustum_bl:it,u_horizon:It,u_transition:St,u_fadeout_range:Vt,u_color:Wt,u_high_color:ii,u_space_color:xi,u_star_intensity:Ut,u_star_size:5*s.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:ai,u_horizon_angle:Ii,u_rotation_matrix:Qi}))(j.frustumCorners.TL,j.frustumCorners.TR,j.frustumCorners.BR,j.frustumCorners.BL,j.frustumCorners.horizon,W,fe,X,G,te,he,ve,Ae,pe);C.prepareDrawProgram(z,Z);const rt=C.atmosphereBuffer;rt&&Z.draw(z,R.TRIANGLES,K,s.StencilMode.disabled,s.ColorMode.alphaBlended,s.CullFaceMode.backCW,Je,"skybox",rt.vertexBuffer,rt.indexBuffer,rt.segments)}(this,this.style.fog),this.renderPass="sky",(s.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){const C=this.style._layers[d[this.currentLayer]],k=n._getLayerSourceCache(C);C.isSky()&&this.renderLayer(this,k,C,k?w[k.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;){const C=this.style._layers[d[this.currentLayer]],k=n._getLayerSourceCache(C);if(C.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(C)){if(C.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const z=k?(C.type==="symbol"?T:w)[k.id]:void 0;this._renderTileClippingMasks(C,k,k?g[k.id]:void 0),this.renderLayer(this,k,C,z),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let C=null;s.values(this.style._layers).forEach(k=>{const z=n._getLayerSourceCache(k);z&&!k.isHidden(this.transform.zoom)&&(!C||C.getSource().maxzoom<z.getSource().maxzoom)&&(C=z)}),C&&this.options.showTileBoundaries&&Ds.debug(this,C,C.getVisibleCoordinates())}this.options.showPadding&&function(C){const k=C.transform.padding;Aa(C,C.transform.height-(k.top||0),3,nd),Aa(C,k.bottom||0,3,ks),od(C,k.left||0,3,zs),od(C,C.transform.width-(k.right||0),3,rd);const z=C.transform.centerPoint;(function(R,j,K,Z){Ma(R,j-1,K-10,2,20,Z),Ma(R,j-10,K-1,20,2,Z)})(C,z.x,C.transform.height-z.y,pu)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(s.window.performance.now()),this.saveCanvasCopy())}}renderLayer(n,a,d,_){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="sky"||d.type==="custom"||_&&_.length)&&(this.id=d.id,this.gpuTimingStart(d),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(d.type)||Ds[d.type](n,a,d,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;let d=this.gpuTimers[n.id];d||(d=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:a.createQueryEXT()}),d.calls++,a.beginQueryEXT(a.TIME_ELAPSED_EXT,d.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,a=n.createQueryEXT();this.deferredRenderGpuTimeQueries.push(a),n.beginQueryEXT(n.TIME_ELAPSED_EXT,a)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const a={};for(const d in n){const _=n[d],g=this.context.extTimerQuery,w=g.getQueryObjectEXT(_.query,g.QUERY_RESULT_EXT)/1e6;g.deleteQueryEXT(_.query),a[d]=w}return a}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const a=this.context.extTimerQuery;let d=0;for(const _ of n)d+=a.getQueryObjectEXT(_,a.QUERY_RESULT_EXT)/1e6,a.deleteQueryEXT(_);return d}translatePosMatrix(n,a,d,_,g){if(!d[0]&&!d[1])return n;const w=g?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(w){const k=Math.sin(w),z=Math.cos(w);d=[d[0]*z-d[1]*k,d[0]*k+d[1]*z]}const T=[g?d[0]:pi(a,d[0],this.transform.zoom),g?d[1]:pi(a,d[1],this.transform.zoom),0],C=new Float32Array(16);return s.translate(C,n,T),C}saveTileTexture(n){const a=this._tileTextures[n.size[0]];a?a.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const a=this._tileTextures[n];return a&&a.length>0?a.pop():null}isPatternMissing(n){if(!n)return!1;if(!n.from||!n.to)return!0;const a=this.imageManager.getPattern(n.from.toString()),d=this.imageManager.getPattern(n.to.toString());return!a||!d}currentGlobalDefines(){const n=this.terrain&&this.terrain.renderingToTexture,a=this.style&&this.style.fog,d=[];return this.terrain&&!this.terrain.renderingToTexture&&d.push("TERRAIN"),a&&!n&&a.getOpacity(this.transform.pitch)!==0&&d.push("FOG"),n&&d.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&d.push("OVERDRAW_INSPECTOR"),d}useProgram(n,a,d){this.cache=this.cache||{};const _=d||[],g=this.currentGlobalDefines().concat(_),w=nu.cacheKey(Al[n],n,g,a);return this.cache[w]||(this.cache[w]=new nu(this.context,n,Al[n],a,Bp[n],g)),this.cache[w]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=s.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(n,a,d){if(this.terrain&&this.terrain.renderingToTexture)return;const _=this.style.fog;if(_){const g=_.getOpacity(this.transform.pitch),w=((T,C,k,z,R,j,K,Z,W,X,G)=>{const te=T.transform,Y=C.properties.get("color").toArray01();Y[3]=z;const pe=T.frameCounter/1e3%1;return{u_fog_matrix:k?te.calculateFogTileMatrix(k):T.identityMat,u_fog_range:C.getFovAdjustedRange(te._fov),u_fog_color:Y,u_fog_horizon_blend:C.properties.get("horizon-blend"),u_fog_temporal_offset:pe,u_frustum_tl:R,u_frustum_tr:j,u_frustum_br:K,u_frustum_bl:Z,u_globe_pos:W,u_globe_radius:X,u_viewport:G,u_globe_transition:s.globeToMercatorTransition(te.zoom),u_is_globe:+(te.projection.name==="globe")}})(this,_,d,g,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.exported.devicePixelRatio,this.transform.height*s.exported.devicePixelRatio]);a.setFogUniformValues(n,w)}}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const n=this.context.gl,a=n.createTexture();return n.bindTexture(n.TEXTURE_2D,a),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,a=this._backgroundTiles={},d=this.transform.coveringTiles({tileSize:512});for(const _ of d)a[_.key]=n[_.key]||new s.Tile(_,512,this.transform.tileZoom,this);return a}clearBackgroundTiles(){this._backgroundTiles={}}}class ka{constructor(n=0,a=0,d=0,_=0){if(isNaN(n)||n<0||isNaN(a)||a<0||isNaN(d)||d<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=a,this.left=d,this.right=_}interpolate(n,a,d){return a.top!=null&&n.top!=null&&(this.top=s.number(n.top,a.top,d)),a.bottom!=null&&n.bottom!=null&&(this.bottom=s.number(n.bottom,a.bottom,d)),a.left!=null&&n.left!=null&&(this.left=s.number(n.left,a.left,d)),a.right!=null&&n.right!=null&&(this.right=s.number(n.right,a.right,d)),this}getCenter(n,a){const d=s.clamp((this.left+n-this.right)/2,0,n),_=s.clamp((this.top+a-this.bottom)/2,0,a);return new s.pointGeometry(d,_)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new ka(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function yu(c,n){const a=s.getColumn(c,3);s.fromQuat(c,n),s.setColumn(c,3,a)}function Ls(c,n){const a=s.identity$1([]);return s.rotateZ$1(a,a,-n),s.rotateX$1(a,a,-c),a}function Bs(c,n){const a=[c[0],c[1],0],d=[n[0],n[1],0];if(s.length(a)>=1e-15){const w=s.normalize([],a);s.scale$2(d,w,s.dot(d,w)),n[0]=d[0],n[1]=d[1]}const _=s.cross([],n,c);if(s.len(_)<1e-15)return null;const g=Math.atan2(-_[1],_[0]);return Ls(Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2]),g)}class Pt{constructor(n,a){this.position=n,this.orientation=a}get position(){return this._position}set position(n){if(n){const a=n instanceof s.MercatorCoordinate?n:new s.MercatorCoordinate(n[0],n[1],n[2]);this._renderWorldCopies&&(a.x=s.wrap(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(n,a){if(this.orientation=null,!this.position)return;const d=this._elevation?this._elevation.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(n)):0,_=this.position,g=s.MercatorCoordinate.fromLngLat(n,d),w=[g.x-_.x,g.y-_.y,g.z-_.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=Bs(w,a)}setPitchBearing(n,a){this.orientation=Ls(s.degToRad(n),s.degToRad(-a))}}class yr{constructor(n,a){this._transform=s.identity([]),this.orientation=a,this.position=n}get mercatorPosition(){const n=this.position;return new s.MercatorCoordinate(n[0],n[1],n[2])}get position(){const n=s.getColumn(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var a;n&&s.setColumn(this._transform,3,[(a=n)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||s.identity$1([]),n&&yu(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,a){this._orientation=Ls(n,a),yu(this._transform,this._orientation)}forward(){const n=s.getColumn(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=s.getColumn(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=s.getColumn(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,a){const d=new Float64Array(16);return s.invert(d,this.getWorldToCamera(n,a)),d}getWorldToCameraPosition(n,a,d){const _=this.position;s.scale$2(_,_,-n);const g=new Float64Array(16);return s.fromScaling(g,[d,d,d]),s.translate(g,g,_),g[10]*=a,g}getWorldToCamera(n,a){const d=new Float64Array(16),_=new Float64Array(4),g=this.position;return s.conjugate(_,this._orientation),s.scale$2(g,g,-n),s.fromQuat(d,_),s.translate(d,d,g),d[1]*=-1,d[5]*=-1,d[9]*=-1,d[13]*=-1,d[8]*=a,d[9]*=a,d[10]*=a,d[11]*=a,d}getCameraToClipPerspective(n,a,d,_){const g=new Float64Array(16);return s.perspective(g,n,a,d,_),g}getDistanceToElevation(n){const a=n===0?0:s.mercatorZfromAltitude(n,this.position[1]),d=this.forward();return(a-this.position[2])/d[2]}clone(){return new yr([...this.position],[...this.orientation])}}function vu(c,n){const a=za(c.projection,c.zoom,c.width,c.height),d=function(g,w,T,C,k){const z=new s.LngLat(T.lng-180*Or,T.lat),R=new s.LngLat(T.lng+180*Or,T.lat),j=g.project(z.lng,z.lat),K=g.project(R.lng,R.lat),Z=-Math.atan2(K.y-j.y,K.x-j.x),W=s.MercatorCoordinate.fromLngLat(T);W.y=s.clamp(W.y,-.999975,.999975);const X=W.toLngLat(),G=g.project(X.lng,X.lat),te=s.MercatorCoordinate.fromLngLat(X);te.x+=Or;const Y=te.toLngLat(),pe=g.project(Y.lng,Y.lat),he=Pa(pe.x-G.x,pe.y-G.y,Z),oe=s.MercatorCoordinate.fromLngLat(X);oe.y+=Or;const fe=oe.toLngLat(),le=g.project(fe.lng,fe.lat),ve=Pa(le.x-G.x,le.y-G.y,Z),Be=Math.abs(he.x)/Math.abs(ve.y),dt=s.identity([]);s.rotateZ(dt,dt,-Z*(1-(k?0:C)));const Ae=s.identity([]);return s.scale(Ae,Ae,[1,1-(1-Be)*C,1]),Ae[4]=-ve.x/ve.y*C,s.rotateZ(Ae,Ae,Z),s.multiply(Ae,dt,Ae),Ae}(c.projection,0,c.center,a,n),_=xu(c);return s.scale(d,d,[_,_,1]),d}function xu(c){const n=c.projection,a=za(c.projection,c.zoom,c.width,c.height),d=bu(n,c.center),_=bu(n,s.LngLat.convert(n.center));return Math.pow(2,d*a+(1-a)*_)}function za(c,n,a,d,_=1/0){const g=c.range;if(!g)return 0;const w=Math.min(_,Math.max(a,d)),T=Math.log(w/1024)/Math.LN2;return s.smoothstep(g[0]+T,g[1]+T,n)}const Or=1/4e4;function bu(c,n){const a=s.clamp(n.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),d=new s.LngLat(n.lng-180*Or,a),_=new s.LngLat(n.lng+180*Or,a),g=c.project(d.lng,a),w=c.project(_.lng,a),T=s.MercatorCoordinate.fromLngLat(d),C=s.MercatorCoordinate.fromLngLat(_),k=w.x-g.x,z=w.y-g.y,R=C.x-T.x,j=C.y-T.y,K=Math.sqrt((R*R+j*j)/(k*k+z*z));return Math.log(K)/Math.LN2}function Pa(c,n,a){const d=Math.cos(a),_=Math.sin(a);return{x:c*d-n*_,y:c*_+n*d}}class Da{constructor(n,a,d,_,g,w,T){this.tileSize=512,this._renderWorldCopies=g===void 0||g,this._minZoom=n||0,this._maxZoom=a||22,this._minPitch=d==null?0:d,this._maxPitch=_==null?60:_,this.setProjection(w),this.setMaxBounds(T),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ka,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new yr,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const n=new Da(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(n){const a=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||a)&&this._updateCameraOnTerrain(),(n||a)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return s.pick(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const a=this.projection?this.getProjection():void 0;this.projection=s.getProjection(this.projectionOptions);const d=!D(a,this.getProjection());return d&&this._calcMatrices(),this.mercatorFromTransition=!1,d}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.getProjection({name:"mercator"});const a=n!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.pointGeometry(this.width,this.height)}get bearing(){return s.wrap(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const a=-n*Math.PI/180;var d;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=(d=new s.ARRAY_TYPE(4),s.ARRAY_TYPE!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d),function(_,g,w){var T=g[0],C=g[1],k=g[2],z=g[3],R=Math.sin(w),j=Math.cos(w);_[0]=T*j+k*R,_[1]=C*j+z*R,_[2]=T*-R+k*j,_[3]=C*-R+z*j}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const a=s.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=n/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const a=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const n=this._elevation;this._centerAltitude=n.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=n.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],d=this.horizonLineFromTop();let _=0,g=0;for(let w=0;w<a.length;w++){const T=new s.pointGeometry(a[w][0]*this.width,d+a[w][1]*(this.height-d)),C=n.pointCoordinate(T);if(!C)continue;const k=1/Math.hypot(C[0]-this._camera.position[0],C[1]-this._camera.position[1]);_+=C[3]*k,g+=k}return g===0?NaN:_/g}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),d=this.pixelsPerMeter/this.worldSize*a,_=this._mercatorZfromZoom(n),g=this._mercatorZfromZoom(this._maxZoom),w=Math.max(_-d,g);this._setZoom(this._zoomFromMercatorZ(w))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let d;d=n.z<this._camera.position[2]?[a.x,a.y,a.z]:[n.x,n.y,n.z];const _=s.length(s.sub([],this._camera.position,d));return s.clamp(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let a=!1;if(n.orientation&&!s.exactEquals(n.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(n.orientation)),n.position){const d=[n.position.x,n.position.y,n.position.z];s.exactEquals$1(d,this._camera.position)||(this._setCameraPosition(d),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,a=new Pt;return a.position=new s.MercatorCoordinate(n[0],n[1],n[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(n){if(!s.length$1(n))return!1;s.normalize$1(n,n);const a=s.transformQuat([],[0,0,-1],n),d=s.transformQuat([],[0,-1,0],n);if(d[2]<0)return!1;const _=Bs(a,d);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(n){const a=this.zoomScale(this.minZoom)*this.tileSize,d=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;n[2]=s.clamp(n[2],_/d,_/a),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,a,d){this._unmodified=!1,this._edgeInsets.interpolate(n,a,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const a=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(n){const a=[new s.UnwrappedTileID(0,n)];if(this.renderWorldCopies){const d=this.pointCoordinate(new s.pointGeometry(0,0)),_=this.pointCoordinate(new s.pointGeometry(this.width,0)),g=this.pointCoordinate(new s.pointGeometry(this.width,this.height)),w=this.pointCoordinate(new s.pointGeometry(0,this.height)),T=Math.floor(Math.min(d.x,_.x,g.x,w.x)),C=Math.floor(Math.max(d.x,_.x,g.x,w.x)),k=1;for(let z=T-k;z<=C+k;z++)z!==0&&a.push(new s.UnwrappedTileID(z,n))}return a}coveringTiles(n){let a=this.coveringZoomLevel(n);const d=a,_=this.elevation&&!n.isTerrainDEM,g=this.projection.name==="mercator";if(n.minzoom!==void 0&&a<n.minzoom)return[];n.maxzoom!==void 0&&a>n.maxzoom&&(a=n.maxzoom);const w=this.locationCoordinate(this.center),T=this.center.lat,C=1<<a,k=[C*w.x,C*w.y,0],z=this.projection.name==="globe",R=!z,j=s.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,R),K=z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Z=C*s.mercatorZfromAltitude(1,this.center.lat),W=this._camera.position[2]/s.mercatorZfromAltitude(1,this.center.lat),X=[C*K.x,C*K.y,W*(R?1:Z)],G=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),te=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?a:0,Y=n.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,pe=n.isTerrainDEM?-Y:this._elevation?this._elevation.getMinElevationBelowMSL():0,he=this.projection.isReprojectedInTileSpace?xu(this):1,oe=qe=>{const it=new s.MercatorCoordinate(qe.x+25e-6,qe.y,qe.z),It=new s.MercatorCoordinate(qe.x,qe.y+25e-6,qe.z),St=qe.toLngLat(),Vt=it.toLngLat(),Wt=It.toLngLat(),ii=this.locationCoordinate(St),xi=this.locationCoordinate(Vt),Ut=this.locationCoordinate(Wt),ai=Math.hypot(xi.x-ii.x,xi.y-ii.y),Ii=Math.hypot(Ut.x-ii.x,Ut.y-ii.y);return Math.sqrt(ai*Ii)*he/25e-6},fe=qe=>{const mt=Y,it=pe;return{aabb:s.tileAABB(this,C,0,0,0,qe,it,mt,this.projection),zoom:0,x:0,y:0,minZ:it,maxZ:mt,wrap:qe,fullyVisible:!1}},le=[];let ve=[];const Be=a,dt=n.reparseOverscaled?d:a,Ae=qe=>qe*qe,Je=Ae((W-this._centerAltitude)*Z),rt=qe=>{if(!this._elevation||!qe.tileID||!g)return;const mt=this._elevation.getMinMaxForTile(qe.tileID),it=qe.aabb;mt?(it.min[2]=mt.min,it.max[2]=mt.max,it.center[2]=(it.min[2]+it.max[2])/2):(qe.shouldSplit=wt(qe),qe.shouldSplit||(it.min[2]=it.max[2]=it.center[2]=this._centerAltitude))},wt=qe=>{if(qe.zoom<te)return!0;if(qe.zoom===Be)return!1;if(qe.shouldSplit!=null)return qe.shouldSplit;const mt=qe.aabb.distanceX(X),it=qe.aabb.distanceY(X);let It=Je,St=1;if(z){It=Ae(qe.aabb.distanceZ(X));const Wt=Math.pow(2,qe.zoom),ii=s.latFromMercatorY((qe.y+1)/Wt),xi=s.latFromMercatorY(qe.y/Wt),Ut=Math.min(Math.max(T,ii),xi),ai=s.circumferenceAtLatitude(Ut)/s.circumferenceAtLatitude(T);if(St=Ut===T?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ai/this._mercatorScaleRatio),this.zoom<=s.GLOBE_ZOOM_THRESHOLD_MIN&&qe.zoom===Be-1&&ai>=.9)return!0}else if(_&&(It=Ae(qe.aabb.distanceZ(X)*Z)),this.projection.isReprojectedInTileSpace&&d<=5){const Wt=Math.pow(2,qe.zoom),ii=oe(new s.MercatorCoordinate((qe.x+.5)/Wt,(qe.y+.5)/Wt));St=ii>.85?1:ii}const Vt=mt*mt+it*it+It;return Vt<Ae((1<<Be-qe.zoom)*G*St*((Wt,ii)=>{if(ii*Ae(.707)<Wt)return 1;const xi=Math.sqrt(ii/Wt);return xi/(1.4144271570014144+(Math.pow(1.1,xi-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(It,Je),Vt))};if(this.renderWorldCopies)for(let qe=1;qe<=3;qe++)le.push(fe(-qe)),le.push(fe(qe));for(le.push(fe(0));le.length>0;){const qe=le.pop(),mt=qe.x,it=qe.y;let It=qe.fullyVisible;if(!It){const St=qe.aabb.intersects(j);if(St===0)continue;It=St===2}if(qe.zoom!==Be&&wt(qe))for(let St=0;St<4;St++){const Vt=(mt<<1)+St%2,Wt=(it<<1)+(St>>1),ii={aabb:g?qe.aabb.quadrant(St):s.tileAABB(this,C,qe.zoom+1,Vt,Wt,qe.wrap,qe.minZ,qe.maxZ,this.projection),zoom:qe.zoom+1,x:Vt,y:Wt,wrap:qe.wrap,fullyVisible:It,tileID:void 0,shouldSplit:void 0,minZ:qe.minZ,maxZ:qe.maxZ};_&&!z&&(ii.tileID=new s.OverscaledTileID(qe.zoom+1===Be?dt:qe.zoom+1,qe.wrap,qe.zoom+1,Vt,Wt),rt(ii)),le.push(ii)}else{const St=qe.zoom===Be?dt:qe.zoom;if(n.minzoom&&n.minzoom>St)continue;const Vt=k[0]-(.5+mt+(qe.wrap<<qe.zoom))*(1<<a-qe.zoom),Wt=k[1]-.5-it,ii=qe.tileID?qe.tileID:new s.OverscaledTileID(St,qe.wrap,qe.zoom,mt,it);ve.push({tileID:ii,distanceSq:Vt*Vt+Wt*Wt})}}if(this.fogCullDistSq){const qe=this.fogCullDistSq,mt=this.horizonLineFromTop();ve=ve.filter(it=>{const It=[0,0,0,1],St=[s.EXTENT,s.EXTENT,0,1],Vt=this.calculateFogTileMatrix(it.tileID.toUnwrapped());s.transformMat4$1(It,It,Vt),s.transformMat4$1(St,St,Vt);const Wt=s.getAABBPointSquareDist(It,St);if(Wt===0)return!0;let ii=!1;const xi=this._elevation;if(xi&&Wt>qe&&mt!==0){const Ut=this.calculateProjMatrix(it.tileID.toUnwrapped());let ai;n.isTerrainDEM||(ai=xi.getMinMaxForTile(it.tileID)),ai||(ai={min:pe,max:Y});const Ii=s.furthestTileCorner(this.rotation),Qi=[Ii[0]*s.EXTENT,Ii[1]*s.EXTENT,ai.max];s.transformMat4(Qi,Qi,Ut),ii=(1-Qi[1])*this.height*.5<mt}return Wt<qe||ii})}return ve.sort((qe,mt)=>qe.distanceSq-mt.distanceSq).map(qe=>qe.tileID)}resize(n,a){this.width=n,this.height=a,this.pixelsToGLUnits=[2/n,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const a=s.clamp(n.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),d=this.projection.project(n.lng,a);return new s.pointGeometry(d.x*this.worldSize,d.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(n,a){let d,_;const g=this.centerPoint;if(this.projection.name==="globe"){const T=this.worldSize;d=(a.x-g.x)/T,_=(a.y-g.y)/T}else{const T=this.pointCoordinate(a),C=this.pointCoordinate(g);d=T.x-C.x,_=T.y-C.y}const w=this.locationCoordinate(n);this.setLocation(new s.MercatorCoordinate(w.x-d,w.y-_))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,a){const d=a?s.mercatorZfromAltitude(a,n.lat):void 0,_=this.projection.project(n.lng,n.lat);return new s.MercatorCoordinate(_.x,_.y,d)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,a){const d=a!=null?a:this._centerAltitude,_=[n.x,n.y,0,1],g=[n.x,n.y,1,1];s.transformMat4$1(_,_,this.pixelMatrixInverse),s.transformMat4$1(g,g,this.pixelMatrixInverse);const w=g[3];s.scale$1(_,_,1/_[3]),s.scale$1(g,g,1/w);const T=_[2],C=g[2];return{p0:_,p1:g,t:T===C?0:(d-T)/(C-T)}}screenPointToMercatorRay(n){const a=[n.x,n.y,0,1],d=[n.x,n.y,1,1];return s.transformMat4$1(a,a,this.pixelMatrixInverse),s.transformMat4$1(d,d,this.pixelMatrixInverse),s.scale$1(a,a,1/a[3]),s.scale$1(d,d,1/d[3]),a[2]=s.mercatorZfromAltitude(a[2],this._center.lat)*this.worldSize,d[2]=s.mercatorZfromAltitude(d[2],this._center.lat)*this.worldSize,s.scale$1(a,a,1/this.worldSize),s.scale$1(d,d,1/this.worldSize),new s.Ray([a[0],a[1],a[2]],s.normalize([],s.sub([],d,a)))}rayIntersectionCoordinate(n){const{p0:a,p1:d,t:_}=n,g=s.mercatorZfromAltitude(a[2],this._center.lat),w=s.mercatorZfromAltitude(d[2],this._center.lat);return new s.MercatorCoordinate(s.number(a[0],d[0],_)/this.worldSize,s.number(a[1],d[1],_)/this.worldSize,s.number(g,w,_))}pointCoordinate(n,a=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,a)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let a=this.projection.pointCoordinate3D(this,n.x,n.y);if(a)return new s.MercatorCoordinate(a[0],a[1],a[2]);let d=0,_=this.horizonLineFromTop();if(n.y>_)return this.pointCoordinate(n);const g=.02*_,w=n.clone();for(let T=0;T<10&&_-d>g;T++){w.y=s.number(d,_,.66);const C=this.projection.pointCoordinate3D(this,w.x,w.y);C?(_=w.y,a=C):d=w.y}return a?new s.MercatorCoordinate(a[0],a[1],a[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}_coordinatePoint(n,a){const d=a&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,_=[n.x*this.worldSize,n.y*this.worldSize,d+n.toAltitude(),1];return s.transformMat4$1(_,_,this.pixelMatrix),_[3]>0?new s.pointGeometry(_[0]/_[3],_[1]/_[3]):new s.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(n,a){const d=new s.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),_=new s.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),g=new s.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),w=new s.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let T=this.pointCoordinate(d,n),C=this.pointCoordinate(_,n);const k=this.pointCoordinate(g,a),z=this.pointCoordinate(w,a),R=(j,K)=>(K.y-j.y)/(K.x-j.x);return T.y>1&&C.y>=0?T=new s.MercatorCoordinate((1-z.y)/R(z,T)+z.x,1):T.y<0&&C.y<=1&&(T=new s.MercatorCoordinate(-z.y/R(z,T)+z.x,0)),C.y>1&&T.y>=0?C=new s.MercatorCoordinate((1-k.y)/R(k,C)+k.x,1):C.y<0&&T.y<=1&&(C=new s.MercatorCoordinate(-k.y/R(k,C)+k.x,0)),new s.LngLatBounds().extend(this.coordinateLocation(T)).extend(this.coordinateLocation(C)).extend(this.coordinateLocation(z)).extend(this.coordinateLocation(k))}_getBounds3D(){const n=this.elevation;if(!n.visibleDemTiles.length)return this._getBounds(0,0);const a=n.visibleDemTiles.reduce((d,_)=>{if(_.dem){const g=_.dem.tree;d.min=Math.min(d.min,g.minimums[0]),d.max=Math.max(d.max,g.maximums[0])}return d},{min:Number.MAX_VALUE,max:0});return this._getBounds(a.min*n.exaggeration(),a.max*n.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(n=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,d=this.height/2-a*(1-this._horizonShift);return n?Math.max(0,d):d}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-s.MAX_MERCATOR_LATITUDE,this.maxLat=s.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=s.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=s.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=s.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,a){return this.projection.createTileMatrix(this,a,n)}calculateDistanceTileData(n){const a=n.key,d=this._distanceTileDataCache;if(d[a])return d[a];const _=n.canonical,g=1/this.height,w=this.cameraWorldSize/this.zoomScale(_.z),T=(_.x+Math.pow(2,_.z)*n.wrap)*w,C=_.y*w,k=this.point,z=this.angle,R=Math.sin(-z),j=-Math.cos(-z);return d[a]={bearing:[R,j],center:[(k.x-T)*g,(k.y-C)*g],scale:w/s.EXTENT*g},d[a]}calculateFogTileMatrix(n){const a=n.key,d=this._fogTileMatrixCache;if(d[a])return d[a];const _=this.projection.createTileMatrix(this,this.cameraWorldSize,n);return s.multiply(_,this.worldToFogMatrix,_),d[a]=new Float32Array(_),d[a]}calculateProjMatrix(n,a=!1){const d=n.key,_=a?this._alignedProjMatrixCache:this._projMatrixCache;if(_[d])return _[d];const g=this.calculatePosMatrix(n,this.worldSize);return s.multiply(g,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:a?this.alignedProjMatrix:this.projMatrix,g),_[d]=new Float32Array(g),_[d]}calculatePixelsToTileUnitsMatrix(n){const a=n.tileID.key,d=this._pixelsToTileUnitsCache;if(d[a])return d[a];const _=function(g,w){const{scale:T}=g.tileTransform,C=T*s.EXTENT/(g.tileSize*Math.pow(2,w.zoom-g.tileID.overscaledZ+g.tileID.canonical.z));return k=new Float32Array(4),j=(z=w.inverseAdjustmentMatrix)[1],K=z[2],Z=z[3],X=(R=[C,C])[1],k[0]=z[0]*(W=R[0]),k[1]=j*W,k[2]=K*X,k[3]=Z*X,k;var k,z,R,j,K,Z,W,X}(n,this);return d[a]=_,d[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const a=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(a),_=this._camera.forward(),g=s.mercatorZfromAltitude(1,this._center.lat);d[2]/=g,_[2]/=g,s.normalize(_,_);const w=n.raycast(d,_,n.exaggeration());if(w){const T=s.scaleAndAdd([],d,_,w),C=new s.MercatorCoordinate(T[0],T[1],s.mercatorZfromAltitude(T[2],s.latFromMercatorY(T[1]))),k=(C.z+s.length([C.x-d[0],C.y-d[1],C.z-d[2]*g]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(k),this._centerAltitude=C.toAltitude(),this._center=this.coordinateLocation(C),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const n=this._elevation;this._updateCameraState();const a=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(a),_=n.getAtPointOrZero(new s.MercatorCoordinate(...d)),g=this._minimumHeightOverTerrain()*Math.cos(s.degToRad(this._maxPitch)),w=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*_;if(w<g){const T=this.locationCoordinate(this._center,this._centerAltitude),C=[T.x-d[0],T.y-d[1],T.z-d[2]],k=s.length(C);C[2]-=(g-w)/this._pixelsPerMercatorPixel;const z=s.length(C);if(z===0)return;s.scale$2(C,C,k/z*this._pixelsPerMercatorPixel),this._camera.position=[T.x-C[0],T.y-C[1],T.z*this._pixelsPerMercatorPixel-C[2]],this._camera.orientation=Bs(C,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const j=this.center;return j.lat=s.clamp(j.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(j.lng=s.clamp(j.lng,this.minLng,this.maxLng)),this.center=j,void(this._constraining=!1)}const a=this._unmodified,{x:d,y:_}=this.point;let g=0,w=d,T=_;const C=this.width/2,k=this.height/2,z=this.worldMinY*this.scale,R=this.worldMaxY*this.scale;if(_-k<z&&(T=z+k),_+k>R&&(T=R-k),R-z<this.height&&(g=Math.max(g,this.height/(R-z)),T=(R+z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const j=this.worldMinX*this.scale,K=this.worldMaxX*this.scale,Z=this.worldSize/2-(j+K)/2;w=(d+Z+this.worldSize)%this.worldSize-Z,w-C<j&&(w=j+C),w+C>K&&(w=K-C),K-j<this.width&&(g=Math.max(g,this.width/(K-j)),w=(K+j)/2)}w===d&&T===_||(this.center=this.unproject(new s.pointGeometry(w,T))),g&&(this.zoom+=this.scaleZoom(g)),this._constrainCameraAltitude(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,a=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.mercatorZfromAltitude(1,this.center.lat)/s.mercatorZfromAltitude(1,s.GLOBE_SCALE_MATCH_LATITUDE));const d=za(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,d),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const _=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?a:1),g=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);g[8]=2*-n.x/this.width,g[9]=2*n.y/this.height;let w=s.mul([],g,_);if(this.projection.isReprojectedInTileSpace){const he=this.locationCoordinate(this.center),oe=s.identity([]);s.translate(oe,oe,[he.x*this.worldSize,he.y*this.worldSize,0]),s.multiply(oe,oe,vu(this)),s.translate(oe,oe,[-he.x*this.worldSize,-he.y*this.worldSize,0]),s.multiply(w,w,oe),this.inverseAdjustmentMatrix=function(fe){const le=vu(fe,!0);return Ke([],[le[0],le[1],le[4],le[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=s.scale([],w,[this.worldSize,this.worldSize,this.worldSize/a,1]),this.projMatrix=w,this.invProjMatrix=s.invert(new Float64Array(16),this.projMatrix);const T=s.invert([],g);this.frustumCorners=s.FrustumCorners.fromInvProjectionMatrix(T,this.horizonLineFromTop(),this.height);const C=new Float32Array(16);s.identity(C),s.scale(C,C,[1,-1,1]),s.rotateX(C,C,this._pitch),s.rotateZ(C,C,this.angle);const k=s.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),z=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;k[8]=2*-n.x/this.width,k[9]=2*(n.y+z)/this.height,this.skyboxMatrix=s.multiply(C,k,C);const R=this.point,j=R.x,K=R.y,Z=this.width%2/2,W=this.height%2/2,X=Math.cos(this.angle),G=Math.sin(this.angle),te=j-Math.round(j)+X*Z+G*W,Y=K-Math.round(K)+X*W+G*Z,pe=new Float64Array(w);if(s.translate(pe,pe,[te>.5?te-1:te,Y>.5?Y-1:Y,0]),this.alignedProjMatrix=pe,w=s.create(),s.scale(w,w,[this.width/2,-this.height/2,1]),s.translate(w,w,[1,-1,0]),this.labelPlaneMatrix=w,w=s.create(),s.scale(w,w,[1,-1,1]),s.translate(w,w,[-1,-1,0]),s.scale(w,w,[2/this.width,2/this.height,1]),this.glCoordMatrix=w,this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},w=s.invert(new Float64Array(16),this.pixelMatrix),!w)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=w,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.calculateGlobeMatrix(this);const he=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.transformMat4(he,he,_),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=w;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSize,a=this.cameraPixelsPerMeter,d=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,g=[n,n,a];s.scale$2(g,g,_),s.scale$2(d,d,-1),s.multiply$2(d,d,g);const w=s.create();s.translate(w,w,d),s.scale(w,w,g),this.mercatorFogMatrix=w,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,a,_)}_computeCameraPosition(n){const a=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,d=this._camera.forward(),_=this.point,g=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-n/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-d[0]*g,_.y/this.worldSize-d[1]*g,n/this.worldSize*this._centerAltitude-d[2]*g]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),d=n[2];let _=1;d>0&&(_=Math.min((a-this._camera.position[2])/d,1)),this._camera.position=s.scaleAndAdd([],this._camera.position,n,_),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const n=this._camera.position,a=this._camera.forward(),{pitch:d,bearing:_}=this._camera.getPitchBearing(),g=s.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,w=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.degToRad(this._maxPitch)),T=Math.max((n[2]-g)/Math.cos(d),w),C=this._zoomFromMercatorZ(T);s.scaleAndAdd(n,n,a,T),this._pitch=s.clamp(d,s.degToRad(this.minPitch),s.degToRad(this.maxPitch)),this.angle=s.wrap(_,-Math.PI,Math.PI),this._setZoom(s.clamp(C,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.MercatorCoordinate(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,a){const d=Math.min(n.x,a.x),_=Math.max(n.x,a.x),g=Math.min(n.y,a.y),w=Math.max(n.y,a.y);if(g<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const T=[new s.pointGeometry(d,g),new s.pointGeometry(_,w),new s.pointGeometry(d,w),new s.pointGeometry(_,g)],C=this.renderWorldCopies?-3:0,k=this.renderWorldCopies?4:1;for(const z of T){const R=this.pointRayIntersection(z);if(R.t<0)return!0;const j=this.rayIntersectionCoordinate(R);if(j.x<C||j.y<0||j.x>k||j.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.pointGeometry(0,0),new s.pointGeometry(this.width,this.height))}zoomDeltaToMovement(n,a){const d=s.length(s.sub([],this._camera.position,n)),_=this._zoomFromMercatorZ(d)+a;return d-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){const n=function(a,d){const _=[a[0],a[1],a[2],1];s.transformMat4$1(_,_,d);const g=Math.max(_[3],1e-6);return[_[0]/g,_[1]/g,_[2]/g,g]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.pointGeometry(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.pointGeometry(0,n))}}getCameraToCenterDistance(n){const a=za(n,this.zoom,this.width,this.height,1024),d=n.pixelSpaceConversion(this.center.lat,this.worldSize,a);return .5/Math.tan(.5*this._fov)*this.height*d}}function La(c,n){let a=!1,d=null;const _=()=>{d=null,a&&(c(),d=setTimeout(_,n),a=!1)};return()=>(a=!0,d||_(),d)}class sd{constructor(n){this._hashName=n&&encodeURIComponent(n),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=La(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,s.window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),s.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const a=wu(n);if(this._hashName){const d=this._hashName;let _=!1;const g=s.window.location.hash.slice(1).split("&").map(w=>{const T=w.split("=")[0];return T===d?(_=!0,`${T}=${a}`):w}).filter(w=>w);return _||g.push(`${d}=${a}`),`#${g.join("&")}`}return`#${a}`}_getCurrentHash(){const n=s.window.location.hash.replace("#","");if(this._hashName){let a;return n.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(a=d)}),(a&&a[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const a=this._getCurrentHash();if(a.length>=3&&!a.some(d=>isNaN(d))){const d=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(a[3]||0):n.getBearing();return n.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:d,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){const n=s.window.location.href.replace(/(#.+)?$/,this.getHashString());s.window.history.replaceState(s.window.history.state,null,n)}}function wu(c,n){const a=c.getCenter(),d=Math.round(100*c.getZoom())/100,_=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,_),w=Math.round(a.lng*g)/g,T=Math.round(a.lat*g)/g,C=c.getBearing(),k=c.getPitch();let z=n?`/${w}/${T}/${d}`:`${d}/${T}/${w}`;return(C||k)&&(z+="/"+Math.round(10*C)/10),k&&(z+=`/${Math.round(k)}`),z}const ro={linearity:.3,easing:s.bezier(0,0,.3,1)},Fp=s.extend({deceleration:2500,maxSpeed:1400},ro),Op=s.extend({deceleration:20,maxSpeed:1400},ro),ad=s.extend({deceleration:1e3,maxSpeed:360},ro),Vl=s.extend({deceleration:1e3,maxSpeed:90},ro);class Tu{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.exported.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,a=s.exported.now();for(;n.length>0&&a-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,pan:new s.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)a.zoom+=g.zoomDelta||0,a.bearing+=g.bearingDelta||0,a.pitch+=g.pitchDelta||0,g.panDelta&&a.pan._add(g.panDelta),g.around&&(a.around=g.around),g.pinchAround&&(a.pinchAround=g.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(a.pan.mag()){const g=Ra(a.pan.mag(),d,s.extend({},Fp,n||{}));_.offset=a.pan.mult(g.amount/a.pan.mag()),_.center=this._map.transform.center,Ba(_,g)}if(a.zoom){const g=Ra(a.zoom,d,Op);_.zoom=this._map.transform.zoom+g.amount,Ba(_,g)}if(a.bearing){const g=Ra(a.bearing,d,ad);_.bearing=this._map.transform.bearing+s.clamp(g.amount,-179,179),Ba(_,g)}if(a.pitch){const g=Ra(a.pitch,d,Vl);_.pitch=this._map.transform.pitch+g.amount,Ba(_,g)}if(_.zoom||_.bearing){const g=a.pinchAround===void 0?a.around:a.pinchAround;_.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function Ba(c,n){(!c.duration||c.duration<n.duration)&&(c.duration=n.duration,c.easing=n.easing)}function Ra(c,n,a){const{maxSpeed:d,linearity:_,deceleration:g}=a,w=s.clamp(c*_/(n/1e3),-d,d),T=Math.abs(w)/(g*_);return{easing:a.easing,duration:1e3*T,amount:w*(T/2)}}class $n extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,d,_={}){const g=Te(a.getCanvasContainer(),d),w=a.unproject(g);super(n,s.extend({point:g,lngLat:w,originalEvent:d},_)),this._defaultPrevented=!1,this.target=a}}class Rs extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,d){const _=n==="touchend"?d.changedTouches:d.touches,g=Pe(a.getCanvasContainer(),_),w=g.map(C=>a.unproject(C)),T=g.reduce((C,k,z,R)=>C.add(k.div(R.length)),new s.pointGeometry(0,0));super(n,{points:g,point:T,lngLats:w,lngLat:a.unproject(T),originalEvent:d}),this._defaultPrevented=!1}}class ld extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,d){super(n,{originalEvent:d}),this._defaultPrevented=!1}}class cd{constructor(n,a){this._map=n,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new ld(n.type,this._map,n))}mousedown(n,a){return this._mousedownPos=a,this._firePreventable(new $n(n.type,this._map,n))}mouseup(n){this._map.fire(new $n(n.type,this._map,n))}preclick(n){const a=s.extend({},n);a.type="preclick",this._map.fire(new $n(a.type,this._map,a))}click(n,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(n),this._map.fire(new $n(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new $n(n.type,this._map,n))}mouseover(n){this._map.fire(new $n(n.type,this._map,n))}mouseout(n){this._map.fire(new $n(n.type,this._map,n))}touchstart(n){return this._firePreventable(new Rs(n.type,this._map,n))}touchmove(n){this._map.fire(new Rs(n.type,this._map,n))}touchend(n){this._map.fire(new Rs(n.type,this._map,n))}touchcancel(n){this._map.fire(new Rs(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ud{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new $n(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new $n("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new $n(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class hd{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,a){this.isEnabled()&&n.shiftKey&&n.button===0&&(He(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(n,a){if(!this._active)return;const d=a;if(this._lastPos.equals(d)||!this._box&&d.dist(this._startPos)<this._clickTolerance)return;const _=this._startPos;this._lastPos=d,this._box||(this._box=q("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const g=Math.min(_.x,d.x),w=Math.max(_.x,d.x),T=Math.min(_.y,d.y),C=Math.max(_.y,d.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${g}px,${T}px)`,this._box.style.width=w-g+"px",this._box.style.height=C-T+"px")})}mouseupWindow(n,a){if(!this._active||n.button!==0)return;const d=this._startPos,_=a;if(this.reset(),Ne(),d.x!==_.x||d.y!==_.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:g=>g.fitScreenCoordinates(d,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),we(),delete this._startPos,delete this._lastPos}_fireEvent(n,a){return this._map.fire(new s.Event(n,{originalEvent:a}))}}function Ul(c,n){const a={};for(let d=0;d<c.length;d++)a[c[d].identifier]=n[d];return a}class Fs{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,a,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),d.length===this.numTouches&&(this.centroid=function(_){const g=new s.pointGeometry(0,0);for(const w of _)g._add(w);return g.div(_.length)}(a),this.touches=Ul(d,a)))}touchmove(n,a,d){if(this.aborted||!this.centroid)return;const _=Ul(d,a);for(const g in this.touches){const w=this.touches[g],T=_[g];(!T||T.dist(w)>30)&&(this.aborted=!0)}}touchend(n,a,d){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Nl{constructor(n){this.singleTap=new Fs(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,a,d){this.singleTap.touchstart(n,a,d)}touchmove(n,a,d){this.singleTap.touchmove(n,a,d)}touchend(n,a,d){const _=this.singleTap.touchend(n,a,d);if(_){const g=n.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(_)<30;if(g&&w||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class dd{constructor(){this._zoomIn=new Nl({numTouches:1,numTaps:2}),this._zoomOut=new Nl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,a,d){this._zoomIn.touchstart(n,a,d),this._zoomOut.touchstart(n,a,d)}touchmove(n,a,d){this._zoomIn.touchmove(n,a,d),this._zoomOut.touchmove(n,a,d)}touchend(n,a,d){const _=this._zoomIn.touchend(n,a,d),g=this._zoomOut.touchend(n,a,d);return _?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(_)},{originalEvent:n})}):g?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(g)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const fd={0:1,2:2};class jl{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,a){return!1}_move(n,a){return{}}mousedown(n,a){if(this._lastPoint)return;const d=xe(n);this._correctButton(n,d)&&(this._lastPoint=a,this._eventButton=d)}mousemoveWindow(n,a){const d=this._lastPoint;if(d){if(n.preventDefault(),this._eventButton!=null&&function(_,g){const w=fd[g];return _.buttons===void 0||(_.buttons&w)!==w}(n,this._eventButton))this.reset();else if(this._moved||!(a.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(d,a)}}mouseupWindow(n){this._lastPoint&&xe(n)===this._eventButton&&(this._moved&&Ne(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pd extends jl{mousedown(n,a){super.mousedown(n,a),this._lastPoint&&(this._active=!0)}_correctButton(n,a){return a===0&&!n.ctrlKey}_move(n,a){return{around:a,panDelta:a.sub(n)}}}class Eu extends jl{_correctButton(n,a){return a===0&&n.ctrlKey||a===2}_move(n,a){const d=.8*(a.x-n.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(n){n.preventDefault()}}class Rn extends jl{_correctButton(n,a){return a===0&&n.ctrlKey||a===2}_move(n,a){const d=-.5*(a.y-n.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(n){n.preventDefault()}}class Vp{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),s.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.pointGeometry(0,0)}touchstart(n,a,d){return this._calculateTransform(n,a,d)}touchmove(n,a,d){if(this._active&&!(d.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(d.length===1&&!s.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,a,d)}}touchend(n,a,d){this._calculateTransform(n,a,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,a,d){d.length>0&&(this._active=!0);const _=Ul(d,a),g=new s.pointGeometry(0,0),w=new s.pointGeometry(0,0);let T=0;for(const k in _){const z=_[k],R=this._touches[k];R&&(g._add(z),w._add(z.sub(R)),T++,_[k]=z)}if(this._touches=_,T<this._minTouches||!w.mag())return;const C=w.div(T);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(T),panDelta:C}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=q("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class ql{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,a,d){return{}}touchstart(n,a,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([a[0],a[1]]))}touchmove(n,a,d){const _=this._firstTwoTouches;if(!_)return;n.preventDefault();const[g,w]=_,T=$l(d,a,g),C=$l(d,a,w);if(!T||!C)return;const k=this._aroundCenter?null:T.add(C).div(2);return this._move([T,C],k,n)}touchend(n,a,d){if(!this._firstTwoTouches)return;const[_,g]=this._firstTwoTouches,w=$l(d,a,_),T=$l(d,a,g);w&&T||(this._active&&Ne(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function $l(c,n,a){for(let d=0;d<c.length;d++)if(c[d].identifier===a)return n[d]}function md(c,n){return Math.log(c/n)/Math.LN2}class oo extends ql{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,a){const d=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(md(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:md(this._distance,d),pinchAround:a}}}function Su(c,n){return 180*c.angleWith(n)/Math.PI}class Os extends ql{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,a){const d=this._vector;if(this._vector=n[0].sub(n[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Su(this._vector,d),pinchAround:a}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const a=25/(Math.PI*this._minDiameter)*360,d=Su(n,this._startVector);return Math.abs(d)<a}}function Ar(c){return Math.abs(c.y)>Math.abs(c.x)}class Gl extends ql{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,Ar(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,a,d){const _=this._lastPoints;if(!_)return;const g=n[0].sub(_[0]),w=n[1].sub(_[1]);return this._map._cooperativeGestures&&d.touches.length<3||(this._valid=this.gestureBeginsVertically(g,w,d.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(g.y+w.y)/2*-.5})}gestureBeginsVertically(n,a,d){if(this._valid!==void 0)return this._valid;const _=n.mag()>=2,g=a.mag()>=2;if(!_&&!g)return;if(!_||!g)return this._firstMove==null&&(this._firstMove=d),d-this._firstMove<100&&void 0;const w=n.y>0==a.y>0;return Ar(n)&&Ar(a)&&w}}const Bt={panStep:100,bearingStep:15,pitchStep:10};class _d{constructor(){const n=Bt;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let a=0,d=0,_=0,g=0,w=0;switch(n.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:n.shiftKey?d=-1:(n.preventDefault(),g=-1);break;case 39:n.shiftKey?d=1:(n.preventDefault(),g=1);break;case 38:n.shiftKey?_=1:(n.preventDefault(),w=-1);break;case 40:n.shiftKey?_=-1:(n.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(d=0,_=0),{cameraAnimation:T=>{const C=T.getZoom();T.easeTo({duration:300,easeId:"keyboardHandler",easing:gd,zoom:a?Math.round(C)+a*(n.shiftKey?2:1):C,bearing:T.getBearing()+d*this._bearingStep,pitch:T.getPitch()+_*this._pitchStep,offset:[-g*this._panStep,-w*this._panStep],center:T.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function gd(c){return c*(2-c)}const Vs=4.000244140625;class Fa{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._handler=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,s.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||s.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=n.deltaMode===s.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const d=s.exported.now(),_=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,a!==0&&a%Vs==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(_*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),n.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=n,this._delta-=a,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=Te(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform,a=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const C=this._type==="wheel"&&Math.abs(this._delta)>Vs?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&k!==0&&(k=1/k);const z=a(),R=Math.pow(2,z),j=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):R;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(j*k))),this._type==="wheel"&&(this._startZoom=z,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:a(),_=this._startZoom,g=this._easing;let w,T=!1;if(this._type==="wheel"&&_&&g){const C=Math.min((s.exported.now()-this._lastWheelEventTime)/200,1),k=g(C);w=s.number(_,d,k),C<1?this._frameId||(this._frameId=!0):T=!0}else w=d,T=!0;return this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!T,zoomDelta:w-a(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let a=s.ease;if(this._prevEase){const d=this._prevEase,_=(s.exported.now()-d.start)/d.duration,g=d.easing(_+.01)-d.easing(_),w=.27/Math.sqrt(g*g+1e-4)*.01,T=Math.sqrt(.0729-w*w);a=s.bezier(w,T,.25,1)}return this._prevEase={start:s.exported.now(),duration:n,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=q("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(s.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class yd{constructor(n,a){this._clickZoom=n,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class vd{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,a){return n.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(n.shiftKey?-1:1),around:d.unproject(a)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xd{constructor(){this._tap=new Nl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,a,d){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=a[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(n,a,d))}touchmove(n,a,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const _=a[0],g=_.y-this._swipePoint.y;return this._swipePoint=_,n.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(n,a,d)}touchend(n,a,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(n,a,d)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bd{constructor(n,a,d){this._el=n,this._mousePan=a,this._touchPan=d}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class wd{constructor(n,a,d){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=a,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Td{constructor(n,a,d,_){this._el=n,this._touchZoom=a,this._touchRotate=d,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Oa=c=>c.zoom||c.drag||c.pitch||c.rotate;class Zl extends s.Event{}class Cu{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,a){const d=s.sub([],a,n);this.radius=s.length(d[2]<0?s.div([],d,this.constants):[d[0],d[1],0])}projectRay(n){s.div(n,n,this.constants),s.normalize(n,n),s.mul$1(n,n,this.constants);const a=s.scale$2([],n,this.radius);if(a[2]>0){const d=s.scale$2([],[0,0,1],s.dot(a,[0,0,1])),_=s.scale$2([],s.normalize([],[a[0],a[1],0]),this.radius),g=s.add([],a,s.scale$2([],s.sub([],s.add([],_,d),a),2));a[0]=g[0],a[1]=g[1]}return a}}function Jo(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class Ed{constructor(n,a){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Tu(n),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Cu,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),s.bindAll(["handleEvent","handleWindowEvent"],this);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[s.window.document,"mousemove",{capture:!0}],[s.window.document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[s.window,"blur",void 0]];for(const[_,g,w]of this._listeners)_.addEventListener(g,_===s.window.document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[n,a,d]of this._listeners)n.removeEventListener(a,n===s.window.document?this.handleWindowEvent:this.handleEvent,d)}_addDefaultHandlers(n){const a=this._map,d=a.getCanvasContainer();this._add("mapEvent",new cd(a,n));const _=a.boxZoom=new hd(a,n);this._add("boxZoom",_);const g=new dd,w=new vd;a.doubleClickZoom=new yd(w,g),this._add("tapZoom",g),this._add("clickZoom",w);const T=new xd;this._add("tapDragZoom",T);const C=a.touchPitch=new Gl(a);this._add("touchPitch",C);const k=new Eu(n),z=new Rn(n);a.dragRotate=new wd(n,k,z),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const R=new pd(n),j=new Vp(a,n);a.dragPan=new bd(d,R,j),this._add("mousePan",R),this._add("touchPan",j,["touchZoom","touchRotate"]);const K=new Os,Z=new oo;a.touchZoomRotate=new Td(d,Z,K,T),this._add("touchRotate",K,["touchPan","touchZoom"]),this._add("touchZoom",Z,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ud(a));const W=a.scrollZoom=new Fa(a,this);this._add("scrollZoom",W,["mousePan"]);const X=a.keyboard=new _d;this._add("keyboard",X);for(const G of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[G]&&a[G].enable(n[G])}_add(n,a,d){this._handlers.push({handlerName:n,handler:a,allowed:d}),this._handlersById[n]=a}stop(n){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Oa(this._eventsInProgress)||this.isZooming()}_blockedByActive(n,a,d){for(const _ in n)if(_!==d&&(!a||a.indexOf(_)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const a=[];for(const d of n)this._el.contains(d.target)&&a.push(d);return a}handleEvent(n,a){this._updatingCamera=!0;const d=n.type==="renderFrame",_=d?void 0:n,g={needsRenderFrame:!1},w={},T={},C=n.touches?this._getMapTouches(n.touches):void 0,k=C?Pe(this._el,C):d?void 0:Te(this._el,n);for(const{handlerName:j,handler:K,allowed:Z}of this._handlers){if(!K.isEnabled())continue;let W;this._blockedByActive(T,Z,j)?K.reset():K[a||n.type]&&(W=K[a||n.type](n,k,C),this.mergeHandlerResult(g,w,W,j,_),W&&W.needsRenderFrame&&this._triggerRenderFrame()),(W||K.isActive())&&(T[j]=K)}const z={};for(const j in this._previousActiveHandlers)T[j]||(z[j]=_);this._previousActiveHandlers=T,(Object.keys(z).length||Jo(g))&&(this._changes.push([g,w,z]),this._triggerRenderFrame()),(Object.keys(T).length||Jo(g))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:R}=g;R&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],R(this._map))}mergeHandlerResult(n,a,d,_,g){if(!d)return;s.extend(n,d);const w={handlerName:_,originalEvent:d.originalEvent||g};d.zoomDelta!==void 0&&(a.zoom=w),d.panDelta!==void 0&&(a.drag=w),d.pitchDelta!==void 0&&(a.pitch=w),d.bearingDelta!==void 0&&(a.rotate=w)}_applyChanges(){const n={},a={},d={};for(const[_,g,w]of this._changes)_.panDelta&&(n.panDelta=(n.panDelta||new s.pointGeometry(0,0))._add(_.panDelta)),_.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(n.around=_.around),_.aroundCoord!==void 0&&(n.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(n.pinchAround=_.pinchAround),_.noInertia&&(n.noInertia=_.noInertia),s.extend(a,g),s.extend(d,w);this._updateMapTransform(n,a,d),this._changes=[]}_updateMapTransform(n,a,d){const _=this._map,g=_.transform,w=te=>[te.x,te.y,te.z];if((te=>{const Y=this._eventsInProgress.drag;return Y&&!this._handlersById[Y.handlerName].isActive()})()&&!Jo(n)){const te=g.zoom;g.cameraElevationReference="sea",g.recenterOnTerrain(),g.cameraElevationReference="ground",te!==g.zoom&&this._map._update(!0)}if(!Jo(n))return void this._fireEvents(a,d,!0);let{panDelta:T,zoomDelta:C,bearingDelta:k,pitchDelta:z,around:R,aroundCoord:j,pinchAround:K}=n;K!==void 0&&(R=K),(te=>a.drag&&!this._eventsInProgress.drag)()&&R&&(this._dragOrigin=w(g.pointCoordinate3D(R)),this._trackingEllipsoid.setup(g._camera.position,this._dragOrigin)),g.cameraElevationReference="sea",_._stop(!0),R=R||_.transform.centerPoint,k&&(g.bearing+=k),z&&(g.pitch+=z),g._updateCameraState();const Z=[0,0,0];if(T)if(g.projection.name==="mercator"){const te=this._trackingEllipsoid.projectRay(g.screenPointToMercatorRay(R).dir),Y=this._trackingEllipsoid.projectRay(g.screenPointToMercatorRay(R.sub(T)).dir);Z[0]=Y[0]-te[0],Z[1]=Y[1]-te[1]}else{const te=g.pointCoordinate(R);if(g.projection.name==="globe"){T=T.rotate(-g.angle);const Y=g._pixelsPerMercatorPixel/g.worldSize;Z[0]=-T.x*s.mercatorScale(s.latFromMercatorY(te.y))*Y,Z[1]=-T.y*s.mercatorScale(g.center.lat)*Y}else{const Y=g.pointCoordinate(R.sub(T));te&&Y&&(Z[0]=Y.x-te.x,Z[1]=Y.y-te.y)}}const W=g.zoom,X=[0,0,0];if(C){const te=w(j||g.pointCoordinate3D(R)),Y={dir:s.normalize([],s.sub([],te,g._camera.position))};if(Y.dir[2]<0){const pe=g.zoomDeltaToMovement(te,C);s.scale$2(X,Y.dir,pe)}}const G=s.add(Z,Z,X);g._translateCameraConstrained(G),C&&Math.abs(g.zoom-W)>1e-4&&g.recenterOnTerrain(),g.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(a,d,!0)}_fireEvents(n,a,d){const _=Oa(this._eventsInProgress),g=Oa(n),w={};for(const z in n){const{originalEvent:R}=n[z];this._eventsInProgress[z]||(w[`${z}start`]=R),this._eventsInProgress[z]=n[z]}!_&&g&&this._fireEvent("movestart",g.originalEvent);for(const z in w)this._fireEvent(z,w[z]);g&&this._fireEvent("move",g.originalEvent);for(const z in n){const{originalEvent:R}=n[z];this._fireEvent(z,R)}const T={};let C;for(const z in this._eventsInProgress){const{handlerName:R,originalEvent:j}=this._eventsInProgress[z];this._handlersById[R].isActive()||(delete this._eventsInProgress[z],C=a[R]||j,T[`${z}end`]=C)}for(const z in T)this._fireEvent(z,T[z]);const k=Oa(this._eventsInProgress);if(d&&(_||g)&&!k){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;z?(R(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:C})):(this._map.fire(new s.Event("moveend",{originalEvent:C})),R(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,a){this._map.fire(new s.Event(n,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new Zl("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Au="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Sd extends s.Evented{constructor(n,a){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=a.bearingSnap,s.bindAll(["_renderFrameCallback"],this)}getCenter(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(n,a){return this.jumpTo({center:n},a)}panBy(n,a,d){return n=s.pointGeometry.convert(n).mult(-1),this.panTo(this.transform.center,s.extend({offset:n},a),d)}panTo(n,a,d){return this.easeTo(s.extend({center:n},a),d)}getZoom(){return this.transform.zoom}setZoom(n,a){return this.jumpTo({zoom:n},a),this}zoomTo(n,a,d){return this.easeTo(s.extend({zoom:n},a),d)}zoomIn(n,a){return this.zoomTo(this.getZoom()+1,n,a),this}zoomOut(n,a){return this.zoomTo(this.getZoom()-1,n,a),this}getBearing(){return this.transform.bearing}setBearing(n,a){return this.jumpTo({bearing:n},a),this}getPadding(){return this.transform.padding}setPadding(n,a){return this.jumpTo({padding:n},a),this}rotateTo(n,a,d){return this.easeTo(s.extend({bearing:n},a),d)}resetNorth(n,a){return this.rotateTo(0,s.extend({duration:1e3},n),a),this}resetNorthPitch(n,a){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},n),a),this}snapToNorth(n,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,a):this}getPitch(){return this.transform.pitch}setPitch(n,a){return this.jumpTo({pitch:n},a),this}cameraForBounds(n,a){this.transform.projection.name==="globe"&&s.warnOnce('Globe projection does not support cameraForBounds API, this API may behave unexpectedly."'),n=s.LngLatBounds.convert(n);const d=a&&a.bearing||0;return this._cameraForBoxAndBearing(n.getNorthWest(),n.getSouthEast(),d,a)}_extendCameraOptions(n){const a={top:0,bottom:0,right:0,left:0};if(typeof(n=s.extend({padding:a,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=="number"){const d=n.padding;n.padding={top:d,bottom:d,right:d,left:d}}return n.padding=s.extend(a,n.padding),n}_cameraForBoxAndBearing(n,a,d,_){const g=this._extendCameraOptions(_),w=this.transform,T=w.padding,C=w.project(s.LngLat.convert(n)),k=w.project(s.LngLat.convert(a)),z=new s.pointGeometry(C.x,k.y),R=new s.pointGeometry(k.x,C.y),j=-s.degToRad(d),K=C.rotate(j),Z=k.rotate(j),W=z.rotate(j),X=R.rotate(j),G=new s.pointGeometry(Math.max(K.x,Z.x,W.x,X.x),Math.max(K.y,Z.y,W.y,X.y)),te=new s.pointGeometry(Math.min(K.x,Z.x,W.x,X.x),Math.min(K.y,Z.y,W.y,X.y)),Y=G.sub(te),pe=(w.width-((T.left||0)+(T.right||0)+g.padding.left+g.padding.right))/Y.x,he=(w.height-((T.top||0)+(T.bottom||0)+g.padding.top+g.padding.bottom))/Y.y;if(he<0||pe<0)return void s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const oe=Math.min(w.scaleZoom(w.scale*Math.min(pe,he)),g.maxZoom),fe=typeof g.offset.x=="number"&&typeof g.offset.y=="number"?new s.pointGeometry(g.offset.x,g.offset.y):s.pointGeometry.convert(g.offset),le=new s.pointGeometry((g.padding.left-g.padding.right)/2,(g.padding.top-g.padding.bottom)/2).rotate(d*Math.PI/180),ve=fe.add(le).mult(w.scale/w.zoomScale(oe));return{center:w.unproject(C.add(k).div(2).sub(ve)),zoom:oe,bearing:d}}_cameraForBox(n,a,d,_,g){const w=this._extendCameraOptions(g);d=d||0,_=_||0,n=s.LngLat.convert(n),a=s.LngLat.convert(a);const T=this.transform.clone();T.padding=w.padding;const C=this.getFreeCameraOptions(),k=new s.LngLat(.5*(n.lng+a.lng),.5*(n.lat+a.lat)),z=.5*(d+_);if(T._camera.position[2]<s.mercatorZfromAltitude(z,k.lat))return void s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");C.lookAtPoint(k),T.setFreeCameraOptions(C);const R=s.MercatorCoordinate.fromLngLat(n),j=s.MercatorCoordinate.fromLngLat(a),K=T.pointRayIntersection(T.centerPoint,z),Z=[(W=T.rayIntersectionCoordinate(K)).x,W.y,W.z];var W;const X=T.screenPointToMercatorRay(T.centerPoint),G=T.projection.name!=="globe";let te,Y=0;do{const pe=Math.floor(T.zoom),he=1<<pe,oe=Math.min(he*R.x,he*j.x),fe=Math.min(he*R.y,he*j.y),le=Math.max(he*R.x,he*j.x),ve=Math.max(he*R.y,he*j.y),Be=new s.Aabb([oe,fe,d],[le,ve,_]),dt=s.Frustum.fromInvProjectionMatrix(T.invProjMatrix,T.worldSize,pe,G);if(Be.intersects(dt)!==2){te&&(T._camera.position=s.scaleAndAdd([],T._camera.position,X.dir,-te),T._updateStateFromCamera());break}const Ae=s.sub([],T._camera.position,Z);te=.5*s.length(Ae),T._camera.position=s.scaleAndAdd([],T._camera.position,X.dir,te);try{T._updateStateFromCamera()}catch{return void s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++Y<10);return{center:T.center,zoom:T.zoom,bearing:T.bearing,pitch:T.pitch}}fitBounds(n,a,d){return this.transform.projection.name==="globe"&&s.warnOnce("Globe projection does not support fitBounds API, this API may behave unexpectedly."),this._fitInternal(this.cameraForBounds(n,a),a,d)}_raycastElevationBox(n,a){const d=this.transform.elevation;if(!d)return;const _=new s.pointGeometry(n.x,a.y),g=new s.pointGeometry(a.x,n.y),w=d.pointCoordinate(n);if(!w)return;const T=d.pointCoordinate(a);if(!T)return;const C=d.pointCoordinate(_);if(!C)return;const k=d.pointCoordinate(g);if(!k)return;const z=new s.MercatorCoordinate(w[0],w[1]).toLngLat(),R=new s.MercatorCoordinate(T[0],T[1]).toLngLat(),j=new s.MercatorCoordinate(C[0],C[1]).toLngLat(),K=new s.MercatorCoordinate(k[0],k[1]).toLngLat(),Z=Math.min(z.lng,Math.min(R.lng,Math.min(j.lng,K.lng))),W=Math.min(z.lat,Math.min(R.lat,Math.min(j.lat,K.lat))),X=Math.max(z.lng,Math.max(R.lng,Math.max(j.lng,K.lng))),G=Math.max(z.lat,Math.max(R.lat,Math.max(j.lat,K.lat))),te=Math.min(w[3],Math.min(T[3],Math.min(C[3],k[3]))),Y=Math.max(w[3],Math.max(T[3],Math.max(C[3],k[3])));return{minLngLat:new s.LngLat(Z,W),maxLngLat:new s.LngLat(X,G),minAltitude:te,maxAltitude:Y}}fitScreenCoordinates(n,a,d,_,g){let w,T,C,k;this.transform.projection.name==="globe"&&s.warnOnce("Globe projection does not support fitScreenCoordinates API, this API may behave unexpectedly.");const z=s.pointGeometry.convert(n),R=s.pointGeometry.convert(a),j=this._raycastElevationBox(z,R);if(j)w=j.minLngLat,T=j.maxLngLat,C=j.minAltitude,k=j.maxAltitude;else{if(this.transform.anyCornerOffEdge(z,R))return this;w=this.transform.pointLocation(z),T=this.transform.pointLocation(R)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(s.pointGeometry.convert(n)),this.transform.pointLocation(s.pointGeometry.convert(a)),d,_):this._cameraForBox(w,T,C,k,_),_,g)}_fitInternal(n,a,d){return n?(delete(a=s.extend(n,a)).padding,a.linear?this.easeTo(a,d):this.flyTo(a,d)):this}jumpTo(n,a){this.stop();const d=n.preloadOnly?this.transform.clone():this.transform;let _=!1,g=!1,w=!1;return"zoom"in n&&d.zoom!==+n.zoom&&(_=!0,d.zoom=+n.zoom),n.center!==void 0&&(d.center=s.LngLat.convert(n.center)),"bearing"in n&&d.bearing!==+n.bearing&&(g=!0,d.bearing=+n.bearing),"pitch"in n&&d.pitch!==+n.pitch&&(w=!0,d.pitch=+n.pitch),n.padding==null||d.isPaddingEqual(n.padding)||(d.padding=n.padding),n.preloadOnly?(this._preloadTiles(d),this):(this.fire(new s.Event("movestart",a)).fire(new s.Event("move",a)),_&&this.fire(new s.Event("zoomstart",a)).fire(new s.Event("zoom",a)).fire(new s.Event("zoomend",a)),g&&this.fire(new s.Event("rotatestart",a)).fire(new s.Event("rotate",a)).fire(new s.Event("rotateend",a)),w&&this.fire(new s.Event("pitchstart",a)).fire(new s.Event("pitch",a)).fire(new s.Event("pitchend",a)),this.fire(new s.Event("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.warnOnce(Au),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,a){const d=this.transform;if(!d.projection.supportsFreeCamera)return s.warnOnce(Au),this;this.stop();const _=d.zoom,g=d.pitch,w=d.bearing;d.setFreeCameraOptions(n);const T=_!==d.zoom,C=g!==d.pitch,k=w!==d.bearing;return this.fire(new s.Event("movestart",a)).fire(new s.Event("move",a)),T&&this.fire(new s.Event("zoomstart",a)).fire(new s.Event("zoom",a)).fire(new s.Event("zoomend",a)),k&&this.fire(new s.Event("rotatestart",a)).fire(new s.Event("rotate",a)).fire(new s.Event("rotateend",a)),C&&this.fire(new s.Event("pitchstart",a)).fire(new s.Event("pitch",a)).fire(new s.Event("pitchend",a)),this.fire(new s.Event("moveend",a)),this}easeTo(n,a){this._stop(!1,n.easeId),((n=s.extend({offset:[0,0],duration:500,easing:s.ease},n)).animate===!1||!n.essential&&s.exported.prefersReducedMotion)&&(n.duration=0);const d=this.transform,_=this.getZoom(),g=this.getBearing(),w=this.getPitch(),T=this.getPadding(),C="zoom"in n?+n.zoom:_,k="bearing"in n?this._normalizeBearing(n.bearing,g):g,z="pitch"in n?+n.pitch:w,R="padding"in n?n.padding:d.padding,j=s.pointGeometry.convert(n.offset);let K,Z,W;if(d.projection.name==="globe"){const ve=s.MercatorCoordinate.fromLngLat(d.center),Be=j.rotate(-d.angle);ve.x+=Be.x/d.worldSize,ve.y+=Be.y/d.worldSize;const dt=ve.toLngLat(),Ae=s.LngLat.convert(n.center||dt);this._normalizeCenter(Ae),K=d.centerPoint.add(Be),Z=new s.pointGeometry(ve.x,ve.y).mult(d.worldSize),W=new s.pointGeometry(s.mercatorXfromLng(Ae.lng),s.mercatorYfromLat(Ae.lat)).mult(d.worldSize).sub(Z)}else{K=d.centerPoint.add(j);const ve=d.pointLocation(K),Be=s.LngLat.convert(n.center||ve);this._normalizeCenter(Be),Z=d.project(ve),W=d.project(Be).sub(Z)}const X=d.zoomScale(C-_);let G,te;n.around&&(G=s.LngLat.convert(n.around),te=d.locationPoint(G));const Y=this._zooming||C!==_,pe=this._rotating||g!==k,he=this._pitching||z!==w,oe=!d.isPaddingEqual(R),fe=ve=>Be=>{if(Y&&(ve.zoom=s.number(_,C,Be)),pe&&(ve.bearing=s.number(g,k,Be)),he&&(ve.pitch=s.number(w,z,Be)),oe&&(ve.interpolatePadding(T,R,Be),K=ve.centerPoint.add(j)),G)ve.setLocationAtPoint(G,te);else{const dt=ve.zoomScale(ve.zoom-_),Ae=C>_?Math.min(2,X):Math.max(.5,X),Je=Math.pow(Ae,1-Be),rt=ve.unproject(Z.add(W.mult(Be*Je)).mult(dt));ve.setLocationAtPoint(ve.renderWorldCopies?rt.wrap():rt,K)}return n.preloadOnly||this._fireMoveEvents(a),ve};if(n.preloadOnly){const ve=this._emulate(fe,n.duration,d);return this._preloadTiles(ve),this}const le={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Y,this._rotating=pe,this._pitching=he,this._padding=oe,this._easeId=n.easeId,this._prepareEase(a,n.noMoveStart,le),this._ease(fe(d),ve=>{d.recenterOnTerrain(),this._afterEase(a,ve)},n),this}_prepareEase(n,a,d={}){this._moving=!0,this.transform.cameraElevationReference="sea",a||d.moving||this.fire(new s.Event("movestart",n)),this._zooming&&!d.zooming&&this.fire(new s.Event("zoomstart",n)),this._rotating&&!d.rotating&&this.fire(new s.Event("rotatestart",n)),this._pitching&&!d.pitching&&this.fire(new s.Event("pitchstart",n))}_fireMoveEvents(n){this.fire(new s.Event("move",n)),this._zooming&&this.fire(new s.Event("zoom",n)),this._rotating&&this.fire(new s.Event("rotate",n)),this._pitching&&this.fire(new s.Event("pitch",n))}_afterEase(n,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const d=this._zooming,_=this._rotating,g=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new s.Event("zoomend",n)),_&&this.fire(new s.Event("rotateend",n)),g&&this.fire(new s.Event("pitchend",n)),this.fire(new s.Event("moveend",n))}flyTo(n,a){if(!n.essential&&s.exported.prefersReducedMotion){const It=s.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(It,a)}this.stop(),n=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},n);const d=this.transform,_=this.getZoom(),g=this.getBearing(),w=this.getPitch(),T=this.getPadding(),C="zoom"in n?s.clamp(+n.zoom,d.minZoom,d.maxZoom):_,k="bearing"in n?this._normalizeBearing(n.bearing,g):g,z="pitch"in n?+n.pitch:w,R="padding"in n?n.padding:d.padding,j=d.zoomScale(C-_),K=s.pointGeometry.convert(n.offset);let Z=d.centerPoint.add(K);const W=d.pointLocation(Z),X=s.LngLat.convert(n.center||W);this._normalizeCenter(X);const G=d.project(W),te=d.project(X).sub(G);let Y=n.curve;const pe=Math.max(d.width,d.height),he=pe/j,oe=te.mag();if("minZoom"in n){const It=s.clamp(Math.min(n.minZoom,_,C),d.minZoom,d.maxZoom),St=pe/d.zoomScale(It-_);Y=Math.sqrt(St/oe*2)}const fe=Y*Y;function le(It){const St=(he*he-pe*pe+(It?-1:1)*fe*fe*oe*oe)/(2*(It?he:pe)*fe*oe);return Math.log(Math.sqrt(St*St+1)-St)}function ve(It){return(Math.exp(It)-Math.exp(-It))/2}function Be(It){return(Math.exp(It)+Math.exp(-It))/2}const dt=le(0);let Ae=function(It){return Be(dt)/Be(dt+Y*It)},Je=function(It){return pe*((Be(dt)*(ve(St=dt+Y*It)/Be(St))-ve(dt))/fe)/oe;var St},rt=(le(1)-dt)/Y;if(Math.abs(oe)<1e-6||!isFinite(rt)){if(Math.abs(pe-he)<1e-6)return this.easeTo(n,a);const It=he<pe?-1:1;rt=Math.abs(Math.log(he/pe))/Y,Je=function(){return 0},Ae=function(St){return Math.exp(It*Y*St)}}n.duration="duration"in n?+n.duration:1e3*rt/("screenSpeed"in n?+n.screenSpeed/Y:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const wt=g!==k,qe=z!==w,mt=!d.isPaddingEqual(R),it=It=>St=>{const Vt=St*rt,Wt=1/Ae(Vt);It.zoom=St===1?C:_+It.scaleZoom(Wt),wt&&(It.bearing=s.number(g,k,St)),qe&&(It.pitch=s.number(w,z,St)),mt&&(It.interpolatePadding(T,R,St),Z=It.centerPoint.add(K));const ii=St===1?X:It.unproject(G.add(te.mult(Je(Vt))).mult(Wt));return It.setLocationAtPoint(It.renderWorldCopies?ii.wrap():ii,Z),It._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(a),It};if(n.preloadOnly){const It=this._emulate(it,n.duration,d);return this._preloadTiles(It),this}return this._zooming=!0,this._rotating=wt,this._pitching=qe,this._padding=mt,this._prepareEase(a,!1),this._ease(it(d),()=>this._afterEase(a),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const d=this._onEaseEnd;this._onEaseEnd=void 0,d.call(this,a)}if(!n){const d=this.handlers;d&&d.stop(!1)}return this}_ease(n,a,d){d.animate===!1||d.duration===0?(n(1),a()):(this._easeStart=s.exported.now(),this._easeOptions=d,this._onEaseFrame=n,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((s.exported.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,a){n=s.wrap(n,-180,180);const d=Math.abs(n-a);return Math.abs(n-360-a)<d&&(n-=360),Math.abs(n+360-a)<d&&(n+=360),n}_normalizeCenter(n){const a=this.transform;if(!a.renderWorldCopies||a.maxBounds)return;const d=n.lng-a.center.lng;n.lng+=d>180?-360:d<-180?360:0}_emulate(n,a,d){const _=Math.ceil(15*a/1e3),g=[],w=n(d.clone());for(let T=0;T<=_;T++){const C=w(T/_);g.push(C.clone())}return g}}class Mu{constructor(n={}){this.options=n,s.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const a=this.options&&this.options.compact;return this._map=n,this._container=q("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=q("button","mapboxgl-ctrl-attrib-button",this._container),q("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=q("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,a){const d=this._map._getUIString(`AttributionControl.${a}`);n.setAttribute("aria-label",d),n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",d)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.config.ACCESS_TOKEN}];if(n){const d=a.reduce((_,g,w)=>(g.value&&(_+=`${g.key}=${g.value}${w<a.length-1?"&":""}`),_),"?");n.href=`${s.config.FEEDBACK_URL}/${d}#${wu(this._map,!0)}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const a=this._map.style._sourceCaches;for(const _ in a){const g=a[_];if(g.used){const w=g.getSource();w.attribution&&n.indexOf(w.attribution)<0&&n.push(w.attribution)}}n.sort((_,g)=>_.length-g.length),n=n.filter((_,g)=>{for(let w=g+1;w<n.length;w++)if(n[w].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const d=n.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,n.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Iu{constructor(){s.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=q("div","mapboxgl-ctrl");const a=q("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const a in n){const d=n[a].getSource();if(d.hasOwnProperty("mapbox_logo")&&!d.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const a=n[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class ku{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const a=++this._id;return this._queue.push({callback:n,id:a,cancelled:!1}),a}remove(n){const a=this._currentlyRunning,d=a?this._queue.concat(a):this._queue;for(const _ of d)if(_.id===n)return void(_.cancelled=!0)}run(n=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const d of a)if(!d.cancelled&&(d.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function zu(c,n,a){if(c=new s.LngLat(c.lng,c.lat),n){const d=new s.LngLat(c.lng-360,c.lat),_=new s.LngLat(c.lng+360,c.lat),g=360*Math.ceil(Math.abs(c.lng-a.center.lng)/360),w=a.locationPoint(c).distSqr(n),T=n.x<0||n.y<0||n.x>a.width||n.y>a.height;a.locationPoint(d).distSqr(n)<w&&(T||Math.abs(d.lng-a.center.lng)<g)?c=d:a.locationPoint(_).distSqr(n)<w&&(T||Math.abs(_.lng-a.center.lng)<g)&&(c=_)}for(;Math.abs(c.lng-a.center.lng)>180;){const d=a.locationPoint(c);if(d.x>=0&&d.y>=0&&d.x<=a.width&&d.y<=a.height)break;c.lng>a.center.lng?c.lng-=360:c.lng+=360}return c}const Va={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Wl extends s.Evented{constructor(n,a){if(super(),(n instanceof s.window.HTMLElement||a)&&(n=s.extend({element:n},a)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),n&&n.element)this._element=n.element,this._offset=s.pointGeometry.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=q("div");const _=41,g=27,w=H("svg",{display:"block",height:_*this._scale+"px",width:g*this._scale+"px",viewBox:`0 0 ${g} ${_}`},this._element),T=H("radialGradient",{id:"shadowGradient"},H("defs",{},w));H("stop",{offset:"10%","stop-opacity":.4},T),H("stop",{offset:"100%","stop-opacity":.05},T),H("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},w),H("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},w),H("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},w),H("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},w),this._offset=s.pointGeometry.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",_=>{_.preventDefault()}),this._element.addEventListener("mousedown",_=>{_.preventDefault()});const d=this._element.classList;for(const _ in Va)d.remove(`mapboxgl-marker-anchor-${_}`);d.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=s.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const a=n.code,d=n.charCode||n.keyCode;a!=="Space"&&a!=="Enter"&&d!==32&&d!==13||this.togglePopup()}_onMapClick(n){const a=n.originalEvent.target,d=this._element;this._popup&&(a===d||d.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map;if(!n)return!1;const a=n.unproject(this._pos),d=n.getFreeCameraOptions();if(!d.position)return!1;const _=d.position.toLngLat();return _.distanceTo(a)<.9*_.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const a=this._pos;if(!a||a.x<0||a.x>n.transform.width||a.y<0||a.y>n.transform.height)return void this._clearFadeTimer();const d=n.unproject(a);let _;n._showingGlobe()&&s.isLngLatBehindGlobe(n.transform,this._lngLat)?_=0:(_=1-n._queryFogOpacity(d),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(_*=.2)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const a=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${Va[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${a.x}px,${a.y}px)
        `}_calculateXYTransform(){const n=this._pos,a=this._map,d=this.getPitchAlignment();if(!a||!n||d!=="map")return"";if(!a._showingGlobe()){const C=a.getPitch();return C?`rotateX(${C}deg)`:""}const _=s.radToDeg(s.globeTiltAtLngLat(a.transform,this._lngLat)),g=n.sub(s.globeCenterToScreenPoint(a.transform)),w=Math.abs(g.x)+Math.abs(g.y);if(w===0)return"";const T=_/w;return`rotateX(${-g.y*T}deg) rotateY(${g.x*T}deg)`}_calculateZTransform(){const n=this._pos,a=this._map;if(!a||!n)return"";let d=0;const _=this.getRotationAlignment();if(_==="map")if(a._showingGlobe()){const g=a.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),w=a.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(g);d=s.radToDeg(Math.atan2(w.y,w.x))-90}else d=-a.getBearing();else if(_==="horizon"){const g=s.smoothstep(4,6,a.getZoom()),w=s.globeCenterToScreenPoint(a.transform);w.y+=g*a.transform.height;const T=n.sub(w),C=s.radToDeg(Math.atan2(T.y,T.x));d=(C>90?C-270:C+90)*(1-g)}return d+=this._rotation,d?`rotateZ(${d}deg)`:""}_update(n){s.window.cancelAnimationFrame(this._updateFrameId);const a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=zu(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat),n===!0?this._updateFrameId=s.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),a._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=s.pointGeometry.convert(n),this._update(),this}_onMove(n){const a=this._map;if(a){if(!this._isDragging){const d=this._clickTolerance||a._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=a.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"}_addDragHandler(n){const a=this._map;a&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos),this._pointerdownPos=n.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const a=this._map;return a&&(n?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}}class Cd{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const a=s.easeCubicInOut((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,a,d){this._start=this.getValue(a),this._end=n,this._startTime=a,this._endTime=a+d}}const Ad={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Md={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Ua(c){c.parentNode&&c.parentNode.removeChild(c)}const Id={showCompass:!0,showZoom:!0,visualizePitch:!1};class Pu{constructor(n,a,d=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new Eu({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,d&&(this.mousePitch=new Rn({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(n,a){this.mouseRotate.mousedown(n,a),this.mousePitch&&this.mousePitch.mousedown(n,a),He()}move(n,a){const d=this.map,_=this.mouseRotate.mousemoveWindow(n,a),g=_&&_.bearingDelta;if(g&&d.setBearing(d.getBearing()+g),this.mousePitch){const w=this.mousePitch.mousemoveWindow(n,a),T=w&&w.pitchDelta;T&&d.setPitch(d.getPitch()+T)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){we(),s.window.removeEventListener("mousemove",this.mousemove),s.window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(s.extend({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),Te(this.element,n)),s.window.addEventListener("mousemove",this.mousemove),s.window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,Te(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Pe(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=Pe(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const kd={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Du={maxWidth:100,unit:"metric"};function Lu(c,n,a){const d=Hl(n),_=d/n,g={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[a];this._map._requestDomTask(()=>{this._container.style.width=c*_+"px",this._container.innerHTML=`${d}&nbsp;${g}`})}function Hl(c){const n=Math.pow(10,`${Math.floor(c)}`.length-1);let a=c/n;return a=a>=10?10:a>=5?5:a>=3?3:a>=2?2:a>=1?1:function(d){const _=Math.pow(10,Math.ceil(-Math.log(d)/Math.LN10));return Math.round(d*_)/_}(a),n*a}const Up={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Np=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Xl(c=new s.pointGeometry(0,0),n="bottom"){if(typeof c=="number"){const a=Math.round(Math.sqrt(.5*Math.pow(c,2)));switch(n){case"top":return new s.pointGeometry(0,c);case"top-left":return new s.pointGeometry(a,a);case"top-right":return new s.pointGeometry(-a,a);case"bottom":return new s.pointGeometry(0,-c);case"bottom-left":return new s.pointGeometry(a,-a);case"bottom-right":return new s.pointGeometry(-a,-a);case"left":return new s.pointGeometry(c,0);case"right":return new s.pointGeometry(-c,0)}return new s.pointGeometry(0,0)}return c instanceof s.pointGeometry||Array.isArray(c)?s.pointGeometry.convert(c):s.pointGeometry.convert(c[n]||[0,0])}const Na={version:s.version,supported:V,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:class extends Sd{constructor(c){if((c=s.extend({},Md,c)).minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(c.antialias&&s.isSafariWithAntialiasingBug(s.window)&&(c.antialias=!1,s.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Da(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies),c),this._interactive=c.interactive,this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=c.preserveDrawingBuffer,this._antialias=c.antialias,this._trackResize=c.trackResize,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles,this._fadeDuration=c.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=c.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=c.collectResourceTiming,this._optimizeForTerrain=c.optimizeForTerrain,this._language=c.language==="auto"?s.window.navigator.language:c.language,this._worldview=c.worldview,this._renderTaskQueue=new ku,this._domRenderTaskQueue=new ku,this._controls=[],this._markers=[],this._mapId=s.uniqueId(),this._locale=s.extend({},Ad,c.locale),this._clickTolerance=c.clickTolerance,this._cooperativeGestures=c.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Cd(0),this._useExplicitProjection=!1,this._requestManager=new s.RequestManager(c.transformRequest,c.accessToken,c.testMode),this._silenceAuthErrors=!!c.testMode,typeof c.container=="string"){if(this._container=s.window.document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof s.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(this._container.childNodes.length>0&&s.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),c.maxBounds&&this.setMaxBounds(c.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),s.window!==void 0&&(s.window.addEventListener("online",this._onWindowOnline,!1),s.window.addEventListener("resize",this._onWindowResize,!1),s.window.addEventListener("orientationchange",this._onWindowResize,!1),s.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Ed(this,c),this._localFontFamily=c.localFontFamily,this._localIdeographFontFamily=c.localIdeographFontFamily,c.style&&this.setStyle(c.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),c.projection&&this.setProjection(c.projection),this._hash=c.hash&&new sd(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,s.extend({},c.fitBoundsOptions,{duration:0})))),this.resize(),c.attributionControl&&this.addControl(new Mu({customAttribution:c.customAttribution})),this._logoControl=new Iu,this.addControl(this._logoControl,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new s.Event(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new s.Event(`${n.dataType}dataloading`,n))})}_getMapId(){return this._mapId}addControl(c,n){if(n===void 0&&(n=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=c.onAdd(this);this._controls.push(c);const d=this._controlPositions[n];return n.indexOf("bottom")!==-1?d.insertBefore(a,d.firstChild):d.appendChild(a),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(c);return n>-1&&this._controls.splice(n,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(c){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new s.Event("movestart",c)).fire(new s.Event("move",c)),this.fire(new s.Event("resize",c)),n&&this.fire(new s.Event("moveend",c)),this}getBounds(){return this.transform.projection.name==="globe"&&s.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(c){return this.transform.setMaxBounds(s.LngLatBounds.convert(c)),this._update()}setMinZoom(c){if((c=c==null?-2:c)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c?this.setZoom(c):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c==null?22:c)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c?this.setZoom(c):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c==null?0:c)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c?this.setPitch(c):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c==null?85:c)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c?this.setPitch(c):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this._update()}getLanguage(){return this._language}setLanguage(c){if(this._language=c==="auto"?s.window.navigator.language:c,this.style)for(const n in this.style._sourceCaches){const a=this.style._sourceCaches[n]._source;a._setLanguage&&a._setLanguage(this._language)}for(const n of this._controls)n._setLanguage&&n._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(c){if(this._worldview=c,this.style)for(const n in this.style._sourceCaches){const a=this.style._sourceCaches[n]._source;a._setWorldview&&a._setWorldview(c)}return this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(c){return this._lazyInitEmptyStyle(),c?typeof c=="string"&&(c={name:c}):c=null,this._useExplicitProjection=!!c,this._prioritizeAndUpdateProjection(c,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const c=this.transform,n=c.projection.name;let a;n==="globe"&&c.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?(c.setMercatorFromTransition(),a=!0):n==="mercator"&&c.zoom<s.GLOBE_ZOOM_THRESHOLD_MAX&&(c.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(c,n){return this._updateProjection(c||n||{name:"mercator"})}_updateProjection(c){let n;if(n=c.name==="globe"&&this.transform.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(c),this.style.applyProjectionUpdate(),n){this.painter.clearBackgroundTiles();for(const a in this.style._sourceCaches)this.style._sourceCaches[a].clearTiles();this._update(!0)}return this}project(c){return this.transform.locationPoint3D(s.LngLat.convert(c))}unproject(c){return this.transform.pointLocation3D(s.pointGeometry.convert(c))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(c,n,a){if(c==="mouseenter"||c==="mouseover"){let d=!1;const _=w=>{const T=n.filter(k=>this.getLayer(k)),C=T.length?this.queryRenderedFeatures(w.point,{layers:T}):[];C.length?d||(d=!0,a.call(this,new $n(c,this,w.originalEvent,{features:C}))):d=!1},g=()=>{d=!1};return{layers:new Set(n),listener:a,delegates:{mousemove:_,mouseout:g}}}if(c==="mouseleave"||c==="mouseout"){let d=!1;const _=w=>{const T=n.filter(C=>this.getLayer(C));(T.length?this.queryRenderedFeatures(w.point,{layers:T}):[]).length?d=!0:d&&(d=!1,a.call(this,new $n(c,this,w.originalEvent)))},g=w=>{d&&(d=!1,a.call(this,new $n(c,this,w.originalEvent)))};return{layers:new Set(n),listener:a,delegates:{mousemove:_,mouseout:g}}}{const d=_=>{const g=n.filter(T=>this.getLayer(T)),w=g.length?this.queryRenderedFeatures(_.point,{layers:g}):[];w.length&&(_.features=w,a.call(this,_),delete _.features)};return{layers:new Set(n),listener:a,delegates:{[c]:d}}}}on(c,n,a){if(a===void 0)return super.on(c,n);Array.isArray(n)||(n=[n]);const d=this._createDelegatedListener(c,n,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(d);for(const _ in d.delegates)this.on(_,d.delegates[_]);return this}once(c,n,a){if(a===void 0)return super.once(c,n);Array.isArray(n)||(n=[n]);const d=this._createDelegatedListener(c,n,a);for(const _ in d.delegates)this.once(_,d.delegates[_]);return this}off(c,n,a){if(a===void 0)return super.off(c,n);n=new Set(Array.isArray(n)?n:[n]);const d=(g,w)=>{if(g.size!==w.size)return!1;for(const T of g)if(!w.has(T))return!1;return!0},_=this._delegatedListeners?this._delegatedListeners[c]:void 0;return _&&(g=>{for(let w=0;w<g.length;w++){const T=g[w];if(T.listener===a&&d(T.layers,n)){for(const C in T.delegates)this.off(C,T.delegates[C]);return g.splice(w,1),this}}})(_),this}queryRenderedFeatures(c,n){return this.style?(n!==void 0||c===void 0||c instanceof s.pointGeometry||Array.isArray(c)||(n=c,c=void 0),this.style.queryRenderedFeatures(c=c||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(c,n){return this.style.querySourceFeatures(c,n)}queryTerrainElevation(c,n){const a=this.transform.elevation;return a?(n=s.extend({},{exaggerated:!0},n),a.getAtPoint(s.MercatorCoordinate.fromLngLat(c),null,n.exaggerated)):null}setStyle(c,n){return(n=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&c?(this._diffStyle(c,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(c,n))}_getUIString(c){const n=this._locale[c];if(n==null)throw new Error(`Missing UI string '${c}'`);return n}_updateStyle(c,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),c&&(this.style=new Cr(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof c=="string"?this.style.loadURL(c):this.style.loadJSON(c)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Cr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(c,n){if(typeof c=="string"){const a=this._requestManager.normalizeStyleURL(c),d=this._requestManager.transformRequest(a,s.ResourceType.Style);s.getJSON(d,(_,g)=>{_?this.fire(new s.ErrorEvent(_)):g&&this._updateDiff(g,n)})}else typeof c=="object"&&this._updateDiff(c,n)}_updateDiff(c,n){try{this.style.setState(c)&&this._update(!0)}catch(a){s.warnOnce(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(c,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.warnOnce("There is no style added to the map."),!1)}addSource(c,n){return this._lazyInitEmptyStyle(),this.style.addSource(c,n),this._update(!0)}isSourceLoaded(c){return!!this.style&&this.style._isSourceCacheLoaded(c)}areTilesLoaded(){const c=this.style&&this.style._sourceCaches;for(const n in c){const a=c[n]._tiles;for(const d in a){const _=a[d];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}addSourceType(c,n,a){this._lazyInitEmptyStyle(),this.style.addSourceType(c,n,a)}removeSource(c){return this.style.removeSource(c),this._updateTerrain(),this._update(!0)}getSource(c){return this.style.getSource(c)}addImage(c,n,{pixelRatio:a=1,sdf:d=!1,stretchX:_,stretchY:g,content:w}={}){if(this._lazyInitEmptyStyle(),n instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&n instanceof s.window.ImageBitmap){const{width:T,height:C,data:k}=s.exported.getImageData(n);this.style.addImage(c,{data:new s.RGBAImage({width:T,height:C},k),pixelRatio:a,stretchX:_,stretchY:g,content:w,sdf:d,version:0})}else if(n.width===void 0||n.height===void 0)this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:T,height:C}=n,k=n;this.style.addImage(c,{data:new s.RGBAImage({width:T,height:C},new Uint8Array(k.data)),pixelRatio:a,stretchX:_,stretchY:g,content:w,sdf:d,version:0,userImage:k}),k.onAdd&&k.onAdd(this,c)}}updateImage(c,n){const a=this.style.getImage(c);if(!a)return void this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=n instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&n instanceof s.window.ImageBitmap?s.exported.getImageData(n):n,{width:_,height:g}=d;_!==void 0&&g!==void 0?_===a.data.width&&g===a.data.height?(a.data.replace(d.data,!(n instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&n instanceof s.window.ImageBitmap)),this.style.updateImage(c,a)):this.fire(new s.ErrorEvent(new Error(`The width and height of the updated image (${_}, ${g})
                must be that same as the previous version of the image
                (${a.data.width}, ${a.data.height})`))):this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(c){return c?!!this.style.getImage(c):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(c)}loadImage(c,n){s.getImage(this._requestManager.transformRequest(c,s.ResourceType.Image),(a,d)=>{n(a,d instanceof s.window.HTMLImageElement?s.exported.getImageData(d):d)})}listImages(){return this.style.listImages()}addLayer(c,n){return this._lazyInitEmptyStyle(),this.style.addLayer(c,n),this._update(!0)}moveLayer(c,n){return this.style.moveLayer(c,n),this._update(!0)}removeLayer(c){return this.style.removeLayer(c),this._update(!0)}getLayer(c){return this.style.getLayer(c)}setLayerZoomRange(c,n,a){return this.style.setLayerZoomRange(c,n,a),this._update(!0)}setFilter(c,n,a={}){return this.style.setFilter(c,n,a),this._update(!0)}getFilter(c){return this.style.getFilter(c)}setPaintProperty(c,n,a,d={}){return this.style.setPaintProperty(c,n,a,d),this._update(!0)}getPaintProperty(c,n){return this.style.getPaintProperty(c,n)}setLayoutProperty(c,n,a,d={}){return this.style.setLayoutProperty(c,n,a,d),this._update(!0)}getLayoutProperty(c,n){return this.style.getLayoutProperty(c,n)}setLight(c,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(c,n),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(c){return this._lazyInitEmptyStyle(),!c&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(c),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(c){return this._lazyInitEmptyStyle(),this.style.setFog(c),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(c){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.LngLat.convert(c),this.transform):0}setFeatureState(c,n){return this.style.setFeatureState(c,n),this._update()}removeFeatureState(c,n){return this.style.removeFeatureState(c,n),this._update()}getFeatureState(c){return this.style.getFeatureState(c)}_updateContainerDimensions(){if(!this._container)return;const c=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let a,d,_,g=this._container;for(;g&&(!d||!_);){const w=s.window.getComputedStyle(g).transform;w&&w!=="none"&&(a=w.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(d=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(_=a[3])),g=g.parentElement}this._containerWidth=d?Math.abs(c/d):c,this._containerHeight=_?Math.abs(n/_):n}_detectMissingCSS(){s.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const c=this._container;c.classList.add("mapboxgl-map"),(this._missingCSSCanary=q("div","mapboxgl-canary",c)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=q("div","mapboxgl-canvas-container",c);this._interactive&&n.classList.add("mapboxgl-interactive"),this._canvas=q("canvas","mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const a=this._controlContainer=q("div","mapboxgl-control-container",c),d=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{d[_]=q("div",`mapboxgl-ctrl-${_}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(c,n){const a=s.exported.devicePixelRatio||1;this._canvas.width=a*Math.ceil(c),this._canvas.height=a*Math.ceil(n),this._canvas.style.width=`${c}px`,this._canvas.style.height=`${n}px`}_addMarker(c){this._markers.push(c)}_removeMarker(c){const n=this._markers.indexOf(c);n!==-1&&this._markers.splice(n,1)}_setupPainter(){const c=s.extend({},V.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl",c)||this._canvas.getContext("experimental-webgl",c);n?(s.storeAuthState(n,!0),this.painter=new gu(n,this.transform),this.on("data",a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.exported$1.testSupport(n)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(c){c.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:c}))}_contextRestored(c){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:c}))}_onMapScroll(c){if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(c){return this.style?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_requestDomTask(c){!this.loaded()||this.loaded()&&!this.isMoving()?c():this._domRenderTaskQueue.add(c)}_render(c){let n;const a=this.painter.context.extTimerQuery,d=s.exported.now();if(this.listens("gpu-timing-frame")&&(n=a.createQueryEXT(),a.beginQueryEXT(a.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(c),this._domRenderTaskQueue.run(c),this._removed)return;this._updateProjectionTransition();let _=!1;const g=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const C=this.transform.zoom,k=this.transform.pitch,z=s.exported.now();this.style.zoomHistory.update(C,z);const R=new s.EvaluationParameters(C,{now:z,fadeDuration:g,pitch:k,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),j=R.crossFadingFactor();j===1&&j===this._crossFadingFactor||(_=!0,this._crossFadingFactor=j),this.style.update(R)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let w=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),w=this._updateAverageElevation(d),this.style._updateSources(this.transform),this._forceMarkerUpdate()):w=this._updateAverageElevation(d),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,g,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:g,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.Event("load"))),this.style&&(this.style.hasTransitions()||_)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const C=s.exported.now()-d;a.endQueryEXT(a.TIME_ELAPSED_EXT,n),setTimeout(()=>{const k=a.getQueryObjectEXT(n,a.QUERY_RESULT_EXT)/1e6;a.deleteQueryEXT(n),this.fire(new s.Event("gpu-timing-frame",{cpuTime:C,gpuTime:k})),s.window.performance.mark("frame-gpu",{startTime:d,detail:{gpuTime:k}})},50)}if(this.listens("gpu-timing-layer")){const C=this.painter.collectGpuTimers();setTimeout(()=>{const k=this.painter.queryGpuTimers(C);this.fire(new s.Event("gpu-timing-layer",{layerTimes:k}))},50)}if(this.listens("gpu-timing-deferred-render")){const C=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const k=this.painter.queryGpuTimeDeferredRender(C);this.fire(new s.Event("gpu-timing-deferred-render",{gpuTime:k}))},50)}const T=this._sourcesDirty||this._styleDirty||this._placementDirty||w;if(T||this._repaint)this.triggerRepaint();else{const C=!this.isMoving()&&this.loaded();if(C&&(w=this._updateAverageElevation(d,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),C&&(this.fire(new s.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const k=this._calculateSpeedIndex();this.fire(new s.Event("speedindexcompleted",{speedIndex:k})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||T||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const c of this._markers)c._update()}_updateAverageElevation(c,n=!1){const a=d=>(this.transform.averageElevation=d,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);if((n||c-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(c)){const d=this.transform.averageElevation;let _=this.transform.sampleAverageElevation(),g=!1;this.transform.elevation&&(g=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(_)?_=0:this._averageElevationLastSampledAt=c;const w=Math.abs(d-_);if(w>1){if(this._isInitialLoad||g)return this._averageElevation.jumpTo(_),a(_);this._averageElevation.easeTo(_,c,300)}else if(w>1e-4)return this._averageElevation.jumpTo(_),a(_)}return!!this._averageElevation.isEasing(c)&&a(this._averageElevation.getValue(c))}_authenticate(){s.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,c=>{if(c&&(c.message===s.AUTH_ERR_MSG||c.status===401)){const n=this.painter.context.gl;s.storeAuthState(n,!1),this._logoControl instanceof Iu&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),s.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const c=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const a=this.painter.context.gl,d=a.createFramebuffer();function _(g){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,g,0);const w=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,w),w}return a.bindFramebuffer(a.FRAMEBUFFER,d),this._canvasPixelComparison(_(c),n.canvasCopies.map(_),n.timeStamps)}_canvasPixelComparison(c,n,a){let d=a[1]-a[0];const _=c.length/4;for(let g=0;g<n.length;g++){const w=n[g];let T=0;for(let C=0;C<w.length;C+=4)w[C]===c[C]&&w[C+1]===c[C+1]&&w[C+2]===c[C+2]&&w[C+3]===c[C+3]&&(T+=1);d+=(a[g+2]-a[g+1])*(1-T/_)}return d}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),s.window!==void 0&&(s.window.removeEventListener("resize",this._onWindowResize,!1),s.window.removeEventListener("orientationchange",this._onWindowResize,!1),s.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.removeEventListener("online",this._onWindowOnline,!1));const c=this.painter.context.gl.getExtension("WEBGL_lose_context");c&&c.loseContext(),Ua(this._canvasContainer),Ua(this._controlContainer),Ua(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),s.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new s.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(c){this._renderNextFrame=this._renderNextFrame||c,this.style&&!this._frame&&(this._frame=s.exported.frame(n=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(n)}))}_preloadTiles(c){const n=this.style?Object.values(this.style._sourceCaches):[];return s.asyncAll(n,(a,d)=>a._preloadTiles(c,d),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(c){this._trackResize&&this.resize({originalEvent:c})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(c){this._showTerrainWireframe!==c&&(this._showTerrainWireframe=c,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(c){this._speedIndexTiming!==c&&(this._speedIndexTiming=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}_setCacheLimits(c,n){s.setCacheLimits(c,n)}get version(){return s.version}},NavigationControl:class{constructor(c){this.options=s.extend({},Id,c),this._container=q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),q("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),q("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:n}):a.resetNorth({},{originalEvent:n}))}),this._compassIcon=q("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const c=this._map;if(!c)return;const n=c.getZoom(),a=n===c.getMaxZoom(),d=n===c.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){const c=this._map;if(!c)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(c.transform.pitch*(Math.PI/180)),.5)}) rotateX(${c.transform.pitch}deg) rotateZ(${c.transform.angle*(180/Math.PI)}deg)`:`rotate(${c.transform.angle*(180/Math.PI)}deg)`;c._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),c.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&c.on("pitch",this._rotateCompassArrow),c.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Pu(c,this._compass,this.options.visualizePitch)),this._container}onRemove(){const c=this._map;c&&(this._container.remove(),this.options.showZoom&&c.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&c.off("pitch",this._rotateCompassArrow),c.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(c,n){const a=q("button",c,this._container);return a.type="button",a.addEventListener("click",n),a}_setButtonTitle(c,n){if(!this._map)return;const a=this._map._getUIString(`NavigationControl.${n}`);c.setAttribute("aria-label",a),c.firstElementChild&&c.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends s.Evented{constructor(c){super(),this.options=s.extend({geolocation:s.window.navigator.geolocation},kd,c),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=La(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(c){return this._map=c,this._container=q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(c){this._supportsGeolocation!==void 0?c(this._supportsGeolocation):s.window.navigator.permissions!==void 0?s.window.navigator.permissions.query({name:"geolocation"}).then(n=>{this._supportsGeolocation=n.state!=="denied",c(this._supportsGeolocation)}):(this._supportsGeolocation=!!this.options.geolocation,c(this._supportsGeolocation))}_isOutOfMapMaxBounds(c){const n=this._map.getMaxBounds(),a=c.coords;return!!n&&(a.longitude<n.getWest()||a.longitude>n.getEast()||a.latitude<n.getSouth()||a.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",c)),this._finish()}}_updateCamera(c){const n=new s.LngLat(c.coords.longitude,c.coords.latitude),a=c.coords.accuracy,d=this._map.getBearing(),_=s.extend({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(a),_,{geolocateSource:!0})}_updateMarker(c){if(c){const n=new s.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const c=this._map.transform,n=s.mercatorZfromAltitude(1,c._center.lat)*c.worldSize,a=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",c)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(c){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=q("button","mapboxgl-ctrl-geolocate",this._container),q("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",c===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=q("div","mapboxgl-user-location"),this._dotElement.appendChild(q("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(q("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Wl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=q("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Wl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.Event("trackuserlocationend")))})}_onDeviceOrientation(c){this._userLocationDotMarker&&(c.webkitCompassHeading?this._heading=c.webkitCompassHeading:c.absolute===!0&&(this._heading=-1*c.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(c={maximumAge:6e5,timeout:0},this._noTimeout=!0):(c=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,c),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const c=()=>{s.window.addEventListener("ondeviceorientationabsolute"in s.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};s.window.DeviceMotionEvent!==void 0&&typeof s.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&c()}).catch(console.error):c()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),s.window.removeEventListener("deviceorientation",this._onDeviceOrientation),s.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Mu,ScaleControl:class{constructor(c){this.options=s.extend({},Du,c),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=Lu.bind(this)),s.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const c=this.options.maxWidth||100,n=this._map,a=n._containerHeight/2,d=n._containerWidth/2-c/2,_=n.unproject([d,a]),g=n.unproject([d+c,a]),w=_.distanceTo(g);if(this.options.unit==="imperial"){const T=3.2808*w;T>5280?this._setScale(c,T/5280,"mile"):this._setScale(c,T,"foot")}else this.options.unit==="nautical"?this._setScale(c,w/1852,"nautical-mile"):w>=1e3?this._setScale(c,w/1e3,"kilometer"):this._setScale(c,w,"meter")}_setScale(c,n,a){const d=Hl(n),_=d/n;this._map._requestDomTask(()=>{this._container.style.width=c*_+"px",this._container.innerHTML=a!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:a}).format(d):`${d}&nbsp;nm`})}onAdd(c){return this._map=c,this._language=c.getLanguage(),this._container=q("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(c){this._language=c,this._update()}setUnit(c){this.options.unit=c,this._update()}},FullscreenControl:class{constructor(c){this._fullscreen=!1,c&&c.container&&(c.container instanceof s.window.HTMLElement?this._container=c.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in s.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in s.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,s.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!s.window.document.fullscreenEnabled&&!s.window.document.webkitFullscreenEnabled)}_setupUI(){const c=this._fullscreenButton=q("button","mapboxgl-ctrl-fullscreen",this._controlContainer);q("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),s.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",c)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(s.window.document.fullscreenElement||s.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?s.window.document.exitFullscreen?s.window.document.exitFullscreen():s.window.document.webkitCancelFullScreen&&s.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.Evented{constructor(c){super(),this.options=s.extend(Object.create(Up),c),s.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(c&&c.className?c.className.trim().split(/\s+/):[])}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&c.on("preclick",this._onClose),this.options.closeOnMove&&c.on("move",this._onClose),c.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(c.on("mousemove",this._onMouseEvent),c.on("mouseup",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")):c.on("move",this._update),this.fire(new s.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const c=this._map;return c&&(c.off("move",this._update),c.off("move",this._onClose),c.off("preclick",this._onClose),c.off("click",this._onClose),c.off("remove",this.remove),c.off("mousemove",this._onMouseEvent),c.off("mouseup",this._onMouseEvent),c.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new s.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(c){this._lngLat=s.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const c=this._map;return c&&(c.off("move",this._update),c.on("mousemove",this._onMouseEvent),c.on("drag",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(s.window.document.createTextNode(c))}setHTML(c){const n=s.window.document.createDocumentFragment(),a=s.window.document.createElement("body");let d;for(a.innerHTML=c;d=a.firstChild,d;)n.appendChild(d);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=q("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(c),this.options.closeButton){const a=this._closeButton=q("button","mapboxgl-popup-close-button",n);a.type="button",a.setAttribute("aria-label","Close popup"),a.setAttribute("aria-hidden","true"),a.innerHTML="&#215;",a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(c){return this._classList.add(c),this._updateClassList(),this}removeClassName(c){return this._classList.delete(c),this._updateClassList(),this}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){let n;return this._classList.delete(c)?n=!1:(this._classList.add(c),n=!0),this._updateClassList(),n}_onMouseEvent(c){this._update(c.point)}_getAnchor(c){if(this.options.anchor)return this.options.anchor;const n=this._map,a=this._container,d=this._pos;if(!n||!a||!d)return"bottom";const _=a.offsetWidth,g=a.offsetHeight,w=d.x<_/2,T=d.x>n.transform.width-_/2;if(d.y+c<g)return w?"top-left":T?"top-right":"top";if(d.y>n.transform.height-g){if(w)return"bottom-left";if(T)return"bottom-right"}return w?"left":T?"right":"bottom"}_updateClassList(){const c=this._container;if(!c)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),c.className=n.join(" ")}_update(c){const n=this._map,a=this._content;if(!n||!this._lngLat&&!this._trackPointer||!a)return;let d=this._container;if(d||(d=this._container=q("div","mapboxgl-popup",n.getContainer()),this._tip=q("div","mapboxgl-popup-tip",d),d.appendChild(a)),this.options.maxWidth&&d.style.maxWidth!==this.options.maxWidth&&(d.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=zu(this._lngLat,this._pos,n.transform)),!this._trackPointer||c){const _=this._pos=this._trackPointer&&c?c:n.project(this._lngLat),g=Xl(this.options.offset),w=this._anchor=this._getAnchor(g.y),T=Xl(this.options.offset,w),C=_.add(T).round();n._requestDomTask(()=>{this._container&&w&&(this._container.style.transform=`${Va[w]} translate(${C.x}px,${C.y}px)`)})}if(!this._marker&&n._showingGlobe()){const _=s.isLngLatBehindGlobe(n.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const c=this._container.querySelector(Np);c&&c.focus()}_onClose(){this.remove()}_setOpacity(c){this._container&&(this._container.style.opacity=`${c}`),this._content&&(this._content.style.pointerEvents=c?"auto":"none")}},Marker:Wl,Style:Cr,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.pointGeometry,MercatorCoordinate:s.MercatorCoordinate,FreeCameraOptions:Pt,Evented:s.Evented,config:s.config,prewarm:function(){Pi().acquire(jt)},clearPrewarmedResources:function(){const c=ci;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(jt),ci=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return s.config.ACCESS_TOKEN},set accessToken(c){s.config.ACCESS_TOKEN=c},get baseApiUrl(){return s.config.API_URL},set baseApiUrl(c){s.config.API_URL=c},get workerCount(){return Qt.workerCount},set workerCount(c){Qt.workerCount=c},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){s.config.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage(c){s.clearTileCache(c)},workerUrl:"",workerClass:null,setNow:s.exported.setNow,restoreNow:s.exported.restoreNow};return Na});var A=b;return A})})(Wb);const f_=Wb.exports;const Xb=(r,h)=>{const p=r.__vccOpts||r;for(const[y,b]of h)p[y]=b;return p},_k={__name:"Mapbox",setup(r){const h=Rt();return f_.accessToken="pk.eyJ1IjoicnViZW5kZWRpZWdvOTAiLCJhIjoiY2t5anF6M2ltMHYxdDJ2cW9lNHZmc3JteiJ9.-WS08Ja1iIvjKvBNRX_X9w",sr(()=>{try{const p=new f_.Map({container:h.value,style:"mapbox://styles/mapbox/streets-v11",center:[-3.3257027308061775,40.49381049145687],zoom:13,projection:"globe"}),y=new f_.Marker().setLngLat([-3.3257027308061775,40.49381049145687]).addTo(p);p.on("style.load",()=>{p.setFog({})})}catch(p){console.error(p)}}),(p,y)=>(nr(),ca("div",{class:"map-container",ref_key:"mapContainer",ref:h},null,512))}},gk=Xb(_k,[["__scopeId","data-v-bcbcb3dd"]]),yk=Ei("div",{class:"col-12 column",style:{padding:"1rem"}},[Ei("p",{class:"text-justify"},[ms("Os esperamos en "),Ei("strong",null,[Ei("u",null,"La Vega del Henares")]),ms(" donde celebraremos nuestro matrimonio junto a nuestros seres queridos.")])],-1),vk={style:{display:"flex","justify-content":"center","align-items":"center","margin-top":"1rem"}},xk={href:"http://maps.google.com/?q=Carretera Madrid Barcelona, 0 Km 33, N-II, 28801 Alcal\xE1 de Henares, Madrid",style:{"text-decoration":"none"}},bk={__name:"Lugar",setup(r){return(h,p)=>(nr(),ca(wr,null,[Ft(Vh,{title:"Lugar"}),yk,Ft(gk),Ei("div",vk,[Ei("a",xk,[Ft(Zo,{color:"black",icon:"map",label:"Ir a Google Maps",rounded:""})])])],64))}},wk={},Tk={class:"q-pa-md"},Ek=L1('<div class="column"><h3>Musica</h3><div class="col-12" style="background-color:purple;height:100px;"></div></div><div class="column" style="height:150px;"><div class="col-4 col-md-6">.col-4 .col-md-6</div><div class="col-4 col-md-6">.col-4 .col-md-6</div><div class="col-4 col-md-6">.col-4 .col-md-6</div></div>',2),Sk=[Ek];function Ck(r,h){return nr(),ca("div",Tk,Sk)}const Ak=Xb(wk,[["render",Ck]]),Mk=L1('<div class="col-12 column" style="padding:1rem;"><p class="text-justify">Vuestra presencia ser\xE1 nuestro mejor regalo. A\xFAn as\xED, si quieres contribuir en nuestra futura vida juntos, os facilitamos el n\xFAmero de cuenta.</p><div class="flex col-12" style="display:flex;justify-content:center;align-items:center;"><p class="text-justify"><strong>ES8801986139751066924632</strong></p></div><p class="text-justify">Tres cosas hay en la vida; salud, dinero y amor. Afortunadamente nos sobran salud y amor.</p></div><p style="color:red;">EL NUMERO DE CUENTA NO ES ESE, CAMBIAR</p>',2),Ik={__name:"Regalos",setup(r){return(h,p)=>(nr(),ca(wr,null,[Ft(Vh,{title:"Regalos"}),Mk],64))}},kk={class:"column",style:{"z-index":"0"}},zk={href:"https://api.whatsapp.com/send?phone=+34689529238",class:"col-6",style:{"text-decoration":"inherit"}},Pk={href:"https://api.whatsapp.com/send?phone=+34665091123",class:"col-6",style:{"text-decoration":"inherit"}},Dk={__name:"App",setup(r){const h=Rt("Inicio"),p=b=>{h.value=b},y=Rt("");return sr(async()=>{y.value=await CI()}),(b,E)=>(nr(),ps(LC,{view:"hHh LpR lFf"},{default:cn(()=>[Ft(wC,{elevated:"",class:"bg-primary text-white"},{default:cn(()=>[Ft(xC,{class:"col-12",src:Y_(aA),style:{height:"100px"},fit:"fill"},null,8,["src"])]),_:1}),Ft(CC,null,{default:cn(()=>[Ft(SC,{style:{"z-index":"1"},position:"top-left",offset:[10,10]},{default:cn(()=>[Ft(sA,{class:"column",onHandleTabSelected:E[0]||(E[0]=A=>p(A))})]),_:1}),Ei("div",kk,[h.value==="Asistencia"?(nr(),ps(NI,{key:0})):pc("",!0),h.value==="Inicio"?(nr(),ps(hk,{key:1})):pc("",!0),h.value==="Itinerario"?(nr(),ps(mk,{key:2})):pc("",!0),h.value==="Lugar"?(nr(),ps(bk,{key:3})):pc("",!0),h.value==="M\xFAsica"?(nr(),ps(Ak,{key:4})):pc("",!0),h.value==="Regalos"?(nr(),ps(Ik,{key:5})):pc("",!0)])]),_:1}),Ft(MC,{elevated:"",class:"q-pa-md bg-grey-8"},{default:cn(()=>[Ft(AC,{class:"row justify-end"},{default:cn(()=>[Ei("a",zk,[Ft(Gx,{avatar:"https://cdn.quasar.dev/img/avatar1.jpg",text:["\xBFDudas?"],sent:""})]),Ei("a",Pk,[Ft(Gx,{avatar:"https://cdn.quasar.dev/img/avatar2.jpg",text:["\xA1Clicka!"],sent:""})])]),_:1})]),_:1})]),_:1}))}},Kb=NS(Dk);Kb.use(fC,{plugins:{}});Kb.mount("#app");

(function(){const f=document.createElement("link").relList;if(f&&f.supports&&f.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))v(w);new MutationObserver(w=>{for(const A of w)if(A.type==="childList")for(const z of A.addedNodes)z.tagName==="LINK"&&z.rel==="modulepreload"&&v(z)}).observe(document,{childList:!0,subtree:!0});function g(w){const A={};return w.integrity&&(A.integrity=w.integrity),w.referrerpolicy&&(A.referrerPolicy=w.referrerpolicy),w.crossorigin==="use-credentials"?A.credentials="include":w.crossorigin==="anonymous"?A.credentials="omit":A.credentials="same-origin",A}function v(w){if(w.ep)return;w.ep=!0;const A=g(w);fetch(w.href,A)}})();function Hm(o,f){const g=Object.create(null),v=o.split(",");for(let w=0;w<v.length;w++)g[v[w]]=!0;return f?w=>!!g[w.toLowerCase()]:w=>!!g[w]}const Gw="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Zw=Hm(Gw);function Ev(o){return!!o||o===""}function Km(o){if(oi(o)){const f={};for(let g=0;g<o.length;g++){const v=o[g],w=zn(v)?Hw(v):Km(v);if(w)for(const A in w)f[A]=w[A]}return f}else{if(zn(o))return o;if(tn(o))return o}}const Ww=/;(?![^(]*\))/g,Xw=/:(.+)/;function Hw(o){const f={};return o.split(Ww).forEach(g=>{if(g){const v=g.split(Xw);v.length>1&&(f[v[0].trim()]=v[1].trim())}}),f}function Ym(o){let f="";if(zn(o))f=o;else if(oi(o))for(let g=0;g<o.length;g++){const v=Ym(o[g]);v&&(f+=v+" ")}else if(tn(o))for(const g in o)o[g]&&(f+=g+" ");return f.trim()}const Kw=o=>zn(o)?o:o==null?"":oi(o)||tn(o)&&(o.toString===Mv||!hi(o.toString))?JSON.stringify(o,Sv,2):String(o),Sv=(o,f)=>f&&f.__v_isRef?Sv(o,f.value):ac(f)?{[`Map(${f.size})`]:[...f.entries()].reduce((g,[v,w])=>(g[`${v} =>`]=w,g),{})}:Cv(f)?{[`Set(${f.size})`]:[...f.values()]}:tn(f)&&!oi(f)&&!Iv(f)?String(f):f,Hi={},sc=[],ro=()=>{},Yw=()=>!1,Jw=/^on[^a-z]/,xf=o=>Jw.test(o),Jm=o=>o.startsWith("onUpdate:"),$n=Object.assign,Qm=(o,f)=>{const g=o.indexOf(f);g>-1&&o.splice(g,1)},Qw=Object.prototype.hasOwnProperty,Si=(o,f)=>Qw.call(o,f),oi=Array.isArray,ac=o=>vf(o)==="[object Map]",Cv=o=>vf(o)==="[object Set]",hi=o=>typeof o=="function",zn=o=>typeof o=="string",e_=o=>typeof o=="symbol",tn=o=>o!==null&&typeof o=="object",Av=o=>tn(o)&&hi(o.then)&&hi(o.catch),Mv=Object.prototype.toString,vf=o=>Mv.call(o),eT=o=>vf(o).slice(8,-1),Iv=o=>vf(o)==="[object Object]",t_=o=>zn(o)&&o!=="NaN"&&o[0]!=="-"&&""+parseInt(o,10)===o,tf=Hm(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),bf=o=>{const f=Object.create(null);return g=>f[g]||(f[g]=o(g))},tT=/-(\w)/g,hc=bf(o=>o.replace(tT,(f,g)=>g?g.toUpperCase():"")),iT=/\B([A-Z])/g,pc=bf(o=>o.replace(iT,"-$1").toLowerCase()),zv=bf(o=>o.charAt(0).toUpperCase()+o.slice(1)),cm=bf(o=>o?`on${zv(o)}`:""),sh=(o,f)=>!Object.is(o,f),nh=(o,f)=>{for(let g=0;g<o.length;g++)o[g](f)},af=(o,f,g)=>{Object.defineProperty(o,f,{configurable:!0,enumerable:!1,value:g})},kv=o=>{const f=parseFloat(o);return isNaN(f)?o:f};let ix;const nT=()=>ix||(ix=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});let Io;class rT{constructor(f=!1){this.active=!0,this.effects=[],this.cleanups=[],!f&&Io&&(this.parent=Io,this.index=(Io.scopes||(Io.scopes=[])).push(this)-1)}run(f){if(this.active){const g=Io;try{return Io=this,f()}finally{Io=g}}}on(){Io=this}off(){Io=this.parent}stop(f){if(this.active){let g,v;for(g=0,v=this.effects.length;g<v;g++)this.effects[g].stop();for(g=0,v=this.cleanups.length;g<v;g++)this.cleanups[g]();if(this.scopes)for(g=0,v=this.scopes.length;g<v;g++)this.scopes[g].stop(!0);if(this.parent&&!f){const w=this.parent.scopes.pop();w&&w!==this&&(this.parent.scopes[this.index]=w,w.index=this.index)}this.active=!1}}}function oT(o,f=Io){f&&f.active&&f.effects.push(o)}const i_=o=>{const f=new Set(o);return f.w=0,f.n=0,f},Pv=o=>(o.w&Xs)>0,Dv=o=>(o.n&Xs)>0,sT=({deps:o})=>{if(o.length)for(let f=0;f<o.length;f++)o[f].w|=Xs},aT=o=>{const{deps:f}=o;if(f.length){let g=0;for(let v=0;v<f.length;v++){const w=f[v];Pv(w)&&!Dv(w)?w.delete(o):f[g++]=w,w.w&=~Xs,w.n&=~Xs}f.length=g}},Sm=new WeakMap;let Qu=0,Xs=1;const Cm=30;let to;const Xa=Symbol(""),Am=Symbol("");class n_{constructor(f,g=null,v){this.fn=f,this.scheduler=g,this.active=!0,this.deps=[],this.parent=void 0,oT(this,v)}run(){if(!this.active)return this.fn();let f=to,g=Zs;for(;f;){if(f===this)return;f=f.parent}try{return this.parent=to,to=this,Zs=!0,Xs=1<<++Qu,Qu<=Cm?sT(this):nx(this),this.fn()}finally{Qu<=Cm&&aT(this),Xs=1<<--Qu,to=this.parent,Zs=g,this.parent=void 0,this.deferStop&&this.stop()}}stop(){to===this?this.deferStop=!0:this.active&&(nx(this),this.onStop&&this.onStop(),this.active=!1)}}function nx(o){const{deps:f}=o;if(f.length){for(let g=0;g<f.length;g++)f[g].delete(o);f.length=0}}let Zs=!0;const Lv=[];function mc(){Lv.push(Zs),Zs=!1}function _c(){const o=Lv.pop();Zs=o===void 0?!0:o}function kr(o,f,g){if(Zs&&to){let v=Sm.get(o);v||Sm.set(o,v=new Map);let w=v.get(g);w||v.set(g,w=i_()),Rv(w)}}function Rv(o,f){let g=!1;Qu<=Cm?Dv(o)||(o.n|=Xs,g=!Pv(o)):g=!o.has(to),g&&(o.add(to),to.deps.push(o))}function os(o,f,g,v,w,A){const z=Sm.get(o);if(!z)return;let s=[];if(f==="clear")s=[...z.values()];else if(g==="length"&&oi(o))z.forEach((B,Z)=>{(Z==="length"||Z>=v)&&s.push(B)});else switch(g!==void 0&&s.push(z.get(g)),f){case"add":oi(o)?t_(g)&&s.push(z.get("length")):(s.push(z.get(Xa)),ac(o)&&s.push(z.get(Am)));break;case"delete":oi(o)||(s.push(z.get(Xa)),ac(o)&&s.push(z.get(Am)));break;case"set":ac(o)&&s.push(z.get(Xa));break}if(s.length===1)s[0]&&Mm(s[0]);else{const B=[];for(const Z of s)Z&&B.push(...Z);Mm(i_(B))}}function Mm(o,f){const g=oi(o)?o:[...o];for(const v of g)v.computed&&rx(v);for(const v of g)v.computed||rx(v)}function rx(o,f){(o!==to||o.allowRecurse)&&(o.scheduler?o.scheduler():o.run())}const lT=Hm("__proto__,__v_isRef,__isVue"),Bv=new Set(Object.getOwnPropertyNames(Symbol).filter(o=>o!=="arguments"&&o!=="caller").map(o=>Symbol[o]).filter(e_)),cT=r_(),uT=r_(!1,!0),hT=r_(!0),ox=dT();function dT(){const o={};return["includes","indexOf","lastIndexOf"].forEach(f=>{o[f]=function(...g){const v=Ui(this);for(let A=0,z=this.length;A<z;A++)kr(v,"get",A+"");const w=v[f](...g);return w===-1||w===!1?v[f](...g.map(Ui)):w}}),["push","pop","shift","unshift","splice"].forEach(f=>{o[f]=function(...g){mc();const v=Ui(this)[f].apply(this,g);return _c(),v}}),o}function r_(o=!1,f=!1){return function(v,w,A){if(w==="__v_isReactive")return!o;if(w==="__v_isReadonly")return o;if(w==="__v_isShallow")return f;if(w==="__v_raw"&&A===(o?f?MT:Nv:f?Vv:Uv).get(v))return v;const z=oi(v);if(!o&&z&&Si(ox,w))return Reflect.get(ox,w,A);const s=Reflect.get(v,w,A);return(e_(w)?Bv.has(w):lT(w))||(o||kr(v,"get",w),f)?s:er(s)?z&&t_(w)?s:s.value:tn(s)?o?jv(s):ns(s):s}}const fT=Fv(),pT=Fv(!0);function Fv(o=!1){return function(g,v,w,A){let z=g[v];if(dc(z)&&er(z)&&!er(w))return!1;if(!o&&(!lf(w)&&!dc(w)&&(z=Ui(z),w=Ui(w)),!oi(g)&&er(z)&&!er(w)))return z.value=w,!0;const s=oi(g)&&t_(v)?Number(v)<g.length:Si(g,v),B=Reflect.set(g,v,w,A);return g===Ui(A)&&(s?sh(w,z)&&os(g,"set",v,w):os(g,"add",v,w)),B}}function mT(o,f){const g=Si(o,f);o[f];const v=Reflect.deleteProperty(o,f);return v&&g&&os(o,"delete",f,void 0),v}function _T(o,f){const g=Reflect.has(o,f);return(!e_(f)||!Bv.has(f))&&kr(o,"has",f),g}function gT(o){return kr(o,"iterate",oi(o)?"length":Xa),Reflect.ownKeys(o)}const Ov={get:cT,set:fT,deleteProperty:mT,has:_T,ownKeys:gT},yT={get:hT,set(o,f){return!0},deleteProperty(o,f){return!0}},xT=$n({},Ov,{get:uT,set:pT}),o_=o=>o,wf=o=>Reflect.getPrototypeOf(o);function Gd(o,f,g=!1,v=!1){o=o.__v_raw;const w=Ui(o),A=Ui(f);g||(f!==A&&kr(w,"get",f),kr(w,"get",A));const{has:z}=wf(w),s=v?o_:g?l_:ah;if(z.call(w,f))return s(o.get(f));if(z.call(w,A))return s(o.get(A));o!==w&&o.get(f)}function Zd(o,f=!1){const g=this.__v_raw,v=Ui(g),w=Ui(o);return f||(o!==w&&kr(v,"has",o),kr(v,"has",w)),o===w?g.has(o):g.has(o)||g.has(w)}function Wd(o,f=!1){return o=o.__v_raw,!f&&kr(Ui(o),"iterate",Xa),Reflect.get(o,"size",o)}function sx(o){o=Ui(o);const f=Ui(this);return wf(f).has.call(f,o)||(f.add(o),os(f,"add",o,o)),this}function ax(o,f){f=Ui(f);const g=Ui(this),{has:v,get:w}=wf(g);let A=v.call(g,o);A||(o=Ui(o),A=v.call(g,o));const z=w.call(g,o);return g.set(o,f),A?sh(f,z)&&os(g,"set",o,f):os(g,"add",o,f),this}function lx(o){const f=Ui(this),{has:g,get:v}=wf(f);let w=g.call(f,o);w||(o=Ui(o),w=g.call(f,o)),v&&v.call(f,o);const A=f.delete(o);return w&&os(f,"delete",o,void 0),A}function cx(){const o=Ui(this),f=o.size!==0,g=o.clear();return f&&os(o,"clear",void 0,void 0),g}function Xd(o,f){return function(v,w){const A=this,z=A.__v_raw,s=Ui(z),B=f?o_:o?l_:ah;return!o&&kr(s,"iterate",Xa),z.forEach((Z,ee)=>v.call(w,B(Z),B(ee),A))}}function Hd(o,f,g){return function(...v){const w=this.__v_raw,A=Ui(w),z=ac(A),s=o==="entries"||o===Symbol.iterator&&z,B=o==="keys"&&z,Z=w[o](...v),ee=g?o_:f?l_:ah;return!f&&kr(A,"iterate",B?Am:Xa),{next(){const{value:G,done:te}=Z.next();return te?{value:G,done:te}:{value:s?[ee(G[0]),ee(G[1])]:ee(G),done:te}},[Symbol.iterator](){return this}}}}function Us(o){return function(...f){return o==="delete"?!1:this}}function vT(){const o={get(A){return Gd(this,A)},get size(){return Wd(this)},has:Zd,add:sx,set:ax,delete:lx,clear:cx,forEach:Xd(!1,!1)},f={get(A){return Gd(this,A,!1,!0)},get size(){return Wd(this)},has:Zd,add:sx,set:ax,delete:lx,clear:cx,forEach:Xd(!1,!0)},g={get(A){return Gd(this,A,!0)},get size(){return Wd(this,!0)},has(A){return Zd.call(this,A,!0)},add:Us("add"),set:Us("set"),delete:Us("delete"),clear:Us("clear"),forEach:Xd(!0,!1)},v={get(A){return Gd(this,A,!0,!0)},get size(){return Wd(this,!0)},has(A){return Zd.call(this,A,!0)},add:Us("add"),set:Us("set"),delete:Us("delete"),clear:Us("clear"),forEach:Xd(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(A=>{o[A]=Hd(A,!1,!1),g[A]=Hd(A,!0,!1),f[A]=Hd(A,!1,!0),v[A]=Hd(A,!0,!0)}),[o,g,f,v]}const[bT,wT,TT,ET]=vT();function s_(o,f){const g=f?o?ET:TT:o?wT:bT;return(v,w,A)=>w==="__v_isReactive"?!o:w==="__v_isReadonly"?o:w==="__v_raw"?v:Reflect.get(Si(g,w)&&w in v?g:v,w,A)}const ST={get:s_(!1,!1)},CT={get:s_(!1,!0)},AT={get:s_(!0,!1)},Uv=new WeakMap,Vv=new WeakMap,Nv=new WeakMap,MT=new WeakMap;function IT(o){switch(o){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function zT(o){return o.__v_skip||!Object.isExtensible(o)?0:IT(eT(o))}function ns(o){return dc(o)?o:a_(o,!1,Ov,ST,Uv)}function kT(o){return a_(o,!1,xT,CT,Vv)}function jv(o){return a_(o,!0,yT,AT,Nv)}function a_(o,f,g,v,w){if(!tn(o)||o.__v_raw&&!(f&&o.__v_isReactive))return o;const A=w.get(o);if(A)return A;const z=zT(o);if(z===0)return o;const s=new Proxy(o,z===2?v:g);return w.set(o,s),s}function lc(o){return dc(o)?lc(o.__v_raw):!!(o&&o.__v_isReactive)}function dc(o){return!!(o&&o.__v_isReadonly)}function lf(o){return!!(o&&o.__v_isShallow)}function $v(o){return lc(o)||dc(o)}function Ui(o){const f=o&&o.__v_raw;return f?Ui(f):o}function Tf(o){return af(o,"__v_skip",!0),o}const ah=o=>tn(o)?ns(o):o,l_=o=>tn(o)?jv(o):o;function qv(o){Zs&&to&&(o=Ui(o),Rv(o.dep||(o.dep=i_())))}function Gv(o,f){o=Ui(o),o.dep&&Mm(o.dep)}function er(o){return!!(o&&o.__v_isRef===!0)}function ii(o){return PT(o,!1)}function PT(o,f){return er(o)?o:new DT(o,f)}class DT{constructor(f,g){this.__v_isShallow=g,this.dep=void 0,this.__v_isRef=!0,this._rawValue=g?f:Ui(f),this._value=g?f:ah(f)}get value(){return qv(this),this._value}set value(f){const g=this.__v_isShallow||lf(f)||dc(f);f=g?f:Ui(f),sh(f,this._rawValue)&&(this._rawValue=f,this._value=g?f:ah(f),Gv(this))}}function c_(o){return er(o)?o.value:o}const LT={get:(o,f,g)=>c_(Reflect.get(o,f,g)),set:(o,f,g,v)=>{const w=o[f];return er(w)&&!er(g)?(w.value=g,!0):Reflect.set(o,f,g,v)}};function Zv(o){return lc(o)?o:new Proxy(o,LT)}var Wv;class RT{constructor(f,g,v,w){this._setter=g,this.dep=void 0,this.__v_isRef=!0,this[Wv]=!1,this._dirty=!0,this.effect=new n_(f,()=>{this._dirty||(this._dirty=!0,Gv(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!w,this.__v_isReadonly=v}get value(){const f=Ui(this);return qv(f),(f._dirty||!f._cacheable)&&(f._dirty=!1,f._value=f.effect.run()),f._value}set value(f){this._setter(f)}}Wv="__v_isReadonly";function BT(o,f,g=!1){let v,w;const A=hi(o);return A?(v=o,w=ro):(v=o.get,w=o.set),new RT(v,w,A||!w,g)}function Ws(o,f,g,v){let w;try{w=v?o(...v):o()}catch(A){Ef(A,f,g)}return w}function Vr(o,f,g,v){if(hi(o)){const A=Ws(o,f,g,v);return A&&Av(A)&&A.catch(z=>{Ef(z,f,g)}),A}const w=[];for(let A=0;A<o.length;A++)w.push(Vr(o[A],f,g,v));return w}function Ef(o,f,g,v=!0){const w=f?f.vnode:null;if(f){let A=f.parent;const z=f.proxy,s=g;for(;A;){const Z=A.ec;if(Z){for(let ee=0;ee<Z.length;ee++)if(Z[ee](o,z,s)===!1)return}A=A.parent}const B=f.appContext.config.errorHandler;if(B){Ws(B,null,10,[o,z,s]);return}}FT(o,g,w,v)}function FT(o,f,g,v=!0){console.error(o)}let lh=!1,Im=!1;const Qn=[];let Po=0;const cc=[];let ts=null,qa=0;const Xv=Promise.resolve();let u_=null;function zr(o){const f=u_||Xv;return o?f.then(this?o.bind(this):o):f}function OT(o){let f=Po+1,g=Qn.length;for(;f<g;){const v=f+g>>>1;ch(Qn[v])<o?f=v+1:g=v}return f}function h_(o){(!Qn.length||!Qn.includes(o,lh&&o.allowRecurse?Po+1:Po))&&(o.id==null?Qn.push(o):Qn.splice(OT(o.id),0,o),Hv())}function Hv(){!lh&&!Im&&(Im=!0,u_=Xv.then(Yv))}function UT(o){const f=Qn.indexOf(o);f>Po&&Qn.splice(f,1)}function VT(o){oi(o)?cc.push(...o):(!ts||!ts.includes(o,o.allowRecurse?qa+1:qa))&&cc.push(o),Hv()}function ux(o,f=lh?Po+1:0){for(;f<Qn.length;f++){const g=Qn[f];g&&g.pre&&(Qn.splice(f,1),f--,g())}}function Kv(o){if(cc.length){const f=[...new Set(cc)];if(cc.length=0,ts){ts.push(...f);return}for(ts=f,ts.sort((g,v)=>ch(g)-ch(v)),qa=0;qa<ts.length;qa++)ts[qa]();ts=null,qa=0}}const ch=o=>o.id==null?1/0:o.id,NT=(o,f)=>{const g=ch(o)-ch(f);if(g===0){if(o.pre&&!f.pre)return-1;if(f.pre&&!o.pre)return 1}return g};function Yv(o){Im=!1,lh=!0,Qn.sort(NT);const f=ro;try{for(Po=0;Po<Qn.length;Po++){const g=Qn[Po];g&&g.active!==!1&&Ws(g,null,14)}}finally{Po=0,Qn.length=0,Kv(),lh=!1,u_=null,(Qn.length||cc.length)&&Yv()}}function jT(o,f,...g){if(o.isUnmounted)return;const v=o.vnode.props||Hi;let w=g;const A=f.startsWith("update:"),z=A&&f.slice(7);if(z&&z in v){const ee=`${z==="modelValue"?"model":z}Modifiers`,{number:G,trim:te}=v[ee]||Hi;te&&(w=g.map(_e=>_e.trim())),G&&(w=g.map(kv))}let s,B=v[s=cm(f)]||v[s=cm(hc(f))];!B&&A&&(B=v[s=cm(pc(f))]),B&&Vr(B,o,6,w);const Z=v[s+"Once"];if(Z){if(!o.emitted)o.emitted={};else if(o.emitted[s])return;o.emitted[s]=!0,Vr(Z,o,6,w)}}function Jv(o,f,g=!1){const v=f.emitsCache,w=v.get(o);if(w!==void 0)return w;const A=o.emits;let z={},s=!1;if(!hi(o)){const B=Z=>{const ee=Jv(Z,f,!0);ee&&(s=!0,$n(z,ee))};!g&&f.mixins.length&&f.mixins.forEach(B),o.extends&&B(o.extends),o.mixins&&o.mixins.forEach(B)}return!A&&!s?(tn(o)&&v.set(o,null),null):(oi(A)?A.forEach(B=>z[B]=null):$n(z,A),tn(o)&&v.set(o,z),z)}function Sf(o,f){return!o||!xf(f)?!1:(f=f.slice(2).replace(/Once$/,""),Si(o,f[0].toLowerCase()+f.slice(1))||Si(o,pc(f))||Si(o,f))}let io=null,Qv=null;function cf(o){const f=io;return io=o,Qv=o&&o.type.__scopeId||null,f}function bn(o,f=io,g){if(!f||o._n)return o;const v=(...w)=>{v._d&&vx(-1);const A=cf(f),z=o(...w);return cf(A),v._d&&vx(1),z};return v._n=!0,v._c=!0,v._d=!0,v}function um(o){const{type:f,vnode:g,proxy:v,withProxy:w,props:A,propsOptions:[z],slots:s,attrs:B,emit:Z,render:ee,renderCache:G,data:te,setupState:_e,ctx:Ee,inheritAttrs:Te}=o;let Be,ot;const Se=cf(o);try{if(g.shapeFlag&4){const ct=w||v;Be=zo(ee.call(ct,ct,G,A,_e,te,Ee)),ot=B}else{const ct=f;Be=zo(ct.length>1?ct(A,{attrs:B,slots:s,emit:Z}):ct(A,null)),ot=f.props?B:$T(B)}}catch(ct){oh.length=0,Ef(ct,o,1),Be=Vt(oo)}let Je=Be;if(ot&&Te!==!1){const ct=Object.keys(ot),{shapeFlag:Ie}=Je;ct.length&&Ie&7&&(z&&ct.some(Jm)&&(ot=qT(ot,z)),Je=ss(Je,ot))}return g.dirs&&(Je=ss(Je),Je.dirs=Je.dirs?Je.dirs.concat(g.dirs):g.dirs),g.transition&&(Je.transition=g.transition),Be=Je,cf(Se),Be}const $T=o=>{let f;for(const g in o)(g==="class"||g==="style"||xf(g))&&((f||(f={}))[g]=o[g]);return f},qT=(o,f)=>{const g={};for(const v in o)(!Jm(v)||!(v.slice(9)in f))&&(g[v]=o[v]);return g};function GT(o,f,g){const{props:v,children:w,component:A}=o,{props:z,children:s,patchFlag:B}=f,Z=A.emitsOptions;if(f.dirs||f.transition)return!0;if(g&&B>=0){if(B&1024)return!0;if(B&16)return v?hx(v,z,Z):!!z;if(B&8){const ee=f.dynamicProps;for(let G=0;G<ee.length;G++){const te=ee[G];if(z[te]!==v[te]&&!Sf(Z,te))return!0}}}else return(w||s)&&(!s||!s.$stable)?!0:v===z?!1:v?z?hx(v,z,Z):!0:!!z;return!1}function hx(o,f,g){const v=Object.keys(f);if(v.length!==Object.keys(o).length)return!0;for(let w=0;w<v.length;w++){const A=v[w];if(f[A]!==o[A]&&!Sf(g,A))return!0}return!1}function ZT({vnode:o,parent:f},g){for(;f&&f.subTree===o;)(o=f.vnode).el=g,f=f.parent}const e0=o=>o.__isSuspense;function WT(o,f){f&&f.pendingBranch?oi(o)?f.effects.push(...o):f.effects.push(o):VT(o)}function fh(o,f){if(Nn){let g=Nn.provides;const v=Nn.parent&&Nn.parent.provides;v===g&&(g=Nn.provides=Object.create(v)),g[o]=f}}function Lo(o,f,g=!1){const v=Nn||io;if(v){const w=v.parent==null?v.vnode.appContext&&v.vnode.appContext.provides:v.parent.provides;if(w&&o in w)return w[o];if(arguments.length>1)return g&&hi(f)?f.call(v.proxy):f}}const dx={};function di(o,f,g){return t0(o,f,g)}function t0(o,f,{immediate:g,deep:v,flush:w,onTrack:A,onTrigger:z}=Hi){const s=Nn;let B,Z=!1,ee=!1;if(er(o)?(B=()=>o.value,Z=lf(o)):lc(o)?(B=()=>o,v=!0):oi(o)?(ee=!0,Z=o.some(ot=>lc(ot)||lf(ot)),B=()=>o.map(ot=>{if(er(ot))return ot.value;if(lc(ot))return Wa(ot);if(hi(ot))return Ws(ot,s,2)})):hi(o)?f?B=()=>Ws(o,s,2):B=()=>{if(!(s&&s.isUnmounted))return G&&G(),Vr(o,s,3,[te])}:B=ro,f&&v){const ot=B;B=()=>Wa(ot())}let G,te=ot=>{G=Be.onStop=()=>{Ws(ot,s,4)}};if(hh)return te=ro,f?g&&Vr(f,s,3,[B(),ee?[]:void 0,te]):B(),ro;let _e=ee?[]:dx;const Ee=()=>{if(!!Be.active)if(f){const ot=Be.run();(v||Z||(ee?ot.some((Se,Je)=>sh(Se,_e[Je])):sh(ot,_e)))&&(G&&G(),Vr(f,s,3,[ot,_e===dx?void 0:_e,te]),_e=ot)}else Be.run()};Ee.allowRecurse=!!f;let Te;w==="sync"?Te=Ee:w==="post"?Te=()=>Un(Ee,s&&s.suspense):(Ee.pre=!0,s&&(Ee.id=s.uid),Te=()=>h_(Ee));const Be=new n_(B,Te);return f?g?Ee():_e=Be.run():w==="post"?Un(Be.run.bind(Be),s&&s.suspense):Be.run(),()=>{Be.stop(),s&&s.scope&&Qm(s.scope.effects,Be)}}function XT(o,f,g){const v=this.proxy,w=zn(o)?o.includes(".")?i0(v,o):()=>v[o]:o.bind(v,v);let A;hi(f)?A=f:(A=f.handler,g=f);const z=Nn;fc(this);const s=t0(w,A.bind(v),g);return z?fc(z):Ha(),s}function i0(o,f){const g=f.split(".");return()=>{let v=o;for(let w=0;w<g.length&&v;w++)v=v[g[w]];return v}}function Wa(o,f){if(!tn(o)||o.__v_skip||(f=f||new Set,f.has(o)))return o;if(f.add(o),er(o))Wa(o.value,f);else if(oi(o))for(let g=0;g<o.length;g++)Wa(o[g],f);else if(Cv(o)||ac(o))o.forEach(g=>{Wa(g,f)});else if(Iv(o))for(const g in o)Wa(o[g],f);return o}function HT(){const o={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return ur(()=>{o.isMounted=!0}),ir(()=>{o.isUnmounting=!0}),o}const Fr=[Function,Array],KT={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Fr,onEnter:Fr,onAfterEnter:Fr,onEnterCancelled:Fr,onBeforeLeave:Fr,onLeave:Fr,onAfterLeave:Fr,onLeaveCancelled:Fr,onBeforeAppear:Fr,onAppear:Fr,onAfterAppear:Fr,onAppearCancelled:Fr},setup(o,{slots:f}){const g=nn(),v=HT();let w;return()=>{const A=f.default&&o0(f.default(),!0);if(!A||!A.length)return;let z=A[0];if(A.length>1){for(const Te of A)if(Te.type!==oo){z=Te;break}}const s=Ui(o),{mode:B}=s;if(v.isLeaving)return hm(z);const Z=fx(z);if(!Z)return hm(z);const ee=zm(Z,s,v,g);uf(Z,ee);const G=g.subTree,te=G&&fx(G);let _e=!1;const{getTransitionKey:Ee}=Z.type;if(Ee){const Te=Ee();w===void 0?w=Te:Te!==w&&(w=Te,_e=!0)}if(te&&te.type!==oo&&(!Ga(Z,te)||_e)){const Te=zm(te,s,v,g);if(uf(te,Te),B==="out-in")return v.isLeaving=!0,Te.afterLeave=()=>{v.isLeaving=!1,g.update()},hm(z);B==="in-out"&&Z.type!==oo&&(Te.delayLeave=(Be,ot,Se)=>{const Je=r0(v,te);Je[String(te.key)]=te,Be._leaveCb=()=>{ot(),Be._leaveCb=void 0,delete ee.delayedLeave},ee.delayedLeave=Se})}return z}}},n0=KT;function r0(o,f){const{leavingVNodes:g}=o;let v=g.get(f.type);return v||(v=Object.create(null),g.set(f.type,v)),v}function zm(o,f,g,v){const{appear:w,mode:A,persisted:z=!1,onBeforeEnter:s,onEnter:B,onAfterEnter:Z,onEnterCancelled:ee,onBeforeLeave:G,onLeave:te,onAfterLeave:_e,onLeaveCancelled:Ee,onBeforeAppear:Te,onAppear:Be,onAfterAppear:ot,onAppearCancelled:Se}=f,Je=String(o.key),ct=r0(g,o),Ie=(ze,Qe)=>{ze&&Vr(ze,v,9,Qe)},Pe=(ze,Qe)=>{const Fe=Qe[1];Ie(ze,Qe),oi(ze)?ze.every(dt=>dt.length<=1)&&Fe():ze.length<=1&&Fe()},be={mode:A,persisted:z,beforeEnter(ze){let Qe=s;if(!g.isMounted)if(w)Qe=Te||s;else return;ze._leaveCb&&ze._leaveCb(!0);const Fe=ct[Je];Fe&&Ga(o,Fe)&&Fe.el._leaveCb&&Fe.el._leaveCb(),Ie(Qe,[ze])},enter(ze){let Qe=B,Fe=Z,dt=ee;if(!g.isMounted)if(w)Qe=Be||B,Fe=ot||Z,dt=Se||ee;else return;let ft=!1;const Ze=ze._enterCb=Ke=>{ft||(ft=!0,Ke?Ie(dt,[ze]):Ie(Fe,[ze]),be.delayedLeave&&be.delayedLeave(),ze._enterCb=void 0)};Qe?Pe(Qe,[ze,Ze]):Ze()},leave(ze,Qe){const Fe=String(o.key);if(ze._enterCb&&ze._enterCb(!0),g.isUnmounting)return Qe();Ie(G,[ze]);let dt=!1;const ft=ze._leaveCb=Ze=>{dt||(dt=!0,Qe(),Ze?Ie(Ee,[ze]):Ie(_e,[ze]),ze._leaveCb=void 0,ct[Fe]===o&&delete ct[Fe])};ct[Fe]=o,te?Pe(te,[ze,ft]):ft()},clone(ze){return zm(ze,f,g,v)}};return be}function hm(o){if(Cf(o))return o=ss(o),o.children=null,o}function fx(o){return Cf(o)?o.children?o.children[0]:void 0:o}function uf(o,f){o.shapeFlag&6&&o.component?uf(o.component.subTree,f):o.shapeFlag&128?(o.ssContent.transition=f.clone(o.ssContent),o.ssFallback.transition=f.clone(o.ssFallback)):o.transition=f}function o0(o,f=!1,g){let v=[],w=0;for(let A=0;A<o.length;A++){let z=o[A];const s=g==null?z.key:String(g)+String(z.key!=null?z.key:A);z.type===xr?(z.patchFlag&128&&w++,v=v.concat(o0(z.children,f,s))):(f||z.type!==oo)&&v.push(s!=null?ss(z,{key:s}):z)}if(w>1)for(let A=0;A<v.length;A++)v[A].patchFlag=-2;return v}function YT(o){return hi(o)?{setup:o,name:o.name}:o}const rh=o=>!!o.type.__asyncLoader,Cf=o=>o.type.__isKeepAlive,JT={name:"KeepAlive",__isKeepAlive:!0,props:{include:[String,RegExp,Array],exclude:[String,RegExp,Array],max:[String,Number]},setup(o,{slots:f}){const g=nn(),v=g.ctx;if(!v.renderer)return()=>{const Se=f.default&&f.default();return Se&&Se.length===1?Se[0]:Se};const w=new Map,A=new Set;let z=null;const s=g.suspense,{renderer:{p:B,m:Z,um:ee,o:{createElement:G}}}=v,te=G("div");v.activate=(Se,Je,ct,Ie,Pe)=>{const be=Se.component;Z(Se,Je,ct,0,s),B(be.vnode,Se,Je,ct,be,s,Ie,Se.slotScopeIds,Pe),Un(()=>{be.isDeactivated=!1,be.a&&nh(be.a);const ze=Se.props&&Se.props.onVnodeMounted;ze&&Ur(ze,be.parent,Se)},s)},v.deactivate=Se=>{const Je=Se.component;Z(Se,te,null,1,s),Un(()=>{Je.da&&nh(Je.da);const ct=Se.props&&Se.props.onVnodeUnmounted;ct&&Ur(ct,Je.parent,Se),Je.isDeactivated=!0},s)};function _e(Se){dm(Se),ee(Se,g,s,!0)}function Ee(Se){w.forEach((Je,ct)=>{const Ie=Tx(Je.type);Ie&&(!Se||!Se(Ie))&&Te(ct)})}function Te(Se){const Je=w.get(Se);!z||Je.type!==z.type?_e(Je):z&&dm(z),w.delete(Se),A.delete(Se)}di(()=>[o.include,o.exclude],([Se,Je])=>{Se&&Ee(ct=>eh(Se,ct)),Je&&Ee(ct=>!eh(Je,ct))},{flush:"post",deep:!0});let Be=null;const ot=()=>{Be!=null&&w.set(Be,fm(g.subTree))};return ur(ot),h0(ot),ir(()=>{w.forEach(Se=>{const{subTree:Je,suspense:ct}=g,Ie=fm(Je);if(Se.type===Ie.type){dm(Ie);const Pe=Ie.component.da;Pe&&Un(Pe,ct);return}_e(Se)})}),()=>{if(Be=null,!f.default)return null;const Se=f.default(),Je=Se[0];if(Se.length>1)return z=null,Se;if(!ff(Je)||!(Je.shapeFlag&4)&&!(Je.shapeFlag&128))return z=null,Je;let ct=fm(Je);const Ie=ct.type,Pe=Tx(rh(ct)?ct.type.__asyncResolved||{}:Ie),{include:be,exclude:ze,max:Qe}=o;if(be&&(!Pe||!eh(be,Pe))||ze&&Pe&&eh(ze,Pe))return z=ct,Je;const Fe=ct.key==null?Ie:ct.key,dt=w.get(Fe);return ct.el&&(ct=ss(ct),Je.shapeFlag&128&&(Je.ssContent=ct)),Be=Fe,dt?(ct.el=dt.el,ct.component=dt.component,ct.transition&&uf(ct,ct.transition),ct.shapeFlag|=512,A.delete(Fe),A.add(Fe)):(A.add(Fe),Qe&&A.size>parseInt(Qe,10)&&Te(A.values().next().value)),ct.shapeFlag|=256,z=ct,e0(Je.type)?Je:ct}}},QT=JT;function eh(o,f){return oi(o)?o.some(g=>eh(g,f)):zn(o)?o.split(",").includes(f):o.test?o.test(f):!1}function s0(o,f){l0(o,"a",f)}function a0(o,f){l0(o,"da",f)}function l0(o,f,g=Nn){const v=o.__wdc||(o.__wdc=()=>{let w=g;for(;w;){if(w.isDeactivated)return;w=w.parent}return o()});if(Af(f,v,g),g){let w=g.parent;for(;w&&w.parent;)Cf(w.parent.vnode)&&e2(v,f,g,w),w=w.parent}}function e2(o,f,g,v){const w=Af(f,o,v,!0);d_(()=>{Qm(v[f],w)},g)}function dm(o){let f=o.shapeFlag;f&256&&(f-=256),f&512&&(f-=512),o.shapeFlag=f}function fm(o){return o.shapeFlag&128?o.ssContent:o}function Af(o,f,g=Nn,v=!1){if(g){const w=g[o]||(g[o]=[]),A=f.__weh||(f.__weh=(...z)=>{if(g.isUnmounted)return;mc(),fc(g);const s=Vr(f,g,o,z);return Ha(),_c(),s});return v?w.unshift(A):w.push(A),A}}const ls=o=>(f,g=Nn)=>(!hh||o==="sp")&&Af(o,(...v)=>f(...v),g),c0=ls("bm"),ur=ls("m"),u0=ls("bu"),h0=ls("u"),ir=ls("bum"),d_=ls("um"),t2=ls("sp"),i2=ls("rtg"),n2=ls("rtc");function r2(o,f=Nn){Af("ec",o,f)}function d0(o,f){const g=io;if(g===null)return o;const v=If(g)||g.proxy,w=o.dirs||(o.dirs=[]);for(let A=0;A<f.length;A++){let[z,s,B,Z=Hi]=f[A];hi(z)&&(z={mounted:z,updated:z}),z.deep&&Wa(s),w.push({dir:z,instance:v,value:s,oldValue:void 0,arg:B,modifiers:Z})}return o}function Ua(o,f,g,v){const w=o.dirs,A=f&&f.dirs;for(let z=0;z<w.length;z++){const s=w[z];A&&(s.oldValue=A[z].value);let B=s.dir[v];B&&(mc(),Vr(B,g,8,[o.el,s,o,f]),_c())}}const o2=Symbol(),km=o=>o?E0(o)?If(o)||o.proxy:km(o.parent):null,hf=$n(Object.create(null),{$:o=>o,$el:o=>o.vnode.el,$data:o=>o.data,$props:o=>o.props,$attrs:o=>o.attrs,$slots:o=>o.slots,$refs:o=>o.refs,$parent:o=>km(o.parent),$root:o=>km(o.root),$emit:o=>o.emit,$options:o=>f_(o),$forceUpdate:o=>o.f||(o.f=()=>h_(o.update)),$nextTick:o=>o.n||(o.n=zr.bind(o.proxy)),$watch:o=>XT.bind(o)}),s2={get({_:o},f){const{ctx:g,setupState:v,data:w,props:A,accessCache:z,type:s,appContext:B}=o;let Z;if(f[0]!=="$"){const _e=z[f];if(_e!==void 0)switch(_e){case 1:return v[f];case 2:return w[f];case 4:return g[f];case 3:return A[f]}else{if(v!==Hi&&Si(v,f))return z[f]=1,v[f];if(w!==Hi&&Si(w,f))return z[f]=2,w[f];if((Z=o.propsOptions[0])&&Si(Z,f))return z[f]=3,A[f];if(g!==Hi&&Si(g,f))return z[f]=4,g[f];Pm&&(z[f]=0)}}const ee=hf[f];let G,te;if(ee)return f==="$attrs"&&kr(o,"get",f),ee(o);if((G=s.__cssModules)&&(G=G[f]))return G;if(g!==Hi&&Si(g,f))return z[f]=4,g[f];if(te=B.config.globalProperties,Si(te,f))return te[f]},set({_:o},f,g){const{data:v,setupState:w,ctx:A}=o;return w!==Hi&&Si(w,f)?(w[f]=g,!0):v!==Hi&&Si(v,f)?(v[f]=g,!0):Si(o.props,f)||f[0]==="$"&&f.slice(1)in o?!1:(A[f]=g,!0)},has({_:{data:o,setupState:f,accessCache:g,ctx:v,appContext:w,propsOptions:A}},z){let s;return!!g[z]||o!==Hi&&Si(o,z)||f!==Hi&&Si(f,z)||(s=A[0])&&Si(s,z)||Si(v,z)||Si(hf,z)||Si(w.config.globalProperties,z)},defineProperty(o,f,g){return g.get!=null?o._.accessCache[f]=0:Si(g,"value")&&this.set(o,f,g.value,null),Reflect.defineProperty(o,f,g)}};let Pm=!0;function a2(o){const f=f_(o),g=o.proxy,v=o.ctx;Pm=!1,f.beforeCreate&&px(f.beforeCreate,o,"bc");const{data:w,computed:A,methods:z,watch:s,provide:B,inject:Z,created:ee,beforeMount:G,mounted:te,beforeUpdate:_e,updated:Ee,activated:Te,deactivated:Be,beforeDestroy:ot,beforeUnmount:Se,destroyed:Je,unmounted:ct,render:Ie,renderTracked:Pe,renderTriggered:be,errorCaptured:ze,serverPrefetch:Qe,expose:Fe,inheritAttrs:dt,components:ft,directives:Ze,filters:Ke}=f;if(Z&&l2(Z,v,null,o.appContext.config.unwrapInjectedRef),z)for(const tt in z){const Mt=z[tt];hi(Mt)&&(v[tt]=Mt.bind(g))}if(w){const tt=w.call(g,g);tn(tt)&&(o.data=ns(tt))}if(Pm=!0,A)for(const tt in A){const Mt=A[tt],Li=hi(Mt)?Mt.bind(g,g):hi(Mt.get)?Mt.get.bind(g,g):ro,xt=!hi(Mt)&&hi(Mt.set)?Mt.set.bind(g):ro,bi=Ue({get:Li,set:xt});Object.defineProperty(v,tt,{enumerable:!0,configurable:!0,get:()=>bi.value,set:Jt=>bi.value=Jt})}if(s)for(const tt in s)f0(s[tt],v,g,tt);if(B){const tt=hi(B)?B.call(g):B;Reflect.ownKeys(tt).forEach(Mt=>{fh(Mt,tt[Mt])})}ee&&px(ee,o,"c");function Wt(tt,Mt){oi(Mt)?Mt.forEach(Li=>tt(Li.bind(g))):Mt&&tt(Mt.bind(g))}if(Wt(c0,G),Wt(ur,te),Wt(u0,_e),Wt(h0,Ee),Wt(s0,Te),Wt(a0,Be),Wt(r2,ze),Wt(n2,Pe),Wt(i2,be),Wt(ir,Se),Wt(d_,ct),Wt(t2,Qe),oi(Fe))if(Fe.length){const tt=o.exposed||(o.exposed={});Fe.forEach(Mt=>{Object.defineProperty(tt,Mt,{get:()=>g[Mt],set:Li=>g[Mt]=Li})})}else o.exposed||(o.exposed={});Ie&&o.render===ro&&(o.render=Ie),dt!=null&&(o.inheritAttrs=dt),ft&&(o.components=ft),Ze&&(o.directives=Ze)}function l2(o,f,g=ro,v=!1){oi(o)&&(o=Dm(o));for(const w in o){const A=o[w];let z;tn(A)?"default"in A?z=Lo(A.from||w,A.default,!0):z=Lo(A.from||w):z=Lo(A),er(z)&&v?Object.defineProperty(f,w,{enumerable:!0,configurable:!0,get:()=>z.value,set:s=>z.value=s}):f[w]=z}}function px(o,f,g){Vr(oi(o)?o.map(v=>v.bind(f.proxy)):o.bind(f.proxy),f,g)}function f0(o,f,g,v){const w=v.includes(".")?i0(g,v):()=>g[v];if(zn(o)){const A=f[o];hi(A)&&di(w,A)}else if(hi(o))di(w,o.bind(g));else if(tn(o))if(oi(o))o.forEach(A=>f0(A,f,g,v));else{const A=hi(o.handler)?o.handler.bind(g):f[o.handler];hi(A)&&di(w,A,o)}}function f_(o){const f=o.type,{mixins:g,extends:v}=f,{mixins:w,optionsCache:A,config:{optionMergeStrategies:z}}=o.appContext,s=A.get(f);let B;return s?B=s:!w.length&&!g&&!v?B=f:(B={},w.length&&w.forEach(Z=>df(B,Z,z,!0)),df(B,f,z)),tn(f)&&A.set(f,B),B}function df(o,f,g,v=!1){const{mixins:w,extends:A}=f;A&&df(o,A,g,!0),w&&w.forEach(z=>df(o,z,g,!0));for(const z in f)if(!(v&&z==="expose")){const s=c2[z]||g&&g[z];o[z]=s?s(o[z],f[z]):f[z]}return o}const c2={data:mx,props:$a,emits:$a,methods:$a,computed:$a,beforeCreate:cr,created:cr,beforeMount:cr,mounted:cr,beforeUpdate:cr,updated:cr,beforeDestroy:cr,beforeUnmount:cr,destroyed:cr,unmounted:cr,activated:cr,deactivated:cr,errorCaptured:cr,serverPrefetch:cr,components:$a,directives:$a,watch:h2,provide:mx,inject:u2};function mx(o,f){return f?o?function(){return $n(hi(o)?o.call(this,this):o,hi(f)?f.call(this,this):f)}:f:o}function u2(o,f){return $a(Dm(o),Dm(f))}function Dm(o){if(oi(o)){const f={};for(let g=0;g<o.length;g++)f[o[g]]=o[g];return f}return o}function cr(o,f){return o?[...new Set([].concat(o,f))]:f}function $a(o,f){return o?$n($n(Object.create(null),o),f):f}function h2(o,f){if(!o)return f;if(!f)return o;const g=$n(Object.create(null),o);for(const v in f)g[v]=cr(o[v],f[v]);return g}function d2(o,f,g,v=!1){const w={},A={};af(A,Mf,1),o.propsDefaults=Object.create(null),p0(o,f,w,A);for(const z in o.propsOptions[0])z in w||(w[z]=void 0);g?o.props=v?w:kT(w):o.type.props?o.props=w:o.props=A,o.attrs=A}function f2(o,f,g,v){const{props:w,attrs:A,vnode:{patchFlag:z}}=o,s=Ui(w),[B]=o.propsOptions;let Z=!1;if((v||z>0)&&!(z&16)){if(z&8){const ee=o.vnode.dynamicProps;for(let G=0;G<ee.length;G++){let te=ee[G];if(Sf(o.emitsOptions,te))continue;const _e=f[te];if(B)if(Si(A,te))_e!==A[te]&&(A[te]=_e,Z=!0);else{const Ee=hc(te);w[Ee]=Lm(B,s,Ee,_e,o,!1)}else _e!==A[te]&&(A[te]=_e,Z=!0)}}}else{p0(o,f,w,A)&&(Z=!0);let ee;for(const G in s)(!f||!Si(f,G)&&((ee=pc(G))===G||!Si(f,ee)))&&(B?g&&(g[G]!==void 0||g[ee]!==void 0)&&(w[G]=Lm(B,s,G,void 0,o,!0)):delete w[G]);if(A!==s)for(const G in A)(!f||!Si(f,G)&&!0)&&(delete A[G],Z=!0)}Z&&os(o,"set","$attrs")}function p0(o,f,g,v){const[w,A]=o.propsOptions;let z=!1,s;if(f)for(let B in f){if(tf(B))continue;const Z=f[B];let ee;w&&Si(w,ee=hc(B))?!A||!A.includes(ee)?g[ee]=Z:(s||(s={}))[ee]=Z:Sf(o.emitsOptions,B)||(!(B in v)||Z!==v[B])&&(v[B]=Z,z=!0)}if(A){const B=Ui(g),Z=s||Hi;for(let ee=0;ee<A.length;ee++){const G=A[ee];g[G]=Lm(w,B,G,Z[G],o,!Si(Z,G))}}return z}function Lm(o,f,g,v,w,A){const z=o[g];if(z!=null){const s=Si(z,"default");if(s&&v===void 0){const B=z.default;if(z.type!==Function&&hi(B)){const{propsDefaults:Z}=w;g in Z?v=Z[g]:(fc(w),v=Z[g]=B.call(null,f),Ha())}else v=B}z[0]&&(A&&!s?v=!1:z[1]&&(v===""||v===pc(g))&&(v=!0))}return v}function m0(o,f,g=!1){const v=f.propsCache,w=v.get(o);if(w)return w;const A=o.props,z={},s=[];let B=!1;if(!hi(o)){const ee=G=>{B=!0;const[te,_e]=m0(G,f,!0);$n(z,te),_e&&s.push(..._e)};!g&&f.mixins.length&&f.mixins.forEach(ee),o.extends&&ee(o.extends),o.mixins&&o.mixins.forEach(ee)}if(!A&&!B)return tn(o)&&v.set(o,sc),sc;if(oi(A))for(let ee=0;ee<A.length;ee++){const G=hc(A[ee]);_x(G)&&(z[G]=Hi)}else if(A)for(const ee in A){const G=hc(ee);if(_x(G)){const te=A[ee],_e=z[G]=oi(te)||hi(te)?{type:te}:te;if(_e){const Ee=xx(Boolean,_e.type),Te=xx(String,_e.type);_e[0]=Ee>-1,_e[1]=Te<0||Ee<Te,(Ee>-1||Si(_e,"default"))&&s.push(G)}}}const Z=[z,s];return tn(o)&&v.set(o,Z),Z}function _x(o){return o[0]!=="$"}function gx(o){const f=o&&o.toString().match(/^\s*function (\w+)/);return f?f[1]:o===null?"null":""}function yx(o,f){return gx(o)===gx(f)}function xx(o,f){return oi(f)?f.findIndex(g=>yx(g,o)):hi(f)&&yx(f,o)?0:-1}const _0=o=>o[0]==="_"||o==="$stable",p_=o=>oi(o)?o.map(zo):[zo(o)],p2=(o,f,g)=>{if(f._n)return f;const v=bn((...w)=>p_(f(...w)),g);return v._c=!1,v},g0=(o,f,g)=>{const v=o._ctx;for(const w in o){if(_0(w))continue;const A=o[w];if(hi(A))f[w]=p2(w,A,v);else if(A!=null){const z=p_(A);f[w]=()=>z}}},y0=(o,f)=>{const g=p_(f);o.slots.default=()=>g},m2=(o,f)=>{if(o.vnode.shapeFlag&32){const g=f._;g?(o.slots=Ui(f),af(f,"_",g)):g0(f,o.slots={})}else o.slots={},f&&y0(o,f);af(o.slots,Mf,1)},_2=(o,f,g)=>{const{vnode:v,slots:w}=o;let A=!0,z=Hi;if(v.shapeFlag&32){const s=f._;s?g&&s===1?A=!1:($n(w,f),!g&&s===1&&delete w._):(A=!f.$stable,g0(f,w)),z=f}else f&&(y0(o,f),z={default:1});if(A)for(const s in w)!_0(s)&&!(s in z)&&delete w[s]};function x0(){return{app:null,config:{isNativeTag:Yw,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let g2=0;function y2(o,f){return function(v,w=null){hi(v)||(v=Object.assign({},v)),w!=null&&!tn(w)&&(w=null);const A=x0(),z=new Set;let s=!1;const B=A.app={_uid:g2++,_component:v,_props:w,_container:null,_context:A,_instance:null,version:R2,get config(){return A.config},set config(Z){},use(Z,...ee){return z.has(Z)||(Z&&hi(Z.install)?(z.add(Z),Z.install(B,...ee)):hi(Z)&&(z.add(Z),Z(B,...ee))),B},mixin(Z){return A.mixins.includes(Z)||A.mixins.push(Z),B},component(Z,ee){return ee?(A.components[Z]=ee,B):A.components[Z]},directive(Z,ee){return ee?(A.directives[Z]=ee,B):A.directives[Z]},mount(Z,ee,G){if(!s){const te=Vt(v,w);return te.appContext=A,ee&&f?f(te,Z):o(te,Z,G),s=!0,B._container=Z,Z.__vue_app__=B,If(te.component)||te.component.proxy}},unmount(){s&&(o(null,B._container),delete B._container.__vue_app__)},provide(Z,ee){return A.provides[Z]=ee,B}};return B}}function Rm(o,f,g,v,w=!1){if(oi(o)){o.forEach((te,_e)=>Rm(te,f&&(oi(f)?f[_e]:f),g,v,w));return}if(rh(v)&&!w)return;const A=v.shapeFlag&4?If(v.component)||v.component.proxy:v.el,z=w?null:A,{i:s,r:B}=o,Z=f&&f.r,ee=s.refs===Hi?s.refs={}:s.refs,G=s.setupState;if(Z!=null&&Z!==B&&(zn(Z)?(ee[Z]=null,Si(G,Z)&&(G[Z]=null)):er(Z)&&(Z.value=null)),hi(B))Ws(B,s,12,[z,ee]);else{const te=zn(B),_e=er(B);if(te||_e){const Ee=()=>{if(o.f){const Te=te?ee[B]:B.value;w?oi(Te)&&Qm(Te,A):oi(Te)?Te.includes(A)||Te.push(A):te?(ee[B]=[A],Si(G,B)&&(G[B]=ee[B])):(B.value=[A],o.k&&(ee[o.k]=B.value))}else te?(ee[B]=z,Si(G,B)&&(G[B]=z)):_e&&(B.value=z,o.k&&(ee[o.k]=z))};z?(Ee.id=-1,Un(Ee,g)):Ee()}}}const Un=WT;function x2(o){return v2(o)}function v2(o,f){const g=nT();g.__VUE__=!0;const{insert:v,remove:w,patchProp:A,createElement:z,createText:s,createComment:B,setText:Z,setElementText:ee,parentNode:G,nextSibling:te,setScopeId:_e=ro,insertStaticContent:Ee}=o,Te=(fe,ye,Me,it=null,nt=null,gt=null,Ct=!1,yt=null,Ye=!!ye.dynamicChildren)=>{if(fe===ye)return;fe&&!Ga(fe,ye)&&(it=qn(fe),Jt(fe,nt,gt,!0),fe=null),ye.patchFlag===-2&&(Ye=!1,ye.dynamicChildren=null);const{type:ht,ref:Rt,shapeFlag:kt}=ye;switch(ht){case m_:Be(fe,ye,Me,it);break;case oo:ot(fe,ye,Me,it);break;case nf:fe==null&&Se(ye,Me,it,Ct);break;case xr:ft(fe,ye,Me,it,nt,gt,Ct,yt,Ye);break;default:kt&1?Ie(fe,ye,Me,it,nt,gt,Ct,yt,Ye):kt&6?Ze(fe,ye,Me,it,nt,gt,Ct,yt,Ye):(kt&64||kt&128)&&ht.process(fe,ye,Me,it,nt,gt,Ct,yt,Ye,hr)}Rt!=null&&nt&&Rm(Rt,fe&&fe.ref,gt,ye||fe,!ye)},Be=(fe,ye,Me,it)=>{if(fe==null)v(ye.el=s(ye.children),Me,it);else{const nt=ye.el=fe.el;ye.children!==fe.children&&Z(nt,ye.children)}},ot=(fe,ye,Me,it)=>{fe==null?v(ye.el=B(ye.children||""),Me,it):ye.el=fe.el},Se=(fe,ye,Me,it)=>{[fe.el,fe.anchor]=Ee(fe.children,ye,Me,it,fe.el,fe.anchor)},Je=({el:fe,anchor:ye},Me,it)=>{let nt;for(;fe&&fe!==ye;)nt=te(fe),v(fe,Me,it),fe=nt;v(ye,Me,it)},ct=({el:fe,anchor:ye})=>{let Me;for(;fe&&fe!==ye;)Me=te(fe),w(fe),fe=Me;w(ye)},Ie=(fe,ye,Me,it,nt,gt,Ct,yt,Ye)=>{Ct=Ct||ye.type==="svg",fe==null?Pe(ye,Me,it,nt,gt,Ct,yt,Ye):Qe(fe,ye,nt,gt,Ct,yt,Ye)},Pe=(fe,ye,Me,it,nt,gt,Ct,yt)=>{let Ye,ht;const{type:Rt,props:kt,shapeFlag:Ot,transition:Zt,dirs:si}=fe;if(Ye=fe.el=z(fe.type,gt,kt&&kt.is,kt),Ot&8?ee(Ye,fe.children):Ot&16&&ze(fe.children,Ye,null,it,nt,gt&&Rt!=="foreignObject",Ct,yt),si&&Ua(fe,null,it,"created"),kt){for(const ai in kt)ai!=="value"&&!tf(ai)&&A(Ye,ai,null,kt[ai],gt,fe.children,it,nt,an);"value"in kt&&A(Ye,"value",null,kt.value),(ht=kt.onVnodeBeforeMount)&&Ur(ht,it,fe)}be(Ye,fe,fe.scopeId,Ct,it),si&&Ua(fe,null,it,"beforeMount");const wi=(!nt||nt&&!nt.pendingBranch)&&Zt&&!Zt.persisted;wi&&Zt.beforeEnter(Ye),v(Ye,ye,Me),((ht=kt&&kt.onVnodeMounted)||wi||si)&&Un(()=>{ht&&Ur(ht,it,fe),wi&&Zt.enter(Ye),si&&Ua(fe,null,it,"mounted")},nt)},be=(fe,ye,Me,it,nt)=>{if(Me&&_e(fe,Me),it)for(let gt=0;gt<it.length;gt++)_e(fe,it[gt]);if(nt){let gt=nt.subTree;if(ye===gt){const Ct=nt.vnode;be(fe,Ct,Ct.scopeId,Ct.slotScopeIds,nt.parent)}}},ze=(fe,ye,Me,it,nt,gt,Ct,yt,Ye=0)=>{for(let ht=Ye;ht<fe.length;ht++){const Rt=fe[ht]=yt?$s(fe[ht]):zo(fe[ht]);Te(null,Rt,ye,Me,it,nt,gt,Ct,yt)}},Qe=(fe,ye,Me,it,nt,gt,Ct)=>{const yt=ye.el=fe.el;let{patchFlag:Ye,dynamicChildren:ht,dirs:Rt}=ye;Ye|=fe.patchFlag&16;const kt=fe.props||Hi,Ot=ye.props||Hi;let Zt;Me&&Va(Me,!1),(Zt=Ot.onVnodeBeforeUpdate)&&Ur(Zt,Me,ye,fe),Rt&&Ua(ye,fe,Me,"beforeUpdate"),Me&&Va(Me,!0);const si=nt&&ye.type!=="foreignObject";if(ht?Fe(fe.dynamicChildren,ht,yt,Me,it,si,gt):Ct||Mt(fe,ye,yt,null,Me,it,si,gt,!1),Ye>0){if(Ye&16)dt(yt,ye,kt,Ot,Me,it,nt);else if(Ye&2&&kt.class!==Ot.class&&A(yt,"class",null,Ot.class,nt),Ye&4&&A(yt,"style",kt.style,Ot.style,nt),Ye&8){const wi=ye.dynamicProps;for(let ai=0;ai<wi.length;ai++){const Ci=wi[ai],ln=kt[Ci],wr=Ot[Ci];(wr!==ln||Ci==="value")&&A(yt,Ci,ln,wr,nt,fe.children,Me,it,an)}}Ye&1&&fe.children!==ye.children&&ee(yt,ye.children)}else!Ct&&ht==null&&dt(yt,ye,kt,Ot,Me,it,nt);((Zt=Ot.onVnodeUpdated)||Rt)&&Un(()=>{Zt&&Ur(Zt,Me,ye,fe),Rt&&Ua(ye,fe,Me,"updated")},it)},Fe=(fe,ye,Me,it,nt,gt,Ct)=>{for(let yt=0;yt<ye.length;yt++){const Ye=fe[yt],ht=ye[yt],Rt=Ye.el&&(Ye.type===xr||!Ga(Ye,ht)||Ye.shapeFlag&70)?G(Ye.el):Me;Te(Ye,ht,Rt,null,it,nt,gt,Ct,!0)}},dt=(fe,ye,Me,it,nt,gt,Ct)=>{if(Me!==it){if(Me!==Hi)for(const yt in Me)!tf(yt)&&!(yt in it)&&A(fe,yt,Me[yt],null,Ct,ye.children,nt,gt,an);for(const yt in it){if(tf(yt))continue;const Ye=it[yt],ht=Me[yt];Ye!==ht&&yt!=="value"&&A(fe,yt,ht,Ye,Ct,ye.children,nt,gt,an)}"value"in it&&A(fe,"value",Me.value,it.value)}},ft=(fe,ye,Me,it,nt,gt,Ct,yt,Ye)=>{const ht=ye.el=fe?fe.el:s(""),Rt=ye.anchor=fe?fe.anchor:s("");let{patchFlag:kt,dynamicChildren:Ot,slotScopeIds:Zt}=ye;Zt&&(yt=yt?yt.concat(Zt):Zt),fe==null?(v(ht,Me,it),v(Rt,Me,it),ze(ye.children,Me,Rt,nt,gt,Ct,yt,Ye)):kt>0&&kt&64&&Ot&&fe.dynamicChildren?(Fe(fe.dynamicChildren,Ot,Me,nt,gt,Ct,yt),(ye.key!=null||nt&&ye===nt.subTree)&&v0(fe,ye,!0)):Mt(fe,ye,Me,Rt,nt,gt,Ct,yt,Ye)},Ze=(fe,ye,Me,it,nt,gt,Ct,yt,Ye)=>{ye.slotScopeIds=yt,fe==null?ye.shapeFlag&512?nt.ctx.activate(ye,Me,it,Ct,Ye):Ke(ye,Me,it,nt,gt,Ct,Ye):Bt(fe,ye,Ye)},Ke=(fe,ye,Me,it,nt,gt,Ct)=>{const yt=fe.component=I2(fe,it,nt);if(Cf(fe)&&(yt.ctx.renderer=hr),z2(yt),yt.asyncDep){if(nt&&nt.registerDep(yt,Wt),!fe.el){const Ye=yt.subTree=Vt(oo);ot(null,Ye,ye,Me)}return}Wt(yt,fe,ye,Me,nt,gt,Ct)},Bt=(fe,ye,Me)=>{const it=ye.component=fe.component;if(GT(fe,ye,Me))if(it.asyncDep&&!it.asyncResolved){tt(it,ye,Me);return}else it.next=ye,UT(it.update),it.update();else ye.el=fe.el,it.vnode=ye},Wt=(fe,ye,Me,it,nt,gt,Ct)=>{const yt=()=>{if(fe.isMounted){let{next:Rt,bu:kt,u:Ot,parent:Zt,vnode:si}=fe,wi=Rt,ai;Va(fe,!1),Rt?(Rt.el=si.el,tt(fe,Rt,Ct)):Rt=si,kt&&nh(kt),(ai=Rt.props&&Rt.props.onVnodeBeforeUpdate)&&Ur(ai,Zt,Rt,si),Va(fe,!0);const Ci=um(fe),ln=fe.subTree;fe.subTree=Ci,Te(ln,Ci,G(ln.el),qn(ln),fe,nt,gt),Rt.el=Ci.el,wi===null&&ZT(fe,Ci.el),Ot&&Un(Ot,nt),(ai=Rt.props&&Rt.props.onVnodeUpdated)&&Un(()=>Ur(ai,Zt,Rt,si),nt)}else{let Rt;const{el:kt,props:Ot}=ye,{bm:Zt,m:si,parent:wi}=fe,ai=rh(ye);if(Va(fe,!1),Zt&&nh(Zt),!ai&&(Rt=Ot&&Ot.onVnodeBeforeMount)&&Ur(Rt,wi,ye),Va(fe,!0),kt&&ao){const Ci=()=>{fe.subTree=um(fe),ao(kt,fe.subTree,fe,nt,null)};ai?ye.type.__asyncLoader().then(()=>!fe.isUnmounted&&Ci()):Ci()}else{const Ci=fe.subTree=um(fe);Te(null,Ci,Me,it,fe,nt,gt),ye.el=Ci.el}if(si&&Un(si,nt),!ai&&(Rt=Ot&&Ot.onVnodeMounted)){const Ci=ye;Un(()=>Ur(Rt,wi,Ci),nt)}(ye.shapeFlag&256||wi&&rh(wi.vnode)&&wi.vnode.shapeFlag&256)&&fe.a&&Un(fe.a,nt),fe.isMounted=!0,ye=Me=it=null}},Ye=fe.effect=new n_(yt,()=>h_(ht),fe.scope),ht=fe.update=()=>Ye.run();ht.id=fe.uid,Va(fe,!0),ht()},tt=(fe,ye,Me)=>{ye.component=fe;const it=fe.vnode.props;fe.vnode=ye,fe.next=null,f2(fe,ye.props,it,Me),_2(fe,ye.children,Me),mc(),ux(),_c()},Mt=(fe,ye,Me,it,nt,gt,Ct,yt,Ye=!1)=>{const ht=fe&&fe.children,Rt=fe?fe.shapeFlag:0,kt=ye.children,{patchFlag:Ot,shapeFlag:Zt}=ye;if(Ot>0){if(Ot&128){xt(ht,kt,Me,it,nt,gt,Ct,yt,Ye);return}else if(Ot&256){Li(ht,kt,Me,it,nt,gt,Ct,yt,Ye);return}}Zt&8?(Rt&16&&an(ht,nt,gt),kt!==ht&&ee(Me,kt)):Rt&16?Zt&16?xt(ht,kt,Me,it,nt,gt,Ct,yt,Ye):an(ht,nt,gt,!0):(Rt&8&&ee(Me,""),Zt&16&&ze(kt,Me,it,nt,gt,Ct,yt,Ye))},Li=(fe,ye,Me,it,nt,gt,Ct,yt,Ye)=>{fe=fe||sc,ye=ye||sc;const ht=fe.length,Rt=ye.length,kt=Math.min(ht,Rt);let Ot;for(Ot=0;Ot<kt;Ot++){const Zt=ye[Ot]=Ye?$s(ye[Ot]):zo(ye[Ot]);Te(fe[Ot],Zt,Me,null,nt,gt,Ct,yt,Ye)}ht>Rt?an(fe,nt,gt,!0,!1,kt):ze(ye,Me,it,nt,gt,Ct,yt,Ye,kt)},xt=(fe,ye,Me,it,nt,gt,Ct,yt,Ye)=>{let ht=0;const Rt=ye.length;let kt=fe.length-1,Ot=Rt-1;for(;ht<=kt&&ht<=Ot;){const Zt=fe[ht],si=ye[ht]=Ye?$s(ye[ht]):zo(ye[ht]);if(Ga(Zt,si))Te(Zt,si,Me,null,nt,gt,Ct,yt,Ye);else break;ht++}for(;ht<=kt&&ht<=Ot;){const Zt=fe[kt],si=ye[Ot]=Ye?$s(ye[Ot]):zo(ye[Ot]);if(Ga(Zt,si))Te(Zt,si,Me,null,nt,gt,Ct,yt,Ye);else break;kt--,Ot--}if(ht>kt){if(ht<=Ot){const Zt=Ot+1,si=Zt<Rt?ye[Zt].el:it;for(;ht<=Ot;)Te(null,ye[ht]=Ye?$s(ye[ht]):zo(ye[ht]),Me,si,nt,gt,Ct,yt,Ye),ht++}}else if(ht>Ot)for(;ht<=kt;)Jt(fe[ht],nt,gt,!0),ht++;else{const Zt=ht,si=ht,wi=new Map;for(ht=si;ht<=Ot;ht++){const cn=ye[ht]=Ye?$s(ye[ht]):zo(ye[ht]);cn.key!=null&&wi.set(cn.key,ht)}let ai,Ci=0;const ln=Ot-si+1;let wr=!1,wn=0;const Dn=new Array(ln);for(ht=0;ht<ln;ht++)Dn[ht]=0;for(ht=Zt;ht<=kt;ht++){const cn=fe[ht];if(Ci>=ln){Jt(cn,nt,gt,!0);continue}let Tn;if(cn.key!=null)Tn=wi.get(cn.key);else for(ai=si;ai<=Ot;ai++)if(Dn[ai-si]===0&&Ga(cn,ye[ai])){Tn=ai;break}Tn===void 0?Jt(cn,nt,gt,!0):(Dn[Tn-si]=ht+1,Tn>=wn?wn=Tn:wr=!0,Te(cn,ye[Tn],Me,null,nt,gt,Ct,yt,Ye),Ci++)}const Bo=wr?b2(Dn):sc;for(ai=Bo.length-1,ht=ln-1;ht>=0;ht--){const cn=si+ht,Tn=ye[cn],lo=cn+1<Rt?ye[cn+1].el:it;Dn[ht]===0?Te(null,Tn,Me,lo,nt,gt,Ct,yt,Ye):wr&&(ai<0||ht!==Bo[ai]?bi(Tn,Me,lo,2):ai--)}}},bi=(fe,ye,Me,it,nt=null)=>{const{el:gt,type:Ct,transition:yt,children:Ye,shapeFlag:ht}=fe;if(ht&6){bi(fe.component.subTree,ye,Me,it);return}if(ht&128){fe.suspense.move(ye,Me,it);return}if(ht&64){Ct.move(fe,ye,Me,hr);return}if(Ct===xr){v(gt,ye,Me);for(let kt=0;kt<Ye.length;kt++)bi(Ye[kt],ye,Me,it);v(fe.anchor,ye,Me);return}if(Ct===nf){Je(fe,ye,Me);return}if(it!==2&&ht&1&&yt)if(it===0)yt.beforeEnter(gt),v(gt,ye,Me),Un(()=>yt.enter(gt),nt);else{const{leave:kt,delayLeave:Ot,afterLeave:Zt}=yt,si=()=>v(gt,ye,Me),wi=()=>{kt(gt,()=>{si(),Zt&&Zt()})};Ot?Ot(gt,si,wi):wi()}else v(gt,ye,Me)},Jt=(fe,ye,Me,it=!1,nt=!1)=>{const{type:gt,props:Ct,ref:yt,children:Ye,dynamicChildren:ht,shapeFlag:Rt,patchFlag:kt,dirs:Ot}=fe;if(yt!=null&&Rm(yt,null,Me,fe,!0),Rt&256){ye.ctx.deactivate(fe);return}const Zt=Rt&1&&Ot,si=!rh(fe);let wi;if(si&&(wi=Ct&&Ct.onVnodeBeforeUnmount)&&Ur(wi,ye,fe),Rt&6)Pn(fe.component,Me,it);else{if(Rt&128){fe.suspense.unmount(Me,it);return}Zt&&Ua(fe,null,ye,"beforeUnmount"),Rt&64?fe.type.remove(fe,ye,Me,nt,hr,it):ht&&(gt!==xr||kt>0&&kt&64)?an(ht,ye,Me,!1,!0):(gt===xr&&kt&384||!nt&&Rt&16)&&an(Ye,ye,Me),it&&_i(fe)}(si&&(wi=Ct&&Ct.onVnodeUnmounted)||Zt)&&Un(()=>{wi&&Ur(wi,ye,fe),Zt&&Ua(fe,null,ye,"unmounted")},Me)},_i=fe=>{const{type:ye,el:Me,anchor:it,transition:nt}=fe;if(ye===xr){kn(Me,it);return}if(ye===nf){ct(fe);return}const gt=()=>{w(Me),nt&&!nt.persisted&&nt.afterLeave&&nt.afterLeave()};if(fe.shapeFlag&1&&nt&&!nt.persisted){const{leave:Ct,delayLeave:yt}=nt,Ye=()=>Ct(Me,gt);yt?yt(fe.el,gt,Ye):Ye()}else gt()},kn=(fe,ye)=>{let Me;for(;fe!==ye;)Me=te(fe),w(fe),fe=Me;w(ye)},Pn=(fe,ye,Me)=>{const{bum:it,scope:nt,update:gt,subTree:Ct,um:yt}=fe;it&&nh(it),nt.stop(),gt&&(gt.active=!1,Jt(Ct,fe,ye,Me)),yt&&Un(yt,ye),Un(()=>{fe.isUnmounted=!0},ye),ye&&ye.pendingBranch&&!ye.isUnmounted&&fe.asyncDep&&!fe.asyncResolved&&fe.suspenseId===ye.pendingId&&(ye.deps--,ye.deps===0&&ye.resolve())},an=(fe,ye,Me,it=!1,nt=!1,gt=0)=>{for(let Ct=gt;Ct<fe.length;Ct++)Jt(fe[Ct],ye,Me,it,nt)},qn=fe=>fe.shapeFlag&6?qn(fe.component.subTree):fe.shapeFlag&128?fe.suspense.next():te(fe.anchor||fe.el),jr=(fe,ye,Me)=>{fe==null?ye._vnode&&Jt(ye._vnode,null,null,!0):Te(ye._vnode||null,fe,ye,null,null,null,Me),ux(),Kv(),ye._vnode=fe},hr={p:Te,um:Jt,m:bi,r:_i,mt:Ke,mc:ze,pc:Mt,pbc:Fe,n:qn,o};let nr,ao;return f&&([nr,ao]=f(hr)),{render:jr,hydrate:nr,createApp:y2(jr,nr)}}function Va({effect:o,update:f},g){o.allowRecurse=f.allowRecurse=g}function v0(o,f,g=!1){const v=o.children,w=f.children;if(oi(v)&&oi(w))for(let A=0;A<v.length;A++){const z=v[A];let s=w[A];s.shapeFlag&1&&!s.dynamicChildren&&((s.patchFlag<=0||s.patchFlag===32)&&(s=w[A]=$s(w[A]),s.el=z.el),g||v0(z,s))}}function b2(o){const f=o.slice(),g=[0];let v,w,A,z,s;const B=o.length;for(v=0;v<B;v++){const Z=o[v];if(Z!==0){if(w=g[g.length-1],o[w]<Z){f[v]=w,g.push(v);continue}for(A=0,z=g.length-1;A<z;)s=A+z>>1,o[g[s]]<Z?A=s+1:z=s;Z<o[g[A]]&&(A>0&&(f[v]=g[A-1]),g[A]=v)}}for(A=g.length,z=g[A-1];A-- >0;)g[A]=z,z=f[z];return g}const w2=o=>o.__isTeleport,xr=Symbol(void 0),m_=Symbol(void 0),oo=Symbol(void 0),nf=Symbol(void 0),oh=[];let no=null;function Vn(o=!1){oh.push(no=o?null:[])}function T2(){oh.pop(),no=oh[oh.length-1]||null}let uh=1;function vx(o){uh+=o}function b0(o){return o.dynamicChildren=uh>0?no||sc:null,T2(),uh>0&&no&&no.push(o),o}function Hs(o,f,g,v,w,A){return b0(hn(o,f,g,v,w,A,!0))}function is(o,f,g,v,w){return b0(Vt(o,f,g,v,w,!0))}function ff(o){return o?o.__v_isVNode===!0:!1}function Ga(o,f){return o.type===f.type&&o.key===f.key}const Mf="__vInternal",w0=({key:o})=>o!=null?o:null,rf=({ref:o,ref_key:f,ref_for:g})=>o!=null?zn(o)||er(o)||hi(o)?{i:io,r:o,k:f,f:!!g}:o:null;function hn(o,f=null,g=null,v=0,w=null,A=o===xr?0:1,z=!1,s=!1){const B={__v_isVNode:!0,__v_skip:!0,type:o,props:f,key:f&&w0(f),ref:f&&rf(f),scopeId:Qv,slotScopeIds:null,children:g,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:A,patchFlag:v,dynamicProps:w,dynamicChildren:null,appContext:null};return s?(__(B,g),A&128&&o.normalize(B)):g&&(B.shapeFlag|=zn(g)?8:16),uh>0&&!z&&no&&(B.patchFlag>0||A&6)&&B.patchFlag!==32&&no.push(B),B}const Vt=E2;function E2(o,f=null,g=null,v=0,w=null,A=!1){if((!o||o===o2)&&(o=oo),ff(o)){const s=ss(o,f,!0);return g&&__(s,g),uh>0&&!A&&no&&(s.shapeFlag&6?no[no.indexOf(o)]=s:no.push(s)),s.patchFlag|=-2,s}if(L2(o)&&(o=o.__vccOpts),f){f=S2(f);let{class:s,style:B}=f;s&&!zn(s)&&(f.class=Ym(s)),tn(B)&&($v(B)&&!oi(B)&&(B=$n({},B)),f.style=Km(B))}const z=zn(o)?1:e0(o)?128:w2(o)?64:tn(o)?4:hi(o)?2:0;return hn(o,f,g,v,w,z,A,!0)}function S2(o){return o?$v(o)||Mf in o?$n({},o):o:null}function ss(o,f,g=!1){const{props:v,ref:w,patchFlag:A,children:z}=o,s=f?C2(v||{},f):v;return{__v_isVNode:!0,__v_skip:!0,type:o.type,props:s,key:s&&w0(s),ref:f&&f.ref?g&&w?oi(w)?w.concat(rf(f)):[w,rf(f)]:rf(f):w,scopeId:o.scopeId,slotScopeIds:o.slotScopeIds,children:z,target:o.target,targetAnchor:o.targetAnchor,staticCount:o.staticCount,shapeFlag:o.shapeFlag,patchFlag:f&&o.type!==xr?A===-1?16:A|16:A,dynamicProps:o.dynamicProps,dynamicChildren:o.dynamicChildren,appContext:o.appContext,dirs:o.dirs,transition:o.transition,component:o.component,suspense:o.suspense,ssContent:o.ssContent&&ss(o.ssContent),ssFallback:o.ssFallback&&ss(o.ssFallback),el:o.el,anchor:o.anchor}}function Ya(o=" ",f=0){return Vt(m_,null,o,f)}function T0(o,f){const g=Vt(nf,null,o);return g.staticCount=f,g}function Ql(o="",f=!1){return f?(Vn(),is(oo,null,o)):Vt(oo,null,o)}function zo(o){return o==null||typeof o=="boolean"?Vt(oo):oi(o)?Vt(xr,null,o.slice()):typeof o=="object"?$s(o):Vt(m_,null,String(o))}function $s(o){return o.el===null&&o.patchFlag!==-1||o.memo?o:ss(o)}function __(o,f){let g=0;const{shapeFlag:v}=o;if(f==null)f=null;else if(oi(f))g=16;else if(typeof f=="object")if(v&65){const w=f.default;w&&(w._c&&(w._d=!1),__(o,w()),w._c&&(w._d=!0));return}else{g=32;const w=f._;!w&&!(Mf in f)?f._ctx=io:w===3&&io&&(io.slots._===1?f._=1:(f._=2,o.patchFlag|=1024))}else hi(f)?(f={default:f,_ctx:io},g=32):(f=String(f),v&64?(g=16,f=[Ya(f)]):g=8);o.children=f,o.shapeFlag|=g}function C2(...o){const f={};for(let g=0;g<o.length;g++){const v=o[g];for(const w in v)if(w==="class")f.class!==v.class&&(f.class=Ym([f.class,v.class]));else if(w==="style")f.style=Km([f.style,v.style]);else if(xf(w)){const A=f[w],z=v[w];z&&A!==z&&!(oi(A)&&A.includes(z))&&(f[w]=A?[].concat(A,z):z)}else w!==""&&(f[w]=v[w])}return f}function Ur(o,f,g,v=null){Vr(o,f,7,[g,v])}const A2=x0();let M2=0;function I2(o,f,g){const v=o.type,w=(f?f.appContext:o.appContext)||A2,A={uid:M2++,vnode:o,type:v,parent:f,appContext:w,root:null,next:null,subTree:null,effect:null,update:null,scope:new rT(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:f?f.provides:Object.create(w.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:m0(v,w),emitsOptions:Jv(v,w),emit:null,emitted:null,propsDefaults:Hi,inheritAttrs:v.inheritAttrs,ctx:Hi,data:Hi,props:Hi,attrs:Hi,slots:Hi,refs:Hi,setupState:Hi,setupContext:null,suspense:g,suspenseId:g?g.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return A.ctx={_:A},A.root=f?f.root:A,A.emit=jT.bind(null,A),o.ce&&o.ce(A),A}let Nn=null;const nn=()=>Nn||io,fc=o=>{Nn=o,o.scope.on()},Ha=()=>{Nn&&Nn.scope.off(),Nn=null};function E0(o){return o.vnode.shapeFlag&4}let hh=!1;function z2(o,f=!1){hh=f;const{props:g,children:v}=o.vnode,w=E0(o);d2(o,g,w,f),m2(o,v);const A=w?k2(o,f):void 0;return hh=!1,A}function k2(o,f){const g=o.type;o.accessCache=Object.create(null),o.proxy=Tf(new Proxy(o.ctx,s2));const{setup:v}=g;if(v){const w=o.setupContext=v.length>1?D2(o):null;fc(o),mc();const A=Ws(v,o,0,[o.props,w]);if(_c(),Ha(),Av(A)){if(A.then(Ha,Ha),f)return A.then(z=>{bx(o,z,f)}).catch(z=>{Ef(z,o,0)});o.asyncDep=A}else bx(o,A,f)}else S0(o,f)}function bx(o,f,g){hi(f)?o.type.__ssrInlineRender?o.ssrRender=f:o.render=f:tn(f)&&(o.setupState=Zv(f)),S0(o,g)}let wx;function S0(o,f,g){const v=o.type;if(!o.render){if(!f&&wx&&!v.render){const w=v.template||f_(o).template;if(w){const{isCustomElement:A,compilerOptions:z}=o.appContext.config,{delimiters:s,compilerOptions:B}=v,Z=$n($n({isCustomElement:A,delimiters:s},z),B);v.render=wx(w,Z)}}o.render=v.render||ro}fc(o),mc(),a2(o),_c(),Ha()}function P2(o){return new Proxy(o.attrs,{get(f,g){return kr(o,"get","$attrs"),f[g]}})}function D2(o){const f=v=>{o.exposed=v||{}};let g;return{get attrs(){return g||(g=P2(o))},slots:o.slots,emit:o.emit,expose:f}}function If(o){if(o.exposed)return o.exposeProxy||(o.exposeProxy=new Proxy(Zv(Tf(o.exposed)),{get(f,g){if(g in f)return f[g];if(g in hf)return hf[g](o)}}))}function Tx(o,f=!0){return hi(o)?o.displayName||o.name:o.name||f&&o.__name}function L2(o){return hi(o)&&"__vccOpts"in o}const Ue=(o,f)=>BT(o,f,hh);function Ne(o,f,g){const v=arguments.length;return v===2?tn(f)&&!oi(f)?ff(f)?Vt(o,null,[f]):Vt(o,f):Vt(o,null,f):(v>3?g=Array.prototype.slice.call(arguments,2):v===3&&ff(g)&&(g=[g]),Vt(o,f,g))}const R2="3.2.40",B2="http://www.w3.org/2000/svg",Za=typeof document<"u"?document:null,Ex=Za&&Za.createElement("template"),F2={insert:(o,f,g)=>{f.insertBefore(o,g||null)},remove:o=>{const f=o.parentNode;f&&f.removeChild(o)},createElement:(o,f,g,v)=>{const w=f?Za.createElementNS(B2,o):Za.createElement(o,g?{is:g}:void 0);return o==="select"&&v&&v.multiple!=null&&w.setAttribute("multiple",v.multiple),w},createText:o=>Za.createTextNode(o),createComment:o=>Za.createComment(o),setText:(o,f)=>{o.nodeValue=f},setElementText:(o,f)=>{o.textContent=f},parentNode:o=>o.parentNode,nextSibling:o=>o.nextSibling,querySelector:o=>Za.querySelector(o),setScopeId(o,f){o.setAttribute(f,"")},insertStaticContent(o,f,g,v,w,A){const z=g?g.previousSibling:f.lastChild;if(w&&(w===A||w.nextSibling))for(;f.insertBefore(w.cloneNode(!0),g),!(w===A||!(w=w.nextSibling)););else{Ex.innerHTML=v?`<svg>${o}</svg>`:o;const s=Ex.content;if(v){const B=s.firstChild;for(;B.firstChild;)s.appendChild(B.firstChild);s.removeChild(B)}f.insertBefore(s,g)}return[z?z.nextSibling:f.firstChild,g?g.previousSibling:f.lastChild]}};function O2(o,f,g){const v=o._vtc;v&&(f=(f?[f,...v]:[...v]).join(" ")),f==null?o.removeAttribute("class"):g?o.setAttribute("class",f):o.className=f}function U2(o,f,g){const v=o.style,w=zn(g);if(g&&!w){for(const A in g)Bm(v,A,g[A]);if(f&&!zn(f))for(const A in f)g[A]==null&&Bm(v,A,"")}else{const A=v.display;w?f!==g&&(v.cssText=g):f&&o.removeAttribute("style"),"_vod"in o&&(v.display=A)}}const Sx=/\s*!important$/;function Bm(o,f,g){if(oi(g))g.forEach(v=>Bm(o,f,v));else if(g==null&&(g=""),f.startsWith("--"))o.setProperty(f,g);else{const v=V2(o,f);Sx.test(g)?o.setProperty(pc(v),g.replace(Sx,""),"important"):o[v]=g}}const Cx=["Webkit","Moz","ms"],pm={};function V2(o,f){const g=pm[f];if(g)return g;let v=hc(f);if(v!=="filter"&&v in o)return pm[f]=v;v=zv(v);for(let w=0;w<Cx.length;w++){const A=Cx[w]+v;if(A in o)return pm[f]=A}return f}const Ax="http://www.w3.org/1999/xlink";function N2(o,f,g,v,w){if(v&&f.startsWith("xlink:"))g==null?o.removeAttributeNS(Ax,f.slice(6,f.length)):o.setAttributeNS(Ax,f,g);else{const A=Zw(f);g==null||A&&!Ev(g)?o.removeAttribute(f):o.setAttribute(f,A?"":g)}}function j2(o,f,g,v,w,A,z){if(f==="innerHTML"||f==="textContent"){v&&z(v,w,A),o[f]=g==null?"":g;return}if(f==="value"&&o.tagName!=="PROGRESS"&&!o.tagName.includes("-")){o._value=g;const B=g==null?"":g;(o.value!==B||o.tagName==="OPTION")&&(o.value=B),g==null&&o.removeAttribute(f);return}let s=!1;if(g===""||g==null){const B=typeof o[f];B==="boolean"?g=Ev(g):g==null&&B==="string"?(g="",s=!0):B==="number"&&(g=0,s=!0)}try{o[f]=g}catch{}s&&o.removeAttribute(f)}const[C0,$2]=(()=>{let o=Date.now,f=!1;if(typeof window<"u"){Date.now()>document.createEvent("Event").timeStamp&&(o=performance.now.bind(performance));const g=navigator.userAgent.match(/firefox\/(\d+)/i);f=!!(g&&Number(g[1])<=53)}return[o,f]})();let Fm=0;const q2=Promise.resolve(),G2=()=>{Fm=0},Z2=()=>Fm||(q2.then(G2),Fm=C0());function W2(o,f,g,v){o.addEventListener(f,g,v)}function X2(o,f,g,v){o.removeEventListener(f,g,v)}function H2(o,f,g,v,w=null){const A=o._vei||(o._vei={}),z=A[f];if(v&&z)z.value=v;else{const[s,B]=K2(f);if(v){const Z=A[f]=Y2(v,w);W2(o,s,Z,B)}else z&&(X2(o,s,z,B),A[f]=void 0)}}const Mx=/(?:Once|Passive|Capture)$/;function K2(o){let f;if(Mx.test(o)){f={};let v;for(;v=o.match(Mx);)o=o.slice(0,o.length-v[0].length),f[v[0].toLowerCase()]=!0}return[o[2]===":"?o.slice(3):pc(o.slice(2)),f]}function Y2(o,f){const g=v=>{const w=v.timeStamp||C0();($2||w>=g.attached-1)&&Vr(J2(v,g.value),f,5,[v])};return g.value=o,g.attached=Z2(),g}function J2(o,f){if(oi(f)){const g=o.stopImmediatePropagation;return o.stopImmediatePropagation=()=>{g.call(o),o._stopped=!0},f.map(v=>w=>!w._stopped&&v&&v(w))}else return f}const Ix=/^on[a-z]/,Q2=(o,f,g,v,w=!1,A,z,s,B)=>{f==="class"?O2(o,v,w):f==="style"?U2(o,g,v):xf(f)?Jm(f)||H2(o,f,g,v,z):(f[0]==="."?(f=f.slice(1),!0):f[0]==="^"?(f=f.slice(1),!1):eE(o,f,v,w))?j2(o,f,v,A,z,s,B):(f==="true-value"?o._trueValue=v:f==="false-value"&&(o._falseValue=v),N2(o,f,v,w))};function eE(o,f,g,v){return v?!!(f==="innerHTML"||f==="textContent"||f in o&&Ix.test(f)&&hi(g)):f==="spellcheck"||f==="draggable"||f==="translate"||f==="form"||f==="list"&&o.tagName==="INPUT"||f==="type"&&o.tagName==="TEXTAREA"||Ix.test(f)&&zn(g)?!1:f in o}const Vs="transition",Hu="animation",gc=(o,{slots:f})=>Ne(n0,tE(o),f);gc.displayName="Transition";const A0={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};gc.props=$n({},n0.props,A0);const Na=(o,f=[])=>{oi(o)?o.forEach(g=>g(...f)):o&&o(...f)},zx=o=>o?oi(o)?o.some(f=>f.length>1):o.length>1:!1;function tE(o){const f={};for(const ft in o)ft in A0||(f[ft]=o[ft]);if(o.css===!1)return f;const{name:g="v",type:v,duration:w,enterFromClass:A=`${g}-enter-from`,enterActiveClass:z=`${g}-enter-active`,enterToClass:s=`${g}-enter-to`,appearFromClass:B=A,appearActiveClass:Z=z,appearToClass:ee=s,leaveFromClass:G=`${g}-leave-from`,leaveActiveClass:te=`${g}-leave-active`,leaveToClass:_e=`${g}-leave-to`}=o,Ee=iE(w),Te=Ee&&Ee[0],Be=Ee&&Ee[1],{onBeforeEnter:ot,onEnter:Se,onEnterCancelled:Je,onLeave:ct,onLeaveCancelled:Ie,onBeforeAppear:Pe=ot,onAppear:be=Se,onAppearCancelled:ze=Je}=f,Qe=(ft,Ze,Ke)=>{ja(ft,Ze?ee:s),ja(ft,Ze?Z:z),Ke&&Ke()},Fe=(ft,Ze)=>{ft._isLeaving=!1,ja(ft,G),ja(ft,_e),ja(ft,te),Ze&&Ze()},dt=ft=>(Ze,Ke)=>{const Bt=ft?be:Se,Wt=()=>Qe(Ze,ft,Ke);Na(Bt,[Ze,Wt]),kx(()=>{ja(Ze,ft?B:A),Ns(Ze,ft?ee:s),zx(Bt)||Px(Ze,v,Te,Wt)})};return $n(f,{onBeforeEnter(ft){Na(ot,[ft]),Ns(ft,A),Ns(ft,z)},onBeforeAppear(ft){Na(Pe,[ft]),Ns(ft,B),Ns(ft,Z)},onEnter:dt(!1),onAppear:dt(!0),onLeave(ft,Ze){ft._isLeaving=!0;const Ke=()=>Fe(ft,Ze);Ns(ft,G),oE(),Ns(ft,te),kx(()=>{!ft._isLeaving||(ja(ft,G),Ns(ft,_e),zx(ct)||Px(ft,v,Be,Ke))}),Na(ct,[ft,Ke])},onEnterCancelled(ft){Qe(ft,!1),Na(Je,[ft])},onAppearCancelled(ft){Qe(ft,!0),Na(ze,[ft])},onLeaveCancelled(ft){Fe(ft),Na(Ie,[ft])}})}function iE(o){if(o==null)return null;if(tn(o))return[mm(o.enter),mm(o.leave)];{const f=mm(o);return[f,f]}}function mm(o){return kv(o)}function Ns(o,f){f.split(/\s+/).forEach(g=>g&&o.classList.add(g)),(o._vtc||(o._vtc=new Set)).add(f)}function ja(o,f){f.split(/\s+/).forEach(v=>v&&o.classList.remove(v));const{_vtc:g}=o;g&&(g.delete(f),g.size||(o._vtc=void 0))}function kx(o){requestAnimationFrame(()=>{requestAnimationFrame(o)})}let nE=0;function Px(o,f,g,v){const w=o._endId=++nE,A=()=>{w===o._endId&&v()};if(g)return setTimeout(A,g);const{type:z,timeout:s,propCount:B}=rE(o,f);if(!z)return v();const Z=z+"end";let ee=0;const G=()=>{o.removeEventListener(Z,te),A()},te=_e=>{_e.target===o&&++ee>=B&&G()};setTimeout(()=>{ee<B&&G()},s+1),o.addEventListener(Z,te)}function rE(o,f){const g=window.getComputedStyle(o),v=Ee=>(g[Ee]||"").split(", "),w=v(Vs+"Delay"),A=v(Vs+"Duration"),z=Dx(w,A),s=v(Hu+"Delay"),B=v(Hu+"Duration"),Z=Dx(s,B);let ee=null,G=0,te=0;f===Vs?z>0&&(ee=Vs,G=z,te=A.length):f===Hu?Z>0&&(ee=Hu,G=Z,te=B.length):(G=Math.max(z,Z),ee=G>0?z>Z?Vs:Hu:null,te=ee?ee===Vs?A.length:B.length:0);const _e=ee===Vs&&/\b(transform|all)(,|$)/.test(g[Vs+"Property"]);return{type:ee,timeout:G,propCount:te,hasTransform:_e}}function Dx(o,f){for(;o.length<f.length;)o=o.concat(o);return Math.max(...f.map((g,v)=>Lx(g)+Lx(o[v])))}function Lx(o){return Number(o.slice(0,-1).replace(",","."))*1e3}function oE(){return document.body.offsetHeight}const sE=$n({patchProp:Q2},F2);let Rx;function aE(){return Rx||(Rx=x2(sE))}const lE=(...o)=>{const f=aE().createApp(...o),{mount:g}=f;return f.mount=v=>{const w=cE(v);if(!w)return;const A=f._component;!hi(A)&&!A.render&&!A.template&&(A.template=w.innerHTML),w.innerHTML="";const z=g(w,!1,w instanceof SVGElement);return w instanceof Element&&(w.removeAttribute("v-cloak"),w.setAttribute("data-v-app","")),z},f};function cE(o){return zn(o)?document.querySelector(o):o}function zf(o,f,g,v){return Object.defineProperty(o,f,{get:g,set:v,enumerable:!0}),o}const so=ii(!1);let kf;function uE(o,f){const g=/(edg|edge|edga|edgios)\/([\w.]+)/.exec(o)||/(opr)[\/]([\w.]+)/.exec(o)||/(vivaldi)[\/]([\w.]+)/.exec(o)||/(chrome|crios)[\/]([\w.]+)/.exec(o)||/(version)(applewebkit)[\/]([\w.]+).*(safari)[\/]([\w.]+)/.exec(o)||/(webkit)[\/]([\w.]+).*(version)[\/]([\w.]+).*(safari)[\/]([\w.]+)/.exec(o)||/(firefox|fxios)[\/]([\w.]+)/.exec(o)||/(webkit)[\/]([\w.]+)/.exec(o)||/(opera)(?:.*version|)[\/]([\w.]+)/.exec(o)||[];return{browser:g[5]||g[3]||g[1]||"",version:g[2]||g[4]||"0",versionNumber:g[4]||g[2]||"0",platform:f[0]||""}}function hE(o){return/(ipad)/.exec(o)||/(ipod)/.exec(o)||/(windows phone)/.exec(o)||/(iphone)/.exec(o)||/(kindle)/.exec(o)||/(silk)/.exec(o)||/(android)/.exec(o)||/(win)/.exec(o)||/(mac)/.exec(o)||/(linux)/.exec(o)||/(cros)/.exec(o)||/(playbook)/.exec(o)||/(bb)/.exec(o)||/(blackberry)/.exec(o)||[]}const M0="ontouchstart"in window||window.navigator.maxTouchPoints>0;function dE(o){kf={is:{...o}},delete o.mac,delete o.desktop;const f=Math.min(window.innerHeight,window.innerWidth)>414?"ipad":"iphone";Object.assign(o,{mobile:!0,ios:!0,platform:f,[f]:!0})}function fE(o){const f=o.toLowerCase(),g=hE(f),v=uE(f,g),w={};v.browser&&(w[v.browser]=!0,w.version=v.version,w.versionNumber=parseInt(v.versionNumber,10)),v.platform&&(w[v.platform]=!0);const A=w.android||w.ios||w.bb||w.blackberry||w.ipad||w.iphone||w.ipod||w.kindle||w.playbook||w.silk||w["windows phone"];return A===!0||f.indexOf("mobile")>-1?(w.mobile=!0,w.edga||w.edgios?(w.edge=!0,v.browser="edge"):w.crios?(w.chrome=!0,v.browser="chrome"):w.fxios&&(w.firefox=!0,v.browser="firefox")):w.desktop=!0,(w.ipod||w.ipad||w.iphone)&&(w.ios=!0),w["windows phone"]&&(w.winphone=!0,delete w["windows phone"]),(w.chrome||w.opr||w.safari||w.vivaldi||w.mobile===!0&&w.ios!==!0&&A!==!0)&&(w.webkit=!0),w.edg&&(v.browser="edgechromium",w.edgeChromium=!0),(w.safari&&w.blackberry||w.bb)&&(v.browser="blackberry",w.blackberry=!0),w.safari&&w.playbook&&(v.browser="playbook",w.playbook=!0),w.opr&&(v.browser="opera",w.opera=!0),w.safari&&w.android&&(v.browser="android",w.android=!0),w.safari&&w.kindle&&(v.browser="kindle",w.kindle=!0),w.safari&&w.silk&&(v.browser="silk",w.silk=!0),w.vivaldi&&(v.browser="vivaldi",w.vivaldi=!0),w.name=v.browser,w.platform=v.platform,f.indexOf("electron")>-1?w.electron=!0:document.location.href.indexOf("-extension://")>-1?w.bex=!0:(window.Capacitor!==void 0?(w.capacitor=!0,w.nativeMobile=!0,w.nativeMobileWrapper="capacitor"):(window._cordovaNative!==void 0||window.cordova!==void 0)&&(w.cordova=!0,w.nativeMobile=!0,w.nativeMobileWrapper="cordova"),M0===!0&&w.mac===!0&&(w.desktop===!0&&w.safari===!0||w.nativeMobile===!0&&w.android!==!0&&w.ios!==!0&&w.ipad!==!0)&&dE(w)),w}const Bx=navigator.userAgent||navigator.vendor||window.opera,pE={has:{touch:!1,webStorage:!1},within:{iframe:!1}},jn={userAgent:Bx,is:fE(Bx),has:{touch:M0},within:{iframe:window.self!==window.top}},pf={install(o){const{$q:f}=o;so.value===!0?(o.onSSRHydrated.push(()=>{so.value=!1,Object.assign(f.platform,jn),kf=void 0}),f.platform=ns(this)):f.platform=this}};{let o;zf(jn.has,"webStorage",()=>{if(o!==void 0)return o;try{if(window.localStorage)return o=!0,!0}catch{}return o=!1,!1}),jn.is.ios===!0&&window.navigator.vendor.toLowerCase().indexOf("apple"),so.value===!0?Object.assign(pf,jn,kf,pE):Object.assign(pf,jn)}const Pf=(o,f)=>{const g=ns(o);for(const v in o)zf(f,v,()=>g[v],w=>{g[v]=w});return f},Ro={hasPassive:!1,passiveCapture:!0,notPassiveCapture:!0};try{const o=Object.defineProperty({},"passive",{get(){Object.assign(Ro,{hasPassive:!0,passive:{passive:!0},notPassive:{passive:!1},passiveCapture:{passive:!0,capture:!0},notPassiveCapture:{passive:!1,capture:!0}})}});window.addEventListener("qtest",null,o),window.removeEventListener("qtest",null,o)}catch{}function as(){}function mE(o){return o.button===0}function Om(o){return o.touches&&o.touches[0]?o=o.touches[0]:o.changedTouches&&o.changedTouches[0]?o=o.changedTouches[0]:o.targetTouches&&o.targetTouches[0]&&(o=o.targetTouches[0]),{top:o.clientY,left:o.clientX}}function mf(o){o.stopPropagation()}function Gs(o){o.cancelable!==!1&&o.preventDefault()}function ko(o){o.cancelable!==!1&&o.preventDefault(),o.stopPropagation()}function _m(o,f){if(o===void 0||f===!0&&o.__dragPrevented===!0)return;const g=f===!0?v=>{v.__dragPrevented=!0,v.addEventListener("dragstart",Gs,Ro.notPassiveCapture)}:v=>{delete v.__dragPrevented,v.removeEventListener("dragstart",Gs,Ro.notPassiveCapture)};o.querySelectorAll("a, img").forEach(g)}function th(o,f,g){const v=`__q_${f}_evt`;o[v]=o[v]!==void 0?o[v].concat(g):g,g.forEach(w=>{w[0].addEventListener(w[1],o[w[2]],Ro[w[3]])})}function of(o,f){const g=`__q_${f}_evt`;o[g]!==void 0&&(o[g].forEach(v=>{v[0].removeEventListener(v[1],o[v[2]],Ro[v[3]])}),o[g]=void 0)}function I0(o,f=250,g){let v;function w(){const A=arguments,z=()=>{v=void 0,g!==!0&&o.apply(this,A)};clearTimeout(v),g===!0&&v===void 0&&o.apply(this,A),v=setTimeout(z,f)}return w.cancel=()=>{clearTimeout(v)},w}const gm=["sm","md","lg","xl"],{passive:Fx}=Ro,_E=Pf({width:0,height:0,name:"xs",sizes:{sm:600,md:1024,lg:1440,xl:1920},lt:{sm:!0,md:!0,lg:!0,xl:!0},gt:{xs:!1,sm:!1,md:!1,lg:!1},xs:!0,sm:!1,md:!1,lg:!1,xl:!1},{setSizes:as,setDebounce:as,install({$q:o,onSSRHydrated:f}){if(o.screen=this,this.__installed===!0){o.config.screen!==void 0&&(o.config.screen.bodyClasses===!1?document.body.classList.remove(`screen--${this.name}`):this.__update(!0));return}const{visualViewport:g}=window,v=g||window,w=document.scrollingElement||document.documentElement,A=g===void 0||jn.is.mobile===!0?()=>[Math.max(window.innerWidth,w.clientWidth),Math.max(window.innerHeight,w.clientHeight)]:()=>[g.width*g.scale+window.innerWidth-w.clientWidth,g.height*g.scale+window.innerHeight-w.clientHeight],z=o.config.screen!==void 0&&o.config.screen.bodyClasses===!0;this.__update=G=>{const[te,_e]=A();if(_e!==this.height&&(this.height=_e),te!==this.width)this.width=te;else if(G!==!0)return;let Ee=this.sizes;this.gt.xs=te>=Ee.sm,this.gt.sm=te>=Ee.md,this.gt.md=te>=Ee.lg,this.gt.lg=te>=Ee.xl,this.lt.sm=te<Ee.sm,this.lt.md=te<Ee.md,this.lt.lg=te<Ee.lg,this.lt.xl=te<Ee.xl,this.xs=this.lt.sm,this.sm=this.gt.xs===!0&&this.lt.md===!0,this.md=this.gt.sm===!0&&this.lt.lg===!0,this.lg=this.gt.md===!0&&this.lt.xl===!0,this.xl=this.gt.lg,Ee=this.xs===!0&&"xs"||this.sm===!0&&"sm"||this.md===!0&&"md"||this.lg===!0&&"lg"||"xl",Ee!==this.name&&(z===!0&&(document.body.classList.remove(`screen--${this.name}`),document.body.classList.add(`screen--${Ee}`)),this.name=Ee)};let s,B={},Z=16;this.setSizes=G=>{gm.forEach(te=>{G[te]!==void 0&&(B[te]=G[te])})},this.setDebounce=G=>{Z=G};const ee=()=>{const G=getComputedStyle(document.body);G.getPropertyValue("--q-size-sm")&&gm.forEach(te=>{this.sizes[te]=parseInt(G.getPropertyValue(`--q-size-${te}`),10)}),this.setSizes=te=>{gm.forEach(_e=>{te[_e]&&(this.sizes[_e]=te[_e])}),this.__update(!0)},this.setDebounce=te=>{s!==void 0&&v.removeEventListener("resize",s,Fx),s=te>0?I0(this.__update,te):this.__update,v.addEventListener("resize",s,Fx)},this.setDebounce(Z),Object.keys(B).length>0?(this.setSizes(B),B=void 0):this.__update(),z===!0&&this.name==="xs"&&document.body.classList.add("screen--xs")};so.value===!0?f.push(ee):ee()}}),Jn=Pf({isActive:!1,mode:!1},{__media:void 0,set(o){Jn.mode=o,o==="auto"?(Jn.__media===void 0&&(Jn.__media=window.matchMedia("(prefers-color-scheme: dark)"),Jn.__updateMedia=()=>{Jn.set("auto")},Jn.__media.addListener(Jn.__updateMedia)),o=Jn.__media.matches):Jn.__media!==void 0&&(Jn.__media.removeListener(Jn.__updateMedia),Jn.__media=void 0),Jn.isActive=o===!0,document.body.classList.remove(`body--${o===!0?"light":"dark"}`),document.body.classList.add(`body--${o===!0?"dark":"light"}`)},toggle(){Jn.set(Jn.isActive===!1)},install({$q:o,onSSRHydrated:f,ssrContext:g}){const{dark:v}=o.config;if(o.dark=this,this.__installed===!0&&v===void 0)return;this.isActive=v===!0;const w=v!==void 0?v:!1;if(so.value===!0){const A=s=>{this.__fromSSR=s},z=this.set;this.set=A,A(w),f.push(()=>{this.set=z,this.set(this.__fromSSR)})}else this.set(w)}}),z0=()=>!0;function gE(o){return typeof o=="string"&&o!==""&&o!=="/"&&o!=="#/"}function yE(o){return o.startsWith("#")===!0&&(o=o.substring(1)),o.startsWith("/")===!1&&(o="/"+o),o.endsWith("/")===!0&&(o=o.substring(0,o.length-1)),"#"+o}function xE(o){if(o.backButtonExit===!1)return()=>!1;if(o.backButtonExit==="*")return z0;const f=["#/"];return Array.isArray(o.backButtonExit)===!0&&f.push(...o.backButtonExit.filter(gE).map(yE)),()=>f.includes(window.location.hash)}const Um={__history:[],add:as,remove:as,install({$q:o}){if(this.__installed===!0)return;const{cordova:f,capacitor:g}=jn.is;if(f!==!0&&g!==!0)return;const v=o.config[f===!0?"cordova":"capacitor"];if(v!==void 0&&v.backButton===!1||g===!0&&(window.Capacitor===void 0||window.Capacitor.Plugins.App===void 0))return;this.add=z=>{z.condition===void 0&&(z.condition=z0),this.__history.push(z)},this.remove=z=>{const s=this.__history.indexOf(z);s>=0&&this.__history.splice(s,1)};const w=xE(Object.assign({backButtonExit:!0},v)),A=()=>{if(this.__history.length){const z=this.__history[this.__history.length-1];z.condition()===!0&&(this.__history.pop(),z.handler())}else w()===!0?navigator.app.exitApp():window.history.back()};f===!0?document.addEventListener("deviceready",()=>{document.addEventListener("backbutton",A,!1)}):window.Capacitor.Plugins.App.addListener("backButton",A)}},Ox={isoName:"en-US",nativeName:"English (US)",label:{clear:"Clear",ok:"OK",cancel:"Cancel",close:"Close",set:"Set",select:"Select",reset:"Reset",remove:"Remove",update:"Update",create:"Create",search:"Search",filter:"Filter",refresh:"Refresh",expand:o=>o?`Expand "${o}"`:"Expand",collapse:o=>o?`Collapse "${o}"`:"Collapse"},date:{days:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),daysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),firstDayOfWeek:0,format24h:!1,pluralDay:"days"},table:{noData:"No data available",noResults:"No matching records found",loading:"Loading...",selectedRecords:o=>o===1?"1 record selected.":(o===0?"No":o)+" records selected.",recordsPerPage:"Records per page:",allRows:"All",pagination:(o,f,g)=>o+"-"+f+" of "+g,columns:"Columns"},editor:{url:"URL",bold:"Bold",italic:"Italic",strikethrough:"Strikethrough",underline:"Underline",unorderedList:"Unordered List",orderedList:"Ordered List",subscript:"Subscript",superscript:"Superscript",hyperlink:"Hyperlink",toggleFullscreen:"Toggle Fullscreen",quote:"Quote",left:"Left align",center:"Center align",right:"Right align",justify:"Justify align",print:"Print",outdent:"Decrease indentation",indent:"Increase indentation",removeFormat:"Remove formatting",formatting:"Formatting",fontSize:"Font Size",align:"Align",hr:"Insert Horizontal Rule",undo:"Undo",redo:"Redo",heading1:"Heading 1",heading2:"Heading 2",heading3:"Heading 3",heading4:"Heading 4",heading5:"Heading 5",heading6:"Heading 6",paragraph:"Paragraph",code:"Code",size1:"Very small",size2:"A bit small",size3:"Normal",size4:"Medium-large",size5:"Big",size6:"Very big",size7:"Maximum",defaultFont:"Default Font",viewSource:"View Source"},tree:{noNodes:"No nodes available",noResults:"No matching nodes found"}};function Ux(){const o=Array.isArray(navigator.languages)===!0&&navigator.languages.length>0?navigator.languages[0]:navigator.language;if(typeof o=="string")return o.split(/[-_]/).map((f,g)=>g===0?f.toLowerCase():g>1||f.length<4?f.toUpperCase():f[0].toUpperCase()+f.slice(1).toLowerCase()).join("-")}const qs=Pf({__langPack:{}},{getLocale:Ux,set(o=Ox,f){const g={...o,rtl:o.rtl===!0,getLocale:Ux};{const v=document.documentElement;v.setAttribute("dir",g.rtl===!0?"rtl":"ltr"),v.setAttribute("lang",g.isoName),g.set=qs.set,Object.assign(qs.__langPack,g),qs.props=g,qs.isoName=g.isoName,qs.nativeName=g.nativeName}},install({$q:o,lang:f,ssrContext:g}){o.lang=qs.__langPack,this.__installed===!0?f!==void 0&&this.set(f):this.set(f||Ox)}});function vE(o,f,g=document.body){if(typeof o!="string")throw new TypeError("Expected a string as propName");if(typeof f!="string")throw new TypeError("Expected a string as value");if(!(g instanceof Element))throw new TypeError("Expected a DOM element");g.style.setProperty(`--q-${o}`,f)}let k0=!1;function bE(o){k0=o.isComposing===!0}function P0(o){return k0===!0||o!==Object(o)||o.isComposing===!0||o.qKeyEvent===!0}function Vm(o,f){return P0(o)===!0?!1:[].concat(f).includes(o.keyCode)}function wE(o){if(o.ios===!0)return"ios";if(o.android===!0)return"android"}function TE({is:o,has:f,within:g},v){const w=[o.desktop===!0?"desktop":"mobile",`${f.touch===!1?"no-":""}touch`];if(o.mobile===!0){const A=wE(o);A!==void 0&&w.push("platform-"+A)}if(o.nativeMobile===!0){const A=o.nativeMobileWrapper;w.push(A),w.push("native-mobile"),o.ios===!0&&(v[A]===void 0||v[A].iosStatusBarPadding!==!1)&&w.push("q-ios-padding")}else o.electron===!0?w.push("electron"):o.bex===!0&&w.push("bex");return g.iframe===!0&&w.push("within-iframe"),w}function EE(){const o=document.body.className;let f=o;kf!==void 0&&(f=f.replace("desktop","platform-ios mobile")),jn.has.touch===!0&&(f=f.replace("no-touch","touch")),jn.within.iframe===!0&&(f+=" within-iframe"),o!==f&&(document.body.className=f)}function SE(o){for(const f in o)vE(f,o[f])}const CE={install(o){if(this.__installed!==!0){if(so.value===!0)EE();else{const{$q:f}=o;f.config.brand!==void 0&&SE(f.config.brand);const g=TE(jn,f.config);document.body.classList.add.apply(document.body.classList,g)}jn.is.ios===!0&&document.body.addEventListener("touchstart",as),window.addEventListener("keydown",bE,!0)}}},AE={name:"material-icons",type:{positive:"check_circle",negative:"warning",info:"info",warning:"priority_high"},arrow:{up:"arrow_upward",right:"arrow_forward",down:"arrow_downward",left:"arrow_back",dropdown:"arrow_drop_down"},chevron:{left:"chevron_left",right:"chevron_right"},colorPicker:{spectrum:"gradient",tune:"tune",palette:"style"},pullToRefresh:{icon:"refresh"},carousel:{left:"chevron_left",right:"chevron_right",up:"keyboard_arrow_up",down:"keyboard_arrow_down",navigationIcon:"lens"},chip:{remove:"cancel",selected:"check"},datetime:{arrowLeft:"chevron_left",arrowRight:"chevron_right",now:"access_time",today:"today"},editor:{bold:"format_bold",italic:"format_italic",strikethrough:"strikethrough_s",underline:"format_underlined",unorderedList:"format_list_bulleted",orderedList:"format_list_numbered",subscript:"vertical_align_bottom",superscript:"vertical_align_top",hyperlink:"link",toggleFullscreen:"fullscreen",quote:"format_quote",left:"format_align_left",center:"format_align_center",right:"format_align_right",justify:"format_align_justify",print:"print",outdent:"format_indent_decrease",indent:"format_indent_increase",removeFormat:"format_clear",formatting:"text_format",fontSize:"format_size",align:"format_align_left",hr:"remove",undo:"undo",redo:"redo",heading:"format_size",code:"code",size:"format_size",font:"font_download",viewSource:"code"},expansionItem:{icon:"keyboard_arrow_down",denseIcon:"arrow_drop_down"},fab:{icon:"add",activeIcon:"close"},field:{clear:"cancel",error:"error"},pagination:{first:"first_page",prev:"keyboard_arrow_left",next:"keyboard_arrow_right",last:"last_page"},rating:{icon:"grade"},stepper:{done:"check",active:"edit",error:"warning"},tabs:{left:"chevron_left",right:"chevron_right",up:"keyboard_arrow_up",down:"keyboard_arrow_down"},table:{arrowUp:"arrow_upward",warning:"warning",firstPage:"first_page",prevPage:"chevron_left",nextPage:"chevron_right",lastPage:"last_page"},tree:{icon:"play_arrow"},uploader:{done:"done",clear:"clear",add:"add_box",upload:"cloud_upload",removeQueue:"clear_all",removeUploaded:"done_all"}},_f=Pf({iconMapFn:null,__icons:{}},{set(o,f){const g={...o,rtl:o.rtl===!0};g.set=_f.set,Object.assign(_f.__icons,g)},install({$q:o,iconSet:f,ssrContext:g}){o.config.iconMapFn!==void 0&&(this.iconMapFn=o.config.iconMapFn),o.iconSet=this.__icons,zf(o,"iconMapFn",()=>this.iconMapFn,v=>{this.iconMapFn=v}),this.__installed===!0?f!==void 0&&this.set(f):this.set(f||AE)}}),ME="_q_",D0="_q_t_",ph="_q_l_",IE="_q_pc_",L0="_q_f_",zE="_q_fo_",Vx={};let R0=!1;function kE(){R0=!0}function Nx(o){return o!==null&&typeof o=="object"&&Array.isArray(o)!==!0}function PE(o){return typeof o=="number"&&isFinite(o)}const jx=[pf,CE,Jn,_E,Um,qs,_f];function $x(o,f){f.forEach(g=>{g.install(o),g.__installed=!0})}function DE(o,f,g){o.config.globalProperties.$q=g.$q,o.provide(ME,g.$q),$x(g,jx),f.components!==void 0&&Object.values(f.components).forEach(v=>{Nx(v)===!0&&v.name!==void 0&&o.component(v.name,v)}),f.directives!==void 0&&Object.values(f.directives).forEach(v=>{Nx(v)===!0&&v.name!==void 0&&o.directive(v.name,v)}),f.plugins!==void 0&&$x(g,Object.values(f.plugins).filter(v=>typeof v.install=="function"&&jx.includes(v)===!1)),so.value===!0&&(g.$q.onSSRHydrated=()=>{g.onSSRHydrated.forEach(v=>{v()}),g.$q.onSSRHydrated=()=>{}})}const LE=function(o,f={}){const g={version:"2.9.2"};R0===!1?(f.config!==void 0&&Object.assign(Vx,f.config),g.config={...Vx},kE()):g.config=f.config||{},DE(o,f,{parentApp:o,$q:g,lang:f.lang,iconSet:f.iconSet,onSSRHydrated:[]})},RE={version:"2.9.2",install:LE,lang:qs,iconSet:_f};const Nm={xs:18,sm:24,md:32,lg:38,xl:46},g_={size:String};function y_(o,f=Nm){return Ue(()=>o.size!==void 0?{fontSize:o.size in f?`${f[o.size]}px`:o.size}:null)}const BE={size:{type:[Number,String],default:"1em"},color:String};function FE(o){return{cSize:Ue(()=>o.size in Nm?`${Nm[o.size]}px`:o.size),classes:Ue(()=>"q-spinner"+(o.color?` text-${o.color}`:""))}}const dn=o=>Tf(YT(o)),B0=o=>Tf(o),x_=dn({name:"QSpinner",props:{...BE,thickness:{type:Number,default:5}},setup(o){const{cSize:f,classes:g}=FE(o);return()=>Ne("svg",{class:g.value+" q-spinner-mat",width:f.value,height:f.value,viewBox:"25 25 50 50"},[Ne("circle",{class:"path",cx:"50",cy:"50",r:"20",fill:"none",stroke:"currentColor","stroke-width":o.thickness,"stroke-miterlimit":"10"})])}}),OE={ratio:[String,Number]};function UE(o,f){return Ue(()=>{const g=Number(o.ratio||(f!==void 0?f.value:void 0));return isNaN(g)!==!0&&g>0?{paddingBottom:`${100/g}%`}:null})}function tr(o,f){return o!==void 0&&o()||f}function F0(o,f){if(o!==void 0){const g=o();if(g!=null)return g.slice()}return f}function Do(o,f){return o!==void 0?f.concat(o()):f}function VE(o,f){return o===void 0?f:f!==void 0?f.concat(o()):o()}function NE(o,f,g,v,w,A){f.key=v+w;const z=Ne(o,f,g);return w===!0?d0(z,A()):z}const jE=16/9,$E=dn({name:"QImg",props:{...OE,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:jE},placeholderSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(o,{slots:f,emit:g}){const v=ii(o.initialRatio),w=UE(o,v);let A;const z=[ii(null),ii(o.placeholderSrc!==void 0?{src:o.placeholderSrc}:null)],s=ii(0),B=ii(!1),Z=ii(!1),ee=Ue(()=>`q-img q-img--${o.noNativeMenu===!0?"no-":""}menu`),G=Ue(()=>({width:o.width,height:o.height})),te=Ue(()=>`q-img__image ${o.imgClass!==void 0?o.imgClass+" ":""}q-img__image--with${o.noTransition===!0?"out":""}-transition`),_e=Ue(()=>({...o.imgStyle,objectFit:o.fit,objectPosition:o.position}));di(()=>Ee(),Te);function Ee(){return o.src||o.srcset||o.sizes?{src:o.src,srcset:o.srcset,sizes:o.sizes}:null}function Te(be){if(clearTimeout(A),Z.value=!1,be===null){B.value=!1,z[0].value=null,z[1].value=null;return}B.value=!0,z[s.value].value=be}function Be({target:be}){A!==null&&(clearTimeout(A),v.value=be.naturalHeight===0?.5:be.naturalWidth/be.naturalHeight,ot(be,1))}function ot(be,ze){A===null||ze===1e3||(be.complete===!0?Se(be):A=setTimeout(()=>{ot(be,ze+1)},50))}function Se(be){A!==null&&(s.value=s.value===1?0:1,z[s.value].value=null,B.value=!1,Z.value=!1,g("load",be.currentSrc||be.src))}function Je(be){clearTimeout(A),B.value=!1,Z.value=!0,z[0].value=null,z[1].value=null,g("error",be)}function ct(be,ze){return Ne("div",{class:"q-img__container absolute-full",key:be},ze)}function Ie(be){const ze=z[be].value,Qe={key:"img_"+be,class:te.value,style:_e.value,crossorigin:o.crossorigin,decoding:o.decoding,referrerpolicy:o.referrerpolicy,height:o.height,width:o.width,loading:o.loading,fetchpriority:o.fetchpriority,"aria-hidden":"true",draggable:o.draggable,...ze};return s.value===be?(Qe.class+=" q-img__image--waiting",Object.assign(Qe,{onLoad:Be,onError:Je})):Qe.class+=" q-img__image--loaded",ct("img"+be,Ne("img",Qe))}function Pe(){return B.value!==!0?Ne("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},tr(f[Z.value===!0?"error":"default"])):Ne("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},f.loading!==void 0?f.loading():o.noSpinner===!0?void 0:[Ne(x_,{color:o.spinnerColor,size:o.spinnerSize})])}return Te(Ee()),ir(()=>{clearTimeout(A),A=null}),()=>{const be=[];return w.value!==null&&be.push(Ne("div",{key:"filler",style:w.value})),Z.value!==!0&&(z[0].value!==null&&be.push(Ie(0)),z[1].value!==null&&be.push(Ie(1))),be.push(Ne(gc,{name:"q-transition--fade"},Pe)),Ne("div",{class:ee.value,style:G.value,role:"img","aria-label":o.alt},be)}}});function qE(){const o=ii(!so.value);return o.value===!1&&ur(()=>{o.value=!0}),o}const O0=typeof ResizeObserver<"u",qx=O0===!0?{}:{style:"display:block;position:absolute;top:0;left:0;right:0;bottom:0;height:100%;width:100%;overflow:hidden;pointer-events:none;z-index:-1;",url:"about:blank"},gf=dn({name:"QResizeObserver",props:{debounce:{type:[String,Number],default:100}},emits:["resize"],setup(o,{emit:f}){let g=null,v,w={width:-1,height:-1};function A(ee){ee===!0||o.debounce===0||o.debounce==="0"?z():g===null&&(g=setTimeout(z,o.debounce))}function z(){if(clearTimeout(g),g=null,v){const{offsetWidth:ee,offsetHeight:G}=v;(ee!==w.width||G!==w.height)&&(w={width:ee,height:G},f("resize",w))}}const{proxy:s}=nn();if(O0===!0){let ee;return ur(()=>{zr(()=>{v=s.$el.parentNode,v&&(ee=new ResizeObserver(A),ee.observe(v),z())})}),ir(()=>{clearTimeout(g),ee!==void 0&&(ee.disconnect!==void 0?ee.disconnect():v&&ee.unobserve(v))}),as}else{let te=function(){clearTimeout(g),G!==void 0&&(G.removeEventListener!==void 0&&G.removeEventListener("resize",A,Ro.passive),G=void 0)},_e=function(){te(),v&&v.contentDocument&&(G=v.contentDocument.defaultView,G.addEventListener("resize",A,Ro.passive),z())};var B=te,Z=_e;const ee=qE();let G;return ur(()=>{zr(()=>{v=s.$el,v&&_e()})}),ir(te),s.trigger=A,()=>{if(ee.value===!0)return Ne("object",{style:qx.style,tabindex:-1,type:"text/html",data:qx.url,"aria-hidden":"true",onLoad:_e})}}}}),GE=dn({name:"QHeader",props:{modelValue:{type:Boolean,default:!0},reveal:Boolean,revealOffset:{type:Number,default:250},bordered:Boolean,elevated:Boolean,heightHint:{type:[String,Number],default:50}},emits:["reveal","focusin"],setup(o,{slots:f,emit:g}){const{proxy:{$q:v}}=nn(),w=Lo(ph,()=>{console.error("QHeader needs to be child of QLayout")}),A=ii(parseInt(o.heightHint,10)),z=ii(!0),s=Ue(()=>o.reveal===!0||w.view.value.indexOf("H")>-1||v.platform.is.ios&&w.isContainer.value===!0),B=Ue(()=>{if(o.modelValue!==!0)return 0;if(s.value===!0)return z.value===!0?A.value:0;const Se=A.value-w.scroll.value.position;return Se>0?Se:0}),Z=Ue(()=>o.modelValue!==!0||s.value===!0&&z.value!==!0),ee=Ue(()=>o.modelValue===!0&&Z.value===!0&&o.reveal===!0),G=Ue(()=>"q-header q-layout__section--marginal "+(s.value===!0?"fixed":"absolute")+"-top"+(o.bordered===!0?" q-header--bordered":"")+(Z.value===!0?" q-header--hidden":"")+(o.modelValue!==!0?" q-layout--prevent-focus":"")),te=Ue(()=>{const Se=w.rows.value.top,Je={};return Se[0]==="l"&&w.left.space===!0&&(Je[v.lang.rtl===!0?"right":"left"]=`${w.left.size}px`),Se[2]==="r"&&w.right.space===!0&&(Je[v.lang.rtl===!0?"left":"right"]=`${w.right.size}px`),Je});function _e(Se,Je){w.update("header",Se,Je)}function Ee(Se,Je){Se.value!==Je&&(Se.value=Je)}function Te({height:Se}){Ee(A,Se),_e("size",Se)}function Be(Se){ee.value===!0&&Ee(z,!0),g("focusin",Se)}di(()=>o.modelValue,Se=>{_e("space",Se),Ee(z,!0),w.animate()}),di(B,Se=>{_e("offset",Se)}),di(()=>o.reveal,Se=>{Se===!1&&Ee(z,o.modelValue)}),di(z,Se=>{w.animate(),g("reveal",Se)}),di(w.scroll,Se=>{o.reveal===!0&&Ee(z,Se.direction==="up"||Se.position<=o.revealOffset||Se.position-Se.inflectionPoint<100)});const ot={};return w.instances.header=ot,o.modelValue===!0&&_e("size",A.value),_e("space",o.modelValue),_e("offset",B.value),ir(()=>{w.instances.header===ot&&(w.instances.header=void 0,_e("size",0),_e("offset",0),_e("space",!1))}),()=>{const Se=F0(f.default,[]);return o.elevated===!0&&Se.push(Ne("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),Se.push(Ne(gf,{debounce:0,onResize:Te})),Ne("header",{class:G.value,style:te.value,onFocusin:Be},Se)}}}),ZE={position:{type:String,default:"bottom-right",validator:o=>["top-right","top-left","bottom-right","bottom-left","top","right","bottom","left"].includes(o)},offset:{type:Array,validator:o=>o.length===2},expand:Boolean};function WE(){const{props:o,proxy:{$q:f}}=nn(),g=Lo(ph,()=>{console.error("QPageSticky needs to be child of QLayout")}),v=Ue(()=>{const G=o.position;return{top:G.indexOf("top")>-1,right:G.indexOf("right")>-1,bottom:G.indexOf("bottom")>-1,left:G.indexOf("left")>-1,vertical:G==="top"||G==="bottom",horizontal:G==="left"||G==="right"}}),w=Ue(()=>g.header.offset),A=Ue(()=>g.right.offset),z=Ue(()=>g.footer.offset),s=Ue(()=>g.left.offset),B=Ue(()=>{let G=0,te=0;const _e=v.value,Ee=f.lang.rtl===!0?-1:1;_e.top===!0&&w.value!==0?te=`${w.value}px`:_e.bottom===!0&&z.value!==0&&(te=`${-z.value}px`),_e.left===!0&&s.value!==0?G=`${Ee*s.value}px`:_e.right===!0&&A.value!==0&&(G=`${-Ee*A.value}px`);const Te={transform:`translate(${G}, ${te})`};return o.offset&&(Te.margin=`${o.offset[1]}px ${o.offset[0]}px`),_e.vertical===!0?(s.value!==0&&(Te[f.lang.rtl===!0?"right":"left"]=`${s.value}px`),A.value!==0&&(Te[f.lang.rtl===!0?"left":"right"]=`${A.value}px`)):_e.horizontal===!0&&(w.value!==0&&(Te.top=`${w.value}px`),z.value!==0&&(Te.bottom=`${z.value}px`)),Te}),Z=Ue(()=>`q-page-sticky row flex-center fixed-${o.position} q-page-sticky--${o.expand===!0?"expand":"shrink"}`);function ee(G){const te=tr(G.default);return Ne("div",{class:Z.value,style:B.value},o.expand===!0?te:[Ne("div",te)])}return{$layout:g,getStickyContent:ee}}const XE=dn({name:"QPageSticky",props:ZE,setup(o,{slots:f}){const{getStickyContent:g}=WE();return()=>g(f)}}),HE=dn({name:"QPageContainer",setup(o,{slots:f}){const{proxy:{$q:g}}=nn(),v=Lo(ph,()=>{console.error("QPageContainer needs to be child of QLayout")});fh(IE,!0);const w=Ue(()=>{const A={};return v.header.space===!0&&(A.paddingTop=`${v.header.size}px`),v.right.space===!0&&(A[`padding${g.lang.rtl===!0?"Left":"Right"}`]=`${v.right.size}px`),v.footer.space===!0&&(A.paddingBottom=`${v.footer.size}px`),v.left.space===!0&&(A[`padding${g.lang.rtl===!0?"Right":"Left"}`]=`${v.left.size}px`),A});return()=>Ne("div",{class:"q-page-container",style:w.value},tr(f.default))}});function U0(o,f){typeof f.type=="symbol"?Array.isArray(f.children)===!0&&f.children.forEach(g=>{U0(o,g)}):o.add(f)}function V0(o){const f=new Set;return o.forEach(g=>{U0(f,g)}),Array.from(f)}function v_(o){return o.appContext.config.globalProperties.$router!==void 0}const Gx=dn({name:"QChatMessage",props:{sent:Boolean,label:String,bgColor:String,textColor:String,name:String,avatar:String,text:Array,stamp:String,size:String,labelHtml:Boolean,nameHtml:Boolean,textHtml:Boolean,stampHtml:Boolean},setup(o,{slots:f}){const g=Ue(()=>o.sent===!0?"sent":"received"),v=Ue(()=>`q-message-text-content q-message-text-content--${g.value}`+(o.textColor!==void 0?` text-${o.textColor}`:"")),w=Ue(()=>`q-message-text q-message-text--${g.value}`+(o.bgColor!==void 0?` text-${o.bgColor}`:"")),A=Ue(()=>"q-message-container row items-end no-wrap"+(o.sent===!0?" reverse":"")),z=Ue(()=>o.size!==void 0?`col-${o.size}`:""),s=Ue(()=>({msg:o.textHtml===!0?"innerHTML":"textContent",stamp:o.stampHtml===!0?"innerHTML":"textContent",name:o.nameHtml===!0?"innerHTML":"textContent",label:o.labelHtml===!0?"innerHTML":"textContent"}));function B(ee){return f.stamp!==void 0?[ee,Ne("div",{class:"q-message-stamp"},f.stamp())]:o.stamp?[ee,Ne("div",{class:"q-message-stamp",[s.value.stamp]:o.stamp})]:[ee]}function Z(ee,G){const te=G===!0?ee.length>1?_e=>_e:_e=>Ne("div",[_e]):_e=>Ne("div",{[s.value.msg]:_e});return ee.map((_e,Ee)=>Ne("div",{key:Ee,class:w.value},[Ne("div",{class:v.value},B(te(_e)))]))}return()=>{const ee=[];f.avatar!==void 0?ee.push(f.avatar()):o.avatar!==void 0&&ee.push(Ne("img",{class:`q-message-avatar q-message-avatar--${g.value}`,src:o.avatar,"aria-hidden":"true"}));const G=[];f.name!==void 0?G.push(Ne("div",{class:`q-message-name q-message-name--${g.value}`},f.name())):o.name!==void 0&&G.push(Ne("div",{class:`q-message-name q-message-name--${g.value}`,[s.value.name]:o.name})),f.default!==void 0?G.push(Z(V0(f.default()),!0)):o.text!==void 0&&G.push(Z(o.text)),ee.push(Ne("div",{class:z.value},G));const te=[];return f.label!==void 0?te.push(Ne("div",{class:"q-message-label"},f.label())):o.label!==void 0&&te.push(Ne("div",{class:"q-message-label",[s.value.label]:o.label})),te.push(Ne("div",{class:A.value},ee)),Ne("div",{class:`q-message q-message-${g.value}`},te)}}}),KE=dn({name:"QToolbar",props:{inset:Boolean},setup(o,{slots:f}){const g=Ue(()=>"q-toolbar row no-wrap items-center"+(o.inset===!0?" q-toolbar--inset":""));return()=>Ne("div",{class:g.value},tr(f.default))}}),YE=dn({name:"QFooter",props:{modelValue:{type:Boolean,default:!0},reveal:Boolean,bordered:Boolean,elevated:Boolean,heightHint:{type:[String,Number],default:50}},emits:["reveal","focusin"],setup(o,{slots:f,emit:g}){const{proxy:{$q:v}}=nn(),w=Lo(ph,()=>{console.error("QFooter needs to be child of QLayout")}),A=ii(parseInt(o.heightHint,10)),z=ii(!0),s=ii(so.value===!0||w.isContainer.value===!0?0:window.innerHeight),B=Ue(()=>o.reveal===!0||w.view.value.indexOf("F")>-1||v.platform.is.ios&&w.isContainer.value===!0),Z=Ue(()=>w.isContainer.value===!0?w.containerHeight.value:s.value),ee=Ue(()=>{if(o.modelValue!==!0)return 0;if(B.value===!0)return z.value===!0?A.value:0;const Ie=w.scroll.value.position+Z.value+A.value-w.height.value;return Ie>0?Ie:0}),G=Ue(()=>o.modelValue!==!0||B.value===!0&&z.value!==!0),te=Ue(()=>o.modelValue===!0&&G.value===!0&&o.reveal===!0),_e=Ue(()=>"q-footer q-layout__section--marginal "+(B.value===!0?"fixed":"absolute")+"-bottom"+(o.bordered===!0?" q-footer--bordered":"")+(G.value===!0?" q-footer--hidden":"")+(o.modelValue!==!0?" q-layout--prevent-focus"+(B.value!==!0?" hidden":""):"")),Ee=Ue(()=>{const Ie=w.rows.value.bottom,Pe={};return Ie[0]==="l"&&w.left.space===!0&&(Pe[v.lang.rtl===!0?"right":"left"]=`${w.left.size}px`),Ie[2]==="r"&&w.right.space===!0&&(Pe[v.lang.rtl===!0?"left":"right"]=`${w.right.size}px`),Pe});function Te(Ie,Pe){w.update("footer",Ie,Pe)}function Be(Ie,Pe){Ie.value!==Pe&&(Ie.value=Pe)}function ot({height:Ie}){Be(A,Ie),Te("size",Ie)}function Se(){if(o.reveal!==!0)return;const{direction:Ie,position:Pe,inflectionPoint:be}=w.scroll.value;Be(z,Ie==="up"||Pe-be<100||w.height.value-Z.value-Pe-A.value<300)}function Je(Ie){te.value===!0&&Be(z,!0),g("focusin",Ie)}di(()=>o.modelValue,Ie=>{Te("space",Ie),Be(z,!0),w.animate()}),di(ee,Ie=>{Te("offset",Ie)}),di(()=>o.reveal,Ie=>{Ie===!1&&Be(z,o.modelValue)}),di(z,Ie=>{w.animate(),g("reveal",Ie)}),di([A,w.scroll,w.height],Se),di(()=>v.screen.height,Ie=>{w.isContainer.value!==!0&&Be(s,Ie)});const ct={};return w.instances.footer=ct,o.modelValue===!0&&Te("size",A.value),Te("space",o.modelValue),Te("offset",ee.value),ir(()=>{w.instances.footer===ct&&(w.instances.footer=void 0,Te("size",0),Te("offset",0),Te("space",!1))}),()=>{const Ie=Do(f.default,[Ne(gf,{debounce:0,onResize:ot})]);return o.elevated===!0&&Ie.push(Ne("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),Ne("footer",{class:_e.value,style:Ee.value,onFocusin:Je},Ie)}}});function jm(o,f){const g=o.style;for(const v in f)g[v]=f[v]}function JE(o){if(o==null)return;if(typeof o=="string")try{return document.querySelector(o)||void 0}catch{return}const f=c_(o);if(f)return f.$el||f}const QE=[null,document,document.body,document.scrollingElement,document.documentElement];function eS(o,f){let g=JE(f);if(g===void 0){if(o==null)return window;g=o.closest(".scroll,.scroll-y,.overflow-auto")}return QE.includes(g)?window:g}function tS(o){return o===window?window.pageYOffset||window.scrollY||document.body.scrollTop||0:o.scrollTop}function iS(o){return o===window?window.pageXOffset||window.scrollX||document.body.scrollLeft||0:o.scrollLeft}let Kd;function ym(){if(Kd!==void 0)return Kd;const o=document.createElement("p"),f=document.createElement("div");jm(o,{width:"100%",height:"200px"}),jm(f,{position:"absolute",top:"0px",left:"0px",visibility:"hidden",width:"200px",height:"150px",overflow:"hidden"}),f.appendChild(o),document.body.appendChild(f);const g=o.offsetWidth;f.style.overflow="scroll";let v=o.offsetWidth;return g===v&&(v=f.clientWidth),f.remove(),Kd=g-v,Kd}const{passive:Zx}=Ro,nS=["both","horizontal","vertical"],rS=dn({name:"QScrollObserver",props:{axis:{type:String,validator:o=>nS.includes(o),default:"vertical"},debounce:[String,Number],scrollTarget:{default:void 0}},emits:["scroll"],setup(o,{emit:f}){const g={position:{top:0,left:0},direction:"down",directionChanged:!1,delta:{top:0,left:0},inflectionPoint:{top:0,left:0}};let v=null,w,A;di(()=>o.scrollTarget,()=>{B(),s()});function z(){v!==null&&v();const G=Math.max(0,tS(w)),te=iS(w),_e={top:G-g.position.top,left:te-g.position.left};if(o.axis==="vertical"&&_e.top===0||o.axis==="horizontal"&&_e.left===0)return;const Ee=Math.abs(_e.top)>=Math.abs(_e.left)?_e.top<0?"up":"down":_e.left<0?"left":"right";g.position={top:G,left:te},g.directionChanged=g.direction!==Ee,g.delta=_e,g.directionChanged===!0&&(g.direction=Ee,g.inflectionPoint=g.position),f("scroll",{...g})}function s(){w=eS(A,o.scrollTarget),w.addEventListener("scroll",Z,Zx),Z(!0)}function B(){w!==void 0&&(w.removeEventListener("scroll",Z,Zx),w=void 0)}function Z(G){if(G===!0||o.debounce===0||o.debounce==="0")z();else if(v===null){const[te,_e]=o.debounce?[setTimeout(z,o.debounce),clearTimeout]:[requestAnimationFrame(z),cancelAnimationFrame];v=()=>{_e(te),v=null}}}const{proxy:ee}=nn();return ur(()=>{A=ee.$el.parentNode,s()}),ir(()=>{v!==null&&v(),B()}),Object.assign(ee,{trigger:Z,getPosition:()=>g}),as}}),oS=dn({name:"QLayout",props:{container:Boolean,view:{type:String,default:"hhh lpr fff",validator:o=>/^(h|l)h(h|r) lpr (f|l)f(f|r)$/.test(o.toLowerCase())},onScroll:Function,onScrollHeight:Function,onResize:Function},setup(o,{slots:f,emit:g}){const{proxy:{$q:v}}=nn(),w=ii(null),A=ii(v.screen.height),z=ii(o.container===!0?0:v.screen.width),s=ii({position:0,direction:"down",inflectionPoint:0}),B=ii(0),Z=ii(so.value===!0?0:ym()),ee=Ue(()=>"q-layout q-layout--"+(o.container===!0?"containerized":"standard")),G=Ue(()=>o.container===!1?{minHeight:v.screen.height+"px"}:null),te=Ue(()=>Z.value!==0?{[v.lang.rtl===!0?"left":"right"]:`${Z.value}px`}:null),_e=Ue(()=>Z.value!==0?{[v.lang.rtl===!0?"right":"left"]:0,[v.lang.rtl===!0?"left":"right"]:`-${Z.value}px`,width:`calc(100% + ${Z.value}px)`}:null);function Ee(be){if(o.container===!0||document.qScrollPrevented!==!0){const ze={position:be.position.top,direction:be.direction,directionChanged:be.directionChanged,inflectionPoint:be.inflectionPoint.top,delta:be.delta.top};s.value=ze,o.onScroll!==void 0&&g("scroll",ze)}}function Te(be){const{height:ze,width:Qe}=be;let Fe=!1;A.value!==ze&&(Fe=!0,A.value=ze,o.onScrollHeight!==void 0&&g("scroll-height",ze),ot()),z.value!==Qe&&(Fe=!0,z.value=Qe),Fe===!0&&o.onResize!==void 0&&g("resize",be)}function Be({height:be}){B.value!==be&&(B.value=be,ot())}function ot(){if(o.container===!0){const be=A.value>B.value?ym():0;Z.value!==be&&(Z.value=be)}}let Se;const Je={instances:{},view:Ue(()=>o.view),isContainer:Ue(()=>o.container),rootRef:w,height:A,containerHeight:B,scrollbarWidth:Z,totalWidth:Ue(()=>z.value+Z.value),rows:Ue(()=>{const be=o.view.toLowerCase().split(" ");return{top:be[0].split(""),middle:be[1].split(""),bottom:be[2].split("")}}),header:ns({size:0,offset:0,space:!1}),right:ns({size:300,offset:0,space:!1}),footer:ns({size:0,offset:0,space:!1}),left:ns({size:300,offset:0,space:!1}),scroll:s,animate(){Se!==void 0?clearTimeout(Se):document.body.classList.add("q-body--layout-animate"),Se=setTimeout(()=>{document.body.classList.remove("q-body--layout-animate"),Se=void 0},155)},update(be,ze,Qe){Je[be][ze]=Qe}};if(fh(ph,Je),ym()>0){let Qe=function(){be=null,ze.classList.remove("hide-scrollbar")},Fe=function(){if(be===null){if(ze.scrollHeight>v.screen.height)return;ze.classList.add("hide-scrollbar")}else clearTimeout(be);be=setTimeout(Qe,300)},dt=function(ft){be!==null&&ft==="remove"&&(clearTimeout(be),Qe()),window[`${ft}EventListener`]("resize",Fe)};var ct=Qe,Ie=Fe,Pe=dt;let be=null;const ze=document.body;di(()=>o.container!==!0?"add":"remove",dt),o.container!==!0&&dt("add"),d_(()=>{dt("remove")})}return()=>{const be=Do(f.default,[Ne(rS,{onScroll:Ee}),Ne(gf,{onResize:Te})]),ze=Ne("div",{class:ee.value,style:G.value,ref:o.container===!0?void 0:w,tabindex:-1},be);return o.container===!0?Ne("div",{class:"q-layout-container overflow-hidden",ref:w},[Ne(gf,{onResize:Be}),Ne("div",{class:"absolute-full",style:te.value},[Ne("div",{class:"scroll",style:_e.value},[ze])])]):ze}}}),Wx="0 0 24 24",Xx=o=>o,xm=o=>`ionicons ${o}`,N0={"mdi-":o=>`mdi ${o}`,"icon-":Xx,"bt-":o=>`bt ${o}`,"eva-":o=>`eva ${o}`,"ion-md":xm,"ion-ios":xm,"ion-logo":xm,"iconfont ":Xx,"ti-":o=>`themify-icon ${o}`,"bi-":o=>`bootstrap-icons ${o}`},j0={o_:"-outlined",r_:"-round",s_:"-sharp"},$0={sym_o_:"-outlined",sym_r_:"-rounded",sym_s_:"-sharp"},sS=new RegExp("^("+Object.keys(N0).join("|")+")"),aS=new RegExp("^("+Object.keys(j0).join("|")+")"),Hx=new RegExp("^("+Object.keys($0).join("|")+")"),lS=/^[Mm]\s?[-+]?\.?\d/,cS=/^img:/,uS=/^svguse:/,hS=/^ion-/,dS=/^(fa-(solid|regular|light|brands|duotone|thin)|[lf]a[srlbdk]?) /,vr=dn({name:"QIcon",props:{...g_,tag:{type:String,default:"i"},name:String,color:String,left:Boolean,right:Boolean},setup(o,{slots:f}){const{proxy:{$q:g}}=nn(),v=y_(o),w=Ue(()=>"q-icon"+(o.left===!0?" on-left":"")+(o.right===!0?" on-right":"")+(o.color!==void 0?` text-${o.color}`:"")),A=Ue(()=>{let z,s=o.name;if(s==="none"||!s)return{none:!0};if(g.iconMapFn!==null){const ee=g.iconMapFn(s);if(ee!==void 0)if(ee.icon!==void 0){if(s=ee.icon,s==="none"||!s)return{none:!0}}else return{cls:ee.cls,content:ee.content!==void 0?ee.content:" "}}if(lS.test(s)===!0){const[ee,G=Wx]=s.split("|");return{svg:!0,viewBox:G,nodes:ee.split("&&").map(te=>{const[_e,Ee,Te]=te.split("@@");return Ne("path",{style:Ee,d:_e,transform:Te})})}}if(cS.test(s)===!0)return{img:!0,src:s.substring(4)};if(uS.test(s)===!0){const[ee,G=Wx]=s.split("|");return{svguse:!0,src:ee.substring(7),viewBox:G}}let B=" ";const Z=s.match(sS);if(Z!==null)z=N0[Z[1]](s);else if(dS.test(s)===!0)z=s;else if(hS.test(s)===!0)z=`ionicons ion-${g.platform.is.ios===!0?"ios":"md"}${s.substring(3)}`;else if(Hx.test(s)===!0){z="notranslate material-symbols";const ee=s.match(Hx);ee!==null&&(s=s.substring(6),z+=$0[ee[1]]),B=s}else{z="notranslate material-icons";const ee=s.match(aS);ee!==null&&(s=s.substring(2),z+=j0[ee[1]]),B=s}return{cls:z,content:B}});return()=>{const z={class:w.value,style:v.value,"aria-hidden":"true",role:"presentation"};return A.value.none===!0?Ne(o.tag,z,tr(f.default)):A.value.img===!0?Ne("span",z,Do(f.default,[Ne("img",{src:A.value.src})])):A.value.svg===!0?Ne("span",z,Do(f.default,[Ne("svg",{viewBox:A.value.viewBox||"0 0 24 24"},A.value.nodes)])):A.value.svguse===!0?Ne("span",z,Do(f.default,[Ne("svg",{viewBox:A.value.viewBox},[Ne("use",{"xlink:href":A.value.src})])])):(A.value.cls!==void 0&&(z.class+=" "+A.value.cls),Ne(o.tag,z,Do(f.default,[A.value.content])))}}});function fS(o,f=250){let g=!1,v;return function(){return g===!1&&(g=!0,setTimeout(()=>{g=!1},f),v=o.apply(this,arguments)),v}}function Kx(o,f,g,v){g.modifiers.stop===!0&&mf(o);const w=g.modifiers.color;let A=g.modifiers.center;A=A===!0||v===!0;const z=document.createElement("span"),s=document.createElement("span"),B=Om(o),{left:Z,top:ee,width:G,height:te}=f.getBoundingClientRect(),_e=Math.sqrt(G*G+te*te),Ee=_e/2,Te=`${(G-_e)/2}px`,Be=A?Te:`${B.left-Z-Ee}px`,ot=`${(te-_e)/2}px`,Se=A?ot:`${B.top-ee-Ee}px`;s.className="q-ripple__inner",jm(s,{height:`${_e}px`,width:`${_e}px`,transform:`translate3d(${Be},${Se},0) scale3d(.2,.2,1)`,opacity:0}),z.className=`q-ripple${w?" text-"+w:""}`,z.setAttribute("dir","ltr"),z.appendChild(s),f.appendChild(z);const Je=()=>{z.remove(),clearTimeout(ct)};g.abort.push(Je);let ct=setTimeout(()=>{s.classList.add("q-ripple__inner--enter"),s.style.transform=`translate3d(${Te},${ot},0) scale3d(1,1,1)`,s.style.opacity=.2,ct=setTimeout(()=>{s.classList.remove("q-ripple__inner--enter"),s.classList.add("q-ripple__inner--leave"),s.style.opacity=0,ct=setTimeout(()=>{z.remove(),g.abort.splice(g.abort.indexOf(Je),1)},275)},250)},50)}function Yx(o,{modifiers:f,value:g,arg:v}){const w=Object.assign({},o.cfg.ripple,f,g);o.modifiers={early:w.early===!0,stop:w.stop===!0,center:w.center===!0,color:w.color||v,keyCodes:[].concat(w.keyCodes||13)}}const pS=B0({name:"ripple",beforeMount(o,f){const g=f.instance.$.appContext.config.globalProperties.$q.config||{};if(g.ripple===!1)return;const v={cfg:g,enabled:f.value!==!1,modifiers:{},abort:[],start(w){v.enabled===!0&&w.qSkipRipple!==!0&&w.type===(v.modifiers.early===!0?"pointerdown":"click")&&Kx(w,o,v,w.qKeyEvent===!0)},keystart:fS(w=>{v.enabled===!0&&w.qSkipRipple!==!0&&Vm(w,v.modifiers.keyCodes)===!0&&w.type===`key${v.modifiers.early===!0?"down":"up"}`&&Kx(w,o,v,!0)},300)};Yx(v,f),o.__qripple=v,th(v,"main",[[o,"pointerdown","start","passive"],[o,"click","start","passive"],[o,"keydown","keystart","passive"],[o,"keyup","keystart","passive"]])},updated(o,f){if(f.oldValue!==f.value){const g=o.__qripple;g!==void 0&&(g.enabled=f.value!==!1,g.enabled===!0&&Object(f.value)===f.value&&Yx(g,f))}},beforeUnmount(o){const f=o.__qripple;f!==void 0&&(f.abort.forEach(g=>{g()}),of(f,"main"),delete o._qripple)}}),q0={left:"start",center:"center",right:"end",between:"between",around:"around",evenly:"evenly",stretch:"stretch"},mS=Object.keys(q0),_S={align:{type:String,validator:o=>mS.includes(o)}};function gS(o){return Ue(()=>{const f=o.align===void 0?o.vertical===!0?"stretch":"left":o.align;return`${o.vertical===!0?"items":"justify"}-${q0[f]}`})}function Jx(o){return o?o.aliasOf?o.aliasOf.path:o.path:""}function Qx(o,f){return(o.aliasOf||o)===(f.aliasOf||f)}function yS(o,f){for(const g in f){const v=f[g],w=o[g];if(typeof v=="string"){if(v!==w)return!1}else if(Array.isArray(w)===!1||w.length!==v.length||v.some((A,z)=>A!==w[z]))return!1}return!0}function ev(o,f){return Array.isArray(f)===!0?o.length===f.length&&o.every((g,v)=>g===f[v]):o.length===1&&o[0]===f}function xS(o,f){return Array.isArray(o)===!0?ev(o,f):Array.isArray(f)===!0?ev(f,o):o===f}function vS(o,f){if(Object.keys(o).length!==Object.keys(f).length)return!1;for(const g in o)if(xS(o[g],f[g])===!1)return!1;return!0}const bS={to:[String,Object],replace:Boolean,exact:Boolean,activeClass:{type:String,default:"q-router-link--active"},exactActiveClass:{type:String,default:"q-router-link--exact-active"},href:String,target:String,disable:Boolean};function wS({fallbackTag:o,useDisableForRouterLinkProps:f=!0}={}){const g=nn(),{props:v,proxy:w,emit:A}=g,z=v_(g),s=Ue(()=>v.disable!==!0&&v.href!==void 0),B=Ue(f===!0?()=>z===!0&&v.disable!==!0&&s.value!==!0&&v.to!==void 0&&v.to!==null&&v.to!=="":()=>z===!0&&s.value!==!0&&v.to!==void 0&&v.to!==null&&v.to!==""),Z=Ue(()=>B.value===!0?Se(v.to):null),ee=Ue(()=>Z.value!==null),G=Ue(()=>s.value===!0||ee.value===!0),te=Ue(()=>v.type==="a"||G.value===!0?"a":v.tag||o||"div"),_e=Ue(()=>s.value===!0?{href:v.href,target:v.target}:ee.value===!0?{href:Z.value.href,target:v.target}:{}),Ee=Ue(()=>{if(ee.value===!1)return-1;const{matched:Ie}=Z.value,{length:Pe}=Ie,be=Ie[Pe-1];if(be===void 0)return-1;const ze=w.$route.matched;if(ze.length===0)return-1;const Qe=ze.findIndex(Qx.bind(null,be));if(Qe>-1)return Qe;const Fe=Jx(Ie[Pe-2]);return Pe>1&&Jx(be)===Fe&&ze[ze.length-1].path!==Fe?ze.findIndex(Qx.bind(null,Ie[Pe-2])):Qe}),Te=Ue(()=>ee.value===!0&&Ee.value!==-1&&yS(w.$route.params,Z.value.params)),Be=Ue(()=>Te.value===!0&&Ee.value===w.$route.matched.length-1&&vS(w.$route.params,Z.value.params)),ot=Ue(()=>ee.value===!0?Be.value===!0?` ${v.exactActiveClass} ${v.activeClass}`:v.exact===!0?"":Te.value===!0?` ${v.activeClass}`:"":"");function Se(Ie){try{return w.$router.resolve(Ie)}catch{}return null}function Je(Ie,{returnRouterError:Pe,to:be=v.to,replace:ze=v.replace}={}){if(v.disable===!0)return Ie.preventDefault(),Promise.resolve(!1);if(Ie.metaKey||Ie.altKey||Ie.ctrlKey||Ie.shiftKey||Ie.button!==void 0&&Ie.button!==0||v.target==="_blank")return Promise.resolve(!1);Ie.preventDefault();const Qe=w.$router[ze===!0?"replace":"push"](be);return Pe===!0?Qe:Qe.then(()=>{}).catch(()=>{})}function ct(Ie){if(ee.value===!0){const Pe=be=>Je(Ie,be);A("click",Ie,Pe),Ie.defaultPrevented!==!0&&Pe()}else A("click",Ie)}return{hasRouterLink:ee,hasHrefLink:s,hasLink:G,linkTag:te,resolvedLink:Z,linkIsActive:Te,linkIsExactActive:Be,linkClass:ot,linkAttrs:_e,getLink:Se,navigateToRouterLink:Je,navigateOnClick:ct}}const tv={none:0,xs:4,sm:8,md:16,lg:24,xl:32},TS={xs:8,sm:10,md:14,lg:20,xl:24},ES=["button","submit","reset"],SS=/[^\s]\/[^\s]/,CS={...g_,...bS,type:{type:String,default:"button"},label:[Number,String],icon:String,iconRight:String,round:Boolean,square:Boolean,outline:Boolean,flat:Boolean,unelevated:Boolean,rounded:Boolean,push:Boolean,glossy:Boolean,size:String,fab:Boolean,fabMini:Boolean,padding:String,color:String,textColor:String,noCaps:Boolean,noWrap:Boolean,dense:Boolean,tabindex:[Number,String],ripple:{type:[Boolean,Object],default:!0},align:{..._S.align,default:"center"},stack:Boolean,stretch:Boolean,loading:{type:Boolean,default:null},disable:Boolean};function AS(o){const f=y_(o,TS),g=gS(o),{hasRouterLink:v,hasLink:w,linkTag:A,linkAttrs:z,navigateOnClick:s}=wS({fallbackTag:"button"}),B=Ue(()=>{const Be=o.fab===!1&&o.fabMini===!1?f.value:{};return o.padding!==void 0?Object.assign({},Be,{padding:o.padding.split(/\s+/).map(ot=>ot in tv?tv[ot]+"px":ot).join(" "),minWidth:"0",minHeight:"0"}):Be}),Z=Ue(()=>o.rounded===!0||o.fab===!0||o.fabMini===!0),ee=Ue(()=>o.disable!==!0&&o.loading!==!0),G=Ue(()=>ee.value===!0?o.tabindex||0:-1),te=Ue(()=>o.flat===!0?"flat":o.outline===!0?"outline":o.push===!0?"push":o.unelevated===!0?"unelevated":"standard"),_e=Ue(()=>{const Be={tabindex:G.value};return w.value===!0?Object.assign(Be,z.value):ES.includes(o.type)===!0&&(Be.type=o.type),A.value==="a"?(o.disable===!0?Be["aria-disabled"]="true":Be.href===void 0&&(Be.role="button"),v.value!==!0&&SS.test(o.type)===!0&&(Be.type=o.type)):o.disable===!0&&(Be.disabled="",Be["aria-disabled"]="true"),o.loading===!0&&o.percentage!==void 0&&Object.assign(Be,{role:"progressbar","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":o.percentage}),Be}),Ee=Ue(()=>{let Be;o.color!==void 0?o.flat===!0||o.outline===!0?Be=`text-${o.textColor||o.color}`:Be=`bg-${o.color} text-${o.textColor||"white"}`:o.textColor&&(Be=`text-${o.textColor}`);const ot=o.round===!0?"round":`rectangle${Z.value===!0?" q-btn--rounded":o.square===!0?" q-btn--square":""}`;return`q-btn--${te.value} q-btn--${ot}`+(Be!==void 0?" "+Be:"")+(ee.value===!0?" q-btn--actionable q-focusable q-hoverable":o.disable===!0?" disabled":"")+(o.fab===!0?" q-btn--fab":o.fabMini===!0?" q-btn--fab-mini":"")+(o.noCaps===!0?" q-btn--no-uppercase":"")+(o.dense===!0?" q-btn--dense":"")+(o.stretch===!0?" no-border-radius self-stretch":"")+(o.glossy===!0?" glossy":"")+(o.square?" q-btn--square":"")}),Te=Ue(()=>g.value+(o.stack===!0?" column":" row")+(o.noWrap===!0?" no-wrap text-no-wrap":"")+(o.loading===!0?" q-btn__content--hidden":""));return{classes:Ee,style:B,innerClasses:Te,attributes:_e,hasLink:w,linkTag:A,navigateOnClick:s,isActionable:ee}}const{passiveCapture:Or}=Ro;let ec=null,tc=null,ic=null;const uc=dn({name:"QBtn",props:{...CS,percentage:Number,darkPercentage:Boolean,onTouchstart:[Function,Array]},emits:["click","keydown","mousedown","keyup"],setup(o,{slots:f,emit:g}){const{proxy:v}=nn(),{classes:w,style:A,innerClasses:z,attributes:s,hasLink:B,linkTag:Z,navigateOnClick:ee,isActionable:G}=AS(o),te=ii(null),_e=ii(null);let Ee=null,Te,Be;const ot=Ue(()=>o.label!==void 0&&o.label!==null&&o.label!==""),Se=Ue(()=>o.disable===!0||o.ripple===!1?!1:{keyCodes:B.value===!0?[13,32]:[13],...o.ripple===!0?{}:o.ripple}),Je=Ue(()=>({center:o.round})),ct=Ue(()=>{const Ke=Math.max(0,Math.min(100,o.percentage));return Ke>0?{transition:"transform 0.6s",transform:`translateX(${Ke-100}%)`}:{}}),Ie=Ue(()=>{if(o.loading===!0)return{onMousedown:Ze,onTouchstart:Ze,onClick:Ze,onKeydown:Ze,onKeyup:Ze};if(G.value===!0){const Ke={onClick:be,onKeydown:ze,onMousedown:Fe};if(v.$q.platform.has.touch===!0){const Bt=o.onTouchstart!==void 0?"":"Passive";Ke[`onTouchstart${Bt}`]=Qe}return Ke}return{onClick:ko}}),Pe=Ue(()=>({ref:te,class:"q-btn q-btn-item non-selectable no-outline "+w.value,style:A.value,...s.value,...Ie.value}));function be(Ke){if(te.value!==null){if(Ke!==void 0){if(Ke.defaultPrevented===!0)return;const Bt=document.activeElement;if(o.type==="submit"&&Bt!==document.body&&te.value.contains(Bt)===!1&&Bt.contains(te.value)===!1){te.value.focus();const Wt=()=>{document.removeEventListener("keydown",ko,!0),document.removeEventListener("keyup",Wt,Or),te.value!==null&&te.value.removeEventListener("blur",Wt,Or)};document.addEventListener("keydown",ko,!0),document.addEventListener("keyup",Wt,Or),te.value.addEventListener("blur",Wt,Or)}}ee(Ke)}}function ze(Ke){te.value!==null&&(g("keydown",Ke),Vm(Ke,[13,32])===!0&&tc!==te.value&&(tc!==null&&ft(),Ke.defaultPrevented!==!0&&(te.value.focus(),tc=te.value,te.value.classList.add("q-btn--active"),document.addEventListener("keyup",dt,!0),te.value.addEventListener("blur",dt,Or)),ko(Ke)))}function Qe(Ke){te.value!==null&&(g("touchstart",Ke),Ke.defaultPrevented!==!0&&(ec!==te.value&&(ec!==null&&ft(),ec=te.value,Ee=Ke.target,Ee.addEventListener("touchcancel",dt,Or),Ee.addEventListener("touchend",dt,Or)),Te=!0,clearTimeout(Be),Be=setTimeout(()=>{Te=!1},200)))}function Fe(Ke){te.value!==null&&(Ke.qSkipRipple=Te===!0,g("mousedown",Ke),Ke.defaultPrevented!==!0&&ic!==te.value&&(ic!==null&&ft(),ic=te.value,te.value.classList.add("q-btn--active"),document.addEventListener("mouseup",dt,Or)))}function dt(Ke){if(te.value!==null&&!(Ke!==void 0&&Ke.type==="blur"&&document.activeElement===te.value)){if(Ke!==void 0&&Ke.type==="keyup"){if(tc===te.value&&Vm(Ke,[13,32])===!0){const Bt=new MouseEvent("click",Ke);Bt.qKeyEvent=!0,Ke.defaultPrevented===!0&&Gs(Bt),Ke.cancelBubble===!0&&mf(Bt),te.value.dispatchEvent(Bt),ko(Ke),Ke.qKeyEvent=!0}g("keyup",Ke)}ft()}}function ft(Ke){const Bt=_e.value;Ke!==!0&&(ec===te.value||ic===te.value)&&Bt!==null&&Bt!==document.activeElement&&(Bt.setAttribute("tabindex",-1),Bt.focus()),ec===te.value&&(Ee!==null&&(Ee.removeEventListener("touchcancel",dt,Or),Ee.removeEventListener("touchend",dt,Or)),ec=Ee=null),ic===te.value&&(document.removeEventListener("mouseup",dt,Or),ic=null),tc===te.value&&(document.removeEventListener("keyup",dt,!0),te.value!==null&&te.value.removeEventListener("blur",dt,Or),tc=null),te.value!==null&&te.value.classList.remove("q-btn--active")}function Ze(Ke){ko(Ke),Ke.qSkipRipple=!0}return ir(()=>{ft(!0)}),Object.assign(v,{click:be}),()=>{let Ke=[];o.icon!==void 0&&Ke.push(Ne(vr,{name:o.icon,left:o.stack===!1&&ot.value===!0,role:"img","aria-hidden":"true"})),ot.value===!0&&Ke.push(Ne("span",{class:"block"},[o.label])),Ke=Do(f.default,Ke),o.iconRight!==void 0&&o.round===!1&&Ke.push(Ne(vr,{name:o.iconRight,right:o.stack===!1&&ot.value===!0,role:"img","aria-hidden":"true"}));const Bt=[Ne("span",{class:"q-focus-helper",ref:_e})];return o.loading===!0&&o.percentage!==void 0&&Bt.push(Ne("span",{class:"q-btn__progress absolute-full overflow-hidden"+(o.darkPercentage===!0?" q-btn__progress--dark":"")},[Ne("span",{class:"q-btn__progress-indicator fit block",style:ct.value})])),Bt.push(Ne("span",{class:"q-btn__content text-center col items-center q-anchor--skip "+z.value},Ke)),o.loading!==null&&Bt.push(Ne(gc,{name:"q-transition--fade"},()=>o.loading===!0?[Ne("span",{key:"loading",class:"absolute-full flex flex-center"},f.loading!==void 0?f.loading():[Ne(x_)])]:null)),d0(Ne(Z.value,Pe.value,Bt),[[pS,Se.value,void 0,Je.value]])}}}),MS=["top","right","bottom","left"],G0={type:{type:String,default:"a"},outline:Boolean,push:Boolean,flat:Boolean,unelevated:Boolean,color:String,textColor:String,glossy:Boolean,square:Boolean,padding:String,label:{type:[String,Number],default:""},labelPosition:{type:String,default:"right",validator:o=>MS.includes(o)},externalLabel:Boolean,hideLabel:{type:Boolean},labelClass:[Array,String,Object],labelStyle:[Array,String,Object],disable:Boolean,tabindex:[Number,String]};function Z0(o,f){return{formClass:Ue(()=>`q-fab--form-${o.square===!0?"square":"rounded"}`),stacked:Ue(()=>o.externalLabel===!1&&["top","bottom"].includes(o.labelPosition)),labelProps:Ue(()=>{if(o.externalLabel===!0){const g=o.hideLabel===null?f.value===!1:o.hideLabel;return{action:"push",data:{class:[o.labelClass,`q-fab__label q-tooltip--style q-fab__label--external q-fab__label--external-${o.labelPosition}`+(g===!0?" q-fab__label--external-hidden":"")],style:o.labelStyle}}}return{action:["left","top"].includes(o.labelPosition)?"unshift":"push",data:{class:[o.labelClass,`q-fab__label q-fab__label--internal q-fab__label--internal-${o.labelPosition}`+(o.hideLabel===!0?" q-fab__label--internal-hidden":"")],style:o.labelStyle}}})}}const W0={start:"self-end",center:"self-center",end:"self-start"},IS=Object.keys(W0),nc=dn({name:"QFabAction",props:{...G0,icon:{type:String,default:""},anchor:{type:String,validator:o=>IS.includes(o)},to:[String,Object],replace:Boolean},emits:["click"],setup(o,{slots:f,emit:g}){const v=Lo(L0,()=>({showing:{value:!0},onChildClick:as})),{formClass:w,labelProps:A}=Z0(o,v.showing),z=Ue(()=>{const G=W0[o.anchor];return w.value+(G!==void 0?` ${G}`:"")}),s=Ue(()=>o.disable===!0||v.showing.value!==!0);function B(G){v.onChildClick(G),g("click",G)}function Z(){const G=[];return f.icon!==void 0?G.push(f.icon()):o.icon!==""&&G.push(Ne(vr,{name:o.icon})),(o.label!==""||f.label!==void 0)&&G[A.value.action](Ne("div",A.value.data,f.label!==void 0?f.label():[o.label])),Do(f.default,G)}const ee=nn();return Object.assign(ee.proxy,{click:B}),()=>Ne(uc,{class:z.value,...o,noWrap:!0,stack:o.stacked,icon:void 0,label:void 0,noCaps:!0,fabMini:!0,disable:s.value,onClick:B},Z)}}),zS={modelValue:{type:Boolean,default:null},"onUpdate:modelValue":[Function,Array]},kS=["before-show","show","before-hide","hide"];function PS({showing:o,canShow:f,hideOnRouteChange:g,handleShow:v,handleHide:w,processOnMount:A}){const z=nn(),{props:s,emit:B,proxy:Z}=z;let ee;function G(Se){o.value===!0?Ee(Se):te(Se)}function te(Se){if(s.disable===!0||Se!==void 0&&Se.qAnchorHandled===!0||f!==void 0&&f(Se)!==!0)return;const Je=s["onUpdate:modelValue"]!==void 0;Je===!0&&(B("update:modelValue",!0),ee=Se,zr(()=>{ee===Se&&(ee=void 0)})),(s.modelValue===null||Je===!1)&&_e(Se)}function _e(Se){o.value!==!0&&(o.value=!0,B("before-show",Se),v!==void 0?v(Se):B("show",Se))}function Ee(Se){if(s.disable===!0)return;const Je=s["onUpdate:modelValue"]!==void 0;Je===!0&&(B("update:modelValue",!1),ee=Se,zr(()=>{ee===Se&&(ee=void 0)})),(s.modelValue===null||Je===!1)&&Te(Se)}function Te(Se){o.value!==!1&&(o.value=!1,B("before-hide",Se),w!==void 0?w(Se):B("hide",Se))}function Be(Se){s.disable===!0&&Se===!0?s["onUpdate:modelValue"]!==void 0&&B("update:modelValue",!1):Se===!0!==o.value&&(Se===!0?_e:Te)(ee)}di(()=>s.modelValue,Be),g!==void 0&&v_(z)===!0&&di(()=>Z.$route.fullPath,()=>{g.value===!0&&o.value===!0&&Ee()}),A===!0&&ur(()=>{Be(s.modelValue)});const ot={show:te,hide:Ee,toggle:G};return Object.assign(Z,ot),ot}let vm,Yd=0;const On=new Array(256);for(let o=0;o<256;o++)On[o]=(o+256).toString(16).substring(1);const DS=(()=>{const o=typeof crypto<"u"?crypto:typeof window<"u"?window.crypto||window.msCrypto:void 0;if(o!==void 0){if(o.randomBytes!==void 0)return o.randomBytes;if(o.getRandomValues!==void 0)return f=>{const g=new Uint8Array(f);return o.getRandomValues(g),g}}return f=>{const g=[];for(let v=f;v>0;v--)g.push(Math.floor(Math.random()*256));return g}})(),iv=4096;function X0(){(vm===void 0||Yd+16>iv)&&(Yd=0,vm=DS(iv));const o=Array.prototype.slice.call(vm,Yd,Yd+=16);return o[6]=o[6]&15|64,o[8]=o[8]&63|128,On[o[0]]+On[o[1]]+On[o[2]]+On[o[3]]+"-"+On[o[4]]+On[o[5]]+"-"+On[o[6]]+On[o[7]]+"-"+On[o[8]]+On[o[9]]+"-"+On[o[10]]+On[o[11]]+On[o[12]]+On[o[13]]+On[o[14]]+On[o[15]]}const LS=["up","right","down","left"],RS=["left","center","right"],BS=dn({name:"QFab",props:{...G0,...zS,icon:String,activeIcon:String,hideIcon:Boolean,hideLabel:{default:null},direction:{type:String,default:"right",validator:o=>LS.includes(o)},persistent:Boolean,verticalActionsAlign:{type:String,default:"center",validator:o=>RS.includes(o)}},emits:kS,setup(o,{slots:f}){const g=ii(null),v=ii(o.modelValue===!0),w=X0(),{proxy:{$q:A}}=nn(),{formClass:z,labelProps:s}=Z0(o,v),B=Ue(()=>o.persistent!==!0),{hide:Z,toggle:ee}=PS({showing:v,hideOnRouteChange:B}),G=Ue(()=>({opened:v.value})),te=Ue(()=>`q-fab z-fab row inline justify-center q-fab--align-${o.verticalActionsAlign} ${z.value}`+(v.value===!0?" q-fab--opened":" q-fab--closed")),_e=Ue(()=>`q-fab__actions flex no-wrap inline q-fab__actions--${o.direction} q-fab__actions--${v.value===!0?"opened":"closed"}`),Ee=Ue(()=>{const Se={id:w};return v.value===!0?Se.role="menu":Se["aria-hidden"]="true",Se}),Te=Ue(()=>`q-fab__icon-holder  q-fab__icon-holder--${v.value===!0?"opened":"closed"}`);function Be(Se,Je){const ct=f[Se],Ie=`q-fab__${Se} absolute-full`;return ct===void 0?Ne(vr,{class:Ie,name:o[Je]||A.iconSet.fab[Je]}):Ne("div",{class:Ie},ct(G.value))}function ot(){const Se=[];return o.hideIcon!==!0&&Se.push(Ne("div",{class:Te.value},[Be("icon","icon"),Be("active-icon","activeIcon")])),(o.label!==""||f.label!==void 0)&&Se[s.value.action](Ne("div",s.value.data,f.label!==void 0?f.label(G.value):[o.label])),Do(f.tooltip,Se)}return fh(L0,{showing:v,onChildClick(Se){Z(Se),g.value!==null&&g.value.$el.focus()}}),()=>Ne("div",{class:te.value},[Ne(uc,{ref:g,class:z.value,...o,noWrap:!0,stack:o.stacked,align:void 0,icon:void 0,label:void 0,noCaps:!0,fab:!0,"aria-expanded":v.value===!0?"true":"false","aria-haspopup":"true","aria-controls":w,"aria-owns":w,onClick:ee},ot),Ne("div",{class:_e.value,...Ee.value},tr(f.default))])}}),FS={__name:"ButtonDesplegable",emits:["handleTabSelected"],setup(o,{emit:f}){return(g,v)=>(Vn(),is(BS,{"vertical-actions-align":"left","label-position":"bottom",glossy:"",color:"black",padding:"5px",icon:"menu",direction:"down","text-color":"white","label-style":{color:"white",width:"75px"}},{default:bn(()=>[Vt(nc,{onClick:v[0]||(v[0]=w=>g.$emit("handleTabSelected","Inicio")),color:"warning",icon:"favorite",label:"Inicio","label-style":{color:"white",width:"60px",fontSize:"80%",padding:0},padding:"5px"}),Vt(nc,{onClick:v[1]||(v[1]=w=>g.$emit("handleTabSelected","Lugar")),color:"accent",icon:"room",label:"Lugar","label-style":{color:"white",width:"60px",fontSize:"80%",padding:0},padding:"5px"}),Vt(nc,{onClick:v[2]||(v[2]=w=>g.$emit("handleTabSelected","Asistencia")),color:"warning",icon:"group_add",label:"Asistencia","label-style":{color:"white",width:"60px",fontSize:"80%",padding:0},padding:"5px"}),Vt(nc,{onClick:v[3]||(v[3]=w=>g.$emit("handleTabSelected","Itinerario")),color:"accent",icon:"alarm",label:"Itinerario","label-style":{color:"white",width:"60px",fontSize:"80%",padding:0},padding:"5px"}),Vt(nc,{onClick:v[4]||(v[4]=w=>g.$emit("handleTabSelected","Regalos")),color:"warning",icon:"card_giftcard",label:"Regalos","label-style":{color:"white",width:"60px",fontSize:"80%",padding:0},padding:"5px"}),Vt(nc,{onClick:v[5]||(v[5]=w=>g.$emit("handleTabSelected","M\xFAsica")),color:"accent",icon:"music_note",label:"M\xFAsica","label-style":{color:"white",width:"60px",fontSize:"80%",padding:0},padding:"5px"})]),_:1}))}},OS="/assets/manos.293ea533.jpg",b_={dark:{type:Boolean,default:null}};function w_(o,f){return Ue(()=>o.dark===null?f.dark.isActive:o.dark)}function US({validate:o,resetValidation:f,requiresQForm:g}){const v=Lo(zE,!1);if(v!==!1){const{props:w,proxy:A}=nn();Object.assign(A,{validate:o,resetValidation:f}),di(()=>w.disable,z=>{z===!0?(typeof f=="function"&&f(),v.unbindComponent(A)):v.bindComponent(A)}),ur(()=>{w.disable!==!0&&v.bindComponent(A)}),ir(()=>{w.disable!==!0&&v.unbindComponent(A)})}else g===!0&&console.error("Parent QForm not found on useFormChild()!")}const nv=/^#[0-9a-fA-F]{3}([0-9a-fA-F]{3})?$/,rv=/^#[0-9a-fA-F]{4}([0-9a-fA-F]{4})?$/,ov=/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{4}|[0-9a-fA-F]{6}|[0-9a-fA-F]{8})$/,Jd=/^rgb\(((0|[1-9][\d]?|1[\d]{0,2}|2[\d]?|2[0-4][\d]|25[0-5]),){2}(0|[1-9][\d]?|1[\d]{0,2}|2[\d]?|2[0-4][\d]|25[0-5])\)$/,Qd=/^rgba\(((0|[1-9][\d]?|1[\d]{0,2}|2[\d]?|2[0-4][\d]|25[0-5]),){2}(0|[1-9][\d]?|1[\d]{0,2}|2[\d]?|2[0-4][\d]|25[0-5]),(0|0\.[0-9]+[1-9]|0\.[1-9]+|1)\)$/,bm={date:o=>/^-?[\d]+\/[0-1]\d\/[0-3]\d$/.test(o),time:o=>/^([0-1]?\d|2[0-3]):[0-5]\d$/.test(o),fulltime:o=>/^([0-1]?\d|2[0-3]):[0-5]\d:[0-5]\d$/.test(o),timeOrFulltime:o=>/^([0-1]?\d|2[0-3]):[0-5]\d(:[0-5]\d)?$/.test(o),email:o=>/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(o),hexColor:o=>nv.test(o),hexaColor:o=>rv.test(o),hexOrHexaColor:o=>ov.test(o),rgbColor:o=>Jd.test(o),rgbaColor:o=>Qd.test(o),rgbOrRgbaColor:o=>Jd.test(o)||Qd.test(o),hexOrRgbColor:o=>nv.test(o)||Jd.test(o),hexaOrRgbaColor:o=>rv.test(o)||Qd.test(o),anyColor:o=>ov.test(o)||Jd.test(o)||Qd.test(o)},VS=[!0,!1,"ondemand"],NS={modelValue:{},error:{type:Boolean,default:null},errorMessage:String,noErrorIcon:Boolean,rules:Array,reactiveRules:Boolean,lazyRules:{type:[Boolean,String],validator:o=>VS.includes(o)}};function jS(o,f){const{props:g,proxy:v}=nn(),w=ii(!1),A=ii(null),z=ii(null);US({validate:Ee,resetValidation:_e});let s=0,B;const Z=Ue(()=>g.rules!==void 0&&g.rules!==null&&g.rules.length>0),ee=Ue(()=>g.disable!==!0&&Z.value===!0),G=Ue(()=>g.error===!0||w.value===!0),te=Ue(()=>typeof g.errorMessage=="string"&&g.errorMessage.length>0?g.errorMessage:A.value);di(()=>g.modelValue,()=>{Te()}),di(()=>g.reactiveRules,ot=>{ot===!0?B===void 0&&(B=di(()=>g.rules,()=>{Te(!0)})):B!==void 0&&(B(),B=void 0)},{immediate:!0}),di(o,ot=>{ot===!0?z.value===null&&(z.value=!1):z.value===!1&&(z.value=!0,ee.value===!0&&g.lazyRules!=="ondemand"&&f.value===!1&&Be())});function _e(){s++,f.value=!1,z.value=null,w.value=!1,A.value=null,Be.cancel()}function Ee(ot=g.modelValue){if(ee.value!==!0)return!0;const Se=++s,Je=f.value!==!0?()=>{z.value=!0}:()=>{},ct=(Pe,be)=>{Pe===!0&&Je(),w.value=Pe,A.value=be||null,f.value=!1},Ie=[];for(let Pe=0;Pe<g.rules.length;Pe++){const be=g.rules[Pe];let ze;if(typeof be=="function"?ze=be(ot,bm):typeof be=="string"&&bm[be]!==void 0&&(ze=bm[be](ot)),ze===!1||typeof ze=="string")return ct(!0,ze),!1;ze!==!0&&ze!==void 0&&Ie.push(ze)}return Ie.length===0?(ct(!1),!0):(f.value=!0,Promise.all(Ie).then(Pe=>{if(Pe===void 0||Array.isArray(Pe)===!1||Pe.length===0)return Se===s&&ct(!1),!0;const be=Pe.find(ze=>ze===!1||typeof ze=="string");return Se===s&&ct(be!==void 0,be),be===void 0},Pe=>(Se===s&&(console.error(Pe),ct(!0)),!1)))}function Te(ot){ee.value===!0&&g.lazyRules!=="ondemand"&&(z.value===!0||g.lazyRules!==!0&&ot!==!0)&&Be()}const Be=I0(Ee,0);return ir(()=>{B!==void 0&&B(),Be.cancel()}),Object.assign(v,{resetValidation:_e,validate:Ee}),zf(v,"hasError",()=>G.value),{isDirtyModel:z,hasRules:Z,hasError:G,errorMessage:te,validate:Ee,resetValidation:_e}}const sv=/^on[A-Z]/;function $S(o,f){const g={listeners:ii({}),attributes:ii({})};function v(){const w={},A={};for(const z in o)z!=="class"&&z!=="style"&&sv.test(z)===!1&&(w[z]=o[z]);for(const z in f.props)sv.test(z)===!0&&(A[z]=f.props[z]);g.attributes.value=w,g.listeners.value=A}return u0(v),v(),g}let $m=[],qS=[];function H0(o){qS.length===0?o():$m.push(o)}function GS(o){$m=$m.filter(f=>f!==o)}function qm(o){return o===void 0?`f_${X0()}`:o}function Gm(o){return o!=null&&(""+o).length>0}const ZS={...b_,...NS,label:String,stackLabel:Boolean,hint:String,hideHint:Boolean,prefix:String,suffix:String,labelColor:String,color:String,bgColor:String,filled:Boolean,outlined:Boolean,borderless:Boolean,standout:[Boolean,String],square:Boolean,loading:Boolean,labelSlot:Boolean,bottomSlots:Boolean,hideBottomSpace:Boolean,rounded:Boolean,dense:Boolean,itemAligned:Boolean,counter:Boolean,clearable:Boolean,clearIcon:String,disable:Boolean,readonly:Boolean,autofocus:Boolean,for:String,maxlength:[Number,String]},WS=["update:modelValue","clear","focus","blur","popup-show","popup-hide"];function XS(){const{props:o,attrs:f,proxy:g,vnode:v}=nn();return{isDark:w_(o,g.$q),editable:Ue(()=>o.disable!==!0&&o.readonly!==!0),innerLoading:ii(!1),focused:ii(!1),hasPopupOpen:!1,splitAttrs:$S(f,v),targetUid:ii(qm(o.for)),rootRef:ii(null),targetRef:ii(null),controlRef:ii(null)}}function HS(o){const{props:f,emit:g,slots:v,attrs:w,proxy:A}=nn(),{$q:z}=A;let s;o.hasValue===void 0&&(o.hasValue=Ue(()=>Gm(f.modelValue))),o.emitValue===void 0&&(o.emitValue=tt=>{g("update:modelValue",tt)}),o.controlEvents===void 0&&(o.controlEvents={onFocusin:Qe,onFocusout:Fe}),Object.assign(o,{clearValue:dt,onControlFocusin:Qe,onControlFocusout:Fe,focus:be}),o.computedCounter===void 0&&(o.computedCounter=Ue(()=>{if(f.counter!==!1){const tt=typeof f.modelValue=="string"||typeof f.modelValue=="number"?(""+f.modelValue).length:Array.isArray(f.modelValue)===!0?f.modelValue.length:0,Mt=f.maxlength!==void 0?f.maxlength:f.maxValues;return tt+(Mt!==void 0?" / "+Mt:"")}}));const{isDirtyModel:B,hasRules:Z,hasError:ee,errorMessage:G,resetValidation:te}=jS(o.focused,o.innerLoading),_e=o.floatingLabel!==void 0?Ue(()=>f.stackLabel===!0||o.focused.value===!0||o.floatingLabel.value===!0):Ue(()=>f.stackLabel===!0||o.focused.value===!0||o.hasValue.value===!0),Ee=Ue(()=>f.bottomSlots===!0||f.hint!==void 0||Z.value===!0||f.counter===!0||f.error!==null),Te=Ue(()=>f.filled===!0?"filled":f.outlined===!0?"outlined":f.borderless===!0?"borderless":f.standout?"standout":"standard"),Be=Ue(()=>`q-field row no-wrap items-start q-field--${Te.value}`+(o.fieldClass!==void 0?` ${o.fieldClass.value}`:"")+(f.rounded===!0?" q-field--rounded":"")+(f.square===!0?" q-field--square":"")+(_e.value===!0?" q-field--float":"")+(Se.value===!0?" q-field--labeled":"")+(f.dense===!0?" q-field--dense":"")+(f.itemAligned===!0?" q-field--item-aligned q-item-type":"")+(o.isDark.value===!0?" q-field--dark":"")+(o.getControl===void 0?" q-field--auto-height":"")+(o.focused.value===!0?" q-field--focused":"")+(ee.value===!0?" q-field--error":"")+(ee.value===!0||o.focused.value===!0?" q-field--highlighted":"")+(f.hideBottomSpace!==!0&&Ee.value===!0?" q-field--with-bottom":"")+(f.disable===!0?" q-field--disabled":f.readonly===!0?" q-field--readonly":"")),ot=Ue(()=>"q-field__control relative-position row no-wrap"+(f.bgColor!==void 0?` bg-${f.bgColor}`:"")+(ee.value===!0?" text-negative":typeof f.standout=="string"&&f.standout.length>0&&o.focused.value===!0?` ${f.standout}`:f.color!==void 0?` text-${f.color}`:"")),Se=Ue(()=>f.labelSlot===!0||f.label!==void 0),Je=Ue(()=>"q-field__label no-pointer-events absolute ellipsis"+(f.labelColor!==void 0&&ee.value!==!0?` text-${f.labelColor}`:"")),ct=Ue(()=>({id:o.targetUid.value,editable:o.editable.value,focused:o.focused.value,floatingLabel:_e.value,modelValue:f.modelValue,emitValue:o.emitValue})),Ie=Ue(()=>{const tt={for:o.targetUid.value};return f.disable===!0?tt["aria-disabled"]="true":f.readonly===!0&&(tt["aria-readonly"]="true"),tt});di(()=>f.for,tt=>{o.targetUid.value=qm(tt)});function Pe(){const tt=document.activeElement;let Mt=o.targetRef!==void 0&&o.targetRef.value;Mt&&(tt===null||tt.id!==o.targetUid.value)&&(Mt.hasAttribute("tabindex")===!0||(Mt=Mt.querySelector("[tabindex]")),Mt&&Mt!==tt&&Mt.focus({preventScroll:!0}))}function be(){H0(Pe)}function ze(){GS(Pe);const tt=document.activeElement;tt!==null&&o.rootRef.value.contains(tt)&&tt.blur()}function Qe(tt){clearTimeout(s),o.editable.value===!0&&o.focused.value===!1&&(o.focused.value=!0,g("focus",tt))}function Fe(tt,Mt){clearTimeout(s),s=setTimeout(()=>{document.hasFocus()===!0&&(o.hasPopupOpen===!0||o.controlRef===void 0||o.controlRef.value===null||o.controlRef.value.contains(document.activeElement)!==!1)||(o.focused.value===!0&&(o.focused.value=!1,g("blur",tt)),Mt!==void 0&&Mt())})}function dt(tt){ko(tt),z.platform.is.mobile!==!0?(o.targetRef!==void 0&&o.targetRef.value||o.rootRef.value).focus():o.rootRef.value.contains(document.activeElement)===!0&&document.activeElement.blur(),f.type==="file"&&(o.inputRef.value.value=null),g("update:modelValue",null),g("clear",f.modelValue),zr(()=>{te(),z.platform.is.mobile!==!0&&(B.value=!1)})}function ft(){const tt=[];return v.prepend!==void 0&&tt.push(Ne("div",{class:"q-field__prepend q-field__marginal row no-wrap items-center",key:"prepend",onClick:Gs},v.prepend())),tt.push(Ne("div",{class:"q-field__control-container col relative-position row no-wrap q-anchor--skip"},Ze())),ee.value===!0&&f.noErrorIcon===!1&&tt.push(Bt("error",[Ne(vr,{name:z.iconSet.field.error,color:"negative"})])),f.loading===!0||o.innerLoading.value===!0?tt.push(Bt("inner-loading-append",v.loading!==void 0?v.loading():[Ne(x_,{color:f.color})])):f.clearable===!0&&o.hasValue.value===!0&&o.editable.value===!0&&tt.push(Bt("inner-clearable-append",[Ne(vr,{class:"q-field__focusable-action",tag:"button",name:f.clearIcon||z.iconSet.field.clear,tabindex:0,type:"button","aria-hidden":null,role:null,onClick:dt})])),v.append!==void 0&&tt.push(Ne("div",{class:"q-field__append q-field__marginal row no-wrap items-center",key:"append",onClick:Gs},v.append())),o.getInnerAppend!==void 0&&tt.push(Bt("inner-append",o.getInnerAppend())),o.getControlChild!==void 0&&tt.push(o.getControlChild()),tt}function Ze(){const tt=[];return f.prefix!==void 0&&f.prefix!==null&&tt.push(Ne("div",{class:"q-field__prefix no-pointer-events row items-center"},f.prefix)),o.getShadowControl!==void 0&&o.hasShadow.value===!0&&tt.push(o.getShadowControl()),o.getControl!==void 0?tt.push(o.getControl()):v.rawControl!==void 0?tt.push(v.rawControl()):v.control!==void 0&&tt.push(Ne("div",{ref:o.targetRef,class:"q-field__native row",tabindex:-1,...o.splitAttrs.attributes.value,"data-autofocus":f.autofocus===!0||void 0},v.control(ct.value))),Se.value===!0&&tt.push(Ne("div",{class:Je.value},tr(v.label,f.label))),f.suffix!==void 0&&f.suffix!==null&&tt.push(Ne("div",{class:"q-field__suffix no-pointer-events row items-center"},f.suffix)),tt.concat(tr(v.default))}function Ke(){let tt,Mt;ee.value===!0?G.value!==null?(tt=[Ne("div",{role:"alert"},G.value)],Mt=`q--slot-error-${G.value}`):(tt=tr(v.error),Mt="q--slot-error"):(f.hideHint!==!0||o.focused.value===!0)&&(f.hint!==void 0?(tt=[Ne("div",f.hint)],Mt=`q--slot-hint-${f.hint}`):(tt=tr(v.hint),Mt="q--slot-hint"));const Li=f.counter===!0||v.counter!==void 0;if(f.hideBottomSpace===!0&&Li===!1&&tt===void 0)return;const xt=Ne("div",{key:Mt,class:"q-field__messages col"},tt);return Ne("div",{class:"q-field__bottom row items-start q-field__bottom--"+(f.hideBottomSpace!==!0?"animated":"stale"),onClick:Gs},[f.hideBottomSpace===!0?xt:Ne(gc,{name:"q-transition--field-message"},()=>xt),Li===!0?Ne("div",{class:"q-field__counter"},v.counter!==void 0?v.counter():o.computedCounter.value):null])}function Bt(tt,Mt){return Mt===null?null:Ne("div",{key:tt,class:"q-field__append q-field__marginal row no-wrap items-center q-anchor--skip"},Mt)}let Wt=!1;return a0(()=>{Wt=!0}),s0(()=>{Wt===!0&&f.autofocus===!0&&A.focus()}),ur(()=>{so.value===!0&&f.for===void 0&&(o.targetUid.value=qm()),f.autofocus===!0&&A.focus()}),ir(()=>{clearTimeout(s)}),Object.assign(A,{focus:be,blur:ze}),function(){const Mt=o.getControl===void 0&&v.control===void 0?{...o.splitAttrs.attributes.value,"data-autofocus":f.autofocus===!0||void 0,...Ie.value}:Ie.value;return Ne("label",{ref:o.rootRef,class:[Be.value,w.class],style:w.style,...Mt},[v.before!==void 0?Ne("div",{class:"q-field__before q-field__marginal row no-wrap items-center",onClick:Gs},v.before()):null,Ne("div",{class:"q-field__inner relative-position col self-stretch"},[Ne("div",{ref:o.controlRef,class:ot.value,tabindex:-1,...o.controlEvents},ft()),Ee.value===!0?Ke():null]),v.after!==void 0?Ne("div",{class:"q-field__after q-field__marginal row no-wrap items-center",onClick:Gs},v.after()):null])}}const av={date:"####/##/##",datetime:"####/##/## ##:##",time:"##:##",fulltime:"##:##:##",phone:"(###) ### - ####",card:"#### #### #### ####"},yf={"#":{pattern:"[\\d]",negate:"[^\\d]"},S:{pattern:"[a-zA-Z]",negate:"[^a-zA-Z]"},N:{pattern:"[0-9a-zA-Z]",negate:"[^0-9a-zA-Z]"},A:{pattern:"[a-zA-Z]",negate:"[^a-zA-Z]",transform:o=>o.toLocaleUpperCase()},a:{pattern:"[a-zA-Z]",negate:"[^a-zA-Z]",transform:o=>o.toLocaleLowerCase()},X:{pattern:"[0-9a-zA-Z]",negate:"[^0-9a-zA-Z]",transform:o=>o.toLocaleUpperCase()},x:{pattern:"[0-9a-zA-Z]",negate:"[^0-9a-zA-Z]",transform:o=>o.toLocaleLowerCase()}},K0=Object.keys(yf);K0.forEach(o=>{yf[o].regex=new RegExp(yf[o].pattern)});const KS=new RegExp("\\\\([^.*+?^${}()|([\\]])|([.*+?^${}()|[\\]])|(["+K0.join("")+"])|(.)","g"),lv=/[.*+?^${}()|[\]\\]/g,vn=String.fromCharCode(1),YS={mask:String,reverseFillMask:Boolean,fillMask:[Boolean,String],unmaskedValue:Boolean};function JS(o,f,g,v){let w,A,z,s;const B=ii(null),Z=ii(G());function ee(){return o.autogrow===!0||["textarea","text","search","url","tel","password"].includes(o.type)}di(()=>o.type+o.autogrow,_e),di(()=>o.mask,Pe=>{if(Pe!==void 0)Ee(Z.value,!0);else{const be=ct(Z.value);_e(),o.modelValue!==be&&f("update:modelValue",be)}}),di(()=>o.fillMask+o.reverseFillMask,()=>{B.value===!0&&Ee(Z.value,!0)}),di(()=>o.unmaskedValue,()=>{B.value===!0&&Ee(Z.value)});function G(){if(_e(),B.value===!0){const Pe=Se(ct(o.modelValue));return o.fillMask!==!1?Ie(Pe):Pe}return o.modelValue}function te(Pe){if(Pe<w.length)return w.slice(-Pe);let be="",ze=w;const Qe=ze.indexOf(vn);if(Qe>-1){for(let Fe=Pe-ze.length;Fe>0;Fe--)be+=vn;ze=ze.slice(0,Qe)+be+ze.slice(Qe)}return ze}function _e(){if(B.value=o.mask!==void 0&&o.mask.length>0&&ee(),B.value===!1){s=void 0,w="",A="";return}const Pe=av[o.mask]===void 0?o.mask:av[o.mask],be=typeof o.fillMask=="string"&&o.fillMask.length>0?o.fillMask.slice(0,1):"_",ze=be.replace(lv,"\\$&"),Qe=[],Fe=[],dt=[];let ft=o.reverseFillMask===!0,Ze="",Ke="";Pe.replace(KS,(Mt,Li,xt,bi,Jt)=>{if(bi!==void 0){const _i=yf[bi];dt.push(_i),Ke=_i.negate,ft===!0&&(Fe.push("(?:"+Ke+"+)?("+_i.pattern+"+)?(?:"+Ke+"+)?("+_i.pattern+"+)?"),ft=!1),Fe.push("(?:"+Ke+"+)?("+_i.pattern+")?")}else if(xt!==void 0)Ze="\\"+(xt==="\\"?"":xt),dt.push(xt),Qe.push("([^"+Ze+"]+)?"+Ze+"?");else{const _i=Li!==void 0?Li:Jt;Ze=_i==="\\"?"\\\\\\\\":_i.replace(lv,"\\\\$&"),dt.push(_i),Qe.push("([^"+Ze+"]+)?"+Ze+"?")}});const Bt=new RegExp("^"+Qe.join("")+"("+(Ze===""?".":"[^"+Ze+"]")+"+)?["+Ze+"]*$"),Wt=Fe.length-1,tt=Fe.map((Mt,Li)=>Li===0&&o.reverseFillMask===!0?new RegExp("^"+ze+"*"+Mt):Li===Wt?new RegExp("^"+Mt+"("+(Ke===""?".":Ke)+"+)?"+(o.reverseFillMask===!0?"$":ze+"*")):new RegExp("^"+Mt));z=dt,s=Mt=>{const Li=Bt.exec(Mt);Li!==null&&(Mt=Li.slice(1).join(""));const xt=[],bi=tt.length;for(let Jt=0,_i=Mt;Jt<bi;Jt++){const kn=tt[Jt].exec(_i);if(kn===null)break;_i=_i.slice(kn.shift().length),xt.push(...kn)}return xt.length>0?xt.join(""):Mt},w=dt.map(Mt=>typeof Mt=="string"?Mt:vn).join(""),A=w.split(vn).join(be)}function Ee(Pe,be,ze){const Qe=v.value,Fe=Qe.selectionEnd,dt=Qe.value.length-Fe,ft=ct(Pe);be===!0&&_e();const Ze=Se(ft),Ke=o.fillMask!==!1?Ie(Ze):Ze,Bt=Z.value!==Ke;Qe.value!==Ke&&(Qe.value=Ke),Bt===!0&&(Z.value=Ke),document.activeElement===Qe&&zr(()=>{if(Ke===A){const tt=o.reverseFillMask===!0?A.length:0;Qe.setSelectionRange(tt,tt,"forward");return}if(ze==="insertFromPaste"&&o.reverseFillMask!==!0){const tt=Fe-1;Be.right(Qe,tt,tt);return}if(["deleteContentBackward","deleteContentForward"].indexOf(ze)>-1){const tt=o.reverseFillMask===!0?Fe===0?Ke.length>Ze.length?1:0:Math.max(0,Ke.length-(Ke===A?0:Math.min(Ze.length,dt)+1))+1:Fe;Qe.setSelectionRange(tt,tt,"forward");return}if(o.reverseFillMask===!0)if(Bt===!0){const tt=Math.max(0,Ke.length-(Ke===A?0:Math.min(Ze.length,dt+1)));tt===1&&Fe===1?Qe.setSelectionRange(tt,tt,"forward"):Be.rightReverse(Qe,tt,tt)}else{const tt=Ke.length-dt;Qe.setSelectionRange(tt,tt,"backward")}else if(Bt===!0){const tt=Math.max(0,w.indexOf(vn),Math.min(Ze.length,Fe)-1);Be.right(Qe,tt,tt)}else{const tt=Fe-1;Be.right(Qe,tt,tt)}});const Wt=o.unmaskedValue===!0?ct(Ke):Ke;String(o.modelValue)!==Wt&&g(Wt,!0)}function Te(Pe,be,ze){const Qe=Se(ct(Pe.value));be=Math.max(0,w.indexOf(vn),Math.min(Qe.length,be)),Pe.setSelectionRange(be,ze,"forward")}const Be={left(Pe,be,ze,Qe){const Fe=w.slice(be-1).indexOf(vn)===-1;let dt=Math.max(0,be-1);for(;dt>=0;dt--)if(w[dt]===vn){be=dt,Fe===!0&&be++;break}if(dt<0&&w[be]!==void 0&&w[be]!==vn)return Be.right(Pe,0,0);be>=0&&Pe.setSelectionRange(be,Qe===!0?ze:be,"backward")},right(Pe,be,ze,Qe){const Fe=Pe.value.length;let dt=Math.min(Fe,ze+1);for(;dt<=Fe;dt++)if(w[dt]===vn){ze=dt;break}else w[dt-1]===vn&&(ze=dt);if(dt>Fe&&w[ze-1]!==void 0&&w[ze-1]!==vn)return Be.left(Pe,Fe,Fe);Pe.setSelectionRange(Qe?be:ze,ze,"forward")},leftReverse(Pe,be,ze,Qe){const Fe=te(Pe.value.length);let dt=Math.max(0,be-1);for(;dt>=0;dt--)if(Fe[dt-1]===vn){be=dt;break}else if(Fe[dt]===vn&&(be=dt,dt===0))break;if(dt<0&&Fe[be]!==void 0&&Fe[be]!==vn)return Be.rightReverse(Pe,0,0);be>=0&&Pe.setSelectionRange(be,Qe===!0?ze:be,"backward")},rightReverse(Pe,be,ze,Qe){const Fe=Pe.value.length,dt=te(Fe),ft=dt.slice(0,ze+1).indexOf(vn)===-1;let Ze=Math.min(Fe,ze+1);for(;Ze<=Fe;Ze++)if(dt[Ze-1]===vn){ze=Ze,ze>0&&ft===!0&&ze--;break}if(Ze>Fe&&dt[ze-1]!==void 0&&dt[ze-1]!==vn)return Be.leftReverse(Pe,Fe,Fe);Pe.setSelectionRange(Qe===!0?be:ze,ze,"forward")}};function ot(Pe){if(P0(Pe)===!0)return;const be=v.value,ze=be.selectionStart,Qe=be.selectionEnd;if(Pe.keyCode===37||Pe.keyCode===39){const Fe=Be[(Pe.keyCode===39?"right":"left")+(o.reverseFillMask===!0?"Reverse":"")];Pe.preventDefault(),Fe(be,ze,Qe,Pe.shiftKey)}else Pe.keyCode===8&&o.reverseFillMask!==!0&&ze===Qe?Be.left(be,ze,Qe,!0):Pe.keyCode===46&&o.reverseFillMask===!0&&ze===Qe&&Be.rightReverse(be,ze,Qe,!0)}function Se(Pe){if(Pe==null||Pe==="")return"";if(o.reverseFillMask===!0)return Je(Pe);const be=z;let ze=0,Qe="";for(let Fe=0;Fe<be.length;Fe++){const dt=Pe[ze],ft=be[Fe];if(typeof ft=="string")Qe+=ft,dt===ft&&ze++;else if(dt!==void 0&&ft.regex.test(dt))Qe+=ft.transform!==void 0?ft.transform(dt):dt,ze++;else return Qe}return Qe}function Je(Pe){const be=z,ze=w.indexOf(vn);let Qe=Pe.length-1,Fe="";for(let dt=be.length-1;dt>=0&&Qe>-1;dt--){const ft=be[dt];let Ze=Pe[Qe];if(typeof ft=="string")Fe=ft+Fe,Ze===ft&&Qe--;else if(Ze!==void 0&&ft.regex.test(Ze))do Fe=(ft.transform!==void 0?ft.transform(Ze):Ze)+Fe,Qe--,Ze=Pe[Qe];while(ze===dt&&Ze!==void 0&&ft.regex.test(Ze));else return Fe}return Fe}function ct(Pe){return typeof Pe!="string"||s===void 0?typeof Pe=="number"?s(""+Pe):Pe:s(Pe)}function Ie(Pe){return A.length-Pe.length<=0?Pe:o.reverseFillMask===!0&&Pe.length>0?A.slice(0,-Pe.length)+Pe:Pe+A.slice(Pe.length)}return{innerValue:Z,hasMask:B,moveCursorForPaste:Te,updateMaskValue:Ee,onMaskedKeydown:ot}}const QS={name:String};function eC(o){return Ue(()=>o.name||o.for)}function tC(o,f){function g(){const v=o.modelValue;try{const w="DataTransfer"in window?new DataTransfer:"ClipboardEvent"in window?new ClipboardEvent("").clipboardData:void 0;return Object(v)===v&&("length"in v?Array.from(v):[v]).forEach(A=>{w.items.add(A)}),{files:w.files}}catch{return{files:void 0}}}return Ue(f===!0?()=>{if(o.type==="file")return g()}:g)}const iC=/[\u3000-\u303f\u3040-\u309f\u30a0-\u30ff\uff00-\uff9f\u4e00-\u9faf\u3400-\u4dbf]/,nC=/[\u4e00-\u9fff\u3400-\u4dbf\u{20000}-\u{2a6df}\u{2a700}-\u{2b73f}\u{2b740}-\u{2b81f}\u{2b820}-\u{2ceaf}\uf900-\ufaff\u3300-\u33ff\ufe30-\ufe4f\uf900-\ufaff\u{2f800}-\u{2fa1f}]/u,rC=/[\u3131-\u314e\u314f-\u3163\uac00-\ud7a3]/,oC=/[a-z0-9_ -]$/i;function sC(o){return function(g){if(g.type==="compositionend"||g.type==="change"){if(g.target.qComposing!==!0)return;g.target.qComposing=!1,o(g)}else g.type==="compositionupdate"&&g.target.qComposing!==!0&&typeof g.data=="string"&&(jn.is.firefox===!0?oC.test(g.data)===!1:iC.test(g.data)===!0||nC.test(g.data)===!0||rC.test(g.data)===!0)===!0&&(g.target.qComposing=!0)}}const rc=dn({name:"QInput",inheritAttrs:!1,props:{...ZS,...YS,...QS,modelValue:{required:!1},shadowText:String,type:{type:String,default:"text"},debounce:[String,Number],autogrow:Boolean,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...WS,"paste","change"],setup(o,{emit:f,attrs:g}){const{proxy:v}=nn(),{$q:w}=v,A={};let z=NaN,s,B,Z,ee;const G=ii(null),te=eC(o),{innerValue:_e,hasMask:Ee,moveCursorForPaste:Te,updateMaskValue:Be,onMaskedKeydown:ot}=JS(o,f,Ke,G),Se=tC(o,!0),Je=Ue(()=>Gm(_e.value)),ct=sC(Ze),Ie=XS(),Pe=Ue(()=>o.type==="textarea"||o.autogrow===!0),be=Ue(()=>Pe.value===!0||["text","search","url","tel","password"].includes(o.type)),ze=Ue(()=>{const xt={...Ie.splitAttrs.listeners.value,onInput:Ze,onPaste:ft,onChange:Wt,onBlur:tt,onFocus:mf};return xt.onCompositionstart=xt.onCompositionupdate=xt.onCompositionend=ct,Ee.value===!0&&(xt.onKeydown=ot),o.autogrow===!0&&(xt.onAnimationend=Bt),xt}),Qe=Ue(()=>{const xt={tabindex:0,"data-autofocus":o.autofocus===!0||void 0,rows:o.type==="textarea"?6:void 0,"aria-label":o.label,name:te.value,...Ie.splitAttrs.attributes.value,id:Ie.targetUid.value,maxlength:o.maxlength,disabled:o.disable===!0,readonly:o.readonly===!0};return Pe.value===!1&&(xt.type=o.type),o.autogrow===!0&&(xt.rows=1),xt});di(()=>o.type,()=>{G.value&&(G.value.value=o.modelValue)}),di(()=>o.modelValue,xt=>{if(Ee.value===!0){if(B===!0&&(B=!1,String(xt)===z))return;Be(xt)}else _e.value!==xt&&(_e.value=xt,o.type==="number"&&A.hasOwnProperty("value")===!0&&(s===!0?s=!1:delete A.value));o.autogrow===!0&&zr(Bt)}),di(()=>o.autogrow,xt=>{xt===!0?zr(Bt):G.value!==null&&g.rows>0&&(G.value.style.height="auto")}),di(()=>o.dense,()=>{o.autogrow===!0&&zr(Bt)});function Fe(){H0(()=>{const xt=document.activeElement;G.value!==null&&G.value!==xt&&(xt===null||xt.id!==Ie.targetUid.value)&&G.value.focus({preventScroll:!0})})}function dt(){G.value!==null&&G.value.select()}function ft(xt){if(Ee.value===!0&&o.reverseFillMask!==!0){const bi=xt.target;Te(bi,bi.selectionStart,bi.selectionEnd)}f("paste",xt)}function Ze(xt){if(!xt||!xt.target)return;if(o.type==="file"){f("update:modelValue",xt.target.files);return}const bi=xt.target.value;if(xt.target.qComposing===!0){A.value=bi;return}if(Ee.value===!0)Be(bi,!1,xt.inputType);else if(Ke(bi),be.value===!0&&xt.target===document.activeElement){const{selectionStart:Jt,selectionEnd:_i}=xt.target;Jt!==void 0&&_i!==void 0&&zr(()=>{xt.target===document.activeElement&&bi.indexOf(xt.target.value)===0&&xt.target.setSelectionRange(Jt,_i)})}o.autogrow===!0&&Bt()}function Ke(xt,bi){ee=()=>{o.type!=="number"&&A.hasOwnProperty("value")===!0&&delete A.value,o.modelValue!==xt&&z!==xt&&(z=xt,bi===!0&&(B=!0),f("update:modelValue",xt),zr(()=>{z===xt&&(z=NaN)})),ee=void 0},o.type==="number"&&(s=!0,A.value=xt),o.debounce!==void 0?(clearTimeout(Z),A.value=xt,Z=setTimeout(ee,o.debounce)):ee()}function Bt(){requestAnimationFrame(()=>{const xt=G.value;if(xt!==null){const bi=xt.parentNode.style,{overflow:Jt}=xt.style;w.platform.is.firefox!==!0&&(xt.style.overflow="hidden"),xt.style.height="1px",bi.marginBottom=xt.scrollHeight-1+"px",xt.style.height=xt.scrollHeight+"px",xt.style.overflow=Jt,bi.marginBottom=""}})}function Wt(xt){ct(xt),clearTimeout(Z),ee!==void 0&&ee(),f("change",xt.target.value)}function tt(xt){xt!==void 0&&mf(xt),clearTimeout(Z),ee!==void 0&&ee(),s=!1,B=!1,delete A.value,o.type!=="file"&&setTimeout(()=>{G.value!==null&&(G.value.value=_e.value!==void 0?_e.value:"")})}function Mt(){return A.hasOwnProperty("value")===!0?A.value:_e.value!==void 0?_e.value:""}ir(()=>{tt()}),ur(()=>{o.autogrow===!0&&Bt()}),Object.assign(Ie,{innerValue:_e,fieldClass:Ue(()=>`q-${Pe.value===!0?"textarea":"input"}`+(o.autogrow===!0?" q-textarea--autogrow":"")),hasShadow:Ue(()=>o.type!=="file"&&typeof o.shadowText=="string"&&o.shadowText.length>0),inputRef:G,emitValue:Ke,hasValue:Je,floatingLabel:Ue(()=>Je.value===!0||Gm(o.displayValue)),getControl:()=>Ne(Pe.value===!0?"textarea":"input",{ref:G,class:["q-field__native q-placeholder",o.inputClass],style:o.inputStyle,...Qe.value,...ze.value,...o.type!=="file"?{value:Mt()}:Se.value}),getShadowControl:()=>Ne("div",{class:"q-field__native q-field__shadow absolute-bottom no-pointer-events"+(Pe.value===!0?"":" text-no-wrap")},[Ne("span",{class:"invisible"},Mt()),Ne("span",o.shadowText)])});const Li=HS(Ie);return Object.assign(v,{focus:Fe,select:dt,getNativeElement:()=>G.value}),Li}}),aC=dn({name:"QAvatar",props:{...g_,fontSize:String,color:String,textColor:String,icon:String,square:Boolean,rounded:Boolean},setup(o,{slots:f}){const g=y_(o),v=Ue(()=>"q-avatar"+(o.color?` bg-${o.color}`:"")+(o.textColor?` text-${o.textColor} q-chip--colored`:"")+(o.square===!0?" q-avatar--square":o.rounded===!0?" rounded-borders":"")),w=Ue(()=>o.fontSize?{fontSize:o.fontSize}:null);return()=>{const A=o.icon!==void 0?[Ne(vr,{name:o.icon})]:void 0;return Ne("div",{class:v.value,style:g.value},[Ne("div",{class:"q-avatar__content row flex-center overflow-hidden",style:w.value},VE(f.default,A))])}}}),lC={class:"q-pa-md"},cC={class:"q-gutter-y-md column",style:{"max-width":"300px"}},uC=hn("img",{src:"https://cdn.quasar.dev/logo-v2/svg/logo.svg"},null,-1),hC={__name:"Asistencia",setup(o){const f=ii("");return(g,v)=>(Vn(),Hs("div",lC,[hn("div",cC,[Vt(rc,{color:"purple-12",modelValue:f.value,"onUpdate:modelValue":v[0]||(v[0]=w=>f.value=w),label:"Label"},{prepend:bn(()=>[Vt(vr,{name:"event"})]),_:1},8,["modelValue"]),Vt(rc,{color:"teal",filled:"",modelValue:f.value,"onUpdate:modelValue":v[1]||(v[1]=w=>f.value=w),label:"Label"},{prepend:bn(()=>[Vt(vr,{name:"event"})]),_:1},8,["modelValue"]),Vt(rc,{color:"grey-3","label-color":"orange",outlined:"",modelValue:f.value,"onUpdate:modelValue":v[2]||(v[2]=w=>f.value=w),label:"Label"},{append:bn(()=>[Vt(vr,{name:"event",color:"orange"})]),_:1},8,["modelValue"]),Vt(rc,{color:"lime-11","bg-color":"green",filled:"",modelValue:f.value,"onUpdate:modelValue":v[3]||(v[3]=w=>f.value=w),label:"Label"},{prepend:bn(()=>[Vt(vr,{name:"event"})]),_:1},8,["modelValue"]),Vt(rc,{color:"teal",outlined:"",modelValue:f.value,"onUpdate:modelValue":v[4]||(v[4]=w=>f.value=w),label:"Label"},{append:bn(()=>[Vt(aC,null,{default:bn(()=>[uC]),_:1})]),_:1},8,["modelValue"]),Vt(rc,{color:"orange",standout:"","bottom-slots":"",modelValue:f.value,"onUpdate:modelValue":v[5]||(v[5]=w=>f.value=w),label:"Label",counter:"",clearable:""},{prepend:bn(()=>[Vt(vr,{name:"place"})]),append:bn(()=>[Vt(vr,{name:"favorite"})]),hint:bn(()=>[Ya(" Field hint ")]),_:1},8,["modelValue"])])]))}},T_={left:!0,right:!0,up:!0,down:!0,horizontal:!0,vertical:!0},dC=Object.keys(T_);T_.all=!0;function cv(o){const f={};for(const g of dC)o[g]===!0&&(f[g]=!0);return Object.keys(f).length===0?T_:(f.horizontal===!0?f.left=f.right=!0:f.left===!0&&f.right===!0&&(f.horizontal=!0),f.vertical===!0?f.up=f.down=!0:f.up===!0&&f.down===!0&&(f.vertical=!0),f.horizontal===!0&&f.vertical===!0&&(f.all=!0),f)}function uv(o,f){return f.event===void 0&&o.target!==void 0&&o.target.draggable!==!0&&typeof f.handler=="function"&&o.target.nodeName.toUpperCase()!=="INPUT"&&(o.qClonedBy===void 0||o.qClonedBy.indexOf(f.uid)===-1)}function fC(){if(window.getSelection!==void 0){const o=window.getSelection();o.empty!==void 0?o.empty():o.removeAllRanges!==void 0&&(o.removeAllRanges(),pf.is.mobile!==!0&&o.addRange(document.createRange()))}else document.selection!==void 0&&document.selection.empty()}function pC(o){const f=[.06,6,50];return typeof o=="string"&&o.length&&o.split(":").forEach((g,v)=>{const w=parseFloat(g);w&&(f[v]=w)}),f}const mC=B0({name:"touch-swipe",beforeMount(o,{value:f,arg:g,modifiers:v}){if(v.mouse!==!0&&jn.has.touch!==!0)return;const w=v.mouseCapture===!0?"Capture":"",A={handler:f,sensitivity:pC(g),direction:cv(v),noop:as,mouseStart(z){uv(z,A)&&mE(z)&&(th(A,"temp",[[document,"mousemove","move",`notPassive${w}`],[document,"mouseup","end","notPassiveCapture"]]),A.start(z,!0))},touchStart(z){if(uv(z,A)){const s=z.target;th(A,"temp",[[s,"touchmove","move","notPassiveCapture"],[s,"touchcancel","end","notPassiveCapture"],[s,"touchend","end","notPassiveCapture"]]),A.start(z)}},start(z,s){jn.is.firefox===!0&&_m(o,!0);const B=Om(z);A.event={x:B.left,y:B.top,time:Date.now(),mouse:s===!0,dir:!1}},move(z){if(A.event===void 0)return;if(A.event.dir!==!1){ko(z);return}const s=Date.now()-A.event.time;if(s===0)return;const B=Om(z),Z=B.left-A.event.x,ee=Math.abs(Z),G=B.top-A.event.y,te=Math.abs(G);if(A.event.mouse!==!0){if(ee<A.sensitivity[1]&&te<A.sensitivity[1]){A.end(z);return}}else if(ee<A.sensitivity[2]&&te<A.sensitivity[2])return;const _e=ee/s,Ee=te/s;A.direction.vertical===!0&&ee<te&&ee<100&&Ee>A.sensitivity[0]&&(A.event.dir=G<0?"up":"down"),A.direction.horizontal===!0&&ee>te&&te<100&&_e>A.sensitivity[0]&&(A.event.dir=Z<0?"left":"right"),A.direction.up===!0&&ee<te&&G<0&&ee<100&&Ee>A.sensitivity[0]&&(A.event.dir="up"),A.direction.down===!0&&ee<te&&G>0&&ee<100&&Ee>A.sensitivity[0]&&(A.event.dir="down"),A.direction.left===!0&&ee>te&&Z<0&&te<100&&_e>A.sensitivity[0]&&(A.event.dir="left"),A.direction.right===!0&&ee>te&&Z>0&&te<100&&_e>A.sensitivity[0]&&(A.event.dir="right"),A.event.dir!==!1?(ko(z),A.event.mouse===!0&&(document.body.classList.add("no-pointer-events--children"),document.body.classList.add("non-selectable"),fC(),A.styleCleanup=Te=>{A.styleCleanup=void 0,document.body.classList.remove("non-selectable");const Be=()=>{document.body.classList.remove("no-pointer-events--children")};Te===!0?setTimeout(Be,50):Be()}),A.handler({evt:z,touch:A.event.mouse!==!0,mouse:A.event.mouse,direction:A.event.dir,duration:s,distance:{x:ee,y:te}})):A.end(z)},end(z){A.event!==void 0&&(of(A,"temp"),jn.is.firefox===!0&&_m(o,!1),A.styleCleanup!==void 0&&A.styleCleanup(!0),z!==void 0&&A.event.dir!==!1&&ko(z),A.event=void 0)}};if(o.__qtouchswipe=A,v.mouse===!0){const z=v.mouseCapture===!0||v.mousecapture===!0?"Capture":"";th(A,"main",[[o,"mousedown","mouseStart",`passive${z}`]])}jn.has.touch===!0&&th(A,"main",[[o,"touchstart","touchStart",`passive${v.capture===!0?"Capture":""}`],[o,"touchmove","noop","notPassiveCapture"]])},updated(o,f){const g=o.__qtouchswipe;g!==void 0&&(f.oldValue!==f.value&&(typeof f.value!="function"&&g.end(),g.handler=f.value),g.direction=cv(f.modifiers))},beforeUnmount(o){const f=o.__qtouchswipe;f!==void 0&&(of(f,"main"),of(f,"temp"),jn.is.firefox===!0&&_m(o,!1),f.styleCleanup!==void 0&&f.styleCleanup(),delete o.__qtouchswipe)}});function _C(){const o=new Map;return{getCache:function(f,g){return o[f]===void 0?o[f]=g:o[f]},getCacheWithFn:function(f,g){return o[f]===void 0?o[f]=g():o[f]}}}const gC={name:{required:!0},disable:Boolean},hv={setup(o,{slots:f}){return()=>Ne("div",{class:"q-panel scroll",role:"tabpanel"},tr(f.default))}},yC={modelValue:{required:!0},animated:Boolean,infinite:Boolean,swipeable:Boolean,vertical:Boolean,transitionPrev:String,transitionNext:String,transitionDuration:{type:[String,Number],default:300},keepAlive:Boolean,keepAliveInclude:[String,Array,RegExp],keepAliveExclude:[String,Array,RegExp],keepAliveMax:Number},xC=["update:modelValue","before-transition","transition"];function vC(){const{props:o,emit:f,proxy:g}=nn(),{getCacheWithFn:v}=_C();let w,A;const z=ii(null),s=ii(null);function B(Ze){const Ke=o.vertical===!0?"up":"left";be((g.$q.lang.rtl===!0?-1:1)*(Ze.direction===Ke?1:-1))}const Z=Ue(()=>[[mC,B,void 0,{horizontal:o.vertical!==!0,vertical:o.vertical,mouse:!0}]]),ee=Ue(()=>o.transitionPrev||`slide-${o.vertical===!0?"down":"right"}`),G=Ue(()=>o.transitionNext||`slide-${o.vertical===!0?"up":"left"}`),te=Ue(()=>`--q-transition-duration: ${o.transitionDuration}ms`),_e=Ue(()=>typeof o.modelValue=="string"||typeof o.modelValue=="number"?o.modelValue:String(o.modelValue)),Ee=Ue(()=>({include:o.keepAliveInclude,exclude:o.keepAliveExclude,max:o.keepAliveMax})),Te=Ue(()=>o.keepAliveInclude!==void 0||o.keepAliveExclude!==void 0);di(()=>o.modelValue,(Ze,Ke)=>{const Bt=Je(Ze)===!0?ct(Ze):-1;A!==!0&&Pe(Bt===-1?0:Bt<ct(Ke)?-1:1),z.value!==Bt&&(z.value=Bt,f("before-transition",Ze,Ke),zr(()=>{f("transition",Ze,Ke)}))});function Be(){be(1)}function ot(){be(-1)}function Se(Ze){f("update:modelValue",Ze)}function Je(Ze){return Ze!=null&&Ze!==""}function ct(Ze){return w.findIndex(Ke=>Ke.props.name===Ze&&Ke.props.disable!==""&&Ke.props.disable!==!0)}function Ie(){return w.filter(Ze=>Ze.props.disable!==""&&Ze.props.disable!==!0)}function Pe(Ze){const Ke=Ze!==0&&o.animated===!0&&z.value!==-1?"q-transition--"+(Ze===-1?ee.value:G.value):null;s.value!==Ke&&(s.value=Ke)}function be(Ze,Ke=z.value){let Bt=Ke+Ze;for(;Bt>-1&&Bt<w.length;){const Wt=w[Bt];if(Wt!==void 0&&Wt.props.disable!==""&&Wt.props.disable!==!0){Pe(Ze),A=!0,f("update:modelValue",Wt.props.name),setTimeout(()=>{A=!1});return}Bt+=Ze}o.infinite===!0&&w.length>0&&Ke!==-1&&Ke!==w.length&&be(Ze,Ze===-1?w.length:-1)}function ze(){const Ze=ct(o.modelValue);return z.value!==Ze&&(z.value=Ze),!0}function Qe(){const Ze=Je(o.modelValue)===!0&&ze()&&w[z.value];return o.keepAlive===!0?[Ne(QT,Ee.value,[Ne(Te.value===!0?v(_e.value,()=>({...hv,name:_e.value})):hv,{key:_e.value,style:te.value},()=>Ze)])]:[Ne("div",{class:"q-panel scroll",style:te.value,key:_e.value,role:"tabpanel"},[Ze])]}function Fe(){if(w.length!==0)return o.animated===!0?[Ne(gc,{name:s.value},Qe)]:Qe()}function dt(Ze){return w=V0(tr(Ze.default,[])).filter(Ke=>Ke.props!==null&&Ke.props.slot===void 0&&Je(Ke.props.name)===!0),w.length}function ft(){return w}return Object.assign(g,{next:Be,previous:ot,goTo:Se}),{panelIndex:z,panelDirectives:Z,updatePanelsList:dt,updatePanelIndex:ze,getPanelContent:Fe,getEnabledPanels:Ie,getPanels:ft,isValidPanelName:Je,keepAliveProps:Ee,needsUniqueKeepAliveWrapper:Te,goToPanelByOffset:be,goToPanel:Se,nextPanel:Be,previousPanel:ot}}const js=dn({name:"QCarouselSlide",props:{...gC,imgSrc:String},setup(o,{slots:f}){const g=Ue(()=>o.imgSrc?{backgroundImage:`url("${o.imgSrc}")`}:{});return()=>Ne("div",{class:"q-carousel__slide",style:g.value},tr(f.default))}});let Ku=0;const bC={fullscreen:Boolean,noRouteFullscreenExit:Boolean},wC=["update:fullscreen","fullscreen"];function TC(){const o=nn(),{props:f,emit:g,proxy:v}=o;let w,A,z;const s=ii(!1);v_(o)===!0&&di(()=>v.$route.fullPath,()=>{f.noRouteFullscreenExit!==!0&&ee()}),di(()=>f.fullscreen,G=>{s.value!==G&&B()}),di(s,G=>{g("update:fullscreen",G),g("fullscreen",G)});function B(){s.value===!0?ee():Z()}function Z(){s.value!==!0&&(s.value=!0,z=v.$el.parentNode,z.replaceChild(A,v.$el),document.body.appendChild(v.$el),Ku++,Ku===1&&document.body.classList.add("q-body--fullscreen-mixin"),w={handler:ee},Um.add(w))}function ee(){s.value===!0&&(w!==void 0&&(Um.remove(w),w=void 0),z.replaceChild(v.$el,A),s.value=!1,Ku=Math.max(0,Ku-1),Ku===0&&(document.body.classList.remove("q-body--fullscreen-mixin"),v.$el.scrollIntoView!==void 0&&setTimeout(()=>{v.$el.scrollIntoView()})))}return c0(()=>{A=document.createElement("span")}),ur(()=>{f.fullscreen===!0&&Z()}),ir(ee),Object.assign(v,{toggleFullscreen:B,setFullscreen:Z,exitFullscreen:ee}),{inFullscreen:s,toggleFullscreen:B}}const EC=["top","right","bottom","left"],SC=["regular","flat","outline","push","unelevated"],CC=dn({name:"QCarousel",props:{...b_,...yC,...bC,transitionPrev:{type:String,default:"fade"},transitionNext:{type:String,default:"fade"},height:String,padding:Boolean,controlColor:String,controlTextColor:String,controlType:{type:String,validator:o=>SC.includes(o),default:"flat"},autoplay:[Number,Boolean],arrows:Boolean,prevIcon:String,nextIcon:String,navigation:Boolean,navigationPosition:{type:String,validator:o=>EC.includes(o)},navigationIcon:String,navigationActiveIcon:String,thumbnails:Boolean},emits:[...wC,...xC],setup(o,{slots:f}){const{proxy:{$q:g}}=nn(),v=w_(o,g);let w,A;const{updatePanelsList:z,getPanelContent:s,panelDirectives:B,goToPanel:Z,previousPanel:ee,nextPanel:G,getEnabledPanels:te,panelIndex:_e}=vC(),{inFullscreen:Ee}=TC(),Te=Ue(()=>Ee.value!==!0&&o.height!==void 0?{height:o.height}:{}),Be=Ue(()=>o.vertical===!0?"vertical":"horizontal"),ot=Ue(()=>`q-carousel q-panel-parent q-carousel--with${o.padding===!0?"":"out"}-padding`+(Ee.value===!0?" fullscreen":"")+(v.value===!0?" q-carousel--dark q-dark":"")+(o.arrows===!0?` q-carousel--arrows-${Be.value}`:"")+(o.navigation===!0?` q-carousel--navigation-${Ie.value}`:"")),Se=Ue(()=>{const Fe=[o.prevIcon||g.iconSet.carousel[o.vertical===!0?"up":"left"],o.nextIcon||g.iconSet.carousel[o.vertical===!0?"down":"right"]];return o.vertical===!1&&g.lang.rtl===!0?Fe.reverse():Fe}),Je=Ue(()=>o.navigationIcon||g.iconSet.carousel.navigationIcon),ct=Ue(()=>o.navigationActiveIcon||Je.value),Ie=Ue(()=>o.navigationPosition||(o.vertical===!0?"right":"bottom")),Pe=Ue(()=>({color:o.controlColor,textColor:o.controlTextColor,round:!0,[o.controlType]:!0,dense:!0}));di(()=>o.modelValue,()=>{o.autoplay&&(clearInterval(w),be())}),di(()=>o.autoplay,Fe=>{Fe?be():clearInterval(w)});function be(){const Fe=PE(o.autoplay)===!0?o.autoplay:5e3;w=setTimeout(Fe>=0?G:ee,Math.abs(Fe))}ur(()=>{o.autoplay&&be()}),ir(()=>{clearInterval(w)});function ze(Fe,dt){return Ne("div",{class:`q-carousel__control q-carousel__navigation no-wrap absolute flex q-carousel__navigation--${Fe} q-carousel__navigation--${Ie.value}`+(o.controlColor!==void 0?` text-${o.controlColor}`:"")},[Ne("div",{class:"q-carousel__navigation-inner flex flex-center no-wrap"},te().map(dt))])}function Qe(){const Fe=[];if(o.navigation===!0){const dt=f["navigation-icon"]!==void 0?f["navigation-icon"]:Ze=>Ne(uc,{key:"nav"+Ze.name,class:`q-carousel__navigation-icon q-carousel__navigation-icon--${Ze.active===!0?"":"in"}active`,...Ze.btnProps,onClick:Ze.onClick}),ft=A-1;Fe.push(ze("buttons",(Ze,Ke)=>{const Bt=Ze.props.name,Wt=_e.value===Ke;return dt({index:Ke,maxIndex:ft,name:Bt,active:Wt,btnProps:{icon:Wt===!0?ct.value:Je.value,size:"sm",...Pe.value},onClick:()=>{Z(Bt)}})}))}else if(o.thumbnails===!0){const dt=o.controlColor!==void 0?` text-${o.controlColor}`:"";Fe.push(ze("thumbnails",ft=>{const Ze=ft.props;return Ne("img",{key:"tmb#"+Ze.name,class:`q-carousel__thumbnail q-carousel__thumbnail--${Ze.name===o.modelValue?"":"in"}active`+dt,src:Ze.imgSrc||Ze["img-src"],onClick:()=>{Z(Ze.name)}})}))}return o.arrows===!0&&_e.value>=0&&((o.infinite===!0||_e.value>0)&&Fe.push(Ne("div",{key:"prev",class:`q-carousel__control q-carousel__arrow q-carousel__prev-arrow q-carousel__prev-arrow--${Be.value} absolute flex flex-center`},[Ne(uc,{icon:Se.value[0],...Pe.value,onClick:ee})])),(o.infinite===!0||_e.value<A-1)&&Fe.push(Ne("div",{key:"next",class:`q-carousel__control q-carousel__arrow q-carousel__next-arrow q-carousel__next-arrow--${Be.value} absolute flex flex-center`},[Ne(uc,{icon:Se.value[1],...Pe.value,onClick:G})]))),Do(f.control,Fe)}return()=>(A=z(f),Ne("div",{class:ot.value,style:Te.value},[NE("div",{class:"q-carousel__slides-container"},s(),"sl-cont",o.swipeable,()=>B.value)].concat(Qe())))}}),AC="/assets/restaurante.6e2a3953.jpeg",MC="/assets/boda-ali.232ec7ae.jpeg",IC="/assets/boda-ana.8e21094f.jpeg",zC="/assets/cala.f0770073.jpeg",kC="/assets/gorra-verde.9b93d1c2.jpeg",PC="/assets/monte.3968e21c.jpeg",DC="/assets/thor.f22c0701.jpeg",LC="/assets/terrorista.3f475105.jpeg";const RC={style:{display:"flex","justify-content":"center","align-items":"center"}},BC={class:"title"},Df={__name:"Title",props:{title:{type:String,default:!1}},setup(o){return(f,g)=>(Vn(),Hs("div",RC,[hn("p",BC,Kw(o.title),1)]))}},FC=hn("div",{class:"col-12 column",style:{padding:"1rem"}},[hn("p",{class:"text-justify"},"\xA1Bienvenid@s! Despu\xE9s de vivir juntos en Madrid, pasar un confinamiento extricto, comprar una casa en Alcal\xE1 de Henares, el nacimiento de Iv\xE1n, retrasar una boda por su llegada e ir a cinco bodas de las cuales ninguna ha sido la nuestra... "),hn("p",{class:"text-justify"},[Ya("Nos complace anunciar que el pr\xF3ximo d\xEDa s\xE1bado "),hn("strong",null,[hn("u",null,"27 de Mayo de 2023")]),Ya(" celebraremos nuestro matrimonio junto a nuestros seres queridos.")])],-1),OC={__name:"Inicio",setup(o){const f=ii(1),g=ii(!0);return(v,w)=>(Vn(),Hs(xr,null,[Vt(Df,{title:"Inicio"}),FC,Vt(CC,{swipeable:"",animated:"",modelValue:f.value,"onUpdate:modelValue":w[0]||(w[0]=A=>f.value=A),thumbnails:"",autoplay:g.value,infinite:"","transition-prev":"slide-right","transition-next":"slide-left",onMouseenter:w[1]||(w[1]=A=>g.value=!1),onMouseleave:w[2]||(w[2]=A=>g.value=!0)},{default:bn(()=>[Vt(js,{name:1,"img-src":AC}),Vt(js,{name:2,"img-src":MC}),Vt(js,{name:3,"img-src":IC}),Vt(js,{name:4,"img-src":zC}),Vt(js,{name:5,"img-src":kC}),Vt(js,{name:6,"img-src":PC}),Vt(js,{name:7,"img-src":DC}),Vt(js,{name:8,"img-src":LC}),Ya(" > ")]),_:1},8,["modelValue","autoplay"])],64))}},Yu=dn({name:"QTimelineEntry",props:{heading:Boolean,tag:{type:String,default:"h3"},side:{type:String,default:"right",validator:o=>["left","right"].includes(o)},icon:String,avatar:String,color:String,title:String,subtitle:String,body:String},setup(o,{slots:f}){const g=Lo(D0,()=>{console.error("QTimelineEntry needs to be child of QTimeline")}),v=Ue(()=>`q-timeline__entry q-timeline__entry--${o.side}`+(o.icon!==void 0||o.avatar!==void 0?" q-timeline__entry--icon":"")),w=Ue(()=>`q-timeline__dot text-${o.color||g.color}`),A=Ue(()=>g.layout==="comfortable"&&g.side==="left");return()=>{const z=F0(f.default,[]);if(o.body!==void 0&&z.unshift(o.body),o.heading===!0){const Z=[Ne("div"),Ne("div"),Ne(o.tag,{class:"q-timeline__heading-title"},z)];return Ne("div",{class:"q-timeline__heading"},A.value===!0?Z.reverse():Z)}let s;o.icon!==void 0?s=[Ne(vr,{class:"row items-center justify-center",name:o.icon})]:o.avatar!==void 0&&(s=[Ne("img",{class:"q-timeline__dot-img",src:o.avatar})]);const B=[Ne("div",{class:"q-timeline__subtitle"},[Ne("span",{},tr(f.subtitle,[o.subtitle]))]),Ne("div",{class:w.value},s),Ne("div",{class:"q-timeline__content"},[Ne("h6",{class:"q-timeline__title"},tr(f.title,[o.title]))].concat(z))];return Ne("li",{class:v.value},A.value===!0?B.reverse():B)}}}),UC=dn({name:"QTimeline",props:{...b_,color:{type:String,default:"primary"},side:{type:String,default:"right",validator:o=>["left","right"].includes(o)},layout:{type:String,default:"dense",validator:o=>["dense","comfortable","loose"].includes(o)}},setup(o,{slots:f}){const g=nn(),v=w_(o,g.proxy.$q);fh(D0,o);const w=Ue(()=>`q-timeline q-timeline--${o.layout} q-timeline--${o.layout}--${o.side}`+(v.value===!0?" q-timeline--dark":""));return()=>Ne("ul",{class:w.value},tr(f.default))}}),VC={class:"col-12 column",style:{padding:"1rem"}},NC={class:"q-px-lg q-pb-md"},jC={__name:"Itinerario",setup(o){return(f,g)=>(Vn(),Hs(xr,null,[Vt(Df,{title:"Itinerario"}),hn("div",VC,[hn("div",NC,[Vt(UC,{color:"secondary"},{default:bn(()=>[Vt(Yu,{title:"Ceremonia",subtitle:"13:30H",icon:"church",body:"Un ofreciante dedicar\xE1 unas palabras. Adem\xE1s hablaran amigos y familiares de los novios.",color:"pink"}),Vt(Yu,{title:"Coctel",subtitle:"14:30H",icon:"tapas",body:"Se servir\xE1 un magn\xEDfico coctel de bienvenida, en el cual habr\xE1 comida y bebida."}),Vt(Yu,{title:"Comida",subtitle:"16:00",icon:"restaurant",color:"green",body:"Momento de disfrutar del men\xFA, cuanta con dos platos y postre."}),Vt(Yu,{title:"Fiesta",subtitle:"18:00",icon:"nightlife",body:"Ser\xE1 hora de bailar y brindar para celebrar el matrimonio.",color:"red"}),Vt(Yu,{title:"Recena",subtitle:"21:00",color:"orange",icon:"lunch_dining",body:"Una hora antes de finalizar la fiesta habr\xE1 una peque\xF1a sorpresa para cenar."})]),_:1})])])],64))}};var $C=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Y0={exports:{}};(function(o,f){(function(g,v){o.exports=v()})($C,function(){var g,v,w;function A(s,B){if(!g)g=B;else if(!v)v=B;else{var Z="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+g+")(sharedChunk); ("+v+")(sharedChunk); self.onerror = null;",ee={};g(ee),w=B(ee),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(w.workerUrl=window.URL.createObjectURL(new Blob([Z],{type:"text/javascript"})))}}A(["exports"],function(s){var B=typeof self<"u"?self:{},Z=ee;function ee(i,e,t,r){this.cx=3*i,this.bx=3*(t-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=r,this.p2x=t,this.p2y=r}ee.prototype.sampleCurveX=function(i){return((this.ax*i+this.bx)*i+this.cx)*i},ee.prototype.sampleCurveY=function(i){return((this.ay*i+this.by)*i+this.cy)*i},ee.prototype.sampleCurveDerivativeX=function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},ee.prototype.solveCurveX=function(i,e){var t,r,l,u,d;for(e===void 0&&(e=1e-6),l=i,d=0;d<8;d++){if(u=this.sampleCurveX(l)-i,Math.abs(u)<e)return l;var p=this.sampleCurveDerivativeX(l);if(Math.abs(p)<1e-6)break;l-=u/p}if((l=i)<(t=0))return t;if(l>(r=1))return r;for(;t<r;){if(u=this.sampleCurveX(l),Math.abs(u-i)<e)return l;i>u?t=l:r=l,l=.5*(r-t)+t}return l},ee.prototype.solve=function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))};var G=te;function te(i,e){this.x=i,this.y=e}te.prototype={clone:function(){return new te(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,t=i.y-this.y;return e*e+t*t},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),t=Math.sin(i),r=t*this.x+e*this.y;return this.x=e*this.x-t*this.y,this.y=r,this},_rotateAround:function(i,e){var t=Math.cos(i),r=Math.sin(i),l=e.y+r*(this.x-e.x)+t*(this.y-e.y);return this.x=e.x+t*(this.x-e.x)-r*(this.y-e.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},te.convert=function(i){return i instanceof te?i:Array.isArray(i)?new te(i[0],i[1]):i};const _e=Math.PI/180,Ee=180/Math.PI;function Te(i){return i*_e}function Be(i){return i*Ee}const ot=[[0,0],[1,0],[1,1],[0,1]];function Se(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,t=e*i;return 4*(i<.5?t:3*(i-e)+t-.75)}function Je(i,e,t,r){const l=new Z(i,e,t,r);return function(u){return l.solve(u)}}const ct=Je(.25,.1,.25,1);function Ie(i,e,t){return Math.min(t,Math.max(e,i))}function Pe(i,e,t){return(t=Ie((t-i)/(e-i),0,1))*t*(3-2*t)}function be(i,e,t){const r=t-e,l=((i-e)%r+r)%r+e;return l===e?t:l}function ze(i,e,t){if(!i.length)return t(null,[]);let r=i.length;const l=new Array(i.length);let u=null;i.forEach((d,p)=>{e(d,(y,x)=>{y&&(u=y),l[p]=x,--r==0&&t(u,l)})})}function Qe(i){const e=[];for(const t in i)e.push(i[t]);return e}function Fe(i,...e){for(const t of e)for(const r in t)i[r]=t[r];return i}let dt=1;function ft(){return dt++}function Ze(){return function i(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function Ke(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function Bt(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function Wt(i,e){i.forEach(t=>{e[t]&&(e[t]=e[t].bind(e))})}function tt(i,e){return i.indexOf(e,i.length-e.length)!==-1}function Mt(i,e,t){const r={};for(const l in i)r[l]=e.call(t||this,i[l],l,i);return r}function Li(i,e,t){const r={};for(const l in i)e.call(t||this,i[l],l,i)&&(r[l]=i[l]);return r}function xt(i){return Array.isArray(i)?i.map(xt):typeof i=="object"&&i?Mt(i,xt):i}const bi={};function Jt(i){bi[i]||(typeof console<"u"&&console.warn(i),bi[i]=!0)}function _i(i,e,t){return(t.y-i.y)*(e.x-i.x)>(e.y-i.y)*(t.x-i.x)}function kn(i){let e=0;for(let t,r,l=0,u=i.length,d=u-1;l<u;d=l++)t=i[l],r=i[d],e+=(r.x-t.x)*(t.y+r.y);return e}function Pn(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function an(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(t,r,l,u)=>{const d=l||u;return e[r]=!d||d.toLowerCase(),""}),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e}let qn=null;function jr(i){if(qn==null){const e=i.navigator?i.navigator.userAgent:null;qn=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return qn}function hr(i){try{const e=B[i];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function nr(i,e){return[i[4*e],i[4*e+1],i[4*e+2],i[4*e+3]]}const ao=B.performance;function fe(i){const e=i?i.url.toString():void 0;return ao.getEntriesByName(e)}var ye="2.10.0";let Me,it,nt,gt;const Ct={now:()=>nt!==void 0?nt:B.performance.now(),setNow(i){nt=i},restoreNow(){nt=void 0},frame(i){const e=B.requestAnimationFrame(i);return{cancel:()=>B.cancelAnimationFrame(e)}},getImageData(i,e=0){const{width:t,height:r}=i;gt||(gt=B.document.createElement("canvas"));const l=gt.getContext("2d");if(!l)throw new Error("failed to create canvas 2d context");return(t>gt.width||r>gt.height)&&(gt.width=t,gt.height=r),l.clearRect(-e,-e,t+2*e,r+2*e),l.drawImage(i,0,0,t,r),l.getImageData(-e,-e,t+2*e,r+2*e)},resolveURL:i=>(Me||(Me=B.document.createElement("a")),Me.href=i,Me.href),get devicePixelRatio(){return B.devicePixelRatio},get prefersReducedMotion(){return!!B.matchMedia&&(it==null&&(it=B.matchMedia("(prefers-reduced-motion: reduce)")),it.matches)}};let yt;const Ye={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(yt==null){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{yt=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):i}catch{yt=i}}return yt},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ht={supported:!1,testSupport:function(i){!Ot&&kt&&(Zt?si(i):Rt=i)}};let Rt,kt,Ot=!1,Zt=!1;function si(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,kt),i.isContextLost())return;ht.supported=!0}catch{}i.deleteTexture(e),Ot=!0}B.document&&(kt=B.document.createElement("img"),kt.onload=function(){Rt&&si(Rt),Rt=null,Zt=!0},kt.onerror=function(){Ot=!0,Rt=null},kt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const wi="01",ai="NO_ACCESS_TOKEN";function Ci(i){return i.indexOf("mapbox:")===0}function ln(i){return Ye.API_URL_REGEX.test(i)}const wr=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function wn(i){const e=i.match(wr);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Dn(i){const e=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${e}`}function Bo(i){if(!i)return null;const e=i.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(B.atob(e[1]).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class cn{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const t=Bo(Ye.ACCESS_TOKEN);let r="";return r=t&&t.u?B.btoa(encodeURIComponent(t.u).replace(/%([0-9A-F]{2})/g,(l,u)=>String.fromCharCode(Number("0x"+u)))):Ye.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${r}`:`mapbox.eventData:${r}`}fetchEventData(){const e=hr("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{const l=B.localStorage.getItem(t);l&&(this.eventData=JSON.parse(l));const u=B.localStorage.getItem(r);u&&(this.anonId=u)}catch{Jt("Unable to read from LocalStorage")}}saveEventData(){const e=hr("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{B.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&B.localStorage.setItem(t,JSON.stringify(this.eventData))}catch{Jt("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,t,r,l){if(!Ye.EVENTS_URL)return;const u=wn(Ye.EVENTS_URL);u.params.push(`access_token=${l||Ye.ACCESS_TOKEN||""}`);const d={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:ye,skuId:wi,userId:this.anonId},p=t?Fe(d,t):d,y={url:Dn(u),headers:{"Content-Type":"text/plain"},body:JSON.stringify([p])};this.pendingRequest=We(y,x=>{this.pendingRequest=null,r(x),this.saveEventData(),this.processRequests(l)})}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const Tn=new class extends cn{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,e){Ye.EVENTS_URL&&Ye.ACCESS_TOKEN&&Array.isArray(i)&&i.some(t=>Ci(t)||ln(t))&&this.queueRequest(Date.now(),e)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Bo(Ye.ACCESS_TOKEN),t=e?e.u:Ye.ACCESS_TOKEN;let r=t!==this.eventData.tokenU;Bt(this.anonId)||(this.anonId=Ze(),r=!0);const l=this.queue.shift();if(this.eventData.lastSuccess){const u=new Date(this.eventData.lastSuccess),d=new Date(l),p=(l-this.eventData.lastSuccess)/864e5;r=r||p>=1||p<-1||u.getDate()!==d.getDate()}else r=!0;r?this.postEvent(l,{"enabled.telemetry":!1},u=>{u||(this.eventData.lastSuccess=l,this.eventData.tokenU=t)},i):this.processRequests()}},lo=Tn.postTurnstileEvent.bind(Tn),Ks=new class extends cn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,e,t,r){this.skuToken=e,this.errorCb=r,Ye.EVENTS_URL&&(t||Ye.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},t):this.errorCb(new Error(ai)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:t}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Bt(this.anonId)||(this.anonId=Ze()),this.postEvent(t,{skuToken:this.skuToken},r=>{r?this.errorCb(r):e&&(this.success[e]=!0)},i))}},Ja=Ks.postMapLoadEvent.bind(Ks),Qa=new class extends cn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,e,t,r){if(!Ye.API_URL||!Ye.SESSION_PATH)return;const l=wn(Ye.API_URL+Ye.SESSION_PATH);l.params.push(`sku=${e||""}`),l.params.push(`access_token=${r||Ye.ACCESS_TOKEN||""}`);const u={url:Dn(l),headers:{"Content-Type":"text/plain"}};this.pendingRequest=wt(u,d=>{this.pendingRequest=null,t(d),this.saveEventData(),this.processRequests(r)})}getSessionAPI(i,e,t,r){this.skuToken=e,this.errorCb=r,Ye.SESSION_PATH&&Ye.API_URL&&(t||Ye.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},t):this.errorCb(new Error(ai)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:t}=this.queue.shift();e&&this.success[e]||this.getSession(t,this.skuToken,r=>{r?this.errorCb(r):e&&(this.success[e]=!0)},i)}},vc=Qa.getSessionAPI.bind(Qa),co=new Set;let $r,us=500,el=50,Gn={};function Ys(i){const e=F(i);let t,r;e&&e.forEach(u=>{const d=u.split("=");d[0]==="language"?t=d[1]:d[0]==="worldview"&&(r=d[1])});let l="mapbox-tiles";return t&&(l+=`-${t}`),r&&(l+=`-${r}`),l}function Y(){try{return B.caches}catch{}}function L(i){const e=Y();e&&!Gn[i]&&(Gn[i]=e.open(i))}function F(i){const e=i.indexOf("?");return e>0?i.slice(e+1).split("&"):[]}function H(i){const e=i.indexOf("?");if(e<0)return i;const t=F(i).filter(r=>{const l=r.split("=");return l[0]==="language"||l[0]==="worldview"});return t.length?`${i.slice(0,e)}?${t.join("&")}`:i.slice(0,e)}let ie=1/0;const de={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(de);class ve extends Error{constructor(e,t,r){t===401&&ln(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=r}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ge=Pn()?()=>self.worker&&self.worker.referrer:()=>(B.location.protocol==="blob:"?B.parent:B).location.href,pe=function(i,e){if(!(/^file:/.test(t=i.url)||/^file:/.test(ge())&&!/^\w+:/.test(t))){if(B.fetch&&B.Request&&B.AbortController&&B.Request.prototype.hasOwnProperty("signal"))return function(r,l){const u=new B.AbortController,d=new B.Request(r.url,{method:r.method||"GET",body:r.body,credentials:r.credentials,headers:r.headers,referrer:ge(),signal:u.signal});let p=!1,y=!1;const x=(E=d.url).indexOf("sku=")>0&&ln(E);var E;r.type==="json"&&d.headers.set("Accept","application/json");const C=(P,D,O)=>{if(y)return;if(P&&P.message!=="SecurityError"&&Jt(P),D&&O)return M(D);const V=Date.now();B.fetch(d).then(K=>{if(K.ok){const oe=x?K.clone():null;return M(K,oe,V)}return l(new ve(K.statusText,K.status,r.url))}).catch(K=>{K.code!==20&&l(new Error(K.message))})},M=(P,D,O)=>{(r.type==="arrayBuffer"?P.arrayBuffer():r.type==="json"?P.json():P.text()).then(V=>{y||(D&&O&&function(K,oe,Q){const ne=Ys(K.url);if(L(ne),!Gn[ne])return;const he={status:oe.status,statusText:oe.statusText,headers:new B.Headers};oe.headers.forEach((Ae,Oe)=>he.headers.set(Oe,Ae));const se=an(oe.headers.get("Cache-Control")||"");if(se["no-store"])return;se["max-age"]&&he.headers.set("Expires",new Date(Q+1e3*se["max-age"]).toUTCString());const ke=he.headers.get("Expires");ke&&(new Date(ke).getTime()-Q<42e4||function(Ae,Oe){if($r===void 0)try{new Response(new ReadableStream),$r=!0}catch{$r=!1}$r?Oe(Ae.body):Ae.blob().then(Oe)}(oe,Ae=>{const Oe=new B.Response(Ae,he);L(ne),Gn[ne]&&Gn[ne].then(ut=>ut.put(H(K.url),Oe)).catch(ut=>Jt(ut.message))}))}(d,D,O),p=!0,l(null,V,P.headers.get("Cache-Control"),P.headers.get("Expires")))}).catch(V=>{y||l(new Error(V.message))})};return x?function(P,D){const O=Ys(P.url);if(L(O),!Gn[O])return D(null);const V=H(P.url);Gn[O].then(K=>{K.match(V).then(oe=>{const Q=function(ne){if(!ne)return!1;const he=new Date(ne.headers.get("Expires")||0),se=an(ne.headers.get("Cache-Control")||"");return he>Date.now()&&!se["no-cache"]}(oe);K.delete(V),Q&&K.put(V,oe.clone()),D(null,oe,Q)}).catch(D)}).catch(D)}(d,C):C(null,null),{cancel:()=>{y=!0,p||u.abort()}}}(i,e);if(Pn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var t;return function(r,l){const u=new B.XMLHttpRequest;u.open(r.method||"GET",r.url,!0),r.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(const d in r.headers)u.setRequestHeader(d,r.headers[d]);return r.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=r.credentials==="include",u.onerror=()=>{l(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let d=u.response;if(r.type==="json")try{d=JSON.parse(u.response)}catch(p){return l(p)}l(null,d,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else l(new ve(u.statusText,u.status,r.url))},u.send(r.body),{cancel:()=>u.abort()}}(i,e)},we=function(i,e){return pe(Fe(i,{type:"arrayBuffer"}),e)},We=function(i,e){return pe(Fe(i,{method:"POST"}),e)},wt=function(i,e){return pe(Fe(i,{method:"GET"}),e)};function et(i){const e=B.document.createElement("a");return e.href=i,e.protocol===B.document.location.protocol&&e.host===B.document.location.host}const Ut="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Nt,Pt;Nt=[],Pt=0;const jt=function(i,e){if(ht.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),Pt>=Ye.MAX_PARALLEL_IMAGE_REQUESTS){const u={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Nt.push(u),u}Pt++;let t=!1;const r=()=>{if(!t)for(t=!0,Pt--;Nt.length&&Pt<Ye.MAX_PARALLEL_IMAGE_REQUESTS;){const u=Nt.shift(),{requestParameters:d,callback:p,cancelled:y}=u;y||(u.cancel=jt(d,p).cancel)}},l=we(i,(u,d,p,y)=>{r(),u?e(u):d&&(B.createImageBitmap?function(x,E){const C=new B.Blob([new Uint8Array(x)],{type:"image/png"});B.createImageBitmap(C).then(M=>{E(null,M)}).catch(M=>{E(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(d,(x,E)=>e(x,E,p,y)):function(x,E){const C=new B.Image,M=B.URL;C.onload=()=>{E(null,C),M.revokeObjectURL(C.src),C.onload=null,B.requestAnimationFrame(()=>{C.src=Ut})},C.onerror=()=>E(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const P=new B.Blob([new Uint8Array(x)],{type:"image/png"});C.src=x.byteLength?M.createObjectURL(P):Ut}(d,(x,E)=>e(x,E,p,y)))});return{cancel:()=>{l.cancel(),r()}}};function ei(i,e,t){t[i]&&t[i].indexOf(e)!==-1||(t[i]=t[i]||[],t[i].push(e))}function Ti(i,e,t){if(t&&t[i]){const r=t[i].indexOf(e);r!==-1&&t[i].splice(r,1)}}class zi{constructor(e,t={}){Fe(this,t),this.type=e}}class Ei extends zi{constructor(e,t={}){super("error",Fe({error:e},t))}}class Ft{on(e,t){return this._listeners=this._listeners||{},ei(e,t,this._listeners),this}off(e,t){return Ti(e,t,this._listeners),Ti(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},ei(e,t,this._oneTimeListeners),this):new Promise(r=>this.once(e,r))}fire(e,t){typeof e=="string"&&(e=new zi(e,t||{}));const r=e.type;if(this.listens(r)){e.target=this;const l=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];for(const p of l)p.call(this,e);const u=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];for(const p of u)Ti(r,p,this._oneTimeListeners),p.call(this,e);const d=this._eventedParent;d&&(Fe(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),d.fire(e))}else e instanceof Ei&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}var Re=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function rr(i,...e){for(const t of e)for(const r in t)i[r]=t[r];return i}function Ki(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function uo(i){if(Array.isArray(i))return i.map(uo);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const t in i)e[t]=uo(i[t]);return e}return Ki(i)}class tl extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}var Tr=tl;class il{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[r,l]of t)this.bindings[r]=l}concat(e){return new il(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Ff=il;const hs={kind:"null"},Tt={kind:"number"},ni={kind:"string"},ri={kind:"boolean"},Er={kind:"color"},Sr={kind:"object"},Kt={kind:"value"},Js={kind:"collator"},Qs={kind:"formatted"},ea={kind:"resolvedImage"};function or(i,e){return{kind:"array",itemType:i,N:e}}function Zi(i){if(i.kind==="array"){const e=Zi(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const gh=[hs,Tt,ni,ri,Er,Qs,Sr,or(Kt),ea];function ds(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ds(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const t of gh)if(!ds(t,e))return null}}return`Expected ${Zi(i)} but found ${Zi(e)} instead.`}function nl(i,e){return e.some(t=>t.kind===i.kind)}function ho(i,e){return e.some(t=>t==="null"?i===null:t==="array"?Array.isArray(i):t==="object"?i&&!Array.isArray(i)&&typeof i=="object":t===typeof i)}function bc(i){var e={exports:{}};return i(e,e.exports),e.exports}var fo=bc(function(i,e){var t={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(p){return(p=Math.round(p))<0?0:p>255?255:p}function l(p){return r(p[p.length-1]==="%"?parseFloat(p)/100*255:parseInt(p))}function u(p){return(y=p[p.length-1]==="%"?parseFloat(p)/100:parseFloat(p))<0?0:y>1?1:y;var y}function d(p,y,x){return x<0?x+=1:x>1&&(x-=1),6*x<1?p+(y-p)*x*6:2*x<1?y:3*x<2?p+(y-p)*(2/3-x)*6:p}try{e.parseCSSColor=function(p){var y,x=p.replace(/ /g,"").toLowerCase();if(x in t)return t[x].slice();if(x[0]==="#")return x.length===4?(y=parseInt(x.substr(1),16))>=0&&y<=4095?[(3840&y)>>4|(3840&y)>>8,240&y|(240&y)>>4,15&y|(15&y)<<4,1]:null:x.length===7&&(y=parseInt(x.substr(1),16))>=0&&y<=16777215?[(16711680&y)>>16,(65280&y)>>8,255&y,1]:null;var E=x.indexOf("("),C=x.indexOf(")");if(E!==-1&&C+1===x.length){var M=x.substr(0,E),P=x.substr(E+1,C-(E+1)).split(","),D=1;switch(M){case"rgba":if(P.length!==4)return null;D=u(P.pop());case"rgb":return P.length!==3?null:[l(P[0]),l(P[1]),l(P[2]),D];case"hsla":if(P.length!==4)return null;D=u(P.pop());case"hsl":if(P.length!==3)return null;var O=(parseFloat(P[0])%360+360)%360/360,V=u(P[1]),K=u(P[2]),oe=K<=.5?K*(V+1):K+V-K*V,Q=2*K-oe;return[r(255*d(Q,oe,O+1/3)),r(255*d(Q,oe,O)),r(255*d(Q,oe,O-1/3)),D];default:return null}}return null}}catch{}});class Ln{constructor(e,t,r,l=1){this.r=e,this.g=t,this.b=r,this.a=l}static parse(e){if(!e)return;if(e instanceof Ln)return e;if(typeof e!="string")return;const t=fo.parseCSSColor(e);return t?new Ln(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3]):void 0}toString(){const[e,t,r,l]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(r)},${l})`}toArray(){const{r:e,g:t,b:r,a:l}=this;return l===0?[0,0,0,0]:[255*e/l,255*t/l,255*r/l,l]}toArray01(){const{r:e,g:t,b:r,a:l}=this;return l===0?[0,0,0,0]:[e/l,t/l,r/l,l]}toArray01PremultipliedAlpha(){const{r:e,g:t,b:r,a:l}=this;return[e,t,r,l]}}Ln.black=new Ln(0,0,0,1),Ln.white=new Ln(1,1,1,1),Ln.transparent=new Ln(0,0,0,0),Ln.red=new Ln(1,0,0,1),Ln.blue=new Ln(0,0,1,1);var Ai=Ln;class wc{constructor(e,t,r){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ta{constructor(e,t,r,l,u){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=r,this.fontStack=l,this.textColor=u}}class Zn{constructor(e){this.sections=e}static fromString(e){return new Zn([new ta(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Zn?e:Zn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.name]);continue}e.push(t.text);const r={};t.fontStack&&(r["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(r["font-scale"]=t.scale),t.textColor&&(r["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(r)}return e}}class Wn{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Wn({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Tc(i,e,t,r){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255?r===void 0||typeof r=="number"&&r>=0&&r<=1?null:`Invalid rgba value [${[i,e,t,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof r=="number"?[i,e,t,r]:[i,e,t]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function po(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Ai||i instanceof wc||i instanceof Zn||i instanceof Wn)return!0;if(Array.isArray(i)){for(const e of i)if(!po(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!po(i[e]))return!1;return!0}return!1}function Qi(i){if(i===null)return hs;if(typeof i=="string")return ni;if(typeof i=="boolean")return ri;if(typeof i=="number")return Tt;if(i instanceof Ai)return Er;if(i instanceof wc)return Js;if(i instanceof Zn)return Qs;if(i instanceof Wn)return ea;if(Array.isArray(i)){const e=i.length;let t;for(const r of i){const l=Qi(r);if(t){if(t===l)continue;t=Kt;break}t=l}return or(t||Kt,e)}return Sr}function ia(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof Ai||i instanceof Zn||i instanceof Wn?i.toString():JSON.stringify(i)}class Ec{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(e.length!==2)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!po(e[1]))return t.error("invalid value");const r=e[1];let l=Qi(r);const u=t.expectedType;return l.kind!=="array"||l.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(l=u),new Ec(l,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ai?["rgba"].concat(this.value.toArray()):this.value instanceof Zn?this.value.serialize():this.value}}var na=Ec,fn=class{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}};const ra={string:ni,number:Tt,boolean:ri,object:Sr};class Sc{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let r,l=1;const u=e[0];if(u==="array"){let p,y;if(e.length>2){const x=e[1];if(typeof x!="string"||!(x in ra)||x==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);p=ra[x],l++}else p=Kt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);y=e[2],l++}r=or(p,y)}else r=ra[u];const d=[];for(;l<e.length;l++){const p=t.parse(e[l],l,Kt);if(!p)return null;d.push(p)}return new Sc(r,d)}evaluate(e){for(let t=0;t<this.args.length;t++){const r=this.args[t].evaluate(e);if(!ds(this.type,Qi(r)))return r;if(t===this.args.length-1)throw new fn(`Expected value to be of type ${Zi(this.type)}, but found ${Zi(Qi(r))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,t=[e.kind];if(e.kind==="array"){const r=e.itemType;if(r.kind==="string"||r.kind==="number"||r.kind==="boolean"){t.push(r.kind);const l=e.N;(typeof l=="number"||this.args.length>1)&&t.push(l)}}return t.concat(this.args.map(r=>r.serialize()))}}var dr=Sc;class oa{constructor(e){this.type=Qs,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const r=e[1];if(!Array.isArray(r)&&typeof r=="object")return t.error("First argument must be an image or text section.");const l=[];let u=!1;for(let d=1;d<=e.length-1;++d){const p=e[d];if(u&&typeof p=="object"&&!Array.isArray(p)){u=!1;let y=null;if(p["font-scale"]&&(y=t.parse(p["font-scale"],1,Tt),!y))return null;let x=null;if(p["text-font"]&&(x=t.parse(p["text-font"],1,or(ni)),!x))return null;let E=null;if(p["text-color"]&&(E=t.parse(p["text-color"],1,Er),!E))return null;const C=l[l.length-1];C.scale=y,C.font=x,C.textColor=E}else{const y=t.parse(e[d],1,Kt);if(!y)return null;const x=y.type.kind;if(x!=="string"&&x!=="value"&&x!=="null"&&x!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,l.push({content:y,scale:null,font:null,textColor:null})}}return new oa(l)}evaluate(e){return new Zn(this.sections.map(t=>{const r=t.content.evaluate(e);return Qi(r)===ea?new ta("",r,null,null,null):new ta(ia(r),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const r={};t.scale&&(r["font-scale"]=t.scale.serialize()),t.font&&(r["text-font"]=t.font.serialize()),t.textColor&&(r["text-color"]=t.textColor.serialize()),e.push(r)}return e}}class rl{constructor(e){this.type=ea,this.input=e}static parse(e,t){if(e.length!==2)return t.error("Expected two arguments.");const r=t.parse(e[1],1,ni);return r?new rl(r):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),r=Wn.fromString(t);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(t)>-1),r}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Of={"to-boolean":ri,"to-color":Er,"to-number":Tt,"to-string":ni};class Cc{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const r=e[0];if((r==="to-boolean"||r==="to-string")&&e.length!==2)return t.error("Expected one argument.");const l=Of[r],u=[];for(let d=1;d<e.length;d++){const p=t.parse(e[d],d,Kt);if(!p)return null;u.push(p)}return new Cc(l,u)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let t,r;for(const l of this.args){if(t=l.evaluate(e),r=null,t instanceof Ai)return t;if(typeof t=="string"){const u=e.parseColor(t);if(u)return u}else if(Array.isArray(t)&&(r=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:Tc(t[0],t[1],t[2],t[3]),!r))return new Ai(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new fn(r||`Could not parse color from value '${typeof t=="string"?t:String(JSON.stringify(t))}'`)}if(this.type.kind==="number"){let t=null;for(const r of this.args){if(t=r.evaluate(e),t===null)return 0;const l=Number(t);if(!isNaN(l))return l}throw new fn(`Could not convert ${JSON.stringify(t)} to number.`)}return this.type.kind==="formatted"?Zn.fromString(ia(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Wn.fromString(ia(this.args[0].evaluate(e))):ia(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new oa([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new rl(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(t=>{e.push(t.serialize())}),e}}var fs=Cc;const Uf=["Unknown","Point","LineString","Polygon"];var yh=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Uf[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const i=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:t,y:r}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(t*e-i[0])+this.featureDistanceData.bearing[1]*(r*e-i[1])}return 0}parseColor(i){let e=this._parseColorCache[i];return e||(e=this._parseColorCache[i]=Ai.parse(i)),e}};class Fo{constructor(e,t,r,l){this.name=e,this.type=t,this._evaluate=r,this.args=l}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,t){const r=e[0],l=Fo.definitions[r];if(!l)return t.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const u=Array.isArray(l)?l[0]:l.type,d=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,p=d.filter(([x])=>!Array.isArray(x)||x.length===e.length-1);let y=null;for(const[x,E]of p){y=new Uo(t.registry,t.path,null,t.scope);const C=[];let M=!1;for(let P=1;P<e.length;P++){const D=e[P],O=Array.isArray(x)?x[P-1]:x.type,V=y.parse(D,1+C.length,O);if(!V){M=!0;break}C.push(V)}if(!M)if(Array.isArray(x)&&x.length!==C.length)y.error(`Expected ${x.length} arguments, but found ${C.length} instead.`);else{for(let P=0;P<C.length;P++){const D=Array.isArray(x)?x[P]:x.type,O=C[P];y.concat(P+1).checkSubtype(D,O.type)}if(y.errors.length===0)return new Fo(r,u,E,C)}}if(p.length===1)t.errors.push(...y.errors);else{const x=(p.length?p:d).map(([C])=>{return M=C,Array.isArray(M)?`(${M.map(Zi).join(", ")})`:`(${Zi(M.type)}...)`;var M}).join(" | "),E=[];for(let C=1;C<e.length;C++){const M=t.parse(e[C],1+E.length);if(!M)return null;E.push(Zi(M.type))}t.error(`Expected arguments of type ${x}, but found (${E.join(", ")}) instead.`)}return null}static register(e,t){Fo.definitions=t;for(const r in t)e[r]=Fo}}var Cr=Fo;class ol{constructor(e,t,r){this.type=Js,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(e.length!==2)return t.error("Expected one argument.");const r=e[1];if(typeof r!="object"||Array.isArray(r))return t.error("Collator options argument must be an object.");const l=t.parse(r["case-sensitive"]!==void 0&&r["case-sensitive"],1,ri);if(!l)return null;const u=t.parse(r["diacritic-sensitive"]!==void 0&&r["diacritic-sensitive"],1,ri);if(!u)return null;let d=null;return r.locale&&(d=t.parse(r.locale,1,ni),!d)?null:new ol(l,u,d)}evaluate(e){return new wc(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const mo=8192;function Ac(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function sl(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function Vf(i,e){const t=(180+i[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(t*l*mo),Math.round(r*l*mo)]}function Nf(i,e,t){const r=i[0]-e[0],l=i[1]-e[1],u=i[0]-t[0],d=i[1]-t[1];return r*d-u*l==0&&r*u<=0&&l*d<=0}function al(i,e){let t=!1;for(let d=0,p=e.length;d<p;d++){const y=e[d];for(let x=0,E=y.length;x<E-1;x++){if(Nf(i,y[x],y[x+1]))return!1;(l=y[x])[1]>(r=i)[1]!=(u=y[x+1])[1]>r[1]&&r[0]<(u[0]-l[0])*(r[1]-l[1])/(u[1]-l[1])+l[0]&&(t=!t)}}var r,l,u;return t}function ll(i,e){for(let t=0;t<e.length;t++)if(al(i,e[t]))return!0;return!1}function xh(i,e,t,r){const l=r[0]-t[0],u=r[1]-t[1],d=(i[0]-t[0])*u-l*(i[1]-t[1]),p=(e[0]-t[0])*u-l*(e[1]-t[1]);return d>0&&p<0||d<0&&p>0}function jf(i,e,t){for(const x of t)for(let E=0;E<x.length-1;++E)if((p=[(d=x[E+1])[0]-(u=x[E])[0],d[1]-u[1]])[0]*(y=[(l=e)[0]-(r=i)[0],l[1]-r[1]])[1]-p[1]*y[0]!=0&&xh(r,l,u,d)&&xh(u,d,r,l))return!0;var r,l,u,d,p,y;return!1}function vh(i,e){for(let t=0;t<i.length;++t)if(!al(i[t],e))return!1;for(let t=0;t<i.length-1;++t)if(jf(i[t],i[t+1],e))return!1;return!0}function $f(i,e){for(let t=0;t<e.length;t++)if(vh(i,e[t]))return!0;return!1}function fr(i,e,t){const r=[];for(let l=0;l<i.length;l++){const u=[];for(let d=0;d<i[l].length;d++){const p=Vf(i[l][d],t);Ac(e,p),u.push(p)}r.push(u)}return r}function Mc(i,e,t){const r=[];for(let l=0;l<i.length;l++){const u=fr(i[l],e,t);r.push(u)}return r}function Ic(i,e,t,r){if(i[0]<t[0]||i[0]>t[2]){const l=.5*r;let u=i[0]-t[0]>l?-r:t[0]-i[0]>l?r:0;u===0&&(u=i[0]-t[2]>l?-r:t[2]-i[0]>l?r:0),i[0]+=u}Ac(e,i)}function zc(i,e,t,r){const l=Math.pow(2,r.z)*mo,u=[r.x*mo,r.y*mo],d=[];if(!i)return d;for(const p of i)for(const y of p){const x=[y.x+u[0],y.y+u[1]];Ic(x,e,t,l),d.push(x)}return d}function kc(i,e,t,r){const l=Math.pow(2,r.z)*mo,u=[r.x*mo,r.y*mo],d=[];if(!i)return d;for(const y of i){const x=[];for(const E of y){const C=[E.x+u[0],E.y+u[1]];Ac(e,C),x.push(C)}d.push(x)}if(e[2]-e[0]<=l/2){(p=e)[0]=p[1]=1/0,p[2]=p[3]=-1/0;for(const y of d)for(const x of y)Ic(x,e,t,l)}var p;return d}class ps{constructor(e,t){this.type=ri,this.geojson=e,this.geometries=t}static parse(e,t){if(e.length!==2)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(po(e[1])){const r=e[1];if(r.type==="FeatureCollection")for(let l=0;l<r.features.length;++l){const u=r.features[l].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new ps(r,r.features[l].geometry)}else if(r.type==="Feature"){const l=r.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new ps(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new ps(r,r)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(t,r){const l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],d=t.canonicalID();if(!d)return!1;if(r.type==="Polygon"){const p=fr(r.coordinates,u,d),y=zc(t.geometry(),l,u,d);if(!sl(l,u))return!1;for(const x of y)if(!al(x,p))return!1}if(r.type==="MultiPolygon"){const p=Mc(r.coordinates,u,d),y=zc(t.geometry(),l,u,d);if(!sl(l,u))return!1;for(const x of y)if(!ll(x,p))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(t,r){const l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],d=t.canonicalID();if(!d)return!1;if(r.type==="Polygon"){const p=fr(r.coordinates,u,d),y=kc(t.geometry(),l,u,d);if(!sl(l,u))return!1;for(const x of y)if(!vh(x,p))return!1}if(r.type==="MultiPolygon"){const p=Mc(r.coordinates,u,d),y=kc(t.geometry(),l,u,d);if(!sl(l,u))return!1;for(const x of y)if(!$f(x,p))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var cl=ps;function Oo(i){if(i instanceof Cr&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof cl)return!1;let e=!0;return i.eachChild(t=>{e&&!Oo(t)&&(e=!1)}),e}function _o(i){if(i instanceof Cr&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(t=>{e&&!_o(t)&&(e=!1)}),e}function sa(i,e){if(i instanceof Cr&&e.indexOf(i.name)>=0)return!1;let t=!0;return i.eachChild(r=>{t&&!sa(r,e)&&(t=!1)}),t}class ul{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");const r=e[1];return t.scope.has(r)?new ul(r,t.scope.get(r)):t.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var hl=ul;class dl{constructor(e,t=[],r,l=new Ff,u=[]){this.registry=e,this.path=t,this.key=t.map(d=>`[${d}]`).join(""),this.scope=l,this.errors=u,this.expectedType=r}parse(e,t,r,l,u={}){return t?this.concat(t,r,l)._parse(e,u):this._parse(e,u)}_parse(e,t){function r(l,u,d){return d==="assert"?new dr(u,[l]):d==="coerce"?new fs(u,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=e[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const u=this.registry[l];if(u){let d=u.parse(e,this);if(!d)return null;if(this.expectedType){const p=this.expectedType,y=d.type;if(p.kind!=="string"&&p.kind!=="number"&&p.kind!=="boolean"&&p.kind!=="object"&&p.kind!=="array"||y.kind!=="value")if(p.kind!=="color"&&p.kind!=="formatted"&&p.kind!=="resolvedImage"||y.kind!=="value"&&y.kind!=="string"){if(this.checkSubtype(p,y))return null}else d=r(d,p,t.typeAnnotation||"coerce");else d=r(d,p,t.typeAnnotation||"assert")}if(!(d instanceof na)&&d.type.kind!=="resolvedImage"&&gi(d)){const p=new yh;try{d=new na(d.type,d.evaluate(p))}catch(y){return this.error(y.message),null}}return d}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,r){const l=typeof e=="number"?this.path.concat(e):this.path,u=r?this.scope.concat(r):this.scope;return new dl(this.registry,l,t||null,u,this.errors)}error(e,...t){const r=`${this.key}${t.map(l=>`[${l}]`).join("")}`;this.errors.push(new Tr(r,e))}checkSubtype(e,t){const r=ds(e,t);return r&&this.error(r),r}}var Uo=dl;function gi(i){if(i instanceof hl)return gi(i.boundExpression);if(i instanceof Cr&&i.name==="error"||i instanceof ol||i instanceof cl)return!1;const e=i instanceof fs||i instanceof dr;let t=!0;return i.eachChild(r=>{t=e?t&&gi(r):t&&r instanceof na}),!!t&&Oo(i)&&sa(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function fl(i,e){const t=i.length-1;let r,l,u=0,d=t,p=0;for(;u<=d;)if(p=Math.floor((u+d)/2),r=i[p],l=i[p+1],r<=e){if(p===t||e<l)return p;u=p+1}else{if(!(r>e))throw new fn("Input is not a number.");d=p-1}return 0}class Pc{constructor(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[l,u]of r)this.labels.push(l),this.outputs.push(u)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const r=t.parse(e[1],1,Tt);if(!r)return null;const l=[];let u=null;t.expectedType&&t.expectedType.kind!=="value"&&(u=t.expectedType);for(let d=1;d<e.length;d+=2){const p=d===1?-1/0:e[d],y=e[d+1],x=d,E=d+1;if(typeof p!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',x);if(l.length&&l[l.length-1][0]>=p)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',x);const C=t.parse(y,E,u);if(!C)return null;u=u||C.type,l.push([p,C])}return new Pc(u,r,l)}evaluate(e){const t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);const l=this.input.evaluate(e);if(l<=t[0])return r[0].evaluate(e);const u=t.length;return l>=t[u-1]?r[u-1].evaluate(e):r[fl(t,l)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var Dc=Pc;function fi(i,e,t){return i*(1-t)+e*t}function ms(i,e,t){return i.map((r,l)=>fi(r,e[l],t))}var aa=Object.freeze({__proto__:null,number:fi,color:function(i,e,t){return new Ai(fi(i.r,e.r,t),fi(i.g,e.g,t),fi(i.b,e.b,t),fi(i.a,e.a,t))},array:ms});const Lc=.95047,Rc=1.08883,Bc=4/29,go=6/29,la=3*go*go,qf=Math.PI/180,Fc=180/Math.PI;function pl(i){return i>.008856451679035631?Math.pow(i,1/3):i/la+Bc}function Oc(i){return i>go?i*i*i:la*(i-Bc)}function Uc(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function ml(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function bh(i){const e=ml(i.r),t=ml(i.g),r=ml(i.b),l=pl((.4124564*e+.3575761*t+.1804375*r)/Lc),u=pl((.2126729*e+.7151522*t+.072175*r)/1);return{l:116*u-16,a:500*(l-u),b:200*(u-pl((.0193339*e+.119192*t+.9503041*r)/Rc)),alpha:i.a}}function Vc(i){let e=(i.l+16)/116,t=isNaN(i.a)?e:e+i.a/500,r=isNaN(i.b)?e:e-i.b/200;return e=1*Oc(e),t=Lc*Oc(t),r=Rc*Oc(r),new Ai(Uc(3.2404542*t-1.5371385*e-.4985314*r),Uc(-.969266*t+1.8760108*e+.041556*r),Uc(.0556434*t-.2040259*e+1.0572252*r),i.alpha)}function wh(i,e,t){const r=e-i;return i+t*(r>180||r<-180?r-360*Math.round(r/360):r)}const ca={forward:bh,reverse:Vc,interpolate:function(i,e,t){return{l:fi(i.l,e.l,t),a:fi(i.a,e.a,t),b:fi(i.b,e.b,t),alpha:fi(i.alpha,e.alpha,t)}}},_s={forward:function(i){const{l:e,a:t,b:r}=bh(i),l=Math.atan2(r,t)*Fc;return{h:l<0?l+360:l,c:Math.sqrt(t*t+r*r),l:e,alpha:i.a}},reverse:function(i){const e=i.h*qf,t=i.c;return Vc({l:i.l,a:Math.cos(e)*t,b:Math.sin(e)*t,alpha:i.alpha})},interpolate:function(i,e,t){return{h:wh(i.h,e.h,t),c:fi(i.c,e.c,t),l:fi(i.l,e.l,t),alpha:fi(i.alpha,e.alpha,t)}}};var Th=Object.freeze({__proto__:null,lab:ca,hcl:_s});class ua{constructor(e,t,r,l,u){this.type=e,this.operator=t,this.interpolation=r,this.input=l,this.labels=[],this.outputs=[];for(const[d,p]of u)this.labels.push(d),this.outputs.push(p)}static interpolationFactor(e,t,r,l){let u=0;if(e.name==="exponential")u=_l(t,e.base,r,l);else if(e.name==="linear")u=_l(t,1,r,l);else if(e.name==="cubic-bezier"){const d=e.controlPoints;u=new Z(d[0],d[1],d[2],d[3]).solve(_l(t,1,r,l))}return u}static parse(e,t){let[r,l,u,...d]=e;if(!Array.isArray(l)||l.length===0)return t.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const x=l[1];if(typeof x!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:x}}else{if(l[0]!=="cubic-bezier")return t.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const x=l.slice(1);if(x.length!==4||x.some(E=>typeof E!="number"||E<0||E>1))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:x}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(u=t.parse(u,2,Tt),!u)return null;const p=[];let y=null;r==="interpolate-hcl"||r==="interpolate-lab"?y=Er:t.expectedType&&t.expectedType.kind!=="value"&&(y=t.expectedType);for(let x=0;x<d.length;x+=2){const E=d[x],C=d[x+1],M=x+3,P=x+4;if(typeof E!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(p.length&&p[p.length-1][0]>=E)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const D=t.parse(C,P,y);if(!D)return null;y=y||D.type,p.push([E,D])}return y.kind==="number"||y.kind==="color"||y.kind==="array"&&y.itemType.kind==="number"&&typeof y.N=="number"?new ua(y,r,l,u,p):t.error(`Type ${Zi(y)} is not interpolatable.`)}evaluate(e){const t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);const l=this.input.evaluate(e);if(l<=t[0])return r[0].evaluate(e);const u=t.length;if(l>=t[u-1])return r[u-1].evaluate(e);const d=fl(t,l),p=ua.interpolationFactor(this.interpolation,l,t[d],t[d+1]),y=r[d].evaluate(e),x=r[d+1].evaluate(e);return this.operator==="interpolate"?aa[this.type.kind.toLowerCase()](y,x,p):this.operator==="interpolate-hcl"?_s.reverse(_s.interpolate(_s.forward(y),_s.forward(x),p)):ca.reverse(ca.interpolate(ca.forward(y),ca.forward(x),p))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let r=0;r<this.labels.length;r++)t.push(this.labels[r],this.outputs[r].serialize());return t}}function _l(i,e,t,r){const l=r-t,u=i-t;return l===0?0:e===1?u/l:(Math.pow(e,u)-1)/(Math.pow(e,l)-1)}var Pr=ua;class Nc{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let r=null;const l=t.expectedType;l&&l.kind!=="value"&&(r=l);const u=[];for(const p of e.slice(1)){const y=t.parse(p,1+u.length,r,void 0,{typeAnnotation:"omit"});if(!y)return null;r=r||y.type,u.push(y)}const d=l&&u.some(p=>ds(l,p.type));return new Nc(d?Kt:r,u)}evaluate(e){let t,r=null,l=0;for(const u of this.args){if(l++,r=u.evaluate(e),r&&r instanceof Wn&&!r.available&&(t||(t=r),r=null,l===this.args.length))return t;if(r!==null)break}return r}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var Eh=Nc;class jc{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const r=[];for(let u=1;u<e.length-1;u+=2){const d=e[u];if(typeof d!="string")return t.error(`Expected string, but found ${typeof d} instead.`,u);if(/[^a-zA-Z0-9_]/.test(d))return t.error("Variable names must contain only alphanumeric characters or '_'.",u);const p=t.parse(e[u+1],u+1);if(!p)return null;r.push([d,p])}const l=t.parse(e[e.length-1],e.length-1,t.expectedType,r);return l?new jc(r,l):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,r]of this.bindings)e.push(t,r.serialize());return e.push(this.result.serialize()),e}}var Sh=jc;class $c{constructor(e,t,r){this.type=e,this.index=t,this.input=r}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,Tt),l=t.parse(e[2],2,or(t.expectedType||Kt));return r&&l?new $c(l.type.itemType,r,l):null}evaluate(e){const t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new fn(`Array index out of bounds: ${t} < 0.`);if(t>=r.length)throw new fn(`Array index out of bounds: ${t} > ${r.length-1}.`);if(t!==Math.floor(t))throw new fn(`Array index must be an integer, but found ${t} instead.`);return r[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Ch=$c;class qc{constructor(e,t){this.type=ri,this.needle=e,this.haystack=t}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,Kt),l=t.parse(e[2],2,Kt);return r&&l?nl(r.type,[ri,ni,Tt,hs,Kt])?new qc(r,l):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Zi(r.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(r==null)return!1;if(!ho(t,["boolean","string","number","null"]))throw new fn(`Expected first argument to be of type boolean, string, number or null, but found ${Zi(Qi(t))} instead.`);if(!ho(r,["string","array"]))throw new fn(`Expected second argument to be of type array or string, but found ${Zi(Qi(r))} instead.`);return r.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Gf=qc;class gl{constructor(e,t,r){this.type=Tt,this.needle=e,this.haystack=t,this.fromIndex=r}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,Kt),l=t.parse(e[2],2,Kt);if(!r||!l)return null;if(!nl(r.type,[ri,ni,Tt,hs,Kt]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Zi(r.type)} instead`);if(e.length===4){const u=t.parse(e[3],3,Tt);return u?new gl(r,l,u):null}return new gl(r,l)}evaluate(e){const t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!ho(t,["boolean","string","number","null"]))throw new fn(`Expected first argument to be of type boolean, string, number or null, but found ${Zi(Qi(t))} instead.`);if(!ho(r,["string","array"]))throw new fn(`Expected second argument to be of type array or string, but found ${Zi(Qi(r))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(e);return r.indexOf(t,l)}return r.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Zf=gl;class yl{constructor(e,t,r,l,u,d){this.inputType=e,this.type=t,this.input=r,this.cases=l,this.outputs=u,this.otherwise=d}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let r,l;t.expectedType&&t.expectedType.kind!=="value"&&(l=t.expectedType);const u={},d=[];for(let x=2;x<e.length-1;x+=2){let E=e[x];const C=e[x+1];Array.isArray(E)||(E=[E]);const M=t.concat(x);if(E.length===0)return M.error("Expected at least one branch label.");for(const D of E){if(typeof D!="number"&&typeof D!="string")return M.error("Branch labels must be numbers or strings.");if(typeof D=="number"&&Math.abs(D)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof D=="number"&&Math.floor(D)!==D)return M.error("Numeric branch labels must be integer values.");if(r){if(M.checkSubtype(r,Qi(D)))return null}else r=Qi(D);if(u[String(D)]!==void 0)return M.error("Branch labels must be unique.");u[String(D)]=d.length}const P=t.parse(C,x,l);if(!P)return null;l=l||P.type,d.push(P)}const p=t.parse(e[1],1,Kt);if(!p)return null;const y=t.parse(e[e.length-1],e.length-1,l);return y?p.type.kind!=="value"&&t.concat(1).checkSubtype(r,p.type)?null:new yl(r,l,p,u,d,y):null}evaluate(e){const t=this.input.evaluate(e);return(Qi(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),r=[],l={};for(const d of t){const p=l[this.cases[d]];p===void 0?(l[this.cases[d]]=r.length,r.push([this.cases[d],[d]])):r[p][1].push(d)}const u=d=>this.inputType.kind==="number"?Number(d):d;for(const[d,p]of r)e.push(p.length===1?u(p[0]):p.map(u)),e.push(this.outputs[d].serialize());return e.push(this.otherwise.serialize()),e}}var Ah=yl;class xl{constructor(e,t,r){this.type=e,this.branches=t,this.otherwise=r}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let r;t.expectedType&&t.expectedType.kind!=="value"&&(r=t.expectedType);const l=[];for(let d=1;d<e.length-1;d+=2){const p=t.parse(e[d],d,ri);if(!p)return null;const y=t.parse(e[d+1],d+1,r);if(!y)return null;l.push([p,y]),r=r||y.type}const u=t.parse(e[e.length-1],e.length-1,r);return u?new xl(r,l,u):null}evaluate(e){for(const[t,r]of this.branches)if(t.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,r]of this.branches)e(t),e(r);e(this.otherwise)}outputDefined(){return this.branches.every(([e,t])=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var Wf=xl;class vl{constructor(e,t,r,l){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=l}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,Kt),l=t.parse(e[2],2,Tt);if(!r||!l)return null;if(!nl(r.type,[or(Kt),ni,Kt]))return t.error(`Expected first argument to be of type array or string, but found ${Zi(r.type)} instead`);if(e.length===4){const u=t.parse(e[3],3,Tt);return u?new vl(r.type,r,l,u):null}return new vl(r.type,r,l)}evaluate(e){const t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!ho(t,["string","array"]))throw new fn(`Expected first argument to be of type array or string, but found ${Zi(Qi(t))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(e);return t.slice(r,l)}return t.slice(r)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Mh=vl;function Gc(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Zc(i,e,t,r){return r.compare(e,t)===0}function gs(i,e,t){const r=i!=="=="&&i!=="!=";return class J0{constructor(u,d,p){this.type=ri,this.lhs=u,this.rhs=d,this.collator=p,this.hasUntypedArgument=u.type.kind==="value"||d.type.kind==="value"}static parse(u,d){if(u.length!==3&&u.length!==4)return d.error("Expected two or three arguments.");const p=u[0];let y=d.parse(u[1],1,Kt);if(!y)return null;if(!Gc(p,y.type))return d.concat(1).error(`"${p}" comparisons are not supported for type '${Zi(y.type)}'.`);let x=d.parse(u[2],2,Kt);if(!x)return null;if(!Gc(p,x.type))return d.concat(2).error(`"${p}" comparisons are not supported for type '${Zi(x.type)}'.`);if(y.type.kind!==x.type.kind&&y.type.kind!=="value"&&x.type.kind!=="value")return d.error(`Cannot compare types '${Zi(y.type)}' and '${Zi(x.type)}'.`);r&&(y.type.kind==="value"&&x.type.kind!=="value"?y=new dr(x.type,[y]):y.type.kind!=="value"&&x.type.kind==="value"&&(x=new dr(y.type,[x])));let E=null;if(u.length===4){if(y.type.kind!=="string"&&x.type.kind!=="string"&&y.type.kind!=="value"&&x.type.kind!=="value")return d.error("Cannot use collator to compare non-string types.");if(E=d.parse(u[3],3,Js),!E)return null}return new J0(y,x,E)}evaluate(u){const d=this.lhs.evaluate(u),p=this.rhs.evaluate(u);if(r&&this.hasUntypedArgument){const y=Qi(d),x=Qi(p);if(y.kind!==x.kind||y.kind!=="string"&&y.kind!=="number")throw new fn(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${y.kind}, ${x.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const y=Qi(d),x=Qi(p);if(y.kind!=="string"||x.kind!=="string")return e(u,d,p)}return this.collator?t(u,d,p,this.collator.evaluate(u)):e(u,d,p)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){const u=[i];return this.eachChild(d=>{u.push(d.serialize())}),u}}}const Xf=gs("==",function(i,e,t){return e===t},Zc),Hf=gs("!=",function(i,e,t){return e!==t},function(i,e,t,r){return!Zc(0,e,t,r)}),Kf=gs("<",function(i,e,t){return e<t},function(i,e,t,r){return r.compare(e,t)<0}),bl=gs(">",function(i,e,t){return e>t},function(i,e,t,r){return r.compare(e,t)>0}),Ih=gs("<=",function(i,e,t){return e<=t},function(i,e,t,r){return r.compare(e,t)<=0}),zh=gs(">=",function(i,e,t){return e>=t},function(i,e,t,r){return r.compare(e,t)>=0});class Wc{constructor(e,t,r,l,u,d){this.type=ni,this.number=e,this.locale=t,this.currency=r,this.unit=l,this.minFractionDigits=u,this.maxFractionDigits=d}static parse(e,t){if(e.length!==3)return t.error("Expected two arguments.");const r=t.parse(e[1],1,Tt);if(!r)return null;const l=e[2];if(typeof l!="object"||Array.isArray(l))return t.error("NumberFormat options argument must be an object.");let u=null;if(l.locale&&(u=t.parse(l.locale,1,ni),!u))return null;let d=null;if(l.currency&&(d=t.parse(l.currency,1,ni),!d))return null;let p=null;if(l.unit&&(p=t.parse(l.unit,1,ni),!p))return null;let y=null;if(l["min-fraction-digits"]&&(y=t.parse(l["min-fraction-digits"],1,Tt),!y))return null;let x=null;return l["max-fraction-digits"]&&(x=t.parse(l["max-fraction-digits"],1,Tt),!x)?null:new Wc(r,u,d,p,y,x)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Xc{constructor(e){this.type=Tt,this.input=e}static parse(e,t){if(e.length!==2)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=t.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?t.error(`Expected argument of type string or array, but found ${Zi(r.type)} instead.`):new Xc(r):null}evaluate(e){const t=this.input.evaluate(e);if(typeof t=="string"||Array.isArray(t))return t.length;throw new fn(`Expected value to be of type string or array, but found ${Zi(Qi(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(t=>{e.push(t.serialize())}),e}}const kh={"==":Xf,"!=":Hf,">":bl,"<":Kf,">=":zh,"<=":Ih,array:dr,at:Ch,boolean:dr,case:Wf,coalesce:Eh,collator:ol,format:oa,image:rl,in:Gf,"index-of":Zf,interpolate:Pr,"interpolate-hcl":Pr,"interpolate-lab":Pr,length:Xc,let:Sh,literal:na,match:Ah,number:dr,"number-format":Wc,object:dr,slice:Mh,step:Dc,string:dr,"to-boolean":fs,"to-color":fs,"to-number":fs,"to-string":fs,var:hl,within:cl};function Hc(i,[e,t,r,l]){e=e.evaluate(i),t=t.evaluate(i),r=r.evaluate(i);const u=l?l.evaluate(i):1,d=Tc(e,t,r,u);if(d)throw new fn(d);return new Ai(e/255*u,t/255*u,r/255*u,u)}function Kc(i,e){return i in e}function wl(i,e){const t=e[i];return t===void 0?null:t}function qr(i){return{type:i}}Cr.register(kh,{error:[{kind:"error"},[ni],(i,[e])=>{throw new fn(e.evaluate(i))}],typeof:[ni,[Kt],(i,[e])=>Zi(Qi(e.evaluate(i)))],"to-rgba":[or(Tt,4),[Er],(i,[e])=>e.evaluate(i).toArray()],rgb:[Er,[Tt,Tt,Tt],Hc],rgba:[Er,[Tt,Tt,Tt,Tt],Hc],has:{type:ri,overloads:[[[ni],(i,[e])=>Kc(e.evaluate(i),i.properties())],[[ni,Sr],(i,[e,t])=>Kc(e.evaluate(i),t.evaluate(i))]]},get:{type:Kt,overloads:[[[ni],(i,[e])=>wl(e.evaluate(i),i.properties())],[[ni,Sr],(i,[e,t])=>wl(e.evaluate(i),t.evaluate(i))]]},"feature-state":[Kt,[ni],(i,[e])=>wl(e.evaluate(i),i.featureState||{})],properties:[Sr,[],i=>i.properties()],"geometry-type":[ni,[],i=>i.geometryType()],id:[Kt,[],i=>i.id()],zoom:[Tt,[],i=>i.globals.zoom],pitch:[Tt,[],i=>i.globals.pitch||0],"distance-from-center":[Tt,[],i=>i.distanceFromCenter()],"heatmap-density":[Tt,[],i=>i.globals.heatmapDensity||0],"line-progress":[Tt,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[Tt,[],i=>i.globals.skyRadialProgress||0],accumulated:[Kt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Tt,qr(Tt),(i,e)=>{let t=0;for(const r of e)t+=r.evaluate(i);return t}],"*":[Tt,qr(Tt),(i,e)=>{let t=1;for(const r of e)t*=r.evaluate(i);return t}],"-":{type:Tt,overloads:[[[Tt,Tt],(i,[e,t])=>e.evaluate(i)-t.evaluate(i)],[[Tt],(i,[e])=>-e.evaluate(i)]]},"/":[Tt,[Tt,Tt],(i,[e,t])=>e.evaluate(i)/t.evaluate(i)],"%":[Tt,[Tt,Tt],(i,[e,t])=>e.evaluate(i)%t.evaluate(i)],ln2:[Tt,[],()=>Math.LN2],pi:[Tt,[],()=>Math.PI],e:[Tt,[],()=>Math.E],"^":[Tt,[Tt,Tt],(i,[e,t])=>Math.pow(e.evaluate(i),t.evaluate(i))],sqrt:[Tt,[Tt],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Tt,[Tt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Tt,[Tt],(i,[e])=>Math.log(e.evaluate(i))],log2:[Tt,[Tt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Tt,[Tt],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Tt,[Tt],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Tt,[Tt],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Tt,[Tt],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Tt,[Tt],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Tt,[Tt],(i,[e])=>Math.atan(e.evaluate(i))],min:[Tt,qr(Tt),(i,e)=>Math.min(...e.map(t=>t.evaluate(i)))],max:[Tt,qr(Tt),(i,e)=>Math.max(...e.map(t=>t.evaluate(i)))],abs:[Tt,[Tt],(i,[e])=>Math.abs(e.evaluate(i))],round:[Tt,[Tt],(i,[e])=>{const t=e.evaluate(i);return t<0?-Math.round(-t):Math.round(t)}],floor:[Tt,[Tt],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Tt,[Tt],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[ri,[ni,Kt],(i,[e,t])=>i.properties()[e.value]===t.value],"filter-id-==":[ri,[Kt],(i,[e])=>i.id()===e.value],"filter-type-==":[ri,[ni],(i,[e])=>i.geometryType()===e.value],"filter-<":[ri,[ni,Kt],(i,[e,t])=>{const r=i.properties()[e.value],l=t.value;return typeof r==typeof l&&r<l}],"filter-id-<":[ri,[Kt],(i,[e])=>{const t=i.id(),r=e.value;return typeof t==typeof r&&t<r}],"filter->":[ri,[ni,Kt],(i,[e,t])=>{const r=i.properties()[e.value],l=t.value;return typeof r==typeof l&&r>l}],"filter-id->":[ri,[Kt],(i,[e])=>{const t=i.id(),r=e.value;return typeof t==typeof r&&t>r}],"filter-<=":[ri,[ni,Kt],(i,[e,t])=>{const r=i.properties()[e.value],l=t.value;return typeof r==typeof l&&r<=l}],"filter-id-<=":[ri,[Kt],(i,[e])=>{const t=i.id(),r=e.value;return typeof t==typeof r&&t<=r}],"filter->=":[ri,[ni,Kt],(i,[e,t])=>{const r=i.properties()[e.value],l=t.value;return typeof r==typeof l&&r>=l}],"filter-id->=":[ri,[Kt],(i,[e])=>{const t=i.id(),r=e.value;return typeof t==typeof r&&t>=r}],"filter-has":[ri,[Kt],(i,[e])=>e.value in i.properties()],"filter-has-id":[ri,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[ri,[or(ni)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[ri,[or(Kt)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[ri,[ni,or(Kt)],(i,[e,t])=>t.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[ri,[ni,or(Kt)],(i,[e,t])=>function(r,l,u,d){for(;u<=d;){const p=u+d>>1;if(l[p]===r)return!0;l[p]>r?d=p-1:u=p+1}return!1}(i.properties()[e.value],t.value,0,t.value.length-1)],all:{type:ri,overloads:[[[ri,ri],(i,[e,t])=>e.evaluate(i)&&t.evaluate(i)],[qr(ri),(i,e)=>{for(const t of e)if(!t.evaluate(i))return!1;return!0}]]},any:{type:ri,overloads:[[[ri,ri],(i,[e,t])=>e.evaluate(i)||t.evaluate(i)],[qr(ri),(i,e)=>{for(const t of e)if(t.evaluate(i))return!0;return!1}]]},"!":[ri,[ri],(i,[e])=>!e.evaluate(i)],"is-supported-script":[ri,[ni],(i,[e])=>{const t=i.globals&&i.globals.isSupportedScript;return!t||t(e.evaluate(i))}],upcase:[ni,[ni],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[ni,[ni],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[ni,qr(Kt),(i,e)=>e.map(t=>ia(t.evaluate(i))).join("")],"resolved-locale":[ni,[Js],(i,[e])=>e.evaluate(i).resolvedLocale()]});var ha=kh;function Ph(i){return{result:"success",value:i}}function ys(i){return{result:"error",value:i}}function xs(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Dh(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Yc(i){return!!i.expression&&i.expression.interpolated}function yi(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function da(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Lh(i){return i}function fa(i,e){const t=e.type==="color",r=i.stops&&typeof i.stops[0][0]=="object",l=r||!(r||i.property!==void 0),u=i.type||(Yc(e)?"exponential":"interval");if(t&&((i=rr({},i)).stops&&(i.stops=i.stops.map(x=>[x[0],Ai.parse(x[1])])),i.default=Ai.parse(i.default?i.default:e.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!Th[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let d,p,y;if(u==="exponential")d=Jc;else if(u==="interval")d=yo;else if(u==="categorical"){d=Yf,p=Object.create(null);for(const x of i.stops)p[x[0]]=x[1];y=typeof i.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);d=vs}if(r){const x={},E=[];for(let P=0;P<i.stops.length;P++){const D=i.stops[P],O=D[0].zoom;x[O]===void 0&&(x[O]={zoom:O,type:i.type,property:i.property,default:i.default,stops:[]},E.push(O)),x[O].stops.push([D[0].value,D[1]])}const C=[];for(const P of E)C.push([x[P].zoom,fa(x[P],e)]);const M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:Pr.interpolationFactor.bind(void 0,M),zoomStops:C.map(P=>P[0]),evaluate:({zoom:P},D)=>Jc({stops:C,base:i.base},e,P).evaluate(P,D)}}if(l){const x=u==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:x,interpolationFactor:Pr.interpolationFactor.bind(void 0,x),zoomStops:i.stops.map(E=>E[0]),evaluate:({zoom:E})=>d(i,e,E,p,y)}}return{kind:"source",evaluate(x,E){const C=E&&E.properties?E.properties[i.property]:void 0;return C===void 0?pa(i.default,e.default):d(i,e,C,p,y)}}}function pa(i,e,t){return i!==void 0?i:e!==void 0?e:t!==void 0?t:void 0}function Yf(i,e,t,r,l){return pa(typeof t===l?r[t]:void 0,i.default,e.default)}function yo(i,e,t){if(yi(t)!=="number")return pa(i.default,e.default);const r=i.stops.length;if(r===1||t<=i.stops[0][0])return i.stops[0][1];if(t>=i.stops[r-1][0])return i.stops[r-1][1];const l=fl(i.stops.map(u=>u[0]),t);return i.stops[l][1]}function Jc(i,e,t){const r=i.base!==void 0?i.base:1;if(yi(t)!=="number")return pa(i.default,e.default);const l=i.stops.length;if(l===1||t<=i.stops[0][0])return i.stops[0][1];if(t>=i.stops[l-1][0])return i.stops[l-1][1];const u=fl(i.stops.map(E=>E[0]),t),d=function(E,C,M,P){const D=P-M,O=E-M;return D===0?0:C===1?O/D:(Math.pow(C,O)-1)/(Math.pow(C,D)-1)}(t,r,i.stops[u][0],i.stops[u+1][0]),p=i.stops[u][1],y=i.stops[u+1][1];let x=aa[e.type]||Lh;if(i.colorSpace&&i.colorSpace!=="rgb"){const E=Th[i.colorSpace];x=(C,M)=>E.reverse(E.interpolate(E.forward(C),E.forward(M),d))}return typeof p.evaluate=="function"?{evaluate(...E){const C=p.evaluate.apply(void 0,E),M=y.evaluate.apply(void 0,E);if(C!==void 0&&M!==void 0)return x(C,M,d)}}:x(p,y,d)}function vs(i,e,t){return e.type==="color"?t=Ai.parse(t):e.type==="formatted"?t=Zn.fromString(t.toString()):e.type==="resolvedImage"?t=Wn.fromString(t.toString()):yi(t)===e.type||e.type==="enum"&&e.values[t]||(t=void 0),pa(t,i.default,e.default)}class Qc{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new yh,this._defaultValue=t?function(r){return r.type==="color"&&(da(r.default)||Array.isArray(r.default))?new Ai(0,0,0,0):r.type==="color"?Ai.parse(r.default)||null:r.default===void 0?null:r.default}(t):null,this._enumValues=t&&t.type==="enum"?t.values:null}evaluateWithoutErrorHandling(e,t,r,l,u,d,p,y){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=l||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=d,this._evaluator.featureTileCoord=p||null,this._evaluator.featureDistanceData=y||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,r,l,u,d,p,y){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=l||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=d||null,this._evaluator.featureTileCoord=p||null,this._evaluator.featureDistanceData=y||null;try{const x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new fn(`Expected value to be one of ${Object.keys(this._enumValues).map(E=>JSON.stringify(E)).join(", ")}, but found ${JSON.stringify(x)} instead.`);return x}catch(x){return this._warningHistory[x.message]||(this._warningHistory[x.message]=!0,typeof console<"u"&&console.warn(x.message)),this._defaultValue}}}function Tl(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in ha}function bs(i,e){const t=new Uo(ha,[],e?function(l){const u={color:Er,string:ni,number:Tt,enum:ni,boolean:ri,formatted:Qs,resolvedImage:ea};return l.type==="array"?or(u[l.value]||Kt,l.length):u[l.type]}(e):void 0),r=t.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return r?Ph(new Qc(r,e)):ys(t.errors)}class eu{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!_o(t.expression)}evaluateWithoutErrorHandling(e,t,r,l,u,d){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,l,u,d)}evaluate(e,t,r,l,u,d){return this._styleExpression.evaluate(e,t,r,l,u,d)}}class ma{constructor(e,t,r,l){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!_o(t.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,t,r,l,u,d){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,l,u,d)}evaluate(e,t,r,l,u,d){return this._styleExpression.evaluate(e,t,r,l,u,d)}interpolationFactor(e,t,r){return this.interpolationType?Pr.interpolationFactor(this.interpolationType,e,t,r):0}}function tu(i,e){if((i=bs(i,e)).result==="error")return i;const t=i.value.expression,r=Oo(t);if(!r&&!xs(e))return ys([new Tr("","data expressions not supported")]);const l=sa(t,["zoom","pitch","distance-from-center"]);if(!l&&!Dh(e))return ys([new Tr("","zoom expressions not supported")]);const u=Ts(t);return u||l?u instanceof Tr?ys([u]):u instanceof Pr&&!Yc(e)?ys([new Tr("",'"interpolate" expressions cannot be used with this property')]):Ph(u?new ma(r?"camera":"composite",i.value,u.labels,u instanceof Pr?u.interpolation:void 0):new eu(r?"constant":"source",i.value)):ys([new Tr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ws{constructor(e,t){this._parameters=e,this._specification=t,rr(this,fa(this._parameters,this._specification))}static deserialize(e){return new ws(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ts(i){let e=null;if(i instanceof Sh)e=Ts(i.result);else if(i instanceof Eh){for(const t of i.args)if(e=Ts(t),e)break}else(i instanceof Dc||i instanceof Pr)&&i.input instanceof Cr&&i.input.name==="zoom"&&(e=i);return e instanceof Tr||i.eachChild(t=>{const r=Ts(t);r instanceof Tr?e=r:!e&&r?e=new Tr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&r&&e!==r&&(e=new Tr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class Et{constructor(e,t,r,l){this.message=(e?`${e}: `:"")+r,l&&(this.identifier=l),t!=null&&t.__line__&&(this.line=t.__line__)}}function sr(i){const e=i.key,t=i.value,r=i.valueSpec||{},l=i.objectElementValidators||{},u=i.style,d=i.styleSpec;let p=[];const y=yi(t);if(y!=="object")return[new Et(e,t,`object expected, ${y} found`)];for(const x in t){const E=x.split(".")[0],C=r[E]||r["*"];let M;l[E]?M=l[E]:r[E]?M=mn:l["*"]?M=l["*"]:r["*"]&&(M=mn),M?p=p.concat(M({key:(e&&`${e}.`)+x,value:t[x],valueSpec:C,style:u,styleSpec:d,object:t,objectKey:x},t)):p.push(new Et(e,t[x],`unknown property "${x}"`))}for(const x in r)l[x]||r[x].required&&r[x].default===void 0&&t[x]===void 0&&p.push(new Et(e,t,`missing required property "${x}"`));return p}function iu(i){const e=i.value,t=i.valueSpec,r=i.style,l=i.styleSpec,u=i.key,d=i.arrayElementValidator||mn;if(yi(e)!=="array")return[new Et(u,e,`array expected, ${yi(e)} found`)];if(t.length&&e.length!==t.length)return[new Et(u,e,`array length ${t.length} expected, length ${e.length} found`)];if(t["min-length"]&&e.length<t["min-length"])return[new Et(u,e,`array length at least ${t["min-length"]} expected, length ${e.length} found`)];let p={type:t.value,values:t.values,minimum:t.minimum,maximum:t.maximum,function:void 0};l.$version<7&&(p.function=t.function),yi(t.value)==="object"&&(p=t.value);let y=[];for(let x=0;x<e.length;x++)y=y.concat(d({array:e,arrayIndex:x,value:e[x],valueSpec:p,style:r,styleSpec:l,key:`${u}[${x}]`}));return y}function nu(i){const e=i.key,t=i.value,r=i.valueSpec;let l=yi(t);if(l==="number"&&t!=t&&(l="NaN"),l!=="number")return[new Et(e,t,`number expected, ${l} found`)];if("minimum"in r){let u=r.minimum;if(yi(r.minimum)==="array"&&(u=r.minimum[i.arrayIndex]),t<u)return[new Et(e,t,`${t} is less than the minimum value ${u}`)]}if("maximum"in r){let u=r.maximum;if(yi(r.maximum)==="array"&&(u=r.maximum[i.arrayIndex]),t>u)return[new Et(e,t,`${t} is greater than the maximum value ${u}`)]}return[]}function _a(i){const e=i.valueSpec,t=Ki(i.value.type);let r,l,u,d={};const p=t!=="categorical"&&i.value.property===void 0,y=!p,x=yi(i.value.stops)==="array"&&yi(i.value.stops[0])==="array"&&yi(i.value.stops[0][0])==="object",E=sr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(P){if(t==="identity")return[new Et(P.key,P.value,'identity function may not have a "stops" property')];let D=[];const O=P.value;return D=D.concat(iu({key:P.key,value:O,valueSpec:P.valueSpec,style:P.style,styleSpec:P.styleSpec,arrayElementValidator:C})),yi(O)==="array"&&O.length===0&&D.push(new Et(P.key,O,"array must have at least one stop")),D},default:function(P){return mn({key:P.key,value:P.value,valueSpec:e,style:P.style,styleSpec:P.styleSpec})}}});return t==="identity"&&p&&E.push(new Et(i.key,i.value,'missing required property "property"')),t==="identity"||i.value.stops||E.push(new Et(i.key,i.value,'missing required property "stops"')),t==="exponential"&&i.valueSpec.expression&&!Yc(i.valueSpec)&&E.push(new Et(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(y&&!xs(i.valueSpec)?E.push(new Et(i.key,i.value,"property functions not supported")):p&&!Dh(i.valueSpec)&&E.push(new Et(i.key,i.value,"zoom functions not supported"))),t!=="categorical"&&!x||i.value.property!==void 0||E.push(new Et(i.key,i.value,'"property" property is required')),E;function C(P){let D=[];const O=P.value,V=P.key;if(yi(O)!=="array")return[new Et(V,O,`array expected, ${yi(O)} found`)];if(O.length!==2)return[new Et(V,O,`array length 2 expected, length ${O.length} found`)];if(x){if(yi(O[0])!=="object")return[new Et(V,O,`object expected, ${yi(O[0])} found`)];if(O[0].zoom===void 0)return[new Et(V,O,"object stop key must have zoom")];if(O[0].value===void 0)return[new Et(V,O,"object stop key must have value")];const K=Ki(O[0].zoom);if(typeof K!="number")return[new Et(V,O[0].zoom,"stop zoom values must be numbers")];if(u&&u>K)return[new Et(V,O[0].zoom,"stop zoom values must appear in ascending order")];K!==u&&(u=K,l=void 0,d={}),D=D.concat(sr({key:`${V}[0]`,value:O[0],valueSpec:{zoom:{}},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{zoom:nu,value:M}}))}else D=D.concat(M({key:`${V}[0]`,value:O[0],valueSpec:{},style:P.style,styleSpec:P.styleSpec},O));return Tl(uo(O[1]))?D.concat([new Et(`${V}[1]`,O[1],"expressions are not allowed in function stops.")]):D.concat(mn({key:`${V}[1]`,value:O[1],valueSpec:e,style:P.style,styleSpec:P.styleSpec}))}function M(P,D){const O=yi(P.value),V=Ki(P.value),K=P.value!==null?P.value:D;if(r){if(O!==r)return[new Et(P.key,K,`${O} stop domain type must match previous stop domain type ${r}`)]}else r=O;if(O!=="number"&&O!=="string"&&O!=="boolean"&&typeof V!="number"&&typeof V!="string"&&typeof V!="boolean")return[new Et(P.key,K,"stop domain value must be a number, string, or boolean")];if(O!=="number"&&t!=="categorical"){let oe=`number expected, ${O} found`;return xs(e)&&t===void 0&&(oe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Et(P.key,K,oe)]}return t!=="categorical"||O!=="number"||typeof V=="number"&&isFinite(V)&&Math.floor(V)===V?t!=="categorical"&&O==="number"&&typeof V=="number"&&typeof l=="number"&&l!==void 0&&V<l?[new Et(P.key,K,"stop domain values must appear in ascending order")]:(l=V,t==="categorical"&&V in d?[new Et(P.key,K,"stop domain values must be unique")]:(d[V]=!0,[])):[new Et(P.key,K,`integer expected, found ${String(V)}`)]}}function Ar(i){const e=(i.expressionContext==="property"?tu:bs)(uo(i.value),i.valueSpec);if(e.result==="error")return e.value.map(r=>new Et(`${i.key}${r.key}`,i.value,r.message));const t=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!t.outputDefined())return[new Et(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!_o(t))return[new Et(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter")return ru(t,i);if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!sa(t,["zoom","feature-state"]))return[new Et(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Oo(t))return[new Et(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ru(i,e){const t=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const l of e.valueSpec.expression.parameters)t.delete(l);if(t.size===0)return[];const r=[];return i instanceof Cr&&t.has(i.name)?[new Et(e.key,e.value,`["${i.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(i.eachChild(l=>{r.push(...ru(l,e))}),r)}function ga(i){const e=i.key,t=i.value,r=i.valueSpec,l=[];return Array.isArray(r.values)?r.values.indexOf(Ki(t))===-1&&l.push(new Et(e,t,`expected one of [${r.values.join(", ")}], ${JSON.stringify(t)} found`)):Object.keys(r.values).indexOf(Ki(t))===-1&&l.push(new Et(e,t,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(t)} found`)),l}function ya(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!ya(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function xa(i,e="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ya(i)||(i=El(i));const t=i;let r=!0;try{r=function(x){if(!Gr(x))return x;let E=uo(x);return ou(E),E=Rh(E),E}(t)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(t,null,2)}
        `)}const l=Re[`filter_${e}`],u=bs(r,l);let d=null;if(u.result==="error")throw new Error(u.value.map(x=>`${x.key}: ${x.message}`).join(", "));d=(x,E,C)=>u.value.evaluate(x,E,{},C);let p=null,y=null;if(r!==t){const x=bs(t,l);if(x.result==="error")throw new Error(x.value.map(E=>`${E.key}: ${E.message}`).join(", "));p=(E,C,M,P,D)=>x.value.evaluate(E,C,{},M,void 0,void 0,P,D),y=!Oo(x.value.expression)}return d=d,{filter:d,dynamicFilter:p||void 0,needGeometry:Bh(r),needFeature:!!y}}function Rh(i){if(!Array.isArray(i))return i;const e=function(t){if(Jf.has(t[0])){for(let r=1;r<t.length;r++)if(Gr(t[r]))return!0}return t}(i);return e===!0?e:e.map(t=>Rh(t))}function ou(i){let e=!1;const t=[];if(i[0]==="case"){for(let r=1;r<i.length-1;r+=2)e=e||Gr(i[r]),t.push(i[r+1]);t.push(i[i.length-1])}else if(i[0]==="match"){e=e||Gr(i[1]);for(let r=2;r<i.length-1;r+=2)t.push(i[r+1]);t.push(i[i.length-1])}else if(i[0]==="step"){e=e||Gr(i[1]);for(let r=1;r<i.length-1;r+=2)t.push(i[r+1])}e&&(i.length=0,i.push("any",...t));for(let r=1;r<i.length;r++)ou(i[r])}function Gr(i){if(!Array.isArray(i))return!1;if((e=i[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let t=1;t<i.length;t++)if(Gr(i[t]))return!0;return!1}const Jf=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Qf(i,e){return i<e?-1:i>e?1:0}function Bh(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(Bh(i[e]))return!0;return!1}function El(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?su(i[1],i[2],"=="):e==="!="?En(su(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?su(i[1],i[2],e):e==="any"?(t=i.slice(1),["any"].concat(t.map(El))):e==="all"?["all"].concat(i.slice(1).map(El)):e==="none"?["all"].concat(i.slice(1).map(El).map(En)):e==="in"?va(i[1],i.slice(2)):e==="!in"?En(va(i[1],i.slice(2))):e==="has"?ba(i[1]):e==="!has"?En(ba(i[1])):e!=="within"||i;var t}function su(i,e,t){switch(i){case"$type":return[`filter-type-${t}`,e];case"$id":return[`filter-id-${t}`,e];default:return[`filter-${t}`,i,e]}}function va(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(t=>typeof t!=typeof e[0])?["filter-in-large",i,["literal",e.sort(Qf)]]:["filter-in-small",i,["literal",e]]}}function ba(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function En(i){return["!",i]}function Es(i){return ya(uo(i.value))?Ar(rr({},i,{expressionContext:"filter",valueSpec:i.styleSpec[`filter_${i.layerType||"fill"}`]})):Fh(i)}function Fh(i){const e=i.value,t=i.key;if(yi(e)!=="array")return[new Et(t,e,`array expected, ${yi(e)} found`)];const r=i.styleSpec;let l,u=[];if(e.length<1)return[new Et(t,e,"filter array must have at least 1 element")];switch(u=u.concat(ga({key:`${t}[0]`,value:e[0],valueSpec:r.filter_operator,style:i.style,styleSpec:i.styleSpec})),Ki(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Ki(e[1])==="$type"&&u.push(new Et(t,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&u.push(new Et(t,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(l=yi(e[1]),l!=="string"&&u.push(new Et(`${t}[1]`,e[1],`string expected, ${l} found`)));for(let d=2;d<e.length;d++)l=yi(e[d]),Ki(e[1])==="$type"?u=u.concat(ga({key:`${t}[${d}]`,value:e[d],valueSpec:r.geometry_type,style:i.style,styleSpec:i.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&u.push(new Et(`${t}[${d}]`,e[d],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let d=1;d<e.length;d++)u=u.concat(Fh({key:`${t}[${d}]`,value:e[d],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":l=yi(e[1]),e.length!==2?u.push(new Et(t,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="string"&&u.push(new Et(`${t}[1]`,e[1],`string expected, ${l} found`));break;case"within":l=yi(e[1]),e.length!==2?u.push(new Et(t,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="object"&&u.push(new Et(`${t}[1]`,e[1],`object expected, ${l} found`))}return u}function Oh(i,e){const t=i.key,r=i.style,l=i.styleSpec,u=i.value,d=i.objectKey,p=l[`${e}_${i.layerType}`];if(!p)return[];const y=d.match(/^(.*)-transition$/);if(e==="paint"&&y&&p[y[1]]&&p[y[1]].transition)return mn({key:t,value:u,valueSpec:l.transition,style:r,styleSpec:l});const x=i.valueSpec||p[d];if(!x)return[new Et(t,u,`unknown property "${d}"`)];let E;if(yi(u)==="string"&&xs(x)&&!x.tokens&&(E=/^{([^}]+)}$/.exec(u)))return[new Et(t,u,`"${d}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(E[1])} }\`.`)];const C=[];return i.layerType==="symbol"&&(d==="text-field"&&r&&!r.glyphs&&C.push(new Et(t,u,'use of "text-field" requires a style "glyphs" property')),d==="text-font"&&da(uo(u))&&Ki(u.type)==="identity"&&C.push(new Et(t,u,'"text-font" does not support identity functions'))),C.concat(mn({key:i.key,value:u,valueSpec:x,style:r,styleSpec:l,expressionContext:"property",propertyType:e,propertyKey:d}))}function Uh(i){return Oh(i,"paint")}function Vh(i){return Oh(i,"layout")}function Sl(i){let e=[];const t=i.value,r=i.key,l=i.style,u=i.styleSpec;t.type||t.ref||e.push(new Et(r,t,'either "type" or "ref" is required'));let d=Ki(t.type);const p=Ki(t.ref);if(t.id){const y=Ki(t.id);for(let x=0;x<i.arrayIndex;x++){const E=l.layers[x];Ki(E.id)===y&&e.push(new Et(r,t.id,`duplicate layer id "${t.id}", previously used at line ${E.id.__line__}`))}}if("ref"in t){let y;["type","source","source-layer","filter","layout"].forEach(x=>{x in t&&e.push(new Et(r,t[x],`"${x}" is prohibited for ref layers`))}),l.layers.forEach(x=>{Ki(x.id)===p&&(y=x)}),y?y.ref?e.push(new Et(r,t.ref,"ref cannot reference another ref layer")):d=Ki(y.type):typeof p=="string"&&e.push(new Et(r,t.ref,`ref layer "${p}" not found`))}else if(d!=="background"&&d!=="sky")if(t.source){const y=l.sources&&l.sources[t.source],x=y&&Ki(y.type);y?x==="vector"&&d==="raster"?e.push(new Et(r,t.source,`layer "${t.id}" requires a raster source`)):x==="raster"&&d!=="raster"?e.push(new Et(r,t.source,`layer "${t.id}" requires a vector source`)):x!=="vector"||t["source-layer"]?x==="raster-dem"&&d!=="hillshade"?e.push(new Et(r,t.source,"raster-dem source can only be used with layer type 'hillshade'.")):d!=="line"||!t.paint||!t.paint["line-gradient"]&&!t.paint["line-trim-offset"]||x==="geojson"&&y.lineMetrics||e.push(new Et(r,t,`layer "${t.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Et(r,t,`layer "${t.id}" must specify a "source-layer"`)):e.push(new Et(r,t.source,`source "${t.source}" not found`))}else e.push(new Et(r,t,'missing required property "source"'));return e=e.concat(sr({key:r,value:t,valueSpec:u.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>mn({key:`${r}.type`,value:t.type,valueSpec:u.layer.type,style:i.style,styleSpec:i.styleSpec,object:t,objectKey:"type"}),filter:y=>Es(rr({layerType:d},y)),layout:y=>sr({layer:t,key:y.key,value:y.value,valueSpec:{},style:y.style,styleSpec:y.styleSpec,objectElementValidators:{"*":x=>Vh(rr({layerType:d},x))}}),paint:y=>sr({layer:t,key:y.key,value:y.value,valueSpec:{},style:y.style,styleSpec:y.styleSpec,objectElementValidators:{"*":x=>Uh(rr({layerType:d},x))}})}})),e}function Ss(i){const e=i.value,t=i.key,r=yi(e);return r!=="string"?[new Et(t,e,`string expected, ${r} found`)]:[]}const Cl={promoteId:function({key:i,value:e}){if(yi(e)==="string")return Ss({key:i,value:e});{const t=[];for(const r in e)t.push(...Ss({key:`${i}.${r}`,value:e[r]}));return t}}};function Nh(i){const e=i.value,t=i.key,r=i.styleSpec,l=i.style;if(!e.type)return[new Et(t,e,'"type" is required')];const u=Ki(e.type);let d;switch(u){case"vector":case"raster":case"raster-dem":return d=sr({key:t,value:e,valueSpec:r[`source_${u.replace("-","_")}`],style:i.style,styleSpec:r,objectElementValidators:Cl}),d;case"geojson":if(d=sr({key:t,value:e,valueSpec:r.source_geojson,style:l,styleSpec:r,objectElementValidators:Cl}),e.cluster)for(const p in e.clusterProperties){const[y,x]=e.clusterProperties[p],E=typeof y=="string"?[y,["accumulated"],["get",p]]:y;d.push(...Ar({key:`${t}.${p}.map`,value:x,expressionContext:"cluster-map"})),d.push(...Ar({key:`${t}.${p}.reduce`,value:E,expressionContext:"cluster-reduce"}))}return d;case"video":return sr({key:t,value:e,valueSpec:r.source_video,style:l,styleSpec:r});case"image":return sr({key:t,value:e,valueSpec:r.source_image,style:l,styleSpec:r});case"canvas":return[new Et(t,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ga({key:`${t}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:l,styleSpec:r})}}function jh(i){const e=i.value,t=i.styleSpec,r=t.light,l=i.style;let u=[];const d=yi(e);if(e===void 0)return u;if(d!=="object")return u=u.concat([new Et("light",e,`object expected, ${d} found`)]),u;for(const p in e){const y=p.match(/^(.*)-transition$/);u=u.concat(y&&r[y[1]]&&r[y[1]].transition?mn({key:p,value:e[p],valueSpec:t.transition,style:l,styleSpec:t}):r[p]?mn({key:p,value:e[p],valueSpec:r[p],style:l,styleSpec:t}):[new Et(p,e[p],`unknown property "${p}"`)])}return u}function Al(i){const e=i.value,t=i.key,r=i.style,l=i.styleSpec,u=l.terrain;let d=[];const p=yi(e);if(e===void 0)return d;if(p!=="object")return d=d.concat([new Et("terrain",e,`object expected, ${p} found`)]),d;for(const y in e){const x=y.match(/^(.*)-transition$/);d=d.concat(x&&u[x[1]]&&u[x[1]].transition?mn({key:y,value:e[y],valueSpec:l.transition,style:r,styleSpec:l}):u[y]?mn({key:y,value:e[y],valueSpec:u[y],style:r,styleSpec:l}):[new Et(y,e[y],`unknown property "${y}"`)])}if(e.source){const y=r.sources&&r.sources[e.source],x=y&&Ki(y.type);y?x!=="raster-dem"&&d.push(new Et(t,e.source,`terrain cannot be used with a source of type ${String(x)}, it only be used with a "raster-dem" source type`)):d.push(new Et(t,e.source,`source "${e.source}" not found`))}else d.push(new Et(t,e,'terrain is missing required property "source"'));return d}function $h(i){const e=i.value,t=i.style,r=i.styleSpec,l=r.fog;let u=[];const d=yi(e);if(e===void 0)return u;if(d!=="object")return u=u.concat([new Et("fog",e,`object expected, ${d} found`)]),u;for(const p in e){const y=p.match(/^(.*)-transition$/);u=u.concat(y&&l[y[1]]&&l[y[1]].transition?mn({key:p,value:e[p],valueSpec:r.transition,style:t,styleSpec:r}):l[p]?mn({key:p,value:e[p],valueSpec:l[p],style:t,styleSpec:r}):[new Et(p,e[p],`unknown property "${p}"`)])}return u}const au={"*":()=>[],array:iu,boolean:function(i){const e=i.value,t=i.key,r=yi(e);return r!=="boolean"?[new Et(t,e,`boolean expected, ${r} found`)]:[]},number:nu,color:function(i){const e=i.key,t=i.value,r=yi(t);return r!=="string"?[new Et(e,t,`color expected, ${r} found`)]:fo.parseCSSColor(t)===null?[new Et(e,t,`color expected, "${t}" found`)]:[]},enum:ga,filter:Es,function:_a,layer:Sl,object:sr,source:Nh,light:jh,terrain:Al,fog:$h,string:Ss,formatted:function(i){return Ss(i).length===0?[]:Ar(i)},resolvedImage:function(i){return Ss(i).length===0?[]:Ar(i)},projection:function(i){const e=i.value,t=i.styleSpec,r=t.projection,l=i.style;let u=[];const d=yi(e);if(d==="object")for(const p in e)u=u.concat(mn({key:p,value:e[p],valueSpec:r[p],style:l,styleSpec:t}));else d!=="string"&&(u=u.concat([new Et("projection",e,`object or string expected, ${d} found`)]));return u}};function mn(i){const e=i.value,t=i.valueSpec,r=i.styleSpec;return t.expression&&da(Ki(e))?_a(i):t.expression&&Tl(uo(e))?Ar(i):t.type&&au[t.type]?au[t.type](i):sr(rr({},i,{valueSpec:t.type?r[t.type]:t}))}function ep(i){const e=i.value,t=i.key,r=Ss(i);return r.length||(e.indexOf("{fontstack}")===-1&&r.push(new Et(t,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&r.push(new Et(t,e,'"glyphs" url must include a "{range}" token'))),r}function Ml(i,e=Re){return Zr(mn({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:ep,"*":()=>[]}}))}const Il=i=>Zr(Uh(i)),qh=i=>Zr(Vh(i));function Zr(i){return i.slice().sort((e,t)=>e.line&&t.line?e.line-t.line:0)}function lu(i,e){let t=!1;if(e&&e.length)for(const r of e)i.fire(new Ei(new Error(r.message))),t=!0;return t}var Cs=pr;function pr(i,e,t){var r=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var l=new Int32Array(this.arrayBuffer);i=l[0],this.d=(e=l[1])+2*(t=l[2]);for(var u=0;u<this.d*this.d;u++){var d=l[3+u],p=l[3+u+1];r.push(d===p?null:l.subarray(d,p))}var y=l[3+r.length+1];this.keys=l.subarray(l[3+r.length],y),this.bboxes=l.subarray(y),this.insert=this._insertReadonly}else{this.d=e+2*t;for(var x=0;x<this.d*this.d;x++)r.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=i,this.padding=t,this.scale=e/i,this.uid=0;var E=t/e*i;this.min=-E,this.max=i+E}pr.prototype.insert=function(i,e,t,r,l){this._forEachCell(e,t,r,l,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(l)},pr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},pr.prototype._insertCell=function(i,e,t,r,l,u){this.cells[l].push(u)},pr.prototype.query=function(i,e,t,r,l){var u=this.min,d=this.max;if(i<=u&&e<=u&&d<=t&&d<=r&&!l)return Array.prototype.slice.call(this.keys);var p=[];return this._forEachCell(i,e,t,r,this._queryCell,p,{},l),p},pr.prototype._queryCell=function(i,e,t,r,l,u,d,p){var y=this.cells[l];if(y!==null)for(var x=this.keys,E=this.bboxes,C=0;C<y.length;C++){var M=y[C];if(d[M]===void 0){var P=4*M;(p?p(E[P+0],E[P+1],E[P+2],E[P+3]):i<=E[P+2]&&e<=E[P+3]&&t>=E[P+0]&&r>=E[P+1])?(d[M]=!0,u.push(x[M])):d[M]=!1}}},pr.prototype._forEachCell=function(i,e,t,r,l,u,d,p){for(var y=this._convertToCellCoord(i),x=this._convertToCellCoord(e),E=this._convertToCellCoord(t),C=this._convertToCellCoord(r),M=y;M<=E;M++)for(var P=x;P<=C;P++){var D=this.d*P+M;if((!p||p(this._convertFromCellCoord(M),this._convertFromCellCoord(P),this._convertFromCellCoord(M+1),this._convertFromCellCoord(P+1)))&&l.call(this,i,e,t,r,D,u,d,p))return}},pr.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},pr.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},pr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,e=3+this.cells.length+1+1,t=0,r=0;r<this.cells.length;r++)t+=this.cells[r].length;var l=new Int32Array(e+t+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;for(var u=e,d=0;d<i.length;d++){var p=i[d];l[3+d]=u,l.set(p,u),u+=p.length}return l[3+i.length]=u,l.set(this.keys,u),l[3+i.length+1]=u+=this.keys.length,l.set(this.bboxes,u),u+=this.bboxes.length,l.buffer};const zl={};function At(i,e,t={}){Object.defineProperty(i,"_classRegistryKey",{value:e,writeable:!1}),zl[e]={klass:i,omit:t.omit||[]}}At(Object,"Object"),Cs.serialize=function(i,e){const t=i.toArrayBuffer();return e&&e.push(t),{buffer:t}},Cs.deserialize=function(i){return new Cs(i.buffer)},Object.defineProperty(Cs,"name",{value:"Grid"}),At(Cs,"Grid"),At(Ai,"Color"),At(Error,"Error"),At(ve,"AJAXError"),At(Wn,"ResolvedImage"),At(ws,"StylePropertyFunction"),At(Qc,"StyleExpression",{omit:["_evaluator"]}),At(ma,"ZoomDependentExpression"),At(eu,"ZoomConstantExpression"),At(Cr,"CompoundExpression",{omit:["_evaluate"]});for(const i in ha)zl[ha[i]._classRegistryKey]||At(ha[i],`Expression${i}`);function Gh(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Zh(i){return B.ImageBitmap&&i instanceof B.ImageBitmap}function As(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(Gh(i)||Zh(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const t=i;return e&&e.push(t.buffer),t}if(i instanceof B.ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const t=[];for(const r of i)t.push(As(r,e));return t}if(typeof i=="object"){const t=i.constructor,r=t._classRegistryKey;if(!r)throw new Error(`can't serialize object of unregistered class ${r}`);const l=t.serialize?t.serialize(i,e):{};if(!t.serialize){for(const u in i)i.hasOwnProperty(u)&&(zl[r].omit.indexOf(u)>=0||(l[u]=As(i[u],e)));i instanceof Error&&(l.message=i.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(l.$name=r),l}throw new Error("can't serialize object of type "+typeof i)}function wa(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||Gh(i)||Zh(i)||ArrayBuffer.isView(i)||i instanceof B.ImageData)return i;if(Array.isArray(i))return i.map(wa);if(typeof i=="object"){const e=i.$name||"Object",{klass:t}=zl[e];if(!t)throw new Error(`can't deserialize unregistered class ${e}`);if(t.deserialize)return t.deserialize(i);const r=Object.create(t.prototype);for(const l of Object.keys(i))l!=="$name"&&(r[l]=wa(i[l]));return r}throw new Error("can't deserialize object of type "+typeof i)}class Wh{constructor(){this.first=!0}update(e,t){const r=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=r,!0))}}const Xh=i=>i>=1536&&i<=1791,Hh=i=>i>=1872&&i<=1919,Kh=i=>i>=2208&&i<=2303,Yh=i=>i>=11904&&i<=12031,Jh=i=>i>=12032&&i<=12255,Ta=i=>i>=12272&&i<=12287,kl=i=>i>=12288&&i<=12351,cu=i=>i>=12352&&i<=12447,Vo=i=>i>=12448&&i<=12543,Qh=i=>i>=12544&&i<=12591,uu=i=>i>=12704&&i<=12735,ed=i=>i>=12736&&i<=12783,hu=i=>i>=12784&&i<=12799,du=i=>i>=12800&&i<=13055,fu=i=>i>=13056&&i<=13311,pu=i=>i>=13312&&i<=19903,Ea=i=>i>=19968&&i<=40959,Pl=i=>i>=40960&&i<=42127,td=i=>i>=42128&&i<=42191,id=i=>i>=44032&&i<=55215,nd=i=>i>=63744&&i<=64255,Sa=i=>i>=64336&&i<=65023,rd=i=>i>=65040&&i<=65055,mu=i=>i>=65072&&i<=65103,od=i=>i>=65104&&i<=65135,_u=i=>i>=65136&&i<=65279,gu=i=>i>=65280&&i<=65519;function Dl(i){for(const e of i)if(Ll(e.charCodeAt(0)))return!0;return!1}function tp(i){for(const e of i)if(!ip(e.charCodeAt(0)))return!1;return!0}function ip(i){return!(Xh(i)||Hh(i)||Kh(i)||Sa(i)||_u(i))}function Ll(i){return!(i!==746&&i!==747&&(i<4352||!(uu(i)||Qh(i)||mu(i)&&!(i>=65097&&i<=65103)||nd(i)||fu(i)||Yh(i)||ed(i)||!(!kl(i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||pu(i)||Ea(i)||du(i)||(e=>e>=12592&&e<=12687)(i)||(e=>e>=43360&&e<=43391)(i)||(e=>e>=55216&&e<=55295)(i)||(e=>e>=4352&&e<=4607)(i)||id(i)||cu(i)||Ta(i)||(e=>e>=12688&&e<=12703)(i)||Jh(i)||hu(i)||Vo(i)&&i!==12540||!(!gu(i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!od(i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||(e=>e>=5120&&e<=5759)(i)||(e=>e>=6320&&e<=6399)(i)||rd(i)||(e=>e>=19904&&e<=19967)(i)||Pl(i)||td(i))))}function Ca(i){return!(Ll(i)||function(e){return!!((t=>t>=128&&t<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(t=>t>=8192&&t<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(t=>t>=8448&&t<=8527)(e)||(t=>t>=8528&&t<=8591)(e)||(t=>t>=8960&&t<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(t=>t>=9216&&t<=9279)(e)&&e!==9251||(t=>t>=9280&&t<=9311)(e)||(t=>t>=9312&&t<=9471)(e)||(t=>t>=9632&&t<=9727)(e)||(t=>t>=9728&&t<=9983)(e)&&!(e>=9754&&e<=9759)||(t=>t>=11008&&t<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||kl(e)||Vo(e)||(t=>t>=57344&&t<=63743)(e)||mu(e)||od(e)||gu(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function c(i){return i>=1424&&i<=2303||Sa(i)||_u(i)}function n(i,e){return!(!e&&c(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||(t=>t>=6016&&t<=6143)(i))}function a(i){for(const e of i)if(c(e.charCodeAt(0)))return!0;return!1}const h="deferred",m="loading",_="loaded";let b=null,T="unavailable",S=null;const I=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(T="error"),b&&b(i)};function k(){R.fire(new zi("pluginStateChange",{pluginStatus:T,pluginURL:S}))}const R=new Ft,U=function(){return T},W=function(){if(T!==h||!S)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");T=m,k(),S&&we({url:S},i=>{i?I(i):(T=_,k())})},j={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>T===_||j.applyArabicShaping!=null,isLoading:()=>T===m,setState(i){T=i.pluginStatus,S=i.pluginURL},isParsed:()=>j.applyArabicShaping!=null&&j.processBidirectionalText!=null&&j.processStyledBidirectionalText!=null,getPluginURL:()=>S};class ${constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition,this.pitch=t.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Wh,this.transition={},this.pitch=0)}isSupportedScript(e){return function(t,r){for(const l of t)if(!n(l.charCodeAt(0),r))return!1;return!0}(e,j.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,t=e-Math.floor(e),r=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*t}}}class q{constructor(e,t){this.property=e,this.value=t,this.expression=function(r,l){if(da(r))return new ws(r,l);if(Tl(r)){const u=tu(r,l);if(u.result==="error")throw new Error(u.value.map(d=>`${d.key}: ${d.message}`).join(", "));return u.value}{let u=r;return typeof r=="string"&&l.type==="color"&&(u=Ai.parse(r)),{kind:"constant",evaluate:()=>u}}}(t===void 0?e.specification.default:t,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,t,r){return this.property.possiblyEvaluate(this,e,t,r)}}class N{constructor(e){this.property=e,this.value=new q(e,void 0)}transitioned(e,t){return new X(this.property,this.value,t,Fe({},e.transition,this.transition),e.now)}untransitioned(){return new X(this.property,this.value,null,{},0)}}class J{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return xt(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new N(this._values[e].property)),this._values[e].value=new q(this._values[e].property,t===null?void 0:xt(t))}getTransition(e){return xt(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new N(this._values[e].property)),this._values[e].transition=xt(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const r=this.getValue(t);r!==void 0&&(e[t]=r);const l=this.getTransition(t);l!==void 0&&(e[`${t}-transition`]=l)}return e}transitioned(e,t){const r=new ue(this._properties);for(const l of Object.keys(this._values))r._values[l]=this._values[l].transitioned(e,t._values[l]);return r}untransitioned(){const e=new ue(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class X{constructor(e,t,r,l,u){const d=l.delay||0,p=l.duration||0;u=u||0,this.property=e,this.value=t,this.begin=u+d,this.end=this.begin+p,e.specification.transition&&(l.delay||l.duration)&&(this.prior=r)}possiblyEvaluate(e,t,r){const l=e.now||0,u=this.value.possiblyEvaluate(e,t,r),d=this.prior;if(d){if(l>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(l<this.begin)return d.possiblyEvaluate(e,t,r);{const p=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(d.possiblyEvaluate(e,t,r),u,Se(p))}}return u}}class ue{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,r){const l=new ce(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(e,t,r);return l}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class le{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return xt(this._values[e].value)}setValue(e,t){this._values[e]=new q(this._values[e].property,t===null?void 0:xt(t))}serialize(){const e={};for(const t of Object.keys(this._values)){const r=this.getValue(t);r!==void 0&&(e[t]=r)}return e}possiblyEvaluate(e,t,r){const l=new ce(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(e,t,r);return l}}class re{constructor(e,t,r){this.property=e,this.value=t,this.parameters=r}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,t,r,l){return this.property.evaluate(this.value,this.parameters,e,t,r,l)}}class ce{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ae{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,r){const l=aa[this.specification.type];return l?l(e,t,r):e}}class me{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,r,l){return new re(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(t,null,{},r,l)}:e.expression,t)}interpolate(e,t,r){if(e.value.kind!=="constant"||t.value.kind!=="constant")return e;if(e.value.value===void 0||t.value.value===void 0)return new re(this,{kind:"constant",value:void 0},e.parameters);const l=aa[this.specification.type];return l?new re(this,{kind:"constant",value:l(e.value.value,t.value.value,r)},e.parameters):e}evaluate(e,t,r,l,u,d){return e.kind==="constant"?e.value:e.evaluate(t,r,l,u,d)}}class Ce extends me{possiblyEvaluate(e,t,r,l){if(e.value===void 0)return new re(this,{kind:"constant",value:void 0},t);if(e.expression.kind==="constant"){const u=e.expression.evaluate(t,null,{},r,l),d=e.property.specification.type==="resolvedImage"&&typeof u!="string"?u.name:u,p=this._calculate(d,d,d,t);return new re(this,{kind:"constant",value:p},t)}if(e.expression.kind==="camera"){const u=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t);return new re(this,{kind:"constant",value:u},t)}return new re(this,e.expression,t)}evaluate(e,t,r,l,u,d){if(e.kind==="source"){const p=e.evaluate(t,r,l,u,d);return this._calculate(p,p,p,t)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},r,l),e.evaluate({zoom:Math.floor(t.zoom)},r,l),e.evaluate({zoom:Math.floor(t.zoom)+1},r,l),t):e.value}_calculate(e,t,r,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:t,other:r}:{from:r,to:t,other:e}}interpolate(e){return e}}class rt{constructor(e){this.specification=e}possiblyEvaluate(e,t,r,l){if(e.value!==void 0){if(e.expression.kind==="constant"){const u=e.expression.evaluate(t,null,{},r,l);return this._calculate(u,u,u,t)}return this._calculate(e.expression.evaluate(new $(Math.floor(t.zoom-1),t)),e.expression.evaluate(new $(Math.floor(t.zoom),t)),e.expression.evaluate(new $(Math.floor(t.zoom+1),t)),t)}}_calculate(e,t,r,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:r,to:t}}interpolate(e){return e}}class xe{constructor(e){this.specification=e}possiblyEvaluate(e,t,r,l){return!!e.expression.evaluate(t,null,{},r,l)}interpolate(){return!1}}class Ve{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new $(0,{});for(const r in e){const l=e[r];l.specification.overridable&&this.overridableProperties.push(r);const u=this.defaultPropertyValues[r]=new q(l,void 0),d=this.defaultTransitionablePropertyValues[r]=new N(l);this.defaultTransitioningPropertyValues[r]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=u.possiblyEvaluate(t)}}}function Ge(i,e){return 256*(i=Ie(Math.floor(i),0,255))+Ie(Math.floor(e),0,255)}At(me,"DataDrivenProperty"),At(ae,"DataConstantProperty"),At(Ce,"CrossFadedDataDrivenProperty"),At(rt,"CrossFadedProperty"),At(xe,"ColorRampProperty");const pt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Le{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class lt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function qe(i,e=1){let t=0,r=0;return{members:i.map(l=>{const u=pt[l.type].BYTES_PER_ELEMENT,d=t=vt(t,Math.max(e,u)),p=l.components||1;return r=Math.max(r,u),t+=u*p,{name:l.name,type:l.type,components:p,offset:d}}),size:vt(t,Math.max(r,e)),alignment:e}}function vt(i,e){return Math.ceil(i/e)*e}class _t extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){const l=2*e;return this.int16[l+0]=t,this.int16[l+1]=r,e}}_t.prototype.bytesPerElement=4,At(_t,"StructArrayLayout2i4");class It extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r){const l=this.length;return this.resize(l+1),this.emplace(l,e,t,r)}emplace(e,t,r,l){const u=3*e;return this.int16[u+0]=t,this.int16[u+1]=r,this.int16[u+2]=l,e}}It.prototype.bytesPerElement=6,At(It,"StructArrayLayout3i6");class Lt extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,r,l)}emplace(e,t,r,l,u){const d=4*e;return this.int16[d+0]=t,this.int16[d+1]=r,this.int16[d+2]=l,this.int16[d+3]=u,e}}Lt.prototype.bytesPerElement=8,At(Lt,"StructArrayLayout4i8");class qt extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,l,u,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,t,r,l,u,d,p)}emplace(e,t,r,l,u,d,p,y){const x=6*e,E=12*e,C=3*e;return this.int16[x+0]=t,this.int16[x+1]=r,this.uint8[E+4]=l,this.uint8[E+5]=u,this.uint8[E+6]=d,this.uint8[E+7]=p,this.float32[C+2]=y,e}}qt.prototype.bytesPerElement=12,At(qt,"StructArrayLayout2i4ub1f12");class li extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,r,l)}emplace(e,t,r,l,u){const d=4*e;return this.float32[d+0]=t,this.float32[d+1]=r,this.float32[d+2]=l,this.float32[d+3]=u,e}}li.prototype.bytesPerElement=16,At(li,"StructArrayLayout4f16");class zt extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,l,u,d,p,y,x,E){const C=this.length;return this.resize(C+1),this.emplace(C,e,t,r,l,u,d,p,y,x,E)}emplace(e,t,r,l,u,d,p,y,x,E,C){const M=10*e;return this.uint16[M+0]=t,this.uint16[M+1]=r,this.uint16[M+2]=l,this.uint16[M+3]=u,this.uint16[M+4]=d,this.uint16[M+5]=p,this.uint16[M+6]=y,this.uint16[M+7]=x,this.uint16[M+8]=E,this.uint16[M+9]=C,e}}zt.prototype.bytesPerElement=20,At(zt,"StructArrayLayout10ui20");class Xt extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,l,u,d,p,y){const x=this.length;return this.resize(x+1),this.emplace(x,e,t,r,l,u,d,p,y)}emplace(e,t,r,l,u,d,p,y,x){const E=8*e;return this.uint16[E+0]=t,this.uint16[E+1]=r,this.uint16[E+2]=l,this.uint16[E+3]=u,this.uint16[E+4]=d,this.uint16[E+5]=p,this.uint16[E+6]=y,this.uint16[E+7]=x,e}}Xt.prototype.bytesPerElement=16,At(Xt,"StructArrayLayout8ui16");class pi extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,l,u,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,t,r,l,u,d)}emplace(e,t,r,l,u,d,p){const y=6*e;return this.int16[y+0]=t,this.int16[y+1]=r,this.int16[y+2]=l,this.int16[y+3]=u,this.int16[y+4]=d,this.int16[y+5]=p,e}}pi.prototype.bytesPerElement=12,At(pi,"StructArrayLayout6i12");class Vi extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,l,u,d,p,y,x,E,C,M){const P=this.length;return this.resize(P+1),this.emplace(P,e,t,r,l,u,d,p,y,x,E,C,M)}emplace(e,t,r,l,u,d,p,y,x,E,C,M,P){const D=12*e;return this.int16[D+0]=t,this.int16[D+1]=r,this.int16[D+2]=l,this.int16[D+3]=u,this.uint16[D+4]=d,this.uint16[D+5]=p,this.uint16[D+6]=y,this.uint16[D+7]=x,this.int16[D+8]=E,this.int16[D+9]=C,this.int16[D+10]=M,this.int16[D+11]=P,e}}Vi.prototype.bytesPerElement=24,At(Vi,"StructArrayLayout4i4ui4i24");class Yi extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,l,u,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,t,r,l,u,d)}emplace(e,t,r,l,u,d,p){const y=10*e,x=5*e;return this.int16[y+0]=t,this.int16[y+1]=r,this.int16[y+2]=l,this.float32[x+2]=u,this.float32[x+3]=d,this.float32[x+4]=p,e}}Yi.prototype.bytesPerElement=20,At(Yi,"StructArrayLayout3i3f20");class Mi extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}Mi.prototype.bytesPerElement=4,At(Mi,"StructArrayLayout1ul4");class _n extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,l,u,d,p,y,x,E,C,M,P){const D=this.length;return this.resize(D+1),this.emplace(D,e,t,r,l,u,d,p,y,x,E,C,M,P)}emplace(e,t,r,l,u,d,p,y,x,E,C,M,P,D){const O=20*e,V=10*e;return this.int16[O+0]=t,this.int16[O+1]=r,this.int16[O+2]=l,this.int16[O+3]=u,this.int16[O+4]=d,this.float32[V+3]=p,this.float32[V+4]=y,this.float32[V+5]=x,this.float32[V+6]=E,this.int16[O+14]=C,this.uint32[V+8]=M,this.uint16[O+18]=P,this.uint16[O+19]=D,e}}_n.prototype.bytesPerElement=40,At(_n,"StructArrayLayout5i4f1i1ul2ui40");class Mr extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,l,u,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,t,r,l,u,d,p)}emplace(e,t,r,l,u,d,p,y){const x=8*e;return this.int16[x+0]=t,this.int16[x+1]=r,this.int16[x+2]=l,this.int16[x+4]=u,this.int16[x+5]=d,this.int16[x+6]=p,this.int16[x+7]=y,e}}Mr.prototype.bytesPerElement=16,At(Mr,"StructArrayLayout3i2i2i16");class Wr extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,l,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,r,l,u)}emplace(e,t,r,l,u,d){const p=4*e,y=8*e;return this.float32[p+0]=t,this.float32[p+1]=r,this.float32[p+2]=l,this.int16[y+6]=u,this.int16[y+7]=d,e}}Wr.prototype.bytesPerElement=16,At(Wr,"StructArrayLayout2f1f2i16");class Ni extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,r,l)}emplace(e,t,r,l,u){const d=12*e,p=3*e;return this.uint8[d+0]=t,this.uint8[d+1]=r,this.float32[p+1]=l,this.float32[p+2]=u,e}}Ni.prototype.bytesPerElement=12,At(Ni,"StructArrayLayout2ub2f12");class $i extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r){const l=this.length;return this.resize(l+1),this.emplace(l,e,t,r)}emplace(e,t,r,l){const u=3*e;return this.float32[u+0]=t,this.float32[u+1]=r,this.float32[u+2]=l,e}}$i.prototype.bytesPerElement=12,At($i,"StructArrayLayout3f12");class ti extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r){const l=this.length;return this.resize(l+1),this.emplace(l,e,t,r)}emplace(e,t,r,l){const u=3*e;return this.uint16[u+0]=t,this.uint16[u+1]=r,this.uint16[u+2]=l,e}}ti.prototype.bytesPerElement=6,At(ti,"StructArrayLayout3ui6");class rn extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,r,l,u,d,p,y,x,E,C,M,P,D,O,V,K,oe,Q,ne,he){const se=this.length;return this.resize(se+1),this.emplace(se,e,t,r,l,u,d,p,y,x,E,C,M,P,D,O,V,K,oe,Q,ne,he)}emplace(e,t,r,l,u,d,p,y,x,E,C,M,P,D,O,V,K,oe,Q,ne,he,se){const ke=30*e,Ae=15*e,Oe=60*e;return this.int16[ke+0]=t,this.int16[ke+1]=r,this.int16[ke+2]=l,this.float32[Ae+2]=u,this.float32[Ae+3]=d,this.uint16[ke+8]=p,this.uint16[ke+9]=y,this.uint32[Ae+5]=x,this.uint32[Ae+6]=E,this.uint32[Ae+7]=C,this.uint16[ke+16]=M,this.uint16[ke+17]=P,this.uint16[ke+18]=D,this.float32[Ae+10]=O,this.float32[Ae+11]=V,this.uint8[Oe+48]=K,this.uint8[Oe+49]=oe,this.uint8[Oe+50]=Q,this.uint32[Ae+13]=ne,this.int16[ke+28]=he,this.uint8[Oe+58]=se,e}}rn.prototype.bytesPerElement=60,At(rn,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Sn extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,r,l,u,d,p,y,x,E,C,M,P,D,O,V,K,oe,Q,ne,he,se,ke,Ae,Oe,ut,De,je,Xe,$e){const st=this.length;return this.resize(st+1),this.emplace(st,e,t,r,l,u,d,p,y,x,E,C,M,P,D,O,V,K,oe,Q,ne,he,se,ke,Ae,Oe,ut,De,je,Xe,$e)}emplace(e,t,r,l,u,d,p,y,x,E,C,M,P,D,O,V,K,oe,Q,ne,he,se,ke,Ae,Oe,ut,De,je,Xe,$e,st){const He=38*e,bt=19*e;return this.int16[He+0]=t,this.int16[He+1]=r,this.int16[He+2]=l,this.float32[bt+2]=u,this.float32[bt+3]=d,this.int16[He+8]=p,this.int16[He+9]=y,this.int16[He+10]=x,this.int16[He+11]=E,this.int16[He+12]=C,this.int16[He+13]=M,this.uint16[He+14]=P,this.uint16[He+15]=D,this.uint16[He+16]=O,this.uint16[He+17]=V,this.uint16[He+18]=K,this.uint16[He+19]=oe,this.uint16[He+20]=Q,this.uint16[He+21]=ne,this.uint16[He+22]=he,this.uint16[He+23]=se,this.uint16[He+24]=ke,this.uint16[He+25]=Ae,this.uint16[He+26]=Oe,this.uint16[He+27]=ut,this.uint16[He+28]=De,this.uint32[bt+15]=je,this.float32[bt+16]=Xe,this.float32[bt+17]=$e,this.float32[bt+18]=st,e}}Sn.prototype.bytesPerElement=76,At(Sn,"StructArrayLayout3i2f6i15ui1ul3f76");class Ri extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}Ri.prototype.bytesPerElement=4,At(Ri,"StructArrayLayout1f4");class Cn extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,l,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,r,l,u)}emplace(e,t,r,l,u,d){const p=5*e;return this.float32[p+0]=t,this.float32[p+1]=r,this.float32[p+2]=l,this.float32[p+3]=u,this.float32[p+4]=d,e}}Cn.prototype.bytesPerElement=20,At(Cn,"StructArrayLayout5f20");class No extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,r,l)}emplace(e,t,r,l,u){const d=6*e;return this.uint32[3*e+0]=t,this.uint16[d+2]=r,this.uint16[d+3]=l,this.uint16[d+4]=u,e}}No.prototype.bytesPerElement=12,At(No,"StructArrayLayout1ul3ui12");class Rn extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){const l=2*e;return this.uint16[l+0]=t,this.uint16[l+1]=r,e}}Rn.prototype.bytesPerElement=4,At(Rn,"StructArrayLayout2ui4");class jo extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}jo.prototype.bytesPerElement=2,At(jo,"StructArrayLayout1ui2");class $o extends lt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){const l=2*e;return this.float32[l+0]=t,this.float32[l+1]=r,e}}$o.prototype.bytesPerElement=8,At($o,"StructArrayLayout2f8");class qo extends Le{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}qo.prototype.size=12;class Bn extends pi{get(e){return new qo(this,e)}}At(Bn,"FillExtrusionExtArray");class Go extends Le{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Go.prototype.size=40;class xo extends _n{get(e){return new Go(this,e)}}At(xo,"CollisionBoxArray");class Aa extends Le{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Aa.prototype.size=60;class I_ extends rn{get(e){return new Aa(this,e)}}At(I_,"PlacedSymbolArray");class z_ extends Le{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}z_.prototype.size=76;class k_ extends Sn{get(e){return new z_(this,e)}}At(k_,"SymbolInstanceArray");class P_ extends Ri{getoffsetX(e){return this.float32[1*e+0]}}At(P_,"GlyphOffsetArray");class D_ extends It{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}At(D_,"SymbolLineVertexArray");class L_ extends Le{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}L_.prototype.size=12;class R_ extends No{get(e){return new L_(this,e)}}At(R_,"FeatureIndexArray");class B_ extends Le{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}B_.prototype.size=4;class F_ extends Rn{get(e){return new B_(this,e)}}At(F_,"FillExtrusionCentroidArray");class O_ extends Le{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}O_.prototype.size=12;class U_ extends pi{get(e){return new O_(this,e)}}At(U_,"CircleGlobeExtArray");const v1=qe([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),b1=qe([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var V_=bc(function(i){i.exports=function(e,t){var r,l,u,d,p,y,x,E;for(l=e.length-(r=3&e.length),u=t,p=3432918353,y=461845907,E=0;E<l;)x=255&e.charCodeAt(E)|(255&e.charCodeAt(++E))<<8|(255&e.charCodeAt(++E))<<16|(255&e.charCodeAt(++E))<<24,++E,u=27492+(65535&(d=5*(65535&(u=(u^=x=(65535&(x=(x=(65535&x)*p+(((x>>>16)*p&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(d>>>16)&65535)<<16);switch(x=0,r){case 3:x^=(255&e.charCodeAt(E+2))<<16;case 2:x^=(255&e.charCodeAt(E+1))<<8;case 1:u^=x=(65535&(x=(x=(65535&(x^=255&e.charCodeAt(E)))*p+(((x>>>16)*p&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295}return u^=e.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0}}),w1=bc(function(i){i.exports=function(e,t){for(var r,l=e.length,u=t^l,d=0;l>=4;)r=1540483477*(65535&(r=255&e.charCodeAt(d)|(255&e.charCodeAt(++d))<<8|(255&e.charCodeAt(++d))<<16|(255&e.charCodeAt(++d))<<24))+((1540483477*(r>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),l-=4,++d;switch(l){case 3:u^=(255&e.charCodeAt(d+2))<<16;case 2:u^=(255&e.charCodeAt(d+1))<<8;case 1:u=1540483477*(65535&(u^=255&e.charCodeAt(d)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0}}),yu=V_,T1=w1;yu.murmur3=V_,yu.murmur2=T1;class sd{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,r,l){this.ids.push(N_(e)),this.positions.push(t,r,l)}getPositions(e){const t=N_(e);let r=0,l=this.ids.length-1;for(;r<l;){const d=r+l>>1;this.ids[d]>=t?l=d:r=d+1}const u=[];for(;this.ids[r]===t;)u.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return u}static serialize(e,t){const r=new Float64Array(e.ids),l=new Uint32Array(e.positions);return np(r,l,0,r.length-1),t&&t.push(r.buffer,l.buffer),{ids:r,positions:l}}static deserialize(e){const t=new sd;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function N_(i){const e=+i;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:yu(String(i))}function np(i,e,t,r){for(;t<r;){const l=i[t+r>>1];let u=t-1,d=r+1;for(;;){do u++;while(i[u]<l);do d--;while(i[d]>l);if(u>=d)break;ad(i,u,d),ad(e,3*u,3*d),ad(e,3*u+1,3*d+1),ad(e,3*u+2,3*d+2)}d-t<r-d?(np(i,e,t,d),t=d+1):(np(i,e,d+1,r),r=d)}}function ad(i,e,t){const r=i[e];i[e]=i[t],i[t]=r}At(sd,"FeaturePositionMap");class Zo{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}}class ld extends Zo{constructor(e){super(e),this.current=0}set(e,t,r){this.fetchUniformLocation(e,t)&&this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class j_ extends Zo{constructor(e){super(e),this.current=[0,0,0,0]}set(e,t,r){this.fetchUniformLocation(e,t)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3])))}}class $_ extends Zo{constructor(e){super(e),this.current=Ai.transparent}set(e,t,r){this.fetchUniformLocation(e,t)&&(r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a)))}}const E1=new Float32Array(16),S1=new Float32Array(9),C1=new Float32Array(4);function rp(i){return[Ge(255*i.r,255*i.g),Ge(255*i.b,255*i.a)]}class xu{constructor(e,t,r){this.value=e,this.uniformNames=t.map(l=>`u_${l}`),this.type=r}setUniform(e,t,r,l,u){t.set(e,u,l.constantOr(this.value))}getBinding(e,t){return this.type==="color"?new $_(e):new ld(e)}}class Rl{constructor(e,t){this.uniformNames=t.map(r=>`u_${r}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,t){this.pixelRatioFrom=t.pixelRatio||1,this.pixelRatioTo=e.pixelRatio||1,this.patternFrom=t.tl.concat(t.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,t,r,l,u){const d=u==="u_pattern_to"||u==="u_dash_to"?this.patternTo:u==="u_pattern_from"||u==="u_dash_from"?this.patternFrom:u==="u_pixel_ratio_to"?this.pixelRatioTo:u==="u_pixel_ratio_from"?this.pixelRatioFrom:null;d&&t.set(e,u,d)}getBinding(e,t){return t==="u_pattern_from"||t==="u_pattern_to"||t==="u_dash_from"||t==="u_dash_to"?new j_(e):new ld(e)}}class Wo{constructor(e,t,r,l){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=t.map(u=>({name:`a_${u}`,type:"Float32",components:r==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(e,t,r,l,u,d){const p=this.paintVertexArray.length,y=this.expression.evaluate(new $(0),t,{},u,l,d);this.paintVertexArray.resize(e),this._setPaintValue(p,e,y)}updatePaintArray(e,t,r,l,u){const d=this.expression.evaluate({zoom:0},r,l,void 0,u);this._setPaintValue(e,t,d)}_setPaintValue(e,t,r){if(this.type==="color"){const l=rp(r);for(let u=e;u<t;u++)this.paintVertexArray.emplace(u,l[0],l[1])}else{for(let l=e;l<t;l++)this.paintVertexArray.emplace(l,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Xr{constructor(e,t,r,l,u,d){this.expression=e,this.uniformNames=t.map(p=>`u_${p}_t`),this.type=r,this.useIntegerZoom=l,this.zoom=u,this.maxValue=0,this.paintVertexAttributes=t.map(p=>({name:`a_${p}`,type:"Float32",components:r==="color"?4:2,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,t,r,l,u,d){const p=this.expression.evaluate(new $(this.zoom),t,{},u,l,d),y=this.expression.evaluate(new $(this.zoom+1),t,{},u,l,d),x=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(x,e,p,y)}updatePaintArray(e,t,r,l,u){const d=this.expression.evaluate({zoom:this.zoom},r,l,void 0,u),p=this.expression.evaluate({zoom:this.zoom+1},r,l,void 0,u);this._setPaintValue(e,t,d,p)}_setPaintValue(e,t,r,l){if(this.type==="color"){const u=rp(r),d=rp(l);for(let p=e;p<t;p++)this.paintVertexArray.emplace(p,u[0],u[1],d[0],d[1])}else{for(let u=e;u<t;u++)this.paintVertexArray.emplace(u,r,l);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t,r,l,u){const d=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,p=Ie(this.expression.interpolationFactor(d,this.zoom,this.zoom+1),0,1);t.set(e,u,p)}getBinding(e,t){return new ld(e)}}class Ms{constructor(e,t,r,l,u,d,p){this.expression=e,this.type=r,this.useIntegerZoom=l,this.zoom=u,this.layerId=p,this.paintVertexAttributes=(r==="array"?b1:v1).members;for(let y=0;y<t.length;++y);this.zoomInPaintVertexArray=new d,this.zoomOutPaintVertexArray=new d}populatePaintArray(e,t,r){const l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(l,e,t.patterns&&t.patterns[this.layerId],r)}updatePaintArray(e,t,r,l,u,d){this._setPaintValues(e,t,r.patterns&&r.patterns[this.layerId],d)}_setPaintValues(e,t,r,l){if(!l||!r)return;const{min:u,mid:d,max:p}=r,y=l[u],x=l[d],E=l[p];if(y&&x&&E)for(let C=e;C<t;C++)this._setPaintValue(this.zoomInPaintVertexArray,C,x,y),this._setPaintValue(this.zoomOutPaintVertexArray,C,x,E)}_setPaintValue(e,t,r,l){e.emplace(t,r.tl[0],r.tl[1],r.br[0],r.br[1],l.tl[0],l.tl[1],l.br[0],l.br[1],r.pixelRatio,l.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Is{constructor(e,t,r=()=>!0){this.binders={},this._buffers=[];const l=[];for(const u in e.paint._values){if(!r(u))continue;const d=e.paint.get(u);if(!(d instanceof re&&xs(d.property.specification)))continue;const p=M1(u,e.type),y=d.value,x=d.property.specification.type,E=d.property.useIntegerZoom,C=d.property.specification["property-type"],M=C==="cross-faded"||C==="cross-faded-data-driven",P=String(u)==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(y.kind!=="constant"||P)if(y.kind==="source"||P||M){const D=q_(u,x,"source");this.binders[u]=M?new Ms(y,p,x,E,t,D,e.id):new Wo(y,p,x,D),l.push(`/a_${u}`)}else{const D=q_(u,x,"composite");this.binders[u]=new Xr(y,p,x,E,t,D),l.push(`/z_${u}`)}else this.binders[u]=M?new Rl(y.value,p):new xu(y.value,p,x),l.push(`/u_${u}`)}this.cacheKey=l.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof Wo||t instanceof Xr?t.maxValue:0}populatePaintArrays(e,t,r,l,u,d){for(const p in this.binders){const y=this.binders[p];(y instanceof Wo||y instanceof Xr||y instanceof Ms)&&y.populatePaintArray(e,t,r,l,u,d)}}setConstantPatternPositions(e,t){for(const r in this.binders){const l=this.binders[r];l instanceof Rl&&l.setConstantPatternPositions(e,t)}}updatePaintArrays(e,t,r,l,u,d){let p=!1;for(const y in e){const x=t.getPositions(y);for(const E of x){const C=r.feature(E.index);for(const M in this.binders){const P=this.binders[M];if((P instanceof Wo||P instanceof Xr||P instanceof Ms)&&P.expression.isStateDependent===!0){const D=l.paint.get(M);P.expression=D.value,P.updatePaintArray(E.start,E.end,C,e[y],u,d),p=!0}}}}return p}defines(){const e=[];for(const t in this.binders){const r=this.binders[t];(r instanceof xu||r instanceof Rl)&&e.push(...r.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const r=this.binders[t];if(r instanceof Wo||r instanceof Xr||r instanceof Ms)for(let l=0;l<r.paintVertexAttributes.length;l++)e.push(r.paintVertexAttributes[l].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const r=this.binders[t];if(r instanceof xu||r instanceof Rl||r instanceof Xr)for(const l of r.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const t=[];for(const r in this.binders){const l=this.binders[r];if(l instanceof xu||l instanceof Rl||l instanceof Xr)for(const u of l.uniformNames)t.push({name:u,property:r,binding:l.getBinding(e,u)})}return t}setUniforms(e,t,r,l,u){for(const{name:d,property:p,binding:y}of r)this.binders[p].setUniform(e,y,u,l.get(p),d)}updatePaintBuffers(e){this._buffers=[];for(const t in this.binders){const r=this.binders[t];if(e&&r instanceof Ms){const l=e.fromScale===2?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(r instanceof Wo||r instanceof Xr)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(const t in this.binders){const r=this.binders[t];(r instanceof Wo||r instanceof Xr||r instanceof Ms)&&r.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof Wo||t instanceof Xr||t instanceof Ms)&&t.destroy()}}}class Ma{constructor(e,t,r=()=>!0){this.programConfigurations={};for(const l of e)this.programConfigurations[l.id]=new Is(l,t,r);this.needsUpload=!1,this._featureMap=new sd,this._bufferOffset=0}populatePaintArrays(e,t,r,l,u,d,p){for(const y in this.programConfigurations)this.programConfigurations[y].populatePaintArrays(e,t,l,u,d,p);t.id!==void 0&&this._featureMap.add(t.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,r,l,u){for(const d of r)this.needsUpload=this.programConfigurations[d.id].updatePaintArrays(e,this._featureMap,t,d,l,u)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const A1={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function M1(i,e){return A1[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}const I1={"line-pattern":{source:zt,composite:zt},"fill-pattern":{source:zt,composite:zt},"fill-extrusion-pattern":{source:zt,composite:zt},"line-dasharray":{source:Xt,composite:Xt}},z1={color:{source:$o,composite:li},number:{source:Ri,composite:$o}};function q_(i,e,t){const r=I1[i];return r&&r[t]||z1[e][t]}At(xu,"ConstantBinder"),At(Rl,"CrossFadedConstantBinder"),At(Wo,"SourceExpressionBinder"),At(Ms,"CrossFadedCompositeBinder"),At(Xr,"CompositeExpressionBinder"),At(Is,"ProgramConfiguration",{omit:["_buffers"]}),At(Ma,"ProgramConfigurationSet");const cd="-transition";class Hr extends Ft{constructor(e,t){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),t.layout&&(this._unevaluatedLayout=new le(t.layout)),t.paint)){this._transitionablePaint=new J(t.paint);for(const r in e.paint)this.setPaintProperty(r,e.paint[r],{validate:!1});for(const r in e.layout)this.setLayoutProperty(r,e.layout[r],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ce(t.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,r={}){t!=null&&this._validate(qh,`layers.${this.id}.layout.${e}`,e,t,r)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}getPaintProperty(e){return tt(e,cd)?this._transitionablePaint.getTransition(e.slice(0,-cd.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,r={}){if(t!=null&&this._validate(Il,`layers.${this.id}.paint.${e}`,e,t,r))return!1;if(tt(e,cd))return this._transitionablePaint.setTransition(e.slice(0,-cd.length),t||void 0),!1;{const l=this._transitionablePaint._values[e],u=l.property.specification["property-type"]==="cross-faded-data-driven",d=l.value.isDataDriven(),p=l.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);const y=this._transitionablePaint._values[e].value;return y.isDataDriven()||d||u||this._handleOverridablePaintPropertyUpdate(e,p,y)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,t,r){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Li(e,(t,r)=>!(t===void 0||r==="layout"&&!Object.keys(t).length||r==="paint"&&!Object.keys(t).length))}_validate(e,t,r,l,u={}){return(!u||u.validate!==!1)&&lu(this,e.call(Ml,{key:t,layerType:this.type,objectKey:r,value:l,styleSpec:Re,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof re&&xs(t.property.specification)&&(t.value.kind==="source"||t.value.kind==="composite")&&t.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=xa(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const k1=qe([{name:"a_pos",components:2,type:"Int16"}],4),P1=qe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class sn{constructor(e=[]){this.segments=e}prepareSegment(e,t,r,l){let u=this.segments[this.segments.length-1];return e>sn.MAX_VERTEX_ARRAY_LENGTH&&Jt(`Max vertices per segment is ${sn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!u||u.vertexLength+e>sn.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==l)&&(u={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},l!==void 0&&(u.sortKey=l),this.segments.push(u)),u}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,r,l){return new sn([{vertexOffset:e,primitiveOffset:t,vertexLength:r,primitiveLength:l,vaos:{},sortKey:0}])}}sn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,At(sn,"SegmentVector");var $t=8192;class zs{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof vi?new vi(e.lng,e.lat):vi.convert(e),this}setSouthWest(e){return this._sw=e instanceof vi?new vi(e.lng,e.lat):vi.convert(e),this}extend(e){const t=this._sw,r=this._ne;let l,u;if(e instanceof vi)l=e,u=e;else{if(!(e instanceof zs))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(zs.convert(e)):this.extend(vi.convert(e)):this;if(l=e._sw,u=e._ne,!l||!u)return this}return t||r?(t.lng=Math.min(l.lng,t.lng),t.lat=Math.min(l.lat,t.lat),r.lng=Math.max(u.lng,r.lng),r.lat=Math.max(u.lat,r.lat)):(this._sw=new vi(l.lng,l.lat),this._ne=new vi(u.lng,u.lat)),this}getCenter(){return new vi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new vi(this.getWest(),this.getNorth())}getSouthEast(){return new vi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:r}=vi.convert(e);let l=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&l}static convert(e){return!e||e instanceof zs?e:new zs(e)}}const op=63710088e-1;class vi{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new vi(be(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,r=this.lat*t,l=e.lat*t,u=Math.sin(r)*Math.sin(l)+Math.cos(r)*Math.cos(l)*Math.cos((e.lng-this.lng)*t);return op*Math.acos(Math.min(u,1))}toBounds(e=0){const t=360*e/40075017,r=t/Math.cos(Math.PI/180*this.lat);return new zs(new vi(this.lng-r,this.lat-t),new vi(this.lng+r,this.lat+t))}static convert(e){if(e instanceof vi)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new vi(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new vi(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const G_=2*Math.PI*op;function sp(i){return G_*Math.cos(i*Math.PI/180)}function vo(i){return(180+i)/360}function Xo(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Dr(i,e){return i/sp(e)}function Lr(i){return 360*i-180}function An(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function Z_(i,e){return i*sp(An(e))}const bo=85.051129;function W_(i){return 1/Math.cos(i*Math.PI/180)}class Bl{constructor(e,t,r=0){this.x=+e,this.y=+t,this.z=+r}static fromLngLat(e,t=0){const r=vi.convert(e);return new Bl(vo(r.lng),Xo(r.lat),Dr(t,r.lat))}toLngLat(){return new vi(Lr(this.x),An(this.y))}toAltitude(){return Z_(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/G_*W_(An(this.y))}}function ap(i,e,t,r,l,u,d,p,y){const x=(e+r)/2,E=(t+l)/2,C=new G(x,E);p(C),function(M,P,D,O,V,K){const oe=D-V,Q=O-K;return Math.abs((O-P)*oe-(D-M)*Q)/Math.hypot(oe,Q)}(C.x,C.y,u.x,u.y,d.x,d.y)>=y?(ap(i,e,t,x,E,u,C,p,y),ap(i,x,E,r,l,C,d,p,y)):i.push(d)}function X_(i,e,t){let r=i[0],l=r.x,u=r.y;e(r);const d=[r];for(let p=1;p<i.length;p++){const y=i[p],{x,y:E}=y;e(y),ap(d,l,u,x,E,r,y,e,t),l=x,u=E,r=y}return d}function lp(i,e,t,r,l){if(l(e,t)){const u=e.add(t).mult(.5);r(u),lp(i,e,u,r,l),lp(i,u,t,r,l)}else i.push(t)}function D1(i,e,t){let r=i[0];e(r);const l=[r];for(let u=1;u<i.length;u++){const d=i[u];e(d),lp(l,r,d,e,t),r=d}return l}const cp=Math.pow(2,14)-1,H_=-cp-1;function L1(i,e){const t=Math.round(i.x*e),r=Math.round(i.y*e);return i.x=Ie(t,H_,cp),i.y=Ie(r,H_,cp),(t<i.x||t>i.x+1||r<i.y||r>i.y+1)&&Jt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function Ho(i,e,t){const r=i.loadGeometry(),l=i.extent,u=$t/l;if(e&&t&&t.projection.isReprojectedInTileSpace){const d=1<<e.z,{scale:p,x:y,y:x,projection:E}=t,C=M=>{const P=Lr((e.x+M.x/l)/d),D=An((e.y+M.y/l)/d),O=E.project(P,D);M.x=(O.x*p-y)*l,M.y=(O.y*p-x)*l};for(let M=0;M<r.length;M++)if(i.type!==1)r[M]=X_(r[M],C,1);else{const P=[];for(const D of r[M])D.x<0||D.x>=l||D.y<0||D.y>=l||(C(D),P.push(D));r[M]=P}}for(const d of r)for(const p of d)L1(p,u);return r}function Ia(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Ho(i):[]}}function ud(i,e,t,r,l){i.emplaceBack(2*e+(r+1)/2,2*t+(l+1)/2)}function hd(i,e,t){i.emplaceBack(e.x,e.y,e.z,t[0]*16384,t[1]*16384,t[2]*16384)}class up{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new _t,this.indexArray=new ti,this.segments=new sn,this.programConfigurations=new Ma(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(e,t,r,l){const u=this.layers[0],d=[];let p=null;u.type==="circle"&&(p=u.layout.get("circle-sort-key"));for(const{feature:x,id:E,index:C,sourceLayerIndex:M}of e){const P=this.layers[0]._featureFilter.needGeometry,D=Ia(x,P);if(!this.layers[0]._featureFilter.filter(new $(this.zoom),D,r))continue;const O=p?p.evaluate(D,{},r):void 0,V={id:E,properties:x.properties,type:x.type,sourceLayerIndex:M,index:C,geometry:P?D.geometry:Ho(x,r,l),patterns:{},sortKey:O};d.push(V)}p&&d.sort((x,E)=>x.sortKey-E.sortKey);let y=null;l.projection.name==="globe"&&(this.globeExtVertexArray=new U_,y=l.projection);for(const x of d){const{geometry:E,index:C,sourceLayerIndex:M}=x,P=e[C].feature;this.addFeature(x,E,C,t.availableImages,r,y),t.featureIndex.insert(P,E,C,M,this.index)}}update(e,t,r,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,k1.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,P1.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,t,r,l,u,d){for(const p of t)for(const y of p){const x=y.x,E=y.y;if(x<0||x>=$t||E<0||E>=$t)continue;if(d){const P=d.projectTilePoint(x,E,u),D=d.upVector(u,x,E),O=this.globeExtVertexArray;hd(O,P,D),hd(O,P,D),hd(O,P,D),hd(O,P,D)}const C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),M=C.vertexLength;ud(this.layoutVertexArray,x,E,-1,-1),ud(this.layoutVertexArray,x,E,1,-1),ud(this.layoutVertexArray,x,E,1,1),ud(this.layoutVertexArray,x,E,-1,1),this.indexArray.emplaceBack(M,M+1,M+2),this.indexArray.emplaceBack(M,M+2,M+3),C.vertexLength+=4,C.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},l,u)}}function K_(i,e){for(let t=0;t<i.length;t++)if(za(e,i[t]))return!0;for(let t=0;t<e.length;t++)if(za(i,e[t]))return!0;return!!hp(i,e)}function R1(i,e,t){return!!za(i,e)||!!dp(e,i,t)}function Y_(i,e){if(i.length===1)return Q_(e,i[0]);for(let t=0;t<e.length;t++){const r=e[t];for(let l=0;l<r.length;l++)if(za(i,r[l]))return!0}for(let t=0;t<i.length;t++)if(Q_(e,i[t]))return!0;for(let t=0;t<e.length;t++)if(hp(i,e[t]))return!0;return!1}function B1(i,e,t){if(i.length>1){if(hp(i,e))return!0;for(let r=0;r<e.length;r++)if(dp(e[r],i,t))return!0}for(let r=0;r<i.length;r++)if(dp(i[r],e,t))return!0;return!1}function hp(i,e){if(i.length===0||e.length===0)return!1;for(let t=0;t<i.length-1;t++){const r=i[t],l=i[t+1];for(let u=0;u<e.length-1;u++)if(F1(r,l,e[u],e[u+1]))return!0}return!1}function F1(i,e,t,r){return _i(i,t,r)!==_i(e,t,r)&&_i(i,e,t)!==_i(i,e,r)}function dp(i,e,t){const r=t*t;if(e.length===1)return i.distSqr(e[0])<r;for(let l=1;l<e.length;l++)if(J_(i,e[l-1],e[l])<r)return!0;return!1}function J_(i,e,t){const r=e.distSqr(t);if(r===0)return i.distSqr(e);const l=((i.x-e.x)*(t.x-e.x)+(i.y-e.y)*(t.y-e.y))/r;return i.distSqr(l<0?e:l>1?t:t.sub(e)._mult(l)._add(e))}function Q_(i,e){let t,r,l,u=!1;for(let d=0;d<i.length;d++){t=i[d];for(let p=0,y=t.length-1;p<t.length;y=p++)r=t[p],l=t[y],r.y>e.y!=l.y>e.y&&e.x<(l.x-r.x)*(e.y-r.y)/(l.y-r.y)+r.x&&(u=!u)}return u}function za(i,e){let t=!1;for(let r=0,l=i.length-1;r<i.length;l=r++){const u=i[r],d=i[l];u.y>e.y!=d.y>e.y&&e.x<(d.x-u.x)*(e.y-u.y)/(d.y-u.y)+u.x&&(t=!t)}return t}function eg(i,e,t,r,l){for(const d of i)if(e<=d.x&&t<=d.y&&r>=d.x&&l>=d.y)return!0;const u=[new G(e,t),new G(e,l),new G(r,l),new G(r,t)];if(i.length>2){for(const d of u)if(za(i,d))return!0}for(let d=0;d<i.length-1;d++)if(O1(i[d],i[d+1],u))return!0;return!1}function O1(i,e,t){const r=t[0],l=t[2];if(i.x<r.x&&e.x<r.x||i.x>l.x&&e.x>l.x||i.y<r.y&&e.y<r.y||i.y>l.y&&e.y>l.y)return!1;const u=_i(i,e,t[0]);return u!==_i(i,e,t[1])||u!==_i(i,e,t[2])||u!==_i(i,e,t[3])}function Fl(i,e,t){const r=e.paint.get(i).value;return r.kind==="constant"?r.value:t.programConfigurations.get(e.id).getMaxValue(i)}function dd(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function tg(i,e,t,r,l){if(!e[0]&&!e[1])return i;const u=G.convert(e)._mult(l);t==="viewport"&&u._rotate(-r);const d=[];for(let p=0;p<i.length;p++)d.push(i[p].sub(u));return d}function ig(i,e,t,r){const l=G.convert(i)._mult(r);return e==="viewport"&&l._rotate(-t),l}At(up,"CircleBucket",{omit:["layers"]});const U1=new Ve({"circle-sort-key":new me(Re.layout_circle["circle-sort-key"])});var V1={paint:new Ve({"circle-radius":new me(Re.paint_circle["circle-radius"]),"circle-color":new me(Re.paint_circle["circle-color"]),"circle-blur":new me(Re.paint_circle["circle-blur"]),"circle-opacity":new me(Re.paint_circle["circle-opacity"]),"circle-translate":new ae(Re.paint_circle["circle-translate"]),"circle-translate-anchor":new ae(Re.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ae(Re.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ae(Re.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new me(Re.paint_circle["circle-stroke-width"]),"circle-stroke-color":new me(Re.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new me(Re.paint_circle["circle-stroke-opacity"])}),layout:U1},fd=1e-6,mr=typeof Float32Array<"u"?Float32Array:Array;function ng(){var i=new mr(9);return mr!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function wo(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function fp(i,e){var t=e[0],r=e[1],l=e[2],u=e[3],d=e[4],p=e[5],y=e[6],x=e[7],E=e[8],C=e[9],M=e[10],P=e[11],D=e[12],O=e[13],V=e[14],K=e[15],oe=t*p-r*d,Q=t*y-l*d,ne=t*x-u*d,he=r*y-l*p,se=r*x-u*p,ke=l*x-u*y,Ae=E*O-C*D,Oe=E*V-M*D,ut=E*K-P*D,De=C*V-M*O,je=C*K-P*O,Xe=M*K-P*V,$e=oe*Xe-Q*je+ne*De+he*ut-se*Oe+ke*Ae;return $e?(i[0]=(p*Xe-y*je+x*De)*($e=1/$e),i[1]=(l*je-r*Xe-u*De)*$e,i[2]=(O*ke-V*se+K*he)*$e,i[3]=(M*se-C*ke-P*he)*$e,i[4]=(y*ut-d*Xe-x*Oe)*$e,i[5]=(t*Xe-l*ut+u*Oe)*$e,i[6]=(V*ne-D*ke-K*Q)*$e,i[7]=(E*ke-M*ne+P*Q)*$e,i[8]=(d*je-p*ut+x*Ae)*$e,i[9]=(r*ut-t*je-u*Ae)*$e,i[10]=(D*se-O*ne+K*oe)*$e,i[11]=(C*ne-E*se-P*oe)*$e,i[12]=(p*Oe-d*De-y*Ae)*$e,i[13]=(t*De-r*Oe+l*Ae)*$e,i[14]=(O*Q-D*he-V*oe)*$e,i[15]=(E*he-C*Q+M*oe)*$e,i):null}function Ol(i,e,t){var r=e[0],l=e[1],u=e[2],d=e[3],p=e[4],y=e[5],x=e[6],E=e[7],C=e[8],M=e[9],P=e[10],D=e[11],O=e[12],V=e[13],K=e[14],oe=e[15],Q=t[0],ne=t[1],he=t[2],se=t[3];return i[0]=Q*r+ne*p+he*C+se*O,i[1]=Q*l+ne*y+he*M+se*V,i[2]=Q*u+ne*x+he*P+se*K,i[3]=Q*d+ne*E+he*D+se*oe,i[4]=(Q=t[4])*r+(ne=t[5])*p+(he=t[6])*C+(se=t[7])*O,i[5]=Q*l+ne*y+he*M+se*V,i[6]=Q*u+ne*x+he*P+se*K,i[7]=Q*d+ne*E+he*D+se*oe,i[8]=(Q=t[8])*r+(ne=t[9])*p+(he=t[10])*C+(se=t[11])*O,i[9]=Q*l+ne*y+he*M+se*V,i[10]=Q*u+ne*x+he*P+se*K,i[11]=Q*d+ne*E+he*D+se*oe,i[12]=(Q=t[12])*r+(ne=t[13])*p+(he=t[14])*C+(se=t[15])*O,i[13]=Q*l+ne*y+he*M+se*V,i[14]=Q*u+ne*x+he*P+se*K,i[15]=Q*d+ne*E+he*D+se*oe,i}function vu(i,e,t){var r,l,u,d,p,y,x,E,C,M,P,D,O=t[0],V=t[1],K=t[2];return e===i?(i[12]=e[0]*O+e[4]*V+e[8]*K+e[12],i[13]=e[1]*O+e[5]*V+e[9]*K+e[13],i[14]=e[2]*O+e[6]*V+e[10]*K+e[14],i[15]=e[3]*O+e[7]*V+e[11]*K+e[15]):(l=e[1],u=e[2],d=e[3],p=e[4],y=e[5],x=e[6],E=e[7],C=e[8],M=e[9],P=e[10],D=e[11],i[0]=r=e[0],i[1]=l,i[2]=u,i[3]=d,i[4]=p,i[5]=y,i[6]=x,i[7]=E,i[8]=C,i[9]=M,i[10]=P,i[11]=D,i[12]=r*O+p*V+C*K+e[12],i[13]=l*O+y*V+M*K+e[13],i[14]=u*O+x*V+P*K+e[14],i[15]=d*O+E*V+D*K+e[15]),i}function ka(i,e,t){var r=t[0],l=t[1],u=t[2];return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i[3]=e[3]*r,i[4]=e[4]*l,i[5]=e[5]*l,i[6]=e[6]*l,i[7]=e[7]*l,i[8]=e[8]*u,i[9]=e[9]*u,i[10]=e[10]*u,i[11]=e[11]*u,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function pp(i,e,t){var r=Math.sin(t),l=Math.cos(t),u=e[4],d=e[5],p=e[6],y=e[7],x=e[8],E=e[9],C=e[10],M=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=u*l+x*r,i[5]=d*l+E*r,i[6]=p*l+C*r,i[7]=y*l+M*r,i[8]=x*l-u*r,i[9]=E*l-d*r,i[10]=C*l-p*r,i[11]=M*l-y*r,i}function pd(i,e,t){var r=Math.sin(t),l=Math.cos(t),u=e[0],d=e[1],p=e[2],y=e[3],x=e[8],E=e[9],C=e[10],M=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=u*l-x*r,i[1]=d*l-E*r,i[2]=p*l-C*r,i[3]=y*l-M*r,i[8]=u*r+x*l,i[9]=d*r+E*l,i[10]=p*r+C*l,i[11]=y*r+M*l,i}function rg(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function og(i,e,t){var r,l,u,d=t[0],p=t[1],y=t[2],x=Math.hypot(d,p,y);return x<fd?null:(d*=x=1/x,p*=x,y*=x,r=Math.sin(e),l=Math.cos(e),i[0]=d*d*(u=1-l)+l,i[1]=p*d*u+y*r,i[2]=y*d*u-p*r,i[3]=0,i[4]=d*p*u-y*r,i[5]=p*p*u+l,i[6]=y*p*u+d*r,i[7]=0,i[8]=d*y*u+p*r,i[9]=p*y*u-d*r,i[10]=y*y*u+l,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var N1=Ol;function mp(){var i=new mr(3);return mr!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function sg(i){var e=new mr(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e}function bu(i){return Math.hypot(i[0],i[1],i[2])}function Ul(i,e,t){var r=new mr(3);return r[0]=i,r[1]=e,r[2]=t,r}function ks(i,e,t){return i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i}function _p(i,e,t){return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i}function ag(i,e,t){return i[0]=e[0]*t[0],i[1]=e[1]*t[1],i[2]=e[2]*t[2],i}function gp(i,e,t){return i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.min(e[2],t[2]),i}function yp(i,e,t){return i[0]=Math.max(e[0],t[0]),i[1]=Math.max(e[1],t[1]),i[2]=Math.max(e[2],t[2]),i}function Kr(i,e,t){return i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i}function md(i,e,t,r){return i[0]=e[0]+t[0]*r,i[1]=e[1]+t[1]*r,i[2]=e[2]+t[2]*r,i}function Xn(i,e){var t=e[0],r=e[1],l=e[2],u=t*t+r*r+l*l;return u>0&&(u=1/Math.sqrt(u)),i[0]=e[0]*u,i[1]=e[1]*u,i[2]=e[2]*u,i}function Rr(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function xp(i,e,t){var r=e[0],l=e[1],u=e[2],d=t[0],p=t[1],y=t[2];return i[0]=l*y-u*p,i[1]=u*d-r*y,i[2]=r*p-l*d,i}function un(i,e,t){var r=e[0],l=e[1],u=e[2],d=t[3]*r+t[7]*l+t[11]*u+t[15];return i[0]=(t[0]*r+t[4]*l+t[8]*u+t[12])/(d=d||1),i[1]=(t[1]*r+t[5]*l+t[9]*u+t[13])/d,i[2]=(t[2]*r+t[6]*l+t[10]*u+t[14])/d,i}function lg(i,e,t){var r=t[0],l=t[1],u=t[2],d=e[0],p=e[1],y=e[2],x=l*y-u*p,E=u*d-r*y,C=r*p-l*d,M=l*C-u*E,P=u*x-r*C,D=r*E-l*x,O=2*t[3];return E*=O,C*=O,P*=2,D*=2,i[0]=d+(x*=O)+(M*=2),i[1]=p+E+P,i[2]=y+C+D,i}var wu,Yr=_p,j1=ag,$1=bu;function cg(i,e,t){return i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i}function Pa(i,e,t){var r=e[0],l=e[1],u=e[2],d=e[3];return i[0]=t[0]*r+t[4]*l+t[8]*u+t[12]*d,i[1]=t[1]*r+t[5]*l+t[9]*u+t[13]*d,i[2]=t[2]*r+t[6]*l+t[10]*u+t[14]*d,i[3]=t[3]*r+t[7]*l+t[11]*u+t[15]*d,i}function ug(){var i=new mr(4);return mr!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function hg(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function dg(i,e,t){t*=.5;var r=e[0],l=e[1],u=e[2],d=e[3],p=Math.sin(t),y=Math.cos(t);return i[0]=r*y+d*p,i[1]=l*y+u*p,i[2]=u*y-l*p,i[3]=d*y-r*p,i}function fg(i,e,t){t*=.5;var r=e[0],l=e[1],u=e[2],d=e[3],p=Math.sin(t),y=Math.cos(t);return i[0]=r*y-u*p,i[1]=l*y+d*p,i[2]=u*y+r*p,i[3]=d*y-l*p,i}mp(),wu=new mr(4),mr!=Float32Array&&(wu[0]=0,wu[1]=0,wu[2]=0,wu[3]=0),mp(),Ul(1,0,0),Ul(0,1,0),ug(),ug(),ng();class vp{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,r){const l=Rr(t,this.dir);if(Math.abs(l)<1e-6)return!1;const u=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1]+(e[2]-this.pos[2])*t[2])/l;return r[0]=this.pos[0]+this.dir[0]*u,r[1]=this.pos[1]+this.dir[1]*u,r[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(e,t,r){if(function(P,D){var O=P[0],V=P[1],K=P[2],oe=D[0],Q=D[1],ne=D[2];return Math.abs(O-oe)<=fd*Math.max(1,Math.abs(O),Math.abs(oe))&&Math.abs(V-Q)<=fd*Math.max(1,Math.abs(V),Math.abs(Q))&&Math.abs(K-ne)<=fd*Math.max(1,Math.abs(K),Math.abs(ne))}(this.pos,e)||t===0)return r[0]=r[1]=r[2]=0,!1;const[l,u,d]=this.dir,p=this.pos[0]-e[0],y=this.pos[1]-e[1],x=this.pos[2]-e[2],E=l*l+u*u+d*d,C=2*(p*l+y*u+x*d),M=C*C-4*E*(p*p+y*y+x*x-t*t);if(M<0){const P=Math.max(-C/2,0),D=p+l*P,O=y+u*P,V=x+d*P,K=Math.hypot(D,O,V);return r[0]=D*t/K,r[1]=O*t/K,r[2]=V*t/K,!1}{const P=(-C-Math.sqrt(M))/(2*E);if(P<0){const D=Math.hypot(p,y,x);return r[0]=p*t/D,r[1]=y*t/D,r[2]=x*t/D,!1}return r[0]=p+l*P,r[1]=y+u*P,r[2]=x+d*P,!0}}}class bp{constructor(e,t,r,l,u){this.TL=e,this.TR=t,this.BR=r,this.BL=l,this.horizon=u}static fromInvProjectionMatrix(e,t,r){const l=[-1,1,1],u=[1,1,1],d=[1,-1,1],p=[-1,-1,1],y=un(l,l,e),x=un(u,u,e),E=un(d,d,e),C=un(p,p,e);return new bp(y,x,E,C,t/r)}}class wp{constructor(e,t){this.points=e,this.planes=t}static fromInvProjectionMatrix(e,t,r,l){const u=Math.pow(2,r),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(y=>{const x=Pa([],y,e),E=1/x[3]/t*u;return function(C,M,P){return C[0]=M[0]*P[0],C[1]=M[1]*P[1],C[2]=M[2]*P[2],C[3]=M[3]*P[3],C}(x,x,[E,E,l?1/x[3]:E,E])}),p=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(y=>{const x=Xn([],xp([],Yr([],d[y[0]],d[y[1]]),Yr([],d[y[2]],d[y[1]]))),E=-Rr(x,d[y[1]]);return x.concat(E)});return new wp(d,p)}}class ar{static fromPoints(e){const t=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],r=[Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE];for(const l of e)t[0]=Math.min(t[0],l[0]),t[1]=Math.min(t[1],l[1]),t[2]=Math.min(t[2],l[2]),r[0]=Math.max(r[0],l[0]),r[1]=Math.max(r[1],l[1]),r[2]=Math.max(r[2],l[2]);return new ar(t,r)}constructor(e,t){this.min=e,this.max=t,this.center=Kr([],ks([],this.min,this.max),.5)}quadrant(e){const t=[e%2==0,e<2],r=sg(this.min),l=sg(this.max);for(let u=0;u<t.length;u++)r[u]=t[u]?this.min[u]:this.center[u],l[u]=t[u]?this.center[u]:this.max[u];return l[2]=this.max[2],new ar(r,l)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){const t=this.getCorners();let r=!0;for(let l=0;l<e.planes.length;l++){const u=e.planes[l];let d=0;for(let p=0;p<t.length;p++)d+=Rr(u,t[p])+u[3]>=0;if(d===0)return 0;d!==t.length&&(r=!1)}if(r)return 2;for(let l=0;l<3;l++){let u=Number.MAX_VALUE,d=-Number.MAX_VALUE;for(let p=0;p<e.points.length;p++){const y=e.points[p][l]-this.min[l];u=Math.min(u,y),d=Math.max(d,y)}if(d<0||u>this.max[l]-this.min[l])return 0}return 1}}function pg(i,e,t,r,l,u,d,p,y){if(u&&i.queryGeometry.isAboveHorizon)return!1;u&&(y*=i.pixelToTileUnitsFactor);const x=i.tileID.canonical,E=t.projection.upVectorScale(x,t.center.lat,t.worldSize).metersToTile;for(const C of e)for(const M of C){const P=M.add(p),D=l&&t.elevation?t.elevation.exaggeration()*l.getElevationAt(P.x,P.y,!0):0,O=t.projection.projectTilePoint(P.x,P.y,x);if(D>0){const Q=t.projection.upVector(x,P.x,P.y);O.x+=Q[0]*E*D,O.y+=Q[1]*E*D,O.z+=Q[2]*E*D}const V=u?P:q1(O.x,O.y,O.z,r),K=u?i.tilespaceRays.map(Q=>Z1(Q,D)):i.queryGeometry.screenGeometry,oe=Pa([],[O.x,O.y,O.z,1],r);if(!d&&u?y*=oe[3]/t.cameraToCenterDistance:d&&!u&&(y*=t.cameraToCenterDistance/oe[3]),u){const Q=An((M.y/$t+x.y)/(1<<x.z));y/=t.projection.pixelsPerMeter(Q,1)/Dr(1,Q)}if(R1(K,V,y))return!0}return!1}function q1(i,e,t,r){const l=Pa([],[i,e,t,1],r);return new G(l[0]/l[3],l[1]/l[3])}const mg=Ul(0,0,0),G1=Ul(0,0,1);function Z1(i,e){const t=mp();return mg[2]=e,i.intersectsPlane(mg,G1,t),new G(t[0],t[1])}class _g extends up{}function gg(i,{width:e,height:t},r,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*t*r)throw new RangeError("mismatched image size")}else l=new Uint8Array(e*t*r);return i.width=e,i.height=t,i.data=l,i}function yg(i,e,t){const{width:r,height:l}=e;r===i.width&&l===i.height||(Tp(i,e,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,r),height:Math.min(i.height,l)},t),i.width=r,i.height=l,i.data=e.data)}function Tp(i,e,t,r,l,u){if(l.width===0||l.height===0)return e;if(l.width>i.width||l.height>i.height||t.x>i.width-l.width||t.y>i.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||r.x>e.width-l.width||r.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const d=i.data,p=e.data;for(let y=0;y<l.height;y++){const x=((t.y+y)*i.width+t.x)*u,E=((r.y+y)*e.width+r.x)*u;for(let C=0;C<l.width*u;C++)p[E+C]=d[x+C]}return e}At(_g,"HeatmapBucket",{omit:["layers"]});class Ko{constructor(e,t){gg(this,e,1,t)}resize(e){yg(this,new Ko(e),1)}clone(){return new Ko({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,r,l,u){Tp(e,t,r,l,u,1)}}class _r{constructor(e,t){gg(this,e,4,t)}resize(e){yg(this,new _r(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new _r({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,r,l,u){Tp(e,t,r,l,u,4)}}At(Ko,"AlphaImage"),At(_r,"RGBAImage");var W1={paint:new Ve({"heatmap-radius":new me(Re.paint_heatmap["heatmap-radius"]),"heatmap-weight":new me(Re.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ae(Re.paint_heatmap["heatmap-intensity"]),"heatmap-color":new xe(Re.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ae(Re.paint_heatmap["heatmap-opacity"])})};function Ep(i){const e={},t=i.resolution||256,r=i.clips?i.clips.length:1,l=i.image||new _r({width:t,height:r}),u=(d,p,y)=>{e[i.evaluationKey]=y;const x=i.expression.evaluate(e);l.data[d+p+0]=Math.floor(255*x.r/x.a),l.data[d+p+1]=Math.floor(255*x.g/x.a),l.data[d+p+2]=Math.floor(255*x.b/x.a),l.data[d+p+3]=Math.floor(255*x.a)};if(i.clips)for(let d=0,p=0;d<r;++d,p+=4*t)for(let y=0,x=0;y<t;y++,x+=4){const E=y/(t-1),{start:C,end:M}=i.clips[d];u(p,x,C*(1-E)+M*E)}else for(let d=0,p=0;d<t;d++,p+=4)u(0,p,d/(t-1));return l}var X1={paint:new Ve({"hillshade-illumination-direction":new ae(Re.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ae(Re.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ae(Re.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ae(Re.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ae(Re.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ae(Re.paint_hillshade["hillshade-accent-color"])})};const H1=qe([{name:"a_pos",components:2,type:"Int16"}],4),{members:K1}=H1;var _d=gd,Y1=gd;function gd(i,e,t){t=t||2;var r,l,u,d,p,y,x,E=e&&e.length,C=E?e[0]*t:i.length,M=xg(i,0,C,t,!0),P=[];if(!M||M.next===M.prev)return P;if(E&&(M=function(O,V,K,oe){var Q,ne,he,se=[];for(Q=0,ne=V.length;Q<ne;Q++)(he=xg(O,V[Q]*oe,Q<ne-1?V[Q+1]*oe:O.length,oe,!1))===he.next&&(he.steiner=!0),se.push(ob(he));for(se.sort(ib),Q=0;Q<se.length;Q++)K=nb(se[Q],K);return K}(i,e,M,t)),i.length>80*t){r=u=i[0],l=d=i[1];for(var D=t;D<C;D+=t)(p=i[D])<r&&(r=p),(y=i[D+1])<l&&(l=y),p>u&&(u=p),y>d&&(d=y);x=(x=Math.max(u-r,d-l))!==0?32767/x:0}return Tu(M,P,t,r,l,x,0),P}function xg(i,e,t,r,l){var u,d;if(l===Ap(i,e,t,r)>0)for(u=e;u<t;u+=r)d=wg(u,i[u],i[u+1],d);else for(u=t-r;u>=e;u-=r)d=wg(u,i[u],i[u+1],d);return d&&yd(d,d.next)&&(Su(d),d=d.next),d}function Da(i,e){if(!i)return i;e||(e=i);var t,r=i;do if(t=!1,r.steiner||!yd(r,r.next)&&on(r.prev,r,r.next)!==0)r=r.next;else{if(Su(r),(r=e=r.prev)===r.next)break;t=!0}while(t||r!==e);return e}function Tu(i,e,t,r,l,u,d){if(i){!d&&u&&function(E,C,M,P){var D=E;do D.z===0&&(D.z=Sp(D.x,D.y,C,M,P)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==E);D.prevZ.nextZ=null,D.prevZ=null,function(O){var V,K,oe,Q,ne,he,se,ke,Ae=1;do{for(K=O,O=null,ne=null,he=0;K;){for(he++,oe=K,se=0,V=0;V<Ae&&(se++,oe=oe.nextZ);V++);for(ke=Ae;se>0||ke>0&&oe;)se!==0&&(ke===0||!oe||K.z<=oe.z)?(Q=K,K=K.nextZ,se--):(Q=oe,oe=oe.nextZ,ke--),ne?ne.nextZ=Q:O=Q,Q.prevZ=ne,ne=Q;K=oe}ne.nextZ=null,Ae*=2}while(he>1)}(D)}(i,r,l,u);for(var p,y,x=i;i.prev!==i.next;)if(p=i.prev,y=i.next,u?Q1(i,r,l,u):J1(i))e.push(p.i/t|0),e.push(i.i/t|0),e.push(y.i/t|0),Su(i),i=y.next,x=y.next;else if((i=y)===x){d?d===1?Tu(i=eb(Da(i),e,t),e,t,r,l,u,2):d===2&&tb(i,e,t,r,l,u):Tu(Da(i),e,t,r,l,u,1);break}}}function J1(i){var e=i.prev,t=i,r=i.next;if(on(e,t,r)>=0)return!1;for(var l=e.x,u=t.x,d=r.x,p=e.y,y=t.y,x=r.y,E=l<u?l<d?l:d:u<d?u:d,C=p<y?p<x?p:x:y<x?y:x,M=l>u?l>d?l:d:u>d?u:d,P=p>y?p>x?p:x:y>x?y:x,D=r.next;D!==e;){if(D.x>=E&&D.x<=M&&D.y>=C&&D.y<=P&&Vl(l,p,u,y,d,x,D.x,D.y)&&on(D.prev,D,D.next)>=0)return!1;D=D.next}return!0}function Q1(i,e,t,r){var l=i.prev,u=i,d=i.next;if(on(l,u,d)>=0)return!1;for(var p=l.x,y=u.x,x=d.x,E=l.y,C=u.y,M=d.y,P=p<y?p<x?p:x:y<x?y:x,D=E<C?E<M?E:M:C<M?C:M,O=p>y?p>x?p:x:y>x?y:x,V=E>C?E>M?E:M:C>M?C:M,K=Sp(P,D,e,t,r),oe=Sp(O,V,e,t,r),Q=i.prevZ,ne=i.nextZ;Q&&Q.z>=K&&ne&&ne.z<=oe;){if(Q.x>=P&&Q.x<=O&&Q.y>=D&&Q.y<=V&&Q!==l&&Q!==d&&Vl(p,E,y,C,x,M,Q.x,Q.y)&&on(Q.prev,Q,Q.next)>=0||(Q=Q.prevZ,ne.x>=P&&ne.x<=O&&ne.y>=D&&ne.y<=V&&ne!==l&&ne!==d&&Vl(p,E,y,C,x,M,ne.x,ne.y)&&on(ne.prev,ne,ne.next)>=0))return!1;ne=ne.nextZ}for(;Q&&Q.z>=K;){if(Q.x>=P&&Q.x<=O&&Q.y>=D&&Q.y<=V&&Q!==l&&Q!==d&&Vl(p,E,y,C,x,M,Q.x,Q.y)&&on(Q.prev,Q,Q.next)>=0)return!1;Q=Q.prevZ}for(;ne&&ne.z<=oe;){if(ne.x>=P&&ne.x<=O&&ne.y>=D&&ne.y<=V&&ne!==l&&ne!==d&&Vl(p,E,y,C,x,M,ne.x,ne.y)&&on(ne.prev,ne,ne.next)>=0)return!1;ne=ne.nextZ}return!0}function eb(i,e,t){var r=i;do{var l=r.prev,u=r.next.next;!yd(l,u)&&vg(l,r,r.next,u)&&Eu(l,u)&&Eu(u,l)&&(e.push(l.i/t|0),e.push(r.i/t|0),e.push(u.i/t|0),Su(r),Su(r.next),r=i=u),r=r.next}while(r!==i);return Da(r)}function tb(i,e,t,r,l,u){var d=i;do{for(var p=d.next.next;p!==d.prev;){if(d.i!==p.i&&sb(d,p)){var y=bg(d,p);return d=Da(d,d.next),y=Da(y,y.next),Tu(d,e,t,r,l,u,0),void Tu(y,e,t,r,l,u,0)}p=p.next}d=d.next}while(d!==i)}function ib(i,e){return i.x-e.x}function nb(i,e){var t=function(l,u){var d,p=u,y=l.x,x=l.y,E=-1/0;do{if(x<=p.y&&x>=p.next.y&&p.next.y!==p.y){var C=p.x+(x-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(C<=y&&C>E&&(E=C,d=p.x<p.next.x?p:p.next,C===y))return d}p=p.next}while(p!==u);if(!d)return null;var M,P=d,D=d.x,O=d.y,V=1/0;p=d;do y>=p.x&&p.x>=D&&y!==p.x&&Vl(x<O?y:E,x,D,O,x<O?E:y,x,p.x,p.y)&&(M=Math.abs(x-p.y)/(y-p.x),Eu(p,l)&&(M<V||M===V&&(p.x>d.x||p.x===d.x&&rb(d,p)))&&(d=p,V=M)),p=p.next;while(p!==P);return d}(i,e);if(!t)return e;var r=bg(t,i);return Da(r,r.next),Da(t,t.next)}function rb(i,e){return on(i.prev,i,e.prev)<0&&on(e.next,i,i.next)<0}function Sp(i,e,t,r,l){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-t)*l|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*l|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ob(i){var e=i,t=i;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==i);return t}function Vl(i,e,t,r,l,u,d,p){return(l-d)*(e-p)>=(i-d)*(u-p)&&(i-d)*(r-p)>=(t-d)*(e-p)&&(t-d)*(u-p)>=(l-d)*(r-p)}function sb(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(t,r){var l=t;do{if(l.i!==t.i&&l.next.i!==t.i&&l.i!==r.i&&l.next.i!==r.i&&vg(l,l.next,t,r))return!0;l=l.next}while(l!==t);return!1}(i,e)&&(Eu(i,e)&&Eu(e,i)&&function(t,r){var l=t,u=!1,d=(t.x+r.x)/2,p=(t.y+r.y)/2;do l.y>p!=l.next.y>p&&l.next.y!==l.y&&d<(l.next.x-l.x)*(p-l.y)/(l.next.y-l.y)+l.x&&(u=!u),l=l.next;while(l!==t);return u}(i,e)&&(on(i.prev,i,e.prev)||on(i,e.prev,e))||yd(i,e)&&on(i.prev,i,i.next)>0&&on(e.prev,e,e.next)>0)}function on(i,e,t){return(e.y-i.y)*(t.x-e.x)-(e.x-i.x)*(t.y-e.y)}function yd(i,e){return i.x===e.x&&i.y===e.y}function vg(i,e,t,r){var l=vd(on(i,e,t)),u=vd(on(i,e,r)),d=vd(on(t,r,i)),p=vd(on(t,r,e));return l!==u&&d!==p||!(l!==0||!xd(i,t,e))||!(u!==0||!xd(i,r,e))||!(d!==0||!xd(t,i,r))||!(p!==0||!xd(t,e,r))}function xd(i,e,t){return e.x<=Math.max(i.x,t.x)&&e.x>=Math.min(i.x,t.x)&&e.y<=Math.max(i.y,t.y)&&e.y>=Math.min(i.y,t.y)}function vd(i){return i>0?1:i<0?-1:0}function Eu(i,e){return on(i.prev,i,i.next)<0?on(i,e,i.next)>=0&&on(i,i.prev,e)>=0:on(i,e,i.prev)<0||on(i,i.next,e)<0}function bg(i,e){var t=new Cp(i.i,i.x,i.y),r=new Cp(e.i,e.x,e.y),l=i.next,u=e.prev;return i.next=e,e.prev=i,t.next=l,l.prev=t,r.next=t,t.prev=r,u.next=r,r.prev=u,r}function wg(i,e,t,r){var l=new Cp(i,e,t);return r?(l.next=r.next,l.prev=r,r.next.prev=l,r.next=l):(l.prev=l,l.next=l),l}function Su(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Cp(i,e,t){this.i=i,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ap(i,e,t,r){for(var l=0,u=e,d=t-r;u<t;u+=r)l+=(i[d]-i[u])*(i[u+1]+i[d+1]),d=u;return l}function ab(i,e,t,r,l){Tg(i,e,t||0,r||i.length-1,l||lb)}function Tg(i,e,t,r,l){for(;r>t;){if(r-t>600){var u=r-t+1,d=e-t+1,p=Math.log(u),y=.5*Math.exp(2*p/3),x=.5*Math.sqrt(p*y*(u-y)/u)*(d-u/2<0?-1:1);Tg(i,e,Math.max(t,Math.floor(e-d*y/u+x)),Math.min(r,Math.floor(e+(u-d)*y/u+x)),l)}var E=i[e],C=t,M=r;for(Cu(i,t,e),l(i[r],E)>0&&Cu(i,t,r);C<M;){for(Cu(i,C,M),C++,M--;l(i[C],E)<0;)C++;for(;l(i[M],E)>0;)M--}l(i[t],E)===0?Cu(i,t,M):Cu(i,++M,r),M<=e&&(t=M+1),e<=M&&(r=M-1)}}function Cu(i,e,t){var r=i[e];i[e]=i[t],i[t]=r}function lb(i,e){return i<e?-1:i>e?1:0}function Mp(i,e){const t=i.length;if(t<=1)return[i];const r=[];let l,u;for(let d=0;d<t;d++){const p=kn(i[d]);p!==0&&(i[d].area=Math.abs(p),u===void 0&&(u=p<0),u===p<0?(l&&r.push(l),l=[i[d]]):l.push(i[d]))}if(l&&r.push(l),e>1)for(let d=0;d<r.length;d++)r[d].length<=e||(ab(r[d],e,1,r[d].length-1,cb),r[d]=r[d].slice(0,e));return r}function cb(i,e){return e.area-i.area}function Ip(i,e,t){const r=t.patternDependencies;let l=!1;for(const u of e){const d=u.paint.get(`${i}-pattern`);d.isConstant()||(l=!0);const p=d.constantOr(null);p&&(l=!0,r[p.to]=!0,r[p.from]=!0)}return l}function zp(i,e,t,r,l){const u=l.patternDependencies;for(const d of e){const p=d.paint.get(`${i}-pattern`).value;if(p.kind!=="constant"){let y=p.evaluate({zoom:r-1},t,{},l.availableImages),x=p.evaluate({zoom:r},t,{},l.availableImages),E=p.evaluate({zoom:r+1},t,{},l.availableImages);y=y&&y.name?y.name:y,x=x&&x.name?x.name:x,E=E&&E.name?E.name:E,u[y]=!0,u[x]=!0,u[E]=!0,t.patterns[d.id]={min:y,mid:x,max:E}}}return t}gd.deviation=function(i,e,t,r){var l=e&&e.length,u=Math.abs(Ap(i,0,l?e[0]*t:i.length,t));if(l)for(var d=0,p=e.length;d<p;d++)u-=Math.abs(Ap(i,e[d]*t,d<p-1?e[d+1]*t:i.length,t));var y=0;for(d=0;d<r.length;d+=3){var x=r[d]*t,E=r[d+1]*t,C=r[d+2]*t;y+=Math.abs((i[x]-i[C])*(i[E+1]-i[x+1])-(i[x]-i[E])*(i[C+1]-i[x+1]))}return u===0&&y===0?0:Math.abs((y-u)/u)},gd.flatten=function(i){for(var e=i[0][0].length,t={vertices:[],holes:[],dimensions:e},r=0,l=0;l<i.length;l++){for(var u=0;u<i[l].length;u++)for(var d=0;d<e;d++)t.vertices.push(i[l][u][d]);l>0&&t.holes.push(r+=i[l-1].length)}return t},_d.default=Y1;class bd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new _t,this.indexArray=new ti,this.indexArray2=new Rn,this.programConfigurations=new Ma(e.layers,e.zoom),this.segments=new sn,this.segments2=new sn,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.projection=e.projection}populate(e,t,r,l){this.hasPattern=Ip("fill",this.layers,t);const u=this.layers[0].layout.get("fill-sort-key"),d=[];for(const{feature:p,id:y,index:x,sourceLayerIndex:E}of e){const C=this.layers[0]._featureFilter.needGeometry,M=Ia(p,C);if(!this.layers[0]._featureFilter.filter(new $(this.zoom),M,r))continue;const P=u?u.evaluate(M,{},r,t.availableImages):void 0,D={id:y,properties:p.properties,type:p.type,sourceLayerIndex:E,index:x,geometry:C?M.geometry:Ho(p,r,l),patterns:{},sortKey:P};d.push(D)}u&&d.sort((p,y)=>p.sortKey-y.sortKey);for(const p of d){const{geometry:y,index:x,sourceLayerIndex:E}=p;if(this.hasPattern){const C=zp("fill",this.layers,p,this.zoom,t);this.patternFeatures.push(C)}else this.addFeature(p,y,x,r,{},t.availableImages);t.featureIndex.insert(e[x].feature,y,x,E,this.index)}}update(e,t,r,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r,l)}addFeatures(e,t,r,l,u){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,t,r,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,K1),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,r,l,u,d=[]){for(const p of Mp(t,500)){let y=0;for(const D of p)y+=D.length;const x=this.segments.prepareSegment(y,this.layoutVertexArray,this.indexArray),E=x.vertexLength,C=[],M=[];for(const D of p){if(D.length===0)continue;D!==p[0]&&M.push(C.length/2);const O=this.segments2.prepareSegment(D.length,this.layoutVertexArray,this.indexArray2),V=O.vertexLength;this.layoutVertexArray.emplaceBack(D[0].x,D[0].y),this.indexArray2.emplaceBack(V+D.length-1,V),C.push(D[0].x),C.push(D[0].y);for(let K=1;K<D.length;K++)this.layoutVertexArray.emplaceBack(D[K].x,D[K].y),this.indexArray2.emplaceBack(V+K-1,V+K),C.push(D[K].x),C.push(D[K].y);O.vertexLength+=D.length,O.primitiveLength+=D.length}const P=_d(C,M);for(let D=0;D<P.length;D+=3)this.indexArray.emplaceBack(E+P[D],E+P[D+1],E+P[D+2]);x.vertexLength+=y,x.primitiveLength+=P.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,u,d,l)}}At(bd,"FillBucket",{omit:["layers","patternFeatures"]});const ub=new Ve({"fill-sort-key":new me(Re.layout_fill["fill-sort-key"])});var hb={paint:new Ve({"fill-antialias":new ae(Re.paint_fill["fill-antialias"]),"fill-opacity":new me(Re.paint_fill["fill-opacity"]),"fill-color":new me(Re.paint_fill["fill-color"]),"fill-outline-color":new me(Re.paint_fill["fill-outline-color"]),"fill-translate":new ae(Re.paint_fill["fill-translate"]),"fill-translate-anchor":new ae(Re.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ce(Re.paint_fill["fill-pattern"])}),layout:ub};const db=qe([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),fb=qe([{name:"a_centroid_pos",components:2,type:"Uint16"}]),pb=qe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:mb}=db;var Eg=Nl;function Nl(i,e,t,r,l){this.properties={},this.extent=t,this.type=0,this._pbf=i,this._geometry=-1,this._keys=r,this._values=l,i.readFields(_b,this,e)}function _b(i,e,t){i==1?e.id=t.readVarint():i==2?function(r,l){for(var u=r.readVarint()+r.pos;r.pos<u;){var d=l._keys[r.readVarint()],p=l._values[r.readVarint()];l.properties[d]=p}}(t,e):i==3?e.type=t.readVarint():i==4&&(e._geometry=t.pos)}function gb(i){for(var e,t,r=0,l=0,u=i.length,d=u-1;l<u;d=l++)r+=((t=i[d]).x-(e=i[l]).x)*(e.y+t.y);return r}Nl.types=["Unknown","Point","LineString","Polygon"],Nl.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,t=i.readVarint()+i.pos,r=1,l=0,u=0,d=0,p=[];i.pos<t;){if(l<=0){var y=i.readVarint();r=7&y,l=y>>3}if(l--,r===1||r===2)u+=i.readSVarint(),d+=i.readSVarint(),r===1&&(e&&p.push(e),e=[]),e.push(new G(u,d));else{if(r!==7)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&p.push(e),p},Nl.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,t=1,r=0,l=0,u=0,d=1/0,p=-1/0,y=1/0,x=-1/0;i.pos<e;){if(r<=0){var E=i.readVarint();t=7&E,r=E>>3}if(r--,t===1||t===2)(l+=i.readSVarint())<d&&(d=l),l>p&&(p=l),(u+=i.readSVarint())<y&&(y=u),u>x&&(x=u);else if(t!==7)throw new Error("unknown command "+t)}return[d,y,p,x]},Nl.prototype.toGeoJSON=function(i,e,t){var r,l,u=this.extent*Math.pow(2,t),d=this.extent*i,p=this.extent*e,y=this.loadGeometry(),x=Nl.types[this.type];function E(P){for(var D=0;D<P.length;D++){var O=P[D];P[D]=[360*(O.x+d)/u-180,360/Math.PI*Math.atan(Math.exp((180-360*(O.y+p)/u)*Math.PI/180))-90]}}switch(this.type){case 1:var C=[];for(r=0;r<y.length;r++)C[r]=y[r][0];E(y=C);break;case 2:for(r=0;r<y.length;r++)E(y[r]);break;case 3:for(y=function(P){var D=P.length;if(D<=1)return[P];for(var O,V,K=[],oe=0;oe<D;oe++){var Q=gb(P[oe]);Q!==0&&(V===void 0&&(V=Q<0),V===Q<0?(O&&K.push(O),O=[P[oe]]):O.push(P[oe]))}return O&&K.push(O),K}(y),r=0;r<y.length;r++)for(l=0;l<y[r].length;l++)E(y[r][l])}y.length===1?y=y[0]:x="Multi"+x;var M={type:"Feature",geometry:{type:x,coordinates:y},properties:this.properties};return"id"in this&&(M.id=this.id),M};var Sg=Cg;function Cg(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(yb,this,e),this.length=this._features.length}function yb(i,e,t){i===15?e.version=t.readVarint():i===1?e.name=t.readString():i===5?e.extent=t.readVarint():i===2?e._features.push(t.pos):i===3?e._keys.push(t.readString()):i===4&&e._values.push(function(r){for(var l=null,u=r.readVarint()+r.pos;r.pos<u;){var d=r.readVarint()>>3;l=d===1?r.readString():d===2?r.readFloat():d===3?r.readDouble():d===4?r.readVarint64():d===5?r.readVarint():d===6?r.readSVarint():d===7?r.readBoolean():null}return l}(t))}function xb(i,e,t){if(i===3){var r=new Sg(t,t.readVarint()+t.pos);r.length&&(e[r.name]=r)}}Cg.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new Eg(this._pbf,e,this.extent,this._keys,this._values)};var La={VectorTile:function(i,e){this.layers=i.readFields(xb,{},e)},VectorTileFeature:Eg,VectorTileLayer:Sg};function wd(i,e,t,r){const l=[],u=r===0?(d,p,y,x,E,C)=>{d.push(new G(C,y+(C-p)/(x-p)*(E-y)))}:(d,p,y,x,E,C)=>{d.push(new G(p+(C-y)/(E-y)*(x-p),C))};for(const d of i){const p=[];for(const y of d){if(y.length<=2)continue;const x=[];for(let M=0;M<y.length-1;M++){const P=y[M].x,D=y[M].y,O=y[M+1].x,V=y[M+1].y,K=r===0?P:D,oe=r===0?O:V;K<e?oe>e&&u(x,P,D,O,V,e):K>t?oe<t&&u(x,P,D,O,V,t):x.push(y[M]),oe<e&&K>=e&&u(x,P,D,O,V,e),oe>t&&K<=t&&u(x,P,D,O,V,t)}let E=y[y.length-1];const C=r===0?E.x:E.y;C>=e&&C<=t&&x.push(E),x.length&&(E=x[x.length-1],x[0].x===E.x&&x[0].y===E.y||x.push(x[0]),p.push(x))}p.length&&l.push(p)}return l}const vb=La.VectorTileFeature.types,bb=Math.pow(2,13);function Au(i,e,t,r,l,u,d,p){i.emplaceBack((e<<1)+d,(t<<1)+u,(Math.floor(r*bb)<<1)+l,Math.round(p))}function Mu(i,e,t){i.emplaceBack(e.x,e.y,e.z,t[0]*16384,t[1]*16384,t[2]*16384)}class Ag{constructor(){this.acc=new G(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new G(e.x,e.y),this.max=new G(e.x,e.y))}append(e,t){this.currentPolyCount.edges++,this.acc._add(e);const r=this.min,l=this.max;e.x<r.x?r.x=e.x:e.x>l.x&&(l.x=e.x),e.y<r.y?r.y=e.y:e.y>l.y&&(l.y=e.y),((e.x===0||e.x===$t)&&e.x===t.x)!=((e.y===0||e.y===$t)&&e.y===t.y)&&this.processBorderOverlap(e,t),t.x<0!=e.x<0&&this.addBorderIntersection(0,fi(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>$t!=e.x>$t&&this.addBorderIntersection(1,fi(t.y,e.y,($t-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,fi(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>$t!=e.y>$t&&this.addBorderIntersection(3,fi(t.x,e.x,($t-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const r=this.borders[e];t<r[0]&&(r[0]=t),t>r[1]&&(r[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const r=e.x===0?0:1;this.addBorderIntersection(r,t.y),this.addBorderIntersection(r,e.y)}else{const r=e.y===0?2:3;this.addBorderIntersection(r,t.x),this.addBorderIntersection(r,e.x)}}centroid(){const e=this.polyCount.reduce((t,r)=>t+r.edges,0);return e!==0?this.acc.div(e)._round():new G(0,0)}span(){return new G(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,t)=>e+ +(t[0]!==Number.MAX_VALUE),0)}}class Iu{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new Lt,this.centroidVertexArray=new F_,this.indexArray=new ti,this.programConfigurations=new Ma(e.layers,e.zoom),this.segments=new sn,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.enableTerrain=e.enableTerrain}populate(e,t,r,l){this.features=[],this.hasPattern=Ip("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(u){const d=Math.exp(Math.PI*(1-u.y/(1<<u.z)*2));return 80150034*d/(d*d+1)/$t/(1<<u.z)}(r),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:u,id:d,index:p,sourceLayerIndex:y}of e){const x=this.layers[0]._featureFilter.needGeometry,E=Ia(u,x);if(!this.layers[0]._featureFilter.filter(new $(this.zoom),E,r))continue;const C={id:d,sourceLayerIndex:y,index:p,geometry:x?E.geometry:Ho(u,r,l),properties:u.properties,type:u.type,patterns:{}},M=this.layoutVertexArray.length;this.hasPattern?this.features.push(zp("fill-extrusion",this.layers,C,this.zoom,t)):this.addFeature(C,C.geometry,p,r,{},t.availableImages,l),t.featureIndex.insert(u,C.geometry,p,y,this.index,M)}this.sortBorders()}addFeatures(e,t,r,l,u){for(const d of this.features){const{geometry:p}=d;this.addFeature(d,p,d.index,t,r,l,u)}this.sortBorders()}update(e,t,r,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,mb),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,pb.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,fb.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,r,l,u,d,p){const y=[new G(0,0),new G($t,$t)],x=p.projection,E=x.name==="globe",C=this.enableTerrain&&!E?new Ag:null,M=vb[e.type]==="Polygon";E&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Bn);const P=Mp(t,500);for(let K=P.length-1;K>=0;K--){const oe=P[K];(oe.length===0||(D=oe[0]).every(Q=>Q.x<=0)||D.every(Q=>Q.x>=$t)||D.every(Q=>Q.y<=0)||D.every(Q=>Q.y>=$t))&&P.splice(K,1)}var D;let O;if(E)O=Lg(P,y,l);else{O=[];for(const K of P)O.push({polygon:K,bounds:y})}const V=M?this.edgeRadius:0;for(const{polygon:K,bounds:oe}of O){let Q=0,ne=0;for(const se of K)M&&!se[0].equals(se[se.length-1])&&se.push(se[0]),ne+=M?se.length-1:se.length;const he=this.segments.prepareSegment((M?5:4)*ne,this.layoutVertexArray,this.indexArray);if(M){const se=[],ke=[];Q=he.vertexLength;for(const Oe of K){let ut,De;Oe.length&&Oe!==K[0]&&ke.push(se.length/2),ut=Oe[1].sub(Oe[0])._perp()._unit();for(let je=1;je<Oe.length;je++){const Xe=Oe[je],$e=Oe[je===Oe.length-1?1:je+1];let{x:st,y:He}=Xe;if(V){De=$e.sub(Xe)._perp()._unit();const bt=ut.add(De)._unit(),Ht=V*Math.min(4,1/(ut.x*bt.x+ut.y*bt.y));st+=Ht*bt.x,He+=Ht*bt.y,ut=De}Au(this.layoutVertexArray,st,He,0,0,1,1,0),he.vertexLength++,se.push(Xe.x,Xe.y),E&&Mu(this.layoutVertexExtArray,x.projectTilePoint(st,He,l),x.upVector(l,st,He))}}const Ae=_d(se,ke);for(let Oe=0;Oe<Ae.length;Oe+=3)this.indexArray.emplaceBack(Q+Ae[Oe],Q+Ae[Oe+2],Q+Ae[Oe+1]),he.primitiveLength++}for(const se of K){C&&se.length&&C.startRing(se[0]);let ke,Ae,Oe,ut=se.length>4&&kg(se[se.length-2],se[0],se[1]),De=V?wb(se[se.length-2],se[0],se[1],V):0;Ae=se[1].sub(se[0])._perp()._unit();for(let je=1,Xe=0;je<se.length;je++){let $e=se[je-1],st=se[je];const He=se[je===se.length-1?1:je+1];if(C&&M&&C.currentPolyCount.top++,zg(st,$e,oe)){V&&(Ae=He.sub(st)._perp()._unit());continue}C&&C.append(st,$e);const bt=st.sub($e)._perp(),Ht=bt.x/(Math.abs(bt.x)+Math.abs(bt.y)),Yt=bt.y>0?1:0,Dt=$e.dist(st);if(Xe+Dt>32768&&(Xe=0),V){Oe=He.sub(st)._perp()._unit();let St=Ig($e,st,He,Mg(Ae,Oe),V);isNaN(St)&&(St=0);const Fi=st.sub($e)._unit();$e=$e.add(Fi.mult(De))._round(),st=st.add(Fi.mult(-St))._round(),De=St,Ae=Oe}const mt=he.vertexLength,ci=se.length>4&&kg($e,st,He);let Gt=Pg(Xe,ut,!0);if(Au(this.layoutVertexArray,$e.x,$e.y,Ht,Yt,0,0,Gt),Au(this.layoutVertexArray,$e.x,$e.y,Ht,Yt,0,1,Gt),Xe+=Dt,Gt=Pg(Xe,ci,!1),ut=ci,Au(this.layoutVertexArray,st.x,st.y,Ht,Yt,0,0,Gt),Au(this.layoutVertexArray,st.x,st.y,Ht,Yt,0,1,Gt),he.vertexLength+=4,this.indexArray.emplaceBack(mt+0,mt+1,mt+2),this.indexArray.emplaceBack(mt+1,mt+3,mt+2),he.primitiveLength+=2,V){const St=Q+(je===1?se.length-2:je-2),Fi=je===1?Q:St+1;if(this.indexArray.emplaceBack(mt+1,St,mt+3),this.indexArray.emplaceBack(St,Fi,mt+3),he.primitiveLength+=2,ke===void 0&&(ke=mt),!zg(He,se[je],oe)){const ki=je===se.length-1?ke:he.vertexLength;this.indexArray.emplaceBack(mt+2,mt+3,ki),this.indexArray.emplaceBack(mt+3,ki+1,ki),this.indexArray.emplaceBack(mt+3,Fi,ki+1),he.primitiveLength+=3}}if(E){const St=this.layoutVertexExtArray,Fi=x.projectTilePoint($e.x,$e.y,l),ki=x.projectTilePoint(st.x,st.y,l),qi=x.upVector(l,$e.x,$e.y),Qt=x.upVector(l,st.x,st.y);Mu(St,Fi,qi),Mu(St,Fi,qi),Mu(St,ki,Qt),Mu(St,ki,Qt)}}M&&(Q+=se.length-1)}}if(C&&C.polyCount.length>0){if(C.borders){C.vertexArrayOffset=this.centroidVertexArray.length;const K=C.borders,oe=this.featuresOnBorder.push(C)-1;for(let Q=0;Q<4;Q++)K[Q][0]!==Number.MAX_VALUE&&this.borders[Q].push(oe)}this.encodeCentroid(C.borders?void 0:C.centroid(),C)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,u,d,l)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((t,r)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[r].borders[e][0])}encodeCentroid(e,t,r=!0){let l,u;if(e)if(e.y!==0){const p=t.span()._mult(this.tileToMeter);l=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(p.x/10)),u=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(p.y/10))}else l=Math.ceil(7*(e.x+450)),u=0;else l=0,u=+r;let d=r?this.centroidVertexArray.length:t.vertexArrayOffset;for(const p of t.polyCount){r&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*p.edges+p.top);for(let y=0;y<p.top;y++)this.centroidVertexArray.emplace(d++,l,u);for(let y=0;y<2*p.edges;y++)this.centroidVertexArray.emplace(d++,0,u),this.centroidVertexArray.emplace(d++,l,u)}}}function Mg(i,e){const t=i.add(e)._unit();return i.x*t.x+i.y*t.y}function wb(i,e,t,r){const l=e.sub(i)._perp()._unit(),u=t.sub(e)._perp()._unit();return Ig(i,e,t,Mg(l,u),r)}function Ig(i,e,t,r,l){const u=Math.sqrt(1-r*r);return Math.min(i.dist(e)/3,e.dist(t)/3,l*u/r)}function zg(i,e,t){return i.x<t[0].x&&e.x<t[0].x||i.x>t[1].x&&e.x>t[1].x||i.y<t[0].y&&e.y<t[0].y||i.y>t[1].y&&e.y>t[1].y}function kg(i,e,t){if(i.x<0||i.x>=$t||e.x<0||e.x>=$t||t.x<0||t.x>=$t)return!1;const r=t.sub(e),l=r.perp(),u=i.sub(e);return(r.x*u.x+r.y*u.y)/Math.sqrt((r.x*r.x+r.y*r.y)*(u.x*u.x+u.y*u.y))>-.866&&l.x*u.x+l.y*u.y<0}function Pg(i,e,t){const r=e?2|i:-3&i;return t?1|r:-2&r}function Dg(){const i=Math.PI/32,e=Math.tan(i),t=op;return t*Math.sqrt(1+2*e*e)-t}function Lg(i,e,t){const r=1<<t.z,l=Lr(t.x/r),u=Lr((t.x+1)/r),d=An(t.y/r),p=An((t.y+1)/r);return function(y,x,E,C,M=0,P){const D=[];if(!y.length||!E||!C)return D;const O=(se,ke)=>{for(const Ae of se)D.push({polygon:Ae,bounds:ke})},V=Math.ceil(Math.log2(E)),K=Math.ceil(Math.log2(C)),oe=V-K,Q=[];for(let se=0;se<Math.abs(oe);se++)Q.push(oe>0?0:1);for(let se=0;se<Math.min(V,K);se++)Q.push(0),Q.push(1);let ne=y;if(ne=wd(ne,x[0].y-M,x[1].y+M,1),ne=wd(ne,x[0].x-M,x[1].x+M,0),!ne.length)return D;const he=[];for(Q.length?he.push({polygons:ne,bounds:x,depth:0}):O(ne,x);he.length;){const se=he.pop(),ke=se.depth,Ae=Q[ke],Oe=se.bounds[0],ut=se.bounds[1],De=Ae===0?Oe.x:Oe.y,je=Ae===0?ut.x:ut.y,Xe=P?P(Ae,De,je):.5*(De+je),$e=wd(se.polygons,De-M,Xe+M,Ae),st=wd(se.polygons,Xe-M,je+M,Ae);if($e.length){const He=[Oe,new G(Ae===0?Xe:ut.x,Ae===1?Xe:ut.y)];Q.length>ke+1?he.push({polygons:$e,bounds:He,depth:ke+1}):O($e,He)}if(st.length){const He=[new G(Ae===0?Xe:Oe.x,Ae===1?Xe:Oe.y),ut];Q.length>ke+1?he.push({polygons:st,bounds:He,depth:ke+1}):O(st,He)}}return D}(i,e,Math.ceil((u-l)/11.25),Math.ceil((d-p)/11.25),1,(y,x,E)=>{if(y===0)return .5*(x+E);{const C=An((t.y+x/$t)/r);return(Xo(.5*(An((t.y+E/$t)/r)+C))*r-t.y)*$t}})}At(Iu,"FillExtrusionBucket",{omit:["layers","features"]}),At(Ag,"PartMetadata");const Tb=new Ve({"fill-extrusion-edge-radius":new ae(Re["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Eb={paint:new Ve({"fill-extrusion-opacity":new ae(Re["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new me(Re["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ae(Re["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ae(Re["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ce(Re["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new me(Re["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new me(Re["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ae(Re["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ae(Re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ae(Re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:Tb};function Rg(i,e,t){var r=2*Math.PI*6378137/256/Math.pow(2,t);return[i*r-2*Math.PI*6378137/2,e*r-2*Math.PI*6378137/2]}class Td{constructor(e,t,r){this.z=e,this.x=t,this.y=r,this.key=zu(0,e,e,t,r)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){const r=function(u,d,p){var y=Rg(256*u,256*(d=Math.pow(2,p)-d-1),p),x=Rg(256*(u+1),256*(d+1),p);return y[0]+","+y[1]+","+x[0]+","+x[1]}(this.x,this.y,this.z),l=function(u,d,p){let y,x="";for(let E=u;E>0;E--)y=1<<E-1,x+=(d&y?1:0)+(p&y?2:0);return x}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(t==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",r)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Bg{constructor(e,t){this.wrap=e,this.canonical=t,this.key=zu(e,t.z,t.z,t.x,t.y)}}class Hn{constructor(e,t,r,l,u){this.overscaledZ=e,this.wrap=t,this.canonical=new Td(r,+l,+u),this.key=t===0&&e===r?this.canonical.key:zu(t,e,r,l,u)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new Hn(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Hn(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t=!0){if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return zu(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const r=this.canonical.z-e;return zu(this.wrap*+t,e,e,this.canonical.x>>r,this.canonical.y>>r)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new Hn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,r=2*this.canonical.x,l=2*this.canonical.y;return[new Hn(t,this.wrap,t,r,l),new Hn(t,this.wrap,t,r+1,l),new Hn(t,this.wrap,t,r,l+1),new Hn(t,this.wrap,t,r+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Hn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Hn(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Bg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function zu(i,e,t,r,l){const u=1<<Math.min(t,22);let d=u*(l%u)+r%u;return i&&t<22&&(d+=u*u*((i<0?-2*i-1:2*i)%(1<<2*(22-t)))),16*(32*d+t)+(e-t)}function ku(i,e){return i.x*e.x+i.y*e.y}function Fg(i,e){if(i.length===1){let t=0;const r=e[t++];let l;for(;!l||r.equals(l);)if(l=e[t++],!l)return 1/0;for(;t<e.length;t++){const u=e[t],d=i[0],p=l.sub(r),y=u.sub(r),x=d.sub(r),E=ku(p,p),C=ku(p,y),M=ku(y,y),P=ku(x,p),D=ku(x,y),O=E*M-C*C,V=(M*P-C*D)/O,K=(E*D-C*P)/O,oe=r.z*(1-V-K)+l.z*V+u.z*K;if(isFinite(oe))return oe}return 1/0}{let t=1/0;for(const r of e)t=Math.min(t,r.z);return t}}function Ed(i){const e=new G(i[0],i[1]);return e.z=i[2],e}function Og(i,e,t,r,l,u,d,p){const y=d*l.getElevationAt(i,e,!0,!0),x=u[0]!==0,E=x?u[1]===0?d*(u[0]/7-450):d*function(C,M,P){const D=Math.floor(M[0]/8),O=Math.floor(M[1]/8),V=10*(M[0]-8*D),K=10*(M[1]-8*O),oe=C.getElevationAt(D,O,!0,!0),Q=C.getMeterToDEM(P),ne=Math.floor(.5*(V*Q-1)),he=Math.floor(.5*(K*Q-1)),se=C.tileCoordToPixel(D,O),ke=2*ne+1,Ae=2*he+1,Oe=function(st,He,bt,Ht,Yt){return[st.getElevationAtPixel(He,bt,!0),st.getElevationAtPixel(He+Yt,bt,!0),st.getElevationAtPixel(He,bt+Yt,!0),st.getElevationAtPixel(He+Ht,bt+Yt,!0)]}(C,se.x-ne,se.y-he,ke,Ae),ut=Math.abs(Oe[0]-Oe[1]),De=Math.abs(Oe[2]-Oe[3]),je=Math.abs(Oe[0]-Oe[2])+Math.abs(Oe[1]-Oe[3]),Xe=Math.min(.25,.5*Q*(ut+De)/ke),$e=Math.min(.25,.5*Q*je/Ae);return oe+Math.max(Xe*V,$e*K)}(l,u,p):y;return{base:y+(t===0)?-1:t,top:x?Math.max(E+r,y+t+2):y+r}}At(Td,"CanonicalTileID"),At(Hn,"OverscaledTileID",{omit:["projMatrix"]});const Sb=qe([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Cb}=Sb,Ab=qe([{name:"a_packed",components:4,type:"Float32"}]),{members:Mb}=Ab,Ib=La.VectorTileFeature.types,zb=Math.cos(Math.PI/180*37.5);class Sd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(t=>{this.gradients[t.id]={}}),this.layoutVertexArray=new qt,this.layoutVertexArray2=new li,this.indexArray=new ti,this.programConfigurations=new Ma(e.layers,e.zoom),this.segments=new sn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(e,t,r,l){this.hasPattern=Ip("line",this.layers,t);const u=this.layers[0].layout.get("line-sort-key"),d=[];for(const{feature:E,id:C,index:M,sourceLayerIndex:P}of e){const D=this.layers[0]._featureFilter.needGeometry,O=Ia(E,D);if(!this.layers[0]._featureFilter.filter(new $(this.zoom),O,r))continue;const V=u?u.evaluate(O,{},r):void 0,K={id:C,properties:E.properties,type:E.type,sourceLayerIndex:P,index:M,geometry:D?O.geometry:Ho(E,r,l),patterns:{},sortKey:V};d.push(K)}u&&d.sort((E,C)=>E.sortKey-C.sortKey);const{lineAtlas:p,featureIndex:y}=t,x=this.addConstantDashes(p);for(const E of d){const{geometry:C,index:M,sourceLayerIndex:P}=E;if(x&&this.addFeatureDashes(E,p),this.hasPattern){const D=zp("line",this.layers,E,this.zoom,t);this.patternFeatures.push(D)}else this.addFeature(E,C,M,r,p.positions,t.availableImages);y.insert(e[M].feature,C,M,P,this.index)}}addConstantDashes(e){let t=!1;for(const r of this.layers){const l=r.paint.get("line-dasharray").value,u=r.layout.get("line-cap").value;if(l.kind!=="constant"||u.kind!=="constant")t=!0;else{const d=u.value,p=l.value;if(!p)continue;e.addDash(p.from,d),e.addDash(p.to,d),p.other&&e.addDash(p.other,d)}}return t}addFeatureDashes(e,t){const r=this.zoom;for(const l of this.layers){const u=l.paint.get("line-dasharray").value,d=l.layout.get("line-cap").value;if(u.kind==="constant"&&d.kind==="constant")continue;let p,y,x,E,C,M;if(u.kind==="constant"){const V=u.value;if(!V)continue;p=V.other||V.to,y=V.to,x=V.from}else p=u.evaluate({zoom:r-1},e),y=u.evaluate({zoom:r},e),x=u.evaluate({zoom:r+1},e);d.kind==="constant"?E=C=M=d.value:(E=d.evaluate({zoom:r-1},e),C=d.evaluate({zoom:r},e),M=d.evaluate({zoom:r+1},e)),t.addDash(p,E),t.addDash(y,C),t.addDash(x,M);const P=t.getKey(p,E),D=t.getKey(y,C),O=t.getKey(x,M);e.patterns[l.id]={min:P,mid:D,max:O}}}update(e,t,r,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r,l)}addFeatures(e,t,r,l,u){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,t,r,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Mb)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Cb),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,r,l,u,d){const p=this.layers[0].layout,y=p.get("line-join").evaluate(e,{}),x=p.get("line-cap").evaluate(e,{}),E=p.get("line-miter-limit"),C=p.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const M of t)this.addLine(M,e,y,x,E,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,u,d,l)}addLine(e,t,r,l,u,d){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let K=0;K<e.length-1;K++)this.totalDistance+=e[K].dist(e[K+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const p=Ib[t.type]==="Polygon";let y=e.length;for(;y>=2&&e[y-1].equals(e[y-2]);)y--;let x=0;for(;x<y-1&&e[x].equals(e[x+1]);)x++;if(y<(p?3:2))return;r==="bevel"&&(u=1.05);const E=this.overscaling<=16?122880/(512*this.overscaling):0,C=this.segments.prepareSegment(10*y,this.layoutVertexArray,this.indexArray);let M,P,D,O,V;this.e1=this.e2=-1,p&&(M=e[y-2],V=e[x].sub(M)._unit()._perp());for(let K=x;K<y;K++){if(D=K===y-1?p?e[x+1]:void 0:e[K+1],D&&e[K].equals(D))continue;V&&(O=V),M&&(P=M),M=e[K],V=D?D.sub(M)._unit()._perp():O,O=O||V;let oe=O.add(V);oe.x===0&&oe.y===0||oe._unit();const Q=O.x*V.x+O.y*V.y,ne=oe.x*V.x+oe.y*V.y,he=ne!==0?1/ne:1/0,se=2*Math.sqrt(2-2*ne),ke=ne<zb&&P&&D,Ae=O.x*V.y-O.y*V.x>0;if(ke&&K>x){const De=M.dist(P);if(De>2*E){const je=M.sub(M.sub(P)._mult(E/De)._round());this.updateDistance(P,je),this.addCurrentVertex(je,O,0,0,C),P=je}}const Oe=P&&D;let ut=Oe?r:p?"butt":l;if(Oe&&ut==="round"&&(he<d?ut="miter":he<=2&&(ut="fakeround")),ut==="miter"&&he>u&&(ut="bevel"),ut==="bevel"&&(he>2&&(ut="flipbevel"),he<u&&(ut="miter")),P&&this.updateDistance(P,M),ut==="miter")oe._mult(he),this.addCurrentVertex(M,oe,0,0,C);else if(ut==="flipbevel"){if(he>100)oe=V.mult(-1);else{const De=he*O.add(V).mag()/O.sub(V).mag();oe._perp()._mult(De*(Ae?-1:1))}this.addCurrentVertex(M,oe,0,0,C),this.addCurrentVertex(M,oe.mult(-1),0,0,C)}else if(ut==="bevel"||ut==="fakeround"){const De=-Math.sqrt(he*he-1),je=Ae?De:0,Xe=Ae?0:De;if(P&&this.addCurrentVertex(M,O,je,Xe,C),ut==="fakeround"){const $e=Math.round(180*se/Math.PI/20);for(let st=1;st<$e;st++){let He=st/$e;if(He!==.5){const Ht=He-.5;He+=He*Ht*(He-1)*((1.0904+Q*(Q*(3.55645-1.43519*Q)-3.2452))*Ht*Ht+(.848013+Q*(.215638*Q-1.06021)))}const bt=V.sub(O)._mult(He)._add(O)._unit()._mult(Ae?-1:1);this.addHalfVertex(M,bt.x,bt.y,!1,Ae,0,C)}}D&&this.addCurrentVertex(M,V,-je,-Xe,C)}else if(ut==="butt")this.addCurrentVertex(M,oe,0,0,C);else if(ut==="square"){const De=P?1:-1;P||this.addCurrentVertex(M,oe,De,De,C),this.addCurrentVertex(M,oe,0,0,C),P&&this.addCurrentVertex(M,oe,De,De,C)}else ut==="round"&&(P&&(this.addCurrentVertex(M,O,0,0,C),this.addCurrentVertex(M,O,1,1,C,!0)),D&&(this.addCurrentVertex(M,V,-1,-1,C,!0),this.addCurrentVertex(M,V,0,0,C)));if(ke&&K<y-1){const De=M.dist(D);if(De>2*E){const je=M.add(D.sub(M)._mult(E/De)._round());this.updateDistance(M,je),this.addCurrentVertex(je,V,0,0,C),M=je}}}}addCurrentVertex(e,t,r,l,u,d=!1){const p=t.y*l-t.x,y=-t.y-t.x*l;this.addHalfVertex(e,t.x+t.y*r,t.y-t.x*r,d,!1,r,u),this.addHalfVertex(e,p,y,d,!0,-l,u)}addHalfVertex({x:e,y:t},r,l,u,d,p,y){this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(t<<1)+(d?1:0),Math.round(63*r)+128,Math.round(63*l)+128,1+(p===0?0:p<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const x=y.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,x),y.primitiveLength++),d?this.e2=x:this.e1=x}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}At(Sd,"LineBucket",{omit:["layers","patternFeatures"]});const kb=new Ve({"line-cap":new me(Re.layout_line["line-cap"]),"line-join":new me(Re.layout_line["line-join"]),"line-miter-limit":new ae(Re.layout_line["line-miter-limit"]),"line-round-limit":new ae(Re.layout_line["line-round-limit"]),"line-sort-key":new me(Re.layout_line["line-sort-key"])});var Ug={paint:new Ve({"line-opacity":new me(Re.paint_line["line-opacity"]),"line-color":new me(Re.paint_line["line-color"]),"line-translate":new ae(Re.paint_line["line-translate"]),"line-translate-anchor":new ae(Re.paint_line["line-translate-anchor"]),"line-width":new me(Re.paint_line["line-width"]),"line-gap-width":new me(Re.paint_line["line-gap-width"]),"line-offset":new me(Re.paint_line["line-offset"]),"line-blur":new me(Re.paint_line["line-blur"]),"line-dasharray":new Ce(Re.paint_line["line-dasharray"]),"line-pattern":new Ce(Re.paint_line["line-pattern"]),"line-gradient":new xe(Re.paint_line["line-gradient"]),"line-trim-offset":new ae(Re.paint_line["line-trim-offset"])}),layout:kb};const Vg=new class extends me{possiblyEvaluate(i,e){return e=new $(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,t,r){return e=Fe({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,t,r)}}(Ug.paint.properties["line-width"].specification);function Ng(i,e){return e>0?e+2*i:i}Vg.useIntegerZoom=!0;const Pb=qe([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Db=qe([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Lb=qe([{name:"a_projected_pos",components:4,type:"Float32"}],4);qe([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Rb=qe([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Bb=qe([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);qe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const jg=qe([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Fb=qe([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);qe([{name:"triangle",components:3,type:"Uint16"}]),qe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),qe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),qe([{type:"Float32",name:"offsetX"}]),qe([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Mn=24;const To=128;function kp(i,e){const{expression:t}=e;if(t.kind==="constant")return{kind:"constant",layoutSize:t.evaluate(new $(i+1))};if(t.kind==="source")return{kind:"source"};{const{zoomStops:r,interpolationType:l}=t;let u=0;for(;u<r.length&&r[u]<=i;)u++;u=Math.max(0,u-1);let d=u;for(;d<r.length&&r[d]<i+1;)d++;d=Math.min(r.length-1,d);const p=r[u],y=r[d];return t.kind==="composite"?{kind:"composite",minZoom:p,maxZoom:y,interpolationType:l}:{kind:"camera",minZoom:p,maxZoom:y,minSize:t.evaluate(new $(p)),maxSize:t.evaluate(new $(y)),interpolationType:l}}}function Cd(i,{uSize:e,uSizeT:t},{lowerSize:r,upperSize:l}){return i.kind==="source"?r/To:i.kind==="composite"?fi(r/To,l/To,t):e}function jl(i,e){let t=0,r=0;if(i.kind==="constant")r=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:l,minZoom:u,maxZoom:d}=i,p=l?Ie(Pr.interpolationFactor(l,e,u,d),0,1):0;i.kind==="camera"?r=fi(i.minSize,i.maxSize,p):t=p}return{uSizeT:t,uSize:r}}var Ob=Object.freeze({__proto__:null,getSizeData:kp,evaluateSizeForFeature:Cd,evaluateSizeForZoom:jl,SIZE_PACK_FACTOR:To});function Ub(i,e,t){return i.sections.forEach(r=>{r.text=function(l,u,d){const p=u.layout.get("text-transform").evaluate(d,{});return p==="uppercase"?l=l.toLocaleUpperCase():p==="lowercase"&&(l=l.toLocaleLowerCase()),j.applyArabicShaping&&(l=j.applyArabicShaping(l)),l}(r.text,e,t)}),i}const Pu={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function Vb(i){return i==="\uFE36"||i==="\uFE48"||i==="\uFE38"||i==="\uFE44"||i==="\uFE42"||i==="\uFE3E"||i==="\uFE3C"||i==="\uFE3A"||i==="\uFE18"||i==="\uFE40"||i==="\uFE10"||i==="\uFE13"||i==="\uFE14"||i==="\uFF40"||i==="\uFFE3"||i==="\uFE11"||i==="\uFE12"}function Nb(i){return i==="\uFE35"||i==="\uFE47"||i==="\uFE37"||i==="\uFE43"||i==="\uFE41"||i==="\uFE3D"||i==="\uFE3B"||i==="\uFE39"||i==="\uFE17"||i==="\uFE3F"}var $g=function(i,e,t,r,l){var u,d,p=8*l-r-1,y=(1<<p)-1,x=y>>1,E=-7,C=t?l-1:0,M=t?-1:1,P=i[e+C];for(C+=M,u=P&(1<<-E)-1,P>>=-E,E+=p;E>0;u=256*u+i[e+C],C+=M,E-=8);for(d=u&(1<<-E)-1,u>>=-E,E+=r;E>0;d=256*d+i[e+C],C+=M,E-=8);if(u===0)u=1-x;else{if(u===y)return d?NaN:1/0*(P?-1:1);d+=Math.pow(2,r),u-=x}return(P?-1:1)*d*Math.pow(2,u-r)},qg=function(i,e,t,r,l,u){var d,p,y,x=8*u-l-1,E=(1<<x)-1,C=E>>1,M=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,P=r?0:u-1,D=r?1:-1,O=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(p=isNaN(e)?1:0,d=E):(d=Math.floor(Math.log(e)/Math.LN2),e*(y=Math.pow(2,-d))<1&&(d--,y*=2),(e+=d+C>=1?M/y:M*Math.pow(2,1-C))*y>=2&&(d++,y/=2),d+C>=E?(p=0,d=E):d+C>=1?(p=(e*y-1)*Math.pow(2,l),d+=C):(p=e*Math.pow(2,C-1)*Math.pow(2,l),d=0));l>=8;i[t+P]=255&p,P+=D,p/=256,l-=8);for(d=d<<l|p,x+=l;x>0;i[t+P]=255&d,P+=D,d/=256,x-=8);i[t+P-D]|=128*O},Du=Bi;function Bi(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Bi.Varint=0,Bi.Fixed64=1,Bi.Bytes=2,Bi.Fixed32=5;var Pp=4294967296,Gg=1/Pp,Zg=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Yo(i){return i.type===Bi.Bytes?i.readVarint()+i.pos:i.pos+1}function $l(i,e,t){return t?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Wg(i,e,t){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));t.realloc(r);for(var l=t.pos-1;l>=i;l--)t.buf[l+r]=t.buf[l]}function jb(i,e){for(var t=0;t<i.length;t++)e.writeVarint(i[t])}function $b(i,e){for(var t=0;t<i.length;t++)e.writeSVarint(i[t])}function qb(i,e){for(var t=0;t<i.length;t++)e.writeFloat(i[t])}function Gb(i,e){for(var t=0;t<i.length;t++)e.writeDouble(i[t])}function Zb(i,e){for(var t=0;t<i.length;t++)e.writeBoolean(i[t])}function Wb(i,e){for(var t=0;t<i.length;t++)e.writeFixed32(i[t])}function Xb(i,e){for(var t=0;t<i.length;t++)e.writeSFixed32(i[t])}function Hb(i,e){for(var t=0;t<i.length;t++)e.writeFixed64(i[t])}function Kb(i,e){for(var t=0;t<i.length;t++)e.writeSFixed64(i[t])}function Ad(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function ql(i,e,t){i[t]=e,i[t+1]=e>>>8,i[t+2]=e>>>16,i[t+3]=e>>>24}function Xg(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function Yb(i,e,t){e.glyphs=[],i===1&&t.readMessage(Jb,e)}function Jb(i,e,t){if(i===3){const{id:r,bitmap:l,width:u,height:d,left:p,top:y,advance:x}=t.readMessage(Qb,{});e.glyphs.push({id:r,bitmap:new Ko({width:u+6,height:d+6},l),metrics:{width:u,height:d,left:p,top:y,advance:x}})}else i===4?e.ascender=t.readSVarint():i===5&&(e.descender=t.readSVarint())}function Qb(i,e,t){i===1?e.id=t.readVarint():i===2?e.bitmap=t.readBytes():i===3?e.width=t.readVarint():i===4?e.height=t.readVarint():i===5?e.left=t.readSVarint():i===6?e.top=t.readSVarint():i===7&&(e.advance=t.readVarint())}function Dp(i){let e=0,t=0;for(const d of i)e+=d.w*d.h,t=Math.max(t,d.w);i.sort((d,p)=>p.h-d.h);const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),t),h:1/0}];let l=0,u=0;for(const d of i)for(let p=r.length-1;p>=0;p--){const y=r[p];if(!(d.w>y.w||d.h>y.h)){if(d.x=y.x,d.y=y.y,u=Math.max(u,d.y+d.h),l=Math.max(l,d.x+d.w),d.w===y.w&&d.h===y.h){const x=r.pop();p<r.length&&(r[p]=x)}else d.h===y.h?(y.x+=d.w,y.w-=d.w):d.w===y.w?(y.y+=d.h,y.h-=d.h):(r.push({x:y.x+d.w,y:y.y,w:y.w-d.w,h:d.h}),y.y+=d.h,y.h-=d.h);break}}return{w:l,h:u,fill:e/(l*u)||0}}Bi.prototype={destroy:function(){this.buf=null},readFields:function(i,e,t){for(t=t||this.length;this.pos<t;){var r=this.readVarint(),l=r>>3,u=this.pos;this.type=7&r,i(l,e,this),this.pos===u&&this.skip(r)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=Ad(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Xg(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Ad(this.buf,this.pos)+Ad(this.buf,this.pos+4)*Pp;return this.pos+=8,i},readSFixed64:function(){var i=Ad(this.buf,this.pos)+Xg(this.buf,this.pos+4)*Pp;return this.pos+=8,i},readFloat:function(){var i=$g(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=$g(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,t,r=this.buf;return e=127&(t=r[this.pos++]),t<128?e:(e|=(127&(t=r[this.pos++]))<<7,t<128?e:(e|=(127&(t=r[this.pos++]))<<14,t<128?e:(e|=(127&(t=r[this.pos++]))<<21,t<128?e:function(l,u,d){var p,y,x=d.buf;if(p=(112&(y=x[d.pos++]))>>4,y<128||(p|=(127&(y=x[d.pos++]))<<3,y<128)||(p|=(127&(y=x[d.pos++]))<<10,y<128)||(p|=(127&(y=x[d.pos++]))<<17,y<128)||(p|=(127&(y=x[d.pos++]))<<24,y<128)||(p|=(1&(y=x[d.pos++]))<<31,y<128))return $l(l,p,u);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(t=r[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&Zg?function(t,r,l){return Zg.decode(t.subarray(r,l))}(this.buf,e,i):function(t,r,l){for(var u="",d=r;d<l;){var p,y,x,E=t[d],C=null,M=E>239?4:E>223?3:E>191?2:1;if(d+M>l)break;M===1?E<128&&(C=E):M===2?(192&(p=t[d+1]))==128&&(C=(31&E)<<6|63&p)<=127&&(C=null):M===3?(y=t[d+2],(192&(p=t[d+1]))==128&&(192&y)==128&&((C=(15&E)<<12|(63&p)<<6|63&y)<=2047||C>=55296&&C<=57343)&&(C=null)):M===4&&(y=t[d+2],x=t[d+3],(192&(p=t[d+1]))==128&&(192&y)==128&&(192&x)==128&&((C=(15&E)<<18|(63&p)<<12|(63&y)<<6|63&x)<=65535||C>=1114112)&&(C=null)),C===null?(C=65533,M=1):C>65535&&(C-=65536,u+=String.fromCharCode(C>>>10&1023|55296),C=56320|1023&C),u+=String.fromCharCode(C),d+=M}return u}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Bi.Bytes)return i.push(this.readVarint(e));var t=Yo(this);for(i=i||[];this.pos<t;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Bi.Bytes)return i.push(this.readSVarint());var e=Yo(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Bi.Bytes)return i.push(this.readBoolean());var e=Yo(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Bi.Bytes)return i.push(this.readFloat());var e=Yo(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Bi.Bytes)return i.push(this.readDouble());var e=Yo(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Bi.Bytes)return i.push(this.readFixed32());var e=Yo(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Bi.Bytes)return i.push(this.readSFixed32());var e=Yo(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Bi.Bytes)return i.push(this.readFixed64());var e=Yo(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Bi.Bytes)return i.push(this.readSFixed64());var e=Yo(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Bi.Varint)for(;this.buf[this.pos++]>127;);else if(e===Bi.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Bi.Fixed32)this.pos+=4;else{if(e!==Bi.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var t=new Uint8Array(e);t.set(this.buf),this.buf=t,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),ql(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),ql(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),ql(this.buf,-1&i,this.pos),ql(this.buf,Math.floor(i*Gg),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),ql(this.buf,-1&i,this.pos),ql(this.buf,Math.floor(i*Gg),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,t){var r,l;if(e>=0?(r=e%4294967296|0,l=e/4294967296|0):(l=~(-e/4294967296),4294967295^(r=~(-e%4294967296))?r=r+1|0:(r=0,l=l+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(u,d,p){p.buf[p.pos++]=127&u|128,u>>>=7,p.buf[p.pos++]=127&u|128,u>>>=7,p.buf[p.pos++]=127&u|128,u>>>=7,p.buf[p.pos++]=127&u|128,p.buf[p.pos]=127&(u>>>=7)}(r,0,t),function(u,d){var p=(7&u)<<4;d.buf[d.pos++]|=p|((u>>>=3)?128:0),u&&(d.buf[d.pos++]=127&u|((u>>>=7)?128:0),u&&(d.buf[d.pos++]=127&u|((u>>>=7)?128:0),u&&(d.buf[d.pos++]=127&u|((u>>>=7)?128:0),u&&(d.buf[d.pos++]=127&u|((u>>>=7)?128:0),u&&(d.buf[d.pos++]=127&u)))))}(l,t)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(r,l,u){for(var d,p,y=0;y<l.length;y++){if((d=l.charCodeAt(y))>55295&&d<57344){if(!p){d>56319||y+1===l.length?(r[u++]=239,r[u++]=191,r[u++]=189):p=d;continue}if(d<56320){r[u++]=239,r[u++]=191,r[u++]=189,p=d;continue}d=p-55296<<10|d-56320|65536,p=null}else p&&(r[u++]=239,r[u++]=191,r[u++]=189,p=null);d<128?r[u++]=d:(d<2048?r[u++]=d>>6|192:(d<65536?r[u++]=d>>12|224:(r[u++]=d>>18|240,r[u++]=d>>12&63|128),r[u++]=d>>6&63|128),r[u++]=63&d|128)}return u}(this.buf,i,this.pos);var t=this.pos-e;t>=128&&Wg(e,t,this),this.pos=e-1,this.writeVarint(t),this.pos+=t},writeFloat:function(i){this.realloc(4),qg(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),qg(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var t=0;t<e;t++)this.buf[this.pos++]=i[t]},writeRawMessage:function(i,e){this.pos++;var t=this.pos;i(e,this);var r=this.pos-t;r>=128&&Wg(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeMessage:function(i,e,t){this.writeTag(i,Bi.Bytes),this.writeRawMessage(e,t)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,jb,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,$b,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,Zb,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,qb,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,Gb,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,Wb,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,Xb,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,Hb,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,Kb,e)},writeBytesField:function(i,e){this.writeTag(i,Bi.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Bi.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Bi.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Bi.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Bi.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Bi.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Bi.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Bi.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Bi.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Bi.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,Boolean(e))}};class Lp{constructor(e,{pixelRatio:t,version:r,stretchX:l,stretchY:u,content:d}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=l,this.stretchY=u,this.content=d,this.version=r}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Hg{constructor(e,t){const r={},l={};this.haveRenderCallbacks=[];const u=[];this.addImages(e,r,u),this.addImages(t,l,u);const{w:d,h:p}=Dp(u),y=new _r({width:d||1,height:p||1});for(const x in e){const E=e[x],C=r[x].paddedRect;_r.copy(E.data,y,{x:0,y:0},{x:C.x+1,y:C.y+1},E.data)}for(const x in t){const E=t[x],C=l[x].paddedRect,M=C.x+1,P=C.y+1,D=E.data.width,O=E.data.height;_r.copy(E.data,y,{x:0,y:0},{x:M,y:P},E.data),_r.copy(E.data,y,{x:0,y:O-1},{x:M,y:P-1},{width:D,height:1}),_r.copy(E.data,y,{x:0,y:0},{x:M,y:P+O},{width:D,height:1}),_r.copy(E.data,y,{x:D-1,y:0},{x:M-1,y:P},{width:1,height:O}),_r.copy(E.data,y,{x:0,y:0},{x:M+D,y:P},{width:1,height:O})}this.image=y,this.iconPositions=r,this.patternPositions=l}addImages(e,t,r){for(const l in e){const u=e[l],d={x:0,y:0,w:u.data.width+2,h:u.data.height+2};r.push(d),t[l]=new Lp(d,u),u.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(e,t){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(r=>e.hasImage(r)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const r in e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),t),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),t)}patchUpdatedImage(e,t,r){if(!e||!t||e.version===t.version)return;e.version=t.version;const[l,u]=e.tl;r.update(t.data,void 0,{x:l,y:u})}}At(Lp,"ImagePosition"),At(Hg,"ImageAtlas");const Ir={horizontal:1,vertical:2,horizontalOnly:3};class Lu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const r=new Lu;return r.scale=e||1,r.fontStack=t,r}static forImage(e){const t=new Lu;return t.imageName=e,t}}class Gl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const r=new Gl;for(let l=0;l<e.sections.length;l++){const u=e.sections[l];u.image?r.addImageSection(u):r.addTextSection(u,t)}return r}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(t,r){let l="";for(let u=0;u<t.length;u++){const d=t.charCodeAt(u+1)||null,p=t.charCodeAt(u-1)||null;l+=!r&&(d&&Ca(d)&&!Pu[t[u+1]]||p&&Ca(p)&&!Pu[t[u-1]])||!Pu[t[u]]?t[u]:Pu[t[u]]}return l}(this.text,e)}trim(){let e=0;for(let r=0;r<this.text.length&&Md[this.text.charCodeAt(r)];r++)e++;let t=this.text.length;for(let r=this.text.length-1;r>=0&&r>=e&&Md[this.text.charCodeAt(r)];r--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const r=new Gl;return r.text=this.text.substring(e,t),r.sectionIndex=this.sectionIndex.slice(e,t),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,t)=>Math.max(e,this.sections[t].scale),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(Lu.forText(e.scale,e.fontStack||t));const r=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(r)}addImageSection(e){const t=e.image?e.image.name:"";if(t.length===0)return void Jt("Can't add FormattedSection with an empty image.");const r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(Lu.forImage(t)),this.sectionIndex.push(this.sections.length-1)):Jt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Rp(i,e,t,r,l,u,d,p,y,x,E,C,M,P,D,O){const V=Gl.fromFeature(i,l);let K;C===Ir.vertical&&V.verticalizePunctuation(M);const{processBidirectionalText:oe,processStyledBidirectionalText:Q}=j;if(oe&&V.sections.length===1){K=[];const se=oe(V.toString(),Bp(V,x,u,e,r,P,D));for(const ke of se){const Ae=new Gl;Ae.text=ke,Ae.sections=V.sections;for(let Oe=0;Oe<ke.length;Oe++)Ae.sectionIndex.push(0);K.push(Ae)}}else if(Q){K=[];const se=Q(V.text,V.sectionIndex,Bp(V,x,u,e,r,P,D));for(const ke of se){const Ae=new Gl;Ae.text=ke[0],Ae.sectionIndex=ke[1],Ae.sections=V.sections,K.push(Ae)}}else K=function(se,ke){const Ae=[],Oe=se.text;let ut=0;for(const De of ke)Ae.push(se.substring(ut,De)),ut=De;return ut<Oe.length&&Ae.push(se.substring(ut,Oe.length)),Ae}(V,Bp(V,x,u,e,r,P,D));const ne=[],he={positionedLines:ne,text:V.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:C,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(se,ke,Ae,Oe,ut,De,je,Xe,$e,st,He,bt){let Ht=0,Yt=0,Dt=0;const mt=Xe==="right"?1:Xe==="left"?0:.5;let ci=!1;for(const Qt of ut){const mi=Qt.getSections();for(const Oi of mi){if(Oi.imageName)continue;const Pi=ke[Oi.fontStack];if(Pi&&(ci=Pi.ascender!==void 0&&Pi.descender!==void 0,!ci))break}if(!ci)break}let Gt=0;for(const Qt of ut){Qt.trim();const mi=Qt.getMaxScale(),Oi=(mi-1)*Mn,Pi={positionedGlyphs:[],lineOffset:0};se.positionedLines[Gt]=Pi;const Ii=Pi.positionedGlyphs;let ji=0;if(!Qt.length()){Yt+=De,++Gt;continue}let Wi=0,gn=0;for(let ui=0;ui<Qt.length();ui++){const Ji=Qt.getSection(ui),Fn=Qt.getSectionIndex(ui),xi=Qt.getCharCode(ui);let Xi=Ji.scale,Kn=null,Gi=null,en=null,yn=Mn,pn=0;const In=!($e===Ir.horizontal||!He&&!Ll(xi)||He&&(Md[xi]||(St=xi,Xh(St)||Hh(St)||Kh(St)||Sa(St)||_u(St))));if(Ji.imageName){const Yn=Oe[Ji.imageName];if(!Yn)continue;en=Ji.imageName,se.iconsInText=se.iconsInText||!0,Gi=Yn.paddedRect;const xn=Yn.displaySize;Xi=Xi*Mn/bt,Kn={width:xn[0],height:xn[1],left:1,top:-3,advance:In?xn[1]:xn[0],localGlyph:!1},pn=ci?-Kn.height*Xi:mi*Mn-17-xn[1]*Xi,yn=Kn.advance;const es=(In?xn[0]:xn[1])*Xi-Mn*mi;es>0&&es>ji&&(ji=es)}else{const Yn=Ae[Ji.fontStack];if(!Yn)continue;Yn[xi]&&(Gi=Yn[xi]);const xn=ke[Ji.fontStack];if(!xn)continue;const es=xn.glyphs[xi];if(!es)continue;if(Kn=es.metrics,yn=xi!==8203?Mn:0,ci){const Jl=xn.ascender!==void 0?Math.abs(xn.ascender):0,Zu=xn.descender!==void 0?Math.abs(xn.descender):0,Wu=(Jl+Zu)*Xi;Wi<Wu&&(Wi=Wu,gn=(Jl-Zu)/2*Xi),pn=-Jl*Xi}else pn=(mi-Xi)*Mn-17}In?(se.verticalizable=!0,Ii.push({glyph:xi,imageName:en,x:Ht,y:Yt+pn,vertical:In,scale:Xi,localGlyph:Kn.localGlyph,fontStack:Ji.fontStack,sectionIndex:Fn,metrics:Kn,rect:Gi}),Ht+=yn*Xi+st):(Ii.push({glyph:xi,imageName:en,x:Ht,y:Yt+pn,vertical:In,scale:Xi,localGlyph:Kn.localGlyph,fontStack:Ji.fontStack,sectionIndex:Fn,metrics:Kn,rect:Gi}),Ht+=Kn.advance*Xi+st)}Ii.length!==0&&(Dt=Math.max(Ht-st,Dt),ci?ey(Ii,mt,ji,gn,De*mi/2):ey(Ii,mt,ji,0,De/2)),Ht=0;const lr=De*mi+ji;Pi.lineOffset=Math.max(ji,Oi),Yt+=lr,++Gt}var St;const Fi=Yt,{horizontalAlign:ki,verticalAlign:qi}=Fp(je);(function(Qt,mi,Oi,Pi,Ii,ji){const Wi=(mi-Oi)*Ii,gn=-ji*Pi;for(const lr of Qt)for(const ui of lr.positionedGlyphs)ui.x+=Wi,ui.y+=gn})(se.positionedLines,mt,ki,qi,Dt,Fi),se.top+=-qi*Fi,se.bottom=se.top+Fi,se.left+=-ki*Dt,se.right=se.left+Dt,se.hasBaseline=ci}(he,e,t,r,K,d,p,y,C,x,M,O),!function(se){for(const ke of se)if(ke.positionedGlyphs.length!==0)return!1;return!0}(ne)&&he}const Md={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ew={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Kg(i,e,t,r,l,u){if(e.imageName){const d=r[e.imageName];return d?d.displaySize[0]*e.scale*Mn/u+l:0}{const d=t[e.fontStack],p=d&&d.glyphs[i];return p?p.metrics.advance*e.scale+l:0}}function Yg(i,e,t,r){const l=Math.pow(i-e,2);return r?i<e?l/2:2*l:l+Math.abs(t)*t}function tw(i,e,t){let r=0;return i===10&&(r-=1e4),t&&(r+=150),i!==40&&i!==65288||(r+=50),e!==41&&e!==65289||(r+=50),r}function Jg(i,e,t,r,l,u){let d=null,p=Yg(e,t,l,u);for(const y of r){const x=Yg(e-y.x,t,l,u)+y.badness;x<=p&&(d=y,p=x)}return{index:i,x:e,priorBreak:d,badness:p}}function Qg(i){return i?Qg(i.priorBreak).concat(i.index):[]}function Bp(i,e,t,r,l,u,d){if(u!=="point")return[];if(!i)return[];const p=[],y=function(M,P,D,O,V,K){let oe=0;for(let Q=0;Q<M.length();Q++){const ne=M.getSection(Q);oe+=Kg(M.getCharCode(Q),ne,O,V,P,K)}return oe/Math.max(1,Math.ceil(oe/D))}(i,e,t,r,l,d),x=i.text.indexOf("\u200B")>=0;let E=0;for(let M=0;M<i.length();M++){const P=i.getSection(M),D=i.getCharCode(M);if(Md[D]||(E+=Kg(D,P,r,l,e,d)),M<i.length()-1){const O=!((C=D)<11904||!(uu(C)||Qh(C)||mu(C)||nd(C)||fu(C)||Yh(C)||ed(C)||kl(C)||pu(C)||Ea(C)||du(C)||gu(C)||cu(C)||Ta(C)||Jh(C)||hu(C)||Vo(C)||rd(C)||td(C)||Pl(C)));(ew[D]||O||P.imageName)&&p.push(Jg(M+1,E,y,p,tw(D,i.getCharCode(M+1),O&&x),!1))}}var C;return Qg(Jg(i.length(),E,y,p,0,!0))}function Fp(i){let e=.5,t=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":t=1;break;case"top":case"top-right":case"top-left":t=0}return{horizontalAlign:e,verticalAlign:t}}function ey(i,e,t,r,l){if(!(e||t||r||l))return;const u=i.length-1,d=i[u],p=(d.x+d.metrics.advance*d.scale)*e;for(let y=0;y<=u;y++)i[y].x-=p,i[y].y+=t+r+l}function iw(i,e,t){const{horizontalAlign:r,verticalAlign:l}=Fp(t),u=e[0]-i.displaySize[0]*r,d=e[1]-i.displaySize[1]*l;return{image:i,top:d,bottom:d+i.displaySize[1],left:u,right:u+i.displaySize[0]}}function ty(i,e,t,r,l,u){const d=i.image;let p;if(d.content){const V=d.content,K=d.pixelRatio||1;p=[V[0]/K,V[1]/K,d.displaySize[0]-V[2]/K,d.displaySize[1]-V[3]/K]}const y=e.left*u,x=e.right*u;let E,C,M,P;t==="width"||t==="both"?(P=l[0]+y-r[3],C=l[0]+x+r[1]):(P=l[0]+(y+x-d.displaySize[0])/2,C=P+d.displaySize[0]);const D=e.top*u,O=e.bottom*u;return t==="height"||t==="both"?(E=l[1]+D-r[0],M=l[1]+O+r[2]):(E=l[1]+(D+O-d.displaySize[1])/2,M=E+d.displaySize[1]),{image:d,top:E,right:C,bottom:M,left:P,collisionPadding:p}}class Jo extends G{constructor(e,t,r,l,u){super(e,t),this.angle=l,this.z=r,u!==void 0&&(this.segment=u)}clone(){return new Jo(this.x,this.y,this.z,this.angle,this.segment)}}function iy(i,e,t,r,l){if(e.segment===void 0)return!0;let u=e,d=e.segment+1,p=0;for(;p>-t/2;){if(d--,d<0)return!1;p-=i[d].dist(u),u=i[d]}p+=i[d].dist(i[d+1]),d++;const y=[];let x=0;for(;p<t/2;){const E=i[d],C=i[d+1];if(!C)return!1;let M=i[d-1].angleTo(E)-E.angleTo(C);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),y.push({distance:p,angleDelta:M}),x+=M;p-y[0].distance>r;)x-=y.shift().angleDelta;if(x>l)return!1;d++,p+=E.dist(C)}return!0}function ny(i){let e=0;for(let t=0;t<i.length-1;t++)e+=i[t].dist(i[t+1]);return e}function ry(i,e,t){return i?.6*e*t:0}function oy(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function nw(i,e,t,r,l,u){const d=ry(t,l,u),p=oy(t,r)*u;let y=0;const x=ny(i)/2;for(let E=0;E<i.length-1;E++){const C=i[E],M=i[E+1],P=C.dist(M);if(y+P>x){const D=(x-y)/P,O=fi(C.x,M.x,D),V=fi(C.y,M.y,D),K=new Jo(O,V,0,M.angleTo(C),E);return!d||iy(i,K,p,d,e)?K:void 0}y+=P}}function rw(i,e,t,r,l,u,d,p,y){const x=ry(r,u,d),E=oy(r,l),C=E*d,M=i[0].x===0||i[0].x===y||i[0].y===0||i[0].y===y;return e-C<e/4&&(e=C+e/4),sy(i,M?e/2*p%e:(E/2+2*u)*d*p%e,e,x,t,C,M,!1,y)}function sy(i,e,t,r,l,u,d,p,y){const x=u/2,E=ny(i);let C=0,M=e-t,P=[];for(let D=0;D<i.length-1;D++){const O=i[D],V=i[D+1],K=O.dist(V),oe=V.angleTo(O);for(;M+t<C+K;){M+=t;const Q=(M-C)/K,ne=fi(O.x,V.x,Q),he=fi(O.y,V.y,Q);if(ne>=0&&ne<y&&he>=0&&he<y&&M-x>=0&&M+x<=E){const se=new Jo(ne,he,0,oe,D);se._round(),r&&!iy(i,se,u,r,l)||P.push(se)}}C+=K}return p||P.length||d||(P=sy(i,C/2,t,r,l,u,d,!0,y)),P}function ay(i,e,t,r,l){const u=[];for(let d=0;d<i.length;d++){const p=i[d];let y;for(let x=0;x<p.length-1;x++){let E=p[x],C=p[x+1];E.x<e&&C.x<e||(E.x<e?E=new G(e,E.y+(e-E.x)/(C.x-E.x)*(C.y-E.y))._round():C.x<e&&(C=new G(e,E.y+(e-E.x)/(C.x-E.x)*(C.y-E.y))._round()),E.y<t&&C.y<t||(E.y<t?E=new G(E.x+(t-E.y)/(C.y-E.y)*(C.x-E.x),t)._round():C.y<t&&(C=new G(E.x+(t-E.y)/(C.y-E.y)*(C.x-E.x),t)._round()),E.x>=r&&C.x>=r||(E.x>=r?E=new G(r,E.y+(r-E.x)/(C.x-E.x)*(C.y-E.y))._round():C.x>=r&&(C=new G(r,E.y+(r-E.x)/(C.x-E.x)*(C.y-E.y))._round()),E.y>=l&&C.y>=l||(E.y>=l?E=new G(E.x+(l-E.y)/(C.y-E.y)*(C.x-E.x),l)._round():C.y>=l&&(C=new G(E.x+(l-E.y)/(C.y-E.y)*(C.x-E.x),l)._round()),y&&E.equals(y[y.length-1])||(y=[E],u.push(y)),y.push(C)))))}}return u}At(Jo,"Anchor");const Ru=1e20;function ly(i,e,t,r,l,u,d,p,y){for(let x=e;x<e+r;x++)cy(i,t*u+x,u,l,d,p,y);for(let x=t;x<t+l;x++)cy(i,x*u+e,1,r,d,p,y)}function cy(i,e,t,r,l,u,d){u[0]=0,d[0]=-Ru,d[1]=Ru,l[0]=i[e];for(let p=1,y=0,x=0;p<r;p++){l[p]=i[e+p*t];const E=p*p;do{const C=u[y];x=(l[p]-l[C]+E-C*C)/(p-C)/2}while(x<=d[y]&&--y>-1);y++,u[y]=p,d[y]=x,d[y+1]=Ru}for(let p=0,y=0;p<r;p++){for(;d[y+1]<p;)y++;const x=u[y],E=p-x;i[e+p*t]=l[x]+E*E}}const Op={none:0,ideographs:1,all:2};class Zl{constructor(e,t,r){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=r,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,t){const r=[];for(const l in e)for(const u of e[l])r.push({stack:l,id:u});ze(r,({stack:l,id:u},d)=>{let p=this.entries[l];p||(p=this.entries[l]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let y=p.glyphs[u];if(y!==void 0)return void d(null,{stack:l,id:u,glyph:y});if(y=this._tinySDF(p,l,u),y)return p.glyphs[u]=y,void d(null,{stack:l,id:u,glyph:y});const x=Math.floor(u/256);if(256*x>65535)return void d(new Error("glyphs > 65535 not supported"));if(p.ranges[x])return void d(null,{stack:l,id:u,glyph:y});let E=p.requests[x];E||(E=p.requests[x]=[],Zl.loadGlyphRange(l,x,this.url,this.requestManager,(C,M)=>{if(M){p.ascender=M.ascender,p.descender=M.descender;for(const P in M.glyphs)this._doesCharSupportLocalGlyph(+P)||(p.glyphs[+P]=M.glyphs[+P]);p.ranges[x]=!0}for(const P of E)P(C,M);delete p.requests[x]})),E.push((C,M)=>{C?d(C):M&&d(null,{stack:l,id:u,glyph:M.glyphs[u]||null})})},(l,u)=>{if(l)t(l);else if(u){const d={};for(const{stack:p,id:y,glyph:x}of u)d[p]===void 0&&(d[p]={}),d[p].glyphs===void 0&&(d[p].glyphs={}),d[p].glyphs[y]=x&&{id:x.id,bitmap:x.bitmap.clone(),metrics:x.metrics},d[p].ascender=this.entries[p].ascender,d[p].descender=this.entries[p].descender;t(null,d)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Op.none&&(this.localGlyphMode===Op.all?!!this.localFontFamily:!!this.localFontFamily&&(Ea(e)||id(e)||cu(e)||Vo(e)||kl(e)))}_tinySDF(e,t,r){const l=this.localFontFamily;if(!l||!this._doesCharSupportLocalGlyph(r))return;let u=e.tinySDF;if(!u){let O="400";/bold/i.test(t)?O="900":/medium/i.test(t)?O="500":/light/i.test(t)&&(O="200"),u=e.tinySDF=new Zl.TinySDF({fontFamily:l,fontWeight:O,fontSize:48,buffer:6,radius:16}),u.fontWeight=O}if(this.localGlyphs[u.fontWeight][r])return this.localGlyphs[u.fontWeight][r];const d=String.fromCharCode(r),{data:p,width:y,height:x,glyphWidth:E,glyphHeight:C,glyphLeft:M,glyphTop:P,glyphAdvance:D}=u.draw(d);return this.localGlyphs[u.fontWeight][r]={id:r,bitmap:new Ko({width:y,height:x},p),metrics:{width:E/2,height:C/2,left:M/2,top:P/2-27,advance:D/2,localGlyph:!0}}}}function uy(i,e,t,r){const l=[],u=i.image,d=u.pixelRatio,p=u.paddedRect.w-2,y=u.paddedRect.h-2,x=i.right-i.left,E=i.bottom-i.top,C=u.stretchX||[[0,p]],M=u.stretchY||[[0,y]],P=(De,je)=>De+je[1]-je[0],D=C.reduce(P,0),O=M.reduce(P,0),V=p-D,K=y-O;let oe=0,Q=D,ne=0,he=O,se=0,ke=V,Ae=0,Oe=K;if(u.content&&r){const De=u.content;oe=Id(C,0,De[0]),ne=Id(M,0,De[1]),Q=Id(C,De[0],De[2]),he=Id(M,De[1],De[3]),se=De[0]-oe,Ae=De[1]-ne,ke=De[2]-De[0]-Q,Oe=De[3]-De[1]-he}const ut=(De,je,Xe,$e)=>{const st=zd(De.stretch-oe,Q,x,i.left),He=kd(De.fixed-se,ke,De.stretch,D),bt=zd(je.stretch-ne,he,E,i.top),Ht=kd(je.fixed-Ae,Oe,je.stretch,O),Yt=zd(Xe.stretch-oe,Q,x,i.left),Dt=kd(Xe.fixed-se,ke,Xe.stretch,D),mt=zd($e.stretch-ne,he,E,i.top),ci=kd($e.fixed-Ae,Oe,$e.stretch,O),Gt=new G(st,bt),St=new G(Yt,bt),Fi=new G(Yt,mt),ki=new G(st,mt),qi=new G(He/d,Ht/d),Qt=new G(Dt/d,ci/d),mi=e*Math.PI/180;if(mi){const Ii=Math.sin(mi),ji=Math.cos(mi),Wi=[ji,-Ii,Ii,ji];Gt._matMult(Wi),St._matMult(Wi),ki._matMult(Wi),Fi._matMult(Wi)}const Oi=De.stretch+De.fixed,Pi=je.stretch+je.fixed;return{tl:Gt,tr:St,bl:ki,br:Fi,tex:{x:u.paddedRect.x+1+Oi,y:u.paddedRect.y+1+Pi,w:Xe.stretch+Xe.fixed-Oi,h:$e.stretch+$e.fixed-Pi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:qi,pixelOffsetBR:Qt,minFontScaleX:ke/d/x,minFontScaleY:Oe/d/E,isSDF:t}};if(r&&(u.stretchX||u.stretchY)){const De=hy(C,V,D),je=hy(M,K,O);for(let Xe=0;Xe<De.length-1;Xe++){const $e=De[Xe],st=De[Xe+1];for(let He=0;He<je.length-1;He++)l.push(ut($e,je[He],st,je[He+1]))}}else l.push(ut({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:p+1},{fixed:0,stretch:y+1}));return l}function Id(i,e,t){let r=0;for(const l of i)r+=Math.max(e,Math.min(t,l[1]))-Math.max(e,Math.min(t,l[0]));return r}function hy(i,e,t){const r=[{fixed:-1,stretch:0}];for(const[l,u]of i){const d=r[r.length-1];r.push({fixed:l-d.stretch,stretch:d.stretch}),r.push({fixed:l-d.stretch,stretch:d.stretch+(u-l)})}return r.push({fixed:e+1,stretch:t}),r}function zd(i,e,t,r){return i/e*t+r}function kd(i,e,t,r){return i-e*t/r}function ow(i,e,t,r){const l=e+i.positionedLines[r].lineOffset;return r===0?t+l/2:t+(l+(e+i.positionedLines[r-1].lineOffset))/2}Zl.loadGlyphRange=function(i,e,t,r,l){const u=256*e,d=u+255,p=r.transformRequest(r.normalizeGlyphsURL(t).replace("{fontstack}",i).replace("{range}",`${u}-${d}`),de.Glyphs);we(p,(y,x)=>{if(y)l(y);else if(x){const E={},C=function(M){return new Du(M).readFields(Yb,{})}(x);for(const M of C.glyphs)E[M.id]=M;l(null,{glyphs:E,ascender:C.ascender,descender:C.descender})}})},Zl.TinySDF=class{constructor({fontSize:i=24,buffer:e=3,radius:t=8,cutoff:r=.25,fontFamily:l="sans-serif",fontWeight:u="normal",fontStyle:d="normal"}={}){this.buffer=e,this.cutoff=r,this.radius=t;const p=this.size=i+4*e,y=this._createCanvas(p),x=this.ctx=y.getContext("2d",{willReadFrequently:!0});x.font=`${d} ${u} ${i}px ${l}`,x.textBaseline="alphabetic",x.textAlign="left",x.fillStyle="black",this.gridOuter=new Float64Array(p*p),this.gridInner=new Float64Array(p*p),this.f=new Float64Array(p),this.z=new Float64Array(p+1),this.v=new Uint16Array(p)}_createCanvas(i){const e=document.createElement("canvas");return e.width=e.height=i,e}draw(i){const{width:e,actualBoundingBoxAscent:t,actualBoundingBoxDescent:r,actualBoundingBoxLeft:l,actualBoundingBoxRight:u}=this.ctx.measureText(i),d=Math.ceil(t),p=Math.min(this.size-this.buffer,Math.ceil(u-l)),y=Math.min(this.size-this.buffer,d+Math.ceil(r)),x=p+2*this.buffer,E=y+2*this.buffer,C=Math.max(x*E,0),M=new Uint8ClampedArray(C),P={data:M,width:x,height:E,glyphWidth:p,glyphHeight:y,glyphTop:d,glyphLeft:0,glyphAdvance:e};if(p===0||y===0)return P;const{ctx:D,buffer:O,gridInner:V,gridOuter:K}=this;D.clearRect(O,O,p,y),D.fillText(i,O,O+d);const oe=D.getImageData(O,O,p,y);K.fill(Ru,0,C),V.fill(0,0,C);for(let Q=0;Q<y;Q++)for(let ne=0;ne<p;ne++){const he=oe.data[4*(Q*p+ne)+3]/255;if(he===0)continue;const se=(Q+O)*x+ne+O;if(he===1)K[se]=0,V[se]=Ru;else{const ke=.5-he;K[se]=ke>0?ke*ke:0,V[se]=ke<0?ke*ke:0}}ly(K,0,0,x,E,x,this.f,this.v,this.z),ly(V,O,O,p,y,x,this.f,this.v,this.z);for(let Q=0;Q<C;Q++){const ne=Math.sqrt(K[Q])-Math.sqrt(V[Q]);M[Q]=Math.round(255-255*(ne/this.radius+this.cutoff))}return P}};class sw{constructor(e=[],t=aw){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:r}=this,l=t[e];for(;e>0;){const u=e-1>>1,d=t[u];if(r(l,d)>=0)break;t[e]=d,e=u}t[e]=l}_down(e){const{data:t,compare:r}=this,l=this.length>>1,u=t[e];for(;e<l;){let d=1+(e<<1),p=t[d];const y=d+1;if(y<this.length&&r(t[y],p)<0&&(d=y,p=t[y]),r(p,u)>=0)break;t[e]=p,e=d}t[e]=u}}function aw(i,e){return i<e?-1:i>e?1:0}function lw(i,e=1,t=!1){let r=1/0,l=1/0,u=-1/0,d=-1/0;const p=i[0];for(let P=0;P<p.length;P++){const D=p[P];(!P||D.x<r)&&(r=D.x),(!P||D.y<l)&&(l=D.y),(!P||D.x>u)&&(u=D.x),(!P||D.y>d)&&(d=D.y)}const y=Math.min(u-r,d-l);let x=y/2;const E=new sw([],cw);if(y===0)return new G(r,l);for(let P=r;P<u;P+=y)for(let D=l;D<d;D+=y)E.push(new Wl(P+x,D+x,x,i));let C=function(P){let D=0,O=0,V=0;const K=P[0];for(let oe=0,Q=K.length,ne=Q-1;oe<Q;ne=oe++){const he=K[oe],se=K[ne],ke=he.x*se.y-se.x*he.y;O+=(he.x+se.x)*ke,V+=(he.y+se.y)*ke,D+=3*ke}return new Wl(O/D,V/D,0,P)}(i),M=E.length;for(;E.length;){const P=E.pop();(P.d>C.d||!C.d)&&(C=P,t&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,M)),P.max-C.d<=e||(x=P.h/2,E.push(new Wl(P.p.x-x,P.p.y-x,x,i)),E.push(new Wl(P.p.x+x,P.p.y-x,x,i)),E.push(new Wl(P.p.x-x,P.p.y+x,x,i)),E.push(new Wl(P.p.x+x,P.p.y+x,x,i)),M+=4)}return t&&(console.log(`num probes: ${M}`),console.log(`best distance: ${C.d}`)),C.p}function cw(i,e){return e.max-i.max}function Wl(i,e,t,r){this.p=new G(i,e),this.h=t,this.d=function(l,u){let d=!1,p=1/0;for(let y=0;y<u.length;y++){const x=u[y];for(let E=0,C=x.length,M=C-1;E<C;M=E++){const P=x[E],D=x[M];P.y>l.y!=D.y>l.y&&l.x<(D.x-P.x)*(l.y-P.y)/(D.y-P.y)+P.x&&(d=!d),p=Math.min(p,J_(l,P,D))}}return(d?1:-1)*Math.sqrt(p)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}const Up=Number.POSITIVE_INFINITY,uw=Math.sqrt(2);function dy(i,e){return e[1]!==Up?function(t,r,l){let u=0,d=0;switch(r=Math.abs(r),l=Math.abs(l),t){case"top-right":case"top-left":case"top":d=l-7;break;case"bottom-right":case"bottom-left":case"bottom":d=7-l}switch(t){case"top-right":case"bottom-right":case"right":u=-r;break;case"top-left":case"bottom-left":case"left":u=r}return[u,d]}(i,e[0],e[1]):function(t,r){let l=0,u=0;r<0&&(r=0);const d=r/uw;switch(t){case"top-right":case"top-left":u=d-7;break;case"bottom-right":case"bottom-left":u=7-d;break;case"bottom":u=7-r;break;case"top":u=r-7}switch(t){case"top-right":case"bottom-right":l=-d;break;case"top-left":case"bottom-left":l=d;break;case"left":l=r;break;case"right":l=-r}return[l,u]}(i,e[0])}function hw(i,e,t,r,l,u,d,p,y,x){i.createArrays(),i.tilePixelRatio=$t/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const E=i.layers[0].layout,C=i.layers[0]._unevaluatedLayout._values,M={};if(i.textSizeData.kind==="composite"){const{minZoom:O,maxZoom:V}=i.textSizeData;M.compositeTextSizes=[C["text-size"].possiblyEvaluate(new $(O),p),C["text-size"].possiblyEvaluate(new $(V),p)]}if(i.iconSizeData.kind==="composite"){const{minZoom:O,maxZoom:V}=i.iconSizeData;M.compositeIconSizes=[C["icon-size"].possiblyEvaluate(new $(O),p),C["icon-size"].possiblyEvaluate(new $(V),p)]}M.layoutTextSize=C["text-size"].possiblyEvaluate(new $(y+1),p),M.layoutIconSize=C["icon-size"].possiblyEvaluate(new $(y+1),p),M.textMaxSize=C["text-size"].possiblyEvaluate(new $(18),p);const P=E.get("text-rotation-alignment")==="map"&&E.get("symbol-placement")!=="point",D=E.get("text-size");for(const O of i.features){const V=E.get("text-font").evaluate(O,{},p).join(","),K=D.evaluate(O,{},p),oe=M.layoutTextSize.evaluate(O,{},p),Q=(M.layoutIconSize.evaluate(O,{},p),{horizontal:{},vertical:void 0}),ne=O.text;let he,se=[0,0];if(ne){const Oe=ne.toString(),ut=E.get("text-letter-spacing").evaluate(O,{},p)*Mn,De=E.get("text-line-height").evaluate(O,{},p)*Mn,je=tp(Oe)?ut:0,Xe=E.get("text-anchor").evaluate(O,{},p),$e=E.get("text-variable-anchor");if(!$e){const Dt=E.get("text-radial-offset").evaluate(O,{},p);se=Dt?dy(Xe,[Dt*Mn,Up]):E.get("text-offset").evaluate(O,{},p).map(mt=>mt*Mn)}let st=P?"center":E.get("text-justify").evaluate(O,{},p);const He=E.get("symbol-placement"),bt=He==="point",Ht=He==="point"?E.get("text-max-width").evaluate(O,{},p)*Mn:0,Yt=Dt=>{i.allowVerticalPlacement&&Dl(Oe)&&(Q.vertical=Rp(ne,e,t,l,V,Ht,De,Xe,Dt,je,se,Ir.vertical,!0,He,oe,K))};if(!P&&$e){const Dt=st==="auto"?$e.map(ci=>Vp(ci)):[st];let mt=!1;for(let ci=0;ci<Dt.length;ci++){const Gt=Dt[ci];if(!Q.horizontal[Gt])if(mt)Q.horizontal[Gt]=Q.horizontal[0];else{const St=Rp(ne,e,t,l,V,Ht,De,"center",Gt,je,se,Ir.horizontal,!1,He,oe,K);St&&(Q.horizontal[Gt]=St,mt=St.positionedLines.length===1)}}Yt("left")}else{if(st==="auto"&&(st=Vp(Xe)),bt||E.get("text-writing-mode").indexOf("horizontal")>=0||!Dl(Oe)){const Dt=Rp(ne,e,t,l,V,Ht,De,Xe,st,je,se,Ir.horizontal,!1,He,oe,K);Dt&&(Q.horizontal[st]=Dt)}Yt(He==="point"?"left":st)}}let ke=!1;if(O.icon&&O.icon.name){const Oe=r[O.icon.name];Oe&&(he=iw(l[O.icon.name],E.get("icon-offset").evaluate(O,{},p),E.get("icon-anchor").evaluate(O,{},p)),ke=Oe.sdf,i.sdfIcons===void 0?i.sdfIcons=Oe.sdf:i.sdfIcons!==Oe.sdf&&Jt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Oe.pixelRatio!==i.pixelRatio||E.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const Ae=py(Q.horizontal)||Q.vertical;i.iconsInText||(i.iconsInText=!!Ae&&Ae.iconsInText),(Ae||he)&&dw(i,O,Q,he,r,M,oe,0,se,ke,d,p,x)}u&&i.generateCollisionDebugBuffers(y,i.collisionBoxArray)}function Vp(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function dw(i,e,t,r,l,u,d,p,y,x,E,C,M){let P=u.textMaxSize.evaluate(e,{},C);P===void 0&&(P=d);const D=i.layers[0].layout,O=D.get("icon-offset").evaluate(e,{},C),V=py(t.horizontal)||t.vertical,K=M.name==="globe",oe=d/24,Q=i.tilePixelRatio*P/24,ne=(je=i.overscaling,i.zoom>18&&je>2&&(je>>=1),Math.max($t/(512*je),1)*D.get("symbol-spacing")),he=D.get("text-padding")*i.tilePixelRatio,se=D.get("icon-padding")*i.tilePixelRatio,ke=Te(D.get("text-max-angle")),Ae=D.get("text-rotation-alignment")==="map"&&D.get("symbol-placement")!=="point",Oe=D.get("icon-rotation-alignment")==="map"&&D.get("symbol-placement")!=="point",ut=D.get("symbol-placement"),De=ne/2;var je;const Xe=D.get("icon-text-fit");let $e;r&&Xe!=="none"&&(i.allowVerticalPlacement&&t.vertical&&($e=ty(r,t.vertical,Xe,D.get("icon-text-fit-padding"),O,oe)),V&&(r=ty(r,V,Xe,D.get("icon-text-fit-padding"),O,oe)));const st=(He,bt,Ht)=>{if(bt.x<0||bt.x>=$t||bt.y<0||bt.y>=$t)return;let Yt=null;if(K){const{x:Dt,y:mt,z:ci}=M.projectTilePoint(bt.x,bt.y,Ht);Yt={anchor:new Jo(Dt,mt,ci,0,void 0),up:M.upVector(Ht,bt.x,bt.y)}}(function(Dt,mt,ci,Gt,St,Fi,ki,qi,Qt,mi,Oi,Pi,Ii,ji,Wi,gn,lr,ui,Ji,Fn,xi,Xi,Kn,Gi,en){const yn=Dt.addToLineVertexArray(mt,Gt);let pn,In,Yn,xn,es,Jl,Zu,Wu=0,Yy=0,Jy=0,Qy=0,nm=-1,rm=-1;const Mo={};let ex=yu("");const Fa=ci?ci.anchor:mt;let om=0,sm=0;if(Qt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[om,sm]=Qt.layout.get("text-offset").evaluate(xi,{},en).map(gr=>gr*Mn):(om=Qt.layout.get("text-radial-offset").evaluate(xi,{},en)*Mn,sm=Up),Dt.allowVerticalPlacement&&St.vertical){const gr=St.vertical;if(Wi)Jl=Np(gr),qi&&(Zu=Np(qi));else{const yr=Qt.layout.get("text-rotate").evaluate(xi,{},en)+90;Yn=Pd(mi,Fa,mt,Oi,Pi,Ii,gr,ji,yr,gn),qi&&(xn=Pd(mi,Fa,mt,Oi,Pi,Ii,qi,ui,yr))}}if(Fi){const gr=Qt.layout.get("icon-rotate").evaluate(xi,{},en),yr=Qt.layout.get("icon-text-fit")!=="none",Xu=uy(Fi,gr,Kn,yr),lm=qi?uy(qi,gr,Kn,yr):void 0;In=Pd(mi,Fa,mt,Oi,Pi,Ii,Fi,ui,gr),Wu=4*Xu.length;const tx=Dt.iconSizeData;let Oa=null;tx.kind==="source"?(Oa=[To*Qt.layout.get("icon-size").evaluate(xi,{},en)],Oa[0]>Ps&&Jt(`${Dt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):tx.kind==="composite"&&(Oa=[To*Xi.compositeIconSizes[0].evaluate(xi,{},en),To*Xi.compositeIconSizes[1].evaluate(xi,{},en)],(Oa[0]>Ps||Oa[1]>Ps)&&Jt(`${Dt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Dt.addSymbols(Dt.icon,Xu,Oa,Fn,Ji,xi,!1,ci,mt,yn.lineStartIndex,yn.lineLength,-1,Gi,en),nm=Dt.icon.placedSymbolArray.length-1,lm&&(Yy=4*lm.length,Dt.addSymbols(Dt.icon,lm,Oa,Fn,Ji,xi,Ir.vertical,ci,mt,yn.lineStartIndex,yn.lineLength,-1,Gi,en),rm=Dt.icon.placedSymbolArray.length-1)}for(const gr in St.horizontal){const yr=St.horizontal[gr];pn||(ex=yu(yr.text),Wi?es=Np(yr):pn=Pd(mi,Fa,mt,Oi,Pi,Ii,yr,ji,Qt.layout.get("text-rotate").evaluate(xi,{},en),gn));const Xu=yr.positionedLines.length===1;if(Jy+=fy(Dt,ci,mt,yr,ki,Qt,Wi,xi,gn,yn,St.vertical?Ir.horizontal:Ir.horizontalOnly,Xu?Object.keys(St.horizontal):[gr],Mo,nm,Xi,Gi,en),Xu)break}St.vertical&&(Qy+=fy(Dt,ci,mt,St.vertical,ki,Qt,Wi,xi,gn,yn,Ir.vertical,["vertical"],Mo,rm,Xi,Gi,en));let Os=-1;const am=(gr,yr)=>gr?Math.max(gr,yr):yr;Os=am(es,Os),Os=am(Jl,Os),Os=am(Zu,Os);const qw=Os>-1?1:0;Dt.glyphOffsetArray.length>=Ls.MAX_GLYPHS&&Jt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),xi.sortKey!==void 0&&Dt.addToSortKeyRanges(Dt.symbolInstances.length,xi.sortKey),Dt.symbolInstances.emplaceBack(Fa.x,Fa.y,Fa.z,mt.x,mt.y,Mo.right>=0?Mo.right:-1,Mo.center>=0?Mo.center:-1,Mo.left>=0?Mo.left:-1,Mo.vertical>=0?Mo.vertical:-1,nm,rm,ex,pn!==void 0?pn:Dt.collisionBoxArray.length,pn!==void 0?pn+1:Dt.collisionBoxArray.length,Yn!==void 0?Yn:Dt.collisionBoxArray.length,Yn!==void 0?Yn+1:Dt.collisionBoxArray.length,In!==void 0?In:Dt.collisionBoxArray.length,In!==void 0?In+1:Dt.collisionBoxArray.length,xn||Dt.collisionBoxArray.length,xn?xn+1:Dt.collisionBoxArray.length,Oi,Jy,Qy,Wu,Yy,qw,0,om,sm,Os)})(i,bt,Yt,He,t,r,l,$e,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,he,Ae,y,0,se,Oe,O,e,u,x,E,C)};if(ut==="line")for(const He of ay(e.geometry,0,0,$t,$t)){const bt=rw(He,ne,ke,t.vertical||V,r,24,Q,i.overscaling,$t);for(const Ht of bt){const Yt=V;Yt&&fw(i,Yt.text,De,Ht)||st(He,Ht,C)}}else if(ut==="line-center"){for(const He of e.geometry)if(He.length>1){const bt=nw(He,ke,t.vertical||V,r,24,Q);bt&&st(He,bt,C)}}else if(e.type==="Polygon")for(const He of Mp(e.geometry,0)){const bt=lw(He,16);st(He[0],new Jo(bt.x,bt.y,0,0,void 0),C)}else if(e.type==="LineString")for(const He of e.geometry)st(He,new Jo(He[0].x,He[0].y,0,0,void 0),C);else if(e.type==="Point")for(const He of e.geometry)for(const bt of He)st([bt],new Jo(bt.x,bt.y,0,0,void 0),C)}const Ps=32640;function fy(i,e,t,r,l,u,d,p,y,x,E,C,M,P,D,O,V){const K=function(ne,he,se,ke,Ae,Oe,ut,De){const je=[];if(he.positionedLines.length===0)return je;const Xe=ke.layout.get("text-rotate").evaluate(Oe,{})*Math.PI/180,$e=function(Yt){const Dt=Yt[0],mt=Yt[1],ci=Dt*mt;return ci>0?[Dt,-mt]:ci<0?[-Dt,mt]:Dt===0?[mt,Dt]:[mt,-Dt]}(se);let st=Math.abs(he.top-he.bottom);for(const Yt of he.positionedLines)st-=Yt.lineOffset;const He=he.positionedLines.length,bt=st/He;let Ht=he.top-se[1];for(let Yt=0;Yt<He;++Yt){const Dt=he.positionedLines[Yt];Ht=ow(he,bt,Ht,Yt);for(const mt of Dt.positionedGlyphs){if(!mt.rect)continue;const ci=mt.rect||{};let Gt=4,St=!0,Fi=1,ki=0;if(mt.imageName){const Gi=ut[mt.imageName];if(!Gi)continue;if(Gi.sdf){Jt("SDF images are not supported in formatted text and will be ignored.");continue}St=!1,Fi=Gi.pixelRatio,Gt=1/Fi}const qi=(Ae||De)&&mt.vertical,Qt=mt.metrics.advance*mt.scale/2,mi=mt.metrics,Oi=mt.rect;if(Oi===null)continue;De&&he.verticalizable&&(ki=mt.imageName?Qt-mt.metrics.width*mt.scale/2:0);const Pi=Ae?[mt.x+Qt,mt.y]:[0,0];let Ii=[0,0],ji=[0,0],Wi=!1;Ae||(qi?(ji=[mt.x+Qt+$e[0],mt.y+$e[1]-ki],Wi=!0):Ii=[mt.x+Qt+se[0],mt.y+se[1]-ki]);const gn=Oi.w*mt.scale/(Fi*(mt.localGlyph?2:1)),lr=Oi.h*mt.scale/(Fi*(mt.localGlyph?2:1));let ui,Ji,Fn,xi;if(qi){const Gi=mt.y-Ht,en=new G(-Qt,Qt-Gi),yn=-Math.PI/2,pn=new G(...ji);ui=new G(-Qt+Ii[0],Ii[1]),ui._rotateAround(yn,en)._add(pn),ui.x+=-Gi+Qt,ui.y-=(mi.left-Gt)*mt.scale;const In=mt.imageName?mi.advance*mt.scale:Mn*mt.scale,Yn=String.fromCharCode(mt.glyph);Vb(Yn)?ui.x+=(1-Gt)*mt.scale:Nb(Yn)?ui.x+=In-mi.height*mt.scale+(-Gt-1)*mt.scale:ui.x+=mt.imageName||mi.width+2*Gt===Oi.w&&mi.height+2*Gt===Oi.h?(In-lr)/2:(In-(mi.height+2*Gt)*mt.scale)/2,Ji=new G(ui.x,ui.y-gn),Fn=new G(ui.x+lr,ui.y),xi=new G(ui.x+lr,ui.y-gn)}else{const Gi=(mi.left-Gt)*mt.scale-Qt+Ii[0],en=(-mi.top-Gt)*mt.scale+Ii[1],yn=Gi+gn,pn=en+lr;ui=new G(Gi,en),Ji=new G(yn,en),Fn=new G(Gi,pn),xi=new G(yn,pn)}if(Xe){let Gi;Gi=Ae?new G(0,0):Wi?new G($e[0],$e[1]):new G(se[0],se[1]),ui._rotateAround(Xe,Gi),Ji._rotateAround(Xe,Gi),Fn._rotateAround(Xe,Gi),xi._rotateAround(Xe,Gi)}const Xi=new G(0,0),Kn=new G(0,0);je.push({tl:ui,tr:Ji,bl:Fn,br:xi,tex:ci,writingMode:he.writingMode,glyphOffset:Pi,sectionIndex:mt.sectionIndex,isSDF:St,pixelOffsetTL:Xi,pixelOffsetBR:Kn,minFontScaleX:0,minFontScaleY:0})}}return je}(0,r,y,u,d,p,l,i.allowVerticalPlacement),oe=i.textSizeData;let Q=null;oe.kind==="source"?(Q=[To*u.layout.get("text-size").evaluate(p,{},V)],Q[0]>Ps&&Jt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):oe.kind==="composite"&&(Q=[To*D.compositeTextSizes[0].evaluate(p,{},V),To*D.compositeTextSizes[1].evaluate(p,{},V)],(Q[0]>Ps||Q[1]>Ps)&&Jt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,K,Q,y,d,p,E,e,t,x.lineStartIndex,x.lineLength,P,O,V);for(const ne of C)M[ne]=i.text.placedSymbolArray.length-1;return 4*K.length}function py(i){for(const e in i)return i[e];return null}function Pd(i,e,t,r,l,u,d,p,y,x){let E=d.top,C=d.bottom,M=d.left,P=d.right;const D=d.collisionPadding;if(D&&(M-=D[0],E-=D[1],P+=D[2],C+=D[3]),y){const O=new G(M,E),V=new G(P,E),K=new G(M,C),oe=new G(P,C),Q=Te(y);let ne=new G(0,0);x&&(ne=new G(x[0],x[1])),O._rotateAround(Q,ne),V._rotateAround(Q,ne),K._rotateAround(Q,ne),oe._rotateAround(Q,ne),M=Math.min(O.x,V.x,K.x,oe.x),P=Math.max(O.x,V.x,K.x,oe.x),E=Math.min(O.y,V.y,K.y,oe.y),C=Math.max(O.y,V.y,K.y,oe.y)}return i.emplaceBack(e.x,e.y,e.z,t.x,t.y,M,E,P,C,p,r,l,u),i.length-1}function Np(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const e=i.bottom-i.top;return e>0?Math.max(10,e):null}function fw(i,e,t,r){const l=i.compareText;if(e in l){const u=l[e];for(let d=u.length-1;d>=0;d--)if(r.dist(u[d])<t)return!0}else l[e]=[];return l[e].push(r),!1}const pw=qe([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:my}=pw,_y=qe([{name:"a_pos_3",components:3,type:"Int16"}]);var Bu=qe([{name:"a_pos",type:"Int16",components:2}]);const Qo=$t/Math.PI/2,jp=2*Dr(1,0)*Qo*Math.PI,Xl=[64,32,16],Jr=-Qo,Qr=Qo,mw=[new ar([Jr,Jr,Jr],[Qr,Qr,Qr]),new ar([Jr,Jr,Jr],[0,0,Qr]),new ar([0,Jr,Jr],[Qr,0,Qr]),new ar([Jr,0,Jr],[0,Qr,Qr]),new ar([0,0,Jr],[Qr,Qr,Qr])];function gy(i,e,t,r=!0){const l=Kr([],i._camera.position,i.worldSize),u=[e,t,1,1];Pa(u,u,i.pixelMatrixInverse),cg(u,u,1/u[3]);const d=Xn([],Yr([],u,l)),p=i.globeMatrix,y=[p[12],p[13],p[14]],x=Yr([],y,l),E=bu(x),C=Xn([],x),M=i.worldSize/(2*Math.PI),P=Rr(C,d),D=Math.asin(M/E);if(D<Math.acos(P)){if(!r)return null;const ut=[],De=[];Kr(ut,d,E/P),Xn(De,Yr(De,ut,x)),Xn(d,ks(d,x,Kr(d,De,Math.tan(D)*E)))}const O=[];new vp(l,d).closestPointOnSphere(y,M,O);const V=Xn([],nr(p,0)),K=Xn([],nr(p,1)),oe=Xn([],nr(p,2)),Q=Rr(V,O),ne=Rr(K,O),he=Rr(oe,O),se=Be(Math.asin(-ne/M));let ke=Be(Math.atan2(Q,he));ke=i.center.lng+function(ut,De){const je=(De-ut+180)%360-180;return je<-180?je+360:je}(i.center.lng,ke);const Ae=vo(ke),Oe=Ie(Xo(se),0,1);return new Bl(Ae,Oe)}class _w{constructor(e,t,r){this.a=Yr([],e,r),this.b=Yr([],t,r),this.center=r;const l=Xn([],this.a),u=Xn([],this.b);this.angle=Math.acos(Rr(l,u))}}function $p(i,e){if(i.angle===0)return null;let t;return t=i.a[e]===0?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[e]/i.a[e]/Math.sin(i.angle)-1/Math.tan(i.angle)),t<0||t>1?null:function(r,l,u,d){const p=Math.sin(u);return r*(Math.sin((1-d)*u)/p)+l*(Math.sin(d*u)/p)}(i.a[e],i.b[e],i.angle,Ie(t,0,1))+i.center[e]}function Eo(i){if(i.z<=1)return mw[i.z+2*i.y+i.x];const e=qp(Dd(i));return ar.fromPoints(e)}function yy(i,e){const t=Uu(e.zoom);if(t===0)return Eo(i);const r=Dd(i),l=qp(r),u=vo(r.getWest())*e.worldSize,d=vo(r.getEast())*e.worldSize,p=Xo(r.getNorth())*e.worldSize,y=Xo(r.getSouth())*e.worldSize,x=[u,p,0],E=[d,p,0],C=[u,y,0],M=[d,y,0],P=fp([],e.globeMatrix);return un(x,x,P),un(E,E,P),un(C,C,P),un(M,M,P),l[0]=ms(l[0],C,t),l[1]=ms(l[1],M,t),l[2]=ms(l[2],E,t),l[3]=ms(l[3],x,t),ar.fromPoints(l)}function xy(i,e,t,r,l){for(const u of t)un(u,u,r),Kr(u,u,l),gp(i,i,u),yp(e,e,u)}function gw(i,e,t){const r=e/i.worldSize,l=Number.MAX_VALUE,u=[-l,-l,-l],d=[l,l,l],p=i.globeMatrix;if(t.z<=1)return xy(d,u,Eo(t).getCorners(),p,r),new ar(d,u);const y=Dd(t),x=qp(y);if(xy(d,u,x,p,r),y.contains(i.center)){u[2]=0;const ke=i.point,Ae=[ke.x*r,ke.y*r,0];return gp(d,d,Ae),yp(u,u,Ae),new ar(d,u)}const E=[p[12]*r,p[13]*r,p[14]*r],C=y.getCenter(),M=Ie(i.center.lat,-85.051129,bo),P=Ie(C.lat,-85.051129,bo),D=vo(i.center.lng),O=Xo(M);let V=D-vo(C.lng);const K=O-Xo(P);V>.5?V-=1:V<-.5&&(V+=1);let oe=0;Math.abs(V)>Math.abs(K)?oe=V>=0?1:3:(oe=K>=0?0:2,md(E,E,[p[4]*r,p[5]*r,p[6]*r],-Math.sin(Te(K>=0?y.getSouth():y.getNorth()))*Qo));const Q=x[oe],ne=x[(oe+1)%4],he=new _w(Q,ne,E),se=[$p(he,0)||Q[0],$p(he,1)||Q[1],$p(he,2)||Q[2]];return d[2]=Math.min(Q[2],ne[2]),gp(d,d,se),yp(u,u,se),new ar(d,u)}function Dd({x:i,y:e,z:t}){const r=1/(1<<t),l=new vi(Lr(i*r),An((e+1)*r)),u=new vi(Lr((i+1)*r),An(e*r));return new zs(l,u)}function qp(i){const e=Te(i.getNorth()),t=Te(i.getSouth()),r=Math.cos(e),l=Math.cos(t),u=Math.sin(e),d=Math.sin(t),p=i.getWest(),y=i.getEast();return[Hl(l,d,p),Hl(l,d,y),Hl(r,u,y),Hl(r,u,p)]}function Hl(i,e,t,r=Qo){return t=Te(t),[i*Math.sin(t)*r,-e*r,i*Math.cos(t)*r]}function Ld(i,e,t){return Hl(Math.cos(Te(i)),Math.sin(Te(i)),e,t)}function Fu(i,e,t,r){const l=1<<t.z,u=(i/$t+t.x)/l;return Ld(An((e/$t+t.y)/l),Lr(u),r)}function Rd({min:i,max:e}){return 16383/Math.max(e[0]-i[0],e[1]-i[1],e[2]-i[2])}const vy=new Float64Array(16);function Ou(i){const e=Rd(i),t=rg(vy,[e,e,e]);return vu(t,t,((r=[])[0]=-(l=i.min)[0],r[1]=-l[1],r[2]=-l[2],r));var r,l}function Gp(i){const e=(r=i.min,(t=vy)[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t);var t,r;const l=1/Rd(i);return ka(e,e,[l,l,l])}function by(i,e,t,r,l){const u=function(y){const x=$t/(2*Math.PI);return y/(2*Math.PI)/x}(t),d=[i,e,-t/(2*Math.PI)],p=wo(new Float64Array(16));return vu(p,p,d),ka(p,p,[u,u,u]),pp(p,p,Te(-l)),pd(p,p,Te(-r)),p}function Uu(i){return Pe(5,6,i)}function wy(i,e){const t=Ld(e.lat,e.lng);return u=(r=_p([],function(P){const D=Ld(P._center.lat,P._center.lng);let O=xp([],Ul(0,1,0),D);const V=og([],-P.angle,D);O=un(O,O,V),og(V,-P._pitch,O);const K=Xn([],D);return Kr(K,K,P.cameraToCenterDistance/P.pixelsPerMeter*jp),un(K,K,V),ks([],D,K)}(i),t))[0],d=r[1],p=r[2],y=(l=t)[0],x=l[1],E=l[2],M=(C=Math.sqrt(u*u+d*d+p*p)*Math.sqrt(y*y+x*x+E*E))&&Rr(r,l)/C,Math.acos(Math.min(Math.max(M,-1),1));var r,l,u,d,p,y,x,E,C,M}const Ty=Te(85),yw=Math.cos(Ty),xw=Math.sin(Ty);function Ey(i,e){const t=i.fovAboveCenter,r=i.elevation?i.elevation.getMinElevationBelowMSL()*e:0,l=(i._camera.position[2]*i.worldSize-r)/Math.cos(i._pitch),u=Math.sin(t)*l/Math.sin(Math.max(Math.PI/2-i._pitch-t,.01)),d=Math.sin(i._pitch)*u+l;return Math.min(1.01*d,l*(1/i._horizonShift))}function Ra(i,e){if(!e.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:e};const t=Math.pow(2,-i.z),r=i.x*t,l=(i.x+1)*t,u=i.y*t,d=(i.y+1)*t,p=Lr(r),y=Lr(l),x=An(u),E=An(d),C=e.project(p,x),M=e.project(y,x),P=e.project(y,E),D=e.project(p,E);let O=Math.min(C.x,M.x,P.x,D.x),V=Math.min(C.y,M.y,P.y,D.y),K=Math.max(C.x,M.x,P.x,D.x),oe=Math.max(C.y,M.y,P.y,D.y);const Q=t/16;function ne(se,ke,Ae,Oe,ut,De){const je=(Ae+ut)/2,Xe=(Oe+De)/2,$e=e.project(Lr(je),An(Xe)),st=Math.max(0,O-$e.x,V-$e.y,$e.x-K,$e.y-oe);O=Math.min(O,$e.x),K=Math.max(K,$e.x),V=Math.min(V,$e.y),oe=Math.max(oe,$e.y),st>Q&&(ne(se,$e,Ae,Oe,je,Xe),ne($e,ke,je,Xe,ut,De))}ne(C,M,r,u,l,u),ne(M,P,l,u,l,d),ne(P,D,l,d,r,d),ne(D,C,r,d,r,u),O-=Q,V-=Q,K+=Q,oe+=Q;const he=1/Math.max(K-O,oe-V);return{scale:he,x:O*he,y:V*he,x2:K*he,y2:oe*he,projection:e}}const vw=wo(new Float32Array(16));class Ds{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new vi(0,0)}projectTilePoint(e,t,r){return{x:e,y:t,z:0}}locationPoint(e,t,r=!0){return e._coordinatePoint(e.locationCoordinate(t),r)}pixelsPerMeter(e,t){return Dr(1,e)*t}pixelSpaceConversion(e,t,r){return 1}farthestPixelDistance(e){return Ey(e,e.pixelsPerMeter)}pointCoordinate(e,t,r,l){const u=e.horizonLineFromTop(!1),d=new G(t,Math.max(u,r));return e.rayIntersectionCoordinate(e.pointRayIntersection(d,l))}pointCoordinate3D(e,t,r){const l=new G(t,r);if(e.elevation)return e.elevation.pointCoordinate(l);{const u=this.pointCoordinate(e,l.x,l.y,0);return[u.x,u.y,u.z]}}isPointAboveHorizon(e,t){if(e.elevation)return!this.pointCoordinate3D(e,t.x,t.y);const r=e.horizonLineFromTop();return t.y<r}createInversionMatrix(e,t){return vw}createTileMatrix(e,t,r){let l,u,d;const p=r.canonical,y=wo(new Float64Array(16));if(this.isReprojectedInTileSpace){const x=Ra(p,this);l=1,u=x.x+r.wrap*x.scale,d=x.y,ka(y,y,[l/x.scale,l/x.scale,e.pixelsPerMeter/t])}else l=t/e.zoomScale(p.z),u=(p.x+Math.pow(2,p.z)*r.wrap)*l,d=p.y*l;return vu(y,y,[u,d,0]),ka(y,y,[l/$t,l/$t,1]),y}upVector(e,t,r){return[0,0,1]}upVectorScale(e,t,r){return{metersToTile:1}}}class bw extends Ds{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,r]=this.parallels=e.parallels||[29.5,45.5],l=Math.sin(Te(t));this.n=(l+Math.sin(Te(r)))/2,this.c=1+l*(2*this.n-l),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n:r,c:l,r0:u}=this,d=Te(e-this.center[0]),p=Te(t),y=Math.sqrt(l-2*r*Math.sin(p))/r;return{x:y*Math.sin(d*r),y:y*Math.cos(d*r)-u,z:0}}unproject(e,t){const{n:r,c:l,r0:u}=this,d=u+t;let p=Math.atan2(e,Math.abs(d))*Math.sign(d);d*r<0&&(p-=Math.PI*Math.sign(e)*Math.sign(d));const y=Te(this.center[0])*r;p=be(p,-Math.PI-y,Math.PI-y);const x=Be(p/r)+this.center[0],E=Math.asin(Ie((l-(e*e+d*d)*r*r)/(2*r),-1,1)),C=Ie(Be(E),-85.051129,bo);return new vi(x,C)}}const Vu=1.340264,Nu=-.081106,ju=893e-6,$u=.003796,Bd=Math.sqrt(3)/2;class ww extends Ds{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const r=Math.asin(Bd*Math.sin(t)),l=r*r,u=l*l*l;return{x:.5*(e*Math.cos(r)/(Bd*(Vu+3*Nu*l+u*(7*ju+9*$u*l)))/Math.PI+.5),y:1-.5*(r*(Vu+Nu*l+u*(ju+$u*l))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let r=t=(2*(1-t)-1)*Math.PI,l=r*r,u=l*l*l;for(let E,C,M,P=0;P<12&&(C=r*(Vu+Nu*l+u*(ju+$u*l))-t,M=Vu+3*Nu*l+u*(7*ju+9*$u*l),E=C/M,r=Ie(r-E,-Math.PI/3,Math.PI/3),l=r*r,u=l*l*l,!(Math.abs(E)<1e-12));++P);const d=Bd*e*(Vu+3*Nu*l+u*(7*ju+9*$u*l))/Math.cos(r),p=Math.asin(Math.sin(r)/Bd),y=Ie(180*d/Math.PI,-180,180),x=Ie(180*p/Math.PI,-85.051129,bo);return new vi(y,x)}}class Tw extends Ds{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const r=360*(e-.5),l=Ie(360*(.5-t),-85.051129,bo);return new vi(r,l)}}const Kl=Math.PI/2;function Fd(i){return Math.tan((Kl+i)/2)}class Ew extends Ds{constructor(e){super(e),this.center=e.center||[0,30];const[t,r]=this.parallels=e.parallels||[30,30],l=Te(t),u=Te(r),d=Math.cos(l);this.n=l===u?Math.sin(l):Math.log(d/Math.cos(u))/Math.log(Fd(u)/Fd(l)),this.f=d*Math.pow(Fd(l),this.n)/this.n}project(e,t){t=Te(t),e=Te(e-this.center[0]);const r=1e-6,{n:l,f:u}=this;u>0?t<-Kl+r&&(t=-Kl+r):t>Kl-r&&(t=Kl-r);const d=u/Math.pow(Fd(t),l),p=d*Math.sin(l*e),y=u-d*Math.cos(l*e);return{x:.5*(p/Math.PI+.5),y:1-.5*(y/Math.PI+.5),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,t=(2*(1-t)-.5)*Math.PI;const{n:r,f:l}=this,u=l-t,d=Math.sign(u),p=Math.sign(r)*Math.sqrt(e*e+u*u);let y=Math.atan2(e,Math.abs(u))*d;u*r<0&&(y-=Math.PI*Math.sign(e)*d);const x=Ie(Be(y/r)+this.center[0],-180,180),E=Ie(Be(2*Math.atan(Math.pow(l/p,1/r))-Kl),-85.051129,bo);return new vi(x,E)}}class Sy extends Ds{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:vo(e),y:Xo(t),z:0}}unproject(e,t){const r=Lr(e),l=An(t);return new vi(r,l)}}const Cy=Te(bo);class Sw extends Ds{project(e,t){const r=(t=Te(t))*t,l=r*r;return{x:.5*((e=Te(e))*(.8707-.131979*r+l*(l*(.003971*r-.001529*l)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+r*(.015085+l*(.028874*r-.044475-.005916*l)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let r=t=(2*(1-t)-1)*Math.PI,l=25,u=0,d=r*r;do{d=r*r;const x=d*d;u=(r*(1.007226+d*(.015085+x*(.028874*d-.044475-.005916*x)))-t)/(1.007226+d*(.045255+x*(.259866*d-.311325-.005916*11*x))),r=Ie(r-u,-Cy,Cy)}while(Math.abs(u)>1e-6&&--l>0);d=r*r;const p=Ie(Be(e/(.8707+d*(d*(d*d*d*(.003971-.001529*d)-.013791)-.131979))),-180,180),y=Be(r);return new vi(p,y)}}const Ay=Te(bo);class Cw extends Ds{project(e,t){t=Te(t),e=Te(e);const r=Math.cos(t),l=2/Math.PI,u=Math.acos(r*Math.cos(e/2)),d=Math.sin(u)/u,p=.5*(e*l+2*r*Math.sin(e/2)/d)||0,y=.5*(t+Math.sin(t)/d)||0;return{x:.5*(p/Math.PI+.5),y:1-.5*(y/Math.PI+1),z:0}}unproject(e,t){let r=e=(2*e-.5)*Math.PI,l=t=(2*(1-t)-1)*Math.PI,u=25;const d=1e-6;let p=0,y=0;do{const x=Math.cos(l),E=Math.sin(l),C=2*E*x,M=E*E,P=x*x,D=Math.cos(r/2),O=Math.sin(r/2),V=2*D*O,K=O*O,oe=1-P*D*D,Q=oe?1/oe:0,ne=oe?Math.acos(x*D)*Math.sqrt(1/oe):0,he=.5*(2*ne*x*O+2*r/Math.PI)-e,se=.5*(ne*E+l)-t,ke=.5*Q*(P*K+ne*x*D*M)+1/Math.PI,Ae=Q*(V*C/4-ne*E*O),Oe=.125*Q*(C*O-ne*E*P*V),ut=.5*Q*(M*D+ne*K*x)+.5,De=Ae*Oe-ut*ke;p=(se*Ae-he*ut)/De,y=(he*Oe-se*ke)/De,r=Ie(r-p,-Math.PI,Math.PI),l=Ie(l-y,-Ay,Ay)}while((Math.abs(p)>d||Math.abs(y)>d)&&--u>0);return new vi(Be(r),Be(l))}}class My extends Ds{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Te(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:r,cosPhi:l}=this;return{x:Te(e)*l*r+.5,y:-Math.sin(Te(t))/l*r+.5,z:0}}unproject(e,t){const{scale:r,cosPhi:l}=this,u=-(t-.5)/r,d=Ie(Be((e-.5)/r)/l,-180,180),p=Math.asin(Ie(u*l,-1,1)),y=Ie(Be(p),-85.051129,bo);return new vi(d,y)}}class Aw extends Sy{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,t,r){const l=Fu(e,t,r);return un(l,l,Ou(Eo(r))),{x:l[0],y:l[1],z:l[2]}}locationPoint(e,t){const r=Ld(t.lat,t.lng),l=Xn([],r),u=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(t),e._centerAltitude):e._centerAltitude;md(r,r,l,Dr(1,0)*$t*u);const d=wo(new Float64Array(16));return Ol(d,e.pixelMatrix,e.globeMatrix),un(r,r,d),new G(r[0],r[1])}pixelsPerMeter(e,t){return Dr(1,0)*t}pixelSpaceConversion(e,t,r){const l=fi(Dr(1,45)*t,Dr(1,e)*t,r);return this.pixelsPerMeter(e,t)/l}createTileMatrix(e,t,r){const l=Gp(Eo(r.canonical));return Ol(new Float64Array(16),e.globeMatrix,l)}createInversionMatrix(e,t){const{center:r}=e,l=Ou(Eo(t));return pd(l,l,Te(r.lng)),pp(l,l,Te(r.lat)),ka(l,l,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(l)}pointCoordinate(e,t,r,l){return gy(e,t,r,!0)||new Bl(0,0)}pointCoordinate3D(e,t,r){const l=this.pointCoordinate(e,t,r,0);return[l.x,l.y,l.z]}isPointAboveHorizon(e,t){return!gy(e,t.x,t.y,!1)}farthestPixelDistance(e){const t=function(l,u){const d=l.cameraToCenterDistance,p=l._centerAltitude*u,y=l._camera,x=l._camera.forward(),E=ks([],Kr([],x,-d),[0,0,p]),C=l.worldSize/(2*Math.PI),M=[0,0,-C],P=l.width/l.height,D=Math.tan(l.fovAboveCenter),O=Kr([],y.up(),D),V=Kr([],y.right(),D*P),K=Xn([],ks([],ks([],x,O),V)),oe=[];let Q;if(new vp(E,K).closestPointOnSphere(M,C,oe)){const ne=ks([],oe,M),he=Yr([],ne,E);Q=Math.cos(l.fovAboveCenter)*bu(he)}else{const ne=Yr([],E,M),he=Yr([],M,E);Xn(he,he);const se=bu(ne)-C;Q=Math.sqrt(se*(se+2*C));const ke=Math.acos(Q/(C+se))-Math.acos(Rr(x,he));Q*=Math.cos(ke)}return 1.01*Q}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),r=Uu(e.zoom);if(r>0){const l=Ey(e,Dr(1,e.center.lat)*e.worldSize),u=e.worldSize/(2*Math.PI),d=Math.max(e.width,e.height)/e.worldSize*Math.PI;return fi(t,l+u*(1-Math.cos(d)),Math.pow(r,10))}return t}upVector(e,t,r){return Fu(t,r,e,1)}upVectorScale(e){return{metersToTile:jp*Rd(Eo(e))}}}function Iy(i){const e=i.parallels,t=!!e&&Math.abs(e[0]+e[1])<.01;switch(i.name){case"mercator":return new Sy(i);case"equirectangular":return new Tw(i);case"naturalEarth":return new Sw(i);case"equalEarth":return new ww(i);case"winkelTripel":return new Cw(i);case"albers":return t?new My(i):new bw(i);case"lambertConformalConic":return t?new My(i):new Ew(i);case"globe":return new Aw(i)}throw new Error(`Invalid projection name: ${i.name}`)}const Mw=La.VectorTileFeature.types,Iw=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Od(i,e,t,r,l,u,d,p,y,x,E,C,M){const P=p?Math.min(Ps,Math.round(p[0])):0,D=p?Math.min(Ps,Math.round(p[1])):0;i.emplaceBack(e,t,Math.round(32*r),Math.round(32*l),u,d,(P<<1)+(y?1:0),D,16*x,16*E,256*C,256*M)}function Ud(i,e,t,r,l,u,d){i.emplaceBack(e,t,r,l,u,d)}function Vd(i,e,t,r,l){i.emplaceBack(e,t,r,l),i.emplaceBack(e,t,r,l),i.emplaceBack(e,t,r,l),i.emplaceBack(e,t,r,l)}function zw(i){for(const e of i.sections)if(a(e.text))return!0;return!1}class Zp{constructor(e){this.layoutVertexArray=new Vi,this.indexArray=new ti,this.programConfigurations=e,this.segments=new sn,this.dynamicLayoutVertexArray=new li,this.opacityVertexArray=new Mi,this.placedSymbolArray=new I_,this.globeExtVertexArray=new Yi}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,t,r,l){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Pb.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Lb.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Iw,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Db.members,!0)),this.opacityVertexBuffer.itemSize=1),(r||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}At(Zp,"SymbolBuffers");class Wp{constructor(e,t,r){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new r,this.segments=new sn,this.collisionVertexArray=new Ni,this.collisionVertexArrayExt=new $i}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Rb.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Bb.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}At(Wp,"CollisionBuffers");class Ls{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(d=>d.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=wo([]),this.placementViewportMatrix=wo([]);const t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=kp(this.zoom,t["text-size"]),this.iconSizeData=kp(this.zoom,t["icon-size"]);const r=this.layers[0].layout,l=r.get("symbol-sort-key"),u=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&l.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=r.get("text-writing-mode").map(d=>Ir[d]),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Zp(new Ma(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Zp(new Ma(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new P_,this.lineVertexArray=new D_,this.symbolInstances=new k_}calculateGlyphDependencies(e,t,r,l,u){for(let d=0;d<e.length;d++)if(t[e.charCodeAt(d)]=!0,l&&u){const p=Pu[e.charAt(d)];p&&(t[p.charCodeAt(0)]=!0)}}populate(e,t,r,l){const u=this.layers[0],d=u.layout,p=this.projection.name==="globe",y=d.get("text-font"),x=d.get("text-field"),E=d.get("icon-image"),C=(x.value.kind!=="constant"||x.value.value instanceof Zn&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),M=E.value.kind!=="constant"||!!E.value.value||Object.keys(E.parameters).length>0,P=d.get("symbol-sort-key");if(this.features=[],!C&&!M)return;const D=t.iconDependencies,O=t.glyphDependencies,V=t.availableImages,K=new $(this.zoom);for(const{feature:oe,id:Q,index:ne,sourceLayerIndex:he}of e){const se=u._featureFilter.needGeometry,ke=Ia(oe,se);if(!u._featureFilter.filter(K,ke,r))continue;if(se||(ke.geometry=Ho(oe,r,l)),p&&oe.type!==1&&r.z<=5){const De=ke.geometry,je=.98078528056;for(let Xe=0;Xe<De.length;Xe++)De[Xe]=D1(De[Xe],$e=>$e,($e,st)=>Rr(Fu($e.x,$e.y,r,1),Fu(st.x,st.y,r,1))<je)}let Ae,Oe;if(C){const De=u.getValueAndResolveTokens("text-field",ke,r,V),je=Zn.factory(De);zw(je)&&(this.hasRTLText=!0),(!this.hasRTLText||U()==="unavailable"||this.hasRTLText&&j.isParsed())&&(Ae=Ub(je,u,ke))}if(M){const De=u.getValueAndResolveTokens("icon-image",ke,r,V);Oe=De instanceof Wn?De:Wn.fromString(De)}if(!Ae&&!Oe)continue;const ut=this.sortFeaturesByKey?P.evaluate(ke,{},r):void 0;if(this.features.push({id:Q,text:Ae,icon:Oe,index:ne,sourceLayerIndex:he,geometry:ke.geometry,properties:oe.properties,type:Mw[oe.type],sortKey:ut}),Oe&&(D[Oe.name]=!0),Ae){const De=y.evaluate(ke,{},r).join(","),je=d.get("text-rotation-alignment")==="map"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ir.vertical)>=0;for(const Xe of Ae.sections)if(Xe.image)D[Xe.image.name]=!0;else{const $e=Dl(Ae.toString()),st=Xe.fontStack||De,He=O[st]=O[st]||{};this.calculateGlyphDependencies(Xe.text,He,je,this.allowVerticalPlacement,$e)}}}d.get("symbol-placement")==="line"&&(this.features=function(oe){const Q={},ne={},he=[];let se=0;function ke(De){he.push(oe[De]),se++}function Ae(De,je,Xe){const $e=ne[De];return delete ne[De],ne[je]=$e,he[$e].geometry[0].pop(),he[$e].geometry[0]=he[$e].geometry[0].concat(Xe[0]),$e}function Oe(De,je,Xe){const $e=Q[je];return delete Q[je],Q[De]=$e,he[$e].geometry[0].shift(),he[$e].geometry[0]=Xe[0].concat(he[$e].geometry[0]),$e}function ut(De,je,Xe){const $e=Xe?je[0][je[0].length-1]:je[0][0];return`${De}:${$e.x}:${$e.y}`}for(let De=0;De<oe.length;De++){const je=oe[De],Xe=je.geometry,$e=je.text?je.text.toString():null;if(!$e){ke(De);continue}const st=ut($e,Xe),He=ut($e,Xe,!0);if(st in ne&&He in Q&&ne[st]!==Q[He]){const bt=Oe(st,He,Xe),Ht=Ae(st,He,he[bt].geometry);delete Q[st],delete ne[He],ne[ut($e,he[Ht].geometry,!0)]=Ht,he[bt].geometry=null}else st in ne?Ae(st,He,Xe):He in Q?Oe(st,He,Xe):(ke(De),Q[st]=se-1,ne[He]=se-1)}return he.filter(De=>De.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((oe,Q)=>oe.sortKey-Q.sortKey)}update(e,t,r,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,r,l),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,r,l))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Iy(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const r=this.lineVertexArray.length,l=e.segment;if(l!==void 0){let u=e.dist(t[l+1]),d=e.dist(t[l]);const p={};for(let y=l+1;y<t.length;y++)p[y]={x:t[y].x,y:t[y].y,tileUnitDistanceFromAnchor:u},y<t.length-1&&(u+=t[y+1].dist(t[y]));for(let y=l||0;y>=0;y--)p[y]={x:t[y].x,y:t[y].y,tileUnitDistanceFromAnchor:d},y>0&&(d+=t[y-1].dist(t[y]));for(let y=0;y<t.length;y++){const x=p[y];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}}addSymbols(e,t,r,l,u,d,p,y,x,E,C,M,P,D){const O=e.indexArray,V=e.layoutVertexArray,K=e.globeExtVertexArray,oe=e.segments.prepareSegment(4*t.length,V,O,this.canOverlap?d.sortKey:void 0),Q=this.glyphOffsetArray.length,ne=oe.vertexLength,he=this.allowVerticalPlacement&&p===Ir.vertical?Math.PI/2:0,se=d.text&&d.text.sections;for(let Ae=0;Ae<t.length;Ae++){const{tl:Oe,tr:ut,bl:De,br:je,tex:Xe,pixelOffsetTL:$e,pixelOffsetBR:st,minFontScaleX:He,minFontScaleY:bt,glyphOffset:Ht,isSDF:Yt,sectionIndex:Dt}=t[Ae],mt=oe.vertexLength,ci=Ht[1];if(Od(V,x.x,x.y,Oe.x,ci+Oe.y,Xe.x,Xe.y,r,Yt,$e.x,$e.y,He,bt),Od(V,x.x,x.y,ut.x,ci+ut.y,Xe.x+Xe.w,Xe.y,r,Yt,st.x,$e.y,He,bt),Od(V,x.x,x.y,De.x,ci+De.y,Xe.x,Xe.y+Xe.h,r,Yt,$e.x,st.y,He,bt),Od(V,x.x,x.y,je.x,ci+je.y,Xe.x+Xe.w,Xe.y+Xe.h,r,Yt,st.x,st.y,He,bt),y){const Gt=y.anchor,St=y.up;Ud(K,Gt.x,Gt.y,Gt.z,St[0],St[1],St[2]),Ud(K,Gt.x,Gt.y,Gt.z,St[0],St[1],St[2]),Ud(K,Gt.x,Gt.y,Gt.z,St[0],St[1],St[2]),Ud(K,Gt.x,Gt.y,Gt.z,St[0],St[1],St[2]),Vd(e.dynamicLayoutVertexArray,Gt.x,Gt.y,Gt.z,he)}else Vd(e.dynamicLayoutVertexArray,x.x,x.y,x.z,he);O.emplaceBack(mt,mt+1,mt+2),O.emplaceBack(mt+1,mt+2,mt+3),oe.vertexLength+=4,oe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ht[0]),Ae!==t.length-1&&Dt===t[Ae+1].sectionIndex||e.programConfigurations.populatePaintArrays(V.length,d,d.index,{},P,D,se&&se[Dt])}const ke=y?y.anchor:x;e.placedSymbolArray.emplaceBack(ke.x,ke.y,ke.z,x.x,x.y,Q,this.glyphOffsetArray.length-Q,ne,E,C,x.segment,r?r[0]:0,r?r[1]:0,l[0],l[1],p,0,!1,0,M,0)}_commitLayoutVertex(e,t,r,l,u,d,p){e.emplaceBack(t,r,l,u,d,Math.round(p.x),Math.round(p.y))}_addCollisionDebugVertices(e,t,r,l,u,d,p){const y=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),x=y.vertexLength,E=p.tileAnchorX,C=p.tileAnchorY;for(let P=0;P<4;P++)r.collisionVertexArray.emplaceBack(0,0,0,0);r.collisionVertexArrayExt.emplaceBack(t,-e.padding,-e.padding),r.collisionVertexArrayExt.emplaceBack(t,e.padding,-e.padding),r.collisionVertexArrayExt.emplaceBack(t,e.padding,e.padding),r.collisionVertexArrayExt.emplaceBack(t,-e.padding,e.padding),this._commitLayoutVertex(r.layoutVertexArray,l,u,d,E,C,new G(e.x1,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,l,u,d,E,C,new G(e.x2,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,l,u,d,E,C,new G(e.x2,e.y2)),this._commitLayoutVertex(r.layoutVertexArray,l,u,d,E,C,new G(e.x1,e.y2)),y.vertexLength+=4;const M=r.indexArray;M.emplaceBack(x,x+1),M.emplaceBack(x+1,x+2),M.emplaceBack(x+2,x+3),M.emplaceBack(x+3,x),y.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,r,l,u,d){for(let p=l;p<u;p++){const y=r.get(p),x=this.getSymbolInstanceTextSize(e,d,t,p);this._addCollisionDebugVertices(y,x,this.textCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,d)}}_addIconDebugCollisionBoxes(e,t,r,l,u,d){for(let p=l;p<u;p++){const y=r.get(p),x=this.getSymbolInstanceIconSize(e,t,p);this._addCollisionDebugVertices(y,x,this.iconCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,d)}}generateCollisionDebugBuffers(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Wp(Mr,jg.members,Rn),this.iconCollisionBox=new Wp(Mr,jg.members,Rn);const r=jl(this.iconSizeData,e),l=jl(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){const d=this.symbolInstances.get(u);this._addTextDebugCollisionBoxes(l,e,t,d.textBoxStartIndex,d.textBoxEndIndex,d),this._addTextDebugCollisionBoxes(l,e,t,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d),this._addIconDebugCollisionBoxes(r,e,t,d.iconBoxStartIndex,d.iconBoxEndIndex,d),this._addIconDebugCollisionBoxes(r,e,t,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex,d)}}getSymbolInstanceTextSize(e,t,r,l){const u=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:l),d=Cd(this.textSizeData,e,u)/Mn;return this.tilePixelRatio*d}getSymbolInstanceIconSize(e,t,r){const l=this.icon.placedSymbolArray.get(r),u=Cd(this.iconSizeData,e,l);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(e,t,r){e.emplaceBack(t,-r,-r),e.emplaceBack(t,r,-r),e.emplaceBack(t,r,r),e.emplaceBack(t,-r,r)}_updateTextDebugCollisionBoxes(e,t,r,l,u,d){for(let p=l;p<u;p++){const y=r.get(p),x=this.getSymbolInstanceTextSize(e,d,t,p);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,x,y.padding)}}_updateIconDebugCollisionBoxes(e,t,r,l,u){for(let d=l;d<u;d++){const p=r.get(d),y=this.getSymbolInstanceIconSize(e,t,d);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,y,p.padding)}}updateCollisionDebugBuffers(e,t){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const r=jl(this.iconSizeData,e),l=jl(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){const d=this.symbolInstances.get(u);this._updateTextDebugCollisionBoxes(l,e,t,d.textBoxStartIndex,d.textBoxEndIndex,d),this._updateTextDebugCollisionBoxes(l,e,t,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d),this._updateIconDebugCollisionBoxes(r,e,t,d.iconBoxStartIndex,d.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(r,e,t,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,r,l,u,d,p,y,x){const E={};for(let C=t;C<r;C++){const M=e.get(C);E.textBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,padding:M.padding,projectedAnchorX:M.projectedAnchorX,projectedAnchorY:M.projectedAnchorY,projectedAnchorZ:M.projectedAnchorZ,tileAnchorX:M.tileAnchorX,tileAnchorY:M.tileAnchorY},E.textFeatureIndex=M.featureIndex;break}for(let C=l;C<u;C++){const M=e.get(C);E.verticalTextBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,padding:M.padding,projectedAnchorX:M.projectedAnchorX,projectedAnchorY:M.projectedAnchorY,projectedAnchorZ:M.projectedAnchorZ,tileAnchorX:M.tileAnchorX,tileAnchorY:M.tileAnchorY},E.verticalTextFeatureIndex=M.featureIndex;break}for(let C=d;C<p;C++){const M=e.get(C);E.iconBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,padding:M.padding,projectedAnchorX:M.projectedAnchorX,projectedAnchorY:M.projectedAnchorY,projectedAnchorZ:M.projectedAnchorZ,tileAnchorX:M.tileAnchorX,tileAnchorY:M.tileAnchorY},E.iconFeatureIndex=M.featureIndex;break}for(let C=y;C<x;C++){const M=e.get(C);E.verticalIconBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,padding:M.padding,projectedAnchorX:M.projectedAnchorX,projectedAnchorY:M.projectedAnchorY,projectedAnchorZ:M.projectedAnchorZ,tileAnchorX:M.tileAnchorX,tileAnchorY:M.tileAnchorY},E.verticalIconFeatureIndex=M.featureIndex;break}return E}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,t){const r=e.placedSymbolArray.get(t),l=r.vertexStartIndex+4*r.numGlyphs;for(let u=r.vertexStartIndex;u<l;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const t=Math.sin(e),r=Math.cos(e),l=[],u=[],d=[];for(let p=0;p<this.symbolInstances.length;++p){d.push(p);const y=this.symbolInstances.get(p);l.push(0|Math.round(t*y.tileAnchorX+r*y.tileAnchorY)),u.push(y.featureIndex)}return d.sort((p,y)=>l[p]-l[y]||u[y]-u[p]),d}addToSortKeyRanges(e,t){const r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===t?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const r=this.symbolInstances.get(t);this.featureSortOrder.push(r.featureIndex),[r.rightJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.leftJustifiedTextSymbolIndex].forEach((l,u,d)=>{l>=0&&d.indexOf(l)===u&&this.addIndicesForPlacedSymbol(this.text,l)}),r.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,r.verticalPlacedTextSymbolIndex),r.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,r.placedIconSymbolIndex),r.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,r.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}At(Ls,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Ls.MAX_GLYPHS=65535,Ls.addDynamicAttributes=Vd;const kw=new Ve({"symbol-placement":new ae(Re.layout_symbol["symbol-placement"]),"symbol-spacing":new ae(Re.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ae(Re.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new me(Re.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ae(Re.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ae(Re.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ae(Re.layout_symbol["icon-ignore-placement"]),"icon-optional":new ae(Re.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ae(Re.layout_symbol["icon-rotation-alignment"]),"icon-size":new me(Re.layout_symbol["icon-size"]),"icon-text-fit":new ae(Re.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ae(Re.layout_symbol["icon-text-fit-padding"]),"icon-image":new me(Re.layout_symbol["icon-image"]),"icon-rotate":new me(Re.layout_symbol["icon-rotate"]),"icon-padding":new ae(Re.layout_symbol["icon-padding"]),"icon-keep-upright":new ae(Re.layout_symbol["icon-keep-upright"]),"icon-offset":new me(Re.layout_symbol["icon-offset"]),"icon-anchor":new me(Re.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ae(Re.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ae(Re.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ae(Re.layout_symbol["text-rotation-alignment"]),"text-field":new me(Re.layout_symbol["text-field"]),"text-font":new me(Re.layout_symbol["text-font"]),"text-size":new me(Re.layout_symbol["text-size"]),"text-max-width":new me(Re.layout_symbol["text-max-width"]),"text-line-height":new me(Re.layout_symbol["text-line-height"]),"text-letter-spacing":new me(Re.layout_symbol["text-letter-spacing"]),"text-justify":new me(Re.layout_symbol["text-justify"]),"text-radial-offset":new me(Re.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ae(Re.layout_symbol["text-variable-anchor"]),"text-anchor":new me(Re.layout_symbol["text-anchor"]),"text-max-angle":new ae(Re.layout_symbol["text-max-angle"]),"text-writing-mode":new ae(Re.layout_symbol["text-writing-mode"]),"text-rotate":new me(Re.layout_symbol["text-rotate"]),"text-padding":new ae(Re.layout_symbol["text-padding"]),"text-keep-upright":new ae(Re.layout_symbol["text-keep-upright"]),"text-transform":new me(Re.layout_symbol["text-transform"]),"text-offset":new me(Re.layout_symbol["text-offset"]),"text-allow-overlap":new ae(Re.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ae(Re.layout_symbol["text-ignore-placement"]),"text-optional":new ae(Re.layout_symbol["text-optional"])});var Xp={paint:new Ve({"icon-opacity":new me(Re.paint_symbol["icon-opacity"]),"icon-color":new me(Re.paint_symbol["icon-color"]),"icon-halo-color":new me(Re.paint_symbol["icon-halo-color"]),"icon-halo-width":new me(Re.paint_symbol["icon-halo-width"]),"icon-halo-blur":new me(Re.paint_symbol["icon-halo-blur"]),"icon-translate":new ae(Re.paint_symbol["icon-translate"]),"icon-translate-anchor":new ae(Re.paint_symbol["icon-translate-anchor"]),"text-opacity":new me(Re.paint_symbol["text-opacity"]),"text-color":new me(Re.paint_symbol["text-color"],{runtimeType:Er,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new me(Re.paint_symbol["text-halo-color"]),"text-halo-width":new me(Re.paint_symbol["text-halo-width"]),"text-halo-blur":new me(Re.paint_symbol["text-halo-blur"]),"text-translate":new ae(Re.paint_symbol["text-translate"]),"text-translate-anchor":new ae(Re.paint_symbol["text-translate-anchor"])}),layout:kw};class zy{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:hs,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}At(zy,"FormatSectionOverride",{omit:["defaultValue"]});class Nd extends Hr{constructor(e){super(e,Xp)}recalculate(e,t){super.recalculate(e,t),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const r=this.layout.get("text-writing-mode");if(r){const l=[];for(const u of r)l.indexOf(u)<0&&l.push(u);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,t,r,l){const u=this.layout.get(e).evaluate(t,{},r,l),d=this._unevaluatedLayout._values[e];return d.isDataDriven()||Tl(d.value)||!u?u:function(p,y){return y.replace(/{([^{}]+)}/g,(x,E)=>E in p?String(p[E]):"")}(t.properties,u)}createBucket(e){return new Ls(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Xp.paint.overridableProperties){if(!Nd.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),r=new zy(t),l=new Qc(r,t.property.specification);let u=null;u=t.value.kind==="constant"||t.value.kind==="source"?new eu("source",l):new ma("composite",l,t.value.zoomStops,t.value._interpolationType),this.paint._values[e]=new re(t.property,u,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,r){return!(!this.layout||t.isDataDriven()||r.isDataDriven())&&Nd.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const r=e.get("text-field"),l=Xp.paint.properties[t];let u=!1;const d=p=>{for(const y of p)if(l.overrides&&l.overrides.hasOverride(y))return void(u=!0)};if(r.value.kind==="constant"&&r.value.value instanceof Zn)d(r.value.value.sections);else if(r.value.kind==="source"){const p=x=>{u||(x instanceof na&&Qi(x.value)===Qs?d(x.value.sections):x instanceof oa?d(x.sections):x.eachChild(p))},y=r.value;y._styleExpression&&p(y._styleExpression.expression)}return u}getProgramConfiguration(e){return new Is(this,e)}}var Pw={paint:new Ve({"background-color":new ae(Re.paint_background["background-color"]),"background-pattern":new rt(Re.paint_background["background-pattern"]),"background-opacity":new ae(Re.paint_background["background-opacity"])})},Dw={paint:new Ve({"raster-opacity":new ae(Re.paint_raster["raster-opacity"]),"raster-hue-rotate":new ae(Re.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ae(Re.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ae(Re.paint_raster["raster-brightness-max"]),"raster-saturation":new ae(Re.paint_raster["raster-saturation"]),"raster-contrast":new ae(Re.paint_raster["raster-contrast"]),"raster-resampling":new ae(Re.paint_raster["raster-resampling"]),"raster-fade-duration":new ae(Re.paint_raster["raster-fade-duration"])})};class Lw extends Hr{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var Rw={paint:new Ve({"sky-type":new ae(Re.paint_sky["sky-type"]),"sky-atmosphere-sun":new ae(Re.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ae(Re.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ae(Re.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ae(Re.paint_sky["sky-gradient-radius"]),"sky-gradient":new xe(Re.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ae(Re.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ae(Re.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ae(Re.paint_sky["sky-opacity"])})};function Hp(i,e,t){const r=[0,0,1],l=hg([]);return fg(l,l,t?-Te(i)+Math.PI:Te(i)),dg(l,l,-Te(e)),lg(r,r,l),Xn(r,r)}const Bw={circle:class extends Hr{constructor(i){super(i,V1)}createBucket(i){return new up(i)}queryRadius(i){const e=i;return Fl("circle-radius",this,e)+Fl("circle-stroke-width",this,e)+dd(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,t,r,l,u,d,p){const y=ig(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),x=this.paint.get("circle-radius").evaluate(e,t)+this.paint.get("circle-stroke-width").evaluate(e,t);return pg(i,r,u,d,p,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",y,x)}getProgramIds(){return["circle"]}getProgramConfiguration(i){return new Is(this,i)}},heatmap:class extends Hr{createBucket(i){return new _g(i)}constructor(i){super(i,W1),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ep({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return Fl("heatmap-radius",this,i)}queryIntersectsFeature(i,e,t,r,l,u,d,p){const y=this.paint.get("heatmap-radius").evaluate(e,t);return pg(i,r,u,d,p,!0,!0,new G(0,0),y)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(i){return new Is(this,i)}},hillshade:class extends Hr{constructor(i){super(i,X1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Hr{constructor(i){super(i,hb)}getProgramIds(){const i=this.paint.get("fill-pattern"),e=i&&i.constantOr(1),t=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&t.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),t}getProgramConfiguration(i){return new Is(this,i)}recalculate(i,e){super.recalculate(i,e);const t=this.paint._values["fill-outline-color"];t.value.kind==="constant"&&t.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new bd(i)}queryRadius(){return dd(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,t,r,l,u){return!i.queryGeometry.isAboveHorizon&&Y_(tg(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),r)}isTileClipped(){return!0}},"fill-extrusion":class extends Hr{constructor(i){super(i,Eb)}createBucket(i){return new Iu(i)}queryRadius(){return dd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(i){return new Is(this,i)}queryIntersectsFeature(i,e,t,r,l,u,d,p,y){const x=ig(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),E=this.paint.get("fill-extrusion-height").evaluate(e,t),C=this.paint.get("fill-extrusion-base").evaluate(e,t),M=[0,0],P=p&&u.elevation,D=u.elevation?u.elevation.exaggeration():1,O=i.tile.getBucket(this);if(P&&O instanceof Iu){const oe=O.centroidVertexArray,Q=y+1;if(Q<oe.length){const ne=oe.get(Q);M[0]=ne.a_centroid_pos0,M[1]=ne.a_centroid_pos1}}if(M[0]===0&&M[1]===1)return!1;u.projection.name==="globe"&&(r=Lg([r],[new G(0,0),new G($t,$t)],i.tileID.canonical).map(oe=>oe.polygon).flat());const V=function(oe,Q,ne,he,se,ke,Ae,Oe,ut,De,je){return oe.projection.name==="globe"?function(Xe,$e,st,He,bt,Ht,Yt,Dt,mt,ci,Gt){const St=[],Fi=[],ki=Xe.projection.upVectorScale(Gt,Xe.center.lat,Xe.worldSize).metersToTile,qi=[0,0,0,1],Qt=[0,0,0,1],mi=(Pi,Ii,ji,Wi)=>{Pi[0]=Ii,Pi[1]=ji,Pi[2]=Wi,Pi[3]=1},Oi=Dg();st>0&&(st+=Oi),He+=Oi;for(const Pi of $e){const Ii=[],ji=[];for(const Wi of Pi){const gn=Wi.x+bt.x,lr=Wi.y+bt.y,ui=Xe.projection.projectTilePoint(gn,lr,Gt),Ji=Xe.projection.upVector(Gt,Wi.x,Wi.y);let Fn=st,xi=He;if(Yt){const Xi=Og(gn,lr,st,He,Yt,Dt,mt,ci);Fn+=Xi.base,xi+=Xi.top}st!==0?mi(qi,ui.x+Ji[0]*ki*Fn,ui.y+Ji[1]*ki*Fn,ui.z+Ji[2]*ki*Fn):mi(qi,ui.x,ui.y,ui.z),mi(Qt,ui.x+Ji[0]*ki*xi,ui.y+Ji[1]*ki*xi,ui.z+Ji[2]*ki*xi),un(qi,qi,Ht),un(Qt,Qt,Ht),Ii.push(Ed(qi)),ji.push(Ed(Qt))}St.push(Ii),Fi.push(ji)}return[St,Fi]}(oe,Q,ne,he,se,ke,Ae,Oe,ut,De,je):Ae?function(Xe,$e,st,He,bt,Ht,Yt,Dt,mt){const ci=[],Gt=[],St=[0,0,0,1];for(const Fi of Xe){const ki=[],qi=[];for(const Qt of Fi){const mi=Qt.x+He.x,Oi=Qt.y+He.y,Pi=Og(mi,Oi,$e,st,Ht,Yt,Dt,mt);St[0]=mi,St[1]=Oi,St[2]=Pi.base,St[3]=1,Pa(St,St,bt),St[3]=Math.max(St[3],1e-5);const Ii=Ed([St[0]/St[3],St[1]/St[3],St[2]/St[3]]);St[0]=mi,St[1]=Oi,St[2]=Pi.top,St[3]=1,Pa(St,St,bt),St[3]=Math.max(St[3],1e-5);const ji=Ed([St[0]/St[3],St[1]/St[3],St[2]/St[3]]);ki.push(Ii),qi.push(ji)}ci.push(ki),Gt.push(qi)}return[ci,Gt]}(Q,ne,he,se,ke,Ae,Oe,ut,De):function(Xe,$e,st,He,bt){const Ht=[],Yt=[],Dt=bt[8]*$e,mt=bt[9]*$e,ci=bt[10]*$e,Gt=bt[11]*$e,St=bt[8]*st,Fi=bt[9]*st,ki=bt[10]*st,qi=bt[11]*st;for(const Qt of Xe){const mi=[],Oi=[];for(const Pi of Qt){const Ii=Pi.x+He.x,ji=Pi.y+He.y,Wi=bt[0]*Ii+bt[4]*ji+bt[12],gn=bt[1]*Ii+bt[5]*ji+bt[13],lr=bt[2]*Ii+bt[6]*ji+bt[14],ui=bt[3]*Ii+bt[7]*ji+bt[15],Ji=Wi+Dt,Fn=gn+mt,xi=lr+ci,Xi=Math.max(ui+Gt,1e-5),Kn=Wi+St,Gi=gn+Fi,en=lr+ki,yn=Math.max(ui+qi,1e-5),pn=new G(Ji/Xi,Fn/Xi);pn.z=xi/Xi,mi.push(pn);const In=new G(Kn/yn,Gi/yn);In.z=en/yn,Oi.push(In)}Ht.push(mi),Yt.push(Oi)}return[Ht,Yt]}(Q,ne,he,se,ke)}(u,r,C,E,x,d,P?p:null,M,D,u.center.lat,i.tileID.canonical),K=i.queryGeometry;return function(oe,Q,ne){let he=1/0;Y_(ne,Q)&&(he=Fg(ne,Q[0]));for(let se=0;se<Q.length;se++){const ke=Q[se],Ae=oe[se];for(let Oe=0;Oe<ke.length-1;Oe++){const ut=ke[Oe],De=[ut,ke[Oe+1],Ae[Oe+1],Ae[Oe],ut];K_(ne,De)&&(he=Math.min(he,Fg(ne,De)))}}return he!==1/0&&he}(V[0],V[1],K.isPointQuery()?K.screenBounds:K.screenGeometry)}},line:class extends Hr{constructor(i){super(i,Ug),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Dc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=Vg.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Sd(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(i){return new Is(this,i)}queryRadius(i){const e=i,t=Ng(Fl("line-width",this,e),Fl("line-gap-width",this,e)),r=Fl("line-offset",this,e);return t/2+Math.abs(r)+dd(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,t,r,l,u){if(i.queryGeometry.isAboveHorizon)return!1;const d=tg(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),p=i.pixelToTileUnitsFactor/2*Ng(this.paint.get("line-width").evaluate(e,t),this.paint.get("line-gap-width").evaluate(e,t)),y=this.paint.get("line-offset").evaluate(e,t);return y&&(r=function(x,E){const C=[],M=new G(0,0);for(let P=0;P<x.length;P++){const D=x[P],O=[];for(let V=0;V<D.length;V++){const K=D[V-1],oe=D[V],Q=D[V+1],ne=V===0?M:oe.sub(K)._unit()._perp(),he=V===D.length-1?M:Q.sub(oe)._unit()._perp(),se=ne._add(he)._unit();se._mult(1/(se.x*he.x+se.y*he.y)),O.push(se._mult(E)._add(oe))}C.push(O)}return C}(r,y*i.pixelToTileUnitsFactor)),function(x,E,C){for(let M=0;M<E.length;M++){const P=E[M];if(x.length>=3){for(let D=0;D<P.length;D++)if(za(x,P[D]))return!0}if(B1(x,P,C))return!0}return!1}(d,r,p)}isTileClipped(){return!0}},symbol:Nd,background:class extends Hr{constructor(i){super(i,Pw)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Hr{constructor(i){super(i,Dw)}getProgramIds(){return["raster"]}},sky:class extends Hr{constructor(i){super(i,Rw),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Ep({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(i,e){if(this.paint.get("sky-type")==="atmosphere"){const r=this.paint.get("sky-atmosphere-sun"),l=!r,u=i.style.light,d=u.properties.get("position");return l&&u.properties.get("anchor")==="viewport"&&Jt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),l?Hp(d.azimuthal,90-d.polar,e):Hp(r[0],90-r[1],e)}const t=this.paint.get("sky-gradient-center");return Hp(t[0],90-t[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}}};class qu{constructor(e,t,r,l){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(t,l)}update(e,t,r){const{width:l,height:u}=e,{context:d}=this,{gl:p}=d,{HTMLImageElement:y,HTMLCanvasElement:x,HTMLVideoElement:E,ImageData:C,ImageBitmap:M}=B;if(p.bindTexture(p.TEXTURE_2D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(this.format===p.RGBA&&(!t||t.premultiply!==!1)),r||this.size&&this.size[0]===l&&this.size[1]===u){const{x:P,y:D}=r||{x:0,y:0};e instanceof y||e instanceof x||e instanceof E||e instanceof C||M&&e instanceof M?p.texSubImage2D(p.TEXTURE_2D,0,P,D,p.RGBA,p.UNSIGNED_BYTE,e):p.texSubImage2D(p.TEXTURE_2D,0,P,D,l,u,p.RGBA,p.UNSIGNED_BYTE,e.data)}else this.size=[l,u],e instanceof y||e instanceof x||e instanceof E||e instanceof C||M&&e instanceof M?p.texImage2D(p.TEXTURE_2D,0,this.format,this.format,p.UNSIGNED_BYTE,e):p.texImage2D(p.TEXTURE_2D,0,this.format,l,u,0,this.format,p.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(t&&t.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&p.generateMipmap(p.TEXTURE_2D)}bind(e,t){const{context:r}=this,{gl:l}=r;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.filter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,this.useMipmap?e===l.NEAREST?l.NEAREST_MIPMAP_NEAREST:l.LINEAR_MIPMAP_NEAREST:e),this.filter=e),t!==this.wrap&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,t),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,t),this.wrap=t)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Kp{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new Ko({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const r=this.getKey(e,t);return this.positions[r]}trim(){const e=this.width,t=this.height=Ke(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,r){const l=[];let u=e.length%2==1?-e[e.length-1]*r:0,d=e[0]*r,p=!0;l.push({left:u,right:d,isDash:p,zeroLength:e[0]===0});let y=e[0];for(let x=1;x<e.length;x++){p=!p;const E=e[x];u=y*r,y+=E,d=y*r,l.push({left:u,right:d,isDash:p,zeroLength:E===0})}return l}addRoundDash(e,t,r){const l=t/2;for(let u=-r;u<=r;u++){const d=this.width*(this.nextRow+r+u);let p=0,y=e[p];for(let x=0;x<this.width;x++){x/y.right>1&&(y=e[++p]);const E=Math.abs(x-y.left),C=Math.abs(x-y.right),M=Math.min(E,C);let P;const D=u/r*(l+1);if(y.isDash){const O=l-Math.abs(D);P=Math.sqrt(M*M+O*O)}else P=l-Math.sqrt(M*M+D*D);this.image.data[d+x]=Math.max(0,Math.min(255,P+128))}}}addRegularDash(e,t){for(let y=e.length-1;y>=0;--y){const x=e[y],E=e[y+1];x.zeroLength?e.splice(y,1):E&&E.isDash===x.isDash&&(E.left=x.left,e.splice(y,1))}const r=e[0],l=e[e.length-1];r.isDash===l.isDash&&(r.left=l.left-this.width,l.right=r.right+this.width);const u=this.width*this.nextRow;let d=0,p=e[d];for(let y=0;y<this.width;y++){y/p.right>1&&(p=e[++d]);const x=Math.abs(y-p.left),E=Math.abs(y-p.right),C=Math.min(x,E);this.image.data[u+y]=Math.max(0,Math.min(255,(p.isDash?C:-C)+t+128))}}addDash(e,t){const r=this.getKey(e,t);if(this.positions[r])return this.positions[r];const l=t==="round",u=l?7:0,d=2*u+1;if(this.nextRow+d>this.height)return Jt("LineAtlas out of space"),null;e.length===0&&e.push(1);let p=0;for(let E=0;E<e.length;E++)e[E]<0&&(Jt("Negative value is found in line dasharray, replacing values with 0"),e[E]=0),p+=e[E];if(p!==0){const E=this.width/p,C=this.getDashRanges(e,this.width,E);l?this.addRoundDash(C,E,u):this.addRegularDash(C,t==="square"?.5*E:0)}const y=this.nextRow+u;this.nextRow+=d;const x={tl:[y,u],br:[p,0]};return this.positions[r]=x,x}}At(Kp,"LineAtlas");class Fw{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Ow{constructor(){this.tasks={},this.taskQueue=[],Wt(["process"],this),this.invoker=new Fw(this.process),this.nextId=0}add(e,t){const r=this.nextId++,l=function({type:u,isSymbolTile:d,zoom:p}){return p=p||0,u==="message"?0:u!=="maybePrepare"||d?u!=="parseTile"||d?u==="parseTile"&&d?300-p:u==="maybePrepare"&&d?400-p:500:200-p:100-p}(t);if(l===0){Pn();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[r]={fn:e,metadata:t,priority:l,id:r},this.taskQueue.push(r),this.invoker.trigger(),{cancel:()=>{delete this.tasks[r]}}}process(){Pn();try{if(this.taskQueue=this.taskQueue.filter(r=>!!this.tasks[r]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let l=0;l<this.taskQueue.length;l++){const u=this.tasks[this.taskQueue[l]];u.priority<t&&(t=u.priority,e=l)}if(e===null)return null;const r=this.taskQueue[e];return this.taskQueue.splice(e,1),r}remove(){this.invoker.remove()}}class ky{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const r=e[t];this._stringToNumber[r]=t,this._numberToString[t]=r}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const Uw=["tile","layer","source","sourceLayer","state"];class Py{constructor(e,t,r,l,u){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=r,this._y=l,this.properties=e.properties,this.id=u}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const t of Uw)this[t]!==void 0&&(e[t]=this[t]);return e}}const Br=32,So=33,Rs=new Uint16Array(8184);for(let i=0;i<2046;i++){let e=i+2,t=0,r=0,l=0,u=0,d=0,p=0;for(1&e?l=u=d=Br:t=r=p=Br;(e>>=1)>1;){const x=t+l>>1,E=r+u>>1;1&e?(l=t,u=r,t=d,r=p):(t=l,r=u,l=d,u=p),d=x,p=E}const y=4*i;Rs[y+0]=t,Rs[y+1]=r,Rs[y+2]=l,Rs[y+3]=u}const Co=new Uint16Array(2178),Bs=new Uint8Array(1089),jd=new Uint16Array(1089);function Dy(i){return i===0?-.03125:i===32?.03125:0}var Ly=qe([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Ry={type:2,extent:$t,loadGeometry:()=>[[new G(0,0),new G(8193,0),new G(8193,8193),new G(0,8193),new G(0,0)]]};class Yp{constructor(e,t,r,l,u){this.tileID=e,this.uid=ft(),this.uses=0,this.tileSize=t,this.tileZoom=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=u,this.expiredRequestCount=0,this.state="loading",l&&l.transform&&(this.projection=l.transform.projection)}registerFadeDuration(e){const t=e+this.timeAdded;t<Ct.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Ra(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,t,r){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(l,u){const d={};if(!u)return d;for(const p of l){const y=p.layerIds.map(x=>u.getLayer(x)).filter(Boolean);if(y.length!==0){p.layers=y,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map(x=>y.filter(E=>E.id===x)[0]));for(const x of y)d[x.id]=p}}return d}(e.buckets,t.style),this.hasSymbolBuckets=!1;for(const l in this.buckets){const u=this.buckets[l];if(u instanceof Ls){if(this.hasSymbolBuckets=!0,!r)break;u.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const l in this.buckets){const u=this.buckets[l];if(u instanceof Ls&&u.hasRTLText){this.hasRTLText=!0,j.isLoading()||j.isLoaded()||U()!=="deferred"||W();break}}this.queryPadding=0;for(const l in this.buckets){const u=this.buckets[l];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(l).queryRadius(u))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new xo}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const r in this.buckets){const l=this.buckets[r];l.uploadPending()&&l.upload(e)}const t=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new qu(e,this.imageAtlas.image,t.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new qu(e,this.glyphAtlasImage,t.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new qu(e,this.lineAtlas.image,t.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,t,r,l,u,d,p,y){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:l,pixelPosMatrix:p,transform:d,params:u,tileTransform:this.tileTransform},e,t,r):{}}querySourceFeatures(e,t){const r=this.latestFeatureIndex;if(!r||!r.rawTileData)return;const l=r.loadVTLayers(),u=t?t.sourceLayer:"",d=l._geojsonTileLayer||l[u];if(!d)return;const p=xa(t&&t.filter),{z:y,x,y:E}=this.tileID.canonical,C={z:y,x,y:E};for(let M=0;M<d.length;M++){const P=d.feature(M);if(p.needGeometry){const V=Ia(P,!0);if(!p.filter(new $(this.tileID.overscaledZ),V,this.tileID.canonical))continue}else if(!p.filter(new $(this.tileID.overscaledZ),P))continue;const D=r.getId(P,u),O=new Py(P,y,x,E,D);O.tile=C,e.push(O)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const t=this.expirationTime;if(e.cacheControl){const r=an(e.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const r=Date.now();let l=!1;if(this.expirationTime>r)l=!1;else if(t)if(this.expirationTime<t)l=!0;else{const u=this.expirationTime-t;u?this.expirationTime=r+Math.max(u,3e4):l=!0}else l=!0;l?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!t)return;const r=this.latestFeatureIndex.loadVTLayers(),l=t.style.listImages();for(const u in this.buckets){if(!t.style.hasLayer(u))continue;const d=this.buckets[u],p=d.layers[0].sourceLayer||"_geojsonTileLayer",y=r[p],x=e[p];if(!y||!x||Object.keys(x).length===0)continue;if(d.update(x,y,l,this.imageAtlas&&this.imageAtlas.patternPositions||{}),d instanceof Sd||d instanceof bd){const C=t.style._getSourceCache(d.layers[0].source);t._terrain&&t._terrain.enabled&&C&&d.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(C.id,this.tileID)}const E=t&&t.style&&t.style.getLayer(u);E&&(this.queryPadding=Math.max(this.queryPadding,E.queryRadius(d)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ct.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Ct.now()+e}setTexture(e,t){const r=t.context,l=r.gl;this.texture=t.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new qu(r,e,l.RGBA,{useMipmap:!0}),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),r.extTextureFilterAnisotropic&&l.texParameterf(l.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax))}setDependencies(e,t){const r={};for(const l of t)r[l]=!0;this.dependencies[e]=r}hasDependency(e,t){for(const r of e){const l=this.dependencies[r];if(l){for(const u of t)if(l[u])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,t){if(!t||t.name==="mercator"||this._tileDebugBuffer)return;const r=Ho(Ry,this.tileID.canonical,this.tileTransform)[0],l=new _t,u=new jo;for(let d=0;d<r.length;d++){const{x:p,y}=r[d];l.emplaceBack(p,y),u.emplaceBack(d)}u.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(u),this._tileDebugBuffer=e.createVertexBuffer(l,Bu.members),this._tileDebugSegments=sn.simpleSegment(0,0,l.length,u.length)}_makeTileBoundsBuffers(e,t){if(this._tileBoundsBuffer||!t||t.name==="mercator")return;const r=Ho(Ry,this.tileID.canonical,this.tileTransform)[0];let l,u;if(this.isRaster){const d=function(p,y){const x=Ra(p,y),E=Math.pow(2,p.z);for(let V=0;V<So;V++)for(let K=0;K<So;K++){const oe=Lr((p.x+(K+Dy(K))/Br)/E),Q=An((p.y+(V+Dy(V))/Br)/E),ne=y.project(oe,Q),he=V*So+K;Co[2*he+0]=Math.round((ne.x*x.scale-x.x)*$t),Co[2*he+1]=Math.round((ne.y*x.scale-x.y)*$t)}Bs.fill(0),jd.fill(0);for(let V=2045;V>=0;V--){const K=4*V,oe=Rs[K+0],Q=Rs[K+1],ne=Rs[K+2],he=Rs[K+3],se=oe+ne>>1,ke=Q+he>>1,Ae=se+ke-Q,Oe=ke+oe-se,ut=Q*So+oe,De=he*So+ne,je=ke*So+se,Xe=Math.hypot((Co[2*ut+0]+Co[2*De+0])/2-Co[2*je+0],(Co[2*ut+1]+Co[2*De+1])/2-Co[2*je+1])>=16;if(Bs[je]=Bs[je]||(Xe?1:0),V<1022){const $e=(Q+Oe>>1)*So+(oe+Ae>>1),st=(he+Oe>>1)*So+(ne+Ae>>1);Bs[je]=Bs[je]||Bs[$e]||Bs[st]}}const C=new Lt,M=new ti;let P=0;function D(V,K){const oe=K*So+V;return jd[oe]===0&&(C.emplaceBack(Co[2*oe+0],Co[2*oe+1],V*$t/Br,K*$t/Br),jd[oe]=++P),jd[oe]-1}function O(V,K,oe,Q,ne,he){const se=V+oe>>1,ke=K+Q>>1;if(Math.abs(V-ne)+Math.abs(K-he)>1&&Bs[ke*So+se])O(ne,he,V,K,se,ke),O(oe,Q,ne,he,se,ke);else{const Ae=D(V,K),Oe=D(oe,Q),ut=D(ne,he);M.emplaceBack(Ae,Oe,ut)}}return O(0,0,Br,Br,Br,0),O(Br,Br,0,0,0,Br),{vertices:C,indices:M}}(this.tileID.canonical,t);l=d.vertices,u=d.indices}else{l=new Lt,u=new ti;for(const{x:p,y}of r)l.emplaceBack(p,y,0,0);const d=_d(l.int16,void 0,4);for(let p=0;p<d.length;p+=3)u.emplaceBack(d[p],d[p+1],d[p+2])}this._tileBoundsBuffer=e.createVertexBuffer(l,Ly.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(u),this._tileBoundsSegments=sn.simpleSegment(0,0,l.length,u.length)}_makeGlobeTileDebugBuffers(e,t){const r=t.projection;if(!r||r.name!=="globe"||t.freezeTileCoverage)return;const l=this.tileID.canonical,u=Ou(yy(l,t)),d=Uu(t.zoom);let p;d>0&&(p=fp(new Float64Array(16),t.globeMatrix));const y=(l.x+.5)/(1<<l.z)-vo(t.center.lng);let x=0;y>.5?x=-1:y<-.5&&(x=1),this._makeGlobeTileDebugBorderBuffer(e,l,t,u,p,d,x),this._makeGlobeTileDebugTextBuffer(e,l,t,u,p,d,x)}_globePoint(e,t,r,l,u,d,p,y){let x=Fu(e,t,r);if(d){const E=1<<r.z,C=[((e/$t+r.x)/E+y)*l,(t/$t+r.y)/E*l,0];un(C,C,d),x=ms(x,C,p)}return un(x,x,u)}_makeGlobeTileDebugBorderBuffer(e,t,r,l,u,d,p){const y=new _t,x=new jo,E=new It,C=(P,D,O,V,K)=>{const oe=(O-P)/(K-1),Q=(V-D)/(K-1),ne=y.length;for(let he=0;he<K;he++){const se=P+he*oe,ke=D+he*Q;y.emplaceBack(se,ke);const Ae=this._globePoint(se,ke,t,r.worldSize,l,u,d,p);E.emplaceBack(Ae[0],Ae[1],Ae[2]),x.emplaceBack(ne+he)}},M=$t;C(0,0,M,0,16),C(M,0,M,M,16),C(M,M,0,M,16),C(0,M,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(x),this._tileDebugBuffer=e.createVertexBuffer(y,Bu.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(E,_y.members),this._tileDebugSegments=sn.simpleSegment(0,0,y.length,x.length)}_makeGlobeTileDebugTextBuffer(e,t,r,l,u,d,p){const y=new _t,x=new ti,E=new It,C=25;x.reserve(32),y.reserve(C),E.reserve(C);const M=(P,D)=>C*P+D;for(let P=0;P<C;P++){const D=2048*P;for(let O=0;O<C;O++){const V=2048*O;y.emplaceBack(V,D);const K=this._globePoint(V,D,t,r.worldSize,l,u,d,p);E.emplaceBack(K[0],K[1],K[2])}}for(let P=0;P<4;P++)for(let D=0;D<4;D++){const O=M(P,D),V=M(P,D+1),K=M(P+1,D),oe=M(P+1,D+1);x.emplaceBack(O,V,K),x.emplaceBack(K,V,oe)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(x),this._tileDebugTextBuffer=e.createVertexBuffer(y,Bu.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(E,_y.members),this._tileDebugTextSegments=sn.simpleSegment(0,0,C,32)}}class Vw{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,t,r){const l=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][l]=this.stateChanges[e][l]||{},Fe(this.stateChanges[e][l],r),this.deletedStates[e]===null){this.deletedStates[e]={};for(const u in this.state[e])u!==l&&(this.deletedStates[e][u]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][l]===null){this.deletedStates[e][l]={};for(const u in this.state[e][l])r[u]||(this.deletedStates[e][l][u]=null)}else for(const u in r)this.deletedStates[e]&&this.deletedStates[e][l]&&this.deletedStates[e][l][u]===null&&delete this.deletedStates[e][l][u]}removeFeatureState(e,t,r){if(this.deletedStates[e]===null)return;const l=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&t!==void 0)this.deletedStates[e][l]!==null&&(this.deletedStates[e][l]=this.deletedStates[e][l]||{},this.deletedStates[e][l][r]=null);else if(t!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][l])for(r in this.deletedStates[e][l]={},this.stateChanges[e][l])this.deletedStates[e][l][r]=null;else this.deletedStates[e][l]=null;else this.deletedStates[e]=null}getState(e,t){const r=String(t),l=Fe({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const u=this.deletedStates[e][t];if(u===null)return{};for(const d in u)delete l[d]}return l}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,t){const r={};for(const l in this.stateChanges){this.state[l]=this.state[l]||{};const u={};for(const d in this.stateChanges[l])this.state[l][d]||(this.state[l][d]={}),Fe(this.state[l][d],this.stateChanges[l][d]),u[d]=this.state[l][d];r[l]=u}for(const l in this.deletedStates){this.state[l]=this.state[l]||{};const u={};if(this.deletedStates[l]===null)for(const d in this.state[l])u[d]={},this.state[l][d]={};else for(const d in this.deletedStates[l]){if(this.deletedStates[l][d]===null)this.state[l][d]={};else for(const p of Object.keys(this.deletedStates[l][d]))delete this.state[l][d][p];u[d]=this.state[l][d]}r[l]=r[l]||{},Fe(r[l],u)}if(this.stateChanges={},this.deletedStates={},Object.keys(r).length!==0)for(const l in e)e[l].setFeatureState(r,t)}}class By{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const r=this.toIdx(e,t);return{min:this.minimums[r],max:this.maximums[r]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function Fy(i,e,t,r){let l=0,u=Number.MAX_VALUE;for(let d=0;d<3;d++)if(Math.abs(r[d])<1e-15){if(t[d]<i[d]||t[d]>e[d])return null}else{const p=1/r[d];let y=(i[d]-t[d])*p,x=(e[d]-t[d])*p;if(y>x){const E=y;y=x,x=E}if(y>l&&(l=y),x<u&&(u=x),l>u)return null}return l}function Oy(i,e,t,r,l,u,d,p,y,x,E){const C=r-i,M=l-e,P=u-t,D=d-i,O=p-e,V=y-t,K=E[1]*V-E[2]*O,oe=E[2]*D-E[0]*V,Q=E[0]*O-E[1]*D,ne=C*K+M*oe+P*Q;if(Math.abs(ne)<1e-15)return null;const he=1/ne,se=x[0]-i,ke=x[1]-e,Ae=x[2]-t,Oe=(se*K+ke*oe+Ae*Q)*he;if(Oe<0||Oe>1)return null;const ut=ke*P-Ae*M,De=Ae*C-se*P,je=se*M-ke*C,Xe=(E[0]*ut+E[1]*De+E[2]*je)*he;return Xe<0||Oe+Xe>1?null:(D*ut+O*De+V*je)*he}function Uy(i,e,t){return(i-e)/(t-e)}function Vy(i,e,t,r,l,u,d,p,y){const x=1<<t,E=u-r,C=d-l,M=(i+1)/x*E+r,P=(e+0)/x*C+l,D=(e+1)/x*C+l;p[0]=(i+0)/x*E+r,p[1]=P,y[0]=M,y[1]=D}class Ny{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(u){const d=Math.ceil(Math.log2(u.dim/8)),p=[];let y=Math.ceil(Math.pow(2,d));const x=1/y,E=(P,D,O,V,K)=>{const oe=V?1:0,Q=(P+1)*O-oe,ne=D*O,he=(D+1)*O-oe;K[0]=P*O,K[1]=ne,K[2]=Q,K[3]=he};let C=new By(y);const M=[];for(let P=0;P<y*y;P++){E(P%y,Math.floor(P/y),x,!1,M);const D=Fs(M[0],M[1],u),O=Fs(M[2],M[1],u),V=Fs(M[2],M[3],u),K=Fs(M[0],M[3],u);C.minimums.push(Math.min(D,O,V,K)),C.maximums.push(Math.max(D,O,V,K)),C.leaves.push(1)}for(p.push(C),y/=2;y>=1;y/=2){const P=p[p.length-1];C=new By(y);for(let D=0;D<y*y;D++){E(D%y,Math.floor(D/y),2,!0,M);const O=P.getElevation(M[0],M[1]),V=P.getElevation(M[2],M[1]),K=P.getElevation(M[2],M[3]),oe=P.getElevation(M[0],M[3]),Q=P.isLeaf(M[0],M[1]),ne=P.isLeaf(M[2],M[1]),he=P.isLeaf(M[2],M[3]),se=P.isLeaf(M[0],M[3]),ke=Math.min(O.min,V.min,K.min,oe.min),Ae=Math.max(O.max,V.max,K.max,oe.max),Oe=Q&&ne&&he&&se;C.maximums.push(Ae),C.minimums.push(ke),C.leaves.push(Ae-ke<=5&&Oe?1:0)}p.push(C)}return p}(this.dem),r=t.length-1,l=t[r];this._addNode(l.minimums[0],l.maximums[0],l.leaves[0]),this._construct(t,0,0,r,0)}raycastRoot(e,t,r,l,u,d,p=1){return Fy([e,t,-100],[r,l,this.maximums[0]*p],u,d)}raycast(e,t,r,l,u,d,p=1){if(!this.nodeCount)return null;const y=this.raycastRoot(e,t,r,l,u,d,p);if(y==null)return null;const x=[],E=[],C=[],M=[],P=[{idx:0,t:y,nodex:0,nodey:0,depth:0}];for(;P.length>0;){const{idx:D,t:O,nodex:V,nodey:K,depth:oe}=P.pop();if(this.leaves[D]){Vy(V,K,oe,e,t,r,l,C,M);const ne=1<<oe,he=(V+0)/ne,se=(V+1)/ne,ke=(K+0)/ne,Ae=(K+1)/ne,Oe=Fs(he,ke,this.dem)*p,ut=Fs(se,ke,this.dem)*p,De=Fs(se,Ae,this.dem)*p,je=Fs(he,Ae,this.dem)*p,Xe=Oy(C[0],C[1],Oe,M[0],C[1],ut,M[0],M[1],De,u,d),$e=Oy(M[0],M[1],De,C[0],M[1],je,C[0],C[1],Oe,u,d),st=Math.min(Xe!==null?Xe:Number.MAX_VALUE,$e!==null?$e:Number.MAX_VALUE);if(st!==Number.MAX_VALUE)return st;{const He=md([],u,d,O);if(jy(Oe,ut,je,De,Uy(He[0],C[0],M[0]),Uy(He[1],C[1],M[1]))>=He[2])return O}continue}let Q=0;for(let ne=0;ne<this._siblingOffset.length;ne++){Vy((V<<1)+this._siblingOffset[ne][0],(K<<1)+this._siblingOffset[ne][1],oe+1,e,t,r,l,C,M),C[2]=-100,M[2]=this.maximums[this.childOffsets[D]+ne]*p;const he=Fy(C,M,u,d);if(he!=null){const se=he;x[ne]=se;let ke=!1;for(let Ae=0;Ae<Q&&!ke;Ae++)se>=x[E[Ae]]&&(E.splice(Ae,0,ne),ke=!0);ke||(E[Q]=ne),Q++}}for(let ne=0;ne<Q;ne++){const he=E[ne];P.push({idx:this.childOffsets[D]+he,t:x[he],nodex:(V<<1)+this._siblingOffset[he][0],nodey:(K<<1)+this._siblingOffset[he][1],depth:oe+1})}}return null}_addNode(e,t,r){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(r),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,r,l,u){if(e[l].isLeaf(t,r)===1)return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);const d=l-1,p=e[d];let y=0,x=0;for(let E=0;E<this._siblingOffset.length;E++){const C=2*t+this._siblingOffset[E][0],M=2*r+this._siblingOffset[E][1],P=p.getElevation(C,M),D=p.isLeaf(C,M),O=this._addNode(P.min,P.max,D);D&&(y|=1<<E),x||(x=O)}for(let E=0;E<this._siblingOffset.length;E++)y&1<<E||this._construct(e,2*t+this._siblingOffset[E][0],2*r+this._siblingOffset[E][1],d,x+E)}}function jy(i,e,t,r,l,u){return fi(fi(i,t,u),fi(e,r,u),l)}function Fs(i,e,t){const r=t.dim,l=Ie(i*r-.5,0,r-1),u=Ie(e*r-.5,0,r-1),d=Math.floor(l),p=Math.floor(u),y=Math.min(d+1,r-1),x=Math.min(p+1,r-1);return jy(t.get(d,p),t.get(y,p),t.get(d,x),t.get(y,x),l-d,u-p)}const $y={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class $d{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,r,l=!1,u=!1){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(r&&r!=="mapbox"&&r!=="terrarium")return Jt(`"${r}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=t.height;const d=this.dim=t.height-2,p=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.encoding=r||"mapbox",this.borderReady=l,!l){for(let y=0;y<d;y++)p[this._idx(-1,y)]=p[this._idx(0,y)],p[this._idx(d,y)]=p[this._idx(d-1,y)],p[this._idx(y,-1)]=p[this._idx(y,0)],p[this._idx(y,d)]=p[this._idx(y,d-1)];p[this._idx(-1,-1)]=p[this._idx(0,0)],p[this._idx(d,-1)]=p[this._idx(d-1,0)],p[this._idx(-1,d)]=p[this._idx(0,d-1)],p[this._idx(d,d)]=p[this._idx(d-1,d-1)],u&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Ny(this)}get(e,t,r=!1){r&&(e=Ie(e,-1,this.dim),t=Ie(t,-1,this.dim));const l=4*this._idx(e,t);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[l],this.pixels[l+1],this.pixels[l+2])}static getUnpackVector(e){return $y[e]}get unpackVector(){return $y[this.encoding]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}_unpackMapbox(e,t,r){return(256*e*256+256*t+r)/10-1e4}_unpackTerrarium(e,t,r){return 256*e+t+r/256-32768}static pack(e,t){const r=[0,0,0,0],l=$d.getUnpackVector(t);let u=Math.floor((e+l[3])/l[2]);return r[2]=u%256,u=Math.floor(u/256),r[1]=u%256,u=Math.floor(u/256),r[0]=u,r}getPixels(){return new _r({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=t*this.dim,u=t*this.dim+this.dim,d=r*this.dim,p=r*this.dim+this.dim;switch(t){case-1:l=u-1;break;case 1:u=l+1}switch(r){case-1:d=p-1;break;case 1:p=d+1}const y=-t*this.dim,x=-r*this.dim;for(let E=d;E<p;E++)for(let C=l;C<u;C++){const M=4*this._idx(C,E),P=4*this._idx(C+y,E+x);this.pixels[M+0]=e.pixels[P+0],this.pixels[M+1]=e.pixels[P+1],this.pixels[M+2]=e.pixels[P+2],this.pixels[M+3]=e.pixels[P+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}At($d,"DEMData"),At(Ny,"DemMinMaxQuadTree",{omit:["dem"]});class Nw{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,r){const l=e.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const u={value:t,timeout:void 0};if(r!==void 0&&(u.timeout=setTimeout(()=>{this.remove(e,u)},r)),this.data[l].push(u),this.order.push(l),this.order.length>this.max){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const r=e.wrapped().key,l=t===void 0?0:this.data[r].indexOf(t),u=this.data[r][l];return this.data[r].splice(l,1),u.timeout&&clearTimeout(u.timeout),this.data[r].length===0&&delete this.data[r],this.onRemove(u.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(e){const t=[];for(const r in this.data)for(const l of this.data[r])e(l.value)||t.push(l);for(const r of t)this.remove(r.value.tileID,r)}}class Yl{constructor(e,t,r){this.func=e,this.mask=t,this.range=r}}Yl.ReadOnly=!1,Yl.ReadWrite=!0,Yl.disabled=new Yl(519,Yl.ReadOnly,[0,1]);const Jp=7680;class Qp{constructor(e,t,r,l,u,d){this.test=e,this.ref=t,this.mask=r,this.fail=l,this.depthFail=u,this.pass=d}}Qp.disabled=new Qp({func:519,mask:0},0,0,Jp,Jp,Jp);class Ao{constructor(e,t,r){this.blendFunction=e,this.blendColor=t,this.mask=r}}Ao.Replace=[1,0],Ao.disabled=new Ao(Ao.Replace,Ai.transparent,[!1,!1,!1,!1]),Ao.unblended=new Ao(Ao.Replace,Ai.transparent,[!0,!0,!0,!0]),Ao.alphaBlended=new Ao([1,771],Ai.transparent,[!0,!0,!0,!0]);const em=1029,tm=2305;class eo{constructor(e,t,r){this.enable=e,this.mode=t,this.frontFace=r}}eo.disabled=new eo(!1,em,tm),eo.backCCW=new eo(!0,em,tm),eo.backCW=new eo(!0,em,2304),eo.frontCW=new eo(!0,1028,2304),eo.frontCCW=new eo(!0,1028,tm);class Ba extends Ft{constructor(e,t,r){super(),this.id=e,this._onlySymbols=r,t.on("data",l=>{l.dataType==="source"&&l.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&l.dataType==="source"&&l.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),t.on("error",()=>{this._sourceErrored=!0}),this._source=t,this._tiles={},this._cache=new Nw(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new Vw,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const t=this._tiles[e];if(t.state!=="loaded"&&t.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const t in this._tiles){const r=this._tiles[t];this._source.prepareTile(r)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,r.tileID),r.upload(e),r.prepare(this.map.style.imageManager)}else for(const t in this._tiles){const r=this._tiles[t];r.upload(e),r.prepare(this.map.style.imageManager)}}getIds(){return Qe(this._tiles).map(e=>e.tileID).sort(qy).map(e=>e.key)}getRenderableIds(e){const t=[];for(const r in this._tiles)this._isIdRenderable(+r,e)&&t.push(this._tiles[r]);return e?t.sort((r,l)=>{const u=r.tileID,d=l.tileID,p=new G(u.canonical.x,u.canonical.y)._rotate(this.transform.angle),y=new G(d.canonical.x,d.canonical.y)._rotate(this.transform.angle);return u.overscaledZ-d.overscaledZ||y.y-p.y||y.x-p.x}).map(r=>r.tileID.key):t.map(r=>r.tileID).sort(qy).map(r=>r.key)}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const r=this._tiles[e];r&&(r.state!=="loading"&&(r.state=t),this._loadTile(r,this._tileLoaded.bind(this,r,e,t)))}_tileLoaded(e,t,r,l){if(l)if(e.state="errored",l.status!==404)this._source.fire(new Ei(l,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const u=this.map.painter.terrain;this.update(this.transform,u.getScaledDemTileSize(),!0),u.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Ct.now(),r==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new zi("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let l=0;l<t.length;l++){const u=t[l];if(e.neighboringTiles&&e.neighboringTiles[u]){const d=this.getTileByID(u);r(e,d),r(d,e)}}function r(l,u){if(!l.dem||l.dem.borderReady)return;l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0;let d=u.tileID.canonical.x-l.tileID.canonical.x;const p=u.tileID.canonical.y-l.tileID.canonical.y,y=Math.pow(2,l.tileID.canonical.z),x=u.tileID.key;d===0&&p===0||Math.abs(p)>1||(Math.abs(d)>1&&(Math.abs(d+y)===1?d+=y:Math.abs(d-y)===1&&(d-=y)),u.dem&&l.dem&&(l.dem.backfillBorder(u.dem,d,p),l.neighboringTiles&&l.neighboringTiles[x]&&(l.neighboringTiles[x].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,r,l){for(const u in this._tiles){let d=this._tiles[u];if(l[u]||!d.hasData()||d.tileID.overscaledZ<=t||d.tileID.overscaledZ>r)continue;let p=d.tileID;for(;d&&d.tileID.overscaledZ>t+1;){const x=d.tileID.scaledTo(d.tileID.overscaledZ-1);d=this._tiles[x.key],d&&d.hasData()&&(p=x)}let y=p;for(;y.overscaledZ>t;)if(y=y.scaledTo(y.overscaledZ-1),e[y.key]){l[p.key]=p;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const r=this._loadedParentTiles[e.key];return r&&r.tileID.overscaledZ>=t?r:null}for(let r=e.overscaledZ-1;r>=t;r--){const l=e.scaledTo(r),u=this._getLoadedTile(l);if(u)return u}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const r=Math.ceil(e.width/t)+1,l=Math.ceil(e.height/t)+1,u=Math.floor(r*l*5),d=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,u):u,p=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(p)}handleWrapJump(e){const t=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,t){const r={};for(const l in this._tiles){const u=this._tiles[l];u.tileID=u.tileID.unwrapTo(u.tileID.wrap+t),r[u.tileID.key]=u}this._tiles=r;for(const l in this._timers)clearTimeout(this._timers[l]),delete this._timers[l];for(const l in this._tiles)this._setTileReloadTimer(+l,this._tiles[l])}}update(e,t,r){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!r)return;let l;this.updateCacheSize(e,t),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(p=>new Hn(p.canonical.z,p.wrap,p.canonical.z,p.canonical.x,p.canonical.y)):(l=e.coveringTiles({tileSize:t||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!r,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(l=l.filter(p=>this._source.hasTile(p)))):l=[];const u=this._updateRetainedTiles(l);if(Gy(this._source.type)&&l.length!==0){const p={},y={},x=Object.keys(u);for(const C of x){const M=u[C],P=this._tiles[C];if(!P||P.fadeEndTime&&P.fadeEndTime<=Ct.now())continue;const D=this.findLoadedParent(M,Math.max(M.overscaledZ-Ba.maxOverzooming,this._source.minzoom));D&&(this._addTile(D.tileID),p[D.tileID.key]=D.tileID),y[C]=M}const E=l[l.length-1].overscaledZ;for(const C in this._tiles){const M=this._tiles[C];if(u[C]||!M.hasData())continue;let P=M.tileID;for(;P.overscaledZ>E;){P=P.scaledTo(P.overscaledZ-1);const D=this._tiles[P.key];if(D&&D.hasData()&&y[P.key]){u[C]=M.tileID;break}}}for(const C in p)u[C]||(this._coveredTiles[C]=!0,u[C]=p[C])}for(const p in u)this._tiles[p].clearFadeHold();const d=function(p,y){const x=[];for(const E in p)E in y||x.push(E);return x}(this._tiles,u);for(const p of d){const y=this._tiles[p];y.hasSymbolBuckets&&!y.holdingForFade()?y.setHoldDuration(this.map._fadeDuration):y.hasSymbolBuckets&&!y.symbolFadeFinished()||this._removeTile(+p)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(e.length===0)return t;const r={},l=e.reduce((x,E)=>Math.min(x,E.overscaledZ),1/0),u=e[0].overscaledZ,d=Math.max(u-Ba.maxOverzooming,this._source.minzoom),p=Math.max(u+Ba.maxUnderzooming,this._source.minzoom),y={};for(const x of e){const E=this._addTile(x);t[x.key]=x,E.hasData()||l<this._source.maxzoom&&(y[x.key]=x)}this._retainLoadedChildren(y,l,p,t);for(const x of e){let E=this._tiles[x.key];if(E.hasData())continue;if(x.canonical.z>=this._source.maxzoom){const M=x.children(this._source.maxzoom)[0],P=this.getTile(M);if(P&&P.hasData()){t[M.key]=M;continue}}else{const M=x.children(this._source.maxzoom);if(t[M[0].key]&&t[M[1].key]&&t[M[2].key]&&t[M[3].key])continue}let C=E.wasRequested();for(let M=x.overscaledZ-1;M>=d;--M){const P=x.scaledTo(M);if(r[P.key]||(r[P.key]=!0,E=this.getTile(P),!E&&C&&(E=this._addTile(P)),E&&(t[P.key]=P,C=E.wasRequested(),E.hasData())))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let r,l=this._tiles[e].tileID;for(;l.overscaledZ>0;){if(l.key in this._loadedParentTiles){r=this._loadedParentTiles[l.key];break}t.push(l.key);const u=l.scaledTo(l.overscaledZ-1);if(r=this._getLoadedTile(u),r)break;l=u}for(const u of t)this._loadedParentTiles[u]=r}}_addTile(e){let t=this._tiles[e.key];if(t)return this._source.prepareTile&&this._source.prepareTile(t),t;t=this._cache.getAndRemove(e),t&&(this._setTileReloadTimer(e.key,t),t.tileID=e,this._state.initializeTileState(t,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t)));const r=Boolean(t);if(!r){const l=this.map?this.map.painter:null;t=new Yp(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,l,this._isRaster),this._source.prepareTile&&this._source.prepareTile(t)||this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))}return t?(t.uses++,this._tiles[e.key]=t,r||this._source.fire(new zi("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const r=t.getExpiryTimeout();r&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},r))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&t.state!=="reloading"?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,t,r){const l=[],u=this.transform;if(!u)return l;const d=u.projection.name==="globe",p=vo(u.center.lng);for(const y in this._tiles){const x=this._tiles[y];if(r&&x.clearQueryDebugViz(),x.holdingForFade())continue;let E;if(d){const C=x.tileID.canonical;if(C.z===0){const M=[Math.abs(Ie(p,...Gu(C,-1))-p),Math.abs(Ie(p,...Gu(C,1))-p)];E=[0,2*M.indexOf(Math.min(...M))-1]}else{const M=[Math.abs(Ie(p,...Gu(C,-1))-p),Math.abs(Ie(p,...Gu(C,0))-p),Math.abs(Ie(p,...Gu(C,1))-p)];E=[M.indexOf(Math.min(...M))-1]}}else E=[0];for(const C of E){const M=e.containsTile(x,u,t,C);M&&l.push(M)}}return l}getVisibleCoordinates(e){const t=this.getRenderableIds(e).map(r=>this._tiles[r].tileID);for(const r of t)r.projMatrix=this.transform.calculateProjMatrix(r.toUnwrapped());return t}hasTransition(){if(this._source.hasTransition())return!0;if(Gy(this._source.type))for(const e in this._tiles){const t=this._tiles[e];if(t.fadeEndTime!==void 0&&t.fadeEndTime>=Ct.now())return!0}return!1}setFeatureState(e,t,r){this._state.updateState(e=e||"_geojsonTileLayer",t,r)}removeFeatureState(e,t,r){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,r)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,r){const l=this._tiles[e];l&&l.setDependencies(t,r)}reloadTilesForDependencies(e,t){for(const r in this._tiles)this._tiles[r].hasDependency(e,t)&&this._reloadTile(+r,"reloading");this._cache.filter(r=>!r.hasDependency(e,t))}_preloadTiles(e,t){const r=new Map,l=Array.isArray(e)?e:[e],u=this.map.painter.terrain,d=this.usedForTerrain&&u?u.getScaledDemTileSize():this._source.tileSize;for(const p of l){const y=p.coveringTiles({tileSize:d,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const x of y)r.set(x.key,x);this.usedForTerrain&&p.updateElevation(!1)}ze(Array.from(r.values()),(p,y)=>{const x=new Yp(p,this._source.tileSize*p.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(x,E=>{this._source.type==="raster-dem"&&x.dem&&this._backfillDEM(x),y(E,x)})},t)}}function qy(i,e){const t=Math.abs(2*i.wrap)-+(i.wrap<0),r=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||r-t||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x}function Gy(i){return i==="raster"||i==="image"||i==="video"}function Gu(i,e){const t=1<<i.z;return[i.x/t+e,(i.x+1)/t+e]}Ba.maxOverzooming=10,Ba.maxUnderzooming=3;class qd{constructor(e,t,r){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=r}static create(e,t,r){const l=r||e.findDEMTileFor(t);if(!l||!l.dem)return;const u=l.dem,d=l.tileID,p=1<<t.canonical.z-d.canonical.z;return new qd(l,l.tileSize/$t/p,[(t.canonical.x/p-d.canonical.x)*u.dim,(t.canonical.y/p-d.canonical.y)*u.dim])}tileCoordToPixel(e,t){const r=t*this._scale+this._offset[1],l=Math.floor(e*this._scale+this._offset[0]),u=Math.floor(r);return new G(l,u)}getElevationAt(e,t,r,l){const u=e*this._scale+this._offset[0],d=t*this._scale+this._offset[1],p=Math.floor(u),y=Math.floor(d),x=this._dem;return l=!!l,r?fi(fi(x.get(p,y,l),x.get(p,y+1,l),d-y),fi(x.get(p+1,y,l),x.get(p+1,y+1,l),d-y),u-p):x.get(p,y,l)}getElevationAtPixel(e,t,r){return this._dem.get(e,t,!!r)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Dr(1,e)*this._dem.stride}}class Zy{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Cs($t,16,0),this.featureIndexArray=new R_,this.promoteId=t}insert(e,t,r,l,u,d=0){const p=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,l,u,d);const y=this.grid;for(let x=0;x<t.length;x++){const E=t[x],C=[1/0,1/0,-1/0,-1/0];for(let M=0;M<E.length;M++){const P=E[M];C[0]=Math.min(C[0],P.x),C[1]=Math.min(C[1],P.y),C[2]=Math.max(C[2],P.x),C[3]=Math.max(C[3],P.y)}C[0]<$t&&C[1]<$t&&C[2]>=0&&C[3]>=0&&y.insert(p,C[0],C[1],C[2],C[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new La.VectorTile(new Du(this.rawTileData)).layers,this.sourceLayerCoder=new ky(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t,r,l){this.loadVTLayers();const u=e.params||{},d=xa(u.filter),p=e.tileResult,y=e.transform,x=p.bufferedTilespaceBounds,E=this.grid.query(x.min.x,x.min.y,x.max.x,x.max.y,(D,O,V,K)=>eg(p.bufferedTilespaceGeometry,D,O,V,K));E.sort(jw);let C=null;y.elevation&&E.length>0&&(C=qd.create(y.elevation,this.tileID));const M={};let P;for(let D=0;D<E.length;D++){const O=E[D];if(O===P)continue;P=O;const V=this.featureIndexArray.get(O);let K=null;this.loadMatchingFeature(M,V,d,u.layers,u.availableImages,t,r,l,(oe,Q,ne,he=0)=>(K||(K=Ho(oe,this.tileID.canonical,e.tileTransform)),Q.queryIntersectsFeature(p,oe,ne,K,this.z,e.transform,e.pixelPosMatrix,C,he)))}return M}loadMatchingFeature(e,t,r,l,u,d,p,y,x){const{featureIndex:E,bucketIndex:C,sourceLayerIndex:M,layoutVertexArrayOffset:P}=t,D=this.bucketLayerIDs[C];if(l&&!function(oe,Q){for(let ne=0;ne<oe.length;ne++)if(Q.indexOf(oe[ne])>=0)return!0;return!1}(l,D))return;const O=this.sourceLayerCoder.decode(M),V=this.vtLayers[O].feature(E);if(r.needGeometry){const oe=Ia(V,!0);if(!r.filter(new $(this.tileID.overscaledZ),oe,this.tileID.canonical))return}else if(!r.filter(new $(this.tileID.overscaledZ),V))return;const K=this.getId(V,O);for(let oe=0;oe<D.length;oe++){const Q=D[oe];if(l&&l.indexOf(Q)<0)continue;const ne=d[Q];if(!ne)continue;let he={};K!==void 0&&y&&(he=y.getState(ne.sourceLayer||"_geojsonTileLayer",K));const se=Fe({},p[Q]);se.paint=Wy(se.paint,ne.paint,V,he,u),se.layout=Wy(se.layout,ne.layout,V,he,u);const ke=!x||x(V,ne,he,P);if(!ke)continue;const Ae=new Py(V,this.z,this.x,this.y,K);Ae.layer=se;let Oe=e[Q];Oe===void 0&&(Oe=e[Q]=[]),Oe.push({featureIndex:E,feature:Ae,intersectionZ:ke})}}lookupSymbolFeatures(e,t,r,l,u,d,p,y){const x={};this.loadVTLayers();const E=xa(u);for(const C of e)this.loadMatchingFeature(x,{bucketIndex:r,sourceLayerIndex:l,featureIndex:C,layoutVertexArrayOffset:0},E,d,p,y,t);return x}loadFeature(e){const{featureIndex:t,sourceLayerIndex:r}=e;this.loadVTLayers();const l=this.sourceLayerCoder.decode(r),u=this.vtFeatures[l];if(u[t])return u[t];const d=this.vtLayers[l].feature(t);return u[t]=d,d}hasLayer(e){for(const t of this.bucketLayerIDs)for(const r of t)if(e===r)return!0;return!1}getId(e,t){let r=e.id;return this.promoteId&&(r=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[t]],typeof r=="boolean"&&(r=Number(r))),r}}function Wy(i,e,t,r,l){return Mt(i,(u,d)=>{const p=e instanceof ce?e.get(d):null;return p&&p.evaluate?p.evaluate(t,r,l):p})}function jw(i,e){return e-i}At(Zy,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Xy{constructor(e){const t={},r=[];for(const p in e){const y=e[p],x=t[p]={};for(const E in y.glyphs){const C=y.glyphs[+E];if(!C||C.bitmap.width===0||C.bitmap.height===0)continue;const M=C.metrics.localGlyph?2:1,P={x:0,y:0,w:C.bitmap.width+2*M,h:C.bitmap.height+2*M};r.push(P),x[E]=P}}const{w:l,h:u}=Dp(r),d=new Ko({width:l||1,height:u||1});for(const p in e){const y=e[p];for(const x in y.glyphs){const E=y.glyphs[+x];if(!E||E.bitmap.width===0||E.bitmap.height===0)continue;const C=t[p][x],M=E.metrics.localGlyph?2:1;Ko.copy(E.bitmap,d,{x:0,y:0},{x:C.x+M,y:C.y+M},E.bitmap)}}this.image=d,this.positions=t}}At(Xy,"GlyphAtlas");class $w{constructor(e){this.tileID=new Hn(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Ra(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,t,r,l,u){this.status="parsing",this.data=e,this.collisionBoxArray=new xo;const d=new ky(Object.keys(e.layers).sort()),p=new Zy(this.tileID,this.promoteId);p.bucketLayerIDs=[];const y={},x=new Kp(256,256),E={featureIndex:p,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:x,availableImages:r},C=t.familiesBySource[this.source];for(const he in C){const se=e.layers[he];if(!se)continue;let ke=!1,Ae=!1;for(const De of C[he])De[0].type==="symbol"?ke=!0:Ae=!0;if(this.isSymbolTile===!0&&!ke||this.isSymbolTile===!1&&!Ae)continue;se.version===1&&Jt(`Vector tile source "${this.source}" layer "${he}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Oe=d.encode(he),ut=[];for(let De=0;De<se.length;De++){const je=se.feature(De),Xe=p.getId(je,he);ut.push({feature:je,id:Xe,index:De,sourceLayerIndex:Oe})}for(const De of C[he]){const je=De[0];this.isSymbolTile!==void 0&&je.type==="symbol"!==this.isSymbolTile||je.minzoom&&this.zoom<Math.floor(je.minzoom)||je.maxzoom&&this.zoom>=je.maxzoom||je.visibility!=="none"&&(im(De,this.zoom,r),(y[je.id]=je.createBucket({index:p.bucketLayerIDs.length,layers:De,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Oe,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:r})).populate(ut,E,this.tileID.canonical,this.tileTransform),p.bucketLayerIDs.push(De.map(Xe=>Xe.id)))}}let M,P,D,O;x.trim();const V={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},K=Mt(E.glyphDependencies,he=>Object.keys(he).map(Number));Object.keys(K).length?l.send("getGlyphs",{uid:this.uid,stacks:K},(he,se)=>{M||(M=he,P=se,ne.call(this))},void 0,!1,V):P={};const oe=Object.keys(E.iconDependencies);oe.length?l.send("getImages",{icons:oe,source:this.source,tileID:this.tileID,type:"icons"},(he,se)=>{M||(M=he,D=se,ne.call(this))},void 0,!1,V):D={};const Q=Object.keys(E.patternDependencies);function ne(){if(M)return u(M);if(P&&D&&O){const he=new Xy(P),se=new Hg(D,O);for(const ke in y){const Ae=y[ke];Ae instanceof Ls?(im(Ae.layers,this.zoom,r),hw(Ae,P,he.positions,D,se.iconPositions,this.showCollisionBoxes,r,this.tileID.canonical,this.tileZoom,this.projection)):Ae.hasPattern&&(Ae instanceof Sd||Ae instanceof bd||Ae instanceof Iu)&&(im(Ae.layers,this.zoom,r),Ae.addFeatures(E,this.tileID.canonical,se.patternPositions,r,this.tileTransform))}this.status="done",u(null,{buckets:Qe(y).filter(ke=>!ke.isEmpty()),featureIndex:p,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:he.image,lineAtlas:x,imageAtlas:se,glyphMap:this.returnDependencies?P:null,iconMap:this.returnDependencies?D:null,glyphPositions:this.returnDependencies?he.positions:null})}}Q.length?l.send("getImages",{icons:Q,source:this.source,tileID:this.tileID,type:"patterns"},(he,se)=>{M||(M=he,O=se,ne.call(this))},void 0,!1,V):O={},ne.call(this)}}function im(i,e,t){const r=new $(e);for(const l of i)l.recalculate(r,t)}class Hy{constructor(e){this.entries={},this.scheduler=e}request(e,t,r,l){const u=this.entries[e]=this.entries[e]||{callbacks:[]};if(u.result){const[d,p]=u.result;return this.scheduler?this.scheduler.add(()=>{l(d,p)},t):l(d,p),()=>{}}return u.callbacks.push(l),u.cancel||(u.cancel=r((d,p)=>{u.result=[d,p];for(const y of u.callbacks)this.scheduler?this.scheduler.add(()=>{y(d,p)},t):y(d,p);setTimeout(()=>delete this.entries[e],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(d=>d!==l),u.callbacks.length||(u.cancel(),delete this.entries[e]))}}}function Ky(i,e,t){const r=JSON.stringify(i.request);return i.data&&(this.deduped.entries[r]={result:[null,i.data]}),this.deduped.request(r,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},l=>{const u=we(i.request,(d,p,y,x)=>{d?l(d):p&&l(null,{vectorTile:t?void 0:new La.VectorTile(new Du(p)),rawData:p,cacheControl:y,expires:x})});return()=>{u.cancel(),l()}},e)}s.ARRAY_TYPE=mr,s.AUTH_ERR_MSG=ai,s.Aabb=ar,s.Actor=class{constructor(i,e,t){this.target=i,this.parent=e,this.mapId=t,this.callbacks={},this.cancelCallbacks={},Wt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Pn()?i:B,this.scheduler=new Ow}send(i,e,t,r,l=!1,u){const d=Math.round(1e18*Math.random()).toString(36).substring(0,10);t&&(t.metadata=u,this.callbacks[d]=t);const p=jr(this.globalScope)?void 0:[];return this.target.postMessage({id:d,type:i,hasCallback:!!t,targetMapId:r,mustQueue:l,sourceMapId:this.mapId,data:As(e,p)},p),{cancel:()=>{t&&delete this.callbacks[d],this.target.postMessage({id:d,type:"<cancel>",targetMapId:r,sourceMapId:this.mapId})}}}receive(i){const e=i.data,t=e.id;if(t&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const r=this.cancelCallbacks[t];delete this.cancelCallbacks[t],r&&r.cancel()}else if(e.mustQueue||Pn()){const r=this.callbacks[t];this.cancelCallbacks[t]=this.scheduler.add(()=>this.processTask(t,e),r&&r.metadata||{type:"message"})}else this.processTask(t,e)}processTask(i,e){if(e.type==="<response>"){const t=this.callbacks[i];delete this.callbacks[i],t&&(e.error?t(wa(e.error)):t(null,wa(e.data)))}else{const t=jr(this.globalScope)?void 0:[],r=e.hasCallback?(u,d)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:u?As(u):null,data:As(d,t)},t)}:u=>{},l=wa(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,l,r);else if(this.parent.getWorkerSource){const u=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,u[0],l.source)[u[1]](l,r)}else r(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.CanonicalTileID=Td,s.Color=Ai,s.ColorMode=Ao,s.CullFaceMode=eo,s.DEMData=$d,s.DataConstantProperty=ae,s.DedupedRequest=Hy,s.DepthMode=Yl,s.EXTENT=$t,s.Elevation=class{isDataAvailableAtPoint(i){const e=this._source();if(!e||i.y<0||i.y>1)return!1;const t=e.getSource().maxzoom,r=1<<t,l=Math.floor(i.x),u=Math.floor((i.x-l)*r),d=Math.floor(i.y*r),p=this.findDEMTileFor(new Hn(t,l,t,u,d));return!(!p||!p.dem)}getAtPointOrZero(i,e=0){return this.getAtPoint(i,e)||0}getAtPoint(i,e,t=!0){e==null&&(e=null);const r=this._source();if(!r||i.y<0||i.y>1)return e;const l=r.getSource().maxzoom,u=1<<l,d=Math.floor(i.x),p=i.x-d,y=new Hn(l,d,l,Math.floor(p*u),Math.floor(i.y*u)),x=this.findDEMTileFor(y);if(!x||!x.dem)return e;const E=x.dem,C=1<<x.tileID.canonical.z,M=(p*C-x.tileID.canonical.x)*E.dim,P=(i.y*C-x.tileID.canonical.y)*E.dim,D=Math.floor(M),O=Math.floor(P);return(t?this.exaggeration():1)*fi(fi(E.get(D,O),E.get(D,O+1),P-O),fi(E.get(D+1,O),E.get(D+1,O+1),P-O),M-D)}getAtTileOffset(i,e,t){const r=1<<i.canonical.z;return this.getAtPointOrZero(new Bl(i.wrap+(i.canonical.x+e/$t)/r,(i.canonical.y+t/$t)/r))}getAtTileOffsetFunc(i,e,t,r){return l=>{const u=this.getAtTileOffset(i,l.x,l.y),d=r.upVector(i.canonical,l.x,l.y);return Kr(d,d,u*r.upVectorScale(i.canonical,e,t).metersToTile),d}}getForTilePoints(i,e,t,r){const l=qd.create(this,i,r);return!!l&&(e.forEach(u=>{u[2]=this.exaggeration()*l.getElevationAt(u[0],u[1],t)}),!0)}getMinMaxForTile(i){const e=this.findDEMTileFor(i);if(!e||!e.dem)return null;const t=e.dem.tree,r=e.tileID,l=1<<i.canonical.z-r.canonical.z;let u=i.canonical.x/l-r.canonical.x,d=i.canonical.y/l-r.canonical.y,p=0;for(let y=0;y<i.canonical.z-r.canonical.z&&!t.leaves[p];y++){u*=2,d*=2;const x=2*Math.floor(d)+Math.floor(u);p=t.childOffsets[p]+x,u%=1,d%=1}return{min:this.exaggeration()*t.minimums[p],max:this.exaggeration()*t.maximums[p]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,e,t){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},s.ErrorEvent=Ei,s.EvaluationParameters=$,s.Event=zi,s.Evented=Ft,s.FillExtrusionBucket=Iu,s.Frustum=wp,s.FrustumCorners=bp,s.GLOBE_METERS_TO_ECEF=jp,s.GLOBE_RADIUS=Qo,s.GLOBE_SCALE_MATCH_LATITUDE=45,s.GLOBE_ZOOM_THRESHOLD_MAX=6,s.GLOBE_ZOOM_THRESHOLD_MIN=5,s.GlobeSharedBuffers=class{constructor(i){this._createGrid(i),this._createPoles(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const i of this._poleSegments)i.destroy();for(const i of this._gridSegments)i.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const i of this._wireframeSegments)i.destroy()}}_createGrid(i){const e=new _t,t=new ti,r=65;for(let l=0;l<r;l++)for(let u=0;u<r;u++)e.emplaceBack(u,l);this._gridSegments=[];for(let l=0,u=0;l<Xl.length;l++){const d=Xl[l];for(let y=0;y<d;y++)for(let x=0;x<64;x++){const E=y*r+x;t.emplaceBack(E+1,E,E+r),t.emplaceBack(E+r,E+r+1,E+1)}const p=64*d*2;this._gridSegments.push(sn.simpleSegment(0,u,(d+1)*r,p)),u+=p}this._gridBuffer=i.createVertexBuffer(e,Bu.members),this._gridIndexBuffer=i.createIndexBuffer(t,!0)}_createPoles(i){const e=new ti;for(let l=0;l<=64;l++)e.emplaceBack(0,l+1,l+2);this._poleIndexBuffer=i.createIndexBuffer(e,!0);const t=new Cn,r=new Cn;this._poleSegments=[];for(let l=0,u=0;l<5;l++){const d=360/(1<<l);t.emplaceBack(0,-Qo,0,.5,0),r.emplaceBack(0,-Qo,0,.5,1);for(let p=0;p<=64;p++){const y=p/64,x=fi(0,d,y),[E,C,M]=Hl(yw,xw,x,Qo);t.emplaceBack(E,C,M,y,0),r.emplaceBack(E,C,M,y,1)}this._poleSegments.push(sn.simpleSegment(u,0,66,64)),u+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(t,my,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(r,my,!1)}getGridBuffers(i){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[i]]}getPoleBuffers(i){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}getWirefameBuffers(i,e){if(!this._wireframeSegments){const t=new Rn,r=64,l=r+1;this._wireframeSegments=[];for(let u=0,d=0;u<Xl.length;u++){const p=Xl[u];for(let x=0;x<p;x++)for(let E=0;E<r;E++){const C=x*l+E;t.emplaceBack(C,C+1),t.emplaceBack(C,C+l),t.emplaceBack(C,C+l+1)}const y=p*r*3;this._wireframeSegments.push(sn.simpleSegment(0,d,(p+1)*l,y)),d+=y}this._wireframeIndexBuffer=i.createIndexBuffer(t)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},s.GlyphManager=Zl,s.ImagePosition=Lp,s.LineAtlas=Kp,s.LngLat=vi,s.LngLatBounds=zs,s.LocalGlyphMode=Op,s.MAX_MERCATOR_LATITUDE=bo,s.MercatorCoordinate=Bl,s.ONE_EM=Mn,s.OverscaledTileID=Hn,s.Properties=Ve,s.RGBAImage=_r,s.Ray=vp,s.RequestManager=class{constructor(i,e,t){this._transformRequestFn=i,this._customAccessToken=e,this._silenceAuthErrors=!!t,this._createSkuToken()}_createSkuToken(){const i=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",wi,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,e){return this._transformRequestFn&&this._transformRequestFn(i,e)||{url:i}}normalizeStyleURL(i,e){if(!Ci(i))return i;const t=wn(i);return t.path=`/styles/v1${t.path}`,this._makeAPIURL(t,this._customAccessToken||e)}normalizeGlyphsURL(i,e){if(!Ci(i))return i;const t=wn(i);return t.path=`/fonts/v1${t.path}`,this._makeAPIURL(t,this._customAccessToken||e)}normalizeSourceURL(i,e,t,r){if(!Ci(i))return i;const l=wn(i);return l.path=`/v4/${l.authority}.json`,l.params.push("secure"),t&&l.params.push(`language=${t}`),r&&l.params.push(`worldview=${r}`),this._makeAPIURL(l,this._customAccessToken||e)}normalizeSpriteURL(i,e,t,r){const l=wn(i);return Ci(i)?(l.path=`/styles/v1${l.path}/sprite${e}${t}`,this._makeAPIURL(l,this._customAccessToken||r)):(l.path+=`${e}${t}`,Dn(l))}normalizeTileURL(i,e,t){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!Ci(i))return i;const r=wn(i);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||t&&r.authority!=="raster"&&t===512?"@2x":""}${ht.supported?".webp":"$1"}`),r.authority==="raster"?r.path=`/${Ye.RASTER_URL_PREFIX}${r.path}`:(r.path=r.path.replace(/^.+\/v4\//,"/"),r.path=`/${Ye.TILE_URL_VERSION}${r.path}`);const l=this._customAccessToken||function(u){for(const d of u){const p=d.match(/^access_token=(.*)$/);if(p)return p[1]}return null}(r.params)||Ye.ACCESS_TOKEN;return Ye.REQUIRE_ACCESS_TOKEN&&l&&this._skuToken&&r.params.push(`sku=${this._skuToken}`),this._makeAPIURL(r,l)}canonicalizeTileURL(i,e){const t=wn(i);if(!t.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!t.path.match(/\.[\w]+$/))return i;let r="mapbox://";t.path.match(/^\/raster\/v1\//)?r+=`raster/${t.path.replace(`/${Ye.RASTER_URL_PREFIX}/`,"")}`:r+=`tiles/${t.path.replace(`/${Ye.TILE_URL_VERSION}/`,"")}`;let l=t.params;return e&&(l=l.filter(u=>!u.match(/^access_token=/))),l.length&&(r+=`?${l.join("&")}`),r}canonicalizeTileset(i,e){const t=!!e&&Ci(e),r=[];for(const l of i.tiles||[])ln(l)?r.push(this.canonicalizeTileURL(l,t)):r.push(l);return r}_makeAPIURL(i,e){const t="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",r=wn(Ye.API_URL);if(i.protocol=r.protocol,i.authority=r.authority,i.protocol==="http"){const l=i.params.indexOf("secure");l>=0&&i.params.splice(l,1)}if(r.path!=="/"&&(i.path=`${r.path}${i.path}`),!Ye.REQUIRE_ACCESS_TOKEN)return Dn(i);if(e=e||Ye.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${t}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${t}`)}return i.params=i.params.filter(l=>l.indexOf("access_token")===-1),i.params.push(`access_token=${e||""}`),Dn(i)}},s.ResourceType=de,s.SegmentVector=sn,s.SourceCache=Ba,s.StencilMode=Qp,s.StructArrayLayout1ui2=jo,s.StructArrayLayout2f1f2i16=Wr,s.StructArrayLayout2i4=_t,s.StructArrayLayout2ui4=Rn,s.StructArrayLayout3f12=$i,s.StructArrayLayout3ui6=ti,s.StructArrayLayout4i8=Lt,s.StructArrayLayout5f20=Cn,s.Texture=qu,s.Tile=Yp,s.Transitionable=J,s.Uniform1f=ld,s.Uniform1i=class extends Zo{constructor(i){super(i),this.current=0}set(i,e,t){this.fetchUniformLocation(i,e)&&this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},s.Uniform2f=class extends Zo{constructor(i){super(i),this.current=[0,0]}set(i,e,t){this.fetchUniformLocation(i,e)&&(t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1])))}},s.Uniform3f=class extends Zo{constructor(i){super(i),this.current=[0,0,0]}set(i,e,t){this.fetchUniformLocation(i,e)&&(t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2])))}},s.Uniform4f=j_,s.UniformColor=$_,s.UniformMatrix2f=class extends Zo{constructor(i){super(i),this.current=C1}set(i,e,t){if(this.fetchUniformLocation(i,e)){for(let r=0;r<4;r++)if(t[r]!==this.current[r]){this.current=t,this.gl.uniformMatrix2fv(this.location,!1,t);break}}}},s.UniformMatrix3f=class extends Zo{constructor(i){super(i),this.current=S1}set(i,e,t){if(this.fetchUniformLocation(i,e)){for(let r=0;r<9;r++)if(t[r]!==this.current[r]){this.current=t,this.gl.uniformMatrix3fv(this.location,!1,t);break}}}},s.UniformMatrix4f=class extends Zo{constructor(i){super(i),this.current=E1}set(i,e,t){if(this.fetchUniformLocation(i,e)){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let r=1;r<16;r++)if(t[r]!==this.current[r]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}}},s.UnwrappedTileID=Bg,s.ValidationError=Et,s.VectorTileWorkerSource=class extends Ft{constructor(i,e,t,r,l){super(),this.actor=i,this.layerIndex=e,this.availableImages=t,this.loadVectorData=l||Ky,this.loading={},this.loaded={},this.deduped=new Hy(i.scheduler),this.isSpriteLoaded=r,this.scheduler=i.scheduler}loadTile(i,e){const t=i.uid,r=i&&i.request,l=r&&r.collectResourceTiming,u=this.loading[t]=new $w(i);u.abort=this.loadVectorData(i,(d,p)=>{const y=!this.loading[t];if(delete this.loading[t],y||d||!p)return u.status="done",y||(this.loaded[t]=u),e(d);const x=p.rawData,E={};p.expires&&(E.expires=p.expires),p.cacheControl&&(E.cacheControl=p.cacheControl),u.vectorTile=p.vectorTile||new La.VectorTile(new Du(x));const C=()=>{u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,(M,P)=>{if(M||!P)return e(M);const D={};if(l){const O=fe(r);O.length>0&&(D.resourceTiming=JSON.parse(JSON.stringify(O)))}e(null,Fe({rawTileData:x.slice(0)},P,E,D))})};this.isSpriteLoaded?C():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(C,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):C()}),this.loaded=this.loaded||{},this.loaded[t]=u})}reloadTile(i,e){const t=this.loaded,r=i.uid,l=this;if(t&&t[r]){const u=t[r];u.showCollisionBoxes=i.showCollisionBoxes,u.enableTerrain=!!i.enableTerrain,u.projection=i.projection,u.tileTransform=Ra(i.tileID.canonical,i.projection);const d=(p,y)=>{const x=u.reloadCallback;x&&(delete u.reloadCallback,u.parse(u.vectorTile,l.layerIndex,this.availableImages,l.actor,x)),e(p,y)};u.status==="parsing"?u.reloadCallback=d:u.status==="done"&&(u.vectorTile?u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,d):d())}}abortTile(i,e){const t=i.uid,r=this.loading[t];r&&(r.abort&&r.abort(),delete this.loading[t]),e()}removeTile(i,e){const t=this.loaded,r=i.uid;t&&t[r]&&delete t[r],e()}},s.WritingMode=Ir,s.ZoomHistory=Wh,s.add=ks,s.addDynamicAttributes=Vd,s.adjoint=function(i,e){var t=e[0],r=e[1],l=e[2],u=e[3],d=e[4],p=e[5],y=e[6],x=e[7],E=e[8];return i[0]=d*E-p*x,i[1]=l*x-r*E,i[2]=r*p-l*d,i[3]=p*y-u*E,i[4]=t*E-l*y,i[5]=l*u-t*p,i[6]=u*x-d*y,i[7]=r*y-t*x,i[8]=t*d-r*u,i},s.asyncAll=ze,s.bezier=Je,s.bindAll=Wt,s.boundsAttributes=Ly,s.bufferConvexPolygon=function(i,e){const t=[];for(let r=0;r<i.length;r++){const l=be(r-1,-1,i.length-1),u=be(r+1,-1,i.length-1),d=i[r],p=i[u],y=i[l].sub(d).unit(),x=p.sub(d).unit(),E=x.angleWithSep(y.x,y.y),C=y.add(x).unit().mult(-1*e/Math.sin(E/2));t.push(d.add(C))}return t},s.cacheEntryPossiblyAdded=function(i){ie++,ie>el&&(i.getActor().send("enforceCacheSizeLimit",us),ie=0)},s.calculateGlobeLabelMatrix=function(i,e){const{x:t,y:r}=i.point,l=by(t,r,i.worldSize/i._pixelsPerMercatorPixel,0,0);return Ol(l,l,Gp(Eo(e)))},s.calculateGlobeMatrix=function(i){const{x:e,y:t}=i.point,{lng:r,lat:l}=i._center;return by(e,t,i.worldSize,r,l)},s.calculateGlobeMercatorMatrix=function(i){const e=i.pixelsPerMeter,t=e/Dr(1,i.center.lat),r=wo(new Float64Array(16));return vu(r,r,[i.point.x,i.point.y,0]),ka(r,r,[t,t,e]),Float32Array.from(r)},s.circumferenceAtLatitude=sp,s.clamp=Ie,s.clearTileCache=function(i){const e=Y(),t=[];for(const r in Gn)e&&t.push(e.delete(r)),delete Gn[r];i&&Promise.all(t).catch(i).then(()=>i())},s.clipLine=ay,s.clone=function(i){var e=new mr(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},s.clone$1=xt,s.collisionCircleLayout=Fb,s.config=Ye,s.conjugate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i},s.create=function(){var i=new mr(16);return mr!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},s.create$1=ng,s.createExpression=bs,s.createLayout=qe,s.createStyleLayer=function(i){return i.type==="custom"?new Lw(i):new Bw[i.type](i)},s.cross=xp,s.degToRad=Te,s.distance=function(i,e){return Math.hypot(e[0]-i[0],e[1]-i[1],e[2]-i[2])},s.div=function(i,e,t){return i[0]=e[0]/t[0],i[1]=e[1]/t[1],i[2]=e[2]/t[2],i},s.dot=Rr,s.ease=ct,s.easeCubicInOut=Se,s.emitValidationErrors=lu,s.endsWith=tt,s.enforceCacheSizeLimit=function(i){for(const e in Gn)L(e),Gn[e].then(t=>{t.keys().then(r=>{for(let l=0;l<r.length-i;l++)t.delete(r[l])})})},s.evaluateSizeForFeature=Cd,s.evaluateSizeForZoom=jl,s.evaluateVariableOffset=dy,s.evented=R,s.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]},s.exactEquals$1=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]},s.exported=Ct,s.exported$1=ht,s.extend=Fe,s.extend$1=rr,s.fillExtrusionHeightLift=Dg,s.filterObject=Li,s.fromMat4=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],i},s.fromQuat=function(i,e){var t=e[0],r=e[1],l=e[2],u=e[3],d=t+t,p=r+r,y=l+l,x=t*d,E=r*d,C=r*p,M=l*d,P=l*p,D=l*y,O=u*d,V=u*p,K=u*y;return i[0]=1-C-D,i[1]=E+K,i[2]=M-V,i[3]=0,i[4]=E-K,i[5]=1-x-D,i[6]=P+O,i[7]=0,i[8]=M+V,i[9]=P-O,i[10]=1-x-C,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},s.fromRotation=function(i,e){var t=Math.sin(e),r=Math.cos(e);return i[0]=r,i[1]=t,i[2]=0,i[3]=-t,i[4]=r,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},s.fromScaling=rg,s.furthestTileCorner=function(i){const e=Math.round((i+45+360)%360/90)%4;return ot[e]},s.getAABBPointSquareDist=function(i,e,t){let r=0;for(let l=0;l<2;++l){const u=t?t[l]:0;i[l]>u&&(r+=(i[l]-u)*(i[l]-u)),e[l]<u&&(r+=(u-e[l])*(u-e[l]))}return r},s.getAnchorAlignment=Fp,s.getAnchorJustification=Vp,s.getBounds=function(i){let e=1/0,t=1/0,r=-1/0,l=-1/0;for(const u of i)e=Math.min(e,u.x),t=Math.min(t,u.y),r=Math.max(r,u.x),l=Math.max(l,u.y);return{min:new G(e,t),max:new G(r,l)}},s.getColumn=nr,s.getGridMatrix=function(i,e,t){const r=e.getNorth(),l=e.getSouth(),u=e.getWest(),d=.015625;return[0,(e.getEast()-u)*d,1<<i.z,(l-r)/Xl[t],0,i.y,r,u,d]},s.getImage=jt,s.getJSON=function(i,e){return pe(Fe(i,{type:"json"}),e)},s.getLatitudinalLod=function(i){const e=80.051129;i=Ie(i,-80.051129,e)/e*90;const t=Math.pow(Math.abs(Math.sin(Te(i))),3);return Math.round(t*(Xl.length-1))},s.getMapSessionAPI=vc,s.getPerformanceMeasurement=fe,s.getProjection=Iy,s.getRTLTextPluginStatus=U,s.getReferrer=ge,s.getTilePoint=function(i,{x:e,y:t},r=0){return new G(((e-r)*i.scale-i.x)*$t,(t*i.scale-i.y)*$t)},s.getTileVec3=function(i,e,t=0){return Ul(((e.x-t)*i.scale-i.x)*$t,(e.y*i.scale-i.y)*$t,Z_(e.z,e.y))},s.getVideo=function(i,e){const t=B.document.createElement("video");t.muted=!0,t.onloadstart=function(){e(null,t)};for(let r=0;r<i.length;r++){const l=B.document.createElement("source");et(i[r])||(t.crossOrigin="Anonymous"),l.src=i[r],t.appendChild(l)}return{cancel:()=>{}}},s.globeCenterToScreenPoint=function(i){const e=[0,0,0],t=wo(new Float64Array(16));return Ol(t,i.pixelMatrix,i.globeMatrix),un(e,e,t),new G(e[0],e[1])},s.globeDenormalizeECEF=Gp,s.globeECEFOrigin=function(i,e){const t=[0,0,0];return un(t,t,Ou(Eo(e.canonical))),un(t,t,i),t},s.globeNormalizeECEF=Ou,s.globePixelsToTileUnits=function(i,e){return $t/(512*Math.pow(2,i))*Rd(Eo(e))},s.globePoleMatrixForTile=function(i,e,t){const r=wo(new Float64Array(16)),l=(e/(1<<i)-.5)*Math.PI*2;return pd(r,t.globeMatrix,l),Float32Array.from(r)},s.globeTileBounds=Eo,s.globeTiltAtLngLat=wy,s.globeToMercatorTransition=Uu,s.globeUseCustomAntiAliasing=function(i,e,t){const r=Uu(t.zoom),l=i.style.map._antialias,u=!!e.extStandardDerivatives,d=e.extStandardDerivativesForceOff||i.terrain&&i.terrain.exaggeration()>0;return r===0&&!l&&!d&&u},s.identity=wo,s.identity$1=hg,s.invert=fp,s.isFullscreen=function(){return!!B.document.fullscreenElement||!!B.document.webkitFullscreenElement},s.isLngLatBehindGlobe=function(i,e){return wy(i,e)>Math.PI/2*1.01},s.isMapAuthenticated=function(i){return co.has(i)},s.isMapboxURL=Ci,s.isSafariWithAntialiasingBug=function(i){const e=i.navigator?i.navigator.userAgent:null;return!!jr(i)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.latFromMercatorY=An,s.len=$1,s.length=bu,s.length$1=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},s.loadVectorTile=Ky,s.makeRequest=pe,s.mapValue=function(i,e,t,r,l){return Ie((i-e)/(t-e)*(l-r)+r,r,l)},s.mercatorScale=W_,s.mercatorXfromLng=vo,s.mercatorYfromLat=Xo,s.mercatorZfromAltitude=Dr,s.mul=N1,s.mul$1=j1,s.multiply=Ol,s.multiply$1=function(i,e,t){var r=e[0],l=e[1],u=e[2],d=e[3],p=e[4],y=e[5],x=e[6],E=e[7],C=e[8],M=t[0],P=t[1],D=t[2],O=t[3],V=t[4],K=t[5],oe=t[6],Q=t[7],ne=t[8];return i[0]=M*r+P*d+D*x,i[1]=M*l+P*p+D*E,i[2]=M*u+P*y+D*C,i[3]=O*r+V*d+K*x,i[4]=O*l+V*p+K*E,i[5]=O*u+V*y+K*C,i[6]=oe*r+Q*d+ne*x,i[7]=oe*l+Q*p+ne*E,i[8]=oe*u+Q*y+ne*C,i},s.multiply$2=ag,s.nextPowerOfTwo=Ke,s.normalize=Xn,s.normalize$1=function(i,e){var t=e[0],r=e[1],l=e[2],u=e[3],d=t*t+r*r+l*l+u*u;return d>0&&(d=1/Math.sqrt(d)),i[0]=t*d,i[1]=r*d,i[2]=l*d,i[3]=u*d,i},s.number=fi,s.ortho=function(i,e,t,r,l,u,d){var p=1/(e-t),y=1/(r-l),x=1/(u-d);return i[0]=-2*p,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*x,i[11]=0,i[12]=(e+t)*p,i[13]=(l+r)*y,i[14]=(d+u)*x,i[15]=1,i},s.pbf=Du,s.perspective=function(i,e,t,r,l){var u,d=1/Math.tan(e/2);return i[0]=d/t,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=d,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,l!=null&&l!==1/0?(i[10]=(l+r)*(u=1/(r-l)),i[14]=2*l*r*u):(i[10]=-1,i[14]=-2*r),i},s.pick=function(i,e){const t={};for(let r=0;r<e.length;r++){const l=e[r];l in i&&(t[l]=i[l])}return t},s.plugin=j,s.pointGeometry=G,s.polygonContainsPoint=za,s.polygonIntersectsBox=eg,s.polygonIntersectsPolygon=K_,s.polygonizeBounds=function(i,e,t=0,r=!0){const l=new G(t,t),u=i.sub(l),d=e.add(l),p=[u,new G(d.x,u.y),d,new G(u.x,d.y)];return r&&p.push(u.clone()),p},s.posAttributes=Bu,s.postMapLoadEvent=Ja,s.postTurnstileEvent=lo,s.potpack=Dp,s.prevPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},s.radToDeg=Be,s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.registerForPluginStateChange=function(i){return i({pluginStatus:T,pluginURL:S}),R.on("pluginStateChange",i),i},s.removeAuthState=function(i){co.delete(i)},s.renderColorRamp=Ep,s.resample=X_,s.rotateX=pp,s.rotateX$1=dg,s.rotateY=pd,s.rotateY$1=fg,s.rotateZ=function(i,e,t){var r=Math.sin(t),l=Math.cos(t),u=e[0],d=e[1],p=e[2],y=e[3],x=e[4],E=e[5],C=e[6],M=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=u*l+x*r,i[1]=d*l+E*r,i[2]=p*l+C*r,i[3]=y*l+M*r,i[4]=x*l-u*r,i[5]=E*l-d*r,i[6]=C*l-p*r,i[7]=M*l-y*r,i},s.rotateZ$1=function(i,e,t){t*=.5;var r=e[0],l=e[1],u=e[2],d=e[3],p=Math.sin(t),y=Math.cos(t);return i[0]=r*y+l*p,i[1]=l*y-r*p,i[2]=u*y+d*p,i[3]=d*y-u*p,i},s.scale=ka,s.scale$1=cg,s.scale$2=Kr,s.scaleAndAdd=md,s.setCacheLimits=function(i,e){us=i,el=e},s.setColumn=function(i,e,t){i[4*e+0]=t[0],i[4*e+1]=t[1],i[4*e+2]=t[2],i[4*e+3]=t[3]},s.setRTLTextPlugin=function(i,e,t=!1){if(T===h||T===m||T===_)throw new Error("setRTLTextPlugin cannot be called multiple times.");S=Ct.resolveURL(i),T=h,b=e,k(),t||W()},s.smoothstep=Pe,s.spec=Re,s.storeAuthState=function(i,e){e?co.add(i):co.delete(i)},s.sub=Yr,s.subtract=_p,s.symbolSize=Ob,s.tileAABB=function(i,e,t,r,l,u,d,p,y){if(y.name==="globe")return gw(i,e,new Td(t,r,l));const x=Ra({z:t,x:r,y:l},y);return new ar([(u+x.x/x.scale)*e,e*(x.y/x.scale),d],[(u+x.x2/x.scale)*e,e*(x.y2/x.scale),p])},s.tileCornersToBounds=Dd,s.tileTransform=Ra,s.transformMat3=function(i,e,t){var r=e[0],l=e[1],u=e[2];return i[0]=r*t[0]+l*t[3]+u*t[6],i[1]=r*t[1]+l*t[4]+u*t[7],i[2]=r*t[2]+l*t[5]+u*t[8],i},s.transformMat4=un,s.transformMat4$1=Pa,s.transformQuat=lg,s.transitionTileAABBinECEF=yy,s.translate=vu,s.transpose=function(i,e){if(i===e){var t=e[1],r=e[2],l=e[5];i[1]=e[3],i[2]=e[6],i[3]=t,i[5]=e[7],i[6]=r,i[7]=l}else i[0]=e[0],i[1]=e[3],i[2]=e[6],i[3]=e[1],i[4]=e[4],i[5]=e[7],i[6]=e[2],i[7]=e[5],i[8]=e[8];return i},s.triggerPluginCompletionEvent=I,s.uniqueId=ft,s.updateGlobeVertexNormal=function(i,e,t,r,l){const u=5*e+2;i.float32[u+0]=t,i.float32[u+1]=r,i.float32[u+2]=l},s.validateCustomStyleLayer=function(i){const e=[],t=i.id;return t===void 0&&e.push({message:`layers.${t}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${t}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${t}: property "renderingMode" must be either "2d" or "3d"`}),e},s.validateFilter=i=>Zr(Es(i)),s.validateFog=i=>Zr($h(i)),s.validateLayer=i=>Zr(Sl(i)),s.validateLight=i=>Zr(jh(i)),s.validateSource=i=>Zr(Nh(i)),s.validateStyle=Ml,s.validateTerrain=i=>Zr(Al(i)),s.values=Qe,s.vectorTile=La,s.version=ye,s.warnOnce=Jt,s.window=B,s.wrap=be}),A(["./shared"],function(s){function B(Y){if(typeof Y=="number"||typeof Y=="boolean"||typeof Y=="string"||Y==null)return JSON.stringify(Y);if(Array.isArray(Y)){let F="[";for(const H of Y)F+=`${B(H)},`;return`${F}]`}let L="{";for(const F of Object.keys(Y).sort())L+=`${F}:${B(Y[F])},`;return`${L}}`}function Z(Y){let L="";for(const F of s.refProperties)L+=`/${B(Y[F])}`;return L}class ee{constructor(L){this.keyCache={},L&&this.replace(L)}replace(L){this._layerConfigs={},this._layers={},this.update(L,[])}update(L,F){for(const ie of L)this._layerConfigs[ie.id]=ie,(this._layers[ie.id]=s.createStyleLayer(ie)).compileFilter(),this.keyCache[ie.id]&&delete this.keyCache[ie.id];for(const ie of F)delete this.keyCache[ie],delete this._layerConfigs[ie],delete this._layers[ie];this.familiesBySource={};const H=function(ie,de){const ve={};for(let pe=0;pe<ie.length;pe++){const we=de&&de[ie[pe].id]||Z(ie[pe]);de&&(de[ie[pe].id]=we);let We=ve[we];We||(We=ve[we]=[]),We.push(ie[pe])}const ge=[];for(const pe in ve)ge.push(ve[pe]);return ge}(s.values(this._layerConfigs),this.keyCache);for(const ie of H){const de=ie.map(wt=>this._layers[wt.id]),ve=de[0];if(ve.visibility==="none")continue;const ge=ve.source||"";let pe=this.familiesBySource[ge];pe||(pe=this.familiesBySource[ge]={});const we=ve.sourceLayer||"_geojsonTileLayer";let We=pe[we];We||(We=pe[we]=[]),We.push(de)}}}class G{loadTile(L,F){const{uid:H,encoding:ie,rawImageData:de,padding:ve,buildQuadTree:ge}=L,pe=s.window.ImageBitmap&&de instanceof s.window.ImageBitmap?this.getImageData(de,ve):de;F(null,new s.DEMData(H,pe,ie,ve<1,ge))}getImageData(L,F){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(L.width,L.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=L.width,this.offscreenCanvas.height=L.height,this.offscreenCanvasContext.drawImage(L,0,0,L.width,L.height);const H=this.offscreenCanvasContext.getImageData(-F,-F,L.width+2*F,L.height+2*F);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),H}}var te=function Y(L,F){var H,ie=L&&L.type;if(ie==="FeatureCollection")for(H=0;H<L.features.length;H++)Y(L.features[H],F);else if(ie==="GeometryCollection")for(H=0;H<L.geometries.length;H++)Y(L.geometries[H],F);else if(ie==="Feature")Y(L.geometry,F);else if(ie==="Polygon")_e(L.coordinates,F);else if(ie==="MultiPolygon")for(H=0;H<L.coordinates.length;H++)_e(L.coordinates[H],F);return L};function _e(Y,L){if(Y.length!==0){Ee(Y[0],L);for(var F=1;F<Y.length;F++)Ee(Y[F],!L)}}function Ee(Y,L){for(var F=0,H=0,ie=0,de=Y.length,ve=de-1;ie<de;ve=ie++){var ge=(Y[ie][0]-Y[ve][0])*(Y[ve][1]+Y[ie][1]),pe=F+ge;H+=Math.abs(F)>=Math.abs(ge)?F-pe+ge:ge-pe+F,F=pe}F+H>=0!=!!L&&Y.reverse()}const Te=s.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Be{constructor(L){this._feature=L,this.extent=s.EXTENT,this.type=L.type,this.properties=L.tags,"id"in L&&!isNaN(L.id)&&(this.id=parseInt(L.id,10))}loadGeometry(){if(this._feature.type===1){const L=[];for(const F of this._feature.geometry)L.push([new s.pointGeometry(F[0],F[1])]);return L}{const L=[];for(const F of this._feature.geometry){const H=[];for(const ie of F)H.push(new s.pointGeometry(ie[0],ie[1]));L.push(H)}return L}}toGeoJSON(L,F,H){return Te.call(this,L,F,H)}}class ot{constructor(L){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=L.length,this._features=L}feature(L){return new Be(this._features[L])}}var Se=s.vectorTile.VectorTileFeature,Je=ct;function ct(Y,L){this.options=L||{},this.features=Y,this.length=Y.length}function Ie(Y,L){this.id=typeof Y.id=="number"?Y.id:void 0,this.type=Y.type,this.rawGeometry=Y.type===1?[Y.geometry]:Y.geometry,this.properties=Y.tags,this.extent=L||4096}ct.prototype.feature=function(Y){return new Ie(this.features[Y],this.options.extent)},Ie.prototype.loadGeometry=function(){var Y=this.rawGeometry;this.geometry=[];for(var L=0;L<Y.length;L++){for(var F=Y[L],H=[],ie=0;ie<F.length;ie++)H.push(new s.pointGeometry(F[ie][0],F[ie][1]));this.geometry.push(H)}return this.geometry},Ie.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Y=this.geometry,L=1/0,F=-1/0,H=1/0,ie=-1/0,de=0;de<Y.length;de++)for(var ve=Y[de],ge=0;ge<ve.length;ge++){var pe=ve[ge];L=Math.min(L,pe.x),F=Math.max(F,pe.x),H=Math.min(H,pe.y),ie=Math.max(ie,pe.y)}return[L,H,F,ie]},Ie.prototype.toGeoJSON=Se.prototype.toGeoJSON;var Pe=ze,be=Je;function ze(Y){var L=new s.pbf;return function(F,H){for(var ie in F.layers)H.writeMessage(3,Qe,F.layers[ie])}(Y,L),L.finish()}function Qe(Y,L){var F;L.writeVarintField(15,Y.version||1),L.writeStringField(1,Y.name||""),L.writeVarintField(5,Y.extent||4096);var H={keys:[],values:[],keycache:{},valuecache:{}};for(F=0;F<Y.length;F++)H.feature=Y.feature(F),L.writeMessage(2,Fe,H);var ie=H.keys;for(F=0;F<ie.length;F++)L.writeStringField(3,ie[F]);var de=H.values;for(F=0;F<de.length;F++)L.writeMessage(4,Bt,de[F])}function Fe(Y,L){var F=Y.feature;F.id!==void 0&&L.writeVarintField(1,F.id),L.writeMessage(2,dt,Y),L.writeVarintField(3,F.type),L.writeMessage(4,Ke,F)}function dt(Y,L){var F=Y.feature,H=Y.keys,ie=Y.values,de=Y.keycache,ve=Y.valuecache;for(var ge in F.properties){var pe=F.properties[ge],we=de[ge];if(pe!==null){we===void 0&&(H.push(ge),de[ge]=we=H.length-1),L.writeVarint(we);var We=typeof pe;We!=="string"&&We!=="boolean"&&We!=="number"&&(pe=JSON.stringify(pe));var wt=We+":"+pe,et=ve[wt];et===void 0&&(ie.push(pe),ve[wt]=et=ie.length-1),L.writeVarint(et)}}}function ft(Y,L){return(L<<3)+(7&Y)}function Ze(Y){return Y<<1^Y>>31}function Ke(Y,L){for(var F=Y.loadGeometry(),H=Y.type,ie=0,de=0,ve=F.length,ge=0;ge<ve;ge++){var pe=F[ge],we=1;H===1&&(we=pe.length),L.writeVarint(ft(1,we));for(var We=H===3?pe.length-1:pe.length,wt=0;wt<We;wt++){wt===1&&H!==1&&L.writeVarint(ft(2,We-1));var et=pe[wt].x-ie,Ut=pe[wt].y-de;L.writeVarint(Ze(et)),L.writeVarint(Ze(Ut)),ie+=et,de+=Ut}H===3&&L.writeVarint(ft(7,1))}}function Bt(Y,L){var F=typeof Y;F==="string"?L.writeStringField(1,Y):F==="boolean"?L.writeBooleanField(7,Y):F==="number"&&(Y%1!=0?L.writeDoubleField(3,Y):Y<0?L.writeSVarintField(6,Y):L.writeVarintField(5,Y))}function Wt(Y,L,F,H,ie,de){if(ie-H<=F)return;const ve=H+ie>>1;tt(Y,L,ve,H,ie,de%2),Wt(Y,L,F,H,ve-1,de+1),Wt(Y,L,F,ve+1,ie,de+1)}function tt(Y,L,F,H,ie,de){for(;ie>H;){if(ie-H>600){const we=ie-H+1,We=F-H+1,wt=Math.log(we),et=.5*Math.exp(2*wt/3),Ut=.5*Math.sqrt(wt*et*(we-et)/we)*(We-we/2<0?-1:1);tt(Y,L,F,Math.max(H,Math.floor(F-We*et/we+Ut)),Math.min(ie,Math.floor(F+(we-We)*et/we+Ut)),de)}const ve=L[2*F+de];let ge=H,pe=ie;for(Mt(Y,L,H,F),L[2*ie+de]>ve&&Mt(Y,L,H,ie);ge<pe;){for(Mt(Y,L,ge,pe),ge++,pe--;L[2*ge+de]<ve;)ge++;for(;L[2*pe+de]>ve;)pe--}L[2*H+de]===ve?Mt(Y,L,H,pe):(pe++,Mt(Y,L,pe,ie)),pe<=F&&(H=pe+1),F<=pe&&(ie=pe-1)}}function Mt(Y,L,F,H){Li(Y,F,H),Li(L,2*F,2*H),Li(L,2*F+1,2*H+1)}function Li(Y,L,F){const H=Y[L];Y[L]=Y[F],Y[F]=H}function xt(Y,L,F,H){const ie=Y-F,de=L-H;return ie*ie+de*de}Pe.fromVectorTileJs=ze,Pe.fromGeojsonVt=function(Y,L){L=L||{};var F={};for(var H in Y)F[H]=new Je(Y[H].features,L),F[H].name=H,F[H].version=L.version,F[H].extent=L.extent;return ze({layers:F})},Pe.GeoJSONWrapper=be;const bi=Y=>Y[0],Jt=Y=>Y[1];class _i{constructor(L,F=bi,H=Jt,ie=64,de=Float64Array){this.nodeSize=ie,this.points=L;const ve=L.length<65536?Uint16Array:Uint32Array,ge=this.ids=new ve(L.length),pe=this.coords=new de(2*L.length);for(let we=0;we<L.length;we++)ge[we]=we,pe[2*we]=F(L[we]),pe[2*we+1]=H(L[we]);Wt(ge,pe,ie,0,ge.length-1,0)}range(L,F,H,ie){return function(de,ve,ge,pe,we,We,wt){const et=[0,de.length-1,0],Ut=[];let Nt,Pt;for(;et.length;){const jt=et.pop(),ei=et.pop(),Ti=et.pop();if(ei-Ti<=wt){for(let Ft=Ti;Ft<=ei;Ft++)Nt=ve[2*Ft],Pt=ve[2*Ft+1],Nt>=ge&&Nt<=we&&Pt>=pe&&Pt<=We&&Ut.push(de[Ft]);continue}const zi=Math.floor((Ti+ei)/2);Nt=ve[2*zi],Pt=ve[2*zi+1],Nt>=ge&&Nt<=we&&Pt>=pe&&Pt<=We&&Ut.push(de[zi]);const Ei=(jt+1)%2;(jt===0?ge<=Nt:pe<=Pt)&&(et.push(Ti),et.push(zi-1),et.push(Ei)),(jt===0?we>=Nt:We>=Pt)&&(et.push(zi+1),et.push(ei),et.push(Ei))}return Ut}(this.ids,this.coords,L,F,H,ie,this.nodeSize)}within(L,F,H){return function(ie,de,ve,ge,pe,we){const We=[0,ie.length-1,0],wt=[],et=pe*pe;for(;We.length;){const Ut=We.pop(),Nt=We.pop(),Pt=We.pop();if(Nt-Pt<=we){for(let Ei=Pt;Ei<=Nt;Ei++)xt(de[2*Ei],de[2*Ei+1],ve,ge)<=et&&wt.push(ie[Ei]);continue}const jt=Math.floor((Pt+Nt)/2),ei=de[2*jt],Ti=de[2*jt+1];xt(ei,Ti,ve,ge)<=et&&wt.push(ie[jt]);const zi=(Ut+1)%2;(Ut===0?ve-pe<=ei:ge-pe<=Ti)&&(We.push(Pt),We.push(jt-1),We.push(zi)),(Ut===0?ve+pe>=ei:ge+pe>=Ti)&&(We.push(jt+1),We.push(Nt),We.push(zi))}return wt}(this.ids,this.coords,L,F,H,this.nodeSize)}}const kn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Y=>Y},Pn=Math.fround||(an=new Float32Array(1),Y=>(an[0]=+Y,an[0]));var an;class qn{constructor(L){this.options=it(Object.create(kn),L),this.trees=new Array(this.options.maxZoom+1)}load(L){const{log:F,minZoom:H,maxZoom:ie,nodeSize:de}=this.options;F&&console.time("total time");const ve=`prepare ${L.length} points`;F&&console.time(ve),this.points=L;let ge=[];for(let pe=0;pe<L.length;pe++)L[pe].geometry&&ge.push(hr(L[pe],pe));this.trees[ie+1]=new _i(ge,nt,gt,de,Float32Array),F&&console.timeEnd(ve);for(let pe=ie;pe>=H;pe--){const we=+Date.now();ge=this._cluster(ge,pe),this.trees[pe]=new _i(ge,nt,gt,de,Float32Array),F&&console.log("z%d: %d clusters in %dms",pe,ge.length,+Date.now()-we)}return F&&console.timeEnd("total time"),this}getClusters(L,F){let H=((L[0]+180)%360+360)%360-180;const ie=Math.max(-90,Math.min(90,L[1]));let de=L[2]===180?180:((L[2]+180)%360+360)%360-180;const ve=Math.max(-90,Math.min(90,L[3]));if(L[2]-L[0]>=360)H=-180,de=180;else if(H>de){const We=this.getClusters([H,ie,180,ve],F),wt=this.getClusters([-180,ie,de,ve],F);return We.concat(wt)}const ge=this.trees[this._limitZoom(F)],pe=ge.range(fe(H),ye(ve),fe(de),ye(ie)),we=[];for(const We of pe){const wt=ge.points[We];we.push(wt.numPoints?nr(wt):this.points[wt.index])}return we}getChildren(L){const F=this._getOriginId(L),H=this._getOriginZoom(L),ie="No cluster with the specified id.",de=this.trees[H];if(!de)throw new Error(ie);const ve=de.points[F];if(!ve)throw new Error(ie);const ge=this.options.radius/(this.options.extent*Math.pow(2,H-1)),pe=de.within(ve.x,ve.y,ge),we=[];for(const We of pe){const wt=de.points[We];wt.parentId===L&&we.push(wt.numPoints?nr(wt):this.points[wt.index])}if(we.length===0)throw new Error(ie);return we}getLeaves(L,F,H){const ie=[];return this._appendLeaves(ie,L,F=F||10,H=H||0,0),ie}getTile(L,F,H){const ie=this.trees[this._limitZoom(L)],de=Math.pow(2,L),{extent:ve,radius:ge}=this.options,pe=ge/ve,we=(H-pe)/de,We=(H+1+pe)/de,wt={features:[]};return this._addTileFeatures(ie.range((F-pe)/de,we,(F+1+pe)/de,We),ie.points,F,H,de,wt),F===0&&this._addTileFeatures(ie.range(1-pe/de,we,1,We),ie.points,de,H,de,wt),F===de-1&&this._addTileFeatures(ie.range(0,we,pe/de,We),ie.points,-1,H,de,wt),wt.features.length?wt:null}getClusterExpansionZoom(L){let F=this._getOriginZoom(L)-1;for(;F<=this.options.maxZoom;){const H=this.getChildren(L);if(F++,H.length!==1)break;L=H[0].properties.cluster_id}return F}_appendLeaves(L,F,H,ie,de){const ve=this.getChildren(F);for(const ge of ve){const pe=ge.properties;if(pe&&pe.cluster?de+pe.point_count<=ie?de+=pe.point_count:de=this._appendLeaves(L,pe.cluster_id,H,ie,de):de<ie?de++:L.push(ge),L.length===H)break}return de}_addTileFeatures(L,F,H,ie,de,ve){for(const ge of L){const pe=F[ge],we=pe.numPoints;let We,wt,et;if(we)We=ao(pe),wt=pe.x,et=pe.y;else{const Pt=this.points[pe.index];We=Pt.properties,wt=fe(Pt.geometry.coordinates[0]),et=ye(Pt.geometry.coordinates[1])}const Ut={type:1,geometry:[[Math.round(this.options.extent*(wt*de-H)),Math.round(this.options.extent*(et*de-ie))]],tags:We};let Nt;we?Nt=pe.id:this.options.generateId?Nt=pe.index:this.points[pe.index].id&&(Nt=this.points[pe.index].id),Nt!==void 0&&(Ut.id=Nt),ve.features.push(Ut)}}_limitZoom(L){return Math.max(this.options.minZoom,Math.min(+L,this.options.maxZoom+1))}_cluster(L,F){const H=[],{radius:ie,extent:de,reduce:ve,minPoints:ge}=this.options,pe=ie/(de*Math.pow(2,F));for(let we=0;we<L.length;we++){const We=L[we];if(We.zoom<=F)continue;We.zoom=F;const wt=this.trees[F+1],et=wt.within(We.x,We.y,pe),Ut=We.numPoints||1;let Nt=Ut;for(const Pt of et){const jt=wt.points[Pt];jt.zoom>F&&(Nt+=jt.numPoints||1)}if(Nt>Ut&&Nt>=ge){let Pt=We.x*Ut,jt=We.y*Ut,ei=ve&&Ut>1?this._map(We,!0):null;const Ti=(we<<5)+(F+1)+this.points.length;for(const zi of et){const Ei=wt.points[zi];if(Ei.zoom<=F)continue;Ei.zoom=F;const Ft=Ei.numPoints||1;Pt+=Ei.x*Ft,jt+=Ei.y*Ft,Ei.parentId=Ti,ve&&(ei||(ei=this._map(We,!0)),ve(ei,this._map(Ei)))}We.parentId=Ti,H.push(jr(Pt/Nt,jt/Nt,Ti,Nt,ei))}else if(H.push(We),Nt>1)for(const Pt of et){const jt=wt.points[Pt];jt.zoom<=F||(jt.zoom=F,H.push(jt))}}return H}_getOriginId(L){return L-this.points.length>>5}_getOriginZoom(L){return(L-this.points.length)%32}_map(L,F){if(L.numPoints)return F?it({},L.properties):L.properties;const H=this.points[L.index].properties,ie=this.options.map(H);return F&&ie===H?it({},ie):ie}}function jr(Y,L,F,H,ie){return{x:Pn(Y),y:Pn(L),zoom:1/0,id:F,parentId:-1,numPoints:H,properties:ie}}function hr(Y,L){const[F,H]=Y.geometry.coordinates;return{x:Pn(fe(F)),y:Pn(ye(H)),zoom:1/0,index:L,parentId:-1}}function nr(Y){return{type:"Feature",id:Y.id,properties:ao(Y),geometry:{type:"Point",coordinates:[(L=Y.x,360*(L-.5)),Me(Y.y)]}};var L}function ao(Y){const L=Y.numPoints,F=L>=1e4?`${Math.round(L/1e3)}k`:L>=1e3?Math.round(L/100)/10+"k":L;return it(it({},Y.properties),{cluster:!0,cluster_id:Y.id,point_count:L,point_count_abbreviated:F})}function fe(Y){return Y/360+.5}function ye(Y){const L=Math.sin(Y*Math.PI/180),F=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return F<0?0:F>1?1:F}function Me(Y){const L=(180-360*Y)*Math.PI/180;return 360*Math.atan(Math.exp(L))/Math.PI-90}function it(Y,L){for(const F in L)Y[F]=L[F];return Y}function nt(Y){return Y.x}function gt(Y){return Y.y}function Ct(Y,L,F,H){for(var ie,de=H,ve=F-L>>1,ge=F-L,pe=Y[L],we=Y[L+1],We=Y[F],wt=Y[F+1],et=L+3;et<F;et+=3){var Ut=yt(Y[et],Y[et+1],pe,we,We,wt);if(Ut>de)ie=et,de=Ut;else if(Ut===de){var Nt=Math.abs(et-ve);Nt<ge&&(ie=et,ge=Nt)}}de>H&&(ie-L>3&&Ct(Y,L,ie,H),Y[ie+2]=de,F-ie>3&&Ct(Y,ie,F,H))}function yt(Y,L,F,H,ie,de){var ve=ie-F,ge=de-H;if(ve!==0||ge!==0){var pe=((Y-F)*ve+(L-H)*ge)/(ve*ve+ge*ge);pe>1?(F=ie,H=de):pe>0&&(F+=ve*pe,H+=ge*pe)}return(ve=Y-F)*ve+(ge=L-H)*ge}function Ye(Y,L,F,H){var ie={id:Y===void 0?null:Y,type:L,geometry:F,tags:H,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(de){var ve=de.geometry,ge=de.type;if(ge==="Point"||ge==="MultiPoint"||ge==="LineString")ht(de,ve);else if(ge==="Polygon"||ge==="MultiLineString")for(var pe=0;pe<ve.length;pe++)ht(de,ve[pe]);else if(ge==="MultiPolygon")for(pe=0;pe<ve.length;pe++)for(var we=0;we<ve[pe].length;we++)ht(de,ve[pe][we])}(ie),ie}function ht(Y,L){for(var F=0;F<L.length;F+=3)Y.minX=Math.min(Y.minX,L[F]),Y.minY=Math.min(Y.minY,L[F+1]),Y.maxX=Math.max(Y.maxX,L[F]),Y.maxY=Math.max(Y.maxY,L[F+1])}function Rt(Y,L,F,H){if(L.geometry){var ie=L.geometry.coordinates,de=L.geometry.type,ve=Math.pow(F.tolerance/((1<<F.maxZoom)*F.extent),2),ge=[],pe=L.id;if(F.promoteId?pe=L.properties[F.promoteId]:F.generateId&&(pe=H||0),de==="Point")kt(ie,ge);else if(de==="MultiPoint")for(var we=0;we<ie.length;we++)kt(ie[we],ge);else if(de==="LineString")Ot(ie,ge,ve,!1);else if(de==="MultiLineString"){if(F.lineMetrics){for(we=0;we<ie.length;we++)Ot(ie[we],ge=[],ve,!1),Y.push(Ye(pe,"LineString",ge,L.properties));return}Zt(ie,ge,ve,!1)}else if(de==="Polygon")Zt(ie,ge,ve,!0);else{if(de!=="MultiPolygon"){if(de==="GeometryCollection"){for(we=0;we<L.geometry.geometries.length;we++)Rt(Y,{id:pe,geometry:L.geometry.geometries[we],properties:L.properties},F,H);return}throw new Error("Input data is not a valid GeoJSON object.")}for(we=0;we<ie.length;we++){var We=[];Zt(ie[we],We,ve,!0),ge.push(We)}}Y.push(Ye(pe,de,ge,L.properties))}}function kt(Y,L){L.push(si(Y[0])),L.push(wi(Y[1])),L.push(0)}function Ot(Y,L,F,H){for(var ie,de,ve=0,ge=0;ge<Y.length;ge++){var pe=si(Y[ge][0]),we=wi(Y[ge][1]);L.push(pe),L.push(we),L.push(0),ge>0&&(ve+=H?(ie*we-pe*de)/2:Math.sqrt(Math.pow(pe-ie,2)+Math.pow(we-de,2))),ie=pe,de=we}var We=L.length-3;L[2]=1,Ct(L,0,We,F),L[We+2]=1,L.size=Math.abs(ve),L.start=0,L.end=L.size}function Zt(Y,L,F,H){for(var ie=0;ie<Y.length;ie++){var de=[];Ot(Y[ie],de,F,H),L.push(de)}}function si(Y){return Y/360+.5}function wi(Y){var L=Math.sin(Y*Math.PI/180),F=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return F<0?0:F>1?1:F}function ai(Y,L,F,H,ie,de,ve,ge){if(H/=L,de>=(F/=L)&&ve<H)return Y;if(ve<F||de>=H)return null;for(var pe=[],we=0;we<Y.length;we++){var We=Y[we],wt=We.geometry,et=We.type,Ut=ie===0?We.minX:We.minY,Nt=ie===0?We.maxX:We.maxY;if(Ut>=F&&Nt<H)pe.push(We);else if(!(Nt<F||Ut>=H)){var Pt=[];if(et==="Point"||et==="MultiPoint")Ci(wt,Pt,F,H,ie);else if(et==="LineString")ln(wt,Pt,F,H,ie,!1,ge.lineMetrics);else if(et==="MultiLineString")wn(wt,Pt,F,H,ie,!1);else if(et==="Polygon")wn(wt,Pt,F,H,ie,!0);else if(et==="MultiPolygon")for(var jt=0;jt<wt.length;jt++){var ei=[];wn(wt[jt],ei,F,H,ie,!0),ei.length&&Pt.push(ei)}if(Pt.length){if(ge.lineMetrics&&et==="LineString"){for(jt=0;jt<Pt.length;jt++)pe.push(Ye(We.id,et,Pt[jt],We.tags));continue}et!=="LineString"&&et!=="MultiLineString"||(Pt.length===1?(et="LineString",Pt=Pt[0]):et="MultiLineString"),et!=="Point"&&et!=="MultiPoint"||(et=Pt.length===3?"Point":"MultiPoint"),pe.push(Ye(We.id,et,Pt,We.tags))}}}return pe.length?pe:null}function Ci(Y,L,F,H,ie){for(var de=0;de<Y.length;de+=3){var ve=Y[de+ie];ve>=F&&ve<=H&&(L.push(Y[de]),L.push(Y[de+1]),L.push(Y[de+2]))}}function ln(Y,L,F,H,ie,de,ve){for(var ge,pe,we=wr(Y),We=ie===0?Bo:cn,wt=Y.start,et=0;et<Y.length-3;et+=3){var Ut=Y[et],Nt=Y[et+1],Pt=Y[et+2],jt=Y[et+3],ei=Y[et+4],Ti=ie===0?Ut:Nt,zi=ie===0?jt:ei,Ei=!1;ve&&(ge=Math.sqrt(Math.pow(Ut-jt,2)+Math.pow(Nt-ei,2))),Ti<F?zi>F&&(pe=We(we,Ut,Nt,jt,ei,F),ve&&(we.start=wt+ge*pe)):Ti>H?zi<H&&(pe=We(we,Ut,Nt,jt,ei,H),ve&&(we.start=wt+ge*pe)):Dn(we,Ut,Nt,Pt),zi<F&&Ti>=F&&(pe=We(we,Ut,Nt,jt,ei,F),Ei=!0),zi>H&&Ti<=H&&(pe=We(we,Ut,Nt,jt,ei,H),Ei=!0),!de&&Ei&&(ve&&(we.end=wt+ge*pe),L.push(we),we=wr(Y)),ve&&(wt+=ge)}var Ft=Y.length-3;Ut=Y[Ft],Nt=Y[Ft+1],Pt=Y[Ft+2],(Ti=ie===0?Ut:Nt)>=F&&Ti<=H&&Dn(we,Ut,Nt,Pt),Ft=we.length-3,de&&Ft>=3&&(we[Ft]!==we[0]||we[Ft+1]!==we[1])&&Dn(we,we[0],we[1],we[2]),we.length&&L.push(we)}function wr(Y){var L=[];return L.size=Y.size,L.start=Y.start,L.end=Y.end,L}function wn(Y,L,F,H,ie,de){for(var ve=0;ve<Y.length;ve++)ln(Y[ve],L,F,H,ie,de,!1)}function Dn(Y,L,F,H){Y.push(L),Y.push(F),Y.push(H)}function Bo(Y,L,F,H,ie,de){var ve=(de-L)/(H-L);return Y.push(de),Y.push(F+(ie-F)*ve),Y.push(1),ve}function cn(Y,L,F,H,ie,de){var ve=(de-F)/(ie-F);return Y.push(L+(H-L)*ve),Y.push(de),Y.push(1),ve}function Tn(Y,L){for(var F=[],H=0;H<Y.length;H++){var ie,de=Y[H],ve=de.type;if(ve==="Point"||ve==="MultiPoint"||ve==="LineString")ie=lo(de.geometry,L);else if(ve==="MultiLineString"||ve==="Polygon"){ie=[];for(var ge=0;ge<de.geometry.length;ge++)ie.push(lo(de.geometry[ge],L))}else if(ve==="MultiPolygon")for(ie=[],ge=0;ge<de.geometry.length;ge++){for(var pe=[],we=0;we<de.geometry[ge].length;we++)pe.push(lo(de.geometry[ge][we],L));ie.push(pe)}F.push(Ye(de.id,ve,ie,de.tags))}return F}function lo(Y,L){var F=[];F.size=Y.size,Y.start!==void 0&&(F.start=Y.start,F.end=Y.end);for(var H=0;H<Y.length;H+=3)F.push(Y[H]+L,Y[H+1],Y[H+2]);return F}function Ks(Y,L){if(Y.transformed)return Y;var F,H,ie,de=1<<Y.z,ve=Y.x,ge=Y.y;for(F=0;F<Y.features.length;F++){var pe=Y.features[F],we=pe.geometry,We=pe.type;if(pe.geometry=[],We===1)for(H=0;H<we.length;H+=2)pe.geometry.push(Ja(we[H],we[H+1],L,de,ve,ge));else for(H=0;H<we.length;H++){var wt=[];for(ie=0;ie<we[H].length;ie+=2)wt.push(Ja(we[H][ie],we[H][ie+1],L,de,ve,ge));pe.geometry.push(wt)}}return Y.transformed=!0,Y}function Ja(Y,L,F,H,ie,de){return[Math.round(F*(Y*H-ie)),Math.round(F*(L*H-de))]}function Qa(Y,L,F,H,ie){for(var de=L===ie.maxZoom?0:ie.tolerance/((1<<L)*ie.extent),ve={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:F,y:H,z:L,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ge=0;ge<Y.length;ge++){ve.numFeatures++,vc(ve,Y[ge],de,ie);var pe=Y[ge].minX,we=Y[ge].minY,We=Y[ge].maxX,wt=Y[ge].maxY;pe<ve.minX&&(ve.minX=pe),we<ve.minY&&(ve.minY=we),We>ve.maxX&&(ve.maxX=We),wt>ve.maxY&&(ve.maxY=wt)}return ve}function vc(Y,L,F,H){var ie=L.geometry,de=L.type,ve=[];if(de==="Point"||de==="MultiPoint")for(var ge=0;ge<ie.length;ge+=3)ve.push(ie[ge]),ve.push(ie[ge+1]),Y.numPoints++,Y.numSimplified++;else if(de==="LineString")co(ve,ie,Y,F,!1,!1);else if(de==="MultiLineString"||de==="Polygon")for(ge=0;ge<ie.length;ge++)co(ve,ie[ge],Y,F,de==="Polygon",ge===0);else if(de==="MultiPolygon")for(var pe=0;pe<ie.length;pe++){var we=ie[pe];for(ge=0;ge<we.length;ge++)co(ve,we[ge],Y,F,!0,ge===0)}if(ve.length){var We=L.tags||null;if(de==="LineString"&&H.lineMetrics){for(var wt in We={},L.tags)We[wt]=L.tags[wt];We.mapbox_clip_start=ie.start/ie.size,We.mapbox_clip_end=ie.end/ie.size}var et={geometry:ve,type:de==="Polygon"||de==="MultiPolygon"?3:de==="LineString"||de==="MultiLineString"?2:1,tags:We};L.id!==null&&(et.id=L.id),Y.features.push(et)}}function co(Y,L,F,H,ie,de){var ve=H*H;if(H>0&&L.size<(ie?ve:H))F.numPoints+=L.length/3;else{for(var ge=[],pe=0;pe<L.length;pe+=3)(H===0||L[pe+2]>ve)&&(F.numSimplified++,ge.push(L[pe]),ge.push(L[pe+1])),F.numPoints++;ie&&function(we,We){for(var wt=0,et=0,Ut=we.length,Nt=Ut-2;et<Ut;Nt=et,et+=2)wt+=(we[et]-we[Nt])*(we[et+1]+we[Nt+1]);if(wt>0===We)for(et=0,Ut=we.length;et<Ut/2;et+=2){var Pt=we[et],jt=we[et+1];we[et]=we[Ut-2-et],we[et+1]=we[Ut-1-et],we[Ut-2-et]=Pt,we[Ut-1-et]=jt}}(ge,de),Y.push(ge)}}function $r(Y,L){var F=(L=this.options=function(ie,de){for(var ve in de)ie[ve]=de[ve];return ie}(Object.create(this.options),L)).debug;if(F&&console.time("preprocess data"),L.maxZoom<0||L.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(L.promoteId&&L.generateId)throw new Error("promoteId and generateId cannot be used together.");var H=function(ie,de){var ve=[];if(ie.type==="FeatureCollection")for(var ge=0;ge<ie.features.length;ge++)Rt(ve,ie.features[ge],de,ge);else Rt(ve,ie.type==="Feature"?ie:{geometry:ie},de);return ve}(Y,L);this.tiles={},this.tileCoords=[],F&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",L.indexMaxZoom,L.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(H=function(ie,de){var ve=de.buffer/de.extent,ge=ie,pe=ai(ie,1,-1-ve,ve,0,-1,2,de),we=ai(ie,1,1-ve,2+ve,0,-1,2,de);return(pe||we)&&(ge=ai(ie,1,-ve,1+ve,0,-1,2,de)||[],pe&&(ge=Tn(pe,1).concat(ge)),we&&(ge=ge.concat(Tn(we,-1)))),ge}(H,L)).length&&this.splitTile(H,0,0,0),F&&(H.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function us(Y,L,F){return 32*((1<<Y)*F+L)+Y}function el(Y,L){const F=Y.tileID.canonical;if(!this._geoJSONIndex)return L(null,null);const H=this._geoJSONIndex.getTile(F.z,F.x,F.y);if(!H)return L(null,null);const ie=new ot(H.features);let de=Pe(ie);de.byteOffset===0&&de.byteLength===de.buffer.byteLength||(de=new Uint8Array(de)),L(null,{vectorTile:ie,rawData:de.buffer})}$r.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},$r.prototype.splitTile=function(Y,L,F,H,ie,de,ve){for(var ge=[Y,L,F,H],pe=this.options,we=pe.debug;ge.length;){H=ge.pop(),F=ge.pop(),L=ge.pop(),Y=ge.pop();var We=1<<L,wt=us(L,F,H),et=this.tiles[wt];if(!et&&(we>1&&console.time("creation"),et=this.tiles[wt]=Qa(Y,L,F,H,pe),this.tileCoords.push({z:L,x:F,y:H}),we)){we>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",L,F,H,et.numFeatures,et.numPoints,et.numSimplified),console.timeEnd("creation"));var Ut="z"+L;this.stats[Ut]=(this.stats[Ut]||0)+1,this.total++}if(et.source=Y,ie){if(L===pe.maxZoom||L===ie)continue;var Nt=1<<ie-L;if(F!==Math.floor(de/Nt)||H!==Math.floor(ve/Nt))continue}else if(L===pe.indexMaxZoom||et.numPoints<=pe.indexMaxPoints)continue;if(et.source=null,Y.length!==0){we>1&&console.time("clipping");var Pt,jt,ei,Ti,zi,Ei,Ft=.5*pe.buffer/pe.extent,Re=.5-Ft,rr=.5+Ft,Ki=1+Ft;Pt=jt=ei=Ti=null,zi=ai(Y,We,F-Ft,F+rr,0,et.minX,et.maxX,pe),Ei=ai(Y,We,F+Re,F+Ki,0,et.minX,et.maxX,pe),Y=null,zi&&(Pt=ai(zi,We,H-Ft,H+rr,1,et.minY,et.maxY,pe),jt=ai(zi,We,H+Re,H+Ki,1,et.minY,et.maxY,pe),zi=null),Ei&&(ei=ai(Ei,We,H-Ft,H+rr,1,et.minY,et.maxY,pe),Ti=ai(Ei,We,H+Re,H+Ki,1,et.minY,et.maxY,pe),Ei=null),we>1&&console.timeEnd("clipping"),ge.push(Pt||[],L+1,2*F,2*H),ge.push(jt||[],L+1,2*F,2*H+1),ge.push(ei||[],L+1,2*F+1,2*H),ge.push(Ti||[],L+1,2*F+1,2*H+1)}}},$r.prototype.getTile=function(Y,L,F){var H=this.options,ie=H.extent,de=H.debug;if(Y<0||Y>24)return null;var ve=1<<Y,ge=us(Y,L=(L%ve+ve)%ve,F);if(this.tiles[ge])return Ks(this.tiles[ge],ie);de>1&&console.log("drilling down to z%d-%d-%d",Y,L,F);for(var pe,we=Y,We=L,wt=F;!pe&&we>0;)we--,We=Math.floor(We/2),wt=Math.floor(wt/2),pe=this.tiles[us(we,We,wt)];return pe&&pe.source?(de>1&&console.log("found parent tile z%d-%d-%d",we,We,wt),de>1&&console.time("drilling down"),this.splitTile(pe.source,we,We,wt,Y,L,F),de>1&&console.timeEnd("drilling down"),this.tiles[ge]?Ks(this.tiles[ge],ie):null):null};class Gn extends s.VectorTileWorkerSource{constructor(L,F,H,ie,de){super(L,F,H,ie,el),de&&(this.loadGeoJSON=de)}loadData(L,F){const H=L&&L.request,ie=H&&H.collectResourceTiming;this.loadGeoJSON(L,(de,ve)=>{if(de||!ve)return F(de);if(typeof ve!="object")return F(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`));{te(ve,!0);try{if(L.filter){const pe=s.createExpression(L.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(pe.result==="error")throw new Error(pe.value.map(We=>`${We.key}: ${We.message}`).join(", "));const we=ve.features.filter(We=>pe.value.evaluate({zoom:0},We));ve={type:"FeatureCollection",features:we}}this._geoJSONIndex=L.cluster?new qn(function({superclusterOptions:pe,clusterProperties:we}){if(!we||!pe)return pe;const We={},wt={},et={accumulated:null,zoom:0},Ut={properties:null},Nt=Object.keys(we);for(const Pt of Nt){const[jt,ei]=we[Pt],Ti=s.createExpression(ei),zi=s.createExpression(typeof jt=="string"?[jt,["accumulated"],["get",Pt]]:jt);We[Pt]=Ti.value,wt[Pt]=zi.value}return pe.map=Pt=>{Ut.properties=Pt;const jt={};for(const ei of Nt)jt[ei]=We[ei].evaluate(et,Ut);return jt},pe.reduce=(Pt,jt)=>{Ut.properties=jt;for(const ei of Nt)et.accumulated=Pt[ei],Pt[ei]=wt[ei].evaluate(et,Ut)},pe}(L)).load(ve.features):function(pe,we){return new $r(pe,we)}(ve,L.geojsonVtOptions)}catch(pe){return F(pe)}this.loaded={};const ge={};if(ie){const pe=s.getPerformanceMeasurement(H);pe&&(ge.resourceTiming={},ge.resourceTiming[L.source]=JSON.parse(JSON.stringify(pe)))}F(null,ge)}})}reloadTile(L,F){const H=this.loaded;return H&&H[L.uid]?super.reloadTile(L,F):this.loadTile(L,F)}loadGeoJSON(L,F){if(L.request)s.getJSON(L.request,F);else{if(typeof L.data!="string")return F(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`));try{return F(null,JSON.parse(L.data))}catch{return F(new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(L,F){try{F(null,this._geoJSONIndex.getClusterExpansionZoom(L.clusterId))}catch(H){F(H)}}getClusterChildren(L,F){try{F(null,this._geoJSONIndex.getChildren(L.clusterId))}catch(H){F(H)}}getClusterLeaves(L,F){try{F(null,this._geoJSONIndex.getLeaves(L.clusterId,L.limit,L.offset))}catch(H){F(H)}}}class Ys{constructor(L){this.self=L,this.actor=new s.Actor(L,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.getProjection({name:"mercator"}),this.workerSourceTypes={vector:s.VectorTileWorkerSource,geojson:Gn},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(F,H)=>{if(this.workerSourceTypes[F])throw new Error(`Worker source with name "${F}" already registered.`);this.workerSourceTypes[F]=H},this.self.registerRTLTextPlugin=F=>{if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=F.applyArabicShaping,s.plugin.processBidirectionalText=F.processBidirectionalText,s.plugin.processStyledBidirectionalText=F.processStyledBidirectionalText}}clearCaches(L,F,H){delete this.layerIndexes[L],delete this.availableImages[L],delete this.workerSources[L],delete this.demWorkerSources[L],H()}checkIfReady(L,F,H){H()}setReferrer(L,F){this.referrer=F}spriteLoaded(L,F){this.isSpriteLoaded[L]=F;for(const H in this.workerSources[L]){const ie=this.workerSources[L][H];for(const de in ie)ie[de]instanceof s.VectorTileWorkerSource&&(ie[de].isSpriteLoaded=F,ie[de].fire(new s.Event("isSpriteLoaded")))}}setImages(L,F,H){this.availableImages[L]=F;for(const ie in this.workerSources[L]){const de=this.workerSources[L][ie];for(const ve in de)de[ve].availableImages=F}H()}enableTerrain(L,F,H){this.terrain=F,H()}setProjection(L,F){this.projections[L]=s.getProjection(F)}setLayers(L,F,H){this.getLayerIndex(L).replace(F),H()}updateLayers(L,F,H){this.getLayerIndex(L).update(F.layers,F.removedIds),H()}loadTile(L,F,H){const ie=this.enableTerrain?s.extend({enableTerrain:this.terrain},F):F;ie.projection=this.projections[L]||this.defaultProjection,this.getWorkerSource(L,F.type,F.source).loadTile(ie,H)}loadDEMTile(L,F,H){const ie=this.enableTerrain?s.extend({buildQuadTree:this.terrain},F):F;this.getDEMWorkerSource(L,F.source).loadTile(ie,H)}reloadTile(L,F,H){const ie=this.enableTerrain?s.extend({enableTerrain:this.terrain},F):F;ie.projection=this.projections[L]||this.defaultProjection,this.getWorkerSource(L,F.type,F.source).reloadTile(ie,H)}abortTile(L,F,H){this.getWorkerSource(L,F.type,F.source).abortTile(F,H)}removeTile(L,F,H){this.getWorkerSource(L,F.type,F.source).removeTile(F,H)}removeSource(L,F,H){if(!this.workerSources[L]||!this.workerSources[L][F.type]||!this.workerSources[L][F.type][F.source])return;const ie=this.workerSources[L][F.type][F.source];delete this.workerSources[L][F.type][F.source],ie.removeSource!==void 0?ie.removeSource(F,H):H()}loadWorkerSource(L,F,H){try{this.self.importScripts(F.url),H()}catch(ie){H(ie.toString())}}syncRTLPluginState(L,F,H){try{s.plugin.setState(F);const ie=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&ie!=null){this.self.importScripts(ie);const de=s.plugin.isParsed();H(de?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ie}`),de)}}catch(ie){H(ie.toString())}}getAvailableImages(L){let F=this.availableImages[L];return F||(F=[]),F}getLayerIndex(L){let F=this.layerIndexes[L];return F||(F=this.layerIndexes[L]=new ee),F}getWorkerSource(L,F,H){return this.workerSources[L]||(this.workerSources[L]={}),this.workerSources[L][F]||(this.workerSources[L][F]={}),this.workerSources[L][F][H]||(this.workerSources[L][F][H]=new this.workerSourceTypes[F]({send:(ie,de,ve,ge,pe,we)=>{this.actor.send(ie,de,ve,L,pe,we)},scheduler:this.actor.scheduler},this.getLayerIndex(L),this.getAvailableImages(L),this.isSpriteLoaded[L])),this.workerSources[L][F][H]}getDEMWorkerSource(L,F){return this.demWorkerSources[L]||(this.demWorkerSources[L]={}),this.demWorkerSources[L][F]||(this.demWorkerSources[L][F]=new G),this.demWorkerSources[L][F]}enforceCacheSizeLimit(L,F){s.enforceCacheSizeLimit(F)}getWorkerPerformanceMetrics(L,F,H){H(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Ys(self)),Ys}),A(["./shared"],function(s){function B(c,n){if(Array.isArray(c)){if(!Array.isArray(n)||c.length!==n.length)return!1;for(let a=0;a<c.length;a++)if(!B(c[a],n[a]))return!1;return!0}if(typeof c=="object"&&c!==null&&n!==null){if(typeof n!="object"||Object.keys(c).length!==Object.keys(n).length)return!1;for(const a in c)if(!B(c[a],n[a]))return!1;return!0}return c===n}var Z=ee;function ee(c){return!function(n){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var h,m,_=new Blob([""],{type:"text/javascript"}),b=URL.createObjectURL(_);try{m=new Worker(b),h=!0}catch{h=!1}return m&&m.terminate(),URL.revokeObjectURL(b),h}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var h=document.createElement("canvas");h.width=h.height=1;var m=h.getContext("2d");if(!m)return!1;var _=m.getImageData(0,0,1,1);return _&&_.width===h.width}()?(G[a=n&&n.failIfMajorPerformanceCaveat]===void 0&&(G[a]=function(h){var m,_=function(b){var T=document.createElement("canvas"),S=Object.create(ee.webGLContextAttributes);return S.failIfMajorPerformanceCaveat=b,T.getContext("webgl",S)||T.getContext("experimental-webgl",S)}(h);if(!_)return!1;try{m=_.createShader(_.VERTEX_SHADER)}catch{return!1}return!(!m||_.isContextLost())&&(_.shaderSource(m,"void main() {}"),_.compileShader(m),_.getShaderParameter(m,_.COMPILE_STATUS)===!0)}(a)),G[a]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var a}(c)}var G={};function te(c,n,a){const h=s.window.document.createElement(c);return n!==void 0&&(h.className=n),a&&a.appendChild(h),h}function _e(c,n,a){const h=s.window.document.createElementNS("http://www.w3.org/2000/svg",c);for(const m of Object.keys(n))h.setAttributeNS(null,m,n[m]);return a&&a.appendChild(h),h}ee.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Ee=s.window.document&&s.window.document.documentElement.style,Te=Ee&&Ee.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Be;function ot(){Ee&&Te&&(Be=Ee[Te],Ee[Te]="none")}function Se(){Ee&&Te&&(Ee[Te]=Be)}function Je(c){c.preventDefault(),c.stopPropagation(),s.window.removeEventListener("click",Je,!0)}function ct(){s.window.addEventListener("click",Je,!0),s.window.setTimeout(()=>{s.window.removeEventListener("click",Je,!0)},0)}function Ie(c,n){const a=c.getBoundingClientRect();return ze(c,a,n)}function Pe(c,n){const a=c.getBoundingClientRect(),h=[];for(let m=0;m<n.length;m++)h.push(ze(c,a,n[m]));return h}function be(c){return s.window.InstallTrigger!==void 0&&c.button===2&&c.ctrlKey&&s.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:c.button}function ze(c,n,a){const h=c.offsetWidth===n.width?1:c.offsetWidth/n.width;return new s.pointGeometry((a.clientX-n.left)*h,(a.clientY-n.top)*h)}function Qe(c,n){var a=n[0],h=n[1],m=n[2],_=n[3],b=a*_-m*h;return b?(c[0]=_*(b=1/b),c[1]=-h*b,c[2]=-m*b,c[3]=a*b,c):null}function Fe(c){const{userImage:n}=c;return!!(n&&n.render&&n.render())&&(c.data.replace(new Uint8Array(n.data.buffer)),!0)}class dt extends s.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:a,callback:h}of this.requestors)this._notify(a,h);this.requestors=[]}}hasImage(n){return!!this.getImage(n)}getImage(n){return this.images[n]}addImage(n,a){this._validate(n,a)&&(this.images[n]=a)}_validate(n,a){let h=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new s.ErrorEvent(new Error(`Image "${n}" has invalid "stretchX" value`))),h=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new s.ErrorEvent(new Error(`Image "${n}" has invalid "stretchY" value`))),h=!1),this._validateContent(a.content,a)||(this.fire(new s.ErrorEvent(new Error(`Image "${n}" has invalid "content" value`))),h=!1),h}_validateStretch(n,a){if(!n)return!0;let h=0;for(const m of n){if(m[0]<h||m[1]<m[0]||a<m[1])return!1;h=m[1]}return!0}_validateContent(n,a){return!(n&&(n.length!==4||n[0]<0||a.data.width<n[0]||n[1]<0||a.data.height<n[1]||n[2]<0||a.data.width<n[2]||n[3]<0||a.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,a){a.version=this.images[n].version+1,this.images[n]=a,this.updatedImages[n]=!0}removeImage(n){const a=this.images[n];delete this.images[n],delete this.patterns[n],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,a){let h=!0;if(!this.isLoaded())for(const m of n)this.images[m]||(h=!1);this.isLoaded()||h?this._notify(n,a):this.requestors.push({ids:n,callback:a})}_notify(n,a){const h={};for(const m of n){this.images[m]||this.fire(new s.Event("styleimagemissing",{id:m}));const _=this.images[m];_?h[m]={data:_.data.clone(),pixelRatio:_.pixelRatio,sdf:_.sdf,version:_.version,stretchX:_.stretchX,stretchY:_.stretchY,content:_.content,hasRenderCallback:Boolean(_.userImage&&_.userImage.render)}:s.warnOnce(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}a(null,h)}getPixelSize(){const{width:n,height:a}=this.atlasImage;return{width:n,height:a}}getPattern(n){const a=this.patterns[n],h=this.getImage(n);if(!h)return null;if(a&&a.position.version===h.version)return a.position;if(a)a.position.version=h.version;else{const m={w:h.data.width+2,h:h.data.height+2,x:0,y:0},_=new s.ImagePosition(m,h);this.patterns[n]={bin:m,position:_}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const a=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.Texture(n,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const _ in this.patterns)n.push(this.patterns[_].bin);const{w:a,h}=s.potpack(n),m=this.atlasImage;m.resize({width:a||1,height:h||1});for(const _ in this.patterns){const{bin:b}=this.patterns[_],T=b.x+1,S=b.y+1,I=this.images[_].data,k=I.width,R=I.height;s.RGBAImage.copy(I,m,{x:0,y:0},{x:T,y:S},{width:k,height:R}),s.RGBAImage.copy(I,m,{x:0,y:R-1},{x:T,y:S-1},{width:k,height:1}),s.RGBAImage.copy(I,m,{x:0,y:0},{x:T,y:S+R},{width:k,height:1}),s.RGBAImage.copy(I,m,{x:k-1,y:0},{x:T-1,y:S},{width:1,height:R}),s.RGBAImage.copy(I,m,{x:0,y:0},{x:T+k,y:S},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const a of n){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const h=this.images[a];Fe(h)&&this.updateImage(a,h)}}}const ft=new s.Properties({anchor:new s.DataConstantProperty(s.spec.light.anchor),position:new class{constructor(){this.specification=s.spec.light.position}possiblyEvaluate(c,n){return function([a,h,m]){const _=s.degToRad(h+90),b=s.degToRad(m);return{x:a*Math.cos(_)*Math.sin(b),y:a*Math.sin(_)*Math.sin(b),z:a*Math.cos(b),azimuthal:h,polar:m}}(c.expression.evaluate(n))}interpolate(c,n,a){return{x:s.number(c.x,n.x,a),y:s.number(c.y,n.y,a),z:s.number(c.z,n.z,a),azimuthal:s.number(c.azimuthal,n.azimuthal,a),polar:s.number(c.polar,n.polar,a)}}},color:new s.DataConstantProperty(s.spec.light.color),intensity:new s.DataConstantProperty(s.spec.light.intensity)}),Ze="-transition";class Ke extends s.Evented{constructor(n){super(),this._transitionable=new s.Transitionable(ft),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,a={}){if(!this._validate(s.validateLight,n,a))for(const h in n){const m=n[h];s.endsWith(h,Ze)?this._transitionable.setTransition(h.slice(0,-Ze.length),m):this._transitionable.setValue(h,m)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,h){return(!h||h.validate!==!1)&&s.emitValidationErrors(this,n.call(s.validateStyle,s.extend({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}const Bt=new s.Properties({source:new s.DataConstantProperty(s.spec.terrain.source),exaggeration:new s.DataConstantProperty(s.spec.terrain.exaggeration)}),Wt="-transition";class tt extends s.Evented{constructor(n,a){super(),this._transitionable=new s.Transitionable(Bt),this.set(n),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=a}get(){return this._transitionable.serialize()}set(n){for(const a in n){const h=n[a];s.endsWith(a,Wt)?this._transitionable.setTransition(a.slice(0,-Wt.length),h):this._transitionable.setValue(a,h)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}}function Mt(c,n,a,h){const m=s.smoothstep(45,65,a),[_,b]=Li(c,h),T=s.length(n);let S=1-Math.min(1,Math.exp((T-_)/(b-_)*-6));return S*=S*S,S=Math.min(1,1.00747*S),S*m*c.alpha}function Li(c,n){const a=.5/Math.tan(.5*n);return[c.range[0]+a,c.range[1]+a]}const xt=new s.Properties({range:new s.DataConstantProperty(s.spec.fog.range),color:new s.DataConstantProperty(s.spec.fog.color),"high-color":new s.DataConstantProperty(s.spec.fog["high-color"]),"space-color":new s.DataConstantProperty(s.spec.fog["space-color"]),"horizon-blend":new s.DataConstantProperty(s.spec.fog["horizon-blend"]),"star-intensity":new s.DataConstantProperty(s.spec.fog["star-intensity"])}),bi="-transition";class Jt extends s.Evented{constructor(n,a){super(),this._transitionable=new s.Transitionable(xt),this.set(n),this._transitioning=this._transitionable.untransitioned(),this._transform=a}get state(){const n=this._transform,a=n.projection.name==="globe",h=s.globeToMercatorTransition(n.zoom),m=this.properties.get("range"),_=[.5,3];return{range:a?[s.number(_[0],m[0],h),s.number(_[1],m[1],h)]:m,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,a={}){if(!this._validate(s.validateFog,n,a)){for(const h of Object.keys(s.spec.fog))n&&n[h]===void 0&&(n[h]=s.spec.fog[h].default);for(const h in n){const m=n[h];s.endsWith(h,bi)?this._transitionable.setTransition(h.slice(0,-bi.length),m):this._transitionable.setValue(h,m)}}}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.smoothstep(45,65,n))*a.a}getOpacityAtLatLng(n,a){return this._transform.projection.supportsFog?function(h,m,_){const b=s.MercatorCoordinate.fromLngLat(m),T=_.elevation?_.elevation.getAtPointOrZero(b):0,S=[b.x,b.y,T];return s.transformMat4(S,S,_.mercatorFogMatrix),Mt(h,S,_.pitch,_._fov)}(this.state,n,a):0}getFovAdjustedRange(n){return this._transform.projection.supportsFog?Li(this.state,n):[0,1]}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,h){return(!h||h.validate!==!1)&&s.emitValidationErrors(this,n.call(s.validateStyle,s.extend({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}class _i{constructor(n,a){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=s.uniqueId();const h=this.workerPool.acquire(this.id);for(let m=0;m<h.length;m++){const _=new _i.Actor(h[m],a,this.id);_.name=`Worker ${m}`,this.actors.push(_)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,a,h){s.asyncAll(this.actors,(m,_)=>{m.send(n,a,_)},h=h||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}function kn(c,n,a){return n*(s.EXTENT/(c.tileSize*Math.pow(2,a-c.tileID.overscaledZ)))}_i.Actor=s.Actor;class Pn{constructor(n,a,h,m){this.screenBounds=n,this.cameraPoint=a,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=h,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,m)}static createFromScreenPoints(n,a){let h,m;if(n instanceof s.pointGeometry||typeof n[0]=="number"){const _=s.pointGeometry.convert(n);h=[s.pointGeometry.convert(n)],m=a.isPointAboveHorizon(_)}else{const _=s.pointGeometry.convert(n[0]),b=s.pointGeometry.convert(n[1]);h=[_,b],m=s.polygonizeBounds(_,b).every(T=>a.isPointAboveHorizon(T))}return new Pn(h,a.getCameraPoint(),m,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return s.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const a=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new s.pointGeometry(1,1)):this.screenBounds[1],m=s.polygonizeBounds(a,h,0,!1);return this.cameraPoint.y>h.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<h.x?m.splice(3,0,this.cameraPoint):this.cameraPoint.x>=h.x?m[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(m[3]=this.cameraPoint)),s.bufferConvexPolygon(m,n)}bufferedCameraGeometryGlobe(n){const a=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new s.pointGeometry(1,1)):this.screenBounds[1],m=s.polygonizeBounds(a,h,n),_=this.cameraPoint.clone();switch(3*((_.y>a.y)+(_.y>h.y))+((_.x>a.x)+(_.x>h.x))){case 0:m[0]=_,m[4]=_.clone();break;case 1:m.splice(1,0,_);break;case 2:m[1]=_;break;case 3:m.splice(4,0,_);break;case 5:m.splice(2,0,_);break;case 6:m[3]=_;break;case 7:m.splice(3,0,_);break;case 8:m[2]=_}return m}containsTile(n,a,h,m=0){const _=n.queryPadding/a._pixelsPerMercatorPixel+1,b=h?this._bufferedCameraMercator(_,a):this._bufferedScreenMercator(_,a);let T=n.tileID.wrap+(b.unwrapped?m:0);const S=b.polygon.map(q=>s.getTilePoint(n.tileTransform,q,T));if(!s.polygonIntersectsBox(S,0,0,s.EXTENT,s.EXTENT))return;T=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?m:0);const I=this.screenGeometryMercator.polygon.map(q=>s.getTileVec3(n.tileTransform,q,T)),k=I.map(q=>new s.pointGeometry(q[0],q[1])),R=a.getFreeCameraOptions().position||new s.MercatorCoordinate(0,0,0),U=s.getTileVec3(n.tileTransform,R,T),W=I.map(q=>{const N=s.sub(q,q,U);return s.normalize(N,N),new s.Ray(U,N)}),j=kn(n,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:k,tilespaceRays:W,bufferedTilespaceGeometry:S,bufferedTilespaceBounds:($=s.getBounds(S),$.min.x=s.clamp($.min.x,0,s.EXTENT),$.min.y=s.clamp($.min.y,0,s.EXTENT),$.max.x=s.clamp($.max.x,0,s.EXTENT),$.max.y=s.clamp($.max.y,0,s.EXTENT),$),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:j};var $}_bufferedScreenMercator(n,a){const h=jr(n);if(this._screenRaycastCache[h])return this._screenRaycastCache[h];{let m;return m=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),a):{polygon:this.bufferedScreenGeometry(n).map(_=>a.pointCoordinate3D(_)),unwrapped:!0},this._screenRaycastCache[h]=m,m}}_bufferedCameraMercator(n,a){const h=jr(n);if(this._cameraRaycastCache[h])return this._cameraRaycastCache[h];{let m;return m=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),a):{polygon:this.bufferedCameraGeometry(n).map(_=>a.pointCoordinate3D(_)),unwrapped:!0},this._cameraRaycastCache[h]=m,m}}_projectAndResample(n,a){const h=function(_,b){const T=s.multiply([],b.pixelMatrix,b.globeMatrix),S=[0,-s.GLOBE_RADIUS,0,1],I=[0,s.GLOBE_RADIUS,0,1],k=[0,0,0,1];s.transformMat4$1(S,S,T),s.transformMat4$1(I,I,T),s.transformMat4$1(k,k,T);const R=new s.pointGeometry(S[0]/S[3],S[1]/S[3]),U=new s.pointGeometry(I[0]/I[3],I[1]/I[3]),W=s.polygonContainsPoint(_,R)&&S[3]<k[3],j=s.polygonContainsPoint(_,U)&&I[3]<k[3];if(!W&&!j)return null;const $=function(ce,ae,me){for(let Ce=1;Ce<ce.length;Ce++){const rt=qn(ae.pointCoordinate3D(ce[Ce-1]).x),xe=qn(ae.pointCoordinate3D(ce[Ce]).x);if(me<0){if(rt<xe)return{idx:Ce,t:-rt/(xe-1-rt)}}else if(xe<rt)return{idx:Ce,t:(1-rt)/(xe+1-rt)}}return null}(_,b,W?-1:1);if(!$)return null;const{idx:q,t:N}=$;let J=q>1?an(_.slice(0,q),b):[],X=q<_.length?an(_.slice(q),b):[];J=J.map(ce=>new s.pointGeometry(qn(ce.x),ce.y)),X=X.map(ce=>new s.pointGeometry(qn(ce.x),ce.y));const ue=[...J];ue.length===0&&ue.push(X[X.length-1]);const le=s.number(ue[ue.length-1].y,(X.length===0?J[0]:X[0]).y,N);let re;return re=W?[new s.pointGeometry(0,le),new s.pointGeometry(0,0),new s.pointGeometry(1,0),new s.pointGeometry(1,le)]:[new s.pointGeometry(1,le),new s.pointGeometry(1,1),new s.pointGeometry(0,1),new s.pointGeometry(0,le)],ue.push(...re),X.length===0?ue.push(J[0]):ue.push(...X),{polygon:ue.map(ce=>new s.MercatorCoordinate(ce.x,ce.y)),unwrapped:!1}}(n,a);if(h)return h;const m=function(_,b){let T=!1,S=-1/0,I=0;for(let R=0;R<_.length-1;R++)_[R].x>S&&(S=_[R].x,I=R);for(let R=0;R<_.length-1;R++){const U=(I+R)%(_.length-1),W=_[U],j=_[U+1];Math.abs(W.x-j.x)>.5&&(W.x<j.x?(W.x+=1,U===0&&(_[_.length-1].x+=1)):(j.x+=1,U+1===_.length-1&&(_[0].x+=1)),T=!0)}const k=s.mercatorXfromLng(b.center.lng);return T&&k<Math.abs(k-1)&&_.forEach(R=>{R.x-=1}),{polygon:_,unwrapped:T}}(an(n,a).map(_=>new s.pointGeometry(qn(_.x),_.y)),a);return{polygon:m.polygon.map(_=>new s.MercatorCoordinate(_.x,_.y)),unwrapped:m.unwrapped}}}function an(c,n){return s.resample(c,a=>{const h=n.pointCoordinate3D(a);a.x=h.x,a.y=h.y},1/256)}function qn(c){return c<0?1+c%1:c%1}function jr(c){return 100*c|0}function hr(c,n,a,h,m){const _=function(b,T){if(b)return m(b);if(T){const S=s.pick(s.extend(T,c),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);T.vector_layers&&(S.vectorLayers=T.vector_layers,S.vectorLayerIds=S.vectorLayers.map(I=>I.id)),T.language_options&&(S.languageOptions=T.language_options),T.language&&T.language[T.id]&&(S.language=T.language[T.id]),T.worldview_options&&(S.worldviewOptions=T.worldview_options),T.worldview?S.worldview=T.worldview[T.id]:T.worldview_default&&(S.worldview=T.worldview_default),S.tiles=n.canonicalizeTileset(S,c.url),m(null,S)}};return c.url?s.getJSON(n.transformRequest(n.normalizeSourceURL(c.url,null,a,h),s.ResourceType.Source),_):s.exported.frame(()=>_(null,c))}class nr{constructor(n,a,h){this.bounds=s.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=a||0,this.maxzoom=h||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const a=Math.pow(2,n.z),h=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*a),m=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*a),_=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*a),b=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*a);return n.x>=h&&n.x<_&&n.y>=m&&n.y<b}}class ao{constructor(n,a,h){this.context=n;const m=n.gl;this.buffer=m.createBuffer(),this.dynamicDraw=Boolean(h),this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const fe={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ye{constructor(n,a,h,m){this.length=a.length,this.attributes=h,this.itemSize=a.bytesPerElement,this.dynamicDraw=m,this.context=n;const _=n.gl;this.buffer=_.createBuffer(),n.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,a){for(let h=0;h<this.attributes.length;h++){const m=a.attributes[this.attributes[h].name];m!==void 0&&n.enableVertexAttribArray(m)}}setVertexAttribPointers(n,a,h){for(let m=0;m<this.attributes.length;m++){const _=this.attributes[m],b=a.attributes[_.name];b!==void 0&&n.vertexAttribPointer(b,_.components,n[fe[_.type]],!1,this.itemSize,_.offset+this.itemSize*(h||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Me{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class it extends Me{getDefault(){return s.Color.transparent}set(n){const a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class nt extends Me{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class gt extends Me{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Ct extends Me{getDefault(){return[!0,!0,!0,!0]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class yt extends Me{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Ye extends Me{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class ht extends Me{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const a=this.current;(n.func!==a.func||n.ref!==a.ref||n.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class Rt extends Me{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class kt extends Me{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=n,this.dirty=!1}}class Ot extends Me{getDefault(){return[0,1]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class Zt extends Me{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=n,this.dirty=!1}}class si extends Me{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class wi extends Me{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.BLEND):a.disable(a.BLEND),this.current=n,this.dirty=!1}}class ai extends Me{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class Ci extends Me{getDefault(){return s.Color.transparent}set(n){const a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class ln extends Me{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class wr extends Me{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=n,this.dirty=!1}}class wn extends Me{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class Dn extends Me{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}class Bo extends Me{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}}class cn extends Me{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class Tn extends Me{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class lo extends Me{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class Ks extends Me{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Ja extends Me{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Qa extends Me{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class vc extends Me{getDefault(){return null}set(n){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class co extends Me{constructor(n){super(n),this.vao=n.extVertexArrayObject}getDefault(){return null}set(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)}}class $r extends Me{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class us extends Me{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class el extends Me{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Gn extends Me{constructor(n,a){super(n),this.context=n,this.parent=a}getDefault(){return null}}class Ys extends Gn{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Y extends Gn{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class L extends Y{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class F{constructor(n,a,h,m){this.context=n,this.width=a,this.height=h;const _=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new Ys(n,_),m&&(this.depthAttachment=new Y(n,_))}destroy(){const n=this.context.gl,a=this.colorAttachment.get();if(a&&n.deleteTexture(a),this.depthAttachment){const h=this.depthAttachment.get();h&&n.deleteRenderbuffer(h)}n.deleteFramebuffer(this.framebuffer)}}class H{constructor(n){this.gl=n,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new it(this),this.clearDepth=new nt(this),this.clearStencil=new gt(this),this.colorMask=new Ct(this),this.depthMask=new yt(this),this.stencilMask=new Ye(this),this.stencilFunc=new ht(this),this.stencilOp=new Rt(this),this.stencilTest=new kt(this),this.depthRange=new Ot(this),this.depthTest=new Zt(this),this.depthFunc=new si(this),this.blend=new wi(this),this.blendFunc=new ai(this),this.blendColor=new Ci(this),this.blendEquation=new ln(this),this.cullFace=new wr(this),this.cullFaceSide=new wn(this),this.frontFace=new Dn(this),this.program=new Bo(this),this.activeTexture=new cn(this),this.viewport=new Tn(this),this.bindFramebuffer=new lo(this),this.bindRenderbuffer=new Ks(this),this.bindTexture=new Ja(this),this.bindVertexBuffer=new Qa(this),this.bindElementBuffer=new vc(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new co(this),this.pixelStoreUnpack=new $r(this),this.pixelStoreUnpackPremultiplyAlpha=new us(this),this.pixelStoreUnpackFlipY=new el(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extTextureHalfFloat=n.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(n.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=n.getExtension("OES_standard_derivatives"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,a){return new ao(this,n,a)}createVertexBuffer(n,a,h){return new ye(this,n,a,h)}createRenderbuffer(n,a,h){const m=this.gl,_=m.createRenderbuffer();return this.bindRenderbuffer.set(_),m.renderbufferStorage(m.RENDERBUFFER,n,a,h),this.bindRenderbuffer.set(null),_}createFramebuffer(n,a,h){return new F(this,n,a,h)}clear({color:n,depth:a,stencil:h}){const m=this.gl;let _=0;n&&(_|=m.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(_|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),h!==void 0&&(_|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),m.clear(_)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){B(n.blendFunction,s.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ie extends s.Evented{constructor(n,a,h,m){super(),this.id=n,this.dispatcher=h,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},a),s.extend(this,s.pick(a,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=hr(this._options,this.map._requestManager,null,null,(n,a)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new s.ErrorEvent(n)):a&&(s.extend(this,a),a.bounds&&(this.tileBounds=new nr(a.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(a.tiles),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return s.extend({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,a){const h=s.exported.devicePixelRatio>=2,m=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),h,this.tileSize);n.request=s.getImage(this.map._requestManager.transformRequest(m,s.ResourceType.Tile),(_,b,T,S)=>(delete n.request,n.aborted?(n.state="unloaded",a(null)):_?(n.state="errored",a(_)):b?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:T,expires:S}),n.setTexture(b,this.map.painter),n.state="loaded",s.cacheEntryPossiblyAdded(this.dispatcher),void a(null)):a(null)))}static loadTileData(n,a,h){n.setTexture(a,h)}static unloadTileData(n,a){n.texture&&a.saveTileTexture(n.texture)}abortTile(n,a){n.request&&(n.request.cancel(),delete n.request),a()}unloadTile(n,a){n.texture&&this.map.painter.saveTileTexture(n.texture),a()}hasTransition(){return!1}}let de;function ve(c,n,a,h,m,_,b,T){const S=[c,a,m,n,h,_,1,1,1],I=[b,T,1],k=s.adjoint([],S),[R,U,W]=s.transformMat3(I,I,s.transpose(k,k));return s.multiply$1(S,[R,0,0,0,U,0,0,0,W],S)}class ge extends s.Evented{constructor(n,a,h,m){super(),this.id=n,this.dispatcher=h,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=a}load(n,a){this._loaded=a||!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),(h,m)=>{if(this._loaded=!0,h)this.fire(new s.ErrorEvent(h));else if(m){const{HTMLImageElement:_}=s.window;this.image=m instanceof _?s.exported.getImageData(m):m,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading()}})}loaded(){return this._loaded}updateImage(n){return this.image&&n.url?(this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(n){this.coordinates=n,this._boundsArray=void 0;const a=n.map(s.MercatorCoordinate.fromLngLat);return this.tileID=function(h){let m=1/0,_=1/0,b=-1/0,T=-1/0;for(const R of h)m=Math.min(m,R.x),_=Math.min(_,R.y),b=Math.max(b,R.x),T=Math.max(T,R.y);const S=Math.max(b-m,T-_),I=Math.max(0,Math.floor(-Math.log(S)/Math.LN2)),k=Math.pow(2,I);return new s.CanonicalTileID(I,Math.floor((m+b)/2*k),Math.floor((_+T)/2*k))}(a),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(n){for(const S in this.tiles){const I=this.tiles[S];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture)}if(this._boundsArray)return;const a=s.tileTransform(this.tileID,this.map.transform.projection),[h,m,_,b]=this.coordinates.map(S=>{const I=a.projection.project(S[0],S[1]);return s.getTilePoint(a,I)._round()});this.perspectiveTransform=function(S,I,k,R,U,W,j,$,q,N){const J=ve(0,0,S,0,0,I,S,I),X=ve(k,R,U,W,j,$,q,N);return s.multiply$1(X,s.adjoint(J,J),X),[X[6]/X[8]*S/s.EXTENT,X[7]/X[8]*I/s.EXTENT]}(this.width,this.height,h.x,h.y,m.x,m.y,b.x,b.y,_.x,_.y);const T=this._boundsArray=new s.StructArrayLayout4i8;T.emplaceBack(h.x,h.y,0,0),T.emplaceBack(m.x,m.y,s.EXTENT,0),T.emplaceBack(b.x,b.y,0,s.EXTENT),T.emplaceBack(_.x,_.y,s.EXTENT,s.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=n.createVertexBuffer(T,s.boundsAttributes.members),this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const n=this.map.painter.context,a=n.gl;this.texture?this.texture.update(this.image):(this.texture=new s.Texture(n,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._prepareData(n)}loadTile(n,a){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},a(null)):(n.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const pe={vector:class extends s.Evented{constructor(c,n,a,h){if(super(),this.id=c,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(n,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(h),this._tileWorkers={},this._deduped=new s.DedupedRequest}load(c){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"}));const n=this.language||this.map._language,a=this.worldview||this.map._worldview;this._tileJSONRequest=hr(this._options,this.map._requestManager,n,a,(h,m)=>{this._tileJSONRequest=null,this._loaded=!0,h?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code. Found: ${n}`),a&&a.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new s.ErrorEvent(h))):m&&(s.extend(this,m),m.bounds&&(this.tileBounds=new nr(m.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(m.tiles,this.map._requestManager._customAccessToken),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(h)})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}setSourceProperty(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.load(()=>{const n=this.map.style._getSourceCaches(this.id);for(const a of n)a.clearTiles()})}setTiles(c){return this.setSourceProperty(()=>{this._options.tiles=c}),this}setUrl(c){return this.setSourceProperty(()=>{this.url=c,this._options.url=c}),this}_setLanguage(c){return c===this.language||this.setSourceProperty(()=>{this.language=c}),this}_setWorldview(c){return c===this.worldview?this:this.worldviewOptions&&c&&!this.worldviewOptions[c]?(console.warn(`Vector tile source "${this.id}" does not support worldview "${c}".`),this):(this.setSourceProperty(()=>{this.worldview=c}),this)}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return s.extend({},this._options)}loadTile(c,n){const a=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),h={request:this.map._requestManager.transformRequest(a,s.ResourceType.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:c.isSymbolTile};if(h.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired")c.state==="loading"?c.reloadCallback=n:c.request=c.actor.send("reloadTile",h,m.bind(this));else if(c.actor=this._tileWorkers[a]=this._tileWorkers[a]||this.dispatcher.getActor(),this.dispatcher.ready)c.request=c.actor.send("loadTile",h,m.bind(this),void 0,!0);else{const _=s.loadVectorTile.call({deduped:this._deduped},h,(b,T)=>{b||!T?m.call(this,b):(h.data={cacheControl:T.cacheControl,expires:T.expires,rawData:T.rawData.slice(0)},c.actor&&c.actor.send("loadTile",h,m.bind(this),void 0,!0))},!0);c.request={cancel:_}}function m(_,b){return delete c.request,c.aborted?n(null):_&&_.status!==404?n(_):(b&&b.resourceTiming&&(c.resourceTiming=b.resourceTiming),this.map._refreshExpiredTiles&&b&&c.setExpiryData(b),c.loadVectorData(b,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id})}unloadTile(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:ie,"raster-dem":class extends ie{constructor(c,n,a,h){super(c,n,a,h),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(c,n){const a=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function h(m,_){m&&(c.state="errored",n(m)),_&&(c.dem=_,c.dem.onDeserialize(),c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0,c.state="loaded",n(null))}c.request=s.getImage(this.map._requestManager.transformRequest(a,s.ResourceType.Tile),function(m,_,b,T){if(delete c.request,c.aborted)c.state="unloaded",n(null);else if(m)c.state="errored",n(m);else if(_){this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:b,expires:T});const S=s.window.ImageBitmap&&_ instanceof s.window.ImageBitmap&&(de==null&&(de=s.window.OffscreenCanvas&&new s.window.OffscreenCanvas(1,1).getContext("2d")&&typeof s.window.createImageBitmap=="function"),de),I=1-(_.width-s.prevPowerOfTwo(_.width))/2;I<1||c.neighboringTiles||(c.neighboringTiles=this._getNeighboringTiles(c.tileID));const k=S?_:s.exported.getImageData(_,I),R={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:k,encoding:this.encoding,padding:I};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",R,h.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(c){const n=c.canonical,a=Math.pow(2,n.z),h=(n.x-1+a)%a,m=n.x===0?c.wrap-1:c.wrap,_=(n.x+1+a)%a,b=n.x+1===a?c.wrap+1:c.wrap,T={};return T[new s.OverscaledTileID(c.overscaledZ,m,n.z,h,n.y).key]={backfilled:!1},T[new s.OverscaledTileID(c.overscaledZ,b,n.z,_,n.y).key]={backfilled:!1},n.y>0&&(T[new s.OverscaledTileID(c.overscaledZ,m,n.z,h,n.y-1).key]={backfilled:!1},T[new s.OverscaledTileID(c.overscaledZ,c.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},T[new s.OverscaledTileID(c.overscaledZ,b,n.z,_,n.y-1).key]={backfilled:!1}),n.y+1<a&&(T[new s.OverscaledTileID(c.overscaledZ,m,n.z,h,n.y+1).key]={backfilled:!1},T[new s.OverscaledTileID(c.overscaledZ,c.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},T[new s.OverscaledTileID(c.overscaledZ,b,n.z,_,n.y+1).key]={backfilled:!1}),T}unloadTile(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded"}},geojson:class extends s.Evented{constructor(c,n,a,h){super(),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(h),this._data=n.data,this._options=s.extend({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const m=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*m,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*m,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:s.EXTENT,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*m,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(c){this.map=c,this.setData(this._data)}setData(c){return this._data=c,this._updateWorkerData(),this}getClusterExpansionZoom(c,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},n),this}getClusterChildren(c,n){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},n),this}getClusterLeaves(c,n,a,h){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:n,offset:a},h),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.Event("dataloading",{dataType:"source"})),this._loaded=!1;const c=s.extend({},this.workerOptions),n=this._data;typeof n=="string"?(c.request=this.map._requestManager.transformRequest(s.exported.resolveURL(n),s.ResourceType.Source),c.request.collectResourceTiming=this._collectResourceTiming):c.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,c,(a,h)=>{if(this._loaded=!0,this._pendingLoad=null,a)this.fire(new s.ErrorEvent(a));else{const m={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&h&&h.resourceTiming&&h.resourceTiming[this.id]&&(m.resourceTiming=h.resourceTiming[this.id]),this.fire(new s.Event("data",m)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(c,n){const a=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(a,{type:this.type,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(h,m)=>(delete c.request,c.unloadVectorData(),c.aborted?n(null):h?n(h):(c.loadVectorData(m,this.map.painter,a==="reloadTile"),n(null))),void 0,a==="loadTile")}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0}unloadTile(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends ge{constructor(c,n,a,h){super(c,n,a,h),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const c=this.options;this.urls=[];for(const n of c.urls)this.urls.push(this.map._requestManager.transformRequest(n,s.ResourceType.Source).url);s.getVideo(this.urls,(n,a)=>{this._loaded=!0,n?this.fire(new s.ErrorEvent(n)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(c){if(this.video){const n=this.video.seekable;c<n.start(0)||c>n.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=c}}getVideo(){return this.video}onAdd(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const c=this.map.painter.context,n=c.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new s.Texture(c,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(c)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:ge,canvas:class extends ge{constructor(c,n,a,h){super(c,n,a,h),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(_=>typeof _!="number"))||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${c}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${c}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${c}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof s.window.HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${c}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${c}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof s.window.HTMLCanvasElement?this.options.canvas:s.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.Texture(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const c of[this.canvas.width,this.canvas.height])if(isNaN(c)||c<=0)return!0;return!1}},custom:class extends s.Evented{constructor(c,n,a,h){super(),this.id=c,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=n,this.setEventedParent(h),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new nr(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.coveringTiles=this._coveringTiles.bind(this),s.extend(this,s.pick(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(c){this._map=c,this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(c),this.load()}onRemove(c){this._implementation.onRemove&&this._implementation.onRemove(c)}hasTile(c){if(this._implementation.hasTile){const{x:n,y:a,z:h}=c.canonical;return this._implementation.hasTile({x:n,y:a,z:h})}return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,n){const{x:a,y:h,z:m}=c.tileID.canonical,_=new s.window.AbortController,b=this._implementation.loadTile({x:a,y:h,z:m},{signal:_.signal});if(!b)return this.loadTileData(c,{width:this.tileSize,height:this.tileSize,data:null}),c.state="loaded",n(null);b.cancel=()=>_.abort(),c.request=b.then(function(T){return delete c.request,c.aborted?(c.state="unloaded",n(null)):T?function(S){return S instanceof s.window.ImageData||S instanceof s.window.ImageBitmap||S instanceof s.window.HTMLCanvasElement}(T)?(this.loadTileData(c,T),c.state="loaded",void n(null)):(c.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(c,{width:this.tileSize,height:this.tileSize,data:null}),c.state="loaded",n(null))}.bind(this)).catch(T=>{T.code!==20&&(c.state="errored",n(T))})}loadTileData(c,n){ie.loadTileData(c,n,this._map.painter)}unloadTileData(c){ie.unloadTileData(c,this._map.painter)}prepareTile(c){if(!this._implementation.prepareTile)return null;const{x:n,y:a,z:h}=c.tileID.canonical,m=this._implementation.prepareTile({x:n,y:a,z:h});return m?(this.loadTileData(c,m),c.state="loaded",m):null}unloadTile(c,n){if(this.unloadTileData(c),this._implementation.unloadTile){const{x:a,y:h,z:m}=c.tileID.canonical;this._implementation.unloadTile({x:a,y:h,z:m})}n()}abortTile(c,n){c.request&&c.request.cancel&&(c.request.cancel(),delete c.request),n()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(c=>({x:c.canonical.x,y:c.canonical.y,z:c.canonical.z}))}_update(){this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}}},we=function(c,n,a,h){const m=new pe[n.type](c,n,a,h);if(m.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${m.id}`);return s.bindAll(["load","abort","unload","serialize","prepare"],m),m};function We(c,n){const a=s.identity([]);return s.scale(a,a,[.5*c.width,.5*-c.height,1]),s.translate(a,a,[1,-1,0]),s.multiply(a,a,c.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(a)}function wt(c,n,a,h,m,_,b,T=!1){const S=c.tilesIn(h,b,T);S.sort(Ut);const I=[];for(const R of S)I.push({wrappedTileID:R.tile.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(n,a,c._state,R,m,_,We(c.transform,R.tile.tileID),T)});const k=function(R){const U={},W={};for(const j of R){const $=j.queryResults,q=j.wrappedTileID,N=W[q]=W[q]||{};for(const J in $){const X=$[J],ue=N[J]=N[J]||{},le=U[J]=U[J]||[];for(const re of X)ue[re.featureIndex]||(ue[re.featureIndex]=!0,le.push(re))}}return U}(I);for(const R in k)k[R].forEach(U=>{const W=U.feature,j=W.layer;j&&j.type!=="background"&&j.type!=="sky"&&(W.source=j.source,j["source-layer"]&&(W.sourceLayer=j["source-layer"]),W.state=W.id!==void 0?c.getFeatureState(j["source-layer"],W.id):{})});return k}function et(c,n){const a=c.getRenderableIds().map(_=>c.getTileByID(_)),h=[],m={};for(let _=0;_<a.length;_++){const b=a[_],T=b.tileID.canonical.key;m[T]||(m[T]=!0,b.querySourceFeatures(h,n))}return h}function Ut(c,n){const a=c.tileID,h=n.tileID;return a.overscaledZ-h.overscaledZ||a.canonical.y-h.canonical.y||a.wrap-h.wrap||a.canonical.x-h.canonical.x}function Nt(){return Ca.workerClass!=null?new Ca.workerClass:new s.window.Worker(Ca.workerUrl)}const Pt="mapboxgl_preloaded_worker_pool";class jt{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<jt.workerCount;)this.workers.push(new Nt);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Pt]}numActive(){return Object.keys(this.active).length}}let ei;function Ti(){return ei||(ei=new jt),ei}function zi(c,n){const a={};for(const h in c)h!=="ref"&&(a[h]=c[h]);return s.refProperties.forEach(h=>{h in n&&(a[h]=n[h])}),a}function Ei(c){c=c.slice();const n=Object.create(null);for(let a=0;a<c.length;a++)n[c[a].id]=c[a];for(let a=0;a<c.length;a++)"ref"in c[a]&&(c[a]=zi(c[a],n[c[a].ref]));return c}jt.workerCount=2;const Ft={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Re(c,n,a){a.push({command:Ft.addSource,args:[c,n[c]]})}function rr(c,n,a){n.push({command:Ft.removeSource,args:[c]}),a[c]=!0}function Ki(c,n,a,h){rr(c,a,h),Re(c,n,a)}function uo(c,n,a){let h;for(h in c[a])if(c[a].hasOwnProperty(h)&&h!=="data"&&!B(c[a][h],n[a][h]))return!1;for(h in n[a])if(n[a].hasOwnProperty(h)&&h!=="data"&&!B(c[a][h],n[a][h]))return!1;return!0}function tl(c,n,a,h,m,_){let b;for(b in n=n||{},c=c||{})c.hasOwnProperty(b)&&(B(c[b],n[b])||a.push({command:_,args:[h,b,n[b],m]}));for(b in n)n.hasOwnProperty(b)&&!c.hasOwnProperty(b)&&(B(c[b],n[b])||a.push({command:_,args:[h,b,n[b],m]}))}function Tr(c){return c.id}function il(c,n){return c[n.id]=n,c}class Ff{constructor(n,a){this.reset(n,a)}reset(n,a){this.points=n||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=s.clamp(n,0,1);let a=1,h=this._distances[a];const m=n*this.paddedLength+this.padding;for(;h<m&&a<this._distances.length;)h=this._distances[++a];const _=a-1,b=this._distances[_],T=h-b,S=T>0?(m-b)/T:0;return this.points[_].mult(1-S).add(this.points[a].mult(S))}}class hs{constructor(n,a,h){const m=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(n/h),this.yCellCount=Math.ceil(a/h);for(let b=0;b<this.xCellCount*this.yCellCount;b++)m.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=a,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,a,h,m,_){this._forEachCell(a,h,m,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(_)}insertCircle(n,a,h,m){this._forEachCell(a-m,h-m,a+m,h+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(a),this.circles.push(h),this.circles.push(m)}_insertBoxCell(n,a,h,m,_,b){this.boxCells[_].push(b)}_insertCircleCell(n,a,h,m,_,b){this.circleCells[_].push(b)}_query(n,a,h,m,_,b){if(h<0||n>this.width||m<0||a>this.height)return!_&&[];const T=[];if(n<=0&&a<=0&&this.width<=h&&this.height<=m){if(_)return!0;for(let S=0;S<this.boxKeys.length;S++)T.push({key:this.boxKeys[S],x1:this.bboxes[4*S],y1:this.bboxes[4*S+1],x2:this.bboxes[4*S+2],y2:this.bboxes[4*S+3]});for(let S=0;S<this.circleKeys.length;S++){const I=this.circles[3*S],k=this.circles[3*S+1],R=this.circles[3*S+2];T.push({key:this.circleKeys[S],x1:I-R,y1:k-R,x2:I+R,y2:k+R})}return b?T.filter(b):T}return this._forEachCell(n,a,h,m,this._queryCell,T,{hitTest:_,seenUids:{box:{},circle:{}}},b),_?T.length>0:T}_queryCircle(n,a,h,m,_){const b=n-h,T=n+h,S=a-h,I=a+h;if(T<0||b>this.width||I<0||S>this.height)return!m&&[];const k=[];return this._forEachCell(b,S,T,I,this._queryCellCircle,k,{hitTest:m,circle:{x:n,y:a,radius:h},seenUids:{box:{},circle:{}}},_),m?k.length>0:k}query(n,a,h,m,_){return this._query(n,a,h,m,!1,_)}hitTest(n,a,h,m,_){return this._query(n,a,h,m,!0,_)}hitTestCircle(n,a,h,m){return this._queryCircle(n,a,h,!0,m)}_queryCell(n,a,h,m,_,b,T,S){const I=T.seenUids,k=this.boxCells[_];if(k!==null){const U=this.bboxes;for(const W of k)if(!I.box[W]){I.box[W]=!0;const j=4*W;if(n<=U[j+2]&&a<=U[j+3]&&h>=U[j+0]&&m>=U[j+1]&&(!S||S(this.boxKeys[W]))){if(T.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[W],x1:U[j],y1:U[j+1],x2:U[j+2],y2:U[j+3]})}}}const R=this.circleCells[_];if(R!==null){const U=this.circles;for(const W of R)if(!I.circle[W]){I.circle[W]=!0;const j=3*W;if(this._circleAndRectCollide(U[j],U[j+1],U[j+2],n,a,h,m)&&(!S||S(this.circleKeys[W]))){if(T.hitTest)return b.push(!0),!0;{const $=U[j],q=U[j+1],N=U[j+2];b.push({key:this.circleKeys[W],x1:$-N,y1:q-N,x2:$+N,y2:q+N})}}}}}_queryCellCircle(n,a,h,m,_,b,T,S){const I=T.circle,k=T.seenUids,R=this.boxCells[_];if(R!==null){const W=this.bboxes;for(const j of R)if(!k.box[j]){k.box[j]=!0;const $=4*j;if(this._circleAndRectCollide(I.x,I.y,I.radius,W[$+0],W[$+1],W[$+2],W[$+3])&&(!S||S(this.boxKeys[j])))return b.push(!0),!0}}const U=this.circleCells[_];if(U!==null){const W=this.circles;for(const j of U)if(!k.circle[j]){k.circle[j]=!0;const $=3*j;if(this._circlesCollide(W[$],W[$+1],W[$+2],I.x,I.y,I.radius)&&(!S||S(this.circleKeys[j])))return b.push(!0),!0}}}_forEachCell(n,a,h,m,_,b,T,S){const I=this._convertToXCellCoord(n),k=this._convertToYCellCoord(a),R=this._convertToXCellCoord(h),U=this._convertToYCellCoord(m);for(let W=I;W<=R;W++)for(let j=k;j<=U;j++)if(_.call(this,n,a,h,m,this.xCellCount*j+W,b,T,S))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,a,h,m,_,b){const T=m-n,S=_-a,I=h+b;return I*I>T*T+S*S}_circleAndRectCollide(n,a,h,m,_,b,T){const S=(b-m)/2,I=Math.abs(n-(m+S));if(I>S+h)return!1;const k=(T-_)/2,R=Math.abs(a-(_+k));if(R>k+h)return!1;if(I<=S||R<=k)return!0;const U=I-S,W=R-k;return U*U+W*W<=h*h}}const Tt=Math.tan(85*Math.PI/180);function ni(c,n,a,h,m,_,b){const T=s.create();if(a)if(_.name==="globe"){const S=s.calculateGlobeLabelMatrix(m,n);s.multiply(T,T,S)}else{const S=Qe([],b);T[0]=S[0],T[1]=S[1],T[4]=S[2],T[5]=S[3],h||s.rotateZ(T,T,m.angle)}else s.multiply(T,m.labelPlaneMatrix,c);return T}function ri(c,n,a,h,m,_,b){const T=ni(c,n,a,h,m,_,b);return _.name==="globe"&&a||(T[2]=T[6]=T[10]=T[14]=0),T}function Er(c,n,a,h,m,_,b){if(a){if(_.name==="globe"){const T=ni(c,n,a,h,m,_,b);return s.invert(T,T),s.multiply(T,c,T),T}{const T=s.clone(c),S=s.identity([]);return S[0]=b[0],S[1]=b[1],S[4]=b[2],S[5]=b[3],s.multiply(T,T,S),h||s.rotateZ(T,T,-m.angle),T}}return m.glCoordMatrix}function Sr(c,n,a=0){const h=[c.x,c.y,a,1];a?s.transformMat4$1(h,h,n):Ln(h,h,n);const m=h[3];return{point:[h[0]/m,h[1]/m,h[2]/m],signedDistanceFromCamera:m}}function Kt(c,n){const a=[c[0],c[1],c[2],1];s.transformMat4$1(a,a,n);const h=a[3];return{point:[a[0]/h,a[1]/h,a[2]/h],signedDistanceFromCamera:h}}function Js(c,n){return Math.min(.5+c/n*.5,1.5)}function Qs(c,n){const a=c[0]/c[3],h=c[1]/c[3];return a>=-n[0]&&a<=n[0]&&h>=-n[1]&&h<=n[1]}function ea(c,n,a,h,m,_,b,T,S,I){const k=a.transform,R=h?c.textSizeData:c.iconSizeData,U=s.evaluateSizeForZoom(R,a.transform.zoom),W=k.projection.name==="globe",j=[256/a.width*2+1,256/a.height*2+1],$=h?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;$.clear();let q=null;W&&(q=h?c.text.globeExtVertexArray:c.icon.globeExtVertexArray);const N=c.lineVertexArray,J=h?c.text.placedSymbolArray:c.icon.placedSymbolArray,X=a.transform.width/a.transform.height;let ue=!1;for(let le=0;le<J.length;le++){const re=J.get(le);if(re.writingMode!==s.WritingMode.vertical||ue||le!==0&&J.get(le-1).writingMode===s.WritingMode.horizontal||(ue=!0),(re.hidden||re.writingMode===s.WritingMode.vertical)&&!ue){fo(re.numGlyphs,$);continue}ue=!1;const ce=new s.pointGeometry(re.tileAnchorX,re.tileAnchorY),ae=S?S(ce):[0,0,0],me=k.projection.projectTilePoint(ce.x,ce.y,I.canonical),Ce=[me.x+ae[0],me.y+ae[1],me.z+ae[2]],rt=[...Ce,1];if(s.transformMat4$1(rt,rt,n),!Qs(rt,j)){fo(re.numGlyphs,$);continue}const xe=Js(a.transform.cameraToCenterDistance,rt[3]),Ve=s.evaluateSizeForFeature(R,U,re),Ge=b?Ve/xe:Ve*xe,pt=Sr(new s.pointGeometry(Ce[0],Ce[1]),m,Ce[2]);if(pt.signedDistanceFromCamera<=0){fo(re.numGlyphs,$);continue}let Le={};const lt=b?null:S,qe=gh(re,Ge,!1,T,n,m,_,c.glyphOffsetArray,N,$,q,pt.point,ce,Le,X,lt,k.projection,I,b);ue=qe.useVertical,lt&&qe.needsFlipping&&(Le={}),(qe.notEnoughRoom||ue||qe.needsFlipping&&gh(re,Ge,!0,T,n,m,_,c.glyphOffsetArray,N,$,q,pt.point,ce,Le,X,lt,k.projection,I,b).notEnoughRoom)&&fo(re.numGlyphs,$)}h?(c.text.dynamicLayoutVertexBuffer.updateData($),q&&c.text.globeExtVertexBuffer.updateData(q)):(c.icon.dynamicLayoutVertexBuffer.updateData($),q&&c.icon.globeExtVertexBuffer.updateData(q))}function or(c,n,a,h,m,_,b,T,S,I,k,R,U,W,j,$){const q=T.glyphStartIndex+T.numGlyphs,N=T.lineStartIndex,J=T.lineStartIndex+T.lineLength,X=n.getoffsetX(T.glyphStartIndex),ue=n.getoffsetX(q-1),le=ho(c*X,a,h,m,_,b,T.segment,N,J,S,I,k,R,U,!0,W,j,$);if(!le)return null;const re=ho(c*ue,a,h,m,_,b,T.segment,N,J,S,I,k,R,U,!0,W,j,$);return re?{first:le,last:re}:null}function Zi(c,n,a,h){return c.writingMode===s.WritingMode.horizontal&&Math.abs(a.y-n.y)>Math.abs(a.x-n.x)*h?{useVertical:!0}:c.writingMode===s.WritingMode.vertical?n.y<a.y?{needsFlipping:!0}:null:c.flipState!==0&&function(m,_,b){const T=(_.x-m.x)*b;return T===0||Math.abs((_.y-m.y)/T)>Tt}(n,a,h)?c.flipState===1?{needsFlipping:!0}:null:n.x>a.x?{needsFlipping:!0}:null}function gh(c,n,a,h,m,_,b,T,S,I,k,R,U,W,j,$,q,N,J){const X=n/24,ue=c.lineOffsetX*X,le=c.lineOffsetY*X;let re;if(c.numGlyphs>1){const ce=c.glyphStartIndex+c.numGlyphs,ae=c.lineStartIndex,me=c.lineStartIndex+c.lineLength,Ce=or(X,T,ue,le,a,R,U,c,S,_,W,$,!1,q,N,J);if(!Ce)return{notEnoughRoom:!0};const rt=Kt(Ce.first.point,b).point,xe=Kt(Ce.last.point,b).point,Ve=new s.pointGeometry(rt[0],rt[1]),Ge=new s.pointGeometry(xe[0],xe[1]);if(h&&!a){const pt=Zi(c,Ve,Ge,j);if(c.flipState=pt&&pt.needsFlipping?1:2,pt)return pt}re=[Ce.first];for(let pt=c.glyphStartIndex+1;pt<ce-1;pt++)re.push(ho(X*T.getoffsetX(pt),ue,le,a,R,U,c.segment,ae,me,S,_,W,$,!1,!1,q,N,J));re.push(Ce.last)}else{if(h&&!a){const ae=Sr(U,m).point,me=c.lineStartIndex+c.segment+1,Ce=new s.pointGeometry(S.getx(me),S.gety(me)),rt=Sr(Ce,m),xe=rt.signedDistanceFromCamera>0?rt.point:nl(U,Ce,ae,1,m,void 0,q,N.canonical),Ve=Zi(c,new s.pointGeometry(ae[0],ae[1]),new s.pointGeometry(xe[0],xe[1]),j);if(c.flipState=Ve&&Ve.needsFlipping?1:2,Ve)return Ve}const ce=ho(X*T.getoffsetX(c.glyphStartIndex),ue,le,a,R,U,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,S,_,W,$,!1,!1,q,N,J);if(!ce)return{notEnoughRoom:!0};re=[ce]}if(k)for(const ce of re)s.updateGlobeVertexNormal(k,I.length+0,ce.up[0],ce.up[1],ce.up[2]),s.updateGlobeVertexNormal(k,I.length+1,ce.up[0],ce.up[1],ce.up[2]),s.updateGlobeVertexNormal(k,I.length+2,ce.up[0],ce.up[1],ce.up[2]),s.updateGlobeVertexNormal(k,I.length+3,ce.up[0],ce.up[1],ce.up[2]),s.addDynamicAttributes(I,ce.point[0],ce.point[1],ce.point[2],ce.angle);else for(const ce of re)s.addDynamicAttributes(I,ce.point[0],ce.point[1],ce.point[2],ce.angle);return{}}function ds(c,n,a,h,m){const _=h.projectTilePoint(c.x,c.y,n);if(!m)return Sr(_,a,_.z);const b=m(c);return Sr(new s.pointGeometry(_.x+b[0],_.y+b[1]),a,_.z+b[2])}function nl(c,n,a,h,m,_,b,T){const S=ds(c.add(c.sub(n)._unit()),T,m,b,_).point,I=s.sub([],a,S);return s.scaleAndAdd([],a,I,h/s.length(I))}function ho(c,n,a,h,m,_,b,T,S,I,k,R,U,W,j,$,q,N){const J=h?c-n:c+n;let X=J>0?1:-1,ue=0;h&&(X*=-1,ue=Math.PI),X<0&&(ue+=Math.PI);let le=X>0?T+b:T+b+1,re=m,ce=m,ae=0,me=0;const Ce=Math.abs(J),rt=[],xe=[];let Ve=_;const Ge=()=>{const zt=le-X;return ae===0?_:new s.pointGeometry(I.getx(zt),I.gety(zt))},pt=()=>nl(Ge(),Ve,ce,Ce-ae+1,k,U,$,q.canonical);for(;ae+me<=Ce;){if(le+=X,le<T||le>=S)return null;if(ce=re,rt.push(re),W&&xe.push(Ve||Ge()),re=R[le],re===void 0){Ve=new s.pointGeometry(I.getx(le),I.gety(le));const zt=ds(Ve,q.canonical,k,$,U);re=zt.signedDistanceFromCamera>0?R[le]=zt.point:pt()}else Ve=null;ae+=me,me=s.distance(ce,re)}Ve=Ve||new s.pointGeometry(I.getx(le),I.gety(le));const Le=Ge();j&&U&&(R[le]=re=R[le]===void 0?re:pt(),me=s.distance(ce,re));const lt=(Ce-ae)/me,qe=Ve.sub(Le).mult(lt)._add(Le),vt=s.sub([],re,ce),_t=s.scaleAndAdd([],ce,vt,lt);let It=[0,0,1],Lt=vt[0],qt=vt[1];if(N&&(It=$.upVector(q.canonical,qe.x,qe.y),It[0]!==0||It[1]!==0||It[2]!==1)){const zt=[1,0,0],Xt=[0,1,0];zt[0]=It[2],zt[1]=0,zt[2]=-It[0],s.cross(Xt,It,zt),s.normalize(zt,zt),s.normalize(Xt,Xt),Lt=s.dot(vt,zt),qt=s.dot(vt,Xt)}if(a){const zt=s.cross([],It,vt);s.normalize(zt,zt),s.scaleAndAdd(_t,_t,zt,a*X)}const li=ue+Math.atan2(qt,Lt);return rt.push(_t),W&&xe.push(qe),{point:_t,angle:li,path:rt,tilePath:xe,up:It}}const bc=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function fo(c,n){for(let a=0;a<c;a++){const h=n.length;n.resize(h+4),n.float32.set(bc,4*h)}}function Ln(c,n,a){const h=n[0],m=n[1];return c[0]=a[0]*h+a[4]*m+a[12],c[1]=a[1]*h+a[5]*m+a[13],c[3]=a[3]*h+a[7]*m+a[15],c}const Ai=100;class wc{constructor(n,a,h=new hs(n.width+200,n.height+200,25),m=new hs(n.width+200,n.height+200,25)){this.transform=n,this.grid=h,this.ignoredGrid=m,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+Ai,this.screenBottomBoundary=n.height+Ai,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=a}placeCollisionBox(n,a,h,m,_,b,T,S){let I=h.projectedAnchorX,k=h.projectedAnchorY,R=h.projectedAnchorZ;const U=h.elevation,W=h.tileID;if(U&&W){const le=n.getProjection().upVector(W.canonical,h.tileAnchorX,h.tileAnchorY),re=n.getProjection().upVectorScale(W.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;I+=le[0]*U*re,k+=le[1]*U*re,R+=le[2]*U*re}const j=this.projectAndGetPerspectiveRatio(T,[I,k,R],h.tileID,n.projection.name==="globe"||!!U||this.transform.pitch>0,n.getProjection()),$=b*j.perspectiveRatio,q=(h.x1*a+m.x-h.padding)*$+j.point.x,N=(h.y1*a+m.y-h.padding)*$+j.point.y,J=(h.x2*a+m.x+h.padding)*$+j.point.x,X=(h.y2*a+m.y+h.padding)*$+j.point.y,ue=j.perspectiveRatio<=.55||j.occluded;return!this.isInsideGrid(q,N,J,X)||!_&&this.grid.hitTest(q,N,J,X,S)||ue?{box:[],offscreen:!1,occluded:j.occluded}:{box:[q,N,J,X],offscreen:this.isOffscreen(q,N,J,X),occluded:!1}}placeCollisionCircles(n,a,h,m,_,b,T,S,I,k,R,U,W,j,$){const q=[],N=this.transform.elevation,J=N?N.getAtTileOffsetFunc($,this.transform.center.lat,this.transform.worldSize,n.getProjection()):Le=>[0,0,0],X=new s.pointGeometry(h.tileAnchorX,h.tileAnchorY),ue=n.getProjection().projectTilePoint(h.tileAnchorX,h.tileAnchorY,$.canonical),le=J(X),re=[ue.x+le[0],ue.y+le[1],ue.z+le[2]],ce=n.projection.name==="globe",ae=this.projectAndGetPerspectiveRatio(T,[re[0],re[1],re[2]],$,ce||!!N||this.transform.pitch>0,n.getProjection()),{perspectiveRatio:me}=ae,Ce=(R?b/me:b*me)/s.ONE_EM,rt=Sr(new s.pointGeometry(re[0],re[1]),S,re[2]).point,xe=ae.signedDistanceFromCamera>0?or(Ce,_,h.lineOffsetX*Ce,h.lineOffsetY*Ce,!1,rt,X,h,m,S,{},N&&!R?J:null,R&&!!N,n.getProjection(),$,R):null;let Ve=!1,Ge=!1,pt=!0;if(xe&&!ae.occluded){const Le=.5*W*me+j,lt=new s.pointGeometry(-100,-100),qe=new s.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),vt=new Ff,_t=xe.first,It=xe.last;let Lt=[];for(let zt=_t.path.length-1;zt>=1;zt--)Lt.push(_t.path[zt]);for(let zt=1;zt<It.path.length;zt++)Lt.push(It.path[zt]);const qt=2.5*Le;if(I){const zt=Lt.map(N&&!ce?(Xt,pi)=>{const Vi=J(pi<_t.path.length-1?_t.tilePath[_t.path.length-1-pi]:It.tilePath[pi-_t.path.length+2]);return Xt[2]=Vi[2],Kt(Xt,I)}:Xt=>Kt(Xt,I));Lt=zt.some(Xt=>Xt.signedDistanceFromCamera<=0)?[]:zt.map(Xt=>Xt.point)}let li=[];if(Lt.length>0){const zt=Lt.map(Mi=>new s.pointGeometry(Mi[0],Mi[1]));let Xt=1/0,pi=-1/0,Vi=1/0,Yi=-1/0;for(let Mi=0;Mi<zt.length;Mi++)Xt=Math.min(Xt,zt[Mi].x),Vi=Math.min(Vi,zt[Mi].y),pi=Math.max(pi,zt[Mi].x),Yi=Math.max(Yi,zt[Mi].y);li=Xt>=lt.x&&pi<=qe.x&&Vi>=lt.y&&Yi<=qe.y?[zt]:pi<lt.x||Xt>qe.x||Yi<lt.y||Vi>qe.y?[]:s.clipLine([zt],lt.x,lt.y,qe.x,qe.y)}for(const zt of li){vt.reset(zt,.25*Le);let Xt=0;Xt=vt.length<=.5*Le?1:Math.ceil(vt.paddedLength/qt)+1;for(let pi=0;pi<Xt;pi++){const Vi=pi/Math.max(Xt-1,1),Yi=vt.lerp(Vi),Mi=Yi.x+Ai,_n=Yi.y+Ai;q.push(Mi,_n,Le,0);const Mr=Mi-Le,Wr=_n-Le,Ni=Mi+Le,$i=_n+Le;if(pt=pt&&this.isOffscreen(Mr,Wr,Ni,$i),Ge=Ge||this.isInsideGrid(Mr,Wr,Ni,$i),!a&&this.grid.hitTestCircle(Mi,_n,Le,U)&&(Ve=!0,!k))return{circles:[],offscreen:!1,collisionDetected:Ve,occluded:!1}}}}return{circles:!k&&Ve||!Ge?[]:q,offscreen:pt,collisionDetected:Ve,occluded:ae.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let h=1/0,m=1/0,_=-1/0,b=-1/0;for(const k of n){const R=new s.pointGeometry(k.x+Ai,k.y+Ai);h=Math.min(h,R.x),m=Math.min(m,R.y),_=Math.max(_,R.x),b=Math.max(b,R.y),a.push(R)}const T=this.grid.query(h,m,_,b).concat(this.ignoredGrid.query(h,m,_,b)),S={},I={};for(const k of T){const R=k.key;if(S[R.bucketInstanceId]===void 0&&(S[R.bucketInstanceId]={}),S[R.bucketInstanceId][R.featureIndex])continue;const U=[new s.pointGeometry(k.x1,k.y1),new s.pointGeometry(k.x2,k.y1),new s.pointGeometry(k.x2,k.y2),new s.pointGeometry(k.x1,k.y2)];s.polygonIntersectsPolygon(a,U)&&(S[R.bucketInstanceId][R.featureIndex]=!0,I[R.bucketInstanceId]===void 0&&(I[R.bucketInstanceId]=[]),I[R.bucketInstanceId].push(R.featureIndex))}return I}insertCollisionBox(n,a,h,m,_){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:m,collisionGroupID:_},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,a,h,m,_){const b=a?this.ignoredGrid:this.grid,T={bucketInstanceId:h,featureIndex:m,collisionGroupID:_};for(let S=0;S<n.length;S+=4)b.insertCircle(T,n[S],n[S+1],n[S+2])}projectAndGetPerspectiveRatio(n,a,h,m,_){const b=[a[0],a[1],a[2],1];let T=!1;if(a[2]||this.transform.pitch>0){s.transformMat4$1(b,b,n);const S=_.name==="globe";this.fogState&&h&&!S&&(T=function(I,k,R,U,W,j){const $=j.calculateFogTileMatrix(W),q=[k,R,U];return s.transformMat4(q,q,$),Mt(I,q,j.pitch,j._fov)}(this.fogState,a[0],a[1],a[2],h.toUnwrapped(),this.transform)>.9)}else Ln(b,b,n);return{point:new s.pointGeometry((b[0]/b[3]+1)/2*this.transform.width+Ai,(-b[1]/b[3]+1)/2*this.transform.height+Ai),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(_)/b[3]*.5,1.5),signedDistanceFromCamera:b[3],occluded:m&&b[2]>b[3]||T}}isOffscreen(n,a,h,m){return h<Ai||n>=this.screenRightBoundary||m<Ai||a>this.screenBottomBoundary}isInsideGrid(n,a,h,m){return h>=0&&n<this.gridRightBoundary&&m>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const n=s.identity([]);return s.translate(n,n,[-100,-100,0]),n}}function ta(c,n,a){const h=n.createTileMatrix(c,c.worldSize,a.toUnwrapped());return s.multiply(new Float32Array(16),c.projMatrix,h)}function Zn(c,n,a){if(n.projection.name===a.projection.name)return c.projMatrix;const h=a.clone();return h.setProjection(n.projection),ta(h,n.getProjection(),c)}function Wn(c,n,a){return n.name===a.projection.name?c.projMatrix:ta(a,n,c)}class Tc{constructor(n,a,h,m){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?a:-a))):m&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class po{constructor(n,a,h,m,_,b=!1){this.text=new Tc(n?n.text:null,a,h,_),this.icon=new Tc(n?n.icon:null,a,m,_),this.clipped=b}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Qi{constructor(n,a,h,m=!1){this.text=n,this.icon=a,this.skipFade=h,this.clipped=m}}class ia{constructor(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]}}class Ec{constructor(n,a,h,m,_){this.bucketInstanceId=n,this.featureIndex=a,this.sourceLayerIndex=h,this.bucketIndex=m,this.tileID=_}}class na{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const a=++this.maxGroupID;this.collisionGroups[n]={ID:a,predicate:h=>h.collisionGroupID===a}}return this.collisionGroups[n]}}function fn(c,n,a,h,m){const{horizontalAlign:_,verticalAlign:b}=s.getAnchorAlignment(c),T=-(_-.5)*n,S=-(b-.5)*a,I=s.evaluateVariableOffset(c,h);return new s.pointGeometry(T+I[0]*m,S+I[1]*m)}function ra(c,n,a,h,m){const _=new s.pointGeometry(c,n);return a&&_._rotate(h?m:-m),_}class Sc{constructor(n,a,h,m,_){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new wc(this.transform,_),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new na(h),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,a,h,m){const _=h.getBucket(a),b=h.latestFeatureIndex;if(!_||!b||a.id!==_.layerIds[0])return;const T=_.layers[0].layout,S=h.collisionBoxArray,I=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),k=h.tileSize/s.EXTENT,R=h.tileID.toUnwrapped();this.transform.setProjection(_.projection);const U=(W=h.tileID,j=_.getProjection(),$=this.transform,j.name===this.projection?$.calculateProjMatrix(W.toUnwrapped()):ta($,j,W));var W,j,$;const q=T.get("text-pitch-alignment")==="map",N=T.get("text-rotation-alignment")==="map";a.compileFilter();const J=a.dynamicFilter(),X=a.dynamicFilterNeedsFeature(),ue=this.transform.calculatePixelsToTileUnitsMatrix(h),le=ri(U,h.tileID.canonical,q,N,this.transform,_.getProjection(),ue);let re=null;if(q){const me=Er(U,h.tileID.canonical,q,N,this.transform,_.getProjection(),ue);re=s.multiply([],this.transform.labelPlaneMatrix,me)}let ce=null;J&&h.latestFeatureIndex&&(ce={unwrappedTileID:R,dynamicFilter:J,dynamicFilterNeedsFeature:X,featureIndex:h.latestFeatureIndex}),this.retainedQueryData[_.bucketInstanceId]=new Ec(_.bucketInstanceId,b,_.sourceLayerIndex,_.index,h.tileID);const ae={bucket:_,layout:T,posMatrix:U,textLabelPlaneMatrix:le,labelToScreenMatrix:re,clippingData:ce,scale:I,textPixelRatio:k,holdingForFade:h.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(_.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.evaluateSizeForZoom(_.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(m)for(const me of _.sortKeyRanges){const{sortKey:Ce,symbolInstanceStart:rt,symbolInstanceEnd:xe}=me;n.push({sortKey:Ce,symbolInstanceStart:rt,symbolInstanceEnd:xe,parameters:ae})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:ae})}attemptAnchorPlacement(n,a,h,m,_,b,T,S,I,k,R,U,W,j,$,q,N,J){const X=[U.textOffset0,U.textOffset1],ue=fn(n,h,m,X,_),le=this.collisionIndex.placeCollisionBox(j,_,a,ra(ue.x,ue.y,b,T,this.transform.angle),R,S,I,k.predicate);if((!q||this.collisionIndex.placeCollisionBox(j,j.getSymbolInstanceIconSize(J,this.transform.zoom,W),q,ra(ue.x,ue.y,b,T,this.transform.angle),R,S,I,k.predicate).box.length!==0)&&le.box.length>0){let re;return this.prevPlacement&&this.prevPlacement.variableOffsets[U.crossTileID]&&this.prevPlacement.placements[U.crossTileID]&&this.prevPlacement.placements[U.crossTileID].text&&(re=this.prevPlacement.variableOffsets[U.crossTileID].anchor),this.variableOffsets[U.crossTileID]={textOffset:X,width:h,height:m,anchor:n,textScale:_,prevAnchor:re},this.markUsedJustification(j,n,U,$),j.allowVerticalPlacement&&(this.markUsedOrientation(j,$,U),this.placedOrientations[U.crossTileID]=$),{shift:ue,placedGlyphBoxes:le}}}placeLayerBucketPart(n,a,h,m){const{bucket:_,layout:b,posMatrix:T,textLabelPlaneMatrix:S,labelToScreenMatrix:I,clippingData:k,textPixelRatio:R,holdingForFade:U,collisionBoxArray:W,partiallyEvaluatedTextSize:j,partiallyEvaluatedIconSize:$,collisionGroup:q}=n.parameters,N=b.get("text-optional"),J=b.get("icon-optional"),X=b.get("text-allow-overlap"),ue=b.get("icon-allow-overlap"),le=b.get("text-rotation-alignment")==="map",re=b.get("text-pitch-alignment")==="map",ce=b.get("icon-text-fit")!=="none",ae=b.get("symbol-z-order")==="viewport-y";this.transform.setProjection(_.projection);let me=X&&(ue||!_.hasIconData()||J),Ce=ue&&(X||!_.hasTextData()||N);!_.collisionArrays&&W&&_.deserializeCollisionBoxes(W),h&&m&&_.updateCollisionDebugBuffers(this.transform.zoom,W);const rt=(xe,Ve,Ge)=>{if(k){const Ni={zoom:this.transform.zoom,pitch:this.transform.pitch};let $i=null;if(k.dynamicFilterNeedsFeature){const ti=this.retainedQueryData[_.bucketInstanceId];$i=k.featureIndex.loadFeature({featureIndex:xe.featureIndex,bucketIndex:ti.bucketIndex,sourceLayerIndex:ti.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,k.dynamicFilter)(Ni,$i,this.retainedQueryData[_.bucketInstanceId].tileID.canonical,new s.pointGeometry(xe.tileAnchorX,xe.tileAnchorY),this.transform.calculateDistanceTileData(k.unwrappedTileID)))return this.placements[xe.crossTileID]=new Qi(!1,!1,!1,!0),void(a[xe.crossTileID]=!0)}if(a[xe.crossTileID])return;if(U)return void(this.placements[xe.crossTileID]=new Qi(!1,!1,!1));let pt=!1,Le=!1,lt=!0,qe=!1,vt=!1,_t=null,It={box:null,offscreen:null,occluded:null},Lt={box:null,offscreen:null,occluded:null},qt=null,li=null,zt=null,Xt=0,pi=0,Vi=0;Ge.textFeatureIndex?Xt=Ge.textFeatureIndex:xe.useRuntimeCollisionCircles&&(Xt=xe.featureIndex),Ge.verticalTextFeatureIndex&&(pi=Ge.verticalTextFeatureIndex);const Yi=Ni=>{Ni.tileID=this.retainedQueryData[_.bucketInstanceId].tileID,(this.transform.elevation||Ni.elevation)&&(Ni.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[_.bucketInstanceId].tileID,Ni.tileAnchorX,Ni.tileAnchorY):0)},Mi=Ge.textBox;if(Mi){Yi(Mi);const Ni=ti=>{let rn=s.WritingMode.horizontal;if(_.allowVerticalPlacement&&!ti&&this.prevPlacement){const Sn=this.prevPlacement.placedOrientations[xe.crossTileID];Sn&&(this.placedOrientations[xe.crossTileID]=Sn,rn=Sn,this.markUsedOrientation(_,rn,xe))}return rn},$i=(ti,rn)=>{if(_.allowVerticalPlacement&&xe.numVerticalGlyphVertices>0&&Ge.verticalTextBox){for(const Sn of _.writingModes)if(Sn===s.WritingMode.vertical?(It=rn(),Lt=It):It=ti(),It&&It.box&&It.box.length)break}else It=ti()};if(b.get("text-variable-anchor")){let ti=b.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[xe.crossTileID]){const Ri=this.prevPlacement.variableOffsets[xe.crossTileID];ti.indexOf(Ri.anchor)>0&&(ti=ti.filter(Cn=>Cn!==Ri.anchor),ti.unshift(Ri.anchor))}const rn=(Ri,Cn,No)=>{const Rn=_.getSymbolInstanceTextSize(j,xe,this.transform.zoom,Ve),jo=(Ri.x2-Ri.x1)*Rn+2*Ri.padding,$o=(Ri.y2-Ri.y1)*Rn+2*Ri.padding,qo=ce&&!ue?Cn:null;qo&&Yi(qo);let Bn={box:[],offscreen:!1,occluded:!1};const Go=X?2*ti.length:ti.length;for(let xo=0;xo<Go;++xo){const Aa=this.attemptAnchorPlacement(ti[xo%ti.length],Ri,jo,$o,Rn,le,re,R,T,q,xo>=ti.length,xe,Ve,_,No,qo,j,$);if(Aa&&(Bn=Aa.placedGlyphBoxes,Bn&&Bn.box&&Bn.box.length)){pt=!0,_t=Aa.shift;break}}return Bn};$i(()=>rn(Mi,Ge.iconBox,s.WritingMode.horizontal),()=>{const Ri=Ge.verticalTextBox;return Ri&&Yi(Ri),_.allowVerticalPlacement&&!(It&&It.box&&It.box.length)&&xe.numVerticalGlyphVertices>0&&Ri?rn(Ri,Ge.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),It&&(pt=It.box,lt=It.offscreen,qe=It.occluded);const Sn=Ni(It&&It.box);if(!pt&&this.prevPlacement){const Ri=this.prevPlacement.variableOffsets[xe.crossTileID];Ri&&(this.variableOffsets[xe.crossTileID]=Ri,this.markUsedJustification(_,Ri.anchor,xe,Sn))}}else{const ti=(rn,Sn)=>{const Ri=_.getSymbolInstanceTextSize(j,xe,this.transform.zoom,Ve),Cn=this.collisionIndex.placeCollisionBox(_,Ri,rn,new s.pointGeometry(0,0),X,R,T,q.predicate);return Cn&&Cn.box&&Cn.box.length&&(this.markUsedOrientation(_,Sn,xe),this.placedOrientations[xe.crossTileID]=Sn),Cn};$i(()=>ti(Mi,s.WritingMode.horizontal),()=>{const rn=Ge.verticalTextBox;return _.allowVerticalPlacement&&xe.numVerticalGlyphVertices>0&&rn?(Yi(rn),ti(rn,s.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Ni(It&&It.box&&It.box.length)}}if(qt=It,pt=qt&&qt.box&&qt.box.length>0,lt=qt&&qt.offscreen,qe=qt&&qt.occluded,xe.useRuntimeCollisionCircles){const Ni=_.text.placedSymbolArray.get(xe.centerJustifiedTextSymbolIndex>=0?xe.centerJustifiedTextSymbolIndex:xe.verticalPlacedTextSymbolIndex),$i=s.evaluateSizeForFeature(_.textSizeData,j,Ni),ti=b.get("text-padding");li=this.collisionIndex.placeCollisionCircles(_,X,Ni,_.lineVertexArray,_.glyphOffsetArray,$i,T,S,I,h,re,q.predicate,xe.collisionCircleDiameter*$i/s.ONE_EM,ti,this.retainedQueryData[_.bucketInstanceId].tileID),pt=X||li.circles.length>0&&!li.collisionDetected,lt=lt&&li.offscreen,qe=li.occluded}if(Ge.iconFeatureIndex&&(Vi=Ge.iconFeatureIndex),Ge.iconBox){const Ni=$i=>{Yi($i);const ti=ce&&_t?ra(_t.x,_t.y,le,re,this.transform.angle):new s.pointGeometry(0,0),rn=_.getSymbolInstanceIconSize($,this.transform.zoom,Ve);return this.collisionIndex.placeCollisionBox(_,rn,$i,ti,ue,R,T,q.predicate)};Lt&&Lt.box&&Lt.box.length&&Ge.verticalIconBox?(zt=Ni(Ge.verticalIconBox),Le=zt.box.length>0):(zt=Ni(Ge.iconBox),Le=zt.box.length>0),lt=lt&&zt.offscreen,vt=zt.occluded}const _n=N||xe.numHorizontalGlyphVertices===0&&xe.numVerticalGlyphVertices===0,Mr=J||xe.numIconVertices===0;if(_n||Mr?Mr?_n||(Le=Le&&pt):pt=Le&&pt:Le=pt=Le&&pt,pt&&qt&&qt.box&&this.collisionIndex.insertCollisionBox(qt.box,b.get("text-ignore-placement"),_.bucketInstanceId,Lt&&Lt.box&&pi?pi:Xt,q.ID),Le&&zt&&this.collisionIndex.insertCollisionBox(zt.box,b.get("icon-ignore-placement"),_.bucketInstanceId,Vi,q.ID),li&&(pt&&this.collisionIndex.insertCollisionCircles(li.circles,b.get("text-ignore-placement"),_.bucketInstanceId,Xt,q.ID),h)){const Ni=_.bucketInstanceId;let $i=this.collisionCircleArrays[Ni];$i===void 0&&($i=this.collisionCircleArrays[Ni]=new ia);for(let ti=0;ti<li.circles.length;ti+=4)$i.circles.push(li.circles[ti+0]),$i.circles.push(li.circles[ti+1]),$i.circles.push(li.circles[ti+2]),$i.circles.push(li.collisionDetected?1:0)}const Wr=_.projection.name!=="globe";me=me&&(Wr||!qe),Ce=Ce&&(Wr||!vt),this.placements[xe.crossTileID]=new Qi(pt||me,Le||Ce,lt||_.justReloaded),a[xe.crossTileID]=!0};if(ae){const xe=_.getSortedSymbolIndexes(this.transform.angle);for(let Ve=xe.length-1;Ve>=0;--Ve){const Ge=xe[Ve];rt(_.symbolInstances.get(Ge),Ge,_.collisionArrays[Ge])}}else for(let xe=n.symbolInstanceStart;xe<n.symbolInstanceEnd;xe++)rt(_.symbolInstances.get(xe),xe,_.collisionArrays[xe]);if(h&&_.bucketInstanceId in this.collisionCircleArrays){const xe=this.collisionCircleArrays[_.bucketInstanceId];s.invert(xe.invProjMatrix,T),xe.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(n,a,h,m){let _;_=m===s.WritingMode.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[s.getAnchorJustification(a)];const b=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];for(const T of b)T>=0&&(n.text.placedSymbolArray.get(T).crossTileID=_>=0&&T!==_?0:h.crossTileID)}markUsedOrientation(n,a,h){const m=a===s.WritingMode.horizontal||a===s.WritingMode.horizontalOnly?a:0,_=a===s.WritingMode.vertical?a:0,b=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];for(const T of b)n.text.placedSymbolArray.get(T).placedOrientation=m;h.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let h=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const m=a?a.symbolFadeChange(n):1,_=a?a.opacities:{},b=a?a.variableOffsets:{},T=a?a.placedOrientations:{};for(const S in this.placements){const I=this.placements[S],k=_[S];k?(this.opacities[S]=new po(k,m,I.text,I.icon,null,I.clipped),h=h||I.text!==k.text.placed||I.icon!==k.icon.placed):(this.opacities[S]=new po(null,m,I.text,I.icon,I.skipFade,I.clipped),h=h||I.text||I.icon)}for(const S in _){const I=_[S];if(!this.opacities[S]){const k=new po(I,m,!1,!1);k.isHidden()||(this.opacities[S]=k,h=h||I.text.placed||I.icon.placed)}}for(const S in b)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=b[S]);for(const S in T)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=T[S]);h?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:n)}updateLayerOpacities(n,a){const h={};for(const m of a){const _=m.getBucket(n);_&&m.latestFeatureIndex&&n.id===_.layerIds[0]&&this.updateBucketOpacities(_,h,m.collisionBoxArray)}}updateBucketOpacities(n,a,h){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const m=n.layers[0].layout,_=!!n.layers[0].dynamicFilter(),b=new po(null,0,!1,!1,!0),T=m.get("text-allow-overlap"),S=m.get("icon-allow-overlap"),I=m.get("text-variable-anchor"),k=m.get("text-rotation-alignment")==="map",R=m.get("text-pitch-alignment")==="map",U=m.get("icon-text-fit")!=="none",W=new po(null,0,T&&(S||!n.hasIconData()||m.get("icon-optional")),S&&(T||!n.hasTextData()||m.get("text-optional")),!0);!n.collisionArrays&&h&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(h);const j=(q,N,J)=>{for(let X=0;X<N/4;X++)q.opacityVertexArray.emplaceBack(J)};let $=0;for(let q=0;q<n.symbolInstances.length;q++){const N=n.symbolInstances.get(q),{numHorizontalGlyphVertices:J,numVerticalGlyphVertices:X,crossTileID:ue}=N;let le=this.opacities[ue];a[ue]?le=b:le||(le=W,this.opacities[ue]=le),a[ue]=!0;const re=J>0||X>0,ce=N.numIconVertices>0,ae=this.placedOrientations[N.crossTileID],me=ae===s.WritingMode.vertical,Ce=ae===s.WritingMode.horizontal||ae===s.WritingMode.horizontalOnly;if(!re&&!ce||le.isHidden()||$++,re){const rt=Fo(le.text);j(n.text,J,me?Cr:rt),j(n.text,X,Ce?Cr:rt);const xe=le.text.isHidden();[N.rightJustifiedTextSymbolIndex,N.centerJustifiedTextSymbolIndex,N.leftJustifiedTextSymbolIndex].forEach(pt=>{pt>=0&&(n.text.placedSymbolArray.get(pt).hidden=xe||me?1:0)}),N.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(N.verticalPlacedTextSymbolIndex).hidden=xe||Ce?1:0);const Ve=this.variableOffsets[N.crossTileID];Ve&&this.markUsedJustification(n,Ve.anchor,N,ae);const Ge=this.placedOrientations[N.crossTileID];Ge&&(this.markUsedJustification(n,"left",N,Ge),this.markUsedOrientation(n,Ge,N))}if(ce){const rt=Fo(le.icon);N.placedIconSymbolIndex>=0&&(j(n.icon,N.numIconVertices,me?Cr:rt),n.icon.placedSymbolArray.get(N.placedIconSymbolIndex).hidden=le.icon.isHidden()),N.verticalPlacedIconSymbolIndex>=0&&(j(n.icon,N.numVerticalIconVertices,Ce?Cr:rt),n.icon.placedSymbolArray.get(N.verticalPlacedIconSymbolIndex).hidden=le.icon.isHidden())}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const rt=n.collisionArrays[q];if(rt){let xe=new s.pointGeometry(0,0),Ve=!0;if(rt.textBox||rt.verticalTextBox){if(I){const pt=this.variableOffsets[ue];pt?(xe=fn(pt.anchor,pt.width,pt.height,pt.textOffset,pt.textScale),k&&xe._rotate(R?this.transform.angle:-this.transform.angle)):Ve=!1}_&&(Ve=!le.clipped),rt.textBox&&dr(n.textCollisionBox.collisionVertexArray,le.text.placed,!Ve||me,xe.x,xe.y),rt.verticalTextBox&&dr(n.textCollisionBox.collisionVertexArray,le.text.placed,!Ve||Ce,xe.x,xe.y)}const Ge=Ve&&Boolean(!Ce&&rt.verticalIconBox);rt.iconBox&&dr(n.iconCollisionBox.collisionVertexArray,le.icon.placed,Ge,U?xe.x:0,U?xe.y:0),rt.verticalIconBox&&dr(n.iconCollisionBox.collisionVertexArray,le.icon.placed,!Ge,U?xe.x:0,U?xe.y:0)}}}if(n.fullyClipped=$===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const q=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=q.invProjMatrix,n.placementViewportMatrix=q.viewportMatrix,n.collisionCircleArray=q.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,a){const h=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*h>n}setStale(){this.stale=!0}}function dr(c,n,a,h,m){c.emplaceBack(n?1:0,a?1:0,h||0,m||0),c.emplaceBack(n?1:0,a?1:0,h||0,m||0),c.emplaceBack(n?1:0,a?1:0,h||0,m||0),c.emplaceBack(n?1:0,a?1:0,h||0,m||0)}const oa=Math.pow(2,25),rl=Math.pow(2,24),Of=Math.pow(2,17),Cc=Math.pow(2,16),fs=Math.pow(2,9),Uf=Math.pow(2,8),yh=Math.pow(2,1);function Fo(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;const n=c.placed?1:0,a=Math.floor(127*c.opacity);return a*oa+n*rl+a*Of+n*Cc+a*fs+n*Uf+a*yh+n}const Cr=0;class ol{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(n,a,h,m,_){const b=this._bucketParts;for(;this._currentTileIndex<n.length;)if(a.getBucketParts(b,m,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort((T,S)=>T.sortKey-S.sortKey));this._currentPartIndex<b.length;){const T=b[this._currentPartIndex];if(a.placeLayerBucketPart(T,this._seenCrossTileIDs,h,T.symbolInstanceStart===0),this._currentPartIndex++,_())return!0}return!1}}class mo{constructor(n,a,h,m,_,b,T,S){this.placement=new Sc(n,_,b,T,S),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(n,a,h){const m=s.exported.now(),_=()=>{const b=s.exported.now()-m;return!this._forceFullPlacement&&b>2};for(;this._currentPlacementIndex>=0;){const b=a[n[this._currentPlacementIndex]],T=this.placement.collisionIndex.transform.zoom;if(b.type==="symbol"&&(!b.minzoom||b.minzoom<=T)&&(!b.maxzoom||b.maxzoom>T)){if(this._inProgressLayer||(this._inProgressLayer=new ol(b)),this._inProgressLayer.continuePlacement(h[b.source],this.placement,this._showCollisionBoxes,b,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const Ac=512/s.EXTENT/2;class sl{constructor(n,a,h){this.tileID=n,this.indexedSymbolInstances={},this.bucketInstanceId=h;for(let m=0;m<a.length;m++){const _=a.get(m),b=_.key;this.indexedSymbolInstances[b]||(this.indexedSymbolInstances[b]=[]),this.indexedSymbolInstances[b].push({crossTileID:_.crossTileID,coord:this.getScaledCoordinates(_,n)})}}getScaledCoordinates(n,a){const h=Ac/Math.pow(2,a.canonical.z-this.tileID.canonical.z);return{x:Math.floor((a.canonical.x*s.EXTENT+n.tileAnchorX)*h),y:Math.floor((a.canonical.y*s.EXTENT+n.tileAnchorY)*h)}}findMatches(n,a,h){const m=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let _=0;_<n.length;_++){const b=n.get(_);if(b.crossTileID)continue;const T=this.indexedSymbolInstances[b.key];if(!T)continue;const S=this.getScaledCoordinates(b,a);for(const I of T)if(Math.abs(I.coord.x-S.x)<=m&&Math.abs(I.coord.y-S.y)<=m&&!h[I.crossTileID]){h[I.crossTileID]=!0,b.crossTileID=I.crossTileID;break}}}}class Vf{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Nf{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const a=Math.round((n-this.lng)/360);if(a!==0)for(const h in this.indexes){const m=this.indexes[h],_={};for(const b in m){const T=m[b];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+a),_[T.tileID.key]=T}this.indexes[h]=_}this.lng=n}addBucket(n,a,h){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let _=0;_<a.symbolInstances.length;_++)a.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});const m=this.usedCrossTileIDs[n.overscaledZ];for(const _ in this.indexes){const b=this.indexes[_];if(Number(_)>n.overscaledZ)for(const T in b){const S=b[T];S.tileID.isChildOf(n)&&S.findMatches(a.symbolInstances,n,m)}else{const T=b[n.scaledTo(Number(_)).key];T&&T.findMatches(a.symbolInstances,n,m)}}for(let _=0;_<a.symbolInstances.length;_++){const b=a.symbolInstances.get(_);b.crossTileID||(b.crossTileID=h.generate(),m[b.crossTileID]=!0)}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new sl(n,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(n,a){for(const h in a.indexedSymbolInstances)for(const m of a.indexedSymbolInstances[h])delete this.usedCrossTileIDs[n][m.crossTileID]}removeStaleBuckets(n){let a=!1;for(const h in this.indexes){const m=this.indexes[h];for(const _ in m)n[m[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,m[_]),delete m[_],a=!0)}return a}}class al{constructor(){this.layerIndexes={},this.crossTileIDs=new Vf,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,a,h,m){let _=this.layerIndexes[n.id];_===void 0&&(_=this.layerIndexes[n.id]=new Nf);let b=!1;const T={};m.name!=="globe"&&_.handleWrapJump(h);for(const S of a){const I=S.getBucket(n);I&&n.id===I.layerIds[0]&&(I.bucketInstanceId||(I.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(S.tileID,I,this.crossTileIDs)&&(b=!0),T[I.bucketInstanceId]=!0)}return _.removeStaleBuckets(T)&&(b=!0),b}pruneUnusedLayers(n){const a={};n.forEach(h=>{a[h]=!0});for(const h in this.layerIndexes)a[h]||delete this.layerIndexes[h]}}const ll=(c,n)=>s.emitValidationErrors(c,n&&n.filter(a=>a.identifier!=="source.canvas")),xh=s.pick(Ft,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),jf=s.pick(Ft,["setCenter","setZoom","setBearing","setPitch"]),vh={version:8,layers:[],sources:{}},$f={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class fr extends s.Evented{constructor(n,a={}){super(),this.map=n,this.dispatcher=new _i(Ti(),this),this.imageManager=new dt,this.imageManager.setEventedParent(this),this.glyphManager=new s.GlyphManager(n._requestManager,a.localFontFamily?s.LocalGlyphMode.all:a.localIdeographFontFamily?s.LocalGlyphMode.ideographs:s.LocalGlyphMode.none,a.localFontFamily||a.localIdeographFontFamily),this.lineAtlas=new s.LineAtlas(256,512),this.crossTileSymbolIndex=new al,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new s.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());const h=this;this._rtlTextPluginCallback=fr.registerForPluginStateChange(m=>{h.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(_,b)=>{if(s.triggerPluginCompletionEvent(_),b&&b.every(T=>T))for(const T in h._sourceCaches){const S=h._sourceCaches[T],I=S.getSource().type;I!=="vector"&&I!=="geojson"||S.reload()}})}),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const _=this.getSource(m.sourceId);if(_&&_.vectorLayerIds)for(const b in this._layers){const T=this._layers[b];T.source===_.id&&this._validateLayer(T)}})}loadURL(n,a={}){this.fire(new s.Event("dataloading",{dataType:"style"}));const h=typeof a.validate=="boolean"?a.validate:!s.isMapboxURL(n);n=this.map._requestManager.normalizeStyleURL(n,a.accessToken);const m=this.map._requestManager.transformRequest(n,s.ResourceType.Style);this._request=s.getJSON(m,(_,b)=>{this._request=null,_?this.fire(new s.ErrorEvent(_)):b&&this._load(b,h)})}loadJSON(n,a={}){this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.exported.frame(()=>{this._request=null,this._load(n,a.validate!==!1)})}loadEmpty(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(vh,!1)}_updateLayerCount(n,a){const h=a?1:-1;n.is3D()&&(this._num3DLayers+=h),n.type==="circle"&&(this._numCircleLayers+=h),n.type==="symbol"&&(this._numSymbolLayers+=h)}_load(n,a){if(a&&ll(this,s.validateStyle(n)))return;this._loaded=!0,this.stylesheet=s.clone$1(n),this._updateMapProjection();for(const m in n.sources)this.addSource(m,n.sources[m],{validate:!1});this._changed=!1,n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(n.glyphs);const h=Ei(this.stylesheet.layers);this._order=h.map(m=>m.id),this._layers={},this._serializedLayers={};for(let m of h)m=s.createStyleLayer(m),m.setEventedParent(this,{layer:{id:m.id}}),this._layers[m.id]=m,this._serializedLayers[m.id]=m.serialize(),this._updateLayerCount(m,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ke(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(n){this._spriteRequest=function(a,h,m){let _,b,T;const S=s.exported.devicePixelRatio>1?"@2x":"";let I=s.getJSON(h.transformRequest(h.normalizeSpriteURL(a,S,".json"),s.ResourceType.SpriteJSON),(U,W)=>{I=null,T||(T=U,_=W,R())}),k=s.getImage(h.transformRequest(h.normalizeSpriteURL(a,S,".png"),s.ResourceType.SpriteImage),(U,W)=>{k=null,T||(T=U,b=W,R())});function R(){if(T)m(T);else if(_&&b){const U=s.exported.getImageData(b),W={};for(const j in _){const{width:$,height:q,x:N,y:J,sdf:X,pixelRatio:ue,stretchX:le,stretchY:re,content:ce}=_[j],ae=new s.RGBAImage({width:$,height:q});s.RGBAImage.copy(U,ae,{x:N,y:J},{x:0,y:0},{width:$,height:q}),W[j]={data:ae,pixelRatio:ue,sdf:X,stretchX:le,stretchY:re,content:ce}}m(null,W)}}return{cancel(){I&&(I.cancel(),I=null),k&&(k.cancel(),k=null)}}}(n,this.map._requestManager,(a,h)=>{if(this._spriteRequest=null,a)this.fire(new s.ErrorEvent(a));else if(h)for(const m in h)this.imageManager.addImage(m,h[m]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new s.Event("data",{dataType:"style"}))})}_validateLayer(n){const a=this.getSource(n.source);if(!a)return;const h=n.sourceLayer;h&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(h)===-1)&&this.fire(new s.ErrorEvent(new Error(`Source layer "${h}" does not exist on source "${a.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(n){const a=[];for(const h of n){const m=this._layers[h];m.type!=="custom"&&a.push(m.serialize())}return a}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(n){return!!this.terrain&&$f[n.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(n){if(!this._loaded)return;const a=this._changed;if(this._changed){const m=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(m.length||_.length)&&this._updateWorkerLayers(m,_);for(const b in this._updatedSources){const T=this._updatedSources[b];T==="reload"?this._reloadSource(b):T==="clear"&&this._clearSource(b)}this._updateTilesForChangedImages();for(const b in this._updatedPaintProps)this._layers[b].updateTransitions(n);this.light.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._resetUpdates()}const h={};for(const m in this._sourceCaches){const _=this._sourceCaches[m];h[m]=_.used,_.used=!1}for(const m of this._order){const _=this._layers[m];if(_.recalculate(n,this._availableImages),!_.isHidden(n.zoom)){const T=this._getLayerSourceCache(_);T&&(T.used=!0)}const b=this.map.painter;if(b){const T=_.getProgramIds();if(!T)continue;const S=_.getProgramConfiguration(n.zoom);for(const I of T)b.useProgram(I,S)}}for(const m in h){const _=this._sourceCaches[m];h[m]!==_.used&&_.getSource().fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:_.getSource().id}))}this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),a&&this.fire(new s.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const a in this._sourceCaches)this._sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateWorkerLayers(n,a){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(n){if(this._checkLoaded(),ll(this,s.validateStyle(n)))return!1;(n=s.clone$1(n)).layers=Ei(n.layers);const a=function(m,_){if(!m)return[{command:Ft.setStyle,args:[_]}];let b=[];try{if(!B(m.version,_.version))return[{command:Ft.setStyle,args:[_]}];B(m.center,_.center)||b.push({command:Ft.setCenter,args:[_.center]}),B(m.zoom,_.zoom)||b.push({command:Ft.setZoom,args:[_.zoom]}),B(m.bearing,_.bearing)||b.push({command:Ft.setBearing,args:[_.bearing]}),B(m.pitch,_.pitch)||b.push({command:Ft.setPitch,args:[_.pitch]}),B(m.sprite,_.sprite)||b.push({command:Ft.setSprite,args:[_.sprite]}),B(m.glyphs,_.glyphs)||b.push({command:Ft.setGlyphs,args:[_.glyphs]}),B(m.transition,_.transition)||b.push({command:Ft.setTransition,args:[_.transition]}),B(m.light,_.light)||b.push({command:Ft.setLight,args:[_.light]}),B(m.fog,_.fog)||b.push({command:Ft.setFog,args:[_.fog]}),B(m.projection,_.projection)||b.push({command:Ft.setProjection,args:[_.projection]});const T={},S=[];(function(R,U,W,j){let $;for($ in U=U||{},R=R||{})R.hasOwnProperty($)&&(U.hasOwnProperty($)||rr($,W,j));for($ in U)U.hasOwnProperty($)&&(R.hasOwnProperty($)?B(R[$],U[$])||(R[$].type==="geojson"&&U[$].type==="geojson"&&uo(R,U,$)?W.push({command:Ft.setGeoJSONSourceData,args:[$,U[$].data]}):Ki($,U,W,j)):Re($,U,W))})(m.sources,_.sources,S,T);const I=[];m.layers&&m.layers.forEach(R=>{R.source&&T[R.source]?b.push({command:Ft.removeLayer,args:[R.id]}):I.push(R)});let k=m.terrain;k&&T[k.source]&&(b.push({command:Ft.setTerrain,args:[void 0]}),k=void 0),b=b.concat(S),B(k,_.terrain)||b.push({command:Ft.setTerrain,args:[_.terrain]}),function(R,U,W){U=U||[];const j=(R=R||[]).map(Tr),$=U.map(Tr),q=R.reduce(il,{}),N=U.reduce(il,{}),J=j.slice(),X=Object.create(null);let ue,le,re,ce,ae,me,Ce;for(ue=0,le=0;ue<j.length;ue++)re=j[ue],N.hasOwnProperty(re)?le++:(W.push({command:Ft.removeLayer,args:[re]}),J.splice(J.indexOf(re,le),1));for(ue=0,le=0;ue<$.length;ue++)re=$[$.length-1-ue],J[J.length-1-ue]!==re&&(q.hasOwnProperty(re)?(W.push({command:Ft.removeLayer,args:[re]}),J.splice(J.lastIndexOf(re,J.length-le),1)):le++,me=J[J.length-ue],W.push({command:Ft.addLayer,args:[N[re],me]}),J.splice(J.length-ue,0,re),X[re]=!0);for(ue=0;ue<$.length;ue++)if(re=$[ue],ce=q[re],ae=N[re],!X[re]&&!B(ce,ae))if(B(ce.source,ae.source)&&B(ce["source-layer"],ae["source-layer"])&&B(ce.type,ae.type)){for(Ce in tl(ce.layout,ae.layout,W,re,null,Ft.setLayoutProperty),tl(ce.paint,ae.paint,W,re,null,Ft.setPaintProperty),B(ce.filter,ae.filter)||W.push({command:Ft.setFilter,args:[re,ae.filter]}),B(ce.minzoom,ae.minzoom)&&B(ce.maxzoom,ae.maxzoom)||W.push({command:Ft.setLayerZoomRange,args:[re,ae.minzoom,ae.maxzoom]}),ce)ce.hasOwnProperty(Ce)&&Ce!=="layout"&&Ce!=="paint"&&Ce!=="filter"&&Ce!=="metadata"&&Ce!=="minzoom"&&Ce!=="maxzoom"&&(Ce.indexOf("paint.")===0?tl(ce[Ce],ae[Ce],W,re,Ce.slice(6),Ft.setPaintProperty):B(ce[Ce],ae[Ce])||W.push({command:Ft.setLayerProperty,args:[re,Ce,ae[Ce]]}));for(Ce in ae)ae.hasOwnProperty(Ce)&&!ce.hasOwnProperty(Ce)&&Ce!=="layout"&&Ce!=="paint"&&Ce!=="filter"&&Ce!=="metadata"&&Ce!=="minzoom"&&Ce!=="maxzoom"&&(Ce.indexOf("paint.")===0?tl(ce[Ce],ae[Ce],W,re,Ce.slice(6),Ft.setPaintProperty):B(ce[Ce],ae[Ce])||W.push({command:Ft.setLayerProperty,args:[re,Ce,ae[Ce]]}))}else W.push({command:Ft.removeLayer,args:[re]}),me=J[J.lastIndexOf(re)+1],W.push({command:Ft.addLayer,args:[ae,me]})}(I,_.layers,b)}catch(T){console.warn("Unable to compute style diff:",T),b=[{command:Ft.setStyle,args:[_]}]}return b}(this.serialize(),n).filter(m=>!(m.command in jf));if(a.length===0)return!1;const h=a.filter(m=>!(m.command in xh));if(h.length>0)throw new Error(`Unimplemented: ${h.map(m=>m.command).join(", ")}.`);return a.forEach(m=>{m.command!=="setTransition"&&m.command!=="setProjection"&&this[m.command].apply(this,m.args)}),this.stylesheet=n,this._updateMapProjection(),!0}addImage(n,a){return this.getImage(n)?this.fire(new s.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,a),this._afterImageUpdated(n),this)}updateImage(n,a){this.imageManager.updateImage(n,a)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n),this._afterImageUpdated(n),this):this.fire(new s.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(n,a,h={}){if(this._checkLoaded(),this.getSource(n)!==void 0)throw new Error("There is already a source with this ID");if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(s.validateSource,`sources.${n}`,a,null,h))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const m=we(n,a,this.dispatcher,this);m.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(n),source:m.serialize(),sourceId:n}));const _=b=>{const T=(b?"symbol:":"other:")+n,S=this._sourceCaches[T]=new s.SourceCache(T,m,b);(b?this._symbolSourceCaches:this._otherSourceCaches)[n]=S,S.style=this,S.onAdd(this.map)};_(!1),a.type!=="vector"&&a.type!=="geojson"||_(!0),m.onAdd&&m.onAdd(this.map),this._changed=!0}removeSource(n){this._checkLoaded();const a=this.getSource(n);if(!a)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===n)return this.fire(new s.ErrorEvent(new Error(`Source "${n}" cannot be removed while layer "${m}" is using it.`)));if(this.terrain&&this.terrain.get().source===n)return this.fire(new s.ErrorEvent(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const h=this._getSourceCaches(n);for(const m of h)delete this._sourceCaches[m.id],delete this._updatedSources[m.id],m.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:m.getSource().id})),m.setEventedParent(null),m.clearTiles();return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(n,a){this._checkLoaded(),this.getSource(n).setData(a),this._changed=!0}getSource(n){const a=this._getSourceCache(n);return a&&a.getSource()}addLayer(n,a,h={}){this._checkLoaded();const m=n.id;if(this.getLayer(m))return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${m}" already exists on this map`)));let _;if(n.type==="custom"){if(ll(this,s.validateCustomStyleLayer(n)))return;_=s.createStyleLayer(n)}else{if(typeof n.source=="object"&&(this.addSource(m,n.source),n=s.clone$1(n),n=s.extend(n,{source:m})),this._validate(s.validateLayer,`layers.${m}`,n,{arrayIndex:-1},h))return;_=s.createStyleLayer(n),this._validateLayer(_),_.setEventedParent(this,{layer:{id:m}}),this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0)}const b=a?this._order.indexOf(a):this._order.length;if(a&&b===-1)return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${a}" does not exist on this map.`)));this._order.splice(b,0,m),this._layerOrderChanged=!0,this._layers[m]=_;const T=this._getLayerSourceCache(_);if(this._removedLayers[m]&&_.source&&T&&_.type!=="custom"){const S=this._removedLayers[m];delete this._removedLayers[m],S.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",T.pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(n,a){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===a)return;const h=this._order.indexOf(n);this._order.splice(h,1);const m=a?this._order.indexOf(a):this._order.length;a&&m===-1?this.fire(new s.ErrorEvent(new Error(`Layer with id "${a}" does not exist on this map.`))):(this._order.splice(m,0,n),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(n){this._checkLoaded();const a=this._layers[n];if(!a)return void this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be removed.`)));a.setEventedParent(null),this._updateLayerCount(a,!1);const h=this._order.indexOf(n);this._order.splice(h,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=a,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],a.onRemove&&a.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(n){return this._layers[n]}hasLayer(n){return n in this._layers}hasLayerType(n){for(const a in this._layers)if(this._layers[a].type===n)return!0;return!1}setLayerZoomRange(n,a,h){this._checkLoaded();const m=this.getLayer(n);m?m.minzoom===a&&m.maxzoom===h||(a!=null&&(m.minzoom=a),h!=null&&(m.maxzoom=h),this._updateLayer(m)):this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(n,a,h={}){this._checkLoaded();const m=this.getLayer(n);if(m){if(!B(m.filter,a))return a==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(s.validateFilter,`layers.${m.id}.filter`,a,{layerType:m.type},h)||(m.filter=s.clone$1(a),this._updateLayer(m)))}else this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be filtered.`)))}getFilter(n){const a=this.getLayer(n);return a&&s.clone$1(a.filter)}setLayoutProperty(n,a,h,m={}){this._checkLoaded();const _=this.getLayer(n);_?B(_.getLayoutProperty(a),h)||(_.setLayoutProperty(a,h,m),this._updateLayer(_)):this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(n,a){const h=this.getLayer(n);if(h)return h.getLayoutProperty(a);this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style.`)))}setPaintProperty(n,a,h,m={}){this._checkLoaded();const _=this.getLayer(n);_?B(_.getPaintProperty(a),h)||(_.setPaintProperty(a,h,m)&&this._updateLayer(_),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(n,a){const h=this.getLayer(n);return h&&h.getPaintProperty(a)}setFeatureState(n,a){this._checkLoaded();const h=n.source,m=n.sourceLayer,_=this.getSource(h);if(!_)return void this.fire(new s.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)));const b=_.type;if(b==="geojson"&&m)return void this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(b==="vector"&&!m)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided.")));const T=this._getSourceCaches(h);for(const S of T)S.setFeatureState(m,n.id,a)}removeFeatureState(n,a){this._checkLoaded();const h=n.source,m=this.getSource(h);if(!m)return void this.fire(new s.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)));const _=m.type,b=_==="vector"?n.sourceLayer:void 0;if(_==="vector"&&!b)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const T=this._getSourceCaches(h);for(const S of T)S.removeFeatureState(b,n.id,a)}getFeatureState(n){this._checkLoaded();const a=n.source,h=n.sourceLayer,m=this.getSource(a);if(m){if(m.type!=="vector"||h)return n.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(a)[0].getFeatureState(h,n.id);this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const n={};for(const a in this._sourceCaches){const h=this._sourceCaches[a].getSource();n[h.id]||(n[h.id]=h.serialize())}return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:n,layers:this._serializeLayers(this._order)},a=>a!==void 0)}_updateLayer(n){this._updatedLayers[n.id]=!0;const a=this._getLayerSourceCache(n);n.source&&!this._updatedSources[n.source]&&a&&a.getSource().type!=="raster"&&(this._updatedSources[n.source]="reload",a.pause()),this._changed=!0,n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const a=b=>this._layers[b].type==="fill-extrusion",h={},m=[];for(let b=this._order.length-1;b>=0;b--){const T=this._order[b];if(a(T)){h[T]=b;for(const S of n){const I=S[T];if(I)for(const k of I)m.push(k)}}}m.sort((b,T)=>T.intersectionZ-b.intersectionZ);const _=[];for(let b=this._order.length-1;b>=0;b--){const T=this._order[b];if(a(T))for(let S=m.length-1;S>=0;S--){const I=m[S].feature;if(h[I.layer.id]<b)break;_.push(I),m.pop()}else for(const S of n){const I=S[T];if(I)for(const k of I)_.push(k.feature)}}return _}queryRenderedFeatures(n,a,h){a&&a.filter&&this._validate(s.validateFilter,"queryRenderedFeatures.filter",a.filter,null,a);const m={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const S of a.layers){const I=this._layers[S];if(!I)return this.fire(new s.ErrorEvent(new Error(`The layer '${S}' does not exist in the map's style and cannot be queried for features.`))),[];m[I.source]=!0}}const _=[];a.availableImages=this._availableImages;const b=a&&a.layers?a.layers.some(S=>{const I=this.getLayer(S);return I&&I.is3D()}):this.has3DLayers(),T=Pn.createFromScreenPoints(n,h);for(const S in this._sourceCaches){const I=this._sourceCaches[S].getSource().id;a.layers&&!m[I]||_.push(wt(this._sourceCaches[S],this._layers,this._serializedLayers,T,a,h,b,!!this.map._showQueryGeometry))}return this.placement&&_.push(function(S,I,k,R,U,W,j){const $={},q=W.queryRenderedSymbols(R),N=[];for(const J of Object.keys(q).map(Number))N.push(j[J]);N.sort(Ut);for(const J of N){const X=J.featureIndex.lookupSymbolFeatures(q[J.bucketInstanceId],I,J.bucketIndex,J.sourceLayerIndex,U.filter,U.layers,U.availableImages,S);for(const ue in X){const le=$[ue]=$[ue]||[],re=X[ue];re.sort((ce,ae)=>{const me=J.featureSortOrder;if(me){const Ce=me.indexOf(ce.featureIndex);return me.indexOf(ae.featureIndex)-Ce}return ae.featureIndex-ce.featureIndex});for(const ce of re)le.push(ce)}}for(const J in $)$[J].forEach(X=>{const ue=X.feature,le=k(S[J]).getFeatureState(ue.layer["source-layer"],ue.id);ue.source=ue.layer.source,ue.layer["source-layer"]&&(ue.sourceLayer=ue.layer["source-layer"]),ue.state=le});return $}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),T.screenGeometry,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(n,a){a&&a.filter&&this._validate(s.validateFilter,"querySourceFeatures.filter",a.filter,null,a);const h=this._getSourceCaches(n);let m=[];for(const _ of h)m=m.concat(et(_,a));return m}addSourceType(n,a,h){return fr.getSourceType(n)?h(new Error(`A source type called "${n}" already exists.`)):(fr.setSourceType(n,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:a.workerSourceURL},h):h(null,null))}getLight(){return this.light.getLight()}setLight(n,a={}){this._checkLoaded();const h=this.light.getLight();let m=!1;for(const b in n)if(!B(n[b],h[b])){m=!0;break}if(!m)return;const _=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(n,a),this.light.updateTransitions(_)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,a=1){if(this._checkLoaded(),!n)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(a===1){if(typeof n.source=="object"){const h="terrain-dem-src";this.addSource(h,n.source),n=s.clone$1(n),n=s.extend(n,{source:h})}if(this._validate(s.validateTerrain,"terrain",n))return}if(!this.terrain||this.terrain&&a!==this.terrain.drapeRenderMode)this._createTerrain(n,a);else{const h=this.terrain,m=h.get();for(const _ of Object.keys(s.spec.terrain))!n.hasOwnProperty(_)&&s.spec.terrain[_].default&&(n[_]=s.spec.terrain[_].default);for(const _ in n)if(!B(n[_],m[_])){h.set(n),this.stylesheet.terrain=n;const b=this._setTransitionParameters({duration:0});h.updateTransitions(b);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const a=this.fog=new Jt(n,this.map.transform);this.stylesheet.fog=n;const h=this._setTransitionParameters({duration:0});a.updateTransitions(h)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog,h=a.get();Object.keys(n).length===0&&a.set(n);for(const m in n)if(!B(n[m],h[m])){a.set(n),this.stylesheet.fog=n;const _=this._setTransitionParameters({duration:0});a.updateTransitions(_);break}}else this._createFog(n);this._markersNeedUpdate=!0}_setTransitionParameters(n){return{now:s.exported.now(),transition:s.extend(n,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const n=this._order.filter(h=>this.isLayerDraped(this._layers[h])),a=this._order.filter(h=>!this.isLayerDraped(this._layers[h]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...a)}_createTerrain(n,a){const h=this.terrain=new tt(n,a);this.stylesheet.terrain=n,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const m=this._setTransitionParameters({duration:0});h.updateTransitions(m)}_force3DLayerUpdate(){for(const n in this._layers){const a=this._layers[n];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const a=this._layers[n];a.type==="symbol"&&this._updateLayer(a)}}_validate(n,a,h,m,_={}){return(!_||_.validate!==!1)&&ll(this,n.call(s.validateStyle,s.extend({key:a,style:this.serialize(),value:h,styleSpec:s.spec},m)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this._sourceCaches)this._sourceCaches[n].clearTiles(),this._sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(n){const a=this._getSourceCaches(n);for(const h of a)h.clearTiles()}_reloadSource(n){const a=this._getSourceCaches(n);for(const h of a)h.resume(),h.reload()}_updateSources(n){for(const a in this._sourceCaches)this._sourceCaches[a].update(n)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const a=this._sourceCaches[n];a.resume(),a.reload()}}_updatePlacement(n,a,h,m,_=!1){let b=!1,T=!1;const S={};for(const I of this._order){const k=this._layers[I];if(k.type!=="symbol")continue;if(!S[k.source]){const U=this._getLayerSourceCache(k);if(!U)continue;S[k.source]=U.getRenderableIds(!0).map(W=>U.getTileByID(W)).sort((W,j)=>j.tileID.overscaledZ-W.tileID.overscaledZ||(W.tileID.isLessThan(j.tileID)?-1:1))}const R=this.crossTileSymbolIndex.addLayer(k,S[k.source],n.center.lng,n.projection);b=b||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),_=_||this._layerOrderChanged||h===0,this._layerOrderChanged&&this.fire(new s.Event("neworder")),(_||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.exported.now(),n.zoom))&&(this.pauseablePlacement=new mo(n,this._order,_,a,h,m,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.exported.now()),T=!0),b&&this.pauseablePlacement.placement.setStale()),T||b)for(const I of this._order){const k=this._layers[I];k.type==="symbol"&&this.placement.updateLayerOpacities(k,S[k.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.exported.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,a,h){this.imageManager.getImages(a.icons,h),this._updateTilesForChangedImages();const m=_=>{_&&_.setDependencies(a.tileID.key,a.type,a.icons)};m(this._otherSourceCaches[a.source]),m(this._symbolSourceCaches[a.source])}getGlyphs(n,a,h){this.glyphManager.getGlyphs(a.stacks,h)}getResource(n,a,h){return s.makeRequest(a,h)}_getSourceCache(n){return this._otherSourceCaches[n]}_getLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}_getSourceCaches(n){const a=[];return this._otherSourceCaches[n]&&a.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&a.push(this._symbolSourceCaches[n]),a}_isSourceCacheLoaded(n){const a=this._getSourceCaches(n);return a.length===0?(this.fire(new s.ErrorEvent(new Error(`There is no source with ID '${n}'`))),!1):a.every(h=>h.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}fr.getSourceType=function(c){return pe[c]},fr.setSourceType=function(c,n){pe[c]=n},fr.registerForPluginStateChange=s.registerForPluginStateChange;var Mc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Ic="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",zc=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,kc=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,ps=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let cl={},Oo={};const _o=[];Uo(Mc,_o),Uo(zc,_o),Uo(kc,_o),Uo(ps,_o),cl=gi("",zc),Oo=gi(ps,kc);const sa=gi(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),ul=Mc,hl=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var dl={background:gi(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:gi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:gi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);
#else 
mat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:gi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:gi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:gi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:gi("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:gi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:gi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:gi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:gi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:gi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:gi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:gi(`uniform lowp vec3 u_lightpos;varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
void main() {vec4 color=v_color;
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color_normal(color.xyz,normalize(v_normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying highp vec3 v_normal;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;vec3 pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_normal=normal;v_depth=gl_Position.w;
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:gi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:gi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:gi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:gi(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
highp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);
#else
vec4 out_color=color;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:gi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:gi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:gi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
vec4 offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:gi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
vec4 offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:gi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:gi(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:gi(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:gi(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Ic),skyboxGradient:gi(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Ic),skyboxCapture:gi(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:gi(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);vec4 color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
vec4 color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;
#ifdef GLOBE_POLES
vec3 up_vector=normalize(globe_pos)*u_tile_up_scale;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:gi(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);
#ifdef PROJECTION_GLOBE_VIEW
float globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));float horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
float horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Uo(c,n){const a=c.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let h of a)if(h=h.trim(),h[0]==="#"&&h.includes("if")&&!h.includes("endif")){h=h.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const m=h.split(" ");for(const _ of m)n.includes(_)||n.push(_)}}function gi(c,n){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=n.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),m={},_=[..._o];return Uo(c,_),Uo(n,_),{fragmentSource:c=c.replace(a,(b,T,S,I,k)=>(m[k]=!0,T==="define"?`
#ifndef HAS_UNIFORM_u_${k}
varying ${S} ${I} ${k};
#else
uniform ${S} ${I} u_${k};
#endif
`:`
#ifdef HAS_UNIFORM_u_${k}
    ${S} ${I} ${k} = u_${k};
#endif
`)),vertexSource:n=n.replace(a,(b,T,S,I,k)=>{const R=I==="float"?"vec2":"vec4",U=k.match(/color/)?"color":R;return m[k]?T==="define"?`
#ifndef HAS_UNIFORM_u_${k}
uniform lowp float u_${k}_t;
attribute ${S} ${R} a_${k};
varying ${S} ${I} ${k};
#else
uniform ${S} ${I} u_${k};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${k}
    ${k} = a_${k};
#else
    ${S} ${I} ${k} = u_${k};
#endif
`:`
#ifndef HAS_UNIFORM_u_${k}
    ${k} = unpack_mix_${U}(a_${k}, u_${k}_t);
#else
    ${S} ${I} ${k} = u_${k};
#endif
`:T==="define"?`
#ifndef HAS_UNIFORM_u_${k}
uniform lowp float u_${k}_t;
attribute ${S} ${R} a_${k};
#else
uniform ${S} ${I} u_${k};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${k}
    ${S} ${I} ${k} = a_${k};
#else
    ${S} ${I} ${k} = u_${k};
#endif
`:`
#ifndef HAS_UNIFORM_u_${k}
    ${S} ${I} ${k} = unpack_mix_${U}(a_${k}, u_${k}_t);
#else
    ${S} ${I} ${k} = u_${k};
#endif
`}),staticAttributes:h,usedDefines:_}}class fl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,a,h,m,_,b,T){this.context=n;let S=this.boundPaintVertexBuffers.length!==m.length;for(let k=0;!S&&k<m.length;k++)this.boundPaintVertexBuffers[k]!==m[k]&&(S=!0);let I=this.boundDynamicVertexBuffers.length!==T.length;for(let k=0;!I&&k<T.length;k++)this.boundDynamicVertexBuffers[k]!==T[k]&&(I=!0);if(!n.extVertexArrayObject||!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==h||S||I||this.boundIndexBuffer!==_||this.boundVertexOffset!==b)this.freshBind(a,h,m,_,b,T);else{n.bindVertexArrayOES.set(this.vao);for(const k of T)k&&k.bind();_&&_.dynamicDraw&&_.bind()}}freshBind(n,a,h,m,_,b){let T;const S=n.numAttributes,I=this.context,k=I.gl;if(I.extVertexArrayObject)this.vao&&this.destroy(),this.vao=I.extVertexArrayObject.createVertexArrayOES(),I.bindVertexArrayOES.set(this.vao),T=0,this.boundProgram=n,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=m,this.boundVertexOffset=_,this.boundDynamicVertexBuffers=b;else{T=I.currentNumAttributes||0;for(let R=S;R<T;R++)k.disableVertexAttribArray(R)}a.enableAttributes(k,n),a.bind(),a.setVertexAttribPointers(k,n,_);for(const R of h)R.enableAttributes(k,n),R.bind(),R.setVertexAttribPointers(k,n,_);for(const R of b)R&&(R.enableAttributes(k,n),R.bind(),R.setVertexAttribPointers(k,n,_));m&&m.bind(),I.currentNumAttributes=S}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Pc(c,n){const a=Math.pow(2,n.canonical.z),h=n.canonical.y;return[new s.MercatorCoordinate(0,h/a).toLngLat().lat,new s.MercatorCoordinate(0,(h+1)/a).toLngLat().lat]}function Dc(c,n,a,h,m,_,b){const T=c.context,S=T.gl,I=a.fbo;if(!I)return;c.prepareDrawTile();const k=c.useProgram("hillshade");T.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,I.colorAttachment.get());const R=(($,q,N,J)=>{const X=N.paint.get("hillshade-shadow-color"),ue=N.paint.get("hillshade-highlight-color"),le=N.paint.get("hillshade-accent-color");let re=N.paint.get("hillshade-illumination-direction")*(Math.PI/180);N.paint.get("hillshade-illumination-anchor")==="viewport"&&(re-=$.transform.angle);const ce=!$.options.moving;return{u_matrix:J||$.transform.calculateProjMatrix(q.tileID.toUnwrapped(),ce),u_image:0,u_latrange:Pc(0,q.tileID),u_light:[N.paint.get("hillshade-exaggeration"),re],u_shadow:X,u_highlight:ue,u_accent:le}})(c,a,h,c.terrain?n.projMatrix:null);c.prepareDrawProgram(T,k,n.toUnwrapped());const{tileBoundsBuffer:U,tileBoundsIndexBuffer:W,tileBoundsSegments:j}=c.getTileBoundsBuffers(a);k.draw(T,S.TRIANGLES,m,_,b,s.CullFaceMode.disabled,R,h.id,U,W,j)}function fi(c,n,a){if(!n.needsDEMTextureUpload)return;const h=c.context,m=h.gl;h.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||c.getTileTexture(a.stride);const _=a.getPixels();n.demTexture?n.demTexture.update(_,{premultiply:!1}):n.demTexture=new s.Texture(h,_,m.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function ms(c,n,a,h,m,_){const b=c.context,T=b.gl;if(!n.dem)return;const S=n.dem;if(b.activeTexture.set(T.TEXTURE1),fi(c,n,S),!n.demTexture)return;n.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE);const I=S.dim;b.activeTexture.set(T.TEXTURE0);let k=n.fbo;if(!k){const j=new s.Texture(b,{width:I,height:I,data:null},T.RGBA);j.bind(T.LINEAR,T.CLAMP_TO_EDGE),k=n.fbo=b.createFramebuffer(I,I,!0),k.colorAttachment.set(j.texture)}b.bindFramebuffer.set(k.framebuffer),b.viewport.set([0,0,I,I]);const{tileBoundsBuffer:R,tileBoundsIndexBuffer:U,tileBoundsSegments:W}=c.getMercatorTileBoundsBuffers();c.useProgram("hillshadePrepare").draw(b,T.TRIANGLES,h,m,_,s.CullFaceMode.disabled,((j,$)=>{const q=$.stride,N=s.create();return s.ortho(N,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate(N,N,[0,-s.EXTENT,0]),{u_matrix:N,u_image:1,u_dimension:[q,q],u_zoom:j.overscaledZ,u_unpack:$.unpackVector}})(n.tileID,S),a.id,R,U,W),n.needsHillshadePrepare=!1}const aa=c=>({u_matrix:new s.UniformMatrix4f(c),u_image0:new s.Uniform1i(c),u_skirt_height:new s.Uniform1f(c)}),Lc=(c,n)=>({u_matrix:c,u_image0:0,u_skirt_height:n}),Rc=(c,n,a,h,m,_,b,T,S,I,k,R,U,W)=>({u_proj_matrix:Float32Array.from(c),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(h),u_merc_matrix:a,u_zoom_transition:m,u_merc_center:_,u_image0:0,u_frustum_tl:b,u_frustum_tr:T,u_frustum_br:S,u_frustum_bl:I,u_globe_pos:k,u_globe_radius:R,u_viewport:U,u_grid_matrix:W?Float32Array.from(W):new Float32Array(9)});function Bc(c,n){return c!=null&&n!=null&&!(!c.hasData()||!n.hasData())&&c.demTexture!=null&&n.demTexture!=null&&c.tileID.key!==n.tileID.key}const go=new class{constructor(){this.operations={}}newMorphing(c,n,a,h,m){if(c in this.operations){const _=this.operations[c];_.to.tileID.key!==a.tileID.key&&(_.queued=a)}else this.operations[c]={startTime:h,phase:0,duration:m,from:n,to:a,queued:null}}getMorphValuesForProxy(c){if(!(c in this.operations))return null;const n=this.operations[c];return{from:n.from,to:n.to,phase:n.phase}}update(c){for(const n in this.operations){const a=this.operations[n];for(a.phase=(c-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,c)){delete this.operations[n];break}}}_nextOp(c,n){return!!c.queued&&(c.from=c.to,c.to=c.queued,c.queued=null,c.phase=0,c.startTime=n,!0)}_validOp(c){return c.from.hasData()&&c.to.hasData()}},la={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function qf(c,n){const a=1<<c.z;return!n&&(c.x===0||c.x===a-1)||c.y===0||c.y===a-1}const Fc=c=>({u_matrix:c});function pl(c,n,a,h,m){if(m>0){const _=s.exported.now(),b=(_-c.timeAdded)/m,T=n?(_-n.timeAdded)/m:-1,S=a.getSource(),I=h.coveringZoomLevel({tileSize:S.tileSize,roundZoom:S.roundZoom}),k=!n||Math.abs(n.tileID.overscaledZ-I)>Math.abs(c.tileID.overscaledZ-I),R=k&&c.refreshedUponExpiration?1:s.clamp(k?b:1-T,0,1);return c.refreshedUponExpiration&&b>=1&&(c.refreshedUponExpiration=!1),n?{opacity:1,mix:1-R}:{opacity:R,mix:0}}return{opacity:1,mix:0}}class Oc extends s.SourceCache{constructor(n){const a={type:"raster-dem",maxzoom:n.transform.maxZoom},h=new _i(Ti(),null),m=we("mock-dem",a,h,n.style);super("mock-dem",m,!1),m.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,a){n.state="loaded",a(null)}}class Uc extends s.SourceCache{constructor(n){const a=we("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new _i(Ti(),null),n.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,a,h){if(n.freezeTileCoverage)return;this.transform=n;const m=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((_,b)=>{if(_[b.key]="",!this._tiles[b.key]){const T=new s.Tile(b,this._source.tileSize*b.overscaleFactor(),n.tileZoom);T.state="loaded",this._tiles[b.key]=T}return _},{});for(const _ in this._tiles)_ in m||(this.freeFBO(_),this._tiles[_].unloadVectorData(),delete this._tiles[_])}freeFBO(n){const a=this.proxyCachedFBO[n];if(a!==void 0){const h=Object.values(a);this.renderCachePool.push(...h),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ml extends s.OverscaledTileID{constructor(n,a,h){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=a,this.projMatrix=h}}class bh extends s.Elevation{constructor(n,a){super(),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[h,m,_]=function(S){const I=new s.StructArrayLayout4i8,k=new s.StructArrayLayout3ui6,R=131;I.reserve(17161),k.reserve(33800);const U=s.EXTENT/128,W=s.EXTENT+U/2,j=W+U;for(let q=-U;q<j;q+=U)for(let N=-U;N<j;N+=U){const J=N<0||N>W||q<0||q>W?24575:0,X=s.clamp(Math.round(N),0,s.EXTENT),ue=s.clamp(Math.round(q),0,s.EXTENT);I.emplaceBack(X+J,ue,X,ue)}const $=(q,N)=>{const J=N*R+q;k.emplaceBack(J+1,J,J+R),k.emplaceBack(J+R,J+R+1,J+1)};for(let q=1;q<129;q++)for(let N=1;N<129;N++)$(N,q);return[0,129].forEach(q=>{for(let N=0;N<130;N++)$(N,q),$(q,N)}),[I,k,32768]}(),b=n.context;this.gridBuffer=b.createVertexBuffer(h,s.boundsAttributes.members),this.gridIndexBuffer=b.createIndexBuffer(m),this.gridSegments=s.SegmentVector.simpleSegment(0,0,h.length,m.length),this.gridNoSkirtSegments=s.SegmentVector.simpleSegment(0,0,h.length,_),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Uc(a.map),this.orthoMatrix=s.create(),s.ortho(this.orthoMatrix,0,s.EXTENT,0,s.EXTENT,0,1);const T=b.gl;this._overlapStencilMode=new s.StencilMode({func:T.GEQUAL,mask:255},0,255,T.KEEP,T.KEEP,T.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Oc(a.map)}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),n.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=n,this._checkRenderCacheEfficiency()}update(n,a,h){if(n&&n.terrain){this._style!==n&&(this.style=n),this.enabled=!0;const m=n.terrain.properties;this.sourceCache=n.terrain.drapeRenderMode===0?this._mockSourceCache:n._getSourceCache(m.get("source")),this._exaggeration=m.get("exaggeration");const _=()=>{this.sourceCache.used&&s.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const b=this.getScaledDemTileSize();this.sourceCache.update(a,b,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,_(),this._initializing=!0),_(),a.updateElevation(!h),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const n=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||n.efficiency!==100&&s.warnOnce(`Terrain render cache efficiency is not optimal (${n.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${n.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._sourceCaches)this._style._sourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,h=this.painter.transform;this._initializing&&(this._initializing=h._centerAltitude===0&&this.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(h.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const m=this.proxyCoords=a.getIds().map(S=>{const I=a.getTileByID(S).tileID;return I.projMatrix=h.calculateProjMatrix(I.toUnwrapped()),I});(function(S,I){const k=I.transform.pointCoordinate(I.transform.getCameraPoint()),R=new s.pointGeometry(k.x,k.y);S.sort((U,W)=>{if(W.overscaledZ-U.overscaledZ)return W.overscaledZ-U.overscaledZ;const j=new s.pointGeometry(U.canonical.x+(1<<U.canonical.z)*U.wrap,U.canonical.y),$=new s.pointGeometry(W.canonical.x+(1<<W.canonical.z)*W.wrap,W.canonical.y),q=R.mult(1<<U.canonical.z);return q.x-=.5,q.y-=.5,q.distSqr(j)-q.distSqr($)})})(m,this.painter),this._previousZoom=h.zoom;const _=this.proxyToSource||{};this.proxyToSource={},m.forEach(S=>{this.proxyToSource[S.key]={}}),this.terrainTileForTile={};const b=this._style._sourceCaches;for(const S in b){const I=b[S];if(!I.used||(I!==this.sourceCache&&this.resetTileLookupCache(I.id),this._setupProxiedCoordsForOrtho(I,n[S],_),I.usedForTerrain))continue;const k=n[S];I.getSource().reparseOverscaled&&this._assignTerrainTiles(k)}this.proxiedCoords[a.id]=m.map(S=>new ml(S,S.key,this.orthoMatrix)),this._assignTerrainTiles(m),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(_),this.renderingToTexture=!1,this._updateTimestamp=s.exported.now();const T={};this._visibleDemTiles=[];for(const S of this.proxyCoords){const I=this.terrainTileForTile[S.key];if(!I)continue;const k=I.tileID.key;k in T||(this._visibleDemTiles.push(I),T[k]=k)}}_assignTerrainTiles(n){this._initializing||n.forEach(a=>{if(this.terrainTileForTile[a.key])return;const h=this._findTileCoveringTileID(a,this.sourceCache);h&&(this.terrainTileForTile[a.key]=h)})}_prepareDEMTextures(){const n=this.painter.context,a=n.gl;for(const h in this.terrainTileForTile){const m=this.terrainTileForTile[h],_=m.dem;!_||m.demTexture&&!m.needsDEMTextureUpload||(n.activeTexture.set(a.TEXTURE1),fi(this.painter,m,_))}}_prepareDemTileUniforms(n,a,h,m){if(!a||a.demTexture==null)return!1;const _=n.tileID.canonical,b=Math.pow(2,a.tileID.canonical.z-_.z),T=m||"";return h[`u_dem_tl${T}`]=[_.x*b%1,_.y*b%1],h[`u_dem_scale${T}`]=b,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,a=n.gl;if(!this._emptyDepthBufferTexture){const h=new s.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new s.Texture(n,h,a.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0;const a=this._visibleDemTiles.reduce((h,m)=>{if(!m.dem)return h;const _=m.dem.tree.minimums[0];return _>0&&n++,h+_},0);return n?a/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,a=n.gl;n.activeTexture.set(a.TEXTURE2);const h=this._getLoadedAreaMinimum(),m=new s.RGBAImage({width:1,height:1},new Uint8Array(s.DEMData.pack(h,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let _=this._emptyDEMTexture;return _?_.update(m,{premultiply:!1}):_=this._emptyDEMTexture=new s.Texture(n,m,a.RGBA,{premultiply:!1}),_}setupElevationDraw(n,a,h){const m=this.painter.context,_=m.gl,b=(T=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:s.DEMData.getUnpackVector(T),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var T;b.u_dem_size=this.sourceCache.getSource().tileSize,b.u_exaggeration=this.exaggeration();const S=this.painter.transform,I=S.projection,k=n.tileID.canonical;b.u_tile_tl_up=I.upVector(k,0,0),b.u_tile_tr_up=I.upVector(k,s.EXTENT,0),b.u_tile_br_up=I.upVector(k,s.EXTENT,s.EXTENT),b.u_tile_bl_up=I.upVector(k,0,s.EXTENT),b.u_tile_up_scale=h&&h.useDenormalizedUpVectorScale?s.GLOBE_METERS_TO_ECEF:I.upVectorScale(k,S.center.lat,S.worldSize).metersToTile;let R=null,U=null,W=1;if(h&&h.morphing&&this._useVertexMorphing){const j=h.morphing.srcDemTile,$=h.morphing.dstDemTile;W=h.morphing.phase,j&&$&&(this._prepareDemTileUniforms(n,j,b,"_prev")&&(U=j),this._prepareDemTileUniforms(n,$,b)&&(R=$))}if(U&&R?(m.activeTexture.set(_.TEXTURE2),R.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE,_.NEAREST),m.activeTexture.set(_.TEXTURE4),U.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE,_.NEAREST),b.u_dem_lerp=W):(R=this.terrainTileForTile[n.tileID.key],m.activeTexture.set(_.TEXTURE2),(this._prepareDemTileUniforms(n,R,b)?R.demTexture:this.emptyDEMTexture).bind(_.NEAREST,_.CLAMP_TO_EDGE)),m.activeTexture.set(_.TEXTURE3),h&&h.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),this._depthFBO&&(b.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),b.u_depth_size_inv=[1,1]),h&&h.useMeterToDem&&R){const j=(1<<R.tileID.canonical.z)*s.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;b.u_meter_to_dem=j}h&&h.labelPlaneMatrixInv&&(b.u_label_plane_matrix_inv=h.labelPlaneMatrixInv),a.setTerrainUniformValues(m,b)}renderToBackBuffer(n){const a=this.painter,h=this.painter.context;n.length!==0&&(h.bindFramebuffer.set(null),h.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(m,_,b,T,S){if(m.transform.projection.name==="globe")(function(I,k,R,U,W){const j=I.context,$=j.gl;let q,N;const J=I.options.showTerrainWireframe?2:0,X=I.transform,ue=s.globeUseCustomAntiAliasing(I,j,X),le=(pt,Le)=>{if(N===pt)return;const lt=[la[pt],"PROJECTION_GLOBE_VIEW"];ue&&lt.push("CUSTOM_ANTIALIASING"),Le&&lt.push(la[J]),q=I.useProgram("globeRaster",null,lt),N=pt},re=I.colorModeForRenderPass(),ce=new s.DepthMode($.LEQUAL,s.DepthMode.ReadWrite,I.depthRangeFor3D);go.update(W);const ae=s.calculateGlobeMercatorMatrix(X),me=[s.mercatorXfromLng(X.center.lng),s.mercatorYfromLat(X.center.lat)],Ce=J?[!1,!0]:[!1],rt=I.globeSharedBuffers,xe=[X.width*s.exported.devicePixelRatio,X.height*s.exported.devicePixelRatio],Ve=Float32Array.from(X.globeMatrix),Ge={useDenormalizedUpVectorScale:!0};if(Ce.forEach(pt=>{N=-1;const Le=pt?$.LINES:$.TRIANGLES;for(const lt of U){const qe=R.getTile(lt),vt=s.StencilMode.disabled,_t=k.prevTerrainTileForTile[lt.key],It=k.terrainTileForTile[lt.key];Bc(_t,It)&&go.newMorphing(lt.key,_t,It,W,250),j.activeTexture.set($.TEXTURE0),qe.texture.bind($.LINEAR,$.CLAMP_TO_EDGE);const Lt=go.getMorphValuesForProxy(lt.key),qt=Lt?1:0;Lt&&s.extend$1(Ge,{morphing:{srcDemTile:Lt.from,dstDemTile:Lt.to,phase:s.easeCubicInOut(Lt.phase)}});const li=s.tileCornersToBounds(lt.canonical),zt=s.getLatitudinalLod(li.getCenter().lat),Xt=s.getGridMatrix(lt.canonical,li,zt),pi=s.globeNormalizeECEF(s.globeTileBounds(lt.canonical)),Vi=Rc(X.projMatrix,Ve,ae,pi,s.globeToMercatorTransition(X.zoom),me,X.frustumCorners.TL,X.frustumCorners.TR,X.frustumCorners.BR,X.frustumCorners.BL,X.globeCenterInViewSpace,X.globeRadius,xe,Xt);if(le(qt,pt),k.setupElevationDraw(qe,q,Ge),I.prepareDrawProgram(j,q,lt.toUnwrapped()),rt){const[Yi,Mi,_n]=pt?rt.getWirefameBuffers(I.context,zt):rt.getGridBuffers(zt);q.draw(j,Le,ce,vt,re,s.CullFaceMode.backCCW,Vi,"globe_raster",Yi,Mi,_n)}}}),rt){const pt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ue&&pt.push("CUSTOM_ANTIALIASING"),q=I.useProgram("globeRaster",null,pt);for(const Le of U){const{x:lt,y:qe,z:vt}=Le.canonical,_t=qe===0,It=qe===(1<<vt)-1,[Lt,qt,li,zt]=rt.getPoleBuffers(vt);if(zt&&(_t||It)){const Xt=R.getTile(Le);j.activeTexture.set($.TEXTURE0),Xt.texture.bind($.LINEAR,$.CLAMP_TO_EDGE);let pi=s.globePoleMatrixForTile(vt,lt,X);const Vi=s.globeNormalizeECEF(s.globeTileBounds(Le.canonical)),Yi=(Mi,_n)=>Mi.draw(j,$.TRIANGLES,ce,s.StencilMode.disabled,re,s.CullFaceMode.disabled,Rc(X.projMatrix,pi,pi,Vi,0,me,X.frustumCorners.TL,X.frustumCorners.TR,X.frustumCorners.BR,X.frustumCorners.BL,X.globeCenterInViewSpace,X.globeRadius,xe),"globe_pole_raster",_n,li,zt);k.setupElevationDraw(Xt,q,Ge),I.prepareDrawProgram(j,q,Le.toUnwrapped()),_t&&Yi(q,Lt),It&&(pi=s.scale(s.create(),pi,[1,-1,1]),Yi(q,qt))}}}})(m,_,b,T,S);else{const I=m.context,k=I.gl;let R,U;const W=m.options.showTerrainWireframe?2:0,j=(X,ue)=>{if(U===X)return;const le=[la[X]];ue&&le.push(la[W]),R=m.useProgram("terrainRaster",null,le),U=X},$=m.colorModeForRenderPass(),q=new s.DepthMode(k.LEQUAL,s.DepthMode.ReadWrite,m.depthRangeFor3D);go.update(S);const N=m.transform,J=6*Math.pow(1.5,22-N.zoom)*_.exaggeration();(W?[!1,!0]:[!1]).forEach(X=>{U=-1;const ue=X?k.LINES:k.TRIANGLES,[le,re]=X?_.getWirefameBuffer():[_.gridIndexBuffer,_.gridSegments];for(const ce of T){const ae=b.getTile(ce),me=s.StencilMode.disabled,Ce=_.prevTerrainTileForTile[ce.key],rt=_.terrainTileForTile[ce.key];Bc(Ce,rt)&&go.newMorphing(ce.key,Ce,rt,S,250),I.activeTexture.set(k.TEXTURE0),ae.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST);const xe=go.getMorphValuesForProxy(ce.key),Ve=xe?1:0;let Ge;xe&&(Ge={morphing:{srcDemTile:xe.from,dstDemTile:xe.to,phase:s.easeCubicInOut(xe.phase)}});const pt=Lc(ce.projMatrix,qf(ce.canonical,N.renderWorldCopies)?J/10:J);j(Ve,X),_.setupElevationDraw(ae,R,Ge),m.prepareDrawProgram(I,R,ce.toUnwrapped()),R.draw(I,ue,q,me,$,s.CullFaceMode.backCCW,pt,"terrain_raster",_.gridBuffer,le,re)}})}}(a,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const a=this.painter,h=this.painter.context,m=this.proxySourceCache,_=this.proxiedCoords[m.id],b=this._drapedRenderBatches.shift(),T=[],S=a.style.order;let I=0;for(const k of _){const R=m.getTileByID(k.proxyTileKey),U=m.proxyCachedFBO[k.key]?m.proxyCachedFBO[k.key][n]:void 0,W=U!==void 0?m.renderCache[U]:this.pool[I++],j=U!==void 0;if(R.texture=W.tex,j&&!W.dirty){T.push(R.tileID);continue}let $;h.bindFramebuffer.set(W.fb.framebuffer),this.renderedToTile=!1,W.dirty&&(h.clear({color:s.Color.transparent,stencil:0}),W.dirty=!1);for(let q=b.start;q<=b.end;++q){const N=a.style._layers[S[q]];if(N.isHidden(a.transform.zoom))continue;const J=a.style._getLayerSourceCache(N),X=J?this.proxyToSource[k.key][J.id]:[k];if(!X)continue;const ue=X;h.viewport.set([0,0,W.fb.width,W.fb.height]),$!==(J?J.id:null)&&(this._setupStencil(W,X,N,J),$=J?J.id:null),a.renderLayer(a,J,N,ue)}this.renderedToTile?(W.dirty=!0,T.push(R.tileID)):j||--I,I===5&&(I=0,this.renderToBackBuffer(T))}return this.renderToBackBuffer(T),this.renderingToTexture=!1,h.bindFramebuffer.set(null),h.viewport.set([0,0,a.width,a.height]),b.end+1}postRender(){}renderCacheEfficiency(n){const a=n.order.length;if(a===0)return{efficiency:100};let h,m=0,_=0,b=!1;for(let T=0;T<a;++T){const S=n._layers[n.order[T]];this._style.isLayerDraped(S)?(b&&++m,++_):b||(b=!0,h=S.id)}return _===0?{efficiency:100}:{efficiency:100*(1-m/_),firstUndrapedLayer:h}}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{n=Math.min(n,a.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,a,h){if(!this._visibleDemTiles)return null;const m=this._visibleDemTiles.filter(_=>_.dem).map(_=>{const b=_.tileID,T=1<<b.overscaledZ,{x:S,y:I}=b.canonical,k=S/T,R=(S+1)/T,U=I/T,W=(I+1)/T;return{minx:k,miny:U,maxx:R,maxy:W,t:_.dem.tree.raycastRoot(k,U,R,W,n,a,h),tile:_}});m.sort((_,b)=>(_.t!==null?_.t:Number.MAX_VALUE)-(b.t!==null?b.t:Number.MAX_VALUE));for(const _ of m){if(_.t==null)return null;const b=_.tile.dem.tree.raycast(_.minx,_.miny,_.maxx,_.maxy,n,a,h);if(b!=null)return b}return null}_createFBO(){const n=this.painter.context,a=n.gl,h=this.drapeBufferSize;n.activeTexture.set(a.TEXTURE0);const m=new s.Texture(n,{width:h[0],height:h[1],data:null},a.RGBA);m.bind(a.LINEAR,a.CLAMP_TO_EDGE);const _=n.createFramebuffer(h[0],h[1],!1);return _.colorAttachment.set(m.texture),_.depthAttachment=new L(n,_.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,h[0],h[1]),this._stencilRef=0,_.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):_.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&!n.extTextureFilterAnisotropicForceOff&&a.texParameterf(a.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:_,tex:m,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const n in this._style._sourceCaches)if(this._style._sourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const a=this._style._layers[n],h=a.isHidden(this.painter.transform.zoom),m=a.getCrossfadeParameters(),_=!!m&&m.t!==1,b=a.hasTransition();return a.type!=="custom"&&!h&&(_||b)})}_clearRasterFadeFromRenderCache(){let n=!1;for(const a in this._style._sourceCaches)if(this._style._sourceCaches[a]._source instanceof ie){n=!0;break}if(n)for(let a=0;a<this._style.order.length;++a){const h=this._style._layers[this._style.order[a]],m=h.isHidden(this.painter.transform.zoom),_=this._style._getLayerSourceCache(h);if(h.type!=="raster"||m||!_)continue;const b=h.paint.get("raster-fade-duration");for(const T of this.proxyCoords){const S=this.proxyToSource[T.key][_.id];if(S)for(const I of S){const k=pl(_.getTile(I),_.findLoadedParent(I,0),_,this.painter.transform,b);(k.opacity!==1||k.mix!==0)&&this._clearRenderCacheForTile(_.id,I)}}}}_setupDrapedRenderBatches(){const n=this._style.order,a=n.length;if(a===0)return;const h=[];let m,_=0,b=this._style._layers[n[_]];for(;!this._style.isLayerDraped(b)&&b.isHidden(this.painter.transform.zoom)&&++_<a;)b=this._style._layers[n[_]];for(;_<a;++_){const T=this._style._layers[n[_]];T.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(T)?m===void 0&&(m=_):m!==void 0&&(h.push({start:m,end:_-1}),m=void 0))}m!==void 0&&h.push({start:m,end:_-1}),this._drapedRenderBatches=h}_setupRenderCache(n){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const b=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let T=0;T<b.length;++T){const S=Object.values(b[T]);a.renderCachePool.push(...S)}}return}this._clearRasterFadeFromRenderCache();const h=this.proxyCoords,m=this._tilesDirty;for(let b=h.length-1;b>=0;b--){const T=h[b];if(a.getTileByID(T.key),a.proxyCachedFBO[T.key]!==void 0){const S=n[T.key],I=this.proxyToSource[T.key];let k=0;for(const R in I){const U=I[R],W=S[R];if(!W||W.length!==U.length||U.some((j,$)=>j!==W[$]||m[R]&&m[R].hasOwnProperty(j.key))){k=-1;break}++k}for(const R in a.proxyCachedFBO[T.key])a.renderCache[a.proxyCachedFBO[T.key][R]].dirty=k<0||k!==Object.values(S).length}}const _=[...this._drapedRenderBatches];_.sort((b,T)=>T.end-T.start-(b.end-b.start));for(const b of _)for(const T of h){if(a.proxyCachedFBO[T.key])continue;let S=a.renderCachePool.pop();S===void 0&&a.renderCache.length<50&&(S=a.renderCache.length,a.renderCache.push(this._createFBO())),S!==void 0&&(a.proxyCachedFBO[T.key]={},a.proxyCachedFBO[T.key][b.start]=S,a.renderCache[S].dirty=!0)}this._tilesDirty={}}_setupStencil(n,a,h,m){if(!m||!this._sourceTilesOverlap[m.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const _=this.painter.context,b=_.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let T;if(h.isTileClipped())T=a.length,this._overlapStencilMode.test={func:b.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);T=1,this._overlapStencilMode.test={func:b.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+T>255&&(_.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=T,this._overlapStencilMode.ref=this._stencilRef,h.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):s.StencilMode.disabled}_renderTileClippingMasks(n,a){const h=this.painter,m=this.painter.context,_=m.gl;h._tileClippingMaskIDs={},m.setColorMode(s.ColorMode.disabled),m.setDepthMode(s.DepthMode.disabled);const b=h.useProgram("clippingMask");for(const T of n){const S=h._tileClippingMaskIDs[T.key]=--a;b.draw(m,_.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:_.ALWAYS,mask:0},S,255,_.KEEP,_.KEEP,_.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,Fc(T.projMatrix),"$clipping",h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}}pointCoordinate(n){const a=this.painter.transform;if(n.x<0||n.x>a.width||n.y<0||n.y>a.height)return null;const h=[n.x,n.y,1,1];s.transformMat4$1(h,h,a.pixelMatrixInverse),s.scale$1(h,h,1/h[3]),h[0]/=a.worldSize,h[1]/=a.worldSize;const m=a._camera.position,_=s.mercatorZfromAltitude(1,a.center.lat),b=[m[0],m[1],m[2]/_,0],T=s.subtract([],h.slice(0,3),b);s.normalize(T,T);const S=this.raycast(b,T,this._exaggeration);return S!==null&&S?(s.scaleAndAdd(b,b,T,S),b[3]=b[2],b[2]*=_,b):null}drawDepth(){const n=this.painter,a=n.context,h=this.proxySourceCache,m=Math.ceil(n.width),_=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===m&&this._depthFBO.height===_||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const b=a.gl,T=a.createFramebuffer(m,_,!0);a.activeTexture.set(b.TEXTURE0);const S=new s.Texture(a,{width:m,height:_,data:null},b.RGBA);S.bind(b.NEAREST,b.CLAMP_TO_EDGE),T.colorAttachment.set(S.texture);const I=a.createRenderbuffer(a.gl.DEPTH_COMPONENT16,m,_);T.depthAttachment.set(I),this._depthFBO=T,this._depthTexture=S}a.bindFramebuffer.set(this._depthFBO.framebuffer),a.viewport.set([0,0,m,_]),function(b,T,S,I){if(b.transform.projection.name==="globe")return;const k=b.context,R=k.gl;k.clear({depth:1});const U=b.useProgram("terrainDepth"),W=new s.DepthMode(R.LESS,s.DepthMode.ReadWrite,b.depthRangeFor3D);for(const j of I){const $=S.getTile(j),q=Lc(j.projMatrix,0);T.setupElevationDraw($,U),U.draw(k,R.TRIANGLES,W,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.backCCW,q,"terrain_depth",T.gridBuffer,T.gridIndexBuffer,T.gridNoSkirtSegments)}}(n,this,h,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,a,h){if(n.getSource()instanceof ge)return this._setupProxiedCoordsForImageSource(n,a,h);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const m=this.proxiedCoords[n.id]=[],_=this.proxyCoords;for(let T=0;T<_.length;T++){const S=_[T],I=this._findTileCoveringTileID(S,n);if(I){const k=this._createProxiedId(S,I,h[S.key]&&h[S.key][n.id]);m.push(k),this.proxyToSource[S.key][n.id]=[k]}}let b=!1;for(let T=0;T<a.length;T++){const S=n.getTile(a[T]);if(!S||!S.hasData())continue;const I=this._findTileCoveringTileID(S.tileID,this.proxySourceCache);if(I&&I.tileID.canonical.z!==S.tileID.canonical.z){const k=this.proxyToSource[I.tileID.key][n.id],R=this._createProxiedId(I.tileID,S,h[I.tileID.key]&&h[I.tileID.key][n.id]);k?k.splice(k.length-1,0,R):this.proxyToSource[I.tileID.key][n.id]=[R],m.push(R),b=!0}}this._sourceTilesOverlap[n.id]=b}_setupProxiedCoordsForImageSource(n,a,h){if(!n.getSource().loaded())return;const m=this.proxiedCoords[n.id]=[],_=this.proxyCoords,b=n.getSource(),T=new s.pointGeometry(b.tileID.x,b.tileID.y)._div(1<<b.tileID.z),S=b.coordinates.map(s.MercatorCoordinate.fromLngLat).reduce((k,R)=>(k.min.x=Math.min(k.min.x,R.x-T.x),k.min.y=Math.min(k.min.y,R.y-T.y),k.max.x=Math.max(k.max.x,R.x-T.x),k.max.y=Math.max(k.max.y,R.y-T.y),k),{min:new s.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),I=(k,R)=>{const U=k.wrap+k.canonical.x/(1<<k.canonical.z),W=k.canonical.y/(1<<k.canonical.z),j=s.EXTENT/(1<<k.canonical.z),$=R.wrap+R.canonical.x/(1<<R.canonical.z),q=R.canonical.y/(1<<R.canonical.z);return U+j<$+S.min.x||U>$+S.max.x||W+j<q+S.min.y||W>q+S.max.y};for(let k=0;k<_.length;k++){const R=_[k];for(let U=0;U<a.length;U++){const W=n.getTile(a[U]);if(!W||!W.hasData()||I(R,W.tileID))continue;const j=this._createProxiedId(R,W,h[R.key]&&h[R.key][n.id]),$=this.proxyToSource[R.key][n.id];$?$.push(j):this.proxyToSource[R.key][n.id]=[j],m.push(j)}}}_createProxiedId(n,a,h){let m=this.orthoMatrix;if(h){const _=h.find(b=>b.key===a.tileID.key);if(_)return _}if(a.tileID.key!==n.key){const _=n.canonical.z-a.tileID.canonical.z;let b,T,S;m=s.create();const I=a.tileID.wrap-n.wrap<<n.overscaledZ;_>0?(b=s.EXTENT>>_,T=b*((a.tileID.canonical.x<<_)-n.canonical.x+I),S=b*((a.tileID.canonical.y<<_)-n.canonical.y)):(b=s.EXTENT<<-_,T=s.EXTENT*(a.tileID.canonical.x-(n.canonical.x+I<<-_)),S=s.EXTENT*(a.tileID.canonical.y-(n.canonical.y<<-_))),s.ortho(m,0,b,0,b,0,1),s.translate(m,m,[T,S,0])}return new ml(a.tileID,n.key,m)}_findTileCoveringTileID(n,a){let h=a.getTile(n);if(h&&h.hasData())return h;const m=this._findCoveringTileCache[a.id],_=m[n.key];if(h=_?a.getTileByID(_):null,h&&h.hasData()||_===null)return h;let b=h?h.tileID:n,T=b.overscaledZ;const S=a.getSource().minzoom,I=[];if(!_){const R=a.getSource().maxzoom;if(n.canonical.z>=R){const U=n.canonical.z-R;a.getSource().reparseOverscaled?(T=Math.max(n.canonical.z+2,a.transform.tileZoom),b=new s.OverscaledTileID(T,n.wrap,R,n.canonical.x>>U,n.canonical.y>>U)):U!==0&&(T=R,b=new s.OverscaledTileID(T,n.wrap,R,n.canonical.x>>U,n.canonical.y>>U))}b.key!==n.key&&(I.push(b.key),h=a.getTile(b))}const k=R=>{I.forEach(U=>{m[U]=R}),I.length=0};for(T-=1;T>=S&&(!h||!h.hasData());T--){h&&k(h.tileID.key);const R=b.calculateScaledKey(T);if(h=a.getTileByID(R),h&&h.hasData())break;const U=m[R];if(U===null)break;U===void 0?I.push(R):h=a.getTileByID(U)}return k(h?h.tileID.key:null),h&&h.hasData()?h:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,a){let h=this._tilesDirty[n];h||(h=this._tilesDirty[n]={}),h[a.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const n=function(a){let h=0;const m=new s.StructArrayLayout2ui4,_=131;for(let b=1;b<129;b++){for(let T=1;T<129;T++)h=b*_+T,m.emplaceBack(h,h+1),m.emplaceBack(h,h+_),m.emplaceBack(h+1,h+_),b===128&&m.emplaceBack(h+_,h+_+1);m.emplaceBack(h+1,h+1+_)}return m}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(n),this.wireframeSegments=s.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,n.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Vc{static cacheKey(n,a,h,m){let _=`${a}${m?m.cacheKey:""}`;for(const b of h)n.usedDefines.includes(b)&&(_+=`/${b}`);return _}constructor(n,a,h,m,_,b){const T=n.gl;this.program=T.createProgram();const S=function(q){const N=[];for(let J=0;J<q.length;J++){if(q[J]===null)continue;const X=q[J].split(" ");N.push(X.pop())}return N}(h.staticAttributes),I=m?m.getBinderAttributes():[],k=S.concat(I);let R=m?m.defines():[];R=R.concat(b.map(q=>`#define ${q}`));const U=R.concat(n.extStandardDerivatives?`#extension GL_OES_standard_derivatives : enable
`.concat(hl):hl,hl,ul,sa.fragmentSource,Oo.fragmentSource,h.fragmentSource).join(`
`),W=R.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,ul,sa.vertexSource,Oo.vertexSource,cl.vertexSource,h.vertexSource).join(`
`),j=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);T.shaderSource(j,U),T.compileShader(j),T.attachShader(this.program,j);const $=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource($,W),T.compileShader($),T.attachShader(this.program,$),this.attributes={},this.numAttributes=k.length;for(let q=0;q<this.numAttributes;q++)k[q]&&(T.bindAttribLocation(this.program,q,k[q]),this.attributes[k[q]]=q);T.linkProgram(this.program),T.deleteShader($),T.deleteShader(j),this.fixedUniforms=_(n),this.binderUniforms=m?m.getUniforms(n):[],b.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=(q=>({u_dem:new s.Uniform1i(q),u_dem_prev:new s.Uniform1i(q),u_dem_unpack:new s.Uniform4f(q),u_dem_tl:new s.Uniform2f(q),u_dem_scale:new s.Uniform1f(q),u_dem_tl_prev:new s.Uniform2f(q),u_dem_scale_prev:new s.Uniform1f(q),u_dem_size:new s.Uniform1f(q),u_dem_lerp:new s.Uniform1f(q),u_exaggeration:new s.Uniform1f(q),u_depth:new s.Uniform1i(q),u_depth_size_inv:new s.Uniform2f(q),u_meter_to_dem:new s.Uniform1f(q),u_label_plane_matrix_inv:new s.UniformMatrix4f(q),u_tile_tl_up:new s.Uniform3f(q),u_tile_tr_up:new s.Uniform3f(q),u_tile_br_up:new s.Uniform3f(q),u_tile_bl_up:new s.Uniform3f(q),u_tile_up_scale:new s.Uniform1f(q)}))(n)),b.indexOf("FOG")!==-1&&(this.fogUniforms=(q=>({u_fog_matrix:new s.UniformMatrix4f(q),u_fog_range:new s.Uniform2f(q),u_fog_color:new s.Uniform4f(q),u_fog_horizon_blend:new s.Uniform1f(q),u_fog_temporal_offset:new s.Uniform1f(q),u_frustum_tl:new s.Uniform3f(q),u_frustum_tr:new s.Uniform3f(q),u_frustum_br:new s.Uniform3f(q),u_frustum_bl:new s.Uniform3f(q),u_globe_pos:new s.Uniform3f(q),u_globe_radius:new s.Uniform1f(q),u_globe_transition:new s.Uniform1f(q),u_is_globe:new s.Uniform1i(q),u_viewport:new s.Uniform2f(q)}))(n))}}setTerrainUniformValues(n,a){if(!this.terrainUniforms)return;const h=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const m in a)h[m].set(this.program,m,a[m])}}setFogUniformValues(n,a){if(!this.fogUniforms)return;const h=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const m in a)h[m].set(this.program,m,a[m])}}draw(n,a,h,m,_,b,T,S,I,k,R,U,W,j,$){const q=n.gl;if(this.failedToCreate)return;n.program.set(this.program),n.setDepthMode(h),n.setStencilMode(m),n.setColorMode(_),n.setCullFace(b);for(const J of Object.keys(this.fixedUniforms))this.fixedUniforms[J].set(this.program,J,T[J]);j&&j.setUniforms(this.program,n,this.binderUniforms,U,{zoom:W});const N={[q.LINES]:2,[q.TRIANGLES]:3,[q.LINE_STRIP]:1}[a];for(const J of R.get()){const X=J.vaos||(J.vaos={});(X[S]||(X[S]=new fl)).bind(n,this,I,j?j.getPaintVertexBuffers():[],k,J.vertexOffset,$||[]),q.drawElements(a,J.primitiveLength*N,q.UNSIGNED_SHORT,J.primitiveOffset*N*2)}}}function wh(c,n,a){const h=1/kn(a,1,n.transform.tileZoom),m=Math.pow(2,a.tileID.overscaledZ),_=a.tileSize*Math.pow(2,n.transform.tileZoom)/m,b=_*(a.tileID.canonical.x+a.tileID.wrap*m),T=_*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[h,c.fromScale,c.toScale],u_fade:c.t,u_pixel_coord_upper:[b>>16,T>>16],u_pixel_coord_lower:[65535&b,65535&T]}}const ca=s.create(),_s=(c,n,a,h,m,_,b,T,S,I,k)=>{const R=n.style.light,U=R.properties.get("position"),W=[U.x,U.y,U.z],j=s.create$1();R.properties.get("anchor")==="viewport"&&(s.fromRotation(j,-n.transform.angle),s.transformMat3(W,W,j));const $=R.properties.get("color"),q=n.transform,N={u_matrix:c,u_lightpos:W,u_lightintensity:R.properties.get("intensity"),u_lightcolor:[$.r,$.g,$.b],u_vertical_gradient:+a,u_opacity:h,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ca,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:m,u_edge_radius:_};return q.projection.name==="globe"&&(N.u_tile_id=[b.canonical.x,b.canonical.y,1<<b.canonical.z],N.u_zoom_transition=S,N.u_inv_rot_matrix=k,N.u_merc_center=I,N.u_up_dir=q.projection.upVector(new s.CanonicalTileID(0,0,0),I[0]*s.EXTENT,I[1]*s.EXTENT),N.u_height_lift=T),N},Th=(c,n,a,h,m,_,b,T,S,I,k,R,U)=>{const W=_s(c,n,a,h,m,_,b,I,k,R,U),j={u_height_factor:-Math.pow(2,b.overscaledZ)/S.tileSize/8};return s.extend(W,wh(T,n,S),j)},ua=c=>({u_matrix:c}),_l=(c,n,a,h)=>s.extend(ua(c),wh(a,n,h)),Pr=(c,n)=>({u_matrix:c,u_world:n}),Nc=(c,n,a,h,m)=>s.extend(_l(c,n,a,h),{u_world:m}),Eh=s.create(),jc=(c,n,a,h,m,_)=>{const b=c.transform,T=b.projection.name==="globe";let S;if(_.paint.get("circle-pitch-alignment")==="map")if(T){const k=s.globePixelsToTileUnits(b.zoom,n.canonical)*b._pixelsPerMercatorPixel;S=Float32Array.from([k,0,0,k])}else S=b.calculatePixelsToTileUnitsMatrix(a);else S=new Float32Array([b.pixelsToGLUnits[0],0,0,b.pixelsToGLUnits[1]]);const I={u_camera_to_center_distance:b.cameraToCenterDistance,u_matrix:c.translatePosMatrix(n.projMatrix,a,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_device_pixel_ratio:s.exported.devicePixelRatio,u_extrude_scale:S,u_inv_rot_matrix:Eh,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(T){I.u_inv_rot_matrix=h,I.u_merc_center=m,I.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],I.u_zoom_transition=s.globeToMercatorTransition(b.zoom);const k=m[0]*s.EXTENT,R=m[1]*s.EXTENT;I.u_up_dir=b.projection.upVector(new s.CanonicalTileID(0,0,0),k,R)}return I},Sh=c=>{const n=[];return c.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),c.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n},$c=(c,n,a,h)=>{const m=s.EXTENT/a.tileSize;return{u_matrix:c,u_camera_to_center_distance:n.getCameraToCenterDistance(h),u_extrude_scale:[n.pixelsToGLUnits[0]/m,n.pixelsToGLUnits[1]/m]}},Ch=(c,n,a=1)=>({u_matrix:c,u_color:n,u_overlay:0,u_overlay_scale:a}),qc=s.create(),Gf=(c,n,a,h,m,_,b)=>{const T=c.transform,S=T.projection.name==="globe",I=S?s.globePixelsToTileUnits(T.zoom,n.canonical)*T._pixelsPerMercatorPixel:kn(a,1,_),k={u_matrix:n.projMatrix,u_extrude_scale:I,u_intensity:b,u_inv_rot_matrix:qc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(S){k.u_inv_rot_matrix=h,k.u_merc_center=m,k.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],k.u_zoom_transition=s.globeToMercatorTransition(T.zoom);const R=m[0]*s.EXTENT,U=m[1]*s.EXTENT;k.u_up_dir=T.projection.upVector(new s.CanonicalTileID(0,0,0),R,U)}return k},gl=(c,n,a,h,m,_,b,T)=>{const S=c.transform,I=S.calculatePixelsToTileUnitsMatrix(n),k={u_matrix:Ah(c,n,a,m),u_pixels_to_tile_units:I,u_device_pixel_ratio:b,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:_,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:T};if(xl(a)){const R=yl(n,c.transform);k.u_texsize=n.lineAtlasTexture.size,k.u_scale=[R,h.fromScale,h.toScale],k.u_mix=h.t}return k},Zf=(c,n,a,h,m,_)=>{const b=c.transform,T=yl(n,b);return{u_matrix:Ah(c,n,a,m),u_texsize:n.imageAtlasTexture.size,u_pixels_to_tile_units:b.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:_,u_image:0,u_scale:[T,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function yl(c,n){return 1/kn(c,1,n.tileZoom)}function Ah(c,n,a,h){return c.translatePosMatrix(h||n.tileID.projMatrix,n,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}function xl(c){const n=c.paint.get("line-dasharray").value;return n.value||n.kind!=="constant"}const Wf=(c,n,a,h,m,_)=>{return{u_matrix:c,u_tl_parent:n,u_scale_parent:a,u_fade_t:h.mix,u_opacity:h.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(T=m.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(b=m.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:vl(m.paint.get("raster-hue-rotate")),u_perspective_transform:_};var b,T};function vl(c){c*=Math.PI/180;const n=Math.sin(c),a=Math.cos(c);return[(2*a+1)/3,(-Math.sqrt(3)*n-a+1)/3,(Math.sqrt(3)*n-a+1)/3]}const Mh=s.create(),Gc=(c,n,a,h,m,_,b,T,S,I,k,R,U,W,j,$)=>{const q=m.transform,N={u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:q.cameraToCenterDistance,u_rotate_symbol:+a,u_aspect_ratio:q.width/q.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:b,u_coord_matrix:T,u_is_text:+S,u_pitch_with_map:+h,u_texsize:I,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Mh,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Mh,u_up_vector:[0,-1,0]};return $.name==="globe"&&(N.u_tile_id=[k.canonical.x,k.canonical.y,1<<k.canonical.z],N.u_zoom_transition=R,N.u_inv_rot_matrix=W,N.u_merc_center=U,N.u_camera_forward=q._camera.forward(),N.u_ecef_origin=s.globeECEFOrigin(q.globeMatrix,k.toUnwrapped()),N.u_tile_matrix=Float32Array.from(q.globeMatrix),N.u_up_vector=j),N},Zc=(c,n,a,h,m,_,b,T,S,I,k,R,U,W,j,$,q)=>s.extend(Gc(c,n,a,h,m,_,b,T,S,I,R,U,W,j,$,q),{u_gamma_scale:h?m.transform.cameraToCenterDistance*Math.cos(m.terrain?0:m.transform._pitch):1,u_device_pixel_ratio:s.exported.devicePixelRatio,u_is_halo:+k}),gs=(c,n,a,h,m,_,b,T,S,I,k,R,U,W,j,$)=>s.extend(Zc(c,n,a,h,m,_,b,T,!0,S,!0,k,R,U,W,j,$),{u_texsize_icon:I,u_texture_icon:1}),Xf=(c,n,a)=>({u_matrix:c,u_opacity:n,u_color:a}),Hf=(c,n,a,h,m,_)=>s.extend(function(b,T,S,I){const k=S.imageManager.getPattern(b.from.toString()),R=S.imageManager.getPattern(b.to.toString()),{width:U,height:W}=S.imageManager.getPixelSize(),j=Math.pow(2,I.tileID.overscaledZ),$=I.tileSize*Math.pow(2,S.transform.tileZoom)/j,q=$*(I.tileID.canonical.x+I.tileID.wrap*j),N=$*I.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:k.tl,u_pattern_br_a:k.br,u_pattern_tl_b:R.tl,u_pattern_br_b:R.br,u_texsize:[U,W],u_mix:T.t,u_pattern_size_a:k.displaySize,u_pattern_size_b:R.displaySize,u_scale_a:T.fromScale,u_scale_b:T.toScale,u_tile_units_to_pixels:1/kn(I,1,S.transform.tileZoom),u_pixel_coord_upper:[q>>16,N>>16],u_pixel_coord_lower:[65535&q,65535&N]}}(h,_,a,m),{u_matrix:c,u_opacity:n}),Kf={fillExtrusion:c=>({u_matrix:new s.UniformMatrix4f(c),u_lightpos:new s.Uniform3f(c),u_lightintensity:new s.Uniform1f(c),u_lightcolor:new s.Uniform3f(c),u_vertical_gradient:new s.Uniform1f(c),u_opacity:new s.Uniform1f(c),u_edge_radius:new s.Uniform1f(c),u_ao:new s.Uniform2f(c),u_tile_id:new s.Uniform3f(c),u_zoom_transition:new s.Uniform1f(c),u_inv_rot_matrix:new s.UniformMatrix4f(c),u_merc_center:new s.Uniform2f(c),u_up_dir:new s.Uniform3f(c),u_height_lift:new s.Uniform1f(c)}),fillExtrusionPattern:c=>({u_matrix:new s.UniformMatrix4f(c),u_lightpos:new s.Uniform3f(c),u_lightintensity:new s.Uniform1f(c),u_lightcolor:new s.Uniform3f(c),u_vertical_gradient:new s.Uniform1f(c),u_height_factor:new s.Uniform1f(c),u_edge_radius:new s.Uniform1f(c),u_ao:new s.Uniform2f(c),u_tile_id:new s.Uniform3f(c),u_zoom_transition:new s.Uniform1f(c),u_inv_rot_matrix:new s.UniformMatrix4f(c),u_merc_center:new s.Uniform2f(c),u_up_dir:new s.Uniform3f(c),u_height_lift:new s.Uniform1f(c),u_image:new s.Uniform1i(c),u_texsize:new s.Uniform2f(c),u_pixel_coord_upper:new s.Uniform2f(c),u_pixel_coord_lower:new s.Uniform2f(c),u_scale:new s.Uniform3f(c),u_fade:new s.Uniform1f(c),u_opacity:new s.Uniform1f(c)}),fill:c=>({u_matrix:new s.UniformMatrix4f(c)}),fillPattern:c=>({u_matrix:new s.UniformMatrix4f(c),u_image:new s.Uniform1i(c),u_texsize:new s.Uniform2f(c),u_pixel_coord_upper:new s.Uniform2f(c),u_pixel_coord_lower:new s.Uniform2f(c),u_scale:new s.Uniform3f(c),u_fade:new s.Uniform1f(c)}),fillOutline:c=>({u_matrix:new s.UniformMatrix4f(c),u_world:new s.Uniform2f(c)}),fillOutlinePattern:c=>({u_matrix:new s.UniformMatrix4f(c),u_world:new s.Uniform2f(c),u_image:new s.Uniform1i(c),u_texsize:new s.Uniform2f(c),u_pixel_coord_upper:new s.Uniform2f(c),u_pixel_coord_lower:new s.Uniform2f(c),u_scale:new s.Uniform3f(c),u_fade:new s.Uniform1f(c)}),circle:c=>({u_camera_to_center_distance:new s.Uniform1f(c),u_extrude_scale:new s.UniformMatrix2f(c),u_device_pixel_ratio:new s.Uniform1f(c),u_matrix:new s.UniformMatrix4f(c),u_inv_rot_matrix:new s.UniformMatrix4f(c),u_merc_center:new s.Uniform2f(c),u_tile_id:new s.Uniform3f(c),u_zoom_transition:new s.Uniform1f(c),u_up_dir:new s.Uniform3f(c)}),collisionBox:c=>({u_matrix:new s.UniformMatrix4f(c),u_camera_to_center_distance:new s.Uniform1f(c),u_extrude_scale:new s.Uniform2f(c)}),collisionCircle:c=>({u_matrix:new s.UniformMatrix4f(c),u_inv_matrix:new s.UniformMatrix4f(c),u_camera_to_center_distance:new s.Uniform1f(c),u_viewport_size:new s.Uniform2f(c)}),debug:c=>({u_color:new s.UniformColor(c),u_matrix:new s.UniformMatrix4f(c),u_overlay:new s.Uniform1i(c),u_overlay_scale:new s.Uniform1f(c)}),clippingMask:c=>({u_matrix:new s.UniformMatrix4f(c)}),heatmap:c=>({u_extrude_scale:new s.Uniform1f(c),u_intensity:new s.Uniform1f(c),u_matrix:new s.UniformMatrix4f(c),u_inv_rot_matrix:new s.UniformMatrix4f(c),u_merc_center:new s.Uniform2f(c),u_tile_id:new s.Uniform3f(c),u_zoom_transition:new s.Uniform1f(c),u_up_dir:new s.Uniform3f(c)}),heatmapTexture:c=>({u_image:new s.Uniform1i(c),u_color_ramp:new s.Uniform1i(c),u_opacity:new s.Uniform1f(c)}),hillshade:c=>({u_matrix:new s.UniformMatrix4f(c),u_image:new s.Uniform1i(c),u_latrange:new s.Uniform2f(c),u_light:new s.Uniform2f(c),u_shadow:new s.UniformColor(c),u_highlight:new s.UniformColor(c),u_accent:new s.UniformColor(c)}),hillshadePrepare:c=>({u_matrix:new s.UniformMatrix4f(c),u_image:new s.Uniform1i(c),u_dimension:new s.Uniform2f(c),u_zoom:new s.Uniform1f(c),u_unpack:new s.Uniform4f(c)}),line:c=>({u_matrix:new s.UniformMatrix4f(c),u_pixels_to_tile_units:new s.UniformMatrix2f(c),u_device_pixel_ratio:new s.Uniform1f(c),u_units_to_pixels:new s.Uniform2f(c),u_dash_image:new s.Uniform1i(c),u_gradient_image:new s.Uniform1i(c),u_image_height:new s.Uniform1f(c),u_texsize:new s.Uniform2f(c),u_scale:new s.Uniform3f(c),u_mix:new s.Uniform1f(c),u_alpha_discard_threshold:new s.Uniform1f(c),u_trim_offset:new s.Uniform2f(c)}),linePattern:c=>({u_matrix:new s.UniformMatrix4f(c),u_texsize:new s.Uniform2f(c),u_pixels_to_tile_units:new s.UniformMatrix2f(c),u_device_pixel_ratio:new s.Uniform1f(c),u_image:new s.Uniform1i(c),u_units_to_pixels:new s.Uniform2f(c),u_scale:new s.Uniform3f(c),u_fade:new s.Uniform1f(c),u_alpha_discard_threshold:new s.Uniform1f(c)}),raster:c=>({u_matrix:new s.UniformMatrix4f(c),u_tl_parent:new s.Uniform2f(c),u_scale_parent:new s.Uniform1f(c),u_fade_t:new s.Uniform1f(c),u_opacity:new s.Uniform1f(c),u_image0:new s.Uniform1i(c),u_image1:new s.Uniform1i(c),u_brightness_low:new s.Uniform1f(c),u_brightness_high:new s.Uniform1f(c),u_saturation_factor:new s.Uniform1f(c),u_contrast_factor:new s.Uniform1f(c),u_spin_weights:new s.Uniform3f(c),u_perspective_transform:new s.Uniform2f(c)}),symbolIcon:c=>({u_is_size_zoom_constant:new s.Uniform1i(c),u_is_size_feature_constant:new s.Uniform1i(c),u_size_t:new s.Uniform1f(c),u_size:new s.Uniform1f(c),u_camera_to_center_distance:new s.Uniform1f(c),u_rotate_symbol:new s.Uniform1i(c),u_aspect_ratio:new s.Uniform1f(c),u_fade_change:new s.Uniform1f(c),u_matrix:new s.UniformMatrix4f(c),u_label_plane_matrix:new s.UniformMatrix4f(c),u_coord_matrix:new s.UniformMatrix4f(c),u_is_text:new s.Uniform1i(c),u_pitch_with_map:new s.Uniform1i(c),u_texsize:new s.Uniform2f(c),u_tile_id:new s.Uniform3f(c),u_zoom_transition:new s.Uniform1f(c),u_inv_rot_matrix:new s.UniformMatrix4f(c),u_merc_center:new s.Uniform2f(c),u_camera_forward:new s.Uniform3f(c),u_tile_matrix:new s.UniformMatrix4f(c),u_up_vector:new s.Uniform3f(c),u_ecef_origin:new s.Uniform3f(c),u_texture:new s.Uniform1i(c)}),symbolSDF:c=>({u_is_size_zoom_constant:new s.Uniform1i(c),u_is_size_feature_constant:new s.Uniform1i(c),u_size_t:new s.Uniform1f(c),u_size:new s.Uniform1f(c),u_camera_to_center_distance:new s.Uniform1f(c),u_rotate_symbol:new s.Uniform1i(c),u_aspect_ratio:new s.Uniform1f(c),u_fade_change:new s.Uniform1f(c),u_matrix:new s.UniformMatrix4f(c),u_label_plane_matrix:new s.UniformMatrix4f(c),u_coord_matrix:new s.UniformMatrix4f(c),u_is_text:new s.Uniform1i(c),u_pitch_with_map:new s.Uniform1i(c),u_texsize:new s.Uniform2f(c),u_texture:new s.Uniform1i(c),u_gamma_scale:new s.Uniform1f(c),u_device_pixel_ratio:new s.Uniform1f(c),u_tile_id:new s.Uniform3f(c),u_zoom_transition:new s.Uniform1f(c),u_inv_rot_matrix:new s.UniformMatrix4f(c),u_merc_center:new s.Uniform2f(c),u_camera_forward:new s.Uniform3f(c),u_tile_matrix:new s.UniformMatrix4f(c),u_up_vector:new s.Uniform3f(c),u_ecef_origin:new s.Uniform3f(c),u_is_halo:new s.Uniform1i(c)}),symbolTextAndIcon:c=>({u_is_size_zoom_constant:new s.Uniform1i(c),u_is_size_feature_constant:new s.Uniform1i(c),u_size_t:new s.Uniform1f(c),u_size:new s.Uniform1f(c),u_camera_to_center_distance:new s.Uniform1f(c),u_rotate_symbol:new s.Uniform1i(c),u_aspect_ratio:new s.Uniform1f(c),u_fade_change:new s.Uniform1f(c),u_matrix:new s.UniformMatrix4f(c),u_label_plane_matrix:new s.UniformMatrix4f(c),u_coord_matrix:new s.UniformMatrix4f(c),u_is_text:new s.Uniform1i(c),u_pitch_with_map:new s.Uniform1i(c),u_texsize:new s.Uniform2f(c),u_texsize_icon:new s.Uniform2f(c),u_texture:new s.Uniform1i(c),u_texture_icon:new s.Uniform1i(c),u_gamma_scale:new s.Uniform1f(c),u_device_pixel_ratio:new s.Uniform1f(c),u_is_halo:new s.Uniform1i(c)}),background:c=>({u_matrix:new s.UniformMatrix4f(c),u_opacity:new s.Uniform1f(c),u_color:new s.UniformColor(c)}),backgroundPattern:c=>({u_matrix:new s.UniformMatrix4f(c),u_opacity:new s.Uniform1f(c),u_image:new s.Uniform1i(c),u_pattern_tl_a:new s.Uniform2f(c),u_pattern_br_a:new s.Uniform2f(c),u_pattern_tl_b:new s.Uniform2f(c),u_pattern_br_b:new s.Uniform2f(c),u_texsize:new s.Uniform2f(c),u_mix:new s.Uniform1f(c),u_pattern_size_a:new s.Uniform2f(c),u_pattern_size_b:new s.Uniform2f(c),u_scale_a:new s.Uniform1f(c),u_scale_b:new s.Uniform1f(c),u_pixel_coord_upper:new s.Uniform2f(c),u_pixel_coord_lower:new s.Uniform2f(c),u_tile_units_to_pixels:new s.Uniform1f(c)}),terrainRaster:aa,terrainDepth:aa,skybox:c=>({u_matrix:new s.UniformMatrix4f(c),u_sun_direction:new s.Uniform3f(c),u_cubemap:new s.Uniform1i(c),u_opacity:new s.Uniform1f(c),u_temporal_offset:new s.Uniform1f(c)}),skyboxGradient:c=>({u_matrix:new s.UniformMatrix4f(c),u_color_ramp:new s.Uniform1i(c),u_center_direction:new s.Uniform3f(c),u_radius:new s.Uniform1f(c),u_opacity:new s.Uniform1f(c),u_temporal_offset:new s.Uniform1f(c)}),skyboxCapture:c=>({u_matrix_3f:new s.UniformMatrix3f(c),u_sun_direction:new s.Uniform3f(c),u_sun_intensity:new s.Uniform1f(c),u_color_tint_r:new s.Uniform4f(c),u_color_tint_m:new s.Uniform4f(c),u_luminance:new s.Uniform1f(c)}),globeRaster:c=>({u_proj_matrix:new s.UniformMatrix4f(c),u_globe_matrix:new s.UniformMatrix4f(c),u_normalize_matrix:new s.UniformMatrix4f(c),u_merc_matrix:new s.UniformMatrix4f(c),u_zoom_transition:new s.Uniform1f(c),u_merc_center:new s.Uniform2f(c),u_image0:new s.Uniform1i(c),u_grid_matrix:new s.UniformMatrix3f(c),u_frustum_tl:new s.Uniform3f(c),u_frustum_tr:new s.Uniform3f(c),u_frustum_br:new s.Uniform3f(c),u_frustum_bl:new s.Uniform3f(c),u_globe_pos:new s.Uniform3f(c),u_globe_radius:new s.Uniform1f(c),u_viewport:new s.Uniform2f(c)}),globeAtmosphere:c=>({u_frustum_tl:new s.Uniform3f(c),u_frustum_tr:new s.Uniform3f(c),u_frustum_br:new s.Uniform3f(c),u_frustum_bl:new s.Uniform3f(c),u_horizon:new s.Uniform1f(c),u_transition:new s.Uniform1f(c),u_fadeout_range:new s.Uniform1f(c),u_color:new s.Uniform4f(c),u_high_color:new s.Uniform4f(c),u_space_color:new s.Uniform4f(c),u_star_intensity:new s.Uniform1f(c),u_star_density:new s.Uniform1f(c),u_star_size:new s.Uniform1f(c),u_temporal_offset:new s.Uniform1f(c),u_horizon_angle:new s.Uniform1f(c),u_rotation_matrix:new s.UniformMatrix4f(c)})};let bl;function Ih(c,n,a,h,m,_,b){const T=c.context,S=T.gl,I=c.transform,k=c.useProgram("collisionBox"),R=[];let U=0,W=0;for(let ue=0;ue<h.length;ue++){const le=h[ue],re=n.getTile(le),ce=re.getBucket(a);if(!ce)continue;const ae=Zn(le,ce,I);let me=ae;m[0]===0&&m[1]===0||(me=c.translatePosMatrix(ae,re,m,_));const Ce=b?ce.textCollisionBox:ce.iconCollisionBox,rt=ce.collisionCircleArray;if(rt.length>0){const xe=s.create(),Ve=me;s.mul(xe,ce.placementInvProjMatrix,I.glCoordMatrix),s.mul(xe,xe,ce.placementViewportMatrix),R.push({circleArray:rt,circleOffset:W,transform:Ve,invTransform:xe,projection:ce.getProjection()}),U+=rt.length/4,W=U}Ce&&(c.terrain&&c.terrain.setupElevationDraw(re,k),k.draw(T,S.LINES,s.DepthMode.disabled,s.StencilMode.disabled,c.colorModeForRenderPass(),s.CullFaceMode.disabled,$c(me,I,re,ce.getProjection()),a.id,Ce.layoutVertexBuffer,Ce.indexBuffer,Ce.segments,null,I.zoom,null,[Ce.collisionVertexBuffer,Ce.collisionVertexBufferExt]))}if(!b||!R.length)return;const j=c.useProgram("collisionCircle"),$=new s.StructArrayLayout2f1f2i16;$.resize(4*U),$._trim();let q=0;for(const ue of R)for(let le=0;le<ue.circleArray.length/4;le++){const re=4*le,ce=ue.circleArray[re+0],ae=ue.circleArray[re+1],me=ue.circleArray[re+2],Ce=ue.circleArray[re+3];$.emplace(q++,ce,ae,me,Ce,0),$.emplace(q++,ce,ae,me,Ce,1),$.emplace(q++,ce,ae,me,Ce,2),$.emplace(q++,ce,ae,me,Ce,3)}(!bl||bl.length<2*U)&&(bl=function(ue){const le=2*ue,re=new s.StructArrayLayout3ui6;re.resize(le),re._trim();for(let ce=0;ce<le;ce++){const ae=6*ce;re.uint16[ae+0]=4*ce+0,re.uint16[ae+1]=4*ce+1,re.uint16[ae+2]=4*ce+2,re.uint16[ae+3]=4*ce+2,re.uint16[ae+4]=4*ce+3,re.uint16[ae+5]=4*ce+0}return re}(U));const N=T.createIndexBuffer(bl,!0),J=T.createVertexBuffer($,s.collisionCircleLayout.members,!0);for(const ue of R){const le={u_matrix:ue.transform,u_inv_matrix:ue.invTransform,u_camera_to_center_distance:(X=I).getCameraToCenterDistance(ue.projection),u_viewport_size:[X.width,X.height]};j.draw(T,S.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,c.colorModeForRenderPass(),s.CullFaceMode.disabled,le,a.id,J,N,s.SegmentVector.simpleSegment(0,2*ue.circleOffset,ue.circleArray.length,ue.circleArray.length/2),null,I.zoom)}var X;J.destroy(),N.destroy()}const zh=s.create();function Wc(c,n,a,h,m,_){const{horizontalAlign:b,verticalAlign:T}=s.getAnchorAlignment(c),S=-(b-.5)*n,I=-(T-.5)*a,k=s.evaluateVariableOffset(c,h);return new s.pointGeometry((S/m+k[0])*_,(I/m+k[1])*_)}function Xc(c,n,a,h,m,_,b,T,S,I,k){const R=c.text.placedSymbolArray,U=c.text.dynamicLayoutVertexArray,W=c.icon.dynamicLayoutVertexArray,j={},$=Wn(T,c.getProjection(),_),q=_.elevation,N=c.getProjection().upVectorScale(T.canonical,_.center.lat,_.worldSize);U.clear();for(let J=0;J<R.length;J++){const X=R.get(J),ue=c.allowVerticalPlacement&&!X.placedOrientation,le=X.hidden||!X.crossTileID||ue?null:h[X.crossTileID];if(le){const re=new s.pointGeometry(X.tileAnchorX,X.tileAnchorY),ce=c.getProjection().upVector(T.canonical,re.x,re.y),ae=q?q.getAtTileOffset(T,re.x,re.y):0,me=Kt([X.projectedAnchorX+ae*ce[0]*N.metersToTile,X.projectedAnchorY+ae*ce[1]*N.metersToTile,X.projectedAnchorZ+ae*ce[2]*N.metersToTile],a?$:b),Ce=Js(_.getCameraToCenterDistance(c.getProjection()),me.signedDistanceFromCamera);let rt=m.evaluateSizeForFeature(c.textSizeData,I,X)*Ce/s.ONE_EM;a&&(rt*=c.tilePixelRatio/S);const{width:xe,height:Ve,anchor:Ge,textOffset:pt,textScale:Le}=le,lt=Wc(Ge,xe,Ve,pt,Le,rt);let qe;if(a){const _t=re.add(lt),{x:It,y:Lt,z:qt}=c.getProjection().projectTilePoint(_t.x,_t.y,T.canonical);qe=Kt([It+ae*ce[0]*N.metersToTile,Lt+ae*ce[1]*N.metersToTile,qt+ae*ce[2]*N.metersToTile],b).point}else{const _t=n?lt.rotate(-_.angle):lt;qe=[me.point[0]+_t.x,me.point[1]+_t.y,0]}const vt=c.allowVerticalPlacement&&X.placedOrientation===s.WritingMode.vertical?Math.PI/2:0;for(let _t=0;_t<X.numGlyphs;_t++)s.addDynamicAttributes(U,qe[0],qe[1],qe[2],vt);k&&X.associatedIconIndex>=0&&(j[X.associatedIconIndex]={shiftedAnchor:qe,angle:vt})}else fo(X.numGlyphs,U)}if(k){W.clear();const J=c.icon.placedSymbolArray;for(let X=0;X<J.length;X++){const ue=J.get(X);if(ue.hidden)fo(ue.numGlyphs,W);else{const le=j[X];if(le)for(let re=0;re<ue.numGlyphs;re++)s.addDynamicAttributes(W,le.shiftedAnchor[0],le.shiftedAnchor[1],le.shiftedAnchor[2],le.angle);else fo(ue.numGlyphs,W)}}c.icon.dynamicLayoutVertexBuffer.updateData(W)}c.text.dynamicLayoutVertexBuffer.updateData(U)}function kh(c,n,a){return a.iconsInText&&n?"symbolTextAndIcon":c?"symbolSDF":"symbolIcon"}function Hc(c,n,a,h,m,_,b,T,S,I,k,R){const U=c.context,W=U.gl,j=c.transform,$=T==="map",q=S==="map",N=$&&a.layout.get("symbol-placement")!=="point",J=$&&!q&&!N,X=a.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ue=!1;const le=c.depthModeForSublayer(0,s.DepthMode.ReadOnly),re=[s.mercatorXfromLng(j.center.lng),s.mercatorYfromLat(j.center.lat)],ce=a.layout.get("text-variable-anchor"),ae=j.projection.name==="globe",me=[],Ce=[0,-1,0];let rt=Ce;!ae&&!j.mercatorFromTransition||$||(rt=function(xe){const Ve=xe._camera.getWorldToCamera(xe.worldSize,1),Ge=s.multiply([],Ve,xe.globeMatrix);s.invert(Ge,Ge);const pt=[0,0,0],Le=[0,1,0,0];return s.transformMat4$1(Le,Le,Ge),pt[0]=Le[0],pt[1]=Le[1],pt[2]=Le[2],s.normalize(pt,pt),pt}(j));for(const xe of h){const Ve=n.getTile(xe),Ge=Ve.getBucket(a);if(!Ge||Ge.projection.name==="mercator"&&ae)continue;const pt=m?Ge.text:Ge.icon;if(!pt||Ge.fullyClipped||!pt.segments.get().length)continue;const Le=pt.programConfigurations.get(a.id),lt=m||Ge.sdfIcons,qe=m?Ge.textSizeData:Ge.iconSizeData,vt=q||j.pitch!==0,_t=s.evaluateSizeForZoom(qe,j.zoom);let It,Lt,qt,li,zt=[0,0],Xt=null;if(m){if(Lt=Ve.glyphAtlasTexture,qt=W.LINEAR,It=Ve.glyphAtlasTexture.size,Ge.iconsInText){zt=Ve.imageAtlasTexture.size,Xt=Ve.imageAtlasTexture;const Bn=qe.kind==="composite"||qe.kind==="camera";li=vt||c.options.rotating||c.options.zooming||Bn?W.LINEAR:W.NEAREST}}else{const Bn=a.layout.get("icon-size").constantOr(0)!==1||Ge.iconsNeedLinear;Lt=Ve.imageAtlasTexture,qt=lt||c.options.rotating||c.options.zooming||Bn||vt?W.LINEAR:W.NEAREST,It=Ve.imageAtlasTexture.size}const pi=Ge.projection.name==="globe",Vi=pi?rt:Ce,Yi=pi?s.globeToMercatorTransition(j.zoom):0,Mi=Wn(xe,Ge.getProjection(),j),_n=j.calculatePixelsToTileUnitsMatrix(Ve),Mr=ni(Mi,Ve.tileID.canonical,q,$,j,Ge.getProjection(),_n),Wr=c.terrain&&q&&N?s.invert(s.create(),Mr):zh,Ni=Er(Mi,Ve.tileID.canonical,q,$,j,Ge.getProjection(),_n),$i=ce&&Ge.hasTextData(),ti=a.layout.get("icon-text-fit")!=="none"&&$i&&Ge.hasIconData();if(N){const Bn=j.elevation,Go=Bn?Bn.getAtTileOffsetFunc(xe,j.center.lat,j.worldSize,Ge.getProjection()):Aa=>[0,0,0],xo=ri(Mi,Ve.tileID.canonical,q,$,j,Ge.getProjection(),_n);ea(Ge,Mi,c,m,xo,Ni,q,I,Go,xe)}const rn=N||m&&ce||ti,Sn=c.translatePosMatrix(Mi,Ve,_,b),Ri=rn?zh:Mr,Cn=c.translatePosMatrix(Ni,Ve,_,b,!0),No=Ge.getProjection().createInversionMatrix(j,xe.canonical),Rn=[];c.terrain&&q&&Rn.push("PITCH_WITH_MAP_TERRAIN"),pi&&Rn.push("PROJECTION_GLOBE_VIEW"),rn&&Rn.push("PROJECTED_POS_ON_VIEWPORT");const jo=lt&&a.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let $o;$o=lt?Ge.iconsInText?gs(qe.kind,_t,J,q,c,Sn,Ri,Cn,It,zt,xe,Yi,re,No,Vi,Ge.getProjection()):Zc(qe.kind,_t,J,q,c,Sn,Ri,Cn,m,It,!0,xe,Yi,re,No,Vi,Ge.getProjection()):Gc(qe.kind,_t,J,q,c,Sn,Ri,Cn,m,It,xe,Yi,re,No,Vi,Ge.getProjection());const qo={program:c.useProgram(kh(lt,m,Ge),Le,Rn),buffers:pt,uniformValues:$o,atlasTexture:Lt,atlasTextureIcon:Xt,atlasInterpolation:qt,atlasInterpolationIcon:li,isSDF:lt,hasHalo:jo,tile:Ve,labelPlaneMatrixInv:Wr};if(X&&Ge.canOverlap){ue=!0;const Bn=pt.segments.get();for(const Go of Bn)me.push({segments:new s.SegmentVector([Go]),sortKey:Go.sortKey,state:qo})}else me.push({segments:pt.segments,sortKey:0,state:qo})}ue&&me.sort((xe,Ve)=>xe.sortKey-Ve.sortKey);for(const xe of me){const Ve=xe.state;if(c.terrain&&c.terrain.setupElevationDraw(Ve.tile,Ve.program,{useDepthForOcclusion:!ae,labelPlaneMatrixInv:Ve.labelPlaneMatrixInv}),U.activeTexture.set(W.TEXTURE0),Ve.atlasTexture.bind(Ve.atlasInterpolation,W.CLAMP_TO_EDGE),Ve.atlasTextureIcon&&(U.activeTexture.set(W.TEXTURE1),Ve.atlasTextureIcon&&Ve.atlasTextureIcon.bind(Ve.atlasInterpolationIcon,W.CLAMP_TO_EDGE)),Ve.isSDF){const Ge=Ve.uniformValues;Ve.hasHalo&&(Ge.u_is_halo=1,Kc(Ve.buffers,xe.segments,a,c,Ve.program,le,k,R,Ge)),Ge.u_is_halo=0}Kc(Ve.buffers,xe.segments,a,c,Ve.program,le,k,R,Ve.uniformValues)}}function Kc(c,n,a,h,m,_,b,T,S){const I=h.context,k=[c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer,c.globeExtVertexBuffer];m.draw(I,I.gl.TRIANGLES,_,b,T,s.CullFaceMode.disabled,S,a.id,c.layoutVertexBuffer,c.indexBuffer,n,a.paint,h.transform.zoom,c.programConfigurations.get(a.id),k)}function wl(c,n,a,h,m,_,b){const T=c.context.gl,S=a.paint.get("fill-pattern"),I=S&&S.constantOr(1),k=a.getCrossfadeParameters();let R,U,W,j,$;b?(U=I&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=T.LINES):(U=I?"fillPattern":"fill",R=T.TRIANGLES);for(const q of h){const N=n.getTile(q);if(I&&!N.patternsLoaded())continue;const J=N.getBucket(a);if(!J)continue;c.prepareDrawTile();const X=J.programConfigurations.get(a.id),ue=c.useProgram(U,X);I&&(c.context.activeTexture.set(T.TEXTURE0),N.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),X.updatePaintBuffers(k));const le=S.constantOr(null);if(le&&N.imageAtlas){const ce=N.imageAtlas,ae=ce.patternPositions[le.to.toString()],me=ce.patternPositions[le.from.toString()];ae&&me&&X.setConstantPatternPositions(ae,me)}const re=c.translatePosMatrix(q.projMatrix,N,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(b){j=J.indexBuffer2,$=J.segments2;const ce=c.terrain&&c.terrain.renderingToTexture?c.terrain.drapeBufferSize:[T.drawingBufferWidth,T.drawingBufferHeight];W=U==="fillOutlinePattern"&&I?Nc(re,c,k,N,ce):Pr(re,ce)}else j=J.indexBuffer,$=J.segments,W=I?_l(re,c,k,N):ua(re);c.prepareDrawProgram(c.context,ue,q.toUnwrapped()),ue.draw(c.context,R,m,c.stencilModeForClipping(q),_,s.CullFaceMode.disabled,W,a.id,J.layoutVertexBuffer,j,$,a.paint,c.transform.zoom,X)}}function qr(c,n,a,h,m,_,b){const T=c.context,S=T.gl,I=c.transform,k=a.paint.get("fill-extrusion-pattern"),R=k.constantOr(1),U=a.getCrossfadeParameters(),W=a.paint.get("fill-extrusion-opacity"),j=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),a.paint.get("fill-extrusion-ambient-occlusion-radius")],$=a.layout.get("fill-extrusion-edge-radius"),q=I.projection.name==="globe"?s.fillExtrusionHeightLift():0,N=I.projection.name==="globe",J=N?s.globeToMercatorTransition(I.zoom):0,X=[s.mercatorXfromLng(I.center.lng),s.mercatorYfromLat(I.center.lat)],ue=[];N&&(ue.push("PROJECTION_GLOBE_VIEW"),c.style.terrainSetForDrapingOnly()&&ue.push("TERRAIN")),j[0]>0&&ue.push("FAUX_AO");for(const le of h){const re=n.getTile(le),ce=re.getBucket(a);if(!ce||ce.projection.name!==I.projection.name)continue;const ae=ce.programConfigurations.get(a.id),me=c.useProgram(R?"fillExtrusionPattern":"fillExtrusion",ae,ue);if(c.terrain){const Le=c.terrain;if(c.style.terrainSetForDrapingOnly())Le.setupElevationDraw(re,me,{useMeterToDem:!0});else{if(!ce.enableTerrain)continue;if(Le.setupElevationDraw(re,me,{useMeterToDem:!0}),ha(T,n,le,ce,a,Le),!ce.centroidVertexBuffer){const lt=me.attributes.a_centroid_pos;lt!==void 0&&S.vertexAttrib2f(lt,0,0)}}}R&&(c.context.activeTexture.set(S.TEXTURE0),re.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),ae.updatePaintBuffers(U));const Ce=k.constantOr(null);if(Ce&&re.imageAtlas){const Le=re.imageAtlas,lt=Le.patternPositions[Ce.to.toString()],qe=Le.patternPositions[Ce.from.toString()];lt&&qe&&ae.setConstantPatternPositions(lt,qe)}const rt=c.translatePosMatrix(le.projMatrix,re,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),xe=I.projection.createInversionMatrix(I,le.canonical),Ve=a.paint.get("fill-extrusion-vertical-gradient"),Ge=R?Th(rt,c,Ve,W,j,$,le,U,re,q,J,X,xe):_s(rt,c,Ve,W,j,$,le,q,J,X,xe);c.prepareDrawProgram(T,me,le.toUnwrapped());const pt=[];c.terrain&&pt.push(ce.centroidVertexBuffer),N&&pt.push(ce.layoutVertexExtBuffer),me.draw(T,T.gl.TRIANGLES,m,_,b,s.CullFaceMode.backCCW,Ge,a.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,a.paint,c.transform.zoom,ae,pt)}}function ha(c,n,a,h,m,_){const b=[N=>{let J=N.canonical.x-1,X=N.wrap;return J<0&&(J=(1<<N.canonical.z)-1,X--),new s.OverscaledTileID(N.overscaledZ,X,N.canonical.z,J,N.canonical.y)},N=>{let J=N.canonical.x+1,X=N.wrap;return J===1<<N.canonical.z&&(J=0,X++),new s.OverscaledTileID(N.overscaledZ,X,N.canonical.z,J,N.canonical.y)},N=>new s.OverscaledTileID(N.overscaledZ,N.wrap,N.canonical.z,N.canonical.x,(N.canonical.y===0?1<<N.canonical.z:N.canonical.y)-1),N=>new s.OverscaledTileID(N.overscaledZ,N.wrap,N.canonical.z,N.canonical.x,N.canonical.y===(1<<N.canonical.z)-1?0:N.canonical.y+1)],T=N=>{const J=n.getSource().minzoom,X=le=>{const re=n.getTileByID(le);if(re&&re.hasData())return re.getBucket(m)},ue=[0,-1,1];for(const le of ue){if(N.overscaledZ+le<J)continue;const re=X(N.calculateScaledKey(N.overscaledZ+le));if(re)return re}},S=[0,0,0],I=(N,J)=>(S[0]=Math.min(N.min.y,J.min.y),S[1]=Math.max(N.max.y,J.max.y),S[2]=s.EXTENT-J.min.x>N.max.x?J.min.x-s.EXTENT:N.max.x,S),k=(N,J)=>(S[0]=Math.min(N.min.x,J.min.x),S[1]=Math.max(N.max.x,J.max.x),S[2]=s.EXTENT-J.min.y>N.max.y?J.min.y-s.EXTENT:N.max.y,S),R=[(N,J)=>I(N,J),(N,J)=>I(J,N),(N,J)=>k(N,J),(N,J)=>k(J,N)],U=new s.pointGeometry(0,0);let W,j,$;const q=(N,J,X,ue,le)=>{const re=[[ue?X:N,ue?N:X,0],[ue?X:J,ue?J:X,0]],ce=le<0?s.EXTENT+le:le,ae=[ue?ce:(N+J)/2,ue?(N+J)/2:ce,0];return X===0&&le<0||X!==0&&le>0?_.getForTilePoints($,[ae],!0,j):re.push(ae),_.getForTilePoints(a,re,!0,W),Math.max(re[0][2],re[1][2],ae[2])/_.exaggeration()};for(let N=0;N<4;N++){const J=(N<2?1:5)-N,X=h.borders[N];if(X.length===0)continue;const ue=$=b[N](a),le=T(ue);if(!(le&&le instanceof s.FillExtrusionBucket&&le.enableTerrain)||h.borderDoneWithNeighborZ[N]===le.canonical.z&&le.borderDoneWithNeighborZ[J]===h.canonical.z||(j=_.findDEMTileFor(ue),!j||!j.dem))continue;if(!W){const me=_.findDEMTileFor(a);if(!me||!me.dem)return;W=me}const re=le.borders[J];let ce=0;const ae=le.borderDoneWithNeighborZ[J]!==h.canonical.z;if(h.canonical.z===le.canonical.z){for(let me=0;me<X.length;me++){const Ce=h.featuresOnBorder[X[me]],rt=Ce.borders[N];let xe;for(;ce<re.length&&(xe=le.featuresOnBorder[re[ce]],!(xe.borders[J][1]>rt[0]+3));)ae&&le.encodeCentroid(void 0,xe,!1),ce++;if(xe&&ce<re.length){const Ve=ce;let Ge=0;for(;!(xe.borders[J][0]>rt[1]-3)&&(Ge++,++ce!==re.length);)xe=le.featuresOnBorder[re[ce]];if(xe=le.featuresOnBorder[re[Ve]],Ce.intersectsCount()>1||xe.intersectsCount()>1||Ge!==1){Ge!==1&&(ce=Ve),h.encodeCentroid(void 0,Ce,!1),ae&&le.encodeCentroid(void 0,xe,!1);continue}const pt=R[N](Ce,xe),Le=N%2?s.EXTENT-1:0;U.x=q(pt[0],Math.min(s.EXTENT-1,pt[1]),Le,N<2,pt[2]),U.y=0,h.encodeCentroid(U,Ce,!1),ae&&le.encodeCentroid(U,xe,!1)}else h.encodeCentroid(void 0,Ce,!1)}h.borderDoneWithNeighborZ[N]=le.canonical.z,h.needsCentroidUpdate=!0,ae&&(le.borderDoneWithNeighborZ[J]=h.canonical.z,le.needsCentroidUpdate=!0)}else{for(const me of X)h.encodeCentroid(void 0,h.featuresOnBorder[me],!1);if(ae){for(const me of re)le.encodeCentroid(void 0,le.featuresOnBorder[me],!1);le.borderDoneWithNeighborZ[J]=h.canonical.z,le.needsCentroidUpdate=!0}h.borderDoneWithNeighborZ[N]=le.canonical.z,h.needsCentroidUpdate=!0}}(h.needsCentroidUpdate||!h.centroidVertexBuffer&&h.centroidVertexArray.length!==0)&&h.uploadCentroid(c)}const Ph=new s.Color(1,0,0,1),ys=new s.Color(0,1,0,1),xs=new s.Color(0,0,1,1),Dh=new s.Color(1,0,1,1),Yc=new s.Color(0,1,1,1);function yi(c,n,a){const h=c.context,m=c.transform,_=h.gl,b=m.projection.name==="globe",T=b?["PROJECTION_GLOBE_VIEW"]:null;let S=a.projMatrix;if(b&&s.globeToMercatorTransition(m.zoom)>0){const Ce=s.transitionTileAABBinECEF(a.canonical,m),rt=s.globeDenormalizeECEF(Ce);S=s.multiply(new Float32Array(16),m.globeMatrix,rt),s.multiply(S,m.projMatrix,S)}const I=c.useProgram("debug",null,T),k=n.getTileByID(a.key);c.terrain&&c.terrain.setupElevationDraw(k,I);const R=s.DepthMode.disabled,U=s.StencilMode.disabled,W=c.colorModeForRenderPass(),j="$debug";h.activeTexture.set(_.TEXTURE0),c.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),b?k._makeGlobeTileDebugBuffers(c.context,m):k._makeDebugTileBoundsBuffers(c.context,m.projection);const $=k._tileDebugBuffer||c.debugBuffer,q=k._tileDebugIndexBuffer||c.debugIndexBuffer,N=k._tileDebugSegments||c.debugSegments;I.draw(h,_.LINE_STRIP,R,U,W,s.CullFaceMode.disabled,Ch(S,s.Color.red),j,$,q,N,null,null,null,[k._globeTileDebugBorderBuffer]);const J=k.latestRawTileData,X=Math.floor((J&&J.byteLength||0)/1024),ue=n.getTile(a).tileSize,le=512/Math.min(ue,512)*(a.overscaledZ/m.zoom)*.5;let re=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(re+=` => ${a.overscaledZ}`),re+=` ${X}kb`,function(Ce,rt){Ce.initDebugOverlayCanvas();const xe=Ce.debugOverlayCanvas,Ve=Ce.context.gl,Ge=Ce.debugOverlayCanvas.getContext("2d");Ge.clearRect(0,0,xe.width,xe.height),Ge.shadowColor="white",Ge.shadowBlur=2,Ge.lineWidth=1.5,Ge.strokeStyle="white",Ge.textBaseline="top",Ge.font="bold 36px Open Sans, sans-serif",Ge.fillText(rt,5,5),Ge.strokeText(rt,5,5),Ce.debugOverlayTexture.update(xe),Ce.debugOverlayTexture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE)}(c,re);const ce=k._tileDebugTextBuffer||c.debugBuffer,ae=k._tileDebugTextIndexBuffer||c.quadTriangleIndexBuffer,me=k._tileDebugTextSegments||c.debugSegments;I.draw(h,_.TRIANGLES,R,U,s.ColorMode.alphaBlended,s.CullFaceMode.disabled,Ch(S,s.Color.transparent,le),j,ce,ae,me,null,null,null,[k._globeTileDebugTextBuffer])}function da(c,n,a,h){fa(c,0,n+a/2,c.transform.width,a,h)}function Lh(c,n,a,h){fa(c,n-a/2,0,a,c.transform.height,h)}function fa(c,n,a,h,m,_){const b=c.context,T=b.gl;T.enable(T.SCISSOR_TEST),T.scissor(n*s.exported.devicePixelRatio,a*s.exported.devicePixelRatio,h*s.exported.devicePixelRatio,m*s.exported.devicePixelRatio),b.clear({color:_}),T.disable(T.SCISSOR_TEST)}const pa=s.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Yf}=pa;function yo(c,n,a,h){c.emplaceBack(n,a,h)}class Jc{constructor(n){this.vertexArray=new s.StructArrayLayout3f12,this.indices=new s.StructArrayLayout3ui6,yo(this.vertexArray,-1,-1,1),yo(this.vertexArray,1,-1,1),yo(this.vertexArray,-1,1,1),yo(this.vertexArray,1,1,1),yo(this.vertexArray,-1,-1,-1),yo(this.vertexArray,1,-1,-1),yo(this.vertexArray,-1,1,-1),yo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,Yf),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=s.SegmentVector.simpleSegment(0,0,36,12)}}function vs(c,n,a,h,m,_){const b=c.gl,T=n.paint.get("sky-atmosphere-color"),S=n.paint.get("sky-atmosphere-halo-color"),I=n.paint.get("sky-atmosphere-sun-intensity"),k=((R,U,W,j,$)=>({u_matrix_3f:R,u_sun_direction:U,u_sun_intensity:W,u_color_tint_r:[j.r,j.g,j.b,j.a],u_color_tint_m:[$.r,$.g,$.b,$.a],u_luminance:5e-5}))(s.fromMat4(s.create$1(),h),m,I,T,S);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+_,n.skyboxTexture,0),a.draw(c,b.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.frontCW,k,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const Qc=s.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Tl{constructor(n){const a=new s.StructArrayLayout5f20;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);const h=new s.StructArrayLayout3ui6;h.emplaceBack(0,1,2),h.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(a,Qc.members),this.indexBuffer=n.createIndexBuffer(h),this.segments=s.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const bs={symbol:function(c,n,a,h,m){if(c.renderPass!=="translucent")return;const _=s.StencilMode.disabled,b=c.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(T,S,I,k,R,U,W){const j=S.transform,$=R==="map",q=U==="map";for(const N of T){const J=k.getTile(N),X=J.getBucket(I);if(!X||!X.text||!X.text.segments.get().length)continue;const ue=s.evaluateSizeForZoom(X.textSizeData,j.zoom),le=Wn(N,X.getProjection(),j),re=j.calculatePixelsToTileUnitsMatrix(J),ce=ni(le,J.tileID.canonical,q,$,j,X.getProjection(),re),ae=I.layout.get("icon-text-fit")!=="none"&&X.hasIconData();if(ue){const me=Math.pow(2,j.zoom-J.tileID.overscaledZ);Xc(X,$,q,W,s.symbolSize,j,ce,N,me,ue,ae)}}}(h,c,a,n,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),m),a.paint.get("icon-opacity").constantOr(1)!==0&&Hc(c,n,a,h,!1,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),a.layout.get("icon-rotation-alignment"),a.layout.get("icon-pitch-alignment"),a.layout.get("icon-keep-upright"),_,b),a.paint.get("text-opacity").constantOr(1)!==0&&Hc(c,n,a,h,!0,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),a.layout.get("text-keep-upright"),_,b),n.map.showCollisionBoxes&&(Ih(c,n,a,h,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),Ih(c,n,a,h,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(c,n,a,h){if(c.renderPass!=="translucent")return;const m=a.paint.get("circle-opacity"),_=a.paint.get("circle-stroke-width"),b=a.paint.get("circle-stroke-opacity"),T=a.layout.get("circle-sort-key").constantOr(1)!==void 0;if(m.constantOr(1)===0&&(_.constantOr(1)===0||b.constantOr(1)===0))return;const S=c.context,I=S.gl,k=c.transform,R=c.depthModeForSublayer(0,s.DepthMode.ReadOnly),U=s.StencilMode.disabled,W=c.colorModeForRenderPass(),j=k.projection.name==="globe",$=[s.mercatorXfromLng(k.center.lng),s.mercatorYfromLat(k.center.lat)],q=[];for(let J=0;J<h.length;J++){const X=h[J],ue=n.getTile(X),le=ue.getBucket(a);if(!le||le.projection.name!==k.projection.name)continue;const re=le.programConfigurations.get(a.id),ce=Sh(a);j&&ce.push("PROJECTION_GLOBE_VIEW");const ae=c.useProgram("circle",re,ce),me=le.layoutVertexBuffer,Ce=le.globeExtVertexBuffer,rt=le.indexBuffer,xe=k.projection.createInversionMatrix(k,X.canonical),Ve={programConfiguration:re,program:ae,layoutVertexBuffer:me,globeExtVertexBuffer:Ce,indexBuffer:rt,uniformValues:jc(c,X,ue,xe,$,a),tile:ue};if(T){const Ge=le.segments.get();for(const pt of Ge)q.push({segments:new s.SegmentVector([pt]),sortKey:pt.sortKey,state:Ve})}else q.push({segments:le.segments,sortKey:0,state:Ve})}T&&q.sort((J,X)=>J.sortKey-X.sortKey);const N={useDepthForOcclusion:!j};for(const J of q){const{programConfiguration:X,program:ue,layoutVertexBuffer:le,globeExtVertexBuffer:re,indexBuffer:ce,uniformValues:ae,tile:me}=J.state,Ce=J.segments;c.terrain&&c.terrain.setupElevationDraw(me,ue,N),c.prepareDrawProgram(S,ue,me.tileID.toUnwrapped()),ue.draw(S,I.TRIANGLES,R,U,W,s.CullFaceMode.disabled,ae,a.id,le,ce,Ce,a.paint,k.zoom,X,[re])}},heatmap:function(c,n,a,h){if(a.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){const m=c.context,_=m.gl,b=s.StencilMode.disabled,T=new s.ColorMode([_.ONE,_.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(W,j,$,q){const N=W.gl,J=j.width*q,X=j.height*q;W.activeTexture.set(N.TEXTURE1),W.viewport.set([0,0,J,X]);let ue=$.heatmapFbo;if(!ue||ue&&(ue.width!==J||ue.height!==X)){ue&&ue.destroy();const le=N.createTexture();N.bindTexture(N.TEXTURE_2D,le),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MIN_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MAG_FILTER,N.LINEAR),ue=$.heatmapFbo=W.createFramebuffer(J,X,!1),function(re,ce,ae,me,Ce,rt){const xe=re.gl;xe.texImage2D(xe.TEXTURE_2D,0,xe.RGBA,Ce,rt,0,xe.RGBA,re.extRenderToTextureHalfFloat?re.extTextureHalfFloat.HALF_FLOAT_OES:xe.UNSIGNED_BYTE,null),me.colorAttachment.set(ae)}(W,0,le,ue,J,X)}else N.bindTexture(N.TEXTURE_2D,ue.colorAttachment.get()),W.bindFramebuffer.set(ue.framebuffer)})(m,c,a,c.transform.projection.name==="globe"?.5:.25),m.clear({color:s.Color.transparent});const S=c.transform,I=S.projection.name==="globe",k=I?["PROJECTION_GLOBE_VIEW"]:null,R=I?s.CullFaceMode.frontCCW:s.CullFaceMode.disabled,U=[s.mercatorXfromLng(S.center.lng),s.mercatorYfromLat(S.center.lat)];for(let W=0;W<h.length;W++){const j=h[W];if(n.hasRenderableParent(j))continue;const $=n.getTile(j),q=$.getBucket(a);if(!q||q.projection.name!==S.projection.name)continue;const N=q.programConfigurations.get(a.id),J=c.useProgram("heatmap",N,k),{zoom:X}=c.transform;c.terrain&&c.terrain.setupElevationDraw($,J),c.prepareDrawProgram(m,J,j.toUnwrapped());const ue=S.projection.createInversionMatrix(S,j.canonical);J.draw(m,_.TRIANGLES,s.DepthMode.disabled,b,T,R,Gf(c,j,$,ue,U,X,a.paint.get("heatmap-intensity")),a.id,q.layoutVertexBuffer,q.indexBuffer,q.segments,a.paint,c.transform.zoom,N,I?[q.globeExtVertexBuffer]:null)}m.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(m,_){const b=m.context,T=b.gl,S=_.heatmapFbo;if(!S)return;b.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,S.colorAttachment.get()),b.activeTexture.set(T.TEXTURE1);let I=_.colorRampTexture;I||(I=_.colorRampTexture=new s.Texture(b,_.colorRamp,T.RGBA)),I.bind(T.LINEAR,T.CLAMP_TO_EDGE),m.useProgram("heatmapTexture").draw(b,T.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,m.colorModeForRenderPass(),s.CullFaceMode.disabled,((k,R,U,W)=>({u_image:0,u_color_ramp:1,u_opacity:R.paint.get("heatmap-opacity")}))(0,_),_.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,_.paint,m.transform.zoom)}(c,a))},line:function(c,n,a,h){if(c.renderPass!=="translucent")return;const m=a.paint.get("line-opacity"),_=a.paint.get("line-width");if(m.constantOr(1)===0||_.constantOr(1)===0)return;const b=c.depthModeForSublayer(0,s.DepthMode.ReadOnly),T=c.colorModeForRenderPass(),S=c.terrain&&c.terrain.renderingToTexture?1:s.exported.devicePixelRatio,I=a.paint.get("line-dasharray"),k=I.constantOr(1),R=a.layout.get("line-cap"),U=a.paint.get("line-pattern"),W=U.constantOr(1),j=a.paint.get("line-gradient"),$=a.getCrossfadeParameters(),q=W?"linePattern":"line",N=c.context,J=N.gl,X=(le=>{const re=[];xl(le)&&re.push("RENDER_LINE_DASH"),le.paint.get("line-gradient")&&re.push("RENDER_LINE_GRADIENT");const ce=le.paint.get("line-trim-offset");ce[0]===0&&ce[1]===0||re.push("RENDER_LINE_TRIM_OFFSET");const ae=le.paint.get("line-pattern").constantOr(1),me=le.paint.get("line-opacity").constantOr(1)!==1;return!ae&&me&&re.push("RENDER_LINE_ALPHA_DISCARD"),re})(a);let ue=X.includes("RENDER_LINE_ALPHA_DISCARD");c.terrain&&c.terrain.clipOrMaskOverlapStencilType()&&(ue=!1);for(const le of h){const re=n.getTile(le);if(W&&!re.patternsLoaded())continue;const ce=re.getBucket(a);if(!ce)continue;c.prepareDrawTile();const ae=ce.programConfigurations.get(a.id),me=c.useProgram(q,ae,X),Ce=U.constantOr(null);if(Ce&&re.imageAtlas){const qe=re.imageAtlas,vt=qe.patternPositions[Ce.to.toString()],_t=qe.patternPositions[Ce.from.toString()];vt&&_t&&ae.setConstantPatternPositions(vt,_t)}const rt=I.constantOr(null),xe=R.constantOr(null);if(!W&&rt&&xe&&re.lineAtlas){const qe=re.lineAtlas,vt=qe.getDash(rt.to,xe),_t=qe.getDash(rt.from,xe);vt&&_t&&ae.setConstantPatternPositions(vt,_t)}let[Ve,Ge]=a.paint.get("line-trim-offset");(xe==="round"||xe==="square")&&Ve!==Ge&&(Ve===0&&(Ve-=1),Ge===1&&(Ge+=1));const pt=c.terrain?le.projMatrix:null,Le=W?Zf(c,re,a,$,pt,S):gl(c,re,a,$,pt,ce.lineClipsArray.length,S,[Ve,Ge]);if(j){const qe=ce.gradients[a.id];let vt=qe.texture;if(a.gradientVersion!==qe.version){let _t=256;if(a.stepInterpolant){const It=n.getSource().maxzoom,Lt=le.canonical.z===It?Math.ceil(1<<c.transform.maxZoom-le.canonical.z):1;_t=s.clamp(s.nextPowerOfTwo(ce.maxLineLength/s.EXTENT*1024*Lt),256,N.maxTextureSize)}qe.gradient=s.renderColorRamp({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:_t,image:qe.gradient||void 0,clips:ce.lineClipsArray}),qe.texture?qe.texture.update(qe.gradient):qe.texture=new s.Texture(N,qe.gradient,J.RGBA),qe.version=a.gradientVersion,vt=qe.texture}N.activeTexture.set(J.TEXTURE1),vt.bind(a.stepInterpolant?J.NEAREST:J.LINEAR,J.CLAMP_TO_EDGE)}k&&(N.activeTexture.set(J.TEXTURE0),re.lineAtlasTexture.bind(J.LINEAR,J.REPEAT),ae.updatePaintBuffers($)),W&&(N.activeTexture.set(J.TEXTURE0),re.imageAtlasTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),ae.updatePaintBuffers($)),c.prepareDrawProgram(N,me,le.toUnwrapped());const lt=qe=>{me.draw(N,J.TRIANGLES,b,qe,T,s.CullFaceMode.disabled,Le,a.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,a.paint,c.transform.zoom,ae,[ce.layoutVertexBuffer2])};if(ue){const qe=c.stencilModeForClipping(le).ref;qe===0&&c.terrain&&N.clear({stencil:0});const vt={func:J.EQUAL,mask:255};Le.u_alpha_discard_threshold=.8,lt(new s.StencilMode(vt,qe,255,J.KEEP,J.KEEP,J.INVERT)),Le.u_alpha_discard_threshold=0,lt(new s.StencilMode(vt,qe,255,J.KEEP,J.KEEP,J.KEEP))}else lt(c.stencilModeForClipping(le))}ue&&(c.resetStencilClippingMasks(),c.terrain&&N.clear({stencil:0}))},fill:function(c,n,a,h){const m=a.paint.get("fill-color"),_=a.paint.get("fill-opacity");if(_.constantOr(1)===0)return;const b=c.colorModeForRenderPass(),T=a.paint.get("fill-pattern"),S=c.opaquePassEnabledForLayer()&&!T.constantOr(1)&&m.constantOr(s.Color.transparent).a===1&&_.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===S){const I=c.depthModeForSublayer(1,c.renderPass==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly);wl(c,n,a,h,I,b,!1)}if(c.renderPass==="translucent"&&a.paint.get("fill-antialias")){const I=c.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,s.DepthMode.ReadOnly);wl(c,n,a,h,I,b,!0)}},"fill-extrusion":function(c,n,a,h){const m=a.paint.get("fill-extrusion-opacity");if(m!==0&&c.renderPass==="translucent"){const _=new s.DepthMode(c.context.gl.LEQUAL,s.DepthMode.ReadWrite,c.depthRangeFor3D);if(m!==1||a.paint.get("fill-extrusion-pattern").constantOr(1))qr(c,n,a,h,_,s.StencilMode.disabled,s.ColorMode.disabled),qr(c,n,a,h,_,c.stencilModeFor3D(),c.colorModeForRenderPass()),c.resetStencilClippingMasks();else{const b=c.colorModeForRenderPass();qr(c,n,a,h,_,s.StencilMode.disabled,b)}}},hillshade:function(c,n,a,h){if(c.renderPass!=="offscreen"&&c.renderPass!=="translucent")return;const m=c.context,_=c.depthModeForSublayer(0,s.DepthMode.ReadOnly),b=c.colorModeForRenderPass(),T=c.terrain&&c.terrain.renderingToTexture,[S,I]=c.renderPass!=="translucent"||T?[{},h]:c.stencilConfigForOverlap(h);for(const k of I){const R=n.getTile(k);if(R.needsHillshadePrepare&&c.renderPass==="offscreen")ms(c,R,a,_,s.StencilMode.disabled,b);else if(c.renderPass==="translucent"){const U=T&&c.terrain?c.terrain.stencilModeForRTTOverlap(k):S[k.overscaledZ];Dc(c,k,R,a,_,U,b)}}m.viewport.set([0,0,c.width,c.height]),c.resetStencilClippingMasks()},raster:function(c,n,a,h,m,_){if(c.renderPass!=="translucent"||a.paint.get("raster-opacity")===0||!h.length)return;const b=c.context,T=b.gl,S=n.getSource(),I=c.useProgram("raster"),k=c.colorModeForRenderPass(),R=c.terrain&&c.terrain.renderingToTexture,[U,W]=S instanceof ge||R?[{},h]:c.stencilConfigForOverlap(h),j=W[W.length-1].overscaledZ,$=!c.options.moving;for(const q of W){const N=R?s.DepthMode.disabled:c.depthModeForSublayer(q.overscaledZ-j,a.paint.get("raster-opacity")===1?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly,T.LESS),J=q.toUnwrapped(),X=n.getTile(q);if(R&&(!X||!X.hasData()))continue;const ue=R?q.projMatrix:c.transform.calculateProjMatrix(J,$),le=c.terrain&&R?c.terrain.stencilModeForRTTOverlap(q):U[q.overscaledZ],re=_?0:a.paint.get("raster-fade-duration");X.registerFadeDuration(re);const ce=n.findLoadedParent(q,0),ae=pl(X,ce,n,c.transform,re);let me,Ce;c.terrain&&c.terrain.prepareDrawTile();const rt=a.paint.get("raster-resampling")==="nearest"?T.NEAREST:T.LINEAR;b.activeTexture.set(T.TEXTURE0),X.texture.bind(rt,T.CLAMP_TO_EDGE),b.activeTexture.set(T.TEXTURE1),ce?(ce.texture.bind(rt,T.CLAMP_TO_EDGE),me=Math.pow(2,ce.tileID.overscaledZ-X.tileID.overscaledZ),Ce=[X.tileID.canonical.x*me%1,X.tileID.canonical.y*me%1]):X.texture.bind(rt,T.CLAMP_TO_EDGE);const xe=Wf(ue,Ce||[0,0],me||1,ae,a,S instanceof ge?S.perspectiveTransform:[0,0]);if(c.prepareDrawProgram(b,I,J),S instanceof ge)S.boundsBuffer&&S.boundsSegments&&I.draw(b,T.TRIANGLES,N,s.StencilMode.disabled,k,s.CullFaceMode.disabled,xe,a.id,S.boundsBuffer,c.quadTriangleIndexBuffer,S.boundsSegments);else{const{tileBoundsBuffer:Ve,tileBoundsIndexBuffer:Ge,tileBoundsSegments:pt}=c.getTileBoundsBuffers(X);I.draw(b,T.TRIANGLES,N,le,k,s.CullFaceMode.disabled,xe,a.id,Ve,Ge,pt)}}c.resetStencilClippingMasks()},background:function(c,n,a,h){const m=a.paint.get("background-color"),_=a.paint.get("background-opacity");if(_===0)return;const b=c.context,T=b.gl,S=c.transform,I=S.tileSize,k=a.paint.get("background-pattern");if(c.isPatternMissing(k))return;const R=!k&&m.a===1&&_===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass!==R)return;const U=s.StencilMode.disabled,W=c.depthModeForSublayer(0,R==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly),j=c.colorModeForRenderPass(),$=c.useProgram(k?"backgroundPattern":"background");let q,N=h;N||(q=c.getBackgroundTiles(),N=Object.values(q).map(X=>X.tileID)),k&&(b.activeTexture.set(T.TEXTURE0),c.imageManager.bind(c.context));const J=a.getCrossfadeParameters();for(const X of N){const ue=X.toUnwrapped(),le=h?X.projMatrix:c.transform.calculateProjMatrix(ue);c.prepareDrawTile();const re=n?n.getTile(X):q?q[X.key]:new s.Tile(X,I,S.zoom,c),ce=k?Hf(le,_,c,k,{tileID:X,tileSize:I},J):Xf(le,_,m);c.prepareDrawProgram(b,$,ue);const{tileBoundsBuffer:ae,tileBoundsIndexBuffer:me,tileBoundsSegments:Ce}=c.getTileBoundsBuffers(re);$.draw(b,T.TRIANGLES,W,U,j,s.CullFaceMode.disabled,ce,a.id,ae,me,Ce)}},sky:function(c,n,a){const h=c.transform,m=h.projection.name==="mercator"||h.projection.name==="globe"?1:s.smoothstep(7,8,h.zoom),_=a.paint.get("sky-opacity")*m;if(_===0)return;const b=c.context,T=a.paint.get("sky-type"),S=new s.DepthMode(b.gl.LEQUAL,s.DepthMode.ReadOnly,[0,1]),I=c.frameCounter/1e3%1;T==="atmosphere"?c.renderPass==="offscreen"?a.needsSkyboxCapture(c)&&(function(k,R,U,W){const j=k.context,$=j.gl;let q=R.skyboxFbo;if(!q){q=R.skyboxFbo=j.createFramebuffer(32,32,!1),R.skyboxGeometry=new Jc(j),R.skyboxTexture=j.gl.createTexture(),$.bindTexture($.TEXTURE_CUBE_MAP,R.skyboxTexture),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_MIN_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_MAG_FILTER,$.LINEAR);for(let ue=0;ue<6;++ue)$.texImage2D($.TEXTURE_CUBE_MAP_POSITIVE_X+ue,0,$.RGBA,32,32,0,$.RGBA,$.UNSIGNED_BYTE,null)}j.bindFramebuffer.set(q.framebuffer),j.viewport.set([0,0,32,32]);const N=R.getCenter(k,!0),J=k.useProgram("skyboxCapture"),X=new Float64Array(16);s.identity(X),s.rotateY(X,X,.5*-Math.PI),vs(j,R,J,X,N,0),s.identity(X),s.rotateY(X,X,.5*Math.PI),vs(j,R,J,X,N,1),s.identity(X),s.rotateX(X,X,.5*-Math.PI),vs(j,R,J,X,N,2),s.identity(X),s.rotateX(X,X,.5*Math.PI),vs(j,R,J,X,N,3),s.identity(X),vs(j,R,J,X,N,4),s.identity(X),s.rotateY(X,X,Math.PI),vs(j,R,J,X,N,5),j.viewport.set([0,0,k.width,k.height])}(c,a),a.markSkyboxValid(c)):c.renderPass==="sky"&&function(k,R,U,W,j){const $=k.context,q=$.gl,N=k.transform,J=k.useProgram("skybox");$.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_CUBE_MAP,R.skyboxTexture);const X=((ue,le,re,ce,ae)=>({u_matrix:ue,u_sun_direction:le,u_cubemap:0,u_opacity:ce,u_temporal_offset:ae}))(N.skyboxMatrix,R.getCenter(k,!1),0,W,j);k.prepareDrawProgram($,J),J.draw($,q.TRIANGLES,U,s.StencilMode.disabled,k.colorModeForRenderPass(),s.CullFaceMode.backCW,X,"skybox",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(c,a,S,_,I):T==="gradient"&&c.renderPass==="sky"&&function(k,R,U,W,j){const $=k.context,q=$.gl,N=k.transform,J=k.useProgram("skyboxGradient");R.skyboxGeometry||(R.skyboxGeometry=new Jc($)),$.activeTexture.set(q.TEXTURE0);let X=R.colorRampTexture;X||(X=R.colorRampTexture=new s.Texture($,R.colorRamp,q.RGBA)),X.bind(q.LINEAR,q.CLAMP_TO_EDGE);const ue=((le,re,ce,ae,me)=>({u_matrix:le,u_color_ramp:0,u_center_direction:re,u_radius:s.degToRad(ce),u_opacity:ae,u_temporal_offset:me}))(N.skyboxMatrix,R.getCenter(k,!1),R.paint.get("sky-gradient-radius"),W,j);k.prepareDrawProgram($,J),J.draw($,q.TRIANGLES,U,s.StencilMode.disabled,k.colorModeForRenderPass(),s.CullFaceMode.backCW,ue,"skyboxGradient",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(c,a,S,_,I)},debug:function(c,n,a){for(let h=0;h<a.length;h++)yi(c,n,a[h])},custom:function(c,n,a){const h=c.context,m=a.implementation;if(c.transform.projection.unsupportedLayers&&c.transform.projection.unsupportedLayers.includes("custom"))s.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(c.renderPass==="offscreen"){const _=m.prerender;_&&(c.setCustomLayerDefaults(),h.setColorMode(c.colorModeForRenderPass()),_.call(m,h.gl,c.transform.customLayerMatrix()),h.setDirty(),c.setBaseState())}else if(c.renderPass==="translucent"){c.setCustomLayerDefaults(),h.setColorMode(c.colorModeForRenderPass()),h.setStencilMode(s.StencilMode.disabled);const _=m.renderingMode==="3d"?new s.DepthMode(c.context.gl.LEQUAL,s.DepthMode.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,s.DepthMode.ReadOnly);h.setDepthMode(_),m.render(h.gl,c.transform.customLayerMatrix()),h.setDirty(),c.setBaseState(),h.bindFramebuffer.set(null)}}};class eu{constructor(n,a){this.context=new H(n),this.transform=a,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=s.SourceCache.maxUnderzooming+s.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new al,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(n,a){const h=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(h||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new bh(this,n));const m=this._terrain;this.transform.elevation=h?m:null,m.update(n,this.transform,a)}_updateFog(n){const a=n.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[h,m]=a.getFovAdjustedRange(this.transform._fov);if(h>m)return void(this.transform.fogCullDistSq=null);const _=h+.78*(m-h);this.transform.fogCullDistSq=_*_}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(n,a){if(this.width=n*s.exported.devicePixelRatio,this.height=a*s.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style.order)this.style._layers[h].resize()}setup(){const n=this.context,a=new s.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(s.EXTENT,0),a.emplaceBack(0,s.EXTENT),a.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(a,s.posAttributes.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);const h=new s.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(s.EXTENT,0),h.emplaceBack(0,s.EXTENT),h.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=n.createVertexBuffer(h,s.posAttributes.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);const m=new s.StructArrayLayout2i4;m.emplaceBack(-1,-1),m.emplaceBack(1,-1),m.emplaceBack(-1,1),m.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(m,s.posAttributes.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);const _=new s.StructArrayLayout4i8;_.emplaceBack(0,0,0,0),_.emplaceBack(s.EXTENT,0,s.EXTENT,0),_.emplaceBack(0,s.EXTENT,0,s.EXTENT),_.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.mercatorBoundsBuffer=n.createVertexBuffer(_,s.boundsAttributes.members),this.mercatorBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);const b=new s.StructArrayLayout3ui6;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(b);const T=new s.StructArrayLayout1ui2;for(const I of[0,1,3,2,0])T.emplaceBack(I);this.debugIndexBuffer=n.createIndexBuffer(T),this.emptyTexture=new s.Texture(n,new s.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA),this.identityMat=s.create();const S=this.context.gl;this.stencilClearMode=new s.StencilMode({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO),this.loadTimeStamps.push(s.window.performance.now()),this.atmosphereBuffer=new Tl(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context,a=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(n,a.TRIANGLES,s.DepthMode.disabled,this.stencilClearMode,s.ColorMode.disabled,s.CullFaceMode.disabled,Fc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,a,h){if(!a||this.currentStencilSource===a.id||!n.isTileClipped()||!h||h.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let T=!1;for(const S of h)if(this._tileClippingMaskIDs[S.key]===void 0){T=!0;break}if(!T)return}this.currentStencilSource=a.id;const m=this.context,_=m.gl;this.nextStencilID+h.length>256&&this.clearStencil(),m.setColorMode(s.ColorMode.disabled),m.setDepthMode(s.DepthMode.disabled);const b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const T of h){const S=a.getTile(T),I=this._tileClippingMaskIDs[T.key]=this.nextStencilID++,{tileBoundsBuffer:k,tileBoundsIndexBuffer:R,tileBoundsSegments:U}=this.getTileBoundsBuffers(S);b.draw(m,_.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:_.ALWAYS,mask:0},I,255,_.KEEP,_.KEEP,_.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,Fc(T.projMatrix),"$clipping",k,R,U)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,a=this.context.gl;return new s.StencilMode({func:a.NOTEQUAL,mask:255},n,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const a=this.context.gl;return new s.StencilMode({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(n){const a=this.context.gl,h=n.sort((b,T)=>T.overscaledZ-b.overscaledZ),m=h[h.length-1].overscaledZ,_=h[0].overscaledZ-m+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const b={};for(let T=0;T<_;T++)b[T+m]=new s.StencilMode({func:a.GEQUAL,mask:255},T+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=_,[b,h]}return[{[m]:s.StencilMode.disabled},h]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new s.ColorMode([n.CONSTANT_COLOR,n.ONE],new s.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?s.ColorMode.unblended:s.ColorMode.alphaBlended}depthModeForSublayer(n,a,h){if(!this.opaquePassEnabledForLayer())return s.DepthMode.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new s.DepthMode(h||this.context.gl.LEQUAL,a,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,a){this.style=n,this.options=a,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(s.exported.now()),this.imageManager.beginFrame();const h=this.style.order,m=this.style._sourceCaches;for(const S in m){const I=m[S];I.used&&I.prepare(this.context)}const _={},b={},T={};for(const S in m){const I=m[S];_[S]=I.getVisibleCoordinates(),b[S]=_[S].slice().reverse(),T[S]=I.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let S=0;S<h.length;S++)if(this.style._layers[h[S]].is3D()){this.opaquePassCutoff=S;break}if(this.terrain&&(this.terrain.updateTileBinding(T),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.GlobeSharedBuffers(this.context)),s.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const S of h){const I=this.style._layers[S],k=n._getLayerSourceCache(I);if(!I.hasOffscreenPass()||I.isHidden(this.transform.zoom))continue;const R=k?b[k.id]:void 0;(I.type==="custom"||I.isSky()||R&&R.length)&&this.renderLayer(this,k,I,R)}if(this.depthRangeFor3D=[0,1-(n.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:a.showOverdrawInspector?s.Color.black:s.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){const S=this.style._layers[h[this.currentLayer]],I=n._getLayerSourceCache(S);if(S.isSky())continue;const k=I?b[I.id]:void 0;this._renderTileClippingMasks(S,I,k),this.renderLayer(this,I,S,k)}if(this.style.fog&&this.transform.projection.supportsFog&&function(S,I){const k=S.context,R=k.gl,U=S.transform,W=new s.DepthMode(R.LEQUAL,s.DepthMode.ReadOnly,[0,1]),j=S.useProgram("globeAtmosphere",null,U.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),$=s.globeToMercatorTransition(U.zoom),q=I.properties.get("color").toArray01(),N=I.properties.get("high-color").toArray01(),J=I.properties.get("space-color").toArray01PremultipliedAlpha(),X=s.identity$1([]);s.rotateY$1(X,X,-s.degToRad(U._center.lng)),s.rotateX$1(X,X,s.degToRad(U._center.lat)),s.rotateZ$1(X,X,U.angle),s.rotateX$1(X,X,-U._pitch);const ue=s.fromQuat(new Float32Array(16),X),le=s.mapValue(I.properties.get("star-intensity"),0,1,0,.25),re=5e-4,ce=s.mapValue(I.properties.get("horizon-blend"),0,1,re,.25),ae=s.globeUseCustomAntiAliasing(S,k,U)&&ce===re?U.worldSize/(2*Math.PI*1.025)-1:U.globeRadius,me=S.frameCounter/1e3%1,Ce=s.length(U.globeCenterInViewSpace),rt=Math.sqrt(Math.pow(Ce,2)-Math.pow(ae,2)),xe=Math.acos(rt/Ce),Ve=((pt,Le,lt,qe,vt,_t,It,Lt,qt,li,zt,Xt,pi,Vi)=>({u_frustum_tl:pt,u_frustum_tr:Le,u_frustum_br:lt,u_frustum_bl:qe,u_horizon:vt,u_transition:_t,u_fadeout_range:It,u_color:Lt,u_high_color:qt,u_space_color:li,u_star_intensity:zt,u_star_size:5*s.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Xt,u_horizon_angle:pi,u_rotation_matrix:Vi}))(U.frustumCorners.TL,U.frustumCorners.TR,U.frustumCorners.BR,U.frustumCorners.BL,U.frustumCorners.horizon,$,ce,q,N,J,le,me,xe,ue);S.prepareDrawProgram(k,j);const Ge=S.atmosphereBuffer;Ge&&j.draw(k,R.TRIANGLES,W,s.StencilMode.disabled,s.ColorMode.alphaBlended,s.CullFaceMode.backCW,Ve,"skybox",Ge.vertexBuffer,Ge.indexBuffer,Ge.segments)}(this,this.style.fog),this.renderPass="sky",(s.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){const S=this.style._layers[h[this.currentLayer]],I=n._getLayerSourceCache(S);S.isSky()&&this.renderLayer(this,I,S,I?b[I.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;){const S=this.style._layers[h[this.currentLayer]],I=n._getLayerSourceCache(S);if(S.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(S)){if(S.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const k=I?(S.type==="symbol"?T:b)[I.id]:void 0;this._renderTileClippingMasks(S,I,I?_[I.id]:void 0),this.renderLayer(this,I,S,k),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let S=null;s.values(this.style._layers).forEach(I=>{const k=n._getLayerSourceCache(I);k&&!I.isHidden(this.transform.zoom)&&(!S||S.getSource().maxzoom<k.getSource().maxzoom)&&(S=k)}),S&&this.options.showTileBoundaries&&bs.debug(this,S,S.getVisibleCoordinates())}this.options.showPadding&&function(S){const I=S.transform.padding;da(S,S.transform.height-(I.top||0),3,Ph),da(S,I.bottom||0,3,ys),Lh(S,I.left||0,3,xs),Lh(S,S.transform.width-(I.right||0),3,Dh);const k=S.transform.centerPoint;(function(R,U,W,j){fa(R,U-1,W-10,2,20,j),fa(R,U-10,W-1,20,2,j)})(S,k.x,S.transform.height-k.y,Yc)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(s.window.performance.now()),this.saveCanvasCopy())}}renderLayer(n,a,h,m){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="sky"||h.type==="custom"||m&&m.length)&&(this.id=h.id,this.gpuTimingStart(h),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(h.type)||bs[h.type](n,a,h,m,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;let h=this.gpuTimers[n.id];h||(h=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:a.createQueryEXT()}),h.calls++,a.beginQueryEXT(a.TIME_ELAPSED_EXT,h.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,a=n.createQueryEXT();this.deferredRenderGpuTimeQueries.push(a),n.beginQueryEXT(n.TIME_ELAPSED_EXT,a)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const a={};for(const h in n){const m=n[h],_=this.context.extTimerQuery,b=_.getQueryObjectEXT(m.query,_.QUERY_RESULT_EXT)/1e6;_.deleteQueryEXT(m.query),a[h]=b}return a}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const a=this.context.extTimerQuery;let h=0;for(const m of n)h+=a.getQueryObjectEXT(m,a.QUERY_RESULT_EXT)/1e6,a.deleteQueryEXT(m);return h}translatePosMatrix(n,a,h,m,_){if(!h[0]&&!h[1])return n;const b=_?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(b){const I=Math.sin(b),k=Math.cos(b);h=[h[0]*k-h[1]*I,h[0]*I+h[1]*k]}const T=[_?h[0]:kn(a,h[0],this.transform.zoom),_?h[1]:kn(a,h[1],this.transform.zoom),0],S=new Float32Array(16);return s.translate(S,n,T),S}saveTileTexture(n){const a=this._tileTextures[n.size[0]];a?a.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const a=this._tileTextures[n];return a&&a.length>0?a.pop():null}isPatternMissing(n){if(!n)return!1;if(!n.from||!n.to)return!0;const a=this.imageManager.getPattern(n.from.toString()),h=this.imageManager.getPattern(n.to.toString());return!a||!h}currentGlobalDefines(){const n=this.terrain&&this.terrain.renderingToTexture,a=this.style&&this.style.fog,h=[];return this.terrain&&!this.terrain.renderingToTexture&&h.push("TERRAIN"),a&&!n&&a.getOpacity(this.transform.pitch)!==0&&h.push("FOG"),n&&h.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&h.push("OVERDRAW_INSPECTOR"),h}useProgram(n,a,h){this.cache=this.cache||{};const m=h||[],_=this.currentGlobalDefines().concat(m),b=Vc.cacheKey(dl[n],n,_,a);return this.cache[b]||(this.cache[b]=new Vc(this.context,n,dl[n],a,Kf[n],_)),this.cache[b]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=s.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(n,a,h){if(this.terrain&&this.terrain.renderingToTexture)return;const m=this.style.fog;if(m){const _=m.getOpacity(this.transform.pitch),b=((T,S,I,k,R,U,W,j,$,q,N)=>{const J=T.transform,X=S.properties.get("color").toArray01();X[3]=k;const ue=T.frameCounter/1e3%1;return{u_fog_matrix:I?J.calculateFogTileMatrix(I):T.identityMat,u_fog_range:S.getFovAdjustedRange(J._fov),u_fog_color:X,u_fog_horizon_blend:S.properties.get("horizon-blend"),u_fog_temporal_offset:ue,u_frustum_tl:R,u_frustum_tr:U,u_frustum_br:W,u_frustum_bl:j,u_globe_pos:$,u_globe_radius:q,u_viewport:N,u_globe_transition:s.globeToMercatorTransition(J.zoom),u_is_globe:+(J.projection.name==="globe")}})(this,m,h,_,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.exported.devicePixelRatio,this.transform.height*s.exported.devicePixelRatio]);a.setFogUniformValues(n,b)}}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const n=this.context.gl,a=n.createTexture();return n.bindTexture(n.TEXTURE_2D,a),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,a=this._backgroundTiles={},h=this.transform.coveringTiles({tileSize:512});for(const m of h)a[m.key]=n[m.key]||new s.Tile(m,512,this.transform.tileZoom,this);return a}clearBackgroundTiles(){this._backgroundTiles={}}}class ma{constructor(n=0,a=0,h=0,m=0){if(isNaN(n)||n<0||isNaN(a)||a<0||isNaN(h)||h<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=a,this.left=h,this.right=m}interpolate(n,a,h){return a.top!=null&&n.top!=null&&(this.top=s.number(n.top,a.top,h)),a.bottom!=null&&n.bottom!=null&&(this.bottom=s.number(n.bottom,a.bottom,h)),a.left!=null&&n.left!=null&&(this.left=s.number(n.left,a.left,h)),a.right!=null&&n.right!=null&&(this.right=s.number(n.right,a.right,h)),this}getCenter(n,a){const h=s.clamp((this.left+n-this.right)/2,0,n),m=s.clamp((this.top+a-this.bottom)/2,0,a);return new s.pointGeometry(h,m)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new ma(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function tu(c,n){const a=s.getColumn(c,3);s.fromQuat(c,n),s.setColumn(c,3,a)}function ws(c,n){const a=s.identity$1([]);return s.rotateZ$1(a,a,-n),s.rotateX$1(a,a,-c),a}function Ts(c,n){const a=[c[0],c[1],0],h=[n[0],n[1],0];if(s.length(a)>=1e-15){const b=s.normalize([],a);s.scale$2(h,b,s.dot(h,b)),n[0]=h[0],n[1]=h[1]}const m=s.cross([],n,c);if(s.len(m)<1e-15)return null;const _=Math.atan2(-m[1],m[0]);return ws(Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2]),_)}class Et{constructor(n,a){this.position=n,this.orientation=a}get position(){return this._position}set position(n){if(n){const a=n instanceof s.MercatorCoordinate?n:new s.MercatorCoordinate(n[0],n[1],n[2]);this._renderWorldCopies&&(a.x=s.wrap(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(n,a){if(this.orientation=null,!this.position)return;const h=this._elevation?this._elevation.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(n)):0,m=this.position,_=s.MercatorCoordinate.fromLngLat(n,h),b=[_.x-m.x,_.y-m.y,_.z-m.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=Ts(b,a)}setPitchBearing(n,a){this.orientation=ws(s.degToRad(n),s.degToRad(-a))}}class sr{constructor(n,a){this._transform=s.identity([]),this.orientation=a,this.position=n}get mercatorPosition(){const n=this.position;return new s.MercatorCoordinate(n[0],n[1],n[2])}get position(){const n=s.getColumn(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var a;n&&s.setColumn(this._transform,3,[(a=n)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||s.identity$1([]),n&&tu(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,a){this._orientation=ws(n,a),tu(this._transform,this._orientation)}forward(){const n=s.getColumn(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=s.getColumn(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=s.getColumn(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,a){const h=new Float64Array(16);return s.invert(h,this.getWorldToCamera(n,a)),h}getWorldToCameraPosition(n,a,h){const m=this.position;s.scale$2(m,m,-n);const _=new Float64Array(16);return s.fromScaling(_,[h,h,h]),s.translate(_,_,m),_[10]*=a,_}getWorldToCamera(n,a){const h=new Float64Array(16),m=new Float64Array(4),_=this.position;return s.conjugate(m,this._orientation),s.scale$2(_,_,-n),s.fromQuat(h,m),s.translate(h,h,_),h[1]*=-1,h[5]*=-1,h[9]*=-1,h[13]*=-1,h[8]*=a,h[9]*=a,h[10]*=a,h[11]*=a,h}getCameraToClipPerspective(n,a,h,m){const _=new Float64Array(16);return s.perspective(_,n,a,h,m),_}getDistanceToElevation(n){const a=n===0?0:s.mercatorZfromAltitude(n,this.position[1]),h=this.forward();return(a-this.position[2])/h[2]}clone(){return new sr([...this.position],[...this.orientation])}}function iu(c,n){const a=_a(c.projection,c.zoom,c.width,c.height),h=function(_,b,T,S,I){const k=new s.LngLat(T.lng-180*Ar,T.lat),R=new s.LngLat(T.lng+180*Ar,T.lat),U=_.project(k.lng,k.lat),W=_.project(R.lng,R.lat),j=-Math.atan2(W.y-U.y,W.x-U.x),$=s.MercatorCoordinate.fromLngLat(T);$.y=s.clamp($.y,-.999975,.999975);const q=$.toLngLat(),N=_.project(q.lng,q.lat),J=s.MercatorCoordinate.fromLngLat(q);J.x+=Ar;const X=J.toLngLat(),ue=_.project(X.lng,X.lat),le=ga(ue.x-N.x,ue.y-N.y,j),re=s.MercatorCoordinate.fromLngLat(q);re.y+=Ar;const ce=re.toLngLat(),ae=_.project(ce.lng,ce.lat),me=ga(ae.x-N.x,ae.y-N.y,j),Ce=Math.abs(le.x)/Math.abs(me.y),rt=s.identity([]);s.rotateZ(rt,rt,-j*(1-(I?0:S)));const xe=s.identity([]);return s.scale(xe,xe,[1,1-(1-Ce)*S,1]),xe[4]=-me.x/me.y*S,s.rotateZ(xe,xe,j),s.multiply(xe,rt,xe),xe}(c.projection,0,c.center,a,n),m=nu(c);return s.scale(h,h,[m,m,1]),h}function nu(c){const n=c.projection,a=_a(c.projection,c.zoom,c.width,c.height),h=ru(n,c.center),m=ru(n,s.LngLat.convert(n.center));return Math.pow(2,h*a+(1-a)*m)}function _a(c,n,a,h,m=1/0){const _=c.range;if(!_)return 0;const b=Math.min(m,Math.max(a,h)),T=Math.log(b/1024)/Math.LN2;return s.smoothstep(_[0]+T,_[1]+T,n)}const Ar=1/4e4;function ru(c,n){const a=s.clamp(n.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),h=new s.LngLat(n.lng-180*Ar,a),m=new s.LngLat(n.lng+180*Ar,a),_=c.project(h.lng,a),b=c.project(m.lng,a),T=s.MercatorCoordinate.fromLngLat(h),S=s.MercatorCoordinate.fromLngLat(m),I=b.x-_.x,k=b.y-_.y,R=S.x-T.x,U=S.y-T.y,W=Math.sqrt((R*R+U*U)/(I*I+k*k));return Math.log(W)/Math.LN2}function ga(c,n,a){const h=Math.cos(a),m=Math.sin(a);return{x:c*h-n*m,y:c*m+n*h}}class ya{constructor(n,a,h,m,_,b,T){this.tileSize=512,this._renderWorldCopies=_===void 0||_,this._minZoom=n||0,this._maxZoom=a||22,this._minPitch=h==null?0:h,this._maxPitch=m==null?60:m,this.setProjection(b),this.setMaxBounds(T),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ma,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new sr,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const n=new ya(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(n){const a=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||a)&&this._updateCameraOnTerrain(),(n||a)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return s.pick(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const a=this.projection?this.getProjection():void 0;this.projection=s.getProjection(this.projectionOptions);const h=!B(a,this.getProjection());return h&&this._calcMatrices(),this.mercatorFromTransition=!1,h}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.getProjection({name:"mercator"});const a=n!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.pointGeometry(this.width,this.height)}get bearing(){return s.wrap(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const a=-n*Math.PI/180;var h;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=(h=new s.ARRAY_TYPE(4),s.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h),function(m,_,b){var T=_[0],S=_[1],I=_[2],k=_[3],R=Math.sin(b),U=Math.cos(b);m[0]=T*U+I*R,m[1]=S*U+k*R,m[2]=T*-R+I*U,m[3]=S*-R+k*U}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const a=s.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=n/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const a=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const n=this._elevation;this._centerAltitude=n.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=n.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],h=this.horizonLineFromTop();let m=0,_=0;for(let b=0;b<a.length;b++){const T=new s.pointGeometry(a[b][0]*this.width,h+a[b][1]*(this.height-h)),S=n.pointCoordinate(T);if(!S)continue;const I=1/Math.hypot(S[0]-this._camera.position[0],S[1]-this._camera.position[1]);m+=S[3]*I,_+=I}return _===0?NaN:m/_}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),h=this.pixelsPerMeter/this.worldSize*a,m=this._mercatorZfromZoom(n),_=this._mercatorZfromZoom(this._maxZoom),b=Math.max(m-h,_);this._setZoom(this._zoomFromMercatorZ(b))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let h;h=n.z<this._camera.position[2]?[a.x,a.y,a.z]:[n.x,n.y,n.z];const m=s.length(s.sub([],this._camera.position,h));return s.clamp(this._zoomFromMercatorZ(m),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let a=!1;if(n.orientation&&!s.exactEquals(n.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(n.orientation)),n.position){const h=[n.position.x,n.position.y,n.position.z];s.exactEquals$1(h,this._camera.position)||(this._setCameraPosition(h),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,a=new Et;return a.position=new s.MercatorCoordinate(n[0],n[1],n[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(n){if(!s.length$1(n))return!1;s.normalize$1(n,n);const a=s.transformQuat([],[0,0,-1],n),h=s.transformQuat([],[0,-1,0],n);if(h[2]<0)return!1;const m=Ts(a,h);return!!m&&(this._camera.orientation=m,!0)}_setCameraPosition(n){const a=this.zoomScale(this.minZoom)*this.tileSize,h=this.zoomScale(this.maxZoom)*this.tileSize,m=this.cameraToCenterDistance;n[2]=s.clamp(n[2],m/h,m/a),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,a,h){this._unmodified=!1,this._edgeInsets.interpolate(n,a,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const a=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(n){const a=[new s.UnwrappedTileID(0,n)];if(this.renderWorldCopies){const h=this.pointCoordinate(new s.pointGeometry(0,0)),m=this.pointCoordinate(new s.pointGeometry(this.width,0)),_=this.pointCoordinate(new s.pointGeometry(this.width,this.height)),b=this.pointCoordinate(new s.pointGeometry(0,this.height)),T=Math.floor(Math.min(h.x,m.x,_.x,b.x)),S=Math.floor(Math.max(h.x,m.x,_.x,b.x)),I=1;for(let k=T-I;k<=S+I;k++)k!==0&&a.push(new s.UnwrappedTileID(k,n))}return a}coveringTiles(n){let a=this.coveringZoomLevel(n);const h=a,m=this.elevation&&!n.isTerrainDEM,_=this.projection.name==="mercator";if(n.minzoom!==void 0&&a<n.minzoom)return[];n.maxzoom!==void 0&&a>n.maxzoom&&(a=n.maxzoom);const b=this.locationCoordinate(this.center),T=this.center.lat,S=1<<a,I=[S*b.x,S*b.y,0],k=this.projection.name==="globe",R=!k,U=s.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,R),W=k?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),j=S*s.mercatorZfromAltitude(1,this.center.lat),$=this._camera.position[2]/s.mercatorZfromAltitude(1,this.center.lat),q=[S*W.x,S*W.y,$*(R?1:j)],N=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),J=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?a:0,X=n.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ue=n.isTerrainDEM?-X:this._elevation?this._elevation.getMinElevationBelowMSL():0,le=this.projection.isReprojectedInTileSpace?nu(this):1,re=Le=>{const qe=new s.MercatorCoordinate(Le.x+25e-6,Le.y,Le.z),vt=new s.MercatorCoordinate(Le.x,Le.y+25e-6,Le.z),_t=Le.toLngLat(),It=qe.toLngLat(),Lt=vt.toLngLat(),qt=this.locationCoordinate(_t),li=this.locationCoordinate(It),zt=this.locationCoordinate(Lt),Xt=Math.hypot(li.x-qt.x,li.y-qt.y),pi=Math.hypot(zt.x-qt.x,zt.y-qt.y);return Math.sqrt(Xt*pi)*le/25e-6},ce=Le=>{const lt=X,qe=ue;return{aabb:s.tileAABB(this,S,0,0,0,Le,qe,lt,this.projection),zoom:0,x:0,y:0,minZ:qe,maxZ:lt,wrap:Le,fullyVisible:!1}},ae=[];let me=[];const Ce=a,rt=n.reparseOverscaled?h:a,xe=Le=>Le*Le,Ve=xe(($-this._centerAltitude)*j),Ge=Le=>{if(!this._elevation||!Le.tileID||!_)return;const lt=this._elevation.getMinMaxForTile(Le.tileID),qe=Le.aabb;lt?(qe.min[2]=lt.min,qe.max[2]=lt.max,qe.center[2]=(qe.min[2]+qe.max[2])/2):(Le.shouldSplit=pt(Le),Le.shouldSplit||(qe.min[2]=qe.max[2]=qe.center[2]=this._centerAltitude))},pt=Le=>{if(Le.zoom<J)return!0;if(Le.zoom===Ce)return!1;if(Le.shouldSplit!=null)return Le.shouldSplit;const lt=Le.aabb.distanceX(q),qe=Le.aabb.distanceY(q);let vt=Ve,_t=1;if(k){vt=xe(Le.aabb.distanceZ(q));const Lt=Math.pow(2,Le.zoom),qt=s.latFromMercatorY((Le.y+1)/Lt),li=s.latFromMercatorY(Le.y/Lt),zt=Math.min(Math.max(T,qt),li),Xt=s.circumferenceAtLatitude(zt)/s.circumferenceAtLatitude(T);if(_t=zt===T?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Xt/this._mercatorScaleRatio),this.zoom<=s.GLOBE_ZOOM_THRESHOLD_MIN&&Le.zoom===Ce-1&&Xt>=.9)return!0}else if(m&&(vt=xe(Le.aabb.distanceZ(q)*j)),this.projection.isReprojectedInTileSpace&&h<=5){const Lt=Math.pow(2,Le.zoom),qt=re(new s.MercatorCoordinate((Le.x+.5)/Lt,(Le.y+.5)/Lt));_t=qt>.85?1:qt}const It=lt*lt+qe*qe+vt;return It<xe((1<<Ce-Le.zoom)*N*_t*((Lt,qt)=>{if(qt*xe(.707)<Lt)return 1;const li=Math.sqrt(qt/Lt);return li/(1.4144271570014144+(Math.pow(1.1,li-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(vt,Ve),It))};if(this.renderWorldCopies)for(let Le=1;Le<=3;Le++)ae.push(ce(-Le)),ae.push(ce(Le));for(ae.push(ce(0));ae.length>0;){const Le=ae.pop(),lt=Le.x,qe=Le.y;let vt=Le.fullyVisible;if(!vt){const _t=Le.aabb.intersects(U);if(_t===0)continue;vt=_t===2}if(Le.zoom!==Ce&&pt(Le))for(let _t=0;_t<4;_t++){const It=(lt<<1)+_t%2,Lt=(qe<<1)+(_t>>1),qt={aabb:_?Le.aabb.quadrant(_t):s.tileAABB(this,S,Le.zoom+1,It,Lt,Le.wrap,Le.minZ,Le.maxZ,this.projection),zoom:Le.zoom+1,x:It,y:Lt,wrap:Le.wrap,fullyVisible:vt,tileID:void 0,shouldSplit:void 0,minZ:Le.minZ,maxZ:Le.maxZ};m&&!k&&(qt.tileID=new s.OverscaledTileID(Le.zoom+1===Ce?rt:Le.zoom+1,Le.wrap,Le.zoom+1,It,Lt),Ge(qt)),ae.push(qt)}else{const _t=Le.zoom===Ce?rt:Le.zoom;if(n.minzoom&&n.minzoom>_t)continue;const It=I[0]-(.5+lt+(Le.wrap<<Le.zoom))*(1<<a-Le.zoom),Lt=I[1]-.5-qe,qt=Le.tileID?Le.tileID:new s.OverscaledTileID(_t,Le.wrap,Le.zoom,lt,qe);me.push({tileID:qt,distanceSq:It*It+Lt*Lt})}}if(this.fogCullDistSq){const Le=this.fogCullDistSq,lt=this.horizonLineFromTop();me=me.filter(qe=>{const vt=[0,0,0,1],_t=[s.EXTENT,s.EXTENT,0,1],It=this.calculateFogTileMatrix(qe.tileID.toUnwrapped());s.transformMat4$1(vt,vt,It),s.transformMat4$1(_t,_t,It);const Lt=s.getAABBPointSquareDist(vt,_t);if(Lt===0)return!0;let qt=!1;const li=this._elevation;if(li&&Lt>Le&&lt!==0){const zt=this.calculateProjMatrix(qe.tileID.toUnwrapped());let Xt;n.isTerrainDEM||(Xt=li.getMinMaxForTile(qe.tileID)),Xt||(Xt={min:ue,max:X});const pi=s.furthestTileCorner(this.rotation),Vi=[pi[0]*s.EXTENT,pi[1]*s.EXTENT,Xt.max];s.transformMat4(Vi,Vi,zt),qt=(1-Vi[1])*this.height*.5<lt}return Lt<Le||qt})}return me.sort((Le,lt)=>Le.distanceSq-lt.distanceSq).map(Le=>Le.tileID)}resize(n,a){this.width=n,this.height=a,this.pixelsToGLUnits=[2/n,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const a=s.clamp(n.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),h=this.projection.project(n.lng,a);return new s.pointGeometry(h.x*this.worldSize,h.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(n,a){let h,m;const _=this.centerPoint;if(this.projection.name==="globe"){const T=this.worldSize;h=(a.x-_.x)/T,m=(a.y-_.y)/T}else{const T=this.pointCoordinate(a),S=this.pointCoordinate(_);h=T.x-S.x,m=T.y-S.y}const b=this.locationCoordinate(n);this.setLocation(new s.MercatorCoordinate(b.x-h,b.y-m))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,a){const h=a?s.mercatorZfromAltitude(a,n.lat):void 0,m=this.projection.project(n.lng,n.lat);return new s.MercatorCoordinate(m.x,m.y,h)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,a){const h=a!=null?a:this._centerAltitude,m=[n.x,n.y,0,1],_=[n.x,n.y,1,1];s.transformMat4$1(m,m,this.pixelMatrixInverse),s.transformMat4$1(_,_,this.pixelMatrixInverse);const b=_[3];s.scale$1(m,m,1/m[3]),s.scale$1(_,_,1/b);const T=m[2],S=_[2];return{p0:m,p1:_,t:T===S?0:(h-T)/(S-T)}}screenPointToMercatorRay(n){const a=[n.x,n.y,0,1],h=[n.x,n.y,1,1];return s.transformMat4$1(a,a,this.pixelMatrixInverse),s.transformMat4$1(h,h,this.pixelMatrixInverse),s.scale$1(a,a,1/a[3]),s.scale$1(h,h,1/h[3]),a[2]=s.mercatorZfromAltitude(a[2],this._center.lat)*this.worldSize,h[2]=s.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,s.scale$1(a,a,1/this.worldSize),s.scale$1(h,h,1/this.worldSize),new s.Ray([a[0],a[1],a[2]],s.normalize([],s.sub([],h,a)))}rayIntersectionCoordinate(n){const{p0:a,p1:h,t:m}=n,_=s.mercatorZfromAltitude(a[2],this._center.lat),b=s.mercatorZfromAltitude(h[2],this._center.lat);return new s.MercatorCoordinate(s.number(a[0],h[0],m)/this.worldSize,s.number(a[1],h[1],m)/this.worldSize,s.number(_,b,m))}pointCoordinate(n,a=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,a)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let a=this.projection.pointCoordinate3D(this,n.x,n.y);if(a)return new s.MercatorCoordinate(a[0],a[1],a[2]);let h=0,m=this.horizonLineFromTop();if(n.y>m)return this.pointCoordinate(n);const _=.02*m,b=n.clone();for(let T=0;T<10&&m-h>_;T++){b.y=s.number(h,m,.66);const S=this.projection.pointCoordinate3D(this,b.x,b.y);S?(m=b.y,a=S):h=b.y}return a?new s.MercatorCoordinate(a[0],a[1],a[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}_coordinatePoint(n,a){const h=a&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,m=[n.x*this.worldSize,n.y*this.worldSize,h+n.toAltitude(),1];return s.transformMat4$1(m,m,this.pixelMatrix),m[3]>0?new s.pointGeometry(m[0]/m[3],m[1]/m[3]):new s.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(n,a){const h=new s.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),m=new s.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),_=new s.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),b=new s.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let T=this.pointCoordinate(h,n),S=this.pointCoordinate(m,n);const I=this.pointCoordinate(_,a),k=this.pointCoordinate(b,a),R=(U,W)=>(W.y-U.y)/(W.x-U.x);return T.y>1&&S.y>=0?T=new s.MercatorCoordinate((1-k.y)/R(k,T)+k.x,1):T.y<0&&S.y<=1&&(T=new s.MercatorCoordinate(-k.y/R(k,T)+k.x,0)),S.y>1&&T.y>=0?S=new s.MercatorCoordinate((1-I.y)/R(I,S)+I.x,1):S.y<0&&T.y<=1&&(S=new s.MercatorCoordinate(-I.y/R(I,S)+I.x,0)),new s.LngLatBounds().extend(this.coordinateLocation(T)).extend(this.coordinateLocation(S)).extend(this.coordinateLocation(k)).extend(this.coordinateLocation(I))}_getBounds3D(){const n=this.elevation;if(!n.visibleDemTiles.length)return this._getBounds(0,0);const a=n.visibleDemTiles.reduce((h,m)=>{if(m.dem){const _=m.dem.tree;h.min=Math.min(h.min,_.minimums[0]),h.max=Math.max(h.max,_.maximums[0])}return h},{min:Number.MAX_VALUE,max:0});return this._getBounds(a.min*n.exaggeration(),a.max*n.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(n=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,h=this.height/2-a*(1-this._horizonShift);return n?Math.max(0,h):h}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-s.MAX_MERCATOR_LATITUDE,this.maxLat=s.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=s.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=s.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=s.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,a){return this.projection.createTileMatrix(this,a,n)}calculateDistanceTileData(n){const a=n.key,h=this._distanceTileDataCache;if(h[a])return h[a];const m=n.canonical,_=1/this.height,b=this.cameraWorldSize/this.zoomScale(m.z),T=(m.x+Math.pow(2,m.z)*n.wrap)*b,S=m.y*b,I=this.point,k=this.angle,R=Math.sin(-k),U=-Math.cos(-k);return h[a]={bearing:[R,U],center:[(I.x-T)*_,(I.y-S)*_],scale:b/s.EXTENT*_},h[a]}calculateFogTileMatrix(n){const a=n.key,h=this._fogTileMatrixCache;if(h[a])return h[a];const m=this.projection.createTileMatrix(this,this.cameraWorldSize,n);return s.multiply(m,this.worldToFogMatrix,m),h[a]=new Float32Array(m),h[a]}calculateProjMatrix(n,a=!1){const h=n.key,m=a?this._alignedProjMatrixCache:this._projMatrixCache;if(m[h])return m[h];const _=this.calculatePosMatrix(n,this.worldSize);return s.multiply(_,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:a?this.alignedProjMatrix:this.projMatrix,_),m[h]=new Float32Array(_),m[h]}calculatePixelsToTileUnitsMatrix(n){const a=n.tileID.key,h=this._pixelsToTileUnitsCache;if(h[a])return h[a];const m=function(_,b){const{scale:T}=_.tileTransform,S=T*s.EXTENT/(_.tileSize*Math.pow(2,b.zoom-_.tileID.overscaledZ+_.tileID.canonical.z));return I=new Float32Array(4),U=(k=b.inverseAdjustmentMatrix)[1],W=k[2],j=k[3],q=(R=[S,S])[1],I[0]=k[0]*($=R[0]),I[1]=U*$,I[2]=W*q,I[3]=j*q,I;var I,k,R,U,W,j,$,q}(n,this);return h[a]=m,h[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const a=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,h=this._computeCameraPosition(a),m=this._camera.forward(),_=s.mercatorZfromAltitude(1,this._center.lat);h[2]/=_,m[2]/=_,s.normalize(m,m);const b=n.raycast(h,m,n.exaggeration());if(b){const T=s.scaleAndAdd([],h,m,b),S=new s.MercatorCoordinate(T[0],T[1],s.mercatorZfromAltitude(T[2],s.latFromMercatorY(T[1]))),I=(S.z+s.length([S.x-h[0],S.y-h[1],S.z-h[2]*_]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(I),this._centerAltitude=S.toAltitude(),this._center=this.coordinateLocation(S),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const n=this._elevation;this._updateCameraState();const a=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,h=this._computeCameraPosition(a),m=n.getAtPointOrZero(new s.MercatorCoordinate(...h)),_=this._minimumHeightOverTerrain()*Math.cos(s.degToRad(this._maxPitch)),b=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*m;if(b<_){const T=this.locationCoordinate(this._center,this._centerAltitude),S=[T.x-h[0],T.y-h[1],T.z-h[2]],I=s.length(S);S[2]-=(_-b)/this._pixelsPerMercatorPixel;const k=s.length(S);if(k===0)return;s.scale$2(S,S,I/k*this._pixelsPerMercatorPixel),this._camera.position=[T.x-S[0],T.y-S[1],T.z*this._pixelsPerMercatorPixel-S[2]],this._camera.orientation=Ts(S,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const U=this.center;return U.lat=s.clamp(U.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(U.lng=s.clamp(U.lng,this.minLng,this.maxLng)),this.center=U,void(this._constraining=!1)}const a=this._unmodified,{x:h,y:m}=this.point;let _=0,b=h,T=m;const S=this.width/2,I=this.height/2,k=this.worldMinY*this.scale,R=this.worldMaxY*this.scale;if(m-I<k&&(T=k+I),m+I>R&&(T=R-I),R-k<this.height&&(_=Math.max(_,this.height/(R-k)),T=(R+k)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const U=this.worldMinX*this.scale,W=this.worldMaxX*this.scale,j=this.worldSize/2-(U+W)/2;b=(h+j+this.worldSize)%this.worldSize-j,b-S<U&&(b=U+S),b+S>W&&(b=W-S),W-U<this.width&&(_=Math.max(_,this.width/(W-U)),b=(W+U)/2)}b===h&&T===m||(this.center=this.unproject(new s.pointGeometry(b,T))),_&&(this.zoom+=this.scaleZoom(_)),this._constrainCameraAltitude(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,a=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.mercatorZfromAltitude(1,this.center.lat)/s.mercatorZfromAltitude(1,s.GLOBE_SCALE_MATCH_LATITUDE));const h=_a(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,h),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const m=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?a:1),_=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);_[8]=2*-n.x/this.width,_[9]=2*n.y/this.height;let b=s.mul([],_,m);if(this.projection.isReprojectedInTileSpace){const le=this.locationCoordinate(this.center),re=s.identity([]);s.translate(re,re,[le.x*this.worldSize,le.y*this.worldSize,0]),s.multiply(re,re,iu(this)),s.translate(re,re,[-le.x*this.worldSize,-le.y*this.worldSize,0]),s.multiply(b,b,re),this.inverseAdjustmentMatrix=function(ce){const ae=iu(ce,!0);return Qe([],[ae[0],ae[1],ae[4],ae[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=s.scale([],b,[this.worldSize,this.worldSize,this.worldSize/a,1]),this.projMatrix=b,this.invProjMatrix=s.invert(new Float64Array(16),this.projMatrix);const T=s.invert([],_);this.frustumCorners=s.FrustumCorners.fromInvProjectionMatrix(T,this.horizonLineFromTop(),this.height);const S=new Float32Array(16);s.identity(S),s.scale(S,S,[1,-1,1]),s.rotateX(S,S,this._pitch),s.rotateZ(S,S,this.angle);const I=s.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),k=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;I[8]=2*-n.x/this.width,I[9]=2*(n.y+k)/this.height,this.skyboxMatrix=s.multiply(S,I,S);const R=this.point,U=R.x,W=R.y,j=this.width%2/2,$=this.height%2/2,q=Math.cos(this.angle),N=Math.sin(this.angle),J=U-Math.round(U)+q*j+N*$,X=W-Math.round(W)+q*$+N*j,ue=new Float64Array(b);if(s.translate(ue,ue,[J>.5?J-1:J,X>.5?X-1:X,0]),this.alignedProjMatrix=ue,b=s.create(),s.scale(b,b,[this.width/2,-this.height/2,1]),s.translate(b,b,[1,-1,0]),this.labelPlaneMatrix=b,b=s.create(),s.scale(b,b,[1,-1,1]),s.translate(b,b,[-1,-1,0]),s.scale(b,b,[2/this.width,2/this.height,1]),this.glCoordMatrix=b,this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},b=s.invert(new Float64Array(16),this.pixelMatrix),!b)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=b,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.calculateGlobeMatrix(this);const le=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.transformMat4(le,le,m),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=b;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSize,a=this.cameraPixelsPerMeter,h=this._camera.position,m=1/this.height/this._pixelsPerMercatorPixel,_=[n,n,a];s.scale$2(_,_,m),s.scale$2(h,h,-1),s.multiply$2(h,h,_);const b=s.create();s.translate(b,b,h),s.scale(b,b,_),this.mercatorFogMatrix=b,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,a,m)}_computeCameraPosition(n){const a=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,h=this._camera.forward(),m=this.point,_=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-n/this.worldSize*this._centerAltitude;return[m.x/this.worldSize-h[0]*_,m.y/this.worldSize-h[1]*_,n/this.worldSize*this._centerAltitude-h[2]*_]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),h=n[2];let m=1;h>0&&(m=Math.min((a-this._camera.position[2])/h,1)),this._camera.position=s.scaleAndAdd([],this._camera.position,n,m),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const n=this._camera.position,a=this._camera.forward(),{pitch:h,bearing:m}=this._camera.getPitchBearing(),_=s.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,b=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.degToRad(this._maxPitch)),T=Math.max((n[2]-_)/Math.cos(h),b),S=this._zoomFromMercatorZ(T);s.scaleAndAdd(n,n,a,T),this._pitch=s.clamp(h,s.degToRad(this.minPitch),s.degToRad(this.maxPitch)),this.angle=s.wrap(m,-Math.PI,Math.PI),this._setZoom(s.clamp(S,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.MercatorCoordinate(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,a){const h=Math.min(n.x,a.x),m=Math.max(n.x,a.x),_=Math.min(n.y,a.y),b=Math.max(n.y,a.y);if(_<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const T=[new s.pointGeometry(h,_),new s.pointGeometry(m,b),new s.pointGeometry(h,b),new s.pointGeometry(m,_)],S=this.renderWorldCopies?-3:0,I=this.renderWorldCopies?4:1;for(const k of T){const R=this.pointRayIntersection(k);if(R.t<0)return!0;const U=this.rayIntersectionCoordinate(R);if(U.x<S||U.y<0||U.x>I||U.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.pointGeometry(0,0),new s.pointGeometry(this.width,this.height))}zoomDeltaToMovement(n,a){const h=s.length(s.sub([],this._camera.position,n)),m=this._zoomFromMercatorZ(h)+a;return h-this._mercatorZfromZoom(m)}getCameraPoint(){if(this.projection.name==="globe"){const n=function(a,h){const m=[a[0],a[1],a[2],1];s.transformMat4$1(m,m,h);const _=Math.max(m[3],1e-6);return[m[0]/_,m[1]/_,m[2]/_,_]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.pointGeometry(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.pointGeometry(0,n))}}getCameraToCenterDistance(n){const a=_a(n,this.zoom,this.width,this.height,1024),h=n.pixelSpaceConversion(this.center.lat,this.worldSize,a);return .5/Math.tan(.5*this._fov)*this.height*h}}function xa(c,n){let a=!1,h=null;const m=()=>{h=null,a&&(c(),h=setTimeout(m,n),a=!1)};return()=>(a=!0,h||m(),h)}class Rh{constructor(n){this._hashName=n&&encodeURIComponent(n),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=xa(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,s.window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),s.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const a=ou(n);if(this._hashName){const h=this._hashName;let m=!1;const _=s.window.location.hash.slice(1).split("&").map(b=>{const T=b.split("=")[0];return T===h?(m=!0,`${T}=${a}`):b}).filter(b=>b);return m||_.push(`${h}=${a}`),`#${_.join("&")}`}return`#${a}`}_getCurrentHash(){const n=s.window.location.hash.replace("#","");if(this._hashName){let a;return n.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(a=h)}),(a&&a[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const a=this._getCurrentHash();if(a.length>=3&&!a.some(h=>isNaN(h))){const h=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(a[3]||0):n.getBearing();return n.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:h,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){const n=s.window.location.href.replace(/(#.+)?$/,this.getHashString());s.window.history.replaceState(s.window.history.state,null,n)}}function ou(c,n){const a=c.getCenter(),h=Math.round(100*c.getZoom())/100,m=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,m),b=Math.round(a.lng*_)/_,T=Math.round(a.lat*_)/_,S=c.getBearing(),I=c.getPitch();let k=n?`/${b}/${T}/${h}`:`${h}/${T}/${b}`;return(S||I)&&(k+="/"+Math.round(10*S)/10),I&&(k+=`/${Math.round(I)}`),k}const Gr={linearity:.3,easing:s.bezier(0,0,.3,1)},Jf=s.extend({deceleration:2500,maxSpeed:1400},Gr),Qf=s.extend({deceleration:20,maxSpeed:1400},Gr),Bh=s.extend({deceleration:1e3,maxSpeed:360},Gr),El=s.extend({deceleration:1e3,maxSpeed:90},Gr);class su{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.exported.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,a=s.exported.now();for(;n.length>0&&a-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,pan:new s.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)a.zoom+=_.zoomDelta||0,a.bearing+=_.bearingDelta||0,a.pitch+=_.pitchDelta||0,_.panDelta&&a.pan._add(_.panDelta),_.around&&(a.around=_.around),_.pinchAround&&(a.pinchAround=_.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(a.pan.mag()){const _=ba(a.pan.mag(),h,s.extend({},Jf,n||{}));m.offset=a.pan.mult(_.amount/a.pan.mag()),m.center=this._map.transform.center,va(m,_)}if(a.zoom){const _=ba(a.zoom,h,Qf);m.zoom=this._map.transform.zoom+_.amount,va(m,_)}if(a.bearing){const _=ba(a.bearing,h,Bh);m.bearing=this._map.transform.bearing+s.clamp(_.amount,-179,179),va(m,_)}if(a.pitch){const _=ba(a.pitch,h,El);m.pitch=this._map.transform.pitch+_.amount,va(m,_)}if(m.zoom||m.bearing){const _=a.pinchAround===void 0?a.around:a.pinchAround;m.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),m.noMoveStart=!0,m}}function va(c,n){(!c.duration||c.duration<n.duration)&&(c.duration=n.duration,c.easing=n.easing)}function ba(c,n,a){const{maxSpeed:h,linearity:m,deceleration:_}=a,b=s.clamp(c*m/(n/1e3),-h,h),T=Math.abs(b)/(_*m);return{easing:a.easing,duration:1e3*T,amount:b*(T/2)}}class En extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,h,m={}){const _=Ie(a.getCanvasContainer(),h),b=a.unproject(_);super(n,s.extend({point:_,lngLat:b,originalEvent:h},m)),this._defaultPrevented=!1,this.target=a}}class Es extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,h){const m=n==="touchend"?h.changedTouches:h.touches,_=Pe(a.getCanvasContainer(),m),b=_.map(S=>a.unproject(S)),T=_.reduce((S,I,k,R)=>S.add(I.div(R.length)),new s.pointGeometry(0,0));super(n,{points:_,point:T,lngLats:b,lngLat:a.unproject(T),originalEvent:h}),this._defaultPrevented=!1}}class Fh extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,h){super(n,{originalEvent:h}),this._defaultPrevented=!1}}class Oh{constructor(n,a){this._map=n,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new Fh(n.type,this._map,n))}mousedown(n,a){return this._mousedownPos=a,this._firePreventable(new En(n.type,this._map,n))}mouseup(n){this._map.fire(new En(n.type,this._map,n))}preclick(n){const a=s.extend({},n);a.type="preclick",this._map.fire(new En(a.type,this._map,a))}click(n,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(n),this._map.fire(new En(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new En(n.type,this._map,n))}mouseover(n){this._map.fire(new En(n.type,this._map,n))}mouseout(n){this._map.fire(new En(n.type,this._map,n))}touchstart(n){return this._firePreventable(new Es(n.type,this._map,n))}touchmove(n){this._map.fire(new Es(n.type,this._map,n))}touchend(n){this._map.fire(new Es(n.type,this._map,n))}touchcancel(n){this._map.fire(new Es(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Uh{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new En(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new En("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new En(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Vh{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,a){this.isEnabled()&&n.shiftKey&&n.button===0&&(ot(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(n,a){if(!this._active)return;const h=a;if(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=h,this._box||(this._box=te("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const _=Math.min(m.x,h.x),b=Math.max(m.x,h.x),T=Math.min(m.y,h.y),S=Math.max(m.y,h.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${_}px,${T}px)`,this._box.style.width=b-_+"px",this._box.style.height=S-T+"px")})}mouseupWindow(n,a){if(!this._active||n.button!==0)return;const h=this._startPos,m=a;if(this.reset(),ct(),h.x!==m.x||h.y!==m.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:_=>_.fitScreenCoordinates(h,m,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Se(),delete this._startPos,delete this._lastPos}_fireEvent(n,a){return this._map.fire(new s.Event(n,{originalEvent:a}))}}function Sl(c,n){const a={};for(let h=0;h<c.length;h++)a[c[h].identifier]=n[h];return a}class Ss{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,a,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),h.length===this.numTouches&&(this.centroid=function(m){const _=new s.pointGeometry(0,0);for(const b of m)_._add(b);return _.div(m.length)}(a),this.touches=Sl(h,a)))}touchmove(n,a,h){if(this.aborted||!this.centroid)return;const m=Sl(h,a);for(const _ in this.touches){const b=this.touches[_],T=m[_];(!T||T.dist(b)>30)&&(this.aborted=!0)}}touchend(n,a,h){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Cl{constructor(n){this.singleTap=new Ss(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,a,h){this.singleTap.touchstart(n,a,h)}touchmove(n,a,h){this.singleTap.touchmove(n,a,h)}touchend(n,a,h){const m=this.singleTap.touchend(n,a,h);if(m){const _=n.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(m)<30;if(_&&b||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class Nh{constructor(){this._zoomIn=new Cl({numTouches:1,numTaps:2}),this._zoomOut=new Cl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,a,h){this._zoomIn.touchstart(n,a,h),this._zoomOut.touchstart(n,a,h)}touchmove(n,a,h){this._zoomIn.touchmove(n,a,h),this._zoomOut.touchmove(n,a,h)}touchend(n,a,h){const m=this._zoomIn.touchend(n,a,h),_=this._zoomOut.touchend(n,a,h);return m?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(m)},{originalEvent:n})}):_?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(_)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const jh={0:1,2:2};class Al{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,a){return!1}_move(n,a){return{}}mousedown(n,a){if(this._lastPoint)return;const h=be(n);this._correctButton(n,h)&&(this._lastPoint=a,this._eventButton=h)}mousemoveWindow(n,a){const h=this._lastPoint;if(h){if(n.preventDefault(),this._eventButton!=null&&function(m,_){const b=jh[_];return m.buttons===void 0||(m.buttons&b)!==b}(n,this._eventButton))this.reset();else if(this._moved||!(a.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(h,a)}}mouseupWindow(n){this._lastPoint&&be(n)===this._eventButton&&(this._moved&&ct(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $h extends Al{mousedown(n,a){super.mousedown(n,a),this._lastPoint&&(this._active=!0)}_correctButton(n,a){return a===0&&!n.ctrlKey}_move(n,a){return{around:a,panDelta:a.sub(n)}}}class au extends Al{_correctButton(n,a){return a===0&&n.ctrlKey||a===2}_move(n,a){const h=.8*(a.x-n.x);if(h)return this._active=!0,{bearingDelta:h}}contextmenu(n){n.preventDefault()}}class mn extends Al{_correctButton(n,a){return a===0&&n.ctrlKey||a===2}_move(n,a){const h=-.5*(a.y-n.y);if(h)return this._active=!0,{pitchDelta:h}}contextmenu(n){n.preventDefault()}}class ep{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),s.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.pointGeometry(0,0)}touchstart(n,a,h){return this._calculateTransform(n,a,h)}touchmove(n,a,h){if(this._active&&!(h.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(h.length===1&&!s.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,a,h)}}touchend(n,a,h){this._calculateTransform(n,a,h),this._active&&h.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,a,h){h.length>0&&(this._active=!0);const m=Sl(h,a),_=new s.pointGeometry(0,0),b=new s.pointGeometry(0,0);let T=0;for(const I in m){const k=m[I],R=this._touches[I];R&&(_._add(k),b._add(k.sub(R)),T++,m[I]=k)}if(this._touches=m,T<this._minTouches||!b.mag())return;const S=b.div(T);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(T),panDelta:S}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=te("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Ml{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,a,h){return{}}touchstart(n,a,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([a[0],a[1]]))}touchmove(n,a,h){const m=this._firstTwoTouches;if(!m)return;n.preventDefault();const[_,b]=m,T=Il(h,a,_),S=Il(h,a,b);if(!T||!S)return;const I=this._aroundCenter?null:T.add(S).div(2);return this._move([T,S],I,n)}touchend(n,a,h){if(!this._firstTwoTouches)return;const[m,_]=this._firstTwoTouches,b=Il(h,a,m),T=Il(h,a,_);b&&T||(this._active&&ct(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Il(c,n,a){for(let h=0;h<c.length;h++)if(c[h].identifier===a)return n[h]}function qh(c,n){return Math.log(c/n)/Math.LN2}class Zr extends Ml{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,a){const h=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(qh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:qh(this._distance,h),pinchAround:a}}}function lu(c,n){return 180*c.angleWith(n)/Math.PI}class Cs extends Ml{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,a){const h=this._vector;if(this._vector=n[0].sub(n[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:lu(this._vector,h),pinchAround:a}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const a=25/(Math.PI*this._minDiameter)*360,h=lu(n,this._startVector);return Math.abs(h)<a}}function pr(c){return Math.abs(c.y)>Math.abs(c.x)}class zl extends Ml{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,pr(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,a,h){const m=this._lastPoints;if(!m)return;const _=n[0].sub(m[0]),b=n[1].sub(m[1]);return this._map._cooperativeGestures&&h.touches.length<3||(this._valid=this.gestureBeginsVertically(_,b,h.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(_.y+b.y)/2*-.5})}gestureBeginsVertically(n,a,h){if(this._valid!==void 0)return this._valid;const m=n.mag()>=2,_=a.mag()>=2;if(!m&&!_)return;if(!m||!_)return this._firstMove==null&&(this._firstMove=h),h-this._firstMove<100&&void 0;const b=n.y>0==a.y>0;return pr(n)&&pr(a)&&b}}const At={panStep:100,bearingStep:15,pitchStep:10};class Gh{constructor(){const n=At;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let a=0,h=0,m=0,_=0,b=0;switch(n.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:n.shiftKey?h=-1:(n.preventDefault(),_=-1);break;case 39:n.shiftKey?h=1:(n.preventDefault(),_=1);break;case 38:n.shiftKey?m=1:(n.preventDefault(),b=-1);break;case 40:n.shiftKey?m=-1:(n.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(h=0,m=0),{cameraAnimation:T=>{const S=T.getZoom();T.easeTo({duration:300,easeId:"keyboardHandler",easing:Zh,zoom:a?Math.round(S)+a*(n.shiftKey?2:1):S,bearing:T.getBearing()+h*this._bearingStep,pitch:T.getPitch()+m*this._pitchStep,offset:[-_*this._panStep,-b*this._panStep],center:T.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Zh(c){return c*(2-c)}const As=4.000244140625;class wa{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._handler=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,s.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||s.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=n.deltaMode===s.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const h=s.exported.now(),m=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,a!==0&&a%As==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(m*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),n.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=n,this._delta-=a,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=Ie(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform,a=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>As?this._wheelZoomRate:this._defaultZoomRate;let I=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&I!==0&&(I=1/I);const k=a(),R=Math.pow(2,k),U=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):R;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(U*I))),this._type==="wheel"&&(this._startZoom=k,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:a(),m=this._startZoom,_=this._easing;let b,T=!1;if(this._type==="wheel"&&m&&_){const S=Math.min((s.exported.now()-this._lastWheelEventTime)/200,1),I=_(S);b=s.number(m,h,I),S<1?this._frameId||(this._frameId=!0):T=!0}else b=h,T=!0;return this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!T,zoomDelta:b-a(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let a=s.ease;if(this._prevEase){const h=this._prevEase,m=(s.exported.now()-h.start)/h.duration,_=h.easing(m+.01)-h.easing(m),b=.27/Math.sqrt(_*_+1e-4)*.01,T=Math.sqrt(.0729-b*b);a=s.bezier(b,T,.25,1)}return this._prevEase={start:s.exported.now(),duration:n,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=te("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(s.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Wh{constructor(n,a){this._clickZoom=n,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Xh{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,a){return n.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:h.getZoom()+(n.shiftKey?-1:1),around:h.unproject(a)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hh{constructor(){this._tap=new Cl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,a,h){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=a[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(n,a,h))}touchmove(n,a,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const m=a[0],_=m.y-this._swipePoint.y;return this._swipePoint=m,n.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(n,a,h)}touchend(n,a,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(n,a,h)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Kh{constructor(n,a,h){this._el=n,this._mousePan=a,this._touchPan=h}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Yh{constructor(n,a,h){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=a,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Jh{constructor(n,a,h,m){this._el=n,this._touchZoom=a,this._touchRotate=h,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ta=c=>c.zoom||c.drag||c.pitch||c.rotate;class kl extends s.Event{}class cu{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,a){const h=s.sub([],a,n);this.radius=s.length(h[2]<0?s.div([],h,this.constants):[h[0],h[1],0])}projectRay(n){s.div(n,n,this.constants),s.normalize(n,n),s.mul$1(n,n,this.constants);const a=s.scale$2([],n,this.radius);if(a[2]>0){const h=s.scale$2([],[0,0,1],s.dot(a,[0,0,1])),m=s.scale$2([],s.normalize([],[a[0],a[1],0]),this.radius),_=s.add([],a,s.scale$2([],s.sub([],s.add([],m,h),a),2));a[0]=_[0],a[1]=_[1]}return a}}function Vo(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class Qh{constructor(n,a){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new su(n),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new cu,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),s.bindAll(["handleEvent","handleWindowEvent"],this);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[s.window.document,"mousemove",{capture:!0}],[s.window.document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[s.window,"blur",void 0]];for(const[m,_,b]of this._listeners)m.addEventListener(_,m===s.window.document?this.handleWindowEvent:this.handleEvent,b)}destroy(){for(const[n,a,h]of this._listeners)n.removeEventListener(a,n===s.window.document?this.handleWindowEvent:this.handleEvent,h)}_addDefaultHandlers(n){const a=this._map,h=a.getCanvasContainer();this._add("mapEvent",new Oh(a,n));const m=a.boxZoom=new Vh(a,n);this._add("boxZoom",m);const _=new Nh,b=new Xh;a.doubleClickZoom=new Wh(b,_),this._add("tapZoom",_),this._add("clickZoom",b);const T=new Hh;this._add("tapDragZoom",T);const S=a.touchPitch=new zl(a);this._add("touchPitch",S);const I=new au(n),k=new mn(n);a.dragRotate=new Yh(n,I,k),this._add("mouseRotate",I,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]);const R=new $h(n),U=new ep(a,n);a.dragPan=new Kh(h,R,U),this._add("mousePan",R),this._add("touchPan",U,["touchZoom","touchRotate"]);const W=new Cs,j=new Zr;a.touchZoomRotate=new Jh(h,j,W,T),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",j,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Uh(a));const $=a.scrollZoom=new wa(a,this);this._add("scrollZoom",$,["mousePan"]);const q=a.keyboard=new Gh;this._add("keyboard",q);for(const N of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[N]&&a[N].enable(n[N])}_add(n,a,h){this._handlers.push({handlerName:n,handler:a,allowed:h}),this._handlersById[n]=a}stop(n){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ta(this._eventsInProgress)||this.isZooming()}_blockedByActive(n,a,h){for(const m in n)if(m!==h&&(!a||a.indexOf(m)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const a=[];for(const h of n)this._el.contains(h.target)&&a.push(h);return a}handleEvent(n,a){this._updatingCamera=!0;const h=n.type==="renderFrame",m=h?void 0:n,_={needsRenderFrame:!1},b={},T={},S=n.touches?this._getMapTouches(n.touches):void 0,I=S?Pe(this._el,S):h?void 0:Ie(this._el,n);for(const{handlerName:U,handler:W,allowed:j}of this._handlers){if(!W.isEnabled())continue;let $;this._blockedByActive(T,j,U)?W.reset():W[a||n.type]&&($=W[a||n.type](n,I,S),this.mergeHandlerResult(_,b,$,U,m),$&&$.needsRenderFrame&&this._triggerRenderFrame()),($||W.isActive())&&(T[U]=W)}const k={};for(const U in this._previousActiveHandlers)T[U]||(k[U]=m);this._previousActiveHandlers=T,(Object.keys(k).length||Vo(_))&&(this._changes.push([_,b,k]),this._triggerRenderFrame()),(Object.keys(T).length||Vo(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:R}=_;R&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],R(this._map))}mergeHandlerResult(n,a,h,m,_){if(!h)return;s.extend(n,h);const b={handlerName:m,originalEvent:h.originalEvent||_};h.zoomDelta!==void 0&&(a.zoom=b),h.panDelta!==void 0&&(a.drag=b),h.pitchDelta!==void 0&&(a.pitch=b),h.bearingDelta!==void 0&&(a.rotate=b)}_applyChanges(){const n={},a={},h={};for(const[m,_,b]of this._changes)m.panDelta&&(n.panDelta=(n.panDelta||new s.pointGeometry(0,0))._add(m.panDelta)),m.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(n.around=m.around),m.aroundCoord!==void 0&&(n.aroundCoord=m.aroundCoord),m.pinchAround!==void 0&&(n.pinchAround=m.pinchAround),m.noInertia&&(n.noInertia=m.noInertia),s.extend(a,_),s.extend(h,b);this._updateMapTransform(n,a,h),this._changes=[]}_updateMapTransform(n,a,h){const m=this._map,_=m.transform,b=J=>[J.x,J.y,J.z];if((J=>{const X=this._eventsInProgress.drag;return X&&!this._handlersById[X.handlerName].isActive()})()&&!Vo(n)){const J=_.zoom;_.cameraElevationReference="sea",_.recenterOnTerrain(),_.cameraElevationReference="ground",J!==_.zoom&&this._map._update(!0)}if(!Vo(n))return void this._fireEvents(a,h,!0);let{panDelta:T,zoomDelta:S,bearingDelta:I,pitchDelta:k,around:R,aroundCoord:U,pinchAround:W}=n;W!==void 0&&(R=W),(J=>a.drag&&!this._eventsInProgress.drag)()&&R&&(this._dragOrigin=b(_.pointCoordinate3D(R)),this._trackingEllipsoid.setup(_._camera.position,this._dragOrigin)),_.cameraElevationReference="sea",m._stop(!0),R=R||m.transform.centerPoint,I&&(_.bearing+=I),k&&(_.pitch+=k),_._updateCameraState();const j=[0,0,0];if(T)if(_.projection.name==="mercator"){const J=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(R).dir),X=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(R.sub(T)).dir);j[0]=X[0]-J[0],j[1]=X[1]-J[1]}else{const J=_.pointCoordinate(R);if(_.projection.name==="globe"){T=T.rotate(-_.angle);const X=_._pixelsPerMercatorPixel/_.worldSize;j[0]=-T.x*s.mercatorScale(s.latFromMercatorY(J.y))*X,j[1]=-T.y*s.mercatorScale(_.center.lat)*X}else{const X=_.pointCoordinate(R.sub(T));J&&X&&(j[0]=X.x-J.x,j[1]=X.y-J.y)}}const $=_.zoom,q=[0,0,0];if(S){const J=b(U||_.pointCoordinate3D(R)),X={dir:s.normalize([],s.sub([],J,_._camera.position))};if(X.dir[2]<0){const ue=_.zoomDeltaToMovement(J,S);s.scale$2(q,X.dir,ue)}}const N=s.add(j,j,q);_._translateCameraConstrained(N),S&&Math.abs(_.zoom-$)>1e-4&&_.recenterOnTerrain(),_.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(a,h,!0)}_fireEvents(n,a,h){const m=Ta(this._eventsInProgress),_=Ta(n),b={};for(const k in n){const{originalEvent:R}=n[k];this._eventsInProgress[k]||(b[`${k}start`]=R),this._eventsInProgress[k]=n[k]}!m&&_&&this._fireEvent("movestart",_.originalEvent);for(const k in b)this._fireEvent(k,b[k]);_&&this._fireEvent("move",_.originalEvent);for(const k in n){const{originalEvent:R}=n[k];this._fireEvent(k,R)}const T={};let S;for(const k in this._eventsInProgress){const{handlerName:R,originalEvent:U}=this._eventsInProgress[k];this._handlersById[R].isActive()||(delete this._eventsInProgress[k],S=a[R]||U,T[`${k}end`]=S)}for(const k in T)this._fireEvent(k,T[k]);const I=Ta(this._eventsInProgress);if(h&&(m||_)&&!I){this._updatingCamera=!0;const k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=U=>U!==0&&-this._bearingSnap<U&&U<this._bearingSnap;k?(R(k.bearing||this._map.getBearing())&&(k.bearing=0),this._map.easeTo(k,{originalEvent:S})):(this._map.fire(new s.Event("moveend",{originalEvent:S})),R(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,a){this._map.fire(new s.Event(n,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new kl("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const uu="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ed extends s.Evented{constructor(n,a){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=a.bearingSnap,s.bindAll(["_renderFrameCallback"],this)}getCenter(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(n,a){return this.jumpTo({center:n},a)}panBy(n,a,h){return n=s.pointGeometry.convert(n).mult(-1),this.panTo(this.transform.center,s.extend({offset:n},a),h)}panTo(n,a,h){return this.easeTo(s.extend({center:n},a),h)}getZoom(){return this.transform.zoom}setZoom(n,a){return this.jumpTo({zoom:n},a),this}zoomTo(n,a,h){return this.easeTo(s.extend({zoom:n},a),h)}zoomIn(n,a){return this.zoomTo(this.getZoom()+1,n,a),this}zoomOut(n,a){return this.zoomTo(this.getZoom()-1,n,a),this}getBearing(){return this.transform.bearing}setBearing(n,a){return this.jumpTo({bearing:n},a),this}getPadding(){return this.transform.padding}setPadding(n,a){return this.jumpTo({padding:n},a),this}rotateTo(n,a,h){return this.easeTo(s.extend({bearing:n},a),h)}resetNorth(n,a){return this.rotateTo(0,s.extend({duration:1e3},n),a),this}resetNorthPitch(n,a){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},n),a),this}snapToNorth(n,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,a):this}getPitch(){return this.transform.pitch}setPitch(n,a){return this.jumpTo({pitch:n},a),this}cameraForBounds(n,a){this.transform.projection.name==="globe"&&s.warnOnce('Globe projection does not support cameraForBounds API, this API may behave unexpectedly."'),n=s.LngLatBounds.convert(n);const h=a&&a.bearing||0;return this._cameraForBoxAndBearing(n.getNorthWest(),n.getSouthEast(),h,a)}_extendCameraOptions(n){const a={top:0,bottom:0,right:0,left:0};if(typeof(n=s.extend({padding:a,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=="number"){const h=n.padding;n.padding={top:h,bottom:h,right:h,left:h}}return n.padding=s.extend(a,n.padding),n}_cameraForBoxAndBearing(n,a,h,m){const _=this._extendCameraOptions(m),b=this.transform,T=b.padding,S=b.project(s.LngLat.convert(n)),I=b.project(s.LngLat.convert(a)),k=new s.pointGeometry(S.x,I.y),R=new s.pointGeometry(I.x,S.y),U=-s.degToRad(h),W=S.rotate(U),j=I.rotate(U),$=k.rotate(U),q=R.rotate(U),N=new s.pointGeometry(Math.max(W.x,j.x,$.x,q.x),Math.max(W.y,j.y,$.y,q.y)),J=new s.pointGeometry(Math.min(W.x,j.x,$.x,q.x),Math.min(W.y,j.y,$.y,q.y)),X=N.sub(J),ue=(b.width-((T.left||0)+(T.right||0)+_.padding.left+_.padding.right))/X.x,le=(b.height-((T.top||0)+(T.bottom||0)+_.padding.top+_.padding.bottom))/X.y;if(le<0||ue<0)return void s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const re=Math.min(b.scaleZoom(b.scale*Math.min(ue,le)),_.maxZoom),ce=typeof _.offset.x=="number"&&typeof _.offset.y=="number"?new s.pointGeometry(_.offset.x,_.offset.y):s.pointGeometry.convert(_.offset),ae=new s.pointGeometry((_.padding.left-_.padding.right)/2,(_.padding.top-_.padding.bottom)/2).rotate(h*Math.PI/180),me=ce.add(ae).mult(b.scale/b.zoomScale(re));return{center:b.unproject(S.add(I).div(2).sub(me)),zoom:re,bearing:h}}_cameraForBox(n,a,h,m,_){const b=this._extendCameraOptions(_);h=h||0,m=m||0,n=s.LngLat.convert(n),a=s.LngLat.convert(a);const T=this.transform.clone();T.padding=b.padding;const S=this.getFreeCameraOptions(),I=new s.LngLat(.5*(n.lng+a.lng),.5*(n.lat+a.lat)),k=.5*(h+m);if(T._camera.position[2]<s.mercatorZfromAltitude(k,I.lat))return void s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");S.lookAtPoint(I),T.setFreeCameraOptions(S);const R=s.MercatorCoordinate.fromLngLat(n),U=s.MercatorCoordinate.fromLngLat(a),W=T.pointRayIntersection(T.centerPoint,k),j=[($=T.rayIntersectionCoordinate(W)).x,$.y,$.z];var $;const q=T.screenPointToMercatorRay(T.centerPoint),N=T.projection.name!=="globe";let J,X=0;do{const ue=Math.floor(T.zoom),le=1<<ue,re=Math.min(le*R.x,le*U.x),ce=Math.min(le*R.y,le*U.y),ae=Math.max(le*R.x,le*U.x),me=Math.max(le*R.y,le*U.y),Ce=new s.Aabb([re,ce,h],[ae,me,m]),rt=s.Frustum.fromInvProjectionMatrix(T.invProjMatrix,T.worldSize,ue,N);if(Ce.intersects(rt)!==2){J&&(T._camera.position=s.scaleAndAdd([],T._camera.position,q.dir,-J),T._updateStateFromCamera());break}const xe=s.sub([],T._camera.position,j);J=.5*s.length(xe),T._camera.position=s.scaleAndAdd([],T._camera.position,q.dir,J);try{T._updateStateFromCamera()}catch{return void s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++X<10);return{center:T.center,zoom:T.zoom,bearing:T.bearing,pitch:T.pitch}}fitBounds(n,a,h){return this.transform.projection.name==="globe"&&s.warnOnce("Globe projection does not support fitBounds API, this API may behave unexpectedly."),this._fitInternal(this.cameraForBounds(n,a),a,h)}_raycastElevationBox(n,a){const h=this.transform.elevation;if(!h)return;const m=new s.pointGeometry(n.x,a.y),_=new s.pointGeometry(a.x,n.y),b=h.pointCoordinate(n);if(!b)return;const T=h.pointCoordinate(a);if(!T)return;const S=h.pointCoordinate(m);if(!S)return;const I=h.pointCoordinate(_);if(!I)return;const k=new s.MercatorCoordinate(b[0],b[1]).toLngLat(),R=new s.MercatorCoordinate(T[0],T[1]).toLngLat(),U=new s.MercatorCoordinate(S[0],S[1]).toLngLat(),W=new s.MercatorCoordinate(I[0],I[1]).toLngLat(),j=Math.min(k.lng,Math.min(R.lng,Math.min(U.lng,W.lng))),$=Math.min(k.lat,Math.min(R.lat,Math.min(U.lat,W.lat))),q=Math.max(k.lng,Math.max(R.lng,Math.max(U.lng,W.lng))),N=Math.max(k.lat,Math.max(R.lat,Math.max(U.lat,W.lat))),J=Math.min(b[3],Math.min(T[3],Math.min(S[3],I[3]))),X=Math.max(b[3],Math.max(T[3],Math.max(S[3],I[3])));return{minLngLat:new s.LngLat(j,$),maxLngLat:new s.LngLat(q,N),minAltitude:J,maxAltitude:X}}fitScreenCoordinates(n,a,h,m,_){let b,T,S,I;this.transform.projection.name==="globe"&&s.warnOnce("Globe projection does not support fitScreenCoordinates API, this API may behave unexpectedly.");const k=s.pointGeometry.convert(n),R=s.pointGeometry.convert(a),U=this._raycastElevationBox(k,R);if(U)b=U.minLngLat,T=U.maxLngLat,S=U.minAltitude,I=U.maxAltitude;else{if(this.transform.anyCornerOffEdge(k,R))return this;b=this.transform.pointLocation(k),T=this.transform.pointLocation(R)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(s.pointGeometry.convert(n)),this.transform.pointLocation(s.pointGeometry.convert(a)),h,m):this._cameraForBox(b,T,S,I,m),m,_)}_fitInternal(n,a,h){return n?(delete(a=s.extend(n,a)).padding,a.linear?this.easeTo(a,h):this.flyTo(a,h)):this}jumpTo(n,a){this.stop();const h=n.preloadOnly?this.transform.clone():this.transform;let m=!1,_=!1,b=!1;return"zoom"in n&&h.zoom!==+n.zoom&&(m=!0,h.zoom=+n.zoom),n.center!==void 0&&(h.center=s.LngLat.convert(n.center)),"bearing"in n&&h.bearing!==+n.bearing&&(_=!0,h.bearing=+n.bearing),"pitch"in n&&h.pitch!==+n.pitch&&(b=!0,h.pitch=+n.pitch),n.padding==null||h.isPaddingEqual(n.padding)||(h.padding=n.padding),n.preloadOnly?(this._preloadTiles(h),this):(this.fire(new s.Event("movestart",a)).fire(new s.Event("move",a)),m&&this.fire(new s.Event("zoomstart",a)).fire(new s.Event("zoom",a)).fire(new s.Event("zoomend",a)),_&&this.fire(new s.Event("rotatestart",a)).fire(new s.Event("rotate",a)).fire(new s.Event("rotateend",a)),b&&this.fire(new s.Event("pitchstart",a)).fire(new s.Event("pitch",a)).fire(new s.Event("pitchend",a)),this.fire(new s.Event("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.warnOnce(uu),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,a){const h=this.transform;if(!h.projection.supportsFreeCamera)return s.warnOnce(uu),this;this.stop();const m=h.zoom,_=h.pitch,b=h.bearing;h.setFreeCameraOptions(n);const T=m!==h.zoom,S=_!==h.pitch,I=b!==h.bearing;return this.fire(new s.Event("movestart",a)).fire(new s.Event("move",a)),T&&this.fire(new s.Event("zoomstart",a)).fire(new s.Event("zoom",a)).fire(new s.Event("zoomend",a)),I&&this.fire(new s.Event("rotatestart",a)).fire(new s.Event("rotate",a)).fire(new s.Event("rotateend",a)),S&&this.fire(new s.Event("pitchstart",a)).fire(new s.Event("pitch",a)).fire(new s.Event("pitchend",a)),this.fire(new s.Event("moveend",a)),this}easeTo(n,a){this._stop(!1,n.easeId),((n=s.extend({offset:[0,0],duration:500,easing:s.ease},n)).animate===!1||!n.essential&&s.exported.prefersReducedMotion)&&(n.duration=0);const h=this.transform,m=this.getZoom(),_=this.getBearing(),b=this.getPitch(),T=this.getPadding(),S="zoom"in n?+n.zoom:m,I="bearing"in n?this._normalizeBearing(n.bearing,_):_,k="pitch"in n?+n.pitch:b,R="padding"in n?n.padding:h.padding,U=s.pointGeometry.convert(n.offset);let W,j,$;if(h.projection.name==="globe"){const me=s.MercatorCoordinate.fromLngLat(h.center),Ce=U.rotate(-h.angle);me.x+=Ce.x/h.worldSize,me.y+=Ce.y/h.worldSize;const rt=me.toLngLat(),xe=s.LngLat.convert(n.center||rt);this._normalizeCenter(xe),W=h.centerPoint.add(Ce),j=new s.pointGeometry(me.x,me.y).mult(h.worldSize),$=new s.pointGeometry(s.mercatorXfromLng(xe.lng),s.mercatorYfromLat(xe.lat)).mult(h.worldSize).sub(j)}else{W=h.centerPoint.add(U);const me=h.pointLocation(W),Ce=s.LngLat.convert(n.center||me);this._normalizeCenter(Ce),j=h.project(me),$=h.project(Ce).sub(j)}const q=h.zoomScale(S-m);let N,J;n.around&&(N=s.LngLat.convert(n.around),J=h.locationPoint(N));const X=this._zooming||S!==m,ue=this._rotating||_!==I,le=this._pitching||k!==b,re=!h.isPaddingEqual(R),ce=me=>Ce=>{if(X&&(me.zoom=s.number(m,S,Ce)),ue&&(me.bearing=s.number(_,I,Ce)),le&&(me.pitch=s.number(b,k,Ce)),re&&(me.interpolatePadding(T,R,Ce),W=me.centerPoint.add(U)),N)me.setLocationAtPoint(N,J);else{const rt=me.zoomScale(me.zoom-m),xe=S>m?Math.min(2,q):Math.max(.5,q),Ve=Math.pow(xe,1-Ce),Ge=me.unproject(j.add($.mult(Ce*Ve)).mult(rt));me.setLocationAtPoint(me.renderWorldCopies?Ge.wrap():Ge,W)}return n.preloadOnly||this._fireMoveEvents(a),me};if(n.preloadOnly){const me=this._emulate(ce,n.duration,h);return this._preloadTiles(me),this}const ae={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=X,this._rotating=ue,this._pitching=le,this._padding=re,this._easeId=n.easeId,this._prepareEase(a,n.noMoveStart,ae),this._ease(ce(h),me=>{h.recenterOnTerrain(),this._afterEase(a,me)},n),this}_prepareEase(n,a,h={}){this._moving=!0,this.transform.cameraElevationReference="sea",a||h.moving||this.fire(new s.Event("movestart",n)),this._zooming&&!h.zooming&&this.fire(new s.Event("zoomstart",n)),this._rotating&&!h.rotating&&this.fire(new s.Event("rotatestart",n)),this._pitching&&!h.pitching&&this.fire(new s.Event("pitchstart",n))}_fireMoveEvents(n){this.fire(new s.Event("move",n)),this._zooming&&this.fire(new s.Event("zoom",n)),this._rotating&&this.fire(new s.Event("rotate",n)),this._pitching&&this.fire(new s.Event("pitch",n))}_afterEase(n,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const h=this._zooming,m=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,h&&this.fire(new s.Event("zoomend",n)),m&&this.fire(new s.Event("rotateend",n)),_&&this.fire(new s.Event("pitchend",n)),this.fire(new s.Event("moveend",n))}flyTo(n,a){if(!n.essential&&s.exported.prefersReducedMotion){const vt=s.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(vt,a)}this.stop(),n=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},n);const h=this.transform,m=this.getZoom(),_=this.getBearing(),b=this.getPitch(),T=this.getPadding(),S="zoom"in n?s.clamp(+n.zoom,h.minZoom,h.maxZoom):m,I="bearing"in n?this._normalizeBearing(n.bearing,_):_,k="pitch"in n?+n.pitch:b,R="padding"in n?n.padding:h.padding,U=h.zoomScale(S-m),W=s.pointGeometry.convert(n.offset);let j=h.centerPoint.add(W);const $=h.pointLocation(j),q=s.LngLat.convert(n.center||$);this._normalizeCenter(q);const N=h.project($),J=h.project(q).sub(N);let X=n.curve;const ue=Math.max(h.width,h.height),le=ue/U,re=J.mag();if("minZoom"in n){const vt=s.clamp(Math.min(n.minZoom,m,S),h.minZoom,h.maxZoom),_t=ue/h.zoomScale(vt-m);X=Math.sqrt(_t/re*2)}const ce=X*X;function ae(vt){const _t=(le*le-ue*ue+(vt?-1:1)*ce*ce*re*re)/(2*(vt?le:ue)*ce*re);return Math.log(Math.sqrt(_t*_t+1)-_t)}function me(vt){return(Math.exp(vt)-Math.exp(-vt))/2}function Ce(vt){return(Math.exp(vt)+Math.exp(-vt))/2}const rt=ae(0);let xe=function(vt){return Ce(rt)/Ce(rt+X*vt)},Ve=function(vt){return ue*((Ce(rt)*(me(_t=rt+X*vt)/Ce(_t))-me(rt))/ce)/re;var _t},Ge=(ae(1)-rt)/X;if(Math.abs(re)<1e-6||!isFinite(Ge)){if(Math.abs(ue-le)<1e-6)return this.easeTo(n,a);const vt=le<ue?-1:1;Ge=Math.abs(Math.log(le/ue))/X,Ve=function(){return 0},xe=function(_t){return Math.exp(vt*X*_t)}}n.duration="duration"in n?+n.duration:1e3*Ge/("screenSpeed"in n?+n.screenSpeed/X:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const pt=_!==I,Le=k!==b,lt=!h.isPaddingEqual(R),qe=vt=>_t=>{const It=_t*Ge,Lt=1/xe(It);vt.zoom=_t===1?S:m+vt.scaleZoom(Lt),pt&&(vt.bearing=s.number(_,I,_t)),Le&&(vt.pitch=s.number(b,k,_t)),lt&&(vt.interpolatePadding(T,R,_t),j=vt.centerPoint.add(W));const qt=_t===1?q:vt.unproject(N.add(J.mult(Ve(It))).mult(Lt));return vt.setLocationAtPoint(vt.renderWorldCopies?qt.wrap():qt,j),vt._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(a),vt};if(n.preloadOnly){const vt=this._emulate(qe,n.duration,h);return this._preloadTiles(vt),this}return this._zooming=!0,this._rotating=pt,this._pitching=Le,this._padding=lt,this._prepareEase(a,!1),this._ease(qe(h),()=>this._afterEase(a),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const h=this._onEaseEnd;this._onEaseEnd=void 0,h.call(this,a)}if(!n){const h=this.handlers;h&&h.stop(!1)}return this}_ease(n,a,h){h.animate===!1||h.duration===0?(n(1),a()):(this._easeStart=s.exported.now(),this._easeOptions=h,this._onEaseFrame=n,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((s.exported.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,a){n=s.wrap(n,-180,180);const h=Math.abs(n-a);return Math.abs(n-360-a)<h&&(n-=360),Math.abs(n+360-a)<h&&(n+=360),n}_normalizeCenter(n){const a=this.transform;if(!a.renderWorldCopies||a.maxBounds)return;const h=n.lng-a.center.lng;n.lng+=h>180?-360:h<-180?360:0}_emulate(n,a,h){const m=Math.ceil(15*a/1e3),_=[],b=n(h.clone());for(let T=0;T<=m;T++){const S=b(T/m);_.push(S.clone())}return _}}class hu{constructor(n={}){this.options=n,s.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const a=this.options&&this.options.compact;return this._map=n,this._container=te("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=te("button","mapboxgl-ctrl-attrib-button",this._container),te("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=te("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,a){const h=this._map._getUIString(`AttributionControl.${a}`);n.setAttribute("aria-label",h),n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",h)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.config.ACCESS_TOKEN}];if(n){const h=a.reduce((m,_,b)=>(_.value&&(m+=`${_.key}=${_.value}${b<a.length-1?"&":""}`),m),"?");n.href=`${s.config.FEEDBACK_URL}/${h}#${ou(this._map,!0)}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const a=this._map.style._sourceCaches;for(const m in a){const _=a[m];if(_.used){const b=_.getSource();b.attribution&&n.indexOf(b.attribution)<0&&n.push(b.attribution)}}n.sort((m,_)=>m.length-_.length),n=n.filter((m,_)=>{for(let b=_+1;b<n.length;b++)if(n[b].indexOf(m)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const h=n.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,n.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class du{constructor(){s.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=te("div","mapboxgl-ctrl");const a=te("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const a in n){const h=n[a].getSource();if(h.hasOwnProperty("mapbox_logo")&&!h.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const a=n[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class fu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const a=++this._id;return this._queue.push({callback:n,id:a,cancelled:!1}),a}remove(n){const a=this._currentlyRunning,h=a?this._queue.concat(a):this._queue;for(const m of h)if(m.id===n)return void(m.cancelled=!0)}run(n=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const h of a)if(!h.cancelled&&(h.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function pu(c,n,a){if(c=new s.LngLat(c.lng,c.lat),n){const h=new s.LngLat(c.lng-360,c.lat),m=new s.LngLat(c.lng+360,c.lat),_=360*Math.ceil(Math.abs(c.lng-a.center.lng)/360),b=a.locationPoint(c).distSqr(n),T=n.x<0||n.y<0||n.x>a.width||n.y>a.height;a.locationPoint(h).distSqr(n)<b&&(T||Math.abs(h.lng-a.center.lng)<_)?c=h:a.locationPoint(m).distSqr(n)<b&&(T||Math.abs(m.lng-a.center.lng)<_)&&(c=m)}for(;Math.abs(c.lng-a.center.lng)>180;){const h=a.locationPoint(c);if(h.x>=0&&h.y>=0&&h.x<=a.width&&h.y<=a.height)break;c.lng>a.center.lng?c.lng-=360:c.lng+=360}return c}const Ea={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Pl extends s.Evented{constructor(n,a){if(super(),(n instanceof s.window.HTMLElement||a)&&(n=s.extend({element:n},a)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),n&&n.element)this._element=n.element,this._offset=s.pointGeometry.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=te("div");const m=41,_=27,b=_e("svg",{display:"block",height:m*this._scale+"px",width:_*this._scale+"px",viewBox:`0 0 ${_} ${m}`},this._element),T=_e("radialGradient",{id:"shadowGradient"},_e("defs",{},b));_e("stop",{offset:"10%","stop-opacity":.4},T),_e("stop",{offset:"100%","stop-opacity":.05},T),_e("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},b),_e("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},b),_e("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},b),_e("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},b),this._offset=s.pointGeometry.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",m=>{m.preventDefault()}),this._element.addEventListener("mousedown",m=>{m.preventDefault()});const h=this._element.classList;for(const m in Ea)h.remove(`mapboxgl-marker-anchor-${m}`);h.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=s.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const m=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const a=n.code,h=n.charCode||n.keyCode;a!=="Space"&&a!=="Enter"&&h!==32&&h!==13||this.togglePopup()}_onMapClick(n){const a=n.originalEvent.target,h=this._element;this._popup&&(a===h||h.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map;if(!n)return!1;const a=n.unproject(this._pos),h=n.getFreeCameraOptions();if(!h.position)return!1;const m=h.position.toLngLat();return m.distanceTo(a)<.9*m.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const a=this._pos;if(!a||a.x<0||a.x>n.transform.width||a.y<0||a.y>n.transform.height)return void this._clearFadeTimer();const h=n.unproject(a);let m;n._showingGlobe()&&s.isLngLatBehindGlobe(n.transform,this._lngLat)?m=0:(m=1-n._queryFogOpacity(h),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(m*=.2)),this._element.style.opacity=`${m}`,this._element.style.pointerEvents=m>0?"auto":"none",this._popup&&this._popup._setOpacity(m),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const a=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${Ea[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${a.x}px,${a.y}px)
        `}_calculateXYTransform(){const n=this._pos,a=this._map,h=this.getPitchAlignment();if(!a||!n||h!=="map")return"";if(!a._showingGlobe()){const S=a.getPitch();return S?`rotateX(${S}deg)`:""}const m=s.radToDeg(s.globeTiltAtLngLat(a.transform,this._lngLat)),_=n.sub(s.globeCenterToScreenPoint(a.transform)),b=Math.abs(_.x)+Math.abs(_.y);if(b===0)return"";const T=m/b;return`rotateX(${-_.y*T}deg) rotateY(${_.x*T}deg)`}_calculateZTransform(){const n=this._pos,a=this._map;if(!a||!n)return"";let h=0;const m=this.getRotationAlignment();if(m==="map")if(a._showingGlobe()){const _=a.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),b=a.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(_);h=s.radToDeg(Math.atan2(b.y,b.x))-90}else h=-a.getBearing();else if(m==="horizon"){const _=s.smoothstep(4,6,a.getZoom()),b=s.globeCenterToScreenPoint(a.transform);b.y+=_*a.transform.height;const T=n.sub(b),S=s.radToDeg(Math.atan2(T.y,T.x));h=(S>90?S-270:S+90)*(1-_)}return h+=this._rotation,h?`rotateZ(${h}deg)`:""}_update(n){s.window.cancelAnimationFrame(this._updateFrameId);const a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=pu(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat),n===!0?this._updateFrameId=s.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),a._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=s.pointGeometry.convert(n),this._update(),this}_onMove(n){const a=this._map;if(a){if(!this._isDragging){const h=this._clickTolerance||a._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=a.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"}_addDragHandler(n){const a=this._map;a&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos),this._pointerdownPos=n.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const a=this._map;return a&&(n?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}}class td{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const a=s.easeCubicInOut((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,a,h){this._start=this.getValue(a),this._end=n,this._startTime=a,this._endTime=a+h}}const id={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},nd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Sa(c){c.parentNode&&c.parentNode.removeChild(c)}const rd={showCompass:!0,showZoom:!0,visualizePitch:!1};class mu{constructor(n,a,h=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new au({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,h&&(this.mousePitch=new mn({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(n,a){this.mouseRotate.mousedown(n,a),this.mousePitch&&this.mousePitch.mousedown(n,a),ot()}move(n,a){const h=this.map,m=this.mouseRotate.mousemoveWindow(n,a),_=m&&m.bearingDelta;if(_&&h.setBearing(h.getBearing()+_),this.mousePitch){const b=this.mousePitch.mousemoveWindow(n,a),T=b&&b.pitchDelta;T&&h.setPitch(h.getPitch()+T)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Se(),s.window.removeEventListener("mousemove",this.mousemove),s.window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(s.extend({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),Ie(this.element,n)),s.window.addEventListener("mousemove",this.mousemove),s.window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,Ie(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Pe(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=Pe(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const od={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},_u={maxWidth:100,unit:"metric"};function gu(c,n,a){const h=Dl(n),m=h/n,_={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[a];this._map._requestDomTask(()=>{this._container.style.width=c*m+"px",this._container.innerHTML=`${h}&nbsp;${_}`})}function Dl(c){const n=Math.pow(10,`${Math.floor(c)}`.length-1);let a=c/n;return a=a>=10?10:a>=5?5:a>=3?3:a>=2?2:a>=1?1:function(h){const m=Math.pow(10,Math.ceil(-Math.log(h)/Math.LN10));return Math.round(h*m)/m}(a),n*a}const tp={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ip=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ll(c=new s.pointGeometry(0,0),n="bottom"){if(typeof c=="number"){const a=Math.round(Math.sqrt(.5*Math.pow(c,2)));switch(n){case"top":return new s.pointGeometry(0,c);case"top-left":return new s.pointGeometry(a,a);case"top-right":return new s.pointGeometry(-a,a);case"bottom":return new s.pointGeometry(0,-c);case"bottom-left":return new s.pointGeometry(a,-a);case"bottom-right":return new s.pointGeometry(-a,-a);case"left":return new s.pointGeometry(c,0);case"right":return new s.pointGeometry(-c,0)}return new s.pointGeometry(0,0)}return c instanceof s.pointGeometry||Array.isArray(c)?s.pointGeometry.convert(c):s.pointGeometry.convert(c[n]||[0,0])}const Ca={version:s.version,supported:Z,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:class extends ed{constructor(c){if((c=s.extend({},nd,c)).minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(c.antialias&&s.isSafariWithAntialiasingBug(s.window)&&(c.antialias=!1,s.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ya(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies),c),this._interactive=c.interactive,this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=c.preserveDrawingBuffer,this._antialias=c.antialias,this._trackResize=c.trackResize,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles,this._fadeDuration=c.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=c.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=c.collectResourceTiming,this._optimizeForTerrain=c.optimizeForTerrain,this._language=c.language==="auto"?s.window.navigator.language:c.language,this._worldview=c.worldview,this._renderTaskQueue=new fu,this._domRenderTaskQueue=new fu,this._controls=[],this._markers=[],this._mapId=s.uniqueId(),this._locale=s.extend({},id,c.locale),this._clickTolerance=c.clickTolerance,this._cooperativeGestures=c.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new td(0),this._useExplicitProjection=!1,this._requestManager=new s.RequestManager(c.transformRequest,c.accessToken,c.testMode),this._silenceAuthErrors=!!c.testMode,typeof c.container=="string"){if(this._container=s.window.document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof s.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(this._container.childNodes.length>0&&s.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),c.maxBounds&&this.setMaxBounds(c.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),s.window!==void 0&&(s.window.addEventListener("online",this._onWindowOnline,!1),s.window.addEventListener("resize",this._onWindowResize,!1),s.window.addEventListener("orientationchange",this._onWindowResize,!1),s.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Qh(this,c),this._localFontFamily=c.localFontFamily,this._localIdeographFontFamily=c.localIdeographFontFamily,c.style&&this.setStyle(c.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),c.projection&&this.setProjection(c.projection),this._hash=c.hash&&new Rh(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,s.extend({},c.fitBoundsOptions,{duration:0})))),this.resize(),c.attributionControl&&this.addControl(new hu({customAttribution:c.customAttribution})),this._logoControl=new du,this.addControl(this._logoControl,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new s.Event(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new s.Event(`${n.dataType}dataloading`,n))})}_getMapId(){return this._mapId}addControl(c,n){if(n===void 0&&(n=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=c.onAdd(this);this._controls.push(c);const h=this._controlPositions[n];return n.indexOf("bottom")!==-1?h.insertBefore(a,h.firstChild):h.appendChild(a),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(c);return n>-1&&this._controls.splice(n,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(c){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new s.Event("movestart",c)).fire(new s.Event("move",c)),this.fire(new s.Event("resize",c)),n&&this.fire(new s.Event("moveend",c)),this}getBounds(){return this.transform.projection.name==="globe"&&s.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(c){return this.transform.setMaxBounds(s.LngLatBounds.convert(c)),this._update()}setMinZoom(c){if((c=c==null?-2:c)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c?this.setZoom(c):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c==null?22:c)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c?this.setZoom(c):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c==null?0:c)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c?this.setPitch(c):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c==null?85:c)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c?this.setPitch(c):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this._update()}getLanguage(){return this._language}setLanguage(c){if(this._language=c==="auto"?s.window.navigator.language:c,this.style)for(const n in this.style._sourceCaches){const a=this.style._sourceCaches[n]._source;a._setLanguage&&a._setLanguage(this._language)}for(const n of this._controls)n._setLanguage&&n._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(c){if(this._worldview=c,this.style)for(const n in this.style._sourceCaches){const a=this.style._sourceCaches[n]._source;a._setWorldview&&a._setWorldview(c)}return this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(c){return this._lazyInitEmptyStyle(),c?typeof c=="string"&&(c={name:c}):c=null,this._useExplicitProjection=!!c,this._prioritizeAndUpdateProjection(c,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const c=this.transform,n=c.projection.name;let a;n==="globe"&&c.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?(c.setMercatorFromTransition(),a=!0):n==="mercator"&&c.zoom<s.GLOBE_ZOOM_THRESHOLD_MAX&&(c.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(c,n){return this._updateProjection(c||n||{name:"mercator"})}_updateProjection(c){let n;if(n=c.name==="globe"&&this.transform.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(c),this.style.applyProjectionUpdate(),n){this.painter.clearBackgroundTiles();for(const a in this.style._sourceCaches)this.style._sourceCaches[a].clearTiles();this._update(!0)}return this}project(c){return this.transform.locationPoint3D(s.LngLat.convert(c))}unproject(c){return this.transform.pointLocation3D(s.pointGeometry.convert(c))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(c,n,a){if(c==="mouseenter"||c==="mouseover"){let h=!1;const m=b=>{const T=n.filter(I=>this.getLayer(I)),S=T.length?this.queryRenderedFeatures(b.point,{layers:T}):[];S.length?h||(h=!0,a.call(this,new En(c,this,b.originalEvent,{features:S}))):h=!1},_=()=>{h=!1};return{layers:new Set(n),listener:a,delegates:{mousemove:m,mouseout:_}}}if(c==="mouseleave"||c==="mouseout"){let h=!1;const m=b=>{const T=n.filter(S=>this.getLayer(S));(T.length?this.queryRenderedFeatures(b.point,{layers:T}):[]).length?h=!0:h&&(h=!1,a.call(this,new En(c,this,b.originalEvent)))},_=b=>{h&&(h=!1,a.call(this,new En(c,this,b.originalEvent)))};return{layers:new Set(n),listener:a,delegates:{mousemove:m,mouseout:_}}}{const h=m=>{const _=n.filter(T=>this.getLayer(T)),b=_.length?this.queryRenderedFeatures(m.point,{layers:_}):[];b.length&&(m.features=b,a.call(this,m),delete m.features)};return{layers:new Set(n),listener:a,delegates:{[c]:h}}}}on(c,n,a){if(a===void 0)return super.on(c,n);Array.isArray(n)||(n=[n]);const h=this._createDelegatedListener(c,n,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(h);for(const m in h.delegates)this.on(m,h.delegates[m]);return this}once(c,n,a){if(a===void 0)return super.once(c,n);Array.isArray(n)||(n=[n]);const h=this._createDelegatedListener(c,n,a);for(const m in h.delegates)this.once(m,h.delegates[m]);return this}off(c,n,a){if(a===void 0)return super.off(c,n);n=new Set(Array.isArray(n)?n:[n]);const h=(_,b)=>{if(_.size!==b.size)return!1;for(const T of _)if(!b.has(T))return!1;return!0},m=this._delegatedListeners?this._delegatedListeners[c]:void 0;return m&&(_=>{for(let b=0;b<_.length;b++){const T=_[b];if(T.listener===a&&h(T.layers,n)){for(const S in T.delegates)this.off(S,T.delegates[S]);return _.splice(b,1),this}}})(m),this}queryRenderedFeatures(c,n){return this.style?(n!==void 0||c===void 0||c instanceof s.pointGeometry||Array.isArray(c)||(n=c,c=void 0),this.style.queryRenderedFeatures(c=c||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(c,n){return this.style.querySourceFeatures(c,n)}queryTerrainElevation(c,n){const a=this.transform.elevation;return a?(n=s.extend({},{exaggerated:!0},n),a.getAtPoint(s.MercatorCoordinate.fromLngLat(c),null,n.exaggerated)):null}setStyle(c,n){return(n=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&c?(this._diffStyle(c,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(c,n))}_getUIString(c){const n=this._locale[c];if(n==null)throw new Error(`Missing UI string '${c}'`);return n}_updateStyle(c,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),c&&(this.style=new fr(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof c=="string"?this.style.loadURL(c):this.style.loadJSON(c)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new fr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(c,n){if(typeof c=="string"){const a=this._requestManager.normalizeStyleURL(c),h=this._requestManager.transformRequest(a,s.ResourceType.Style);s.getJSON(h,(m,_)=>{m?this.fire(new s.ErrorEvent(m)):_&&this._updateDiff(_,n)})}else typeof c=="object"&&this._updateDiff(c,n)}_updateDiff(c,n){try{this.style.setState(c)&&this._update(!0)}catch(a){s.warnOnce(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(c,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.warnOnce("There is no style added to the map."),!1)}addSource(c,n){return this._lazyInitEmptyStyle(),this.style.addSource(c,n),this._update(!0)}isSourceLoaded(c){return!!this.style&&this.style._isSourceCacheLoaded(c)}areTilesLoaded(){const c=this.style&&this.style._sourceCaches;for(const n in c){const a=c[n]._tiles;for(const h in a){const m=a[h];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}addSourceType(c,n,a){this._lazyInitEmptyStyle(),this.style.addSourceType(c,n,a)}removeSource(c){return this.style.removeSource(c),this._updateTerrain(),this._update(!0)}getSource(c){return this.style.getSource(c)}addImage(c,n,{pixelRatio:a=1,sdf:h=!1,stretchX:m,stretchY:_,content:b}={}){if(this._lazyInitEmptyStyle(),n instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&n instanceof s.window.ImageBitmap){const{width:T,height:S,data:I}=s.exported.getImageData(n);this.style.addImage(c,{data:new s.RGBAImage({width:T,height:S},I),pixelRatio:a,stretchX:m,stretchY:_,content:b,sdf:h,version:0})}else if(n.width===void 0||n.height===void 0)this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:T,height:S}=n,I=n;this.style.addImage(c,{data:new s.RGBAImage({width:T,height:S},new Uint8Array(I.data)),pixelRatio:a,stretchX:m,stretchY:_,content:b,sdf:h,version:0,userImage:I}),I.onAdd&&I.onAdd(this,c)}}updateImage(c,n){const a=this.style.getImage(c);if(!a)return void this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const h=n instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&n instanceof s.window.ImageBitmap?s.exported.getImageData(n):n,{width:m,height:_}=h;m!==void 0&&_!==void 0?m===a.data.width&&_===a.data.height?(a.data.replace(h.data,!(n instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&n instanceof s.window.ImageBitmap)),this.style.updateImage(c,a)):this.fire(new s.ErrorEvent(new Error(`The width and height of the updated image (${m}, ${_})
                must be that same as the previous version of the image
                (${a.data.width}, ${a.data.height})`))):this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(c){return c?!!this.style.getImage(c):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(c)}loadImage(c,n){s.getImage(this._requestManager.transformRequest(c,s.ResourceType.Image),(a,h)=>{n(a,h instanceof s.window.HTMLImageElement?s.exported.getImageData(h):h)})}listImages(){return this.style.listImages()}addLayer(c,n){return this._lazyInitEmptyStyle(),this.style.addLayer(c,n),this._update(!0)}moveLayer(c,n){return this.style.moveLayer(c,n),this._update(!0)}removeLayer(c){return this.style.removeLayer(c),this._update(!0)}getLayer(c){return this.style.getLayer(c)}setLayerZoomRange(c,n,a){return this.style.setLayerZoomRange(c,n,a),this._update(!0)}setFilter(c,n,a={}){return this.style.setFilter(c,n,a),this._update(!0)}getFilter(c){return this.style.getFilter(c)}setPaintProperty(c,n,a,h={}){return this.style.setPaintProperty(c,n,a,h),this._update(!0)}getPaintProperty(c,n){return this.style.getPaintProperty(c,n)}setLayoutProperty(c,n,a,h={}){return this.style.setLayoutProperty(c,n,a,h),this._update(!0)}getLayoutProperty(c,n){return this.style.getLayoutProperty(c,n)}setLight(c,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(c,n),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(c){return this._lazyInitEmptyStyle(),!c&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(c),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(c){return this._lazyInitEmptyStyle(),this.style.setFog(c),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(c){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.LngLat.convert(c),this.transform):0}setFeatureState(c,n){return this.style.setFeatureState(c,n),this._update()}removeFeatureState(c,n){return this.style.removeFeatureState(c,n),this._update()}getFeatureState(c){return this.style.getFeatureState(c)}_updateContainerDimensions(){if(!this._container)return;const c=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let a,h,m,_=this._container;for(;_&&(!h||!m);){const b=s.window.getComputedStyle(_).transform;b&&b!=="none"&&(a=b.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(h=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(m=a[3])),_=_.parentElement}this._containerWidth=h?Math.abs(c/h):c,this._containerHeight=m?Math.abs(n/m):n}_detectMissingCSS(){s.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const c=this._container;c.classList.add("mapboxgl-map"),(this._missingCSSCanary=te("div","mapboxgl-canary",c)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=te("div","mapboxgl-canvas-container",c);this._interactive&&n.classList.add("mapboxgl-interactive"),this._canvas=te("canvas","mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const a=this._controlContainer=te("div","mapboxgl-control-container",c),h=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(m=>{h[m]=te("div",`mapboxgl-ctrl-${m}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(c,n){const a=s.exported.devicePixelRatio||1;this._canvas.width=a*Math.ceil(c),this._canvas.height=a*Math.ceil(n),this._canvas.style.width=`${c}px`,this._canvas.style.height=`${n}px`}_addMarker(c){this._markers.push(c)}_removeMarker(c){const n=this._markers.indexOf(c);n!==-1&&this._markers.splice(n,1)}_setupPainter(){const c=s.extend({},Z.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl",c)||this._canvas.getContext("experimental-webgl",c);n?(s.storeAuthState(n,!0),this.painter=new eu(n,this.transform),this.on("data",a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.exported$1.testSupport(n)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(c){c.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:c}))}_contextRestored(c){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:c}))}_onMapScroll(c){if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(c){return this.style?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_requestDomTask(c){!this.loaded()||this.loaded()&&!this.isMoving()?c():this._domRenderTaskQueue.add(c)}_render(c){let n;const a=this.painter.context.extTimerQuery,h=s.exported.now();if(this.listens("gpu-timing-frame")&&(n=a.createQueryEXT(),a.beginQueryEXT(a.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(c),this._domRenderTaskQueue.run(c),this._removed)return;this._updateProjectionTransition();let m=!1;const _=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const S=this.transform.zoom,I=this.transform.pitch,k=s.exported.now();this.style.zoomHistory.update(S,k);const R=new s.EvaluationParameters(S,{now:k,fadeDuration:_,pitch:I,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),U=R.crossFadingFactor();U===1&&U===this._crossFadingFactor||(m=!0,this._crossFadingFactor=U),this.style.update(R)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(h),this.style._updateSources(this.transform),this._forceMarkerUpdate()):b=this._updateAverageElevation(h),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,_,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:_,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.Event("load"))),this.style&&(this.style.hasTransitions()||m)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const S=s.exported.now()-h;a.endQueryEXT(a.TIME_ELAPSED_EXT,n),setTimeout(()=>{const I=a.getQueryObjectEXT(n,a.QUERY_RESULT_EXT)/1e6;a.deleteQueryEXT(n),this.fire(new s.Event("gpu-timing-frame",{cpuTime:S,gpuTime:I})),s.window.performance.mark("frame-gpu",{startTime:h,detail:{gpuTime:I}})},50)}if(this.listens("gpu-timing-layer")){const S=this.painter.collectGpuTimers();setTimeout(()=>{const I=this.painter.queryGpuTimers(S);this.fire(new s.Event("gpu-timing-layer",{layerTimes:I}))},50)}if(this.listens("gpu-timing-deferred-render")){const S=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const I=this.painter.queryGpuTimeDeferredRender(S);this.fire(new s.Event("gpu-timing-deferred-render",{gpuTime:I}))},50)}const T=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(T||this._repaint)this.triggerRepaint();else{const S=!this.isMoving()&&this.loaded();if(S&&(b=this._updateAverageElevation(h,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),S&&(this.fire(new s.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const I=this._calculateSpeedIndex();this.fire(new s.Event("speedindexcompleted",{speedIndex:I})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||T||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const c of this._markers)c._update()}_updateAverageElevation(c,n=!1){const a=h=>(this.transform.averageElevation=h,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);if((n||c-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(c)){const h=this.transform.averageElevation;let m=this.transform.sampleAverageElevation(),_=!1;this.transform.elevation&&(_=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(m)?m=0:this._averageElevationLastSampledAt=c;const b=Math.abs(h-m);if(b>1){if(this._isInitialLoad||_)return this._averageElevation.jumpTo(m),a(m);this._averageElevation.easeTo(m,c,300)}else if(b>1e-4)return this._averageElevation.jumpTo(m),a(m)}return!!this._averageElevation.isEasing(c)&&a(this._averageElevation.getValue(c))}_authenticate(){s.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,c=>{if(c&&(c.message===s.AUTH_ERR_MSG||c.status===401)){const n=this.painter.context.gl;s.storeAuthState(n,!1),this._logoControl instanceof du&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),s.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const c=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const a=this.painter.context.gl,h=a.createFramebuffer();function m(_){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,_,0);const b=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,b),b}return a.bindFramebuffer(a.FRAMEBUFFER,h),this._canvasPixelComparison(m(c),n.canvasCopies.map(m),n.timeStamps)}_canvasPixelComparison(c,n,a){let h=a[1]-a[0];const m=c.length/4;for(let _=0;_<n.length;_++){const b=n[_];let T=0;for(let S=0;S<b.length;S+=4)b[S]===c[S]&&b[S+1]===c[S+1]&&b[S+2]===c[S+2]&&b[S+3]===c[S+3]&&(T+=1);h+=(a[_+2]-a[_+1])*(1-T/m)}return h}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),s.window!==void 0&&(s.window.removeEventListener("resize",this._onWindowResize,!1),s.window.removeEventListener("orientationchange",this._onWindowResize,!1),s.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.removeEventListener("online",this._onWindowOnline,!1));const c=this.painter.context.gl.getExtension("WEBGL_lose_context");c&&c.loseContext(),Sa(this._canvasContainer),Sa(this._controlContainer),Sa(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),s.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new s.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(c){this._renderNextFrame=this._renderNextFrame||c,this.style&&!this._frame&&(this._frame=s.exported.frame(n=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(n)}))}_preloadTiles(c){const n=this.style?Object.values(this.style._sourceCaches):[];return s.asyncAll(n,(a,h)=>a._preloadTiles(c,h),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(c){this._trackResize&&this.resize({originalEvent:c})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(c){this._showTerrainWireframe!==c&&(this._showTerrainWireframe=c,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(c){this._speedIndexTiming!==c&&(this._speedIndexTiming=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}_setCacheLimits(c,n){s.setCacheLimits(c,n)}get version(){return s.version}},NavigationControl:class{constructor(c){this.options=s.extend({},rd,c),this._container=te("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),te("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),te("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:n}):a.resetNorth({},{originalEvent:n}))}),this._compassIcon=te("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const c=this._map;if(!c)return;const n=c.getZoom(),a=n===c.getMaxZoom(),h=n===c.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const c=this._map;if(!c)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(c.transform.pitch*(Math.PI/180)),.5)}) rotateX(${c.transform.pitch}deg) rotateZ(${c.transform.angle*(180/Math.PI)}deg)`:`rotate(${c.transform.angle*(180/Math.PI)}deg)`;c._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),c.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&c.on("pitch",this._rotateCompassArrow),c.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new mu(c,this._compass,this.options.visualizePitch)),this._container}onRemove(){const c=this._map;c&&(this._container.remove(),this.options.showZoom&&c.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&c.off("pitch",this._rotateCompassArrow),c.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(c,n){const a=te("button",c,this._container);return a.type="button",a.addEventListener("click",n),a}_setButtonTitle(c,n){if(!this._map)return;const a=this._map._getUIString(`NavigationControl.${n}`);c.setAttribute("aria-label",a),c.firstElementChild&&c.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends s.Evented{constructor(c){super(),this.options=s.extend({geolocation:s.window.navigator.geolocation},od,c),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=xa(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(c){return this._map=c,this._container=te("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(c){this._supportsGeolocation!==void 0?c(this._supportsGeolocation):s.window.navigator.permissions!==void 0?s.window.navigator.permissions.query({name:"geolocation"}).then(n=>{this._supportsGeolocation=n.state!=="denied",c(this._supportsGeolocation)}):(this._supportsGeolocation=!!this.options.geolocation,c(this._supportsGeolocation))}_isOutOfMapMaxBounds(c){const n=this._map.getMaxBounds(),a=c.coords;return!!n&&(a.longitude<n.getWest()||a.longitude>n.getEast()||a.latitude<n.getSouth()||a.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",c)),this._finish()}}_updateCamera(c){const n=new s.LngLat(c.coords.longitude,c.coords.latitude),a=c.coords.accuracy,h=this._map.getBearing(),m=s.extend({bearing:h},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(a),m,{geolocateSource:!0})}_updateMarker(c){if(c){const n=new s.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const c=this._map.transform,n=s.mercatorZfromAltitude(1,c._center.lat)*c.worldSize,a=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",c)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(c){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=te("button","mapboxgl-ctrl-geolocate",this._container),te("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",c===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=te("div","mapboxgl-user-location"),this._dotElement.appendChild(te("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(te("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Pl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=te("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Pl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.Event("trackuserlocationend")))})}_onDeviceOrientation(c){this._userLocationDotMarker&&(c.webkitCompassHeading?this._heading=c.webkitCompassHeading:c.absolute===!0&&(this._heading=-1*c.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(c={maximumAge:6e5,timeout:0},this._noTimeout=!0):(c=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,c),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const c=()=>{s.window.addEventListener("ondeviceorientationabsolute"in s.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};s.window.DeviceMotionEvent!==void 0&&typeof s.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&c()}).catch(console.error):c()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),s.window.removeEventListener("deviceorientation",this._onDeviceOrientation),s.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:hu,ScaleControl:class{constructor(c){this.options=s.extend({},_u,c),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=gu.bind(this)),s.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const c=this.options.maxWidth||100,n=this._map,a=n._containerHeight/2,h=n._containerWidth/2-c/2,m=n.unproject([h,a]),_=n.unproject([h+c,a]),b=m.distanceTo(_);if(this.options.unit==="imperial"){const T=3.2808*b;T>5280?this._setScale(c,T/5280,"mile"):this._setScale(c,T,"foot")}else this.options.unit==="nautical"?this._setScale(c,b/1852,"nautical-mile"):b>=1e3?this._setScale(c,b/1e3,"kilometer"):this._setScale(c,b,"meter")}_setScale(c,n,a){const h=Dl(n),m=h/n;this._map._requestDomTask(()=>{this._container.style.width=c*m+"px",this._container.innerHTML=a!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:a}).format(h):`${h}&nbsp;nm`})}onAdd(c){return this._map=c,this._language=c.getLanguage(),this._container=te("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(c){this._language=c,this._update()}setUnit(c){this.options.unit=c,this._update()}},FullscreenControl:class{constructor(c){this._fullscreen=!1,c&&c.container&&(c.container instanceof s.window.HTMLElement?this._container=c.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in s.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in s.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=te("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,s.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!s.window.document.fullscreenEnabled&&!s.window.document.webkitFullscreenEnabled)}_setupUI(){const c=this._fullscreenButton=te("button","mapboxgl-ctrl-fullscreen",this._controlContainer);te("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),s.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",c)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(s.window.document.fullscreenElement||s.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?s.window.document.exitFullscreen?s.window.document.exitFullscreen():s.window.document.webkitCancelFullScreen&&s.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.Evented{constructor(c){super(),this.options=s.extend(Object.create(tp),c),s.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(c&&c.className?c.className.trim().split(/\s+/):[])}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&c.on("preclick",this._onClose),this.options.closeOnMove&&c.on("move",this._onClose),c.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(c.on("mousemove",this._onMouseEvent),c.on("mouseup",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")):c.on("move",this._update),this.fire(new s.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const c=this._map;return c&&(c.off("move",this._update),c.off("move",this._onClose),c.off("preclick",this._onClose),c.off("click",this._onClose),c.off("remove",this.remove),c.off("mousemove",this._onMouseEvent),c.off("mouseup",this._onMouseEvent),c.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new s.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(c){this._lngLat=s.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const c=this._map;return c&&(c.off("move",this._update),c.on("mousemove",this._onMouseEvent),c.on("drag",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(s.window.document.createTextNode(c))}setHTML(c){const n=s.window.document.createDocumentFragment(),a=s.window.document.createElement("body");let h;for(a.innerHTML=c;h=a.firstChild,h;)n.appendChild(h);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=te("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(c),this.options.closeButton){const a=this._closeButton=te("button","mapboxgl-popup-close-button",n);a.type="button",a.setAttribute("aria-label","Close popup"),a.setAttribute("aria-hidden","true"),a.innerHTML="&#215;",a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(c){return this._classList.add(c),this._updateClassList(),this}removeClassName(c){return this._classList.delete(c),this._updateClassList(),this}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){let n;return this._classList.delete(c)?n=!1:(this._classList.add(c),n=!0),this._updateClassList(),n}_onMouseEvent(c){this._update(c.point)}_getAnchor(c){if(this.options.anchor)return this.options.anchor;const n=this._map,a=this._container,h=this._pos;if(!n||!a||!h)return"bottom";const m=a.offsetWidth,_=a.offsetHeight,b=h.x<m/2,T=h.x>n.transform.width-m/2;if(h.y+c<_)return b?"top-left":T?"top-right":"top";if(h.y>n.transform.height-_){if(b)return"bottom-left";if(T)return"bottom-right"}return b?"left":T?"right":"bottom"}_updateClassList(){const c=this._container;if(!c)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),c.className=n.join(" ")}_update(c){const n=this._map,a=this._content;if(!n||!this._lngLat&&!this._trackPointer||!a)return;let h=this._container;if(h||(h=this._container=te("div","mapboxgl-popup",n.getContainer()),this._tip=te("div","mapboxgl-popup-tip",h),h.appendChild(a)),this.options.maxWidth&&h.style.maxWidth!==this.options.maxWidth&&(h.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=pu(this._lngLat,this._pos,n.transform)),!this._trackPointer||c){const m=this._pos=this._trackPointer&&c?c:n.project(this._lngLat),_=Ll(this.options.offset),b=this._anchor=this._getAnchor(_.y),T=Ll(this.options.offset,b),S=m.add(T).round();n._requestDomTask(()=>{this._container&&b&&(this._container.style.transform=`${Ea[b]} translate(${S.x}px,${S.y}px)`)})}if(!this._marker&&n._showingGlobe()){const m=s.isLngLatBehindGlobe(n.transform,this._lngLat)?0:1;this._setOpacity(m)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const c=this._container.querySelector(ip);c&&c.focus()}_onClose(){this.remove()}_setOpacity(c){this._container&&(this._container.style.opacity=`${c}`),this._content&&(this._content.style.pointerEvents=c?"auto":"none")}},Marker:Pl,Style:fr,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.pointGeometry,MercatorCoordinate:s.MercatorCoordinate,FreeCameraOptions:Et,Evented:s.Evented,config:s.config,prewarm:function(){Ti().acquire(Pt)},clearPrewarmedResources:function(){const c=ei;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(Pt),ei=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return s.config.ACCESS_TOKEN},set accessToken(c){s.config.ACCESS_TOKEN=c},get baseApiUrl(){return s.config.API_URL},set baseApiUrl(c){s.config.API_URL=c},get workerCount(){return jt.workerCount},set workerCount(c){jt.workerCount=c},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){s.config.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage(c){s.clearTileCache(c)},workerUrl:"",workerClass:null,setNow:s.exported.setNow,restoreNow:s.exported.restoreNow};return Ca});var z=w;return z})})(Y0);const wm=Y0.exports;const Q0=(o,f)=>{const g=o.__vccOpts||o;for(const[v,w]of f)g[v]=w;return g},qC={__name:"Mapbox",setup(o){const f=ii();return wm.accessToken="pk.eyJ1IjoicnViZW5kZWRpZWdvOTAiLCJhIjoiY2t5anF6M2ltMHYxdDJ2cW9lNHZmc3JteiJ9.-WS08Ja1iIvjKvBNRX_X9w",ur(()=>{try{const g=new wm.Map({container:f.value,style:"mapbox://styles/mapbox/streets-v11",center:[-3.3257027308061775,40.49381049145687],zoom:13,projection:"globe"}),v=new wm.Marker().setLngLat([-3.3257027308061775,40.49381049145687]).addTo(g);g.on("style.load",()=>{g.setFog({})})}catch(g){console.error(g)}}),(g,v)=>(Vn(),Hs("div",{class:"map-container",ref_key:"mapContainer",ref:f},null,512))}},GC=Q0(qC,[["__scopeId","data-v-bcbcb3dd"]]),ZC=hn("div",{class:"col-12 column",style:{padding:"1rem"}},[hn("p",{class:"text-justify"},[Ya("Os esperamos en "),hn("strong",null,[hn("u",null,"La Vega del Henares")]),Ya(" donde celebraremos nuestro matrimonio junto a nuestros seres queridos.")])],-1),WC={style:{display:"flex","justify-content":"center","align-items":"center","margin-top":"1rem"}},XC={href:"http://maps.google.com/?q=Carretera Madrid Barcelona, 0 Km 33, N-II, 28801 Alcal\xE1 de Henares, Madrid"},HC={__name:"Lugar",setup(o){return(f,g)=>(Vn(),Hs(xr,null,[Vt(Df,{title:"Lugar"}),ZC,Vt(GC),hn("div",WC,[hn("a",XC,[Vt(uc,{color:"black",icon:"map",label:"Ir a Google Maps",rounded:""})])])],64))}},KC={},YC={class:"q-pa-md"},JC=T0('<div class="column"><h3>Musica</h3><div class="col-12" style="background-color:purple;height:100px;"></div></div><div class="column" style="height:150px;"><div class="col-4 col-md-6">.col-4 .col-md-6</div><div class="col-4 col-md-6">.col-4 .col-md-6</div><div class="col-4 col-md-6">.col-4 .col-md-6</div></div>',2),QC=[JC];function eA(o,f){return Vn(),Hs("div",YC,QC)}const tA=Q0(KC,[["render",eA]]),iA=T0('<div class="col-12 column" style="padding:1rem;"><p class="text-justify">Vuestra presencia ser\xE1 nuestro mejor regalo. A\xFAn as\xED, si quieres contribuir en nuestra futura vida juntos, os facilitamos el n\xFAmero de cuenta.</p><div class="flex col-12" style="display:flex;justify-content:center;align-items:center;"><p class="text-justify"><strong>ES8801986139751066924632</strong></p></div><p class="text-justify">Tres cosas hay en la vida; salud, dinero y amor. Afortunadamente nos sobran salud y amor.</p></div><p style="color:red;">EL NUMERO DE CUENTA NO ES ESE, CAMBIAR</p>',2),nA={__name:"Regalos",setup(o){return(f,g)=>(Vn(),Hs(xr,null,[Vt(Df,{title:"Regalos"}),iA],64))}};function e1(o,f){return function(){return o.apply(f,arguments)}}const{toString:t1}=Object.prototype,{getPrototypeOf:E_}=Object,S_=(o=>f=>{const g=t1.call(f);return o[g]||(o[g]=g.slice(8,-1).toLowerCase())})(Object.create(null)),cs=o=>(o=o.toLowerCase(),f=>S_(f)===o),Lf=o=>f=>typeof f===o,{isArray:mh}=Array,Zm=Lf("undefined");function rA(o){return o!==null&&!Zm(o)&&o.constructor!==null&&!Zm(o.constructor)&&yc(o.constructor.isBuffer)&&o.constructor.isBuffer(o)}const i1=cs("ArrayBuffer");function oA(o){let f;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?f=ArrayBuffer.isView(o):f=o&&o.buffer&&i1(o.buffer),f}const sA=Lf("string"),yc=Lf("function"),n1=Lf("number"),r1=o=>o!==null&&typeof o=="object",aA=o=>o===!0||o===!1,sf=o=>{if(S_(o)!=="object")return!1;const f=E_(o);return(f===null||f===Object.prototype||Object.getPrototypeOf(f)===null)&&!(Symbol.toStringTag in o)&&!(Symbol.iterator in o)},lA=cs("Date"),cA=cs("File"),uA=cs("Blob"),hA=cs("FileList"),dA=o=>r1(o)&&yc(o.pipe),fA=o=>{const f="[object FormData]";return o&&(typeof FormData=="function"&&o instanceof FormData||t1.call(o)===f||yc(o.toString)&&o.toString()===f)},pA=cs("URLSearchParams"),mA=o=>o.trim?o.trim():o.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Rf(o,f,{allOwnKeys:g=!1}={}){if(o===null||typeof o>"u")return;let v,w;if(typeof o!="object"&&(o=[o]),mh(o))for(v=0,w=o.length;v<w;v++)f.call(null,o[v],v,o);else{const A=g?Object.getOwnPropertyNames(o):Object.keys(o),z=A.length;let s;for(v=0;v<z;v++)s=A[v],f.call(null,o[s],s,o)}}function Wm(){const o={},f=(g,v)=>{sf(o[v])&&sf(g)?o[v]=Wm(o[v],g):sf(g)?o[v]=Wm({},g):mh(g)?o[v]=g.slice():o[v]=g};for(let g=0,v=arguments.length;g<v;g++)arguments[g]&&Rf(arguments[g],f);return o}const _A=(o,f,g,{allOwnKeys:v}={})=>(Rf(f,(w,A)=>{g&&yc(w)?o[A]=e1(w,g):o[A]=w},{allOwnKeys:v}),o),gA=o=>(o.charCodeAt(0)===65279&&(o=o.slice(1)),o),yA=(o,f,g,v)=>{o.prototype=Object.create(f.prototype,v),o.prototype.constructor=o,Object.defineProperty(o,"super",{value:f.prototype}),g&&Object.assign(o.prototype,g)},xA=(o,f,g,v)=>{let w,A,z;const s={};if(f=f||{},o==null)return f;do{for(w=Object.getOwnPropertyNames(o),A=w.length;A-- >0;)z=w[A],(!v||v(z,o,f))&&!s[z]&&(f[z]=o[z],s[z]=!0);o=g!==!1&&E_(o)}while(o&&(!g||g(o,f))&&o!==Object.prototype);return f},vA=(o,f,g)=>{o=String(o),(g===void 0||g>o.length)&&(g=o.length),g-=f.length;const v=o.indexOf(f,g);return v!==-1&&v===g},bA=o=>{if(!o)return null;if(mh(o))return o;let f=o.length;if(!n1(f))return null;const g=new Array(f);for(;f-- >0;)g[f]=o[f];return g},wA=(o=>f=>o&&f instanceof o)(typeof Uint8Array<"u"&&E_(Uint8Array)),TA=(o,f)=>{const v=(o&&o[Symbol.iterator]).call(o);let w;for(;(w=v.next())&&!w.done;){const A=w.value;f.call(o,A[0],A[1])}},EA=(o,f)=>{let g;const v=[];for(;(g=o.exec(f))!==null;)v.push(g);return v},SA=cs("HTMLFormElement"),CA=o=>o.toLowerCase().replace(/[_-\s]([a-z\d])(\w*)/g,function(g,v,w){return v.toUpperCase()+w}),dv=(({hasOwnProperty:o})=>(f,g)=>o.call(f,g))(Object.prototype),AA=cs("RegExp"),o1=(o,f)=>{const g=Object.getOwnPropertyDescriptors(o),v={};Rf(g,(w,A)=>{f(w,A,o)!==!1&&(v[A]=w)}),Object.defineProperties(o,v)},MA=o=>{o1(o,(f,g)=>{const v=o[g];if(!!yc(v)){if(f.enumerable=!1,"writable"in f){f.writable=!1;return}f.set||(f.set=()=>{throw Error("Can not read-only method '"+g+"'")})}})},IA=(o,f)=>{const g={},v=w=>{w.forEach(A=>{g[A]=!0})};return mh(o)?v(o):v(String(o).split(f)),g},zA=()=>{},kA=(o,f)=>(o=+o,Number.isFinite(o)?o:f),at={isArray:mh,isArrayBuffer:i1,isBuffer:rA,isFormData:fA,isArrayBufferView:oA,isString:sA,isNumber:n1,isBoolean:aA,isObject:r1,isPlainObject:sf,isUndefined:Zm,isDate:lA,isFile:cA,isBlob:uA,isRegExp:AA,isFunction:yc,isStream:dA,isURLSearchParams:pA,isTypedArray:wA,isFileList:hA,forEach:Rf,merge:Wm,extend:_A,trim:mA,stripBOM:gA,inherits:yA,toFlatObject:xA,kindOf:S_,kindOfTest:cs,endsWith:vA,toArray:bA,forEachEntry:TA,matchAll:EA,isHTMLForm:SA,hasOwnProperty:dv,hasOwnProp:dv,reduceDescriptors:o1,freezeMethods:MA,toObjectSet:IA,toCamelCase:CA,noop:zA,toFiniteNumber:kA};function Di(o,f,g,v,w){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=o,this.name="AxiosError",f&&(this.code=f),g&&(this.config=g),v&&(this.request=v),w&&(this.response=w)}at.inherits(Di,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const s1=Di.prototype,a1={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(o=>{a1[o]={value:o}});Object.defineProperties(Di,a1);Object.defineProperty(s1,"isAxiosError",{value:!0});Di.from=(o,f,g,v,w,A)=>{const z=Object.create(s1);return at.toFlatObject(o,z,function(B){return B!==Error.prototype},s=>s!=="isAxiosError"),Di.call(z,o.message,f,g,v,w),z.cause=o,z.name=o.name,A&&Object.assign(z,A),z};var PA=typeof self=="object"?self.FormData:window.FormData;function Xm(o){return at.isPlainObject(o)||at.isArray(o)}function l1(o){return at.endsWith(o,"[]")?o.slice(0,-2):o}function fv(o,f,g){return o?o.concat(f).map(function(w,A){return w=l1(w),!g&&A?"["+w+"]":w}).join(g?".":""):f}function DA(o){return at.isArray(o)&&!o.some(Xm)}const LA=at.toFlatObject(at,{},null,function(f){return/^is[A-Z]/.test(f)});function RA(o){return o&&at.isFunction(o.append)&&o[Symbol.toStringTag]==="FormData"&&o[Symbol.iterator]}function Bf(o,f,g){if(!at.isObject(o))throw new TypeError("target must be an object");f=f||new(PA||FormData),g=at.toFlatObject(g,{metaTokens:!0,dots:!1,indexes:!1},!1,function(Te,Be){return!at.isUndefined(Be[Te])});const v=g.metaTokens,w=g.visitor||ee,A=g.dots,z=g.indexes,B=(g.Blob||typeof Blob<"u"&&Blob)&&RA(f);if(!at.isFunction(w))throw new TypeError("visitor must be a function");function Z(Ee){if(Ee===null)return"";if(at.isDate(Ee))return Ee.toISOString();if(!B&&at.isBlob(Ee))throw new Di("Blob is not supported. Use a Buffer instead.");return at.isArrayBuffer(Ee)||at.isTypedArray(Ee)?B&&typeof Blob=="function"?new Blob([Ee]):Buffer.from(Ee):Ee}function ee(Ee,Te,Be){let ot=Ee;if(Ee&&!Be&&typeof Ee=="object"){if(at.endsWith(Te,"{}"))Te=v?Te:Te.slice(0,-2),Ee=JSON.stringify(Ee);else if(at.isArray(Ee)&&DA(Ee)||at.isFileList(Ee)||at.endsWith(Te,"[]")&&(ot=at.toArray(Ee)))return Te=l1(Te),ot.forEach(function(Je,ct){!at.isUndefined(Je)&&f.append(z===!0?fv([Te],ct,A):z===null?Te:Te+"[]",Z(Je))}),!1}return Xm(Ee)?!0:(f.append(fv(Be,Te,A),Z(Ee)),!1)}const G=[],te=Object.assign(LA,{defaultVisitor:ee,convertValue:Z,isVisitable:Xm});function _e(Ee,Te){if(!at.isUndefined(Ee)){if(G.indexOf(Ee)!==-1)throw Error("Circular reference detected in "+Te.join("."));G.push(Ee),at.forEach(Ee,function(ot,Se){(!at.isUndefined(ot)&&w.call(f,ot,at.isString(Se)?Se.trim():Se,Te,te))===!0&&_e(ot,Te?Te.concat(Se):[Se])}),G.pop()}}if(!at.isObject(o))throw new TypeError("data must be an object");return _e(o),f}function pv(o){const f={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(o).replace(/[!'()~]|%20|%00/g,function(v){return f[v]})}function C_(o,f){this._pairs=[],o&&Bf(o,this,f)}const c1=C_.prototype;c1.append=function(f,g){this._pairs.push([f,g])};c1.toString=function(f){const g=f?function(v){return f.call(this,v,pv)}:pv;return this._pairs.map(function(w){return g(w[0])+"="+g(w[1])},"").join("&")};function BA(o){return encodeURIComponent(o).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function u1(o,f,g){if(!f)return o;const v=o.indexOf("#");v!==-1&&(o=o.slice(0,v));const w=g&&g.encode||BA,A=at.isURLSearchParams(f)?f.toString():new C_(f,g).toString(w);return A&&(o+=(o.indexOf("?")===-1?"?":"&")+A),o}class mv{constructor(){this.handlers=[]}use(f,g,v){return this.handlers.push({fulfilled:f,rejected:g,synchronous:v?v.synchronous:!1,runWhen:v?v.runWhen:null}),this.handlers.length-1}eject(f){this.handlers[f]&&(this.handlers[f]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(f){at.forEach(this.handlers,function(v){v!==null&&f(v)})}}const h1={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},FA=typeof URLSearchParams<"u"?URLSearchParams:C_,OA=FormData,UA=(()=>{let o;return typeof navigator<"u"&&((o=navigator.product)==="ReactNative"||o==="NativeScript"||o==="NS")?!1:typeof window<"u"&&typeof document<"u"})(),rs={isBrowser:!0,classes:{URLSearchParams:FA,FormData:OA,Blob},isStandardBrowserEnv:UA,protocols:["http","https","file","blob","url","data"]};function VA(o,f){return Bf(o,new rs.classes.URLSearchParams,Object.assign({visitor:function(g,v,w,A){return rs.isNode&&at.isBuffer(g)?(this.append(v,g.toString("base64")),!1):A.defaultVisitor.apply(this,arguments)}},f))}function NA(o){return at.matchAll(/\w+|\[(\w*)]/g,o).map(f=>f[0]==="[]"?"":f[1]||f[0])}function jA(o){const f={},g=Object.keys(o);let v;const w=g.length;let A;for(v=0;v<w;v++)A=g[v],f[A]=o[A];return f}function d1(o){function f(g,v,w,A){let z=g[A++];const s=Number.isFinite(+z),B=A>=g.length;return z=!z&&at.isArray(w)?w.length:z,B?(at.hasOwnProp(w,z)?w[z]=[w[z],v]:w[z]=v,!s):((!w[z]||!at.isObject(w[z]))&&(w[z]=[]),f(g,v,w[z],A)&&at.isArray(w[z])&&(w[z]=jA(w[z])),!s)}if(at.isFormData(o)&&at.isFunction(o.entries)){const g={};return at.forEachEntry(o,(v,w)=>{f(NA(v),w,g,0)}),g}return null}function $A(o,f,g){const v=g.config.validateStatus;!g.status||!v||v(g.status)?o(g):f(new Di("Request failed with status code "+g.status,[Di.ERR_BAD_REQUEST,Di.ERR_BAD_RESPONSE][Math.floor(g.status/100)-4],g.config,g.request,g))}const qA=rs.isStandardBrowserEnv?function(){return{write:function(g,v,w,A,z,s){const B=[];B.push(g+"="+encodeURIComponent(v)),at.isNumber(w)&&B.push("expires="+new Date(w).toGMTString()),at.isString(A)&&B.push("path="+A),at.isString(z)&&B.push("domain="+z),s===!0&&B.push("secure"),document.cookie=B.join("; ")},read:function(g){const v=document.cookie.match(new RegExp("(^|;\\s*)("+g+")=([^;]*)"));return v?decodeURIComponent(v[3]):null},remove:function(g){this.write(g,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function GA(o){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(o)}function ZA(o,f){return f?o.replace(/\/+$/,"")+"/"+f.replace(/^\/+/,""):o}function f1(o,f){return o&&!GA(f)?ZA(o,f):f}const WA=rs.isStandardBrowserEnv?function(){const f=/(msie|trident)/i.test(navigator.userAgent),g=document.createElement("a");let v;function w(A){let z=A;return f&&(g.setAttribute("href",z),z=g.href),g.setAttribute("href",z),{href:g.href,protocol:g.protocol?g.protocol.replace(/:$/,""):"",host:g.host,search:g.search?g.search.replace(/^\?/,""):"",hash:g.hash?g.hash.replace(/^#/,""):"",hostname:g.hostname,port:g.port,pathname:g.pathname.charAt(0)==="/"?g.pathname:"/"+g.pathname}}return v=w(window.location.href),function(z){const s=at.isString(z)?w(z):z;return s.protocol===v.protocol&&s.host===v.host}}():function(){return function(){return!0}}();function _h(o,f,g){Di.call(this,o==null?"canceled":o,Di.ERR_CANCELED,f,g),this.name="CanceledError"}at.inherits(_h,Di,{__CANCEL__:!0});function XA(o){const f=/^([-+\w]{1,25})(:?\/\/|:)/.exec(o);return f&&f[1]||""}const HA=at.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),KA=o=>{const f={};let g,v,w;return o&&o.split(`
`).forEach(function(z){w=z.indexOf(":"),g=z.substring(0,w).trim().toLowerCase(),v=z.substring(w+1).trim(),!(!g||f[g]&&HA[g])&&(g==="set-cookie"?f[g]?f[g].push(v):f[g]=[v]:f[g]=f[g]?f[g]+", "+v:v)}),f},_v=Symbol("internals"),p1=Symbol("defaults");function ih(o){return o&&String(o).trim().toLowerCase()}function ef(o){return o===!1||o==null?o:String(o)}function YA(o){const f=Object.create(null),g=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let v;for(;v=g.exec(o);)f[v[1]]=v[2];return f}function gv(o,f,g,v){if(at.isFunction(v))return v.call(this,f,g);if(!!at.isString(f)){if(at.isString(v))return f.indexOf(v)!==-1;if(at.isRegExp(v))return v.test(f)}}function JA(o){return o.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(f,g,v)=>g.toUpperCase()+v)}function QA(o,f){const g=at.toCamelCase(" "+f);["get","set","has"].forEach(v=>{Object.defineProperty(o,v+g,{value:function(w,A,z){return this[v].call(this,f,w,A,z)},configurable:!0})})}function Ju(o,f){f=f.toLowerCase();const g=Object.keys(o);let v=g.length,w;for(;v-- >0;)if(w=g[v],f===w.toLowerCase())return w;return null}function Nr(o,f){o&&this.set(o),this[p1]=f||null}Object.assign(Nr.prototype,{set:function(o,f,g){const v=this;function w(A,z,s){const B=ih(z);if(!B)throw new Error("header name must be a non-empty string");const Z=Ju(v,B);Z&&s!==!0&&(v[Z]===!1||s===!1)||(at.isArray(A)?A=A.map(ef):A=ef(A),v[Z||z]=A)}return at.isPlainObject(o)?at.forEach(o,(A,z)=>{w(A,z,f)}):w(f,o,g),this},get:function(o,f){if(o=ih(o),!o)return;const g=Ju(this,o);if(g){const v=this[g];if(!f)return v;if(f===!0)return YA(v);if(at.isFunction(f))return f.call(this,v,g);if(at.isRegExp(f))return f.exec(v);throw new TypeError("parser must be boolean|regexp|function")}},has:function(o,f){if(o=ih(o),o){const g=Ju(this,o);return!!(g&&(!f||gv(this,this[g],g,f)))}return!1},delete:function(o,f){const g=this;let v=!1;function w(A){if(A=ih(A),A){const z=Ju(g,A);z&&(!f||gv(g,g[z],z,f))&&(delete g[z],v=!0)}}return at.isArray(o)?o.forEach(w):w(o),v},clear:function(){return Object.keys(this).forEach(this.delete.bind(this))},normalize:function(o){const f=this,g={};return at.forEach(this,(v,w)=>{const A=Ju(g,w);if(A){f[A]=ef(v),delete f[w];return}const z=o?JA(w):String(w).trim();z!==w&&delete f[w],f[z]=ef(v),g[z]=!0}),this},toJSON:function(){const o=Object.create(null);return at.forEach(Object.assign({},this[p1]||null,this),(f,g)=>{f==null||f===!1||(o[g]=at.isArray(f)?f.join(", "):f)}),o}});Object.assign(Nr,{from:function(o){return at.isString(o)?new this(KA(o)):o instanceof this?o:new this(o)},accessor:function(o){const g=(this[_v]=this[_v]={accessors:{}}).accessors,v=this.prototype;function w(A){const z=ih(A);g[z]||(QA(v,A),g[z]=!0)}return at.isArray(o)?o.forEach(w):w(o),this}});Nr.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent"]);at.freezeMethods(Nr.prototype);at.freezeMethods(Nr);function eM(o,f){o=o||10;const g=new Array(o),v=new Array(o);let w=0,A=0,z;return f=f!==void 0?f:1e3,function(B){const Z=Date.now(),ee=v[A];z||(z=Z),g[w]=B,v[w]=Z;let G=A,te=0;for(;G!==w;)te+=g[G++],G=G%o;if(w=(w+1)%o,w===A&&(A=(A+1)%o),Z-z<f)return;const _e=ee&&Z-ee;return _e?Math.round(te*1e3/_e):void 0}}function yv(o,f){let g=0;const v=eM(50,250);return w=>{const A=w.loaded,z=w.lengthComputable?w.total:void 0,s=A-g,B=v(s),Z=A<=z;g=A;const ee={loaded:A,total:z,progress:z?A/z:void 0,bytes:s,rate:B||void 0,estimated:B&&z&&Z?(z-A)/B:void 0};ee[f?"download":"upload"]=!0,o(ee)}}function xv(o){return new Promise(function(g,v){let w=o.data;const A=Nr.from(o.headers).normalize(),z=o.responseType;let s;function B(){o.cancelToken&&o.cancelToken.unsubscribe(s),o.signal&&o.signal.removeEventListener("abort",s)}at.isFormData(w)&&rs.isStandardBrowserEnv&&A.setContentType(!1);let Z=new XMLHttpRequest;if(o.auth){const _e=o.auth.username||"",Ee=o.auth.password?unescape(encodeURIComponent(o.auth.password)):"";A.set("Authorization","Basic "+btoa(_e+":"+Ee))}const ee=f1(o.baseURL,o.url);Z.open(o.method.toUpperCase(),u1(ee,o.params,o.paramsSerializer),!0),Z.timeout=o.timeout;function G(){if(!Z)return;const _e=Nr.from("getAllResponseHeaders"in Z&&Z.getAllResponseHeaders()),Te={data:!z||z==="text"||z==="json"?Z.responseText:Z.response,status:Z.status,statusText:Z.statusText,headers:_e,config:o,request:Z};$A(function(ot){g(ot),B()},function(ot){v(ot),B()},Te),Z=null}if("onloadend"in Z?Z.onloadend=G:Z.onreadystatechange=function(){!Z||Z.readyState!==4||Z.status===0&&!(Z.responseURL&&Z.responseURL.indexOf("file:")===0)||setTimeout(G)},Z.onabort=function(){!Z||(v(new Di("Request aborted",Di.ECONNABORTED,o,Z)),Z=null)},Z.onerror=function(){v(new Di("Network Error",Di.ERR_NETWORK,o,Z)),Z=null},Z.ontimeout=function(){let Ee=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const Te=o.transitional||h1;o.timeoutErrorMessage&&(Ee=o.timeoutErrorMessage),v(new Di(Ee,Te.clarifyTimeoutError?Di.ETIMEDOUT:Di.ECONNABORTED,o,Z)),Z=null},rs.isStandardBrowserEnv){const _e=(o.withCredentials||WA(ee))&&o.xsrfCookieName&&qA.read(o.xsrfCookieName);_e&&A.set(o.xsrfHeaderName,_e)}w===void 0&&A.setContentType(null),"setRequestHeader"in Z&&at.forEach(A.toJSON(),function(Ee,Te){Z.setRequestHeader(Te,Ee)}),at.isUndefined(o.withCredentials)||(Z.withCredentials=!!o.withCredentials),z&&z!=="json"&&(Z.responseType=o.responseType),typeof o.onDownloadProgress=="function"&&Z.addEventListener("progress",yv(o.onDownloadProgress,!0)),typeof o.onUploadProgress=="function"&&Z.upload&&Z.upload.addEventListener("progress",yv(o.onUploadProgress)),(o.cancelToken||o.signal)&&(s=_e=>{!Z||(v(!_e||_e.type?new _h(null,o,Z):_e),Z.abort(),Z=null)},o.cancelToken&&o.cancelToken.subscribe(s),o.signal&&(o.signal.aborted?s():o.signal.addEventListener("abort",s)));const te=XA(ee);if(te&&rs.protocols.indexOf(te)===-1){v(new Di("Unsupported protocol "+te+":",Di.ERR_BAD_REQUEST,o));return}Z.send(w||null)})}const vv={http:xv,xhr:xv},bv={getAdapter:o=>{if(at.isString(o)){const f=vv[o];if(!o)throw Error(at.hasOwnProp(o)?`Adapter '${o}' is not available in the build`:`Can not resolve adapter '${o}'`);return f}if(!at.isFunction(o))throw new TypeError("adapter is not a function");return o},adapters:vv},tM={"Content-Type":"application/x-www-form-urlencoded"};function iM(){let o;return typeof XMLHttpRequest<"u"?o=bv.getAdapter("xhr"):typeof process<"u"&&at.kindOf(process)==="process"&&(o=bv.getAdapter("http")),o}function nM(o,f,g){if(at.isString(o))try{return(f||JSON.parse)(o),at.trim(o)}catch(v){if(v.name!=="SyntaxError")throw v}return(g||JSON.stringify)(o)}const xc={transitional:h1,adapter:iM(),transformRequest:[function(f,g){const v=g.getContentType()||"",w=v.indexOf("application/json")>-1,A=at.isObject(f);if(A&&at.isHTMLForm(f)&&(f=new FormData(f)),at.isFormData(f))return w&&w?JSON.stringify(d1(f)):f;if(at.isArrayBuffer(f)||at.isBuffer(f)||at.isStream(f)||at.isFile(f)||at.isBlob(f))return f;if(at.isArrayBufferView(f))return f.buffer;if(at.isURLSearchParams(f))return g.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),f.toString();let s;if(A){if(v.indexOf("application/x-www-form-urlencoded")>-1)return VA(f,this.formSerializer).toString();if((s=at.isFileList(f))||v.indexOf("multipart/form-data")>-1){const B=this.env&&this.env.FormData;return Bf(s?{"files[]":f}:f,B&&new B,this.formSerializer)}}return A||w?(g.setContentType("application/json",!1),nM(f)):f}],transformResponse:[function(f){const g=this.transitional||xc.transitional,v=g&&g.forcedJSONParsing,w=this.responseType==="json";if(f&&at.isString(f)&&(v&&!this.responseType||w)){const z=!(g&&g.silentJSONParsing)&&w;try{return JSON.parse(f)}catch(s){if(z)throw s.name==="SyntaxError"?Di.from(s,Di.ERR_BAD_RESPONSE,this,null,this.response):s}}return f}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:rs.classes.FormData,Blob:rs.classes.Blob},validateStatus:function(f){return f>=200&&f<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};at.forEach(["delete","get","head"],function(f){xc.headers[f]={}});at.forEach(["post","put","patch"],function(f){xc.headers[f]=at.merge(tM)});function Tm(o,f){const g=this||xc,v=f||g,w=Nr.from(v.headers);let A=v.data;return at.forEach(o,function(s){A=s.call(g,A,w.normalize(),f?f.status:void 0)}),w.normalize(),A}function m1(o){return!!(o&&o.__CANCEL__)}function Em(o){if(o.cancelToken&&o.cancelToken.throwIfRequested(),o.signal&&o.signal.aborted)throw new _h}function wv(o){return Em(o),o.headers=Nr.from(o.headers),o.data=Tm.call(o,o.transformRequest),(o.adapter||xc.adapter)(o).then(function(v){return Em(o),v.data=Tm.call(o,o.transformResponse,v),v.headers=Nr.from(v.headers),v},function(v){return m1(v)||(Em(o),v&&v.response&&(v.response.data=Tm.call(o,o.transformResponse,v.response),v.response.headers=Nr.from(v.response.headers))),Promise.reject(v)})}function dh(o,f){f=f||{};const g={};function v(Z,ee){return at.isPlainObject(Z)&&at.isPlainObject(ee)?at.merge(Z,ee):at.isPlainObject(ee)?at.merge({},ee):at.isArray(ee)?ee.slice():ee}function w(Z){if(at.isUndefined(f[Z])){if(!at.isUndefined(o[Z]))return v(void 0,o[Z])}else return v(o[Z],f[Z])}function A(Z){if(!at.isUndefined(f[Z]))return v(void 0,f[Z])}function z(Z){if(at.isUndefined(f[Z])){if(!at.isUndefined(o[Z]))return v(void 0,o[Z])}else return v(void 0,f[Z])}function s(Z){if(Z in f)return v(o[Z],f[Z]);if(Z in o)return v(void 0,o[Z])}const B={url:A,method:A,data:A,baseURL:z,transformRequest:z,transformResponse:z,paramsSerializer:z,timeout:z,timeoutMessage:z,withCredentials:z,adapter:z,responseType:z,xsrfCookieName:z,xsrfHeaderName:z,onUploadProgress:z,onDownloadProgress:z,decompress:z,maxContentLength:z,maxBodyLength:z,beforeRedirect:z,transport:z,httpAgent:z,httpsAgent:z,cancelToken:z,socketPath:z,responseEncoding:z,validateStatus:s};return at.forEach(Object.keys(o).concat(Object.keys(f)),function(ee){const G=B[ee]||w,te=G(ee);at.isUndefined(te)&&G!==s||(g[ee]=te)}),g}const _1="1.1.2",A_={};["object","boolean","number","function","string","symbol"].forEach((o,f)=>{A_[o]=function(v){return typeof v===o||"a"+(f<1?"n ":" ")+o}});const Tv={};A_.transitional=function(f,g,v){function w(A,z){return"[Axios v"+_1+"] Transitional option '"+A+"'"+z+(v?". "+v:"")}return(A,z,s)=>{if(f===!1)throw new Di(w(z," has been removed"+(g?" in "+g:"")),Di.ERR_DEPRECATED);return g&&!Tv[z]&&(Tv[z]=!0,console.warn(w(z," has been deprecated since v"+g+" and will be removed in the near future"))),f?f(A,z,s):!0}};function rM(o,f,g){if(typeof o!="object")throw new Di("options must be an object",Di.ERR_BAD_OPTION_VALUE);const v=Object.keys(o);let w=v.length;for(;w-- >0;){const A=v[w],z=f[A];if(z){const s=o[A],B=s===void 0||z(s,A,o);if(B!==!0)throw new Di("option "+A+" must be "+B,Di.ERR_BAD_OPTION_VALUE);continue}if(g!==!0)throw new Di("Unknown option "+A,Di.ERR_BAD_OPTION)}}const g1={assertOptions:rM,validators:A_},oc=g1.validators;class Ka{constructor(f){this.defaults=f,this.interceptors={request:new mv,response:new mv}}request(f,g){typeof f=="string"?(g=g||{},g.url=f):g=f||{},g=dh(this.defaults,g);const v=g.transitional;v!==void 0&&g1.assertOptions(v,{silentJSONParsing:oc.transitional(oc.boolean),forcedJSONParsing:oc.transitional(oc.boolean),clarifyTimeoutError:oc.transitional(oc.boolean)},!1),g.method=(g.method||this.defaults.method||"get").toLowerCase();const w=g.headers&&at.merge(g.headers.common,g.headers[g.method]);w&&at.forEach(["delete","get","head","post","put","patch","common"],function(_e){delete g.headers[_e]}),g.headers=new Nr(g.headers,w);const A=[];let z=!0;this.interceptors.request.forEach(function(_e){typeof _e.runWhen=="function"&&_e.runWhen(g)===!1||(z=z&&_e.synchronous,A.unshift(_e.fulfilled,_e.rejected))});const s=[];this.interceptors.response.forEach(function(_e){s.push(_e.fulfilled,_e.rejected)});let B,Z=0,ee;if(!z){const te=[wv.bind(this),void 0];for(te.unshift.apply(te,A),te.push.apply(te,s),ee=te.length,B=Promise.resolve(g);Z<ee;)B=B.then(te[Z++],te[Z++]);return B}ee=A.length;let G=g;for(Z=0;Z<ee;){const te=A[Z++],_e=A[Z++];try{G=te(G)}catch(Ee){_e.call(this,Ee);break}}try{B=wv.call(this,G)}catch(te){return Promise.reject(te)}for(Z=0,ee=s.length;Z<ee;)B=B.then(s[Z++],s[Z++]);return B}getUri(f){f=dh(this.defaults,f);const g=f1(f.baseURL,f.url);return u1(g,f.params,f.paramsSerializer)}}at.forEach(["delete","get","head","options"],function(f){Ka.prototype[f]=function(g,v){return this.request(dh(v||{},{method:f,url:g,data:(v||{}).data}))}});at.forEach(["post","put","patch"],function(f){function g(v){return function(A,z,s){return this.request(dh(s||{},{method:f,headers:v?{"Content-Type":"multipart/form-data"}:{},url:A,data:z}))}}Ka.prototype[f]=g(),Ka.prototype[f+"Form"]=g(!0)});class M_{constructor(f){if(typeof f!="function")throw new TypeError("executor must be a function.");let g;this.promise=new Promise(function(A){g=A});const v=this;this.promise.then(w=>{if(!v._listeners)return;let A=v._listeners.length;for(;A-- >0;)v._listeners[A](w);v._listeners=null}),this.promise.then=w=>{let A;const z=new Promise(s=>{v.subscribe(s),A=s}).then(w);return z.cancel=function(){v.unsubscribe(A)},z},f(function(A,z,s){v.reason||(v.reason=new _h(A,z,s),g(v.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(f){if(this.reason){f(this.reason);return}this._listeners?this._listeners.push(f):this._listeners=[f]}unsubscribe(f){if(!this._listeners)return;const g=this._listeners.indexOf(f);g!==-1&&this._listeners.splice(g,1)}static source(){let f;return{token:new M_(function(w){f=w}),cancel:f}}}function oM(o){return function(g){return o.apply(null,g)}}function sM(o){return at.isObject(o)&&o.isAxiosError===!0}function y1(o){const f=new Ka(o),g=e1(Ka.prototype.request,f);return at.extend(g,Ka.prototype,f,{allOwnKeys:!0}),at.extend(g,f,null,{allOwnKeys:!0}),g.create=function(w){return y1(dh(o,w))},g}const br=y1(xc);br.Axios=Ka;br.CanceledError=_h;br.CancelToken=M_;br.isCancel=m1;br.VERSION=_1;br.toFormData=Bf;br.AxiosError=Di;br.Cancel=br.CanceledError;br.all=function(f){return Promise.all(f)};br.spread=oM;br.isAxiosError=sM;br.formToJSON=o=>d1(at.isHTMLForm(o)?new FormData(o):o);const aM=()=>br.create({baseURL:"https://bear-express-delta.vercel.app/api/"}),lM=async()=>await aM().get("guest"),cM={class:"column",style:{"z-index":"0"}},uM={href:"https://api.whatsapp.com/send?phone=+34689529238",class:"col-6",style:{"text-decoration":"inherit"}},hM={href:"https://api.whatsapp.com/send?phone=+34665091123",class:"col-6",style:{"text-decoration":"inherit"}},dM={__name:"App",setup(o){const f=ii("Inicio"),g=w=>{f.value=w},v=ii("");return ur(async()=>{v.value=await lM()}),(w,A)=>(Vn(),is(oS,{view:"hHh LpR lFf"},{default:bn(()=>[Vt(GE,{elevated:"",class:"bg-primary text-white"},{default:bn(()=>[Vt($E,{class:"col-12",src:c_(OS),style:{height:"100px"},fit:"fill"},null,8,["src"])]),_:1}),Vt(HE,null,{default:bn(()=>[Vt(XE,{style:{"z-index":"1"},position:"top-left",offset:[10,10]},{default:bn(()=>[Vt(FS,{class:"column",onHandleTabSelected:A[0]||(A[0]=z=>g(z))})]),_:1}),hn("div",cM,[f.value==="Asistencia"?(Vn(),is(hC,{key:0})):Ql("",!0),f.value==="Inicio"?(Vn(),is(OC,{key:1})):Ql("",!0),f.value==="Itinerario"?(Vn(),is(jC,{key:2})):Ql("",!0),f.value==="Lugar"?(Vn(),is(HC,{key:3})):Ql("",!0),f.value==="M\xFAsica"?(Vn(),is(tA,{key:4})):Ql("",!0),f.value==="Regalos"?(Vn(),is(nA,{key:5})):Ql("",!0)])]),_:1}),Vt(YE,{elevated:"",class:"q-pa-md bg-grey-8"},{default:bn(()=>[Vt(KE,{class:"row justify-end"},{default:bn(()=>[hn("a",uM,[Vt(Gx,{avatar:"https://cdn.quasar.dev/img/avatar1.jpg",text:["\xBFDudas?"],sent:""})]),hn("a",hM,[Vt(Gx,{avatar:"https://cdn.quasar.dev/img/avatar2.jpg",text:["\xA1Clicka!"],sent:""})])]),_:1})]),_:1})]),_:1}))}},x1=lE(dM);x1.use(RE,{plugins:{}});x1.mount("#app");

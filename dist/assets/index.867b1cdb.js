(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const x of document.querySelectorAll('link[rel="modulepreload"]'))y(x);new MutationObserver(x=>{for(const T of x)if(T.type==="childList")for(const A of T.addedNodes)A.tagName==="LINK"&&A.rel==="modulepreload"&&y(A)}).observe(document,{childList:!0,subtree:!0});function p(x){const T={};return x.integrity&&(T.integrity=x.integrity),x.referrerpolicy&&(T.referrerPolicy=x.referrerpolicy),x.crossorigin==="use-credentials"?T.credentials="include":x.crossorigin==="anonymous"?T.credentials="omit":T.credentials="same-origin",T}function y(x){if(x.ep)return;x.ep=!0;const T=p(x);fetch(x.href,T)}})();function Z_(r,u){const p=Object.create(null),y=r.split(",");for(let x=0;x<y.length;x++)p[y[x]]=!0;return u?x=>!!p[x.toLowerCase()]:x=>!!p[x]}const G2="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Z2=Z_(G2);function J0(r){return!!r||r===""}function W_(r){if(xi(r)){const u={};for(let p=0;p<r.length;p++){const y=r[p],x=$n(y)?X2(y):W_(y);if(x)for(const T in x)u[T]=x[T]}return u}else{if($n(r))return r;if(wn(r))return r}}const W2=/;(?![^(]*\))/g,H2=/:(.+)/;function X2(r){const u={};return r.split(W2).forEach(p=>{if(p){const y=p.split(H2);y.length>1&&(u[y[0].trim()]=y[1].trim())}}),u}function H_(r){let u="";if($n(r))u=r;else if(xi(r))for(let p=0;p<r.length;p++){const y=H_(r[p]);y&&(u+=y+" ")}else if(wn(r))for(const p in r)r[p]&&(u+=p+" ");return u.trim()}const ia=r=>$n(r)?r:r==null?"":xi(r)||wn(r)&&(r.toString===i1||!Si(r.toString))?JSON.stringify(r,Q0,2):String(r),Q0=(r,u)=>u&&u.__v_isRef?Q0(r,u.value):Ec(u)?{[`Map(${u.size})`]:[...u.entries()].reduce((p,[y,x])=>(p[`${y} =>`]=x,p),{})}:e1(u)?{[`Set(${u.size})`]:[...u.values()]}:wn(u)&&!xi(u)&&!n1(u)?String(u):u,un={},Tc=[],To=()=>{},K2=()=>!1,Y2=/^on[^a-z]/,hp=r=>Y2.test(r),X_=r=>r.startsWith("onUpdate:"),Yn=Object.assign,K_=(r,u)=>{const p=r.indexOf(u);p>-1&&r.splice(p,1)},J2=Object.prototype.hasOwnProperty,Ni=(r,u)=>J2.call(r,u),xi=Array.isArray,Ec=r=>dp(r)==="[object Map]",e1=r=>dp(r)==="[object Set]",Si=r=>typeof r=="function",$n=r=>typeof r=="string",Y_=r=>typeof r=="symbol",wn=r=>r!==null&&typeof r=="object",t1=r=>wn(r)&&Si(r.then)&&Si(r.catch),i1=Object.prototype.toString,dp=r=>i1.call(r),Q2=r=>dp(r).slice(8,-1),n1=r=>dp(r)==="[object Object]",J_=r=>$n(r)&&r!=="NaN"&&r[0]!=="-"&&""+parseInt(r,10)===r,Nf=Z_(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),fp=r=>{const u=Object.create(null);return p=>u[p]||(u[p]=r(p))},eE=/-(\w)/g,Ic=fp(r=>r.replace(eE,(u,p)=>p?p.toUpperCase():"")),tE=/\B([A-Z])/g,Lc=fp(r=>r.replace(tE,"-$1").toLowerCase()),r1=fp(r=>r.charAt(0).toUpperCase()+r.slice(1)),r_=fp(r=>r?`on${r1(r)}`:""),Bh=(r,u)=>!Object.is(r,u),kh=(r,u)=>{for(let p=0;p<r.length;p++)r[p](u)},Xf=(r,u,p)=>{Object.defineProperty(r,u,{configurable:!0,enumerable:!1,value:p})},o1=r=>{const u=parseFloat(r);return isNaN(u)?r:u};let dx;const iE=()=>dx||(dx=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});let Go;class nE{constructor(u=!1){this.active=!0,this.effects=[],this.cleanups=[],!u&&Go&&(this.parent=Go,this.index=(Go.scopes||(Go.scopes=[])).push(this)-1)}run(u){if(this.active){const p=Go;try{return Go=this,u()}finally{Go=p}}}on(){Go=this}off(){Go=this.parent}stop(u){if(this.active){let p,y;for(p=0,y=this.effects.length;p<y;p++)this.effects[p].stop();for(p=0,y=this.cleanups.length;p<y;p++)this.cleanups[p]();if(this.scopes)for(p=0,y=this.scopes.length;p<y;p++)this.scopes[p].stop(!0);if(this.parent&&!u){const x=this.parent.scopes.pop();x&&x!==this&&(this.parent.scopes[this.index]=x,x.index=this.index)}this.active=!1}}}function rE(r,u=Go){u&&u.active&&u.effects.push(r)}const Q_=r=>{const u=new Set(r);return u.w=0,u.n=0,u},s1=r=>(r.w&ca)>0,a1=r=>(r.n&ca)>0,oE=({deps:r})=>{if(r.length)for(let u=0;u<r.length;u++)r[u].w|=ca},sE=r=>{const{deps:u}=r;if(u.length){let p=0;for(let y=0;y<u.length;y++){const x=u[y];s1(x)&&!a1(x)?x.delete(r):u[p++]=x,x.w&=~ca,x.n&=~ca}u.length=p}},T_=new WeakMap;let Sh=0,ca=1;const E_=30;let vo;const dl=Symbol(""),S_=Symbol("");class eg{constructor(u,p=null,y){this.fn=u,this.scheduler=p,this.active=!0,this.deps=[],this.parent=void 0,rE(this,y)}run(){if(!this.active)return this.fn();let u=vo,p=aa;for(;u;){if(u===this)return;u=u.parent}try{return this.parent=vo,vo=this,aa=!0,ca=1<<++Sh,Sh<=E_?oE(this):fx(this),this.fn()}finally{Sh<=E_&&sE(this),ca=1<<--Sh,vo=this.parent,aa=p,this.parent=void 0,this.deferStop&&this.stop()}}stop(){vo===this?this.deferStop=!0:this.active&&(fx(this),this.onStop&&this.onStop(),this.active=!1)}}function fx(r){const{deps:u}=r;if(u.length){for(let p=0;p<u.length;p++)u[p].delete(r);u.length=0}}let aa=!0;const l1=[];function Bc(){l1.push(aa),aa=!1}function Rc(){const r=l1.pop();aa=r===void 0?!0:r}function jr(r,u,p){if(aa&&vo){let y=T_.get(r);y||T_.set(r,y=new Map);let x=y.get(p);x||y.set(p,x=Q_()),c1(x)}}function c1(r,u){let p=!1;Sh<=E_?a1(r)||(r.n|=ca,p=!s1(r)):p=!r.has(vo),p&&(r.add(vo),vo.deps.push(r))}function vs(r,u,p,y,x,T){const A=T_.get(r);if(!A)return;let s=[];if(u==="clear")s=[...A.values()];else if(p==="length"&&xi(r))A.forEach((D,O)=>{(O==="length"||O>=y)&&s.push(D)});else switch(p!==void 0&&s.push(A.get(p)),u){case"add":xi(r)?J_(p)&&s.push(A.get("length")):(s.push(A.get(dl)),Ec(r)&&s.push(A.get(S_)));break;case"delete":xi(r)||(s.push(A.get(dl)),Ec(r)&&s.push(A.get(S_)));break;case"set":Ec(r)&&s.push(A.get(dl));break}if(s.length===1)s[0]&&C_(s[0]);else{const D=[];for(const O of s)O&&D.push(...O);C_(Q_(D))}}function C_(r,u){const p=xi(r)?r:[...r];for(const y of p)y.computed&&px(y);for(const y of p)y.computed||px(y)}function px(r,u){(r!==vo||r.allowRecurse)&&(r.scheduler?r.scheduler():r.run())}const aE=Z_("__proto__,__v_isRef,__isVue"),u1=new Set(Object.getOwnPropertyNames(Symbol).filter(r=>r!=="arguments"&&r!=="caller").map(r=>Symbol[r]).filter(Y_)),lE=tg(),cE=tg(!1,!0),uE=tg(!0),mx=hE();function hE(){const r={};return["includes","indexOf","lastIndexOf"].forEach(u=>{r[u]=function(...p){const y=zi(this);for(let T=0,A=this.length;T<A;T++)jr(y,"get",T+"");const x=y[u](...p);return x===-1||x===!1?y[u](...p.map(zi)):x}}),["push","pop","shift","unshift","splice"].forEach(u=>{r[u]=function(...p){Bc();const y=zi(this)[u].apply(this,p);return Rc(),y}}),r}function tg(r=!1,u=!1){return function(y,x,T){if(x==="__v_isReactive")return!r;if(x==="__v_isReadonly")return r;if(x==="__v_isShallow")return u;if(x==="__v_raw"&&T===(r?u?AE:m1:u?p1:f1).get(y))return y;const A=xi(y);if(!r&&A&&Ni(mx,x))return Reflect.get(mx,x,T);const s=Reflect.get(y,x,T);return(Y_(x)?u1.has(x):aE(x))||(r||jr(y,"get",x),u)?s:_r(s)?A&&J_(x)?s:s.value:wn(s)?r?_1(s):xo(s):s}}const dE=h1(),fE=h1(!0);function h1(r=!1){return function(p,y,x,T){let A=p[y];if(kc(A)&&_r(A)&&!_r(x))return!1;if(!r&&(!Kf(x)&&!kc(x)&&(A=zi(A),x=zi(x)),!xi(p)&&_r(A)&&!_r(x)))return A.value=x,!0;const s=xi(p)&&J_(y)?Number(y)<p.length:Ni(p,y),D=Reflect.set(p,y,x,T);return p===zi(T)&&(s?Bh(x,A)&&vs(p,"set",y,x):vs(p,"add",y,x)),D}}function pE(r,u){const p=Ni(r,u);r[u];const y=Reflect.deleteProperty(r,u);return y&&p&&vs(r,"delete",u,void 0),y}function mE(r,u){const p=Reflect.has(r,u);return(!Y_(u)||!u1.has(u))&&jr(r,"has",u),p}function _E(r){return jr(r,"iterate",xi(r)?"length":dl),Reflect.ownKeys(r)}const d1={get:lE,set:dE,deleteProperty:pE,has:mE,ownKeys:_E},gE={get:uE,set(r,u){return!0},deleteProperty(r,u){return!0}},yE=Yn({},d1,{get:cE,set:fE}),ig=r=>r,pp=r=>Reflect.getPrototypeOf(r);function Af(r,u,p=!1,y=!1){r=r.__v_raw;const x=zi(r),T=zi(u);p||(u!==T&&jr(x,"get",u),jr(x,"get",T));const{has:A}=pp(x),s=y?ig:p?og:Rh;if(A.call(x,u))return s(r.get(u));if(A.call(x,T))return s(r.get(T));r!==x&&r.get(u)}function Mf(r,u=!1){const p=this.__v_raw,y=zi(p),x=zi(r);return u||(r!==x&&jr(y,"has",r),jr(y,"has",x)),r===x?p.has(r):p.has(r)||p.has(x)}function If(r,u=!1){return r=r.__v_raw,!u&&jr(zi(r),"iterate",dl),Reflect.get(r,"size",r)}function _x(r){r=zi(r);const u=zi(this);return pp(u).has.call(u,r)||(u.add(r),vs(u,"add",r,r)),this}function gx(r,u){u=zi(u);const p=zi(this),{has:y,get:x}=pp(p);let T=y.call(p,r);T||(r=zi(r),T=y.call(p,r));const A=x.call(p,r);return p.set(r,u),T?Bh(u,A)&&vs(p,"set",r,u):vs(p,"add",r,u),this}function yx(r){const u=zi(this),{has:p,get:y}=pp(u);let x=p.call(u,r);x||(r=zi(r),x=p.call(u,r)),y&&y.call(u,r);const T=u.delete(r);return x&&vs(u,"delete",r,void 0),T}function vx(){const r=zi(this),u=r.size!==0,p=r.clear();return u&&vs(r,"clear",void 0,void 0),p}function kf(r,u){return function(y,x){const T=this,A=T.__v_raw,s=zi(A),D=u?ig:r?og:Rh;return!r&&jr(s,"iterate",dl),A.forEach((O,F)=>y.call(x,D(O),D(F),T))}}function zf(r,u,p){return function(...y){const x=this.__v_raw,T=zi(x),A=Ec(T),s=r==="entries"||r===Symbol.iterator&&A,D=r==="keys"&&A,O=x[r](...y),F=p?ig:u?og:Rh;return!u&&jr(T,"iterate",D?S_:dl),{next(){const{value:N,done:q}=O.next();return q?{value:N,done:q}:{value:s?[F(N[0]),F(N[1])]:F(N),done:q}},[Symbol.iterator](){return this}}}}function Qs(r){return function(...u){return r==="delete"?!1:this}}function vE(){const r={get(T){return Af(this,T)},get size(){return If(this)},has:Mf,add:_x,set:gx,delete:yx,clear:vx,forEach:kf(!1,!1)},u={get(T){return Af(this,T,!1,!0)},get size(){return If(this)},has:Mf,add:_x,set:gx,delete:yx,clear:vx,forEach:kf(!1,!0)},p={get(T){return Af(this,T,!0)},get size(){return If(this,!0)},has(T){return Mf.call(this,T,!0)},add:Qs("add"),set:Qs("set"),delete:Qs("delete"),clear:Qs("clear"),forEach:kf(!0,!1)},y={get(T){return Af(this,T,!0,!0)},get size(){return If(this,!0)},has(T){return Mf.call(this,T,!0)},add:Qs("add"),set:Qs("set"),delete:Qs("delete"),clear:Qs("clear"),forEach:kf(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(T=>{r[T]=zf(T,!1,!1),p[T]=zf(T,!0,!1),u[T]=zf(T,!1,!0),y[T]=zf(T,!0,!0)}),[r,p,u,y]}const[xE,bE,wE,TE]=vE();function ng(r,u){const p=u?r?TE:wE:r?bE:xE;return(y,x,T)=>x==="__v_isReactive"?!r:x==="__v_isReadonly"?r:x==="__v_raw"?y:Reflect.get(Ni(p,x)&&x in y?p:y,x,T)}const EE={get:ng(!1,!1)},SE={get:ng(!1,!0)},CE={get:ng(!0,!1)},f1=new WeakMap,p1=new WeakMap,m1=new WeakMap,AE=new WeakMap;function ME(r){switch(r){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function IE(r){return r.__v_skip||!Object.isExtensible(r)?0:ME(Q2(r))}function xo(r){return kc(r)?r:rg(r,!1,d1,EE,f1)}function kE(r){return rg(r,!1,yE,SE,p1)}function _1(r){return rg(r,!0,gE,CE,m1)}function rg(r,u,p,y,x){if(!wn(r)||r.__v_raw&&!(u&&r.__v_isReactive))return r;const T=x.get(r);if(T)return T;const A=IE(r);if(A===0)return r;const s=new Proxy(r,A===2?y:p);return x.set(r,s),s}function Sc(r){return kc(r)?Sc(r.__v_raw):!!(r&&r.__v_isReactive)}function kc(r){return!!(r&&r.__v_isReadonly)}function Kf(r){return!!(r&&r.__v_isShallow)}function g1(r){return Sc(r)||kc(r)}function zi(r){const u=r&&r.__v_raw;return u?zi(u):r}function Wh(r){return Xf(r,"__v_skip",!0),r}const Rh=r=>wn(r)?xo(r):r,og=r=>wn(r)?_1(r):r;function y1(r){aa&&vo&&(r=zi(r),c1(r.dep||(r.dep=Q_())))}function v1(r,u){r=zi(r),r.dep&&C_(r.dep)}function _r(r){return!!(r&&r.__v_isRef===!0)}function Ot(r){return zE(r,!1)}function zE(r,u){return _r(r)?r:new PE(r,u)}class PE{constructor(u,p){this.__v_isShallow=p,this.dep=void 0,this.__v_isRef=!0,this._rawValue=p?u:zi(u),this._value=p?u:Rh(u)}get value(){return y1(this),this._value}set value(u){const p=this.__v_isShallow||Kf(u)||kc(u);u=p?u:zi(u),Bh(u,this._rawValue)&&(this._rawValue=u,this._value=p?u:Rh(u),v1(this))}}function sg(r){return _r(r)?r.value:r}const DE={get:(r,u,p)=>sg(Reflect.get(r,u,p)),set:(r,u,p,y)=>{const x=r[u];return _r(x)&&!_r(p)?(x.value=p,!0):Reflect.set(r,u,p,y)}};function x1(r){return Sc(r)?r:new Proxy(r,DE)}var b1;class LE{constructor(u,p,y,x){this._setter=p,this.dep=void 0,this.__v_isRef=!0,this[b1]=!1,this._dirty=!0,this.effect=new eg(u,()=>{this._dirty||(this._dirty=!0,v1(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!x,this.__v_isReadonly=y}get value(){const u=zi(this);return y1(u),(u._dirty||!u._cacheable)&&(u._dirty=!1,u._value=u.effect.run()),u._value}set value(u){this._setter(u)}}b1="__v_isReadonly";function BE(r,u,p=!1){let y,x;const T=Si(r);return T?(y=r,x=To):(y=r.get,x=r.set),new LE(y,x,T||!x,p)}function la(r,u,p,y){let x;try{x=y?r(...y):r()}catch(T){mp(T,u,p)}return x}function eo(r,u,p,y){if(Si(r)){const T=la(r,u,p,y);return T&&t1(T)&&T.catch(A=>{mp(A,u,p)}),T}const x=[];for(let T=0;T<r.length;T++)x.push(eo(r[T],u,p,y));return x}function mp(r,u,p,y=!0){const x=u?u.vnode:null;if(u){let T=u.parent;const A=u.proxy,s=p;for(;T;){const O=T.ec;if(O){for(let F=0;F<O.length;F++)if(O[F](r,A,s)===!1)return}T=T.parent}const D=u.appContext.config.errorHandler;if(D){la(D,null,10,[r,A,s]);return}}RE(r,p,x,y)}function RE(r,u,p,y=!0){console.error(r)}let Oh=!1,A_=!1;const mr=[];let Ho=0;const Cc=[];let gs=null,sl=0;const w1=Promise.resolve();let ag=null;function fn(r){const u=ag||w1;return r?u.then(this?r.bind(this):r):u}function OE(r){let u=Ho+1,p=mr.length;for(;u<p;){const y=u+p>>>1;Fh(mr[y])<r?u=y+1:p=y}return u}function lg(r){(!mr.length||!mr.includes(r,Oh&&r.allowRecurse?Ho+1:Ho))&&(r.id==null?mr.push(r):mr.splice(OE(r.id),0,r),T1())}function T1(){!Oh&&!A_&&(A_=!0,ag=w1.then(S1))}function FE(r){const u=mr.indexOf(r);u>Ho&&mr.splice(u,1)}function VE(r){xi(r)?Cc.push(...r):(!gs||!gs.includes(r,r.allowRecurse?sl+1:sl))&&Cc.push(r),T1()}function xx(r,u=Oh?Ho+1:0){for(;u<mr.length;u++){const p=mr[u];p&&p.pre&&(mr.splice(u,1),u--,p())}}function E1(r){if(Cc.length){const u=[...new Set(Cc)];if(Cc.length=0,gs){gs.push(...u);return}for(gs=u,gs.sort((p,y)=>Fh(p)-Fh(y)),sl=0;sl<gs.length;sl++)gs[sl]();gs=null,sl=0}}const Fh=r=>r.id==null?1/0:r.id,UE=(r,u)=>{const p=Fh(r)-Fh(u);if(p===0){if(r.pre&&!u.pre)return-1;if(u.pre&&!r.pre)return 1}return p};function S1(r){A_=!1,Oh=!0,mr.sort(UE);const u=To;try{for(Ho=0;Ho<mr.length;Ho++){const p=mr[Ho];p&&p.active!==!1&&la(p,null,14)}}finally{Ho=0,mr.length=0,E1(),Oh=!1,ag=null,(mr.length||Cc.length)&&S1()}}function NE(r,u,...p){if(r.isUnmounted)return;const y=r.vnode.props||un;let x=p;const T=u.startsWith("update:"),A=T&&u.slice(7);if(A&&A in y){const F=`${A==="modelValue"?"model":A}Modifiers`,{number:N,trim:q}=y[F]||un;q&&(x=p.map(Z=>Z.trim())),N&&(x=p.map(o1))}let s,D=y[s=r_(u)]||y[s=r_(Ic(u))];!D&&T&&(D=y[s=r_(Lc(u))]),D&&eo(D,r,6,x);const O=y[s+"Once"];if(O){if(!r.emitted)r.emitted={};else if(r.emitted[s])return;r.emitted[s]=!0,eo(O,r,6,x)}}function C1(r,u,p=!1){const y=u.emitsCache,x=y.get(r);if(x!==void 0)return x;const T=r.emits;let A={},s=!1;if(!Si(r)){const D=O=>{const F=C1(O,u,!0);F&&(s=!0,Yn(A,F))};!p&&u.mixins.length&&u.mixins.forEach(D),r.extends&&D(r.extends),r.mixins&&r.mixins.forEach(D)}return!T&&!s?(wn(r)&&y.set(r,null),null):(xi(T)?T.forEach(D=>A[D]=null):Yn(A,T),wn(r)&&y.set(r,A),A)}function _p(r,u){return!r||!hp(u)?!1:(u=u.slice(2).replace(/Once$/,""),Ni(r,u[0].toLowerCase()+u.slice(1))||Ni(r,Lc(u))||Ni(r,u))}let bo=null,A1=null;function Yf(r){const u=bo;return bo=r,A1=r&&r.type.__scopeId||null,u}function Qi(r,u=bo,p){if(!u||r._n)return r;const y=(...x)=>{y._d&&zx(-1);const T=Yf(u),A=r(...x);return Yf(T),y._d&&zx(1),A};return y._n=!0,y._c=!0,y._d=!0,y}function o_(r){const{type:u,vnode:p,proxy:y,withProxy:x,props:T,propsOptions:[A],slots:s,attrs:D,emit:O,render:F,renderCache:N,data:q,setupState:Z,ctx:ae,inheritAttrs:le}=r;let xe,He;const Ee=Yf(r);try{if(p.shapeFlag&4){const Ne=x||y;xe=Zo(F.call(Ne,Ne,N,T,Z,q,ae)),He=D}else{const Ne=u;xe=Zo(Ne.length>1?Ne(T,{attrs:D,slots:s,emit:O}):Ne(T,null)),He=u.props?D:jE(D)}}catch(Ne){Dh.length=0,mp(Ne,r,1),xe=Lt(So)}let Le=xe;if(He&&le!==!1){const Ne=Object.keys(He),{shapeFlag:Se}=Le;Ne.length&&Se&7&&(A&&Ne.some(X_)&&(He=qE(He,A)),Le=xs(Le,He))}return p.dirs&&(Le=xs(Le),Le.dirs=Le.dirs?Le.dirs.concat(p.dirs):p.dirs),p.transition&&(Le.transition=p.transition),xe=Le,Yf(Ee),xe}const jE=r=>{let u;for(const p in r)(p==="class"||p==="style"||hp(p))&&((u||(u={}))[p]=r[p]);return u},qE=(r,u)=>{const p={};for(const y in r)(!X_(y)||!(y.slice(9)in u))&&(p[y]=r[y]);return p};function $E(r,u,p){const{props:y,children:x,component:T}=r,{props:A,children:s,patchFlag:D}=u,O=T.emitsOptions;if(u.dirs||u.transition)return!0;if(p&&D>=0){if(D&1024)return!0;if(D&16)return y?bx(y,A,O):!!A;if(D&8){const F=u.dynamicProps;for(let N=0;N<F.length;N++){const q=F[N];if(A[q]!==y[q]&&!_p(O,q))return!0}}}else return(x||s)&&(!s||!s.$stable)?!0:y===A?!1:y?A?bx(y,A,O):!0:!!A;return!1}function bx(r,u,p){const y=Object.keys(u);if(y.length!==Object.keys(r).length)return!0;for(let x=0;x<y.length;x++){const T=y[x];if(u[T]!==r[T]&&!_p(p,T))return!0}return!1}function GE({vnode:r,parent:u},p){for(;u&&u.subTree===r;)(r=u.vnode).el=p,u=u.parent}const M1=r=>r.__isSuspense;function ZE(r,u){u&&u.pendingBranch?xi(r)?u.effects.push(...r):u.effects.push(r):VE(r)}function Oc(r,u){if(sr){let p=sr.provides;const y=sr.parent&&sr.parent.provides;y===p&&(p=sr.provides=Object.create(y)),p[r]=u}}function Eo(r,u,p=!1){const y=sr||bo;if(y){const x=y.parent==null?y.vnode.appContext&&y.vnode.appContext.provides:y.parent.provides;if(x&&r in x)return x[r];if(arguments.length>1)return p&&Si(u)?u.call(y.proxy):u}}const wx={};function ri(r,u,p){return I1(r,u,p)}function I1(r,u,{immediate:p,deep:y,flush:x,onTrack:T,onTrigger:A}=un){const s=sr;let D,O=!1,F=!1;if(_r(r)?(D=()=>r.value,O=Kf(r)):Sc(r)?(D=()=>r,y=!0):xi(r)?(F=!0,O=r.some(He=>Sc(He)||Kf(He)),D=()=>r.map(He=>{if(_r(He))return He.value;if(Sc(He))return cl(He);if(Si(He))return la(He,s,2)})):Si(r)?u?D=()=>la(r,s,2):D=()=>{if(!(s&&s.isUnmounted))return N&&N(),eo(r,s,3,[q])}:D=To,u&&y){const He=D;D=()=>cl(He())}let N,q=He=>{N=xe.onStop=()=>{la(He,s,4)}};if(Nh)return q=To,u?p&&eo(u,s,3,[D(),F?[]:void 0,q]):D(),To;let Z=F?[]:wx;const ae=()=>{if(!!xe.active)if(u){const He=xe.run();(y||O||(F?He.some((Ee,Le)=>Bh(Ee,Z[Le])):Bh(He,Z)))&&(N&&N(),eo(u,s,3,[He,Z===wx?void 0:Z,q]),Z=He)}else xe.run()};ae.allowRecurse=!!u;let le;x==="sync"?le=ae:x==="post"?le=()=>rr(ae,s&&s.suspense):(ae.pre=!0,s&&(ae.id=s.uid),le=()=>lg(ae));const xe=new eg(D,le);return u?p?ae():Z=xe.run():x==="post"?rr(xe.run.bind(xe),s&&s.suspense):xe.run(),()=>{xe.stop(),s&&s.scope&&K_(s.scope.effects,xe)}}function WE(r,u,p){const y=this.proxy,x=$n(r)?r.includes(".")?k1(y,r):()=>y[r]:r.bind(y,y);let T;Si(u)?T=u:(T=u.handler,p=u);const A=sr;Pc(this);const s=I1(x,T.bind(y),p);return A?Pc(A):fl(),s}function k1(r,u){const p=u.split(".");return()=>{let y=r;for(let x=0;x<p.length&&y;x++)y=y[p[x]];return y}}function cl(r,u){if(!wn(r)||r.__v_skip||(u=u||new Set,u.has(r)))return r;if(u.add(r),_r(r))cl(r.value,u);else if(xi(r))for(let p=0;p<r.length;p++)cl(r[p],u);else if(e1(r)||Ec(r))r.forEach(p=>{cl(p,u)});else if(n1(r))for(const p in r)cl(r[p],u);return r}function z1(){const r={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return ar(()=>{r.isMounted=!0}),_n(()=>{r.isUnmounting=!0}),r}const Xr=[Function,Array],HE={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Xr,onEnter:Xr,onAfterEnter:Xr,onEnterCancelled:Xr,onBeforeLeave:Xr,onLeave:Xr,onAfterLeave:Xr,onLeaveCancelled:Xr,onBeforeAppear:Xr,onAppear:Xr,onAfterAppear:Xr,onAppearCancelled:Xr},setup(r,{slots:u}){const p=Pi(),y=z1();let x;return()=>{const T=u.default&&cg(u.default(),!0);if(!T||!T.length)return;let A=T[0];if(T.length>1){for(const le of T)if(le.type!==So){A=le;break}}const s=zi(r),{mode:D}=s;if(y.isLeaving)return s_(A);const O=Tx(A);if(!O)return s_(A);const F=Vh(O,s,y,p);zc(O,F);const N=p.subTree,q=N&&Tx(N);let Z=!1;const{getTransitionKey:ae}=O.type;if(ae){const le=ae();x===void 0?x=le:le!==x&&(x=le,Z=!0)}if(q&&q.type!==So&&(!al(O,q)||Z)){const le=Vh(q,s,y,p);if(zc(q,le),D==="out-in")return y.isLeaving=!0,le.afterLeave=()=>{y.isLeaving=!1,p.update()},s_(A);D==="in-out"&&O.type!==So&&(le.delayLeave=(xe,He,Ee)=>{const Le=D1(y,q);Le[String(q.key)]=q,xe._leaveCb=()=>{He(),xe._leaveCb=void 0,delete F.delayedLeave},F.delayedLeave=Ee})}return A}}},P1=HE;function D1(r,u){const{leavingVNodes:p}=r;let y=p.get(u.type);return y||(y=Object.create(null),p.set(u.type,y)),y}function Vh(r,u,p,y){const{appear:x,mode:T,persisted:A=!1,onBeforeEnter:s,onEnter:D,onAfterEnter:O,onEnterCancelled:F,onBeforeLeave:N,onLeave:q,onAfterLeave:Z,onLeaveCancelled:ae,onBeforeAppear:le,onAppear:xe,onAfterAppear:He,onAppearCancelled:Ee}=u,Le=String(r.key),Ne=D1(p,r),Se=(De,Ke)=>{De&&eo(De,y,9,Ke)},Pe=(De,Ke)=>{const Ue=Ke[1];Se(De,Ke),xi(De)?De.every(nt=>nt.length<=1)&&Ue():De.length<=1&&Ue()},we={mode:T,persisted:A,beforeEnter(De){let Ke=s;if(!p.isMounted)if(x)Ke=le||s;else return;De._leaveCb&&De._leaveCb(!0);const Ue=Ne[Le];Ue&&al(r,Ue)&&Ue.el._leaveCb&&Ue.el._leaveCb(),Se(Ke,[De])},enter(De){let Ke=D,Ue=O,nt=F;if(!p.isMounted)if(x)Ke=xe||D,Ue=He||O,nt=Ee||F;else return;let $e=!1;const Ge=De._enterCb=Ye=>{$e||($e=!0,Ye?Se(nt,[De]):Se(Ue,[De]),we.delayedLeave&&we.delayedLeave(),De._enterCb=void 0)};Ke?Pe(Ke,[De,Ge]):Ge()},leave(De,Ke){const Ue=String(r.key);if(De._enterCb&&De._enterCb(!0),p.isUnmounting)return Ke();Se(N,[De]);let nt=!1;const $e=De._leaveCb=Ge=>{nt||(nt=!0,Ke(),Ge?Se(ae,[De]):Se(Z,[De]),De._leaveCb=void 0,Ne[Ue]===r&&delete Ne[Ue])};Ne[Ue]=r,q?Pe(q,[De,$e]):$e()},clone(De){return Vh(De,u,p,y)}};return we}function s_(r){if(gp(r))return r=xs(r),r.children=null,r}function Tx(r){return gp(r)?r.children?r.children[0]:void 0:r}function zc(r,u){r.shapeFlag&6&&r.component?zc(r.component.subTree,u):r.shapeFlag&128?(r.ssContent.transition=u.clone(r.ssContent),r.ssFallback.transition=u.clone(r.ssFallback)):r.transition=u}function cg(r,u=!1,p){let y=[],x=0;for(let T=0;T<r.length;T++){let A=r[T];const s=p==null?A.key:String(p)+String(A.key!=null?A.key:T);A.type===or?(A.patchFlag&128&&x++,y=y.concat(cg(A.children,u,s))):(u||A.type!==So)&&y.push(s!=null?xs(A,{key:s}):A)}if(x>1)for(let T=0;T<y.length;T++)y[T].patchFlag=-2;return y}function XE(r){return Si(r)?{setup:r,name:r.name}:r}const zh=r=>!!r.type.__asyncLoader,gp=r=>r.type.__isKeepAlive,KE={name:"KeepAlive",__isKeepAlive:!0,props:{include:[String,RegExp,Array],exclude:[String,RegExp,Array],max:[String,Number]},setup(r,{slots:u}){const p=Pi(),y=p.ctx;if(!y.renderer)return()=>{const Ee=u.default&&u.default();return Ee&&Ee.length===1?Ee[0]:Ee};const x=new Map,T=new Set;let A=null;const s=p.suspense,{renderer:{p:D,m:O,um:F,o:{createElement:N}}}=y,q=N("div");y.activate=(Ee,Le,Ne,Se,Pe)=>{const we=Ee.component;O(Ee,Le,Ne,0,s),D(we.vnode,Ee,Le,Ne,we,s,Se,Ee.slotScopeIds,Pe),rr(()=>{we.isDeactivated=!1,we.a&&kh(we.a);const De=Ee.props&&Ee.props.onVnodeMounted;De&&Yr(De,we.parent,Ee)},s)},y.deactivate=Ee=>{const Le=Ee.component;O(Ee,q,null,1,s),rr(()=>{Le.da&&kh(Le.da);const Ne=Ee.props&&Ee.props.onVnodeUnmounted;Ne&&Yr(Ne,Le.parent,Ee),Le.isDeactivated=!0},s)};function Z(Ee){a_(Ee),F(Ee,p,s,!0)}function ae(Ee){x.forEach((Le,Ne)=>{const Se=Lx(Le.type);Se&&(!Ee||!Ee(Se))&&le(Ne)})}function le(Ee){const Le=x.get(Ee);!A||Le.type!==A.type?Z(Le):A&&a_(A),x.delete(Ee),T.delete(Ee)}ri(()=>[r.include,r.exclude],([Ee,Le])=>{Ee&&ae(Ne=>Ch(Ee,Ne)),Le&&ae(Ne=>!Ch(Le,Ne))},{flush:"post",deep:!0});let xe=null;const He=()=>{xe!=null&&x.set(xe,l_(p.subTree))};return ar(He),xp(He),_n(()=>{x.forEach(Ee=>{const{subTree:Le,suspense:Ne}=p,Se=l_(Le);if(Ee.type===Se.type){a_(Se);const Pe=Se.component.da;Pe&&rr(Pe,Ne);return}Z(Ee)})}),()=>{if(xe=null,!u.default)return null;const Ee=u.default(),Le=Ee[0];if(Ee.length>1)return A=null,Ee;if(!ep(Le)||!(Le.shapeFlag&4)&&!(Le.shapeFlag&128))return A=null,Le;let Ne=l_(Le);const Se=Ne.type,Pe=Lx(zh(Ne)?Ne.type.__asyncResolved||{}:Se),{include:we,exclude:De,max:Ke}=r;if(we&&(!Pe||!Ch(we,Pe))||De&&Pe&&Ch(De,Pe))return A=Ne,Le;const Ue=Ne.key==null?Se:Ne.key,nt=x.get(Ue);return Ne.el&&(Ne=xs(Ne),Le.shapeFlag&128&&(Le.ssContent=Ne)),xe=Ue,nt?(Ne.el=nt.el,Ne.component=nt.component,Ne.transition&&zc(Ne,Ne.transition),Ne.shapeFlag|=512,T.delete(Ue),T.add(Ue)):(T.add(Ue),Ke&&T.size>parseInt(Ke,10)&&le(T.values().next().value)),Ne.shapeFlag|=256,A=Ne,M1(Le.type)?Le:Ne}}},YE=KE;function Ch(r,u){return xi(r)?r.some(p=>Ch(p,u)):$n(r)?r.split(",").includes(u):r.test?r.test(u):!1}function yp(r,u){L1(r,"a",u)}function Fc(r,u){L1(r,"da",u)}function L1(r,u,p=sr){const y=r.__wdc||(r.__wdc=()=>{let x=p;for(;x;){if(x.isDeactivated)return;x=x.parent}return r()});if(vp(u,y,p),p){let x=p.parent;for(;x&&x.parent;)gp(x.parent.vnode)&&JE(y,u,p,x),x=x.parent}}function JE(r,u,p,y){const x=vp(u,r,y,!0);bp(()=>{K_(y[u],x)},p)}function a_(r){let u=r.shapeFlag;u&256&&(u-=256),u&512&&(u-=512),r.shapeFlag=u}function l_(r){return r.shapeFlag&128?r.ssContent:r}function vp(r,u,p=sr,y=!1){if(p){const x=p[r]||(p[r]=[]),T=u.__weh||(u.__weh=(...A)=>{if(p.isUnmounted)return;Bc(),Pc(p);const s=eo(u,p,r,A);return fl(),Rc(),s});return y?x.unshift(T):x.push(T),T}}const ws=r=>(u,p=sr)=>(!Nh||r==="sp")&&vp(r,(...y)=>u(...y),p),ug=ws("bm"),ar=ws("m"),hg=ws("bu"),xp=ws("u"),_n=ws("bum"),bp=ws("um"),QE=ws("sp"),eS=ws("rtg"),tS=ws("rtc");function iS(r,u=sr){vp("ec",r,u)}function dg(r,u){const p=bo;if(p===null)return r;const y=Tp(p)||p.proxy,x=r.dirs||(r.dirs=[]);for(let T=0;T<u.length;T++){let[A,s,D,O=un]=u[T];Si(A)&&(A={mounted:A,updated:A}),A.deep&&cl(s),x.push({dir:A,instance:y,value:s,oldValue:void 0,arg:D,modifiers:O})}return r}function il(r,u,p,y){const x=r.dirs,T=u&&u.dirs;for(let A=0;A<x.length;A++){const s=x[A];T&&(s.oldValue=T[A].value);let D=s.dir[y];D&&(Bc(),eo(D,p,8,[r.el,s,r,u]),Rc())}}const nS=Symbol(),M_=r=>r?$1(r)?Tp(r)||r.proxy:M_(r.parent):null,Jf=Yn(Object.create(null),{$:r=>r,$el:r=>r.vnode.el,$data:r=>r.data,$props:r=>r.props,$attrs:r=>r.attrs,$slots:r=>r.slots,$refs:r=>r.refs,$parent:r=>M_(r.parent),$root:r=>M_(r.root),$emit:r=>r.emit,$options:r=>fg(r),$forceUpdate:r=>r.f||(r.f=()=>lg(r.update)),$nextTick:r=>r.n||(r.n=fn.bind(r.proxy)),$watch:r=>WE.bind(r)}),rS={get({_:r},u){const{ctx:p,setupState:y,data:x,props:T,accessCache:A,type:s,appContext:D}=r;let O;if(u[0]!=="$"){const Z=A[u];if(Z!==void 0)switch(Z){case 1:return y[u];case 2:return x[u];case 4:return p[u];case 3:return T[u]}else{if(y!==un&&Ni(y,u))return A[u]=1,y[u];if(x!==un&&Ni(x,u))return A[u]=2,x[u];if((O=r.propsOptions[0])&&Ni(O,u))return A[u]=3,T[u];if(p!==un&&Ni(p,u))return A[u]=4,p[u];I_&&(A[u]=0)}}const F=Jf[u];let N,q;if(F)return u==="$attrs"&&jr(r,"get",u),F(r);if((N=s.__cssModules)&&(N=N[u]))return N;if(p!==un&&Ni(p,u))return A[u]=4,p[u];if(q=D.config.globalProperties,Ni(q,u))return q[u]},set({_:r},u,p){const{data:y,setupState:x,ctx:T}=r;return x!==un&&Ni(x,u)?(x[u]=p,!0):y!==un&&Ni(y,u)?(y[u]=p,!0):Ni(r.props,u)||u[0]==="$"&&u.slice(1)in r?!1:(T[u]=p,!0)},has({_:{data:r,setupState:u,accessCache:p,ctx:y,appContext:x,propsOptions:T}},A){let s;return!!p[A]||r!==un&&Ni(r,A)||u!==un&&Ni(u,A)||(s=T[0])&&Ni(s,A)||Ni(y,A)||Ni(Jf,A)||Ni(x.config.globalProperties,A)},defineProperty(r,u,p){return p.get!=null?r._.accessCache[u]=0:Ni(p,"value")&&this.set(r,u,p.value,null),Reflect.defineProperty(r,u,p)}};let I_=!0;function oS(r){const u=fg(r),p=r.proxy,y=r.ctx;I_=!1,u.beforeCreate&&Ex(u.beforeCreate,r,"bc");const{data:x,computed:T,methods:A,watch:s,provide:D,inject:O,created:F,beforeMount:N,mounted:q,beforeUpdate:Z,updated:ae,activated:le,deactivated:xe,beforeDestroy:He,beforeUnmount:Ee,destroyed:Le,unmounted:Ne,render:Se,renderTracked:Pe,renderTriggered:we,errorCaptured:De,serverPrefetch:Ke,expose:Ue,inheritAttrs:nt,components:$e,directives:Ge,filters:Ye}=u;if(O&&sS(O,y,null,r.appContext.config.unwrapInjectedRef),A)for(const ot in A){const At=A[ot];Si(At)&&(y[ot]=At.bind(p))}if(x){const ot=x.call(p,p);wn(ot)&&(r.data=xo(ot))}if(I_=!0,T)for(const ot in T){const At=T[ot],di=Si(At)?At.bind(p,p):Si(At.get)?At.get.bind(p,p):To,Fe=!Si(At)&&Si(At.set)?At.set.bind(p):To,_t=ve({get:di,set:Fe});Object.defineProperty(y,ot,{enumerable:!0,configurable:!0,get:()=>_t.value,set:xt=>_t.value=xt})}if(s)for(const ot in s)B1(s[ot],y,p,ot);if(D){const ot=Si(D)?D.call(p):D;Reflect.ownKeys(ot).forEach(At=>{Oc(At,ot[At])})}F&&Ex(F,r,"c");function Ht(ot,At){xi(At)?At.forEach(di=>ot(di.bind(p))):At&&ot(At.bind(p))}if(Ht(ug,N),Ht(ar,q),Ht(hg,Z),Ht(xp,ae),Ht(yp,le),Ht(Fc,xe),Ht(iS,De),Ht(tS,Pe),Ht(eS,we),Ht(_n,Ee),Ht(bp,Ne),Ht(QE,Ke),xi(Ue))if(Ue.length){const ot=r.exposed||(r.exposed={});Ue.forEach(At=>{Object.defineProperty(ot,At,{get:()=>p[At],set:di=>p[At]=di})})}else r.exposed||(r.exposed={});Se&&r.render===To&&(r.render=Se),nt!=null&&(r.inheritAttrs=nt),$e&&(r.components=$e),Ge&&(r.directives=Ge)}function sS(r,u,p=To,y=!1){xi(r)&&(r=k_(r));for(const x in r){const T=r[x];let A;wn(T)?"default"in T?A=Eo(T.from||x,T.default,!0):A=Eo(T.from||x):A=Eo(T),_r(A)&&y?Object.defineProperty(u,x,{enumerable:!0,configurable:!0,get:()=>A.value,set:s=>A.value=s}):u[x]=A}}function Ex(r,u,p){eo(xi(r)?r.map(y=>y.bind(u.proxy)):r.bind(u.proxy),u,p)}function B1(r,u,p,y){const x=y.includes(".")?k1(p,y):()=>p[y];if($n(r)){const T=u[r];Si(T)&&ri(x,T)}else if(Si(r))ri(x,r.bind(p));else if(wn(r))if(xi(r))r.forEach(T=>B1(T,u,p,y));else{const T=Si(r.handler)?r.handler.bind(p):u[r.handler];Si(T)&&ri(x,T,r)}}function fg(r){const u=r.type,{mixins:p,extends:y}=u,{mixins:x,optionsCache:T,config:{optionMergeStrategies:A}}=r.appContext,s=T.get(u);let D;return s?D=s:!x.length&&!p&&!y?D=u:(D={},x.length&&x.forEach(O=>Qf(D,O,A,!0)),Qf(D,u,A)),wn(u)&&T.set(u,D),D}function Qf(r,u,p,y=!1){const{mixins:x,extends:T}=u;T&&Qf(r,T,p,!0),x&&x.forEach(A=>Qf(r,A,p,!0));for(const A in u)if(!(y&&A==="expose")){const s=aS[A]||p&&p[A];r[A]=s?s(r[A],u[A]):u[A]}return r}const aS={data:Sx,props:ol,emits:ol,methods:ol,computed:ol,beforeCreate:wr,created:wr,beforeMount:wr,mounted:wr,beforeUpdate:wr,updated:wr,beforeDestroy:wr,beforeUnmount:wr,destroyed:wr,unmounted:wr,activated:wr,deactivated:wr,errorCaptured:wr,serverPrefetch:wr,components:ol,directives:ol,watch:cS,provide:Sx,inject:lS};function Sx(r,u){return u?r?function(){return Yn(Si(r)?r.call(this,this):r,Si(u)?u.call(this,this):u)}:u:r}function lS(r,u){return ol(k_(r),k_(u))}function k_(r){if(xi(r)){const u={};for(let p=0;p<r.length;p++)u[r[p]]=r[p];return u}return r}function wr(r,u){return r?[...new Set([].concat(r,u))]:u}function ol(r,u){return r?Yn(Yn(Object.create(null),r),u):u}function cS(r,u){if(!r)return u;if(!u)return r;const p=Yn(Object.create(null),r);for(const y in u)p[y]=wr(r[y],u[y]);return p}function uS(r,u,p,y=!1){const x={},T={};Xf(T,wp,1),r.propsDefaults=Object.create(null),R1(r,u,x,T);for(const A in r.propsOptions[0])A in x||(x[A]=void 0);p?r.props=y?x:kE(x):r.type.props?r.props=x:r.props=T,r.attrs=T}function hS(r,u,p,y){const{props:x,attrs:T,vnode:{patchFlag:A}}=r,s=zi(x),[D]=r.propsOptions;let O=!1;if((y||A>0)&&!(A&16)){if(A&8){const F=r.vnode.dynamicProps;for(let N=0;N<F.length;N++){let q=F[N];if(_p(r.emitsOptions,q))continue;const Z=u[q];if(D)if(Ni(T,q))Z!==T[q]&&(T[q]=Z,O=!0);else{const ae=Ic(q);x[ae]=z_(D,s,ae,Z,r,!1)}else Z!==T[q]&&(T[q]=Z,O=!0)}}}else{R1(r,u,x,T)&&(O=!0);let F;for(const N in s)(!u||!Ni(u,N)&&((F=Lc(N))===N||!Ni(u,F)))&&(D?p&&(p[N]!==void 0||p[F]!==void 0)&&(x[N]=z_(D,s,N,void 0,r,!0)):delete x[N]);if(T!==s)for(const N in T)(!u||!Ni(u,N)&&!0)&&(delete T[N],O=!0)}O&&vs(r,"set","$attrs")}function R1(r,u,p,y){const[x,T]=r.propsOptions;let A=!1,s;if(u)for(let D in u){if(Nf(D))continue;const O=u[D];let F;x&&Ni(x,F=Ic(D))?!T||!T.includes(F)?p[F]=O:(s||(s={}))[F]=O:_p(r.emitsOptions,D)||(!(D in y)||O!==y[D])&&(y[D]=O,A=!0)}if(T){const D=zi(p),O=s||un;for(let F=0;F<T.length;F++){const N=T[F];p[N]=z_(x,D,N,O[N],r,!Ni(O,N))}}return A}function z_(r,u,p,y,x,T){const A=r[p];if(A!=null){const s=Ni(A,"default");if(s&&y===void 0){const D=A.default;if(A.type!==Function&&Si(D)){const{propsDefaults:O}=x;p in O?y=O[p]:(Pc(x),y=O[p]=D.call(null,u),fl())}else y=D}A[0]&&(T&&!s?y=!1:A[1]&&(y===""||y===Lc(p))&&(y=!0))}return y}function O1(r,u,p=!1){const y=u.propsCache,x=y.get(r);if(x)return x;const T=r.props,A={},s=[];let D=!1;if(!Si(r)){const F=N=>{D=!0;const[q,Z]=O1(N,u,!0);Yn(A,q),Z&&s.push(...Z)};!p&&u.mixins.length&&u.mixins.forEach(F),r.extends&&F(r.extends),r.mixins&&r.mixins.forEach(F)}if(!T&&!D)return wn(r)&&y.set(r,Tc),Tc;if(xi(T))for(let F=0;F<T.length;F++){const N=Ic(T[F]);Cx(N)&&(A[N]=un)}else if(T)for(const F in T){const N=Ic(F);if(Cx(N)){const q=T[F],Z=A[N]=xi(q)||Si(q)?{type:q}:q;if(Z){const ae=Ix(Boolean,Z.type),le=Ix(String,Z.type);Z[0]=ae>-1,Z[1]=le<0||ae<le,(ae>-1||Ni(Z,"default"))&&s.push(N)}}}const O=[A,s];return wn(r)&&y.set(r,O),O}function Cx(r){return r[0]!=="$"}function Ax(r){const u=r&&r.toString().match(/^\s*function (\w+)/);return u?u[1]:r===null?"null":""}function Mx(r,u){return Ax(r)===Ax(u)}function Ix(r,u){return xi(u)?u.findIndex(p=>Mx(p,r)):Si(u)&&Mx(u,r)?0:-1}const F1=r=>r[0]==="_"||r==="$stable",pg=r=>xi(r)?r.map(Zo):[Zo(r)],dS=(r,u,p)=>{if(u._n)return u;const y=Qi((...x)=>pg(u(...x)),p);return y._c=!1,y},V1=(r,u,p)=>{const y=r._ctx;for(const x in r){if(F1(x))continue;const T=r[x];if(Si(T))u[x]=dS(x,T,y);else if(T!=null){const A=pg(T);u[x]=()=>A}}},U1=(r,u)=>{const p=pg(u);r.slots.default=()=>p},fS=(r,u)=>{if(r.vnode.shapeFlag&32){const p=u._;p?(r.slots=zi(u),Xf(u,"_",p)):V1(u,r.slots={})}else r.slots={},u&&U1(r,u);Xf(r.slots,wp,1)},pS=(r,u,p)=>{const{vnode:y,slots:x}=r;let T=!0,A=un;if(y.shapeFlag&32){const s=u._;s?p&&s===1?T=!1:(Yn(x,u),!p&&s===1&&delete x._):(T=!u.$stable,V1(u,x)),A=u}else u&&(U1(r,u),A={default:1});if(T)for(const s in x)!F1(s)&&!(s in A)&&delete x[s]};function N1(){return{app:null,config:{isNativeTag:K2,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let mS=0;function _S(r,u){return function(y,x=null){Si(y)||(y=Object.assign({},y)),x!=null&&!wn(x)&&(x=null);const T=N1(),A=new Set;let s=!1;const D=T.app={_uid:mS++,_component:y,_props:x,_container:null,_context:T,_instance:null,version:OS,get config(){return T.config},set config(O){},use(O,...F){return A.has(O)||(O&&Si(O.install)?(A.add(O),O.install(D,...F)):Si(O)&&(A.add(O),O(D,...F))),D},mixin(O){return T.mixins.includes(O)||T.mixins.push(O),D},component(O,F){return F?(T.components[O]=F,D):T.components[O]},directive(O,F){return F?(T.directives[O]=F,D):T.directives[O]},mount(O,F,N){if(!s){const q=Lt(y,x);return q.appContext=T,F&&u?u(q,O):r(q,O,N),s=!0,D._container=O,O.__vue_app__=D,Tp(q.component)||q.component.proxy}},unmount(){s&&(r(null,D._container),delete D._container.__vue_app__)},provide(O,F){return T.provides[O]=F,D}};return D}}function P_(r,u,p,y,x=!1){if(xi(r)){r.forEach((q,Z)=>P_(q,u&&(xi(u)?u[Z]:u),p,y,x));return}if(zh(y)&&!x)return;const T=y.shapeFlag&4?Tp(y.component)||y.component.proxy:y.el,A=x?null:T,{i:s,r:D}=r,O=u&&u.r,F=s.refs===un?s.refs={}:s.refs,N=s.setupState;if(O!=null&&O!==D&&($n(O)?(F[O]=null,Ni(N,O)&&(N[O]=null)):_r(O)&&(O.value=null)),Si(D))la(D,s,12,[A,F]);else{const q=$n(D),Z=_r(D);if(q||Z){const ae=()=>{if(r.f){const le=q?F[D]:D.value;x?xi(le)&&K_(le,T):xi(le)?le.includes(T)||le.push(T):q?(F[D]=[T],Ni(N,D)&&(N[D]=F[D])):(D.value=[T],r.k&&(F[r.k]=D.value))}else q?(F[D]=A,Ni(N,D)&&(N[D]=A)):Z&&(D.value=A,r.k&&(F[r.k]=A))};A?(ae.id=-1,rr(ae,p)):ae()}}}const rr=ZE;function gS(r){return yS(r)}function yS(r,u){const p=iE();p.__VUE__=!0;const{insert:y,remove:x,patchProp:T,createElement:A,createText:s,createComment:D,setText:O,setElementText:F,parentNode:N,nextSibling:q,setScopeId:Z=To,insertStaticContent:ae}=r,le=(de,Ce,Re,ct=null,ut=null,bt=null,Mt=!1,gt=null,Xe=!!Ce.dynamicChildren)=>{if(de===Ce)return;de&&!al(de,Ce)&&(ct=Yt(de),xt(de,ut,bt,!0),de=null),Ce.patchFlag===-2&&(Xe=!1,Ce.dynamicChildren=null);const{type:ht,ref:qt,shapeFlag:Nt}=Ce;switch(ht){case _g:xe(de,Ce,Re,ct);break;case So:He(de,Ce,Re,ct);break;case jf:de==null&&Ee(Ce,Re,ct,Mt);break;case or:$e(de,Ce,Re,ct,ut,bt,Mt,gt,Xe);break;default:Nt&1?Se(de,Ce,Re,ct,ut,bt,Mt,gt,Xe):Nt&6?Ge(de,Ce,Re,ct,ut,bt,Mt,gt,Xe):(Nt&64||Nt&128)&&ht.process(de,Ce,Re,ct,ut,bt,Mt,gt,Xe,Et)}qt!=null&&ut&&P_(qt,de&&de.ref,bt,Ce||de,!Ce)},xe=(de,Ce,Re,ct)=>{if(de==null)y(Ce.el=s(Ce.children),Re,ct);else{const ut=Ce.el=de.el;Ce.children!==de.children&&O(ut,Ce.children)}},He=(de,Ce,Re,ct)=>{de==null?y(Ce.el=D(Ce.children||""),Re,ct):Ce.el=de.el},Ee=(de,Ce,Re,ct)=>{[de.el,de.anchor]=ae(de.children,Ce,Re,ct,de.el,de.anchor)},Le=({el:de,anchor:Ce},Re,ct)=>{let ut;for(;de&&de!==Ce;)ut=q(de),y(de,Re,ct),de=ut;y(Ce,Re,ct)},Ne=({el:de,anchor:Ce})=>{let Re;for(;de&&de!==Ce;)Re=q(de),x(de),de=Re;x(Ce)},Se=(de,Ce,Re,ct,ut,bt,Mt,gt,Xe)=>{Mt=Mt||Ce.type==="svg",de==null?Pe(Ce,Re,ct,ut,bt,Mt,gt,Xe):Ke(de,Ce,ut,bt,Mt,gt,Xe)},Pe=(de,Ce,Re,ct,ut,bt,Mt,gt)=>{let Xe,ht;const{type:qt,props:Nt,shapeFlag:Zt,transition:ti,dirs:mi}=de;if(Xe=de.el=A(de.type,bt,Nt&&Nt.is,Nt),Zt&8?F(Xe,de.children):Zt&16&&De(de.children,Xe,null,ct,ut,bt&&qt!=="foreignObject",Mt,gt),mi&&il(de,null,ct,"created"),Nt){for(const si in Nt)si!=="value"&&!Nf(si)&&T(Xe,si,null,Nt[si],bt,de.children,ct,ut,Kt);"value"in Nt&&T(Xe,"value",null,Nt.value),(ht=Nt.onVnodeBeforeMount)&&Yr(ht,ct,de)}we(Xe,de,de.scopeId,Mt,ct),mi&&il(de,null,ct,"beforeMount");const Di=(!ut||ut&&!ut.pendingBranch)&&ti&&!ti.persisted;Di&&ti.beforeEnter(Xe),y(Xe,Ce,Re),((ht=Nt&&Nt.onVnodeMounted)||Di||mi)&&rr(()=>{ht&&Yr(ht,ct,de),Di&&ti.enter(Xe),mi&&il(de,null,ct,"mounted")},ut)},we=(de,Ce,Re,ct,ut)=>{if(Re&&Z(de,Re),ct)for(let bt=0;bt<ct.length;bt++)Z(de,ct[bt]);if(ut){let bt=ut.subTree;if(Ce===bt){const Mt=ut.vnode;we(de,Mt,Mt.scopeId,Mt.slotScopeIds,ut.parent)}}},De=(de,Ce,Re,ct,ut,bt,Mt,gt,Xe=0)=>{for(let ht=Xe;ht<de.length;ht++){const qt=de[ht]=gt?ra(de[ht]):Zo(de[ht]);le(null,qt,Ce,Re,ct,ut,bt,Mt,gt)}},Ke=(de,Ce,Re,ct,ut,bt,Mt)=>{const gt=Ce.el=de.el;let{patchFlag:Xe,dynamicChildren:ht,dirs:qt}=Ce;Xe|=de.patchFlag&16;const Nt=de.props||un,Zt=Ce.props||un;let ti;Re&&nl(Re,!1),(ti=Zt.onVnodeBeforeUpdate)&&Yr(ti,Re,Ce,de),qt&&il(Ce,de,Re,"beforeUpdate"),Re&&nl(Re,!0);const mi=ut&&Ce.type!=="foreignObject";if(ht?Ue(de.dynamicChildren,ht,gt,Re,ct,mi,bt):Mt||At(de,Ce,gt,null,Re,ct,mi,bt,!1),Xe>0){if(Xe&16)nt(gt,Ce,Nt,Zt,Re,ct,ut);else if(Xe&2&&Nt.class!==Zt.class&&T(gt,"class",null,Zt.class,ut),Xe&4&&T(gt,"style",Nt.style,Zt.style,ut),Xe&8){const Di=Ce.dynamicProps;for(let si=0;si<Di.length;si++){const Ai=Di[si],hn=Nt[Ai],gr=Zt[Ai];(gr!==hn||Ai==="value")&&T(gt,Ai,hn,gr,ut,de.children,Re,ct,Kt)}}Xe&1&&de.children!==Ce.children&&F(gt,Ce.children)}else!Mt&&ht==null&&nt(gt,Ce,Nt,Zt,Re,ct,ut);((ti=Zt.onVnodeUpdated)||qt)&&rr(()=>{ti&&Yr(ti,Re,Ce,de),qt&&il(Ce,de,Re,"updated")},ct)},Ue=(de,Ce,Re,ct,ut,bt,Mt)=>{for(let gt=0;gt<Ce.length;gt++){const Xe=de[gt],ht=Ce[gt],qt=Xe.el&&(Xe.type===or||!al(Xe,ht)||Xe.shapeFlag&70)?N(Xe.el):Re;le(Xe,ht,qt,null,ct,ut,bt,Mt,!0)}},nt=(de,Ce,Re,ct,ut,bt,Mt)=>{if(Re!==ct){if(Re!==un)for(const gt in Re)!Nf(gt)&&!(gt in ct)&&T(de,gt,Re[gt],null,Mt,Ce.children,ut,bt,Kt);for(const gt in ct){if(Nf(gt))continue;const Xe=ct[gt],ht=Re[gt];Xe!==ht&&gt!=="value"&&T(de,gt,ht,Xe,Mt,Ce.children,ut,bt,Kt)}"value"in ct&&T(de,"value",Re.value,ct.value)}},$e=(de,Ce,Re,ct,ut,bt,Mt,gt,Xe)=>{const ht=Ce.el=de?de.el:s(""),qt=Ce.anchor=de?de.anchor:s("");let{patchFlag:Nt,dynamicChildren:Zt,slotScopeIds:ti}=Ce;ti&&(gt=gt?gt.concat(ti):ti),de==null?(y(ht,Re,ct),y(qt,Re,ct),De(Ce.children,Re,qt,ut,bt,Mt,gt,Xe)):Nt>0&&Nt&64&&Zt&&de.dynamicChildren?(Ue(de.dynamicChildren,Zt,Re,ut,bt,Mt,gt),(Ce.key!=null||ut&&Ce===ut.subTree)&&mg(de,Ce,!0)):At(de,Ce,Re,qt,ut,bt,Mt,gt,Xe)},Ge=(de,Ce,Re,ct,ut,bt,Mt,gt,Xe)=>{Ce.slotScopeIds=gt,de==null?Ce.shapeFlag&512?ut.ctx.activate(Ce,Re,ct,Mt,Xe):Ye(Ce,Re,ct,ut,bt,Mt,Xe):Ft(de,Ce,Xe)},Ye=(de,Ce,Re,ct,ut,bt,Mt)=>{const gt=de.component=zS(de,ct,ut);if(gp(de)&&(gt.ctx.renderer=Et),PS(gt),gt.asyncDep){if(ut&&ut.registerDep(gt,Ht),!de.el){const Xe=gt.subTree=Lt(So);He(null,Xe,Ce,Re)}return}Ht(gt,de,Ce,Re,ut,bt,Mt)},Ft=(de,Ce,Re)=>{const ct=Ce.component=de.component;if($E(de,Ce,Re))if(ct.asyncDep&&!ct.asyncResolved){ot(ct,Ce,Re);return}else ct.next=Ce,FE(ct.update),ct.update();else Ce.el=de.el,ct.vnode=Ce},Ht=(de,Ce,Re,ct,ut,bt,Mt)=>{const gt=()=>{if(de.isMounted){let{next:qt,bu:Nt,u:Zt,parent:ti,vnode:mi}=de,Di=qt,si;nl(de,!1),qt?(qt.el=mi.el,ot(de,qt,Mt)):qt=mi,Nt&&kh(Nt),(si=qt.props&&qt.props.onVnodeBeforeUpdate)&&Yr(si,ti,qt,mi),nl(de,!0);const Ai=o_(de),hn=de.subTree;de.subTree=Ai,le(hn,Ai,N(hn.el),Yt(hn),de,ut,bt),qt.el=Ai.el,Di===null&&GE(de,Ai.el),Zt&&rr(Zt,ut),(si=qt.props&&qt.props.onVnodeUpdated)&&rr(()=>Yr(si,ti,qt,mi),ut)}else{let qt;const{el:Nt,props:Zt}=Ce,{bm:ti,m:mi,parent:Di}=de,si=zh(Ce);if(nl(de,!1),ti&&kh(ti),!si&&(qt=Zt&&Zt.onVnodeBeforeMount)&&Yr(qt,Di,Ce),nl(de,!0),Nt&&Tn){const Ai=()=>{de.subTree=o_(de),Tn(Nt,de.subTree,de,ut,null)};si?Ce.type.__asyncLoader().then(()=>!de.isUnmounted&&Ai()):Ai()}else{const Ai=de.subTree=o_(de);le(null,Ai,Re,ct,de,ut,bt),Ce.el=Ai.el}if(mi&&rr(mi,ut),!si&&(qt=Zt&&Zt.onVnodeMounted)){const Ai=Ce;rr(()=>Yr(qt,Di,Ai),ut)}(Ce.shapeFlag&256||Di&&zh(Di.vnode)&&Di.vnode.shapeFlag&256)&&de.a&&rr(de.a,ut),de.isMounted=!0,Ce=Re=ct=null}},Xe=de.effect=new eg(gt,()=>lg(ht),de.scope),ht=de.update=()=>Xe.run();ht.id=de.uid,nl(de,!0),ht()},ot=(de,Ce,Re)=>{Ce.component=de;const ct=de.vnode.props;de.vnode=Ce,de.next=null,hS(de,Ce.props,ct,Re),pS(de,Ce.children,Re),Bc(),xx(),Rc()},At=(de,Ce,Re,ct,ut,bt,Mt,gt,Xe=!1)=>{const ht=de&&de.children,qt=de?de.shapeFlag:0,Nt=Ce.children,{patchFlag:Zt,shapeFlag:ti}=Ce;if(Zt>0){if(Zt&128){Fe(ht,Nt,Re,ct,ut,bt,Mt,gt,Xe);return}else if(Zt&256){di(ht,Nt,Re,ct,ut,bt,Mt,gt,Xe);return}}ti&8?(qt&16&&Kt(ht,ut,bt),Nt!==ht&&F(Re,Nt)):qt&16?ti&16?Fe(ht,Nt,Re,ct,ut,bt,Mt,gt,Xe):Kt(ht,ut,bt,!0):(qt&8&&F(Re,""),ti&16&&De(Nt,Re,ct,ut,bt,Mt,gt,Xe))},di=(de,Ce,Re,ct,ut,bt,Mt,gt,Xe)=>{de=de||Tc,Ce=Ce||Tc;const ht=de.length,qt=Ce.length,Nt=Math.min(ht,qt);let Zt;for(Zt=0;Zt<Nt;Zt++){const ti=Ce[Zt]=Xe?ra(Ce[Zt]):Zo(Ce[Zt]);le(de[Zt],ti,Re,null,ut,bt,Mt,gt,Xe)}ht>qt?Kt(de,ut,bt,!0,!1,Nt):De(Ce,Re,ct,ut,bt,Mt,gt,Xe,Nt)},Fe=(de,Ce,Re,ct,ut,bt,Mt,gt,Xe)=>{let ht=0;const qt=Ce.length;let Nt=de.length-1,Zt=qt-1;for(;ht<=Nt&&ht<=Zt;){const ti=de[ht],mi=Ce[ht]=Xe?ra(Ce[ht]):Zo(Ce[ht]);if(al(ti,mi))le(ti,mi,Re,null,ut,bt,Mt,gt,Xe);else break;ht++}for(;ht<=Nt&&ht<=Zt;){const ti=de[Nt],mi=Ce[Zt]=Xe?ra(Ce[Zt]):Zo(Ce[Zt]);if(al(ti,mi))le(ti,mi,Re,null,ut,bt,Mt,gt,Xe);else break;Nt--,Zt--}if(ht>Nt){if(ht<=Zt){const ti=Zt+1,mi=ti<qt?Ce[ti].el:ct;for(;ht<=Zt;)le(null,Ce[ht]=Xe?ra(Ce[ht]):Zo(Ce[ht]),Re,mi,ut,bt,Mt,gt,Xe),ht++}}else if(ht>Zt)for(;ht<=Nt;)xt(de[ht],ut,bt,!0),ht++;else{const ti=ht,mi=ht,Di=new Map;for(ht=mi;ht<=Zt;ht++){const gn=Ce[ht]=Xe?ra(Ce[ht]):Zo(Ce[ht]);gn.key!=null&&Di.set(gn.key,ht)}let si,Ai=0;const hn=Zt-mi+1;let gr=!1,Cn=0;const zn=new Array(hn);for(ht=0;ht<hn;ht++)zn[ht]=0;for(ht=ti;ht<=Nt;ht++){const gn=de[ht];if(Ai>=hn){xt(gn,ut,bt,!0);continue}let Pn;if(gn.key!=null)Pn=Di.get(gn.key);else for(si=mi;si<=Zt;si++)if(zn[si-mi]===0&&al(gn,Ce[si])){Pn=si;break}Pn===void 0?xt(gn,ut,bt,!0):(zn[Pn-mi]=ht+1,Pn>=Cn?Cn=Pn:gr=!0,le(gn,Ce[Pn],Re,null,ut,bt,Mt,gt,Xe),Ai++)}const qr=gr?vS(zn):Tc;for(si=qr.length-1,ht=hn-1;ht>=0;ht--){const gn=mi+ht,Pn=Ce[gn],Pr=gn+1<qt?Ce[gn+1].el:ct;zn[ht]===0?le(null,Pn,Re,Pr,ut,bt,Mt,gt,Xe):gr&&(si<0||ht!==qr[si]?_t(Pn,Re,Pr,2):si--)}}},_t=(de,Ce,Re,ct,ut=null)=>{const{el:bt,type:Mt,transition:gt,children:Xe,shapeFlag:ht}=de;if(ht&6){_t(de.component.subTree,Ce,Re,ct);return}if(ht&128){de.suspense.move(Ce,Re,ct);return}if(ht&64){Mt.move(de,Ce,Re,Et);return}if(Mt===or){y(bt,Ce,Re);for(let Nt=0;Nt<Xe.length;Nt++)_t(Xe[Nt],Ce,Re,ct);y(de.anchor,Ce,Re);return}if(Mt===jf){Le(de,Ce,Re);return}if(ct!==2&&ht&1&&gt)if(ct===0)gt.beforeEnter(bt),y(bt,Ce,Re),rr(()=>gt.enter(bt),ut);else{const{leave:Nt,delayLeave:Zt,afterLeave:ti}=gt,mi=()=>y(bt,Ce,Re),Di=()=>{Nt(bt,()=>{mi(),ti&&ti()})};Zt?Zt(bt,mi,Di):Di()}else y(bt,Ce,Re)},xt=(de,Ce,Re,ct=!1,ut=!1)=>{const{type:bt,props:Mt,ref:gt,children:Xe,dynamicChildren:ht,shapeFlag:qt,patchFlag:Nt,dirs:Zt}=de;if(gt!=null&&P_(gt,null,Re,de,!0),qt&256){Ce.ctx.deactivate(de);return}const ti=qt&1&&Zt,mi=!zh(de);let Di;if(mi&&(Di=Mt&&Mt.onVnodeBeforeUnmount)&&Yr(Di,Ce,de),qt&6)Ci(de.component,Re,ct);else{if(qt&128){de.suspense.unmount(Re,ct);return}ti&&il(de,null,Ce,"beforeUnmount"),qt&64?de.type.remove(de,Ce,Re,ut,Et,ct):ht&&(bt!==or||Nt>0&&Nt&64)?Kt(ht,Ce,Re,!1,!0):(bt===or&&Nt&384||!ut&&qt&16)&&Kt(Xe,Ce,Re),ct&&Bt(de)}(mi&&(Di=Mt&&Mt.onVnodeUnmounted)||ti)&&rr(()=>{Di&&Yr(Di,Ce,de),ti&&il(de,null,Ce,"unmounted")},Re)},Bt=de=>{const{type:Ce,el:Re,anchor:ct,transition:ut}=de;if(Ce===or){pi(Re,ct);return}if(Ce===jf){Ne(de);return}const bt=()=>{x(Re),ut&&!ut.persisted&&ut.afterLeave&&ut.afterLeave()};if(de.shapeFlag&1&&ut&&!ut.persisted){const{leave:Mt,delayLeave:gt}=ut,Xe=()=>Mt(Re,bt);gt?gt(de.el,bt,Xe):Xe()}else bt()},pi=(de,Ce)=>{let Re;for(;de!==Ce;)Re=q(de),x(de),de=Re;x(Ce)},Ci=(de,Ce,Re)=>{const{bum:ct,scope:ut,update:bt,subTree:Mt,um:gt}=de;ct&&kh(ct),ut.stop(),bt&&(bt.active=!1,xt(Mt,de,Ce,Re)),gt&&rr(gt,Ce),rr(()=>{de.isUnmounted=!0},Ce),Ce&&Ce.pendingBranch&&!Ce.isUnmounted&&de.asyncDep&&!de.asyncResolved&&de.suspenseId===Ce.pendingId&&(Ce.deps--,Ce.deps===0&&Ce.resolve())},Kt=(de,Ce,Re,ct=!1,ut=!1,bt=0)=>{for(let Mt=bt;Mt<de.length;Mt++)xt(de[Mt],Ce,Re,ct,ut)},Yt=de=>de.shapeFlag&6?Yt(de.component.subTree):de.shapeFlag&128?de.suspense.next():q(de.anchor||de.el),Jt=(de,Ce,Re)=>{de==null?Ce._vnode&&xt(Ce._vnode,null,null,!0):le(Ce._vnode||null,de,Ce,null,null,null,Re),xx(),E1(),Ce._vnode=de},Et={p:le,um:xt,m:_t,r:Bt,mt:Ye,mc:De,pc:At,pbc:Ue,n:Yt,o:r};let Ri,Tn;return u&&([Ri,Tn]=u(Et)),{render:Jt,hydrate:Ri,createApp:_S(Jt,Ri)}}function nl({effect:r,update:u},p){r.allowRecurse=u.allowRecurse=p}function mg(r,u,p=!1){const y=r.children,x=u.children;if(xi(y)&&xi(x))for(let T=0;T<y.length;T++){const A=y[T];let s=x[T];s.shapeFlag&1&&!s.dynamicChildren&&((s.patchFlag<=0||s.patchFlag===32)&&(s=x[T]=ra(x[T]),s.el=A.el),p||mg(A,s))}}function vS(r){const u=r.slice(),p=[0];let y,x,T,A,s;const D=r.length;for(y=0;y<D;y++){const O=r[y];if(O!==0){if(x=p[p.length-1],r[x]<O){u[y]=x,p.push(y);continue}for(T=0,A=p.length-1;T<A;)s=T+A>>1,r[p[s]]<O?T=s+1:A=s;O<r[p[T]]&&(T>0&&(u[y]=p[T-1]),p[T]=y)}}for(T=p.length,A=p[T-1];T-- >0;)p[T]=A,A=u[A];return p}const xS=r=>r.__isTeleport,Ph=r=>r&&(r.disabled||r.disabled===""),kx=r=>typeof SVGElement<"u"&&r instanceof SVGElement,D_=(r,u)=>{const p=r&&r.to;return $n(p)?u?u(p):null:p},bS={__isTeleport:!0,process(r,u,p,y,x,T,A,s,D,O){const{mc:F,pc:N,pbc:q,o:{insert:Z,querySelector:ae,createText:le,createComment:xe}}=O,He=Ph(u.props);let{shapeFlag:Ee,children:Le,dynamicChildren:Ne}=u;if(r==null){const Se=u.el=le(""),Pe=u.anchor=le("");Z(Se,p,y),Z(Pe,p,y);const we=u.target=D_(u.props,ae),De=u.targetAnchor=le("");we&&(Z(De,we),A=A||kx(we));const Ke=(Ue,nt)=>{Ee&16&&F(Le,Ue,nt,x,T,A,s,D)};He?Ke(p,Pe):we&&Ke(we,De)}else{u.el=r.el;const Se=u.anchor=r.anchor,Pe=u.target=r.target,we=u.targetAnchor=r.targetAnchor,De=Ph(r.props),Ke=De?p:Pe,Ue=De?Se:we;if(A=A||kx(Pe),Ne?(q(r.dynamicChildren,Ne,Ke,x,T,A,s),mg(r,u,!0)):D||N(r,u,Ke,Ue,x,T,A,s,!1),He)De||Pf(u,p,Se,O,1);else if((u.props&&u.props.to)!==(r.props&&r.props.to)){const nt=u.target=D_(u.props,ae);nt&&Pf(u,nt,null,O,0)}else De&&Pf(u,Pe,we,O,1)}},remove(r,u,p,y,{um:x,o:{remove:T}},A){const{shapeFlag:s,children:D,anchor:O,targetAnchor:F,target:N,props:q}=r;if(N&&T(F),(A||!Ph(q))&&(T(O),s&16))for(let Z=0;Z<D.length;Z++){const ae=D[Z];x(ae,u,p,!0,!!ae.dynamicChildren)}},move:Pf,hydrate:wS};function Pf(r,u,p,{o:{insert:y},m:x},T=2){T===0&&y(r.targetAnchor,u,p);const{el:A,anchor:s,shapeFlag:D,children:O,props:F}=r,N=T===2;if(N&&y(A,u,p),(!N||Ph(F))&&D&16)for(let q=0;q<O.length;q++)x(O[q],u,p,2);N&&y(s,u,p)}function wS(r,u,p,y,x,T,{o:{nextSibling:A,parentNode:s,querySelector:D}},O){const F=u.target=D_(u.props,D);if(F){const N=F._lpa||F.firstChild;if(u.shapeFlag&16)if(Ph(u.props))u.anchor=O(A(r),u,s(r),p,y,x,T),u.targetAnchor=N;else{u.anchor=A(r);let q=N;for(;q;)if(q=A(q),q&&q.nodeType===8&&q.data==="teleport anchor"){u.targetAnchor=q,F._lpa=u.targetAnchor&&A(u.targetAnchor);break}O(N,u,F,p,y,x,T)}}return u.anchor&&A(u.anchor)}const TS=bS,or=Symbol(void 0),_g=Symbol(void 0),So=Symbol(void 0),jf=Symbol(void 0),Dh=[];let wo=null;function qn(r=!1){Dh.push(wo=r?null:[])}function ES(){Dh.pop(),wo=Dh[Dh.length-1]||null}let Uh=1;function zx(r){Uh+=r}function j1(r){return r.dynamicChildren=Uh>0?wo||Tc:null,ES(),Uh>0&&wo&&wo.push(r),r}function ha(r,u,p,y,x,T){return j1(gi(r,u,p,y,x,T,!0))}function _o(r,u,p,y,x){return j1(Lt(r,u,p,y,x,!0))}function ep(r){return r?r.__v_isVNode===!0:!1}function al(r,u){return r.type===u.type&&r.key===u.key}const wp="__vInternal",q1=({key:r})=>r!=null?r:null,qf=({ref:r,ref_key:u,ref_for:p})=>r!=null?$n(r)||_r(r)||Si(r)?{i:bo,r,k:u,f:!!p}:r:null;function gi(r,u=null,p=null,y=0,x=null,T=r===or?0:1,A=!1,s=!1){const D={__v_isVNode:!0,__v_skip:!0,type:r,props:u,key:u&&q1(u),ref:u&&qf(u),scopeId:A1,slotScopeIds:null,children:p,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:T,patchFlag:y,dynamicProps:x,dynamicChildren:null,appContext:null};return s?(gg(D,p),T&128&&r.normalize(D)):p&&(D.shapeFlag|=$n(p)?8:16),Uh>0&&!A&&wo&&(D.patchFlag>0||T&6)&&D.patchFlag!==32&&wo.push(D),D}const Lt=SS;function SS(r,u=null,p=null,y=0,x=null,T=!1){if((!r||r===nS)&&(r=So),ep(r)){const s=xs(r,u,!0);return p&&gg(s,p),Uh>0&&!T&&wo&&(s.shapeFlag&6?wo[wo.indexOf(r)]=s:wo.push(s)),s.patchFlag|=-2,s}if(RS(r)&&(r=r.__vccOpts),u){u=CS(u);let{class:s,style:D}=u;s&&!$n(s)&&(u.class=H_(s)),wn(D)&&(g1(D)&&!xi(D)&&(D=Yn({},D)),u.style=W_(D))}const A=$n(r)?1:M1(r)?128:xS(r)?64:wn(r)?4:Si(r)?2:0;return gi(r,u,p,y,x,A,T,!0)}function CS(r){return r?g1(r)||wp in r?Yn({},r):r:null}function xs(r,u,p=!1){const{props:y,ref:x,patchFlag:T,children:A}=r,s=u?MS(y||{},u):y;return{__v_isVNode:!0,__v_skip:!0,type:r.type,props:s,key:s&&q1(s),ref:u&&u.ref?p&&x?xi(x)?x.concat(qf(u)):[x,qf(u)]:qf(u):x,scopeId:r.scopeId,slotScopeIds:r.slotScopeIds,children:A,target:r.target,targetAnchor:r.targetAnchor,staticCount:r.staticCount,shapeFlag:r.shapeFlag,patchFlag:u&&r.type!==or?T===-1?16:T|16:T,dynamicProps:r.dynamicProps,dynamicChildren:r.dynamicChildren,appContext:r.appContext,dirs:r.dirs,transition:r.transition,component:r.component,suspense:r.suspense,ssContent:r.ssContent&&xs(r.ssContent),ssFallback:r.ssFallback&&xs(r.ssFallback),el:r.el,anchor:r.anchor}}function Xo(r=" ",u=0){return Lt(_g,null,r,u)}function AS(r,u){const p=Lt(jf,null,r);return p.staticCount=u,p}function mc(r="",u=!1){return u?(qn(),_o(So,null,r)):Lt(So,null,r)}function Zo(r){return r==null||typeof r=="boolean"?Lt(So):xi(r)?Lt(or,null,r.slice()):typeof r=="object"?ra(r):Lt(_g,null,String(r))}function ra(r){return r.el===null&&r.patchFlag!==-1||r.memo?r:xs(r)}function gg(r,u){let p=0;const{shapeFlag:y}=r;if(u==null)u=null;else if(xi(u))p=16;else if(typeof u=="object")if(y&65){const x=u.default;x&&(x._c&&(x._d=!1),gg(r,x()),x._c&&(x._d=!0));return}else{p=32;const x=u._;!x&&!(wp in u)?u._ctx=bo:x===3&&bo&&(bo.slots._===1?u._=1:(u._=2,r.patchFlag|=1024))}else Si(u)?(u={default:u,_ctx:bo},p=32):(u=String(u),y&64?(p=16,u=[Xo(u)]):p=8);r.children=u,r.shapeFlag|=p}function MS(...r){const u={};for(let p=0;p<r.length;p++){const y=r[p];for(const x in y)if(x==="class")u.class!==y.class&&(u.class=H_([u.class,y.class]));else if(x==="style")u.style=W_([u.style,y.style]);else if(hp(x)){const T=u[x],A=y[x];A&&T!==A&&!(xi(T)&&T.includes(A))&&(u[x]=T?[].concat(T,A):A)}else x!==""&&(u[x]=y[x])}return u}function Yr(r,u,p,y=null){eo(r,u,7,[p,y])}const IS=N1();let kS=0;function zS(r,u,p){const y=r.type,x=(u?u.appContext:r.appContext)||IS,T={uid:kS++,vnode:r,type:y,parent:u,appContext:x,root:null,next:null,subTree:null,effect:null,update:null,scope:new nE(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:u?u.provides:Object.create(x.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:O1(y,x),emitsOptions:C1(y,x),emit:null,emitted:null,propsDefaults:un,inheritAttrs:y.inheritAttrs,ctx:un,data:un,props:un,attrs:un,slots:un,refs:un,setupState:un,setupContext:null,suspense:p,suspenseId:p?p.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return T.ctx={_:T},T.root=u?u.root:T,T.emit=NE.bind(null,T),r.ce&&r.ce(T),T}let sr=null;const Pi=()=>sr||bo,Pc=r=>{sr=r,r.scope.on()},fl=()=>{sr&&sr.scope.off(),sr=null};function $1(r){return r.vnode.shapeFlag&4}let Nh=!1;function PS(r,u=!1){Nh=u;const{props:p,children:y}=r.vnode,x=$1(r);uS(r,p,x,u),fS(r,y);const T=x?DS(r,u):void 0;return Nh=!1,T}function DS(r,u){const p=r.type;r.accessCache=Object.create(null),r.proxy=Wh(new Proxy(r.ctx,rS));const{setup:y}=p;if(y){const x=r.setupContext=y.length>1?BS(r):null;Pc(r),Bc();const T=la(y,r,0,[r.props,x]);if(Rc(),fl(),t1(T)){if(T.then(fl,fl),u)return T.then(A=>{Px(r,A,u)}).catch(A=>{mp(A,r,0)});r.asyncDep=T}else Px(r,T,u)}else G1(r,u)}function Px(r,u,p){Si(u)?r.type.__ssrInlineRender?r.ssrRender=u:r.render=u:wn(u)&&(r.setupState=x1(u)),G1(r,p)}let Dx;function G1(r,u,p){const y=r.type;if(!r.render){if(!u&&Dx&&!y.render){const x=y.template||fg(r).template;if(x){const{isCustomElement:T,compilerOptions:A}=r.appContext.config,{delimiters:s,compilerOptions:D}=y,O=Yn(Yn({isCustomElement:T,delimiters:s},A),D);y.render=Dx(x,O)}}r.render=y.render||To}Pc(r),Bc(),oS(r),Rc(),fl()}function LS(r){return new Proxy(r.attrs,{get(u,p){return jr(r,"get","$attrs"),u[p]}})}function BS(r){const u=y=>{r.exposed=y||{}};let p;return{get attrs(){return p||(p=LS(r))},slots:r.slots,emit:r.emit,expose:u}}function Tp(r){if(r.exposed)return r.exposeProxy||(r.exposeProxy=new Proxy(x1(Wh(r.exposed)),{get(u,p){if(p in u)return u[p];if(p in Jf)return Jf[p](r)}}))}function Lx(r,u=!0){return Si(r)?r.displayName||r.name:r.name||u&&r.__name}function RS(r){return Si(r)&&"__vccOpts"in r}const ve=(r,u)=>BE(r,u,Nh);function Te(r,u,p){const y=arguments.length;return y===2?wn(u)&&!xi(u)?ep(u)?Lt(r,null,[u]):Lt(r,u):Lt(r,null,u):(y>3?p=Array.prototype.slice.call(arguments,2):y===3&&ep(p)&&(p=[p]),Lt(r,u,p))}const OS="3.2.40",FS="http://www.w3.org/2000/svg",ll=typeof document<"u"?document:null,Bx=ll&&ll.createElement("template"),VS={insert:(r,u,p)=>{u.insertBefore(r,p||null)},remove:r=>{const u=r.parentNode;u&&u.removeChild(r)},createElement:(r,u,p,y)=>{const x=u?ll.createElementNS(FS,r):ll.createElement(r,p?{is:p}:void 0);return r==="select"&&y&&y.multiple!=null&&x.setAttribute("multiple",y.multiple),x},createText:r=>ll.createTextNode(r),createComment:r=>ll.createComment(r),setText:(r,u)=>{r.nodeValue=u},setElementText:(r,u)=>{r.textContent=u},parentNode:r=>r.parentNode,nextSibling:r=>r.nextSibling,querySelector:r=>ll.querySelector(r),setScopeId(r,u){r.setAttribute(u,"")},insertStaticContent(r,u,p,y,x,T){const A=p?p.previousSibling:u.lastChild;if(x&&(x===T||x.nextSibling))for(;u.insertBefore(x.cloneNode(!0),p),!(x===T||!(x=x.nextSibling)););else{Bx.innerHTML=y?`<svg>${r}</svg>`:r;const s=Bx.content;if(y){const D=s.firstChild;for(;D.firstChild;)s.appendChild(D.firstChild);s.removeChild(D)}u.insertBefore(s,p)}return[A?A.nextSibling:u.firstChild,p?p.previousSibling:u.lastChild]}};function US(r,u,p){const y=r._vtc;y&&(u=(u?[u,...y]:[...y]).join(" ")),u==null?r.removeAttribute("class"):p?r.setAttribute("class",u):r.className=u}function NS(r,u,p){const y=r.style,x=$n(p);if(p&&!x){for(const T in p)L_(y,T,p[T]);if(u&&!$n(u))for(const T in u)p[T]==null&&L_(y,T,"")}else{const T=y.display;x?u!==p&&(y.cssText=p):u&&r.removeAttribute("style"),"_vod"in r&&(y.display=T)}}const Rx=/\s*!important$/;function L_(r,u,p){if(xi(p))p.forEach(y=>L_(r,u,y));else if(p==null&&(p=""),u.startsWith("--"))r.setProperty(u,p);else{const y=jS(r,u);Rx.test(p)?r.setProperty(Lc(y),p.replace(Rx,""),"important"):r[y]=p}}const Ox=["Webkit","Moz","ms"],c_={};function jS(r,u){const p=c_[u];if(p)return p;let y=Ic(u);if(y!=="filter"&&y in r)return c_[u]=y;y=r1(y);for(let x=0;x<Ox.length;x++){const T=Ox[x]+y;if(T in r)return c_[u]=T}return u}const Fx="http://www.w3.org/1999/xlink";function qS(r,u,p,y,x){if(y&&u.startsWith("xlink:"))p==null?r.removeAttributeNS(Fx,u.slice(6,u.length)):r.setAttributeNS(Fx,u,p);else{const T=Z2(u);p==null||T&&!J0(p)?r.removeAttribute(u):r.setAttribute(u,T?"":p)}}function $S(r,u,p,y,x,T,A){if(u==="innerHTML"||u==="textContent"){y&&A(y,x,T),r[u]=p==null?"":p;return}if(u==="value"&&r.tagName!=="PROGRESS"&&!r.tagName.includes("-")){r._value=p;const D=p==null?"":p;(r.value!==D||r.tagName==="OPTION")&&(r.value=D),p==null&&r.removeAttribute(u);return}let s=!1;if(p===""||p==null){const D=typeof r[u];D==="boolean"?p=J0(p):p==null&&D==="string"?(p="",s=!0):D==="number"&&(p=0,s=!0)}try{r[u]=p}catch{}s&&r.removeAttribute(u)}const[Z1,GS]=(()=>{let r=Date.now,u=!1;if(typeof window<"u"){Date.now()>document.createEvent("Event").timeStamp&&(r=performance.now.bind(performance));const p=navigator.userAgent.match(/firefox\/(\d+)/i);u=!!(p&&Number(p[1])<=53)}return[r,u]})();let B_=0;const ZS=Promise.resolve(),WS=()=>{B_=0},HS=()=>B_||(ZS.then(WS),B_=Z1());function XS(r,u,p,y){r.addEventListener(u,p,y)}function KS(r,u,p,y){r.removeEventListener(u,p,y)}function YS(r,u,p,y,x=null){const T=r._vei||(r._vei={}),A=T[u];if(y&&A)A.value=y;else{const[s,D]=JS(u);if(y){const O=T[u]=QS(y,x);XS(r,s,O,D)}else A&&(KS(r,s,A,D),T[u]=void 0)}}const Vx=/(?:Once|Passive|Capture)$/;function JS(r){let u;if(Vx.test(r)){u={};let y;for(;y=r.match(Vx);)r=r.slice(0,r.length-y[0].length),u[y[0].toLowerCase()]=!0}return[r[2]===":"?r.slice(3):Lc(r.slice(2)),u]}function QS(r,u){const p=y=>{const x=y.timeStamp||Z1();(GS||x>=p.attached-1)&&eo(eC(y,p.value),u,5,[y])};return p.value=r,p.attached=HS(),p}function eC(r,u){if(xi(u)){const p=r.stopImmediatePropagation;return r.stopImmediatePropagation=()=>{p.call(r),r._stopped=!0},u.map(y=>x=>!x._stopped&&y&&y(x))}else return u}const Ux=/^on[a-z]/,tC=(r,u,p,y,x=!1,T,A,s,D)=>{u==="class"?US(r,y,x):u==="style"?NS(r,p,y):hp(u)?X_(u)||YS(r,u,p,y,A):(u[0]==="."?(u=u.slice(1),!0):u[0]==="^"?(u=u.slice(1),!1):iC(r,u,y,x))?$S(r,u,y,T,A,s,D):(u==="true-value"?r._trueValue=y:u==="false-value"&&(r._falseValue=y),qS(r,u,y,x))};function iC(r,u,p,y){return y?!!(u==="innerHTML"||u==="textContent"||u in r&&Ux.test(u)&&Si(p)):u==="spellcheck"||u==="draggable"||u==="translate"||u==="form"||u==="list"&&r.tagName==="INPUT"||u==="type"&&r.tagName==="TEXTAREA"||Ux.test(u)&&$n(p)?!1:u in r}const ea="transition",yh="animation",bs=(r,{slots:u})=>Te(P1,H1(r),u);bs.displayName="Transition";const W1={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},nC=bs.props=Yn({},P1.props,W1),rl=(r,u=[])=>{xi(r)?r.forEach(p=>p(...u)):r&&r(...u)},Nx=r=>r?xi(r)?r.some(u=>u.length>1):r.length>1:!1;function H1(r){const u={};for(const $e in r)$e in W1||(u[$e]=r[$e]);if(r.css===!1)return u;const{name:p="v",type:y,duration:x,enterFromClass:T=`${p}-enter-from`,enterActiveClass:A=`${p}-enter-active`,enterToClass:s=`${p}-enter-to`,appearFromClass:D=T,appearActiveClass:O=A,appearToClass:F=s,leaveFromClass:N=`${p}-leave-from`,leaveActiveClass:q=`${p}-leave-active`,leaveToClass:Z=`${p}-leave-to`}=r,ae=rC(x),le=ae&&ae[0],xe=ae&&ae[1],{onBeforeEnter:He,onEnter:Ee,onEnterCancelled:Le,onLeave:Ne,onLeaveCancelled:Se,onBeforeAppear:Pe=He,onAppear:we=Ee,onAppearCancelled:De=Le}=u,Ke=($e,Ge,Ye)=>{na($e,Ge?F:s),na($e,Ge?O:A),Ye&&Ye()},Ue=($e,Ge)=>{$e._isLeaving=!1,na($e,N),na($e,Z),na($e,q),Ge&&Ge()},nt=$e=>(Ge,Ye)=>{const Ft=$e?we:Ee,Ht=()=>Ke(Ge,$e,Ye);rl(Ft,[Ge,Ht]),jx(()=>{na(Ge,$e?D:T),_s(Ge,$e?F:s),Nx(Ft)||qx(Ge,y,le,Ht)})};return Yn(u,{onBeforeEnter($e){rl(He,[$e]),_s($e,T),_s($e,A)},onBeforeAppear($e){rl(Pe,[$e]),_s($e,D),_s($e,O)},onEnter:nt(!1),onAppear:nt(!0),onLeave($e,Ge){$e._isLeaving=!0;const Ye=()=>Ue($e,Ge);_s($e,N),K1(),_s($e,q),jx(()=>{!$e._isLeaving||(na($e,N),_s($e,Z),Nx(Ne)||qx($e,y,xe,Ye))}),rl(Ne,[$e,Ye])},onEnterCancelled($e){Ke($e,!1),rl(Le,[$e])},onAppearCancelled($e){Ke($e,!0),rl(De,[$e])},onLeaveCancelled($e){Ue($e),rl(Se,[$e])}})}function rC(r){if(r==null)return null;if(wn(r))return[u_(r.enter),u_(r.leave)];{const u=u_(r);return[u,u]}}function u_(r){return o1(r)}function _s(r,u){u.split(/\s+/).forEach(p=>p&&r.classList.add(p)),(r._vtc||(r._vtc=new Set)).add(u)}function na(r,u){u.split(/\s+/).forEach(y=>y&&r.classList.remove(y));const{_vtc:p}=r;p&&(p.delete(u),p.size||(r._vtc=void 0))}function jx(r){requestAnimationFrame(()=>{requestAnimationFrame(r)})}let oC=0;function qx(r,u,p,y){const x=r._endId=++oC,T=()=>{x===r._endId&&y()};if(p)return setTimeout(T,p);const{type:A,timeout:s,propCount:D}=X1(r,u);if(!A)return y();const O=A+"end";let F=0;const N=()=>{r.removeEventListener(O,q),T()},q=Z=>{Z.target===r&&++F>=D&&N()};setTimeout(()=>{F<D&&N()},s+1),r.addEventListener(O,q)}function X1(r,u){const p=window.getComputedStyle(r),y=ae=>(p[ae]||"").split(", "),x=y(ea+"Delay"),T=y(ea+"Duration"),A=$x(x,T),s=y(yh+"Delay"),D=y(yh+"Duration"),O=$x(s,D);let F=null,N=0,q=0;u===ea?A>0&&(F=ea,N=A,q=T.length):u===yh?O>0&&(F=yh,N=O,q=D.length):(N=Math.max(A,O),F=N>0?A>O?ea:yh:null,q=F?F===ea?T.length:D.length:0);const Z=F===ea&&/\b(transform|all)(,|$)/.test(p[ea+"Property"]);return{type:F,timeout:N,propCount:q,hasTransform:Z}}function $x(r,u){for(;r.length<u.length;)r=r.concat(r);return Math.max(...u.map((p,y)=>Gx(p)+Gx(r[y])))}function Gx(r){return Number(r.slice(0,-1).replace(",","."))*1e3}function K1(){return document.body.offsetHeight}const Y1=new WeakMap,J1=new WeakMap,sC={name:"TransitionGroup",props:Yn({},nC,{tag:String,moveClass:String}),setup(r,{slots:u}){const p=Pi(),y=z1();let x,T;return xp(()=>{if(!x.length)return;const A=r.moveClass||`${r.name||"v"}-move`;if(!hC(x[0].el,p.vnode.el,A))return;x.forEach(lC),x.forEach(cC);const s=x.filter(uC);K1(),s.forEach(D=>{const O=D.el,F=O.style;_s(O,A),F.transform=F.webkitTransform=F.transitionDuration="";const N=O._moveCb=q=>{q&&q.target!==O||(!q||/transform$/.test(q.propertyName))&&(O.removeEventListener("transitionend",N),O._moveCb=null,na(O,A))};O.addEventListener("transitionend",N)})}),()=>{const A=zi(r),s=H1(A);let D=A.tag||or;x=T,T=u.default?cg(u.default()):[];for(let O=0;O<T.length;O++){const F=T[O];F.key!=null&&zc(F,Vh(F,s,y,p))}if(x)for(let O=0;O<x.length;O++){const F=x[O];zc(F,Vh(F,s,y,p)),Y1.set(F,F.el.getBoundingClientRect())}return Lt(D,null,T)}}},aC=sC;function lC(r){const u=r.el;u._moveCb&&u._moveCb(),u._enterCb&&u._enterCb()}function cC(r){J1.set(r,r.el.getBoundingClientRect())}function uC(r){const u=Y1.get(r),p=J1.get(r),y=u.left-p.left,x=u.top-p.top;if(y||x){const T=r.el.style;return T.transform=T.webkitTransform=`translate(${y}px,${x}px)`,T.transitionDuration="0s",r}}function hC(r,u,p){const y=r.cloneNode();r._vtc&&r._vtc.forEach(A=>{A.split(/\s+/).forEach(s=>s&&y.classList.remove(s))}),p.split(/\s+/).forEach(A=>A&&y.classList.add(A)),y.style.display="none";const x=u.nodeType===1?u:u.parentNode;x.appendChild(y);const{hasTransform:T}=X1(y);return x.removeChild(y),T}const dC=Yn({patchProp:tC},VS);let Zx;function fC(){return Zx||(Zx=gS(dC))}const Q1=(...r)=>{const u=fC().createApp(...r),{mount:p}=u;return u.mount=y=>{const x=pC(y);if(!x)return;const T=u._component;!Si(T)&&!T.render&&!T.template&&(T.template=x.innerHTML),x.innerHTML="";const A=p(x,!1,x instanceof SVGElement);return x instanceof Element&&(x.removeAttribute("v-cloak"),x.setAttribute("data-v-app","")),A},u};function pC(r){return $n(r)?document.querySelector(r):r}function Ep(r,u,p,y){return Object.defineProperty(r,u,{get:p,set:y,enumerable:!0}),r}const Co=Ot(!1);let Sp;function mC(r,u){const p=/(edg|edge|edga|edgios)\/([\w.]+)/.exec(r)||/(opr)[\/]([\w.]+)/.exec(r)||/(vivaldi)[\/]([\w.]+)/.exec(r)||/(chrome|crios)[\/]([\w.]+)/.exec(r)||/(version)(applewebkit)[\/]([\w.]+).*(safari)[\/]([\w.]+)/.exec(r)||/(webkit)[\/]([\w.]+).*(version)[\/]([\w.]+).*(safari)[\/]([\w.]+)/.exec(r)||/(firefox|fxios)[\/]([\w.]+)/.exec(r)||/(webkit)[\/]([\w.]+)/.exec(r)||/(opera)(?:.*version|)[\/]([\w.]+)/.exec(r)||[];return{browser:p[5]||p[3]||p[1]||"",version:p[2]||p[4]||"0",versionNumber:p[4]||p[2]||"0",platform:u[0]||""}}function _C(r){return/(ipad)/.exec(r)||/(ipod)/.exec(r)||/(windows phone)/.exec(r)||/(iphone)/.exec(r)||/(kindle)/.exec(r)||/(silk)/.exec(r)||/(android)/.exec(r)||/(win)/.exec(r)||/(mac)/.exec(r)||/(linux)/.exec(r)||/(cros)/.exec(r)||/(playbook)/.exec(r)||/(bb)/.exec(r)||/(blackberry)/.exec(r)||[]}const eb="ontouchstart"in window||window.navigator.maxTouchPoints>0;function gC(r){Sp={is:{...r}},delete r.mac,delete r.desktop;const u=Math.min(window.innerHeight,window.innerWidth)>414?"ipad":"iphone";Object.assign(r,{mobile:!0,ios:!0,platform:u,[u]:!0})}function yC(r){const u=r.toLowerCase(),p=_C(u),y=mC(u,p),x={};y.browser&&(x[y.browser]=!0,x.version=y.version,x.versionNumber=parseInt(y.versionNumber,10)),y.platform&&(x[y.platform]=!0);const T=x.android||x.ios||x.bb||x.blackberry||x.ipad||x.iphone||x.ipod||x.kindle||x.playbook||x.silk||x["windows phone"];return T===!0||u.indexOf("mobile")>-1?(x.mobile=!0,x.edga||x.edgios?(x.edge=!0,y.browser="edge"):x.crios?(x.chrome=!0,y.browser="chrome"):x.fxios&&(x.firefox=!0,y.browser="firefox")):x.desktop=!0,(x.ipod||x.ipad||x.iphone)&&(x.ios=!0),x["windows phone"]&&(x.winphone=!0,delete x["windows phone"]),(x.chrome||x.opr||x.safari||x.vivaldi||x.mobile===!0&&x.ios!==!0&&T!==!0)&&(x.webkit=!0),x.edg&&(y.browser="edgechromium",x.edgeChromium=!0),(x.safari&&x.blackberry||x.bb)&&(y.browser="blackberry",x.blackberry=!0),x.safari&&x.playbook&&(y.browser="playbook",x.playbook=!0),x.opr&&(y.browser="opera",x.opera=!0),x.safari&&x.android&&(y.browser="android",x.android=!0),x.safari&&x.kindle&&(y.browser="kindle",x.kindle=!0),x.safari&&x.silk&&(y.browser="silk",x.silk=!0),x.vivaldi&&(y.browser="vivaldi",x.vivaldi=!0),x.name=y.browser,x.platform=y.platform,u.indexOf("electron")>-1?x.electron=!0:document.location.href.indexOf("-extension://")>-1?x.bex=!0:(window.Capacitor!==void 0?(x.capacitor=!0,x.nativeMobile=!0,x.nativeMobileWrapper="capacitor"):(window._cordovaNative!==void 0||window.cordova!==void 0)&&(x.cordova=!0,x.nativeMobile=!0,x.nativeMobileWrapper="cordova"),eb===!0&&x.mac===!0&&(x.desktop===!0&&x.safari===!0||x.nativeMobile===!0&&x.android!==!0&&x.ios!==!0&&x.ipad!==!0)&&gC(x)),x}const Wx=navigator.userAgent||navigator.vendor||window.opera,vC={has:{touch:!1,webStorage:!1},within:{iframe:!1}},pn={userAgent:Wx,is:yC(Wx),has:{touch:eb},within:{iframe:window.self!==window.top}},tp={install(r){const{$q:u}=r;Co.value===!0?(r.onSSRHydrated.push(()=>{Co.value=!1,Object.assign(u.platform,pn),Sp=void 0}),u.platform=xo(this)):u.platform=this}};{let r;Ep(pn.has,"webStorage",()=>{if(r!==void 0)return r;try{if(window.localStorage)return r=!0,!0}catch{}return r=!1,!1}),pn.is.ios===!0&&window.navigator.vendor.toLowerCase().indexOf("apple"),Co.value===!0?Object.assign(tp,pn,Sp,vC):Object.assign(tp,pn)}const Cp=(r,u)=>{const p=xo(r);for(const y in r)Ep(u,y,()=>p[y],x=>{p[y]=x});return u},Rn={hasPassive:!1,passiveCapture:!0,notPassiveCapture:!0};try{const r=Object.defineProperty({},"passive",{get(){Object.assign(Rn,{hasPassive:!0,passive:{passive:!0},notPassive:{passive:!1},passiveCapture:{passive:!0,capture:!0},notPassiveCapture:{passive:!1,capture:!0}})}});window.addEventListener("qtest",null,r),window.removeEventListener("qtest",null,r)}catch{}function Ko(){}function xC(r){return r.button===0}function ip(r){return r.touches&&r.touches[0]?r=r.touches[0]:r.changedTouches&&r.changedTouches[0]?r=r.changedTouches[0]:r.targetTouches&&r.targetTouches[0]&&(r=r.targetTouches[0]),{top:r.clientY,left:r.clientX}}function bC(r){if(r.path)return r.path;if(r.composedPath)return r.composedPath();const u=[];let p=r.target;for(;p;){if(u.push(p),p.tagName==="HTML")return u.push(document),u.push(window),u;p=p.parentElement}}function Wo(r){r.stopPropagation()}function Nr(r){r.cancelable!==!1&&r.preventDefault()}function xn(r){r.cancelable!==!1&&r.preventDefault(),r.stopPropagation()}function h_(r,u){if(r===void 0||u===!0&&r.__dragPrevented===!0)return;const p=u===!0?y=>{y.__dragPrevented=!0,y.addEventListener("dragstart",Nr,Rn.notPassiveCapture)}:y=>{delete y.__dragPrevented,y.removeEventListener("dragstart",Nr,Rn.notPassiveCapture)};r.querySelectorAll("a, img").forEach(p)}function ul(r,u,p){const y=`__q_${u}_evt`;r[y]=r[y]!==void 0?r[y].concat(p):p,p.forEach(x=>{x[0].addEventListener(x[1],r[x[2]],Rn[x[3]])})}function Lh(r,u){const p=`__q_${u}_evt`;r[p]!==void 0&&(r[p].forEach(y=>{y[0].removeEventListener(y[1],r[y[2]],Rn[y[3]])}),r[p]=void 0)}function yg(r,u=250,p){let y;function x(){const T=arguments,A=()=>{y=void 0,p!==!0&&r.apply(this,T)};clearTimeout(y),p===!0&&y===void 0&&r.apply(this,T),y=setTimeout(A,u)}return x.cancel=()=>{clearTimeout(y)},x}const d_=["sm","md","lg","xl"],{passive:Hx}=Rn,wC=Cp({width:0,height:0,name:"xs",sizes:{sm:600,md:1024,lg:1440,xl:1920},lt:{sm:!0,md:!0,lg:!0,xl:!0},gt:{xs:!1,sm:!1,md:!1,lg:!1},xs:!0,sm:!1,md:!1,lg:!1,xl:!1},{setSizes:Ko,setDebounce:Ko,install({$q:r,onSSRHydrated:u}){if(r.screen=this,this.__installed===!0){r.config.screen!==void 0&&(r.config.screen.bodyClasses===!1?document.body.classList.remove(`screen--${this.name}`):this.__update(!0));return}const{visualViewport:p}=window,y=p||window,x=document.scrollingElement||document.documentElement,T=p===void 0||pn.is.mobile===!0?()=>[Math.max(window.innerWidth,x.clientWidth),Math.max(window.innerHeight,x.clientHeight)]:()=>[p.width*p.scale+window.innerWidth-x.clientWidth,p.height*p.scale+window.innerHeight-x.clientHeight],A=r.config.screen!==void 0&&r.config.screen.bodyClasses===!0;this.__update=N=>{const[q,Z]=T();if(Z!==this.height&&(this.height=Z),q!==this.width)this.width=q;else if(N!==!0)return;let ae=this.sizes;this.gt.xs=q>=ae.sm,this.gt.sm=q>=ae.md,this.gt.md=q>=ae.lg,this.gt.lg=q>=ae.xl,this.lt.sm=q<ae.sm,this.lt.md=q<ae.md,this.lt.lg=q<ae.lg,this.lt.xl=q<ae.xl,this.xs=this.lt.sm,this.sm=this.gt.xs===!0&&this.lt.md===!0,this.md=this.gt.sm===!0&&this.lt.lg===!0,this.lg=this.gt.md===!0&&this.lt.xl===!0,this.xl=this.gt.lg,ae=this.xs===!0&&"xs"||this.sm===!0&&"sm"||this.md===!0&&"md"||this.lg===!0&&"lg"||"xl",ae!==this.name&&(A===!0&&(document.body.classList.remove(`screen--${this.name}`),document.body.classList.add(`screen--${ae}`)),this.name=ae)};let s,D={},O=16;this.setSizes=N=>{d_.forEach(q=>{N[q]!==void 0&&(D[q]=N[q])})},this.setDebounce=N=>{O=N};const F=()=>{const N=getComputedStyle(document.body);N.getPropertyValue("--q-size-sm")&&d_.forEach(q=>{this.sizes[q]=parseInt(N.getPropertyValue(`--q-size-${q}`),10)}),this.setSizes=q=>{d_.forEach(Z=>{q[Z]&&(this.sizes[Z]=q[Z])}),this.__update(!0)},this.setDebounce=q=>{s!==void 0&&y.removeEventListener("resize",s,Hx),s=q>0?yg(this.__update,q):this.__update,y.addEventListener("resize",s,Hx)},this.setDebounce(O),Object.keys(D).length>0?(this.setSizes(D),D=void 0):this.__update(),A===!0&&this.name==="xs"&&document.body.classList.add("screen--xs")};Co.value===!0?u.push(F):F()}}),pr=Cp({isActive:!1,mode:!1},{__media:void 0,set(r){pr.mode=r,r==="auto"?(pr.__media===void 0&&(pr.__media=window.matchMedia("(prefers-color-scheme: dark)"),pr.__updateMedia=()=>{pr.set("auto")},pr.__media.addListener(pr.__updateMedia)),r=pr.__media.matches):pr.__media!==void 0&&(pr.__media.removeListener(pr.__updateMedia),pr.__media=void 0),pr.isActive=r===!0,document.body.classList.remove(`body--${r===!0?"light":"dark"}`),document.body.classList.add(`body--${r===!0?"dark":"light"}`)},toggle(){pr.set(pr.isActive===!1)},install({$q:r,onSSRHydrated:u,ssrContext:p}){const{dark:y}=r.config;if(r.dark=this,this.__installed===!0&&y===void 0)return;this.isActive=y===!0;const x=y!==void 0?y:!1;if(Co.value===!0){const T=s=>{this.__fromSSR=s},A=this.set;this.set=T,T(x),u.push(()=>{this.set=A,this.set(this.__fromSSR)})}else this.set(x)}}),tb=()=>!0;function TC(r){return typeof r=="string"&&r!==""&&r!=="/"&&r!=="#/"}function EC(r){return r.startsWith("#")===!0&&(r=r.substring(1)),r.startsWith("/")===!1&&(r="/"+r),r.endsWith("/")===!0&&(r=r.substring(0,r.length-1)),"#"+r}function SC(r){if(r.backButtonExit===!1)return()=>!1;if(r.backButtonExit==="*")return tb;const u=["#/"];return Array.isArray(r.backButtonExit)===!0&&u.push(...r.backButtonExit.filter(TC).map(EC)),()=>u.includes(window.location.hash)}const jh={__history:[],add:Ko,remove:Ko,install({$q:r}){if(this.__installed===!0)return;const{cordova:u,capacitor:p}=pn.is;if(u!==!0&&p!==!0)return;const y=r.config[u===!0?"cordova":"capacitor"];if(y!==void 0&&y.backButton===!1||p===!0&&(window.Capacitor===void 0||window.Capacitor.Plugins.App===void 0))return;this.add=A=>{A.condition===void 0&&(A.condition=tb),this.__history.push(A)},this.remove=A=>{const s=this.__history.indexOf(A);s>=0&&this.__history.splice(s,1)};const x=SC(Object.assign({backButtonExit:!0},y)),T=()=>{if(this.__history.length){const A=this.__history[this.__history.length-1];A.condition()===!0&&(this.__history.pop(),A.handler())}else x()===!0?navigator.app.exitApp():window.history.back()};u===!0?document.addEventListener("deviceready",()=>{document.addEventListener("backbutton",T,!1)}):window.Capacitor.Plugins.App.addListener("backButton",T)}},Xx={isoName:"en-US",nativeName:"English (US)",label:{clear:"Clear",ok:"OK",cancel:"Cancel",close:"Close",set:"Set",select:"Select",reset:"Reset",remove:"Remove",update:"Update",create:"Create",search:"Search",filter:"Filter",refresh:"Refresh",expand:r=>r?`Expand "${r}"`:"Expand",collapse:r=>r?`Collapse "${r}"`:"Collapse"},date:{days:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),daysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),firstDayOfWeek:0,format24h:!1,pluralDay:"days"},table:{noData:"No data available",noResults:"No matching records found",loading:"Loading...",selectedRecords:r=>r===1?"1 record selected.":(r===0?"No":r)+" records selected.",recordsPerPage:"Records per page:",allRows:"All",pagination:(r,u,p)=>r+"-"+u+" of "+p,columns:"Columns"},editor:{url:"URL",bold:"Bold",italic:"Italic",strikethrough:"Strikethrough",underline:"Underline",unorderedList:"Unordered List",orderedList:"Ordered List",subscript:"Subscript",superscript:"Superscript",hyperlink:"Hyperlink",toggleFullscreen:"Toggle Fullscreen",quote:"Quote",left:"Left align",center:"Center align",right:"Right align",justify:"Justify align",print:"Print",outdent:"Decrease indentation",indent:"Increase indentation",removeFormat:"Remove formatting",formatting:"Formatting",fontSize:"Font Size",align:"Align",hr:"Insert Horizontal Rule",undo:"Undo",redo:"Redo",heading1:"Heading 1",heading2:"Heading 2",heading3:"Heading 3",heading4:"Heading 4",heading5:"Heading 5",heading6:"Heading 6",paragraph:"Paragraph",code:"Code",size1:"Very small",size2:"A bit small",size3:"Normal",size4:"Medium-large",size5:"Big",size6:"Very big",size7:"Maximum",defaultFont:"Default Font",viewSource:"View Source"},tree:{noNodes:"No nodes available",noResults:"No matching nodes found"}};function Kx(){const r=Array.isArray(navigator.languages)===!0&&navigator.languages.length>0?navigator.languages[0]:navigator.language;if(typeof r=="string")return r.split(/[-_]/).map((u,p)=>p===0?u.toLowerCase():p>1||u.length<4?u.toUpperCase():u[0].toUpperCase()+u.slice(1).toLowerCase()).join("-")}const oa=Cp({__langPack:{}},{getLocale:Kx,set(r=Xx,u){const p={...r,rtl:r.rtl===!0,getLocale:Kx};{const y=document.documentElement;y.setAttribute("dir",p.rtl===!0?"rtl":"ltr"),y.setAttribute("lang",p.isoName),p.set=oa.set,Object.assign(oa.__langPack,p),oa.props=p,oa.isoName=p.isoName,oa.nativeName=p.nativeName}},install({$q:r,lang:u,ssrContext:p}){r.lang=oa.__langPack,this.__installed===!0?u!==void 0&&this.set(u):this.set(u||Xx)}});function CC(r,u,p=document.body){if(typeof r!="string")throw new TypeError("Expected a string as propName");if(typeof u!="string")throw new TypeError("Expected a string as value");if(!(p instanceof Element))throw new TypeError("Expected a DOM element");p.style.setProperty(`--q-${r}`,u)}let ib=!1;function AC(r){ib=r.isComposing===!0}function vg(r){return ib===!0||r!==Object(r)||r.isComposing===!0||r.qKeyEvent===!0}function ua(r,u){return vg(r)===!0?!1:[].concat(u).includes(r.keyCode)}function MC(r){if(r.ios===!0)return"ios";if(r.android===!0)return"android"}function IC({is:r,has:u,within:p},y){const x=[r.desktop===!0?"desktop":"mobile",`${u.touch===!1?"no-":""}touch`];if(r.mobile===!0){const T=MC(r);T!==void 0&&x.push("platform-"+T)}if(r.nativeMobile===!0){const T=r.nativeMobileWrapper;x.push(T),x.push("native-mobile"),r.ios===!0&&(y[T]===void 0||y[T].iosStatusBarPadding!==!1)&&x.push("q-ios-padding")}else r.electron===!0?x.push("electron"):r.bex===!0&&x.push("bex");return p.iframe===!0&&x.push("within-iframe"),x}function kC(){const r=document.body.className;let u=r;Sp!==void 0&&(u=u.replace("desktop","platform-ios mobile")),pn.has.touch===!0&&(u=u.replace("no-touch","touch")),pn.within.iframe===!0&&(u+=" within-iframe"),r!==u&&(document.body.className=u)}function zC(r){for(const u in r)CC(u,r[u])}const PC={install(r){if(this.__installed!==!0){if(Co.value===!0)kC();else{const{$q:u}=r;u.config.brand!==void 0&&zC(u.config.brand);const p=IC(pn,u.config);document.body.classList.add.apply(document.body.classList,p)}pn.is.ios===!0&&document.body.addEventListener("touchstart",Ko),window.addEventListener("keydown",AC,!0)}}},DC={name:"material-icons",type:{positive:"check_circle",negative:"warning",info:"info",warning:"priority_high"},arrow:{up:"arrow_upward",right:"arrow_forward",down:"arrow_downward",left:"arrow_back",dropdown:"arrow_drop_down"},chevron:{left:"chevron_left",right:"chevron_right"},colorPicker:{spectrum:"gradient",tune:"tune",palette:"style"},pullToRefresh:{icon:"refresh"},carousel:{left:"chevron_left",right:"chevron_right",up:"keyboard_arrow_up",down:"keyboard_arrow_down",navigationIcon:"lens"},chip:{remove:"cancel",selected:"check"},datetime:{arrowLeft:"chevron_left",arrowRight:"chevron_right",now:"access_time",today:"today"},editor:{bold:"format_bold",italic:"format_italic",strikethrough:"strikethrough_s",underline:"format_underlined",unorderedList:"format_list_bulleted",orderedList:"format_list_numbered",subscript:"vertical_align_bottom",superscript:"vertical_align_top",hyperlink:"link",toggleFullscreen:"fullscreen",quote:"format_quote",left:"format_align_left",center:"format_align_center",right:"format_align_right",justify:"format_align_justify",print:"print",outdent:"format_indent_decrease",indent:"format_indent_increase",removeFormat:"format_clear",formatting:"text_format",fontSize:"format_size",align:"format_align_left",hr:"remove",undo:"undo",redo:"redo",heading:"format_size",code:"code",size:"format_size",font:"font_download",viewSource:"code"},expansionItem:{icon:"keyboard_arrow_down",denseIcon:"arrow_drop_down"},fab:{icon:"add",activeIcon:"close"},field:{clear:"cancel",error:"error"},pagination:{first:"first_page",prev:"keyboard_arrow_left",next:"keyboard_arrow_right",last:"last_page"},rating:{icon:"grade"},stepper:{done:"check",active:"edit",error:"warning"},tabs:{left:"chevron_left",right:"chevron_right",up:"keyboard_arrow_up",down:"keyboard_arrow_down"},table:{arrowUp:"arrow_upward",warning:"warning",firstPage:"first_page",prevPage:"chevron_left",nextPage:"chevron_right",lastPage:"last_page"},tree:{icon:"play_arrow"},uploader:{done:"done",clear:"clear",add:"add_box",upload:"cloud_upload",removeQueue:"clear_all",removeUploaded:"done_all"}},np=Cp({iconMapFn:null,__icons:{}},{set(r,u){const p={...r,rtl:r.rtl===!0};p.set=np.set,Object.assign(np.__icons,p)},install({$q:r,iconSet:u,ssrContext:p}){r.config.iconMapFn!==void 0&&(this.iconMapFn=r.config.iconMapFn),r.iconSet=this.__icons,Ep(r,"iconMapFn",()=>this.iconMapFn,y=>{this.iconMapFn=y}),this.__installed===!0?u!==void 0&&this.set(u):this.set(u||DC)}}),nb="_q_",rb="_q_t_",Hh="_q_l_",LC="_q_pc_",ob="_q_f_",sb="_q_fo_",rp={};let ab=!1;function BC(){ab=!0}function sa(r,u){if(r===u)return!0;if(r!==null&&u!==null&&typeof r=="object"&&typeof u=="object"){if(r.constructor!==u.constructor)return!1;let p,y;if(r.constructor===Array){if(p=r.length,p!==u.length)return!1;for(y=p;y--!==0;)if(sa(r[y],u[y])!==!0)return!1;return!0}if(r.constructor===Map){if(r.size!==u.size)return!1;for(y=r.entries().next();y.done!==!0;){if(u.has(y.value[0])!==!0)return!1;y=y.next()}for(y=r.entries().next();y.done!==!0;){if(sa(y.value[1],u.get(y.value[0]))!==!0)return!1;y=y.next()}return!0}if(r.constructor===Set){if(r.size!==u.size)return!1;for(y=r.entries().next();y.done!==!0;){if(u.has(y.value[0])!==!0)return!1;y=y.next()}return!0}if(r.buffer!=null&&r.buffer.constructor===ArrayBuffer){if(p=r.length,p!==u.length)return!1;for(y=p;y--!==0;)if(r[y]!==u[y])return!1;return!0}if(r.constructor===RegExp)return r.source===u.source&&r.flags===u.flags;if(r.valueOf!==Object.prototype.valueOf)return r.valueOf()===u.valueOf();if(r.toString!==Object.prototype.toString)return r.toString()===u.toString();const x=Object.keys(r).filter(T=>r[T]!==void 0);if(p=x.length,p!==Object.keys(u).filter(T=>u[T]!==void 0).length)return!1;for(y=p;y--!==0;){const T=x[y];if(sa(r[T],u[T])!==!0)return!1}return!0}return r!==r&&u!==u}function qh(r){return r!==null&&typeof r=="object"&&Array.isArray(r)!==!0}function RC(r){return typeof r=="number"&&isFinite(r)}const Yx=[tp,PC,pr,wC,jh,oa,np];function OC(r,u){const p=Q1(r);p.config.globalProperties=u.config.globalProperties;const{reload:y,...x}=u._context;return Object.assign(p._context,x),p}function Jx(r,u){u.forEach(p=>{p.install(r),p.__installed=!0})}function FC(r,u,p){r.config.globalProperties.$q=p.$q,r.provide(nb,p.$q),Jx(p,Yx),u.components!==void 0&&Object.values(u.components).forEach(y=>{qh(y)===!0&&y.name!==void 0&&r.component(y.name,y)}),u.directives!==void 0&&Object.values(u.directives).forEach(y=>{qh(y)===!0&&y.name!==void 0&&r.directive(y.name,y)}),u.plugins!==void 0&&Jx(p,Object.values(u.plugins).filter(y=>typeof y.install=="function"&&Yx.includes(y)===!1)),Co.value===!0&&(p.$q.onSSRHydrated=()=>{p.onSSRHydrated.forEach(y=>{y()}),p.$q.onSSRHydrated=()=>{}})}const VC=function(r,u={}){const p={version:"2.9.2"};ab===!1?(u.config!==void 0&&Object.assign(rp,u.config),p.config={...rp},BC()):p.config=u.config||{},FC(r,u,{parentApp:r,$q:p,lang:u.lang,iconSet:u.iconSet,onSSRHydrated:[]})},UC={version:"2.9.2",install:VC,lang:oa,iconSet:np},R_={xs:18,sm:24,md:32,lg:38,xl:46},Vc={size:String};function Uc(r,u=R_){return ve(()=>r.size!==void 0?{fontSize:r.size in u?`${u[r.size]}px`:r.size}:null)}const Vi=r=>Wh(XE(r)),xg=r=>Wh(r);function bn(r,u){return r!==void 0&&r()||u}function bg(r,u){if(r!==void 0){const p=r();if(p!=null)return p.slice()}return u}function Jr(r,u){return r!==void 0?u.concat(r()):u}function wg(r,u){return r===void 0?u:u!==void 0?u.concat(r()):r()}function lb(r,u,p,y,x,T){u.key=y+x;const A=Te(r,u,p);return x===!0?dg(A,T()):A}const Qx="0 0 24 24",e0=r=>r,f_=r=>`ionicons ${r}`,cb={"mdi-":r=>`mdi ${r}`,"icon-":e0,"bt-":r=>`bt ${r}`,"eva-":r=>`eva ${r}`,"ion-md":f_,"ion-ios":f_,"ion-logo":f_,"iconfont ":e0,"ti-":r=>`themify-icon ${r}`,"bi-":r=>`bootstrap-icons ${r}`},ub={o_:"-outlined",r_:"-round",s_:"-sharp"},hb={sym_o_:"-outlined",sym_r_:"-rounded",sym_s_:"-sharp"},NC=new RegExp("^("+Object.keys(cb).join("|")+")"),jC=new RegExp("^("+Object.keys(ub).join("|")+")"),t0=new RegExp("^("+Object.keys(hb).join("|")+")"),qC=/^[Mm]\s?[-+]?\.?\d/,$C=/^img:/,GC=/^svguse:/,ZC=/^ion-/,WC=/^(fa-(solid|regular|light|brands|duotone|thin)|[lf]a[srlbdk]?) /,kn=Vi({name:"QIcon",props:{...Vc,tag:{type:String,default:"i"},name:String,color:String,left:Boolean,right:Boolean},setup(r,{slots:u}){const{proxy:{$q:p}}=Pi(),y=Uc(r),x=ve(()=>"q-icon"+(r.left===!0?" on-left":"")+(r.right===!0?" on-right":"")+(r.color!==void 0?` text-${r.color}`:"")),T=ve(()=>{let A,s=r.name;if(s==="none"||!s)return{none:!0};if(p.iconMapFn!==null){const F=p.iconMapFn(s);if(F!==void 0)if(F.icon!==void 0){if(s=F.icon,s==="none"||!s)return{none:!0}}else return{cls:F.cls,content:F.content!==void 0?F.content:" "}}if(qC.test(s)===!0){const[F,N=Qx]=s.split("|");return{svg:!0,viewBox:N,nodes:F.split("&&").map(q=>{const[Z,ae,le]=q.split("@@");return Te("path",{style:ae,d:Z,transform:le})})}}if($C.test(s)===!0)return{img:!0,src:s.substring(4)};if(GC.test(s)===!0){const[F,N=Qx]=s.split("|");return{svguse:!0,src:F.substring(7),viewBox:N}}let D=" ";const O=s.match(NC);if(O!==null)A=cb[O[1]](s);else if(WC.test(s)===!0)A=s;else if(ZC.test(s)===!0)A=`ionicons ion-${p.platform.is.ios===!0?"ios":"md"}${s.substring(3)}`;else if(t0.test(s)===!0){A="notranslate material-symbols";const F=s.match(t0);F!==null&&(s=s.substring(6),A+=hb[F[1]]),D=s}else{A="notranslate material-icons";const F=s.match(jC);F!==null&&(s=s.substring(2),A+=ub[F[1]]),D=s}return{cls:A,content:D}});return()=>{const A={class:x.value,style:y.value,"aria-hidden":"true",role:"presentation"};return T.value.none===!0?Te(r.tag,A,bn(u.default)):T.value.img===!0?Te("span",A,Jr(u.default,[Te("img",{src:T.value.src})])):T.value.svg===!0?Te("span",A,Jr(u.default,[Te("svg",{viewBox:T.value.viewBox||"0 0 24 24"},T.value.nodes)])):T.value.svguse===!0?Te("span",A,Jr(u.default,[Te("svg",{viewBox:T.value.viewBox},[Te("use",{"xlink:href":T.value.src})])])):(T.value.cls!==void 0&&(A.class+=" "+T.value.cls),Te(r.tag,A,Jr(u.default,[T.value.content])))}}}),HC=Vi({name:"QAvatar",props:{...Vc,fontSize:String,color:String,textColor:String,icon:String,square:Boolean,rounded:Boolean},setup(r,{slots:u}){const p=Uc(r),y=ve(()=>"q-avatar"+(r.color?` bg-${r.color}`:"")+(r.textColor?` text-${r.textColor} q-chip--colored`:"")+(r.square===!0?" q-avatar--square":r.rounded===!0?" rounded-borders":"")),x=ve(()=>r.fontSize?{fontSize:r.fontSize}:null);return()=>{const T=r.icon!==void 0?[Te(kn,{name:r.icon})]:void 0;return Te("div",{class:y.value,style:p.value},[Te("div",{class:"q-avatar__content row flex-center overflow-hidden",style:x.value},wg(u.default,T))])}}}),XC={size:{type:[Number,String],default:"1em"},color:String};function KC(r){return{cSize:ve(()=>r.size in R_?`${R_[r.size]}px`:r.size),classes:ve(()=>"q-spinner"+(r.color?` text-${r.color}`:""))}}const Ap=Vi({name:"QSpinner",props:{...XC,thickness:{type:Number,default:5}},setup(r){const{cSize:u,classes:p}=KC(r);return()=>Te("svg",{class:p.value+" q-spinner-mat",width:u.value,height:u.value,viewBox:"25 25 50 50"},[Te("circle",{class:"path",cx:"50",cy:"50",r:"20",fill:"none",stroke:"currentColor","stroke-width":r.thickness,"stroke-miterlimit":"10"})])}});function O_(r,u){const p=r.style;for(const y in u)p[y]=u[y]}function YC(r){if(r==null)return;if(typeof r=="string")try{return document.querySelector(r)||void 0}catch{return}const u=sg(r);if(u)return u.$el||u}function db(r,u){if(r==null||r.contains(u)===!0)return!0;for(let p=r.nextElementSibling;p!==null;p=p.nextElementSibling)if(p.contains(u))return!0;return!1}function JC(r,u=250){let p=!1,y;return function(){return p===!1&&(p=!0,setTimeout(()=>{p=!1},u),y=r.apply(this,arguments)),y}}function i0(r,u,p,y){p.modifiers.stop===!0&&Wo(r);const x=p.modifiers.color;let T=p.modifiers.center;T=T===!0||y===!0;const A=document.createElement("span"),s=document.createElement("span"),D=ip(r),{left:O,top:F,width:N,height:q}=u.getBoundingClientRect(),Z=Math.sqrt(N*N+q*q),ae=Z/2,le=`${(N-Z)/2}px`,xe=T?le:`${D.left-O-ae}px`,He=`${(q-Z)/2}px`,Ee=T?He:`${D.top-F-ae}px`;s.className="q-ripple__inner",O_(s,{height:`${Z}px`,width:`${Z}px`,transform:`translate3d(${xe},${Ee},0) scale3d(.2,.2,1)`,opacity:0}),A.className=`q-ripple${x?" text-"+x:""}`,A.setAttribute("dir","ltr"),A.appendChild(s),u.appendChild(A);const Le=()=>{A.remove(),clearTimeout(Ne)};p.abort.push(Le);let Ne=setTimeout(()=>{s.classList.add("q-ripple__inner--enter"),s.style.transform=`translate3d(${le},${He},0) scale3d(1,1,1)`,s.style.opacity=.2,Ne=setTimeout(()=>{s.classList.remove("q-ripple__inner--enter"),s.classList.add("q-ripple__inner--leave"),s.style.opacity=0,Ne=setTimeout(()=>{A.remove(),p.abort.splice(p.abort.indexOf(Le),1)},275)},250)},50)}function n0(r,{modifiers:u,value:p,arg:y}){const x=Object.assign({},r.cfg.ripple,u,p);r.modifiers={early:x.early===!0,stop:x.stop===!0,center:x.center===!0,color:x.color||y,keyCodes:[].concat(x.keyCodes||13)}}const fb=xg({name:"ripple",beforeMount(r,u){const p=u.instance.$.appContext.config.globalProperties.$q.config||{};if(p.ripple===!1)return;const y={cfg:p,enabled:u.value!==!1,modifiers:{},abort:[],start(x){y.enabled===!0&&x.qSkipRipple!==!0&&x.type===(y.modifiers.early===!0?"pointerdown":"click")&&i0(x,r,y,x.qKeyEvent===!0)},keystart:JC(x=>{y.enabled===!0&&x.qSkipRipple!==!0&&ua(x,y.modifiers.keyCodes)===!0&&x.type===`key${y.modifiers.early===!0?"down":"up"}`&&i0(x,r,y,!0)},300)};n0(y,u),r.__qripple=y,ul(y,"main",[[r,"pointerdown","start","passive"],[r,"click","start","passive"],[r,"keydown","keystart","passive"],[r,"keyup","keystart","passive"]])},updated(r,u){if(u.oldValue!==u.value){const p=r.__qripple;p!==void 0&&(p.enabled=u.value!==!1,p.enabled===!0&&Object(u.value)===u.value&&n0(p,u))}},beforeUnmount(r){const u=r.__qripple;u!==void 0&&(u.abort.forEach(p=>{p()}),Lh(u,"main"),delete r._qripple)}}),pb={left:"start",center:"center",right:"end",between:"between",around:"around",evenly:"evenly",stretch:"stretch"},QC=Object.keys(pb),eA={align:{type:String,validator:r=>QC.includes(r)}};function tA(r){return ve(()=>{const u=r.align===void 0?r.vertical===!0?"stretch":"left":r.align;return`${r.vertical===!0?"items":"justify"}-${pb[u]}`})}function $f(r){if(Object(r.$parent)===r.$parent)return r.$parent;let{parent:u}=r.$;for(;Object(u)===u;){if(Object(u.proxy)===u.proxy)return u.proxy;u=u.parent}}function mb(r,u){typeof u.type=="symbol"?Array.isArray(u.children)===!0&&u.children.forEach(p=>{mb(r,p)}):r.add(u)}function _b(r){const u=new Set;return r.forEach(p=>{mb(u,p)}),Array.from(u)}function Tg(r){return r.appContext.config.globalProperties.$router!==void 0}function Eg(r){return r.isUnmounted===!0||r.isDeactivated===!0}function r0(r){return r?r.aliasOf?r.aliasOf.path:r.path:""}function o0(r,u){return(r.aliasOf||r)===(u.aliasOf||u)}function iA(r,u){for(const p in u){const y=u[p],x=r[p];if(typeof y=="string"){if(y!==x)return!1}else if(Array.isArray(x)===!1||x.length!==y.length||y.some((T,A)=>T!==x[A]))return!1}return!0}function s0(r,u){return Array.isArray(u)===!0?r.length===u.length&&r.every((p,y)=>p===u[y]):r.length===1&&r[0]===u}function nA(r,u){return Array.isArray(r)===!0?s0(r,u):Array.isArray(u)===!0?s0(u,r):r===u}function rA(r,u){if(Object.keys(r).length!==Object.keys(u).length)return!1;for(const p in r)if(nA(r[p],u[p])===!1)return!1;return!0}const gb={to:[String,Object],replace:Boolean,exact:Boolean,activeClass:{type:String,default:"q-router-link--active"},exactActiveClass:{type:String,default:"q-router-link--exact-active"},href:String,target:String,disable:Boolean};function yb({fallbackTag:r,useDisableForRouterLinkProps:u=!0}={}){const p=Pi(),{props:y,proxy:x,emit:T}=p,A=Tg(p),s=ve(()=>y.disable!==!0&&y.href!==void 0),D=ve(u===!0?()=>A===!0&&y.disable!==!0&&s.value!==!0&&y.to!==void 0&&y.to!==null&&y.to!=="":()=>A===!0&&s.value!==!0&&y.to!==void 0&&y.to!==null&&y.to!==""),O=ve(()=>D.value===!0?Ee(y.to):null),F=ve(()=>O.value!==null),N=ve(()=>s.value===!0||F.value===!0),q=ve(()=>y.type==="a"||N.value===!0?"a":y.tag||r||"div"),Z=ve(()=>s.value===!0?{href:y.href,target:y.target}:F.value===!0?{href:O.value.href,target:y.target}:{}),ae=ve(()=>{if(F.value===!1)return-1;const{matched:Se}=O.value,{length:Pe}=Se,we=Se[Pe-1];if(we===void 0)return-1;const De=x.$route.matched;if(De.length===0)return-1;const Ke=De.findIndex(o0.bind(null,we));if(Ke>-1)return Ke;const Ue=r0(Se[Pe-2]);return Pe>1&&r0(we)===Ue&&De[De.length-1].path!==Ue?De.findIndex(o0.bind(null,Se[Pe-2])):Ke}),le=ve(()=>F.value===!0&&ae.value!==-1&&iA(x.$route.params,O.value.params)),xe=ve(()=>le.value===!0&&ae.value===x.$route.matched.length-1&&rA(x.$route.params,O.value.params)),He=ve(()=>F.value===!0?xe.value===!0?` ${y.exactActiveClass} ${y.activeClass}`:y.exact===!0?"":le.value===!0?` ${y.activeClass}`:"":"");function Ee(Se){try{return x.$router.resolve(Se)}catch{}return null}function Le(Se,{returnRouterError:Pe,to:we=y.to,replace:De=y.replace}={}){if(y.disable===!0)return Se.preventDefault(),Promise.resolve(!1);if(Se.metaKey||Se.altKey||Se.ctrlKey||Se.shiftKey||Se.button!==void 0&&Se.button!==0||y.target==="_blank")return Promise.resolve(!1);Se.preventDefault();const Ke=x.$router[De===!0?"replace":"push"](we);return Pe===!0?Ke:Ke.then(()=>{}).catch(()=>{})}function Ne(Se){if(F.value===!0){const Pe=we=>Le(Se,we);T("click",Se,Pe),Se.defaultPrevented!==!0&&Pe()}else T("click",Se)}return{hasRouterLink:F,hasHrefLink:s,hasLink:N,linkTag:q,resolvedLink:O,linkIsActive:le,linkIsExactActive:xe,linkClass:He,linkAttrs:Z,getLink:Ee,navigateToRouterLink:Le,navigateOnClick:Ne}}const a0={none:0,xs:4,sm:8,md:16,lg:24,xl:32},oA={xs:8,sm:10,md:14,lg:20,xl:24},sA=["button","submit","reset"],aA=/[^\s]\/[^\s]/,lA={...Vc,...gb,type:{type:String,default:"button"},label:[Number,String],icon:String,iconRight:String,round:Boolean,square:Boolean,outline:Boolean,flat:Boolean,unelevated:Boolean,rounded:Boolean,push:Boolean,glossy:Boolean,size:String,fab:Boolean,fabMini:Boolean,padding:String,color:String,textColor:String,noCaps:Boolean,noWrap:Boolean,dense:Boolean,tabindex:[Number,String],ripple:{type:[Boolean,Object],default:!0},align:{...eA.align,default:"center"},stack:Boolean,stretch:Boolean,loading:{type:Boolean,default:null},disable:Boolean};function cA(r){const u=Uc(r,oA),p=tA(r),{hasRouterLink:y,hasLink:x,linkTag:T,linkAttrs:A,navigateOnClick:s}=yb({fallbackTag:"button"}),D=ve(()=>{const xe=r.fab===!1&&r.fabMini===!1?u.value:{};return r.padding!==void 0?Object.assign({},xe,{padding:r.padding.split(/\s+/).map(He=>He in a0?a0[He]+"px":He).join(" "),minWidth:"0",minHeight:"0"}):xe}),O=ve(()=>r.rounded===!0||r.fab===!0||r.fabMini===!0),F=ve(()=>r.disable!==!0&&r.loading!==!0),N=ve(()=>F.value===!0?r.tabindex||0:-1),q=ve(()=>r.flat===!0?"flat":r.outline===!0?"outline":r.push===!0?"push":r.unelevated===!0?"unelevated":"standard"),Z=ve(()=>{const xe={tabindex:N.value};return x.value===!0?Object.assign(xe,A.value):sA.includes(r.type)===!0&&(xe.type=r.type),T.value==="a"?(r.disable===!0?xe["aria-disabled"]="true":xe.href===void 0&&(xe.role="button"),y.value!==!0&&aA.test(r.type)===!0&&(xe.type=r.type)):r.disable===!0&&(xe.disabled="",xe["aria-disabled"]="true"),r.loading===!0&&r.percentage!==void 0&&Object.assign(xe,{role:"progressbar","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":r.percentage}),xe}),ae=ve(()=>{let xe;r.color!==void 0?r.flat===!0||r.outline===!0?xe=`text-${r.textColor||r.color}`:xe=`bg-${r.color} text-${r.textColor||"white"}`:r.textColor&&(xe=`text-${r.textColor}`);const He=r.round===!0?"round":`rectangle${O.value===!0?" q-btn--rounded":r.square===!0?" q-btn--square":""}`;return`q-btn--${q.value} q-btn--${He}`+(xe!==void 0?" "+xe:"")+(F.value===!0?" q-btn--actionable q-focusable q-hoverable":r.disable===!0?" disabled":"")+(r.fab===!0?" q-btn--fab":r.fabMini===!0?" q-btn--fab-mini":"")+(r.noCaps===!0?" q-btn--no-uppercase":"")+(r.dense===!0?" q-btn--dense":"")+(r.stretch===!0?" no-border-radius self-stretch":"")+(r.glossy===!0?" glossy":"")+(r.square?" q-btn--square":"")}),le=ve(()=>p.value+(r.stack===!0?" column":" row")+(r.noWrap===!0?" no-wrap text-no-wrap":"")+(r.loading===!0?" q-btn__content--hidden":""));return{classes:ae,style:D,innerClasses:le,attributes:Z,hasLink:x,linkTag:T,navigateOnClick:s,isActionable:F}}const{passiveCapture:Kr}=Rn;let _c=null,gc=null,yc=null;const Qr=Vi({name:"QBtn",props:{...lA,percentage:Number,darkPercentage:Boolean,onTouchstart:[Function,Array]},emits:["click","keydown","mousedown","keyup"],setup(r,{slots:u,emit:p}){const{proxy:y}=Pi(),{classes:x,style:T,innerClasses:A,attributes:s,hasLink:D,linkTag:O,navigateOnClick:F,isActionable:N}=cA(r),q=Ot(null),Z=Ot(null);let ae=null,le,xe;const He=ve(()=>r.label!==void 0&&r.label!==null&&r.label!==""),Ee=ve(()=>r.disable===!0||r.ripple===!1?!1:{keyCodes:D.value===!0?[13,32]:[13],...r.ripple===!0?{}:r.ripple}),Le=ve(()=>({center:r.round})),Ne=ve(()=>{const Ye=Math.max(0,Math.min(100,r.percentage));return Ye>0?{transition:"transform 0.6s",transform:`translateX(${Ye-100}%)`}:{}}),Se=ve(()=>{if(r.loading===!0)return{onMousedown:Ge,onTouchstart:Ge,onClick:Ge,onKeydown:Ge,onKeyup:Ge};if(N.value===!0){const Ye={onClick:we,onKeydown:De,onMousedown:Ue};if(y.$q.platform.has.touch===!0){const Ft=r.onTouchstart!==void 0?"":"Passive";Ye[`onTouchstart${Ft}`]=Ke}return Ye}return{onClick:xn}}),Pe=ve(()=>({ref:q,class:"q-btn q-btn-item non-selectable no-outline "+x.value,style:T.value,...s.value,...Se.value}));function we(Ye){if(q.value!==null){if(Ye!==void 0){if(Ye.defaultPrevented===!0)return;const Ft=document.activeElement;if(r.type==="submit"&&Ft!==document.body&&q.value.contains(Ft)===!1&&Ft.contains(q.value)===!1){q.value.focus();const Ht=()=>{document.removeEventListener("keydown",xn,!0),document.removeEventListener("keyup",Ht,Kr),q.value!==null&&q.value.removeEventListener("blur",Ht,Kr)};document.addEventListener("keydown",xn,!0),document.addEventListener("keyup",Ht,Kr),q.value.addEventListener("blur",Ht,Kr)}}F(Ye)}}function De(Ye){q.value!==null&&(p("keydown",Ye),ua(Ye,[13,32])===!0&&gc!==q.value&&(gc!==null&&$e(),Ye.defaultPrevented!==!0&&(q.value.focus(),gc=q.value,q.value.classList.add("q-btn--active"),document.addEventListener("keyup",nt,!0),q.value.addEventListener("blur",nt,Kr)),xn(Ye)))}function Ke(Ye){q.value!==null&&(p("touchstart",Ye),Ye.defaultPrevented!==!0&&(_c!==q.value&&(_c!==null&&$e(),_c=q.value,ae=Ye.target,ae.addEventListener("touchcancel",nt,Kr),ae.addEventListener("touchend",nt,Kr)),le=!0,clearTimeout(xe),xe=setTimeout(()=>{le=!1},200)))}function Ue(Ye){q.value!==null&&(Ye.qSkipRipple=le===!0,p("mousedown",Ye),Ye.defaultPrevented!==!0&&yc!==q.value&&(yc!==null&&$e(),yc=q.value,q.value.classList.add("q-btn--active"),document.addEventListener("mouseup",nt,Kr)))}function nt(Ye){if(q.value!==null&&!(Ye!==void 0&&Ye.type==="blur"&&document.activeElement===q.value)){if(Ye!==void 0&&Ye.type==="keyup"){if(gc===q.value&&ua(Ye,[13,32])===!0){const Ft=new MouseEvent("click",Ye);Ft.qKeyEvent=!0,Ye.defaultPrevented===!0&&Nr(Ft),Ye.cancelBubble===!0&&Wo(Ft),q.value.dispatchEvent(Ft),xn(Ye),Ye.qKeyEvent=!0}p("keyup",Ye)}$e()}}function $e(Ye){const Ft=Z.value;Ye!==!0&&(_c===q.value||yc===q.value)&&Ft!==null&&Ft!==document.activeElement&&(Ft.setAttribute("tabindex",-1),Ft.focus()),_c===q.value&&(ae!==null&&(ae.removeEventListener("touchcancel",nt,Kr),ae.removeEventListener("touchend",nt,Kr)),_c=ae=null),yc===q.value&&(document.removeEventListener("mouseup",nt,Kr),yc=null),gc===q.value&&(document.removeEventListener("keyup",nt,!0),q.value!==null&&q.value.removeEventListener("blur",nt,Kr),gc=null),q.value!==null&&q.value.classList.remove("q-btn--active")}function Ge(Ye){xn(Ye),Ye.qSkipRipple=!0}return _n(()=>{$e(!0)}),Object.assign(y,{click:we}),()=>{let Ye=[];r.icon!==void 0&&Ye.push(Te(kn,{name:r.icon,left:r.stack===!1&&He.value===!0,role:"img","aria-hidden":"true"})),He.value===!0&&Ye.push(Te("span",{class:"block"},[r.label])),Ye=Jr(u.default,Ye),r.iconRight!==void 0&&r.round===!1&&Ye.push(Te(kn,{name:r.iconRight,right:r.stack===!1&&He.value===!0,role:"img","aria-hidden":"true"}));const Ft=[Te("span",{class:"q-focus-helper",ref:Z})];return r.loading===!0&&r.percentage!==void 0&&Ft.push(Te("span",{class:"q-btn__progress absolute-full overflow-hidden"+(r.darkPercentage===!0?" q-btn__progress--dark":"")},[Te("span",{class:"q-btn__progress-indicator fit block",style:Ne.value})])),Ft.push(Te("span",{class:"q-btn__content text-center col items-center q-anchor--skip "+A.value},Ye)),r.loading!==null&&Ft.push(Te(bs,{name:"q-transition--fade"},()=>r.loading===!0?[Te("span",{key:"loading",class:"absolute-full flex flex-center"},u.loading!==void 0?u.loading():[Te(Ap)])]:null)),dg(Te(O.value,Pe.value,Ft),[[fb,Ee.value,void 0,Le.value]])}}});let uA=document.body;function vb(r){const u=document.createElement("div");if(r!==void 0&&(u.id=r),rp.globalNodes!==void 0){const p=rp.globalNodes.class;p!==void 0&&(u.className=p)}return uA.appendChild(u),u}function hA(r){r.remove()}let dA=0;const Gf={},Zf={},go={},xb={},fA=/^\s*$/,bb=[],Sg=["top-left","top-right","bottom-left","bottom-right","top","bottom","left","right","center"],pA=["top-left","top-right","bottom-left","bottom-right"],wc={positive:{icon:r=>r.iconSet.type.positive,color:"positive"},negative:{icon:r=>r.iconSet.type.negative,color:"negative"},warning:{icon:r=>r.iconSet.type.warning,color:"warning",textColor:"dark"},info:{icon:r=>r.iconSet.type.info,color:"info"},ongoing:{group:!1,timeout:0,spinner:!0,color:"grey-8"}};function wb(r,u,p){if(!r)return vh("parameter required");let y;const x={textColor:"white"};if(r.ignoreDefaults!==!0&&Object.assign(x,Gf),qh(r)===!1&&(x.type&&Object.assign(x,wc[x.type]),r={message:r}),Object.assign(x,wc[r.type||x.type],r),typeof x.icon=="function"&&(x.icon=x.icon(u)),x.spinner?(x.spinner===!0&&(x.spinner=Ap),x.spinner=Wh(x.spinner)):x.spinner=!1,x.meta={hasMedia:Boolean(x.spinner!==!1||x.icon||x.avatar),hasText:l0(x.message)||l0(x.caption)},x.position){if(Sg.includes(x.position)===!1)return vh("wrong position",r)}else x.position="bottom";if(x.timeout===void 0)x.timeout=5e3;else{const D=parseInt(x.timeout,10);if(isNaN(D)||D<0)return vh("wrong timeout",r);x.timeout=D}x.timeout===0?x.progress=!1:x.progress===!0&&(x.meta.progressClass="q-notification__progress"+(x.progressClass?` ${x.progressClass}`:""),x.meta.progressStyle={animationDuration:`${x.timeout+1e3}ms`});const T=(Array.isArray(r.actions)===!0?r.actions:[]).concat(r.ignoreDefaults!==!0&&Array.isArray(Gf.actions)===!0?Gf.actions:[]).concat(wc[r.type]!==void 0&&Array.isArray(wc[r.type].actions)===!0?wc[r.type].actions:[]),{closeBtn:A}=x;if(A&&T.push({label:typeof A=="string"?A:u.lang.label.close}),x.actions=T.map(({handler:D,noDismiss:O,...F})=>({flat:!0,...F,onClick:typeof D=="function"?()=>{D(),O!==!0&&s()}:()=>{s()}})),x.multiLine===void 0&&(x.multiLine=x.actions.length>1),Object.assign(x.meta,{class:`q-notification row items-stretch q-notification--${x.multiLine===!0?"multi-line":"standard"}`+(x.color!==void 0?` bg-${x.color}`:"")+(x.textColor!==void 0?` text-${x.textColor}`:"")+(x.classes!==void 0?` ${x.classes}`:""),wrapperClass:"q-notification__wrapper col relative-position border-radius-inherit "+(x.multiLine===!0?"column no-wrap justify-center":"row items-center"),contentClass:"q-notification__content row items-center"+(x.multiLine===!0?"":" col"),leftClass:x.meta.hasText===!0?"additional":"single",attrs:{role:"alert",...x.attrs}}),x.group===!1?(x.group=void 0,x.meta.group=void 0):((x.group===void 0||x.group===!0)&&(x.group=[x.message,x.caption,x.multiline].concat(x.actions.map(D=>`${D.label}*${D.icon}`)).join("|")),x.meta.group=x.group+"|"+x.position),x.actions.length===0?x.actions=void 0:x.meta.actionsClass="q-notification__actions row items-center "+(x.multiLine===!0?"justify-end":"col-auto")+(x.meta.hasMedia===!0?" q-notification__actions--with-media":""),p!==void 0){clearTimeout(p.notif.meta.timer),x.meta.uid=p.notif.meta.uid;const D=go[x.position].value.indexOf(p.notif);go[x.position].value[D]=x}else{const D=Zf[x.meta.group];if(D===void 0){if(x.meta.uid=dA++,x.meta.badge=1,["left","right","center"].indexOf(x.position)!==-1)go[x.position].value.splice(Math.floor(go[x.position].value.length/2),0,x);else{const O=x.position.indexOf("top")>-1?"unshift":"push";go[x.position].value[O](x)}x.group!==void 0&&(Zf[x.meta.group]=x)}else{if(clearTimeout(D.meta.timer),x.badgePosition!==void 0){if(pA.includes(x.badgePosition)===!1)return vh("wrong badgePosition",r)}else x.badgePosition=`top-${x.position.indexOf("left")>-1?"right":"left"}`;x.meta.uid=D.meta.uid,x.meta.badge=D.meta.badge+1,x.meta.badgeClass=`q-notification__badge q-notification__badge--${x.badgePosition}`+(x.badgeColor!==void 0?` bg-${x.badgeColor}`:"")+(x.badgeTextColor!==void 0?` text-${x.badgeTextColor}`:"")+(x.badgeClass?` ${x.badgeClass}`:"");const O=go[x.position].value.indexOf(D);go[x.position].value[O]=Zf[x.meta.group]=x}}const s=()=>{mA(x),y=void 0};if(x.timeout>0&&(x.meta.timer=setTimeout(()=>{s()},x.timeout+1e3)),x.group!==void 0)return D=>{D!==void 0?vh("trying to update a grouped one which is forbidden",r):s()};if(y={dismiss:s,config:r,notif:x},p!==void 0){Object.assign(p,y);return}return D=>{if(y!==void 0)if(D===void 0)y.dismiss();else{const O=Object.assign({},y.config,D,{group:!1,position:x.position});wb(O,u,y)}}}function mA(r){clearTimeout(r.meta.timer);const u=go[r.position].value.indexOf(r);if(u!==-1){r.group!==void 0&&delete Zf[r.meta.group];const p=bb[""+r.meta.uid];if(p){const{width:y,height:x}=getComputedStyle(p);p.style.left=`${p.offsetLeft}px`,p.style.width=y,p.style.height=x}go[r.position].value.splice(u,1),typeof r.onDismiss=="function"&&r.onDismiss()}}function l0(r){return r!=null&&fA.test(r)!==!0}function vh(r,u){return console.error(`Notify: ${r}`,u),!1}function _A(){return Vi({name:"QNotifications",devtools:{hide:!0},setup(){return()=>Te("div",{class:"q-notifications"},Sg.map(r=>Te(aC,{key:r,class:xb[r],tag:"div",name:`q-notification--${r}`},()=>go[r].value.map(u=>{const p=u.meta,y=[];if(p.hasMedia===!0&&(u.spinner!==!1?y.push(Te(u.spinner,{class:"q-notification__spinner q-notification__spinner--"+p.leftClass,color:u.spinnerColor,size:u.spinnerSize})):u.icon?y.push(Te(kn,{class:"q-notification__icon q-notification__icon--"+p.leftClass,name:u.icon,color:u.iconColor,size:u.iconSize,role:"img"})):u.avatar&&y.push(Te(HC,{class:"q-notification__avatar q-notification__avatar--"+p.leftClass},()=>Te("img",{src:u.avatar,"aria-hidden":"true"})))),p.hasText===!0){let T;const A={class:"q-notification__message col"};if(u.html===!0)A.innerHTML=u.caption?`<div>${u.message}</div><div class="q-notification__caption">${u.caption}</div>`:u.message;else{const s=[u.message];T=u.caption?[Te("div",s),Te("div",{class:"q-notification__caption"},[u.caption])]:s}y.push(Te("div",A,T))}const x=[Te("div",{class:p.contentClass},y)];return u.progress===!0&&x.push(Te("div",{key:`${p.uid}|p|${p.badge}`,class:p.progressClass,style:p.progressStyle})),u.actions!==void 0&&x.push(Te("div",{class:p.actionsClass},u.actions.map(T=>Te(Qr,T)))),p.badge>1&&x.push(Te("div",{key:`${p.uid}|${p.badge}`,class:u.meta.badgeClass,style:u.badgeStyle},[p.badge])),Te("div",{ref:T=>{bb[""+p.uid]=T},key:p.uid,class:p.class,...p.attrs},[Te("div",{class:p.wrapperClass},x)])}))))}})}const Tb={setDefaults(r){qh(r)===!0&&Object.assign(Gf,r)},registerType(r,u){qh(u)===!0&&(wc[r]=u)},install({$q:r,parentApp:u}){if(r.notify=this.create=p=>wb(p,r),r.notify.setDefaults=this.setDefaults,r.notify.registerType=this.registerType,r.config.notify!==void 0&&this.setDefaults(r.config.notify),this.__installed!==!0){Sg.forEach(y=>{go[y]=Ot([]);const x=["left","center","right"].includes(y)===!0?"center":y.indexOf("top")>-1?"top":"bottom",T=y.indexOf("left")>-1?"start":y.indexOf("right")>-1?"end":"center",A=["left","right"].includes(y)?`items-${y==="left"?"start":"end"} justify-center`:y==="center"?"flex-center":`items-${T}`;xb[y]=`q-notifications__list q-notifications__list--${x} fixed column no-wrap ${A}`});const p=vb("q-notify");OC(_A(),u).mount(p)}}};const gA={ratio:[String,Number]};function yA(r,u){return ve(()=>{const p=Number(r.ratio||(u!==void 0?u.value:void 0));return isNaN(p)!==!0&&p>0?{paddingBottom:`${100/p}%`}:null})}const vA=16/9,Eb=Vi({name:"QImg",props:{...gA,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:vA},placeholderSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(r,{slots:u,emit:p}){const y=Ot(r.initialRatio),x=yA(r,y);let T;const A=[Ot(null),Ot(r.placeholderSrc!==void 0?{src:r.placeholderSrc}:null)],s=Ot(0),D=Ot(!1),O=Ot(!1),F=ve(()=>`q-img q-img--${r.noNativeMenu===!0?"no-":""}menu`),N=ve(()=>({width:r.width,height:r.height})),q=ve(()=>`q-img__image ${r.imgClass!==void 0?r.imgClass+" ":""}q-img__image--with${r.noTransition===!0?"out":""}-transition`),Z=ve(()=>({...r.imgStyle,objectFit:r.fit,objectPosition:r.position}));ri(()=>ae(),le);function ae(){return r.src||r.srcset||r.sizes?{src:r.src,srcset:r.srcset,sizes:r.sizes}:null}function le(we){if(clearTimeout(T),O.value=!1,we===null){D.value=!1,A[0].value=null,A[1].value=null;return}D.value=!0,A[s.value].value=we}function xe({target:we}){T!==null&&(clearTimeout(T),y.value=we.naturalHeight===0?.5:we.naturalWidth/we.naturalHeight,He(we,1))}function He(we,De){T===null||De===1e3||(we.complete===!0?Ee(we):T=setTimeout(()=>{He(we,De+1)},50))}function Ee(we){T!==null&&(s.value=s.value===1?0:1,A[s.value].value=null,D.value=!1,O.value=!1,p("load",we.currentSrc||we.src))}function Le(we){clearTimeout(T),D.value=!1,O.value=!0,A[0].value=null,A[1].value=null,p("error",we)}function Ne(we,De){return Te("div",{class:"q-img__container absolute-full",key:we},De)}function Se(we){const De=A[we].value,Ke={key:"img_"+we,class:q.value,style:Z.value,crossorigin:r.crossorigin,decoding:r.decoding,referrerpolicy:r.referrerpolicy,height:r.height,width:r.width,loading:r.loading,fetchpriority:r.fetchpriority,"aria-hidden":"true",draggable:r.draggable,...De};return s.value===we?(Ke.class+=" q-img__image--waiting",Object.assign(Ke,{onLoad:xe,onError:Le})):Ke.class+=" q-img__image--loaded",Ne("img"+we,Te("img",Ke))}function Pe(){return D.value!==!0?Te("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},bn(u[O.value===!0?"error":"default"])):Te("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},u.loading!==void 0?u.loading():r.noSpinner===!0?void 0:[Te(Ap,{color:r.spinnerColor,size:r.spinnerSize})])}return le(ae()),_n(()=>{clearTimeout(T),T=null}),()=>{const we=[];return x.value!==null&&we.push(Te("div",{key:"filler",style:x.value})),O.value!==!0&&(A[0].value!==null&&we.push(Se(0)),A[1].value!==null&&we.push(Se(1))),we.push(Te(bs,{name:"q-transition--fade"},Pe)),Te("div",{class:F.value,style:N.value,role:"img","aria-label":r.alt},we)}}});function xA(){const r=Ot(!Co.value);return r.value===!1&&ar(()=>{r.value=!0}),r}const Sb=typeof ResizeObserver<"u",c0=Sb===!0?{}:{style:"display:block;position:absolute;top:0;left:0;right:0;bottom:0;height:100%;width:100%;overflow:hidden;pointer-events:none;z-index:-1;",url:"about:blank"},op=Vi({name:"QResizeObserver",props:{debounce:{type:[String,Number],default:100}},emits:["resize"],setup(r,{emit:u}){let p=null,y,x={width:-1,height:-1};function T(F){F===!0||r.debounce===0||r.debounce==="0"?A():p===null&&(p=setTimeout(A,r.debounce))}function A(){if(clearTimeout(p),p=null,y){const{offsetWidth:F,offsetHeight:N}=y;(F!==x.width||N!==x.height)&&(x={width:F,height:N},u("resize",x))}}const{proxy:s}=Pi();if(Sb===!0){let F;return ar(()=>{fn(()=>{y=s.$el.parentNode,y&&(F=new ResizeObserver(T),F.observe(y),A())})}),_n(()=>{clearTimeout(p),F!==void 0&&(F.disconnect!==void 0?F.disconnect():y&&F.unobserve(y))}),Ko}else{let q=function(){clearTimeout(p),N!==void 0&&(N.removeEventListener!==void 0&&N.removeEventListener("resize",T,Rn.passive),N=void 0)},Z=function(){q(),y&&y.contentDocument&&(N=y.contentDocument.defaultView,N.addEventListener("resize",T,Rn.passive),A())};var D=q,O=Z;const F=xA();let N;return ar(()=>{fn(()=>{y=s.$el,y&&Z()})}),_n(q),s.trigger=T,()=>{if(F.value===!0)return Te("object",{style:c0.style,tabindex:-1,type:"text/html",data:c0.url,"aria-hidden":"true",onLoad:Z})}}}}),bA=Vi({name:"QHeader",props:{modelValue:{type:Boolean,default:!0},reveal:Boolean,revealOffset:{type:Number,default:250},bordered:Boolean,elevated:Boolean,heightHint:{type:[String,Number],default:50}},emits:["reveal","focusin"],setup(r,{slots:u,emit:p}){const{proxy:{$q:y}}=Pi(),x=Eo(Hh,()=>{console.error("QHeader needs to be child of QLayout")}),T=Ot(parseInt(r.heightHint,10)),A=Ot(!0),s=ve(()=>r.reveal===!0||x.view.value.indexOf("H")>-1||y.platform.is.ios&&x.isContainer.value===!0),D=ve(()=>{if(r.modelValue!==!0)return 0;if(s.value===!0)return A.value===!0?T.value:0;const Ee=T.value-x.scroll.value.position;return Ee>0?Ee:0}),O=ve(()=>r.modelValue!==!0||s.value===!0&&A.value!==!0),F=ve(()=>r.modelValue===!0&&O.value===!0&&r.reveal===!0),N=ve(()=>"q-header q-layout__section--marginal "+(s.value===!0?"fixed":"absolute")+"-top"+(r.bordered===!0?" q-header--bordered":"")+(O.value===!0?" q-header--hidden":"")+(r.modelValue!==!0?" q-layout--prevent-focus":"")),q=ve(()=>{const Ee=x.rows.value.top,Le={};return Ee[0]==="l"&&x.left.space===!0&&(Le[y.lang.rtl===!0?"right":"left"]=`${x.left.size}px`),Ee[2]==="r"&&x.right.space===!0&&(Le[y.lang.rtl===!0?"left":"right"]=`${x.right.size}px`),Le});function Z(Ee,Le){x.update("header",Ee,Le)}function ae(Ee,Le){Ee.value!==Le&&(Ee.value=Le)}function le({height:Ee}){ae(T,Ee),Z("size",Ee)}function xe(Ee){F.value===!0&&ae(A,!0),p("focusin",Ee)}ri(()=>r.modelValue,Ee=>{Z("space",Ee),ae(A,!0),x.animate()}),ri(D,Ee=>{Z("offset",Ee)}),ri(()=>r.reveal,Ee=>{Ee===!1&&ae(A,r.modelValue)}),ri(A,Ee=>{x.animate(),p("reveal",Ee)}),ri(x.scroll,Ee=>{r.reveal===!0&&ae(A,Ee.direction==="up"||Ee.position<=r.revealOffset||Ee.position-Ee.inflectionPoint<100)});const He={};return x.instances.header=He,r.modelValue===!0&&Z("size",T.value),Z("space",r.modelValue),Z("offset",D.value),_n(()=>{x.instances.header===He&&(x.instances.header=void 0,Z("size",0),Z("offset",0),Z("space",!1))}),()=>{const Ee=bg(u.default,[]);return r.elevated===!0&&Ee.push(Te("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),Ee.push(Te(op,{debounce:0,onResize:le})),Te("header",{class:N.value,style:q.value,onFocusin:xe},Ee)}}}),wA={position:{type:String,default:"bottom-right",validator:r=>["top-right","top-left","bottom-right","bottom-left","top","right","bottom","left"].includes(r)},offset:{type:Array,validator:r=>r.length===2},expand:Boolean};function TA(){const{props:r,proxy:{$q:u}}=Pi(),p=Eo(Hh,()=>{console.error("QPageSticky needs to be child of QLayout")}),y=ve(()=>{const N=r.position;return{top:N.indexOf("top")>-1,right:N.indexOf("right")>-1,bottom:N.indexOf("bottom")>-1,left:N.indexOf("left")>-1,vertical:N==="top"||N==="bottom",horizontal:N==="left"||N==="right"}}),x=ve(()=>p.header.offset),T=ve(()=>p.right.offset),A=ve(()=>p.footer.offset),s=ve(()=>p.left.offset),D=ve(()=>{let N=0,q=0;const Z=y.value,ae=u.lang.rtl===!0?-1:1;Z.top===!0&&x.value!==0?q=`${x.value}px`:Z.bottom===!0&&A.value!==0&&(q=`${-A.value}px`),Z.left===!0&&s.value!==0?N=`${ae*s.value}px`:Z.right===!0&&T.value!==0&&(N=`${-ae*T.value}px`);const le={transform:`translate(${N}, ${q})`};return r.offset&&(le.margin=`${r.offset[1]}px ${r.offset[0]}px`),Z.vertical===!0?(s.value!==0&&(le[u.lang.rtl===!0?"right":"left"]=`${s.value}px`),T.value!==0&&(le[u.lang.rtl===!0?"left":"right"]=`${T.value}px`)):Z.horizontal===!0&&(x.value!==0&&(le.top=`${x.value}px`),A.value!==0&&(le.bottom=`${A.value}px`)),le}),O=ve(()=>`q-page-sticky row flex-center fixed-${r.position} q-page-sticky--${r.expand===!0?"expand":"shrink"}`);function F(N){const q=bn(N.default);return Te("div",{class:O.value,style:D.value},r.expand===!0?q:[Te("div",q)])}return{$layout:p,getStickyContent:F}}const EA=Vi({name:"QPageSticky",props:wA,setup(r,{slots:u}){const{getStickyContent:p}=TA();return()=>p(u)}}),SA=Vi({name:"QPageContainer",setup(r,{slots:u}){const{proxy:{$q:p}}=Pi(),y=Eo(Hh,()=>{console.error("QPageContainer needs to be child of QLayout")});Oc(LC,!0);const x=ve(()=>{const T={};return y.header.space===!0&&(T.paddingTop=`${y.header.size}px`),y.right.space===!0&&(T[`padding${p.lang.rtl===!0?"Left":"Right"}`]=`${y.right.size}px`),y.footer.space===!0&&(T.paddingBottom=`${y.footer.size}px`),y.left.space===!0&&(T[`padding${p.lang.rtl===!0?"Right":"Left"}`]=`${y.left.size}px`),T});return()=>Te("div",{class:"q-page-container",style:x.value},bn(u.default))}}),u0=Vi({name:"QChatMessage",props:{sent:Boolean,label:String,bgColor:String,textColor:String,name:String,avatar:String,text:Array,stamp:String,size:String,labelHtml:Boolean,nameHtml:Boolean,textHtml:Boolean,stampHtml:Boolean},setup(r,{slots:u}){const p=ve(()=>r.sent===!0?"sent":"received"),y=ve(()=>`q-message-text-content q-message-text-content--${p.value}`+(r.textColor!==void 0?` text-${r.textColor}`:"")),x=ve(()=>`q-message-text q-message-text--${p.value}`+(r.bgColor!==void 0?` text-${r.bgColor}`:"")),T=ve(()=>"q-message-container row items-end no-wrap"+(r.sent===!0?" reverse":"")),A=ve(()=>r.size!==void 0?`col-${r.size}`:""),s=ve(()=>({msg:r.textHtml===!0?"innerHTML":"textContent",stamp:r.stampHtml===!0?"innerHTML":"textContent",name:r.nameHtml===!0?"innerHTML":"textContent",label:r.labelHtml===!0?"innerHTML":"textContent"}));function D(F){return u.stamp!==void 0?[F,Te("div",{class:"q-message-stamp"},u.stamp())]:r.stamp?[F,Te("div",{class:"q-message-stamp",[s.value.stamp]:r.stamp})]:[F]}function O(F,N){const q=N===!0?F.length>1?Z=>Z:Z=>Te("div",[Z]):Z=>Te("div",{[s.value.msg]:Z});return F.map((Z,ae)=>Te("div",{key:ae,class:x.value},[Te("div",{class:y.value},D(q(Z)))]))}return()=>{const F=[];u.avatar!==void 0?F.push(u.avatar()):r.avatar!==void 0&&F.push(Te("img",{class:`q-message-avatar q-message-avatar--${p.value}`,src:r.avatar,"aria-hidden":"true"}));const N=[];u.name!==void 0?N.push(Te("div",{class:`q-message-name q-message-name--${p.value}`},u.name())):r.name!==void 0&&N.push(Te("div",{class:`q-message-name q-message-name--${p.value}`,[s.value.name]:r.name})),u.default!==void 0?N.push(O(_b(u.default()),!0)):r.text!==void 0&&N.push(O(r.text)),F.push(Te("div",{class:A.value},N));const q=[];return u.label!==void 0?q.push(Te("div",{class:"q-message-label"},u.label())):r.label!==void 0&&q.push(Te("div",{class:"q-message-label",[s.value.label]:r.label})),q.push(Te("div",{class:T.value},F)),Te("div",{class:`q-message q-message-${p.value}`},q)}}}),CA=Vi({name:"QToolbar",props:{inset:Boolean},setup(r,{slots:u}){const p=ve(()=>"q-toolbar row no-wrap items-center"+(r.inset===!0?" q-toolbar--inset":""));return()=>Te("div",{class:p.value},bn(u.default))}}),AA=Vi({name:"QFooter",props:{modelValue:{type:Boolean,default:!0},reveal:Boolean,bordered:Boolean,elevated:Boolean,heightHint:{type:[String,Number],default:50}},emits:["reveal","focusin"],setup(r,{slots:u,emit:p}){const{proxy:{$q:y}}=Pi(),x=Eo(Hh,()=>{console.error("QFooter needs to be child of QLayout")}),T=Ot(parseInt(r.heightHint,10)),A=Ot(!0),s=Ot(Co.value===!0||x.isContainer.value===!0?0:window.innerHeight),D=ve(()=>r.reveal===!0||x.view.value.indexOf("F")>-1||y.platform.is.ios&&x.isContainer.value===!0),O=ve(()=>x.isContainer.value===!0?x.containerHeight.value:s.value),F=ve(()=>{if(r.modelValue!==!0)return 0;if(D.value===!0)return A.value===!0?T.value:0;const Se=x.scroll.value.position+O.value+T.value-x.height.value;return Se>0?Se:0}),N=ve(()=>r.modelValue!==!0||D.value===!0&&A.value!==!0),q=ve(()=>r.modelValue===!0&&N.value===!0&&r.reveal===!0),Z=ve(()=>"q-footer q-layout__section--marginal "+(D.value===!0?"fixed":"absolute")+"-bottom"+(r.bordered===!0?" q-footer--bordered":"")+(N.value===!0?" q-footer--hidden":"")+(r.modelValue!==!0?" q-layout--prevent-focus"+(D.value!==!0?" hidden":""):"")),ae=ve(()=>{const Se=x.rows.value.bottom,Pe={};return Se[0]==="l"&&x.left.space===!0&&(Pe[y.lang.rtl===!0?"right":"left"]=`${x.left.size}px`),Se[2]==="r"&&x.right.space===!0&&(Pe[y.lang.rtl===!0?"left":"right"]=`${x.right.size}px`),Pe});function le(Se,Pe){x.update("footer",Se,Pe)}function xe(Se,Pe){Se.value!==Pe&&(Se.value=Pe)}function He({height:Se}){xe(T,Se),le("size",Se)}function Ee(){if(r.reveal!==!0)return;const{direction:Se,position:Pe,inflectionPoint:we}=x.scroll.value;xe(A,Se==="up"||Pe-we<100||x.height.value-O.value-Pe-T.value<300)}function Le(Se){q.value===!0&&xe(A,!0),p("focusin",Se)}ri(()=>r.modelValue,Se=>{le("space",Se),xe(A,!0),x.animate()}),ri(F,Se=>{le("offset",Se)}),ri(()=>r.reveal,Se=>{Se===!1&&xe(A,r.modelValue)}),ri(A,Se=>{x.animate(),p("reveal",Se)}),ri([T,x.scroll,x.height],Ee),ri(()=>y.screen.height,Se=>{x.isContainer.value!==!0&&xe(s,Se)});const Ne={};return x.instances.footer=Ne,r.modelValue===!0&&le("size",T.value),le("space",r.modelValue),le("offset",F.value),_n(()=>{x.instances.footer===Ne&&(x.instances.footer=void 0,le("size",0),le("offset",0),le("space",!1))}),()=>{const Se=Jr(u.default,[Te(op,{debounce:0,onResize:He})]);return r.elevated===!0&&Se.push(Te("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),Te("footer",{class:Z.value,style:ae.value,onFocusin:Le},Se)}}}),MA=[null,document,document.body,document.scrollingElement,document.documentElement];function Cb(r,u){let p=YC(u);if(p===void 0){if(r==null)return window;p=r.closest(".scroll,.scroll-y,.overflow-auto")}return MA.includes(p)?window:p}function Ab(r){return r===window?window.pageYOffset||window.scrollY||document.body.scrollTop||0:r.scrollTop}function Mb(r){return r===window?window.pageXOffset||window.scrollX||document.body.scrollLeft||0:r.scrollLeft}let Df;function Wf(){if(Df!==void 0)return Df;const r=document.createElement("p"),u=document.createElement("div");O_(r,{width:"100%",height:"200px"}),O_(u,{position:"absolute",top:"0px",left:"0px",visibility:"hidden",width:"200px",height:"150px",overflow:"hidden"}),u.appendChild(r),document.body.appendChild(u);const p=r.offsetWidth;u.style.overflow="scroll";let y=r.offsetWidth;return p===y&&(y=u.clientWidth),u.remove(),Df=p-y,Df}function IA(r,u=!0){return!r||r.nodeType!==Node.ELEMENT_NODE?!1:u?r.scrollHeight>r.clientHeight&&(r.classList.contains("scroll")||r.classList.contains("overflow-auto")||["auto","scroll"].includes(window.getComputedStyle(r)["overflow-y"])):r.scrollWidth>r.clientWidth&&(r.classList.contains("scroll")||r.classList.contains("overflow-auto")||["auto","scroll"].includes(window.getComputedStyle(r)["overflow-x"]))}const{passive:h0}=Rn,kA=["both","horizontal","vertical"],zA=Vi({name:"QScrollObserver",props:{axis:{type:String,validator:r=>kA.includes(r),default:"vertical"},debounce:[String,Number],scrollTarget:{default:void 0}},emits:["scroll"],setup(r,{emit:u}){const p={position:{top:0,left:0},direction:"down",directionChanged:!1,delta:{top:0,left:0},inflectionPoint:{top:0,left:0}};let y=null,x,T;ri(()=>r.scrollTarget,()=>{D(),s()});function A(){y!==null&&y();const N=Math.max(0,Ab(x)),q=Mb(x),Z={top:N-p.position.top,left:q-p.position.left};if(r.axis==="vertical"&&Z.top===0||r.axis==="horizontal"&&Z.left===0)return;const ae=Math.abs(Z.top)>=Math.abs(Z.left)?Z.top<0?"up":"down":Z.left<0?"left":"right";p.position={top:N,left:q},p.directionChanged=p.direction!==ae,p.delta=Z,p.directionChanged===!0&&(p.direction=ae,p.inflectionPoint=p.position),u("scroll",{...p})}function s(){x=Cb(T,r.scrollTarget),x.addEventListener("scroll",O,h0),O(!0)}function D(){x!==void 0&&(x.removeEventListener("scroll",O,h0),x=void 0)}function O(N){if(N===!0||r.debounce===0||r.debounce==="0")A();else if(y===null){const[q,Z]=r.debounce?[setTimeout(A,r.debounce),clearTimeout]:[requestAnimationFrame(A),cancelAnimationFrame];y=()=>{Z(q),y=null}}}const{proxy:F}=Pi();return ar(()=>{T=F.$el.parentNode,s()}),_n(()=>{y!==null&&y(),D()}),Object.assign(F,{trigger:O,getPosition:()=>p}),Ko}}),PA=Vi({name:"QLayout",props:{container:Boolean,view:{type:String,default:"hhh lpr fff",validator:r=>/^(h|l)h(h|r) lpr (f|l)f(f|r)$/.test(r.toLowerCase())},onScroll:Function,onScrollHeight:Function,onResize:Function},setup(r,{slots:u,emit:p}){const{proxy:{$q:y}}=Pi(),x=Ot(null),T=Ot(y.screen.height),A=Ot(r.container===!0?0:y.screen.width),s=Ot({position:0,direction:"down",inflectionPoint:0}),D=Ot(0),O=Ot(Co.value===!0?0:Wf()),F=ve(()=>"q-layout q-layout--"+(r.container===!0?"containerized":"standard")),N=ve(()=>r.container===!1?{minHeight:y.screen.height+"px"}:null),q=ve(()=>O.value!==0?{[y.lang.rtl===!0?"left":"right"]:`${O.value}px`}:null),Z=ve(()=>O.value!==0?{[y.lang.rtl===!0?"right":"left"]:0,[y.lang.rtl===!0?"left":"right"]:`-${O.value}px`,width:`calc(100% + ${O.value}px)`}:null);function ae(we){if(r.container===!0||document.qScrollPrevented!==!0){const De={position:we.position.top,direction:we.direction,directionChanged:we.directionChanged,inflectionPoint:we.inflectionPoint.top,delta:we.delta.top};s.value=De,r.onScroll!==void 0&&p("scroll",De)}}function le(we){const{height:De,width:Ke}=we;let Ue=!1;T.value!==De&&(Ue=!0,T.value=De,r.onScrollHeight!==void 0&&p("scroll-height",De),He()),A.value!==Ke&&(Ue=!0,A.value=Ke),Ue===!0&&r.onResize!==void 0&&p("resize",we)}function xe({height:we}){D.value!==we&&(D.value=we,He())}function He(){if(r.container===!0){const we=T.value>D.value?Wf():0;O.value!==we&&(O.value=we)}}let Ee;const Le={instances:{},view:ve(()=>r.view),isContainer:ve(()=>r.container),rootRef:x,height:T,containerHeight:D,scrollbarWidth:O,totalWidth:ve(()=>A.value+O.value),rows:ve(()=>{const we=r.view.toLowerCase().split(" ");return{top:we[0].split(""),middle:we[1].split(""),bottom:we[2].split("")}}),header:xo({size:0,offset:0,space:!1}),right:xo({size:300,offset:0,space:!1}),footer:xo({size:0,offset:0,space:!1}),left:xo({size:300,offset:0,space:!1}),scroll:s,animate(){Ee!==void 0?clearTimeout(Ee):document.body.classList.add("q-body--layout-animate"),Ee=setTimeout(()=>{document.body.classList.remove("q-body--layout-animate"),Ee=void 0},155)},update(we,De,Ke){Le[we][De]=Ke}};if(Oc(Hh,Le),Wf()>0){let Ke=function(){we=null,De.classList.remove("hide-scrollbar")},Ue=function(){if(we===null){if(De.scrollHeight>y.screen.height)return;De.classList.add("hide-scrollbar")}else clearTimeout(we);we=setTimeout(Ke,300)},nt=function($e){we!==null&&$e==="remove"&&(clearTimeout(we),Ke()),window[`${$e}EventListener`]("resize",Ue)};var Ne=Ke,Se=Ue,Pe=nt;let we=null;const De=document.body;ri(()=>r.container!==!0?"add":"remove",nt),r.container!==!0&&nt("add"),bp(()=>{nt("remove")})}return()=>{const we=Jr(u.default,[Te(zA,{onScroll:ae}),Te(op,{onResize:le})]),De=Te("div",{class:F.value,style:N.value,ref:r.container===!0?void 0:x,tabindex:-1},we);return r.container===!0?Te("div",{class:"q-layout-container overflow-hidden",ref:x},[Te(op,{onResize:xe}),Te("div",{class:"absolute-full",style:q.value},[Te("div",{class:"scroll",style:Z.value},[De])])]):De}}}),DA=["top","right","bottom","left"],Ib={type:{type:String,default:"a"},outline:Boolean,push:Boolean,flat:Boolean,unelevated:Boolean,color:String,textColor:String,glossy:Boolean,square:Boolean,padding:String,label:{type:[String,Number],default:""},labelPosition:{type:String,default:"right",validator:r=>DA.includes(r)},externalLabel:Boolean,hideLabel:{type:Boolean},labelClass:[Array,String,Object],labelStyle:[Array,String,Object],disable:Boolean,tabindex:[Number,String]};function kb(r,u){return{formClass:ve(()=>`q-fab--form-${r.square===!0?"square":"rounded"}`),stacked:ve(()=>r.externalLabel===!1&&["top","bottom"].includes(r.labelPosition)),labelProps:ve(()=>{if(r.externalLabel===!0){const p=r.hideLabel===null?u.value===!1:r.hideLabel;return{action:"push",data:{class:[r.labelClass,`q-fab__label q-tooltip--style q-fab__label--external q-fab__label--external-${r.labelPosition}`+(p===!0?" q-fab__label--external-hidden":"")],style:r.labelStyle}}}return{action:["left","top"].includes(r.labelPosition)?"unshift":"push",data:{class:[r.labelClass,`q-fab__label q-fab__label--internal q-fab__label--internal-${r.labelPosition}`+(r.hideLabel===!0?" q-fab__label--internal-hidden":"")],style:r.labelStyle}}})}}const zb={start:"self-end",center:"self-center",end:"self-start"},LA=Object.keys(zb),vc=Vi({name:"QFabAction",props:{...Ib,icon:{type:String,default:""},anchor:{type:String,validator:r=>LA.includes(r)},to:[String,Object],replace:Boolean},emits:["click"],setup(r,{slots:u,emit:p}){const y=Eo(ob,()=>({showing:{value:!0},onChildClick:Ko})),{formClass:x,labelProps:T}=kb(r,y.showing),A=ve(()=>{const N=zb[r.anchor];return x.value+(N!==void 0?` ${N}`:"")}),s=ve(()=>r.disable===!0||y.showing.value!==!0);function D(N){y.onChildClick(N),p("click",N)}function O(){const N=[];return u.icon!==void 0?N.push(u.icon()):r.icon!==""&&N.push(Te(kn,{name:r.icon})),(r.label!==""||u.label!==void 0)&&N[T.value.action](Te("div",T.value.data,u.label!==void 0?u.label():[r.label])),Jr(u.default,N)}const F=Pi();return Object.assign(F.proxy,{click:D}),()=>Te(Qr,{class:A.value,...r,noWrap:!0,stack:r.stacked,icon:void 0,label:void 0,noCaps:!0,fabMini:!0,disable:s.value,onClick:D},O)}}),Cg={modelValue:{type:Boolean,default:null},"onUpdate:modelValue":[Function,Array]},Ag=["before-show","show","before-hide","hide"];function Mg({showing:r,canShow:u,hideOnRouteChange:p,handleShow:y,handleHide:x,processOnMount:T}){const A=Pi(),{props:s,emit:D,proxy:O}=A;let F;function N(Ee){r.value===!0?ae(Ee):q(Ee)}function q(Ee){if(s.disable===!0||Ee!==void 0&&Ee.qAnchorHandled===!0||u!==void 0&&u(Ee)!==!0)return;const Le=s["onUpdate:modelValue"]!==void 0;Le===!0&&(D("update:modelValue",!0),F=Ee,fn(()=>{F===Ee&&(F=void 0)})),(s.modelValue===null||Le===!1)&&Z(Ee)}function Z(Ee){r.value!==!0&&(r.value=!0,D("before-show",Ee),y!==void 0?y(Ee):D("show",Ee))}function ae(Ee){if(s.disable===!0)return;const Le=s["onUpdate:modelValue"]!==void 0;Le===!0&&(D("update:modelValue",!1),F=Ee,fn(()=>{F===Ee&&(F=void 0)})),(s.modelValue===null||Le===!1)&&le(Ee)}function le(Ee){r.value!==!1&&(r.value=!1,D("before-hide",Ee),x!==void 0?x(Ee):D("hide",Ee))}function xe(Ee){s.disable===!0&&Ee===!0?s["onUpdate:modelValue"]!==void 0&&D("update:modelValue",!1):Ee===!0!==r.value&&(Ee===!0?Z:le)(F)}ri(()=>s.modelValue,xe),p!==void 0&&Tg(A)===!0&&ri(()=>O.$route.fullPath,()=>{p.value===!0&&r.value===!0&&ae()}),T===!0&&ar(()=>{xe(s.modelValue)});const He={show:q,hide:ae,toggle:N};return Object.assign(O,He),He}let p_,Lf=0;const nr=new Array(256);for(let r=0;r<256;r++)nr[r]=(r+256).toString(16).substring(1);const BA=(()=>{const r=typeof crypto<"u"?crypto:typeof window<"u"?window.crypto||window.msCrypto:void 0;if(r!==void 0){if(r.randomBytes!==void 0)return r.randomBytes;if(r.getRandomValues!==void 0)return u=>{const p=new Uint8Array(u);return r.getRandomValues(p),p}}return u=>{const p=[];for(let y=u;y>0;y--)p.push(Math.floor(Math.random()*256));return p}})(),d0=4096;function Pb(){(p_===void 0||Lf+16>d0)&&(Lf=0,p_=BA(d0));const r=Array.prototype.slice.call(p_,Lf,Lf+=16);return r[6]=r[6]&15|64,r[8]=r[8]&63|128,nr[r[0]]+nr[r[1]]+nr[r[2]]+nr[r[3]]+"-"+nr[r[4]]+nr[r[5]]+"-"+nr[r[6]]+nr[r[7]]+"-"+nr[r[8]]+nr[r[9]]+"-"+nr[r[10]]+nr[r[11]]+nr[r[12]]+nr[r[13]]+nr[r[14]]+nr[r[15]]}const RA=["up","right","down","left"],OA=["left","center","right"],FA=Vi({name:"QFab",props:{...Ib,...Cg,icon:String,activeIcon:String,hideIcon:Boolean,hideLabel:{default:null},direction:{type:String,default:"right",validator:r=>RA.includes(r)},persistent:Boolean,verticalActionsAlign:{type:String,default:"center",validator:r=>OA.includes(r)}},emits:Ag,setup(r,{slots:u}){const p=Ot(null),y=Ot(r.modelValue===!0),x=Pb(),{proxy:{$q:T}}=Pi(),{formClass:A,labelProps:s}=kb(r,y),D=ve(()=>r.persistent!==!0),{hide:O,toggle:F}=Mg({showing:y,hideOnRouteChange:D}),N=ve(()=>({opened:y.value})),q=ve(()=>`q-fab z-fab row inline justify-center q-fab--align-${r.verticalActionsAlign} ${A.value}`+(y.value===!0?" q-fab--opened":" q-fab--closed")),Z=ve(()=>`q-fab__actions flex no-wrap inline q-fab__actions--${r.direction} q-fab__actions--${y.value===!0?"opened":"closed"}`),ae=ve(()=>{const Ee={id:x};return y.value===!0?Ee.role="menu":Ee["aria-hidden"]="true",Ee}),le=ve(()=>`q-fab__icon-holder  q-fab__icon-holder--${y.value===!0?"opened":"closed"}`);function xe(Ee,Le){const Ne=u[Ee],Se=`q-fab__${Ee} absolute-full`;return Ne===void 0?Te(kn,{class:Se,name:r[Le]||T.iconSet.fab[Le]}):Te("div",{class:Se},Ne(N.value))}function He(){const Ee=[];return r.hideIcon!==!0&&Ee.push(Te("div",{class:le.value},[xe("icon","icon"),xe("active-icon","activeIcon")])),(r.label!==""||u.label!==void 0)&&Ee[s.value.action](Te("div",s.value.data,u.label!==void 0?u.label(N.value):[r.label])),Jr(u.tooltip,Ee)}return Oc(ob,{showing:y,onChildClick(Ee){O(Ee),p.value!==null&&p.value.$el.focus()}}),()=>Te("div",{class:q.value},[Te(Qr,{ref:p,class:A.value,...r,noWrap:!0,stack:r.stacked,align:void 0,icon:void 0,label:void 0,noCaps:!0,fab:!0,"aria-expanded":y.value===!0?"true":"false","aria-haspopup":"true","aria-controls":x,"aria-owns":x,onClick:F},He),Te("div",{class:Z.value,...ae.value},bn(u.default))])}}),VA={__name:"ButtonDesplegable",emits:["handleTabSelected"],setup(r,{emit:u}){return(p,y)=>(qn(),_o(FA,{"vertical-actions-align":"left","label-position":"bottom",glossy:"",color:"black",padding:"5px",icon:"menu",direction:"down","text-color":"white","label-style":{color:"white",width:"75px"}},{default:Qi(()=>[Lt(vc,{onClick:y[0]||(y[0]=x=>p.$emit("handleTabSelected","Inicio")),color:"warning",icon:"favorite",label:"Inicio","label-style":{color:"white",width:"60px",fontSize:"80%",padding:0},padding:"5px"}),Lt(vc,{onClick:y[1]||(y[1]=x=>p.$emit("handleTabSelected","Lugar")),color:"accent",icon:"room",label:"Lugar","label-style":{color:"white",width:"60px",fontSize:"80%",padding:0},padding:"5px"}),Lt(vc,{onClick:y[2]||(y[2]=x=>p.$emit("handleTabSelected","Asistencia")),color:"warning",icon:"group_add",label:"Asistencia","label-style":{color:"white",width:"60px",fontSize:"80%",padding:0},padding:"5px"}),Lt(vc,{onClick:y[3]||(y[3]=x=>p.$emit("handleTabSelected","Itinerario")),color:"accent",icon:"alarm",label:"Itinerario","label-style":{color:"white",width:"60px",fontSize:"80%",padding:0},padding:"5px"}),Lt(vc,{onClick:y[4]||(y[4]=x=>p.$emit("handleTabSelected","Regalos")),color:"warning",icon:"card_giftcard",label:"Regalos","label-style":{color:"white",width:"60px",fontSize:"80%",padding:0},padding:"5px"}),Lt(vc,{onClick:y[5]||(y[5]=x=>p.$emit("handleTabSelected","M\xFAsica")),color:"accent",icon:"music_note",label:"M\xFAsica","label-style":{color:"white",width:"60px",fontSize:"80%",padding:0},padding:"5px"})]),_:1}))}},UA="/assets/manos.293ea533.jpg",da={dark:{type:Boolean,default:null}};function fa(r,u){return ve(()=>r.dark===null?u.dark.isActive:r.dark)}function NA({validate:r,resetValidation:u,requiresQForm:p}){const y=Eo(sb,!1);if(y!==!1){const{props:x,proxy:T}=Pi();Object.assign(T,{validate:r,resetValidation:u}),ri(()=>x.disable,A=>{A===!0?(typeof u=="function"&&u(),y.unbindComponent(T)):y.bindComponent(T)}),ar(()=>{x.disable!==!0&&y.bindComponent(T)}),_n(()=>{x.disable!==!0&&y.unbindComponent(T)})}else p===!0&&console.error("Parent QForm not found on useFormChild()!")}const f0=/^#[0-9a-fA-F]{3}([0-9a-fA-F]{3})?$/,p0=/^#[0-9a-fA-F]{4}([0-9a-fA-F]{4})?$/,m0=/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{4}|[0-9a-fA-F]{6}|[0-9a-fA-F]{8})$/,Bf=/^rgb\(((0|[1-9][\d]?|1[\d]{0,2}|2[\d]?|2[0-4][\d]|25[0-5]),){2}(0|[1-9][\d]?|1[\d]{0,2}|2[\d]?|2[0-4][\d]|25[0-5])\)$/,Rf=/^rgba\(((0|[1-9][\d]?|1[\d]{0,2}|2[\d]?|2[0-4][\d]|25[0-5]),){2}(0|[1-9][\d]?|1[\d]{0,2}|2[\d]?|2[0-4][\d]|25[0-5]),(0|0\.[0-9]+[1-9]|0\.[1-9]+|1)\)$/,m_={date:r=>/^-?[\d]+\/[0-1]\d\/[0-3]\d$/.test(r),time:r=>/^([0-1]?\d|2[0-3]):[0-5]\d$/.test(r),fulltime:r=>/^([0-1]?\d|2[0-3]):[0-5]\d:[0-5]\d$/.test(r),timeOrFulltime:r=>/^([0-1]?\d|2[0-3]):[0-5]\d(:[0-5]\d)?$/.test(r),email:r=>/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(r),hexColor:r=>f0.test(r),hexaColor:r=>p0.test(r),hexOrHexaColor:r=>m0.test(r),rgbColor:r=>Bf.test(r),rgbaColor:r=>Rf.test(r),rgbOrRgbaColor:r=>Bf.test(r)||Rf.test(r),hexOrRgbColor:r=>f0.test(r)||Bf.test(r),hexaOrRgbaColor:r=>p0.test(r)||Rf.test(r),anyColor:r=>m0.test(r)||Bf.test(r)||Rf.test(r)},jA=[!0,!1,"ondemand"],qA={modelValue:{},error:{type:Boolean,default:null},errorMessage:String,noErrorIcon:Boolean,rules:Array,reactiveRules:Boolean,lazyRules:{type:[Boolean,String],validator:r=>jA.includes(r)}};function $A(r,u){const{props:p,proxy:y}=Pi(),x=Ot(!1),T=Ot(null),A=Ot(null);NA({validate:ae,resetValidation:Z});let s=0,D;const O=ve(()=>p.rules!==void 0&&p.rules!==null&&p.rules.length>0),F=ve(()=>p.disable!==!0&&O.value===!0),N=ve(()=>p.error===!0||x.value===!0),q=ve(()=>typeof p.errorMessage=="string"&&p.errorMessage.length>0?p.errorMessage:T.value);ri(()=>p.modelValue,()=>{le()}),ri(()=>p.reactiveRules,He=>{He===!0?D===void 0&&(D=ri(()=>p.rules,()=>{le(!0)})):D!==void 0&&(D(),D=void 0)},{immediate:!0}),ri(r,He=>{He===!0?A.value===null&&(A.value=!1):A.value===!1&&(A.value=!0,F.value===!0&&p.lazyRules!=="ondemand"&&u.value===!1&&xe())});function Z(){s++,u.value=!1,A.value=null,x.value=!1,T.value=null,xe.cancel()}function ae(He=p.modelValue){if(F.value!==!0)return!0;const Ee=++s,Le=u.value!==!0?()=>{A.value=!0}:()=>{},Ne=(Pe,we)=>{Pe===!0&&Le(),x.value=Pe,T.value=we||null,u.value=!1},Se=[];for(let Pe=0;Pe<p.rules.length;Pe++){const we=p.rules[Pe];let De;if(typeof we=="function"?De=we(He,m_):typeof we=="string"&&m_[we]!==void 0&&(De=m_[we](He)),De===!1||typeof De=="string")return Ne(!0,De),!1;De!==!0&&De!==void 0&&Se.push(De)}return Se.length===0?(Ne(!1),!0):(u.value=!0,Promise.all(Se).then(Pe=>{if(Pe===void 0||Array.isArray(Pe)===!1||Pe.length===0)return Ee===s&&Ne(!1),!0;const we=Pe.find(De=>De===!1||typeof De=="string");return Ee===s&&Ne(we!==void 0,we),we===void 0},Pe=>(Ee===s&&(console.error(Pe),Ne(!0)),!1)))}function le(He){F.value===!0&&p.lazyRules!=="ondemand"&&(A.value===!0||p.lazyRules!==!0&&He!==!0)&&xe()}const xe=yg(ae,0);return _n(()=>{D!==void 0&&D(),xe.cancel()}),Object.assign(y,{resetValidation:Z,validate:ae}),Ep(y,"hasError",()=>N.value),{isDirtyModel:A,hasRules:O,hasError:N,errorMessage:q,validate:ae,resetValidation:Z}}const _0=/^on[A-Z]/;function GA(r,u){const p={listeners:Ot({}),attributes:Ot({})};function y(){const x={},T={};for(const A in r)A!=="class"&&A!=="style"&&_0.test(A)===!1&&(x[A]=r[A]);for(const A in u.props)_0.test(A)===!0&&(T[A]=u.props[A]);p.attributes.value=x,p.listeners.value=T}return hg(y),y(),p}let hl=[],$h=[];function Db(r){$h=$h.filter(u=>u!==r)}function ZA(r){Db(r),$h.push(r)}function g0(r){Db(r),$h.length===0&&hl.length>0&&(hl[hl.length-1](),hl=[])}function Xh(r){$h.length===0?r():hl.push(r)}function WA(r){hl=hl.filter(u=>u!==r)}function F_(r){return r===void 0?`f_${Pb()}`:r}function Gh(r){return r!=null&&(""+r).length>0}const Mp={...da,...qA,label:String,stackLabel:Boolean,hint:String,hideHint:Boolean,prefix:String,suffix:String,labelColor:String,color:String,bgColor:String,filled:Boolean,outlined:Boolean,borderless:Boolean,standout:[Boolean,String],square:Boolean,loading:Boolean,labelSlot:Boolean,bottomSlots:Boolean,hideBottomSpace:Boolean,rounded:Boolean,dense:Boolean,itemAligned:Boolean,counter:Boolean,clearable:Boolean,clearIcon:String,disable:Boolean,readonly:Boolean,autofocus:Boolean,for:String,maxlength:[Number,String]},Ig=["update:modelValue","clear","focus","blur","popup-show","popup-hide"];function kg(){const{props:r,attrs:u,proxy:p,vnode:y}=Pi();return{isDark:fa(r,p.$q),editable:ve(()=>r.disable!==!0&&r.readonly!==!0),innerLoading:Ot(!1),focused:Ot(!1),hasPopupOpen:!1,splitAttrs:GA(u,y),targetUid:Ot(F_(r.for)),rootRef:Ot(null),targetRef:Ot(null),controlRef:Ot(null)}}function zg(r){const{props:u,emit:p,slots:y,attrs:x,proxy:T}=Pi(),{$q:A}=T;let s;r.hasValue===void 0&&(r.hasValue=ve(()=>Gh(u.modelValue))),r.emitValue===void 0&&(r.emitValue=ot=>{p("update:modelValue",ot)}),r.controlEvents===void 0&&(r.controlEvents={onFocusin:Ke,onFocusout:Ue}),Object.assign(r,{clearValue:nt,onControlFocusin:Ke,onControlFocusout:Ue,focus:we}),r.computedCounter===void 0&&(r.computedCounter=ve(()=>{if(u.counter!==!1){const ot=typeof u.modelValue=="string"||typeof u.modelValue=="number"?(""+u.modelValue).length:Array.isArray(u.modelValue)===!0?u.modelValue.length:0,At=u.maxlength!==void 0?u.maxlength:u.maxValues;return ot+(At!==void 0?" / "+At:"")}}));const{isDirtyModel:D,hasRules:O,hasError:F,errorMessage:N,resetValidation:q}=$A(r.focused,r.innerLoading),Z=r.floatingLabel!==void 0?ve(()=>u.stackLabel===!0||r.focused.value===!0||r.floatingLabel.value===!0):ve(()=>u.stackLabel===!0||r.focused.value===!0||r.hasValue.value===!0),ae=ve(()=>u.bottomSlots===!0||u.hint!==void 0||O.value===!0||u.counter===!0||u.error!==null),le=ve(()=>u.filled===!0?"filled":u.outlined===!0?"outlined":u.borderless===!0?"borderless":u.standout?"standout":"standard"),xe=ve(()=>`q-field row no-wrap items-start q-field--${le.value}`+(r.fieldClass!==void 0?` ${r.fieldClass.value}`:"")+(u.rounded===!0?" q-field--rounded":"")+(u.square===!0?" q-field--square":"")+(Z.value===!0?" q-field--float":"")+(Ee.value===!0?" q-field--labeled":"")+(u.dense===!0?" q-field--dense":"")+(u.itemAligned===!0?" q-field--item-aligned q-item-type":"")+(r.isDark.value===!0?" q-field--dark":"")+(r.getControl===void 0?" q-field--auto-height":"")+(r.focused.value===!0?" q-field--focused":"")+(F.value===!0?" q-field--error":"")+(F.value===!0||r.focused.value===!0?" q-field--highlighted":"")+(u.hideBottomSpace!==!0&&ae.value===!0?" q-field--with-bottom":"")+(u.disable===!0?" q-field--disabled":u.readonly===!0?" q-field--readonly":"")),He=ve(()=>"q-field__control relative-position row no-wrap"+(u.bgColor!==void 0?` bg-${u.bgColor}`:"")+(F.value===!0?" text-negative":typeof u.standout=="string"&&u.standout.length>0&&r.focused.value===!0?` ${u.standout}`:u.color!==void 0?` text-${u.color}`:"")),Ee=ve(()=>u.labelSlot===!0||u.label!==void 0),Le=ve(()=>"q-field__label no-pointer-events absolute ellipsis"+(u.labelColor!==void 0&&F.value!==!0?` text-${u.labelColor}`:"")),Ne=ve(()=>({id:r.targetUid.value,editable:r.editable.value,focused:r.focused.value,floatingLabel:Z.value,modelValue:u.modelValue,emitValue:r.emitValue})),Se=ve(()=>{const ot={for:r.targetUid.value};return u.disable===!0?ot["aria-disabled"]="true":u.readonly===!0&&(ot["aria-readonly"]="true"),ot});ri(()=>u.for,ot=>{r.targetUid.value=F_(ot)});function Pe(){const ot=document.activeElement;let At=r.targetRef!==void 0&&r.targetRef.value;At&&(ot===null||ot.id!==r.targetUid.value)&&(At.hasAttribute("tabindex")===!0||(At=At.querySelector("[tabindex]")),At&&At!==ot&&At.focus({preventScroll:!0}))}function we(){Xh(Pe)}function De(){WA(Pe);const ot=document.activeElement;ot!==null&&r.rootRef.value.contains(ot)&&ot.blur()}function Ke(ot){clearTimeout(s),r.editable.value===!0&&r.focused.value===!1&&(r.focused.value=!0,p("focus",ot))}function Ue(ot,At){clearTimeout(s),s=setTimeout(()=>{document.hasFocus()===!0&&(r.hasPopupOpen===!0||r.controlRef===void 0||r.controlRef.value===null||r.controlRef.value.contains(document.activeElement)!==!1)||(r.focused.value===!0&&(r.focused.value=!1,p("blur",ot)),At!==void 0&&At())})}function nt(ot){xn(ot),A.platform.is.mobile!==!0?(r.targetRef!==void 0&&r.targetRef.value||r.rootRef.value).focus():r.rootRef.value.contains(document.activeElement)===!0&&document.activeElement.blur(),u.type==="file"&&(r.inputRef.value.value=null),p("update:modelValue",null),p("clear",u.modelValue),fn(()=>{q(),A.platform.is.mobile!==!0&&(D.value=!1)})}function $e(){const ot=[];return y.prepend!==void 0&&ot.push(Te("div",{class:"q-field__prepend q-field__marginal row no-wrap items-center",key:"prepend",onClick:Nr},y.prepend())),ot.push(Te("div",{class:"q-field__control-container col relative-position row no-wrap q-anchor--skip"},Ge())),F.value===!0&&u.noErrorIcon===!1&&ot.push(Ft("error",[Te(kn,{name:A.iconSet.field.error,color:"negative"})])),u.loading===!0||r.innerLoading.value===!0?ot.push(Ft("inner-loading-append",y.loading!==void 0?y.loading():[Te(Ap,{color:u.color})])):u.clearable===!0&&r.hasValue.value===!0&&r.editable.value===!0&&ot.push(Ft("inner-clearable-append",[Te(kn,{class:"q-field__focusable-action",tag:"button",name:u.clearIcon||A.iconSet.field.clear,tabindex:0,type:"button","aria-hidden":null,role:null,onClick:nt})])),y.append!==void 0&&ot.push(Te("div",{class:"q-field__append q-field__marginal row no-wrap items-center",key:"append",onClick:Nr},y.append())),r.getInnerAppend!==void 0&&ot.push(Ft("inner-append",r.getInnerAppend())),r.getControlChild!==void 0&&ot.push(r.getControlChild()),ot}function Ge(){const ot=[];return u.prefix!==void 0&&u.prefix!==null&&ot.push(Te("div",{class:"q-field__prefix no-pointer-events row items-center"},u.prefix)),r.getShadowControl!==void 0&&r.hasShadow.value===!0&&ot.push(r.getShadowControl()),r.getControl!==void 0?ot.push(r.getControl()):y.rawControl!==void 0?ot.push(y.rawControl()):y.control!==void 0&&ot.push(Te("div",{ref:r.targetRef,class:"q-field__native row",tabindex:-1,...r.splitAttrs.attributes.value,"data-autofocus":u.autofocus===!0||void 0},y.control(Ne.value))),Ee.value===!0&&ot.push(Te("div",{class:Le.value},bn(y.label,u.label))),u.suffix!==void 0&&u.suffix!==null&&ot.push(Te("div",{class:"q-field__suffix no-pointer-events row items-center"},u.suffix)),ot.concat(bn(y.default))}function Ye(){let ot,At;F.value===!0?N.value!==null?(ot=[Te("div",{role:"alert"},N.value)],At=`q--slot-error-${N.value}`):(ot=bn(y.error),At="q--slot-error"):(u.hideHint!==!0||r.focused.value===!0)&&(u.hint!==void 0?(ot=[Te("div",u.hint)],At=`q--slot-hint-${u.hint}`):(ot=bn(y.hint),At="q--slot-hint"));const di=u.counter===!0||y.counter!==void 0;if(u.hideBottomSpace===!0&&di===!1&&ot===void 0)return;const Fe=Te("div",{key:At,class:"q-field__messages col"},ot);return Te("div",{class:"q-field__bottom row items-start q-field__bottom--"+(u.hideBottomSpace!==!0?"animated":"stale"),onClick:Nr},[u.hideBottomSpace===!0?Fe:Te(bs,{name:"q-transition--field-message"},()=>Fe),di===!0?Te("div",{class:"q-field__counter"},y.counter!==void 0?y.counter():r.computedCounter.value):null])}function Ft(ot,At){return At===null?null:Te("div",{key:ot,class:"q-field__append q-field__marginal row no-wrap items-center q-anchor--skip"},At)}let Ht=!1;return Fc(()=>{Ht=!0}),yp(()=>{Ht===!0&&u.autofocus===!0&&T.focus()}),ar(()=>{Co.value===!0&&u.for===void 0&&(r.targetUid.value=F_()),u.autofocus===!0&&T.focus()}),_n(()=>{clearTimeout(s)}),Object.assign(T,{focus:we,blur:De}),function(){const At=r.getControl===void 0&&y.control===void 0?{...r.splitAttrs.attributes.value,"data-autofocus":u.autofocus===!0||void 0,...Se.value}:Se.value;return Te("label",{ref:r.rootRef,class:[xe.value,x.class],style:x.style,...At},[y.before!==void 0?Te("div",{class:"q-field__before q-field__marginal row no-wrap items-center",onClick:Nr},y.before()):null,Te("div",{class:"q-field__inner relative-position col self-stretch"},[Te("div",{ref:r.controlRef,class:He.value,tabindex:-1,...r.controlEvents},$e()),ae.value===!0?Ye():null]),y.after!==void 0?Te("div",{class:"q-field__after q-field__marginal row no-wrap items-center",onClick:Nr},y.after()):null])}}const y0={date:"####/##/##",datetime:"####/##/## ##:##",time:"##:##",fulltime:"##:##:##",phone:"(###) ### - ####",card:"#### #### #### ####"},sp={"#":{pattern:"[\\d]",negate:"[^\\d]"},S:{pattern:"[a-zA-Z]",negate:"[^a-zA-Z]"},N:{pattern:"[0-9a-zA-Z]",negate:"[^0-9a-zA-Z]"},A:{pattern:"[a-zA-Z]",negate:"[^a-zA-Z]",transform:r=>r.toLocaleUpperCase()},a:{pattern:"[a-zA-Z]",negate:"[^a-zA-Z]",transform:r=>r.toLocaleLowerCase()},X:{pattern:"[0-9a-zA-Z]",negate:"[^0-9a-zA-Z]",transform:r=>r.toLocaleUpperCase()},x:{pattern:"[0-9a-zA-Z]",negate:"[^0-9a-zA-Z]",transform:r=>r.toLocaleLowerCase()}},Lb=Object.keys(sp);Lb.forEach(r=>{sp[r].regex=new RegExp(sp[r].pattern)});const HA=new RegExp("\\\\([^.*+?^${}()|([\\]])|([.*+?^${}()|[\\]])|(["+Lb.join("")+"])|(.)","g"),v0=/[.*+?^${}()|[\]\\]/g,jn=String.fromCharCode(1),XA={mask:String,reverseFillMask:Boolean,fillMask:[Boolean,String],unmaskedValue:Boolean};function KA(r,u,p,y){let x,T,A,s;const D=Ot(null),O=Ot(N());function F(){return r.autogrow===!0||["textarea","text","search","url","tel","password"].includes(r.type)}ri(()=>r.type+r.autogrow,Z),ri(()=>r.mask,Pe=>{if(Pe!==void 0)ae(O.value,!0);else{const we=Ne(O.value);Z(),r.modelValue!==we&&u("update:modelValue",we)}}),ri(()=>r.fillMask+r.reverseFillMask,()=>{D.value===!0&&ae(O.value,!0)}),ri(()=>r.unmaskedValue,()=>{D.value===!0&&ae(O.value)});function N(){if(Z(),D.value===!0){const Pe=Ee(Ne(r.modelValue));return r.fillMask!==!1?Se(Pe):Pe}return r.modelValue}function q(Pe){if(Pe<x.length)return x.slice(-Pe);let we="",De=x;const Ke=De.indexOf(jn);if(Ke>-1){for(let Ue=Pe-De.length;Ue>0;Ue--)we+=jn;De=De.slice(0,Ke)+we+De.slice(Ke)}return De}function Z(){if(D.value=r.mask!==void 0&&r.mask.length>0&&F(),D.value===!1){s=void 0,x="",T="";return}const Pe=y0[r.mask]===void 0?r.mask:y0[r.mask],we=typeof r.fillMask=="string"&&r.fillMask.length>0?r.fillMask.slice(0,1):"_",De=we.replace(v0,"\\$&"),Ke=[],Ue=[],nt=[];let $e=r.reverseFillMask===!0,Ge="",Ye="";Pe.replace(HA,(At,di,Fe,_t,xt)=>{if(_t!==void 0){const Bt=sp[_t];nt.push(Bt),Ye=Bt.negate,$e===!0&&(Ue.push("(?:"+Ye+"+)?("+Bt.pattern+"+)?(?:"+Ye+"+)?("+Bt.pattern+"+)?"),$e=!1),Ue.push("(?:"+Ye+"+)?("+Bt.pattern+")?")}else if(Fe!==void 0)Ge="\\"+(Fe==="\\"?"":Fe),nt.push(Fe),Ke.push("([^"+Ge+"]+)?"+Ge+"?");else{const Bt=di!==void 0?di:xt;Ge=Bt==="\\"?"\\\\\\\\":Bt.replace(v0,"\\\\$&"),nt.push(Bt),Ke.push("([^"+Ge+"]+)?"+Ge+"?")}});const Ft=new RegExp("^"+Ke.join("")+"("+(Ge===""?".":"[^"+Ge+"]")+"+)?["+Ge+"]*$"),Ht=Ue.length-1,ot=Ue.map((At,di)=>di===0&&r.reverseFillMask===!0?new RegExp("^"+De+"*"+At):di===Ht?new RegExp("^"+At+"("+(Ye===""?".":Ye)+"+)?"+(r.reverseFillMask===!0?"$":De+"*")):new RegExp("^"+At));A=nt,s=At=>{const di=Ft.exec(At);di!==null&&(At=di.slice(1).join(""));const Fe=[],_t=ot.length;for(let xt=0,Bt=At;xt<_t;xt++){const pi=ot[xt].exec(Bt);if(pi===null)break;Bt=Bt.slice(pi.shift().length),Fe.push(...pi)}return Fe.length>0?Fe.join(""):At},x=nt.map(At=>typeof At=="string"?At:jn).join(""),T=x.split(jn).join(we)}function ae(Pe,we,De){const Ke=y.value,Ue=Ke.selectionEnd,nt=Ke.value.length-Ue,$e=Ne(Pe);we===!0&&Z();const Ge=Ee($e),Ye=r.fillMask!==!1?Se(Ge):Ge,Ft=O.value!==Ye;Ke.value!==Ye&&(Ke.value=Ye),Ft===!0&&(O.value=Ye),document.activeElement===Ke&&fn(()=>{if(Ye===T){const ot=r.reverseFillMask===!0?T.length:0;Ke.setSelectionRange(ot,ot,"forward");return}if(De==="insertFromPaste"&&r.reverseFillMask!==!0){const ot=Ue-1;xe.right(Ke,ot,ot);return}if(["deleteContentBackward","deleteContentForward"].indexOf(De)>-1){const ot=r.reverseFillMask===!0?Ue===0?Ye.length>Ge.length?1:0:Math.max(0,Ye.length-(Ye===T?0:Math.min(Ge.length,nt)+1))+1:Ue;Ke.setSelectionRange(ot,ot,"forward");return}if(r.reverseFillMask===!0)if(Ft===!0){const ot=Math.max(0,Ye.length-(Ye===T?0:Math.min(Ge.length,nt+1)));ot===1&&Ue===1?Ke.setSelectionRange(ot,ot,"forward"):xe.rightReverse(Ke,ot,ot)}else{const ot=Ye.length-nt;Ke.setSelectionRange(ot,ot,"backward")}else if(Ft===!0){const ot=Math.max(0,x.indexOf(jn),Math.min(Ge.length,Ue)-1);xe.right(Ke,ot,ot)}else{const ot=Ue-1;xe.right(Ke,ot,ot)}});const Ht=r.unmaskedValue===!0?Ne(Ye):Ye;String(r.modelValue)!==Ht&&p(Ht,!0)}function le(Pe,we,De){const Ke=Ee(Ne(Pe.value));we=Math.max(0,x.indexOf(jn),Math.min(Ke.length,we)),Pe.setSelectionRange(we,De,"forward")}const xe={left(Pe,we,De,Ke){const Ue=x.slice(we-1).indexOf(jn)===-1;let nt=Math.max(0,we-1);for(;nt>=0;nt--)if(x[nt]===jn){we=nt,Ue===!0&&we++;break}if(nt<0&&x[we]!==void 0&&x[we]!==jn)return xe.right(Pe,0,0);we>=0&&Pe.setSelectionRange(we,Ke===!0?De:we,"backward")},right(Pe,we,De,Ke){const Ue=Pe.value.length;let nt=Math.min(Ue,De+1);for(;nt<=Ue;nt++)if(x[nt]===jn){De=nt;break}else x[nt-1]===jn&&(De=nt);if(nt>Ue&&x[De-1]!==void 0&&x[De-1]!==jn)return xe.left(Pe,Ue,Ue);Pe.setSelectionRange(Ke?we:De,De,"forward")},leftReverse(Pe,we,De,Ke){const Ue=q(Pe.value.length);let nt=Math.max(0,we-1);for(;nt>=0;nt--)if(Ue[nt-1]===jn){we=nt;break}else if(Ue[nt]===jn&&(we=nt,nt===0))break;if(nt<0&&Ue[we]!==void 0&&Ue[we]!==jn)return xe.rightReverse(Pe,0,0);we>=0&&Pe.setSelectionRange(we,Ke===!0?De:we,"backward")},rightReverse(Pe,we,De,Ke){const Ue=Pe.value.length,nt=q(Ue),$e=nt.slice(0,De+1).indexOf(jn)===-1;let Ge=Math.min(Ue,De+1);for(;Ge<=Ue;Ge++)if(nt[Ge-1]===jn){De=Ge,De>0&&$e===!0&&De--;break}if(Ge>Ue&&nt[De-1]!==void 0&&nt[De-1]!==jn)return xe.leftReverse(Pe,Ue,Ue);Pe.setSelectionRange(Ke===!0?we:De,De,"forward")}};function He(Pe){if(vg(Pe)===!0)return;const we=y.value,De=we.selectionStart,Ke=we.selectionEnd;if(Pe.keyCode===37||Pe.keyCode===39){const Ue=xe[(Pe.keyCode===39?"right":"left")+(r.reverseFillMask===!0?"Reverse":"")];Pe.preventDefault(),Ue(we,De,Ke,Pe.shiftKey)}else Pe.keyCode===8&&r.reverseFillMask!==!0&&De===Ke?xe.left(we,De,Ke,!0):Pe.keyCode===46&&r.reverseFillMask===!0&&De===Ke&&xe.rightReverse(we,De,Ke,!0)}function Ee(Pe){if(Pe==null||Pe==="")return"";if(r.reverseFillMask===!0)return Le(Pe);const we=A;let De=0,Ke="";for(let Ue=0;Ue<we.length;Ue++){const nt=Pe[De],$e=we[Ue];if(typeof $e=="string")Ke+=$e,nt===$e&&De++;else if(nt!==void 0&&$e.regex.test(nt))Ke+=$e.transform!==void 0?$e.transform(nt):nt,De++;else return Ke}return Ke}function Le(Pe){const we=A,De=x.indexOf(jn);let Ke=Pe.length-1,Ue="";for(let nt=we.length-1;nt>=0&&Ke>-1;nt--){const $e=we[nt];let Ge=Pe[Ke];if(typeof $e=="string")Ue=$e+Ue,Ge===$e&&Ke--;else if(Ge!==void 0&&$e.regex.test(Ge))do Ue=($e.transform!==void 0?$e.transform(Ge):Ge)+Ue,Ke--,Ge=Pe[Ke];while(De===nt&&Ge!==void 0&&$e.regex.test(Ge));else return Ue}return Ue}function Ne(Pe){return typeof Pe!="string"||s===void 0?typeof Pe=="number"?s(""+Pe):Pe:s(Pe)}function Se(Pe){return T.length-Pe.length<=0?Pe:r.reverseFillMask===!0&&Pe.length>0?T.slice(0,-Pe.length)+Pe:Pe+T.slice(Pe.length)}return{innerValue:O,hasMask:D,moveCursorForPaste:le,updateMaskValue:ae,onMaskedKeydown:He}}const Pg={name:String};function YA(r={}){return(u,p,y)=>{u[p](Te("input",{class:"hidden"+(y||""),...r.value}))}}function Bb(r){return ve(()=>r.name||r.for)}function JA(r,u){function p(){const y=r.modelValue;try{const x="DataTransfer"in window?new DataTransfer:"ClipboardEvent"in window?new ClipboardEvent("").clipboardData:void 0;return Object(y)===y&&("length"in y?Array.from(y):[y]).forEach(T=>{x.items.add(T)}),{files:x.files}}catch{return{files:void 0}}}return ve(u===!0?()=>{if(r.type==="file")return p()}:p)}const QA=/[\u3000-\u303f\u3040-\u309f\u30a0-\u30ff\uff00-\uff9f\u4e00-\u9faf\u3400-\u4dbf]/,eM=/[\u4e00-\u9fff\u3400-\u4dbf\u{20000}-\u{2a6df}\u{2a700}-\u{2b73f}\u{2b740}-\u{2b81f}\u{2b820}-\u{2ceaf}\uf900-\ufaff\u3300-\u33ff\ufe30-\ufe4f\uf900-\ufaff\u{2f800}-\u{2fa1f}]/u,tM=/[\u3131-\u314e\u314f-\u3163\uac00-\ud7a3]/,iM=/[a-z0-9_ -]$/i;function Rb(r){return function(p){if(p.type==="compositionend"||p.type==="change"){if(p.target.qComposing!==!0)return;p.target.qComposing=!1,r(p)}else p.type==="compositionupdate"&&p.target.qComposing!==!0&&typeof p.data=="string"&&(pn.is.firefox===!0?iM.test(p.data)===!1:QA.test(p.data)===!0||eM.test(p.data)===!0||tM.test(p.data)===!0)===!0&&(p.target.qComposing=!0)}}const Ah=Vi({name:"QInput",inheritAttrs:!1,props:{...Mp,...XA,...Pg,modelValue:{required:!1},shadowText:String,type:{type:String,default:"text"},debounce:[String,Number],autogrow:Boolean,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...Ig,"paste","change"],setup(r,{emit:u,attrs:p}){const{proxy:y}=Pi(),{$q:x}=y,T={};let A=NaN,s,D,O,F;const N=Ot(null),q=Bb(r),{innerValue:Z,hasMask:ae,moveCursorForPaste:le,updateMaskValue:xe,onMaskedKeydown:He}=KA(r,u,Ye,N),Ee=JA(r,!0),Le=ve(()=>Gh(Z.value)),Ne=Rb(Ge),Se=kg(),Pe=ve(()=>r.type==="textarea"||r.autogrow===!0),we=ve(()=>Pe.value===!0||["text","search","url","tel","password"].includes(r.type)),De=ve(()=>{const Fe={...Se.splitAttrs.listeners.value,onInput:Ge,onPaste:$e,onChange:Ht,onBlur:ot,onFocus:Wo};return Fe.onCompositionstart=Fe.onCompositionupdate=Fe.onCompositionend=Ne,ae.value===!0&&(Fe.onKeydown=He),r.autogrow===!0&&(Fe.onAnimationend=Ft),Fe}),Ke=ve(()=>{const Fe={tabindex:0,"data-autofocus":r.autofocus===!0||void 0,rows:r.type==="textarea"?6:void 0,"aria-label":r.label,name:q.value,...Se.splitAttrs.attributes.value,id:Se.targetUid.value,maxlength:r.maxlength,disabled:r.disable===!0,readonly:r.readonly===!0};return Pe.value===!1&&(Fe.type=r.type),r.autogrow===!0&&(Fe.rows=1),Fe});ri(()=>r.type,()=>{N.value&&(N.value.value=r.modelValue)}),ri(()=>r.modelValue,Fe=>{if(ae.value===!0){if(D===!0&&(D=!1,String(Fe)===A))return;xe(Fe)}else Z.value!==Fe&&(Z.value=Fe,r.type==="number"&&T.hasOwnProperty("value")===!0&&(s===!0?s=!1:delete T.value));r.autogrow===!0&&fn(Ft)}),ri(()=>r.autogrow,Fe=>{Fe===!0?fn(Ft):N.value!==null&&p.rows>0&&(N.value.style.height="auto")}),ri(()=>r.dense,()=>{r.autogrow===!0&&fn(Ft)});function Ue(){Xh(()=>{const Fe=document.activeElement;N.value!==null&&N.value!==Fe&&(Fe===null||Fe.id!==Se.targetUid.value)&&N.value.focus({preventScroll:!0})})}function nt(){N.value!==null&&N.value.select()}function $e(Fe){if(ae.value===!0&&r.reverseFillMask!==!0){const _t=Fe.target;le(_t,_t.selectionStart,_t.selectionEnd)}u("paste",Fe)}function Ge(Fe){if(!Fe||!Fe.target)return;if(r.type==="file"){u("update:modelValue",Fe.target.files);return}const _t=Fe.target.value;if(Fe.target.qComposing===!0){T.value=_t;return}if(ae.value===!0)xe(_t,!1,Fe.inputType);else if(Ye(_t),we.value===!0&&Fe.target===document.activeElement){const{selectionStart:xt,selectionEnd:Bt}=Fe.target;xt!==void 0&&Bt!==void 0&&fn(()=>{Fe.target===document.activeElement&&_t.indexOf(Fe.target.value)===0&&Fe.target.setSelectionRange(xt,Bt)})}r.autogrow===!0&&Ft()}function Ye(Fe,_t){F=()=>{r.type!=="number"&&T.hasOwnProperty("value")===!0&&delete T.value,r.modelValue!==Fe&&A!==Fe&&(A=Fe,_t===!0&&(D=!0),u("update:modelValue",Fe),fn(()=>{A===Fe&&(A=NaN)})),F=void 0},r.type==="number"&&(s=!0,T.value=Fe),r.debounce!==void 0?(clearTimeout(O),T.value=Fe,O=setTimeout(F,r.debounce)):F()}function Ft(){requestAnimationFrame(()=>{const Fe=N.value;if(Fe!==null){const _t=Fe.parentNode.style,{overflow:xt}=Fe.style;x.platform.is.firefox!==!0&&(Fe.style.overflow="hidden"),Fe.style.height="1px",_t.marginBottom=Fe.scrollHeight-1+"px",Fe.style.height=Fe.scrollHeight+"px",Fe.style.overflow=xt,_t.marginBottom=""}})}function Ht(Fe){Ne(Fe),clearTimeout(O),F!==void 0&&F(),u("change",Fe.target.value)}function ot(Fe){Fe!==void 0&&Wo(Fe),clearTimeout(O),F!==void 0&&F(),s=!1,D=!1,delete T.value,r.type!=="file"&&setTimeout(()=>{N.value!==null&&(N.value.value=Z.value!==void 0?Z.value:"")})}function At(){return T.hasOwnProperty("value")===!0?T.value:Z.value!==void 0?Z.value:""}_n(()=>{ot()}),ar(()=>{r.autogrow===!0&&Ft()}),Object.assign(Se,{innerValue:Z,fieldClass:ve(()=>`q-${Pe.value===!0?"textarea":"input"}`+(r.autogrow===!0?" q-textarea--autogrow":"")),hasShadow:ve(()=>r.type!=="file"&&typeof r.shadowText=="string"&&r.shadowText.length>0),inputRef:N,emitValue:Ye,hasValue:Le,floatingLabel:ve(()=>Le.value===!0||Gh(r.displayValue)),getControl:()=>Te(Pe.value===!0?"textarea":"input",{ref:N,class:["q-field__native q-placeholder",r.inputClass],style:r.inputStyle,...Ke.value,...De.value,...r.type!=="file"?{value:At()}:Ee.value}),getShadowControl:()=>Te("div",{class:"q-field__native q-field__shadow absolute-bottom no-pointer-events"+(Pe.value===!0?"":" text-no-wrap")},[Te("span",{class:"invisible"},At()),Te("span",r.shadowText)])});const di=zg(Se);return Object.assign(y,{focus:Ue,select:nt,getNativeElement:()=>N.value}),di}}),nM=Vi({name:"QField",inheritAttrs:!1,props:Mp,emits:Ig,setup(){return zg(kg())}}),rM={xs:8,sm:10,md:14,lg:20,xl:24},oM=Vi({name:"QChip",props:{...da,...Vc,dense:Boolean,icon:String,iconRight:String,iconRemove:String,iconSelected:String,label:[String,Number],color:String,textColor:String,modelValue:{type:Boolean,default:!0},selected:{type:Boolean,default:null},square:Boolean,outline:Boolean,clickable:Boolean,removable:Boolean,removeAriaLabel:String,tabindex:[String,Number],disable:Boolean,ripple:{type:[Boolean,Object],default:!0}},emits:["update:modelValue","update:selected","remove","click"],setup(r,{slots:u,emit:p}){const{proxy:{$q:y}}=Pi(),x=fa(r,y),T=Uc(r,rM),A=ve(()=>r.selected===!0||r.icon!==void 0),s=ve(()=>r.selected===!0?r.iconSelected||y.iconSet.chip.selected:r.icon),D=ve(()=>r.iconRemove||y.iconSet.chip.remove),O=ve(()=>r.disable===!1&&(r.clickable===!0||r.selected!==null)),F=ve(()=>{const xe=r.outline===!0&&r.color||r.textColor;return"q-chip row inline no-wrap items-center"+(r.outline===!1&&r.color!==void 0?` bg-${r.color}`:"")+(xe?` text-${xe} q-chip--colored`:"")+(r.disable===!0?" disabled":"")+(r.dense===!0?" q-chip--dense":"")+(r.outline===!0?" q-chip--outline":"")+(r.selected===!0?" q-chip--selected":"")+(O.value===!0?" q-chip--clickable cursor-pointer non-selectable q-hoverable":"")+(r.square===!0?" q-chip--square":"")+(x.value===!0?" q-chip--dark q-dark":"")}),N=ve(()=>r.disable===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:r.tabindex||0,role:"button","aria-hidden":"false","aria-label":r.removeAriaLabel||y.lang.label.remove});function q(xe){xe.keyCode===13&&Z(xe)}function Z(xe){r.disable||(p("update:selected",!r.selected),p("click",xe))}function ae(xe){(xe.keyCode===void 0||xe.keyCode===13)&&(xn(xe),r.disable===!1&&(p("update:modelValue",!1),p("remove")))}function le(){const xe=[];O.value===!0&&xe.push(Te("div",{class:"q-focus-helper"})),A.value===!0&&xe.push(Te(kn,{class:"q-chip__icon q-chip__icon--left",name:s.value}));const He=r.label!==void 0?[Te("div",{class:"ellipsis"},[r.label])]:void 0;return xe.push(Te("div",{class:"q-chip__content col row no-wrap items-center q-anchor--skip"},wg(u.default,He))),r.iconRight&&xe.push(Te(kn,{class:"q-chip__icon q-chip__icon--right",name:r.iconRight})),r.removable===!0&&xe.push(Te(kn,{class:"q-chip__icon q-chip__icon--remove cursor-pointer",name:D.value,...N.value,onClick:ae,onKeyup:ae})),xe}return()=>{if(r.modelValue===!1)return;const xe={class:F.value,style:T.value};return O.value===!0&&Object.assign(xe,N.value,{onClick:Z,onKeyup:q}),lb("div",xe,le(),"ripple",r.ripple!==!1&&r.disable!==!0,()=>[[fb,r.ripple]])}}}),sM=Vi({name:"QItem",props:{...da,...gb,tag:{type:String,default:"div"},active:{type:Boolean,default:null},clickable:Boolean,dense:Boolean,insetLevel:Number,tabindex:[String,Number],focused:Boolean,manualFocus:Boolean},emits:["click","keyup"],setup(r,{slots:u,emit:p}){const{proxy:{$q:y}}=Pi(),x=fa(r,y),{hasLink:T,linkAttrs:A,linkClass:s,linkTag:D,navigateOnClick:O}=yb(),F=Ot(null),N=Ot(null),q=ve(()=>r.clickable===!0||T.value===!0||r.tag==="label"),Z=ve(()=>r.disable!==!0&&q.value===!0),ae=ve(()=>"q-item q-item-type row no-wrap"+(r.dense===!0?" q-item--dense":"")+(x.value===!0?" q-item--dark":"")+(T.value===!0&&r.active===null?s.value:r.active===!0?` q-item--active${r.activeClass!==void 0?` ${r.activeClass}`:""}`:"")+(r.disable===!0?" disabled":"")+(Z.value===!0?" q-item--clickable q-link cursor-pointer "+(r.manualFocus===!0?"q-manual-focusable":"q-focusable q-hoverable")+(r.focused===!0?" q-manual-focusable--focused":""):"")),le=ve(()=>{if(r.insetLevel===void 0)return null;const Le=y.lang.rtl===!0?"Right":"Left";return{["padding"+Le]:16+r.insetLevel*56+"px"}});function xe(Le){Z.value===!0&&(N.value!==null&&(Le.qKeyEvent!==!0&&document.activeElement===F.value?N.value.focus():document.activeElement===N.value&&F.value.focus()),O(Le))}function He(Le){if(Z.value===!0&&ua(Le,13)===!0){xn(Le),Le.qKeyEvent=!0;const Ne=new MouseEvent("click",Le);Ne.qKeyEvent=!0,F.value.dispatchEvent(Ne)}p("keyup",Le)}function Ee(){const Le=bg(u.default,[]);return Z.value===!0&&Le.unshift(Te("div",{class:"q-focus-helper",tabindex:-1,ref:N})),Le}return()=>{const Le={ref:F,class:ae.value,style:le.value,onClick:xe,onKeyup:He};return Z.value===!0?(Le.tabindex=r.tabindex||"0",Object.assign(Le,A.value)):q.value===!0&&(Le["aria-disabled"]="true"),Te(D.value,Le,Ee())}}}),aM=Vi({name:"QItemSection",props:{avatar:Boolean,thumbnail:Boolean,side:Boolean,top:Boolean,noWrap:Boolean},setup(r,{slots:u}){const p=ve(()=>`q-item__section column q-item__section--${r.avatar===!0||r.side===!0||r.thumbnail===!0?"side":"main"}`+(r.top===!0?" q-item__section--top justify-start":" justify-center")+(r.avatar===!0?" q-item__section--avatar":"")+(r.thumbnail===!0?" q-item__section--thumbnail":"")+(r.noWrap===!0?" q-item__section--nowrap":""));return()=>Te("div",{class:p.value},bn(u.default))}}),lM=Vi({name:"QItemLabel",props:{overline:Boolean,caption:Boolean,header:Boolean,lines:[Number,String]},setup(r,{slots:u}){const p=ve(()=>parseInt(r.lines,10)),y=ve(()=>"q-item__label"+(r.overline===!0?" q-item__label--overline text-overline":"")+(r.caption===!0?" q-item__label--caption text-caption":"")+(r.header===!0?" q-item__label--header":"")+(p.value===1?" ellipsis":"")),x=ve(()=>r.lines!==void 0&&p.value>1?{overflow:"hidden",display:"-webkit-box","-webkit-box-orient":"vertical","-webkit-line-clamp":p.value}:null);return()=>Te("div",{style:x.value,class:y.value},bn(u.default))}});function Ob(){if(window.getSelection!==void 0){const r=window.getSelection();r.empty!==void 0?r.empty():r.removeAllRanges!==void 0&&(r.removeAllRanges(),tp.is.mobile!==!0&&r.addRange(document.createRange()))}else document.selection!==void 0&&document.selection.empty()}const cM={target:{default:!0},noParentEvent:Boolean,contextMenu:Boolean};function uM({showing:r,avoidEmit:u,configureAnchorEl:p}){const{props:y,proxy:x,emit:T}=Pi(),A=Ot(null);let s;function D(Z){return A.value===null?!1:Z===void 0||Z.touches===void 0||Z.touches.length<=1}const O={};p===void 0&&(Object.assign(O,{hide(Z){x.hide(Z)},toggle(Z){x.toggle(Z),Z.qAnchorHandled=!0},toggleKey(Z){ua(Z,13)===!0&&O.toggle(Z)},contextClick(Z){x.hide(Z),Nr(Z),fn(()=>{x.show(Z),Z.qAnchorHandled=!0})},prevent:Nr,mobileTouch(Z){if(O.mobileCleanup(Z),D(Z)!==!0)return;x.hide(Z),A.value.classList.add("non-selectable");const ae=Z.target;ul(O,"anchor",[[ae,"touchmove","mobileCleanup","passive"],[ae,"touchend","mobileCleanup","passive"],[ae,"touchcancel","mobileCleanup","passive"],[A.value,"contextmenu","prevent","notPassive"]]),s=setTimeout(()=>{x.show(Z),Z.qAnchorHandled=!0},300)},mobileCleanup(Z){A.value.classList.remove("non-selectable"),clearTimeout(s),r.value===!0&&Z!==void 0&&Ob()}}),p=function(Z=y.contextMenu){if(y.noParentEvent===!0||A.value===null)return;let ae;Z===!0?x.$q.platform.is.mobile===!0?ae=[[A.value,"touchstart","mobileTouch","passive"]]:ae=[[A.value,"mousedown","hide","passive"],[A.value,"contextmenu","contextClick","notPassive"]]:ae=[[A.value,"click","toggle","passive"],[A.value,"keyup","toggleKey","passive"]],ul(O,"anchor",ae)});function F(){Lh(O,"anchor")}function N(Z){for(A.value=Z;A.value.classList.contains("q-anchor--skip");)A.value=A.value.parentNode;p()}function q(){if(y.target===!1||y.target===""||x.$el.parentNode===null)A.value=null;else if(y.target===!0)N(x.$el.parentNode);else{let Z=y.target;if(typeof y.target=="string")try{Z=document.querySelector(y.target)}catch{Z=void 0}Z!=null?(A.value=Z.$el||Z,p()):(A.value=null,console.error(`Anchor: target "${y.target}" not found`))}}return ri(()=>y.contextMenu,Z=>{A.value!==null&&(F(),p(Z))}),ri(()=>y.target,()=>{A.value!==null&&F(),q()}),ri(()=>y.noParentEvent,Z=>{A.value!==null&&(Z===!0?F():p())}),ar(()=>{q(),u!==!0&&y.modelValue===!0&&A.value===null&&T("update:modelValue",!1)}),_n(()=>{clearTimeout(s),F()}),{anchorEl:A,canShow:D,anchorEvents:O}}function hM(r,u){const p=Ot(null);let y;function x(s,D){const O=`${D!==void 0?"add":"remove"}EventListener`,F=D!==void 0?D:y;s!==window&&s[O]("scroll",F,Rn.passive),window[O]("scroll",F,Rn.passive),y=D}function T(){p.value!==null&&(x(p.value),p.value=null)}const A=ri(()=>r.noParentEvent,()=>{p.value!==null&&(T(),u())});return _n(A),{localScrollTarget:p,unconfigureScrollTarget:T,changeScrollEvent:x}}const Ac=[];function dM(r){return Ac.find(u=>u.__qPortalInnerRef.value!==null&&u.__qPortalInnerRef.value.contains(r))}function Fb(r,u){do{if(r.$options.name==="QMenu"){if(r.hide(u),r.$props.separateClosePopup===!0)return $f(r)}else if(r.__qPortalInnerRef!==void 0){const p=$f(r);return p!==void 0&&p.$options.name==="QPopupProxy"?(r.hide(u),p):r}r=$f(r)}while(r!=null)}function fM(r,u,p){for(;p!==0&&r!==void 0&&r!==null;){if(r.__qPortalInnerRef!==void 0){if(p--,r.$options.name==="QMenu"){r=Fb(r,u);continue}r.hide(u)}r=$f(r)}}function pM(r){for(r=r.parent;r!=null;){if(r.type.name==="QGlobalDialog")return!0;if(r.type.name==="QDialog"||r.type.name==="QMenu")return!1;r=r.parent}return!1}function Vb(r,u,p,y){const x=Ot(!1),T=Ot(!1);let A=null;const s={},D=y===!0&&pM(r);function O(N){if(N===!0){g0(s),T.value=!0;return}T.value=!1,x.value===!1&&(D===!1&&A===null&&(A=vb()),x.value=!0,Ac.push(r.proxy),ZA(s))}function F(N){if(T.value=!1,N!==!0)return;g0(s),x.value=!1;const q=Ac.indexOf(r.proxy);q!==-1&&Ac.splice(q,1),A!==null&&(hA(A),A=null)}return bp(()=>{F(!0)}),r.proxy.__qPortalInnerRef=u,{showPortal:O,hidePortal:F,portalIsActive:x,portalIsAccessible:T,renderPortal:()=>D===!0?p():x.value===!0?[Te(TS,{to:A},p())]:void 0}}const Ub={transitionShow:{type:String,default:"fade"},transitionHide:{type:String,default:"fade"},transitionDuration:{type:[String,Number],default:300}};function mM(r,u){const p=Ot(u.value);return ri(u,y=>{fn(()=>{p.value=y})}),{transition:ve(()=>"q-transition--"+(p.value===!0?r.transitionHide:r.transitionShow)),transitionStyle:ve(()=>`--q-transition-duration: ${r.transitionDuration}ms`)}}function Nb(){let r;const u=Pi();function p(){r=void 0}return Fc(p),_n(p),{removeTick:p,registerTick(y){r=y,fn(()=>{r===y&&(Eg(u)===!1&&r(),r=void 0)})}}}function jb(){let r;const u=Pi();function p(){clearTimeout(r)}return Fc(p),_n(p),{removeTimeout:p,registerTimeout(y,x){clearTimeout(r),Eg(u)===!1&&(r=setTimeout(y,x))}}}const pl=[];let Dc;function _M(r){Dc=r.keyCode===27}function gM(){Dc===!0&&(Dc=!1)}function yM(r){Dc===!0&&(Dc=!1,ua(r,27)===!0&&pl[pl.length-1](r))}function qb(r){window[r]("keydown",_M),window[r]("blur",gM),window[r]("keyup",yM),Dc=!1}function $b(r){pn.is.desktop===!0&&(pl.push(r),pl.length===1&&qb("addEventListener"))}function ap(r){const u=pl.indexOf(r);u>-1&&(pl.splice(u,1),pl.length===0&&qb("removeEventListener"))}const ml=[];function Gb(r){ml[ml.length-1](r)}function Zb(r){pn.is.desktop===!0&&(ml.push(r),ml.length===1&&document.body.addEventListener("focusin",Gb))}function V_(r){const u=ml.indexOf(r);u>-1&&(ml.splice(u,1),ml.length===0&&document.body.removeEventListener("focusin",Gb))}let Wb;const{notPassiveCapture:lp}=Rn,_l=[];function cp(r){clearTimeout(Wb);const u=r.target;if(u===void 0||u.nodeType===8||u.classList.contains("no-pointer-events")===!0)return;let p=Ac.length-1;for(;p>=0;){const y=Ac[p].$;if(y.type.name!=="QDialog")break;if(y.props.seamless!==!0)return;p--}for(let y=_l.length-1;y>=0;y--){const x=_l[y];if((x.anchorEl.value===null||x.anchorEl.value.contains(u)===!1)&&(u===document.body||x.innerRef.value!==null&&x.innerRef.value.contains(u)===!1))r.qClickOutside=!0,x.onClickOutside(r);else return}}function vM(r){_l.push(r),_l.length===1&&(document.addEventListener("mousedown",cp,lp),document.addEventListener("touchstart",cp,lp))}function x0(r){const u=_l.findIndex(p=>p===r);u>-1&&(_l.splice(u,1),_l.length===0&&(clearTimeout(Wb),document.removeEventListener("mousedown",cp,lp),document.removeEventListener("touchstart",cp,lp)))}let b0,w0;function T0(r){const u=r.split(" ");return u.length!==2?!1:["top","center","bottom"].includes(u[0])!==!0?(console.error("Anchor/Self position must start with one of top/center/bottom"),!1):["left","middle","right","start","end"].includes(u[1])!==!0?(console.error("Anchor/Self position must end with one of left/middle/right/start/end"),!1):!0}function xM(r){return r?!(r.length!==2||typeof r[0]!="number"||typeof r[1]!="number"):!0}const U_={"start#ltr":"left","start#rtl":"right","end#ltr":"right","end#rtl":"left"};["left","middle","right"].forEach(r=>{U_[`${r}#ltr`]=r,U_[`${r}#rtl`]=r});function E0(r,u){const p=r.split(" ");return{vertical:p[0],horizontal:U_[`${p[1]}#${u===!0?"rtl":"ltr"}`]}}function bM(r,u){let{top:p,left:y,right:x,bottom:T,width:A,height:s}=r.getBoundingClientRect();return u!==void 0&&(p-=u[1],y-=u[0],T+=u[1],x+=u[0],A+=u[0],s+=u[1]),{top:p,left:y,right:x,bottom:T,width:A,height:s,middle:y+(x-y)/2,center:p+(T-p)/2}}function wM(r){return{top:0,center:r.offsetHeight/2,bottom:r.offsetHeight,left:0,middle:r.offsetWidth/2,right:r.offsetWidth}}function TM(r){if(pn.is.ios===!0&&window.visualViewport!==void 0){const s=document.body.style,{offsetLeft:D,offsetTop:O}=window.visualViewport;D!==b0&&(s.setProperty("--q-pe-left",D+"px"),b0=D),O!==w0&&(s.setProperty("--q-pe-top",O+"px"),w0=O)}let u;const{scrollLeft:p,scrollTop:y}=r.el;if(r.absoluteOffset===void 0)u=bM(r.anchorEl,r.cover===!0?[0,0]:r.offset);else{const{top:s,left:D}=r.anchorEl.getBoundingClientRect(),O=s+r.absoluteOffset.top,F=D+r.absoluteOffset.left;u={top:O,left:F,width:1,height:1,right:F+1,center:O,middle:F,bottom:O+1}}let x={maxHeight:r.maxHeight,maxWidth:r.maxWidth,visibility:"visible"};(r.fit===!0||r.cover===!0)&&(x.minWidth=u.width+"px",r.cover===!0&&(x.minHeight=u.height+"px")),Object.assign(r.el.style,x);const T=wM(r.el),A={top:u[r.anchorOrigin.vertical]-T[r.selfOrigin.vertical],left:u[r.anchorOrigin.horizontal]-T[r.selfOrigin.horizontal]};EM(A,u,T,r.anchorOrigin,r.selfOrigin),x={top:A.top+"px",left:A.left+"px"},A.maxHeight!==void 0&&(x.maxHeight=A.maxHeight+"px",u.height>A.maxHeight&&(x.minHeight=x.maxHeight)),A.maxWidth!==void 0&&(x.maxWidth=A.maxWidth+"px",u.width>A.maxWidth&&(x.minWidth=x.maxWidth)),Object.assign(r.el.style,x),r.el.scrollTop!==y&&(r.el.scrollTop=y),r.el.scrollLeft!==p&&(r.el.scrollLeft=p)}function EM(r,u,p,y,x){const T=p.bottom,A=p.right,s=Wf(),D=window.innerHeight-s,O=document.body.clientWidth;if(r.top<0||r.top+T>D)if(x.vertical==="center")r.top=u[y.vertical]>D/2?Math.max(0,D-T):0,r.maxHeight=Math.min(T,D);else if(u[y.vertical]>D/2){const F=Math.min(D,y.vertical==="center"?u.center:y.vertical===x.vertical?u.bottom:u.top);r.maxHeight=Math.min(T,F),r.top=Math.max(0,F-T)}else r.top=Math.max(0,y.vertical==="center"?u.center:y.vertical===x.vertical?u.top:u.bottom),r.maxHeight=Math.min(T,D-r.top);if(r.left<0||r.left+A>O)if(r.maxWidth=Math.min(A,O),x.horizontal==="middle")r.left=u[y.horizontal]>O/2?Math.max(0,O-A):0;else if(u[y.horizontal]>O/2){const F=Math.min(O,y.horizontal==="middle"?u.middle:y.horizontal===x.horizontal?u.right:u.left);r.maxWidth=Math.min(A,F),r.left=Math.max(0,F-r.maxWidth)}else r.left=Math.max(0,y.horizontal==="middle"?u.middle:y.horizontal===x.horizontal?u.left:u.right),r.maxWidth=Math.min(A,O-r.left)}const SM=Vi({name:"QMenu",inheritAttrs:!1,props:{...cM,...Cg,...da,...Ub,persistent:Boolean,autoClose:Boolean,separateClosePopup:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,fit:Boolean,cover:Boolean,square:Boolean,anchor:{type:String,validator:T0},self:{type:String,validator:T0},offset:{type:Array,validator:xM},scrollTarget:{default:void 0},touchPosition:Boolean,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null}},emits:[...Ag,"click","escape-key"],setup(r,{slots:u,emit:p,attrs:y}){let x=null,T,A,s;const D=Pi(),{proxy:O}=D,{$q:F}=O,N=Ot(null),q=Ot(!1),Z=ve(()=>r.persistent!==!0&&r.noRouteDismiss!==!0),ae=fa(r,F),{registerTick:le,removeTick:xe}=Nb(),{registerTimeout:He}=jb(),{transition:Ee,transitionStyle:Le}=mM(r,q),{localScrollTarget:Ne,changeScrollEvent:Se,unconfigureScrollTarget:Pe}=hM(r,Bt),{anchorEl:we,canShow:De}=uM({showing:q}),{hide:Ke}=Mg({showing:q,canShow:De,handleShow:Fe,handleHide:_t,hideOnRouteChange:Z,processOnMount:!0}),{showPortal:Ue,hidePortal:nt,renderPortal:$e}=Vb(D,N,Jt),Ge={anchorEl:we,innerRef:N,onClickOutside(Et){if(r.persistent!==!0&&q.value===!0)return Ke(Et),(Et.type==="touchstart"||Et.target.classList.contains("q-dialog__backdrop"))&&xn(Et),!0}},Ye=ve(()=>E0(r.anchor||(r.cover===!0?"center middle":"bottom start"),F.lang.rtl)),Ft=ve(()=>r.cover===!0?Ye.value:E0(r.self||"top start",F.lang.rtl)),Ht=ve(()=>(r.square===!0?" q-menu--square":"")+(ae.value===!0?" q-menu--dark q-dark":"")),ot=ve(()=>r.autoClose===!0?{onClick:pi}:{}),At=ve(()=>q.value===!0&&r.persistent!==!0);ri(At,Et=>{Et===!0?($b(Kt),vM(Ge)):(ap(Kt),x0(Ge))});function di(){Xh(()=>{let Et=N.value;Et&&Et.contains(document.activeElement)!==!0&&(Et=Et.querySelector("[autofocus], [data-autofocus]")||Et,Et.focus({preventScroll:!0}))})}function Fe(Et){if(x=r.noRefocus===!1?document.activeElement:null,Zb(Ci),Ue(),Bt(),T=void 0,Et!==void 0&&(r.touchPosition||r.contextMenu)){const Ri=ip(Et);if(Ri.left!==void 0){const{top:Tn,left:de}=we.value.getBoundingClientRect();T={left:Ri.left-de,top:Ri.top-Tn}}}A===void 0&&(A=ri(()=>F.screen.width+"|"+F.screen.height+"|"+r.self+"|"+r.anchor+"|"+F.lang.rtl,Yt)),r.noFocus!==!0&&document.activeElement.blur(),le(()=>{Yt(),r.noFocus!==!0&&di()}),He(()=>{F.platform.is.ios===!0&&(s=r.autoClose,N.value.click()),Yt(),Ue(!0),p("show",Et)},r.transitionDuration)}function _t(Et){xe(),nt(),xt(!0),x!==null&&(Et===void 0||Et.qClickOutside!==!0)&&(x.focus(),x=null),He(()=>{nt(!0),p("hide",Et)},r.transitionDuration)}function xt(Et){T=void 0,A!==void 0&&(A(),A=void 0),(Et===!0||q.value===!0)&&(V_(Ci),Pe(),x0(Ge),ap(Kt)),Et!==!0&&(x=null)}function Bt(){(we.value!==null||r.scrollTarget!==void 0)&&(Ne.value=Cb(we.value,r.scrollTarget),Se(Ne.value,Yt))}function pi(Et){s!==!0?(Fb(O,Et),p("click",Et)):s=!1}function Ci(Et){At.value===!0&&r.noFocus!==!0&&db(N.value,Et.target)!==!0&&di()}function Kt(Et){p("escape-key"),Ke(Et)}function Yt(){const Et=N.value;Et===null||we.value===null||TM({el:Et,offset:r.offset,anchorEl:we.value,anchorOrigin:Ye.value,selfOrigin:Ft.value,absoluteOffset:T,fit:r.fit,cover:r.cover,maxHeight:r.maxHeight,maxWidth:r.maxWidth})}function Jt(){return Te(bs,{name:Ee.value,appear:!0},()=>q.value===!0?Te("div",{role:"menu",...y,ref:N,tabindex:-1,class:["q-menu q-position-engine scroll"+Ht.value,y.class],style:[y.style,Le.value],...ot.value},bn(u.default)):null)}return _n(xt),Object.assign(O,{focus:di,updatePosition:Yt}),$e}});function CM(r,u,p){let y;function x(){y!==void 0&&(jh.remove(y),y=void 0)}return _n(()=>{r.value===!0&&x()}),{removeFromHistory:x,addToHistory(){y={condition:()=>p.value===!0,handler:u},jh.add(y)}}}let xh=0,__,g_,Mh,y_=!1,S0,C0,xc;function AM(r){MM(r)&&xn(r)}function MM(r){if(r.target===document.body||r.target.classList.contains("q-layout__backdrop"))return!0;const u=bC(r),p=r.shiftKey&&!r.deltaX,y=!p&&Math.abs(r.deltaX)<=Math.abs(r.deltaY),x=p||y?r.deltaY:r.deltaX;for(let T=0;T<u.length;T++){const A=u[T];if(IA(A,y))return y?x<0&&A.scrollTop===0?!0:x>0&&A.scrollTop+A.clientHeight===A.scrollHeight:x<0&&A.scrollLeft===0?!0:x>0&&A.scrollLeft+A.clientWidth===A.scrollWidth}return!0}function A0(r){r.target===document&&(document.scrollingElement.scrollTop=document.scrollingElement.scrollTop)}function Of(r){y_!==!0&&(y_=!0,requestAnimationFrame(()=>{y_=!1;const{height:u}=r.target,{clientHeight:p,scrollTop:y}=document.scrollingElement;(Mh===void 0||u!==window.innerHeight)&&(Mh=p-u,document.scrollingElement.scrollTop=y),y>Mh&&(document.scrollingElement.scrollTop-=Math.ceil((y-Mh)/8))}))}function M0(r){const u=document.body,p=window.visualViewport!==void 0;if(r==="add"){const{overflowY:y,overflowX:x}=window.getComputedStyle(u);__=Mb(window),g_=Ab(window),S0=u.style.left,C0=u.style.top,u.style.left=`-${__}px`,u.style.top=`-${g_}px`,x!=="hidden"&&(x==="scroll"||u.scrollWidth>window.innerWidth)&&u.classList.add("q-body--force-scrollbar-x"),y!=="hidden"&&(y==="scroll"||u.scrollHeight>window.innerHeight)&&u.classList.add("q-body--force-scrollbar-y"),u.classList.add("q-body--prevent-scroll"),document.qScrollPrevented=!0,pn.is.ios===!0&&(p===!0?(window.scrollTo(0,0),window.visualViewport.addEventListener("resize",Of,Rn.passiveCapture),window.visualViewport.addEventListener("scroll",Of,Rn.passiveCapture),window.scrollTo(0,0)):window.addEventListener("scroll",A0,Rn.passiveCapture))}pn.is.desktop===!0&&pn.is.mac===!0&&window[`${r}EventListener`]("wheel",AM,Rn.notPassive),r==="remove"&&(pn.is.ios===!0&&(p===!0?(window.visualViewport.removeEventListener("resize",Of,Rn.passiveCapture),window.visualViewport.removeEventListener("scroll",Of,Rn.passiveCapture)):window.removeEventListener("scroll",A0,Rn.passiveCapture)),u.classList.remove("q-body--prevent-scroll"),u.classList.remove("q-body--force-scrollbar-x"),u.classList.remove("q-body--force-scrollbar-y"),document.qScrollPrevented=!1,u.style.left=S0,u.style.top=C0,window.scrollTo(__,g_),Mh=void 0)}function IM(r){let u="add";if(r===!0){if(xh++,xc!==void 0){clearTimeout(xc),xc=void 0;return}if(xh>1)return}else{if(xh===0||(xh--,xh>0))return;if(u="remove",pn.is.ios===!0&&pn.is.nativeMobile===!0){clearTimeout(xc),xc=setTimeout(()=>{M0(u),xc=void 0},100);return}}M0(u)}function kM(){let r;return{preventBodyScroll(u){u!==r&&(r!==void 0||u===!0)&&(r=u,IM(u))}}}let Ff=0;const zM={standard:"fixed-full flex-center",top:"fixed-top justify-center",bottom:"fixed-bottom justify-center",right:"fixed-right items-center",left:"fixed-left items-center"},I0={standard:["scale","scale"],top:["slide-down","slide-up"],bottom:["slide-up","slide-down"],right:["slide-left","slide-right"],left:["slide-right","slide-left"]},N_=Vi({name:"QDialog",inheritAttrs:!1,props:{...Cg,...Ub,transitionShow:String,transitionHide:String,persistent:Boolean,autoClose:Boolean,allowFocusOutside:Boolean,noEscDismiss:Boolean,noBackdropDismiss:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,noShake:Boolean,seamless:Boolean,maximized:Boolean,fullWidth:Boolean,fullHeight:Boolean,square:Boolean,position:{type:String,default:"standard",validator:r=>r==="standard"||["top","bottom","left","right"].includes(r)}},emits:[...Ag,"shake","click","escape-key"],setup(r,{slots:u,emit:p,attrs:y}){const x=Pi(),T=Ot(null),A=Ot(!1),s=Ot(!1),D=Ot(!1);let O,F=null,N,q;const Z=ve(()=>r.persistent!==!0&&r.noRouteDismiss!==!0&&r.seamless!==!0),{preventBodyScroll:ae}=kM(),{registerTimeout:le}=jb(),{registerTick:xe,removeTick:He}=Nb(),{showPortal:Ee,hidePortal:Le,portalIsAccessible:Ne,renderPortal:Se}=Vb(x,T,Yt,!0),{hide:Pe}=Mg({showing:A,hideOnRouteChange:Z,handleShow:ot,handleHide:At,processOnMount:!0}),{addToHistory:we,removeFromHistory:De}=CM(A,Pe,Z),Ke=ve(()=>`q-dialog__inner flex no-pointer-events q-dialog__inner--${r.maximized===!0?"maximized":"minimized"} q-dialog__inner--${r.position} ${zM[r.position]}`+(D.value===!0?" q-dialog__inner--animating":"")+(r.fullWidth===!0?" q-dialog__inner--fullwidth":"")+(r.fullHeight===!0?" q-dialog__inner--fullheight":"")+(r.square===!0?" q-dialog__inner--square":"")),Ue=ve(()=>"q-transition--"+(r.transitionShow===void 0?I0[r.position][0]:r.transitionShow)),nt=ve(()=>"q-transition--"+(r.transitionHide===void 0?I0[r.position][1]:r.transitionHide)),$e=ve(()=>s.value===!0?nt.value:Ue.value),Ge=ve(()=>`--q-transition-duration: ${r.transitionDuration}ms`),Ye=ve(()=>A.value===!0&&r.seamless!==!0),Ft=ve(()=>r.autoClose===!0?{onClick:pi}:{}),Ht=ve(()=>[`q-dialog fullscreen no-pointer-events q-dialog--${Ye.value===!0?"modal":"seamless"}`,y.class]);ri(A,Jt=>{fn(()=>{s.value=Jt})}),ri(()=>r.maximized,Jt=>{A.value===!0&&Bt(Jt)}),ri(Ye,Jt=>{ae(Jt),Jt===!0?(Zb(Kt),$b(_t)):(V_(Kt),ap(_t))});function ot(Jt){we(),F=r.noRefocus===!1&&document.activeElement!==null?document.activeElement:null,Bt(r.maximized),Ee(),D.value=!0,r.noFocus!==!0?(document.activeElement!==null&&document.activeElement.blur(),xe(di)):He(),le(()=>{if(x.proxy.$q.platform.is.ios===!0){if(r.seamless!==!0&&document.activeElement){const{top:Et,bottom:Ri}=document.activeElement.getBoundingClientRect(),{innerHeight:Tn}=window,de=window.visualViewport!==void 0?window.visualViewport.height:Tn;Et>0&&Ri>de/2&&(document.scrollingElement.scrollTop=Math.min(document.scrollingElement.scrollHeight-de,Ri>=Tn?1/0:Math.ceil(document.scrollingElement.scrollTop+Ri-de/2))),document.activeElement.scrollIntoView()}q=!0,T.value.click(),q=!1}Ee(!0),D.value=!1,p("show",Jt)},r.transitionDuration)}function At(Jt){He(),De(),xt(!0),D.value=!0,Le(),F!==null&&(F.focus(),F=null),le(()=>{Le(!0),D.value=!1,p("hide",Jt)},r.transitionDuration)}function di(Jt){Xh(()=>{let Et=T.value;Et===null||Et.contains(document.activeElement)===!0||(Et=Et.querySelector(Jt||"[autofocus], [data-autofocus]")||Et,Et.focus({preventScroll:!0}))})}function Fe(){di(),p("shake");const Jt=T.value;Jt!==null&&(Jt.classList.remove("q-animate--scale"),Jt.classList.add("q-animate--scale"),clearTimeout(O),O=setTimeout(()=>{T.value!==null&&(Jt.classList.remove("q-animate--scale"),di())},170))}function _t(){r.seamless!==!0&&(r.persistent===!0||r.noEscDismiss===!0?r.maximized!==!0&&r.noShake!==!0&&Fe():(p("escape-key"),Pe()))}function xt(Jt){clearTimeout(O),(Jt===!0||A.value===!0)&&(Bt(!1),r.seamless!==!0&&(ae(!1),V_(Kt),ap(_t))),Jt!==!0&&(F=null)}function Bt(Jt){Jt===!0?N!==!0&&(Ff<1&&document.body.classList.add("q-body--dialog"),Ff++,N=!0):N===!0&&(Ff<2&&document.body.classList.remove("q-body--dialog"),Ff--,N=!1)}function pi(Jt){q!==!0&&(Pe(Jt),p("click",Jt))}function Ci(Jt){r.persistent!==!0&&r.noBackdropDismiss!==!0?Pe(Jt):r.noShake!==!0&&Fe()}function Kt(Jt){r.allowFocusOutside!==!0&&Ne.value===!0&&db(T.value,Jt.target)!==!0&&di('[tabindex]:not([tabindex="-1"])')}Object.assign(x.proxy,{focus:di,shake:Fe,__updateRefocusTarget(Jt){F=Jt||null}}),_n(xt);function Yt(){return Te("div",{"aria-modal":"true",...y,class:Ht.value},[Te(bs,{name:"q-transition--fade",appear:!0},()=>Ye.value===!0?Te("div",{class:"q-dialog__backdrop fixed-full",style:Ge.value,"aria-hidden":"true",onMousedown:Ci}):null),Te(bs,{name:$e.value,appear:!0},()=>A.value===!0?Te("div",{ref:T,class:Ke.value,style:Ge.value,tabindex:-1,...Ft.value},bn(u.default)):null)])}return Se}});let up=!1;{const r=document.createElement("div");r.setAttribute("dir","rtl"),Object.assign(r.style,{width:"1px",height:"1px",overflow:"auto"});const u=document.createElement("div");Object.assign(u.style,{width:"1000px",height:"1px"}),document.body.appendChild(r),r.appendChild(u),r.scrollLeft=-1e3,up=r.scrollLeft>=0,r.remove()}const yo=1e3,PM=["start","center","end","start-force","center-force","end-force"],Hb=Array.prototype.filter,DM=window.getComputedStyle(document.body).overflowAnchor===void 0?Ko:function(r,u){r!==null&&(cancelAnimationFrame(r._qOverflowAnimationFrame),r._qOverflowAnimationFrame=requestAnimationFrame(()=>{if(r===null)return;const p=r.children||[];Hb.call(p,x=>x.dataset&&x.dataset.qVsAnchor!==void 0).forEach(x=>{delete x.dataset.qVsAnchor});const y=p[u];y&&y.dataset&&(y.dataset.qVsAnchor="")}))};function Mc(r,u){return r+u}function v_(r,u,p,y,x,T,A,s){const D=r===window?document.scrollingElement||document.documentElement:r,O=x===!0?"offsetWidth":"offsetHeight",F={scrollStart:0,scrollViewSize:-A-s,scrollMaxSize:0,offsetStart:-A,offsetEnd:-s};if(x===!0?(r===window?(F.scrollStart=window.pageXOffset||window.scrollX||document.body.scrollLeft||0,F.scrollViewSize+=document.documentElement.clientWidth):(F.scrollStart=D.scrollLeft,F.scrollViewSize+=D.clientWidth),F.scrollMaxSize=D.scrollWidth,T===!0&&(F.scrollStart=(up===!0?F.scrollMaxSize-F.scrollViewSize:0)-F.scrollStart)):(r===window?(F.scrollStart=window.pageYOffset||window.scrollY||document.body.scrollTop||0,F.scrollViewSize+=document.documentElement.clientHeight):(F.scrollStart=D.scrollTop,F.scrollViewSize+=D.clientHeight),F.scrollMaxSize=D.scrollHeight),p!==null)for(let N=p.previousElementSibling;N!==null;N=N.previousElementSibling)N.classList.contains("q-virtual-scroll--skip")===!1&&(F.offsetStart+=N[O]);if(y!==null)for(let N=y.nextElementSibling;N!==null;N=N.nextElementSibling)N.classList.contains("q-virtual-scroll--skip")===!1&&(F.offsetEnd+=N[O]);if(u!==r){const N=D.getBoundingClientRect(),q=u.getBoundingClientRect();x===!0?(F.offsetStart+=q.left-N.left,F.offsetEnd-=q.width):(F.offsetStart+=q.top-N.top,F.offsetEnd-=q.height),r!==window&&(F.offsetStart+=F.scrollStart),F.offsetEnd+=F.scrollMaxSize-F.offsetStart}return F}function k0(r,u,p,y){u==="end"&&(u=(r===window?document.body:r)[p===!0?"scrollWidth":"scrollHeight"]),r===window?p===!0?(y===!0&&(u=(up===!0?document.body.scrollWidth-document.documentElement.clientWidth:0)-u),window.scrollTo(u,window.pageYOffset||window.scrollY||document.body.scrollTop||0)):window.scrollTo(window.pageXOffset||window.scrollX||document.body.scrollLeft||0,u):p===!0?(y===!0&&(u=(up===!0?r.scrollWidth-r.offsetWidth:0)-u),r.scrollLeft=u):r.scrollTop=u}function bh(r,u,p,y){if(p>=y)return 0;const x=u.length,T=Math.floor(p/yo),A=Math.floor((y-1)/yo)+1;let s=r.slice(T,A).reduce(Mc,0);return p%yo!==0&&(s-=u.slice(T*yo,p).reduce(Mc,0)),y%yo!==0&&y!==x&&(s-=u.slice(y,A*yo).reduce(Mc,0)),s}const LM={virtualScrollSliceSize:{type:[Number,String],default:null},virtualScrollSliceRatioBefore:{type:[Number,String],default:1},virtualScrollSliceRatioAfter:{type:[Number,String],default:1},virtualScrollItemSize:{type:[Number,String],default:24},virtualScrollStickySizeStart:{type:[Number,String],default:0},virtualScrollStickySizeEnd:{type:[Number,String],default:0},tableColspan:[Number,String]},BM={virtualScrollHorizontal:Boolean,onVirtualScroll:Function,...LM};function RM({virtualScrollLength:r,getVirtualScrollTarget:u,getVirtualScrollEl:p,virtualScrollItemSizeComputed:y}){const x=Pi(),{props:T,emit:A,proxy:s}=x,{$q:D}=s;let O,F,N,q=[],Z;const ae=Ot(0),le=Ot(0),xe=Ot({}),He=Ot(null),Ee=Ot(null),Le=Ot(null),Ne=Ot({from:0,to:0}),Se=ve(()=>T.tableColspan!==void 0?T.tableColspan:100);y===void 0&&(y=ve(()=>T.virtualScrollItemSize));const Pe=ve(()=>y.value+";"+T.virtualScrollHorizontal),we=ve(()=>Pe.value+";"+T.virtualScrollSliceRatioBefore+";"+T.virtualScrollSliceRatioAfter);ri(we,()=>{Ht()}),ri(Pe,De);function De(){Ft(F,!0)}function Ke(_t){Ft(_t===void 0?F:_t)}function Ue(_t,xt){const Bt=u();if(Bt==null||Bt.nodeType===8)return;const pi=v_(Bt,p(),He.value,Ee.value,T.virtualScrollHorizontal,D.lang.rtl,T.virtualScrollStickySizeStart,T.virtualScrollStickySizeEnd);N!==pi.scrollViewSize&&Ht(pi.scrollViewSize),$e(Bt,pi,Math.min(r.value-1,Math.max(0,parseInt(_t,10)||0)),0,PM.indexOf(xt)>-1?xt:F>-1&&_t>F?"end":"start")}function nt(){const _t=u();if(_t==null||_t.nodeType===8)return;const xt=v_(_t,p(),He.value,Ee.value,T.virtualScrollHorizontal,D.lang.rtl,T.virtualScrollStickySizeStart,T.virtualScrollStickySizeEnd),Bt=r.value-1,pi=xt.scrollMaxSize-xt.offsetStart-xt.offsetEnd-le.value;if(O===xt.scrollStart)return;if(xt.scrollMaxSize<=0){$e(_t,xt,0,0);return}N!==xt.scrollViewSize&&Ht(xt.scrollViewSize),Ge(Ne.value.from);const Ci=Math.floor(xt.scrollMaxSize-Math.max(xt.scrollViewSize,xt.offsetEnd)-Math.min(Z[Bt],xt.scrollViewSize/2));if(Ci>0&&Math.ceil(xt.scrollStart)>=Ci){$e(_t,xt,Bt,xt.scrollMaxSize-xt.offsetEnd-q.reduce(Mc,0));return}let Kt=0,Yt=xt.scrollStart-xt.offsetStart,Jt=Yt;if(Yt<=pi&&Yt+xt.scrollViewSize>=ae.value)Yt-=ae.value,Kt=Ne.value.from,Jt=Yt;else for(let Et=0;Yt>=q[Et]&&Kt<Bt;Et++)Yt-=q[Et],Kt+=yo;for(;Yt>0&&Kt<Bt;)Yt-=Z[Kt],Yt>-xt.scrollViewSize?(Kt++,Jt=Yt):Jt=Z[Kt]+Yt;$e(_t,xt,Kt,Jt)}function $e(_t,xt,Bt,pi,Ci){const Kt=typeof Ci=="string"&&Ci.indexOf("-force")>-1,Yt=Kt===!0?Ci.replace("-force",""):Ci,Jt=Yt!==void 0?Yt:"start";let Et=Math.max(0,Bt-xe.value[Jt]),Ri=Et+xe.value.total;Ri>r.value&&(Ri=r.value,Et=Math.max(0,Ri-xe.value.total)),O=xt.scrollStart;const Tn=Et!==Ne.value.from||Ri!==Ne.value.to;if(Tn===!1&&Yt===void 0){At(Bt);return}const{activeElement:de}=document,Ce=Le.value;Tn===!0&&Ce!==null&&Ce!==de&&Ce.contains(de)===!0&&(Ce.addEventListener("focusout",Ye),setTimeout(()=>{Ce!==null&&Ce.removeEventListener("focusout",Ye)})),DM(Ce,Bt-Et);const Re=Yt!==void 0?Z.slice(Et,Bt).reduce(Mc,0):0;if(Tn===!0){const ct=Ri>=Ne.value.from&&Et<=Ne.value.to?Ne.value.to:Ri;Ne.value={from:Et,to:ct},ae.value=bh(q,Z,0,Et),le.value=bh(q,Z,Ri,r.value),requestAnimationFrame(()=>{Ne.value.to!==Ri&&O===xt.scrollStart&&(Ne.value={from:Ne.value.from,to:Ri},le.value=bh(q,Z,Ri,r.value))})}requestAnimationFrame(()=>{if(O!==xt.scrollStart)return;Tn===!0&&Ge(Et);const ct=Z.slice(Et,Bt).reduce(Mc,0),ut=ct+xt.offsetStart+ae.value,bt=ut+Z[Bt];let Mt=ut+pi;if(Yt!==void 0){const gt=ct-Re,Xe=xt.scrollStart+gt;Mt=Kt!==!0&&Xe<ut&&bt<Xe+xt.scrollViewSize?Xe:Yt==="end"?bt-xt.scrollViewSize:ut-(Yt==="start"?0:Math.round((xt.scrollViewSize-Z[Bt])/2))}O=Mt,k0(_t,Mt,T.virtualScrollHorizontal,D.lang.rtl),At(Bt)})}function Ge(_t){const xt=Le.value;if(xt){const Bt=Hb.call(xt.children,Et=>Et.classList&&Et.classList.contains("q-virtual-scroll--skip")===!1),pi=Bt.length,Ci=T.virtualScrollHorizontal===!0?Et=>Et.getBoundingClientRect().width:Et=>Et.offsetHeight;let Kt=_t,Yt,Jt;for(let Et=0;Et<pi;){for(Yt=Ci(Bt[Et]),Et++;Et<pi&&Bt[Et].classList.contains("q-virtual-scroll--with-prev")===!0;)Yt+=Ci(Bt[Et]),Et++;Jt=Yt-Z[Kt],Jt!==0&&(Z[Kt]+=Jt,q[Math.floor(Kt/yo)]+=Jt),Kt++}}}function Ye(){Le.value!==null&&Le.value!==void 0&&Le.value.focus()}function Ft(_t,xt){const Bt=1*y.value;(xt===!0||Array.isArray(Z)===!1)&&(Z=[]);const pi=Z.length;Z.length=r.value;for(let Kt=r.value-1;Kt>=pi;Kt--)Z[Kt]=Bt;const Ci=Math.floor((r.value-1)/yo);q=[];for(let Kt=0;Kt<=Ci;Kt++){let Yt=0;const Jt=Math.min((Kt+1)*yo,r.value);for(let Et=Kt*yo;Et<Jt;Et++)Yt+=Z[Et];q.push(Yt)}F=-1,O=void 0,ae.value=bh(q,Z,0,Ne.value.from),le.value=bh(q,Z,Ne.value.to,r.value),_t>=0?(Ge(Ne.value.from),fn(()=>{Ue(_t)})):di()}function Ht(_t){if(_t===void 0&&typeof window<"u"){const Yt=u();Yt!=null&&Yt.nodeType!==8&&(_t=v_(Yt,p(),He.value,Ee.value,T.virtualScrollHorizontal,D.lang.rtl,T.virtualScrollStickySizeStart,T.virtualScrollStickySizeEnd).scrollViewSize)}N=_t;const xt=parseFloat(T.virtualScrollSliceRatioBefore)||0,Bt=parseFloat(T.virtualScrollSliceRatioAfter)||0,pi=1+xt+Bt,Ci=_t===void 0||_t<=0?1:Math.ceil(_t/y.value),Kt=Math.max(1,Ci,Math.ceil((T.virtualScrollSliceSize>0?T.virtualScrollSliceSize:10)/pi));xe.value={total:Math.ceil(Kt*pi),start:Math.ceil(Kt*xt),center:Math.ceil(Kt*(.5+xt)),end:Math.ceil(Kt*(1+xt)),view:Ci}}function ot(_t,xt){const Bt=T.virtualScrollHorizontal===!0?"width":"height",pi={["--q-virtual-scroll-item-"+Bt]:y.value+"px"};return[_t==="tbody"?Te(_t,{class:"q-virtual-scroll__padding",key:"before",ref:He},[Te("tr",[Te("td",{style:{[Bt]:`${ae.value}px`,...pi},colspan:Se.value})])]):Te(_t,{class:"q-virtual-scroll__padding",key:"before",ref:He,style:{[Bt]:`${ae.value}px`,...pi}}),Te(_t,{class:"q-virtual-scroll__content",key:"content",ref:Le,tabindex:-1},xt.flat()),_t==="tbody"?Te(_t,{class:"q-virtual-scroll__padding",key:"after",ref:Ee},[Te("tr",[Te("td",{style:{[Bt]:`${le.value}px`,...pi},colspan:Se.value})])]):Te(_t,{class:"q-virtual-scroll__padding",key:"after",ref:Ee,style:{[Bt]:`${le.value}px`,...pi}})]}function At(_t){F!==_t&&(T.onVirtualScroll!==void 0&&A("virtual-scroll",{index:_t,from:Ne.value.from,to:Ne.value.to-1,direction:_t<F?"decrease":"increase",ref:s}),F=_t)}Ht();const di=yg(nt,D.platform.is.ios===!0?120:35);ug(()=>{Ht()});let Fe=!1;return Fc(()=>{Fe=!0}),yp(()=>{if(Fe!==!0)return;const _t=u();O!==void 0&&_t!==void 0&&_t!==null&&_t.nodeType!==8?k0(_t,O,T.virtualScrollHorizontal,D.lang.rtl):Ue(F)}),_n(()=>{di.cancel()}),Object.assign(s,{scrollTo:Ue,reset:De,refresh:Ke}),{virtualScrollSliceRange:Ne,virtualScrollSliceSizeComputed:xe,setVirtualScrollSize:Ht,onVirtualScrollEvt:di,localResetVirtualScroll:Ft,padVirtualScroll:ot,scrollTo:Ue,reset:De,refresh:Ke}}function OM(r,u,p){return p<=u?u:Math.min(p,Math.max(u,r))}function z0(r,u,p){if(p<=u)return u;const y=p-u+1;let x=u+(r-u)%y;return x<u&&(x=y+x),x===0?0:x}const P0=r=>["add","add-unique","toggle"].includes(r),FM=".*+?^${}()|[]\\",VM=Object.keys(Mp),D0=Vi({name:"QSelect",inheritAttrs:!1,props:{...BM,...Pg,...Mp,modelValue:{required:!0},multiple:Boolean,displayValue:[String,Number],displayValueHtml:Boolean,dropdownIcon:String,options:{type:Array,default:()=>[]},optionValue:[Function,String],optionLabel:[Function,String],optionDisable:[Function,String],hideSelected:Boolean,hideDropdownIcon:Boolean,fillInput:Boolean,maxValues:[Number,String],optionsDense:Boolean,optionsDark:{type:Boolean,default:null},optionsSelectedClass:String,optionsHtml:Boolean,optionsCover:Boolean,menuShrink:Boolean,menuAnchor:String,menuSelf:String,menuOffset:Array,popupContentClass:String,popupContentStyle:[String,Array,Object],useInput:Boolean,useChips:Boolean,newValueMode:{type:String,validator:P0},mapOptions:Boolean,emitValue:Boolean,inputDebounce:{type:[Number,String],default:500},inputClass:[Array,String,Object],inputStyle:[Array,String,Object],tabindex:{type:[String,Number],default:0},autocomplete:String,transitionShow:String,transitionHide:String,transitionDuration:[String,Number],behavior:{type:String,validator:r=>["default","menu","dialog"].includes(r),default:"default"},virtualScrollItemSize:{type:[Number,String],default:void 0},onNewValue:Function,onFilter:Function},emits:[...Ig,"add","remove","input-value","new-value","keyup","keypress","keydown","filter-abort"],setup(r,{slots:u,emit:p}){const{proxy:y}=Pi(),{$q:x}=y,T=Ot(!1),A=Ot(!1),s=Ot(-1),D=Ot(""),O=Ot(!1),F=Ot(!1);let N,q,Z,ae,le,xe,He,Ee,Le;const Ne=Ot(null),Se=Ot(null),Pe=Ot(null),we=Ot(null),De=Ot(null),Ke=Bb(r),Ue=Rb(io),nt=ve(()=>Array.isArray(r.options)?r.options.length:0),$e=ve(()=>r.virtualScrollItemSize===void 0?r.optionsDense===!0?24:48:r.virtualScrollItemSize),{virtualScrollSliceRange:Ge,virtualScrollSliceSizeComputed:Ye,localResetVirtualScroll:Ft,padVirtualScroll:Ht,onVirtualScrollEvt:ot,scrollTo:At,setVirtualScrollSize:di}=RM({virtualScrollLength:nt,getVirtualScrollTarget:Es,getVirtualScrollEl:Yo,virtualScrollItemSizeComputed:$e}),Fe=kg(),_t=ve(()=>{const he=r.mapOptions===!0&&r.multiple!==!0,vt=r.modelValue!==void 0&&(r.modelValue!==null||he===!0)?r.multiple===!0&&Array.isArray(r.modelValue)?r.modelValue:[r.modelValue]:[];if(r.mapOptions===!0&&Array.isArray(r.options)===!0){const Ze=r.mapOptions===!0&&q!==void 0?q:[],Me=vt.map(Ti=>gr(Ti,Ze));return r.modelValue===null&&he===!0?Me.filter(Ti=>Ti!==null):Me}return vt}),xt=ve(()=>{const he={};return VM.forEach(vt=>{const Ze=r[vt];Ze!==void 0&&(he[vt]=Ze)}),he}),Bt=ve(()=>r.optionsDark===null?Fe.isDark.value:r.optionsDark),pi=ve(()=>Gh(_t.value)),Ci=ve(()=>{let he="q-field__input q-placeholder col";return r.hideSelected===!0||_t.value.length===0?[he,r.inputClass]:(he+=" q-field__input--padding",r.inputClass===void 0?he:[he,r.inputClass])}),Kt=ve(()=>(r.virtualScrollHorizontal===!0?"q-virtual-scroll--horizontal":"")+(r.popupContentClass?" "+r.popupContentClass:"")),Yt=ve(()=>nt.value===0),Jt=ve(()=>_t.value.map(he=>Xe.value(he)).join(", ")),Et=ve(()=>r.optionsHtml===!0?()=>!0:he=>he!=null&&he.html===!0),Ri=ve(()=>r.displayValueHtml===!0||r.displayValue===void 0&&(r.optionsHtml===!0||_t.value.some(Et.value))),Tn=ve(()=>Fe.focused.value===!0?r.tabindex:-1),de=ve(()=>({tabindex:r.tabindex,role:"combobox","aria-label":r.label,"aria-readonly":r.readonly===!0?"true":"false","aria-autocomplete":r.useInput===!0?"list":"none","aria-expanded":T.value===!0?"true":"false","aria-owns":`${Fe.targetUid.value}_lb`,"aria-controls":`${Fe.targetUid.value}_lb`})),Ce=ve(()=>{const he={id:`${Fe.targetUid.value}_lb`,role:"listbox","aria-multiselectable":r.multiple===!0?"true":"false"};return s.value>=0&&(he["aria-activedescendant"]=`${Fe.targetUid.value}_${s.value}`),he}),Re=ve(()=>_t.value.map((he,vt)=>({index:vt,opt:he,html:Et.value(he),selected:!0,removeAtIndex:mi,toggleOption:si,tabindex:Tn.value}))),ct=ve(()=>{if(nt.value===0)return[];const{from:he,to:vt}=Ge.value;return r.options.slice(he,vt).map((Ze,Me)=>{const Ti=ht.value(Ze)===!0,ni=he+Me,Gi={clickable:!0,active:!1,activeClass:Mt.value,manualFocus:!0,focused:!1,disable:Ti,tabindex:-1,dense:r.optionsDense,dark:Bt.value,role:"option",id:`${Fe.targetUid.value}_${ni}`,onClick:()=>{si(Ze)}};return Ti!==!0&&(zn(Ze)===!0&&(Gi.active=!0),s.value===ni&&(Gi.focused=!0),Gi["aria-selected"]=Gi.active===!0?"true":"false",x.platform.is.desktop===!0&&(Gi.onMousemove=()=>{T.value===!0&&Ai(ni)})),{index:ni,opt:Ze,html:Et.value(Ze),label:Xe.value(Ze),selected:Gi.active,focused:Gi.focused,toggleOption:si,setOptionIndex:Ai,itemProps:Gi}})}),ut=ve(()=>r.dropdownIcon!==void 0?r.dropdownIcon:x.iconSet.arrow.dropdown),bt=ve(()=>r.optionsCover===!1&&r.outlined!==!0&&r.standout!==!0&&r.borderless!==!0&&r.rounded!==!0),Mt=ve(()=>r.optionsSelectedClass!==void 0?r.optionsSelectedClass:r.color!==void 0?`text-${r.color}`:""),gt=ve(()=>Cn(r.optionValue,"value")),Xe=ve(()=>Cn(r.optionLabel,"label")),ht=ve(()=>Cn(r.optionDisable,"disable")),qt=ve(()=>_t.value.map(he=>gt.value(he))),Nt=ve(()=>{const he={onInput:io,onChange:Ue,onKeydown:Ao,onKeyup:Pn,onKeypress:Pr,onFocus:qr,onClick(vt){Z===!0&&Wo(vt)}};return he.onCompositionstart=he.onCompositionupdate=he.onCompositionend=Ue,he});ri(_t,he=>{q=he,r.useInput===!0&&r.fillInput===!0&&r.multiple!==!0&&Fe.innerLoading.value!==!0&&(A.value!==!0&&T.value!==!0||pi.value!==!0)&&(ae!==!0&&st(),(A.value===!0||T.value===!0)&&Er(""))},{immediate:!0}),ri(()=>r.fillInput,st),ri(T,$t),ri(nt,Xt);function Zt(he){return r.emitValue===!0?gt.value(he):he}function ti(he){if(he>-1&&he<_t.value.length)if(r.multiple===!0){const vt=r.modelValue.slice();p("remove",{index:he,value:vt.splice(he,1)[0]}),p("update:modelValue",vt)}else p("update:modelValue",null)}function mi(he){ti(he),Fe.focus()}function Di(he,vt){const Ze=Zt(he);if(r.multiple!==!0){r.fillInput===!0&&An(Xe.value(he),!0,!0),p("update:modelValue",Ze);return}if(_t.value.length===0){p("add",{index:0,value:Ze}),p("update:modelValue",r.multiple===!0?[Ze]:Ze);return}if(vt===!0&&zn(he)===!0||r.maxValues!==void 0&&r.modelValue.length>=r.maxValues)return;const Me=r.modelValue.slice();p("add",{index:Me.length,value:Ze}),Me.push(Ze),p("update:modelValue",Me)}function si(he,vt){if(Fe.editable.value!==!0||he===void 0||ht.value(he)===!0)return;const Ze=gt.value(he);if(r.multiple!==!0){vt!==!0&&(An(r.fillInput===!0?Xe.value(he):"",!0,!0),Ct()),Se.value!==null&&Se.value.focus(),(_t.value.length===0||sa(gt.value(_t.value[0]),Ze)!==!0)&&p("update:modelValue",r.emitValue===!0?Ze:he);return}if((Z!==!0||O.value===!0)&&Fe.focus(),qr(),_t.value.length===0){const ni=r.emitValue===!0?Ze:he;p("add",{index:0,value:ni}),p("update:modelValue",r.multiple===!0?[ni]:ni);return}const Me=r.modelValue.slice(),Ti=qt.value.findIndex(ni=>sa(ni,Ze));if(Ti>-1)p("remove",{index:Ti,value:Me.splice(Ti,1)[0]});else{if(r.maxValues!==void 0&&Me.length>=r.maxValues)return;const ni=r.emitValue===!0?Ze:he;p("add",{index:Me.length,value:ni}),Me.push(ni)}p("update:modelValue",Me)}function Ai(he){if(x.platform.is.desktop!==!0)return;const vt=he>-1&&he<nt.value?he:-1;s.value!==vt&&(s.value=vt)}function hn(he=1,vt){if(T.value===!0){let Ze=s.value;do Ze=z0(Ze+he,-1,nt.value-1);while(Ze!==-1&&Ze!==s.value&&ht.value(r.options[Ze])===!0);s.value!==Ze&&(Ai(Ze),At(Ze),vt!==!0&&r.useInput===!0&&r.fillInput===!0&&no(Ze>=0?Xe.value(r.options[Ze]):xe))}}function gr(he,vt){const Ze=Me=>sa(gt.value(Me),he);return r.options.find(Ze)||vt.find(Ze)||he}function Cn(he,vt){const Ze=he!==void 0?he:vt;return typeof Ze=="function"?Ze:Me=>Me!==null&&typeof Me=="object"&&Ze in Me?Me[Ze]:Me}function zn(he){const vt=gt.value(he);return qt.value.find(Ze=>sa(Ze,vt))!==void 0}function qr(he){r.useInput===!0&&Se.value!==null&&(he===void 0||Se.value===he.target&&he.target.value===Jt.value)&&Se.value.select()}function gn(he){ua(he,27)===!0&&T.value===!0&&(Wo(he),Ct(),st()),p("keyup",he)}function Pn(he){const{value:vt}=he.target;if(he.keyCode!==void 0){gn(he);return}if(he.target.value="",clearTimeout(N),st(),typeof vt=="string"&&vt.length>0){const Ze=vt.toLocaleLowerCase(),Me=ni=>{const Gi=r.options.find(Mn=>ni.value(Mn).toLocaleLowerCase()===Ze);return Gi===void 0?!1:(_t.value.indexOf(Gi)===-1?si(Gi):Ct(),!0)},Ti=ni=>{Me(gt)!==!0&&(Me(Xe)===!0||ni===!0||Er(vt,!0,()=>Ti(!0)))};Ti()}else Fe.clearValue(he)}function Pr(he){p("keypress",he)}function Ao(he){if(p("keydown",he),vg(he)===!0)return;const vt=D.value.length>0&&(r.newValueMode!==void 0||r.onNewValue!==void 0),Ze=he.shiftKey!==!0&&r.multiple!==!0&&(s.value>-1||vt===!0);if(he.keyCode===27){Nr(he);return}if(he.keyCode===9&&Ze===!1){ze();return}if(he.target===void 0||he.target.id!==Fe.targetUid.value)return;if(he.keyCode===40&&Fe.innerLoading.value!==!0&&T.value===!1){xn(he),Qe();return}if(he.keyCode===8&&r.hideSelected!==!0&&D.value.length===0){r.multiple===!0&&Array.isArray(r.modelValue)===!0?ti(r.modelValue.length-1):r.multiple!==!0&&r.modelValue!==null&&p("update:modelValue",null);return}(he.keyCode===35||he.keyCode===36)&&(typeof D.value!="string"||D.value.length===0)&&(xn(he),s.value=-1,hn(he.keyCode===36?1:-1,r.multiple)),(he.keyCode===33||he.keyCode===34)&&Ye.value!==void 0&&(xn(he),s.value=Math.max(-1,Math.min(nt.value,s.value+(he.keyCode===33?-1:1)*Ye.value.view)),hn(he.keyCode===33?1:-1,r.multiple)),(he.keyCode===38||he.keyCode===40)&&(xn(he),hn(he.keyCode===38?-1:1,r.multiple));const Me=nt.value;if((Ee===void 0||Le<Date.now())&&(Ee=""),Me>0&&r.useInput!==!0&&he.key!==void 0&&he.key.length===1&&he.altKey===he.ctrlKey&&(he.keyCode!==32||Ee.length>0)){T.value!==!0&&Qe(he);const Ti=he.key.toLocaleLowerCase(),ni=Ee.length===1&&Ee[0]===Ti;Le=Date.now()+1500,ni===!1&&(xn(he),Ee+=Ti);const Gi=new RegExp("^"+Ee.split("").map(Jn=>FM.indexOf(Jn)>-1?"\\"+Jn:Jn).join(".*"),"i");let Mn=s.value;if(ni===!0||Mn<0||Gi.test(Xe.value(r.options[Mn]))!==!0)do Mn=z0(Mn+1,-1,Me-1);while(Mn!==s.value&&(ht.value(r.options[Mn])===!0||Gi.test(Xe.value(r.options[Mn]))!==!0));s.value!==Mn&&fn(()=>{Ai(Mn),At(Mn),Mn>=0&&r.useInput===!0&&r.fillInput===!0&&no(Xe.value(r.options[Mn]))});return}if(!(he.keyCode!==13&&(he.keyCode!==32||r.useInput===!0||Ee!=="")&&(he.keyCode!==9||Ze===!1))){if(he.keyCode!==9&&xn(he),s.value>-1&&s.value<Me){si(r.options[s.value]);return}if(vt===!0){const Ti=(ni,Gi)=>{if(Gi){if(P0(Gi)!==!0)return}else Gi=r.newValueMode;if(ni==null)return;An("",r.multiple!==!0,!0),(Gi==="toggle"?si:Di)(ni,Gi==="add-unique"),r.multiple!==!0&&(Se.value!==null&&Se.value.focus(),Ct())};if(r.onNewValue!==void 0?p("new-value",D.value,Ti):Ti(D.value),r.multiple!==!0)return}T.value===!0?ze():Fe.innerLoading.value!==!0&&Qe()}}function Yo(){return Z===!0?De.value:Pe.value!==null&&Pe.value.__qPortalInnerRef.value!==null?Pe.value.__qPortalInnerRef.value:void 0}function Es(){return Yo()}function pa(){return r.hideSelected===!0?[]:u["selected-item"]!==void 0?Re.value.map(he=>u["selected-item"](he)).slice():u.selected!==void 0?[].concat(u.selected()):r.useChips===!0?Re.value.map((he,vt)=>Te(oM,{key:"option-"+vt,removable:Fe.editable.value===!0&&ht.value(he.opt)!==!0,dense:!0,textColor:r.color,tabindex:Tn.value,onRemove(){he.removeAtIndex(vt)}},()=>Te("span",{class:"ellipsis",[he.html===!0?"innerHTML":"textContent"]:Xe.value(he.opt)}))):[Te("span",{[Ri.value===!0?"innerHTML":"textContent"]:r.displayValue!==void 0?r.displayValue:Jt.value})]}function Dr(){if(Yt.value===!0)return u["no-option"]!==void 0?u["no-option"]({inputValue:D.value}):void 0;const he=u.option!==void 0?u.option:Ze=>Te(sM,{key:Ze.index,...Ze.itemProps},()=>Te(aM,()=>Te(lM,()=>Te("span",{[Ze.html===!0?"innerHTML":"textContent"]:Ze.label}))));let vt=Ht("div",ct.value.map(he));return u["before-options"]!==void 0&&(vt=u["before-options"]().concat(vt)),Jr(u["after-options"],vt)}function Lr(he,vt){const Ze=vt===!0?{...de.value,...Fe.splitAttrs.attributes.value}:void 0,Me={ref:vt===!0?Se:void 0,key:"i_t",class:Ci.value,style:r.inputStyle,value:D.value!==void 0?D.value:"",type:"search",...Ze,id:vt===!0?Fe.targetUid.value:void 0,maxlength:r.maxlength,autocomplete:r.autocomplete,"data-autofocus":he!==!0&&r.autofocus===!0||void 0,disabled:r.disable===!0,readonly:r.readonly===!0,...Nt.value};return he!==!0&&Z===!0&&(Array.isArray(Me.class)===!0?Me.class=[...Me.class,"no-pointer-events"]:Me.class+=" no-pointer-events"),Te("input",Me)}function io(he){clearTimeout(N),!(he&&he.target&&he.target.qComposing===!0)&&(no(he.target.value||""),ae=!0,xe=D.value,Fe.focused.value!==!0&&(Z!==!0||O.value===!0)&&Fe.focus(),r.onFilter!==void 0&&(N=setTimeout(()=>{Er(D.value)},r.inputDebounce)))}function no(he){D.value!==he&&(D.value=he,p("input-value",he))}function An(he,vt,Ze){ae=Ze!==!0,r.useInput===!0&&(no(he),(vt===!0||Ze!==!0)&&(xe=he),vt!==!0&&Er(he))}function Er(he,vt,Ze){if(r.onFilter===void 0||vt!==!0&&Fe.focused.value!==!0)return;Fe.innerLoading.value===!0?p("filter-abort"):(Fe.innerLoading.value=!0,F.value=!0),he!==""&&r.multiple!==!0&&_t.value.length>0&&ae!==!0&&he===Xe.value(_t.value[0])&&(he="");const Me=setTimeout(()=>{T.value===!0&&(T.value=!1)},10);clearTimeout(le),le=Me,p("filter",he,(Ti,ni)=>{(vt===!0||Fe.focused.value===!0)&&le===Me&&(clearTimeout(le),typeof Ti=="function"&&Ti(),F.value=!1,fn(()=>{Fe.innerLoading.value=!1,Fe.editable.value===!0&&(vt===!0?T.value===!0&&Ct():T.value===!0?$t(!0):T.value=!0),typeof ni=="function"&&fn(()=>{ni(y)}),typeof Ze=="function"&&fn(()=>{Ze(y)})}))},()=>{Fe.focused.value===!0&&le===Me&&(clearTimeout(le),Fe.innerLoading.value=!1,F.value=!1),T.value===!0&&(T.value=!1)})}function Q(){return Te(SM,{ref:Pe,class:Kt.value,style:r.popupContentStyle,modelValue:T.value,fit:r.menuShrink!==!0,cover:r.optionsCover===!0&&Yt.value!==!0&&r.useInput!==!0,anchor:r.menuAnchor,self:r.menuSelf,offset:r.menuOffset,dark:Bt.value,noParentEvent:!0,noRefocus:!0,noFocus:!0,square:bt.value,transitionShow:r.transitionShow,transitionHide:r.transitionHide,transitionDuration:r.transitionDuration,separateClosePopup:!0,...Ce.value,onScrollPassive:ot,onBeforeShow:Qt,onBeforeHide:B,onShow:V},Dr)}function B(he){ci(he),ze()}function V(){di()}function J(he){Wo(he),Se.value!==null&&Se.value.focus(),O.value=!0,window.scrollTo(window.pageXOffset||window.scrollX||document.body.scrollLeft||0,0)}function ne(he){Wo(he),fn(()=>{O.value=!1})}function ge(){const he=[Te(nM,{class:`col-auto ${Fe.fieldClass.value}`,...xt.value,for:Fe.targetUid.value,dark:Bt.value,square:!0,loading:F.value,itemAligned:!1,filled:!0,stackLabel:D.value.length>0,...Fe.splitAttrs.listeners.value,onFocus:J,onBlur:ne},{...u,rawControl:()=>Fe.getControl(!0),before:void 0,after:void 0})];return T.value===!0&&he.push(Te("div",{ref:De,class:Kt.value+" scroll",style:r.popupContentStyle,...Ce.value,onClick:Nr,onScrollPassive:ot},Dr())),Te(N_,{ref:we,modelValue:A.value,position:r.useInput===!0?"top":void 0,transitionShow:He,transitionHide:r.transitionHide,transitionDuration:r.transitionDuration,onBeforeShow:Qt,onBeforeHide:ke,onHide:Ae,onShow:ye},()=>Te("div",{class:"q-select__dialog"+(Bt.value===!0?" q-select__dialog--dark q-dark":"")+(O.value===!0?" q-select__dialog--focused":"")},he))}function ke(he){ci(he),we.value!==null&&we.value.__updateRefocusTarget(Fe.rootRef.value.querySelector(".q-field__native > [tabindex]:last-child")),Fe.focused.value=!1}function Ae(he){Ct(),Fe.focused.value===!1&&p("blur",he),st()}function ye(){const he=document.activeElement;(he===null||he.id!==Fe.targetUid.value)&&Se.value!==null&&Se.value!==he&&Se.value.focus(),di()}function ze(){A.value!==!0&&(s.value=-1,T.value===!0&&(T.value=!1),Fe.focused.value===!1&&(clearTimeout(le),le=void 0,Fe.innerLoading.value===!0&&(p("filter-abort"),Fe.innerLoading.value=!1,F.value=!1)))}function Qe(he){Fe.editable.value===!0&&(Z===!0?(Fe.onControlFocusin(he),A.value=!0,fn(()=>{Fe.focus()})):Fe.focus(),r.onFilter!==void 0?Er(D.value):(Yt.value!==!0||u["no-option"]!==void 0)&&(T.value=!0))}function Ct(){A.value=!1,ze()}function st(){r.useInput===!0&&An(r.multiple!==!0&&r.fillInput===!0&&_t.value.length>0&&Xe.value(_t.value[0])||"",!0,!0)}function $t(he){let vt=-1;if(he===!0){if(_t.value.length>0){const Ze=gt.value(_t.value[0]);vt=r.options.findIndex(Me=>sa(gt.value(Me),Ze))}Ft(vt)}Ai(vt)}function Xt(he,vt){T.value===!0&&Fe.innerLoading.value===!1&&(Ft(-1,!0),fn(()=>{T.value===!0&&Fe.innerLoading.value===!1&&(he>vt?Ft():$t(!0))}))}function jt(){A.value===!1&&Pe.value!==null&&Pe.value.updatePosition()}function Qt(he){he!==void 0&&Wo(he),p("popup-show",he),Fe.hasPopupOpen=!0,Fe.onControlFocusin(he)}function ci(he){he!==void 0&&Wo(he),p("popup-hide",he),Fe.hasPopupOpen=!1,Fe.onControlFocusout(he)}function Li(){Z=x.platform.is.mobile!==!0&&r.behavior!=="dialog"?!1:r.behavior!=="menu"&&(r.useInput===!0?u["no-option"]!==void 0||r.onFilter!==void 0||Yt.value===!1:!0),He=x.platform.is.ios===!0&&Z===!0&&r.useInput===!0?"fade":r.transitionShow}return hg(Li),xp(jt),Li(),_n(()=>{clearTimeout(N)}),Object.assign(y,{showPopup:Qe,hidePopup:Ct,removeAtIndex:ti,add:Di,toggleOption:si,getOptionIndex:()=>s.value,setOptionIndex:Ai,moveOptionSelection:hn,filter:Er,updateMenuPosition:jt,updateInputValue:An,isOptionSelected:zn,getEmittingOptionValue:Zt,isOptionDisabled:(...he)=>ht.value.apply(null,he)===!0,getOptionValue:(...he)=>gt.value.apply(null,he),getOptionLabel:(...he)=>Xe.value.apply(null,he)}),Object.assign(Fe,{innerValue:_t,fieldClass:ve(()=>`q-select q-field--auto-height q-select--with${r.useInput!==!0?"out":""}-input q-select--with${r.useChips!==!0?"out":""}-chips q-select--${r.multiple===!0?"multiple":"single"}`),inputRef:Ne,targetRef:Se,hasValue:pi,showPopup:Qe,floatingLabel:ve(()=>r.hideSelected!==!0&&pi.value===!0||typeof D.value=="number"||D.value.length>0||Gh(r.displayValue)),getControlChild:()=>{if(Fe.editable.value!==!1&&(A.value===!0||Yt.value!==!0||u["no-option"]!==void 0))return Z===!0?ge():Q();Fe.hasPopupOpen===!0&&(Fe.hasPopupOpen=!1)},controlEvents:{onFocusin(he){Fe.onControlFocusin(he)},onFocusout(he){Fe.onControlFocusout(he,()=>{st(),ze()})},onClick(he){if(Nr(he),Z!==!0&&T.value===!0){ze(),Se.value!==null&&Se.value.focus();return}Qe(he)}},getControl:he=>{const vt=pa(),Ze=he===!0||A.value!==!0||Z!==!0;if(r.useInput===!0)vt.push(Lr(he,Ze));else if(Fe.editable.value===!0){const Ti=Ze===!0?de.value:void 0;vt.push(Te("input",{ref:Ze===!0?Se:void 0,key:"d_t",class:"q-select__focus-target",id:Ze===!0?Fe.targetUid.value:void 0,readonly:!0,"data-autofocus":he!==!0&&r.autofocus===!0||void 0,...Ti,onKeydown:Ao,onKeyup:gn,onKeypress:Pr})),Ze===!0&&typeof r.autocomplete=="string"&&r.autocomplete.length>0&&vt.push(Te("input",{class:"q-select__autocomplete-input",autocomplete:r.autocomplete,tabindex:-1,onKeyup:Pn}))}if(Ke.value!==void 0&&r.disable!==!0&&qt.value.length>0){const Ti=qt.value.map(ni=>Te("option",{value:ni,selected:!0}));vt.push(Te("select",{class:"hidden",name:Ke.value,multiple:r.multiple},Ti))}const Me=r.useInput===!0||Ze!==!0?void 0:Fe.splitAttrs.attributes.value;return Te("div",{class:"q-field__native row items-center",...Me},vt)},getInnerAppend:()=>r.loading!==!0&&F.value!==!0&&r.hideDropdownIcon!==!0?[Te(kn,{class:"q-select__dropdown-icon"+(T.value===!0?" rotate-180":""),name:ut.value})]:null}),zg(Fe)}});function UM(r,u){const p=Ot(null),y=ve(()=>r.disable===!0?null:Te("span",{ref:p,class:"no-outline",tabindex:-1}));function x(T){const A=u.value;T!==void 0&&T.type.indexOf("key")===0?A!==null&&document.activeElement!==A&&A.contains(document.activeElement)===!0&&A.focus():p.value!==null&&(T===void 0||A!==null&&A.contains(T.target)===!0)&&p.value.focus()}return{refocusTargetEl:y,refocusTarget:x}}const NM={xs:30,sm:35,md:40,lg:50,xl:60},jM={...da,...Vc,...Pg,modelValue:{required:!0,default:null},val:{},trueValue:{default:!0},falseValue:{default:!1},indeterminateValue:{default:null},checkedIcon:String,uncheckedIcon:String,indeterminateIcon:String,toggleOrder:{type:String,validator:r=>r==="tf"||r==="ft"},toggleIndeterminate:Boolean,label:String,leftLabel:Boolean,color:String,keepColor:Boolean,dense:Boolean,disable:Boolean,tabindex:[String,Number]},qM=["update:modelValue"];function $M(r,u){const{props:p,slots:y,emit:x,proxy:T}=Pi(),{$q:A}=T,s=fa(p,A),D=Ot(null),{refocusTargetEl:O,refocusTarget:F}=UM(p,D),N=Uc(p,NM),q=ve(()=>p.val!==void 0&&Array.isArray(p.modelValue)),Z=ve(()=>{const $e=zi(p.val);return q.value===!0?p.modelValue.findIndex(Ge=>zi(Ge)===$e):-1}),ae=ve(()=>q.value===!0?Z.value>-1:zi(p.modelValue)===zi(p.trueValue)),le=ve(()=>q.value===!0?Z.value===-1:zi(p.modelValue)===zi(p.falseValue)),xe=ve(()=>ae.value===!1&&le.value===!1),He=ve(()=>p.disable===!0?-1:p.tabindex||0),Ee=ve(()=>`q-${r} cursor-pointer no-outline row inline no-wrap items-center`+(p.disable===!0?" disabled":"")+(s.value===!0?` q-${r}--dark`:"")+(p.dense===!0?` q-${r}--dense`:"")+(p.leftLabel===!0?" reverse":"")),Le=ve(()=>{const $e=ae.value===!0?"truthy":le.value===!0?"falsy":"indet",Ge=p.color!==void 0&&(p.keepColor===!0||(r==="toggle"?ae.value===!0:le.value!==!0))?` text-${p.color}`:"";return`q-${r}__inner relative-position non-selectable q-${r}__inner--${$e}${Ge}`}),Ne=ve(()=>{const $e={type:"checkbox"};return p.name!==void 0&&Object.assign($e,{"^checked":ae.value===!0?"checked":void 0,name:p.name,value:q.value===!0?p.val:p.trueValue}),$e}),Se=YA(Ne),Pe=ve(()=>{const $e={tabindex:He.value,role:"checkbox","aria-label":p.label,"aria-checked":xe.value===!0?"mixed":ae.value===!0?"true":"false"};return p.disable===!0&&($e["aria-disabled"]="true"),$e});function we($e){$e!==void 0&&(xn($e),F($e)),p.disable!==!0&&x("update:modelValue",De(),$e)}function De(){if(q.value===!0){if(ae.value===!0){const $e=p.modelValue.slice();return $e.splice(Z.value,1),$e}return p.modelValue.concat([p.val])}if(ae.value===!0){if(p.toggleOrder!=="ft"||p.toggleIndeterminate===!1)return p.falseValue}else if(le.value===!0){if(p.toggleOrder==="ft"||p.toggleIndeterminate===!1)return p.trueValue}else return p.toggleOrder!=="ft"?p.trueValue:p.falseValue;return p.indeterminateValue}function Ke($e){($e.keyCode===13||$e.keyCode===32)&&xn($e)}function Ue($e){($e.keyCode===13||$e.keyCode===32)&&we($e)}const nt=u(ae,xe);return Object.assign(T,{toggle:we}),()=>{const $e=nt();p.disable!==!0&&Se($e,"unshift",` q-${r}__native absolute q-ma-none q-pa-none`);const Ge=[Te("div",{class:Le.value,style:N.value,"aria-hidden":"true"},$e)];O.value!==null&&Ge.push(O.value);const Ye=p.label!==void 0?Jr(y.default,[p.label]):bn(y.default);return Ye!==void 0&&Ge.push(Te("div",{class:`q-${r}__label q-anchor--skip`},Ye)),Te("div",{ref:D,class:Ee.value,...Pe.value,onClick:we,onKeydown:Ke,onKeyup:Ue},Ge)}}const GM=Vi({name:"QToggle",props:{...jM,icon:String,iconColor:String},emits:qM,setup(r){function u(p,y){const x=ve(()=>(p.value===!0?r.checkedIcon:y.value===!0?r.indeterminateIcon:r.uncheckedIcon)||r.icon),T=ve(()=>p.value===!0?r.iconColor:null);return()=>[Te("div",{class:"q-toggle__track"}),Te("div",{class:"q-toggle__thumb absolute flex flex-center no-wrap"},x.value!==void 0?[Te(kn,{name:x.value,color:T.value})]:void 0)]}return $M("toggle",u)}}),Xb=Vi({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validation-success","validation-error"],setup(r,{slots:u,emit:p}){const y=Pi(),x=Ot(null);let T=0;const A=[];function s(Z){const ae=typeof Z=="boolean"?Z:r.noErrorFocus!==!0,le=++T,xe=(Le,Ne)=>{p("validation-"+(Le===!0?"success":"error"),Ne)},He=Le=>{const Ne=Le.validate();return typeof Ne.then=="function"?Ne.then(Se=>({valid:Se,comp:Le}),Se=>({valid:!1,comp:Le,err:Se})):Promise.resolve({valid:Ne,comp:Le})};return(r.greedy===!0?Promise.all(A.map(He)).then(Le=>Le.filter(Ne=>Ne.valid!==!0)):A.reduce((Le,Ne)=>Le.then(()=>He(Ne).then(Se=>{if(Se.valid===!1)return Promise.reject(Se)})),Promise.resolve()).catch(Le=>[Le])).then(Le=>{if(Le===void 0||Le.length===0)return le===T&&xe(!0),!0;if(le===T){const{comp:Ne,err:Se}=Le[0];if(Se!==void 0&&console.error(Se),xe(!1,Ne),ae===!0){const Pe=Le.find(({comp:we})=>typeof we.focus=="function"&&Eg(we.$)===!1);Pe!==void 0&&Pe.comp.focus()}}return!1})}function D(){T++,A.forEach(Z=>{typeof Z.resetValidation=="function"&&Z.resetValidation()})}function O(Z){Z!==void 0&&xn(Z);const ae=T+1;s().then(le=>{ae===T&&le===!0&&(r.onSubmit!==void 0?p("submit",Z):Z!==void 0&&Z.target!==void 0&&typeof Z.target.submit=="function"&&Z.target.submit())})}function F(Z){Z!==void 0&&xn(Z),p("reset"),fn(()=>{D(),r.autofocus===!0&&r.noResetFocus!==!0&&N()})}function N(){Xh(()=>{if(x.value===null)return;const Z=x.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(x.value.querySelectorAll("[tabindex]"),ae=>ae.tabIndex>-1);Z!=null&&Z.focus({preventScroll:!0})})}Oc(sb,{bindComponent(Z){A.push(Z)},unbindComponent(Z){const ae=A.indexOf(Z);ae>-1&&A.splice(ae,1)}});let q=!1;return Fc(()=>{q=!0}),yp(()=>{q===!0&&r.autofocus===!0&&N()}),ar(()=>{r.autofocus===!0&&N()}),Object.assign(y.proxy,{validate:s,resetValidation:D,submit:O,reset:F,focus:N,getValidationComponents:()=>A}),()=>Te("form",{class:"q-form",ref:x,onSubmit:O,onReset:F},bn(u.default))}}),ZM=Te("div",{class:"q-space"}),L0=Vi({name:"QSpace",setup(){return()=>ZM}}),Vf=Vi({name:"QCardSection",props:{tag:{type:String,default:"div"},horizontal:Boolean},setup(r,{slots:u}){const p=ve(()=>`q-card__section q-card__section--${r.horizontal===!0?"horiz row no-wrap":"vert"}`);return()=>Te(r.tag,{class:p.value},bn(u.default))}}),WM={...Vc,min:{type:Number,default:0},max:{type:Number,default:100},color:String,centerColor:String,trackColor:String,fontSize:String,rounded:Boolean,thickness:{type:Number,default:.2,validator:r=>r>=0&&r<=1},angle:{type:Number,default:0},showValue:Boolean,reverse:Boolean,instantFeedback:Boolean},j_=50,Kb=2*j_,Yb=Kb*Math.PI,HM=Math.round(Yb*1e3)/1e3,XM=Vi({name:"QCircularProgress",props:{...WM,value:{type:Number,default:0},animationSpeed:{type:[String,Number],default:600},indeterminate:Boolean},setup(r,{slots:u}){const{proxy:{$q:p}}=Pi(),y=Uc(r),x=ve(()=>{const q=(p.lang.rtl===!0?-1:1)*r.angle;return{transform:r.reverse!==(p.lang.rtl===!0)?`scale3d(-1, 1, 1) rotate3d(0, 0, 1, ${-90-q}deg)`:`rotate3d(0, 0, 1, ${q-90}deg)`}}),T=ve(()=>r.instantFeedback!==!0&&r.indeterminate!==!0?{transition:`stroke-dashoffset ${r.animationSpeed}ms ease 0s, stroke ${r.animationSpeed}ms ease`}:""),A=ve(()=>Kb/(1-r.thickness/2)),s=ve(()=>`${A.value/2} ${A.value/2} ${A.value} ${A.value}`),D=ve(()=>OM(r.value,r.min,r.max)),O=ve(()=>Yb*(1-(D.value-r.min)/(r.max-r.min))),F=ve(()=>r.thickness/2*A.value);function N({thickness:q,offset:Z,color:ae,cls:le,rounded:xe}){return Te("circle",{class:"q-circular-progress__"+le+(ae!==void 0?` text-${ae}`:""),style:T.value,fill:"transparent",stroke:"currentColor","stroke-width":q,"stroke-dasharray":HM,"stroke-dashoffset":Z,"stroke-linecap":xe,cx:A.value,cy:A.value,r:j_})}return()=>{const q=[];r.centerColor!==void 0&&r.centerColor!=="transparent"&&q.push(Te("circle",{class:`q-circular-progress__center text-${r.centerColor}`,fill:"currentColor",r:j_-F.value/2,cx:A.value,cy:A.value})),r.trackColor!==void 0&&r.trackColor!=="transparent"&&q.push(N({cls:"track",thickness:F.value,offset:0,color:r.trackColor})),q.push(N({cls:"circle",thickness:F.value,offset:O.value,color:r.color,rounded:r.rounded===!0?"round":void 0}));const Z=[Te("svg",{class:"q-circular-progress__svg",style:x.value,viewBox:s.value,"aria-hidden":"true"},q)];return r.showValue===!0&&Z.push(Te("div",{class:"q-circular-progress__text absolute-full row flex-center content-center",style:{fontSize:r.fontSize}},u.default!==void 0?u.default():[Te("div",D.value)])),Te("div",{class:`q-circular-progress q-circular-progress--${r.indeterminate===!0?"in":""}determinate`,style:y.value,role:"progressbar","aria-valuemin":r.min,"aria-valuemax":r.max,"aria-valuenow":r.indeterminate===!0?void 0:D.value},wg(u.internal,Z))}}}),B0=Vi({name:"QCard",props:{...da,tag:{type:String,default:"div"},square:Boolean,flat:Boolean,bordered:Boolean},setup(r,{slots:u}){const{proxy:{$q:p}}=Pi(),y=fa(r,p),x=ve(()=>"q-card"+(y.value===!0?" q-card--dark q-dark":"")+(r.bordered===!0?" q-card--bordered":"")+(r.square===!0?" q-card--square no-border-radius":"")+(r.flat===!0?" q-card--flat no-shadow":""));return()=>Te(r.tag,{class:x.value},bn(u.default))}});function R0(r){if(r===!1)return 0;if(r===!0||r===void 0)return 1;const u=parseInt(r,10);return isNaN(u)?0:u}const KM=xg({name:"close-popup",beforeMount(r,{value:u}){const p={depth:R0(u),handler(y){p.depth!==0&&setTimeout(()=>{const x=dM(r);x!==void 0&&fM(x,y,p.depth)})},handlerKey(y){ua(y,13)===!0&&p.handler(y)}};r.__qclosepopup=p,r.addEventListener("click",p.handler),r.addEventListener("keyup",p.handlerKey)},updated(r,{value:u,oldValue:p}){u!==p&&(r.__qclosepopup.depth=R0(u))},beforeUnmount(r){const u=r.__qclosepopup;r.removeEventListener("click",u.handler),r.removeEventListener("keyup",u.handlerKey),delete r.__qclosepopup}}),YM="/assets/star-wars.f02d4277.jpg";const JM={style:{display:"flex","justify-content":"center","align-items":"center"}},QM={class:"title"},Nc={__name:"Title",props:{title:{type:String,default:!1}},setup(r){return(u,p)=>(qn(),ha("div",JM,[gi("p",QM,ia(r.title),1)]))}};function eI(){return Eo(nb)}function Jb(r,u){return function(){return r.apply(u,arguments)}}const{toString:Qb}=Object.prototype,{getPrototypeOf:Dg}=Object,Lg=(r=>u=>{const p=Qb.call(u);return r[p]||(r[p]=p.slice(8,-1).toLowerCase())})(Object.create(null)),Ts=r=>(r=r.toLowerCase(),u=>Lg(u)===r),Ip=r=>u=>typeof u===r,{isArray:Kh}=Array,q_=Ip("undefined");function tI(r){return r!==null&&!q_(r)&&r.constructor!==null&&!q_(r.constructor)&&jc(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const ew=Ts("ArrayBuffer");function iI(r){let u;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?u=ArrayBuffer.isView(r):u=r&&r.buffer&&ew(r.buffer),u}const nI=Ip("string"),jc=Ip("function"),tw=Ip("number"),iw=r=>r!==null&&typeof r=="object",rI=r=>r===!0||r===!1,Hf=r=>{if(Lg(r)!=="object")return!1;const u=Dg(r);return(u===null||u===Object.prototype||Object.getPrototypeOf(u)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},oI=Ts("Date"),sI=Ts("File"),aI=Ts("Blob"),lI=Ts("FileList"),cI=r=>iw(r)&&jc(r.pipe),uI=r=>{const u="[object FormData]";return r&&(typeof FormData=="function"&&r instanceof FormData||Qb.call(r)===u||jc(r.toString)&&r.toString()===u)},hI=Ts("URLSearchParams"),dI=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function kp(r,u,{allOwnKeys:p=!1}={}){if(r===null||typeof r>"u")return;let y,x;if(typeof r!="object"&&(r=[r]),Kh(r))for(y=0,x=r.length;y<x;y++)u.call(null,r[y],y,r);else{const T=p?Object.getOwnPropertyNames(r):Object.keys(r),A=T.length;let s;for(y=0;y<A;y++)s=T[y],u.call(null,r[s],s,r)}}function $_(){const r={},u=(p,y)=>{Hf(r[y])&&Hf(p)?r[y]=$_(r[y],p):Hf(p)?r[y]=$_({},p):Kh(p)?r[y]=p.slice():r[y]=p};for(let p=0,y=arguments.length;p<y;p++)arguments[p]&&kp(arguments[p],u);return r}const fI=(r,u,p,{allOwnKeys:y}={})=>(kp(u,(x,T)=>{p&&jc(x)?r[T]=Jb(x,p):r[T]=x},{allOwnKeys:y}),r),pI=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),mI=(r,u,p,y)=>{r.prototype=Object.create(u.prototype,y),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:u.prototype}),p&&Object.assign(r.prototype,p)},_I=(r,u,p,y)=>{let x,T,A;const s={};if(u=u||{},r==null)return u;do{for(x=Object.getOwnPropertyNames(r),T=x.length;T-- >0;)A=x[T],(!y||y(A,r,u))&&!s[A]&&(u[A]=r[A],s[A]=!0);r=p!==!1&&Dg(r)}while(r&&(!p||p(r,u))&&r!==Object.prototype);return u},gI=(r,u,p)=>{r=String(r),(p===void 0||p>r.length)&&(p=r.length),p-=u.length;const y=r.indexOf(u,p);return y!==-1&&y===p},yI=r=>{if(!r)return null;if(Kh(r))return r;let u=r.length;if(!tw(u))return null;const p=new Array(u);for(;u-- >0;)p[u]=r[u];return p},vI=(r=>u=>r&&u instanceof r)(typeof Uint8Array<"u"&&Dg(Uint8Array)),xI=(r,u)=>{const y=(r&&r[Symbol.iterator]).call(r);let x;for(;(x=y.next())&&!x.done;){const T=x.value;u.call(r,T[0],T[1])}},bI=(r,u)=>{let p;const y=[];for(;(p=r.exec(u))!==null;)y.push(p);return y},wI=Ts("HTMLFormElement"),TI=r=>r.toLowerCase().replace(/[_-\s]([a-z\d])(\w*)/g,function(p,y,x){return y.toUpperCase()+x}),O0=(({hasOwnProperty:r})=>(u,p)=>r.call(u,p))(Object.prototype),EI=Ts("RegExp"),nw=(r,u)=>{const p=Object.getOwnPropertyDescriptors(r),y={};kp(p,(x,T)=>{u(x,T,r)!==!1&&(y[T]=x)}),Object.defineProperties(r,y)},SI=r=>{nw(r,(u,p)=>{const y=r[p];if(!!jc(y)){if(u.enumerable=!1,"writable"in u){u.writable=!1;return}u.set||(u.set=()=>{throw Error("Can not read-only method '"+p+"'")})}})},CI=(r,u)=>{const p={},y=x=>{x.forEach(T=>{p[T]=!0})};return Kh(r)?y(r):y(String(r).split(u)),p},AI=()=>{},MI=(r,u)=>(r=+r,Number.isFinite(r)?r:u),pt={isArray:Kh,isArrayBuffer:ew,isBuffer:tI,isFormData:uI,isArrayBufferView:iI,isString:nI,isNumber:tw,isBoolean:rI,isObject:iw,isPlainObject:Hf,isUndefined:q_,isDate:oI,isFile:sI,isBlob:aI,isRegExp:EI,isFunction:jc,isStream:cI,isURLSearchParams:hI,isTypedArray:vI,isFileList:lI,forEach:kp,merge:$_,extend:fI,trim:dI,stripBOM:pI,inherits:mI,toFlatObject:_I,kindOf:Lg,kindOfTest:Ts,endsWith:gI,toArray:yI,forEachEntry:xI,matchAll:bI,isHTMLForm:wI,hasOwnProperty:O0,hasOwnProp:O0,reduceDescriptors:nw,freezeMethods:SI,toObjectSet:CI,toCamelCase:TI,noop:AI,toFiniteNumber:MI};function Hi(r,u,p,y,x){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",u&&(this.code=u),p&&(this.config=p),y&&(this.request=y),x&&(this.response=x)}pt.inherits(Hi,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const rw=Hi.prototype,ow={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{ow[r]={value:r}});Object.defineProperties(Hi,ow);Object.defineProperty(rw,"isAxiosError",{value:!0});Hi.from=(r,u,p,y,x,T)=>{const A=Object.create(rw);return pt.toFlatObject(r,A,function(D){return D!==Error.prototype},s=>s!=="isAxiosError"),Hi.call(A,r.message,u,p,y,x),A.cause=r,A.name=r.name,T&&Object.assign(A,T),A};var II=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},kI=typeof self=="object"?self.FormData:window.FormData;function G_(r){return pt.isPlainObject(r)||pt.isArray(r)}function sw(r){return pt.endsWith(r,"[]")?r.slice(0,-2):r}function F0(r,u,p){return r?r.concat(u).map(function(x,T){return x=sw(x),!p&&T?"["+x+"]":x}).join(p?".":""):u}function zI(r){return pt.isArray(r)&&!r.some(G_)}const PI=pt.toFlatObject(pt,{},null,function(u){return/^is[A-Z]/.test(u)});function DI(r){return r&&pt.isFunction(r.append)&&r[Symbol.toStringTag]==="FormData"&&r[Symbol.iterator]}function zp(r,u,p){if(!pt.isObject(r))throw new TypeError("target must be an object");u=u||new(kI||FormData),p=pt.toFlatObject(p,{metaTokens:!0,dots:!1,indexes:!1},!1,function(le,xe){return!pt.isUndefined(xe[le])});const y=p.metaTokens,x=p.visitor||F,T=p.dots,A=p.indexes,D=(p.Blob||typeof Blob<"u"&&Blob)&&DI(u);if(!pt.isFunction(x))throw new TypeError("visitor must be a function");function O(ae){if(ae===null)return"";if(pt.isDate(ae))return ae.toISOString();if(!D&&pt.isBlob(ae))throw new Hi("Blob is not supported. Use a Buffer instead.");return pt.isArrayBuffer(ae)||pt.isTypedArray(ae)?D&&typeof Blob=="function"?new Blob([ae]):Buffer.from(ae):ae}function F(ae,le,xe){let He=ae;if(ae&&!xe&&typeof ae=="object"){if(pt.endsWith(le,"{}"))le=y?le:le.slice(0,-2),ae=JSON.stringify(ae);else if(pt.isArray(ae)&&zI(ae)||pt.isFileList(ae)||pt.endsWith(le,"[]")&&(He=pt.toArray(ae)))return le=sw(le),He.forEach(function(Le,Ne){!pt.isUndefined(Le)&&u.append(A===!0?F0([le],Ne,T):A===null?le:le+"[]",O(Le))}),!1}return G_(ae)?!0:(u.append(F0(xe,le,T),O(ae)),!1)}const N=[],q=Object.assign(PI,{defaultVisitor:F,convertValue:O,isVisitable:G_});function Z(ae,le){if(!pt.isUndefined(ae)){if(N.indexOf(ae)!==-1)throw Error("Circular reference detected in "+le.join("."));N.push(ae),pt.forEach(ae,function(He,Ee){(!pt.isUndefined(He)&&x.call(u,He,pt.isString(Ee)?Ee.trim():Ee,le,q))===!0&&Z(He,le?le.concat(Ee):[Ee])}),N.pop()}}if(!pt.isObject(r))throw new TypeError("data must be an object");return Z(r),u}function V0(r){const u={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(y){return u[y]})}function Bg(r,u){this._pairs=[],r&&zp(r,this,u)}const aw=Bg.prototype;aw.append=function(u,p){this._pairs.push([u,p])};aw.toString=function(u){const p=u?function(y){return u.call(this,y,V0)}:V0;return this._pairs.map(function(x){return p(x[0])+"="+p(x[1])},"").join("&")};function LI(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function lw(r,u,p){if(!u)return r;const y=r.indexOf("#");y!==-1&&(r=r.slice(0,y));const x=p&&p.encode||LI,T=pt.isURLSearchParams(u)?u.toString():new Bg(u,p).toString(x);return T&&(r+=(r.indexOf("?")===-1?"?":"&")+T),r}class U0{constructor(){this.handlers=[]}use(u,p,y){return this.handlers.push({fulfilled:u,rejected:p,synchronous:y?y.synchronous:!1,runWhen:y?y.runWhen:null}),this.handlers.length-1}eject(u){this.handlers[u]&&(this.handlers[u]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(u){pt.forEach(this.handlers,function(y){y!==null&&u(y)})}}const cw={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},BI=typeof URLSearchParams<"u"?URLSearchParams:Bg,RI=FormData,OI=(()=>{let r;return typeof navigator<"u"&&((r=navigator.product)==="ReactNative"||r==="NativeScript"||r==="NS")?!1:typeof window<"u"&&typeof document<"u"})(),ys={isBrowser:!0,classes:{URLSearchParams:BI,FormData:RI,Blob},isStandardBrowserEnv:OI,protocols:["http","https","file","blob","url","data"]};function FI(r,u){return zp(r,new ys.classes.URLSearchParams,Object.assign({visitor:function(p,y,x,T){return ys.isNode&&pt.isBuffer(p)?(this.append(y,p.toString("base64")),!1):T.defaultVisitor.apply(this,arguments)}},u))}function VI(r){return pt.matchAll(/\w+|\[(\w*)]/g,r).map(u=>u[0]==="[]"?"":u[1]||u[0])}function UI(r){const u={},p=Object.keys(r);let y;const x=p.length;let T;for(y=0;y<x;y++)T=p[y],u[T]=r[T];return u}function uw(r){function u(p,y,x,T){let A=p[T++];const s=Number.isFinite(+A),D=T>=p.length;return A=!A&&pt.isArray(x)?x.length:A,D?(pt.hasOwnProp(x,A)?x[A]=[x[A],y]:x[A]=y,!s):((!x[A]||!pt.isObject(x[A]))&&(x[A]=[]),u(p,y,x[A],T)&&pt.isArray(x[A])&&(x[A]=UI(x[A])),!s)}if(pt.isFormData(r)&&pt.isFunction(r.entries)){const p={};return pt.forEachEntry(r,(y,x)=>{u(VI(y),x,p,0)}),p}return null}function NI(r,u,p){const y=p.config.validateStatus;!p.status||!y||y(p.status)?r(p):u(new Hi("Request failed with status code "+p.status,[Hi.ERR_BAD_REQUEST,Hi.ERR_BAD_RESPONSE][Math.floor(p.status/100)-4],p.config,p.request,p))}const jI=ys.isStandardBrowserEnv?function(){return{write:function(p,y,x,T,A,s){const D=[];D.push(p+"="+encodeURIComponent(y)),pt.isNumber(x)&&D.push("expires="+new Date(x).toGMTString()),pt.isString(T)&&D.push("path="+T),pt.isString(A)&&D.push("domain="+A),s===!0&&D.push("secure"),document.cookie=D.join("; ")},read:function(p){const y=document.cookie.match(new RegExp("(^|;\\s*)("+p+")=([^;]*)"));return y?decodeURIComponent(y[3]):null},remove:function(p){this.write(p,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function qI(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function $I(r,u){return u?r.replace(/\/+$/,"")+"/"+u.replace(/^\/+/,""):r}function hw(r,u){return r&&!qI(u)?$I(r,u):u}const GI=ys.isStandardBrowserEnv?function(){const u=/(msie|trident)/i.test(navigator.userAgent),p=document.createElement("a");let y;function x(T){let A=T;return u&&(p.setAttribute("href",A),A=p.href),p.setAttribute("href",A),{href:p.href,protocol:p.protocol?p.protocol.replace(/:$/,""):"",host:p.host,search:p.search?p.search.replace(/^\?/,""):"",hash:p.hash?p.hash.replace(/^#/,""):"",hostname:p.hostname,port:p.port,pathname:p.pathname.charAt(0)==="/"?p.pathname:"/"+p.pathname}}return y=x(window.location.href),function(A){const s=pt.isString(A)?x(A):A;return s.protocol===y.protocol&&s.host===y.host}}():function(){return function(){return!0}}();function Yh(r,u,p){Hi.call(this,r==null?"canceled":r,Hi.ERR_CANCELED,u,p),this.name="CanceledError"}pt.inherits(Yh,Hi,{__CANCEL__:!0});function ZI(r){const u=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return u&&u[1]||""}const WI=pt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),HI=r=>{const u={};let p,y,x;return r&&r.split(`
`).forEach(function(A){x=A.indexOf(":"),p=A.substring(0,x).trim().toLowerCase(),y=A.substring(x+1).trim(),!(!p||u[p]&&WI[p])&&(p==="set-cookie"?u[p]?u[p].push(y):u[p]=[y]:u[p]=u[p]?u[p]+", "+y:y)}),u},N0=Symbol("internals"),dw=Symbol("defaults");function Ih(r){return r&&String(r).trim().toLowerCase()}function Uf(r){return r===!1||r==null?r:String(r)}function XI(r){const u=Object.create(null),p=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let y;for(;y=p.exec(r);)u[y[1]]=y[2];return u}function j0(r,u,p,y){if(pt.isFunction(y))return y.call(this,u,p);if(!!pt.isString(u)){if(pt.isString(y))return u.indexOf(y)!==-1;if(pt.isRegExp(y))return y.test(u)}}function KI(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(u,p,y)=>p.toUpperCase()+y)}function YI(r,u){const p=pt.toCamelCase(" "+u);["get","set","has"].forEach(y=>{Object.defineProperty(r,y+p,{value:function(x,T,A){return this[y].call(this,u,x,T,A)},configurable:!0})})}function wh(r,u){u=u.toLowerCase();const p=Object.keys(r);let y=p.length,x;for(;y-- >0;)if(x=p[y],u===x.toLowerCase())return x;return null}function to(r,u){r&&this.set(r),this[dw]=u||null}Object.assign(to.prototype,{set:function(r,u,p){const y=this;function x(T,A,s){const D=Ih(A);if(!D)throw new Error("header name must be a non-empty string");const O=wh(y,D);O&&s!==!0&&(y[O]===!1||s===!1)||(pt.isArray(T)?T=T.map(Uf):T=Uf(T),y[O||A]=T)}return pt.isPlainObject(r)?pt.forEach(r,(T,A)=>{x(T,A,u)}):x(u,r,p),this},get:function(r,u){if(r=Ih(r),!r)return;const p=wh(this,r);if(p){const y=this[p];if(!u)return y;if(u===!0)return XI(y);if(pt.isFunction(u))return u.call(this,y,p);if(pt.isRegExp(u))return u.exec(y);throw new TypeError("parser must be boolean|regexp|function")}},has:function(r,u){if(r=Ih(r),r){const p=wh(this,r);return!!(p&&(!u||j0(this,this[p],p,u)))}return!1},delete:function(r,u){const p=this;let y=!1;function x(T){if(T=Ih(T),T){const A=wh(p,T);A&&(!u||j0(p,p[A],A,u))&&(delete p[A],y=!0)}}return pt.isArray(r)?r.forEach(x):x(r),y},clear:function(){return Object.keys(this).forEach(this.delete.bind(this))},normalize:function(r){const u=this,p={};return pt.forEach(this,(y,x)=>{const T=wh(p,x);if(T){u[T]=Uf(y),delete u[x];return}const A=r?KI(x):String(x).trim();A!==x&&delete u[x],u[A]=Uf(y),p[A]=!0}),this},toJSON:function(){const r=Object.create(null);return pt.forEach(Object.assign({},this[dw]||null,this),(u,p)=>{u==null||u===!1||(r[p]=pt.isArray(u)?u.join(", "):u)}),r}});Object.assign(to,{from:function(r){return pt.isString(r)?new this(HI(r)):r instanceof this?r:new this(r)},accessor:function(r){const p=(this[N0]=this[N0]={accessors:{}}).accessors,y=this.prototype;function x(T){const A=Ih(T);p[A]||(YI(y,T),p[A]=!0)}return pt.isArray(r)?r.forEach(x):x(r),this}});to.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent"]);pt.freezeMethods(to.prototype);pt.freezeMethods(to);function JI(r,u){r=r||10;const p=new Array(r),y=new Array(r);let x=0,T=0,A;return u=u!==void 0?u:1e3,function(D){const O=Date.now(),F=y[T];A||(A=O),p[x]=D,y[x]=O;let N=T,q=0;for(;N!==x;)q+=p[N++],N=N%r;if(x=(x+1)%r,x===T&&(T=(T+1)%r),O-A<u)return;const Z=F&&O-F;return Z?Math.round(q*1e3/Z):void 0}}function q0(r,u){let p=0;const y=JI(50,250);return x=>{const T=x.loaded,A=x.lengthComputable?x.total:void 0,s=T-p,D=y(s),O=T<=A;p=T;const F={loaded:T,total:A,progress:A?T/A:void 0,bytes:s,rate:D||void 0,estimated:D&&A&&O?(A-T)/D:void 0};F[u?"download":"upload"]=!0,r(F)}}function $0(r){return new Promise(function(p,y){let x=r.data;const T=to.from(r.headers).normalize(),A=r.responseType;let s;function D(){r.cancelToken&&r.cancelToken.unsubscribe(s),r.signal&&r.signal.removeEventListener("abort",s)}pt.isFormData(x)&&ys.isStandardBrowserEnv&&T.setContentType(!1);let O=new XMLHttpRequest;if(r.auth){const Z=r.auth.username||"",ae=r.auth.password?unescape(encodeURIComponent(r.auth.password)):"";T.set("Authorization","Basic "+btoa(Z+":"+ae))}const F=hw(r.baseURL,r.url);O.open(r.method.toUpperCase(),lw(F,r.params,r.paramsSerializer),!0),O.timeout=r.timeout;function N(){if(!O)return;const Z=to.from("getAllResponseHeaders"in O&&O.getAllResponseHeaders()),le={data:!A||A==="text"||A==="json"?O.responseText:O.response,status:O.status,statusText:O.statusText,headers:Z,config:r,request:O};NI(function(He){p(He),D()},function(He){y(He),D()},le),O=null}if("onloadend"in O?O.onloadend=N:O.onreadystatechange=function(){!O||O.readyState!==4||O.status===0&&!(O.responseURL&&O.responseURL.indexOf("file:")===0)||setTimeout(N)},O.onabort=function(){!O||(y(new Hi("Request aborted",Hi.ECONNABORTED,r,O)),O=null)},O.onerror=function(){y(new Hi("Network Error",Hi.ERR_NETWORK,r,O)),O=null},O.ontimeout=function(){let ae=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const le=r.transitional||cw;r.timeoutErrorMessage&&(ae=r.timeoutErrorMessage),y(new Hi(ae,le.clarifyTimeoutError?Hi.ETIMEDOUT:Hi.ECONNABORTED,r,O)),O=null},ys.isStandardBrowserEnv){const Z=(r.withCredentials||GI(F))&&r.xsrfCookieName&&jI.read(r.xsrfCookieName);Z&&T.set(r.xsrfHeaderName,Z)}x===void 0&&T.setContentType(null),"setRequestHeader"in O&&pt.forEach(T.toJSON(),function(ae,le){O.setRequestHeader(le,ae)}),pt.isUndefined(r.withCredentials)||(O.withCredentials=!!r.withCredentials),A&&A!=="json"&&(O.responseType=r.responseType),typeof r.onDownloadProgress=="function"&&O.addEventListener("progress",q0(r.onDownloadProgress,!0)),typeof r.onUploadProgress=="function"&&O.upload&&O.upload.addEventListener("progress",q0(r.onUploadProgress)),(r.cancelToken||r.signal)&&(s=Z=>{!O||(y(!Z||Z.type?new Yh(null,r,O):Z),O.abort(),O=null)},r.cancelToken&&r.cancelToken.subscribe(s),r.signal&&(r.signal.aborted?s():r.signal.addEventListener("abort",s)));const q=ZI(F);if(q&&ys.protocols.indexOf(q)===-1){y(new Hi("Unsupported protocol "+q+":",Hi.ERR_BAD_REQUEST,r));return}O.send(x||null)})}const G0={http:$0,xhr:$0},Z0={getAdapter:r=>{if(pt.isString(r)){const u=G0[r];if(!r)throw Error(pt.hasOwnProp(r)?`Adapter '${r}' is not available in the build`:`Can not resolve adapter '${r}'`);return u}if(!pt.isFunction(r))throw new TypeError("adapter is not a function");return r},adapters:G0},QI={"Content-Type":"application/x-www-form-urlencoded"};function ek(){let r;return typeof XMLHttpRequest<"u"?r=Z0.getAdapter("xhr"):typeof process<"u"&&pt.kindOf(process)==="process"&&(r=Z0.getAdapter("http")),r}function tk(r,u,p){if(pt.isString(r))try{return(u||JSON.parse)(r),pt.trim(r)}catch(y){if(y.name!=="SyntaxError")throw y}return(p||JSON.stringify)(r)}const qc={transitional:cw,adapter:ek(),transformRequest:[function(u,p){const y=p.getContentType()||"",x=y.indexOf("application/json")>-1,T=pt.isObject(u);if(T&&pt.isHTMLForm(u)&&(u=new FormData(u)),pt.isFormData(u))return x&&x?JSON.stringify(uw(u)):u;if(pt.isArrayBuffer(u)||pt.isBuffer(u)||pt.isStream(u)||pt.isFile(u)||pt.isBlob(u))return u;if(pt.isArrayBufferView(u))return u.buffer;if(pt.isURLSearchParams(u))return p.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),u.toString();let s;if(T){if(y.indexOf("application/x-www-form-urlencoded")>-1)return FI(u,this.formSerializer).toString();if((s=pt.isFileList(u))||y.indexOf("multipart/form-data")>-1){const D=this.env&&this.env.FormData;return zp(s?{"files[]":u}:u,D&&new D,this.formSerializer)}}return T||x?(p.setContentType("application/json",!1),tk(u)):u}],transformResponse:[function(u){const p=this.transitional||qc.transitional,y=p&&p.forcedJSONParsing,x=this.responseType==="json";if(u&&pt.isString(u)&&(y&&!this.responseType||x)){const A=!(p&&p.silentJSONParsing)&&x;try{return JSON.parse(u)}catch(s){if(A)throw s.name==="SyntaxError"?Hi.from(s,Hi.ERR_BAD_RESPONSE,this,null,this.response):s}}return u}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ys.classes.FormData,Blob:ys.classes.Blob},validateStatus:function(u){return u>=200&&u<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};pt.forEach(["delete","get","head"],function(u){qc.headers[u]={}});pt.forEach(["post","put","patch"],function(u){qc.headers[u]=pt.merge(QI)});function x_(r,u){const p=this||qc,y=u||p,x=to.from(y.headers);let T=y.data;return pt.forEach(r,function(s){T=s.call(p,T,x.normalize(),u?u.status:void 0)}),x.normalize(),T}function fw(r){return!!(r&&r.__CANCEL__)}function b_(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new Yh}function W0(r){return b_(r),r.headers=to.from(r.headers),r.data=x_.call(r,r.transformRequest),(r.adapter||qc.adapter)(r).then(function(y){return b_(r),y.data=x_.call(r,r.transformResponse,y),y.headers=to.from(y.headers),y},function(y){return fw(y)||(b_(r),y&&y.response&&(y.response.data=x_.call(r,r.transformResponse,y.response),y.response.headers=to.from(y.response.headers))),Promise.reject(y)})}function Zh(r,u){u=u||{};const p={};function y(O,F){return pt.isPlainObject(O)&&pt.isPlainObject(F)?pt.merge(O,F):pt.isPlainObject(F)?pt.merge({},F):pt.isArray(F)?F.slice():F}function x(O){if(pt.isUndefined(u[O])){if(!pt.isUndefined(r[O]))return y(void 0,r[O])}else return y(r[O],u[O])}function T(O){if(!pt.isUndefined(u[O]))return y(void 0,u[O])}function A(O){if(pt.isUndefined(u[O])){if(!pt.isUndefined(r[O]))return y(void 0,r[O])}else return y(void 0,u[O])}function s(O){if(O in u)return y(r[O],u[O]);if(O in r)return y(void 0,r[O])}const D={url:T,method:T,data:T,baseURL:A,transformRequest:A,transformResponse:A,paramsSerializer:A,timeout:A,timeoutMessage:A,withCredentials:A,adapter:A,responseType:A,xsrfCookieName:A,xsrfHeaderName:A,onUploadProgress:A,onDownloadProgress:A,decompress:A,maxContentLength:A,maxBodyLength:A,beforeRedirect:A,transport:A,httpAgent:A,httpsAgent:A,cancelToken:A,socketPath:A,responseEncoding:A,validateStatus:s};return pt.forEach(Object.keys(r).concat(Object.keys(u)),function(F){const N=D[F]||x,q=N(F);pt.isUndefined(q)&&N!==s||(p[F]=q)}),p}const pw="1.1.2",Rg={};["object","boolean","number","function","string","symbol"].forEach((r,u)=>{Rg[r]=function(y){return typeof y===r||"a"+(u<1?"n ":" ")+r}});const H0={};Rg.transitional=function(u,p,y){function x(T,A){return"[Axios v"+pw+"] Transitional option '"+T+"'"+A+(y?". "+y:"")}return(T,A,s)=>{if(u===!1)throw new Hi(x(A," has been removed"+(p?" in "+p:"")),Hi.ERR_DEPRECATED);return p&&!H0[A]&&(H0[A]=!0,console.warn(x(A," has been deprecated since v"+p+" and will be removed in the near future"))),u?u(T,A,s):!0}};function ik(r,u,p){if(typeof r!="object")throw new Hi("options must be an object",Hi.ERR_BAD_OPTION_VALUE);const y=Object.keys(r);let x=y.length;for(;x-- >0;){const T=y[x],A=u[T];if(A){const s=r[T],D=s===void 0||A(s,T,r);if(D!==!0)throw new Hi("option "+T+" must be "+D,Hi.ERR_BAD_OPTION_VALUE);continue}if(p!==!0)throw new Hi("Unknown option "+T,Hi.ERR_BAD_OPTION)}}const mw={assertOptions:ik,validators:Rg},bc=mw.validators;class gl{constructor(u){this.defaults=u,this.interceptors={request:new U0,response:new U0}}request(u,p){typeof u=="string"?(p=p||{},p.url=u):p=u||{},p=Zh(this.defaults,p);const y=p.transitional;y!==void 0&&mw.assertOptions(y,{silentJSONParsing:bc.transitional(bc.boolean),forcedJSONParsing:bc.transitional(bc.boolean),clarifyTimeoutError:bc.transitional(bc.boolean)},!1),p.method=(p.method||this.defaults.method||"get").toLowerCase();const x=p.headers&&pt.merge(p.headers.common,p.headers[p.method]);x&&pt.forEach(["delete","get","head","post","put","patch","common"],function(Z){delete p.headers[Z]}),p.headers=new to(p.headers,x);const T=[];let A=!0;this.interceptors.request.forEach(function(Z){typeof Z.runWhen=="function"&&Z.runWhen(p)===!1||(A=A&&Z.synchronous,T.unshift(Z.fulfilled,Z.rejected))});const s=[];this.interceptors.response.forEach(function(Z){s.push(Z.fulfilled,Z.rejected)});let D,O=0,F;if(!A){const q=[W0.bind(this),void 0];for(q.unshift.apply(q,T),q.push.apply(q,s),F=q.length,D=Promise.resolve(p);O<F;)D=D.then(q[O++],q[O++]);return D}F=T.length;let N=p;for(O=0;O<F;){const q=T[O++],Z=T[O++];try{N=q(N)}catch(ae){Z.call(this,ae);break}}try{D=W0.call(this,N)}catch(q){return Promise.reject(q)}for(O=0,F=s.length;O<F;)D=D.then(s[O++],s[O++]);return D}getUri(u){u=Zh(this.defaults,u);const p=hw(u.baseURL,u.url);return lw(p,u.params,u.paramsSerializer)}}pt.forEach(["delete","get","head","options"],function(u){gl.prototype[u]=function(p,y){return this.request(Zh(y||{},{method:u,url:p,data:(y||{}).data}))}});pt.forEach(["post","put","patch"],function(u){function p(y){return function(T,A,s){return this.request(Zh(s||{},{method:u,headers:y?{"Content-Type":"multipart/form-data"}:{},url:T,data:A}))}}gl.prototype[u]=p(),gl.prototype[u+"Form"]=p(!0)});class Og{constructor(u){if(typeof u!="function")throw new TypeError("executor must be a function.");let p;this.promise=new Promise(function(T){p=T});const y=this;this.promise.then(x=>{if(!y._listeners)return;let T=y._listeners.length;for(;T-- >0;)y._listeners[T](x);y._listeners=null}),this.promise.then=x=>{let T;const A=new Promise(s=>{y.subscribe(s),T=s}).then(x);return A.cancel=function(){y.unsubscribe(T)},A},u(function(T,A,s){y.reason||(y.reason=new Yh(T,A,s),p(y.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(u){if(this.reason){u(this.reason);return}this._listeners?this._listeners.push(u):this._listeners=[u]}unsubscribe(u){if(!this._listeners)return;const p=this._listeners.indexOf(u);p!==-1&&this._listeners.splice(p,1)}static source(){let u;return{token:new Og(function(x){u=x}),cancel:u}}}function nk(r){return function(p){return r.apply(null,p)}}function rk(r){return pt.isObject(r)&&r.isAxiosError===!0}function _w(r){const u=new gl(r),p=Jb(gl.prototype.request,u);return pt.extend(p,gl.prototype,u,{allOwnKeys:!0}),pt.extend(p,u,null,{allOwnKeys:!0}),p.create=function(x){return _w(Zh(r,x))},p}const Tr=_w(qc);Tr.Axios=gl;Tr.CanceledError=Yh;Tr.CancelToken=Og;Tr.isCancel=fw;Tr.VERSION=pw;Tr.toFormData=zp;Tr.AxiosError=Hi;Tr.Cancel=Tr.CanceledError;Tr.all=function(u){return Promise.all(u)};Tr.spread=nk;Tr.isAxiosError=rk;Tr.formToJSON=r=>uw(pt.isHTMLForm(r)?new FormData(r):r);const ok=()=>Tr.create({baseURL:"https://bear-express-delta.vercel.app/api/"}),sk=async()=>await ok().get("guest"),ak=async r=>await Tr.post("https://bear-express-delta.vercel.app/api/guest",r),lk={class:"row",style:{"justify-content":"center","align-items":"center"}},ck=gi("span",{class:"text-weight-bold text-deep-orange"},"*",-1),uk=gi("span",{class:"text-weight-bold text-deep-orange"},"*",-1),hk=gi("span",{class:"text-weight-bold text-deep-orange"},"*",-1),dk={style:{display:"flex","justify-content":"space-between"}},fk={style:{display:"flex","align-items":"center"}},pk=gi("p",{style:{color:"grey","font-size":"120%",padding:"0",margin:"0"}},"\xBFIr\xE1s en el autobus?",-1),mk={style:{display:"flex","justify-content":"center"}},_k=gi("br",null,null,-1),gk=gi("div",{style:{"font-weight":"900",display:"flex","justify-content":"center"}},[gi("p",null," \xBFDeseas enviar la informaci\xF3n? ")],-1),yk={style:{display:"flex","justify-content":"space-around"}},vk=gi("div",{style:{"font-weight":"900"}},"\xA1Todo ha ido correctamente!",-1),xk=gi("p",null,"Muchas gracias por ayudarnos con el registro.",-1),bk={__name:"Asistencia",setup(r){const u=eI(),p=xo({nombre:null,acompaniantesNombre:null,numAdultos:null,numNinios:null,alergias:null,bus:!1,observaciones:null}),y=xo({...p}),x=[0,1,2,3,4,5,6,7,8,9],T=[1,2,3,4,5,6,7,8,9],A=Ot(!1),s=Ot(!1),D=Ot(!1),O=ae=>s.value=ae,F=async()=>{A.value=!0;try{(await ak(y)).status===200?D.value=!0:(Z(),console.log("error"))}catch(ae){console.error(ae),Z()}A.value=!1,O(!1)},N=()=>{O(!0)},q=ae=>ae===null?" - ":ae;function Z(){u.notify({type:"negative",message:"Ocurri\xF3 un error, por favor contacta con nosotros."})}return(ae,le)=>(qn(),ha(or,null,[Lt(Nc,{title:"Asistencia"}),gi("div",lk,[Lt(Xb,{onSubmit:N,class:"q-gutter-lg",style:{width:"95%",display:"flex","flex-direction":"column"}},{default:Qi(()=>[Lt(Ah,{color:"blue-12",modelValue:y.nombre,"onUpdate:modelValue":le[0]||(le[0]=xe=>y.nombre=xe),"lazy-rules":"","label-slot":"",rules:[xe=>xe&&xe.length>0||"Campo obligatorio"]},{prepend:Qi(()=>[Lt(kn,{name:"person"})]),label:Qi(()=>[Xo(" Nombre y apellidos "),ck]),_:1},8,["modelValue","rules"]),Lt(Ah,{modelValue:y.acompaniantesNombre,"onUpdate:modelValue":le[1]||(le[1]=xe=>y.acompaniantesNombre=xe),type:"textarea",label:"Nombre y apellidos de acompa\xF1antes"},{prepend:Qi(()=>[Lt(kn,{name:"group"})]),_:1},8,["modelValue"]),Lt(D0,{color:"blue-12",modelValue:y.numAdultos,"onUpdate:modelValue":le[2]||(le[2]=xe=>y.numAdultos=xe),options:T,"lazy-rules":"","label-slot":"",rules:[xe=>xe!==null&&xe!==""||"Campo obligatorio"]},{prepend:Qi(()=>[Lt(kn,{name:"restaurant_menu"})]),label:Qi(()=>[Xo(" Menus adulto "),uk]),_:1},8,["modelValue","rules"]),Lt(D0,{color:"blue-12",modelValue:y.numNinios,"onUpdate:modelValue":le[3]||(le[3]=xe=>y.numNinios=xe),options:x,"lazy-rules":"","label-slot":"",rules:[xe=>xe!==null&&xe!==""||"Campo obligatorio"]},{prepend:Qi(()=>[Lt(kn,{name:"local_pizza"})]),label:Qi(()=>[Xo(" Menus ni\xF1o "),hk]),_:1},8,["modelValue","rules"]),Lt(Ah,{modelValue:y.alergias,"onUpdate:modelValue":le[4]||(le[4]=xe=>y.alergias=xe),label:"Alergias e intolerancias"},{prepend:Qi(()=>[Lt(kn,{name:"bug_report"})]),_:1},8,["modelValue"]),gi("div",dk,[gi("div",fk,[Lt(kn,{style:{color:"grey","font-size":"140%","padding-right":"1.2rem"},name:"directions_bus"}),pk]),Lt(GM,{modelValue:y.bus,"onUpdate:modelValue":le[5]||(le[5]=xe=>y.bus=xe),"checked-icon":"check",color:"green","unchecked-icon":"clear"},null,8,["modelValue"])]),Lt(Ah,{modelValue:y.observaciones,"onUpdate:modelValue":le[6]||(le[6]=xe=>y.observaciones=xe),type:"textarea",label:"\xBFQuieres a\xF1adir algo m\xE1s?"},{prepend:Qi(()=>[Lt(kn,{name:"contact_support"})]),_:1},8,["modelValue"]),gi("div",mk,[Lt(Qr,{style:{width:"60%"},type:"submit",color:"black",icon:"mail_outline",label:"Enviar",rounded:""})]),_k]),_:1})]),Lt(N_,{modelValue:s.value,"onUpdate:modelValue":le[9]||(le[9]=xe=>s.value=xe),"transition-show":"rotate","transition-hide":"rotate","transition-duration":"500"},{default:Qi(()=>[Lt(B0,null,{default:Qi(()=>[A.value?(qn(),_o(Vf,{key:1},{default:Qi(()=>[Lt(XM,{indeterminate:"",rounded:"",size:"10rem",color:"blue",class:"q-ma-md"})]),_:1})):(qn(),_o(Vf,{key:0},{default:Qi(()=>[gi("div",null,[gi("p",null,ia(`Nombre y apellidos:${y.nombre}`),1),gi("p",null,ia(`Nombre y apellidos de acompa\xF1antes:${q(y.acompaniantesNombre)}`),1),gi("p",null,ia(`N\xFAmero de menus de adulto:${y.numAdultos}`),1),gi("p",null,ia(`N\xFAmero de menus de ni\xF1o:${y.numNinios}`),1),gi("p",null,ia(`Alergias e intolerancias:${q(y.alergias)}`),1),gi("p",null,ia(`Ir\xE1s en autobus:${y.bus?"S\xED":"No"}`),1),gi("p",null,ia(`Otra informaci\xF3n:${q(y.observaciones)}`),1)]),gk,Lt(L0),gi("div",yk,[Lt(Qr,{style:{width:"40%"},color:"black",icon:"cancel",label:"No",rounded:"",onClick:le[7]||(le[7]=xe=>O(!1))}),Lt(Qr,{style:{width:"40%"},color:"black",icon:"mail_outline",label:"S\xED",rounded:"",onClick:le[8]||(le[8]=xe=>F())})])]),_:1}))]),_:1})]),_:1},8,["modelValue"]),Lt(N_,{modelValue:D.value,"onUpdate:modelValue":le[10]||(le[10]=xe=>D.value=xe)},{default:Qi(()=>[Lt(B0,null,{default:Qi(()=>[Lt(Vf,{class:"row items-center q-pb-none"},{default:Qi(()=>[vk,Lt(L0),dg(Lt(Qr,{icon:"close",flat:"",round:"",dense:""},null,512),[[KM]])]),_:1}),Lt(Vf,null,{default:Qi(()=>[xk,Lt(Eb,{src:YM,style:{width:"100%",height:"100%"}})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},Fg={left:!0,right:!0,up:!0,down:!0,horizontal:!0,vertical:!0},wk=Object.keys(Fg);Fg.all=!0;function X0(r){const u={};for(const p of wk)r[p]===!0&&(u[p]=!0);return Object.keys(u).length===0?Fg:(u.horizontal===!0?u.left=u.right=!0:u.left===!0&&u.right===!0&&(u.horizontal=!0),u.vertical===!0?u.up=u.down=!0:u.up===!0&&u.down===!0&&(u.vertical=!0),u.horizontal===!0&&u.vertical===!0&&(u.all=!0),u)}function K0(r,u){return u.event===void 0&&r.target!==void 0&&r.target.draggable!==!0&&typeof u.handler=="function"&&r.target.nodeName.toUpperCase()!=="INPUT"&&(r.qClonedBy===void 0||r.qClonedBy.indexOf(u.uid)===-1)}function Tk(r){const u=[.06,6,50];return typeof r=="string"&&r.length&&r.split(":").forEach((p,y)=>{const x=parseFloat(p);x&&(u[y]=x)}),u}const Ek=xg({name:"touch-swipe",beforeMount(r,{value:u,arg:p,modifiers:y}){if(y.mouse!==!0&&pn.has.touch!==!0)return;const x=y.mouseCapture===!0?"Capture":"",T={handler:u,sensitivity:Tk(p),direction:X0(y),noop:Ko,mouseStart(A){K0(A,T)&&xC(A)&&(ul(T,"temp",[[document,"mousemove","move",`notPassive${x}`],[document,"mouseup","end","notPassiveCapture"]]),T.start(A,!0))},touchStart(A){if(K0(A,T)){const s=A.target;ul(T,"temp",[[s,"touchmove","move","notPassiveCapture"],[s,"touchcancel","end","notPassiveCapture"],[s,"touchend","end","notPassiveCapture"]]),T.start(A)}},start(A,s){pn.is.firefox===!0&&h_(r,!0);const D=ip(A);T.event={x:D.left,y:D.top,time:Date.now(),mouse:s===!0,dir:!1}},move(A){if(T.event===void 0)return;if(T.event.dir!==!1){xn(A);return}const s=Date.now()-T.event.time;if(s===0)return;const D=ip(A),O=D.left-T.event.x,F=Math.abs(O),N=D.top-T.event.y,q=Math.abs(N);if(T.event.mouse!==!0){if(F<T.sensitivity[1]&&q<T.sensitivity[1]){T.end(A);return}}else if(F<T.sensitivity[2]&&q<T.sensitivity[2])return;const Z=F/s,ae=q/s;T.direction.vertical===!0&&F<q&&F<100&&ae>T.sensitivity[0]&&(T.event.dir=N<0?"up":"down"),T.direction.horizontal===!0&&F>q&&q<100&&Z>T.sensitivity[0]&&(T.event.dir=O<0?"left":"right"),T.direction.up===!0&&F<q&&N<0&&F<100&&ae>T.sensitivity[0]&&(T.event.dir="up"),T.direction.down===!0&&F<q&&N>0&&F<100&&ae>T.sensitivity[0]&&(T.event.dir="down"),T.direction.left===!0&&F>q&&O<0&&q<100&&Z>T.sensitivity[0]&&(T.event.dir="left"),T.direction.right===!0&&F>q&&O>0&&q<100&&Z>T.sensitivity[0]&&(T.event.dir="right"),T.event.dir!==!1?(xn(A),T.event.mouse===!0&&(document.body.classList.add("no-pointer-events--children"),document.body.classList.add("non-selectable"),Ob(),T.styleCleanup=le=>{T.styleCleanup=void 0,document.body.classList.remove("non-selectable");const xe=()=>{document.body.classList.remove("no-pointer-events--children")};le===!0?setTimeout(xe,50):xe()}),T.handler({evt:A,touch:T.event.mouse!==!0,mouse:T.event.mouse,direction:T.event.dir,duration:s,distance:{x:F,y:q}})):T.end(A)},end(A){T.event!==void 0&&(Lh(T,"temp"),pn.is.firefox===!0&&h_(r,!1),T.styleCleanup!==void 0&&T.styleCleanup(!0),A!==void 0&&T.event.dir!==!1&&xn(A),T.event=void 0)}};if(r.__qtouchswipe=T,y.mouse===!0){const A=y.mouseCapture===!0||y.mousecapture===!0?"Capture":"";ul(T,"main",[[r,"mousedown","mouseStart",`passive${A}`]])}pn.has.touch===!0&&ul(T,"main",[[r,"touchstart","touchStart",`passive${y.capture===!0?"Capture":""}`],[r,"touchmove","noop","notPassiveCapture"]])},updated(r,u){const p=r.__qtouchswipe;p!==void 0&&(u.oldValue!==u.value&&(typeof u.value!="function"&&p.end(),p.handler=u.value),p.direction=X0(u.modifiers))},beforeUnmount(r){const u=r.__qtouchswipe;u!==void 0&&(Lh(u,"main"),Lh(u,"temp"),pn.is.firefox===!0&&h_(r,!1),u.styleCleanup!==void 0&&u.styleCleanup(),delete r.__qtouchswipe)}});function Sk(){const r=new Map;return{getCache:function(u,p){return r[u]===void 0?r[u]=p:r[u]},getCacheWithFn:function(u,p){return r[u]===void 0?r[u]=p():r[u]}}}const Ck={name:{required:!0},disable:Boolean},Y0={setup(r,{slots:u}){return()=>Te("div",{class:"q-panel scroll",role:"tabpanel"},bn(u.default))}},Ak={modelValue:{required:!0},animated:Boolean,infinite:Boolean,swipeable:Boolean,vertical:Boolean,transitionPrev:String,transitionNext:String,transitionDuration:{type:[String,Number],default:300},keepAlive:Boolean,keepAliveInclude:[String,Array,RegExp],keepAliveExclude:[String,Array,RegExp],keepAliveMax:Number},Mk=["update:modelValue","before-transition","transition"];function Ik(){const{props:r,emit:u,proxy:p}=Pi(),{getCacheWithFn:y}=Sk();let x,T;const A=Ot(null),s=Ot(null);function D(Ge){const Ye=r.vertical===!0?"up":"left";we((p.$q.lang.rtl===!0?-1:1)*(Ge.direction===Ye?1:-1))}const O=ve(()=>[[Ek,D,void 0,{horizontal:r.vertical!==!0,vertical:r.vertical,mouse:!0}]]),F=ve(()=>r.transitionPrev||`slide-${r.vertical===!0?"down":"right"}`),N=ve(()=>r.transitionNext||`slide-${r.vertical===!0?"up":"left"}`),q=ve(()=>`--q-transition-duration: ${r.transitionDuration}ms`),Z=ve(()=>typeof r.modelValue=="string"||typeof r.modelValue=="number"?r.modelValue:String(r.modelValue)),ae=ve(()=>({include:r.keepAliveInclude,exclude:r.keepAliveExclude,max:r.keepAliveMax})),le=ve(()=>r.keepAliveInclude!==void 0||r.keepAliveExclude!==void 0);ri(()=>r.modelValue,(Ge,Ye)=>{const Ft=Le(Ge)===!0?Ne(Ge):-1;T!==!0&&Pe(Ft===-1?0:Ft<Ne(Ye)?-1:1),A.value!==Ft&&(A.value=Ft,u("before-transition",Ge,Ye),fn(()=>{u("transition",Ge,Ye)}))});function xe(){we(1)}function He(){we(-1)}function Ee(Ge){u("update:modelValue",Ge)}function Le(Ge){return Ge!=null&&Ge!==""}function Ne(Ge){return x.findIndex(Ye=>Ye.props.name===Ge&&Ye.props.disable!==""&&Ye.props.disable!==!0)}function Se(){return x.filter(Ge=>Ge.props.disable!==""&&Ge.props.disable!==!0)}function Pe(Ge){const Ye=Ge!==0&&r.animated===!0&&A.value!==-1?"q-transition--"+(Ge===-1?F.value:N.value):null;s.value!==Ye&&(s.value=Ye)}function we(Ge,Ye=A.value){let Ft=Ye+Ge;for(;Ft>-1&&Ft<x.length;){const Ht=x[Ft];if(Ht!==void 0&&Ht.props.disable!==""&&Ht.props.disable!==!0){Pe(Ge),T=!0,u("update:modelValue",Ht.props.name),setTimeout(()=>{T=!1});return}Ft+=Ge}r.infinite===!0&&x.length>0&&Ye!==-1&&Ye!==x.length&&we(Ge,Ge===-1?x.length:-1)}function De(){const Ge=Ne(r.modelValue);return A.value!==Ge&&(A.value=Ge),!0}function Ke(){const Ge=Le(r.modelValue)===!0&&De()&&x[A.value];return r.keepAlive===!0?[Te(YE,ae.value,[Te(le.value===!0?y(Z.value,()=>({...Y0,name:Z.value})):Y0,{key:Z.value,style:q.value},()=>Ge)])]:[Te("div",{class:"q-panel scroll",style:q.value,key:Z.value,role:"tabpanel"},[Ge])]}function Ue(){if(x.length!==0)return r.animated===!0?[Te(bs,{name:s.value},Ke)]:Ke()}function nt(Ge){return x=_b(bn(Ge.default,[])).filter(Ye=>Ye.props!==null&&Ye.props.slot===void 0&&Le(Ye.props.name)===!0),x.length}function $e(){return x}return Object.assign(p,{next:xe,previous:He,goTo:Ee}),{panelIndex:A,panelDirectives:O,updatePanelsList:nt,updatePanelIndex:De,getPanelContent:Ue,getEnabledPanels:Se,getPanels:$e,isValidPanelName:Le,keepAliveProps:ae,needsUniqueKeepAliveWrapper:le,goToPanelByOffset:we,goToPanel:Ee,nextPanel:xe,previousPanel:He}}const ta=Vi({name:"QCarouselSlide",props:{...Ck,imgSrc:String},setup(r,{slots:u}){const p=ve(()=>r.imgSrc?{backgroundImage:`url("${r.imgSrc}")`}:{});return()=>Te("div",{class:"q-carousel__slide",style:p.value},bn(u.default))}});let Th=0;const kk={fullscreen:Boolean,noRouteFullscreenExit:Boolean},zk=["update:fullscreen","fullscreen"];function Pk(){const r=Pi(),{props:u,emit:p,proxy:y}=r;let x,T,A;const s=Ot(!1);Tg(r)===!0&&ri(()=>y.$route.fullPath,()=>{u.noRouteFullscreenExit!==!0&&F()}),ri(()=>u.fullscreen,N=>{s.value!==N&&D()}),ri(s,N=>{p("update:fullscreen",N),p("fullscreen",N)});function D(){s.value===!0?F():O()}function O(){s.value!==!0&&(s.value=!0,A=y.$el.parentNode,A.replaceChild(T,y.$el),document.body.appendChild(y.$el),Th++,Th===1&&document.body.classList.add("q-body--fullscreen-mixin"),x={handler:F},jh.add(x))}function F(){s.value===!0&&(x!==void 0&&(jh.remove(x),x=void 0),A.replaceChild(y.$el,T),s.value=!1,Th=Math.max(0,Th-1),Th===0&&(document.body.classList.remove("q-body--fullscreen-mixin"),y.$el.scrollIntoView!==void 0&&setTimeout(()=>{y.$el.scrollIntoView()})))}return ug(()=>{T=document.createElement("span")}),ar(()=>{u.fullscreen===!0&&O()}),_n(F),Object.assign(y,{toggleFullscreen:D,setFullscreen:O,exitFullscreen:F}),{inFullscreen:s,toggleFullscreen:D}}const Dk=["top","right","bottom","left"],Lk=["regular","flat","outline","push","unelevated"],Bk=Vi({name:"QCarousel",props:{...da,...Ak,...kk,transitionPrev:{type:String,default:"fade"},transitionNext:{type:String,default:"fade"},height:String,padding:Boolean,controlColor:String,controlTextColor:String,controlType:{type:String,validator:r=>Lk.includes(r),default:"flat"},autoplay:[Number,Boolean],arrows:Boolean,prevIcon:String,nextIcon:String,navigation:Boolean,navigationPosition:{type:String,validator:r=>Dk.includes(r)},navigationIcon:String,navigationActiveIcon:String,thumbnails:Boolean},emits:[...zk,...Mk],setup(r,{slots:u}){const{proxy:{$q:p}}=Pi(),y=fa(r,p);let x,T;const{updatePanelsList:A,getPanelContent:s,panelDirectives:D,goToPanel:O,previousPanel:F,nextPanel:N,getEnabledPanels:q,panelIndex:Z}=Ik(),{inFullscreen:ae}=Pk(),le=ve(()=>ae.value!==!0&&r.height!==void 0?{height:r.height}:{}),xe=ve(()=>r.vertical===!0?"vertical":"horizontal"),He=ve(()=>`q-carousel q-panel-parent q-carousel--with${r.padding===!0?"":"out"}-padding`+(ae.value===!0?" fullscreen":"")+(y.value===!0?" q-carousel--dark q-dark":"")+(r.arrows===!0?` q-carousel--arrows-${xe.value}`:"")+(r.navigation===!0?` q-carousel--navigation-${Se.value}`:"")),Ee=ve(()=>{const Ue=[r.prevIcon||p.iconSet.carousel[r.vertical===!0?"up":"left"],r.nextIcon||p.iconSet.carousel[r.vertical===!0?"down":"right"]];return r.vertical===!1&&p.lang.rtl===!0?Ue.reverse():Ue}),Le=ve(()=>r.navigationIcon||p.iconSet.carousel.navigationIcon),Ne=ve(()=>r.navigationActiveIcon||Le.value),Se=ve(()=>r.navigationPosition||(r.vertical===!0?"right":"bottom")),Pe=ve(()=>({color:r.controlColor,textColor:r.controlTextColor,round:!0,[r.controlType]:!0,dense:!0}));ri(()=>r.modelValue,()=>{r.autoplay&&(clearInterval(x),we())}),ri(()=>r.autoplay,Ue=>{Ue?we():clearInterval(x)});function we(){const Ue=RC(r.autoplay)===!0?r.autoplay:5e3;x=setTimeout(Ue>=0?N:F,Math.abs(Ue))}ar(()=>{r.autoplay&&we()}),_n(()=>{clearInterval(x)});function De(Ue,nt){return Te("div",{class:`q-carousel__control q-carousel__navigation no-wrap absolute flex q-carousel__navigation--${Ue} q-carousel__navigation--${Se.value}`+(r.controlColor!==void 0?` text-${r.controlColor}`:"")},[Te("div",{class:"q-carousel__navigation-inner flex flex-center no-wrap"},q().map(nt))])}function Ke(){const Ue=[];if(r.navigation===!0){const nt=u["navigation-icon"]!==void 0?u["navigation-icon"]:Ge=>Te(Qr,{key:"nav"+Ge.name,class:`q-carousel__navigation-icon q-carousel__navigation-icon--${Ge.active===!0?"":"in"}active`,...Ge.btnProps,onClick:Ge.onClick}),$e=T-1;Ue.push(De("buttons",(Ge,Ye)=>{const Ft=Ge.props.name,Ht=Z.value===Ye;return nt({index:Ye,maxIndex:$e,name:Ft,active:Ht,btnProps:{icon:Ht===!0?Ne.value:Le.value,size:"sm",...Pe.value},onClick:()=>{O(Ft)}})}))}else if(r.thumbnails===!0){const nt=r.controlColor!==void 0?` text-${r.controlColor}`:"";Ue.push(De("thumbnails",$e=>{const Ge=$e.props;return Te("img",{key:"tmb#"+Ge.name,class:`q-carousel__thumbnail q-carousel__thumbnail--${Ge.name===r.modelValue?"":"in"}active`+nt,src:Ge.imgSrc||Ge["img-src"],onClick:()=>{O(Ge.name)}})}))}return r.arrows===!0&&Z.value>=0&&((r.infinite===!0||Z.value>0)&&Ue.push(Te("div",{key:"prev",class:`q-carousel__control q-carousel__arrow q-carousel__prev-arrow q-carousel__prev-arrow--${xe.value} absolute flex flex-center`},[Te(Qr,{icon:Ee.value[0],...Pe.value,onClick:F})])),(r.infinite===!0||Z.value<T-1)&&Ue.push(Te("div",{key:"next",class:`q-carousel__control q-carousel__arrow q-carousel__next-arrow q-carousel__next-arrow--${xe.value} absolute flex flex-center`},[Te(Qr,{icon:Ee.value[1],...Pe.value,onClick:N})]))),Jr(u.control,Ue)}return()=>(T=A(u),Te("div",{class:He.value,style:le.value},[lb("div",{class:"q-carousel__slides-container"},s(),"sl-cont",r.swipeable,()=>D.value)].concat(Ke())))}}),Rk="/assets/restaurante.6e2a3953.jpeg",Ok="/assets/boda-ali.232ec7ae.jpeg",Fk="/assets/boda-ana.8e21094f.jpeg",Vk="/assets/cala.f0770073.jpeg",Uk="/assets/gorra-verde.9b93d1c2.jpeg",Nk="/assets/monte.3968e21c.jpeg",jk="/assets/thor.f22c0701.jpeg",qk="/assets/terrorista.3f475105.jpeg",$k=gi("div",{class:"col-12 column",style:{padding:"1rem"}},[gi("p",{class:"text-justify"},"\xA1Bienvenid@s! Despu\xE9s de vivir juntos en Madrid, pasar un confinamiento extricto, comprar una casa en Alcal\xE1 de Henares, el nacimiento de Iv\xE1n, retrasar una boda por su llegada e ir a cinco bodas de las cuales ninguna ha sido la nuestra... "),gi("p",{class:"text-justify"},[Xo("Nos alegra anunciar que el pr\xF3ximo d\xEDa s\xE1bado "),gi("strong",null,[gi("u",null,"27 de Mayo de 2023")]),Xo(" celebraremos nuestro matrimonio junto a nuestros seres queridos.")])],-1),Gk={__name:"Inicio",setup(r){const u=Ot(1),p=Ot(!0);return(y,x)=>(qn(),ha(or,null,[Lt(Nc,{title:"Inicio"}),$k,Lt(Bk,{swipeable:"",animated:"",modelValue:u.value,"onUpdate:modelValue":x[0]||(x[0]=T=>u.value=T),thumbnails:"",autoplay:p.value,infinite:"","transition-prev":"slide-right","transition-next":"slide-left",onMouseenter:x[1]||(x[1]=T=>p.value=!1),onMouseleave:x[2]||(x[2]=T=>p.value=!0)},{default:Qi(()=>[Lt(ta,{name:1,"img-src":Rk}),Lt(ta,{name:2,"img-src":Ok}),Lt(ta,{name:3,"img-src":Fk}),Lt(ta,{name:4,"img-src":Vk}),Lt(ta,{name:5,"img-src":Uk}),Lt(ta,{name:6,"img-src":Nk}),Lt(ta,{name:7,"img-src":jk}),Lt(ta,{name:8,"img-src":qk}),Xo(" > ")]),_:1},8,["modelValue","autoplay"])],64))}},Eh=Vi({name:"QTimelineEntry",props:{heading:Boolean,tag:{type:String,default:"h3"},side:{type:String,default:"right",validator:r=>["left","right"].includes(r)},icon:String,avatar:String,color:String,title:String,subtitle:String,body:String},setup(r,{slots:u}){const p=Eo(rb,()=>{console.error("QTimelineEntry needs to be child of QTimeline")}),y=ve(()=>`q-timeline__entry q-timeline__entry--${r.side}`+(r.icon!==void 0||r.avatar!==void 0?" q-timeline__entry--icon":"")),x=ve(()=>`q-timeline__dot text-${r.color||p.color}`),T=ve(()=>p.layout==="comfortable"&&p.side==="left");return()=>{const A=bg(u.default,[]);if(r.body!==void 0&&A.unshift(r.body),r.heading===!0){const O=[Te("div"),Te("div"),Te(r.tag,{class:"q-timeline__heading-title"},A)];return Te("div",{class:"q-timeline__heading"},T.value===!0?O.reverse():O)}let s;r.icon!==void 0?s=[Te(kn,{class:"row items-center justify-center",name:r.icon})]:r.avatar!==void 0&&(s=[Te("img",{class:"q-timeline__dot-img",src:r.avatar})]);const D=[Te("div",{class:"q-timeline__subtitle"},[Te("span",{},bn(u.subtitle,[r.subtitle]))]),Te("div",{class:x.value},s),Te("div",{class:"q-timeline__content"},[Te("h6",{class:"q-timeline__title"},bn(u.title,[r.title]))].concat(A))];return Te("li",{class:y.value},T.value===!0?D.reverse():D)}}}),Zk=Vi({name:"QTimeline",props:{...da,color:{type:String,default:"primary"},side:{type:String,default:"right",validator:r=>["left","right"].includes(r)},layout:{type:String,default:"dense",validator:r=>["dense","comfortable","loose"].includes(r)}},setup(r,{slots:u}){const p=Pi(),y=fa(r,p.proxy.$q);Oc(rb,r);const x=ve(()=>`q-timeline q-timeline--${r.layout} q-timeline--${r.layout}--${r.side}`+(y.value===!0?" q-timeline--dark":""));return()=>Te("ul",{class:x.value},bn(u.default))}}),Wk={class:"col-12 column",style:{padding:"1rem"}},Hk={class:"q-px-lg q-pb-md"},Xk={__name:"Itinerario",setup(r){return(u,p)=>(qn(),ha(or,null,[Lt(Nc,{title:"Itinerario"}),gi("div",Wk,[gi("div",Hk,[Lt(Zk,{color:"secondary"},{default:Qi(()=>[Lt(Eh,{title:"Ceremonia",subtitle:"13:30H",icon:"church",body:"Un ofreciante dedicar\xE1 unas palabras. Adem\xE1s hablaran amigos y familiares de los novios.",color:"pink"}),Lt(Eh,{title:"Coctel",subtitle:"14:30H",icon:"tapas",body:"Se servir\xE1 un magn\xEDfico coctel, en el cual habr\xE1 comida y bebida."}),Lt(Eh,{title:"Comida",subtitle:"16:00H",icon:"restaurant",color:"green",body:"Momento de disfrutar del men\xFA, consta con dos platos y postre."}),Lt(Eh,{title:"Fiesta",subtitle:"18:00H",icon:"nightlife",body:"Ser\xE1 hora de bailar y brindar para celebrar el matrimonio.",color:"red"}),Lt(Eh,{title:"Recena",subtitle:"21:00H",color:"orange",icon:"lunch_dining",body:"Una hora antes de finalizar la fiesta habr\xE1 una peque\xF1a sorpresa para cenar."})]),_:1})])])],64))}};var gw={exports:{}};(function(r,u){(function(p,y){r.exports=y()})(II,function(){var p,y,x;function T(s,D){if(!p)p=D;else if(!y)y=D;else{var O="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+p+")(sharedChunk); ("+y+")(sharedChunk); self.onerror = null;",F={};p(F),x=D(F),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(x.workerUrl=window.URL.createObjectURL(new Blob([O],{type:"text/javascript"})))}}T(["exports"],function(s){var D=typeof self<"u"?self:{},O=F;function F(i,e,t,o){this.cx=3*i,this.bx=3*(t-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=o,this.p2x=t,this.p2y=o}F.prototype.sampleCurveX=function(i){return((this.ax*i+this.bx)*i+this.cx)*i},F.prototype.sampleCurveY=function(i){return((this.ay*i+this.by)*i+this.cy)*i},F.prototype.sampleCurveDerivativeX=function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},F.prototype.solveCurveX=function(i,e){var t,o,l,h,f;for(e===void 0&&(e=1e-6),l=i,f=0;f<8;f++){if(h=this.sampleCurveX(l)-i,Math.abs(h)<e)return l;var m=this.sampleCurveDerivativeX(l);if(Math.abs(m)<1e-6)break;l-=h/m}if((l=i)<(t=0))return t;if(l>(o=1))return o;for(;t<o;){if(h=this.sampleCurveX(l),Math.abs(h-i)<e)return l;i>h?t=l:o=l,l=.5*(o-t)+t}return l},F.prototype.solve=function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))};var N=q;function q(i,e){this.x=i,this.y=e}q.prototype={clone:function(){return new q(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,t=i.y-this.y;return e*e+t*t},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),t=Math.sin(i),o=t*this.x+e*this.y;return this.x=e*this.x-t*this.y,this.y=o,this},_rotateAround:function(i,e){var t=Math.cos(i),o=Math.sin(i),l=e.y+o*(this.x-e.x)+t*(this.y-e.y);return this.x=e.x+t*(this.x-e.x)-o*(this.y-e.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},q.convert=function(i){return i instanceof q?i:Array.isArray(i)?new q(i[0],i[1]):i};const Z=Math.PI/180,ae=180/Math.PI;function le(i){return i*Z}function xe(i){return i*ae}const He=[[0,0],[1,0],[1,1],[0,1]];function Ee(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,t=e*i;return 4*(i<.5?t:3*(i-e)+t-.75)}function Le(i,e,t,o){const l=new O(i,e,t,o);return function(h){return l.solve(h)}}const Ne=Le(.25,.1,.25,1);function Se(i,e,t){return Math.min(t,Math.max(e,i))}function Pe(i,e,t){return(t=Se((t-i)/(e-i),0,1))*t*(3-2*t)}function we(i,e,t){const o=t-e,l=((i-e)%o+o)%o+e;return l===e?t:l}function De(i,e,t){if(!i.length)return t(null,[]);let o=i.length;const l=new Array(i.length);let h=null;i.forEach((f,m)=>{e(f,(v,b)=>{v&&(h=v),l[m]=b,--o==0&&t(h,l)})})}function Ke(i){const e=[];for(const t in i)e.push(i[t]);return e}function Ue(i,...e){for(const t of e)for(const o in t)i[o]=t[o];return i}let nt=1;function $e(){return nt++}function Ge(){return function i(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function Ye(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function Ft(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function Ht(i,e){i.forEach(t=>{e[t]&&(e[t]=e[t].bind(e))})}function ot(i,e){return i.indexOf(e,i.length-e.length)!==-1}function At(i,e,t){const o={};for(const l in i)o[l]=e.call(t||this,i[l],l,i);return o}function di(i,e,t){const o={};for(const l in i)e.call(t||this,i[l],l,i)&&(o[l]=i[l]);return o}function Fe(i){return Array.isArray(i)?i.map(Fe):typeof i=="object"&&i?At(i,Fe):i}const _t={};function xt(i){_t[i]||(typeof console<"u"&&console.warn(i),_t[i]=!0)}function Bt(i,e,t){return(t.y-i.y)*(e.x-i.x)>(e.y-i.y)*(t.x-i.x)}function pi(i){let e=0;for(let t,o,l=0,h=i.length,f=h-1;l<h;f=l++)t=i[l],o=i[f],e+=(o.x-t.x)*(t.y+o.y);return e}function Ci(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Kt(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(t,o,l,h)=>{const f=l||h;return e[o]=!f||f.toLowerCase(),""}),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e}let Yt=null;function Jt(i){if(Yt==null){const e=i.navigator?i.navigator.userAgent:null;Yt=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Yt}function Et(i){try{const e=D[i];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Ri(i,e){return[i[4*e],i[4*e+1],i[4*e+2],i[4*e+3]]}const Tn=D.performance;function de(i){const e=i?i.url.toString():void 0;return Tn.getEntriesByName(e)}var Ce="2.10.0";let Re,ct,ut,bt;const Mt={now:()=>ut!==void 0?ut:D.performance.now(),setNow(i){ut=i},restoreNow(){ut=void 0},frame(i){const e=D.requestAnimationFrame(i);return{cancel:()=>D.cancelAnimationFrame(e)}},getImageData(i,e=0){const{width:t,height:o}=i;bt||(bt=D.document.createElement("canvas"));const l=bt.getContext("2d");if(!l)throw new Error("failed to create canvas 2d context");return(t>bt.width||o>bt.height)&&(bt.width=t,bt.height=o),l.clearRect(-e,-e,t+2*e,o+2*e),l.drawImage(i,0,0,t,o),l.getImageData(-e,-e,t+2*e,o+2*e)},resolveURL:i=>(Re||(Re=D.document.createElement("a")),Re.href=i,Re.href),get devicePixelRatio(){return D.devicePixelRatio},get prefersReducedMotion(){return!!D.matchMedia&&(ct==null&&(ct=D.matchMedia("(prefers-reduced-motion: reduce)")),ct.matches)}};let gt;const Xe={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(gt==null){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{gt=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):i}catch{gt=i}}return gt},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ht={supported:!1,testSupport:function(i){!Zt&&Nt&&(ti?mi(i):qt=i)}};let qt,Nt,Zt=!1,ti=!1;function mi(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,Nt),i.isContextLost())return;ht.supported=!0}catch{}i.deleteTexture(e),Zt=!0}D.document&&(Nt=D.document.createElement("img"),Nt.onload=function(){qt&&mi(qt),qt=null,ti=!0},Nt.onerror=function(){Zt=!0,qt=null},Nt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Di="01",si="NO_ACCESS_TOKEN";function Ai(i){return i.indexOf("mapbox:")===0}function hn(i){return Xe.API_URL_REGEX.test(i)}const gr=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Cn(i){const e=i.match(gr);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function zn(i){const e=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${e}`}function qr(i){if(!i)return null;const e=i.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(D.atob(e[1]).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class gn{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const t=qr(Xe.ACCESS_TOKEN);let o="";return o=t&&t.u?D.btoa(encodeURIComponent(t.u).replace(/%([0-9A-F]{2})/g,(l,h)=>String.fromCharCode(Number("0x"+h)))):Xe.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${o}`:`mapbox.eventData:${o}`}fetchEventData(){const e=Et("localStorage"),t=this.getStorageKey(),o=this.getStorageKey("uuid");if(e)try{const l=D.localStorage.getItem(t);l&&(this.eventData=JSON.parse(l));const h=D.localStorage.getItem(o);h&&(this.anonId=h)}catch{xt("Unable to read from LocalStorage")}}saveEventData(){const e=Et("localStorage"),t=this.getStorageKey(),o=this.getStorageKey("uuid");if(e)try{D.localStorage.setItem(o,this.anonId),Object.keys(this.eventData).length>=1&&D.localStorage.setItem(t,JSON.stringify(this.eventData))}catch{xt("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,t,o,l){if(!Xe.EVENTS_URL)return;const h=Cn(Xe.EVENTS_URL);h.params.push(`access_token=${l||Xe.ACCESS_TOKEN||""}`);const f={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:Ce,skuId:Di,userId:this.anonId},m=t?Ue(f,t):f,v={url:zn(h),headers:{"Content-Type":"text/plain"},body:JSON.stringify([m])};this.pendingRequest=Qe(v,b=>{this.pendingRequest=null,o(b),this.saveEventData(),this.processRequests(l)})}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const Pn=new class extends gn{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,e){Xe.EVENTS_URL&&Xe.ACCESS_TOKEN&&Array.isArray(i)&&i.some(t=>Ai(t)||hn(t))&&this.queueRequest(Date.now(),e)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=qr(Xe.ACCESS_TOKEN),t=e?e.u:Xe.ACCESS_TOKEN;let o=t!==this.eventData.tokenU;Ft(this.anonId)||(this.anonId=Ge(),o=!0);const l=this.queue.shift();if(this.eventData.lastSuccess){const h=new Date(this.eventData.lastSuccess),f=new Date(l),m=(l-this.eventData.lastSuccess)/864e5;o=o||m>=1||m<-1||h.getDate()!==f.getDate()}else o=!0;o?this.postEvent(l,{"enabled.telemetry":!1},h=>{h||(this.eventData.lastSuccess=l,this.eventData.tokenU=t)},i):this.processRequests()}},Pr=Pn.postTurnstileEvent.bind(Pn),Ao=new class extends gn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,e,t,o){this.skuToken=e,this.errorCb=o,Xe.EVENTS_URL&&(t||Xe.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},t):this.errorCb(new Error(si)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:t}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Ft(this.anonId)||(this.anonId=Ge()),this.postEvent(t,{skuToken:this.skuToken},o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},i))}},Yo=Ao.postMapLoadEvent.bind(Ao),Es=new class extends gn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,e,t,o){if(!Xe.API_URL||!Xe.SESSION_PATH)return;const l=Cn(Xe.API_URL+Xe.SESSION_PATH);l.params.push(`sku=${e||""}`),l.params.push(`access_token=${o||Xe.ACCESS_TOKEN||""}`);const h={url:zn(l),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Ct(h,f=>{this.pendingRequest=null,t(f),this.saveEventData(),this.processRequests(o)})}getSessionAPI(i,e,t,o){this.skuToken=e,this.errorCb=o,Xe.SESSION_PATH&&Xe.API_URL&&(t||Xe.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},t):this.errorCb(new Error(si)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:t}=this.queue.shift();e&&this.success[e]||this.getSession(t,this.skuToken,o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},i)}},pa=Es.getSessionAPI.bind(Es),Dr=new Set;let Lr,io=500,no=50,An={};function Er(i){const e=V(i);let t,o;e&&e.forEach(h=>{const f=h.split("=");f[0]==="language"?t=f[1]:f[0]==="worldview"&&(o=f[1])});let l="mapbox-tiles";return t&&(l+=`-${t}`),o&&(l+=`-${o}`),l}function Q(){try{return D.caches}catch{}}function B(i){const e=Q();e&&!An[i]&&(An[i]=e.open(i))}function V(i){const e=i.indexOf("?");return e>0?i.slice(e+1).split("&"):[]}function J(i){const e=i.indexOf("?");if(e<0)return i;const t=V(i).filter(o=>{const l=o.split("=");return l[0]==="language"||l[0]==="worldview"});return t.length?`${i.slice(0,e)}?${t.join("&")}`:i.slice(0,e)}let ne=1/0;const ge={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(ge);class ke extends Error{constructor(e,t,o){t===401&&hn(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ae=Ci()?()=>self.worker&&self.worker.referrer:()=>(D.location.protocol==="blob:"?D.parent:D).location.href,ye=function(i,e){if(!(/^file:/.test(t=i.url)||/^file:/.test(Ae())&&!/^\w+:/.test(t))){if(D.fetch&&D.Request&&D.AbortController&&D.Request.prototype.hasOwnProperty("signal"))return function(o,l){const h=new D.AbortController,f=new D.Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:Ae(),signal:h.signal});let m=!1,v=!1;const b=(S=f.url).indexOf("sku=")>0&&hn(S);var S;o.type==="json"&&f.headers.set("Accept","application/json");const M=(P,L,U)=>{if(v)return;if(P&&P.message!=="SecurityError"&&xt(P),L&&U)return I(L);const $=Date.now();D.fetch(f).then(ee=>{if(ee.ok){const se=b?ee.clone():null;return I(ee,se,$)}return l(new ke(ee.statusText,ee.status,o.url))}).catch(ee=>{ee.code!==20&&l(new Error(ee.message))})},I=(P,L,U)=>{(o.type==="arrayBuffer"?P.arrayBuffer():o.type==="json"?P.json():P.text()).then($=>{v||(L&&U&&function(ee,se,ie){const re=Er(ee.url);if(B(re),!An[re])return;const _e={status:se.status,statusText:se.statusText,headers:new D.Headers};se.headers.forEach((Oe,We)=>_e.headers.set(We,Oe));const ce=Kt(se.headers.get("Cache-Control")||"");if(ce["no-store"])return;ce["max-age"]&&_e.headers.set("Expires",new Date(ie+1e3*ce["max-age"]).toUTCString());const Ve=_e.headers.get("Expires");Ve&&(new Date(Ve).getTime()-ie<42e4||function(Oe,We){if(Lr===void 0)try{new Response(new ReadableStream),Lr=!0}catch{Lr=!1}Lr?We(Oe.body):Oe.blob().then(We)}(se,Oe=>{const We=new D.Response(Oe,_e);B(re),An[re]&&An[re].then(yt=>yt.put(J(ee.url),We)).catch(yt=>xt(yt.message))}))}(f,L,U),m=!0,l(null,$,P.headers.get("Cache-Control"),P.headers.get("Expires")))}).catch($=>{v||l(new Error($.message))})};return b?function(P,L){const U=Er(P.url);if(B(U),!An[U])return L(null);const $=J(P.url);An[U].then(ee=>{ee.match($).then(se=>{const ie=function(re){if(!re)return!1;const _e=new Date(re.headers.get("Expires")||0),ce=Kt(re.headers.get("Cache-Control")||"");return _e>Date.now()&&!ce["no-cache"]}(se);ee.delete($),ie&&ee.put($,se.clone()),L(null,se,ie)}).catch(L)}).catch(L)}(f,M):M(null,null),{cancel:()=>{v=!0,m||h.abort()}}}(i,e);if(Ci()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var t;return function(o,l){const h=new D.XMLHttpRequest;h.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(const f in o.headers)h.setRequestHeader(f,o.headers[f]);return o.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=o.credentials==="include",h.onerror=()=>{l(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let f=h.response;if(o.type==="json")try{f=JSON.parse(h.response)}catch(m){return l(m)}l(null,f,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else l(new ke(h.statusText,h.status,o.url))},h.send(o.body),{cancel:()=>h.abort()}}(i,e)},ze=function(i,e){return ye(Ue(i,{type:"arrayBuffer"}),e)},Qe=function(i,e){return ye(Ue(i,{method:"POST"}),e)},Ct=function(i,e){return ye(Ue(i,{method:"GET"}),e)};function st(i){const e=D.document.createElement("a");return e.href=i,e.protocol===D.document.location.protocol&&e.host===D.document.location.host}const $t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Xt,jt;Xt=[],jt=0;const Qt=function(i,e){if(ht.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),jt>=Xe.MAX_PARALLEL_IMAGE_REQUESTS){const h={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Xt.push(h),h}jt++;let t=!1;const o=()=>{if(!t)for(t=!0,jt--;Xt.length&&jt<Xe.MAX_PARALLEL_IMAGE_REQUESTS;){const h=Xt.shift(),{requestParameters:f,callback:m,cancelled:v}=h;v||(h.cancel=Qt(f,m).cancel)}},l=ze(i,(h,f,m,v)=>{o(),h?e(h):f&&(D.createImageBitmap?function(b,S){const M=new D.Blob([new Uint8Array(b)],{type:"image/png"});D.createImageBitmap(M).then(I=>{S(null,I)}).catch(I=>{S(new Error(`Could not load image because of ${I.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(f,(b,S)=>e(b,S,m,v)):function(b,S){const M=new D.Image,I=D.URL;M.onload=()=>{S(null,M),I.revokeObjectURL(M.src),M.onload=null,D.requestAnimationFrame(()=>{M.src=$t})},M.onerror=()=>S(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const P=new D.Blob([new Uint8Array(b)],{type:"image/png"});M.src=b.byteLength?I.createObjectURL(P):$t}(f,(b,S)=>e(b,S,m,v)))});return{cancel:()=>{l.cancel(),o()}}};function ci(i,e,t){t[i]&&t[i].indexOf(e)!==-1||(t[i]=t[i]||[],t[i].push(e))}function Li(i,e,t){if(t&&t[i]){const o=t[i].indexOf(e);o!==-1&&t[i].splice(o,1)}}class he{constructor(e,t={}){Ue(this,t),this.type=e}}class vt extends he{constructor(e,t={}){super("error",Ue({error:e},t))}}class Ze{on(e,t){return this._listeners=this._listeners||{},ci(e,t,this._listeners),this}off(e,t){return Li(e,t,this._listeners),Li(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},ci(e,t,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,t){typeof e=="string"&&(e=new he(e,t||{}));const o=e.type;if(this.listens(o)){e.target=this;const l=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const m of l)m.call(this,e);const h=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const m of h)Li(o,m,this._oneTimeListeners),m.call(this,e);const f=this._eventedParent;f&&(Ue(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),f.fire(e))}else e instanceof vt&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}var Me=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Ti(i,...e){for(const t of e)for(const o in t)i[o]=t[o];return i}function ni(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Gi(i){if(Array.isArray(i))return i.map(Gi);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const t in i)e[t]=Gi(i[t]);return e}return ni(i)}class Mn extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}var Jn=Mn;class yl{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[o,l]of t)this.bindings[o]=l}concat(e){return new yl(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Pp=yl;const Ss={kind:"null"},zt={kind:"number"},yi={kind:"string"},vi={kind:"boolean"},Br={kind:"color"},Rr={kind:"object"},ui={kind:"value"},ma={kind:"collator"},_a={kind:"formatted"},ga={kind:"resolvedImage"};function yr(i,e){return{kind:"array",itemType:i,N:e}}function an(i){if(i.kind==="array"){const e=an(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const Jh=[Ss,zt,yi,vi,Br,_a,Rr,yr(ui),ga];function Cs(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Cs(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const t of Jh)if(!Cs(t,e))return null}}return`Expected ${an(i)} but found ${an(e)} instead.`}function vl(i,e){return e.some(t=>t.kind===i.kind)}function Mo(i,e){return e.some(t=>t==="null"?i===null:t==="array"?Array.isArray(i):t==="object"?i&&!Array.isArray(i)&&typeof i=="object":t===typeof i)}function $c(i){var e={exports:{}};return i(e,e.exports),e.exports}var Io=$c(function(i,e){var t={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function o(m){return(m=Math.round(m))<0?0:m>255?255:m}function l(m){return o(m[m.length-1]==="%"?parseFloat(m)/100*255:parseInt(m))}function h(m){return(v=m[m.length-1]==="%"?parseFloat(m)/100:parseFloat(m))<0?0:v>1?1:v;var v}function f(m,v,b){return b<0?b+=1:b>1&&(b-=1),6*b<1?m+(v-m)*b*6:2*b<1?v:3*b<2?m+(v-m)*(2/3-b)*6:m}try{e.parseCSSColor=function(m){var v,b=m.replace(/ /g,"").toLowerCase();if(b in t)return t[b].slice();if(b[0]==="#")return b.length===4?(v=parseInt(b.substr(1),16))>=0&&v<=4095?[(3840&v)>>4|(3840&v)>>8,240&v|(240&v)>>4,15&v|(15&v)<<4,1]:null:b.length===7&&(v=parseInt(b.substr(1),16))>=0&&v<=16777215?[(16711680&v)>>16,(65280&v)>>8,255&v,1]:null;var S=b.indexOf("("),M=b.indexOf(")");if(S!==-1&&M+1===b.length){var I=b.substr(0,S),P=b.substr(S+1,M-(S+1)).split(","),L=1;switch(I){case"rgba":if(P.length!==4)return null;L=h(P.pop());case"rgb":return P.length!==3?null:[l(P[0]),l(P[1]),l(P[2]),L];case"hsla":if(P.length!==4)return null;L=h(P.pop());case"hsl":if(P.length!==3)return null;var U=(parseFloat(P[0])%360+360)%360/360,$=h(P[1]),ee=h(P[2]),se=ee<=.5?ee*($+1):ee+$-ee*$,ie=2*ee-se;return[o(255*f(ie,se,U+1/3)),o(255*f(ie,se,U)),o(255*f(ie,se,U-1/3)),L];default:return null}}return null}}catch{}});class Qn{constructor(e,t,o,l=1){this.r=e,this.g=t,this.b=o,this.a=l}static parse(e){if(!e)return;if(e instanceof Qn)return e;if(typeof e!="string")return;const t=Io.parseCSSColor(e);return t?new Qn(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3]):void 0}toString(){const[e,t,o,l]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(o)},${l})`}toArray(){const{r:e,g:t,b:o,a:l}=this;return l===0?[0,0,0,0]:[255*e/l,255*t/l,255*o/l,l]}toArray01(){const{r:e,g:t,b:o,a:l}=this;return l===0?[0,0,0,0]:[e/l,t/l,o/l,l]}toArray01PremultipliedAlpha(){const{r:e,g:t,b:o,a:l}=this;return[e,t,o,l]}}Qn.black=new Qn(0,0,0,1),Qn.white=new Qn(1,1,1,1),Qn.transparent=new Qn(0,0,0,0),Qn.red=new Qn(1,0,0,1),Qn.blue=new Qn(0,0,1,1);var ji=Qn;class Gc{constructor(e,t,o){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ya{constructor(e,t,o,l,h){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=o,this.fontStack=l,this.textColor=h}}class lr{constructor(e){this.sections=e}static fromString(e){return new lr([new ya(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof lr?e:lr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.name]);continue}e.push(t.text);const o={};t.fontStack&&(o["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(o["font-scale"]=t.scale),t.textColor&&(o["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(o)}return e}}class cr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new cr({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Zc(i,e,t,o){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[i,e,t,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[i,e,t,o]:[i,e,t]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ko(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof ji||i instanceof Gc||i instanceof lr||i instanceof cr)return!0;if(Array.isArray(i)){for(const e of i)if(!ko(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!ko(i[e]))return!1;return!0}return!1}function yn(i){if(i===null)return Ss;if(typeof i=="string")return yi;if(typeof i=="boolean")return vi;if(typeof i=="number")return zt;if(i instanceof ji)return Br;if(i instanceof Gc)return ma;if(i instanceof lr)return _a;if(i instanceof cr)return ga;if(Array.isArray(i)){const e=i.length;let t;for(const o of i){const l=yn(o);if(t){if(t===l)continue;t=ui;break}t=l}return yr(t||ui,e)}return Rr}function va(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof ji||i instanceof lr||i instanceof cr?i.toString():JSON.stringify(i)}class Wc{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(e.length!==2)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ko(e[1]))return t.error("invalid value");const o=e[1];let l=yn(o);const h=t.expectedType;return l.kind!=="array"||l.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(l=h),new Wc(l,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ji?["rgba"].concat(this.value.toArray()):this.value instanceof lr?this.value.serialize():this.value}}var xa=Wc,Ln=class{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}};const ba={string:yi,number:zt,boolean:vi,object:Rr};class Hc{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let o,l=1;const h=e[0];if(h==="array"){let m,v;if(e.length>2){const b=e[1];if(typeof b!="string"||!(b in ba)||b==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);m=ba[b],l++}else m=ui;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);v=e[2],l++}o=yr(m,v)}else o=ba[h];const f=[];for(;l<e.length;l++){const m=t.parse(e[l],l,ui);if(!m)return null;f.push(m)}return new Hc(o,f)}evaluate(e){for(let t=0;t<this.args.length;t++){const o=this.args[t].evaluate(e);if(!Cs(this.type,yn(o)))return o;if(t===this.args.length-1)throw new Ln(`Expected value to be of type ${an(this.type)}, but found ${an(yn(o))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,t=[e.kind];if(e.kind==="array"){const o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){t.push(o.kind);const l=e.N;(typeof l=="number"||this.args.length>1)&&t.push(l)}}return t.concat(this.args.map(o=>o.serialize()))}}var Sr=Hc;class wa{constructor(e){this.type=_a,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return t.error("First argument must be an image or text section.");const l=[];let h=!1;for(let f=1;f<=e.length-1;++f){const m=e[f];if(h&&typeof m=="object"&&!Array.isArray(m)){h=!1;let v=null;if(m["font-scale"]&&(v=t.parse(m["font-scale"],1,zt),!v))return null;let b=null;if(m["text-font"]&&(b=t.parse(m["text-font"],1,yr(yi)),!b))return null;let S=null;if(m["text-color"]&&(S=t.parse(m["text-color"],1,Br),!S))return null;const M=l[l.length-1];M.scale=v,M.font=b,M.textColor=S}else{const v=t.parse(e[f],1,ui);if(!v)return null;const b=v.type.kind;if(b!=="string"&&b!=="value"&&b!=="null"&&b!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,l.push({content:v,scale:null,font:null,textColor:null})}}return new wa(l)}evaluate(e){return new lr(this.sections.map(t=>{const o=t.content.evaluate(e);return yn(o)===ga?new ya("",o,null,null,null):new ya(va(o),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const o={};t.scale&&(o["font-scale"]=t.scale.serialize()),t.font&&(o["text-font"]=t.font.serialize()),t.textColor&&(o["text-color"]=t.textColor.serialize()),e.push(o)}return e}}class xl{constructor(e){this.type=ga,this.input=e}static parse(e,t){if(e.length!==2)return t.error("Expected two arguments.");const o=t.parse(e[1],1,yi);return o?new xl(o):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),o=cr.fromString(t);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(t)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Dp={"to-boolean":vi,"to-color":Br,"to-number":zt,"to-string":yi};class Xc{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const o=e[0];if((o==="to-boolean"||o==="to-string")&&e.length!==2)return t.error("Expected one argument.");const l=Dp[o],h=[];for(let f=1;f<e.length;f++){const m=t.parse(e[f],f,ui);if(!m)return null;h.push(m)}return new Xc(l,h)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let t,o;for(const l of this.args){if(t=l.evaluate(e),o=null,t instanceof ji)return t;if(typeof t=="string"){const h=e.parseColor(t);if(h)return h}else if(Array.isArray(t)&&(o=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:Zc(t[0],t[1],t[2],t[3]),!o))return new ji(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Ln(o||`Could not parse color from value '${typeof t=="string"?t:String(JSON.stringify(t))}'`)}if(this.type.kind==="number"){let t=null;for(const o of this.args){if(t=o.evaluate(e),t===null)return 0;const l=Number(t);if(!isNaN(l))return l}throw new Ln(`Could not convert ${JSON.stringify(t)} to number.`)}return this.type.kind==="formatted"?lr.fromString(va(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?cr.fromString(va(this.args[0].evaluate(e))):va(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new wa([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new xl(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(t=>{e.push(t.serialize())}),e}}var As=Xc;const Lp=["Unknown","Point","LineString","Polygon"];var Qh=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Lp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const i=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:t,y:o}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(t*e-i[0])+this.featureDistanceData.bearing[1]*(o*e-i[1])}return 0}parseColor(i){let e=this._parseColorCache[i];return e||(e=this._parseColorCache[i]=ji.parse(i)),e}};class Jo{constructor(e,t,o,l){this.name=e,this.type=t,this._evaluate=o,this.args=l}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,t){const o=e[0],l=Jo.definitions[o];if(!l)return t.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(l)?l[0]:l.type,f=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,m=f.filter(([b])=>!Array.isArray(b)||b.length===e.length-1);let v=null;for(const[b,S]of m){v=new es(t.registry,t.path,null,t.scope);const M=[];let I=!1;for(let P=1;P<e.length;P++){const L=e[P],U=Array.isArray(b)?b[P-1]:b.type,$=v.parse(L,1+M.length,U);if(!$){I=!0;break}M.push($)}if(!I)if(Array.isArray(b)&&b.length!==M.length)v.error(`Expected ${b.length} arguments, but found ${M.length} instead.`);else{for(let P=0;P<M.length;P++){const L=Array.isArray(b)?b[P]:b.type,U=M[P];v.concat(P+1).checkSubtype(L,U.type)}if(v.errors.length===0)return new Jo(o,h,S,M)}}if(m.length===1)t.errors.push(...v.errors);else{const b=(m.length?m:f).map(([M])=>{return I=M,Array.isArray(I)?`(${I.map(an).join(", ")})`:`(${an(I.type)}...)`;var I}).join(" | "),S=[];for(let M=1;M<e.length;M++){const I=t.parse(e[M],1+S.length);if(!I)return null;S.push(an(I.type))}t.error(`Expected arguments of type ${b}, but found (${S.join(", ")}) instead.`)}return null}static register(e,t){Jo.definitions=t;for(const o in t)e[o]=Jo}}var Or=Jo;class bl{constructor(e,t,o){this.type=ma,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(e.length!==2)return t.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return t.error("Collator options argument must be an object.");const l=t.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,vi);if(!l)return null;const h=t.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,vi);if(!h)return null;let f=null;return o.locale&&(f=t.parse(o.locale,1,yi),!f)?null:new bl(l,h,f)}evaluate(e){return new Gc(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const zo=8192;function Kc(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function wl(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function Bp(i,e){const t=(180+i[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(t*l*zo),Math.round(o*l*zo)]}function Rp(i,e,t){const o=i[0]-e[0],l=i[1]-e[1],h=i[0]-t[0],f=i[1]-t[1];return o*f-h*l==0&&o*h<=0&&l*f<=0}function Tl(i,e){let t=!1;for(let f=0,m=e.length;f<m;f++){const v=e[f];for(let b=0,S=v.length;b<S-1;b++){if(Rp(i,v[b],v[b+1]))return!1;(l=v[b])[1]>(o=i)[1]!=(h=v[b+1])[1]>o[1]&&o[0]<(h[0]-l[0])*(o[1]-l[1])/(h[1]-l[1])+l[0]&&(t=!t)}}var o,l,h;return t}function El(i,e){for(let t=0;t<e.length;t++)if(Tl(i,e[t]))return!0;return!1}function ed(i,e,t,o){const l=o[0]-t[0],h=o[1]-t[1],f=(i[0]-t[0])*h-l*(i[1]-t[1]),m=(e[0]-t[0])*h-l*(e[1]-t[1]);return f>0&&m<0||f<0&&m>0}function Op(i,e,t){for(const b of t)for(let S=0;S<b.length-1;++S)if((m=[(f=b[S+1])[0]-(h=b[S])[0],f[1]-h[1]])[0]*(v=[(l=e)[0]-(o=i)[0],l[1]-o[1]])[1]-m[1]*v[0]!=0&&ed(o,l,h,f)&&ed(h,f,o,l))return!0;var o,l,h,f,m,v;return!1}function td(i,e){for(let t=0;t<i.length;++t)if(!Tl(i[t],e))return!1;for(let t=0;t<i.length-1;++t)if(Op(i[t],i[t+1],e))return!1;return!0}function Fp(i,e){for(let t=0;t<e.length;t++)if(td(i,e[t]))return!0;return!1}function Cr(i,e,t){const o=[];for(let l=0;l<i.length;l++){const h=[];for(let f=0;f<i[l].length;f++){const m=Bp(i[l][f],t);Kc(e,m),h.push(m)}o.push(h)}return o}function Yc(i,e,t){const o=[];for(let l=0;l<i.length;l++){const h=Cr(i[l],e,t);o.push(h)}return o}function Jc(i,e,t,o){if(i[0]<t[0]||i[0]>t[2]){const l=.5*o;let h=i[0]-t[0]>l?-o:t[0]-i[0]>l?o:0;h===0&&(h=i[0]-t[2]>l?-o:t[2]-i[0]>l?o:0),i[0]+=h}Kc(e,i)}function Qc(i,e,t,o){const l=Math.pow(2,o.z)*zo,h=[o.x*zo,o.y*zo],f=[];if(!i)return f;for(const m of i)for(const v of m){const b=[v.x+h[0],v.y+h[1]];Jc(b,e,t,l),f.push(b)}return f}function eu(i,e,t,o){const l=Math.pow(2,o.z)*zo,h=[o.x*zo,o.y*zo],f=[];if(!i)return f;for(const v of i){const b=[];for(const S of v){const M=[S.x+h[0],S.y+h[1]];Kc(e,M),b.push(M)}f.push(b)}if(e[2]-e[0]<=l/2){(m=e)[0]=m[1]=1/0,m[2]=m[3]=-1/0;for(const v of f)for(const b of v)Jc(b,e,t,l)}var m;return f}class Ms{constructor(e,t){this.type=vi,this.geojson=e,this.geometries=t}static parse(e,t){if(e.length!==2)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ko(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let l=0;l<o.features.length;++l){const h=o.features[l].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Ms(o,o.features[l].geometry)}else if(o.type==="Feature"){const l=o.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new Ms(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Ms(o,o)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(t,o){const l=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],f=t.canonicalID();if(!f)return!1;if(o.type==="Polygon"){const m=Cr(o.coordinates,h,f),v=Qc(t.geometry(),l,h,f);if(!wl(l,h))return!1;for(const b of v)if(!Tl(b,m))return!1}if(o.type==="MultiPolygon"){const m=Yc(o.coordinates,h,f),v=Qc(t.geometry(),l,h,f);if(!wl(l,h))return!1;for(const b of v)if(!El(b,m))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(t,o){const l=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],f=t.canonicalID();if(!f)return!1;if(o.type==="Polygon"){const m=Cr(o.coordinates,h,f),v=eu(t.geometry(),l,h,f);if(!wl(l,h))return!1;for(const b of v)if(!td(b,m))return!1}if(o.type==="MultiPolygon"){const m=Yc(o.coordinates,h,f),v=eu(t.geometry(),l,h,f);if(!wl(l,h))return!1;for(const b of v)if(!Fp(b,m))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Sl=Ms;function Qo(i){if(i instanceof Or&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Sl)return!1;let e=!0;return i.eachChild(t=>{e&&!Qo(t)&&(e=!1)}),e}function Po(i){if(i instanceof Or&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(t=>{e&&!Po(t)&&(e=!1)}),e}function Ta(i,e){if(i instanceof Or&&e.indexOf(i.name)>=0)return!1;let t=!0;return i.eachChild(o=>{t&&!Ta(o,e)&&(t=!1)}),t}class Cl{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");const o=e[1];return t.scope.has(o)?new Cl(o,t.scope.get(o)):t.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Al=Cl;class Ml{constructor(e,t=[],o,l=new Pp,h=[]){this.registry=e,this.path=t,this.key=t.map(f=>`[${f}]`).join(""),this.scope=l,this.errors=h,this.expectedType=o}parse(e,t,o,l,h={}){return t?this.concat(t,o,l)._parse(e,h):this._parse(e,h)}_parse(e,t){function o(l,h,f){return f==="assert"?new Sr(h,[l]):f==="coerce"?new As(h,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=e[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const h=this.registry[l];if(h){let f=h.parse(e,this);if(!f)return null;if(this.expectedType){const m=this.expectedType,v=f.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||v.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(m,v))return null}else f=o(f,m,t.typeAnnotation||"coerce");else f=o(f,m,t.typeAnnotation||"assert")}if(!(f instanceof xa)&&f.type.kind!=="resolvedImage"&&Bi(f)){const m=new Qh;try{f=new xa(f.type,f.evaluate(m))}catch(v){return this.error(v.message),null}}return f}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,o){const l=typeof e=="number"?this.path.concat(e):this.path,h=o?this.scope.concat(o):this.scope;return new Ml(this.registry,l,t||null,h,this.errors)}error(e,...t){const o=`${this.key}${t.map(l=>`[${l}]`).join("")}`;this.errors.push(new Jn(o,e))}checkSubtype(e,t){const o=Cs(e,t);return o&&this.error(o),o}}var es=Ml;function Bi(i){if(i instanceof Al)return Bi(i.boundExpression);if(i instanceof Or&&i.name==="error"||i instanceof bl||i instanceof Sl)return!1;const e=i instanceof As||i instanceof Sr;let t=!0;return i.eachChild(o=>{t=e?t&&Bi(o):t&&o instanceof xa}),!!t&&Qo(i)&&Ta(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Il(i,e){const t=i.length-1;let o,l,h=0,f=t,m=0;for(;h<=f;)if(m=Math.floor((h+f)/2),o=i[m],l=i[m+1],o<=e){if(m===t||e<l)return m;h=m+1}else{if(!(o>e))throw new Ln("Input is not a number.");f=m-1}return 0}class tu{constructor(e,t,o){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[l,h]of o)this.labels.push(l),this.outputs.push(h)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const o=t.parse(e[1],1,zt);if(!o)return null;const l=[];let h=null;t.expectedType&&t.expectedType.kind!=="value"&&(h=t.expectedType);for(let f=1;f<e.length;f+=2){const m=f===1?-1/0:e[f],v=e[f+1],b=f,S=f+1;if(typeof m!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',b);if(l.length&&l[l.length-1][0]>=m)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',b);const M=t.parse(v,S,h);if(!M)return null;h=h||M.type,l.push([m,M])}return new tu(h,o,l)}evaluate(e){const t=this.labels,o=this.outputs;if(t.length===1)return o[0].evaluate(e);const l=this.input.evaluate(e);if(l<=t[0])return o[0].evaluate(e);const h=t.length;return l>=t[h-1]?o[h-1].evaluate(e):o[Il(t,l)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var iu=tu;function Mi(i,e,t){return i*(1-t)+e*t}function Is(i,e,t){return i.map((o,l)=>Mi(o,e[l],t))}var Ea=Object.freeze({__proto__:null,number:Mi,color:function(i,e,t){return new ji(Mi(i.r,e.r,t),Mi(i.g,e.g,t),Mi(i.b,e.b,t),Mi(i.a,e.a,t))},array:Is});const nu=.95047,ru=1.08883,ou=4/29,Do=6/29,Sa=3*Do*Do,Vp=Math.PI/180,su=180/Math.PI;function kl(i){return i>.008856451679035631?Math.pow(i,1/3):i/Sa+ou}function au(i){return i>Do?i*i*i:Sa*(i-ou)}function lu(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function zl(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function id(i){const e=zl(i.r),t=zl(i.g),o=zl(i.b),l=kl((.4124564*e+.3575761*t+.1804375*o)/nu),h=kl((.2126729*e+.7151522*t+.072175*o)/1);return{l:116*h-16,a:500*(l-h),b:200*(h-kl((.0193339*e+.119192*t+.9503041*o)/ru)),alpha:i.a}}function cu(i){let e=(i.l+16)/116,t=isNaN(i.a)?e:e+i.a/500,o=isNaN(i.b)?e:e-i.b/200;return e=1*au(e),t=nu*au(t),o=ru*au(o),new ji(lu(3.2404542*t-1.5371385*e-.4985314*o),lu(-.969266*t+1.8760108*e+.041556*o),lu(.0556434*t-.2040259*e+1.0572252*o),i.alpha)}function nd(i,e,t){const o=e-i;return i+t*(o>180||o<-180?o-360*Math.round(o/360):o)}const Ca={forward:id,reverse:cu,interpolate:function(i,e,t){return{l:Mi(i.l,e.l,t),a:Mi(i.a,e.a,t),b:Mi(i.b,e.b,t),alpha:Mi(i.alpha,e.alpha,t)}}},ks={forward:function(i){const{l:e,a:t,b:o}=id(i),l=Math.atan2(o,t)*su;return{h:l<0?l+360:l,c:Math.sqrt(t*t+o*o),l:e,alpha:i.a}},reverse:function(i){const e=i.h*Vp,t=i.c;return cu({l:i.l,a:Math.cos(e)*t,b:Math.sin(e)*t,alpha:i.alpha})},interpolate:function(i,e,t){return{h:nd(i.h,e.h,t),c:Mi(i.c,e.c,t),l:Mi(i.l,e.l,t),alpha:Mi(i.alpha,e.alpha,t)}}};var rd=Object.freeze({__proto__:null,lab:Ca,hcl:ks});class Aa{constructor(e,t,o,l,h){this.type=e,this.operator=t,this.interpolation=o,this.input=l,this.labels=[],this.outputs=[];for(const[f,m]of h)this.labels.push(f),this.outputs.push(m)}static interpolationFactor(e,t,o,l){let h=0;if(e.name==="exponential")h=Pl(t,e.base,o,l);else if(e.name==="linear")h=Pl(t,1,o,l);else if(e.name==="cubic-bezier"){const f=e.controlPoints;h=new O(f[0],f[1],f[2],f[3]).solve(Pl(t,1,o,l))}return h}static parse(e,t){let[o,l,h,...f]=e;if(!Array.isArray(l)||l.length===0)return t.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const b=l[1];if(typeof b!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:b}}else{if(l[0]!=="cubic-bezier")return t.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const b=l.slice(1);if(b.length!==4||b.some(S=>typeof S!="number"||S<0||S>1))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:b}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(h=t.parse(h,2,zt),!h)return null;const m=[];let v=null;o==="interpolate-hcl"||o==="interpolate-lab"?v=Br:t.expectedType&&t.expectedType.kind!=="value"&&(v=t.expectedType);for(let b=0;b<f.length;b+=2){const S=f[b],M=f[b+1],I=b+3,P=b+4;if(typeof S!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(m.length&&m[m.length-1][0]>=S)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',I);const L=t.parse(M,P,v);if(!L)return null;v=v||L.type,m.push([S,L])}return v.kind==="number"||v.kind==="color"||v.kind==="array"&&v.itemType.kind==="number"&&typeof v.N=="number"?new Aa(v,o,l,h,m):t.error(`Type ${an(v)} is not interpolatable.`)}evaluate(e){const t=this.labels,o=this.outputs;if(t.length===1)return o[0].evaluate(e);const l=this.input.evaluate(e);if(l<=t[0])return o[0].evaluate(e);const h=t.length;if(l>=t[h-1])return o[h-1].evaluate(e);const f=Il(t,l),m=Aa.interpolationFactor(this.interpolation,l,t[f],t[f+1]),v=o[f].evaluate(e),b=o[f+1].evaluate(e);return this.operator==="interpolate"?Ea[this.type.kind.toLowerCase()](v,b,m):this.operator==="interpolate-hcl"?ks.reverse(ks.interpolate(ks.forward(v),ks.forward(b),m)):Ca.reverse(Ca.interpolate(Ca.forward(v),Ca.forward(b),m))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let o=0;o<this.labels.length;o++)t.push(this.labels[o],this.outputs[o].serialize());return t}}function Pl(i,e,t,o){const l=o-t,h=i-t;return l===0?0:e===1?h/l:(Math.pow(e,h)-1)/(Math.pow(e,l)-1)}var $r=Aa;class uu{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let o=null;const l=t.expectedType;l&&l.kind!=="value"&&(o=l);const h=[];for(const m of e.slice(1)){const v=t.parse(m,1+h.length,o,void 0,{typeAnnotation:"omit"});if(!v)return null;o=o||v.type,h.push(v)}const f=l&&h.some(m=>Cs(l,m.type));return new uu(f?ui:o,h)}evaluate(e){let t,o=null,l=0;for(const h of this.args){if(l++,o=h.evaluate(e),o&&o instanceof cr&&!o.available&&(t||(t=o),o=null,l===this.args.length))return t;if(o!==null)break}return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var od=uu;class hu{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let h=1;h<e.length-1;h+=2){const f=e[h];if(typeof f!="string")return t.error(`Expected string, but found ${typeof f} instead.`,h);if(/[^a-zA-Z0-9_]/.test(f))return t.error("Variable names must contain only alphanumeric characters or '_'.",h);const m=t.parse(e[h+1],h+1);if(!m)return null;o.push([f,m])}const l=t.parse(e[e.length-1],e.length-1,t.expectedType,o);return l?new hu(o,l):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,o]of this.bindings)e.push(t,o.serialize());return e.push(this.result.serialize()),e}}var sd=hu;class du{constructor(e,t,o){this.type=e,this.index=t,this.input=o}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=t.parse(e[1],1,zt),l=t.parse(e[2],2,yr(t.expectedType||ui));return o&&l?new du(l.type.itemType,o,l):null}evaluate(e){const t=this.index.evaluate(e),o=this.input.evaluate(e);if(t<0)throw new Ln(`Array index out of bounds: ${t} < 0.`);if(t>=o.length)throw new Ln(`Array index out of bounds: ${t} > ${o.length-1}.`);if(t!==Math.floor(t))throw new Ln(`Array index must be an integer, but found ${t} instead.`);return o[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var ad=du;class fu{constructor(e,t){this.type=vi,this.needle=e,this.haystack=t}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=t.parse(e[1],1,ui),l=t.parse(e[2],2,ui);return o&&l?vl(o.type,[vi,yi,zt,Ss,ui])?new fu(o,l):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${an(o.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(o==null)return!1;if(!Mo(t,["boolean","string","number","null"]))throw new Ln(`Expected first argument to be of type boolean, string, number or null, but found ${an(yn(t))} instead.`);if(!Mo(o,["string","array"]))throw new Ln(`Expected second argument to be of type array or string, but found ${an(yn(o))} instead.`);return o.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Up=fu;class Dl{constructor(e,t,o){this.type=zt,this.needle=e,this.haystack=t,this.fromIndex=o}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=t.parse(e[1],1,ui),l=t.parse(e[2],2,ui);if(!o||!l)return null;if(!vl(o.type,[vi,yi,zt,Ss,ui]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${an(o.type)} instead`);if(e.length===4){const h=t.parse(e[3],3,zt);return h?new Dl(o,l,h):null}return new Dl(o,l)}evaluate(e){const t=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!Mo(t,["boolean","string","number","null"]))throw new Ln(`Expected first argument to be of type boolean, string, number or null, but found ${an(yn(t))} instead.`);if(!Mo(o,["string","array"]))throw new Ln(`Expected second argument to be of type array or string, but found ${an(yn(o))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(e);return o.indexOf(t,l)}return o.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Np=Dl;class Ll{constructor(e,t,o,l,h,f){this.inputType=e,this.type=t,this.input=o,this.cases=l,this.outputs=h,this.otherwise=f}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let o,l;t.expectedType&&t.expectedType.kind!=="value"&&(l=t.expectedType);const h={},f=[];for(let b=2;b<e.length-1;b+=2){let S=e[b];const M=e[b+1];Array.isArray(S)||(S=[S]);const I=t.concat(b);if(S.length===0)return I.error("Expected at least one branch label.");for(const L of S){if(typeof L!="number"&&typeof L!="string")return I.error("Branch labels must be numbers or strings.");if(typeof L=="number"&&Math.abs(L)>Number.MAX_SAFE_INTEGER)return I.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof L=="number"&&Math.floor(L)!==L)return I.error("Numeric branch labels must be integer values.");if(o){if(I.checkSubtype(o,yn(L)))return null}else o=yn(L);if(h[String(L)]!==void 0)return I.error("Branch labels must be unique.");h[String(L)]=f.length}const P=t.parse(M,b,l);if(!P)return null;l=l||P.type,f.push(P)}const m=t.parse(e[1],1,ui);if(!m)return null;const v=t.parse(e[e.length-1],e.length-1,l);return v?m.type.kind!=="value"&&t.concat(1).checkSubtype(o,m.type)?null:new Ll(o,l,m,h,f,v):null}evaluate(e){const t=this.input.evaluate(e);return(yn(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),o=[],l={};for(const f of t){const m=l[this.cases[f]];m===void 0?(l[this.cases[f]]=o.length,o.push([this.cases[f],[f]])):o[m][1].push(f)}const h=f=>this.inputType.kind==="number"?Number(f):f;for(const[f,m]of o)e.push(m.length===1?h(m[0]):m.map(h)),e.push(this.outputs[f].serialize());return e.push(this.otherwise.serialize()),e}}var ld=Ll;class Bl{constructor(e,t,o){this.type=e,this.branches=t,this.otherwise=o}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let o;t.expectedType&&t.expectedType.kind!=="value"&&(o=t.expectedType);const l=[];for(let f=1;f<e.length-1;f+=2){const m=t.parse(e[f],f,vi);if(!m)return null;const v=t.parse(e[f+1],f+1,o);if(!v)return null;l.push([m,v]),o=o||v.type}const h=t.parse(e[e.length-1],e.length-1,o);return h?new Bl(o,l,h):null}evaluate(e){for(const[t,o]of this.branches)if(t.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,o]of this.branches)e(t),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,t])=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var jp=Bl;class Rl{constructor(e,t,o,l){this.type=e,this.input=t,this.beginIndex=o,this.endIndex=l}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=t.parse(e[1],1,ui),l=t.parse(e[2],2,zt);if(!o||!l)return null;if(!vl(o.type,[yr(ui),yi,ui]))return t.error(`Expected first argument to be of type array or string, but found ${an(o.type)} instead`);if(e.length===4){const h=t.parse(e[3],3,zt);return h?new Rl(o.type,o,l,h):null}return new Rl(o.type,o,l)}evaluate(e){const t=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!Mo(t,["string","array"]))throw new Ln(`Expected first argument to be of type array or string, but found ${an(yn(t))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(e);return t.slice(o,l)}return t.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var cd=Rl;function pu(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function mu(i,e,t,o){return o.compare(e,t)===0}function zs(i,e,t){const o=i!=="=="&&i!=="!=";return class yw{constructor(h,f,m){this.type=vi,this.lhs=h,this.rhs=f,this.collator=m,this.hasUntypedArgument=h.type.kind==="value"||f.type.kind==="value"}static parse(h,f){if(h.length!==3&&h.length!==4)return f.error("Expected two or three arguments.");const m=h[0];let v=f.parse(h[1],1,ui);if(!v)return null;if(!pu(m,v.type))return f.concat(1).error(`"${m}" comparisons are not supported for type '${an(v.type)}'.`);let b=f.parse(h[2],2,ui);if(!b)return null;if(!pu(m,b.type))return f.concat(2).error(`"${m}" comparisons are not supported for type '${an(b.type)}'.`);if(v.type.kind!==b.type.kind&&v.type.kind!=="value"&&b.type.kind!=="value")return f.error(`Cannot compare types '${an(v.type)}' and '${an(b.type)}'.`);o&&(v.type.kind==="value"&&b.type.kind!=="value"?v=new Sr(b.type,[v]):v.type.kind!=="value"&&b.type.kind==="value"&&(b=new Sr(v.type,[b])));let S=null;if(h.length===4){if(v.type.kind!=="string"&&b.type.kind!=="string"&&v.type.kind!=="value"&&b.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(S=f.parse(h[3],3,ma),!S)return null}return new yw(v,b,S)}evaluate(h){const f=this.lhs.evaluate(h),m=this.rhs.evaluate(h);if(o&&this.hasUntypedArgument){const v=yn(f),b=yn(m);if(v.kind!==b.kind||v.kind!=="string"&&v.kind!=="number")throw new Ln(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${v.kind}, ${b.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const v=yn(f),b=yn(m);if(v.kind!=="string"||b.kind!=="string")return e(h,f,m)}return this.collator?t(h,f,m,this.collator.evaluate(h)):e(h,f,m)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}serialize(){const h=[i];return this.eachChild(f=>{h.push(f.serialize())}),h}}}const qp=zs("==",function(i,e,t){return e===t},mu),$p=zs("!=",function(i,e,t){return e!==t},function(i,e,t,o){return!mu(0,e,t,o)}),Gp=zs("<",function(i,e,t){return e<t},function(i,e,t,o){return o.compare(e,t)<0}),Ol=zs(">",function(i,e,t){return e>t},function(i,e,t,o){return o.compare(e,t)>0}),ud=zs("<=",function(i,e,t){return e<=t},function(i,e,t,o){return o.compare(e,t)<=0}),hd=zs(">=",function(i,e,t){return e>=t},function(i,e,t,o){return o.compare(e,t)>=0});class _u{constructor(e,t,o,l,h,f){this.type=yi,this.number=e,this.locale=t,this.currency=o,this.unit=l,this.minFractionDigits=h,this.maxFractionDigits=f}static parse(e,t){if(e.length!==3)return t.error("Expected two arguments.");const o=t.parse(e[1],1,zt);if(!o)return null;const l=e[2];if(typeof l!="object"||Array.isArray(l))return t.error("NumberFormat options argument must be an object.");let h=null;if(l.locale&&(h=t.parse(l.locale,1,yi),!h))return null;let f=null;if(l.currency&&(f=t.parse(l.currency,1,yi),!f))return null;let m=null;if(l.unit&&(m=t.parse(l.unit,1,yi),!m))return null;let v=null;if(l["min-fraction-digits"]&&(v=t.parse(l["min-fraction-digits"],1,zt),!v))return null;let b=null;return l["max-fraction-digits"]&&(b=t.parse(l["max-fraction-digits"],1,zt),!b)?null:new _u(o,h,f,m,v,b)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class gu{constructor(e){this.type=zt,this.input=e}static parse(e,t){if(e.length!==2)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=t.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?t.error(`Expected argument of type string or array, but found ${an(o.type)} instead.`):new gu(o):null}evaluate(e){const t=this.input.evaluate(e);if(typeof t=="string"||Array.isArray(t))return t.length;throw new Ln(`Expected value to be of type string or array, but found ${an(yn(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(t=>{e.push(t.serialize())}),e}}const dd={"==":qp,"!=":$p,">":Ol,"<":Gp,">=":hd,"<=":ud,array:Sr,at:ad,boolean:Sr,case:jp,coalesce:od,collator:bl,format:wa,image:xl,in:Up,"index-of":Np,interpolate:$r,"interpolate-hcl":$r,"interpolate-lab":$r,length:gu,let:sd,literal:xa,match:ld,number:Sr,"number-format":_u,object:Sr,slice:cd,step:iu,string:Sr,"to-boolean":As,"to-color":As,"to-number":As,"to-string":As,var:Al,within:Sl};function yu(i,[e,t,o,l]){e=e.evaluate(i),t=t.evaluate(i),o=o.evaluate(i);const h=l?l.evaluate(i):1,f=Zc(e,t,o,h);if(f)throw new Ln(f);return new ji(e/255*h,t/255*h,o/255*h,h)}function vu(i,e){return i in e}function Fl(i,e){const t=e[i];return t===void 0?null:t}function ro(i){return{type:i}}Or.register(dd,{error:[{kind:"error"},[yi],(i,[e])=>{throw new Ln(e.evaluate(i))}],typeof:[yi,[ui],(i,[e])=>an(yn(e.evaluate(i)))],"to-rgba":[yr(zt,4),[Br],(i,[e])=>e.evaluate(i).toArray()],rgb:[Br,[zt,zt,zt],yu],rgba:[Br,[zt,zt,zt,zt],yu],has:{type:vi,overloads:[[[yi],(i,[e])=>vu(e.evaluate(i),i.properties())],[[yi,Rr],(i,[e,t])=>vu(e.evaluate(i),t.evaluate(i))]]},get:{type:ui,overloads:[[[yi],(i,[e])=>Fl(e.evaluate(i),i.properties())],[[yi,Rr],(i,[e,t])=>Fl(e.evaluate(i),t.evaluate(i))]]},"feature-state":[ui,[yi],(i,[e])=>Fl(e.evaluate(i),i.featureState||{})],properties:[Rr,[],i=>i.properties()],"geometry-type":[yi,[],i=>i.geometryType()],id:[ui,[],i=>i.id()],zoom:[zt,[],i=>i.globals.zoom],pitch:[zt,[],i=>i.globals.pitch||0],"distance-from-center":[zt,[],i=>i.distanceFromCenter()],"heatmap-density":[zt,[],i=>i.globals.heatmapDensity||0],"line-progress":[zt,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[zt,[],i=>i.globals.skyRadialProgress||0],accumulated:[ui,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[zt,ro(zt),(i,e)=>{let t=0;for(const o of e)t+=o.evaluate(i);return t}],"*":[zt,ro(zt),(i,e)=>{let t=1;for(const o of e)t*=o.evaluate(i);return t}],"-":{type:zt,overloads:[[[zt,zt],(i,[e,t])=>e.evaluate(i)-t.evaluate(i)],[[zt],(i,[e])=>-e.evaluate(i)]]},"/":[zt,[zt,zt],(i,[e,t])=>e.evaluate(i)/t.evaluate(i)],"%":[zt,[zt,zt],(i,[e,t])=>e.evaluate(i)%t.evaluate(i)],ln2:[zt,[],()=>Math.LN2],pi:[zt,[],()=>Math.PI],e:[zt,[],()=>Math.E],"^":[zt,[zt,zt],(i,[e,t])=>Math.pow(e.evaluate(i),t.evaluate(i))],sqrt:[zt,[zt],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[zt,[zt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[zt,[zt],(i,[e])=>Math.log(e.evaluate(i))],log2:[zt,[zt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[zt,[zt],(i,[e])=>Math.sin(e.evaluate(i))],cos:[zt,[zt],(i,[e])=>Math.cos(e.evaluate(i))],tan:[zt,[zt],(i,[e])=>Math.tan(e.evaluate(i))],asin:[zt,[zt],(i,[e])=>Math.asin(e.evaluate(i))],acos:[zt,[zt],(i,[e])=>Math.acos(e.evaluate(i))],atan:[zt,[zt],(i,[e])=>Math.atan(e.evaluate(i))],min:[zt,ro(zt),(i,e)=>Math.min(...e.map(t=>t.evaluate(i)))],max:[zt,ro(zt),(i,e)=>Math.max(...e.map(t=>t.evaluate(i)))],abs:[zt,[zt],(i,[e])=>Math.abs(e.evaluate(i))],round:[zt,[zt],(i,[e])=>{const t=e.evaluate(i);return t<0?-Math.round(-t):Math.round(t)}],floor:[zt,[zt],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[zt,[zt],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[vi,[yi,ui],(i,[e,t])=>i.properties()[e.value]===t.value],"filter-id-==":[vi,[ui],(i,[e])=>i.id()===e.value],"filter-type-==":[vi,[yi],(i,[e])=>i.geometryType()===e.value],"filter-<":[vi,[yi,ui],(i,[e,t])=>{const o=i.properties()[e.value],l=t.value;return typeof o==typeof l&&o<l}],"filter-id-<":[vi,[ui],(i,[e])=>{const t=i.id(),o=e.value;return typeof t==typeof o&&t<o}],"filter->":[vi,[yi,ui],(i,[e,t])=>{const o=i.properties()[e.value],l=t.value;return typeof o==typeof l&&o>l}],"filter-id->":[vi,[ui],(i,[e])=>{const t=i.id(),o=e.value;return typeof t==typeof o&&t>o}],"filter-<=":[vi,[yi,ui],(i,[e,t])=>{const o=i.properties()[e.value],l=t.value;return typeof o==typeof l&&o<=l}],"filter-id-<=":[vi,[ui],(i,[e])=>{const t=i.id(),o=e.value;return typeof t==typeof o&&t<=o}],"filter->=":[vi,[yi,ui],(i,[e,t])=>{const o=i.properties()[e.value],l=t.value;return typeof o==typeof l&&o>=l}],"filter-id->=":[vi,[ui],(i,[e])=>{const t=i.id(),o=e.value;return typeof t==typeof o&&t>=o}],"filter-has":[vi,[ui],(i,[e])=>e.value in i.properties()],"filter-has-id":[vi,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[vi,[yr(yi)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[vi,[yr(ui)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[vi,[yi,yr(ui)],(i,[e,t])=>t.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[vi,[yi,yr(ui)],(i,[e,t])=>function(o,l,h,f){for(;h<=f;){const m=h+f>>1;if(l[m]===o)return!0;l[m]>o?f=m-1:h=m+1}return!1}(i.properties()[e.value],t.value,0,t.value.length-1)],all:{type:vi,overloads:[[[vi,vi],(i,[e,t])=>e.evaluate(i)&&t.evaluate(i)],[ro(vi),(i,e)=>{for(const t of e)if(!t.evaluate(i))return!1;return!0}]]},any:{type:vi,overloads:[[[vi,vi],(i,[e,t])=>e.evaluate(i)||t.evaluate(i)],[ro(vi),(i,e)=>{for(const t of e)if(t.evaluate(i))return!0;return!1}]]},"!":[vi,[vi],(i,[e])=>!e.evaluate(i)],"is-supported-script":[vi,[yi],(i,[e])=>{const t=i.globals&&i.globals.isSupportedScript;return!t||t(e.evaluate(i))}],upcase:[yi,[yi],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[yi,[yi],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[yi,ro(ui),(i,e)=>e.map(t=>va(t.evaluate(i))).join("")],"resolved-locale":[yi,[ma],(i,[e])=>e.evaluate(i).resolvedLocale()]});var Ma=dd;function fd(i){return{result:"success",value:i}}function Ps(i){return{result:"error",value:i}}function Ds(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function pd(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function xu(i){return!!i.expression&&i.expression.interpolated}function Oi(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Ia(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function md(i){return i}function ka(i,e){const t=e.type==="color",o=i.stops&&typeof i.stops[0][0]=="object",l=o||!(o||i.property!==void 0),h=i.type||(xu(e)?"exponential":"interval");if(t&&((i=Ti({},i)).stops&&(i.stops=i.stops.map(b=>[b[0],ji.parse(b[1])])),i.default=ji.parse(i.default?i.default:e.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!rd[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let f,m,v;if(h==="exponential")f=bu;else if(h==="interval")f=Lo;else if(h==="categorical"){f=Zp,m=Object.create(null);for(const b of i.stops)m[b[0]]=b[1];v=typeof i.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);f=Ls}if(o){const b={},S=[];for(let P=0;P<i.stops.length;P++){const L=i.stops[P],U=L[0].zoom;b[U]===void 0&&(b[U]={zoom:U,type:i.type,property:i.property,default:i.default,stops:[]},S.push(U)),b[U].stops.push([L[0].value,L[1]])}const M=[];for(const P of S)M.push([b[P].zoom,ka(b[P],e)]);const I={name:"linear"};return{kind:"composite",interpolationType:I,interpolationFactor:$r.interpolationFactor.bind(void 0,I),zoomStops:M.map(P=>P[0]),evaluate:({zoom:P},L)=>bu({stops:M,base:i.base},e,P).evaluate(P,L)}}if(l){const b=h==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:b,interpolationFactor:$r.interpolationFactor.bind(void 0,b),zoomStops:i.stops.map(S=>S[0]),evaluate:({zoom:S})=>f(i,e,S,m,v)}}return{kind:"source",evaluate(b,S){const M=S&&S.properties?S.properties[i.property]:void 0;return M===void 0?za(i.default,e.default):f(i,e,M,m,v)}}}function za(i,e,t){return i!==void 0?i:e!==void 0?e:t!==void 0?t:void 0}function Zp(i,e,t,o,l){return za(typeof t===l?o[t]:void 0,i.default,e.default)}function Lo(i,e,t){if(Oi(t)!=="number")return za(i.default,e.default);const o=i.stops.length;if(o===1||t<=i.stops[0][0])return i.stops[0][1];if(t>=i.stops[o-1][0])return i.stops[o-1][1];const l=Il(i.stops.map(h=>h[0]),t);return i.stops[l][1]}function bu(i,e,t){const o=i.base!==void 0?i.base:1;if(Oi(t)!=="number")return za(i.default,e.default);const l=i.stops.length;if(l===1||t<=i.stops[0][0])return i.stops[0][1];if(t>=i.stops[l-1][0])return i.stops[l-1][1];const h=Il(i.stops.map(S=>S[0]),t),f=function(S,M,I,P){const L=P-I,U=S-I;return L===0?0:M===1?U/L:(Math.pow(M,U)-1)/(Math.pow(M,L)-1)}(t,o,i.stops[h][0],i.stops[h+1][0]),m=i.stops[h][1],v=i.stops[h+1][1];let b=Ea[e.type]||md;if(i.colorSpace&&i.colorSpace!=="rgb"){const S=rd[i.colorSpace];b=(M,I)=>S.reverse(S.interpolate(S.forward(M),S.forward(I),f))}return typeof m.evaluate=="function"?{evaluate(...S){const M=m.evaluate.apply(void 0,S),I=v.evaluate.apply(void 0,S);if(M!==void 0&&I!==void 0)return b(M,I,f)}}:b(m,v,f)}function Ls(i,e,t){return e.type==="color"?t=ji.parse(t):e.type==="formatted"?t=lr.fromString(t.toString()):e.type==="resolvedImage"?t=cr.fromString(t.toString()):Oi(t)===e.type||e.type==="enum"&&e.values[t]||(t=void 0),za(t,i.default,e.default)}class wu{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new Qh,this._defaultValue=t?function(o){return o.type==="color"&&(Ia(o.default)||Array.isArray(o.default))?new ji(0,0,0,0):o.type==="color"?ji.parse(o.default)||null:o.default===void 0?null:o.default}(t):null,this._enumValues=t&&t.type==="enum"?t.values:null}evaluateWithoutErrorHandling(e,t,o,l,h,f,m,v){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=o,this._evaluator.canonical=l||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=f,this._evaluator.featureTileCoord=m||null,this._evaluator.featureDistanceData=v||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,o,l,h,f,m,v){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=o||null,this._evaluator.canonical=l||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=f||null,this._evaluator.featureTileCoord=m||null,this._evaluator.featureDistanceData=v||null;try{const b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new Ln(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function Vl(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Ma}function Bs(i,e){const t=new es(Ma,[],e?function(l){const h={color:Br,string:yi,number:zt,enum:yi,boolean:vi,formatted:_a,resolvedImage:ga};return l.type==="array"?yr(h[l.value]||ui,l.length):h[l.type]}(e):void 0),o=t.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?fd(new wu(o,e)):Ps(t.errors)}class Tu{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!Po(t.expression)}evaluateWithoutErrorHandling(e,t,o,l,h,f){return this._styleExpression.evaluateWithoutErrorHandling(e,t,o,l,h,f)}evaluate(e,t,o,l,h,f){return this._styleExpression.evaluate(e,t,o,l,h,f)}}class Pa{constructor(e,t,o,l){this.kind=e,this.zoomStops=o,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!Po(t.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,t,o,l,h,f){return this._styleExpression.evaluateWithoutErrorHandling(e,t,o,l,h,f)}evaluate(e,t,o,l,h,f){return this._styleExpression.evaluate(e,t,o,l,h,f)}interpolationFactor(e,t,o){return this.interpolationType?$r.interpolationFactor(this.interpolationType,e,t,o):0}}function Eu(i,e){if((i=Bs(i,e)).result==="error")return i;const t=i.value.expression,o=Qo(t);if(!o&&!Ds(e))return Ps([new Jn("","data expressions not supported")]);const l=Ta(t,["zoom","pitch","distance-from-center"]);if(!l&&!pd(e))return Ps([new Jn("","zoom expressions not supported")]);const h=Os(t);return h||l?h instanceof Jn?Ps([h]):h instanceof $r&&!xu(e)?Ps([new Jn("",'"interpolate" expressions cannot be used with this property')]):fd(h?new Pa(o?"camera":"composite",i.value,h.labels,h instanceof $r?h.interpolation:void 0):new Tu(o?"constant":"source",i.value)):Ps([new Jn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Rs{constructor(e,t){this._parameters=e,this._specification=t,Ti(this,ka(this._parameters,this._specification))}static deserialize(e){return new Rs(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Os(i){let e=null;if(i instanceof sd)e=Os(i.result);else if(i instanceof od){for(const t of i.args)if(e=Os(t),e)break}else(i instanceof iu||i instanceof $r)&&i.input instanceof Or&&i.input.name==="zoom"&&(e=i);return e instanceof Jn||i.eachChild(t=>{const o=Os(t);o instanceof Jn?e=o:!e&&o?e=new Jn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new Jn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class Pt{constructor(e,t,o,l){this.message=(e?`${e}: `:"")+o,l&&(this.identifier=l),t!=null&&t.__line__&&(this.line=t.__line__)}}function vr(i){const e=i.key,t=i.value,o=i.valueSpec||{},l=i.objectElementValidators||{},h=i.style,f=i.styleSpec;let m=[];const v=Oi(t);if(v!=="object")return[new Pt(e,t,`object expected, ${v} found`)];for(const b in t){const S=b.split(".")[0],M=o[S]||o["*"];let I;l[S]?I=l[S]:o[S]?I=On:l["*"]?I=l["*"]:o["*"]&&(I=On),I?m=m.concat(I({key:(e&&`${e}.`)+b,value:t[b],valueSpec:M,style:h,styleSpec:f,object:t,objectKey:b},t)):m.push(new Pt(e,t[b],`unknown property "${b}"`))}for(const b in o)l[b]||o[b].required&&o[b].default===void 0&&t[b]===void 0&&m.push(new Pt(e,t,`missing required property "${b}"`));return m}function Su(i){const e=i.value,t=i.valueSpec,o=i.style,l=i.styleSpec,h=i.key,f=i.arrayElementValidator||On;if(Oi(e)!=="array")return[new Pt(h,e,`array expected, ${Oi(e)} found`)];if(t.length&&e.length!==t.length)return[new Pt(h,e,`array length ${t.length} expected, length ${e.length} found`)];if(t["min-length"]&&e.length<t["min-length"])return[new Pt(h,e,`array length at least ${t["min-length"]} expected, length ${e.length} found`)];let m={type:t.value,values:t.values,minimum:t.minimum,maximum:t.maximum,function:void 0};l.$version<7&&(m.function=t.function),Oi(t.value)==="object"&&(m=t.value);let v=[];for(let b=0;b<e.length;b++)v=v.concat(f({array:e,arrayIndex:b,value:e[b],valueSpec:m,style:o,styleSpec:l,key:`${h}[${b}]`}));return v}function Cu(i){const e=i.key,t=i.value,o=i.valueSpec;let l=Oi(t);if(l==="number"&&t!=t&&(l="NaN"),l!=="number")return[new Pt(e,t,`number expected, ${l} found`)];if("minimum"in o){let h=o.minimum;if(Oi(o.minimum)==="array"&&(h=o.minimum[i.arrayIndex]),t<h)return[new Pt(e,t,`${t} is less than the minimum value ${h}`)]}if("maximum"in o){let h=o.maximum;if(Oi(o.maximum)==="array"&&(h=o.maximum[i.arrayIndex]),t>h)return[new Pt(e,t,`${t} is greater than the maximum value ${h}`)]}return[]}function Da(i){const e=i.valueSpec,t=ni(i.value.type);let o,l,h,f={};const m=t!=="categorical"&&i.value.property===void 0,v=!m,b=Oi(i.value.stops)==="array"&&Oi(i.value.stops[0])==="array"&&Oi(i.value.stops[0][0])==="object",S=vr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(P){if(t==="identity")return[new Pt(P.key,P.value,'identity function may not have a "stops" property')];let L=[];const U=P.value;return L=L.concat(Su({key:P.key,value:U,valueSpec:P.valueSpec,style:P.style,styleSpec:P.styleSpec,arrayElementValidator:M})),Oi(U)==="array"&&U.length===0&&L.push(new Pt(P.key,U,"array must have at least one stop")),L},default:function(P){return On({key:P.key,value:P.value,valueSpec:e,style:P.style,styleSpec:P.styleSpec})}}});return t==="identity"&&m&&S.push(new Pt(i.key,i.value,'missing required property "property"')),t==="identity"||i.value.stops||S.push(new Pt(i.key,i.value,'missing required property "stops"')),t==="exponential"&&i.valueSpec.expression&&!xu(i.valueSpec)&&S.push(new Pt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(v&&!Ds(i.valueSpec)?S.push(new Pt(i.key,i.value,"property functions not supported")):m&&!pd(i.valueSpec)&&S.push(new Pt(i.key,i.value,"zoom functions not supported"))),t!=="categorical"&&!b||i.value.property!==void 0||S.push(new Pt(i.key,i.value,'"property" property is required')),S;function M(P){let L=[];const U=P.value,$=P.key;if(Oi(U)!=="array")return[new Pt($,U,`array expected, ${Oi(U)} found`)];if(U.length!==2)return[new Pt($,U,`array length 2 expected, length ${U.length} found`)];if(b){if(Oi(U[0])!=="object")return[new Pt($,U,`object expected, ${Oi(U[0])} found`)];if(U[0].zoom===void 0)return[new Pt($,U,"object stop key must have zoom")];if(U[0].value===void 0)return[new Pt($,U,"object stop key must have value")];const ee=ni(U[0].zoom);if(typeof ee!="number")return[new Pt($,U[0].zoom,"stop zoom values must be numbers")];if(h&&h>ee)return[new Pt($,U[0].zoom,"stop zoom values must appear in ascending order")];ee!==h&&(h=ee,l=void 0,f={}),L=L.concat(vr({key:`${$}[0]`,value:U[0],valueSpec:{zoom:{}},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{zoom:Cu,value:I}}))}else L=L.concat(I({key:`${$}[0]`,value:U[0],valueSpec:{},style:P.style,styleSpec:P.styleSpec},U));return Vl(Gi(U[1]))?L.concat([new Pt(`${$}[1]`,U[1],"expressions are not allowed in function stops.")]):L.concat(On({key:`${$}[1]`,value:U[1],valueSpec:e,style:P.style,styleSpec:P.styleSpec}))}function I(P,L){const U=Oi(P.value),$=ni(P.value),ee=P.value!==null?P.value:L;if(o){if(U!==o)return[new Pt(P.key,ee,`${U} stop domain type must match previous stop domain type ${o}`)]}else o=U;if(U!=="number"&&U!=="string"&&U!=="boolean"&&typeof $!="number"&&typeof $!="string"&&typeof $!="boolean")return[new Pt(P.key,ee,"stop domain value must be a number, string, or boolean")];if(U!=="number"&&t!=="categorical"){let se=`number expected, ${U} found`;return Ds(e)&&t===void 0&&(se+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Pt(P.key,ee,se)]}return t!=="categorical"||U!=="number"||typeof $=="number"&&isFinite($)&&Math.floor($)===$?t!=="categorical"&&U==="number"&&typeof $=="number"&&typeof l=="number"&&l!==void 0&&$<l?[new Pt(P.key,ee,"stop domain values must appear in ascending order")]:(l=$,t==="categorical"&&$ in f?[new Pt(P.key,ee,"stop domain values must be unique")]:(f[$]=!0,[])):[new Pt(P.key,ee,`integer expected, found ${String($)}`)]}}function Fr(i){const e=(i.expressionContext==="property"?Eu:Bs)(Gi(i.value),i.valueSpec);if(e.result==="error")return e.value.map(o=>new Pt(`${i.key}${o.key}`,i.value,o.message));const t=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!t.outputDefined())return[new Pt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Po(t))return[new Pt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter")return Au(t,i);if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Ta(t,["zoom","feature-state"]))return[new Pt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Qo(t))return[new Pt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Au(i,e){const t=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const l of e.valueSpec.expression.parameters)t.delete(l);if(t.size===0)return[];const o=[];return i instanceof Or&&t.has(i.name)?[new Pt(e.key,e.value,`["${i.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(i.eachChild(l=>{o.push(...Au(l,e))}),o)}function La(i){const e=i.key,t=i.value,o=i.valueSpec,l=[];return Array.isArray(o.values)?o.values.indexOf(ni(t))===-1&&l.push(new Pt(e,t,`expected one of [${o.values.join(", ")}], ${JSON.stringify(t)} found`)):Object.keys(o.values).indexOf(ni(t))===-1&&l.push(new Pt(e,t,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(t)} found`)),l}function Ba(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!Ba(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Ra(i,e="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ba(i)||(i=Ul(i));const t=i;let o=!0;try{o=function(b){if(!oo(b))return b;let S=Gi(b);return Mu(S),S=_d(S),S}(t)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(t,null,2)}
        `)}const l=Me[`filter_${e}`],h=Bs(o,l);let f=null;if(h.result==="error")throw new Error(h.value.map(b=>`${b.key}: ${b.message}`).join(", "));f=(b,S,M)=>h.value.evaluate(b,S,{},M);let m=null,v=null;if(o!==t){const b=Bs(t,l);if(b.result==="error")throw new Error(b.value.map(S=>`${S.key}: ${S.message}`).join(", "));m=(S,M,I,P,L)=>b.value.evaluate(S,M,{},I,void 0,void 0,P,L),v=!Qo(b.value.expression)}return f=f,{filter:f,dynamicFilter:m||void 0,needGeometry:gd(o),needFeature:!!v}}function _d(i){if(!Array.isArray(i))return i;const e=function(t){if(Wp.has(t[0])){for(let o=1;o<t.length;o++)if(oo(t[o]))return!0}return t}(i);return e===!0?e:e.map(t=>_d(t))}function Mu(i){let e=!1;const t=[];if(i[0]==="case"){for(let o=1;o<i.length-1;o+=2)e=e||oo(i[o]),t.push(i[o+1]);t.push(i[i.length-1])}else if(i[0]==="match"){e=e||oo(i[1]);for(let o=2;o<i.length-1;o+=2)t.push(i[o+1]);t.push(i[i.length-1])}else if(i[0]==="step"){e=e||oo(i[1]);for(let o=1;o<i.length-1;o+=2)t.push(i[o+1])}e&&(i.length=0,i.push("any",...t));for(let o=1;o<i.length;o++)Mu(i[o])}function oo(i){if(!Array.isArray(i))return!1;if((e=i[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let t=1;t<i.length;t++)if(oo(i[t]))return!0;return!1}const Wp=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Hp(i,e){return i<e?-1:i>e?1:0}function gd(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(gd(i[e]))return!0;return!1}function Ul(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?Iu(i[1],i[2],"=="):e==="!="?Gn(Iu(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Iu(i[1],i[2],e):e==="any"?(t=i.slice(1),["any"].concat(t.map(Ul))):e==="all"?["all"].concat(i.slice(1).map(Ul)):e==="none"?["all"].concat(i.slice(1).map(Ul).map(Gn)):e==="in"?Oa(i[1],i.slice(2)):e==="!in"?Gn(Oa(i[1],i.slice(2))):e==="has"?Fa(i[1]):e==="!has"?Gn(Fa(i[1])):e!=="within"||i;var t}function Iu(i,e,t){switch(i){case"$type":return[`filter-type-${t}`,e];case"$id":return[`filter-id-${t}`,e];default:return[`filter-${t}`,i,e]}}function Oa(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(t=>typeof t!=typeof e[0])?["filter-in-large",i,["literal",e.sort(Hp)]]:["filter-in-small",i,["literal",e]]}}function Fa(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Gn(i){return["!",i]}function Fs(i){return Ba(Gi(i.value))?Fr(Ti({},i,{expressionContext:"filter",valueSpec:i.styleSpec[`filter_${i.layerType||"fill"}`]})):yd(i)}function yd(i){const e=i.value,t=i.key;if(Oi(e)!=="array")return[new Pt(t,e,`array expected, ${Oi(e)} found`)];const o=i.styleSpec;let l,h=[];if(e.length<1)return[new Pt(t,e,"filter array must have at least 1 element")];switch(h=h.concat(La({key:`${t}[0]`,value:e[0],valueSpec:o.filter_operator,style:i.style,styleSpec:i.styleSpec})),ni(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&ni(e[1])==="$type"&&h.push(new Pt(t,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&h.push(new Pt(t,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(l=Oi(e[1]),l!=="string"&&h.push(new Pt(`${t}[1]`,e[1],`string expected, ${l} found`)));for(let f=2;f<e.length;f++)l=Oi(e[f]),ni(e[1])==="$type"?h=h.concat(La({key:`${t}[${f}]`,value:e[f],valueSpec:o.geometry_type,style:i.style,styleSpec:i.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&h.push(new Pt(`${t}[${f}]`,e[f],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let f=1;f<e.length;f++)h=h.concat(yd({key:`${t}[${f}]`,value:e[f],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":l=Oi(e[1]),e.length!==2?h.push(new Pt(t,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="string"&&h.push(new Pt(`${t}[1]`,e[1],`string expected, ${l} found`));break;case"within":l=Oi(e[1]),e.length!==2?h.push(new Pt(t,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="object"&&h.push(new Pt(`${t}[1]`,e[1],`object expected, ${l} found`))}return h}function vd(i,e){const t=i.key,o=i.style,l=i.styleSpec,h=i.value,f=i.objectKey,m=l[`${e}_${i.layerType}`];if(!m)return[];const v=f.match(/^(.*)-transition$/);if(e==="paint"&&v&&m[v[1]]&&m[v[1]].transition)return On({key:t,value:h,valueSpec:l.transition,style:o,styleSpec:l});const b=i.valueSpec||m[f];if(!b)return[new Pt(t,h,`unknown property "${f}"`)];let S;if(Oi(h)==="string"&&Ds(b)&&!b.tokens&&(S=/^{([^}]+)}$/.exec(h)))return[new Pt(t,h,`"${f}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(S[1])} }\`.`)];const M=[];return i.layerType==="symbol"&&(f==="text-field"&&o&&!o.glyphs&&M.push(new Pt(t,h,'use of "text-field" requires a style "glyphs" property')),f==="text-font"&&Ia(Gi(h))&&ni(h.type)==="identity"&&M.push(new Pt(t,h,'"text-font" does not support identity functions'))),M.concat(On({key:i.key,value:h,valueSpec:b,style:o,styleSpec:l,expressionContext:"property",propertyType:e,propertyKey:f}))}function xd(i){return vd(i,"paint")}function bd(i){return vd(i,"layout")}function Nl(i){let e=[];const t=i.value,o=i.key,l=i.style,h=i.styleSpec;t.type||t.ref||e.push(new Pt(o,t,'either "type" or "ref" is required'));let f=ni(t.type);const m=ni(t.ref);if(t.id){const v=ni(t.id);for(let b=0;b<i.arrayIndex;b++){const S=l.layers[b];ni(S.id)===v&&e.push(new Pt(o,t.id,`duplicate layer id "${t.id}", previously used at line ${S.id.__line__}`))}}if("ref"in t){let v;["type","source","source-layer","filter","layout"].forEach(b=>{b in t&&e.push(new Pt(o,t[b],`"${b}" is prohibited for ref layers`))}),l.layers.forEach(b=>{ni(b.id)===m&&(v=b)}),v?v.ref?e.push(new Pt(o,t.ref,"ref cannot reference another ref layer")):f=ni(v.type):typeof m=="string"&&e.push(new Pt(o,t.ref,`ref layer "${m}" not found`))}else if(f!=="background"&&f!=="sky")if(t.source){const v=l.sources&&l.sources[t.source],b=v&&ni(v.type);v?b==="vector"&&f==="raster"?e.push(new Pt(o,t.source,`layer "${t.id}" requires a raster source`)):b==="raster"&&f!=="raster"?e.push(new Pt(o,t.source,`layer "${t.id}" requires a vector source`)):b!=="vector"||t["source-layer"]?b==="raster-dem"&&f!=="hillshade"?e.push(new Pt(o,t.source,"raster-dem source can only be used with layer type 'hillshade'.")):f!=="line"||!t.paint||!t.paint["line-gradient"]&&!t.paint["line-trim-offset"]||b==="geojson"&&v.lineMetrics||e.push(new Pt(o,t,`layer "${t.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Pt(o,t,`layer "${t.id}" must specify a "source-layer"`)):e.push(new Pt(o,t.source,`source "${t.source}" not found`))}else e.push(new Pt(o,t,'missing required property "source"'));return e=e.concat(vr({key:o,value:t,valueSpec:h.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>On({key:`${o}.type`,value:t.type,valueSpec:h.layer.type,style:i.style,styleSpec:i.styleSpec,object:t,objectKey:"type"}),filter:v=>Fs(Ti({layerType:f},v)),layout:v=>vr({layer:t,key:v.key,value:v.value,valueSpec:{},style:v.style,styleSpec:v.styleSpec,objectElementValidators:{"*":b=>bd(Ti({layerType:f},b))}}),paint:v=>vr({layer:t,key:v.key,value:v.value,valueSpec:{},style:v.style,styleSpec:v.styleSpec,objectElementValidators:{"*":b=>xd(Ti({layerType:f},b))}})}})),e}function Vs(i){const e=i.value,t=i.key,o=Oi(e);return o!=="string"?[new Pt(t,e,`string expected, ${o} found`)]:[]}const jl={promoteId:function({key:i,value:e}){if(Oi(e)==="string")return Vs({key:i,value:e});{const t=[];for(const o in e)t.push(...Vs({key:`${i}.${o}`,value:e[o]}));return t}}};function wd(i){const e=i.value,t=i.key,o=i.styleSpec,l=i.style;if(!e.type)return[new Pt(t,e,'"type" is required')];const h=ni(e.type);let f;switch(h){case"vector":case"raster":case"raster-dem":return f=vr({key:t,value:e,valueSpec:o[`source_${h.replace("-","_")}`],style:i.style,styleSpec:o,objectElementValidators:jl}),f;case"geojson":if(f=vr({key:t,value:e,valueSpec:o.source_geojson,style:l,styleSpec:o,objectElementValidators:jl}),e.cluster)for(const m in e.clusterProperties){const[v,b]=e.clusterProperties[m],S=typeof v=="string"?[v,["accumulated"],["get",m]]:v;f.push(...Fr({key:`${t}.${m}.map`,value:b,expressionContext:"cluster-map"})),f.push(...Fr({key:`${t}.${m}.reduce`,value:S,expressionContext:"cluster-reduce"}))}return f;case"video":return vr({key:t,value:e,valueSpec:o.source_video,style:l,styleSpec:o});case"image":return vr({key:t,value:e,valueSpec:o.source_image,style:l,styleSpec:o});case"canvas":return[new Pt(t,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return La({key:`${t}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:l,styleSpec:o})}}function Td(i){const e=i.value,t=i.styleSpec,o=t.light,l=i.style;let h=[];const f=Oi(e);if(e===void 0)return h;if(f!=="object")return h=h.concat([new Pt("light",e,`object expected, ${f} found`)]),h;for(const m in e){const v=m.match(/^(.*)-transition$/);h=h.concat(v&&o[v[1]]&&o[v[1]].transition?On({key:m,value:e[m],valueSpec:t.transition,style:l,styleSpec:t}):o[m]?On({key:m,value:e[m],valueSpec:o[m],style:l,styleSpec:t}):[new Pt(m,e[m],`unknown property "${m}"`)])}return h}function ql(i){const e=i.value,t=i.key,o=i.style,l=i.styleSpec,h=l.terrain;let f=[];const m=Oi(e);if(e===void 0)return f;if(m!=="object")return f=f.concat([new Pt("terrain",e,`object expected, ${m} found`)]),f;for(const v in e){const b=v.match(/^(.*)-transition$/);f=f.concat(b&&h[b[1]]&&h[b[1]].transition?On({key:v,value:e[v],valueSpec:l.transition,style:o,styleSpec:l}):h[v]?On({key:v,value:e[v],valueSpec:h[v],style:o,styleSpec:l}):[new Pt(v,e[v],`unknown property "${v}"`)])}if(e.source){const v=o.sources&&o.sources[e.source],b=v&&ni(v.type);v?b!=="raster-dem"&&f.push(new Pt(t,e.source,`terrain cannot be used with a source of type ${String(b)}, it only be used with a "raster-dem" source type`)):f.push(new Pt(t,e.source,`source "${e.source}" not found`))}else f.push(new Pt(t,e,'terrain is missing required property "source"'));return f}function Ed(i){const e=i.value,t=i.style,o=i.styleSpec,l=o.fog;let h=[];const f=Oi(e);if(e===void 0)return h;if(f!=="object")return h=h.concat([new Pt("fog",e,`object expected, ${f} found`)]),h;for(const m in e){const v=m.match(/^(.*)-transition$/);h=h.concat(v&&l[v[1]]&&l[v[1]].transition?On({key:m,value:e[m],valueSpec:o.transition,style:t,styleSpec:o}):l[m]?On({key:m,value:e[m],valueSpec:l[m],style:t,styleSpec:o}):[new Pt(m,e[m],`unknown property "${m}"`)])}return h}const ku={"*":()=>[],array:Su,boolean:function(i){const e=i.value,t=i.key,o=Oi(e);return o!=="boolean"?[new Pt(t,e,`boolean expected, ${o} found`)]:[]},number:Cu,color:function(i){const e=i.key,t=i.value,o=Oi(t);return o!=="string"?[new Pt(e,t,`color expected, ${o} found`)]:Io.parseCSSColor(t)===null?[new Pt(e,t,`color expected, "${t}" found`)]:[]},enum:La,filter:Fs,function:Da,layer:Nl,object:vr,source:wd,light:Td,terrain:ql,fog:Ed,string:Vs,formatted:function(i){return Vs(i).length===0?[]:Fr(i)},resolvedImage:function(i){return Vs(i).length===0?[]:Fr(i)},projection:function(i){const e=i.value,t=i.styleSpec,o=t.projection,l=i.style;let h=[];const f=Oi(e);if(f==="object")for(const m in e)h=h.concat(On({key:m,value:e[m],valueSpec:o[m],style:l,styleSpec:t}));else f!=="string"&&(h=h.concat([new Pt("projection",e,`object or string expected, ${f} found`)]));return h}};function On(i){const e=i.value,t=i.valueSpec,o=i.styleSpec;return t.expression&&Ia(ni(e))?Da(i):t.expression&&Vl(Gi(e))?Fr(i):t.type&&ku[t.type]?ku[t.type](i):vr(Ti({},i,{valueSpec:t.type?o[t.type]:t}))}function Xp(i){const e=i.value,t=i.key,o=Vs(i);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new Pt(t,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new Pt(t,e,'"glyphs" url must include a "{range}" token'))),o}function $l(i,e=Me){return so(On({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:Xp,"*":()=>[]}}))}const Gl=i=>so(xd(i)),Sd=i=>so(bd(i));function so(i){return i.slice().sort((e,t)=>e.line&&t.line?e.line-t.line:0)}function zu(i,e){let t=!1;if(e&&e.length)for(const o of e)i.fire(new vt(new Error(o.message))),t=!0;return t}var Us=Ar;function Ar(i,e,t){var o=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var l=new Int32Array(this.arrayBuffer);i=l[0],this.d=(e=l[1])+2*(t=l[2]);for(var h=0;h<this.d*this.d;h++){var f=l[3+h],m=l[3+h+1];o.push(f===m?null:l.subarray(f,m))}var v=l[3+o.length+1];this.keys=l.subarray(l[3+o.length],v),this.bboxes=l.subarray(v),this.insert=this._insertReadonly}else{this.d=e+2*t;for(var b=0;b<this.d*this.d;b++)o.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=i,this.padding=t,this.scale=e/i,this.uid=0;var S=t/e*i;this.min=-S,this.max=i+S}Ar.prototype.insert=function(i,e,t,o,l){this._forEachCell(e,t,o,l,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(e),this.bboxes.push(t),this.bboxes.push(o),this.bboxes.push(l)},Ar.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ar.prototype._insertCell=function(i,e,t,o,l,h){this.cells[l].push(h)},Ar.prototype.query=function(i,e,t,o,l){var h=this.min,f=this.max;if(i<=h&&e<=h&&f<=t&&f<=o&&!l)return Array.prototype.slice.call(this.keys);var m=[];return this._forEachCell(i,e,t,o,this._queryCell,m,{},l),m},Ar.prototype._queryCell=function(i,e,t,o,l,h,f,m){var v=this.cells[l];if(v!==null)for(var b=this.keys,S=this.bboxes,M=0;M<v.length;M++){var I=v[M];if(f[I]===void 0){var P=4*I;(m?m(S[P+0],S[P+1],S[P+2],S[P+3]):i<=S[P+2]&&e<=S[P+3]&&t>=S[P+0]&&o>=S[P+1])?(f[I]=!0,h.push(b[I])):f[I]=!1}}},Ar.prototype._forEachCell=function(i,e,t,o,l,h,f,m){for(var v=this._convertToCellCoord(i),b=this._convertToCellCoord(e),S=this._convertToCellCoord(t),M=this._convertToCellCoord(o),I=v;I<=S;I++)for(var P=b;P<=M;P++){var L=this.d*P+I;if((!m||m(this._convertFromCellCoord(I),this._convertFromCellCoord(P),this._convertFromCellCoord(I+1),this._convertFromCellCoord(P+1)))&&l.call(this,i,e,t,o,L,h,f,m))return}},Ar.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},Ar.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},Ar.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,e=3+this.cells.length+1+1,t=0,o=0;o<this.cells.length;o++)t+=this.cells[o].length;var l=new Int32Array(e+t+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;for(var h=e,f=0;f<i.length;f++){var m=i[f];l[3+f]=h,l.set(m,h),h+=m.length}return l[3+i.length]=h,l.set(this.keys,h),l[3+i.length+1]=h+=this.keys.length,l.set(this.bboxes,h),h+=this.bboxes.length,l.buffer};const Zl={};function Rt(i,e,t={}){Object.defineProperty(i,"_classRegistryKey",{value:e,writeable:!1}),Zl[e]={klass:i,omit:t.omit||[]}}Rt(Object,"Object"),Us.serialize=function(i,e){const t=i.toArrayBuffer();return e&&e.push(t),{buffer:t}},Us.deserialize=function(i){return new Us(i.buffer)},Object.defineProperty(Us,"name",{value:"Grid"}),Rt(Us,"Grid"),Rt(ji,"Color"),Rt(Error,"Error"),Rt(ke,"AJAXError"),Rt(cr,"ResolvedImage"),Rt(Rs,"StylePropertyFunction"),Rt(wu,"StyleExpression",{omit:["_evaluator"]}),Rt(Pa,"ZoomDependentExpression"),Rt(Tu,"ZoomConstantExpression"),Rt(Or,"CompoundExpression",{omit:["_evaluate"]});for(const i in Ma)Zl[Ma[i]._classRegistryKey]||Rt(Ma[i],`Expression${i}`);function Cd(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Ad(i){return D.ImageBitmap&&i instanceof D.ImageBitmap}function Ns(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(Cd(i)||Ad(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const t=i;return e&&e.push(t.buffer),t}if(i instanceof D.ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const t=[];for(const o of i)t.push(Ns(o,e));return t}if(typeof i=="object"){const t=i.constructor,o=t._classRegistryKey;if(!o)throw new Error(`can't serialize object of unregistered class ${o}`);const l=t.serialize?t.serialize(i,e):{};if(!t.serialize){for(const h in i)i.hasOwnProperty(h)&&(Zl[o].omit.indexOf(h)>=0||(l[h]=Ns(i[h],e)));i instanceof Error&&(l.message=i.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(l.$name=o),l}throw new Error("can't serialize object of type "+typeof i)}function Va(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||Cd(i)||Ad(i)||ArrayBuffer.isView(i)||i instanceof D.ImageData)return i;if(Array.isArray(i))return i.map(Va);if(typeof i=="object"){const e=i.$name||"Object",{klass:t}=Zl[e];if(!t)throw new Error(`can't deserialize unregistered class ${e}`);if(t.deserialize)return t.deserialize(i);const o=Object.create(t.prototype);for(const l of Object.keys(i))l!=="$name"&&(o[l]=Va(i[l]));return o}throw new Error("can't deserialize object of type "+typeof i)}class Md{constructor(){this.first=!0}update(e,t){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}const Id=i=>i>=1536&&i<=1791,kd=i=>i>=1872&&i<=1919,zd=i=>i>=2208&&i<=2303,Pd=i=>i>=11904&&i<=12031,Dd=i=>i>=12032&&i<=12255,Ua=i=>i>=12272&&i<=12287,Wl=i=>i>=12288&&i<=12351,Pu=i=>i>=12352&&i<=12447,ts=i=>i>=12448&&i<=12543,Ld=i=>i>=12544&&i<=12591,Du=i=>i>=12704&&i<=12735,Bd=i=>i>=12736&&i<=12783,Lu=i=>i>=12784&&i<=12799,Bu=i=>i>=12800&&i<=13055,Ru=i=>i>=13056&&i<=13311,Ou=i=>i>=13312&&i<=19903,Na=i=>i>=19968&&i<=40959,Hl=i=>i>=40960&&i<=42127,Rd=i=>i>=42128&&i<=42191,Od=i=>i>=44032&&i<=55215,Fd=i=>i>=63744&&i<=64255,ja=i=>i>=64336&&i<=65023,Vd=i=>i>=65040&&i<=65055,Fu=i=>i>=65072&&i<=65103,Ud=i=>i>=65104&&i<=65135,Vu=i=>i>=65136&&i<=65279,Uu=i=>i>=65280&&i<=65519;function Xl(i){for(const e of i)if(Kl(e.charCodeAt(0)))return!0;return!1}function Kp(i){for(const e of i)if(!Yp(e.charCodeAt(0)))return!1;return!0}function Yp(i){return!(Id(i)||kd(i)||zd(i)||ja(i)||Vu(i))}function Kl(i){return!(i!==746&&i!==747&&(i<4352||!(Du(i)||Ld(i)||Fu(i)&&!(i>=65097&&i<=65103)||Fd(i)||Ru(i)||Pd(i)||Bd(i)||!(!Wl(i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Ou(i)||Na(i)||Bu(i)||(e=>e>=12592&&e<=12687)(i)||(e=>e>=43360&&e<=43391)(i)||(e=>e>=55216&&e<=55295)(i)||(e=>e>=4352&&e<=4607)(i)||Od(i)||Pu(i)||Ua(i)||(e=>e>=12688&&e<=12703)(i)||Dd(i)||Lu(i)||ts(i)&&i!==12540||!(!Uu(i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Ud(i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||(e=>e>=5120&&e<=5759)(i)||(e=>e>=6320&&e<=6399)(i)||Vd(i)||(e=>e>=19904&&e<=19967)(i)||Hl(i)||Rd(i))))}function qa(i){return!(Kl(i)||function(e){return!!((t=>t>=128&&t<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(t=>t>=8192&&t<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(t=>t>=8448&&t<=8527)(e)||(t=>t>=8528&&t<=8591)(e)||(t=>t>=8960&&t<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(t=>t>=9216&&t<=9279)(e)&&e!==9251||(t=>t>=9280&&t<=9311)(e)||(t=>t>=9312&&t<=9471)(e)||(t=>t>=9632&&t<=9727)(e)||(t=>t>=9728&&t<=9983)(e)&&!(e>=9754&&e<=9759)||(t=>t>=11008&&t<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Wl(e)||ts(e)||(t=>t>=57344&&t<=63743)(e)||Fu(e)||Ud(e)||Uu(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function c(i){return i>=1424&&i<=2303||ja(i)||Vu(i)}function n(i,e){return!(!e&&c(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||(t=>t>=6016&&t<=6143)(i))}function a(i){for(const e of i)if(c(e.charCodeAt(0)))return!0;return!1}const d="deferred",_="loading",g="loaded";let w=null,E="unavailable",C=null;const k=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(E="error"),w&&w(i)};function z(){R.fire(new he("pluginStateChange",{pluginStatus:E,pluginURL:C}))}const R=new Ze,j=function(){return E},K=function(){if(E!==d||!C)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");E=_,z(),C&&ze({url:C},i=>{i?k(i):(E=g,z())})},W={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>E===g||W.applyArabicShaping!=null,isLoading:()=>E===_,setState(i){E=i.pluginStatus,C=i.pluginURL},isParsed:()=>W.applyArabicShaping!=null&&W.processBidirectionalText!=null&&W.processStyledBidirectionalText!=null,getPluginURL:()=>C};class H{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition,this.pitch=t.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Md,this.transition={},this.pitch=0)}isSupportedScript(e){return function(t,o){for(const l of t)if(!n(l.charCodeAt(0),o))return!1;return!0}(e,W.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,t=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*t}}}class X{constructor(e,t){this.property=e,this.value=t,this.expression=function(o,l){if(Ia(o))return new Rs(o,l);if(Vl(o)){const h=Eu(o,l);if(h.result==="error")throw new Error(h.value.map(f=>`${f.key}: ${f.message}`).join(", "));return h.value}{let h=o;return typeof o=="string"&&l.type==="color"&&(h=ji.parse(o)),{kind:"constant",evaluate:()=>h}}}(t===void 0?e.specification.default:t,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,t,o){return this.property.possiblyEvaluate(this,e,t,o)}}class G{constructor(e){this.property=e,this.value=new X(e,void 0)}transitioned(e,t){return new Y(this.property,this.value,t,Ue({},e.transition,this.transition),e.now)}untransitioned(){return new Y(this.property,this.value,null,{},0)}}class te{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Fe(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new G(this._values[e].property)),this._values[e].value=new X(this._values[e].property,t===null?void 0:Fe(t))}getTransition(e){return Fe(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new G(this._values[e].property)),this._values[e].transition=Fe(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const o=this.getValue(t);o!==void 0&&(e[t]=o);const l=this.getTransition(t);l!==void 0&&(e[`${t}-transition`]=l)}return e}transitioned(e,t){const o=new me(this._properties);for(const l of Object.keys(this._values))o._values[l]=this._values[l].transitioned(e,t._values[l]);return o}untransitioned(){const e=new me(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class Y{constructor(e,t,o,l,h){const f=l.delay||0,m=l.duration||0;h=h||0,this.property=e,this.value=t,this.begin=h+f,this.end=this.begin+m,e.specification.transition&&(l.delay||l.duration)&&(this.prior=o)}possiblyEvaluate(e,t,o){const l=e.now||0,h=this.value.possiblyEvaluate(e,t,o),f=this.prior;if(f){if(l>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(l<this.begin)return f.possiblyEvaluate(e,t,o);{const m=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,t,o),h,Ee(m))}}return h}}class me{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,o){const l=new pe(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].possiblyEvaluate(e,t,o);return l}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class fe{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Fe(this._values[e].value)}setValue(e,t){this._values[e]=new X(this._values[e].property,t===null?void 0:Fe(t))}serialize(){const e={};for(const t of Object.keys(this._values)){const o=this.getValue(t);o!==void 0&&(e[t]=o)}return e}possiblyEvaluate(e,t,o){const l=new pe(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].possiblyEvaluate(e,t,o);return l}}class oe{constructor(e,t,o){this.property=e,this.value=t,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,t,o,l){return this.property.evaluate(this.value,this.parameters,e,t,o,l)}}class pe{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ue{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,o){const l=Ea[this.specification.type];return l?l(e,t,o):e}}class be{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,o,l){return new oe(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(t,null,{},o,l)}:e.expression,t)}interpolate(e,t,o){if(e.value.kind!=="constant"||t.value.kind!=="constant")return e;if(e.value.value===void 0||t.value.value===void 0)return new oe(this,{kind:"constant",value:void 0},e.parameters);const l=Ea[this.specification.type];return l?new oe(this,{kind:"constant",value:l(e.value.value,t.value.value,o)},e.parameters):e}evaluate(e,t,o,l,h,f){return e.kind==="constant"?e.value:e.evaluate(t,o,l,h,f)}}class Be extends be{possiblyEvaluate(e,t,o,l){if(e.value===void 0)return new oe(this,{kind:"constant",value:void 0},t);if(e.expression.kind==="constant"){const h=e.expression.evaluate(t,null,{},o,l),f=e.property.specification.type==="resolvedImage"&&typeof h!="string"?h.name:h,m=this._calculate(f,f,f,t);return new oe(this,{kind:"constant",value:m},t)}if(e.expression.kind==="camera"){const h=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t);return new oe(this,{kind:"constant",value:h},t)}return new oe(this,e.expression,t)}evaluate(e,t,o,l,h,f){if(e.kind==="source"){const m=e.evaluate(t,o,l,h,f);return this._calculate(m,m,m,t)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},o,l),e.evaluate({zoom:Math.floor(t.zoom)},o,l),e.evaluate({zoom:Math.floor(t.zoom)+1},o,l),t):e.value}_calculate(e,t,o,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:t,other:o}:{from:o,to:t,other:e}}interpolate(e){return e}}class dt{constructor(e){this.specification=e}possiblyEvaluate(e,t,o,l){if(e.value!==void 0){if(e.expression.kind==="constant"){const h=e.expression.evaluate(t,null,{},o,l);return this._calculate(h,h,h,t)}return this._calculate(e.expression.evaluate(new H(Math.floor(t.zoom-1),t)),e.expression.evaluate(new H(Math.floor(t.zoom),t)),e.expression.evaluate(new H(Math.floor(t.zoom+1),t)),t)}}_calculate(e,t,o,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:o,to:t}}interpolate(e){return e}}class Ie{constructor(e){this.specification=e}possiblyEvaluate(e,t,o,l){return!!e.expression.evaluate(t,null,{},o,l)}interpolate(){return!1}}class Je{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new H(0,{});for(const o in e){const l=e[o];l.specification.overridable&&this.overridableProperties.push(o);const h=this.defaultPropertyValues[o]=new X(l,void 0),f=this.defaultTransitionablePropertyValues[o]=new G(l);this.defaultTransitioningPropertyValues[o]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=h.possiblyEvaluate(t)}}}function rt(i,e){return 256*(i=Se(Math.floor(i),0,255))+Se(Math.floor(e),0,255)}Rt(be,"DataDrivenProperty"),Rt(ue,"DataConstantProperty"),Rt(Be,"CrossFadedDataDrivenProperty"),Rt(dt,"CrossFadedProperty"),Rt(Ie,"ColorRampProperty");const wt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class qe{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class mt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function it(i,e=1){let t=0,o=0;return{members:i.map(l=>{const h=wt[l.type].BYTES_PER_ELEMENT,f=t=It(t,Math.max(e,h)),m=l.components||1;return o=Math.max(o,h),t+=h*m,{name:l.name,type:l.type,components:m,offset:f}}),size:It(t,Math.max(o,e)),alignment:e}}function It(i,e){return Math.ceil(i/e)*e}class St extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const o=this.length;return this.resize(o+1),this.emplace(o,e,t)}emplace(e,t,o){const l=2*e;return this.int16[l+0]=t,this.int16[l+1]=o,e}}St.prototype.bytesPerElement=4,Rt(St,"StructArrayLayout2i4");class Vt extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,t,o)}emplace(e,t,o,l){const h=3*e;return this.int16[h+0]=t,this.int16[h+1]=o,this.int16[h+2]=l,e}}Vt.prototype.bytesPerElement=6,Rt(Vt,"StructArrayLayout3i6");class Wt extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,o,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,t,o,l)}emplace(e,t,o,l,h){const f=4*e;return this.int16[f+0]=t,this.int16[f+1]=o,this.int16[f+2]=l,this.int16[f+3]=h,e}}Wt.prototype.bytesPerElement=8,Rt(Wt,"StructArrayLayout4i8");class ii extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,o,l,h,f,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,t,o,l,h,f,m)}emplace(e,t,o,l,h,f,m,v){const b=6*e,S=12*e,M=3*e;return this.int16[b+0]=t,this.int16[b+1]=o,this.uint8[S+4]=l,this.uint8[S+5]=h,this.uint8[S+6]=f,this.uint8[S+7]=m,this.float32[M+2]=v,e}}ii.prototype.bytesPerElement=12,Rt(ii,"StructArrayLayout2i4ub1f12");class bi extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,o,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,t,o,l)}emplace(e,t,o,l,h){const f=4*e;return this.float32[f+0]=t,this.float32[f+1]=o,this.float32[f+2]=l,this.float32[f+3]=h,e}}bi.prototype.bytesPerElement=16,Rt(bi,"StructArrayLayout4f16");class Ut extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,o,l,h,f,m,v,b,S){const M=this.length;return this.resize(M+1),this.emplace(M,e,t,o,l,h,f,m,v,b,S)}emplace(e,t,o,l,h,f,m,v,b,S,M){const I=10*e;return this.uint16[I+0]=t,this.uint16[I+1]=o,this.uint16[I+2]=l,this.uint16[I+3]=h,this.uint16[I+4]=f,this.uint16[I+5]=m,this.uint16[I+6]=v,this.uint16[I+7]=b,this.uint16[I+8]=S,this.uint16[I+9]=M,e}}Ut.prototype.bytesPerElement=20,Rt(Ut,"StructArrayLayout10ui20");class ai extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,o,l,h,f,m,v){const b=this.length;return this.resize(b+1),this.emplace(b,e,t,o,l,h,f,m,v)}emplace(e,t,o,l,h,f,m,v,b){const S=8*e;return this.uint16[S+0]=t,this.uint16[S+1]=o,this.uint16[S+2]=l,this.uint16[S+3]=h,this.uint16[S+4]=f,this.uint16[S+5]=m,this.uint16[S+6]=v,this.uint16[S+7]=b,e}}ai.prototype.bytesPerElement=16,Rt(ai,"StructArrayLayout8ui16");class Ii extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,o,l,h,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,t,o,l,h,f)}emplace(e,t,o,l,h,f,m){const v=6*e;return this.int16[v+0]=t,this.int16[v+1]=o,this.int16[v+2]=l,this.int16[v+3]=h,this.int16[v+4]=f,this.int16[v+5]=m,e}}Ii.prototype.bytesPerElement=12,Rt(Ii,"StructArrayLayout6i12");class en extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,o,l,h,f,m,v,b,S,M,I){const P=this.length;return this.resize(P+1),this.emplace(P,e,t,o,l,h,f,m,v,b,S,M,I)}emplace(e,t,o,l,h,f,m,v,b,S,M,I,P){const L=12*e;return this.int16[L+0]=t,this.int16[L+1]=o,this.int16[L+2]=l,this.int16[L+3]=h,this.uint16[L+4]=f,this.uint16[L+5]=m,this.uint16[L+6]=v,this.uint16[L+7]=b,this.int16[L+8]=S,this.int16[L+9]=M,this.int16[L+10]=I,this.int16[L+11]=P,e}}en.prototype.bytesPerElement=24,Rt(en,"StructArrayLayout4i4ui4i24");class dn extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,o,l,h,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,t,o,l,h,f)}emplace(e,t,o,l,h,f,m){const v=10*e,b=5*e;return this.int16[v+0]=t,this.int16[v+1]=o,this.int16[v+2]=l,this.float32[b+2]=h,this.float32[b+3]=f,this.float32[b+4]=m,e}}dn.prototype.bytesPerElement=20,Rt(dn,"StructArrayLayout3i3f20");class qi extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}qi.prototype.bytesPerElement=4,Rt(qi,"StructArrayLayout1ul4");class Fn extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,o,l,h,f,m,v,b,S,M,I,P){const L=this.length;return this.resize(L+1),this.emplace(L,e,t,o,l,h,f,m,v,b,S,M,I,P)}emplace(e,t,o,l,h,f,m,v,b,S,M,I,P,L){const U=20*e,$=10*e;return this.int16[U+0]=t,this.int16[U+1]=o,this.int16[U+2]=l,this.int16[U+3]=h,this.int16[U+4]=f,this.float32[$+3]=m,this.float32[$+4]=v,this.float32[$+5]=b,this.float32[$+6]=S,this.int16[U+14]=M,this.uint32[$+8]=I,this.uint16[U+18]=P,this.uint16[U+19]=L,e}}Fn.prototype.bytesPerElement=40,Rt(Fn,"StructArrayLayout5i4f1i1ul2ui40");class Vr extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,o,l,h,f,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,t,o,l,h,f,m)}emplace(e,t,o,l,h,f,m,v){const b=8*e;return this.int16[b+0]=t,this.int16[b+1]=o,this.int16[b+2]=l,this.int16[b+4]=h,this.int16[b+5]=f,this.int16[b+6]=m,this.int16[b+7]=v,e}}Vr.prototype.bytesPerElement=16,Rt(Vr,"StructArrayLayout3i2i2i16");class ao extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,o,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,t,o,l,h)}emplace(e,t,o,l,h,f){const m=4*e,v=8*e;return this.float32[m+0]=t,this.float32[m+1]=o,this.float32[m+2]=l,this.int16[v+6]=h,this.int16[v+7]=f,e}}ao.prototype.bytesPerElement=16,Rt(ao,"StructArrayLayout2f1f2i16");class tn extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,o,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,t,o,l)}emplace(e,t,o,l,h){const f=12*e,m=3*e;return this.uint8[f+0]=t,this.uint8[f+1]=o,this.float32[m+1]=l,this.float32[m+2]=h,e}}tn.prototype.bytesPerElement=12,Rt(tn,"StructArrayLayout2ub2f12");class rn extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,t,o)}emplace(e,t,o,l){const h=3*e;return this.float32[h+0]=t,this.float32[h+1]=o,this.float32[h+2]=l,e}}rn.prototype.bytesPerElement=12,Rt(rn,"StructArrayLayout3f12");class _i extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,t,o)}emplace(e,t,o,l){const h=3*e;return this.uint16[h+0]=t,this.uint16[h+1]=o,this.uint16[h+2]=l,e}}_i.prototype.bytesPerElement=6,Rt(_i,"StructArrayLayout3ui6");class En extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,o,l,h,f,m,v,b,S,M,I,P,L,U,$,ee,se,ie,re,_e){const ce=this.length;return this.resize(ce+1),this.emplace(ce,e,t,o,l,h,f,m,v,b,S,M,I,P,L,U,$,ee,se,ie,re,_e)}emplace(e,t,o,l,h,f,m,v,b,S,M,I,P,L,U,$,ee,se,ie,re,_e,ce){const Ve=30*e,Oe=15*e,We=60*e;return this.int16[Ve+0]=t,this.int16[Ve+1]=o,this.int16[Ve+2]=l,this.float32[Oe+2]=h,this.float32[Oe+3]=f,this.uint16[Ve+8]=m,this.uint16[Ve+9]=v,this.uint32[Oe+5]=b,this.uint32[Oe+6]=S,this.uint32[Oe+7]=M,this.uint16[Ve+16]=I,this.uint16[Ve+17]=P,this.uint16[Ve+18]=L,this.float32[Oe+10]=U,this.float32[Oe+11]=$,this.uint8[We+48]=ee,this.uint8[We+49]=se,this.uint8[We+50]=ie,this.uint32[Oe+13]=re,this.int16[Ve+28]=_e,this.uint8[We+58]=ce,e}}En.prototype.bytesPerElement=60,Rt(En,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Zn extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,o,l,h,f,m,v,b,S,M,I,P,L,U,$,ee,se,ie,re,_e,ce,Ve,Oe,We,yt,je,et,at,tt){const ft=this.length;return this.resize(ft+1),this.emplace(ft,e,t,o,l,h,f,m,v,b,S,M,I,P,L,U,$,ee,se,ie,re,_e,ce,Ve,Oe,We,yt,je,et,at,tt)}emplace(e,t,o,l,h,f,m,v,b,S,M,I,P,L,U,$,ee,se,ie,re,_e,ce,Ve,Oe,We,yt,je,et,at,tt,ft){const lt=38*e,kt=19*e;return this.int16[lt+0]=t,this.int16[lt+1]=o,this.int16[lt+2]=l,this.float32[kt+2]=h,this.float32[kt+3]=f,this.int16[lt+8]=m,this.int16[lt+9]=v,this.int16[lt+10]=b,this.int16[lt+11]=S,this.int16[lt+12]=M,this.int16[lt+13]=I,this.uint16[lt+14]=P,this.uint16[lt+15]=L,this.uint16[lt+16]=U,this.uint16[lt+17]=$,this.uint16[lt+18]=ee,this.uint16[lt+19]=se,this.uint16[lt+20]=ie,this.uint16[lt+21]=re,this.uint16[lt+22]=_e,this.uint16[lt+23]=ce,this.uint16[lt+24]=Ve,this.uint16[lt+25]=Oe,this.uint16[lt+26]=We,this.uint16[lt+27]=yt,this.uint16[lt+28]=je,this.uint32[kt+15]=et,this.float32[kt+16]=at,this.float32[kt+17]=tt,this.float32[kt+18]=ft,e}}Zn.prototype.bytesPerElement=76,Rt(Zn,"StructArrayLayout3i2f6i15ui1ul3f76");class Xi extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}Xi.prototype.bytesPerElement=4,Rt(Xi,"StructArrayLayout1f4");class Wn extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,o,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,t,o,l,h)}emplace(e,t,o,l,h,f){const m=5*e;return this.float32[m+0]=t,this.float32[m+1]=o,this.float32[m+2]=l,this.float32[m+3]=h,this.float32[m+4]=f,e}}Wn.prototype.bytesPerElement=20,Rt(Wn,"StructArrayLayout5f20");class is extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,o,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,t,o,l)}emplace(e,t,o,l,h){const f=6*e;return this.uint32[3*e+0]=t,this.uint16[f+2]=o,this.uint16[f+3]=l,this.uint16[f+4]=h,e}}is.prototype.bytesPerElement=12,Rt(is,"StructArrayLayout1ul3ui12");class er extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const o=this.length;return this.resize(o+1),this.emplace(o,e,t)}emplace(e,t,o){const l=2*e;return this.uint16[l+0]=t,this.uint16[l+1]=o,e}}er.prototype.bytesPerElement=4,Rt(er,"StructArrayLayout2ui4");class ns extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}ns.prototype.bytesPerElement=2,Rt(ns,"StructArrayLayout1ui2");class rs extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const o=this.length;return this.resize(o+1),this.emplace(o,e,t)}emplace(e,t,o){const l=2*e;return this.float32[l+0]=t,this.float32[l+1]=o,e}}rs.prototype.bytesPerElement=8,Rt(rs,"StructArrayLayout2f8");class os extends qe{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}os.prototype.size=12;class tr extends Ii{get(e){return new os(this,e)}}Rt(tr,"FillExtrusionExtArray");class ss extends qe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ss.prototype.size=40;class Bo extends Fn{get(e){return new ss(this,e)}}Rt(Bo,"CollisionBoxArray");class $a extends qe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}$a.prototype.size=60;class Vg extends En{get(e){return new $a(this,e)}}Rt(Vg,"PlacedSymbolArray");class Ug extends qe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Ug.prototype.size=76;class Ng extends Zn{get(e){return new Ug(this,e)}}Rt(Ng,"SymbolInstanceArray");class jg extends Xi{getoffsetX(e){return this.float32[1*e+0]}}Rt(jg,"GlyphOffsetArray");class qg extends Vt{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Rt(qg,"SymbolLineVertexArray");class $g extends qe{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}$g.prototype.size=12;class Gg extends is{get(e){return new $g(this,e)}}Rt(Gg,"FeatureIndexArray");class Zg extends qe{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Zg.prototype.size=4;class Wg extends er{get(e){return new Zg(this,e)}}Rt(Wg,"FillExtrusionCentroidArray");class Hg extends qe{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Hg.prototype.size=12;class Xg extends Ii{get(e){return new Hg(this,e)}}Rt(Xg,"CircleGlobeExtArray");const xw=it([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),bw=it([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Kg=$c(function(i){i.exports=function(e,t){var o,l,h,f,m,v,b,S;for(l=e.length-(o=3&e.length),h=t,m=3432918353,v=461845907,S=0;S<l;)b=255&e.charCodeAt(S)|(255&e.charCodeAt(++S))<<8|(255&e.charCodeAt(++S))<<16|(255&e.charCodeAt(++S))<<24,++S,h=27492+(65535&(f=5*(65535&(h=(h^=b=(65535&(b=(b=(65535&b)*m+(((b>>>16)*m&65535)<<16)&4294967295)<<15|b>>>17))*v+(((b>>>16)*v&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(b=0,o){case 3:b^=(255&e.charCodeAt(S+2))<<16;case 2:b^=(255&e.charCodeAt(S+1))<<8;case 1:h^=b=(65535&(b=(b=(65535&(b^=255&e.charCodeAt(S)))*m+(((b>>>16)*m&65535)<<16)&4294967295)<<15|b>>>17))*v+(((b>>>16)*v&65535)<<16)&4294967295}return h^=e.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0}}),ww=$c(function(i){i.exports=function(e,t){for(var o,l=e.length,h=t^l,f=0;l>=4;)o=1540483477*(65535&(o=255&e.charCodeAt(f)|(255&e.charCodeAt(++f))<<8|(255&e.charCodeAt(++f))<<16|(255&e.charCodeAt(++f))<<24))+((1540483477*(o>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),l-=4,++f;switch(l){case 3:h^=(255&e.charCodeAt(f+2))<<16;case 2:h^=(255&e.charCodeAt(f+1))<<8;case 1:h=1540483477*(65535&(h^=255&e.charCodeAt(f)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0}}),Nu=Kg,Tw=ww;Nu.murmur3=Kg,Nu.murmur2=Tw;class Nd{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,o,l){this.ids.push(Yg(e)),this.positions.push(t,o,l)}getPositions(e){const t=Yg(e);let o=0,l=this.ids.length-1;for(;o<l;){const f=o+l>>1;this.ids[f]>=t?l=f:o=f+1}const h=[];for(;this.ids[o]===t;)h.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return h}static serialize(e,t){const o=new Float64Array(e.ids),l=new Uint32Array(e.positions);return Jp(o,l,0,o.length-1),t&&t.push(o.buffer,l.buffer),{ids:o,positions:l}}static deserialize(e){const t=new Nd;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function Yg(i){const e=+i;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Nu(String(i))}function Jp(i,e,t,o){for(;t<o;){const l=i[t+o>>1];let h=t-1,f=o+1;for(;;){do h++;while(i[h]<l);do f--;while(i[f]>l);if(h>=f)break;jd(i,h,f),jd(e,3*h,3*f),jd(e,3*h+1,3*f+1),jd(e,3*h+2,3*f+2)}f-t<o-f?(Jp(i,e,t,f),t=f+1):(Jp(i,e,f+1,o),o=f)}}function jd(i,e,t){const o=i[e];i[e]=i[t],i[t]=o}Rt(Nd,"FeaturePositionMap");class as{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}}class qd extends as{constructor(e){super(e),this.current=0}set(e,t,o){this.fetchUniformLocation(e,t)&&this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class Jg extends as{constructor(e){super(e),this.current=[0,0,0,0]}set(e,t,o){this.fetchUniformLocation(e,t)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3])))}}class Qg extends as{constructor(e){super(e),this.current=ji.transparent}set(e,t,o){this.fetchUniformLocation(e,t)&&(o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a)))}}const Ew=new Float32Array(16),Sw=new Float32Array(9),Cw=new Float32Array(4);function Qp(i){return[rt(255*i.r,255*i.g),rt(255*i.b,255*i.a)]}class ju{constructor(e,t,o){this.value=e,this.uniformNames=t.map(l=>`u_${l}`),this.type=o}setUniform(e,t,o,l,h){t.set(e,h,l.constantOr(this.value))}getBinding(e,t){return this.type==="color"?new Qg(e):new qd(e)}}class Yl{constructor(e,t){this.uniformNames=t.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,t){this.pixelRatioFrom=t.pixelRatio||1,this.pixelRatioTo=e.pixelRatio||1,this.patternFrom=t.tl.concat(t.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,t,o,l,h){const f=h==="u_pattern_to"||h==="u_dash_to"?this.patternTo:h==="u_pattern_from"||h==="u_dash_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;f&&t.set(e,h,f)}getBinding(e,t){return t==="u_pattern_from"||t==="u_pattern_to"||t==="u_dash_from"||t==="u_dash_to"?new Jg(e):new qd(e)}}class ls{constructor(e,t,o,l){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=t.map(h=>({name:`a_${h}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(e,t,o,l,h,f){const m=this.paintVertexArray.length,v=this.expression.evaluate(new H(0),t,{},h,l,f);this.paintVertexArray.resize(e),this._setPaintValue(m,e,v)}updatePaintArray(e,t,o,l,h){const f=this.expression.evaluate({zoom:0},o,l,void 0,h);this._setPaintValue(e,t,f)}_setPaintValue(e,t,o){if(this.type==="color"){const l=Qp(o);for(let h=e;h<t;h++)this.paintVertexArray.emplace(h,l[0],l[1])}else{for(let l=e;l<t;l++)this.paintVertexArray.emplace(l,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class lo{constructor(e,t,o,l,h,f){this.expression=e,this.uniformNames=t.map(m=>`u_${m}_t`),this.type=o,this.useIntegerZoom=l,this.zoom=h,this.maxValue=0,this.paintVertexAttributes=t.map(m=>({name:`a_${m}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,t,o,l,h,f){const m=this.expression.evaluate(new H(this.zoom),t,{},h,l,f),v=this.expression.evaluate(new H(this.zoom+1),t,{},h,l,f),b=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(b,e,m,v)}updatePaintArray(e,t,o,l,h){const f=this.expression.evaluate({zoom:this.zoom},o,l,void 0,h),m=this.expression.evaluate({zoom:this.zoom+1},o,l,void 0,h);this._setPaintValue(e,t,f,m)}_setPaintValue(e,t,o,l){if(this.type==="color"){const h=Qp(o),f=Qp(l);for(let m=e;m<t;m++)this.paintVertexArray.emplace(m,h[0],h[1],f[0],f[1])}else{for(let h=e;h<t;h++)this.paintVertexArray.emplace(h,o,l);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t,o,l,h){const f=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,m=Se(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);t.set(e,h,m)}getBinding(e,t){return new qd(e)}}class js{constructor(e,t,o,l,h,f,m){this.expression=e,this.type=o,this.useIntegerZoom=l,this.zoom=h,this.layerId=m,this.paintVertexAttributes=(o==="array"?bw:xw).members;for(let v=0;v<t.length;++v);this.zoomInPaintVertexArray=new f,this.zoomOutPaintVertexArray=new f}populatePaintArray(e,t,o){const l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(l,e,t.patterns&&t.patterns[this.layerId],o)}updatePaintArray(e,t,o,l,h,f){this._setPaintValues(e,t,o.patterns&&o.patterns[this.layerId],f)}_setPaintValues(e,t,o,l){if(!l||!o)return;const{min:h,mid:f,max:m}=o,v=l[h],b=l[f],S=l[m];if(v&&b&&S)for(let M=e;M<t;M++)this._setPaintValue(this.zoomInPaintVertexArray,M,b,v),this._setPaintValue(this.zoomOutPaintVertexArray,M,b,S)}_setPaintValue(e,t,o,l){e.emplace(t,o.tl[0],o.tl[1],o.br[0],o.br[1],l.tl[0],l.tl[1],l.br[0],l.br[1],o.pixelRatio,l.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class qs{constructor(e,t,o=()=>!0){this.binders={},this._buffers=[];const l=[];for(const h in e.paint._values){if(!o(h))continue;const f=e.paint.get(h);if(!(f instanceof oe&&Ds(f.property.specification)))continue;const m=Mw(h,e.type),v=f.value,b=f.property.specification.type,S=f.property.useIntegerZoom,M=f.property.specification["property-type"],I=M==="cross-faded"||M==="cross-faded-data-driven",P=String(h)==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(v.kind!=="constant"||P)if(v.kind==="source"||P||I){const L=ey(h,b,"source");this.binders[h]=I?new js(v,m,b,S,t,L,e.id):new ls(v,m,b,L),l.push(`/a_${h}`)}else{const L=ey(h,b,"composite");this.binders[h]=new lo(v,m,b,S,t,L),l.push(`/z_${h}`)}else this.binders[h]=I?new Yl(v.value,m):new ju(v.value,m,b),l.push(`/u_${h}`)}this.cacheKey=l.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof ls||t instanceof lo?t.maxValue:0}populatePaintArrays(e,t,o,l,h,f){for(const m in this.binders){const v=this.binders[m];(v instanceof ls||v instanceof lo||v instanceof js)&&v.populatePaintArray(e,t,o,l,h,f)}}setConstantPatternPositions(e,t){for(const o in this.binders){const l=this.binders[o];l instanceof Yl&&l.setConstantPatternPositions(e,t)}}updatePaintArrays(e,t,o,l,h,f){let m=!1;for(const v in e){const b=t.getPositions(v);for(const S of b){const M=o.feature(S.index);for(const I in this.binders){const P=this.binders[I];if((P instanceof ls||P instanceof lo||P instanceof js)&&P.expression.isStateDependent===!0){const L=l.paint.get(I);P.expression=L.value,P.updatePaintArray(S.start,S.end,M,e[v],h,f),m=!0}}}}return m}defines(){const e=[];for(const t in this.binders){const o=this.binders[t];(o instanceof ju||o instanceof Yl)&&e.push(...o.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const o=this.binders[t];if(o instanceof ls||o instanceof lo||o instanceof js)for(let l=0;l<o.paintVertexAttributes.length;l++)e.push(o.paintVertexAttributes[l].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const o=this.binders[t];if(o instanceof ju||o instanceof Yl||o instanceof lo)for(const l of o.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const t=[];for(const o in this.binders){const l=this.binders[o];if(l instanceof ju||l instanceof Yl||l instanceof lo)for(const h of l.uniformNames)t.push({name:h,property:o,binding:l.getBinding(e,h)})}return t}setUniforms(e,t,o,l,h){for(const{name:f,property:m,binding:v}of o)this.binders[m].setUniform(e,v,h,l.get(m),f)}updatePaintBuffers(e){this._buffers=[];for(const t in this.binders){const o=this.binders[t];if(e&&o instanceof js){const l=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(o instanceof ls||o instanceof lo)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const t in this.binders){const o=this.binders[t];(o instanceof ls||o instanceof lo||o instanceof js)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof ls||t instanceof lo||t instanceof js)&&t.destroy()}}}class Ga{constructor(e,t,o=()=>!0){this.programConfigurations={};for(const l of e)this.programConfigurations[l.id]=new qs(l,t,o);this.needsUpload=!1,this._featureMap=new Nd,this._bufferOffset=0}populatePaintArrays(e,t,o,l,h,f,m){for(const v in this.programConfigurations)this.programConfigurations[v].populatePaintArrays(e,t,l,h,f,m);t.id!==void 0&&this._featureMap.add(t.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,o,l,h){for(const f of o)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(e,this._featureMap,t,f,l,h)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Aw={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function Mw(i,e){return Aw[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}const Iw={"line-pattern":{source:Ut,composite:Ut},"fill-pattern":{source:Ut,composite:Ut},"fill-extrusion-pattern":{source:Ut,composite:Ut},"line-dasharray":{source:ai,composite:ai}},kw={color:{source:rs,composite:bi},number:{source:Xi,composite:rs}};function ey(i,e,t){const o=Iw[i];return o&&o[t]||kw[e][t]}Rt(ju,"ConstantBinder"),Rt(Yl,"CrossFadedConstantBinder"),Rt(ls,"SourceExpressionBinder"),Rt(js,"CrossFadedCompositeBinder"),Rt(lo,"CompositeExpressionBinder"),Rt(qs,"ProgramConfiguration",{omit:["_buffers"]}),Rt(Ga,"ProgramConfigurationSet");const $d="-transition";class co extends Ze{constructor(e,t){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),t.layout&&(this._unevaluatedLayout=new fe(t.layout)),t.paint)){this._transitionablePaint=new te(t.paint);for(const o in e.paint)this.setPaintProperty(o,e.paint[o],{validate:!1});for(const o in e.layout)this.setLayoutProperty(o,e.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new pe(t.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,o={}){t!=null&&this._validate(Sd,`layers.${this.id}.layout.${e}`,e,t,o)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}getPaintProperty(e){return ot(e,$d)?this._transitionablePaint.getTransition(e.slice(0,-$d.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,o={}){if(t!=null&&this._validate(Gl,`layers.${this.id}.paint.${e}`,e,t,o))return!1;if(ot(e,$d))return this._transitionablePaint.setTransition(e.slice(0,-$d.length),t||void 0),!1;{const l=this._transitionablePaint._values[e],h=l.property.specification["property-type"]==="cross-faded-data-driven",f=l.value.isDataDriven(),m=l.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);const v=this._transitionablePaint._values[e].value;return v.isDataDriven()||f||h||this._handleOverridablePaintPropertyUpdate(e,m,v)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,t,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),di(e,(t,o)=>!(t===void 0||o==="layout"&&!Object.keys(t).length||o==="paint"&&!Object.keys(t).length))}_validate(e,t,o,l,h={}){return(!h||h.validate!==!1)&&zu(this,e.call($l,{key:t,layerType:this.type,objectKey:o,value:l,styleSpec:Me,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof oe&&Ds(t.property.specification)&&(t.value.kind==="source"||t.value.kind==="composite")&&t.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Ra(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const zw=it([{name:"a_pos",components:2,type:"Int16"}],4),Pw=it([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class In{constructor(e=[]){this.segments=e}prepareSegment(e,t,o,l){let h=this.segments[this.segments.length-1];return e>In.MAX_VERTEX_ARRAY_LENGTH&&xt(`Max vertices per segment is ${In.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!h||h.vertexLength+e>In.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==l)&&(h={vertexOffset:t.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},l!==void 0&&(h.sortKey=l),this.segments.push(h)),h}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,o,l){return new In([{vertexOffset:e,primitiveOffset:t,vertexLength:o,primitiveLength:l,vaos:{},sortKey:0}])}}In.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Rt(In,"SegmentVector");var ei=8192;class $s{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Ui?new Ui(e.lng,e.lat):Ui.convert(e),this}setSouthWest(e){return this._sw=e instanceof Ui?new Ui(e.lng,e.lat):Ui.convert(e),this}extend(e){const t=this._sw,o=this._ne;let l,h;if(e instanceof Ui)l=e,h=e;else{if(!(e instanceof $s))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend($s.convert(e)):this.extend(Ui.convert(e)):this;if(l=e._sw,h=e._ne,!l||!h)return this}return t||o?(t.lng=Math.min(l.lng,t.lng),t.lat=Math.min(l.lat,t.lat),o.lng=Math.max(h.lng,o.lng),o.lat=Math.max(h.lat,o.lat)):(this._sw=new Ui(l.lng,l.lat),this._ne=new Ui(h.lng,h.lat)),this}getCenter(){return new Ui((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ui(this.getWest(),this.getNorth())}getSouthEast(){return new Ui(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:o}=Ui.convert(e);let l=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&l}static convert(e){return!e||e instanceof $s?e:new $s(e)}}const em=63710088e-1;class Ui{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ui(we(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,o=this.lat*t,l=e.lat*t,h=Math.sin(o)*Math.sin(l)+Math.cos(o)*Math.cos(l)*Math.cos((e.lng-this.lng)*t);return em*Math.acos(Math.min(h,1))}toBounds(e=0){const t=360*e/40075017,o=t/Math.cos(Math.PI/180*this.lat);return new $s(new Ui(this.lng-o,this.lat-t),new Ui(this.lng+o,this.lat+t))}static convert(e){if(e instanceof Ui)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Ui(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Ui(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const ty=2*Math.PI*em;function tm(i){return ty*Math.cos(i*Math.PI/180)}function Ro(i){return(180+i)/360}function cs(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Gr(i,e){return i/tm(e)}function Zr(i){return 360*i-180}function Hn(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function iy(i,e){return i*tm(Hn(e))}const Oo=85.051129;function ny(i){return 1/Math.cos(i*Math.PI/180)}class Jl{constructor(e,t,o=0){this.x=+e,this.y=+t,this.z=+o}static fromLngLat(e,t=0){const o=Ui.convert(e);return new Jl(Ro(o.lng),cs(o.lat),Gr(t,o.lat))}toLngLat(){return new Ui(Zr(this.x),Hn(this.y))}toAltitude(){return iy(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ty*ny(Hn(this.y))}}function im(i,e,t,o,l,h,f,m,v){const b=(e+o)/2,S=(t+l)/2,M=new N(b,S);m(M),function(I,P,L,U,$,ee){const se=L-$,ie=U-ee;return Math.abs((U-P)*se-(L-I)*ie)/Math.hypot(se,ie)}(M.x,M.y,h.x,h.y,f.x,f.y)>=v?(im(i,e,t,b,S,h,M,m,v),im(i,b,S,o,l,M,f,m,v)):i.push(f)}function ry(i,e,t){let o=i[0],l=o.x,h=o.y;e(o);const f=[o];for(let m=1;m<i.length;m++){const v=i[m],{x:b,y:S}=v;e(v),im(f,l,h,b,S,o,v,e,t),l=b,h=S,o=v}return f}function nm(i,e,t,o,l){if(l(e,t)){const h=e.add(t).mult(.5);o(h),nm(i,e,h,o,l),nm(i,h,t,o,l)}else i.push(t)}function Dw(i,e,t){let o=i[0];e(o);const l=[o];for(let h=1;h<i.length;h++){const f=i[h];e(f),nm(l,o,f,e,t),o=f}return l}const rm=Math.pow(2,14)-1,oy=-rm-1;function Lw(i,e){const t=Math.round(i.x*e),o=Math.round(i.y*e);return i.x=Se(t,oy,rm),i.y=Se(o,oy,rm),(t<i.x||t>i.x+1||o<i.y||o>i.y+1)&&xt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function us(i,e,t){const o=i.loadGeometry(),l=i.extent,h=ei/l;if(e&&t&&t.projection.isReprojectedInTileSpace){const f=1<<e.z,{scale:m,x:v,y:b,projection:S}=t,M=I=>{const P=Zr((e.x+I.x/l)/f),L=Hn((e.y+I.y/l)/f),U=S.project(P,L);I.x=(U.x*m-v)*l,I.y=(U.y*m-b)*l};for(let I=0;I<o.length;I++)if(i.type!==1)o[I]=ry(o[I],M,1);else{const P=[];for(const L of o[I])L.x<0||L.x>=l||L.y<0||L.y>=l||(M(L),P.push(L));o[I]=P}}for(const f of o)for(const m of f)Lw(m,h);return o}function Za(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?us(i):[]}}function Gd(i,e,t,o,l){i.emplaceBack(2*e+(o+1)/2,2*t+(l+1)/2)}function Zd(i,e,t){i.emplaceBack(e.x,e.y,e.z,t[0]*16384,t[1]*16384,t[2]*16384)}class om{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new St,this.indexArray=new _i,this.segments=new In,this.programConfigurations=new Ga(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(e,t,o,l){const h=this.layers[0],f=[];let m=null;h.type==="circle"&&(m=h.layout.get("circle-sort-key"));for(const{feature:b,id:S,index:M,sourceLayerIndex:I}of e){const P=this.layers[0]._featureFilter.needGeometry,L=Za(b,P);if(!this.layers[0]._featureFilter.filter(new H(this.zoom),L,o))continue;const U=m?m.evaluate(L,{},o):void 0,$={id:S,properties:b.properties,type:b.type,sourceLayerIndex:I,index:M,geometry:P?L.geometry:us(b,o,l),patterns:{},sortKey:U};f.push($)}m&&f.sort((b,S)=>b.sortKey-S.sortKey);let v=null;l.projection.name==="globe"&&(this.globeExtVertexArray=new Xg,v=l.projection);for(const b of f){const{geometry:S,index:M,sourceLayerIndex:I}=b,P=e[M].feature;this.addFeature(b,S,M,t.availableImages,o,v),t.featureIndex.insert(P,S,M,I,this.index)}}update(e,t,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,o,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,zw.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Pw.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,t,o,l,h,f){for(const m of t)for(const v of m){const b=v.x,S=v.y;if(b<0||b>=ei||S<0||S>=ei)continue;if(f){const P=f.projectTilePoint(b,S,h),L=f.upVector(h,b,S),U=this.globeExtVertexArray;Zd(U,P,L),Zd(U,P,L),Zd(U,P,L),Zd(U,P,L)}const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),I=M.vertexLength;Gd(this.layoutVertexArray,b,S,-1,-1),Gd(this.layoutVertexArray,b,S,1,-1),Gd(this.layoutVertexArray,b,S,1,1),Gd(this.layoutVertexArray,b,S,-1,1),this.indexArray.emplaceBack(I,I+1,I+2),this.indexArray.emplaceBack(I,I+2,I+3),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},l,h)}}function sy(i,e){for(let t=0;t<i.length;t++)if(Wa(e,i[t]))return!0;for(let t=0;t<e.length;t++)if(Wa(i,e[t]))return!0;return!!sm(i,e)}function Bw(i,e,t){return!!Wa(i,e)||!!am(e,i,t)}function ay(i,e){if(i.length===1)return cy(e,i[0]);for(let t=0;t<e.length;t++){const o=e[t];for(let l=0;l<o.length;l++)if(Wa(i,o[l]))return!0}for(let t=0;t<i.length;t++)if(cy(e,i[t]))return!0;for(let t=0;t<e.length;t++)if(sm(i,e[t]))return!0;return!1}function Rw(i,e,t){if(i.length>1){if(sm(i,e))return!0;for(let o=0;o<e.length;o++)if(am(e[o],i,t))return!0}for(let o=0;o<i.length;o++)if(am(i[o],e,t))return!0;return!1}function sm(i,e){if(i.length===0||e.length===0)return!1;for(let t=0;t<i.length-1;t++){const o=i[t],l=i[t+1];for(let h=0;h<e.length-1;h++)if(Ow(o,l,e[h],e[h+1]))return!0}return!1}function Ow(i,e,t,o){return Bt(i,t,o)!==Bt(e,t,o)&&Bt(i,e,t)!==Bt(i,e,o)}function am(i,e,t){const o=t*t;if(e.length===1)return i.distSqr(e[0])<o;for(let l=1;l<e.length;l++)if(ly(i,e[l-1],e[l])<o)return!0;return!1}function ly(i,e,t){const o=e.distSqr(t);if(o===0)return i.distSqr(e);const l=((i.x-e.x)*(t.x-e.x)+(i.y-e.y)*(t.y-e.y))/o;return i.distSqr(l<0?e:l>1?t:t.sub(e)._mult(l)._add(e))}function cy(i,e){let t,o,l,h=!1;for(let f=0;f<i.length;f++){t=i[f];for(let m=0,v=t.length-1;m<t.length;v=m++)o=t[m],l=t[v],o.y>e.y!=l.y>e.y&&e.x<(l.x-o.x)*(e.y-o.y)/(l.y-o.y)+o.x&&(h=!h)}return h}function Wa(i,e){let t=!1;for(let o=0,l=i.length-1;o<i.length;l=o++){const h=i[o],f=i[l];h.y>e.y!=f.y>e.y&&e.x<(f.x-h.x)*(e.y-h.y)/(f.y-h.y)+h.x&&(t=!t)}return t}function uy(i,e,t,o,l){for(const f of i)if(e<=f.x&&t<=f.y&&o>=f.x&&l>=f.y)return!0;const h=[new N(e,t),new N(e,l),new N(o,l),new N(o,t)];if(i.length>2){for(const f of h)if(Wa(i,f))return!0}for(let f=0;f<i.length-1;f++)if(Fw(i[f],i[f+1],h))return!0;return!1}function Fw(i,e,t){const o=t[0],l=t[2];if(i.x<o.x&&e.x<o.x||i.x>l.x&&e.x>l.x||i.y<o.y&&e.y<o.y||i.y>l.y&&e.y>l.y)return!1;const h=Bt(i,e,t[0]);return h!==Bt(i,e,t[1])||h!==Bt(i,e,t[2])||h!==Bt(i,e,t[3])}function Ql(i,e,t){const o=e.paint.get(i).value;return o.kind==="constant"?o.value:t.programConfigurations.get(e.id).getMaxValue(i)}function Wd(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function hy(i,e,t,o,l){if(!e[0]&&!e[1])return i;const h=N.convert(e)._mult(l);t==="viewport"&&h._rotate(-o);const f=[];for(let m=0;m<i.length;m++)f.push(i[m].sub(h));return f}function dy(i,e,t,o){const l=N.convert(i)._mult(o);return e==="viewport"&&l._rotate(-t),l}Rt(om,"CircleBucket",{omit:["layers"]});const Vw=new Je({"circle-sort-key":new be(Me.layout_circle["circle-sort-key"])});var Uw={paint:new Je({"circle-radius":new be(Me.paint_circle["circle-radius"]),"circle-color":new be(Me.paint_circle["circle-color"]),"circle-blur":new be(Me.paint_circle["circle-blur"]),"circle-opacity":new be(Me.paint_circle["circle-opacity"]),"circle-translate":new ue(Me.paint_circle["circle-translate"]),"circle-translate-anchor":new ue(Me.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ue(Me.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ue(Me.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new be(Me.paint_circle["circle-stroke-width"]),"circle-stroke-color":new be(Me.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new be(Me.paint_circle["circle-stroke-opacity"])}),layout:Vw},Hd=1e-6,Mr=typeof Float32Array<"u"?Float32Array:Array;function fy(){var i=new Mr(9);return Mr!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function Fo(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function lm(i,e){var t=e[0],o=e[1],l=e[2],h=e[3],f=e[4],m=e[5],v=e[6],b=e[7],S=e[8],M=e[9],I=e[10],P=e[11],L=e[12],U=e[13],$=e[14],ee=e[15],se=t*m-o*f,ie=t*v-l*f,re=t*b-h*f,_e=o*v-l*m,ce=o*b-h*m,Ve=l*b-h*v,Oe=S*U-M*L,We=S*$-I*L,yt=S*ee-P*L,je=M*$-I*U,et=M*ee-P*U,at=I*ee-P*$,tt=se*at-ie*et+re*je+_e*yt-ce*We+Ve*Oe;return tt?(i[0]=(m*at-v*et+b*je)*(tt=1/tt),i[1]=(l*et-o*at-h*je)*tt,i[2]=(U*Ve-$*ce+ee*_e)*tt,i[3]=(I*ce-M*Ve-P*_e)*tt,i[4]=(v*yt-f*at-b*We)*tt,i[5]=(t*at-l*yt+h*We)*tt,i[6]=($*re-L*Ve-ee*ie)*tt,i[7]=(S*Ve-I*re+P*ie)*tt,i[8]=(f*et-m*yt+b*Oe)*tt,i[9]=(o*yt-t*et-h*Oe)*tt,i[10]=(L*ce-U*re+ee*se)*tt,i[11]=(M*re-S*ce-P*se)*tt,i[12]=(m*We-f*je-v*Oe)*tt,i[13]=(t*je-o*We+l*Oe)*tt,i[14]=(U*ie-L*_e-$*se)*tt,i[15]=(S*_e-M*ie+I*se)*tt,i):null}function ec(i,e,t){var o=e[0],l=e[1],h=e[2],f=e[3],m=e[4],v=e[5],b=e[6],S=e[7],M=e[8],I=e[9],P=e[10],L=e[11],U=e[12],$=e[13],ee=e[14],se=e[15],ie=t[0],re=t[1],_e=t[2],ce=t[3];return i[0]=ie*o+re*m+_e*M+ce*U,i[1]=ie*l+re*v+_e*I+ce*$,i[2]=ie*h+re*b+_e*P+ce*ee,i[3]=ie*f+re*S+_e*L+ce*se,i[4]=(ie=t[4])*o+(re=t[5])*m+(_e=t[6])*M+(ce=t[7])*U,i[5]=ie*l+re*v+_e*I+ce*$,i[6]=ie*h+re*b+_e*P+ce*ee,i[7]=ie*f+re*S+_e*L+ce*se,i[8]=(ie=t[8])*o+(re=t[9])*m+(_e=t[10])*M+(ce=t[11])*U,i[9]=ie*l+re*v+_e*I+ce*$,i[10]=ie*h+re*b+_e*P+ce*ee,i[11]=ie*f+re*S+_e*L+ce*se,i[12]=(ie=t[12])*o+(re=t[13])*m+(_e=t[14])*M+(ce=t[15])*U,i[13]=ie*l+re*v+_e*I+ce*$,i[14]=ie*h+re*b+_e*P+ce*ee,i[15]=ie*f+re*S+_e*L+ce*se,i}function qu(i,e,t){var o,l,h,f,m,v,b,S,M,I,P,L,U=t[0],$=t[1],ee=t[2];return e===i?(i[12]=e[0]*U+e[4]*$+e[8]*ee+e[12],i[13]=e[1]*U+e[5]*$+e[9]*ee+e[13],i[14]=e[2]*U+e[6]*$+e[10]*ee+e[14],i[15]=e[3]*U+e[7]*$+e[11]*ee+e[15]):(l=e[1],h=e[2],f=e[3],m=e[4],v=e[5],b=e[6],S=e[7],M=e[8],I=e[9],P=e[10],L=e[11],i[0]=o=e[0],i[1]=l,i[2]=h,i[3]=f,i[4]=m,i[5]=v,i[6]=b,i[7]=S,i[8]=M,i[9]=I,i[10]=P,i[11]=L,i[12]=o*U+m*$+M*ee+e[12],i[13]=l*U+v*$+I*ee+e[13],i[14]=h*U+b*$+P*ee+e[14],i[15]=f*U+S*$+L*ee+e[15]),i}function Ha(i,e,t){var o=t[0],l=t[1],h=t[2];return i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i[3]=e[3]*o,i[4]=e[4]*l,i[5]=e[5]*l,i[6]=e[6]*l,i[7]=e[7]*l,i[8]=e[8]*h,i[9]=e[9]*h,i[10]=e[10]*h,i[11]=e[11]*h,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function cm(i,e,t){var o=Math.sin(t),l=Math.cos(t),h=e[4],f=e[5],m=e[6],v=e[7],b=e[8],S=e[9],M=e[10],I=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=h*l+b*o,i[5]=f*l+S*o,i[6]=m*l+M*o,i[7]=v*l+I*o,i[8]=b*l-h*o,i[9]=S*l-f*o,i[10]=M*l-m*o,i[11]=I*l-v*o,i}function Xd(i,e,t){var o=Math.sin(t),l=Math.cos(t),h=e[0],f=e[1],m=e[2],v=e[3],b=e[8],S=e[9],M=e[10],I=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=h*l-b*o,i[1]=f*l-S*o,i[2]=m*l-M*o,i[3]=v*l-I*o,i[8]=h*o+b*l,i[9]=f*o+S*l,i[10]=m*o+M*l,i[11]=v*o+I*l,i}function py(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function my(i,e,t){var o,l,h,f=t[0],m=t[1],v=t[2],b=Math.hypot(f,m,v);return b<Hd?null:(f*=b=1/b,m*=b,v*=b,o=Math.sin(e),l=Math.cos(e),i[0]=f*f*(h=1-l)+l,i[1]=m*f*h+v*o,i[2]=v*f*h-m*o,i[3]=0,i[4]=f*m*h-v*o,i[5]=m*m*h+l,i[6]=v*m*h+f*o,i[7]=0,i[8]=f*v*h+m*o,i[9]=m*v*h-f*o,i[10]=v*v*h+l,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var Nw=ec;function um(){var i=new Mr(3);return Mr!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function _y(i){var e=new Mr(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e}function $u(i){return Math.hypot(i[0],i[1],i[2])}function tc(i,e,t){var o=new Mr(3);return o[0]=i,o[1]=e,o[2]=t,o}function Gs(i,e,t){return i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i}function hm(i,e,t){return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i}function gy(i,e,t){return i[0]=e[0]*t[0],i[1]=e[1]*t[1],i[2]=e[2]*t[2],i}function dm(i,e,t){return i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.min(e[2],t[2]),i}function fm(i,e,t){return i[0]=Math.max(e[0],t[0]),i[1]=Math.max(e[1],t[1]),i[2]=Math.max(e[2],t[2]),i}function uo(i,e,t){return i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i}function Kd(i,e,t,o){return i[0]=e[0]+t[0]*o,i[1]=e[1]+t[1]*o,i[2]=e[2]+t[2]*o,i}function ur(i,e){var t=e[0],o=e[1],l=e[2],h=t*t+o*o+l*l;return h>0&&(h=1/Math.sqrt(h)),i[0]=e[0]*h,i[1]=e[1]*h,i[2]=e[2]*h,i}function Wr(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function pm(i,e,t){var o=e[0],l=e[1],h=e[2],f=t[0],m=t[1],v=t[2];return i[0]=l*v-h*m,i[1]=h*f-o*v,i[2]=o*m-l*f,i}function Dn(i,e,t){var o=e[0],l=e[1],h=e[2],f=t[3]*o+t[7]*l+t[11]*h+t[15];return i[0]=(t[0]*o+t[4]*l+t[8]*h+t[12])/(f=f||1),i[1]=(t[1]*o+t[5]*l+t[9]*h+t[13])/f,i[2]=(t[2]*o+t[6]*l+t[10]*h+t[14])/f,i}function yy(i,e,t){var o=t[0],l=t[1],h=t[2],f=e[0],m=e[1],v=e[2],b=l*v-h*m,S=h*f-o*v,M=o*m-l*f,I=l*M-h*S,P=h*b-o*M,L=o*S-l*b,U=2*t[3];return S*=U,M*=U,P*=2,L*=2,i[0]=f+(b*=U)+(I*=2),i[1]=m+S+P,i[2]=v+M+L,i}var Gu,ho=hm,jw=gy,qw=$u;function vy(i,e,t){return i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i}function Xa(i,e,t){var o=e[0],l=e[1],h=e[2],f=e[3];return i[0]=t[0]*o+t[4]*l+t[8]*h+t[12]*f,i[1]=t[1]*o+t[5]*l+t[9]*h+t[13]*f,i[2]=t[2]*o+t[6]*l+t[10]*h+t[14]*f,i[3]=t[3]*o+t[7]*l+t[11]*h+t[15]*f,i}function xy(){var i=new Mr(4);return Mr!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function by(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function wy(i,e,t){t*=.5;var o=e[0],l=e[1],h=e[2],f=e[3],m=Math.sin(t),v=Math.cos(t);return i[0]=o*v+f*m,i[1]=l*v+h*m,i[2]=h*v-l*m,i[3]=f*v-o*m,i}function Ty(i,e,t){t*=.5;var o=e[0],l=e[1],h=e[2],f=e[3],m=Math.sin(t),v=Math.cos(t);return i[0]=o*v-h*m,i[1]=l*v+f*m,i[2]=h*v+o*m,i[3]=f*v-l*m,i}um(),Gu=new Mr(4),Mr!=Float32Array&&(Gu[0]=0,Gu[1]=0,Gu[2]=0,Gu[3]=0),um(),tc(1,0,0),tc(0,1,0),xy(),xy(),fy();class mm{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,o){const l=Wr(t,this.dir);if(Math.abs(l)<1e-6)return!1;const h=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1]+(e[2]-this.pos[2])*t[2])/l;return o[0]=this.pos[0]+this.dir[0]*h,o[1]=this.pos[1]+this.dir[1]*h,o[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(e,t,o){if(function(P,L){var U=P[0],$=P[1],ee=P[2],se=L[0],ie=L[1],re=L[2];return Math.abs(U-se)<=Hd*Math.max(1,Math.abs(U),Math.abs(se))&&Math.abs($-ie)<=Hd*Math.max(1,Math.abs($),Math.abs(ie))&&Math.abs(ee-re)<=Hd*Math.max(1,Math.abs(ee),Math.abs(re))}(this.pos,e)||t===0)return o[0]=o[1]=o[2]=0,!1;const[l,h,f]=this.dir,m=this.pos[0]-e[0],v=this.pos[1]-e[1],b=this.pos[2]-e[2],S=l*l+h*h+f*f,M=2*(m*l+v*h+b*f),I=M*M-4*S*(m*m+v*v+b*b-t*t);if(I<0){const P=Math.max(-M/2,0),L=m+l*P,U=v+h*P,$=b+f*P,ee=Math.hypot(L,U,$);return o[0]=L*t/ee,o[1]=U*t/ee,o[2]=$*t/ee,!1}{const P=(-M-Math.sqrt(I))/(2*S);if(P<0){const L=Math.hypot(m,v,b);return o[0]=m*t/L,o[1]=v*t/L,o[2]=b*t/L,!1}return o[0]=m+l*P,o[1]=v+h*P,o[2]=b+f*P,!0}}}class _m{constructor(e,t,o,l,h){this.TL=e,this.TR=t,this.BR=o,this.BL=l,this.horizon=h}static fromInvProjectionMatrix(e,t,o){const l=[-1,1,1],h=[1,1,1],f=[1,-1,1],m=[-1,-1,1],v=Dn(l,l,e),b=Dn(h,h,e),S=Dn(f,f,e),M=Dn(m,m,e);return new _m(v,b,S,M,t/o)}}class gm{constructor(e,t){this.points=e,this.planes=t}static fromInvProjectionMatrix(e,t,o,l){const h=Math.pow(2,o),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(v=>{const b=Xa([],v,e),S=1/b[3]/t*h;return function(M,I,P){return M[0]=I[0]*P[0],M[1]=I[1]*P[1],M[2]=I[2]*P[2],M[3]=I[3]*P[3],M}(b,b,[S,S,l?1/b[3]:S,S])}),m=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(v=>{const b=ur([],pm([],ho([],f[v[0]],f[v[1]]),ho([],f[v[2]],f[v[1]]))),S=-Wr(b,f[v[1]]);return b.concat(S)});return new gm(f,m)}}class xr{static fromPoints(e){const t=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],o=[Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE];for(const l of e)t[0]=Math.min(t[0],l[0]),t[1]=Math.min(t[1],l[1]),t[2]=Math.min(t[2],l[2]),o[0]=Math.max(o[0],l[0]),o[1]=Math.max(o[1],l[1]),o[2]=Math.max(o[2],l[2]);return new xr(t,o)}constructor(e,t){this.min=e,this.max=t,this.center=uo([],Gs([],this.min,this.max),.5)}quadrant(e){const t=[e%2==0,e<2],o=_y(this.min),l=_y(this.max);for(let h=0;h<t.length;h++)o[h]=t[h]?this.min[h]:this.center[h],l[h]=t[h]?this.center[h]:this.max[h];return l[2]=this.max[2],new xr(o,l)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){const t=this.getCorners();let o=!0;for(let l=0;l<e.planes.length;l++){const h=e.planes[l];let f=0;for(let m=0;m<t.length;m++)f+=Wr(h,t[m])+h[3]>=0;if(f===0)return 0;f!==t.length&&(o=!1)}if(o)return 2;for(let l=0;l<3;l++){let h=Number.MAX_VALUE,f=-Number.MAX_VALUE;for(let m=0;m<e.points.length;m++){const v=e.points[m][l]-this.min[l];h=Math.min(h,v),f=Math.max(f,v)}if(f<0||h>this.max[l]-this.min[l])return 0}return 1}}function Ey(i,e,t,o,l,h,f,m,v){if(h&&i.queryGeometry.isAboveHorizon)return!1;h&&(v*=i.pixelToTileUnitsFactor);const b=i.tileID.canonical,S=t.projection.upVectorScale(b,t.center.lat,t.worldSize).metersToTile;for(const M of e)for(const I of M){const P=I.add(m),L=l&&t.elevation?t.elevation.exaggeration()*l.getElevationAt(P.x,P.y,!0):0,U=t.projection.projectTilePoint(P.x,P.y,b);if(L>0){const ie=t.projection.upVector(b,P.x,P.y);U.x+=ie[0]*S*L,U.y+=ie[1]*S*L,U.z+=ie[2]*S*L}const $=h?P:$w(U.x,U.y,U.z,o),ee=h?i.tilespaceRays.map(ie=>Zw(ie,L)):i.queryGeometry.screenGeometry,se=Xa([],[U.x,U.y,U.z,1],o);if(!f&&h?v*=se[3]/t.cameraToCenterDistance:f&&!h&&(v*=t.cameraToCenterDistance/se[3]),h){const ie=Hn((I.y/ei+b.y)/(1<<b.z));v/=t.projection.pixelsPerMeter(ie,1)/Gr(1,ie)}if(Bw(ee,$,v))return!0}return!1}function $w(i,e,t,o){const l=Xa([],[i,e,t,1],o);return new N(l[0]/l[3],l[1]/l[3])}const Sy=tc(0,0,0),Gw=tc(0,0,1);function Zw(i,e){const t=um();return Sy[2]=e,i.intersectsPlane(Sy,Gw,t),new N(t[0],t[1])}class Cy extends om{}function Ay(i,{width:e,height:t},o,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*t*o)throw new RangeError("mismatched image size")}else l=new Uint8Array(e*t*o);return i.width=e,i.height=t,i.data=l,i}function My(i,e,t){const{width:o,height:l}=e;o===i.width&&l===i.height||(ym(i,e,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,o),height:Math.min(i.height,l)},t),i.width=o,i.height=l,i.data=e.data)}function ym(i,e,t,o,l,h){if(l.width===0||l.height===0)return e;if(l.width>i.width||l.height>i.height||t.x>i.width-l.width||t.y>i.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||o.x>e.width-l.width||o.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const f=i.data,m=e.data;for(let v=0;v<l.height;v++){const b=((t.y+v)*i.width+t.x)*h,S=((o.y+v)*e.width+o.x)*h;for(let M=0;M<l.width*h;M++)m[S+M]=f[b+M]}return e}Rt(Cy,"HeatmapBucket",{omit:["layers"]});class hs{constructor(e,t){Ay(this,e,1,t)}resize(e){My(this,new hs(e),1)}clone(){return new hs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,o,l,h){ym(e,t,o,l,h,1)}}class Ir{constructor(e,t){Ay(this,e,4,t)}resize(e){My(this,new Ir(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ir({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,o,l,h){ym(e,t,o,l,h,4)}}Rt(hs,"AlphaImage"),Rt(Ir,"RGBAImage");var Ww={paint:new Je({"heatmap-radius":new be(Me.paint_heatmap["heatmap-radius"]),"heatmap-weight":new be(Me.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ue(Me.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ie(Me.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ue(Me.paint_heatmap["heatmap-opacity"])})};function vm(i){const e={},t=i.resolution||256,o=i.clips?i.clips.length:1,l=i.image||new Ir({width:t,height:o}),h=(f,m,v)=>{e[i.evaluationKey]=v;const b=i.expression.evaluate(e);l.data[f+m+0]=Math.floor(255*b.r/b.a),l.data[f+m+1]=Math.floor(255*b.g/b.a),l.data[f+m+2]=Math.floor(255*b.b/b.a),l.data[f+m+3]=Math.floor(255*b.a)};if(i.clips)for(let f=0,m=0;f<o;++f,m+=4*t)for(let v=0,b=0;v<t;v++,b+=4){const S=v/(t-1),{start:M,end:I}=i.clips[f];h(m,b,M*(1-S)+I*S)}else for(let f=0,m=0;f<t;f++,m+=4)h(0,m,f/(t-1));return l}var Hw={paint:new Je({"hillshade-illumination-direction":new ue(Me.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ue(Me.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ue(Me.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ue(Me.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ue(Me.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ue(Me.paint_hillshade["hillshade-accent-color"])})};const Xw=it([{name:"a_pos",components:2,type:"Int16"}],4),{members:Kw}=Xw;var Yd=Jd,Yw=Jd;function Jd(i,e,t){t=t||2;var o,l,h,f,m,v,b,S=e&&e.length,M=S?e[0]*t:i.length,I=Iy(i,0,M,t,!0),P=[];if(!I||I.next===I.prev)return P;if(S&&(I=function(U,$,ee,se){var ie,re,_e,ce=[];for(ie=0,re=$.length;ie<re;ie++)(_e=Iy(U,$[ie]*se,ie<re-1?$[ie+1]*se:U.length,se,!1))===_e.next&&(_e.steiner=!0),ce.push(oT(_e));for(ce.sort(iT),ie=0;ie<ce.length;ie++)ee=nT(ce[ie],ee);return ee}(i,e,I,t)),i.length>80*t){o=h=i[0],l=f=i[1];for(var L=t;L<M;L+=t)(m=i[L])<o&&(o=m),(v=i[L+1])<l&&(l=v),m>h&&(h=m),v>f&&(f=v);b=(b=Math.max(h-o,f-l))!==0?32767/b:0}return Zu(I,P,t,o,l,b,0),P}function Iy(i,e,t,o,l){var h,f;if(l===wm(i,e,t,o)>0)for(h=e;h<t;h+=o)f=Py(h,i[h],i[h+1],f);else for(h=t-o;h>=e;h-=o)f=Py(h,i[h],i[h+1],f);return f&&Qd(f,f.next)&&(Hu(f),f=f.next),f}function Ka(i,e){if(!i)return i;e||(e=i);var t,o=i;do if(t=!1,o.steiner||!Qd(o,o.next)&&Sn(o.prev,o,o.next)!==0)o=o.next;else{if(Hu(o),(o=e=o.prev)===o.next)break;t=!0}while(t||o!==e);return e}function Zu(i,e,t,o,l,h,f){if(i){!f&&h&&function(S,M,I,P){var L=S;do L.z===0&&(L.z=xm(L.x,L.y,M,I,P)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==S);L.prevZ.nextZ=null,L.prevZ=null,function(U){var $,ee,se,ie,re,_e,ce,Ve,Oe=1;do{for(ee=U,U=null,re=null,_e=0;ee;){for(_e++,se=ee,ce=0,$=0;$<Oe&&(ce++,se=se.nextZ);$++);for(Ve=Oe;ce>0||Ve>0&&se;)ce!==0&&(Ve===0||!se||ee.z<=se.z)?(ie=ee,ee=ee.nextZ,ce--):(ie=se,se=se.nextZ,Ve--),re?re.nextZ=ie:U=ie,ie.prevZ=re,re=ie;ee=se}re.nextZ=null,Oe*=2}while(_e>1)}(L)}(i,o,l,h);for(var m,v,b=i;i.prev!==i.next;)if(m=i.prev,v=i.next,h?Qw(i,o,l,h):Jw(i))e.push(m.i/t|0),e.push(i.i/t|0),e.push(v.i/t|0),Hu(i),i=v.next,b=v.next;else if((i=v)===b){f?f===1?Zu(i=eT(Ka(i),e,t),e,t,o,l,h,2):f===2&&tT(i,e,t,o,l,h):Zu(Ka(i),e,t,o,l,h,1);break}}}function Jw(i){var e=i.prev,t=i,o=i.next;if(Sn(e,t,o)>=0)return!1;for(var l=e.x,h=t.x,f=o.x,m=e.y,v=t.y,b=o.y,S=l<h?l<f?l:f:h<f?h:f,M=m<v?m<b?m:b:v<b?v:b,I=l>h?l>f?l:f:h>f?h:f,P=m>v?m>b?m:b:v>b?v:b,L=o.next;L!==e;){if(L.x>=S&&L.x<=I&&L.y>=M&&L.y<=P&&ic(l,m,h,v,f,b,L.x,L.y)&&Sn(L.prev,L,L.next)>=0)return!1;L=L.next}return!0}function Qw(i,e,t,o){var l=i.prev,h=i,f=i.next;if(Sn(l,h,f)>=0)return!1;for(var m=l.x,v=h.x,b=f.x,S=l.y,M=h.y,I=f.y,P=m<v?m<b?m:b:v<b?v:b,L=S<M?S<I?S:I:M<I?M:I,U=m>v?m>b?m:b:v>b?v:b,$=S>M?S>I?S:I:M>I?M:I,ee=xm(P,L,e,t,o),se=xm(U,$,e,t,o),ie=i.prevZ,re=i.nextZ;ie&&ie.z>=ee&&re&&re.z<=se;){if(ie.x>=P&&ie.x<=U&&ie.y>=L&&ie.y<=$&&ie!==l&&ie!==f&&ic(m,S,v,M,b,I,ie.x,ie.y)&&Sn(ie.prev,ie,ie.next)>=0||(ie=ie.prevZ,re.x>=P&&re.x<=U&&re.y>=L&&re.y<=$&&re!==l&&re!==f&&ic(m,S,v,M,b,I,re.x,re.y)&&Sn(re.prev,re,re.next)>=0))return!1;re=re.nextZ}for(;ie&&ie.z>=ee;){if(ie.x>=P&&ie.x<=U&&ie.y>=L&&ie.y<=$&&ie!==l&&ie!==f&&ic(m,S,v,M,b,I,ie.x,ie.y)&&Sn(ie.prev,ie,ie.next)>=0)return!1;ie=ie.prevZ}for(;re&&re.z<=se;){if(re.x>=P&&re.x<=U&&re.y>=L&&re.y<=$&&re!==l&&re!==f&&ic(m,S,v,M,b,I,re.x,re.y)&&Sn(re.prev,re,re.next)>=0)return!1;re=re.nextZ}return!0}function eT(i,e,t){var o=i;do{var l=o.prev,h=o.next.next;!Qd(l,h)&&ky(l,o,o.next,h)&&Wu(l,h)&&Wu(h,l)&&(e.push(l.i/t|0),e.push(o.i/t|0),e.push(h.i/t|0),Hu(o),Hu(o.next),o=i=h),o=o.next}while(o!==i);return Ka(o)}function tT(i,e,t,o,l,h){var f=i;do{for(var m=f.next.next;m!==f.prev;){if(f.i!==m.i&&sT(f,m)){var v=zy(f,m);return f=Ka(f,f.next),v=Ka(v,v.next),Zu(f,e,t,o,l,h,0),void Zu(v,e,t,o,l,h,0)}m=m.next}f=f.next}while(f!==i)}function iT(i,e){return i.x-e.x}function nT(i,e){var t=function(l,h){var f,m=h,v=l.x,b=l.y,S=-1/0;do{if(b<=m.y&&b>=m.next.y&&m.next.y!==m.y){var M=m.x+(b-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(M<=v&&M>S&&(S=M,f=m.x<m.next.x?m:m.next,M===v))return f}m=m.next}while(m!==h);if(!f)return null;var I,P=f,L=f.x,U=f.y,$=1/0;m=f;do v>=m.x&&m.x>=L&&v!==m.x&&ic(b<U?v:S,b,L,U,b<U?S:v,b,m.x,m.y)&&(I=Math.abs(b-m.y)/(v-m.x),Wu(m,l)&&(I<$||I===$&&(m.x>f.x||m.x===f.x&&rT(f,m)))&&(f=m,$=I)),m=m.next;while(m!==P);return f}(i,e);if(!t)return e;var o=zy(t,i);return Ka(o,o.next),Ka(t,t.next)}function rT(i,e){return Sn(i.prev,i,e.prev)<0&&Sn(e.next,i,i.next)<0}function xm(i,e,t,o,l){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-t)*l|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*l|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function oT(i){var e=i,t=i;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==i);return t}function ic(i,e,t,o,l,h,f,m){return(l-f)*(e-m)>=(i-f)*(h-m)&&(i-f)*(o-m)>=(t-f)*(e-m)&&(t-f)*(h-m)>=(l-f)*(o-m)}function sT(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(t,o){var l=t;do{if(l.i!==t.i&&l.next.i!==t.i&&l.i!==o.i&&l.next.i!==o.i&&ky(l,l.next,t,o))return!0;l=l.next}while(l!==t);return!1}(i,e)&&(Wu(i,e)&&Wu(e,i)&&function(t,o){var l=t,h=!1,f=(t.x+o.x)/2,m=(t.y+o.y)/2;do l.y>m!=l.next.y>m&&l.next.y!==l.y&&f<(l.next.x-l.x)*(m-l.y)/(l.next.y-l.y)+l.x&&(h=!h),l=l.next;while(l!==t);return h}(i,e)&&(Sn(i.prev,i,e.prev)||Sn(i,e.prev,e))||Qd(i,e)&&Sn(i.prev,i,i.next)>0&&Sn(e.prev,e,e.next)>0)}function Sn(i,e,t){return(e.y-i.y)*(t.x-e.x)-(e.x-i.x)*(t.y-e.y)}function Qd(i,e){return i.x===e.x&&i.y===e.y}function ky(i,e,t,o){var l=tf(Sn(i,e,t)),h=tf(Sn(i,e,o)),f=tf(Sn(t,o,i)),m=tf(Sn(t,o,e));return l!==h&&f!==m||!(l!==0||!ef(i,t,e))||!(h!==0||!ef(i,o,e))||!(f!==0||!ef(t,i,o))||!(m!==0||!ef(t,e,o))}function ef(i,e,t){return e.x<=Math.max(i.x,t.x)&&e.x>=Math.min(i.x,t.x)&&e.y<=Math.max(i.y,t.y)&&e.y>=Math.min(i.y,t.y)}function tf(i){return i>0?1:i<0?-1:0}function Wu(i,e){return Sn(i.prev,i,i.next)<0?Sn(i,e,i.next)>=0&&Sn(i,i.prev,e)>=0:Sn(i,e,i.prev)<0||Sn(i,i.next,e)<0}function zy(i,e){var t=new bm(i.i,i.x,i.y),o=new bm(e.i,e.x,e.y),l=i.next,h=e.prev;return i.next=e,e.prev=i,t.next=l,l.prev=t,o.next=t,t.prev=o,h.next=o,o.prev=h,o}function Py(i,e,t,o){var l=new bm(i,e,t);return o?(l.next=o.next,l.prev=o,o.next.prev=l,o.next=l):(l.prev=l,l.next=l),l}function Hu(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function bm(i,e,t){this.i=i,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function wm(i,e,t,o){for(var l=0,h=e,f=t-o;h<t;h+=o)l+=(i[f]-i[h])*(i[h+1]+i[f+1]),f=h;return l}function aT(i,e,t,o,l){Dy(i,e,t||0,o||i.length-1,l||lT)}function Dy(i,e,t,o,l){for(;o>t;){if(o-t>600){var h=o-t+1,f=e-t+1,m=Math.log(h),v=.5*Math.exp(2*m/3),b=.5*Math.sqrt(m*v*(h-v)/h)*(f-h/2<0?-1:1);Dy(i,e,Math.max(t,Math.floor(e-f*v/h+b)),Math.min(o,Math.floor(e+(h-f)*v/h+b)),l)}var S=i[e],M=t,I=o;for(Xu(i,t,e),l(i[o],S)>0&&Xu(i,t,o);M<I;){for(Xu(i,M,I),M++,I--;l(i[M],S)<0;)M++;for(;l(i[I],S)>0;)I--}l(i[t],S)===0?Xu(i,t,I):Xu(i,++I,o),I<=e&&(t=I+1),e<=I&&(o=I-1)}}function Xu(i,e,t){var o=i[e];i[e]=i[t],i[t]=o}function lT(i,e){return i<e?-1:i>e?1:0}function Tm(i,e){const t=i.length;if(t<=1)return[i];const o=[];let l,h;for(let f=0;f<t;f++){const m=pi(i[f]);m!==0&&(i[f].area=Math.abs(m),h===void 0&&(h=m<0),h===m<0?(l&&o.push(l),l=[i[f]]):l.push(i[f]))}if(l&&o.push(l),e>1)for(let f=0;f<o.length;f++)o[f].length<=e||(aT(o[f],e,1,o[f].length-1,cT),o[f]=o[f].slice(0,e));return o}function cT(i,e){return e.area-i.area}function Em(i,e,t){const o=t.patternDependencies;let l=!1;for(const h of e){const f=h.paint.get(`${i}-pattern`);f.isConstant()||(l=!0);const m=f.constantOr(null);m&&(l=!0,o[m.to]=!0,o[m.from]=!0)}return l}function Sm(i,e,t,o,l){const h=l.patternDependencies;for(const f of e){const m=f.paint.get(`${i}-pattern`).value;if(m.kind!=="constant"){let v=m.evaluate({zoom:o-1},t,{},l.availableImages),b=m.evaluate({zoom:o},t,{},l.availableImages),S=m.evaluate({zoom:o+1},t,{},l.availableImages);v=v&&v.name?v.name:v,b=b&&b.name?b.name:b,S=S&&S.name?S.name:S,h[v]=!0,h[b]=!0,h[S]=!0,t.patterns[f.id]={min:v,mid:b,max:S}}}return t}Jd.deviation=function(i,e,t,o){var l=e&&e.length,h=Math.abs(wm(i,0,l?e[0]*t:i.length,t));if(l)for(var f=0,m=e.length;f<m;f++)h-=Math.abs(wm(i,e[f]*t,f<m-1?e[f+1]*t:i.length,t));var v=0;for(f=0;f<o.length;f+=3){var b=o[f]*t,S=o[f+1]*t,M=o[f+2]*t;v+=Math.abs((i[b]-i[M])*(i[S+1]-i[b+1])-(i[b]-i[S])*(i[M+1]-i[b+1]))}return h===0&&v===0?0:Math.abs((v-h)/h)},Jd.flatten=function(i){for(var e=i[0][0].length,t={vertices:[],holes:[],dimensions:e},o=0,l=0;l<i.length;l++){for(var h=0;h<i[l].length;h++)for(var f=0;f<e;f++)t.vertices.push(i[l][h][f]);l>0&&t.holes.push(o+=i[l-1].length)}return t},Yd.default=Yw;class nf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new St,this.indexArray=new _i,this.indexArray2=new er,this.programConfigurations=new Ga(e.layers,e.zoom),this.segments=new In,this.segments2=new In,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.projection=e.projection}populate(e,t,o,l){this.hasPattern=Em("fill",this.layers,t);const h=this.layers[0].layout.get("fill-sort-key"),f=[];for(const{feature:m,id:v,index:b,sourceLayerIndex:S}of e){const M=this.layers[0]._featureFilter.needGeometry,I=Za(m,M);if(!this.layers[0]._featureFilter.filter(new H(this.zoom),I,o))continue;const P=h?h.evaluate(I,{},o,t.availableImages):void 0,L={id:v,properties:m.properties,type:m.type,sourceLayerIndex:S,index:b,geometry:M?I.geometry:us(m,o,l),patterns:{},sortKey:P};f.push(L)}h&&f.sort((m,v)=>m.sortKey-v.sortKey);for(const m of f){const{geometry:v,index:b,sourceLayerIndex:S}=m;if(this.hasPattern){const M=Sm("fill",this.layers,m,this.zoom,t);this.patternFeatures.push(M)}else this.addFeature(m,v,b,o,{},t.availableImages);t.featureIndex.insert(e[b].feature,v,b,S,this.index)}}update(e,t,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,o,l)}addFeatures(e,t,o,l,h){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,t,o,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Kw),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,o,l,h,f=[]){for(const m of Tm(t,500)){let v=0;for(const L of m)v+=L.length;const b=this.segments.prepareSegment(v,this.layoutVertexArray,this.indexArray),S=b.vertexLength,M=[],I=[];for(const L of m){if(L.length===0)continue;L!==m[0]&&I.push(M.length/2);const U=this.segments2.prepareSegment(L.length,this.layoutVertexArray,this.indexArray2),$=U.vertexLength;this.layoutVertexArray.emplaceBack(L[0].x,L[0].y),this.indexArray2.emplaceBack($+L.length-1,$),M.push(L[0].x),M.push(L[0].y);for(let ee=1;ee<L.length;ee++)this.layoutVertexArray.emplaceBack(L[ee].x,L[ee].y),this.indexArray2.emplaceBack($+ee-1,$+ee),M.push(L[ee].x),M.push(L[ee].y);U.vertexLength+=L.length,U.primitiveLength+=L.length}const P=Yd(M,I);for(let L=0;L<P.length;L+=3)this.indexArray.emplaceBack(S+P[L],S+P[L+1],S+P[L+2]);b.vertexLength+=v,b.primitiveLength+=P.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,h,f,l)}}Rt(nf,"FillBucket",{omit:["layers","patternFeatures"]});const uT=new Je({"fill-sort-key":new be(Me.layout_fill["fill-sort-key"])});var hT={paint:new Je({"fill-antialias":new ue(Me.paint_fill["fill-antialias"]),"fill-opacity":new be(Me.paint_fill["fill-opacity"]),"fill-color":new be(Me.paint_fill["fill-color"]),"fill-outline-color":new be(Me.paint_fill["fill-outline-color"]),"fill-translate":new ue(Me.paint_fill["fill-translate"]),"fill-translate-anchor":new ue(Me.paint_fill["fill-translate-anchor"]),"fill-pattern":new Be(Me.paint_fill["fill-pattern"])}),layout:uT};const dT=it([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),fT=it([{name:"a_centroid_pos",components:2,type:"Uint16"}]),pT=it([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:mT}=dT;var Ly=nc;function nc(i,e,t,o,l){this.properties={},this.extent=t,this.type=0,this._pbf=i,this._geometry=-1,this._keys=o,this._values=l,i.readFields(_T,this,e)}function _T(i,e,t){i==1?e.id=t.readVarint():i==2?function(o,l){for(var h=o.readVarint()+o.pos;o.pos<h;){var f=l._keys[o.readVarint()],m=l._values[o.readVarint()];l.properties[f]=m}}(t,e):i==3?e.type=t.readVarint():i==4&&(e._geometry=t.pos)}function gT(i){for(var e,t,o=0,l=0,h=i.length,f=h-1;l<h;f=l++)o+=((t=i[f]).x-(e=i[l]).x)*(e.y+t.y);return o}nc.types=["Unknown","Point","LineString","Polygon"],nc.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,t=i.readVarint()+i.pos,o=1,l=0,h=0,f=0,m=[];i.pos<t;){if(l<=0){var v=i.readVarint();o=7&v,l=v>>3}if(l--,o===1||o===2)h+=i.readSVarint(),f+=i.readSVarint(),o===1&&(e&&m.push(e),e=[]),e.push(new N(h,f));else{if(o!==7)throw new Error("unknown command "+o);e&&e.push(e[0].clone())}}return e&&m.push(e),m},nc.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,t=1,o=0,l=0,h=0,f=1/0,m=-1/0,v=1/0,b=-1/0;i.pos<e;){if(o<=0){var S=i.readVarint();t=7&S,o=S>>3}if(o--,t===1||t===2)(l+=i.readSVarint())<f&&(f=l),l>m&&(m=l),(h+=i.readSVarint())<v&&(v=h),h>b&&(b=h);else if(t!==7)throw new Error("unknown command "+t)}return[f,v,m,b]},nc.prototype.toGeoJSON=function(i,e,t){var o,l,h=this.extent*Math.pow(2,t),f=this.extent*i,m=this.extent*e,v=this.loadGeometry(),b=nc.types[this.type];function S(P){for(var L=0;L<P.length;L++){var U=P[L];P[L]=[360*(U.x+f)/h-180,360/Math.PI*Math.atan(Math.exp((180-360*(U.y+m)/h)*Math.PI/180))-90]}}switch(this.type){case 1:var M=[];for(o=0;o<v.length;o++)M[o]=v[o][0];S(v=M);break;case 2:for(o=0;o<v.length;o++)S(v[o]);break;case 3:for(v=function(P){var L=P.length;if(L<=1)return[P];for(var U,$,ee=[],se=0;se<L;se++){var ie=gT(P[se]);ie!==0&&($===void 0&&($=ie<0),$===ie<0?(U&&ee.push(U),U=[P[se]]):U.push(P[se]))}return U&&ee.push(U),ee}(v),o=0;o<v.length;o++)for(l=0;l<v[o].length;l++)S(v[o][l])}v.length===1?v=v[0]:b="Multi"+b;var I={type:"Feature",geometry:{type:b,coordinates:v},properties:this.properties};return"id"in this&&(I.id=this.id),I};var By=Ry;function Ry(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(yT,this,e),this.length=this._features.length}function yT(i,e,t){i===15?e.version=t.readVarint():i===1?e.name=t.readString():i===5?e.extent=t.readVarint():i===2?e._features.push(t.pos):i===3?e._keys.push(t.readString()):i===4&&e._values.push(function(o){for(var l=null,h=o.readVarint()+o.pos;o.pos<h;){var f=o.readVarint()>>3;l=f===1?o.readString():f===2?o.readFloat():f===3?o.readDouble():f===4?o.readVarint64():f===5?o.readVarint():f===6?o.readSVarint():f===7?o.readBoolean():null}return l}(t))}function vT(i,e,t){if(i===3){var o=new By(t,t.readVarint()+t.pos);o.length&&(e[o.name]=o)}}Ry.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new Ly(this._pbf,e,this.extent,this._keys,this._values)};var Ya={VectorTile:function(i,e){this.layers=i.readFields(vT,{},e)},VectorTileFeature:Ly,VectorTileLayer:By};function rf(i,e,t,o){const l=[],h=o===0?(f,m,v,b,S,M)=>{f.push(new N(M,v+(M-m)/(b-m)*(S-v)))}:(f,m,v,b,S,M)=>{f.push(new N(m+(M-v)/(S-v)*(b-m),M))};for(const f of i){const m=[];for(const v of f){if(v.length<=2)continue;const b=[];for(let I=0;I<v.length-1;I++){const P=v[I].x,L=v[I].y,U=v[I+1].x,$=v[I+1].y,ee=o===0?P:L,se=o===0?U:$;ee<e?se>e&&h(b,P,L,U,$,e):ee>t?se<t&&h(b,P,L,U,$,t):b.push(v[I]),se<e&&ee>=e&&h(b,P,L,U,$,e),se>t&&ee<=t&&h(b,P,L,U,$,t)}let S=v[v.length-1];const M=o===0?S.x:S.y;M>=e&&M<=t&&b.push(S),b.length&&(S=b[b.length-1],b[0].x===S.x&&b[0].y===S.y||b.push(b[0]),m.push(b))}m.length&&l.push(m)}return l}const xT=Ya.VectorTileFeature.types,bT=Math.pow(2,13);function Ku(i,e,t,o,l,h,f,m){i.emplaceBack((e<<1)+f,(t<<1)+h,(Math.floor(o*bT)<<1)+l,Math.round(m))}function Yu(i,e,t){i.emplaceBack(e.x,e.y,e.z,t[0]*16384,t[1]*16384,t[2]*16384)}class Oy{constructor(){this.acc=new N(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new N(e.x,e.y),this.max=new N(e.x,e.y))}append(e,t){this.currentPolyCount.edges++,this.acc._add(e);const o=this.min,l=this.max;e.x<o.x?o.x=e.x:e.x>l.x&&(l.x=e.x),e.y<o.y?o.y=e.y:e.y>l.y&&(l.y=e.y),((e.x===0||e.x===ei)&&e.x===t.x)!=((e.y===0||e.y===ei)&&e.y===t.y)&&this.processBorderOverlap(e,t),t.x<0!=e.x<0&&this.addBorderIntersection(0,Mi(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>ei!=e.x>ei&&this.addBorderIntersection(1,Mi(t.y,e.y,(ei-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,Mi(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>ei!=e.y>ei&&this.addBorderIntersection(3,Mi(t.x,e.x,(ei-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const o=this.borders[e];t<o[0]&&(o[0]=t),t>o[1]&&(o[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const o=e.x===0?0:1;this.addBorderIntersection(o,t.y),this.addBorderIntersection(o,e.y)}else{const o=e.y===0?2:3;this.addBorderIntersection(o,t.x),this.addBorderIntersection(o,e.x)}}centroid(){const e=this.polyCount.reduce((t,o)=>t+o.edges,0);return e!==0?this.acc.div(e)._round():new N(0,0)}span(){return new N(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,t)=>e+ +(t[0]!==Number.MAX_VALUE),0)}}class Ju{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new Wt,this.centroidVertexArray=new Wg,this.indexArray=new _i,this.programConfigurations=new Ga(e.layers,e.zoom),this.segments=new In,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.enableTerrain=e.enableTerrain}populate(e,t,o,l){this.features=[],this.hasPattern=Em("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(h){const f=Math.exp(Math.PI*(1-h.y/(1<<h.z)*2));return 80150034*f/(f*f+1)/ei/(1<<h.z)}(o),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:h,id:f,index:m,sourceLayerIndex:v}of e){const b=this.layers[0]._featureFilter.needGeometry,S=Za(h,b);if(!this.layers[0]._featureFilter.filter(new H(this.zoom),S,o))continue;const M={id:f,sourceLayerIndex:v,index:m,geometry:b?S.geometry:us(h,o,l),properties:h.properties,type:h.type,patterns:{}},I=this.layoutVertexArray.length;this.hasPattern?this.features.push(Sm("fill-extrusion",this.layers,M,this.zoom,t)):this.addFeature(M,M.geometry,m,o,{},t.availableImages,l),t.featureIndex.insert(h,M.geometry,m,v,this.index,I)}this.sortBorders()}addFeatures(e,t,o,l,h){for(const f of this.features){const{geometry:m}=f;this.addFeature(f,m,f.index,t,o,l,h)}this.sortBorders()}update(e,t,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,o,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,mT),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,pT.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,fT.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,o,l,h,f,m){const v=[new N(0,0),new N(ei,ei)],b=m.projection,S=b.name==="globe",M=this.enableTerrain&&!S?new Oy:null,I=xT[e.type]==="Polygon";S&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new tr);const P=Tm(t,500);for(let ee=P.length-1;ee>=0;ee--){const se=P[ee];(se.length===0||(L=se[0]).every(ie=>ie.x<=0)||L.every(ie=>ie.x>=ei)||L.every(ie=>ie.y<=0)||L.every(ie=>ie.y>=ei))&&P.splice(ee,1)}var L;let U;if(S)U=$y(P,v,l);else{U=[];for(const ee of P)U.push({polygon:ee,bounds:v})}const $=I?this.edgeRadius:0;for(const{polygon:ee,bounds:se}of U){let ie=0,re=0;for(const ce of ee)I&&!ce[0].equals(ce[ce.length-1])&&ce.push(ce[0]),re+=I?ce.length-1:ce.length;const _e=this.segments.prepareSegment((I?5:4)*re,this.layoutVertexArray,this.indexArray);if(I){const ce=[],Ve=[];ie=_e.vertexLength;for(const We of ee){let yt,je;We.length&&We!==ee[0]&&Ve.push(ce.length/2),yt=We[1].sub(We[0])._perp()._unit();for(let et=1;et<We.length;et++){const at=We[et],tt=We[et===We.length-1?1:et+1];let{x:ft,y:lt}=at;if($){je=tt.sub(at)._perp()._unit();const kt=yt.add(je)._unit(),li=$*Math.min(4,1/(yt.x*kt.x+yt.y*kt.y));ft+=li*kt.x,lt+=li*kt.y,yt=je}Ku(this.layoutVertexArray,ft,lt,0,0,1,1,0),_e.vertexLength++,ce.push(at.x,at.y),S&&Yu(this.layoutVertexExtArray,b.projectTilePoint(ft,lt,l),b.upVector(l,ft,lt))}}const Oe=Yd(ce,Ve);for(let We=0;We<Oe.length;We+=3)this.indexArray.emplaceBack(ie+Oe[We],ie+Oe[We+2],ie+Oe[We+1]),_e.primitiveLength++}for(const ce of ee){M&&ce.length&&M.startRing(ce[0]);let Ve,Oe,We,yt=ce.length>4&&Ny(ce[ce.length-2],ce[0],ce[1]),je=$?wT(ce[ce.length-2],ce[0],ce[1],$):0;Oe=ce[1].sub(ce[0])._perp()._unit();for(let et=1,at=0;et<ce.length;et++){let tt=ce[et-1],ft=ce[et];const lt=ce[et===ce.length-1?1:et+1];if(M&&I&&M.currentPolyCount.top++,Uy(ft,tt,se)){$&&(Oe=lt.sub(ft)._perp()._unit());continue}M&&M.append(ft,tt);const kt=ft.sub(tt)._perp(),li=kt.x/(Math.abs(kt.x)+Math.abs(kt.y)),hi=kt.y>0?1:0,Gt=tt.dist(ft);if(at+Gt>32768&&(at=0),$){We=lt.sub(ft)._perp()._unit();let Dt=Vy(tt,ft,lt,Fy(Oe,We),$);isNaN(Dt)&&(Dt=0);const Yi=ft.sub(tt)._unit();tt=tt.add(Yi.mult(je))._round(),ft=ft.add(Yi.mult(-Dt))._round(),je=Dt,Oe=We}const Tt=_e.vertexLength,wi=ce.length>4&&Ny(tt,ft,lt);let oi=jy(at,yt,!0);if(Ku(this.layoutVertexArray,tt.x,tt.y,li,hi,0,0,oi),Ku(this.layoutVertexArray,tt.x,tt.y,li,hi,0,1,oi),at+=Gt,oi=jy(at,wi,!1),yt=wi,Ku(this.layoutVertexArray,ft.x,ft.y,li,hi,0,0,oi),Ku(this.layoutVertexArray,ft.x,ft.y,li,hi,0,1,oi),_e.vertexLength+=4,this.indexArray.emplaceBack(Tt+0,Tt+1,Tt+2),this.indexArray.emplaceBack(Tt+1,Tt+3,Tt+2),_e.primitiveLength+=2,$){const Dt=ie+(et===1?ce.length-2:et-2),Yi=et===1?ie:Dt+1;if(this.indexArray.emplaceBack(Tt+1,Dt,Tt+3),this.indexArray.emplaceBack(Dt,Yi,Tt+3),_e.primitiveLength+=2,Ve===void 0&&(Ve=Tt),!Uy(lt,ce[et],se)){const Zi=et===ce.length-1?Ve:_e.vertexLength;this.indexArray.emplaceBack(Tt+2,Tt+3,Zi),this.indexArray.emplaceBack(Tt+3,Zi+1,Zi),this.indexArray.emplaceBack(Tt+3,Yi,Zi+1),_e.primitiveLength+=3}}if(S){const Dt=this.layoutVertexExtArray,Yi=b.projectTilePoint(tt.x,tt.y,l),Zi=b.projectTilePoint(ft.x,ft.y,l),on=b.upVector(l,tt.x,tt.y),fi=b.upVector(l,ft.x,ft.y);Yu(Dt,Yi,on),Yu(Dt,Yi,on),Yu(Dt,Zi,fi),Yu(Dt,Zi,fi)}}I&&(ie+=ce.length-1)}}if(M&&M.polyCount.length>0){if(M.borders){M.vertexArrayOffset=this.centroidVertexArray.length;const ee=M.borders,se=this.featuresOnBorder.push(M)-1;for(let ie=0;ie<4;ie++)ee[ie][0]!==Number.MAX_VALUE&&this.borders[ie].push(se)}this.encodeCentroid(M.borders?void 0:M.centroid(),M)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,h,f,l)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((t,o)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[o].borders[e][0])}encodeCentroid(e,t,o=!0){let l,h;if(e)if(e.y!==0){const m=t.span()._mult(this.tileToMeter);l=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(m.x/10)),h=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(m.y/10))}else l=Math.ceil(7*(e.x+450)),h=0;else l=0,h=+o;let f=o?this.centroidVertexArray.length:t.vertexArrayOffset;for(const m of t.polyCount){o&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*m.edges+m.top);for(let v=0;v<m.top;v++)this.centroidVertexArray.emplace(f++,l,h);for(let v=0;v<2*m.edges;v++)this.centroidVertexArray.emplace(f++,0,h),this.centroidVertexArray.emplace(f++,l,h)}}}function Fy(i,e){const t=i.add(e)._unit();return i.x*t.x+i.y*t.y}function wT(i,e,t,o){const l=e.sub(i)._perp()._unit(),h=t.sub(e)._perp()._unit();return Vy(i,e,t,Fy(l,h),o)}function Vy(i,e,t,o,l){const h=Math.sqrt(1-o*o);return Math.min(i.dist(e)/3,e.dist(t)/3,l*h/o)}function Uy(i,e,t){return i.x<t[0].x&&e.x<t[0].x||i.x>t[1].x&&e.x>t[1].x||i.y<t[0].y&&e.y<t[0].y||i.y>t[1].y&&e.y>t[1].y}function Ny(i,e,t){if(i.x<0||i.x>=ei||e.x<0||e.x>=ei||t.x<0||t.x>=ei)return!1;const o=t.sub(e),l=o.perp(),h=i.sub(e);return(o.x*h.x+o.y*h.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(h.x*h.x+h.y*h.y))>-.866&&l.x*h.x+l.y*h.y<0}function jy(i,e,t){const o=e?2|i:-3&i;return t?1|o:-2&o}function qy(){const i=Math.PI/32,e=Math.tan(i),t=em;return t*Math.sqrt(1+2*e*e)-t}function $y(i,e,t){const o=1<<t.z,l=Zr(t.x/o),h=Zr((t.x+1)/o),f=Hn(t.y/o),m=Hn((t.y+1)/o);return function(v,b,S,M,I=0,P){const L=[];if(!v.length||!S||!M)return L;const U=(ce,Ve)=>{for(const Oe of ce)L.push({polygon:Oe,bounds:Ve})},$=Math.ceil(Math.log2(S)),ee=Math.ceil(Math.log2(M)),se=$-ee,ie=[];for(let ce=0;ce<Math.abs(se);ce++)ie.push(se>0?0:1);for(let ce=0;ce<Math.min($,ee);ce++)ie.push(0),ie.push(1);let re=v;if(re=rf(re,b[0].y-I,b[1].y+I,1),re=rf(re,b[0].x-I,b[1].x+I,0),!re.length)return L;const _e=[];for(ie.length?_e.push({polygons:re,bounds:b,depth:0}):U(re,b);_e.length;){const ce=_e.pop(),Ve=ce.depth,Oe=ie[Ve],We=ce.bounds[0],yt=ce.bounds[1],je=Oe===0?We.x:We.y,et=Oe===0?yt.x:yt.y,at=P?P(Oe,je,et):.5*(je+et),tt=rf(ce.polygons,je-I,at+I,Oe),ft=rf(ce.polygons,at-I,et+I,Oe);if(tt.length){const lt=[We,new N(Oe===0?at:yt.x,Oe===1?at:yt.y)];ie.length>Ve+1?_e.push({polygons:tt,bounds:lt,depth:Ve+1}):U(tt,lt)}if(ft.length){const lt=[new N(Oe===0?at:We.x,Oe===1?at:We.y),yt];ie.length>Ve+1?_e.push({polygons:ft,bounds:lt,depth:Ve+1}):U(ft,lt)}}return L}(i,e,Math.ceil((h-l)/11.25),Math.ceil((f-m)/11.25),1,(v,b,S)=>{if(v===0)return .5*(b+S);{const M=Hn((t.y+b/ei)/o);return(cs(.5*(Hn((t.y+S/ei)/o)+M))*o-t.y)*ei}})}Rt(Ju,"FillExtrusionBucket",{omit:["layers","features"]}),Rt(Oy,"PartMetadata");const TT=new Je({"fill-extrusion-edge-radius":new ue(Me["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var ET={paint:new Je({"fill-extrusion-opacity":new ue(Me["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new be(Me["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ue(Me["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ue(Me["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Be(Me["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new be(Me["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new be(Me["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ue(Me["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ue(Me["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ue(Me["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:TT};function Gy(i,e,t){var o=2*Math.PI*6378137/256/Math.pow(2,t);return[i*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class of{constructor(e,t,o){this.z=e,this.x=t,this.y=o,this.key=Qu(0,e,e,t,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){const o=function(h,f,m){var v=Gy(256*h,256*(f=Math.pow(2,m)-f-1),m),b=Gy(256*(h+1),256*(f+1),m);return v[0]+","+v[1]+","+b[0]+","+b[1]}(this.x,this.y,this.z),l=function(h,f,m){let v,b="";for(let S=h;S>0;S--)v=1<<S-1,b+=(f&v?1:0)+(m&v?2:0);return b}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(t==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Zy{constructor(e,t){this.wrap=e,this.canonical=t,this.key=Qu(e,t.z,t.z,t.x,t.y)}}class hr{constructor(e,t,o,l,h){this.overscaledZ=e,this.wrap=t,this.canonical=new of(o,+l,+h),this.key=t===0&&e===o?this.canonical.key:Qu(t,e,o,l,h)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new hr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new hr(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t=!0){if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return Qu(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const o=this.canonical.z-e;return Qu(this.wrap*+t,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new hr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,o=2*this.canonical.x,l=2*this.canonical.y;return[new hr(t,this.wrap,t,o,l),new hr(t,this.wrap,t,o+1,l),new hr(t,this.wrap,t,o,l+1),new hr(t,this.wrap,t,o+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new hr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new hr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Zy(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Qu(i,e,t,o,l){const h=1<<Math.min(t,22);let f=h*(l%h)+o%h;return i&&t<22&&(f+=h*h*((i<0?-2*i-1:2*i)%(1<<2*(22-t)))),16*(32*f+t)+(e-t)}function eh(i,e){return i.x*e.x+i.y*e.y}function Wy(i,e){if(i.length===1){let t=0;const o=e[t++];let l;for(;!l||o.equals(l);)if(l=e[t++],!l)return 1/0;for(;t<e.length;t++){const h=e[t],f=i[0],m=l.sub(o),v=h.sub(o),b=f.sub(o),S=eh(m,m),M=eh(m,v),I=eh(v,v),P=eh(b,m),L=eh(b,v),U=S*I-M*M,$=(I*P-M*L)/U,ee=(S*L-M*P)/U,se=o.z*(1-$-ee)+l.z*$+h.z*ee;if(isFinite(se))return se}return 1/0}{let t=1/0;for(const o of e)t=Math.min(t,o.z);return t}}function sf(i){const e=new N(i[0],i[1]);return e.z=i[2],e}function Hy(i,e,t,o,l,h,f,m){const v=f*l.getElevationAt(i,e,!0,!0),b=h[0]!==0,S=b?h[1]===0?f*(h[0]/7-450):f*function(M,I,P){const L=Math.floor(I[0]/8),U=Math.floor(I[1]/8),$=10*(I[0]-8*L),ee=10*(I[1]-8*U),se=M.getElevationAt(L,U,!0,!0),ie=M.getMeterToDEM(P),re=Math.floor(.5*($*ie-1)),_e=Math.floor(.5*(ee*ie-1)),ce=M.tileCoordToPixel(L,U),Ve=2*re+1,Oe=2*_e+1,We=function(ft,lt,kt,li,hi){return[ft.getElevationAtPixel(lt,kt,!0),ft.getElevationAtPixel(lt+hi,kt,!0),ft.getElevationAtPixel(lt,kt+hi,!0),ft.getElevationAtPixel(lt+li,kt+hi,!0)]}(M,ce.x-re,ce.y-_e,Ve,Oe),yt=Math.abs(We[0]-We[1]),je=Math.abs(We[2]-We[3]),et=Math.abs(We[0]-We[2])+Math.abs(We[1]-We[3]),at=Math.min(.25,.5*ie*(yt+je)/Ve),tt=Math.min(.25,.5*ie*et/Oe);return se+Math.max(at*$,tt*ee)}(l,h,m):v;return{base:v+(t===0)?-1:t,top:b?Math.max(S+o,v+t+2):v+o}}Rt(of,"CanonicalTileID"),Rt(hr,"OverscaledTileID",{omit:["projMatrix"]});const ST=it([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:CT}=ST,AT=it([{name:"a_packed",components:4,type:"Float32"}]),{members:MT}=AT,IT=Ya.VectorTileFeature.types,kT=Math.cos(Math.PI/180*37.5);class af{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(t=>{this.gradients[t.id]={}}),this.layoutVertexArray=new ii,this.layoutVertexArray2=new bi,this.indexArray=new _i,this.programConfigurations=new Ga(e.layers,e.zoom),this.segments=new In,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(e,t,o,l){this.hasPattern=Em("line",this.layers,t);const h=this.layers[0].layout.get("line-sort-key"),f=[];for(const{feature:S,id:M,index:I,sourceLayerIndex:P}of e){const L=this.layers[0]._featureFilter.needGeometry,U=Za(S,L);if(!this.layers[0]._featureFilter.filter(new H(this.zoom),U,o))continue;const $=h?h.evaluate(U,{},o):void 0,ee={id:M,properties:S.properties,type:S.type,sourceLayerIndex:P,index:I,geometry:L?U.geometry:us(S,o,l),patterns:{},sortKey:$};f.push(ee)}h&&f.sort((S,M)=>S.sortKey-M.sortKey);const{lineAtlas:m,featureIndex:v}=t,b=this.addConstantDashes(m);for(const S of f){const{geometry:M,index:I,sourceLayerIndex:P}=S;if(b&&this.addFeatureDashes(S,m),this.hasPattern){const L=Sm("line",this.layers,S,this.zoom,t);this.patternFeatures.push(L)}else this.addFeature(S,M,I,o,m.positions,t.availableImages);v.insert(e[I].feature,M,I,P,this.index)}}addConstantDashes(e){let t=!1;for(const o of this.layers){const l=o.paint.get("line-dasharray").value,h=o.layout.get("line-cap").value;if(l.kind!=="constant"||h.kind!=="constant")t=!0;else{const f=h.value,m=l.value;if(!m)continue;e.addDash(m.from,f),e.addDash(m.to,f),m.other&&e.addDash(m.other,f)}}return t}addFeatureDashes(e,t){const o=this.zoom;for(const l of this.layers){const h=l.paint.get("line-dasharray").value,f=l.layout.get("line-cap").value;if(h.kind==="constant"&&f.kind==="constant")continue;let m,v,b,S,M,I;if(h.kind==="constant"){const $=h.value;if(!$)continue;m=$.other||$.to,v=$.to,b=$.from}else m=h.evaluate({zoom:o-1},e),v=h.evaluate({zoom:o},e),b=h.evaluate({zoom:o+1},e);f.kind==="constant"?S=M=I=f.value:(S=f.evaluate({zoom:o-1},e),M=f.evaluate({zoom:o},e),I=f.evaluate({zoom:o+1},e)),t.addDash(m,S),t.addDash(v,M),t.addDash(b,I);const P=t.getKey(m,S),L=t.getKey(v,M),U=t.getKey(b,I);e.patterns[l.id]={min:P,mid:L,max:U}}}update(e,t,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,o,l)}addFeatures(e,t,o,l,h){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,t,o,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,MT)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,CT),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,o,l,h,f){const m=this.layers[0].layout,v=m.get("line-join").evaluate(e,{}),b=m.get("line-cap").evaluate(e,{}),S=m.get("line-miter-limit"),M=m.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const I of t)this.addLine(I,e,v,b,S,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,h,f,l)}addLine(e,t,o,l,h,f){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ee=0;ee<e.length-1;ee++)this.totalDistance+=e[ee].dist(e[ee+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const m=IT[t.type]==="Polygon";let v=e.length;for(;v>=2&&e[v-1].equals(e[v-2]);)v--;let b=0;for(;b<v-1&&e[b].equals(e[b+1]);)b++;if(v<(m?3:2))return;o==="bevel"&&(h=1.05);const S=this.overscaling<=16?122880/(512*this.overscaling):0,M=this.segments.prepareSegment(10*v,this.layoutVertexArray,this.indexArray);let I,P,L,U,$;this.e1=this.e2=-1,m&&(I=e[v-2],$=e[b].sub(I)._unit()._perp());for(let ee=b;ee<v;ee++){if(L=ee===v-1?m?e[b+1]:void 0:e[ee+1],L&&e[ee].equals(L))continue;$&&(U=$),I&&(P=I),I=e[ee],$=L?L.sub(I)._unit()._perp():U,U=U||$;let se=U.add($);se.x===0&&se.y===0||se._unit();const ie=U.x*$.x+U.y*$.y,re=se.x*$.x+se.y*$.y,_e=re!==0?1/re:1/0,ce=2*Math.sqrt(2-2*re),Ve=re<kT&&P&&L,Oe=U.x*$.y-U.y*$.x>0;if(Ve&&ee>b){const je=I.dist(P);if(je>2*S){const et=I.sub(I.sub(P)._mult(S/je)._round());this.updateDistance(P,et),this.addCurrentVertex(et,U,0,0,M),P=et}}const We=P&&L;let yt=We?o:m?"butt":l;if(We&&yt==="round"&&(_e<f?yt="miter":_e<=2&&(yt="fakeround")),yt==="miter"&&_e>h&&(yt="bevel"),yt==="bevel"&&(_e>2&&(yt="flipbevel"),_e<h&&(yt="miter")),P&&this.updateDistance(P,I),yt==="miter")se._mult(_e),this.addCurrentVertex(I,se,0,0,M);else if(yt==="flipbevel"){if(_e>100)se=$.mult(-1);else{const je=_e*U.add($).mag()/U.sub($).mag();se._perp()._mult(je*(Oe?-1:1))}this.addCurrentVertex(I,se,0,0,M),this.addCurrentVertex(I,se.mult(-1),0,0,M)}else if(yt==="bevel"||yt==="fakeround"){const je=-Math.sqrt(_e*_e-1),et=Oe?je:0,at=Oe?0:je;if(P&&this.addCurrentVertex(I,U,et,at,M),yt==="fakeround"){const tt=Math.round(180*ce/Math.PI/20);for(let ft=1;ft<tt;ft++){let lt=ft/tt;if(lt!==.5){const li=lt-.5;lt+=lt*li*(lt-1)*((1.0904+ie*(ie*(3.55645-1.43519*ie)-3.2452))*li*li+(.848013+ie*(.215638*ie-1.06021)))}const kt=$.sub(U)._mult(lt)._add(U)._unit()._mult(Oe?-1:1);this.addHalfVertex(I,kt.x,kt.y,!1,Oe,0,M)}}L&&this.addCurrentVertex(I,$,-et,-at,M)}else if(yt==="butt")this.addCurrentVertex(I,se,0,0,M);else if(yt==="square"){const je=P?1:-1;P||this.addCurrentVertex(I,se,je,je,M),this.addCurrentVertex(I,se,0,0,M),P&&this.addCurrentVertex(I,se,je,je,M)}else yt==="round"&&(P&&(this.addCurrentVertex(I,U,0,0,M),this.addCurrentVertex(I,U,1,1,M,!0)),L&&(this.addCurrentVertex(I,$,-1,-1,M,!0),this.addCurrentVertex(I,$,0,0,M)));if(Ve&&ee<v-1){const je=I.dist(L);if(je>2*S){const et=I.add(L.sub(I)._mult(S/je)._round());this.updateDistance(I,et),this.addCurrentVertex(et,$,0,0,M),I=et}}}}addCurrentVertex(e,t,o,l,h,f=!1){const m=t.y*l-t.x,v=-t.y-t.x*l;this.addHalfVertex(e,t.x+t.y*o,t.y-t.x*o,f,!1,o,h),this.addHalfVertex(e,m,v,f,!0,-l,h)}addHalfVertex({x:e,y:t},o,l,h,f,m,v){this.layoutVertexArray.emplaceBack((e<<1)+(h?1:0),(t<<1)+(f?1:0),Math.round(63*o)+128,Math.round(63*l)+128,1+(m===0?0:m<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const b=v.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,b),v.primitiveLength++),f?this.e2=b:this.e1=b}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}Rt(af,"LineBucket",{omit:["layers","patternFeatures"]});const zT=new Je({"line-cap":new be(Me.layout_line["line-cap"]),"line-join":new be(Me.layout_line["line-join"]),"line-miter-limit":new ue(Me.layout_line["line-miter-limit"]),"line-round-limit":new ue(Me.layout_line["line-round-limit"]),"line-sort-key":new be(Me.layout_line["line-sort-key"])});var Xy={paint:new Je({"line-opacity":new be(Me.paint_line["line-opacity"]),"line-color":new be(Me.paint_line["line-color"]),"line-translate":new ue(Me.paint_line["line-translate"]),"line-translate-anchor":new ue(Me.paint_line["line-translate-anchor"]),"line-width":new be(Me.paint_line["line-width"]),"line-gap-width":new be(Me.paint_line["line-gap-width"]),"line-offset":new be(Me.paint_line["line-offset"]),"line-blur":new be(Me.paint_line["line-blur"]),"line-dasharray":new Be(Me.paint_line["line-dasharray"]),"line-pattern":new Be(Me.paint_line["line-pattern"]),"line-gradient":new Ie(Me.paint_line["line-gradient"]),"line-trim-offset":new ue(Me.paint_line["line-trim-offset"])}),layout:zT};const Ky=new class extends be{possiblyEvaluate(i,e){return e=new H(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,t,o){return e=Ue({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,t,o)}}(Xy.paint.properties["line-width"].specification);function Yy(i,e){return e>0?e+2*i:i}Ky.useIntegerZoom=!0;const PT=it([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),DT=it([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),LT=it([{name:"a_projected_pos",components:4,type:"Float32"}],4);it([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const BT=it([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),RT=it([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);it([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Jy=it([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),OT=it([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);it([{name:"triangle",components:3,type:"Uint16"}]),it([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),it([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),it([{type:"Float32",name:"offsetX"}]),it([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Xn=24;const Vo=128;function Cm(i,e){const{expression:t}=e;if(t.kind==="constant")return{kind:"constant",layoutSize:t.evaluate(new H(i+1))};if(t.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:l}=t;let h=0;for(;h<o.length&&o[h]<=i;)h++;h=Math.max(0,h-1);let f=h;for(;f<o.length&&o[f]<i+1;)f++;f=Math.min(o.length-1,f);const m=o[h],v=o[f];return t.kind==="composite"?{kind:"composite",minZoom:m,maxZoom:v,interpolationType:l}:{kind:"camera",minZoom:m,maxZoom:v,minSize:t.evaluate(new H(m)),maxSize:t.evaluate(new H(v)),interpolationType:l}}}function lf(i,{uSize:e,uSizeT:t},{lowerSize:o,upperSize:l}){return i.kind==="source"?o/Vo:i.kind==="composite"?Mi(o/Vo,l/Vo,t):e}function rc(i,e){let t=0,o=0;if(i.kind==="constant")o=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:l,minZoom:h,maxZoom:f}=i,m=l?Se($r.interpolationFactor(l,e,h,f),0,1):0;i.kind==="camera"?o=Mi(i.minSize,i.maxSize,m):t=m}return{uSizeT:t,uSize:o}}var FT=Object.freeze({__proto__:null,getSizeData:Cm,evaluateSizeForFeature:lf,evaluateSizeForZoom:rc,SIZE_PACK_FACTOR:Vo});function VT(i,e,t){return i.sections.forEach(o=>{o.text=function(l,h,f){const m=h.layout.get("text-transform").evaluate(f,{});return m==="uppercase"?l=l.toLocaleUpperCase():m==="lowercase"&&(l=l.toLocaleLowerCase()),W.applyArabicShaping&&(l=W.applyArabicShaping(l)),l}(o.text,e,t)}),i}const th={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function UT(i){return i==="\uFE36"||i==="\uFE48"||i==="\uFE38"||i==="\uFE44"||i==="\uFE42"||i==="\uFE3E"||i==="\uFE3C"||i==="\uFE3A"||i==="\uFE18"||i==="\uFE40"||i==="\uFE10"||i==="\uFE13"||i==="\uFE14"||i==="\uFF40"||i==="\uFFE3"||i==="\uFE11"||i==="\uFE12"}function NT(i){return i==="\uFE35"||i==="\uFE47"||i==="\uFE37"||i==="\uFE43"||i==="\uFE41"||i==="\uFE3D"||i==="\uFE3B"||i==="\uFE39"||i==="\uFE17"||i==="\uFE3F"}var Qy=function(i,e,t,o,l){var h,f,m=8*l-o-1,v=(1<<m)-1,b=v>>1,S=-7,M=t?l-1:0,I=t?-1:1,P=i[e+M];for(M+=I,h=P&(1<<-S)-1,P>>=-S,S+=m;S>0;h=256*h+i[e+M],M+=I,S-=8);for(f=h&(1<<-S)-1,h>>=-S,S+=o;S>0;f=256*f+i[e+M],M+=I,S-=8);if(h===0)h=1-b;else{if(h===v)return f?NaN:1/0*(P?-1:1);f+=Math.pow(2,o),h-=b}return(P?-1:1)*f*Math.pow(2,h-o)},ev=function(i,e,t,o,l,h){var f,m,v,b=8*h-l-1,S=(1<<b)-1,M=S>>1,I=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,P=o?0:h-1,L=o?1:-1,U=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(m=isNaN(e)?1:0,f=S):(f=Math.floor(Math.log(e)/Math.LN2),e*(v=Math.pow(2,-f))<1&&(f--,v*=2),(e+=f+M>=1?I/v:I*Math.pow(2,1-M))*v>=2&&(f++,v/=2),f+M>=S?(m=0,f=S):f+M>=1?(m=(e*v-1)*Math.pow(2,l),f+=M):(m=e*Math.pow(2,M-1)*Math.pow(2,l),f=0));l>=8;i[t+P]=255&m,P+=L,m/=256,l-=8);for(f=f<<l|m,b+=l;b>0;i[t+P]=255&f,P+=L,f/=256,b-=8);i[t+P-L]|=128*U},ih=Ki;function Ki(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Ki.Varint=0,Ki.Fixed64=1,Ki.Bytes=2,Ki.Fixed32=5;var Am=4294967296,tv=1/Am,iv=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ds(i){return i.type===Ki.Bytes?i.readVarint()+i.pos:i.pos+1}function oc(i,e,t){return t?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function nv(i,e,t){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));t.realloc(o);for(var l=t.pos-1;l>=i;l--)t.buf[l+o]=t.buf[l]}function jT(i,e){for(var t=0;t<i.length;t++)e.writeVarint(i[t])}function qT(i,e){for(var t=0;t<i.length;t++)e.writeSVarint(i[t])}function $T(i,e){for(var t=0;t<i.length;t++)e.writeFloat(i[t])}function GT(i,e){for(var t=0;t<i.length;t++)e.writeDouble(i[t])}function ZT(i,e){for(var t=0;t<i.length;t++)e.writeBoolean(i[t])}function WT(i,e){for(var t=0;t<i.length;t++)e.writeFixed32(i[t])}function HT(i,e){for(var t=0;t<i.length;t++)e.writeSFixed32(i[t])}function XT(i,e){for(var t=0;t<i.length;t++)e.writeFixed64(i[t])}function KT(i,e){for(var t=0;t<i.length;t++)e.writeSFixed64(i[t])}function cf(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function sc(i,e,t){i[t]=e,i[t+1]=e>>>8,i[t+2]=e>>>16,i[t+3]=e>>>24}function rv(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function YT(i,e,t){e.glyphs=[],i===1&&t.readMessage(JT,e)}function JT(i,e,t){if(i===3){const{id:o,bitmap:l,width:h,height:f,left:m,top:v,advance:b}=t.readMessage(QT,{});e.glyphs.push({id:o,bitmap:new hs({width:h+6,height:f+6},l),metrics:{width:h,height:f,left:m,top:v,advance:b}})}else i===4?e.ascender=t.readSVarint():i===5&&(e.descender=t.readSVarint())}function QT(i,e,t){i===1?e.id=t.readVarint():i===2?e.bitmap=t.readBytes():i===3?e.width=t.readVarint():i===4?e.height=t.readVarint():i===5?e.left=t.readSVarint():i===6?e.top=t.readSVarint():i===7&&(e.advance=t.readVarint())}function Mm(i){let e=0,t=0;for(const f of i)e+=f.w*f.h,t=Math.max(t,f.w);i.sort((f,m)=>m.h-f.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),t),h:1/0}];let l=0,h=0;for(const f of i)for(let m=o.length-1;m>=0;m--){const v=o[m];if(!(f.w>v.w||f.h>v.h)){if(f.x=v.x,f.y=v.y,h=Math.max(h,f.y+f.h),l=Math.max(l,f.x+f.w),f.w===v.w&&f.h===v.h){const b=o.pop();m<o.length&&(o[m]=b)}else f.h===v.h?(v.x+=f.w,v.w-=f.w):f.w===v.w?(v.y+=f.h,v.h-=f.h):(o.push({x:v.x+f.w,y:v.y,w:v.w-f.w,h:f.h}),v.y+=f.h,v.h-=f.h);break}}return{w:l,h,fill:e/(l*h)||0}}Ki.prototype={destroy:function(){this.buf=null},readFields:function(i,e,t){for(t=t||this.length;this.pos<t;){var o=this.readVarint(),l=o>>3,h=this.pos;this.type=7&o,i(l,e,this),this.pos===h&&this.skip(o)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=cf(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=rv(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=cf(this.buf,this.pos)+cf(this.buf,this.pos+4)*Am;return this.pos+=8,i},readSFixed64:function(){var i=cf(this.buf,this.pos)+rv(this.buf,this.pos+4)*Am;return this.pos+=8,i},readFloat:function(){var i=Qy(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Qy(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,t,o=this.buf;return e=127&(t=o[this.pos++]),t<128?e:(e|=(127&(t=o[this.pos++]))<<7,t<128?e:(e|=(127&(t=o[this.pos++]))<<14,t<128?e:(e|=(127&(t=o[this.pos++]))<<21,t<128?e:function(l,h,f){var m,v,b=f.buf;if(m=(112&(v=b[f.pos++]))>>4,v<128||(m|=(127&(v=b[f.pos++]))<<3,v<128)||(m|=(127&(v=b[f.pos++]))<<10,v<128)||(m|=(127&(v=b[f.pos++]))<<17,v<128)||(m|=(127&(v=b[f.pos++]))<<24,v<128)||(m|=(1&(v=b[f.pos++]))<<31,v<128))return oc(l,m,h);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(t=o[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&iv?function(t,o,l){return iv.decode(t.subarray(o,l))}(this.buf,e,i):function(t,o,l){for(var h="",f=o;f<l;){var m,v,b,S=t[f],M=null,I=S>239?4:S>223?3:S>191?2:1;if(f+I>l)break;I===1?S<128&&(M=S):I===2?(192&(m=t[f+1]))==128&&(M=(31&S)<<6|63&m)<=127&&(M=null):I===3?(v=t[f+2],(192&(m=t[f+1]))==128&&(192&v)==128&&((M=(15&S)<<12|(63&m)<<6|63&v)<=2047||M>=55296&&M<=57343)&&(M=null)):I===4&&(v=t[f+2],b=t[f+3],(192&(m=t[f+1]))==128&&(192&v)==128&&(192&b)==128&&((M=(15&S)<<18|(63&m)<<12|(63&v)<<6|63&b)<=65535||M>=1114112)&&(M=null)),M===null?(M=65533,I=1):M>65535&&(M-=65536,h+=String.fromCharCode(M>>>10&1023|55296),M=56320|1023&M),h+=String.fromCharCode(M),f+=I}return h}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Ki.Bytes)return i.push(this.readVarint(e));var t=ds(this);for(i=i||[];this.pos<t;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Ki.Bytes)return i.push(this.readSVarint());var e=ds(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Ki.Bytes)return i.push(this.readBoolean());var e=ds(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Ki.Bytes)return i.push(this.readFloat());var e=ds(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Ki.Bytes)return i.push(this.readDouble());var e=ds(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Ki.Bytes)return i.push(this.readFixed32());var e=ds(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Ki.Bytes)return i.push(this.readSFixed32());var e=ds(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Ki.Bytes)return i.push(this.readFixed64());var e=ds(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Ki.Bytes)return i.push(this.readSFixed64());var e=ds(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Ki.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ki.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ki.Fixed32)this.pos+=4;else{if(e!==Ki.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var t=new Uint8Array(e);t.set(this.buf),this.buf=t,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),sc(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),sc(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),sc(this.buf,-1&i,this.pos),sc(this.buf,Math.floor(i*tv),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),sc(this.buf,-1&i,this.pos),sc(this.buf,Math.floor(i*tv),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,t){var o,l;if(e>=0?(o=e%4294967296|0,l=e/4294967296|0):(l=~(-e/4294967296),4294967295^(o=~(-e%4294967296))?o=o+1|0:(o=0,l=l+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(h,f,m){m.buf[m.pos++]=127&h|128,h>>>=7,m.buf[m.pos++]=127&h|128,h>>>=7,m.buf[m.pos++]=127&h|128,h>>>=7,m.buf[m.pos++]=127&h|128,m.buf[m.pos]=127&(h>>>=7)}(o,0,t),function(h,f){var m=(7&h)<<4;f.buf[f.pos++]|=m|((h>>>=3)?128:0),h&&(f.buf[f.pos++]=127&h|((h>>>=7)?128:0),h&&(f.buf[f.pos++]=127&h|((h>>>=7)?128:0),h&&(f.buf[f.pos++]=127&h|((h>>>=7)?128:0),h&&(f.buf[f.pos++]=127&h|((h>>>=7)?128:0),h&&(f.buf[f.pos++]=127&h)))))}(l,t)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(o,l,h){for(var f,m,v=0;v<l.length;v++){if((f=l.charCodeAt(v))>55295&&f<57344){if(!m){f>56319||v+1===l.length?(o[h++]=239,o[h++]=191,o[h++]=189):m=f;continue}if(f<56320){o[h++]=239,o[h++]=191,o[h++]=189,m=f;continue}f=m-55296<<10|f-56320|65536,m=null}else m&&(o[h++]=239,o[h++]=191,o[h++]=189,m=null);f<128?o[h++]=f:(f<2048?o[h++]=f>>6|192:(f<65536?o[h++]=f>>12|224:(o[h++]=f>>18|240,o[h++]=f>>12&63|128),o[h++]=f>>6&63|128),o[h++]=63&f|128)}return h}(this.buf,i,this.pos);var t=this.pos-e;t>=128&&nv(e,t,this),this.pos=e-1,this.writeVarint(t),this.pos+=t},writeFloat:function(i){this.realloc(4),ev(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),ev(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var t=0;t<e;t++)this.buf[this.pos++]=i[t]},writeRawMessage:function(i,e){this.pos++;var t=this.pos;i(e,this);var o=this.pos-t;o>=128&&nv(t,o,this),this.pos=t-1,this.writeVarint(o),this.pos+=o},writeMessage:function(i,e,t){this.writeTag(i,Ki.Bytes),this.writeRawMessage(e,t)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,jT,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,qT,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,ZT,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,$T,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,GT,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,WT,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,HT,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,XT,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,KT,e)},writeBytesField:function(i,e){this.writeTag(i,Ki.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Ki.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Ki.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Ki.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Ki.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Ki.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Ki.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Ki.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Ki.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Ki.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,Boolean(e))}};class Im{constructor(e,{pixelRatio:t,version:o,stretchX:l,stretchY:h,content:f}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=l,this.stretchY=h,this.content=f,this.version=o}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class ov{constructor(e,t){const o={},l={};this.haveRenderCallbacks=[];const h=[];this.addImages(e,o,h),this.addImages(t,l,h);const{w:f,h:m}=Mm(h),v=new Ir({width:f||1,height:m||1});for(const b in e){const S=e[b],M=o[b].paddedRect;Ir.copy(S.data,v,{x:0,y:0},{x:M.x+1,y:M.y+1},S.data)}for(const b in t){const S=t[b],M=l[b].paddedRect,I=M.x+1,P=M.y+1,L=S.data.width,U=S.data.height;Ir.copy(S.data,v,{x:0,y:0},{x:I,y:P},S.data),Ir.copy(S.data,v,{x:0,y:U-1},{x:I,y:P-1},{width:L,height:1}),Ir.copy(S.data,v,{x:0,y:0},{x:I,y:P+U},{width:L,height:1}),Ir.copy(S.data,v,{x:L-1,y:0},{x:I-1,y:P},{width:1,height:U}),Ir.copy(S.data,v,{x:0,y:0},{x:I+L,y:P},{width:1,height:U})}this.image=v,this.iconPositions=o,this.patternPositions=l}addImages(e,t,o){for(const l in e){const h=e[l],f={x:0,y:0,w:h.data.width+2,h:h.data.height+2};o.push(f),t[l]=new Im(f,h),h.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(e,t){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(o=>e.hasImage(o)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),t),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),t)}patchUpdatedImage(e,t,o){if(!e||!t||e.version===t.version)return;e.version=t.version;const[l,h]=e.tl;o.update(t.data,void 0,{x:l,y:h})}}Rt(Im,"ImagePosition"),Rt(ov,"ImageAtlas");const Ur={horizontal:1,vertical:2,horizontalOnly:3};class nh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const o=new nh;return o.scale=e||1,o.fontStack=t,o}static forImage(e){const t=new nh;return t.imageName=e,t}}class ac{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const o=new ac;for(let l=0;l<e.sections.length;l++){const h=e.sections[l];h.image?o.addImageSection(h):o.addTextSection(h,t)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(t,o){let l="";for(let h=0;h<t.length;h++){const f=t.charCodeAt(h+1)||null,m=t.charCodeAt(h-1)||null;l+=!o&&(f&&qa(f)&&!th[t[h+1]]||m&&qa(m)&&!th[t[h-1]])||!th[t[h]]?t[h]:th[t[h]]}return l}(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&uf[this.text.charCodeAt(o)];o++)e++;let t=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&uf[this.text.charCodeAt(o)];o--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const o=new ac;return o.text=this.text.substring(e,t),o.sectionIndex=this.sectionIndex.slice(e,t),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,t)=>Math.max(e,this.sections[t].scale),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(nh.forText(e.scale,e.fontStack||t));const o=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(o)}addImageSection(e){const t=e.image?e.image.name:"";if(t.length===0)return void xt("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(nh.forImage(t)),this.sectionIndex.push(this.sections.length-1)):xt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function km(i,e,t,o,l,h,f,m,v,b,S,M,I,P,L,U){const $=ac.fromFeature(i,l);let ee;M===Ur.vertical&&$.verticalizePunctuation(I);const{processBidirectionalText:se,processStyledBidirectionalText:ie}=W;if(se&&$.sections.length===1){ee=[];const ce=se($.toString(),zm($,b,h,e,o,P,L));for(const Ve of ce){const Oe=new ac;Oe.text=Ve,Oe.sections=$.sections;for(let We=0;We<Ve.length;We++)Oe.sectionIndex.push(0);ee.push(Oe)}}else if(ie){ee=[];const ce=ie($.text,$.sectionIndex,zm($,b,h,e,o,P,L));for(const Ve of ce){const Oe=new ac;Oe.text=Ve[0],Oe.sectionIndex=Ve[1],Oe.sections=$.sections,ee.push(Oe)}}else ee=function(ce,Ve){const Oe=[],We=ce.text;let yt=0;for(const je of Ve)Oe.push(ce.substring(yt,je)),yt=je;return yt<We.length&&Oe.push(ce.substring(yt,We.length)),Oe}($,zm($,b,h,e,o,P,L));const re=[],_e={positionedLines:re,text:$.toString(),top:S[1],bottom:S[1],left:S[0],right:S[0],writingMode:M,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ce,Ve,Oe,We,yt,je,et,at,tt,ft,lt,kt){let li=0,hi=0,Gt=0;const Tt=at==="right"?1:at==="left"?0:.5;let wi=!1;for(const fi of yt){const ki=fi.getSections();for(const Ji of ki){if(Ji.imageName)continue;const Wi=Ve[Ji.fontStack];if(Wi&&(wi=Wi.ascender!==void 0&&Wi.descender!==void 0,!wi))break}if(!wi)break}let oi=0;for(const fi of yt){fi.trim();const ki=fi.getMaxScale(),Ji=(ki-1)*Xn,Wi={positionedGlyphs:[],lineOffset:0};ce.positionedLines[oi]=Wi;const $i=Wi.positionedGlyphs;let nn=0;if(!fi.length()){hi+=je,++oi;continue}let ln=0,Vn=0;for(let Ei=0;Ei<fi.length();Ei++){const mn=fi.getSection(Ei),ir=fi.getSectionIndex(Ei),Fi=fi.getCharCode(Ei);let cn=mn.scale,dr=null,sn=null,vn=null,Un=Xn,Bn=0;const Kn=!(tt===Ur.horizontal||!lt&&!Kl(Fi)||lt&&(uf[Fi]||(Dt=Fi,Id(Dt)||kd(Dt)||zd(Dt)||ja(Dt)||Vu(Dt))));if(mn.imageName){const fr=We[mn.imageName];if(!fr)continue;vn=mn.imageName,ce.iconsInText=ce.iconsInText||!0,sn=fr.paddedRect;const Nn=fr.displaySize;cn=cn*Xn/kt,dr={width:Nn[0],height:Nn[1],left:1,top:-3,advance:Kn?Nn[1]:Nn[0],localGlyph:!1},Bn=wi?-dr.height*cn:ki*Xn-17-Nn[1]*cn,Un=dr.advance;const ms=(Kn?Nn[0]:Nn[1])*cn-Xn*ki;ms>0&&ms>nn&&(nn=ms)}else{const fr=Oe[mn.fontStack];if(!fr)continue;fr[Fi]&&(sn=fr[Fi]);const Nn=Ve[mn.fontStack];if(!Nn)continue;const ms=Nn.glyphs[Fi];if(!ms)continue;if(dr=ms.metrics,Un=Fi!==8203?Xn:0,wi){const pc=Nn.ascender!==void 0?Math.abs(Nn.ascender):0,mh=Nn.descender!==void 0?Math.abs(Nn.descender):0,_h=(pc+mh)*cn;ln<_h&&(ln=_h,Vn=(pc-mh)/2*cn),Bn=-pc*cn}else Bn=(ki-cn)*Xn-17}Kn?(ce.verticalizable=!0,$i.push({glyph:Fi,imageName:vn,x:li,y:hi+Bn,vertical:Kn,scale:cn,localGlyph:dr.localGlyph,fontStack:mn.fontStack,sectionIndex:ir,metrics:dr,rect:sn}),li+=Un*cn+ft):($i.push({glyph:Fi,imageName:vn,x:li,y:hi+Bn,vertical:Kn,scale:cn,localGlyph:dr.localGlyph,fontStack:mn.fontStack,sectionIndex:ir,metrics:dr,rect:sn}),li+=dr.advance*cn+ft)}$i.length!==0&&(Gt=Math.max(li-ft,Gt),wi?uv($i,Tt,nn,Vn,je*ki/2):uv($i,Tt,nn,0,je/2)),li=0;const br=je*ki+nn;Wi.lineOffset=Math.max(nn,Ji),hi+=br,++oi}var Dt;const Yi=hi,{horizontalAlign:Zi,verticalAlign:on}=Pm(et);(function(fi,ki,Ji,Wi,$i,nn){const ln=(ki-Ji)*$i,Vn=-nn*Wi;for(const br of fi)for(const Ei of br.positionedGlyphs)Ei.x+=ln,Ei.y+=Vn})(ce.positionedLines,Tt,Zi,on,Gt,Yi),ce.top+=-on*Yi,ce.bottom=ce.top+Yi,ce.left+=-Zi*Gt,ce.right=ce.left+Gt,ce.hasBaseline=wi}(_e,e,t,o,ee,f,m,v,M,b,I,U),!function(ce){for(const Ve of ce)if(Ve.positionedGlyphs.length!==0)return!1;return!0}(re)&&_e}const uf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},e2={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function sv(i,e,t,o,l,h){if(e.imageName){const f=o[e.imageName];return f?f.displaySize[0]*e.scale*Xn/h+l:0}{const f=t[e.fontStack],m=f&&f.glyphs[i];return m?m.metrics.advance*e.scale+l:0}}function av(i,e,t,o){const l=Math.pow(i-e,2);return o?i<e?l/2:2*l:l+Math.abs(t)*t}function t2(i,e,t){let o=0;return i===10&&(o-=1e4),t&&(o+=150),i!==40&&i!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function lv(i,e,t,o,l,h){let f=null,m=av(e,t,l,h);for(const v of o){const b=av(e-v.x,t,l,h)+v.badness;b<=m&&(f=v,m=b)}return{index:i,x:e,priorBreak:f,badness:m}}function cv(i){return i?cv(i.priorBreak).concat(i.index):[]}function zm(i,e,t,o,l,h,f){if(h!=="point")return[];if(!i)return[];const m=[],v=function(I,P,L,U,$,ee){let se=0;for(let ie=0;ie<I.length();ie++){const re=I.getSection(ie);se+=sv(I.getCharCode(ie),re,U,$,P,ee)}return se/Math.max(1,Math.ceil(se/L))}(i,e,t,o,l,f),b=i.text.indexOf("\u200B")>=0;let S=0;for(let I=0;I<i.length();I++){const P=i.getSection(I),L=i.getCharCode(I);if(uf[L]||(S+=sv(L,P,o,l,e,f)),I<i.length()-1){const U=!((M=L)<11904||!(Du(M)||Ld(M)||Fu(M)||Fd(M)||Ru(M)||Pd(M)||Bd(M)||Wl(M)||Ou(M)||Na(M)||Bu(M)||Uu(M)||Pu(M)||Ua(M)||Dd(M)||Lu(M)||ts(M)||Vd(M)||Rd(M)||Hl(M)));(e2[L]||U||P.imageName)&&m.push(lv(I+1,S,v,m,t2(L,i.getCharCode(I+1),U&&b),!1))}}var M;return cv(lv(i.length(),S,v,m,0,!0))}function Pm(i){let e=.5,t=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":t=1;break;case"top":case"top-right":case"top-left":t=0}return{horizontalAlign:e,verticalAlign:t}}function uv(i,e,t,o,l){if(!(e||t||o||l))return;const h=i.length-1,f=i[h],m=(f.x+f.metrics.advance*f.scale)*e;for(let v=0;v<=h;v++)i[v].x-=m,i[v].y+=t+o+l}function i2(i,e,t){const{horizontalAlign:o,verticalAlign:l}=Pm(t),h=e[0]-i.displaySize[0]*o,f=e[1]-i.displaySize[1]*l;return{image:i,top:f,bottom:f+i.displaySize[1],left:h,right:h+i.displaySize[0]}}function hv(i,e,t,o,l,h){const f=i.image;let m;if(f.content){const $=f.content,ee=f.pixelRatio||1;m=[$[0]/ee,$[1]/ee,f.displaySize[0]-$[2]/ee,f.displaySize[1]-$[3]/ee]}const v=e.left*h,b=e.right*h;let S,M,I,P;t==="width"||t==="both"?(P=l[0]+v-o[3],M=l[0]+b+o[1]):(P=l[0]+(v+b-f.displaySize[0])/2,M=P+f.displaySize[0]);const L=e.top*h,U=e.bottom*h;return t==="height"||t==="both"?(S=l[1]+L-o[0],I=l[1]+U+o[2]):(S=l[1]+(L+U-f.displaySize[1])/2,I=S+f.displaySize[1]),{image:f,top:S,right:M,bottom:I,left:P,collisionPadding:m}}class fs extends N{constructor(e,t,o,l,h){super(e,t),this.angle=l,this.z=o,h!==void 0&&(this.segment=h)}clone(){return new fs(this.x,this.y,this.z,this.angle,this.segment)}}function dv(i,e,t,o,l){if(e.segment===void 0)return!0;let h=e,f=e.segment+1,m=0;for(;m>-t/2;){if(f--,f<0)return!1;m-=i[f].dist(h),h=i[f]}m+=i[f].dist(i[f+1]),f++;const v=[];let b=0;for(;m<t/2;){const S=i[f],M=i[f+1];if(!M)return!1;let I=i[f-1].angleTo(S)-S.angleTo(M);for(I=Math.abs((I+3*Math.PI)%(2*Math.PI)-Math.PI),v.push({distance:m,angleDelta:I}),b+=I;m-v[0].distance>o;)b-=v.shift().angleDelta;if(b>l)return!1;f++,m+=S.dist(M)}return!0}function fv(i){let e=0;for(let t=0;t<i.length-1;t++)e+=i[t].dist(i[t+1]);return e}function pv(i,e,t){return i?.6*e*t:0}function mv(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function n2(i,e,t,o,l,h){const f=pv(t,l,h),m=mv(t,o)*h;let v=0;const b=fv(i)/2;for(let S=0;S<i.length-1;S++){const M=i[S],I=i[S+1],P=M.dist(I);if(v+P>b){const L=(b-v)/P,U=Mi(M.x,I.x,L),$=Mi(M.y,I.y,L),ee=new fs(U,$,0,I.angleTo(M),S);return!f||dv(i,ee,m,f,e)?ee:void 0}v+=P}}function r2(i,e,t,o,l,h,f,m,v){const b=pv(o,h,f),S=mv(o,l),M=S*f,I=i[0].x===0||i[0].x===v||i[0].y===0||i[0].y===v;return e-M<e/4&&(e=M+e/4),_v(i,I?e/2*m%e:(S/2+2*h)*f*m%e,e,b,t,M,I,!1,v)}function _v(i,e,t,o,l,h,f,m,v){const b=h/2,S=fv(i);let M=0,I=e-t,P=[];for(let L=0;L<i.length-1;L++){const U=i[L],$=i[L+1],ee=U.dist($),se=$.angleTo(U);for(;I+t<M+ee;){I+=t;const ie=(I-M)/ee,re=Mi(U.x,$.x,ie),_e=Mi(U.y,$.y,ie);if(re>=0&&re<v&&_e>=0&&_e<v&&I-b>=0&&I+b<=S){const ce=new fs(re,_e,0,se,L);ce._round(),o&&!dv(i,ce,h,o,l)||P.push(ce)}}M+=ee}return m||P.length||f||(P=_v(i,M/2,t,o,l,h,f,!0,v)),P}function gv(i,e,t,o,l){const h=[];for(let f=0;f<i.length;f++){const m=i[f];let v;for(let b=0;b<m.length-1;b++){let S=m[b],M=m[b+1];S.x<e&&M.x<e||(S.x<e?S=new N(e,S.y+(e-S.x)/(M.x-S.x)*(M.y-S.y))._round():M.x<e&&(M=new N(e,S.y+(e-S.x)/(M.x-S.x)*(M.y-S.y))._round()),S.y<t&&M.y<t||(S.y<t?S=new N(S.x+(t-S.y)/(M.y-S.y)*(M.x-S.x),t)._round():M.y<t&&(M=new N(S.x+(t-S.y)/(M.y-S.y)*(M.x-S.x),t)._round()),S.x>=o&&M.x>=o||(S.x>=o?S=new N(o,S.y+(o-S.x)/(M.x-S.x)*(M.y-S.y))._round():M.x>=o&&(M=new N(o,S.y+(o-S.x)/(M.x-S.x)*(M.y-S.y))._round()),S.y>=l&&M.y>=l||(S.y>=l?S=new N(S.x+(l-S.y)/(M.y-S.y)*(M.x-S.x),l)._round():M.y>=l&&(M=new N(S.x+(l-S.y)/(M.y-S.y)*(M.x-S.x),l)._round()),v&&S.equals(v[v.length-1])||(v=[S],h.push(v)),v.push(M)))))}}return h}Rt(fs,"Anchor");const rh=1e20;function yv(i,e,t,o,l,h,f,m,v){for(let b=e;b<e+o;b++)vv(i,t*h+b,h,l,f,m,v);for(let b=t;b<t+l;b++)vv(i,b*h+e,1,o,f,m,v)}function vv(i,e,t,o,l,h,f){h[0]=0,f[0]=-rh,f[1]=rh,l[0]=i[e];for(let m=1,v=0,b=0;m<o;m++){l[m]=i[e+m*t];const S=m*m;do{const M=h[v];b=(l[m]-l[M]+S-M*M)/(m-M)/2}while(b<=f[v]&&--v>-1);v++,h[v]=m,f[v]=b,f[v+1]=rh}for(let m=0,v=0;m<o;m++){for(;f[v+1]<m;)v++;const b=h[v],S=m-b;i[e+m*t]=l[b]+S*S}}const Dm={none:0,ideographs:1,all:2};class lc{constructor(e,t,o){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=o,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,t){const o=[];for(const l in e)for(const h of e[l])o.push({stack:l,id:h});De(o,({stack:l,id:h},f)=>{let m=this.entries[l];m||(m=this.entries[l]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let v=m.glyphs[h];if(v!==void 0)return void f(null,{stack:l,id:h,glyph:v});if(v=this._tinySDF(m,l,h),v)return m.glyphs[h]=v,void f(null,{stack:l,id:h,glyph:v});const b=Math.floor(h/256);if(256*b>65535)return void f(new Error("glyphs > 65535 not supported"));if(m.ranges[b])return void f(null,{stack:l,id:h,glyph:v});let S=m.requests[b];S||(S=m.requests[b]=[],lc.loadGlyphRange(l,b,this.url,this.requestManager,(M,I)=>{if(I){m.ascender=I.ascender,m.descender=I.descender;for(const P in I.glyphs)this._doesCharSupportLocalGlyph(+P)||(m.glyphs[+P]=I.glyphs[+P]);m.ranges[b]=!0}for(const P of S)P(M,I);delete m.requests[b]})),S.push((M,I)=>{M?f(M):I&&f(null,{stack:l,id:h,glyph:I.glyphs[h]||null})})},(l,h)=>{if(l)t(l);else if(h){const f={};for(const{stack:m,id:v,glyph:b}of h)f[m]===void 0&&(f[m]={}),f[m].glyphs===void 0&&(f[m].glyphs={}),f[m].glyphs[v]=b&&{id:b.id,bitmap:b.bitmap.clone(),metrics:b.metrics},f[m].ascender=this.entries[m].ascender,f[m].descender=this.entries[m].descender;t(null,f)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Dm.none&&(this.localGlyphMode===Dm.all?!!this.localFontFamily:!!this.localFontFamily&&(Na(e)||Od(e)||Pu(e)||ts(e)||Wl(e)))}_tinySDF(e,t,o){const l=this.localFontFamily;if(!l||!this._doesCharSupportLocalGlyph(o))return;let h=e.tinySDF;if(!h){let U="400";/bold/i.test(t)?U="900":/medium/i.test(t)?U="500":/light/i.test(t)&&(U="200"),h=e.tinySDF=new lc.TinySDF({fontFamily:l,fontWeight:U,fontSize:48,buffer:6,radius:16}),h.fontWeight=U}if(this.localGlyphs[h.fontWeight][o])return this.localGlyphs[h.fontWeight][o];const f=String.fromCharCode(o),{data:m,width:v,height:b,glyphWidth:S,glyphHeight:M,glyphLeft:I,glyphTop:P,glyphAdvance:L}=h.draw(f);return this.localGlyphs[h.fontWeight][o]={id:o,bitmap:new hs({width:v,height:b},m),metrics:{width:S/2,height:M/2,left:I/2,top:P/2-27,advance:L/2,localGlyph:!0}}}}function xv(i,e,t,o){const l=[],h=i.image,f=h.pixelRatio,m=h.paddedRect.w-2,v=h.paddedRect.h-2,b=i.right-i.left,S=i.bottom-i.top,M=h.stretchX||[[0,m]],I=h.stretchY||[[0,v]],P=(je,et)=>je+et[1]-et[0],L=M.reduce(P,0),U=I.reduce(P,0),$=m-L,ee=v-U;let se=0,ie=L,re=0,_e=U,ce=0,Ve=$,Oe=0,We=ee;if(h.content&&o){const je=h.content;se=hf(M,0,je[0]),re=hf(I,0,je[1]),ie=hf(M,je[0],je[2]),_e=hf(I,je[1],je[3]),ce=je[0]-se,Oe=je[1]-re,Ve=je[2]-je[0]-ie,We=je[3]-je[1]-_e}const yt=(je,et,at,tt)=>{const ft=df(je.stretch-se,ie,b,i.left),lt=ff(je.fixed-ce,Ve,je.stretch,L),kt=df(et.stretch-re,_e,S,i.top),li=ff(et.fixed-Oe,We,et.stretch,U),hi=df(at.stretch-se,ie,b,i.left),Gt=ff(at.fixed-ce,Ve,at.stretch,L),Tt=df(tt.stretch-re,_e,S,i.top),wi=ff(tt.fixed-Oe,We,tt.stretch,U),oi=new N(ft,kt),Dt=new N(hi,kt),Yi=new N(hi,Tt),Zi=new N(ft,Tt),on=new N(lt/f,li/f),fi=new N(Gt/f,wi/f),ki=e*Math.PI/180;if(ki){const $i=Math.sin(ki),nn=Math.cos(ki),ln=[nn,-$i,$i,nn];oi._matMult(ln),Dt._matMult(ln),Zi._matMult(ln),Yi._matMult(ln)}const Ji=je.stretch+je.fixed,Wi=et.stretch+et.fixed;return{tl:oi,tr:Dt,bl:Zi,br:Yi,tex:{x:h.paddedRect.x+1+Ji,y:h.paddedRect.y+1+Wi,w:at.stretch+at.fixed-Ji,h:tt.stretch+tt.fixed-Wi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:on,pixelOffsetBR:fi,minFontScaleX:Ve/f/b,minFontScaleY:We/f/S,isSDF:t}};if(o&&(h.stretchX||h.stretchY)){const je=bv(M,$,L),et=bv(I,ee,U);for(let at=0;at<je.length-1;at++){const tt=je[at],ft=je[at+1];for(let lt=0;lt<et.length-1;lt++)l.push(yt(tt,et[lt],ft,et[lt+1]))}}else l.push(yt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:m+1},{fixed:0,stretch:v+1}));return l}function hf(i,e,t){let o=0;for(const l of i)o+=Math.max(e,Math.min(t,l[1]))-Math.max(e,Math.min(t,l[0]));return o}function bv(i,e,t){const o=[{fixed:-1,stretch:0}];for(const[l,h]of i){const f=o[o.length-1];o.push({fixed:l-f.stretch,stretch:f.stretch}),o.push({fixed:l-f.stretch,stretch:f.stretch+(h-l)})}return o.push({fixed:e+1,stretch:t}),o}function df(i,e,t,o){return i/e*t+o}function ff(i,e,t,o){return i-e*t/o}function o2(i,e,t,o){const l=e+i.positionedLines[o].lineOffset;return o===0?t+l/2:t+(l+(e+i.positionedLines[o-1].lineOffset))/2}lc.loadGlyphRange=function(i,e,t,o,l){const h=256*e,f=h+255,m=o.transformRequest(o.normalizeGlyphsURL(t).replace("{fontstack}",i).replace("{range}",`${h}-${f}`),ge.Glyphs);ze(m,(v,b)=>{if(v)l(v);else if(b){const S={},M=function(I){return new ih(I).readFields(YT,{})}(b);for(const I of M.glyphs)S[I.id]=I;l(null,{glyphs:S,ascender:M.ascender,descender:M.descender})}})},lc.TinySDF=class{constructor({fontSize:i=24,buffer:e=3,radius:t=8,cutoff:o=.25,fontFamily:l="sans-serif",fontWeight:h="normal",fontStyle:f="normal"}={}){this.buffer=e,this.cutoff=o,this.radius=t;const m=this.size=i+4*e,v=this._createCanvas(m),b=this.ctx=v.getContext("2d",{willReadFrequently:!0});b.font=`${f} ${h} ${i}px ${l}`,b.textBaseline="alphabetic",b.textAlign="left",b.fillStyle="black",this.gridOuter=new Float64Array(m*m),this.gridInner=new Float64Array(m*m),this.f=new Float64Array(m),this.z=new Float64Array(m+1),this.v=new Uint16Array(m)}_createCanvas(i){const e=document.createElement("canvas");return e.width=e.height=i,e}draw(i){const{width:e,actualBoundingBoxAscent:t,actualBoundingBoxDescent:o,actualBoundingBoxLeft:l,actualBoundingBoxRight:h}=this.ctx.measureText(i),f=Math.ceil(t),m=Math.min(this.size-this.buffer,Math.ceil(h-l)),v=Math.min(this.size-this.buffer,f+Math.ceil(o)),b=m+2*this.buffer,S=v+2*this.buffer,M=Math.max(b*S,0),I=new Uint8ClampedArray(M),P={data:I,width:b,height:S,glyphWidth:m,glyphHeight:v,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(m===0||v===0)return P;const{ctx:L,buffer:U,gridInner:$,gridOuter:ee}=this;L.clearRect(U,U,m,v),L.fillText(i,U,U+f);const se=L.getImageData(U,U,m,v);ee.fill(rh,0,M),$.fill(0,0,M);for(let ie=0;ie<v;ie++)for(let re=0;re<m;re++){const _e=se.data[4*(ie*m+re)+3]/255;if(_e===0)continue;const ce=(ie+U)*b+re+U;if(_e===1)ee[ce]=0,$[ce]=rh;else{const Ve=.5-_e;ee[ce]=Ve>0?Ve*Ve:0,$[ce]=Ve<0?Ve*Ve:0}}yv(ee,0,0,b,S,b,this.f,this.v,this.z),yv($,U,U,m,v,b,this.f,this.v,this.z);for(let ie=0;ie<M;ie++){const re=Math.sqrt(ee[ie])-Math.sqrt($[ie]);I[ie]=Math.round(255-255*(re/this.radius+this.cutoff))}return P}};class s2{constructor(e=[],t=a2){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:o}=this,l=t[e];for(;e>0;){const h=e-1>>1,f=t[h];if(o(l,f)>=0)break;t[e]=f,e=h}t[e]=l}_down(e){const{data:t,compare:o}=this,l=this.length>>1,h=t[e];for(;e<l;){let f=1+(e<<1),m=t[f];const v=f+1;if(v<this.length&&o(t[v],m)<0&&(f=v,m=t[v]),o(m,h)>=0)break;t[e]=m,e=f}t[e]=h}}function a2(i,e){return i<e?-1:i>e?1:0}function l2(i,e=1,t=!1){let o=1/0,l=1/0,h=-1/0,f=-1/0;const m=i[0];for(let P=0;P<m.length;P++){const L=m[P];(!P||L.x<o)&&(o=L.x),(!P||L.y<l)&&(l=L.y),(!P||L.x>h)&&(h=L.x),(!P||L.y>f)&&(f=L.y)}const v=Math.min(h-o,f-l);let b=v/2;const S=new s2([],c2);if(v===0)return new N(o,l);for(let P=o;P<h;P+=v)for(let L=l;L<f;L+=v)S.push(new cc(P+b,L+b,b,i));let M=function(P){let L=0,U=0,$=0;const ee=P[0];for(let se=0,ie=ee.length,re=ie-1;se<ie;re=se++){const _e=ee[se],ce=ee[re],Ve=_e.x*ce.y-ce.x*_e.y;U+=(_e.x+ce.x)*Ve,$+=(_e.y+ce.y)*Ve,L+=3*Ve}return new cc(U/L,$/L,0,P)}(i),I=S.length;for(;S.length;){const P=S.pop();(P.d>M.d||!M.d)&&(M=P,t&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,I)),P.max-M.d<=e||(b=P.h/2,S.push(new cc(P.p.x-b,P.p.y-b,b,i)),S.push(new cc(P.p.x+b,P.p.y-b,b,i)),S.push(new cc(P.p.x-b,P.p.y+b,b,i)),S.push(new cc(P.p.x+b,P.p.y+b,b,i)),I+=4)}return t&&(console.log(`num probes: ${I}`),console.log(`best distance: ${M.d}`)),M.p}function c2(i,e){return e.max-i.max}function cc(i,e,t,o){this.p=new N(i,e),this.h=t,this.d=function(l,h){let f=!1,m=1/0;for(let v=0;v<h.length;v++){const b=h[v];for(let S=0,M=b.length,I=M-1;S<M;I=S++){const P=b[S],L=b[I];P.y>l.y!=L.y>l.y&&l.x<(L.x-P.x)*(l.y-P.y)/(L.y-P.y)+P.x&&(f=!f),m=Math.min(m,ly(l,P,L))}}return(f?1:-1)*Math.sqrt(m)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}const Lm=Number.POSITIVE_INFINITY,u2=Math.sqrt(2);function wv(i,e){return e[1]!==Lm?function(t,o,l){let h=0,f=0;switch(o=Math.abs(o),l=Math.abs(l),t){case"top-right":case"top-left":case"top":f=l-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-l}switch(t){case"top-right":case"bottom-right":case"right":h=-o;break;case"top-left":case"bottom-left":case"left":h=o}return[h,f]}(i,e[0],e[1]):function(t,o){let l=0,h=0;o<0&&(o=0);const f=o/u2;switch(t){case"top-right":case"top-left":h=f-7;break;case"bottom-right":case"bottom-left":h=7-f;break;case"bottom":h=7-o;break;case"top":h=o-7}switch(t){case"top-right":case"bottom-right":l=-f;break;case"top-left":case"bottom-left":l=f;break;case"left":l=o;break;case"right":l=-o}return[l,h]}(i,e[0])}function h2(i,e,t,o,l,h,f,m,v,b){i.createArrays(),i.tilePixelRatio=ei/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const S=i.layers[0].layout,M=i.layers[0]._unevaluatedLayout._values,I={};if(i.textSizeData.kind==="composite"){const{minZoom:U,maxZoom:$}=i.textSizeData;I.compositeTextSizes=[M["text-size"].possiblyEvaluate(new H(U),m),M["text-size"].possiblyEvaluate(new H($),m)]}if(i.iconSizeData.kind==="composite"){const{minZoom:U,maxZoom:$}=i.iconSizeData;I.compositeIconSizes=[M["icon-size"].possiblyEvaluate(new H(U),m),M["icon-size"].possiblyEvaluate(new H($),m)]}I.layoutTextSize=M["text-size"].possiblyEvaluate(new H(v+1),m),I.layoutIconSize=M["icon-size"].possiblyEvaluate(new H(v+1),m),I.textMaxSize=M["text-size"].possiblyEvaluate(new H(18),m);const P=S.get("text-rotation-alignment")==="map"&&S.get("symbol-placement")!=="point",L=S.get("text-size");for(const U of i.features){const $=S.get("text-font").evaluate(U,{},m).join(","),ee=L.evaluate(U,{},m),se=I.layoutTextSize.evaluate(U,{},m),ie=(I.layoutIconSize.evaluate(U,{},m),{horizontal:{},vertical:void 0}),re=U.text;let _e,ce=[0,0];if(re){const We=re.toString(),yt=S.get("text-letter-spacing").evaluate(U,{},m)*Xn,je=S.get("text-line-height").evaluate(U,{},m)*Xn,et=Kp(We)?yt:0,at=S.get("text-anchor").evaluate(U,{},m),tt=S.get("text-variable-anchor");if(!tt){const Gt=S.get("text-radial-offset").evaluate(U,{},m);ce=Gt?wv(at,[Gt*Xn,Lm]):S.get("text-offset").evaluate(U,{},m).map(Tt=>Tt*Xn)}let ft=P?"center":S.get("text-justify").evaluate(U,{},m);const lt=S.get("symbol-placement"),kt=lt==="point",li=lt==="point"?S.get("text-max-width").evaluate(U,{},m)*Xn:0,hi=Gt=>{i.allowVerticalPlacement&&Xl(We)&&(ie.vertical=km(re,e,t,l,$,li,je,at,Gt,et,ce,Ur.vertical,!0,lt,se,ee))};if(!P&&tt){const Gt=ft==="auto"?tt.map(wi=>Bm(wi)):[ft];let Tt=!1;for(let wi=0;wi<Gt.length;wi++){const oi=Gt[wi];if(!ie.horizontal[oi])if(Tt)ie.horizontal[oi]=ie.horizontal[0];else{const Dt=km(re,e,t,l,$,li,je,"center",oi,et,ce,Ur.horizontal,!1,lt,se,ee);Dt&&(ie.horizontal[oi]=Dt,Tt=Dt.positionedLines.length===1)}}hi("left")}else{if(ft==="auto"&&(ft=Bm(at)),kt||S.get("text-writing-mode").indexOf("horizontal")>=0||!Xl(We)){const Gt=km(re,e,t,l,$,li,je,at,ft,et,ce,Ur.horizontal,!1,lt,se,ee);Gt&&(ie.horizontal[ft]=Gt)}hi(lt==="point"?"left":ft)}}let Ve=!1;if(U.icon&&U.icon.name){const We=o[U.icon.name];We&&(_e=i2(l[U.icon.name],S.get("icon-offset").evaluate(U,{},m),S.get("icon-anchor").evaluate(U,{},m)),Ve=We.sdf,i.sdfIcons===void 0?i.sdfIcons=We.sdf:i.sdfIcons!==We.sdf&&xt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(We.pixelRatio!==i.pixelRatio||S.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const Oe=Ev(ie.horizontal)||ie.vertical;i.iconsInText||(i.iconsInText=!!Oe&&Oe.iconsInText),(Oe||_e)&&d2(i,U,ie,_e,o,I,se,0,ce,Ve,f,m,b)}h&&i.generateCollisionDebugBuffers(v,i.collisionBoxArray)}function Bm(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function d2(i,e,t,o,l,h,f,m,v,b,S,M,I){let P=h.textMaxSize.evaluate(e,{},M);P===void 0&&(P=f);const L=i.layers[0].layout,U=L.get("icon-offset").evaluate(e,{},M),$=Ev(t.horizontal)||t.vertical,ee=I.name==="globe",se=f/24,ie=i.tilePixelRatio*P/24,re=(et=i.overscaling,i.zoom>18&&et>2&&(et>>=1),Math.max(ei/(512*et),1)*L.get("symbol-spacing")),_e=L.get("text-padding")*i.tilePixelRatio,ce=L.get("icon-padding")*i.tilePixelRatio,Ve=le(L.get("text-max-angle")),Oe=L.get("text-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",We=L.get("icon-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",yt=L.get("symbol-placement"),je=re/2;var et;const at=L.get("icon-text-fit");let tt;o&&at!=="none"&&(i.allowVerticalPlacement&&t.vertical&&(tt=hv(o,t.vertical,at,L.get("icon-text-fit-padding"),U,se)),$&&(o=hv(o,$,at,L.get("icon-text-fit-padding"),U,se)));const ft=(lt,kt,li)=>{if(kt.x<0||kt.x>=ei||kt.y<0||kt.y>=ei)return;let hi=null;if(ee){const{x:Gt,y:Tt,z:wi}=I.projectTilePoint(kt.x,kt.y,li);hi={anchor:new fs(Gt,Tt,wi,0,void 0),up:I.upVector(li,kt.x,kt.y)}}(function(Gt,Tt,wi,oi,Dt,Yi,Zi,on,fi,ki,Ji,Wi,$i,nn,ln,Vn,br,Ei,mn,ir,Fi,cn,dr,sn,vn){const Un=Gt.addToLineVertexArray(Tt,oi);let Bn,Kn,fr,Nn,ms,pc,mh,_h=0,ax=0,lx=0,cx=0,Jm=-1,Qm=-1;const $o={};let ux=Nu("");const el=wi?wi.anchor:Tt;let e_=0,t_=0;if(fi._unevaluatedLayout.getValue("text-radial-offset")===void 0?[e_,t_]=fi.layout.get("text-offset").evaluate(Fi,{},vn).map(kr=>kr*Xn):(e_=fi.layout.get("text-radial-offset").evaluate(Fi,{},vn)*Xn,t_=Lm),Gt.allowVerticalPlacement&&Dt.vertical){const kr=Dt.vertical;if(ln)pc=Rm(kr),on&&(mh=Rm(on));else{const zr=fi.layout.get("text-rotate").evaluate(Fi,{},vn)+90;fr=pf(ki,el,Tt,Ji,Wi,$i,kr,nn,zr,Vn),on&&(Nn=pf(ki,el,Tt,Ji,Wi,$i,on,Ei,zr))}}if(Yi){const kr=fi.layout.get("icon-rotate").evaluate(Fi,{},vn),zr=fi.layout.get("icon-text-fit")!=="none",gh=xv(Yi,kr,dr,zr),n_=on?xv(on,kr,dr,zr):void 0;Kn=pf(ki,el,Tt,Ji,Wi,$i,Yi,Ei,kr),_h=4*gh.length;const hx=Gt.iconSizeData;let tl=null;hx.kind==="source"?(tl=[Vo*fi.layout.get("icon-size").evaluate(Fi,{},vn)],tl[0]>Zs&&xt(`${Gt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):hx.kind==="composite"&&(tl=[Vo*cn.compositeIconSizes[0].evaluate(Fi,{},vn),Vo*cn.compositeIconSizes[1].evaluate(Fi,{},vn)],(tl[0]>Zs||tl[1]>Zs)&&xt(`${Gt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Gt.addSymbols(Gt.icon,gh,tl,ir,mn,Fi,!1,wi,Tt,Un.lineStartIndex,Un.lineLength,-1,sn,vn),Jm=Gt.icon.placedSymbolArray.length-1,n_&&(ax=4*n_.length,Gt.addSymbols(Gt.icon,n_,tl,ir,mn,Fi,Ur.vertical,wi,Tt,Un.lineStartIndex,Un.lineLength,-1,sn,vn),Qm=Gt.icon.placedSymbolArray.length-1)}for(const kr in Dt.horizontal){const zr=Dt.horizontal[kr];Bn||(ux=Nu(zr.text),ln?ms=Rm(zr):Bn=pf(ki,el,Tt,Ji,Wi,$i,zr,nn,fi.layout.get("text-rotate").evaluate(Fi,{},vn),Vn));const gh=zr.positionedLines.length===1;if(lx+=Tv(Gt,wi,Tt,zr,Zi,fi,ln,Fi,Vn,Un,Dt.vertical?Ur.horizontal:Ur.horizontalOnly,gh?Object.keys(Dt.horizontal):[kr],$o,Jm,cn,sn,vn),gh)break}Dt.vertical&&(cx+=Tv(Gt,wi,Tt,Dt.vertical,Zi,fi,ln,Fi,Vn,Un,Ur.vertical,["vertical"],$o,Qm,cn,sn,vn));let Js=-1;const i_=(kr,zr)=>kr?Math.max(kr,zr):zr;Js=i_(ms,Js),Js=i_(pc,Js),Js=i_(mh,Js);const $2=Js>-1?1:0;Gt.glyphOffsetArray.length>=Hs.MAX_GLYPHS&&xt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Fi.sortKey!==void 0&&Gt.addToSortKeyRanges(Gt.symbolInstances.length,Fi.sortKey),Gt.symbolInstances.emplaceBack(el.x,el.y,el.z,Tt.x,Tt.y,$o.right>=0?$o.right:-1,$o.center>=0?$o.center:-1,$o.left>=0?$o.left:-1,$o.vertical>=0?$o.vertical:-1,Jm,Qm,ux,Bn!==void 0?Bn:Gt.collisionBoxArray.length,Bn!==void 0?Bn+1:Gt.collisionBoxArray.length,fr!==void 0?fr:Gt.collisionBoxArray.length,fr!==void 0?fr+1:Gt.collisionBoxArray.length,Kn!==void 0?Kn:Gt.collisionBoxArray.length,Kn!==void 0?Kn+1:Gt.collisionBoxArray.length,Nn||Gt.collisionBoxArray.length,Nn?Nn+1:Gt.collisionBoxArray.length,Ji,lx,cx,_h,ax,$2,0,e_,t_,Js)})(i,kt,hi,lt,t,o,l,tt,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,_e,Oe,v,0,ce,We,U,e,h,b,S,M)};if(yt==="line")for(const lt of gv(e.geometry,0,0,ei,ei)){const kt=r2(lt,re,Ve,t.vertical||$,o,24,ie,i.overscaling,ei);for(const li of kt){const hi=$;hi&&f2(i,hi.text,je,li)||ft(lt,li,M)}}else if(yt==="line-center"){for(const lt of e.geometry)if(lt.length>1){const kt=n2(lt,Ve,t.vertical||$,o,24,ie);kt&&ft(lt,kt,M)}}else if(e.type==="Polygon")for(const lt of Tm(e.geometry,0)){const kt=l2(lt,16);ft(lt[0],new fs(kt.x,kt.y,0,0,void 0),M)}else if(e.type==="LineString")for(const lt of e.geometry)ft(lt,new fs(lt[0].x,lt[0].y,0,0,void 0),M);else if(e.type==="Point")for(const lt of e.geometry)for(const kt of lt)ft([kt],new fs(kt.x,kt.y,0,0,void 0),M)}const Zs=32640;function Tv(i,e,t,o,l,h,f,m,v,b,S,M,I,P,L,U,$){const ee=function(re,_e,ce,Ve,Oe,We,yt,je){const et=[];if(_e.positionedLines.length===0)return et;const at=Ve.layout.get("text-rotate").evaluate(We,{})*Math.PI/180,tt=function(hi){const Gt=hi[0],Tt=hi[1],wi=Gt*Tt;return wi>0?[Gt,-Tt]:wi<0?[-Gt,Tt]:Gt===0?[Tt,Gt]:[Tt,-Gt]}(ce);let ft=Math.abs(_e.top-_e.bottom);for(const hi of _e.positionedLines)ft-=hi.lineOffset;const lt=_e.positionedLines.length,kt=ft/lt;let li=_e.top-ce[1];for(let hi=0;hi<lt;++hi){const Gt=_e.positionedLines[hi];li=o2(_e,kt,li,hi);for(const Tt of Gt.positionedGlyphs){if(!Tt.rect)continue;const wi=Tt.rect||{};let oi=4,Dt=!0,Yi=1,Zi=0;if(Tt.imageName){const sn=yt[Tt.imageName];if(!sn)continue;if(sn.sdf){xt("SDF images are not supported in formatted text and will be ignored.");continue}Dt=!1,Yi=sn.pixelRatio,oi=1/Yi}const on=(Oe||je)&&Tt.vertical,fi=Tt.metrics.advance*Tt.scale/2,ki=Tt.metrics,Ji=Tt.rect;if(Ji===null)continue;je&&_e.verticalizable&&(Zi=Tt.imageName?fi-Tt.metrics.width*Tt.scale/2:0);const Wi=Oe?[Tt.x+fi,Tt.y]:[0,0];let $i=[0,0],nn=[0,0],ln=!1;Oe||(on?(nn=[Tt.x+fi+tt[0],Tt.y+tt[1]-Zi],ln=!0):$i=[Tt.x+fi+ce[0],Tt.y+ce[1]-Zi]);const Vn=Ji.w*Tt.scale/(Yi*(Tt.localGlyph?2:1)),br=Ji.h*Tt.scale/(Yi*(Tt.localGlyph?2:1));let Ei,mn,ir,Fi;if(on){const sn=Tt.y-li,vn=new N(-fi,fi-sn),Un=-Math.PI/2,Bn=new N(...nn);Ei=new N(-fi+$i[0],$i[1]),Ei._rotateAround(Un,vn)._add(Bn),Ei.x+=-sn+fi,Ei.y-=(ki.left-oi)*Tt.scale;const Kn=Tt.imageName?ki.advance*Tt.scale:Xn*Tt.scale,fr=String.fromCharCode(Tt.glyph);UT(fr)?Ei.x+=(1-oi)*Tt.scale:NT(fr)?Ei.x+=Kn-ki.height*Tt.scale+(-oi-1)*Tt.scale:Ei.x+=Tt.imageName||ki.width+2*oi===Ji.w&&ki.height+2*oi===Ji.h?(Kn-br)/2:(Kn-(ki.height+2*oi)*Tt.scale)/2,mn=new N(Ei.x,Ei.y-Vn),ir=new N(Ei.x+br,Ei.y),Fi=new N(Ei.x+br,Ei.y-Vn)}else{const sn=(ki.left-oi)*Tt.scale-fi+$i[0],vn=(-ki.top-oi)*Tt.scale+$i[1],Un=sn+Vn,Bn=vn+br;Ei=new N(sn,vn),mn=new N(Un,vn),ir=new N(sn,Bn),Fi=new N(Un,Bn)}if(at){let sn;sn=Oe?new N(0,0):ln?new N(tt[0],tt[1]):new N(ce[0],ce[1]),Ei._rotateAround(at,sn),mn._rotateAround(at,sn),ir._rotateAround(at,sn),Fi._rotateAround(at,sn)}const cn=new N(0,0),dr=new N(0,0);et.push({tl:Ei,tr:mn,bl:ir,br:Fi,tex:wi,writingMode:_e.writingMode,glyphOffset:Wi,sectionIndex:Tt.sectionIndex,isSDF:Dt,pixelOffsetTL:cn,pixelOffsetBR:dr,minFontScaleX:0,minFontScaleY:0})}}return et}(0,o,v,h,f,m,l,i.allowVerticalPlacement),se=i.textSizeData;let ie=null;se.kind==="source"?(ie=[Vo*h.layout.get("text-size").evaluate(m,{},$)],ie[0]>Zs&&xt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):se.kind==="composite"&&(ie=[Vo*L.compositeTextSizes[0].evaluate(m,{},$),Vo*L.compositeTextSizes[1].evaluate(m,{},$)],(ie[0]>Zs||ie[1]>Zs)&&xt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,ee,ie,v,f,m,S,e,t,b.lineStartIndex,b.lineLength,P,U,$);for(const re of M)I[re]=i.text.placedSymbolArray.length-1;return 4*ee.length}function Ev(i){for(const e in i)return i[e];return null}function pf(i,e,t,o,l,h,f,m,v,b){let S=f.top,M=f.bottom,I=f.left,P=f.right;const L=f.collisionPadding;if(L&&(I-=L[0],S-=L[1],P+=L[2],M+=L[3]),v){const U=new N(I,S),$=new N(P,S),ee=new N(I,M),se=new N(P,M),ie=le(v);let re=new N(0,0);b&&(re=new N(b[0],b[1])),U._rotateAround(ie,re),$._rotateAround(ie,re),ee._rotateAround(ie,re),se._rotateAround(ie,re),I=Math.min(U.x,$.x,ee.x,se.x),P=Math.max(U.x,$.x,ee.x,se.x),S=Math.min(U.y,$.y,ee.y,se.y),M=Math.max(U.y,$.y,ee.y,se.y)}return i.emplaceBack(e.x,e.y,e.z,t.x,t.y,I,S,P,M,m,o,l,h),i.length-1}function Rm(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const e=i.bottom-i.top;return e>0?Math.max(10,e):null}function f2(i,e,t,o){const l=i.compareText;if(e in l){const h=l[e];for(let f=h.length-1;f>=0;f--)if(o.dist(h[f])<t)return!0}else l[e]=[];return l[e].push(o),!1}const p2=it([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Sv}=p2,Cv=it([{name:"a_pos_3",components:3,type:"Int16"}]);var oh=it([{name:"a_pos",type:"Int16",components:2}]);const ps=ei/Math.PI/2,Om=2*Gr(1,0)*ps*Math.PI,uc=[64,32,16],fo=-ps,po=ps,m2=[new xr([fo,fo,fo],[po,po,po]),new xr([fo,fo,fo],[0,0,po]),new xr([0,fo,fo],[po,0,po]),new xr([fo,0,fo],[0,po,po]),new xr([0,0,fo],[po,po,po])];function Av(i,e,t,o=!0){const l=uo([],i._camera.position,i.worldSize),h=[e,t,1,1];Xa(h,h,i.pixelMatrixInverse),vy(h,h,1/h[3]);const f=ur([],ho([],h,l)),m=i.globeMatrix,v=[m[12],m[13],m[14]],b=ho([],v,l),S=$u(b),M=ur([],b),I=i.worldSize/(2*Math.PI),P=Wr(M,f),L=Math.asin(I/S);if(L<Math.acos(P)){if(!o)return null;const yt=[],je=[];uo(yt,f,S/P),ur(je,ho(je,yt,b)),ur(f,Gs(f,b,uo(f,je,Math.tan(L)*S)))}const U=[];new mm(l,f).closestPointOnSphere(v,I,U);const $=ur([],Ri(m,0)),ee=ur([],Ri(m,1)),se=ur([],Ri(m,2)),ie=Wr($,U),re=Wr(ee,U),_e=Wr(se,U),ce=xe(Math.asin(-re/I));let Ve=xe(Math.atan2(ie,_e));Ve=i.center.lng+function(yt,je){const et=(je-yt+180)%360-180;return et<-180?et+360:et}(i.center.lng,Ve);const Oe=Ro(Ve),We=Se(cs(ce),0,1);return new Jl(Oe,We)}class _2{constructor(e,t,o){this.a=ho([],e,o),this.b=ho([],t,o),this.center=o;const l=ur([],this.a),h=ur([],this.b);this.angle=Math.acos(Wr(l,h))}}function Fm(i,e){if(i.angle===0)return null;let t;return t=i.a[e]===0?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[e]/i.a[e]/Math.sin(i.angle)-1/Math.tan(i.angle)),t<0||t>1?null:function(o,l,h,f){const m=Math.sin(h);return o*(Math.sin((1-f)*h)/m)+l*(Math.sin(f*h)/m)}(i.a[e],i.b[e],i.angle,Se(t,0,1))+i.center[e]}function Uo(i){if(i.z<=1)return m2[i.z+2*i.y+i.x];const e=Vm(mf(i));return xr.fromPoints(e)}function Mv(i,e){const t=lh(e.zoom);if(t===0)return Uo(i);const o=mf(i),l=Vm(o),h=Ro(o.getWest())*e.worldSize,f=Ro(o.getEast())*e.worldSize,m=cs(o.getNorth())*e.worldSize,v=cs(o.getSouth())*e.worldSize,b=[h,m,0],S=[f,m,0],M=[h,v,0],I=[f,v,0],P=lm([],e.globeMatrix);return Dn(b,b,P),Dn(S,S,P),Dn(M,M,P),Dn(I,I,P),l[0]=Is(l[0],M,t),l[1]=Is(l[1],I,t),l[2]=Is(l[2],S,t),l[3]=Is(l[3],b,t),xr.fromPoints(l)}function Iv(i,e,t,o,l){for(const h of t)Dn(h,h,o),uo(h,h,l),dm(i,i,h),fm(e,e,h)}function g2(i,e,t){const o=e/i.worldSize,l=Number.MAX_VALUE,h=[-l,-l,-l],f=[l,l,l],m=i.globeMatrix;if(t.z<=1)return Iv(f,h,Uo(t).getCorners(),m,o),new xr(f,h);const v=mf(t),b=Vm(v);if(Iv(f,h,b,m,o),v.contains(i.center)){h[2]=0;const Ve=i.point,Oe=[Ve.x*o,Ve.y*o,0];return dm(f,f,Oe),fm(h,h,Oe),new xr(f,h)}const S=[m[12]*o,m[13]*o,m[14]*o],M=v.getCenter(),I=Se(i.center.lat,-85.051129,Oo),P=Se(M.lat,-85.051129,Oo),L=Ro(i.center.lng),U=cs(I);let $=L-Ro(M.lng);const ee=U-cs(P);$>.5?$-=1:$<-.5&&($+=1);let se=0;Math.abs($)>Math.abs(ee)?se=$>=0?1:3:(se=ee>=0?0:2,Kd(S,S,[m[4]*o,m[5]*o,m[6]*o],-Math.sin(le(ee>=0?v.getSouth():v.getNorth()))*ps));const ie=b[se],re=b[(se+1)%4],_e=new _2(ie,re,S),ce=[Fm(_e,0)||ie[0],Fm(_e,1)||ie[1],Fm(_e,2)||ie[2]];return f[2]=Math.min(ie[2],re[2]),dm(f,f,ce),fm(h,h,ce),new xr(f,h)}function mf({x:i,y:e,z:t}){const o=1/(1<<t),l=new Ui(Zr(i*o),Hn((e+1)*o)),h=new Ui(Zr((i+1)*o),Hn(e*o));return new $s(l,h)}function Vm(i){const e=le(i.getNorth()),t=le(i.getSouth()),o=Math.cos(e),l=Math.cos(t),h=Math.sin(e),f=Math.sin(t),m=i.getWest(),v=i.getEast();return[hc(l,f,m),hc(l,f,v),hc(o,h,v),hc(o,h,m)]}function hc(i,e,t,o=ps){return t=le(t),[i*Math.sin(t)*o,-e*o,i*Math.cos(t)*o]}function _f(i,e,t){return hc(Math.cos(le(i)),Math.sin(le(i)),e,t)}function sh(i,e,t,o){const l=1<<t.z,h=(i/ei+t.x)/l;return _f(Hn((e/ei+t.y)/l),Zr(h),o)}function gf({min:i,max:e}){return 16383/Math.max(e[0]-i[0],e[1]-i[1],e[2]-i[2])}const kv=new Float64Array(16);function ah(i){const e=gf(i),t=py(kv,[e,e,e]);return qu(t,t,((o=[])[0]=-(l=i.min)[0],o[1]=-l[1],o[2]=-l[2],o));var o,l}function Um(i){const e=(o=i.min,(t=kv)[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=o[0],t[13]=o[1],t[14]=o[2],t[15]=1,t);var t,o;const l=1/gf(i);return Ha(e,e,[l,l,l])}function zv(i,e,t,o,l){const h=function(v){const b=ei/(2*Math.PI);return v/(2*Math.PI)/b}(t),f=[i,e,-t/(2*Math.PI)],m=Fo(new Float64Array(16));return qu(m,m,f),Ha(m,m,[h,h,h]),cm(m,m,le(-l)),Xd(m,m,le(-o)),m}function lh(i){return Pe(5,6,i)}function Pv(i,e){const t=_f(e.lat,e.lng);return h=(o=hm([],function(P){const L=_f(P._center.lat,P._center.lng);let U=pm([],tc(0,1,0),L);const $=my([],-P.angle,L);U=Dn(U,U,$),my($,-P._pitch,U);const ee=ur([],L);return uo(ee,ee,P.cameraToCenterDistance/P.pixelsPerMeter*Om),Dn(ee,ee,$),Gs([],L,ee)}(i),t))[0],f=o[1],m=o[2],v=(l=t)[0],b=l[1],S=l[2],I=(M=Math.sqrt(h*h+f*f+m*m)*Math.sqrt(v*v+b*b+S*S))&&Wr(o,l)/M,Math.acos(Math.min(Math.max(I,-1),1));var o,l,h,f,m,v,b,S,M,I}const Dv=le(85),y2=Math.cos(Dv),v2=Math.sin(Dv);function Lv(i,e){const t=i.fovAboveCenter,o=i.elevation?i.elevation.getMinElevationBelowMSL()*e:0,l=(i._camera.position[2]*i.worldSize-o)/Math.cos(i._pitch),h=Math.sin(t)*l/Math.sin(Math.max(Math.PI/2-i._pitch-t,.01)),f=Math.sin(i._pitch)*h+l;return Math.min(1.01*f,l*(1/i._horizonShift))}function Ja(i,e){if(!e.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:e};const t=Math.pow(2,-i.z),o=i.x*t,l=(i.x+1)*t,h=i.y*t,f=(i.y+1)*t,m=Zr(o),v=Zr(l),b=Hn(h),S=Hn(f),M=e.project(m,b),I=e.project(v,b),P=e.project(v,S),L=e.project(m,S);let U=Math.min(M.x,I.x,P.x,L.x),$=Math.min(M.y,I.y,P.y,L.y),ee=Math.max(M.x,I.x,P.x,L.x),se=Math.max(M.y,I.y,P.y,L.y);const ie=t/16;function re(ce,Ve,Oe,We,yt,je){const et=(Oe+yt)/2,at=(We+je)/2,tt=e.project(Zr(et),Hn(at)),ft=Math.max(0,U-tt.x,$-tt.y,tt.x-ee,tt.y-se);U=Math.min(U,tt.x),ee=Math.max(ee,tt.x),$=Math.min($,tt.y),se=Math.max(se,tt.y),ft>ie&&(re(ce,tt,Oe,We,et,at),re(tt,Ve,et,at,yt,je))}re(M,I,o,h,l,h),re(I,P,l,h,l,f),re(P,L,l,f,o,f),re(L,M,o,f,o,h),U-=ie,$-=ie,ee+=ie,se+=ie;const _e=1/Math.max(ee-U,se-$);return{scale:_e,x:U*_e,y:$*_e,x2:ee*_e,y2:se*_e,projection:e}}const x2=Fo(new Float32Array(16));class Ws{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new Ui(0,0)}projectTilePoint(e,t,o){return{x:e,y:t,z:0}}locationPoint(e,t,o=!0){return e._coordinatePoint(e.locationCoordinate(t),o)}pixelsPerMeter(e,t){return Gr(1,e)*t}pixelSpaceConversion(e,t,o){return 1}farthestPixelDistance(e){return Lv(e,e.pixelsPerMeter)}pointCoordinate(e,t,o,l){const h=e.horizonLineFromTop(!1),f=new N(t,Math.max(h,o));return e.rayIntersectionCoordinate(e.pointRayIntersection(f,l))}pointCoordinate3D(e,t,o){const l=new N(t,o);if(e.elevation)return e.elevation.pointCoordinate(l);{const h=this.pointCoordinate(e,l.x,l.y,0);return[h.x,h.y,h.z]}}isPointAboveHorizon(e,t){if(e.elevation)return!this.pointCoordinate3D(e,t.x,t.y);const o=e.horizonLineFromTop();return t.y<o}createInversionMatrix(e,t){return x2}createTileMatrix(e,t,o){let l,h,f;const m=o.canonical,v=Fo(new Float64Array(16));if(this.isReprojectedInTileSpace){const b=Ja(m,this);l=1,h=b.x+o.wrap*b.scale,f=b.y,Ha(v,v,[l/b.scale,l/b.scale,e.pixelsPerMeter/t])}else l=t/e.zoomScale(m.z),h=(m.x+Math.pow(2,m.z)*o.wrap)*l,f=m.y*l;return qu(v,v,[h,f,0]),Ha(v,v,[l/ei,l/ei,1]),v}upVector(e,t,o){return[0,0,1]}upVectorScale(e,t,o){return{metersToTile:1}}}class b2 extends Ws{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,o]=this.parallels=e.parallels||[29.5,45.5],l=Math.sin(le(t));this.n=(l+Math.sin(le(o)))/2,this.c=1+l*(2*this.n-l),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n:o,c:l,r0:h}=this,f=le(e-this.center[0]),m=le(t),v=Math.sqrt(l-2*o*Math.sin(m))/o;return{x:v*Math.sin(f*o),y:v*Math.cos(f*o)-h,z:0}}unproject(e,t){const{n:o,c:l,r0:h}=this,f=h+t;let m=Math.atan2(e,Math.abs(f))*Math.sign(f);f*o<0&&(m-=Math.PI*Math.sign(e)*Math.sign(f));const v=le(this.center[0])*o;m=we(m,-Math.PI-v,Math.PI-v);const b=xe(m/o)+this.center[0],S=Math.asin(Se((l-(e*e+f*f)*o*o)/(2*o),-1,1)),M=Se(xe(S),-85.051129,Oo);return new Ui(b,M)}}const ch=1.340264,uh=-.081106,hh=893e-6,dh=.003796,yf=Math.sqrt(3)/2;class w2 extends Ws{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const o=Math.asin(yf*Math.sin(t)),l=o*o,h=l*l*l;return{x:.5*(e*Math.cos(o)/(yf*(ch+3*uh*l+h*(7*hh+9*dh*l)))/Math.PI+.5),y:1-.5*(o*(ch+uh*l+h*(hh+dh*l))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let o=t=(2*(1-t)-1)*Math.PI,l=o*o,h=l*l*l;for(let S,M,I,P=0;P<12&&(M=o*(ch+uh*l+h*(hh+dh*l))-t,I=ch+3*uh*l+h*(7*hh+9*dh*l),S=M/I,o=Se(o-S,-Math.PI/3,Math.PI/3),l=o*o,h=l*l*l,!(Math.abs(S)<1e-12));++P);const f=yf*e*(ch+3*uh*l+h*(7*hh+9*dh*l))/Math.cos(o),m=Math.asin(Math.sin(o)/yf),v=Se(180*f/Math.PI,-180,180),b=Se(180*m/Math.PI,-85.051129,Oo);return new Ui(v,b)}}class T2 extends Ws{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const o=360*(e-.5),l=Se(360*(.5-t),-85.051129,Oo);return new Ui(o,l)}}const dc=Math.PI/2;function vf(i){return Math.tan((dc+i)/2)}class E2 extends Ws{constructor(e){super(e),this.center=e.center||[0,30];const[t,o]=this.parallels=e.parallels||[30,30],l=le(t),h=le(o),f=Math.cos(l);this.n=l===h?Math.sin(l):Math.log(f/Math.cos(h))/Math.log(vf(h)/vf(l)),this.f=f*Math.pow(vf(l),this.n)/this.n}project(e,t){t=le(t),e=le(e-this.center[0]);const o=1e-6,{n:l,f:h}=this;h>0?t<-dc+o&&(t=-dc+o):t>dc-o&&(t=dc-o);const f=h/Math.pow(vf(t),l),m=f*Math.sin(l*e),v=h-f*Math.cos(l*e);return{x:.5*(m/Math.PI+.5),y:1-.5*(v/Math.PI+.5),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,t=(2*(1-t)-.5)*Math.PI;const{n:o,f:l}=this,h=l-t,f=Math.sign(h),m=Math.sign(o)*Math.sqrt(e*e+h*h);let v=Math.atan2(e,Math.abs(h))*f;h*o<0&&(v-=Math.PI*Math.sign(e)*f);const b=Se(xe(v/o)+this.center[0],-180,180),S=Se(xe(2*Math.atan(Math.pow(l/m,1/o))-dc),-85.051129,Oo);return new Ui(b,S)}}class Bv extends Ws{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:Ro(e),y:cs(t),z:0}}unproject(e,t){const o=Zr(e),l=Hn(t);return new Ui(o,l)}}const Rv=le(Oo);class S2 extends Ws{project(e,t){const o=(t=le(t))*t,l=o*o;return{x:.5*((e=le(e))*(.8707-.131979*o+l*(l*(.003971*o-.001529*l)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+o*(.015085+l*(.028874*o-.044475-.005916*l)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let o=t=(2*(1-t)-1)*Math.PI,l=25,h=0,f=o*o;do{f=o*o;const b=f*f;h=(o*(1.007226+f*(.015085+b*(.028874*f-.044475-.005916*b)))-t)/(1.007226+f*(.045255+b*(.259866*f-.311325-.005916*11*b))),o=Se(o-h,-Rv,Rv)}while(Math.abs(h)>1e-6&&--l>0);f=o*o;const m=Se(xe(e/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),v=xe(o);return new Ui(m,v)}}const Ov=le(Oo);class C2 extends Ws{project(e,t){t=le(t),e=le(e);const o=Math.cos(t),l=2/Math.PI,h=Math.acos(o*Math.cos(e/2)),f=Math.sin(h)/h,m=.5*(e*l+2*o*Math.sin(e/2)/f)||0,v=.5*(t+Math.sin(t)/f)||0;return{x:.5*(m/Math.PI+.5),y:1-.5*(v/Math.PI+1),z:0}}unproject(e,t){let o=e=(2*e-.5)*Math.PI,l=t=(2*(1-t)-1)*Math.PI,h=25;const f=1e-6;let m=0,v=0;do{const b=Math.cos(l),S=Math.sin(l),M=2*S*b,I=S*S,P=b*b,L=Math.cos(o/2),U=Math.sin(o/2),$=2*L*U,ee=U*U,se=1-P*L*L,ie=se?1/se:0,re=se?Math.acos(b*L)*Math.sqrt(1/se):0,_e=.5*(2*re*b*U+2*o/Math.PI)-e,ce=.5*(re*S+l)-t,Ve=.5*ie*(P*ee+re*b*L*I)+1/Math.PI,Oe=ie*($*M/4-re*S*U),We=.125*ie*(M*U-re*S*P*$),yt=.5*ie*(I*L+re*ee*b)+.5,je=Oe*We-yt*Ve;m=(ce*Oe-_e*yt)/je,v=(_e*We-ce*Ve)/je,o=Se(o-m,-Math.PI,Math.PI),l=Se(l-v,-Ov,Ov)}while((Math.abs(m)>f||Math.abs(v)>f)&&--h>0);return new Ui(xe(o),xe(l))}}class Fv extends Ws{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(le(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:o,cosPhi:l}=this;return{x:le(e)*l*o+.5,y:-Math.sin(le(t))/l*o+.5,z:0}}unproject(e,t){const{scale:o,cosPhi:l}=this,h=-(t-.5)/o,f=Se(xe((e-.5)/o)/l,-180,180),m=Math.asin(Se(h*l,-1,1)),v=Se(xe(m),-85.051129,Oo);return new Ui(f,v)}}class A2 extends Bv{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,t,o){const l=sh(e,t,o);return Dn(l,l,ah(Uo(o))),{x:l[0],y:l[1],z:l[2]}}locationPoint(e,t){const o=_f(t.lat,t.lng),l=ur([],o),h=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(t),e._centerAltitude):e._centerAltitude;Kd(o,o,l,Gr(1,0)*ei*h);const f=Fo(new Float64Array(16));return ec(f,e.pixelMatrix,e.globeMatrix),Dn(o,o,f),new N(o[0],o[1])}pixelsPerMeter(e,t){return Gr(1,0)*t}pixelSpaceConversion(e,t,o){const l=Mi(Gr(1,45)*t,Gr(1,e)*t,o);return this.pixelsPerMeter(e,t)/l}createTileMatrix(e,t,o){const l=Um(Uo(o.canonical));return ec(new Float64Array(16),e.globeMatrix,l)}createInversionMatrix(e,t){const{center:o}=e,l=ah(Uo(t));return Xd(l,l,le(o.lng)),cm(l,l,le(o.lat)),Ha(l,l,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(l)}pointCoordinate(e,t,o,l){return Av(e,t,o,!0)||new Jl(0,0)}pointCoordinate3D(e,t,o){const l=this.pointCoordinate(e,t,o,0);return[l.x,l.y,l.z]}isPointAboveHorizon(e,t){return!Av(e,t.x,t.y,!1)}farthestPixelDistance(e){const t=function(l,h){const f=l.cameraToCenterDistance,m=l._centerAltitude*h,v=l._camera,b=l._camera.forward(),S=Gs([],uo([],b,-f),[0,0,m]),M=l.worldSize/(2*Math.PI),I=[0,0,-M],P=l.width/l.height,L=Math.tan(l.fovAboveCenter),U=uo([],v.up(),L),$=uo([],v.right(),L*P),ee=ur([],Gs([],Gs([],b,U),$)),se=[];let ie;if(new mm(S,ee).closestPointOnSphere(I,M,se)){const re=Gs([],se,I),_e=ho([],re,S);ie=Math.cos(l.fovAboveCenter)*$u(_e)}else{const re=ho([],S,I),_e=ho([],I,S);ur(_e,_e);const ce=$u(re)-M;ie=Math.sqrt(ce*(ce+2*M));const Ve=Math.acos(ie/(M+ce))-Math.acos(Wr(b,_e));ie*=Math.cos(Ve)}return 1.01*ie}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),o=lh(e.zoom);if(o>0){const l=Lv(e,Gr(1,e.center.lat)*e.worldSize),h=e.worldSize/(2*Math.PI),f=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Mi(t,l+h*(1-Math.cos(f)),Math.pow(o,10))}return t}upVector(e,t,o){return sh(t,o,e,1)}upVectorScale(e){return{metersToTile:Om*gf(Uo(e))}}}function Vv(i){const e=i.parallels,t=!!e&&Math.abs(e[0]+e[1])<.01;switch(i.name){case"mercator":return new Bv(i);case"equirectangular":return new T2(i);case"naturalEarth":return new S2(i);case"equalEarth":return new w2(i);case"winkelTripel":return new C2(i);case"albers":return t?new Fv(i):new b2(i);case"lambertConformalConic":return t?new Fv(i):new E2(i);case"globe":return new A2(i)}throw new Error(`Invalid projection name: ${i.name}`)}const M2=Ya.VectorTileFeature.types,I2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function xf(i,e,t,o,l,h,f,m,v,b,S,M,I){const P=m?Math.min(Zs,Math.round(m[0])):0,L=m?Math.min(Zs,Math.round(m[1])):0;i.emplaceBack(e,t,Math.round(32*o),Math.round(32*l),h,f,(P<<1)+(v?1:0),L,16*b,16*S,256*M,256*I)}function bf(i,e,t,o,l,h,f){i.emplaceBack(e,t,o,l,h,f)}function wf(i,e,t,o,l){i.emplaceBack(e,t,o,l),i.emplaceBack(e,t,o,l),i.emplaceBack(e,t,o,l),i.emplaceBack(e,t,o,l)}function k2(i){for(const e of i.sections)if(a(e.text))return!0;return!1}class Nm{constructor(e){this.layoutVertexArray=new en,this.indexArray=new _i,this.programConfigurations=e,this.segments=new In,this.dynamicLayoutVertexArray=new bi,this.opacityVertexArray=new qi,this.placedSymbolArray=new Vg,this.globeExtVertexArray=new dn}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,t,o,l){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,PT.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,LT.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,I2,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,DT.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Rt(Nm,"SymbolBuffers");class jm{constructor(e,t,o){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new o,this.segments=new In,this.collisionVertexArray=new tn,this.collisionVertexArrayExt=new rn}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,BT.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,RT.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Rt(jm,"CollisionBuffers");class Hs{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(f=>f.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Fo([]),this.placementViewportMatrix=Fo([]);const t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Cm(this.zoom,t["text-size"]),this.iconSizeData=Cm(this.zoom,t["icon-size"]);const o=this.layers[0].layout,l=o.get("symbol-sort-key"),h=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&l.constantOr(1)!==void 0,this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(f=>Ur[f]),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Nm(new Ga(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Nm(new Ga(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new jg,this.lineVertexArray=new qg,this.symbolInstances=new Ng}calculateGlyphDependencies(e,t,o,l,h){for(let f=0;f<e.length;f++)if(t[e.charCodeAt(f)]=!0,l&&h){const m=th[e.charAt(f)];m&&(t[m.charCodeAt(0)]=!0)}}populate(e,t,o,l){const h=this.layers[0],f=h.layout,m=this.projection.name==="globe",v=f.get("text-font"),b=f.get("text-field"),S=f.get("icon-image"),M=(b.value.kind!=="constant"||b.value.value instanceof lr&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),I=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,P=f.get("symbol-sort-key");if(this.features=[],!M&&!I)return;const L=t.iconDependencies,U=t.glyphDependencies,$=t.availableImages,ee=new H(this.zoom);for(const{feature:se,id:ie,index:re,sourceLayerIndex:_e}of e){const ce=h._featureFilter.needGeometry,Ve=Za(se,ce);if(!h._featureFilter.filter(ee,Ve,o))continue;if(ce||(Ve.geometry=us(se,o,l)),m&&se.type!==1&&o.z<=5){const je=Ve.geometry,et=.98078528056;for(let at=0;at<je.length;at++)je[at]=Dw(je[at],tt=>tt,(tt,ft)=>Wr(sh(tt.x,tt.y,o,1),sh(ft.x,ft.y,o,1))<et)}let Oe,We;if(M){const je=h.getValueAndResolveTokens("text-field",Ve,o,$),et=lr.factory(je);k2(et)&&(this.hasRTLText=!0),(!this.hasRTLText||j()==="unavailable"||this.hasRTLText&&W.isParsed())&&(Oe=VT(et,h,Ve))}if(I){const je=h.getValueAndResolveTokens("icon-image",Ve,o,$);We=je instanceof cr?je:cr.fromString(je)}if(!Oe&&!We)continue;const yt=this.sortFeaturesByKey?P.evaluate(Ve,{},o):void 0;if(this.features.push({id:ie,text:Oe,icon:We,index:re,sourceLayerIndex:_e,geometry:Ve.geometry,properties:se.properties,type:M2[se.type],sortKey:yt}),We&&(L[We.name]=!0),Oe){const je=v.evaluate(Ve,{},o).join(","),et=f.get("text-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ur.vertical)>=0;for(const at of Oe.sections)if(at.image)L[at.image.name]=!0;else{const tt=Xl(Oe.toString()),ft=at.fontStack||je,lt=U[ft]=U[ft]||{};this.calculateGlyphDependencies(at.text,lt,et,this.allowVerticalPlacement,tt)}}}f.get("symbol-placement")==="line"&&(this.features=function(se){const ie={},re={},_e=[];let ce=0;function Ve(je){_e.push(se[je]),ce++}function Oe(je,et,at){const tt=re[je];return delete re[je],re[et]=tt,_e[tt].geometry[0].pop(),_e[tt].geometry[0]=_e[tt].geometry[0].concat(at[0]),tt}function We(je,et,at){const tt=ie[et];return delete ie[et],ie[je]=tt,_e[tt].geometry[0].shift(),_e[tt].geometry[0]=at[0].concat(_e[tt].geometry[0]),tt}function yt(je,et,at){const tt=at?et[0][et[0].length-1]:et[0][0];return`${je}:${tt.x}:${tt.y}`}for(let je=0;je<se.length;je++){const et=se[je],at=et.geometry,tt=et.text?et.text.toString():null;if(!tt){Ve(je);continue}const ft=yt(tt,at),lt=yt(tt,at,!0);if(ft in re&&lt in ie&&re[ft]!==ie[lt]){const kt=We(ft,lt,at),li=Oe(ft,lt,_e[kt].geometry);delete ie[ft],delete re[lt],re[yt(tt,_e[li].geometry,!0)]=li,_e[kt].geometry=null}else ft in re?Oe(ft,lt,at):lt in ie?We(ft,lt,at):(Ve(je),ie[ft]=ce-1,re[lt]=ce-1)}return _e.filter(je=>je.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((se,ie)=>se.sortKey-ie.sortKey)}update(e,t,o,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,o,l),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,o,l))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Vv(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const o=this.lineVertexArray.length,l=e.segment;if(l!==void 0){let h=e.dist(t[l+1]),f=e.dist(t[l]);const m={};for(let v=l+1;v<t.length;v++)m[v]={x:t[v].x,y:t[v].y,tileUnitDistanceFromAnchor:h},v<t.length-1&&(h+=t[v+1].dist(t[v]));for(let v=l||0;v>=0;v--)m[v]={x:t[v].x,y:t[v].y,tileUnitDistanceFromAnchor:f},v>0&&(f+=t[v-1].dist(t[v]));for(let v=0;v<t.length;v++){const b=m[v];this.lineVertexArray.emplaceBack(b.x,b.y,b.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,t,o,l,h,f,m,v,b,S,M,I,P,L){const U=e.indexArray,$=e.layoutVertexArray,ee=e.globeExtVertexArray,se=e.segments.prepareSegment(4*t.length,$,U,this.canOverlap?f.sortKey:void 0),ie=this.glyphOffsetArray.length,re=se.vertexLength,_e=this.allowVerticalPlacement&&m===Ur.vertical?Math.PI/2:0,ce=f.text&&f.text.sections;for(let Oe=0;Oe<t.length;Oe++){const{tl:We,tr:yt,bl:je,br:et,tex:at,pixelOffsetTL:tt,pixelOffsetBR:ft,minFontScaleX:lt,minFontScaleY:kt,glyphOffset:li,isSDF:hi,sectionIndex:Gt}=t[Oe],Tt=se.vertexLength,wi=li[1];if(xf($,b.x,b.y,We.x,wi+We.y,at.x,at.y,o,hi,tt.x,tt.y,lt,kt),xf($,b.x,b.y,yt.x,wi+yt.y,at.x+at.w,at.y,o,hi,ft.x,tt.y,lt,kt),xf($,b.x,b.y,je.x,wi+je.y,at.x,at.y+at.h,o,hi,tt.x,ft.y,lt,kt),xf($,b.x,b.y,et.x,wi+et.y,at.x+at.w,at.y+at.h,o,hi,ft.x,ft.y,lt,kt),v){const oi=v.anchor,Dt=v.up;bf(ee,oi.x,oi.y,oi.z,Dt[0],Dt[1],Dt[2]),bf(ee,oi.x,oi.y,oi.z,Dt[0],Dt[1],Dt[2]),bf(ee,oi.x,oi.y,oi.z,Dt[0],Dt[1],Dt[2]),bf(ee,oi.x,oi.y,oi.z,Dt[0],Dt[1],Dt[2]),wf(e.dynamicLayoutVertexArray,oi.x,oi.y,oi.z,_e)}else wf(e.dynamicLayoutVertexArray,b.x,b.y,b.z,_e);U.emplaceBack(Tt,Tt+1,Tt+2),U.emplaceBack(Tt+1,Tt+2,Tt+3),se.vertexLength+=4,se.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(li[0]),Oe!==t.length-1&&Gt===t[Oe+1].sectionIndex||e.programConfigurations.populatePaintArrays($.length,f,f.index,{},P,L,ce&&ce[Gt])}const Ve=v?v.anchor:b;e.placedSymbolArray.emplaceBack(Ve.x,Ve.y,Ve.z,b.x,b.y,ie,this.glyphOffsetArray.length-ie,re,S,M,b.segment,o?o[0]:0,o?o[1]:0,l[0],l[1],m,0,!1,0,I,0)}_commitLayoutVertex(e,t,o,l,h,f,m){e.emplaceBack(t,o,l,h,f,Math.round(m.x),Math.round(m.y))}_addCollisionDebugVertices(e,t,o,l,h,f,m){const v=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),b=v.vertexLength,S=m.tileAnchorX,M=m.tileAnchorY;for(let P=0;P<4;P++)o.collisionVertexArray.emplaceBack(0,0,0,0);o.collisionVertexArrayExt.emplaceBack(t,-e.padding,-e.padding),o.collisionVertexArrayExt.emplaceBack(t,e.padding,-e.padding),o.collisionVertexArrayExt.emplaceBack(t,e.padding,e.padding),o.collisionVertexArrayExt.emplaceBack(t,-e.padding,e.padding),this._commitLayoutVertex(o.layoutVertexArray,l,h,f,S,M,new N(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,l,h,f,S,M,new N(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,l,h,f,S,M,new N(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,l,h,f,S,M,new N(e.x1,e.y2)),v.vertexLength+=4;const I=o.indexArray;I.emplaceBack(b,b+1),I.emplaceBack(b+1,b+2),I.emplaceBack(b+2,b+3),I.emplaceBack(b+3,b),v.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,o,l,h,f){for(let m=l;m<h;m++){const v=o.get(m),b=this.getSymbolInstanceTextSize(e,f,t,m);this._addCollisionDebugVertices(v,b,this.textCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,f)}}_addIconDebugCollisionBoxes(e,t,o,l,h,f){for(let m=l;m<h;m++){const v=o.get(m),b=this.getSymbolInstanceIconSize(e,t,m);this._addCollisionDebugVertices(v,b,this.iconCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,f)}}generateCollisionDebugBuffers(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new jm(Vr,Jy.members,er),this.iconCollisionBox=new jm(Vr,Jy.members,er);const o=rc(this.iconSizeData,e),l=rc(this.textSizeData,e);for(let h=0;h<this.symbolInstances.length;h++){const f=this.symbolInstances.get(h);this._addTextDebugCollisionBoxes(l,e,t,f.textBoxStartIndex,f.textBoxEndIndex,f),this._addTextDebugCollisionBoxes(l,e,t,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f),this._addIconDebugCollisionBoxes(o,e,t,f.iconBoxStartIndex,f.iconBoxEndIndex,f),this._addIconDebugCollisionBoxes(o,e,t,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f)}}getSymbolInstanceTextSize(e,t,o,l){const h=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:l),f=lf(this.textSizeData,e,h)/Xn;return this.tilePixelRatio*f}getSymbolInstanceIconSize(e,t,o){const l=this.icon.placedSymbolArray.get(o),h=lf(this.iconSizeData,e,l);return this.tilePixelRatio*h}_commitDebugCollisionVertexUpdate(e,t,o){e.emplaceBack(t,-o,-o),e.emplaceBack(t,o,-o),e.emplaceBack(t,o,o),e.emplaceBack(t,-o,o)}_updateTextDebugCollisionBoxes(e,t,o,l,h,f){for(let m=l;m<h;m++){const v=o.get(m),b=this.getSymbolInstanceTextSize(e,f,t,m);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,b,v.padding)}}_updateIconDebugCollisionBoxes(e,t,o,l,h){for(let f=l;f<h;f++){const m=o.get(f),v=this.getSymbolInstanceIconSize(e,t,f);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,v,m.padding)}}updateCollisionDebugBuffers(e,t){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const o=rc(this.iconSizeData,e),l=rc(this.textSizeData,e);for(let h=0;h<this.symbolInstances.length;h++){const f=this.symbolInstances.get(h);this._updateTextDebugCollisionBoxes(l,e,t,f.textBoxStartIndex,f.textBoxEndIndex,f),this._updateTextDebugCollisionBoxes(l,e,t,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f),this._updateIconDebugCollisionBoxes(o,e,t,f.iconBoxStartIndex,f.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(o,e,t,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,o,l,h,f,m,v,b){const S={};for(let M=t;M<o;M++){const I=e.get(M);S.textBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,padding:I.padding,projectedAnchorX:I.projectedAnchorX,projectedAnchorY:I.projectedAnchorY,projectedAnchorZ:I.projectedAnchorZ,tileAnchorX:I.tileAnchorX,tileAnchorY:I.tileAnchorY},S.textFeatureIndex=I.featureIndex;break}for(let M=l;M<h;M++){const I=e.get(M);S.verticalTextBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,padding:I.padding,projectedAnchorX:I.projectedAnchorX,projectedAnchorY:I.projectedAnchorY,projectedAnchorZ:I.projectedAnchorZ,tileAnchorX:I.tileAnchorX,tileAnchorY:I.tileAnchorY},S.verticalTextFeatureIndex=I.featureIndex;break}for(let M=f;M<m;M++){const I=e.get(M);S.iconBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,padding:I.padding,projectedAnchorX:I.projectedAnchorX,projectedAnchorY:I.projectedAnchorY,projectedAnchorZ:I.projectedAnchorZ,tileAnchorX:I.tileAnchorX,tileAnchorY:I.tileAnchorY},S.iconFeatureIndex=I.featureIndex;break}for(let M=v;M<b;M++){const I=e.get(M);S.verticalIconBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,padding:I.padding,projectedAnchorX:I.projectedAnchorX,projectedAnchorY:I.projectedAnchorY,projectedAnchorZ:I.projectedAnchorZ,tileAnchorX:I.tileAnchorX,tileAnchorY:I.tileAnchorY},S.verticalIconFeatureIndex=I.featureIndex;break}return S}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const o=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,t){const o=e.placedSymbolArray.get(t),l=o.vertexStartIndex+4*o.numGlyphs;for(let h=o.vertexStartIndex;h<l;h+=4)e.indexArray.emplaceBack(h,h+1,h+2),e.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const t=Math.sin(e),o=Math.cos(e),l=[],h=[],f=[];for(let m=0;m<this.symbolInstances.length;++m){f.push(m);const v=this.symbolInstances.get(m);l.push(0|Math.round(t*v.tileAnchorX+o*v.tileAnchorY)),h.push(v.featureIndex)}return f.sort((m,v)=>l[m]-l[v]||h[v]-h[m]),f}addToSortKeyRanges(e,t){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===t?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const o=this.symbolInstances.get(t);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((l,h,f)=>{l>=0&&f.indexOf(l)===h&&this.addIndicesForPlacedSymbol(this.text,l)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Rt(Hs,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Hs.MAX_GLYPHS=65535,Hs.addDynamicAttributes=wf;const z2=new Je({"symbol-placement":new ue(Me.layout_symbol["symbol-placement"]),"symbol-spacing":new ue(Me.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ue(Me.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new be(Me.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ue(Me.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ue(Me.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ue(Me.layout_symbol["icon-ignore-placement"]),"icon-optional":new ue(Me.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ue(Me.layout_symbol["icon-rotation-alignment"]),"icon-size":new be(Me.layout_symbol["icon-size"]),"icon-text-fit":new ue(Me.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ue(Me.layout_symbol["icon-text-fit-padding"]),"icon-image":new be(Me.layout_symbol["icon-image"]),"icon-rotate":new be(Me.layout_symbol["icon-rotate"]),"icon-padding":new ue(Me.layout_symbol["icon-padding"]),"icon-keep-upright":new ue(Me.layout_symbol["icon-keep-upright"]),"icon-offset":new be(Me.layout_symbol["icon-offset"]),"icon-anchor":new be(Me.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ue(Me.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ue(Me.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ue(Me.layout_symbol["text-rotation-alignment"]),"text-field":new be(Me.layout_symbol["text-field"]),"text-font":new be(Me.layout_symbol["text-font"]),"text-size":new be(Me.layout_symbol["text-size"]),"text-max-width":new be(Me.layout_symbol["text-max-width"]),"text-line-height":new be(Me.layout_symbol["text-line-height"]),"text-letter-spacing":new be(Me.layout_symbol["text-letter-spacing"]),"text-justify":new be(Me.layout_symbol["text-justify"]),"text-radial-offset":new be(Me.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ue(Me.layout_symbol["text-variable-anchor"]),"text-anchor":new be(Me.layout_symbol["text-anchor"]),"text-max-angle":new ue(Me.layout_symbol["text-max-angle"]),"text-writing-mode":new ue(Me.layout_symbol["text-writing-mode"]),"text-rotate":new be(Me.layout_symbol["text-rotate"]),"text-padding":new ue(Me.layout_symbol["text-padding"]),"text-keep-upright":new ue(Me.layout_symbol["text-keep-upright"]),"text-transform":new be(Me.layout_symbol["text-transform"]),"text-offset":new be(Me.layout_symbol["text-offset"]),"text-allow-overlap":new ue(Me.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ue(Me.layout_symbol["text-ignore-placement"]),"text-optional":new ue(Me.layout_symbol["text-optional"])});var qm={paint:new Je({"icon-opacity":new be(Me.paint_symbol["icon-opacity"]),"icon-color":new be(Me.paint_symbol["icon-color"]),"icon-halo-color":new be(Me.paint_symbol["icon-halo-color"]),"icon-halo-width":new be(Me.paint_symbol["icon-halo-width"]),"icon-halo-blur":new be(Me.paint_symbol["icon-halo-blur"]),"icon-translate":new ue(Me.paint_symbol["icon-translate"]),"icon-translate-anchor":new ue(Me.paint_symbol["icon-translate-anchor"]),"text-opacity":new be(Me.paint_symbol["text-opacity"]),"text-color":new be(Me.paint_symbol["text-color"],{runtimeType:Br,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new be(Me.paint_symbol["text-halo-color"]),"text-halo-width":new be(Me.paint_symbol["text-halo-width"]),"text-halo-blur":new be(Me.paint_symbol["text-halo-blur"]),"text-translate":new ue(Me.paint_symbol["text-translate"]),"text-translate-anchor":new ue(Me.paint_symbol["text-translate-anchor"])}),layout:z2};class Uv{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Ss,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Rt(Uv,"FormatSectionOverride",{omit:["defaultValue"]});class Tf extends co{constructor(e){super(e,qm)}recalculate(e,t){super.recalculate(e,t),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const o=this.layout.get("text-writing-mode");if(o){const l=[];for(const h of o)l.indexOf(h)<0&&l.push(h);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,t,o,l){const h=this.layout.get(e).evaluate(t,{},o,l),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||Vl(f.value)||!h?h:function(m,v){return v.replace(/{([^{}]+)}/g,(b,S)=>S in m?String(m[S]):"")}(t.properties,h)}createBucket(e){return new Hs(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of qm.paint.overridableProperties){if(!Tf.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),o=new Uv(t),l=new wu(o,t.property.specification);let h=null;h=t.value.kind==="constant"||t.value.kind==="source"?new Tu("source",l):new Pa("composite",l,t.value.zoomStops,t.value._interpolationType),this.paint._values[e]=new oe(t.property,h,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,o){return!(!this.layout||t.isDataDriven()||o.isDataDriven())&&Tf.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const o=e.get("text-field"),l=qm.paint.properties[t];let h=!1;const f=m=>{for(const v of m)if(l.overrides&&l.overrides.hasOverride(v))return void(h=!0)};if(o.value.kind==="constant"&&o.value.value instanceof lr)f(o.value.value.sections);else if(o.value.kind==="source"){const m=b=>{h||(b instanceof xa&&yn(b.value)===_a?f(b.value.sections):b instanceof wa?f(b.sections):b.eachChild(m))},v=o.value;v._styleExpression&&m(v._styleExpression.expression)}return h}getProgramConfiguration(e){return new qs(this,e)}}var P2={paint:new Je({"background-color":new ue(Me.paint_background["background-color"]),"background-pattern":new dt(Me.paint_background["background-pattern"]),"background-opacity":new ue(Me.paint_background["background-opacity"])})},D2={paint:new Je({"raster-opacity":new ue(Me.paint_raster["raster-opacity"]),"raster-hue-rotate":new ue(Me.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ue(Me.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ue(Me.paint_raster["raster-brightness-max"]),"raster-saturation":new ue(Me.paint_raster["raster-saturation"]),"raster-contrast":new ue(Me.paint_raster["raster-contrast"]),"raster-resampling":new ue(Me.paint_raster["raster-resampling"]),"raster-fade-duration":new ue(Me.paint_raster["raster-fade-duration"])})};class L2 extends co{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var B2={paint:new Je({"sky-type":new ue(Me.paint_sky["sky-type"]),"sky-atmosphere-sun":new ue(Me.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ue(Me.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ue(Me.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ue(Me.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ie(Me.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ue(Me.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ue(Me.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ue(Me.paint_sky["sky-opacity"])})};function $m(i,e,t){const o=[0,0,1],l=by([]);return Ty(l,l,t?-le(i)+Math.PI:le(i)),wy(l,l,-le(e)),yy(o,o,l),ur(o,o)}const R2={circle:class extends co{constructor(i){super(i,Uw)}createBucket(i){return new om(i)}queryRadius(i){const e=i;return Ql("circle-radius",this,e)+Ql("circle-stroke-width",this,e)+Wd(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,t,o,l,h,f,m){const v=dy(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,i.pixelToTileUnitsFactor),b=this.paint.get("circle-radius").evaluate(e,t)+this.paint.get("circle-stroke-width").evaluate(e,t);return Ey(i,o,h,f,m,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",v,b)}getProgramIds(){return["circle"]}getProgramConfiguration(i){return new qs(this,i)}},heatmap:class extends co{createBucket(i){return new Cy(i)}constructor(i){super(i,Ww),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=vm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return Ql("heatmap-radius",this,i)}queryIntersectsFeature(i,e,t,o,l,h,f,m){const v=this.paint.get("heatmap-radius").evaluate(e,t);return Ey(i,o,h,f,m,!0,!0,new N(0,0),v)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(i){return new qs(this,i)}},hillshade:class extends co{constructor(i){super(i,Hw)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends co{constructor(i){super(i,hT)}getProgramIds(){const i=this.paint.get("fill-pattern"),e=i&&i.constantOr(1),t=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&t.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),t}getProgramConfiguration(i){return new qs(this,i)}recalculate(i,e){super.recalculate(i,e);const t=this.paint._values["fill-outline-color"];t.value.kind==="constant"&&t.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new nf(i)}queryRadius(){return Wd(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,t,o,l,h){return!i.queryGeometry.isAboveHorizon&&ay(hy(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,i.pixelToTileUnitsFactor),o)}isTileClipped(){return!0}},"fill-extrusion":class extends co{constructor(i){super(i,ET)}createBucket(i){return new Ju(i)}queryRadius(){return Wd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(i){return new qs(this,i)}queryIntersectsFeature(i,e,t,o,l,h,f,m,v){const b=dy(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,i.pixelToTileUnitsFactor),S=this.paint.get("fill-extrusion-height").evaluate(e,t),M=this.paint.get("fill-extrusion-base").evaluate(e,t),I=[0,0],P=m&&h.elevation,L=h.elevation?h.elevation.exaggeration():1,U=i.tile.getBucket(this);if(P&&U instanceof Ju){const se=U.centroidVertexArray,ie=v+1;if(ie<se.length){const re=se.get(ie);I[0]=re.a_centroid_pos0,I[1]=re.a_centroid_pos1}}if(I[0]===0&&I[1]===1)return!1;h.projection.name==="globe"&&(o=$y([o],[new N(0,0),new N(ei,ei)],i.tileID.canonical).map(se=>se.polygon).flat());const $=function(se,ie,re,_e,ce,Ve,Oe,We,yt,je,et){return se.projection.name==="globe"?function(at,tt,ft,lt,kt,li,hi,Gt,Tt,wi,oi){const Dt=[],Yi=[],Zi=at.projection.upVectorScale(oi,at.center.lat,at.worldSize).metersToTile,on=[0,0,0,1],fi=[0,0,0,1],ki=(Wi,$i,nn,ln)=>{Wi[0]=$i,Wi[1]=nn,Wi[2]=ln,Wi[3]=1},Ji=qy();ft>0&&(ft+=Ji),lt+=Ji;for(const Wi of tt){const $i=[],nn=[];for(const ln of Wi){const Vn=ln.x+kt.x,br=ln.y+kt.y,Ei=at.projection.projectTilePoint(Vn,br,oi),mn=at.projection.upVector(oi,ln.x,ln.y);let ir=ft,Fi=lt;if(hi){const cn=Hy(Vn,br,ft,lt,hi,Gt,Tt,wi);ir+=cn.base,Fi+=cn.top}ft!==0?ki(on,Ei.x+mn[0]*Zi*ir,Ei.y+mn[1]*Zi*ir,Ei.z+mn[2]*Zi*ir):ki(on,Ei.x,Ei.y,Ei.z),ki(fi,Ei.x+mn[0]*Zi*Fi,Ei.y+mn[1]*Zi*Fi,Ei.z+mn[2]*Zi*Fi),Dn(on,on,li),Dn(fi,fi,li),$i.push(sf(on)),nn.push(sf(fi))}Dt.push($i),Yi.push(nn)}return[Dt,Yi]}(se,ie,re,_e,ce,Ve,Oe,We,yt,je,et):Oe?function(at,tt,ft,lt,kt,li,hi,Gt,Tt){const wi=[],oi=[],Dt=[0,0,0,1];for(const Yi of at){const Zi=[],on=[];for(const fi of Yi){const ki=fi.x+lt.x,Ji=fi.y+lt.y,Wi=Hy(ki,Ji,tt,ft,li,hi,Gt,Tt);Dt[0]=ki,Dt[1]=Ji,Dt[2]=Wi.base,Dt[3]=1,Xa(Dt,Dt,kt),Dt[3]=Math.max(Dt[3],1e-5);const $i=sf([Dt[0]/Dt[3],Dt[1]/Dt[3],Dt[2]/Dt[3]]);Dt[0]=ki,Dt[1]=Ji,Dt[2]=Wi.top,Dt[3]=1,Xa(Dt,Dt,kt),Dt[3]=Math.max(Dt[3],1e-5);const nn=sf([Dt[0]/Dt[3],Dt[1]/Dt[3],Dt[2]/Dt[3]]);Zi.push($i),on.push(nn)}wi.push(Zi),oi.push(on)}return[wi,oi]}(ie,re,_e,ce,Ve,Oe,We,yt,je):function(at,tt,ft,lt,kt){const li=[],hi=[],Gt=kt[8]*tt,Tt=kt[9]*tt,wi=kt[10]*tt,oi=kt[11]*tt,Dt=kt[8]*ft,Yi=kt[9]*ft,Zi=kt[10]*ft,on=kt[11]*ft;for(const fi of at){const ki=[],Ji=[];for(const Wi of fi){const $i=Wi.x+lt.x,nn=Wi.y+lt.y,ln=kt[0]*$i+kt[4]*nn+kt[12],Vn=kt[1]*$i+kt[5]*nn+kt[13],br=kt[2]*$i+kt[6]*nn+kt[14],Ei=kt[3]*$i+kt[7]*nn+kt[15],mn=ln+Gt,ir=Vn+Tt,Fi=br+wi,cn=Math.max(Ei+oi,1e-5),dr=ln+Dt,sn=Vn+Yi,vn=br+Zi,Un=Math.max(Ei+on,1e-5),Bn=new N(mn/cn,ir/cn);Bn.z=Fi/cn,ki.push(Bn);const Kn=new N(dr/Un,sn/Un);Kn.z=vn/Un,Ji.push(Kn)}li.push(ki),hi.push(Ji)}return[li,hi]}(ie,re,_e,ce,Ve)}(h,o,M,S,b,f,P?m:null,I,L,h.center.lat,i.tileID.canonical),ee=i.queryGeometry;return function(se,ie,re){let _e=1/0;ay(re,ie)&&(_e=Wy(re,ie[0]));for(let ce=0;ce<ie.length;ce++){const Ve=ie[ce],Oe=se[ce];for(let We=0;We<Ve.length-1;We++){const yt=Ve[We],je=[yt,Ve[We+1],Oe[We+1],Oe[We],yt];sy(re,je)&&(_e=Math.min(_e,Wy(re,je)))}}return _e!==1/0&&_e}($[0],$[1],ee.isPointQuery()?ee.screenBounds:ee.screenGeometry)}},line:class extends co{constructor(i){super(i,Xy),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof iu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=Ky.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new af(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(i){return new qs(this,i)}queryRadius(i){const e=i,t=Yy(Ql("line-width",this,e),Ql("line-gap-width",this,e)),o=Ql("line-offset",this,e);return t/2+Math.abs(o)+Wd(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,t,o,l,h){if(i.queryGeometry.isAboveHorizon)return!1;const f=hy(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,i.pixelToTileUnitsFactor),m=i.pixelToTileUnitsFactor/2*Yy(this.paint.get("line-width").evaluate(e,t),this.paint.get("line-gap-width").evaluate(e,t)),v=this.paint.get("line-offset").evaluate(e,t);return v&&(o=function(b,S){const M=[],I=new N(0,0);for(let P=0;P<b.length;P++){const L=b[P],U=[];for(let $=0;$<L.length;$++){const ee=L[$-1],se=L[$],ie=L[$+1],re=$===0?I:se.sub(ee)._unit()._perp(),_e=$===L.length-1?I:ie.sub(se)._unit()._perp(),ce=re._add(_e)._unit();ce._mult(1/(ce.x*_e.x+ce.y*_e.y)),U.push(ce._mult(S)._add(se))}M.push(U)}return M}(o,v*i.pixelToTileUnitsFactor)),function(b,S,M){for(let I=0;I<S.length;I++){const P=S[I];if(b.length>=3){for(let L=0;L<P.length;L++)if(Wa(b,P[L]))return!0}if(Rw(b,P,M))return!0}return!1}(f,o,m)}isTileClipped(){return!0}},symbol:Tf,background:class extends co{constructor(i){super(i,P2)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends co{constructor(i){super(i,D2)}getProgramIds(){return["raster"]}},sky:class extends co{constructor(i){super(i,B2),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=vm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(i,e){if(this.paint.get("sky-type")==="atmosphere"){const o=this.paint.get("sky-atmosphere-sun"),l=!o,h=i.style.light,f=h.properties.get("position");return l&&h.properties.get("anchor")==="viewport"&&xt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),l?$m(f.azimuthal,90-f.polar,e):$m(o[0],90-o[1],e)}const t=this.paint.get("sky-gradient-center");return $m(t[0],90-t[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}}};class fh{constructor(e,t,o,l){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(t,l)}update(e,t,o){const{width:l,height:h}=e,{context:f}=this,{gl:m}=f,{HTMLImageElement:v,HTMLCanvasElement:b,HTMLVideoElement:S,ImageData:M,ImageBitmap:I}=D;if(m.bindTexture(m.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===m.RGBA&&(!t||t.premultiply!==!1)),o||this.size&&this.size[0]===l&&this.size[1]===h){const{x:P,y:L}=o||{x:0,y:0};e instanceof v||e instanceof b||e instanceof S||e instanceof M||I&&e instanceof I?m.texSubImage2D(m.TEXTURE_2D,0,P,L,m.RGBA,m.UNSIGNED_BYTE,e):m.texSubImage2D(m.TEXTURE_2D,0,P,L,l,h,m.RGBA,m.UNSIGNED_BYTE,e.data)}else this.size=[l,h],e instanceof v||e instanceof b||e instanceof S||e instanceof M||I&&e instanceof I?m.texImage2D(m.TEXTURE_2D,0,this.format,this.format,m.UNSIGNED_BYTE,e):m.texImage2D(m.TEXTURE_2D,0,this.format,l,h,0,this.format,m.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(t&&t.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&m.generateMipmap(m.TEXTURE_2D)}bind(e,t){const{context:o}=this,{gl:l}=o;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.filter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,this.useMipmap?e===l.NEAREST?l.NEAREST_MIPMAP_NEAREST:l.LINEAR_MIPMAP_NEAREST:e),this.filter=e),t!==this.wrap&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,t),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,t),this.wrap=t)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Gm{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new hs({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const o=this.getKey(e,t);return this.positions[o]}trim(){const e=this.width,t=this.height=Ye(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,o){const l=[];let h=e.length%2==1?-e[e.length-1]*o:0,f=e[0]*o,m=!0;l.push({left:h,right:f,isDash:m,zeroLength:e[0]===0});let v=e[0];for(let b=1;b<e.length;b++){m=!m;const S=e[b];h=v*o,v+=S,f=v*o,l.push({left:h,right:f,isDash:m,zeroLength:S===0})}return l}addRoundDash(e,t,o){const l=t/2;for(let h=-o;h<=o;h++){const f=this.width*(this.nextRow+o+h);let m=0,v=e[m];for(let b=0;b<this.width;b++){b/v.right>1&&(v=e[++m]);const S=Math.abs(b-v.left),M=Math.abs(b-v.right),I=Math.min(S,M);let P;const L=h/o*(l+1);if(v.isDash){const U=l-Math.abs(L);P=Math.sqrt(I*I+U*U)}else P=l-Math.sqrt(I*I+L*L);this.image.data[f+b]=Math.max(0,Math.min(255,P+128))}}}addRegularDash(e,t){for(let v=e.length-1;v>=0;--v){const b=e[v],S=e[v+1];b.zeroLength?e.splice(v,1):S&&S.isDash===b.isDash&&(S.left=b.left,e.splice(v,1))}const o=e[0],l=e[e.length-1];o.isDash===l.isDash&&(o.left=l.left-this.width,l.right=o.right+this.width);const h=this.width*this.nextRow;let f=0,m=e[f];for(let v=0;v<this.width;v++){v/m.right>1&&(m=e[++f]);const b=Math.abs(v-m.left),S=Math.abs(v-m.right),M=Math.min(b,S);this.image.data[h+v]=Math.max(0,Math.min(255,(m.isDash?M:-M)+t+128))}}addDash(e,t){const o=this.getKey(e,t);if(this.positions[o])return this.positions[o];const l=t==="round",h=l?7:0,f=2*h+1;if(this.nextRow+f>this.height)return xt("LineAtlas out of space"),null;e.length===0&&e.push(1);let m=0;for(let S=0;S<e.length;S++)e[S]<0&&(xt("Negative value is found in line dasharray, replacing values with 0"),e[S]=0),m+=e[S];if(m!==0){const S=this.width/m,M=this.getDashRanges(e,this.width,S);l?this.addRoundDash(M,S,h):this.addRegularDash(M,t==="square"?.5*S:0)}const v=this.nextRow+h;this.nextRow+=f;const b={tl:[v,h],br:[m,0]};return this.positions[o]=b,b}}Rt(Gm,"LineAtlas");class O2{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class F2{constructor(){this.tasks={},this.taskQueue=[],Ht(["process"],this),this.invoker=new O2(this.process),this.nextId=0}add(e,t){const o=this.nextId++,l=function({type:h,isSymbolTile:f,zoom:m}){return m=m||0,h==="message"?0:h!=="maybePrepare"||f?h!=="parseTile"||f?h==="parseTile"&&f?300-m:h==="maybePrepare"&&f?400-m:500:200-m:100-m}(t);if(l===0){Ci();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[o]={fn:e,metadata:t,priority:l,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){Ci();try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let l=0;l<this.taskQueue.length;l++){const h=this.tasks[this.taskQueue[l]];h.priority<t&&(t=h.priority,e=l)}if(e===null)return null;const o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}class Nv{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const o=e[t];this._stringToNumber[o]=t,this._numberToString[t]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const V2=["tile","layer","source","sourceLayer","state"];class jv{constructor(e,t,o,l,h){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=o,this._y=l,this.properties=e.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const t of V2)this[t]!==void 0&&(e[t]=this[t]);return e}}const Hr=32,No=33,Xs=new Uint16Array(8184);for(let i=0;i<2046;i++){let e=i+2,t=0,o=0,l=0,h=0,f=0,m=0;for(1&e?l=h=f=Hr:t=o=m=Hr;(e>>=1)>1;){const b=t+l>>1,S=o+h>>1;1&e?(l=t,h=o,t=f,o=m):(t=l,o=h,l=f,h=m),f=b,m=S}const v=4*i;Xs[v+0]=t,Xs[v+1]=o,Xs[v+2]=l,Xs[v+3]=h}const jo=new Uint16Array(2178),Ks=new Uint8Array(1089),Ef=new Uint16Array(1089);function qv(i){return i===0?-.03125:i===32?.03125:0}var $v=it([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Gv={type:2,extent:ei,loadGeometry:()=>[[new N(0,0),new N(8193,0),new N(8193,8193),new N(0,8193),new N(0,0)]]};class Zm{constructor(e,t,o,l,h){this.tileID=e,this.uid=$e(),this.uses=0,this.tileSize=t,this.tileZoom=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=h,this.expiredRequestCount=0,this.state="loading",l&&l.transform&&(this.projection=l.transform.projection)}registerFadeDuration(e){const t=e+this.timeAdded;t<Mt.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Ja(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,t,o){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(l,h){const f={};if(!h)return f;for(const m of l){const v=m.layerIds.map(b=>h.getLayer(b)).filter(Boolean);if(v.length!==0){m.layers=v,m.stateDependentLayerIds&&(m.stateDependentLayers=m.stateDependentLayerIds.map(b=>v.filter(S=>S.id===b)[0]));for(const b of v)f[b.id]=m}}return f}(e.buckets,t.style),this.hasSymbolBuckets=!1;for(const l in this.buckets){const h=this.buckets[l];if(h instanceof Hs){if(this.hasSymbolBuckets=!0,!o)break;h.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const l in this.buckets){const h=this.buckets[l];if(h instanceof Hs&&h.hasRTLText){this.hasRTLText=!0,W.isLoading()||W.isLoaded()||j()!=="deferred"||K();break}}this.queryPadding=0;for(const l in this.buckets){const h=this.buckets[l];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(l).queryRadius(h))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Bo}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const o in this.buckets){const l=this.buckets[o];l.uploadPending()&&l.upload(e)}const t=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new fh(e,this.imageAtlas.image,t.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new fh(e,this.glyphAtlasImage,t.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new fh(e,this.lineAtlas.image,t.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,t,o,l,h,f,m,v){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:l,pixelPosMatrix:m,transform:f,params:h,tileTransform:this.tileTransform},e,t,o):{}}querySourceFeatures(e,t){const o=this.latestFeatureIndex;if(!o||!o.rawTileData)return;const l=o.loadVTLayers(),h=t?t.sourceLayer:"",f=l._geojsonTileLayer||l[h];if(!f)return;const m=Ra(t&&t.filter),{z:v,x:b,y:S}=this.tileID.canonical,M={z:v,x:b,y:S};for(let I=0;I<f.length;I++){const P=f.feature(I);if(m.needGeometry){const $=Za(P,!0);if(!m.filter(new H(this.tileID.overscaledZ),$,this.tileID.canonical))continue}else if(!m.filter(new H(this.tileID.overscaledZ),P))continue;const L=o.getId(P,h),U=new jv(P,v,b,S,L);U.tile=M,e.push(U)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const t=this.expirationTime;if(e.cacheControl){const o=Kt(e.cacheControl);o["max-age"]&&(this.expirationTime=Date.now()+1e3*o["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const o=Date.now();let l=!1;if(this.expirationTime>o)l=!1;else if(t)if(this.expirationTime<t)l=!0;else{const h=this.expirationTime-t;h?this.expirationTime=o+Math.max(h,3e4):l=!0}else l=!0;l?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!t)return;const o=this.latestFeatureIndex.loadVTLayers(),l=t.style.listImages();for(const h in this.buckets){if(!t.style.hasLayer(h))continue;const f=this.buckets[h],m=f.layers[0].sourceLayer||"_geojsonTileLayer",v=o[m],b=e[m];if(!v||!b||Object.keys(b).length===0)continue;if(f.update(b,v,l,this.imageAtlas&&this.imageAtlas.patternPositions||{}),f instanceof af||f instanceof nf){const M=t.style._getSourceCache(f.layers[0].source);t._terrain&&t._terrain.enabled&&M&&f.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(M.id,this.tileID)}const S=t&&t.style&&t.style.getLayer(h);S&&(this.queryPadding=Math.max(this.queryPadding,S.queryRadius(f)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Mt.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Mt.now()+e}setTexture(e,t){const o=t.context,l=o.gl;this.texture=t.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new fh(o,e,l.RGBA,{useMipmap:!0}),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),o.extTextureFilterAnisotropic&&l.texParameterf(l.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax))}setDependencies(e,t){const o={};for(const l of t)o[l]=!0;this.dependencies[e]=o}hasDependency(e,t){for(const o of e){const l=this.dependencies[o];if(l){for(const h of t)if(l[h])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,t){if(!t||t.name==="mercator"||this._tileDebugBuffer)return;const o=us(Gv,this.tileID.canonical,this.tileTransform)[0],l=new St,h=new ns;for(let f=0;f<o.length;f++){const{x:m,y:v}=o[f];l.emplaceBack(m,v),h.emplaceBack(f)}h.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(h),this._tileDebugBuffer=e.createVertexBuffer(l,oh.members),this._tileDebugSegments=In.simpleSegment(0,0,l.length,h.length)}_makeTileBoundsBuffers(e,t){if(this._tileBoundsBuffer||!t||t.name==="mercator")return;const o=us(Gv,this.tileID.canonical,this.tileTransform)[0];let l,h;if(this.isRaster){const f=function(m,v){const b=Ja(m,v),S=Math.pow(2,m.z);for(let $=0;$<No;$++)for(let ee=0;ee<No;ee++){const se=Zr((m.x+(ee+qv(ee))/Hr)/S),ie=Hn((m.y+($+qv($))/Hr)/S),re=v.project(se,ie),_e=$*No+ee;jo[2*_e+0]=Math.round((re.x*b.scale-b.x)*ei),jo[2*_e+1]=Math.round((re.y*b.scale-b.y)*ei)}Ks.fill(0),Ef.fill(0);for(let $=2045;$>=0;$--){const ee=4*$,se=Xs[ee+0],ie=Xs[ee+1],re=Xs[ee+2],_e=Xs[ee+3],ce=se+re>>1,Ve=ie+_e>>1,Oe=ce+Ve-ie,We=Ve+se-ce,yt=ie*No+se,je=_e*No+re,et=Ve*No+ce,at=Math.hypot((jo[2*yt+0]+jo[2*je+0])/2-jo[2*et+0],(jo[2*yt+1]+jo[2*je+1])/2-jo[2*et+1])>=16;if(Ks[et]=Ks[et]||(at?1:0),$<1022){const tt=(ie+We>>1)*No+(se+Oe>>1),ft=(_e+We>>1)*No+(re+Oe>>1);Ks[et]=Ks[et]||Ks[tt]||Ks[ft]}}const M=new Wt,I=new _i;let P=0;function L($,ee){const se=ee*No+$;return Ef[se]===0&&(M.emplaceBack(jo[2*se+0],jo[2*se+1],$*ei/Hr,ee*ei/Hr),Ef[se]=++P),Ef[se]-1}function U($,ee,se,ie,re,_e){const ce=$+se>>1,Ve=ee+ie>>1;if(Math.abs($-re)+Math.abs(ee-_e)>1&&Ks[Ve*No+ce])U(re,_e,$,ee,ce,Ve),U(se,ie,re,_e,ce,Ve);else{const Oe=L($,ee),We=L(se,ie),yt=L(re,_e);I.emplaceBack(Oe,We,yt)}}return U(0,0,Hr,Hr,Hr,0),U(Hr,Hr,0,0,0,Hr),{vertices:M,indices:I}}(this.tileID.canonical,t);l=f.vertices,h=f.indices}else{l=new Wt,h=new _i;for(const{x:m,y:v}of o)l.emplaceBack(m,v,0,0);const f=Yd(l.int16,void 0,4);for(let m=0;m<f.length;m+=3)h.emplaceBack(f[m],f[m+1],f[m+2])}this._tileBoundsBuffer=e.createVertexBuffer(l,$v.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(h),this._tileBoundsSegments=In.simpleSegment(0,0,l.length,h.length)}_makeGlobeTileDebugBuffers(e,t){const o=t.projection;if(!o||o.name!=="globe"||t.freezeTileCoverage)return;const l=this.tileID.canonical,h=ah(Mv(l,t)),f=lh(t.zoom);let m;f>0&&(m=lm(new Float64Array(16),t.globeMatrix));const v=(l.x+.5)/(1<<l.z)-Ro(t.center.lng);let b=0;v>.5?b=-1:v<-.5&&(b=1),this._makeGlobeTileDebugBorderBuffer(e,l,t,h,m,f,b),this._makeGlobeTileDebugTextBuffer(e,l,t,h,m,f,b)}_globePoint(e,t,o,l,h,f,m,v){let b=sh(e,t,o);if(f){const S=1<<o.z,M=[((e/ei+o.x)/S+v)*l,(t/ei+o.y)/S*l,0];Dn(M,M,f),b=Is(b,M,m)}return Dn(b,b,h)}_makeGlobeTileDebugBorderBuffer(e,t,o,l,h,f,m){const v=new St,b=new ns,S=new Vt,M=(P,L,U,$,ee)=>{const se=(U-P)/(ee-1),ie=($-L)/(ee-1),re=v.length;for(let _e=0;_e<ee;_e++){const ce=P+_e*se,Ve=L+_e*ie;v.emplaceBack(ce,Ve);const Oe=this._globePoint(ce,Ve,t,o.worldSize,l,h,f,m);S.emplaceBack(Oe[0],Oe[1],Oe[2]),b.emplaceBack(re+_e)}},I=ei;M(0,0,I,0,16),M(I,0,I,I,16),M(I,I,0,I,16),M(0,I,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(b),this._tileDebugBuffer=e.createVertexBuffer(v,oh.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(S,Cv.members),this._tileDebugSegments=In.simpleSegment(0,0,v.length,b.length)}_makeGlobeTileDebugTextBuffer(e,t,o,l,h,f,m){const v=new St,b=new _i,S=new Vt,M=25;b.reserve(32),v.reserve(M),S.reserve(M);const I=(P,L)=>M*P+L;for(let P=0;P<M;P++){const L=2048*P;for(let U=0;U<M;U++){const $=2048*U;v.emplaceBack($,L);const ee=this._globePoint($,L,t,o.worldSize,l,h,f,m);S.emplaceBack(ee[0],ee[1],ee[2])}}for(let P=0;P<4;P++)for(let L=0;L<4;L++){const U=I(P,L),$=I(P,L+1),ee=I(P+1,L),se=I(P+1,L+1);b.emplaceBack(U,$,ee),b.emplaceBack(ee,$,se)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(b),this._tileDebugTextBuffer=e.createVertexBuffer(v,oh.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(S,Cv.members),this._tileDebugTextSegments=In.simpleSegment(0,0,M,32)}}class U2{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,t,o){const l=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][l]=this.stateChanges[e][l]||{},Ue(this.stateChanges[e][l],o),this.deletedStates[e]===null){this.deletedStates[e]={};for(const h in this.state[e])h!==l&&(this.deletedStates[e][h]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][l]===null){this.deletedStates[e][l]={};for(const h in this.state[e][l])o[h]||(this.deletedStates[e][l][h]=null)}else for(const h in o)this.deletedStates[e]&&this.deletedStates[e][l]&&this.deletedStates[e][l][h]===null&&delete this.deletedStates[e][l][h]}removeFeatureState(e,t,o){if(this.deletedStates[e]===null)return;const l=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},o&&t!==void 0)this.deletedStates[e][l]!==null&&(this.deletedStates[e][l]=this.deletedStates[e][l]||{},this.deletedStates[e][l][o]=null);else if(t!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][l])for(o in this.deletedStates[e][l]={},this.stateChanges[e][l])this.deletedStates[e][l][o]=null;else this.deletedStates[e][l]=null;else this.deletedStates[e]=null}getState(e,t){const o=String(t),l=Ue({},(this.state[e]||{})[o],(this.stateChanges[e]||{})[o]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const h=this.deletedStates[e][t];if(h===null)return{};for(const f in h)delete l[f]}return l}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,t){const o={};for(const l in this.stateChanges){this.state[l]=this.state[l]||{};const h={};for(const f in this.stateChanges[l])this.state[l][f]||(this.state[l][f]={}),Ue(this.state[l][f],this.stateChanges[l][f]),h[f]=this.state[l][f];o[l]=h}for(const l in this.deletedStates){this.state[l]=this.state[l]||{};const h={};if(this.deletedStates[l]===null)for(const f in this.state[l])h[f]={},this.state[l][f]={};else for(const f in this.deletedStates[l]){if(this.deletedStates[l][f]===null)this.state[l][f]={};else for(const m of Object.keys(this.deletedStates[l][f]))delete this.state[l][f][m];h[f]=this.state[l][f]}o[l]=o[l]||{},Ue(o[l],h)}if(this.stateChanges={},this.deletedStates={},Object.keys(o).length!==0)for(const l in e)e[l].setFeatureState(o,t)}}class Zv{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const o=this.toIdx(e,t);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function Wv(i,e,t,o){let l=0,h=Number.MAX_VALUE;for(let f=0;f<3;f++)if(Math.abs(o[f])<1e-15){if(t[f]<i[f]||t[f]>e[f])return null}else{const m=1/o[f];let v=(i[f]-t[f])*m,b=(e[f]-t[f])*m;if(v>b){const S=v;v=b,b=S}if(v>l&&(l=v),b<h&&(h=b),l>h)return null}return l}function Hv(i,e,t,o,l,h,f,m,v,b,S){const M=o-i,I=l-e,P=h-t,L=f-i,U=m-e,$=v-t,ee=S[1]*$-S[2]*U,se=S[2]*L-S[0]*$,ie=S[0]*U-S[1]*L,re=M*ee+I*se+P*ie;if(Math.abs(re)<1e-15)return null;const _e=1/re,ce=b[0]-i,Ve=b[1]-e,Oe=b[2]-t,We=(ce*ee+Ve*se+Oe*ie)*_e;if(We<0||We>1)return null;const yt=Ve*P-Oe*I,je=Oe*M-ce*P,et=ce*I-Ve*M,at=(S[0]*yt+S[1]*je+S[2]*et)*_e;return at<0||We+at>1?null:(L*yt+U*je+$*et)*_e}function Xv(i,e,t){return(i-e)/(t-e)}function Kv(i,e,t,o,l,h,f,m,v){const b=1<<t,S=h-o,M=f-l,I=(i+1)/b*S+o,P=(e+0)/b*M+l,L=(e+1)/b*M+l;m[0]=(i+0)/b*S+o,m[1]=P,v[0]=I,v[1]=L}class Yv{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(h){const f=Math.ceil(Math.log2(h.dim/8)),m=[];let v=Math.ceil(Math.pow(2,f));const b=1/v,S=(P,L,U,$,ee)=>{const se=$?1:0,ie=(P+1)*U-se,re=L*U,_e=(L+1)*U-se;ee[0]=P*U,ee[1]=re,ee[2]=ie,ee[3]=_e};let M=new Zv(v);const I=[];for(let P=0;P<v*v;P++){S(P%v,Math.floor(P/v),b,!1,I);const L=Ys(I[0],I[1],h),U=Ys(I[2],I[1],h),$=Ys(I[2],I[3],h),ee=Ys(I[0],I[3],h);M.minimums.push(Math.min(L,U,$,ee)),M.maximums.push(Math.max(L,U,$,ee)),M.leaves.push(1)}for(m.push(M),v/=2;v>=1;v/=2){const P=m[m.length-1];M=new Zv(v);for(let L=0;L<v*v;L++){S(L%v,Math.floor(L/v),2,!0,I);const U=P.getElevation(I[0],I[1]),$=P.getElevation(I[2],I[1]),ee=P.getElevation(I[2],I[3]),se=P.getElevation(I[0],I[3]),ie=P.isLeaf(I[0],I[1]),re=P.isLeaf(I[2],I[1]),_e=P.isLeaf(I[2],I[3]),ce=P.isLeaf(I[0],I[3]),Ve=Math.min(U.min,$.min,ee.min,se.min),Oe=Math.max(U.max,$.max,ee.max,se.max),We=ie&&re&&_e&&ce;M.maximums.push(Oe),M.minimums.push(Ve),M.leaves.push(Oe-Ve<=5&&We?1:0)}m.push(M)}return m}(this.dem),o=t.length-1,l=t[o];this._addNode(l.minimums[0],l.maximums[0],l.leaves[0]),this._construct(t,0,0,o,0)}raycastRoot(e,t,o,l,h,f,m=1){return Wv([e,t,-100],[o,l,this.maximums[0]*m],h,f)}raycast(e,t,o,l,h,f,m=1){if(!this.nodeCount)return null;const v=this.raycastRoot(e,t,o,l,h,f,m);if(v==null)return null;const b=[],S=[],M=[],I=[],P=[{idx:0,t:v,nodex:0,nodey:0,depth:0}];for(;P.length>0;){const{idx:L,t:U,nodex:$,nodey:ee,depth:se}=P.pop();if(this.leaves[L]){Kv($,ee,se,e,t,o,l,M,I);const re=1<<se,_e=($+0)/re,ce=($+1)/re,Ve=(ee+0)/re,Oe=(ee+1)/re,We=Ys(_e,Ve,this.dem)*m,yt=Ys(ce,Ve,this.dem)*m,je=Ys(ce,Oe,this.dem)*m,et=Ys(_e,Oe,this.dem)*m,at=Hv(M[0],M[1],We,I[0],M[1],yt,I[0],I[1],je,h,f),tt=Hv(I[0],I[1],je,M[0],I[1],et,M[0],M[1],We,h,f),ft=Math.min(at!==null?at:Number.MAX_VALUE,tt!==null?tt:Number.MAX_VALUE);if(ft!==Number.MAX_VALUE)return ft;{const lt=Kd([],h,f,U);if(Jv(We,yt,et,je,Xv(lt[0],M[0],I[0]),Xv(lt[1],M[1],I[1]))>=lt[2])return U}continue}let ie=0;for(let re=0;re<this._siblingOffset.length;re++){Kv(($<<1)+this._siblingOffset[re][0],(ee<<1)+this._siblingOffset[re][1],se+1,e,t,o,l,M,I),M[2]=-100,I[2]=this.maximums[this.childOffsets[L]+re]*m;const _e=Wv(M,I,h,f);if(_e!=null){const ce=_e;b[re]=ce;let Ve=!1;for(let Oe=0;Oe<ie&&!Ve;Oe++)ce>=b[S[Oe]]&&(S.splice(Oe,0,re),Ve=!0);Ve||(S[ie]=re),ie++}}for(let re=0;re<ie;re++){const _e=S[re];P.push({idx:this.childOffsets[L]+_e,t:b[_e],nodex:($<<1)+this._siblingOffset[_e][0],nodey:(ee<<1)+this._siblingOffset[_e][1],depth:se+1})}}return null}_addNode(e,t,o){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,o,l,h){if(e[l].isLeaf(t,o)===1)return;this.childOffsets[h]||(this.childOffsets[h]=this.nodeCount);const f=l-1,m=e[f];let v=0,b=0;for(let S=0;S<this._siblingOffset.length;S++){const M=2*t+this._siblingOffset[S][0],I=2*o+this._siblingOffset[S][1],P=m.getElevation(M,I),L=m.isLeaf(M,I),U=this._addNode(P.min,P.max,L);L&&(v|=1<<S),b||(b=U)}for(let S=0;S<this._siblingOffset.length;S++)v&1<<S||this._construct(e,2*t+this._siblingOffset[S][0],2*o+this._siblingOffset[S][1],f,b+S)}}function Jv(i,e,t,o,l,h){return Mi(Mi(i,t,h),Mi(e,o,h),l)}function Ys(i,e,t){const o=t.dim,l=Se(i*o-.5,0,o-1),h=Se(e*o-.5,0,o-1),f=Math.floor(l),m=Math.floor(h),v=Math.min(f+1,o-1),b=Math.min(m+1,o-1);return Jv(t.get(f,m),t.get(v,m),t.get(f,b),t.get(v,b),l-f,h-m)}const Qv={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Sf{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,o,l=!1,h=!1){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return xt(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=t.height;const f=this.dim=t.height-2,m=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.encoding=o||"mapbox",this.borderReady=l,!l){for(let v=0;v<f;v++)m[this._idx(-1,v)]=m[this._idx(0,v)],m[this._idx(f,v)]=m[this._idx(f-1,v)],m[this._idx(v,-1)]=m[this._idx(v,0)],m[this._idx(v,f)]=m[this._idx(v,f-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(f,-1)]=m[this._idx(f-1,0)],m[this._idx(-1,f)]=m[this._idx(0,f-1)],m[this._idx(f,f)]=m[this._idx(f-1,f-1)],h&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Yv(this)}get(e,t,o=!1){o&&(e=Se(e,-1,this.dim),t=Se(t,-1,this.dim));const l=4*this._idx(e,t);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[l],this.pixels[l+1],this.pixels[l+2])}static getUnpackVector(e){return Qv[e]}get unpackVector(){return Qv[this.encoding]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}_unpackMapbox(e,t,o){return(256*e*256+256*t+o)/10-1e4}_unpackTerrarium(e,t,o){return 256*e+t+o/256-32768}static pack(e,t){const o=[0,0,0,0],l=Sf.getUnpackVector(t);let h=Math.floor((e+l[3])/l[2]);return o[2]=h%256,h=Math.floor(h/256),o[1]=h%256,h=Math.floor(h/256),o[0]=h,o}getPixels(){return new Ir({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=t*this.dim,h=t*this.dim+this.dim,f=o*this.dim,m=o*this.dim+this.dim;switch(t){case-1:l=h-1;break;case 1:h=l+1}switch(o){case-1:f=m-1;break;case 1:m=f+1}const v=-t*this.dim,b=-o*this.dim;for(let S=f;S<m;S++)for(let M=l;M<h;M++){const I=4*this._idx(M,S),P=4*this._idx(M+v,S+b);this.pixels[I+0]=e.pixels[P+0],this.pixels[I+1]=e.pixels[P+1],this.pixels[I+2]=e.pixels[P+2],this.pixels[I+3]=e.pixels[P+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Rt(Sf,"DEMData"),Rt(Yv,"DemMinMaxQuadTree",{omit:["dem"]});class N2{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,o){const l=e.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const h={value:t,timeout:void 0};if(o!==void 0&&(h.timeout=setTimeout(()=>{this.remove(e,h)},o)),this.data[l].push(h),this.order.push(l),this.order.length>this.max){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const o=e.wrapped().key,l=t===void 0?0:this.data[o].indexOf(t),h=this.data[o][l];return this.data[o].splice(l,1),h.timeout&&clearTimeout(h.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(h.value),this.order.splice(this.order.indexOf(o),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(e){const t=[];for(const o in this.data)for(const l of this.data[o])e(l.value)||t.push(l);for(const o of t)this.remove(o.value.tileID,o)}}class fc{constructor(e,t,o){this.func=e,this.mask=t,this.range=o}}fc.ReadOnly=!1,fc.ReadWrite=!0,fc.disabled=new fc(519,fc.ReadOnly,[0,1]);const Wm=7680;class Hm{constructor(e,t,o,l,h,f){this.test=e,this.ref=t,this.mask=o,this.fail=l,this.depthFail=h,this.pass=f}}Hm.disabled=new Hm({func:519,mask:0},0,0,Wm,Wm,Wm);class qo{constructor(e,t,o){this.blendFunction=e,this.blendColor=t,this.mask=o}}qo.Replace=[1,0],qo.disabled=new qo(qo.Replace,ji.transparent,[!1,!1,!1,!1]),qo.unblended=new qo(qo.Replace,ji.transparent,[!0,!0,!0,!0]),qo.alphaBlended=new qo([1,771],ji.transparent,[!0,!0,!0,!0]);const Xm=1029,Km=2305;class mo{constructor(e,t,o){this.enable=e,this.mode=t,this.frontFace=o}}mo.disabled=new mo(!1,Xm,Km),mo.backCCW=new mo(!0,Xm,Km),mo.backCW=new mo(!0,Xm,2304),mo.frontCW=new mo(!0,1028,2304),mo.frontCCW=new mo(!0,1028,Km);class Qa extends Ze{constructor(e,t,o){super(),this.id=e,this._onlySymbols=o,t.on("data",l=>{l.dataType==="source"&&l.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&l.dataType==="source"&&l.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),t.on("error",()=>{this._sourceErrored=!0}),this._source=t,this._tiles={},this._cache=new N2(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new U2,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const t=this._tiles[e];if(t.state!=="loaded"&&t.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const t in this._tiles){const o=this._tiles[t];this._source.prepareTile(o)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,o.tileID),o.upload(e),o.prepare(this.map.style.imageManager)}else for(const t in this._tiles){const o=this._tiles[t];o.upload(e),o.prepare(this.map.style.imageManager)}}getIds(){return Ke(this._tiles).map(e=>e.tileID).sort(ex).map(e=>e.key)}getRenderableIds(e){const t=[];for(const o in this._tiles)this._isIdRenderable(+o,e)&&t.push(this._tiles[o]);return e?t.sort((o,l)=>{const h=o.tileID,f=l.tileID,m=new N(h.canonical.x,h.canonical.y)._rotate(this.transform.angle),v=new N(f.canonical.x,f.canonical.y)._rotate(this.transform.angle);return h.overscaledZ-f.overscaledZ||v.y-m.y||v.x-m.x}).map(o=>o.tileID.key):t.map(o=>o.tileID).sort(ex).map(o=>o.key)}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const o=this._tiles[e];o&&(o.state!=="loading"&&(o.state=t),this._loadTile(o,this._tileLoaded.bind(this,o,e,t)))}_tileLoaded(e,t,o,l){if(l)if(e.state="errored",l.status!==404)this._source.fire(new vt(l,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const h=this.map.painter.terrain;this.update(this.transform,h.getScaledDemTileSize(),!0),h.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Mt.now(),o==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new he("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let l=0;l<t.length;l++){const h=t[l];if(e.neighboringTiles&&e.neighboringTiles[h]){const f=this.getTileByID(h);o(e,f),o(f,e)}}function o(l,h){if(!l.dem||l.dem.borderReady)return;l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0;let f=h.tileID.canonical.x-l.tileID.canonical.x;const m=h.tileID.canonical.y-l.tileID.canonical.y,v=Math.pow(2,l.tileID.canonical.z),b=h.tileID.key;f===0&&m===0||Math.abs(m)>1||(Math.abs(f)>1&&(Math.abs(f+v)===1?f+=v:Math.abs(f-v)===1&&(f-=v)),h.dem&&l.dem&&(l.dem.backfillBorder(h.dem,f,m),l.neighboringTiles&&l.neighboringTiles[b]&&(l.neighboringTiles[b].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,o,l){for(const h in this._tiles){let f=this._tiles[h];if(l[h]||!f.hasData()||f.tileID.overscaledZ<=t||f.tileID.overscaledZ>o)continue;let m=f.tileID;for(;f&&f.tileID.overscaledZ>t+1;){const b=f.tileID.scaledTo(f.tileID.overscaledZ-1);f=this._tiles[b.key],f&&f.hasData()&&(m=b)}let v=m;for(;v.overscaledZ>t;)if(v=v.scaledTo(v.overscaledZ-1),e[v.key]){l[m.key]=m;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const o=this._loadedParentTiles[e.key];return o&&o.tileID.overscaledZ>=t?o:null}for(let o=e.overscaledZ-1;o>=t;o--){const l=e.scaledTo(o),h=this._getLoadedTile(l);if(h)return h}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const o=Math.ceil(e.width/t)+1,l=Math.ceil(e.height/t)+1,h=Math.floor(o*l*5),f=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,h):h,m=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,f):f;this._cache.setMaxSize(m)}handleWrapJump(e){const t=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,t){const o={};for(const l in this._tiles){const h=this._tiles[l];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+t),o[h.tileID.key]=h}this._tiles=o;for(const l in this._timers)clearTimeout(this._timers[l]),delete this._timers[l];for(const l in this._tiles)this._setTileReloadTimer(+l,this._tiles[l])}}update(e,t,o){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!o)return;let l;this.updateCacheSize(e,t),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(m=>new hr(m.canonical.z,m.wrap,m.canonical.z,m.canonical.x,m.canonical.y)):(l=e.coveringTiles({tileSize:t||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!o,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(l=l.filter(m=>this._source.hasTile(m)))):l=[];const h=this._updateRetainedTiles(l);if(tx(this._source.type)&&l.length!==0){const m={},v={},b=Object.keys(h);for(const M of b){const I=h[M],P=this._tiles[M];if(!P||P.fadeEndTime&&P.fadeEndTime<=Mt.now())continue;const L=this.findLoadedParent(I,Math.max(I.overscaledZ-Qa.maxOverzooming,this._source.minzoom));L&&(this._addTile(L.tileID),m[L.tileID.key]=L.tileID),v[M]=I}const S=l[l.length-1].overscaledZ;for(const M in this._tiles){const I=this._tiles[M];if(h[M]||!I.hasData())continue;let P=I.tileID;for(;P.overscaledZ>S;){P=P.scaledTo(P.overscaledZ-1);const L=this._tiles[P.key];if(L&&L.hasData()&&v[P.key]){h[M]=I.tileID;break}}}for(const M in m)h[M]||(this._coveredTiles[M]=!0,h[M]=m[M])}for(const m in h)this._tiles[m].clearFadeHold();const f=function(m,v){const b=[];for(const S in m)S in v||b.push(S);return b}(this._tiles,h);for(const m of f){const v=this._tiles[m];v.hasSymbolBuckets&&!v.holdingForFade()?v.setHoldDuration(this.map._fadeDuration):v.hasSymbolBuckets&&!v.symbolFadeFinished()||this._removeTile(+m)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(e.length===0)return t;const o={},l=e.reduce((b,S)=>Math.min(b,S.overscaledZ),1/0),h=e[0].overscaledZ,f=Math.max(h-Qa.maxOverzooming,this._source.minzoom),m=Math.max(h+Qa.maxUnderzooming,this._source.minzoom),v={};for(const b of e){const S=this._addTile(b);t[b.key]=b,S.hasData()||l<this._source.maxzoom&&(v[b.key]=b)}this._retainLoadedChildren(v,l,m,t);for(const b of e){let S=this._tiles[b.key];if(S.hasData())continue;if(b.canonical.z>=this._source.maxzoom){const I=b.children(this._source.maxzoom)[0],P=this.getTile(I);if(P&&P.hasData()){t[I.key]=I;continue}}else{const I=b.children(this._source.maxzoom);if(t[I[0].key]&&t[I[1].key]&&t[I[2].key]&&t[I[3].key])continue}let M=S.wasRequested();for(let I=b.overscaledZ-1;I>=f;--I){const P=b.scaledTo(I);if(o[P.key]||(o[P.key]=!0,S=this.getTile(P),!S&&M&&(S=this._addTile(P)),S&&(t[P.key]=P,M=S.wasRequested(),S.hasData())))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let o,l=this._tiles[e].tileID;for(;l.overscaledZ>0;){if(l.key in this._loadedParentTiles){o=this._loadedParentTiles[l.key];break}t.push(l.key);const h=l.scaledTo(l.overscaledZ-1);if(o=this._getLoadedTile(h),o)break;l=h}for(const h of t)this._loadedParentTiles[h]=o}}_addTile(e){let t=this._tiles[e.key];if(t)return this._source.prepareTile&&this._source.prepareTile(t),t;t=this._cache.getAndRemove(e),t&&(this._setTileReloadTimer(e.key,t),t.tileID=e,this._state.initializeTileState(t,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t)));const o=Boolean(t);if(!o){const l=this.map?this.map.painter:null;t=new Zm(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,l,this._isRaster),this._source.prepareTile&&this._source.prepareTile(t)||this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))}return t?(t.uses++,this._tiles[e.key]=t,o||this._source.fire(new he("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const o=t.getExpiryTimeout();o&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},o))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&t.state!=="reloading"?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,t,o){const l=[],h=this.transform;if(!h)return l;const f=h.projection.name==="globe",m=Ro(h.center.lng);for(const v in this._tiles){const b=this._tiles[v];if(o&&b.clearQueryDebugViz(),b.holdingForFade())continue;let S;if(f){const M=b.tileID.canonical;if(M.z===0){const I=[Math.abs(Se(m,...ph(M,-1))-m),Math.abs(Se(m,...ph(M,1))-m)];S=[0,2*I.indexOf(Math.min(...I))-1]}else{const I=[Math.abs(Se(m,...ph(M,-1))-m),Math.abs(Se(m,...ph(M,0))-m),Math.abs(Se(m,...ph(M,1))-m)];S=[I.indexOf(Math.min(...I))-1]}}else S=[0];for(const M of S){const I=e.containsTile(b,h,t,M);I&&l.push(I)}}return l}getVisibleCoordinates(e){const t=this.getRenderableIds(e).map(o=>this._tiles[o].tileID);for(const o of t)o.projMatrix=this.transform.calculateProjMatrix(o.toUnwrapped());return t}hasTransition(){if(this._source.hasTransition())return!0;if(tx(this._source.type))for(const e in this._tiles){const t=this._tiles[e];if(t.fadeEndTime!==void 0&&t.fadeEndTime>=Mt.now())return!0}return!1}setFeatureState(e,t,o){this._state.updateState(e=e||"_geojsonTileLayer",t,o)}removeFeatureState(e,t,o){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,o)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,o){const l=this._tiles[e];l&&l.setDependencies(t,o)}reloadTilesForDependencies(e,t){for(const o in this._tiles)this._tiles[o].hasDependency(e,t)&&this._reloadTile(+o,"reloading");this._cache.filter(o=>!o.hasDependency(e,t))}_preloadTiles(e,t){const o=new Map,l=Array.isArray(e)?e:[e],h=this.map.painter.terrain,f=this.usedForTerrain&&h?h.getScaledDemTileSize():this._source.tileSize;for(const m of l){const v=m.coveringTiles({tileSize:f,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const b of v)o.set(b.key,b);this.usedForTerrain&&m.updateElevation(!1)}De(Array.from(o.values()),(m,v)=>{const b=new Zm(m,this._source.tileSize*m.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(b,S=>{this._source.type==="raster-dem"&&b.dem&&this._backfillDEM(b),v(S,b)})},t)}}function ex(i,e){const t=Math.abs(2*i.wrap)-+(i.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||o-t||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x}function tx(i){return i==="raster"||i==="image"||i==="video"}function ph(i,e){const t=1<<i.z;return[i.x/t+e,(i.x+1)/t+e]}Qa.maxOverzooming=10,Qa.maxUnderzooming=3;class Cf{constructor(e,t,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=o}static create(e,t,o){const l=o||e.findDEMTileFor(t);if(!l||!l.dem)return;const h=l.dem,f=l.tileID,m=1<<t.canonical.z-f.canonical.z;return new Cf(l,l.tileSize/ei/m,[(t.canonical.x/m-f.canonical.x)*h.dim,(t.canonical.y/m-f.canonical.y)*h.dim])}tileCoordToPixel(e,t){const o=t*this._scale+this._offset[1],l=Math.floor(e*this._scale+this._offset[0]),h=Math.floor(o);return new N(l,h)}getElevationAt(e,t,o,l){const h=e*this._scale+this._offset[0],f=t*this._scale+this._offset[1],m=Math.floor(h),v=Math.floor(f),b=this._dem;return l=!!l,o?Mi(Mi(b.get(m,v,l),b.get(m,v+1,l),f-v),Mi(b.get(m+1,v,l),b.get(m+1,v+1,l),f-v),h-m):b.get(m,v,l)}getElevationAtPixel(e,t,o){return this._dem.get(e,t,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Gr(1,e)*this._dem.stride}}class ix{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Us(ei,16,0),this.featureIndexArray=new Gg,this.promoteId=t}insert(e,t,o,l,h,f=0){const m=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,l,h,f);const v=this.grid;for(let b=0;b<t.length;b++){const S=t[b],M=[1/0,1/0,-1/0,-1/0];for(let I=0;I<S.length;I++){const P=S[I];M[0]=Math.min(M[0],P.x),M[1]=Math.min(M[1],P.y),M[2]=Math.max(M[2],P.x),M[3]=Math.max(M[3],P.y)}M[0]<ei&&M[1]<ei&&M[2]>=0&&M[3]>=0&&v.insert(m,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ya.VectorTile(new ih(this.rawTileData)).layers,this.sourceLayerCoder=new Nv(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t,o,l){this.loadVTLayers();const h=e.params||{},f=Ra(h.filter),m=e.tileResult,v=e.transform,b=m.bufferedTilespaceBounds,S=this.grid.query(b.min.x,b.min.y,b.max.x,b.max.y,(L,U,$,ee)=>uy(m.bufferedTilespaceGeometry,L,U,$,ee));S.sort(j2);let M=null;v.elevation&&S.length>0&&(M=Cf.create(v.elevation,this.tileID));const I={};let P;for(let L=0;L<S.length;L++){const U=S[L];if(U===P)continue;P=U;const $=this.featureIndexArray.get(U);let ee=null;this.loadMatchingFeature(I,$,f,h.layers,h.availableImages,t,o,l,(se,ie,re,_e=0)=>(ee||(ee=us(se,this.tileID.canonical,e.tileTransform)),ie.queryIntersectsFeature(m,se,re,ee,this.z,e.transform,e.pixelPosMatrix,M,_e)))}return I}loadMatchingFeature(e,t,o,l,h,f,m,v,b){const{featureIndex:S,bucketIndex:M,sourceLayerIndex:I,layoutVertexArrayOffset:P}=t,L=this.bucketLayerIDs[M];if(l&&!function(se,ie){for(let re=0;re<se.length;re++)if(ie.indexOf(se[re])>=0)return!0;return!1}(l,L))return;const U=this.sourceLayerCoder.decode(I),$=this.vtLayers[U].feature(S);if(o.needGeometry){const se=Za($,!0);if(!o.filter(new H(this.tileID.overscaledZ),se,this.tileID.canonical))return}else if(!o.filter(new H(this.tileID.overscaledZ),$))return;const ee=this.getId($,U);for(let se=0;se<L.length;se++){const ie=L[se];if(l&&l.indexOf(ie)<0)continue;const re=f[ie];if(!re)continue;let _e={};ee!==void 0&&v&&(_e=v.getState(re.sourceLayer||"_geojsonTileLayer",ee));const ce=Ue({},m[ie]);ce.paint=nx(ce.paint,re.paint,$,_e,h),ce.layout=nx(ce.layout,re.layout,$,_e,h);const Ve=!b||b($,re,_e,P);if(!Ve)continue;const Oe=new jv($,this.z,this.x,this.y,ee);Oe.layer=ce;let We=e[ie];We===void 0&&(We=e[ie]=[]),We.push({featureIndex:S,feature:Oe,intersectionZ:Ve})}}lookupSymbolFeatures(e,t,o,l,h,f,m,v){const b={};this.loadVTLayers();const S=Ra(h);for(const M of e)this.loadMatchingFeature(b,{bucketIndex:o,sourceLayerIndex:l,featureIndex:M,layoutVertexArrayOffset:0},S,f,m,v,t);return b}loadFeature(e){const{featureIndex:t,sourceLayerIndex:o}=e;this.loadVTLayers();const l=this.sourceLayerCoder.decode(o),h=this.vtFeatures[l];if(h[t])return h[t];const f=this.vtLayers[l].feature(t);return h[t]=f,f}hasLayer(e){for(const t of this.bucketLayerIDs)for(const o of t)if(e===o)return!0;return!1}getId(e,t){let o=e.id;return this.promoteId&&(o=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[t]],typeof o=="boolean"&&(o=Number(o))),o}}function nx(i,e,t,o,l){return At(i,(h,f)=>{const m=e instanceof pe?e.get(f):null;return m&&m.evaluate?m.evaluate(t,o,l):m})}function j2(i,e){return e-i}Rt(ix,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class rx{constructor(e){const t={},o=[];for(const m in e){const v=e[m],b=t[m]={};for(const S in v.glyphs){const M=v.glyphs[+S];if(!M||M.bitmap.width===0||M.bitmap.height===0)continue;const I=M.metrics.localGlyph?2:1,P={x:0,y:0,w:M.bitmap.width+2*I,h:M.bitmap.height+2*I};o.push(P),b[S]=P}}const{w:l,h}=Mm(o),f=new hs({width:l||1,height:h||1});for(const m in e){const v=e[m];for(const b in v.glyphs){const S=v.glyphs[+b];if(!S||S.bitmap.width===0||S.bitmap.height===0)continue;const M=t[m][b],I=S.metrics.localGlyph?2:1;hs.copy(S.bitmap,f,{x:0,y:0},{x:M.x+I,y:M.y+I},S.bitmap)}}this.image=f,this.positions=t}}Rt(rx,"GlyphAtlas");class q2{constructor(e){this.tileID=new hr(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Ja(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,t,o,l,h){this.status="parsing",this.data=e,this.collisionBoxArray=new Bo;const f=new Nv(Object.keys(e.layers).sort()),m=new ix(this.tileID,this.promoteId);m.bucketLayerIDs=[];const v={},b=new Gm(256,256),S={featureIndex:m,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:b,availableImages:o},M=t.familiesBySource[this.source];for(const _e in M){const ce=e.layers[_e];if(!ce)continue;let Ve=!1,Oe=!1;for(const je of M[_e])je[0].type==="symbol"?Ve=!0:Oe=!0;if(this.isSymbolTile===!0&&!Ve||this.isSymbolTile===!1&&!Oe)continue;ce.version===1&&xt(`Vector tile source "${this.source}" layer "${_e}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const We=f.encode(_e),yt=[];for(let je=0;je<ce.length;je++){const et=ce.feature(je),at=m.getId(et,_e);yt.push({feature:et,id:at,index:je,sourceLayerIndex:We})}for(const je of M[_e]){const et=je[0];this.isSymbolTile!==void 0&&et.type==="symbol"!==this.isSymbolTile||et.minzoom&&this.zoom<Math.floor(et.minzoom)||et.maxzoom&&this.zoom>=et.maxzoom||et.visibility!=="none"&&(Ym(je,this.zoom,o),(v[et.id]=et.createBucket({index:m.bucketLayerIDs.length,layers:je,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:We,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:o})).populate(yt,S,this.tileID.canonical,this.tileTransform),m.bucketLayerIDs.push(je.map(at=>at.id)))}}let I,P,L,U;b.trim();const $={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ee=At(S.glyphDependencies,_e=>Object.keys(_e).map(Number));Object.keys(ee).length?l.send("getGlyphs",{uid:this.uid,stacks:ee},(_e,ce)=>{I||(I=_e,P=ce,re.call(this))},void 0,!1,$):P={};const se=Object.keys(S.iconDependencies);se.length?l.send("getImages",{icons:se,source:this.source,tileID:this.tileID,type:"icons"},(_e,ce)=>{I||(I=_e,L=ce,re.call(this))},void 0,!1,$):L={};const ie=Object.keys(S.patternDependencies);function re(){if(I)return h(I);if(P&&L&&U){const _e=new rx(P),ce=new ov(L,U);for(const Ve in v){const Oe=v[Ve];Oe instanceof Hs?(Ym(Oe.layers,this.zoom,o),h2(Oe,P,_e.positions,L,ce.iconPositions,this.showCollisionBoxes,o,this.tileID.canonical,this.tileZoom,this.projection)):Oe.hasPattern&&(Oe instanceof af||Oe instanceof nf||Oe instanceof Ju)&&(Ym(Oe.layers,this.zoom,o),Oe.addFeatures(S,this.tileID.canonical,ce.patternPositions,o,this.tileTransform))}this.status="done",h(null,{buckets:Ke(v).filter(Ve=>!Ve.isEmpty()),featureIndex:m,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:_e.image,lineAtlas:b,imageAtlas:ce,glyphMap:this.returnDependencies?P:null,iconMap:this.returnDependencies?L:null,glyphPositions:this.returnDependencies?_e.positions:null})}}ie.length?l.send("getImages",{icons:ie,source:this.source,tileID:this.tileID,type:"patterns"},(_e,ce)=>{I||(I=_e,U=ce,re.call(this))},void 0,!1,$):U={},re.call(this)}}function Ym(i,e,t){const o=new H(e);for(const l of i)l.recalculate(o,t)}class ox{constructor(e){this.entries={},this.scheduler=e}request(e,t,o,l){const h=this.entries[e]=this.entries[e]||{callbacks:[]};if(h.result){const[f,m]=h.result;return this.scheduler?this.scheduler.add(()=>{l(f,m)},t):l(f,m),()=>{}}return h.callbacks.push(l),h.cancel||(h.cancel=o((f,m)=>{h.result=[f,m];for(const v of h.callbacks)this.scheduler?this.scheduler.add(()=>{v(f,m)},t):v(f,m);setTimeout(()=>delete this.entries[e],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(f=>f!==l),h.callbacks.length||(h.cancel(),delete this.entries[e]))}}}function sx(i,e,t){const o=JSON.stringify(i.request);return i.data&&(this.deduped.entries[o]={result:[null,i.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},l=>{const h=ze(i.request,(f,m,v,b)=>{f?l(f):m&&l(null,{vectorTile:t?void 0:new Ya.VectorTile(new ih(m)),rawData:m,cacheControl:v,expires:b})});return()=>{h.cancel(),l()}},e)}s.ARRAY_TYPE=Mr,s.AUTH_ERR_MSG=si,s.Aabb=xr,s.Actor=class{constructor(i,e,t){this.target=i,this.parent=e,this.mapId=t,this.callbacks={},this.cancelCallbacks={},Ht(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ci()?i:D,this.scheduler=new F2}send(i,e,t,o,l=!1,h){const f=Math.round(1e18*Math.random()).toString(36).substring(0,10);t&&(t.metadata=h,this.callbacks[f]=t);const m=Jt(this.globalScope)?void 0:[];return this.target.postMessage({id:f,type:i,hasCallback:!!t,targetMapId:o,mustQueue:l,sourceMapId:this.mapId,data:Ns(e,m)},m),{cancel:()=>{t&&delete this.callbacks[f],this.target.postMessage({id:f,type:"<cancel>",targetMapId:o,sourceMapId:this.mapId})}}}receive(i){const e=i.data,t=e.id;if(t&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const o=this.cancelCallbacks[t];delete this.cancelCallbacks[t],o&&o.cancel()}else if(e.mustQueue||Ci()){const o=this.callbacks[t];this.cancelCallbacks[t]=this.scheduler.add(()=>this.processTask(t,e),o&&o.metadata||{type:"message"})}else this.processTask(t,e)}processTask(i,e){if(e.type==="<response>"){const t=this.callbacks[i];delete this.callbacks[i],t&&(e.error?t(Va(e.error)):t(null,Va(e.data)))}else{const t=Jt(this.globalScope)?void 0:[],o=e.hasCallback?(h,f)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:h?Ns(h):null,data:Ns(f,t)},t)}:h=>{},l=Va(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,l,o);else if(this.parent.getWorkerSource){const h=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,h[0],l.source)[h[1]](l,o)}else o(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.CanonicalTileID=of,s.Color=ji,s.ColorMode=qo,s.CullFaceMode=mo,s.DEMData=Sf,s.DataConstantProperty=ue,s.DedupedRequest=ox,s.DepthMode=fc,s.EXTENT=ei,s.Elevation=class{isDataAvailableAtPoint(i){const e=this._source();if(!e||i.y<0||i.y>1)return!1;const t=e.getSource().maxzoom,o=1<<t,l=Math.floor(i.x),h=Math.floor((i.x-l)*o),f=Math.floor(i.y*o),m=this.findDEMTileFor(new hr(t,l,t,h,f));return!(!m||!m.dem)}getAtPointOrZero(i,e=0){return this.getAtPoint(i,e)||0}getAtPoint(i,e,t=!0){e==null&&(e=null);const o=this._source();if(!o||i.y<0||i.y>1)return e;const l=o.getSource().maxzoom,h=1<<l,f=Math.floor(i.x),m=i.x-f,v=new hr(l,f,l,Math.floor(m*h),Math.floor(i.y*h)),b=this.findDEMTileFor(v);if(!b||!b.dem)return e;const S=b.dem,M=1<<b.tileID.canonical.z,I=(m*M-b.tileID.canonical.x)*S.dim,P=(i.y*M-b.tileID.canonical.y)*S.dim,L=Math.floor(I),U=Math.floor(P);return(t?this.exaggeration():1)*Mi(Mi(S.get(L,U),S.get(L,U+1),P-U),Mi(S.get(L+1,U),S.get(L+1,U+1),P-U),I-L)}getAtTileOffset(i,e,t){const o=1<<i.canonical.z;return this.getAtPointOrZero(new Jl(i.wrap+(i.canonical.x+e/ei)/o,(i.canonical.y+t/ei)/o))}getAtTileOffsetFunc(i,e,t,o){return l=>{const h=this.getAtTileOffset(i,l.x,l.y),f=o.upVector(i.canonical,l.x,l.y);return uo(f,f,h*o.upVectorScale(i.canonical,e,t).metersToTile),f}}getForTilePoints(i,e,t,o){const l=Cf.create(this,i,o);return!!l&&(e.forEach(h=>{h[2]=this.exaggeration()*l.getElevationAt(h[0],h[1],t)}),!0)}getMinMaxForTile(i){const e=this.findDEMTileFor(i);if(!e||!e.dem)return null;const t=e.dem.tree,o=e.tileID,l=1<<i.canonical.z-o.canonical.z;let h=i.canonical.x/l-o.canonical.x,f=i.canonical.y/l-o.canonical.y,m=0;for(let v=0;v<i.canonical.z-o.canonical.z&&!t.leaves[m];v++){h*=2,f*=2;const b=2*Math.floor(f)+Math.floor(h);m=t.childOffsets[m]+b,h%=1,f%=1}return{min:this.exaggeration()*t.minimums[m],max:this.exaggeration()*t.maximums[m]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,e,t){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},s.ErrorEvent=vt,s.EvaluationParameters=H,s.Event=he,s.Evented=Ze,s.FillExtrusionBucket=Ju,s.Frustum=gm,s.FrustumCorners=_m,s.GLOBE_METERS_TO_ECEF=Om,s.GLOBE_RADIUS=ps,s.GLOBE_SCALE_MATCH_LATITUDE=45,s.GLOBE_ZOOM_THRESHOLD_MAX=6,s.GLOBE_ZOOM_THRESHOLD_MIN=5,s.GlobeSharedBuffers=class{constructor(i){this._createGrid(i),this._createPoles(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const i of this._poleSegments)i.destroy();for(const i of this._gridSegments)i.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const i of this._wireframeSegments)i.destroy()}}_createGrid(i){const e=new St,t=new _i,o=65;for(let l=0;l<o;l++)for(let h=0;h<o;h++)e.emplaceBack(h,l);this._gridSegments=[];for(let l=0,h=0;l<uc.length;l++){const f=uc[l];for(let v=0;v<f;v++)for(let b=0;b<64;b++){const S=v*o+b;t.emplaceBack(S+1,S,S+o),t.emplaceBack(S+o,S+o+1,S+1)}const m=64*f*2;this._gridSegments.push(In.simpleSegment(0,h,(f+1)*o,m)),h+=m}this._gridBuffer=i.createVertexBuffer(e,oh.members),this._gridIndexBuffer=i.createIndexBuffer(t,!0)}_createPoles(i){const e=new _i;for(let l=0;l<=64;l++)e.emplaceBack(0,l+1,l+2);this._poleIndexBuffer=i.createIndexBuffer(e,!0);const t=new Wn,o=new Wn;this._poleSegments=[];for(let l=0,h=0;l<5;l++){const f=360/(1<<l);t.emplaceBack(0,-ps,0,.5,0),o.emplaceBack(0,-ps,0,.5,1);for(let m=0;m<=64;m++){const v=m/64,b=Mi(0,f,v),[S,M,I]=hc(y2,v2,b,ps);t.emplaceBack(S,M,I,v,0),o.emplaceBack(S,M,I,v,1)}this._poleSegments.push(In.simpleSegment(h,0,66,64)),h+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(t,Sv,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(o,Sv,!1)}getGridBuffers(i){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[i]]}getPoleBuffers(i){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}getWirefameBuffers(i,e){if(!this._wireframeSegments){const t=new er,o=64,l=o+1;this._wireframeSegments=[];for(let h=0,f=0;h<uc.length;h++){const m=uc[h];for(let b=0;b<m;b++)for(let S=0;S<o;S++){const M=b*l+S;t.emplaceBack(M,M+1),t.emplaceBack(M,M+l),t.emplaceBack(M,M+l+1)}const v=m*o*3;this._wireframeSegments.push(In.simpleSegment(0,f,(m+1)*l,v)),f+=v}this._wireframeIndexBuffer=i.createIndexBuffer(t)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},s.GlyphManager=lc,s.ImagePosition=Im,s.LineAtlas=Gm,s.LngLat=Ui,s.LngLatBounds=$s,s.LocalGlyphMode=Dm,s.MAX_MERCATOR_LATITUDE=Oo,s.MercatorCoordinate=Jl,s.ONE_EM=Xn,s.OverscaledTileID=hr,s.Properties=Je,s.RGBAImage=Ir,s.Ray=mm,s.RequestManager=class{constructor(i,e,t){this._transformRequestFn=i,this._customAccessToken=e,this._silenceAuthErrors=!!t,this._createSkuToken()}_createSkuToken(){const i=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Di,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,e){return this._transformRequestFn&&this._transformRequestFn(i,e)||{url:i}}normalizeStyleURL(i,e){if(!Ai(i))return i;const t=Cn(i);return t.path=`/styles/v1${t.path}`,this._makeAPIURL(t,this._customAccessToken||e)}normalizeGlyphsURL(i,e){if(!Ai(i))return i;const t=Cn(i);return t.path=`/fonts/v1${t.path}`,this._makeAPIURL(t,this._customAccessToken||e)}normalizeSourceURL(i,e,t,o){if(!Ai(i))return i;const l=Cn(i);return l.path=`/v4/${l.authority}.json`,l.params.push("secure"),t&&l.params.push(`language=${t}`),o&&l.params.push(`worldview=${o}`),this._makeAPIURL(l,this._customAccessToken||e)}normalizeSpriteURL(i,e,t,o){const l=Cn(i);return Ai(i)?(l.path=`/styles/v1${l.path}/sprite${e}${t}`,this._makeAPIURL(l,this._customAccessToken||o)):(l.path+=`${e}${t}`,zn(l))}normalizeTileURL(i,e,t){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!Ai(i))return i;const o=Cn(i);o.path=o.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||t&&o.authority!=="raster"&&t===512?"@2x":""}${ht.supported?".webp":"$1"}`),o.authority==="raster"?o.path=`/${Xe.RASTER_URL_PREFIX}${o.path}`:(o.path=o.path.replace(/^.+\/v4\//,"/"),o.path=`/${Xe.TILE_URL_VERSION}${o.path}`);const l=this._customAccessToken||function(h){for(const f of h){const m=f.match(/^access_token=(.*)$/);if(m)return m[1]}return null}(o.params)||Xe.ACCESS_TOKEN;return Xe.REQUIRE_ACCESS_TOKEN&&l&&this._skuToken&&o.params.push(`sku=${this._skuToken}`),this._makeAPIURL(o,l)}canonicalizeTileURL(i,e){const t=Cn(i);if(!t.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!t.path.match(/\.[\w]+$/))return i;let o="mapbox://";t.path.match(/^\/raster\/v1\//)?o+=`raster/${t.path.replace(`/${Xe.RASTER_URL_PREFIX}/`,"")}`:o+=`tiles/${t.path.replace(`/${Xe.TILE_URL_VERSION}/`,"")}`;let l=t.params;return e&&(l=l.filter(h=>!h.match(/^access_token=/))),l.length&&(o+=`?${l.join("&")}`),o}canonicalizeTileset(i,e){const t=!!e&&Ai(e),o=[];for(const l of i.tiles||[])hn(l)?o.push(this.canonicalizeTileURL(l,t)):o.push(l);return o}_makeAPIURL(i,e){const t="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",o=Cn(Xe.API_URL);if(i.protocol=o.protocol,i.authority=o.authority,i.protocol==="http"){const l=i.params.indexOf("secure");l>=0&&i.params.splice(l,1)}if(o.path!=="/"&&(i.path=`${o.path}${i.path}`),!Xe.REQUIRE_ACCESS_TOKEN)return zn(i);if(e=e||Xe.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${t}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${t}`)}return i.params=i.params.filter(l=>l.indexOf("access_token")===-1),i.params.push(`access_token=${e||""}`),zn(i)}},s.ResourceType=ge,s.SegmentVector=In,s.SourceCache=Qa,s.StencilMode=Hm,s.StructArrayLayout1ui2=ns,s.StructArrayLayout2f1f2i16=ao,s.StructArrayLayout2i4=St,s.StructArrayLayout2ui4=er,s.StructArrayLayout3f12=rn,s.StructArrayLayout3ui6=_i,s.StructArrayLayout4i8=Wt,s.StructArrayLayout5f20=Wn,s.Texture=fh,s.Tile=Zm,s.Transitionable=te,s.Uniform1f=qd,s.Uniform1i=class extends as{constructor(i){super(i),this.current=0}set(i,e,t){this.fetchUniformLocation(i,e)&&this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},s.Uniform2f=class extends as{constructor(i){super(i),this.current=[0,0]}set(i,e,t){this.fetchUniformLocation(i,e)&&(t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1])))}},s.Uniform3f=class extends as{constructor(i){super(i),this.current=[0,0,0]}set(i,e,t){this.fetchUniformLocation(i,e)&&(t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2])))}},s.Uniform4f=Jg,s.UniformColor=Qg,s.UniformMatrix2f=class extends as{constructor(i){super(i),this.current=Cw}set(i,e,t){if(this.fetchUniformLocation(i,e)){for(let o=0;o<4;o++)if(t[o]!==this.current[o]){this.current=t,this.gl.uniformMatrix2fv(this.location,!1,t);break}}}},s.UniformMatrix3f=class extends as{constructor(i){super(i),this.current=Sw}set(i,e,t){if(this.fetchUniformLocation(i,e)){for(let o=0;o<9;o++)if(t[o]!==this.current[o]){this.current=t,this.gl.uniformMatrix3fv(this.location,!1,t);break}}}},s.UniformMatrix4f=class extends as{constructor(i){super(i),this.current=Ew}set(i,e,t){if(this.fetchUniformLocation(i,e)){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let o=1;o<16;o++)if(t[o]!==this.current[o]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}}},s.UnwrappedTileID=Zy,s.ValidationError=Pt,s.VectorTileWorkerSource=class extends Ze{constructor(i,e,t,o,l){super(),this.actor=i,this.layerIndex=e,this.availableImages=t,this.loadVectorData=l||sx,this.loading={},this.loaded={},this.deduped=new ox(i.scheduler),this.isSpriteLoaded=o,this.scheduler=i.scheduler}loadTile(i,e){const t=i.uid,o=i&&i.request,l=o&&o.collectResourceTiming,h=this.loading[t]=new q2(i);h.abort=this.loadVectorData(i,(f,m)=>{const v=!this.loading[t];if(delete this.loading[t],v||f||!m)return h.status="done",v||(this.loaded[t]=h),e(f);const b=m.rawData,S={};m.expires&&(S.expires=m.expires),m.cacheControl&&(S.cacheControl=m.cacheControl),h.vectorTile=m.vectorTile||new Ya.VectorTile(new ih(b));const M=()=>{h.parse(h.vectorTile,this.layerIndex,this.availableImages,this.actor,(I,P)=>{if(I||!P)return e(I);const L={};if(l){const U=de(o);U.length>0&&(L.resourceTiming=JSON.parse(JSON.stringify(U)))}e(null,Ue({rawTileData:b.slice(0)},P,S,L))})};this.isSpriteLoaded?M():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(M,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):M()}),this.loaded=this.loaded||{},this.loaded[t]=h})}reloadTile(i,e){const t=this.loaded,o=i.uid,l=this;if(t&&t[o]){const h=t[o];h.showCollisionBoxes=i.showCollisionBoxes,h.enableTerrain=!!i.enableTerrain,h.projection=i.projection,h.tileTransform=Ja(i.tileID.canonical,i.projection);const f=(m,v)=>{const b=h.reloadCallback;b&&(delete h.reloadCallback,h.parse(h.vectorTile,l.layerIndex,this.availableImages,l.actor,b)),e(m,v)};h.status==="parsing"?h.reloadCallback=f:h.status==="done"&&(h.vectorTile?h.parse(h.vectorTile,this.layerIndex,this.availableImages,this.actor,f):f())}}abortTile(i,e){const t=i.uid,o=this.loading[t];o&&(o.abort&&o.abort(),delete this.loading[t]),e()}removeTile(i,e){const t=this.loaded,o=i.uid;t&&t[o]&&delete t[o],e()}},s.WritingMode=Ur,s.ZoomHistory=Md,s.add=Gs,s.addDynamicAttributes=wf,s.adjoint=function(i,e){var t=e[0],o=e[1],l=e[2],h=e[3],f=e[4],m=e[5],v=e[6],b=e[7],S=e[8];return i[0]=f*S-m*b,i[1]=l*b-o*S,i[2]=o*m-l*f,i[3]=m*v-h*S,i[4]=t*S-l*v,i[5]=l*h-t*m,i[6]=h*b-f*v,i[7]=o*v-t*b,i[8]=t*f-o*h,i},s.asyncAll=De,s.bezier=Le,s.bindAll=Ht,s.boundsAttributes=$v,s.bufferConvexPolygon=function(i,e){const t=[];for(let o=0;o<i.length;o++){const l=we(o-1,-1,i.length-1),h=we(o+1,-1,i.length-1),f=i[o],m=i[h],v=i[l].sub(f).unit(),b=m.sub(f).unit(),S=b.angleWithSep(v.x,v.y),M=v.add(b).unit().mult(-1*e/Math.sin(S/2));t.push(f.add(M))}return t},s.cacheEntryPossiblyAdded=function(i){ne++,ne>no&&(i.getActor().send("enforceCacheSizeLimit",io),ne=0)},s.calculateGlobeLabelMatrix=function(i,e){const{x:t,y:o}=i.point,l=zv(t,o,i.worldSize/i._pixelsPerMercatorPixel,0,0);return ec(l,l,Um(Uo(e)))},s.calculateGlobeMatrix=function(i){const{x:e,y:t}=i.point,{lng:o,lat:l}=i._center;return zv(e,t,i.worldSize,o,l)},s.calculateGlobeMercatorMatrix=function(i){const e=i.pixelsPerMeter,t=e/Gr(1,i.center.lat),o=Fo(new Float64Array(16));return qu(o,o,[i.point.x,i.point.y,0]),Ha(o,o,[t,t,e]),Float32Array.from(o)},s.circumferenceAtLatitude=tm,s.clamp=Se,s.clearTileCache=function(i){const e=Q(),t=[];for(const o in An)e&&t.push(e.delete(o)),delete An[o];i&&Promise.all(t).catch(i).then(()=>i())},s.clipLine=gv,s.clone=function(i){var e=new Mr(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},s.clone$1=Fe,s.collisionCircleLayout=OT,s.config=Xe,s.conjugate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i},s.create=function(){var i=new Mr(16);return Mr!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},s.create$1=fy,s.createExpression=Bs,s.createLayout=it,s.createStyleLayer=function(i){return i.type==="custom"?new L2(i):new R2[i.type](i)},s.cross=pm,s.degToRad=le,s.distance=function(i,e){return Math.hypot(e[0]-i[0],e[1]-i[1],e[2]-i[2])},s.div=function(i,e,t){return i[0]=e[0]/t[0],i[1]=e[1]/t[1],i[2]=e[2]/t[2],i},s.dot=Wr,s.ease=Ne,s.easeCubicInOut=Ee,s.emitValidationErrors=zu,s.endsWith=ot,s.enforceCacheSizeLimit=function(i){for(const e in An)B(e),An[e].then(t=>{t.keys().then(o=>{for(let l=0;l<o.length-i;l++)t.delete(o[l])})})},s.evaluateSizeForFeature=lf,s.evaluateSizeForZoom=rc,s.evaluateVariableOffset=wv,s.evented=R,s.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]},s.exactEquals$1=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]},s.exported=Mt,s.exported$1=ht,s.extend=Ue,s.extend$1=Ti,s.fillExtrusionHeightLift=qy,s.filterObject=di,s.fromMat4=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],i},s.fromQuat=function(i,e){var t=e[0],o=e[1],l=e[2],h=e[3],f=t+t,m=o+o,v=l+l,b=t*f,S=o*f,M=o*m,I=l*f,P=l*m,L=l*v,U=h*f,$=h*m,ee=h*v;return i[0]=1-M-L,i[1]=S+ee,i[2]=I-$,i[3]=0,i[4]=S-ee,i[5]=1-b-L,i[6]=P+U,i[7]=0,i[8]=I+$,i[9]=P-U,i[10]=1-b-M,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},s.fromRotation=function(i,e){var t=Math.sin(e),o=Math.cos(e);return i[0]=o,i[1]=t,i[2]=0,i[3]=-t,i[4]=o,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},s.fromScaling=py,s.furthestTileCorner=function(i){const e=Math.round((i+45+360)%360/90)%4;return He[e]},s.getAABBPointSquareDist=function(i,e,t){let o=0;for(let l=0;l<2;++l){const h=t?t[l]:0;i[l]>h&&(o+=(i[l]-h)*(i[l]-h)),e[l]<h&&(o+=(h-e[l])*(h-e[l]))}return o},s.getAnchorAlignment=Pm,s.getAnchorJustification=Bm,s.getBounds=function(i){let e=1/0,t=1/0,o=-1/0,l=-1/0;for(const h of i)e=Math.min(e,h.x),t=Math.min(t,h.y),o=Math.max(o,h.x),l=Math.max(l,h.y);return{min:new N(e,t),max:new N(o,l)}},s.getColumn=Ri,s.getGridMatrix=function(i,e,t){const o=e.getNorth(),l=e.getSouth(),h=e.getWest(),f=.015625;return[0,(e.getEast()-h)*f,1<<i.z,(l-o)/uc[t],0,i.y,o,h,f]},s.getImage=Qt,s.getJSON=function(i,e){return ye(Ue(i,{type:"json"}),e)},s.getLatitudinalLod=function(i){const e=80.051129;i=Se(i,-80.051129,e)/e*90;const t=Math.pow(Math.abs(Math.sin(le(i))),3);return Math.round(t*(uc.length-1))},s.getMapSessionAPI=pa,s.getPerformanceMeasurement=de,s.getProjection=Vv,s.getRTLTextPluginStatus=j,s.getReferrer=Ae,s.getTilePoint=function(i,{x:e,y:t},o=0){return new N(((e-o)*i.scale-i.x)*ei,(t*i.scale-i.y)*ei)},s.getTileVec3=function(i,e,t=0){return tc(((e.x-t)*i.scale-i.x)*ei,(e.y*i.scale-i.y)*ei,iy(e.z,e.y))},s.getVideo=function(i,e){const t=D.document.createElement("video");t.muted=!0,t.onloadstart=function(){e(null,t)};for(let o=0;o<i.length;o++){const l=D.document.createElement("source");st(i[o])||(t.crossOrigin="Anonymous"),l.src=i[o],t.appendChild(l)}return{cancel:()=>{}}},s.globeCenterToScreenPoint=function(i){const e=[0,0,0],t=Fo(new Float64Array(16));return ec(t,i.pixelMatrix,i.globeMatrix),Dn(e,e,t),new N(e[0],e[1])},s.globeDenormalizeECEF=Um,s.globeECEFOrigin=function(i,e){const t=[0,0,0];return Dn(t,t,ah(Uo(e.canonical))),Dn(t,t,i),t},s.globeNormalizeECEF=ah,s.globePixelsToTileUnits=function(i,e){return ei/(512*Math.pow(2,i))*gf(Uo(e))},s.globePoleMatrixForTile=function(i,e,t){const o=Fo(new Float64Array(16)),l=(e/(1<<i)-.5)*Math.PI*2;return Xd(o,t.globeMatrix,l),Float32Array.from(o)},s.globeTileBounds=Uo,s.globeTiltAtLngLat=Pv,s.globeToMercatorTransition=lh,s.globeUseCustomAntiAliasing=function(i,e,t){const o=lh(t.zoom),l=i.style.map._antialias,h=!!e.extStandardDerivatives,f=e.extStandardDerivativesForceOff||i.terrain&&i.terrain.exaggeration()>0;return o===0&&!l&&!f&&h},s.identity=Fo,s.identity$1=by,s.invert=lm,s.isFullscreen=function(){return!!D.document.fullscreenElement||!!D.document.webkitFullscreenElement},s.isLngLatBehindGlobe=function(i,e){return Pv(i,e)>Math.PI/2*1.01},s.isMapAuthenticated=function(i){return Dr.has(i)},s.isMapboxURL=Ai,s.isSafariWithAntialiasingBug=function(i){const e=i.navigator?i.navigator.userAgent:null;return!!Jt(i)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.latFromMercatorY=Hn,s.len=qw,s.length=$u,s.length$1=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},s.loadVectorTile=sx,s.makeRequest=ye,s.mapValue=function(i,e,t,o,l){return Se((i-e)/(t-e)*(l-o)+o,o,l)},s.mercatorScale=ny,s.mercatorXfromLng=Ro,s.mercatorYfromLat=cs,s.mercatorZfromAltitude=Gr,s.mul=Nw,s.mul$1=jw,s.multiply=ec,s.multiply$1=function(i,e,t){var o=e[0],l=e[1],h=e[2],f=e[3],m=e[4],v=e[5],b=e[6],S=e[7],M=e[8],I=t[0],P=t[1],L=t[2],U=t[3],$=t[4],ee=t[5],se=t[6],ie=t[7],re=t[8];return i[0]=I*o+P*f+L*b,i[1]=I*l+P*m+L*S,i[2]=I*h+P*v+L*M,i[3]=U*o+$*f+ee*b,i[4]=U*l+$*m+ee*S,i[5]=U*h+$*v+ee*M,i[6]=se*o+ie*f+re*b,i[7]=se*l+ie*m+re*S,i[8]=se*h+ie*v+re*M,i},s.multiply$2=gy,s.nextPowerOfTwo=Ye,s.normalize=ur,s.normalize$1=function(i,e){var t=e[0],o=e[1],l=e[2],h=e[3],f=t*t+o*o+l*l+h*h;return f>0&&(f=1/Math.sqrt(f)),i[0]=t*f,i[1]=o*f,i[2]=l*f,i[3]=h*f,i},s.number=Mi,s.ortho=function(i,e,t,o,l,h,f){var m=1/(e-t),v=1/(o-l),b=1/(h-f);return i[0]=-2*m,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*v,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*b,i[11]=0,i[12]=(e+t)*m,i[13]=(l+o)*v,i[14]=(f+h)*b,i[15]=1,i},s.pbf=ih,s.perspective=function(i,e,t,o,l){var h,f=1/Math.tan(e/2);return i[0]=f/t,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=f,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,l!=null&&l!==1/0?(i[10]=(l+o)*(h=1/(o-l)),i[14]=2*l*o*h):(i[10]=-1,i[14]=-2*o),i},s.pick=function(i,e){const t={};for(let o=0;o<e.length;o++){const l=e[o];l in i&&(t[l]=i[l])}return t},s.plugin=W,s.pointGeometry=N,s.polygonContainsPoint=Wa,s.polygonIntersectsBox=uy,s.polygonIntersectsPolygon=sy,s.polygonizeBounds=function(i,e,t=0,o=!0){const l=new N(t,t),h=i.sub(l),f=e.add(l),m=[h,new N(f.x,h.y),f,new N(h.x,f.y)];return o&&m.push(h.clone()),m},s.posAttributes=oh,s.postMapLoadEvent=Yo,s.postTurnstileEvent=Pr,s.potpack=Mm,s.prevPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},s.radToDeg=xe,s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.registerForPluginStateChange=function(i){return i({pluginStatus:E,pluginURL:C}),R.on("pluginStateChange",i),i},s.removeAuthState=function(i){Dr.delete(i)},s.renderColorRamp=vm,s.resample=ry,s.rotateX=cm,s.rotateX$1=wy,s.rotateY=Xd,s.rotateY$1=Ty,s.rotateZ=function(i,e,t){var o=Math.sin(t),l=Math.cos(t),h=e[0],f=e[1],m=e[2],v=e[3],b=e[4],S=e[5],M=e[6],I=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=h*l+b*o,i[1]=f*l+S*o,i[2]=m*l+M*o,i[3]=v*l+I*o,i[4]=b*l-h*o,i[5]=S*l-f*o,i[6]=M*l-m*o,i[7]=I*l-v*o,i},s.rotateZ$1=function(i,e,t){t*=.5;var o=e[0],l=e[1],h=e[2],f=e[3],m=Math.sin(t),v=Math.cos(t);return i[0]=o*v+l*m,i[1]=l*v-o*m,i[2]=h*v+f*m,i[3]=f*v-h*m,i},s.scale=Ha,s.scale$1=vy,s.scale$2=uo,s.scaleAndAdd=Kd,s.setCacheLimits=function(i,e){io=i,no=e},s.setColumn=function(i,e,t){i[4*e+0]=t[0],i[4*e+1]=t[1],i[4*e+2]=t[2],i[4*e+3]=t[3]},s.setRTLTextPlugin=function(i,e,t=!1){if(E===d||E===_||E===g)throw new Error("setRTLTextPlugin cannot be called multiple times.");C=Mt.resolveURL(i),E=d,w=e,z(),t||K()},s.smoothstep=Pe,s.spec=Me,s.storeAuthState=function(i,e){e?Dr.add(i):Dr.delete(i)},s.sub=ho,s.subtract=hm,s.symbolSize=FT,s.tileAABB=function(i,e,t,o,l,h,f,m,v){if(v.name==="globe")return g2(i,e,new of(t,o,l));const b=Ja({z:t,x:o,y:l},v);return new xr([(h+b.x/b.scale)*e,e*(b.y/b.scale),f],[(h+b.x2/b.scale)*e,e*(b.y2/b.scale),m])},s.tileCornersToBounds=mf,s.tileTransform=Ja,s.transformMat3=function(i,e,t){var o=e[0],l=e[1],h=e[2];return i[0]=o*t[0]+l*t[3]+h*t[6],i[1]=o*t[1]+l*t[4]+h*t[7],i[2]=o*t[2]+l*t[5]+h*t[8],i},s.transformMat4=Dn,s.transformMat4$1=Xa,s.transformQuat=yy,s.transitionTileAABBinECEF=Mv,s.translate=qu,s.transpose=function(i,e){if(i===e){var t=e[1],o=e[2],l=e[5];i[1]=e[3],i[2]=e[6],i[3]=t,i[5]=e[7],i[6]=o,i[7]=l}else i[0]=e[0],i[1]=e[3],i[2]=e[6],i[3]=e[1],i[4]=e[4],i[5]=e[7],i[6]=e[2],i[7]=e[5],i[8]=e[8];return i},s.triggerPluginCompletionEvent=k,s.uniqueId=$e,s.updateGlobeVertexNormal=function(i,e,t,o,l){const h=5*e+2;i.float32[h+0]=t,i.float32[h+1]=o,i.float32[h+2]=l},s.validateCustomStyleLayer=function(i){const e=[],t=i.id;return t===void 0&&e.push({message:`layers.${t}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${t}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${t}: property "renderingMode" must be either "2d" or "3d"`}),e},s.validateFilter=i=>so(Fs(i)),s.validateFog=i=>so(Ed(i)),s.validateLayer=i=>so(Nl(i)),s.validateLight=i=>so(Td(i)),s.validateSource=i=>so(wd(i)),s.validateStyle=$l,s.validateTerrain=i=>so(ql(i)),s.values=Ke,s.vectorTile=Ya,s.version=Ce,s.warnOnce=xt,s.window=D,s.wrap=we}),T(["./shared"],function(s){function D(Q){if(typeof Q=="number"||typeof Q=="boolean"||typeof Q=="string"||Q==null)return JSON.stringify(Q);if(Array.isArray(Q)){let V="[";for(const J of Q)V+=`${D(J)},`;return`${V}]`}let B="{";for(const V of Object.keys(Q).sort())B+=`${V}:${D(Q[V])},`;return`${B}}`}function O(Q){let B="";for(const V of s.refProperties)B+=`/${D(Q[V])}`;return B}class F{constructor(B){this.keyCache={},B&&this.replace(B)}replace(B){this._layerConfigs={},this._layers={},this.update(B,[])}update(B,V){for(const ne of B)this._layerConfigs[ne.id]=ne,(this._layers[ne.id]=s.createStyleLayer(ne)).compileFilter(),this.keyCache[ne.id]&&delete this.keyCache[ne.id];for(const ne of V)delete this.keyCache[ne],delete this._layerConfigs[ne],delete this._layers[ne];this.familiesBySource={};const J=function(ne,ge){const ke={};for(let ye=0;ye<ne.length;ye++){const ze=ge&&ge[ne[ye].id]||O(ne[ye]);ge&&(ge[ne[ye].id]=ze);let Qe=ke[ze];Qe||(Qe=ke[ze]=[]),Qe.push(ne[ye])}const Ae=[];for(const ye in ke)Ae.push(ke[ye]);return Ae}(s.values(this._layerConfigs),this.keyCache);for(const ne of J){const ge=ne.map(Ct=>this._layers[Ct.id]),ke=ge[0];if(ke.visibility==="none")continue;const Ae=ke.source||"";let ye=this.familiesBySource[Ae];ye||(ye=this.familiesBySource[Ae]={});const ze=ke.sourceLayer||"_geojsonTileLayer";let Qe=ye[ze];Qe||(Qe=ye[ze]=[]),Qe.push(ge)}}}class N{loadTile(B,V){const{uid:J,encoding:ne,rawImageData:ge,padding:ke,buildQuadTree:Ae}=B,ye=s.window.ImageBitmap&&ge instanceof s.window.ImageBitmap?this.getImageData(ge,ke):ge;V(null,new s.DEMData(J,ye,ne,ke<1,Ae))}getImageData(B,V){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(B.width,B.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=B.width,this.offscreenCanvas.height=B.height,this.offscreenCanvasContext.drawImage(B,0,0,B.width,B.height);const J=this.offscreenCanvasContext.getImageData(-V,-V,B.width+2*V,B.height+2*V);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),J}}var q=function Q(B,V){var J,ne=B&&B.type;if(ne==="FeatureCollection")for(J=0;J<B.features.length;J++)Q(B.features[J],V);else if(ne==="GeometryCollection")for(J=0;J<B.geometries.length;J++)Q(B.geometries[J],V);else if(ne==="Feature")Q(B.geometry,V);else if(ne==="Polygon")Z(B.coordinates,V);else if(ne==="MultiPolygon")for(J=0;J<B.coordinates.length;J++)Z(B.coordinates[J],V);return B};function Z(Q,B){if(Q.length!==0){ae(Q[0],B);for(var V=1;V<Q.length;V++)ae(Q[V],!B)}}function ae(Q,B){for(var V=0,J=0,ne=0,ge=Q.length,ke=ge-1;ne<ge;ke=ne++){var Ae=(Q[ne][0]-Q[ke][0])*(Q[ke][1]+Q[ne][1]),ye=V+Ae;J+=Math.abs(V)>=Math.abs(Ae)?V-ye+Ae:Ae-ye+V,V=ye}V+J>=0!=!!B&&Q.reverse()}const le=s.vectorTile.VectorTileFeature.prototype.toGeoJSON;class xe{constructor(B){this._feature=B,this.extent=s.EXTENT,this.type=B.type,this.properties=B.tags,"id"in B&&!isNaN(B.id)&&(this.id=parseInt(B.id,10))}loadGeometry(){if(this._feature.type===1){const B=[];for(const V of this._feature.geometry)B.push([new s.pointGeometry(V[0],V[1])]);return B}{const B=[];for(const V of this._feature.geometry){const J=[];for(const ne of V)J.push(new s.pointGeometry(ne[0],ne[1]));B.push(J)}return B}}toGeoJSON(B,V,J){return le.call(this,B,V,J)}}class He{constructor(B){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=B.length,this._features=B}feature(B){return new xe(this._features[B])}}var Ee=s.vectorTile.VectorTileFeature,Le=Ne;function Ne(Q,B){this.options=B||{},this.features=Q,this.length=Q.length}function Se(Q,B){this.id=typeof Q.id=="number"?Q.id:void 0,this.type=Q.type,this.rawGeometry=Q.type===1?[Q.geometry]:Q.geometry,this.properties=Q.tags,this.extent=B||4096}Ne.prototype.feature=function(Q){return new Se(this.features[Q],this.options.extent)},Se.prototype.loadGeometry=function(){var Q=this.rawGeometry;this.geometry=[];for(var B=0;B<Q.length;B++){for(var V=Q[B],J=[],ne=0;ne<V.length;ne++)J.push(new s.pointGeometry(V[ne][0],V[ne][1]));this.geometry.push(J)}return this.geometry},Se.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Q=this.geometry,B=1/0,V=-1/0,J=1/0,ne=-1/0,ge=0;ge<Q.length;ge++)for(var ke=Q[ge],Ae=0;Ae<ke.length;Ae++){var ye=ke[Ae];B=Math.min(B,ye.x),V=Math.max(V,ye.x),J=Math.min(J,ye.y),ne=Math.max(ne,ye.y)}return[B,J,V,ne]},Se.prototype.toGeoJSON=Ee.prototype.toGeoJSON;var Pe=De,we=Le;function De(Q){var B=new s.pbf;return function(V,J){for(var ne in V.layers)J.writeMessage(3,Ke,V.layers[ne])}(Q,B),B.finish()}function Ke(Q,B){var V;B.writeVarintField(15,Q.version||1),B.writeStringField(1,Q.name||""),B.writeVarintField(5,Q.extent||4096);var J={keys:[],values:[],keycache:{},valuecache:{}};for(V=0;V<Q.length;V++)J.feature=Q.feature(V),B.writeMessage(2,Ue,J);var ne=J.keys;for(V=0;V<ne.length;V++)B.writeStringField(3,ne[V]);var ge=J.values;for(V=0;V<ge.length;V++)B.writeMessage(4,Ft,ge[V])}function Ue(Q,B){var V=Q.feature;V.id!==void 0&&B.writeVarintField(1,V.id),B.writeMessage(2,nt,Q),B.writeVarintField(3,V.type),B.writeMessage(4,Ye,V)}function nt(Q,B){var V=Q.feature,J=Q.keys,ne=Q.values,ge=Q.keycache,ke=Q.valuecache;for(var Ae in V.properties){var ye=V.properties[Ae],ze=ge[Ae];if(ye!==null){ze===void 0&&(J.push(Ae),ge[Ae]=ze=J.length-1),B.writeVarint(ze);var Qe=typeof ye;Qe!=="string"&&Qe!=="boolean"&&Qe!=="number"&&(ye=JSON.stringify(ye));var Ct=Qe+":"+ye,st=ke[Ct];st===void 0&&(ne.push(ye),ke[Ct]=st=ne.length-1),B.writeVarint(st)}}}function $e(Q,B){return(B<<3)+(7&Q)}function Ge(Q){return Q<<1^Q>>31}function Ye(Q,B){for(var V=Q.loadGeometry(),J=Q.type,ne=0,ge=0,ke=V.length,Ae=0;Ae<ke;Ae++){var ye=V[Ae],ze=1;J===1&&(ze=ye.length),B.writeVarint($e(1,ze));for(var Qe=J===3?ye.length-1:ye.length,Ct=0;Ct<Qe;Ct++){Ct===1&&J!==1&&B.writeVarint($e(2,Qe-1));var st=ye[Ct].x-ne,$t=ye[Ct].y-ge;B.writeVarint(Ge(st)),B.writeVarint(Ge($t)),ne+=st,ge+=$t}J===3&&B.writeVarint($e(7,1))}}function Ft(Q,B){var V=typeof Q;V==="string"?B.writeStringField(1,Q):V==="boolean"?B.writeBooleanField(7,Q):V==="number"&&(Q%1!=0?B.writeDoubleField(3,Q):Q<0?B.writeSVarintField(6,Q):B.writeVarintField(5,Q))}function Ht(Q,B,V,J,ne,ge){if(ne-J<=V)return;const ke=J+ne>>1;ot(Q,B,ke,J,ne,ge%2),Ht(Q,B,V,J,ke-1,ge+1),Ht(Q,B,V,ke+1,ne,ge+1)}function ot(Q,B,V,J,ne,ge){for(;ne>J;){if(ne-J>600){const ze=ne-J+1,Qe=V-J+1,Ct=Math.log(ze),st=.5*Math.exp(2*Ct/3),$t=.5*Math.sqrt(Ct*st*(ze-st)/ze)*(Qe-ze/2<0?-1:1);ot(Q,B,V,Math.max(J,Math.floor(V-Qe*st/ze+$t)),Math.min(ne,Math.floor(V+(ze-Qe)*st/ze+$t)),ge)}const ke=B[2*V+ge];let Ae=J,ye=ne;for(At(Q,B,J,V),B[2*ne+ge]>ke&&At(Q,B,J,ne);Ae<ye;){for(At(Q,B,Ae,ye),Ae++,ye--;B[2*Ae+ge]<ke;)Ae++;for(;B[2*ye+ge]>ke;)ye--}B[2*J+ge]===ke?At(Q,B,J,ye):(ye++,At(Q,B,ye,ne)),ye<=V&&(J=ye+1),V<=ye&&(ne=ye-1)}}function At(Q,B,V,J){di(Q,V,J),di(B,2*V,2*J),di(B,2*V+1,2*J+1)}function di(Q,B,V){const J=Q[B];Q[B]=Q[V],Q[V]=J}function Fe(Q,B,V,J){const ne=Q-V,ge=B-J;return ne*ne+ge*ge}Pe.fromVectorTileJs=De,Pe.fromGeojsonVt=function(Q,B){B=B||{};var V={};for(var J in Q)V[J]=new Le(Q[J].features,B),V[J].name=J,V[J].version=B.version,V[J].extent=B.extent;return De({layers:V})},Pe.GeoJSONWrapper=we;const _t=Q=>Q[0],xt=Q=>Q[1];class Bt{constructor(B,V=_t,J=xt,ne=64,ge=Float64Array){this.nodeSize=ne,this.points=B;const ke=B.length<65536?Uint16Array:Uint32Array,Ae=this.ids=new ke(B.length),ye=this.coords=new ge(2*B.length);for(let ze=0;ze<B.length;ze++)Ae[ze]=ze,ye[2*ze]=V(B[ze]),ye[2*ze+1]=J(B[ze]);Ht(Ae,ye,ne,0,Ae.length-1,0)}range(B,V,J,ne){return function(ge,ke,Ae,ye,ze,Qe,Ct){const st=[0,ge.length-1,0],$t=[];let Xt,jt;for(;st.length;){const Qt=st.pop(),ci=st.pop(),Li=st.pop();if(ci-Li<=Ct){for(let Ze=Li;Ze<=ci;Ze++)Xt=ke[2*Ze],jt=ke[2*Ze+1],Xt>=Ae&&Xt<=ze&&jt>=ye&&jt<=Qe&&$t.push(ge[Ze]);continue}const he=Math.floor((Li+ci)/2);Xt=ke[2*he],jt=ke[2*he+1],Xt>=Ae&&Xt<=ze&&jt>=ye&&jt<=Qe&&$t.push(ge[he]);const vt=(Qt+1)%2;(Qt===0?Ae<=Xt:ye<=jt)&&(st.push(Li),st.push(he-1),st.push(vt)),(Qt===0?ze>=Xt:Qe>=jt)&&(st.push(he+1),st.push(ci),st.push(vt))}return $t}(this.ids,this.coords,B,V,J,ne,this.nodeSize)}within(B,V,J){return function(ne,ge,ke,Ae,ye,ze){const Qe=[0,ne.length-1,0],Ct=[],st=ye*ye;for(;Qe.length;){const $t=Qe.pop(),Xt=Qe.pop(),jt=Qe.pop();if(Xt-jt<=ze){for(let vt=jt;vt<=Xt;vt++)Fe(ge[2*vt],ge[2*vt+1],ke,Ae)<=st&&Ct.push(ne[vt]);continue}const Qt=Math.floor((jt+Xt)/2),ci=ge[2*Qt],Li=ge[2*Qt+1];Fe(ci,Li,ke,Ae)<=st&&Ct.push(ne[Qt]);const he=($t+1)%2;($t===0?ke-ye<=ci:Ae-ye<=Li)&&(Qe.push(jt),Qe.push(Qt-1),Qe.push(he)),($t===0?ke+ye>=ci:Ae+ye>=Li)&&(Qe.push(Qt+1),Qe.push(Xt),Qe.push(he))}return Ct}(this.ids,this.coords,B,V,J,this.nodeSize)}}const pi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Q=>Q},Ci=Math.fround||(Kt=new Float32Array(1),Q=>(Kt[0]=+Q,Kt[0]));var Kt;class Yt{constructor(B){this.options=ct(Object.create(pi),B),this.trees=new Array(this.options.maxZoom+1)}load(B){const{log:V,minZoom:J,maxZoom:ne,nodeSize:ge}=this.options;V&&console.time("total time");const ke=`prepare ${B.length} points`;V&&console.time(ke),this.points=B;let Ae=[];for(let ye=0;ye<B.length;ye++)B[ye].geometry&&Ae.push(Et(B[ye],ye));this.trees[ne+1]=new Bt(Ae,ut,bt,ge,Float32Array),V&&console.timeEnd(ke);for(let ye=ne;ye>=J;ye--){const ze=+Date.now();Ae=this._cluster(Ae,ye),this.trees[ye]=new Bt(Ae,ut,bt,ge,Float32Array),V&&console.log("z%d: %d clusters in %dms",ye,Ae.length,+Date.now()-ze)}return V&&console.timeEnd("total time"),this}getClusters(B,V){let J=((B[0]+180)%360+360)%360-180;const ne=Math.max(-90,Math.min(90,B[1]));let ge=B[2]===180?180:((B[2]+180)%360+360)%360-180;const ke=Math.max(-90,Math.min(90,B[3]));if(B[2]-B[0]>=360)J=-180,ge=180;else if(J>ge){const Qe=this.getClusters([J,ne,180,ke],V),Ct=this.getClusters([-180,ne,ge,ke],V);return Qe.concat(Ct)}const Ae=this.trees[this._limitZoom(V)],ye=Ae.range(de(J),Ce(ke),de(ge),Ce(ne)),ze=[];for(const Qe of ye){const Ct=Ae.points[Qe];ze.push(Ct.numPoints?Ri(Ct):this.points[Ct.index])}return ze}getChildren(B){const V=this._getOriginId(B),J=this._getOriginZoom(B),ne="No cluster with the specified id.",ge=this.trees[J];if(!ge)throw new Error(ne);const ke=ge.points[V];if(!ke)throw new Error(ne);const Ae=this.options.radius/(this.options.extent*Math.pow(2,J-1)),ye=ge.within(ke.x,ke.y,Ae),ze=[];for(const Qe of ye){const Ct=ge.points[Qe];Ct.parentId===B&&ze.push(Ct.numPoints?Ri(Ct):this.points[Ct.index])}if(ze.length===0)throw new Error(ne);return ze}getLeaves(B,V,J){const ne=[];return this._appendLeaves(ne,B,V=V||10,J=J||0,0),ne}getTile(B,V,J){const ne=this.trees[this._limitZoom(B)],ge=Math.pow(2,B),{extent:ke,radius:Ae}=this.options,ye=Ae/ke,ze=(J-ye)/ge,Qe=(J+1+ye)/ge,Ct={features:[]};return this._addTileFeatures(ne.range((V-ye)/ge,ze,(V+1+ye)/ge,Qe),ne.points,V,J,ge,Ct),V===0&&this._addTileFeatures(ne.range(1-ye/ge,ze,1,Qe),ne.points,ge,J,ge,Ct),V===ge-1&&this._addTileFeatures(ne.range(0,ze,ye/ge,Qe),ne.points,-1,J,ge,Ct),Ct.features.length?Ct:null}getClusterExpansionZoom(B){let V=this._getOriginZoom(B)-1;for(;V<=this.options.maxZoom;){const J=this.getChildren(B);if(V++,J.length!==1)break;B=J[0].properties.cluster_id}return V}_appendLeaves(B,V,J,ne,ge){const ke=this.getChildren(V);for(const Ae of ke){const ye=Ae.properties;if(ye&&ye.cluster?ge+ye.point_count<=ne?ge+=ye.point_count:ge=this._appendLeaves(B,ye.cluster_id,J,ne,ge):ge<ne?ge++:B.push(Ae),B.length===J)break}return ge}_addTileFeatures(B,V,J,ne,ge,ke){for(const Ae of B){const ye=V[Ae],ze=ye.numPoints;let Qe,Ct,st;if(ze)Qe=Tn(ye),Ct=ye.x,st=ye.y;else{const jt=this.points[ye.index];Qe=jt.properties,Ct=de(jt.geometry.coordinates[0]),st=Ce(jt.geometry.coordinates[1])}const $t={type:1,geometry:[[Math.round(this.options.extent*(Ct*ge-J)),Math.round(this.options.extent*(st*ge-ne))]],tags:Qe};let Xt;ze?Xt=ye.id:this.options.generateId?Xt=ye.index:this.points[ye.index].id&&(Xt=this.points[ye.index].id),Xt!==void 0&&($t.id=Xt),ke.features.push($t)}}_limitZoom(B){return Math.max(this.options.minZoom,Math.min(+B,this.options.maxZoom+1))}_cluster(B,V){const J=[],{radius:ne,extent:ge,reduce:ke,minPoints:Ae}=this.options,ye=ne/(ge*Math.pow(2,V));for(let ze=0;ze<B.length;ze++){const Qe=B[ze];if(Qe.zoom<=V)continue;Qe.zoom=V;const Ct=this.trees[V+1],st=Ct.within(Qe.x,Qe.y,ye),$t=Qe.numPoints||1;let Xt=$t;for(const jt of st){const Qt=Ct.points[jt];Qt.zoom>V&&(Xt+=Qt.numPoints||1)}if(Xt>$t&&Xt>=Ae){let jt=Qe.x*$t,Qt=Qe.y*$t,ci=ke&&$t>1?this._map(Qe,!0):null;const Li=(ze<<5)+(V+1)+this.points.length;for(const he of st){const vt=Ct.points[he];if(vt.zoom<=V)continue;vt.zoom=V;const Ze=vt.numPoints||1;jt+=vt.x*Ze,Qt+=vt.y*Ze,vt.parentId=Li,ke&&(ci||(ci=this._map(Qe,!0)),ke(ci,this._map(vt)))}Qe.parentId=Li,J.push(Jt(jt/Xt,Qt/Xt,Li,Xt,ci))}else if(J.push(Qe),Xt>1)for(const jt of st){const Qt=Ct.points[jt];Qt.zoom<=V||(Qt.zoom=V,J.push(Qt))}}return J}_getOriginId(B){return B-this.points.length>>5}_getOriginZoom(B){return(B-this.points.length)%32}_map(B,V){if(B.numPoints)return V?ct({},B.properties):B.properties;const J=this.points[B.index].properties,ne=this.options.map(J);return V&&ne===J?ct({},ne):ne}}function Jt(Q,B,V,J,ne){return{x:Ci(Q),y:Ci(B),zoom:1/0,id:V,parentId:-1,numPoints:J,properties:ne}}function Et(Q,B){const[V,J]=Q.geometry.coordinates;return{x:Ci(de(V)),y:Ci(Ce(J)),zoom:1/0,index:B,parentId:-1}}function Ri(Q){return{type:"Feature",id:Q.id,properties:Tn(Q),geometry:{type:"Point",coordinates:[(B=Q.x,360*(B-.5)),Re(Q.y)]}};var B}function Tn(Q){const B=Q.numPoints,V=B>=1e4?`${Math.round(B/1e3)}k`:B>=1e3?Math.round(B/100)/10+"k":B;return ct(ct({},Q.properties),{cluster:!0,cluster_id:Q.id,point_count:B,point_count_abbreviated:V})}function de(Q){return Q/360+.5}function Ce(Q){const B=Math.sin(Q*Math.PI/180),V=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return V<0?0:V>1?1:V}function Re(Q){const B=(180-360*Q)*Math.PI/180;return 360*Math.atan(Math.exp(B))/Math.PI-90}function ct(Q,B){for(const V in B)Q[V]=B[V];return Q}function ut(Q){return Q.x}function bt(Q){return Q.y}function Mt(Q,B,V,J){for(var ne,ge=J,ke=V-B>>1,Ae=V-B,ye=Q[B],ze=Q[B+1],Qe=Q[V],Ct=Q[V+1],st=B+3;st<V;st+=3){var $t=gt(Q[st],Q[st+1],ye,ze,Qe,Ct);if($t>ge)ne=st,ge=$t;else if($t===ge){var Xt=Math.abs(st-ke);Xt<Ae&&(ne=st,Ae=Xt)}}ge>J&&(ne-B>3&&Mt(Q,B,ne,J),Q[ne+2]=ge,V-ne>3&&Mt(Q,ne,V,J))}function gt(Q,B,V,J,ne,ge){var ke=ne-V,Ae=ge-J;if(ke!==0||Ae!==0){var ye=((Q-V)*ke+(B-J)*Ae)/(ke*ke+Ae*Ae);ye>1?(V=ne,J=ge):ye>0&&(V+=ke*ye,J+=Ae*ye)}return(ke=Q-V)*ke+(Ae=B-J)*Ae}function Xe(Q,B,V,J){var ne={id:Q===void 0?null:Q,type:B,geometry:V,tags:J,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ge){var ke=ge.geometry,Ae=ge.type;if(Ae==="Point"||Ae==="MultiPoint"||Ae==="LineString")ht(ge,ke);else if(Ae==="Polygon"||Ae==="MultiLineString")for(var ye=0;ye<ke.length;ye++)ht(ge,ke[ye]);else if(Ae==="MultiPolygon")for(ye=0;ye<ke.length;ye++)for(var ze=0;ze<ke[ye].length;ze++)ht(ge,ke[ye][ze])}(ne),ne}function ht(Q,B){for(var V=0;V<B.length;V+=3)Q.minX=Math.min(Q.minX,B[V]),Q.minY=Math.min(Q.minY,B[V+1]),Q.maxX=Math.max(Q.maxX,B[V]),Q.maxY=Math.max(Q.maxY,B[V+1])}function qt(Q,B,V,J){if(B.geometry){var ne=B.geometry.coordinates,ge=B.geometry.type,ke=Math.pow(V.tolerance/((1<<V.maxZoom)*V.extent),2),Ae=[],ye=B.id;if(V.promoteId?ye=B.properties[V.promoteId]:V.generateId&&(ye=J||0),ge==="Point")Nt(ne,Ae);else if(ge==="MultiPoint")for(var ze=0;ze<ne.length;ze++)Nt(ne[ze],Ae);else if(ge==="LineString")Zt(ne,Ae,ke,!1);else if(ge==="MultiLineString"){if(V.lineMetrics){for(ze=0;ze<ne.length;ze++)Zt(ne[ze],Ae=[],ke,!1),Q.push(Xe(ye,"LineString",Ae,B.properties));return}ti(ne,Ae,ke,!1)}else if(ge==="Polygon")ti(ne,Ae,ke,!0);else{if(ge!=="MultiPolygon"){if(ge==="GeometryCollection"){for(ze=0;ze<B.geometry.geometries.length;ze++)qt(Q,{id:ye,geometry:B.geometry.geometries[ze],properties:B.properties},V,J);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ze=0;ze<ne.length;ze++){var Qe=[];ti(ne[ze],Qe,ke,!0),Ae.push(Qe)}}Q.push(Xe(ye,ge,Ae,B.properties))}}function Nt(Q,B){B.push(mi(Q[0])),B.push(Di(Q[1])),B.push(0)}function Zt(Q,B,V,J){for(var ne,ge,ke=0,Ae=0;Ae<Q.length;Ae++){var ye=mi(Q[Ae][0]),ze=Di(Q[Ae][1]);B.push(ye),B.push(ze),B.push(0),Ae>0&&(ke+=J?(ne*ze-ye*ge)/2:Math.sqrt(Math.pow(ye-ne,2)+Math.pow(ze-ge,2))),ne=ye,ge=ze}var Qe=B.length-3;B[2]=1,Mt(B,0,Qe,V),B[Qe+2]=1,B.size=Math.abs(ke),B.start=0,B.end=B.size}function ti(Q,B,V,J){for(var ne=0;ne<Q.length;ne++){var ge=[];Zt(Q[ne],ge,V,J),B.push(ge)}}function mi(Q){return Q/360+.5}function Di(Q){var B=Math.sin(Q*Math.PI/180),V=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return V<0?0:V>1?1:V}function si(Q,B,V,J,ne,ge,ke,Ae){if(J/=B,ge>=(V/=B)&&ke<J)return Q;if(ke<V||ge>=J)return null;for(var ye=[],ze=0;ze<Q.length;ze++){var Qe=Q[ze],Ct=Qe.geometry,st=Qe.type,$t=ne===0?Qe.minX:Qe.minY,Xt=ne===0?Qe.maxX:Qe.maxY;if($t>=V&&Xt<J)ye.push(Qe);else if(!(Xt<V||$t>=J)){var jt=[];if(st==="Point"||st==="MultiPoint")Ai(Ct,jt,V,J,ne);else if(st==="LineString")hn(Ct,jt,V,J,ne,!1,Ae.lineMetrics);else if(st==="MultiLineString")Cn(Ct,jt,V,J,ne,!1);else if(st==="Polygon")Cn(Ct,jt,V,J,ne,!0);else if(st==="MultiPolygon")for(var Qt=0;Qt<Ct.length;Qt++){var ci=[];Cn(Ct[Qt],ci,V,J,ne,!0),ci.length&&jt.push(ci)}if(jt.length){if(Ae.lineMetrics&&st==="LineString"){for(Qt=0;Qt<jt.length;Qt++)ye.push(Xe(Qe.id,st,jt[Qt],Qe.tags));continue}st!=="LineString"&&st!=="MultiLineString"||(jt.length===1?(st="LineString",jt=jt[0]):st="MultiLineString"),st!=="Point"&&st!=="MultiPoint"||(st=jt.length===3?"Point":"MultiPoint"),ye.push(Xe(Qe.id,st,jt,Qe.tags))}}}return ye.length?ye:null}function Ai(Q,B,V,J,ne){for(var ge=0;ge<Q.length;ge+=3){var ke=Q[ge+ne];ke>=V&&ke<=J&&(B.push(Q[ge]),B.push(Q[ge+1]),B.push(Q[ge+2]))}}function hn(Q,B,V,J,ne,ge,ke){for(var Ae,ye,ze=gr(Q),Qe=ne===0?qr:gn,Ct=Q.start,st=0;st<Q.length-3;st+=3){var $t=Q[st],Xt=Q[st+1],jt=Q[st+2],Qt=Q[st+3],ci=Q[st+4],Li=ne===0?$t:Xt,he=ne===0?Qt:ci,vt=!1;ke&&(Ae=Math.sqrt(Math.pow($t-Qt,2)+Math.pow(Xt-ci,2))),Li<V?he>V&&(ye=Qe(ze,$t,Xt,Qt,ci,V),ke&&(ze.start=Ct+Ae*ye)):Li>J?he<J&&(ye=Qe(ze,$t,Xt,Qt,ci,J),ke&&(ze.start=Ct+Ae*ye)):zn(ze,$t,Xt,jt),he<V&&Li>=V&&(ye=Qe(ze,$t,Xt,Qt,ci,V),vt=!0),he>J&&Li<=J&&(ye=Qe(ze,$t,Xt,Qt,ci,J),vt=!0),!ge&&vt&&(ke&&(ze.end=Ct+Ae*ye),B.push(ze),ze=gr(Q)),ke&&(Ct+=Ae)}var Ze=Q.length-3;$t=Q[Ze],Xt=Q[Ze+1],jt=Q[Ze+2],(Li=ne===0?$t:Xt)>=V&&Li<=J&&zn(ze,$t,Xt,jt),Ze=ze.length-3,ge&&Ze>=3&&(ze[Ze]!==ze[0]||ze[Ze+1]!==ze[1])&&zn(ze,ze[0],ze[1],ze[2]),ze.length&&B.push(ze)}function gr(Q){var B=[];return B.size=Q.size,B.start=Q.start,B.end=Q.end,B}function Cn(Q,B,V,J,ne,ge){for(var ke=0;ke<Q.length;ke++)hn(Q[ke],B,V,J,ne,ge,!1)}function zn(Q,B,V,J){Q.push(B),Q.push(V),Q.push(J)}function qr(Q,B,V,J,ne,ge){var ke=(ge-B)/(J-B);return Q.push(ge),Q.push(V+(ne-V)*ke),Q.push(1),ke}function gn(Q,B,V,J,ne,ge){var ke=(ge-V)/(ne-V);return Q.push(B+(J-B)*ke),Q.push(ge),Q.push(1),ke}function Pn(Q,B){for(var V=[],J=0;J<Q.length;J++){var ne,ge=Q[J],ke=ge.type;if(ke==="Point"||ke==="MultiPoint"||ke==="LineString")ne=Pr(ge.geometry,B);else if(ke==="MultiLineString"||ke==="Polygon"){ne=[];for(var Ae=0;Ae<ge.geometry.length;Ae++)ne.push(Pr(ge.geometry[Ae],B))}else if(ke==="MultiPolygon")for(ne=[],Ae=0;Ae<ge.geometry.length;Ae++){for(var ye=[],ze=0;ze<ge.geometry[Ae].length;ze++)ye.push(Pr(ge.geometry[Ae][ze],B));ne.push(ye)}V.push(Xe(ge.id,ke,ne,ge.tags))}return V}function Pr(Q,B){var V=[];V.size=Q.size,Q.start!==void 0&&(V.start=Q.start,V.end=Q.end);for(var J=0;J<Q.length;J+=3)V.push(Q[J]+B,Q[J+1],Q[J+2]);return V}function Ao(Q,B){if(Q.transformed)return Q;var V,J,ne,ge=1<<Q.z,ke=Q.x,Ae=Q.y;for(V=0;V<Q.features.length;V++){var ye=Q.features[V],ze=ye.geometry,Qe=ye.type;if(ye.geometry=[],Qe===1)for(J=0;J<ze.length;J+=2)ye.geometry.push(Yo(ze[J],ze[J+1],B,ge,ke,Ae));else for(J=0;J<ze.length;J++){var Ct=[];for(ne=0;ne<ze[J].length;ne+=2)Ct.push(Yo(ze[J][ne],ze[J][ne+1],B,ge,ke,Ae));ye.geometry.push(Ct)}}return Q.transformed=!0,Q}function Yo(Q,B,V,J,ne,ge){return[Math.round(V*(Q*J-ne)),Math.round(V*(B*J-ge))]}function Es(Q,B,V,J,ne){for(var ge=B===ne.maxZoom?0:ne.tolerance/((1<<B)*ne.extent),ke={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:V,y:J,z:B,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ae=0;Ae<Q.length;Ae++){ke.numFeatures++,pa(ke,Q[Ae],ge,ne);var ye=Q[Ae].minX,ze=Q[Ae].minY,Qe=Q[Ae].maxX,Ct=Q[Ae].maxY;ye<ke.minX&&(ke.minX=ye),ze<ke.minY&&(ke.minY=ze),Qe>ke.maxX&&(ke.maxX=Qe),Ct>ke.maxY&&(ke.maxY=Ct)}return ke}function pa(Q,B,V,J){var ne=B.geometry,ge=B.type,ke=[];if(ge==="Point"||ge==="MultiPoint")for(var Ae=0;Ae<ne.length;Ae+=3)ke.push(ne[Ae]),ke.push(ne[Ae+1]),Q.numPoints++,Q.numSimplified++;else if(ge==="LineString")Dr(ke,ne,Q,V,!1,!1);else if(ge==="MultiLineString"||ge==="Polygon")for(Ae=0;Ae<ne.length;Ae++)Dr(ke,ne[Ae],Q,V,ge==="Polygon",Ae===0);else if(ge==="MultiPolygon")for(var ye=0;ye<ne.length;ye++){var ze=ne[ye];for(Ae=0;Ae<ze.length;Ae++)Dr(ke,ze[Ae],Q,V,!0,Ae===0)}if(ke.length){var Qe=B.tags||null;if(ge==="LineString"&&J.lineMetrics){for(var Ct in Qe={},B.tags)Qe[Ct]=B.tags[Ct];Qe.mapbox_clip_start=ne.start/ne.size,Qe.mapbox_clip_end=ne.end/ne.size}var st={geometry:ke,type:ge==="Polygon"||ge==="MultiPolygon"?3:ge==="LineString"||ge==="MultiLineString"?2:1,tags:Qe};B.id!==null&&(st.id=B.id),Q.features.push(st)}}function Dr(Q,B,V,J,ne,ge){var ke=J*J;if(J>0&&B.size<(ne?ke:J))V.numPoints+=B.length/3;else{for(var Ae=[],ye=0;ye<B.length;ye+=3)(J===0||B[ye+2]>ke)&&(V.numSimplified++,Ae.push(B[ye]),Ae.push(B[ye+1])),V.numPoints++;ne&&function(ze,Qe){for(var Ct=0,st=0,$t=ze.length,Xt=$t-2;st<$t;Xt=st,st+=2)Ct+=(ze[st]-ze[Xt])*(ze[st+1]+ze[Xt+1]);if(Ct>0===Qe)for(st=0,$t=ze.length;st<$t/2;st+=2){var jt=ze[st],Qt=ze[st+1];ze[st]=ze[$t-2-st],ze[st+1]=ze[$t-1-st],ze[$t-2-st]=jt,ze[$t-1-st]=Qt}}(Ae,ge),Q.push(Ae)}}function Lr(Q,B){var V=(B=this.options=function(ne,ge){for(var ke in ge)ne[ke]=ge[ke];return ne}(Object.create(this.options),B)).debug;if(V&&console.time("preprocess data"),B.maxZoom<0||B.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(B.promoteId&&B.generateId)throw new Error("promoteId and generateId cannot be used together.");var J=function(ne,ge){var ke=[];if(ne.type==="FeatureCollection")for(var Ae=0;Ae<ne.features.length;Ae++)qt(ke,ne.features[Ae],ge,Ae);else qt(ke,ne.type==="Feature"?ne:{geometry:ne},ge);return ke}(Q,B);this.tiles={},this.tileCoords=[],V&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",B.indexMaxZoom,B.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(J=function(ne,ge){var ke=ge.buffer/ge.extent,Ae=ne,ye=si(ne,1,-1-ke,ke,0,-1,2,ge),ze=si(ne,1,1-ke,2+ke,0,-1,2,ge);return(ye||ze)&&(Ae=si(ne,1,-ke,1+ke,0,-1,2,ge)||[],ye&&(Ae=Pn(ye,1).concat(Ae)),ze&&(Ae=Ae.concat(Pn(ze,-1)))),Ae}(J,B)).length&&this.splitTile(J,0,0,0),V&&(J.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function io(Q,B,V){return 32*((1<<Q)*V+B)+Q}function no(Q,B){const V=Q.tileID.canonical;if(!this._geoJSONIndex)return B(null,null);const J=this._geoJSONIndex.getTile(V.z,V.x,V.y);if(!J)return B(null,null);const ne=new He(J.features);let ge=Pe(ne);ge.byteOffset===0&&ge.byteLength===ge.buffer.byteLength||(ge=new Uint8Array(ge)),B(null,{vectorTile:ne,rawData:ge.buffer})}Lr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Lr.prototype.splitTile=function(Q,B,V,J,ne,ge,ke){for(var Ae=[Q,B,V,J],ye=this.options,ze=ye.debug;Ae.length;){J=Ae.pop(),V=Ae.pop(),B=Ae.pop(),Q=Ae.pop();var Qe=1<<B,Ct=io(B,V,J),st=this.tiles[Ct];if(!st&&(ze>1&&console.time("creation"),st=this.tiles[Ct]=Es(Q,B,V,J,ye),this.tileCoords.push({z:B,x:V,y:J}),ze)){ze>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",B,V,J,st.numFeatures,st.numPoints,st.numSimplified),console.timeEnd("creation"));var $t="z"+B;this.stats[$t]=(this.stats[$t]||0)+1,this.total++}if(st.source=Q,ne){if(B===ye.maxZoom||B===ne)continue;var Xt=1<<ne-B;if(V!==Math.floor(ge/Xt)||J!==Math.floor(ke/Xt))continue}else if(B===ye.indexMaxZoom||st.numPoints<=ye.indexMaxPoints)continue;if(st.source=null,Q.length!==0){ze>1&&console.time("clipping");var jt,Qt,ci,Li,he,vt,Ze=.5*ye.buffer/ye.extent,Me=.5-Ze,Ti=.5+Ze,ni=1+Ze;jt=Qt=ci=Li=null,he=si(Q,Qe,V-Ze,V+Ti,0,st.minX,st.maxX,ye),vt=si(Q,Qe,V+Me,V+ni,0,st.minX,st.maxX,ye),Q=null,he&&(jt=si(he,Qe,J-Ze,J+Ti,1,st.minY,st.maxY,ye),Qt=si(he,Qe,J+Me,J+ni,1,st.minY,st.maxY,ye),he=null),vt&&(ci=si(vt,Qe,J-Ze,J+Ti,1,st.minY,st.maxY,ye),Li=si(vt,Qe,J+Me,J+ni,1,st.minY,st.maxY,ye),vt=null),ze>1&&console.timeEnd("clipping"),Ae.push(jt||[],B+1,2*V,2*J),Ae.push(Qt||[],B+1,2*V,2*J+1),Ae.push(ci||[],B+1,2*V+1,2*J),Ae.push(Li||[],B+1,2*V+1,2*J+1)}}},Lr.prototype.getTile=function(Q,B,V){var J=this.options,ne=J.extent,ge=J.debug;if(Q<0||Q>24)return null;var ke=1<<Q,Ae=io(Q,B=(B%ke+ke)%ke,V);if(this.tiles[Ae])return Ao(this.tiles[Ae],ne);ge>1&&console.log("drilling down to z%d-%d-%d",Q,B,V);for(var ye,ze=Q,Qe=B,Ct=V;!ye&&ze>0;)ze--,Qe=Math.floor(Qe/2),Ct=Math.floor(Ct/2),ye=this.tiles[io(ze,Qe,Ct)];return ye&&ye.source?(ge>1&&console.log("found parent tile z%d-%d-%d",ze,Qe,Ct),ge>1&&console.time("drilling down"),this.splitTile(ye.source,ze,Qe,Ct,Q,B,V),ge>1&&console.timeEnd("drilling down"),this.tiles[Ae]?Ao(this.tiles[Ae],ne):null):null};class An extends s.VectorTileWorkerSource{constructor(B,V,J,ne,ge){super(B,V,J,ne,no),ge&&(this.loadGeoJSON=ge)}loadData(B,V){const J=B&&B.request,ne=J&&J.collectResourceTiming;this.loadGeoJSON(B,(ge,ke)=>{if(ge||!ke)return V(ge);if(typeof ke!="object")return V(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`));{q(ke,!0);try{if(B.filter){const ye=s.createExpression(B.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ye.result==="error")throw new Error(ye.value.map(Qe=>`${Qe.key}: ${Qe.message}`).join(", "));const ze=ke.features.filter(Qe=>ye.value.evaluate({zoom:0},Qe));ke={type:"FeatureCollection",features:ze}}this._geoJSONIndex=B.cluster?new Yt(function({superclusterOptions:ye,clusterProperties:ze}){if(!ze||!ye)return ye;const Qe={},Ct={},st={accumulated:null,zoom:0},$t={properties:null},Xt=Object.keys(ze);for(const jt of Xt){const[Qt,ci]=ze[jt],Li=s.createExpression(ci),he=s.createExpression(typeof Qt=="string"?[Qt,["accumulated"],["get",jt]]:Qt);Qe[jt]=Li.value,Ct[jt]=he.value}return ye.map=jt=>{$t.properties=jt;const Qt={};for(const ci of Xt)Qt[ci]=Qe[ci].evaluate(st,$t);return Qt},ye.reduce=(jt,Qt)=>{$t.properties=Qt;for(const ci of Xt)st.accumulated=jt[ci],jt[ci]=Ct[ci].evaluate(st,$t)},ye}(B)).load(ke.features):function(ye,ze){return new Lr(ye,ze)}(ke,B.geojsonVtOptions)}catch(ye){return V(ye)}this.loaded={};const Ae={};if(ne){const ye=s.getPerformanceMeasurement(J);ye&&(Ae.resourceTiming={},Ae.resourceTiming[B.source]=JSON.parse(JSON.stringify(ye)))}V(null,Ae)}})}reloadTile(B,V){const J=this.loaded;return J&&J[B.uid]?super.reloadTile(B,V):this.loadTile(B,V)}loadGeoJSON(B,V){if(B.request)s.getJSON(B.request,V);else{if(typeof B.data!="string")return V(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`));try{return V(null,JSON.parse(B.data))}catch{return V(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(B,V){try{V(null,this._geoJSONIndex.getClusterExpansionZoom(B.clusterId))}catch(J){V(J)}}getClusterChildren(B,V){try{V(null,this._geoJSONIndex.getChildren(B.clusterId))}catch(J){V(J)}}getClusterLeaves(B,V){try{V(null,this._geoJSONIndex.getLeaves(B.clusterId,B.limit,B.offset))}catch(J){V(J)}}}class Er{constructor(B){this.self=B,this.actor=new s.Actor(B,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.getProjection({name:"mercator"}),this.workerSourceTypes={vector:s.VectorTileWorkerSource,geojson:An},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(V,J)=>{if(this.workerSourceTypes[V])throw new Error(`Worker source with name "${V}" already registered.`);this.workerSourceTypes[V]=J},this.self.registerRTLTextPlugin=V=>{if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=V.applyArabicShaping,s.plugin.processBidirectionalText=V.processBidirectionalText,s.plugin.processStyledBidirectionalText=V.processStyledBidirectionalText}}clearCaches(B,V,J){delete this.layerIndexes[B],delete this.availableImages[B],delete this.workerSources[B],delete this.demWorkerSources[B],J()}checkIfReady(B,V,J){J()}setReferrer(B,V){this.referrer=V}spriteLoaded(B,V){this.isSpriteLoaded[B]=V;for(const J in this.workerSources[B]){const ne=this.workerSources[B][J];for(const ge in ne)ne[ge]instanceof s.VectorTileWorkerSource&&(ne[ge].isSpriteLoaded=V,ne[ge].fire(new s.Event("isSpriteLoaded")))}}setImages(B,V,J){this.availableImages[B]=V;for(const ne in this.workerSources[B]){const ge=this.workerSources[B][ne];for(const ke in ge)ge[ke].availableImages=V}J()}enableTerrain(B,V,J){this.terrain=V,J()}setProjection(B,V){this.projections[B]=s.getProjection(V)}setLayers(B,V,J){this.getLayerIndex(B).replace(V),J()}updateLayers(B,V,J){this.getLayerIndex(B).update(V.layers,V.removedIds),J()}loadTile(B,V,J){const ne=this.enableTerrain?s.extend({enableTerrain:this.terrain},V):V;ne.projection=this.projections[B]||this.defaultProjection,this.getWorkerSource(B,V.type,V.source).loadTile(ne,J)}loadDEMTile(B,V,J){const ne=this.enableTerrain?s.extend({buildQuadTree:this.terrain},V):V;this.getDEMWorkerSource(B,V.source).loadTile(ne,J)}reloadTile(B,V,J){const ne=this.enableTerrain?s.extend({enableTerrain:this.terrain},V):V;ne.projection=this.projections[B]||this.defaultProjection,this.getWorkerSource(B,V.type,V.source).reloadTile(ne,J)}abortTile(B,V,J){this.getWorkerSource(B,V.type,V.source).abortTile(V,J)}removeTile(B,V,J){this.getWorkerSource(B,V.type,V.source).removeTile(V,J)}removeSource(B,V,J){if(!this.workerSources[B]||!this.workerSources[B][V.type]||!this.workerSources[B][V.type][V.source])return;const ne=this.workerSources[B][V.type][V.source];delete this.workerSources[B][V.type][V.source],ne.removeSource!==void 0?ne.removeSource(V,J):J()}loadWorkerSource(B,V,J){try{this.self.importScripts(V.url),J()}catch(ne){J(ne.toString())}}syncRTLPluginState(B,V,J){try{s.plugin.setState(V);const ne=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&ne!=null){this.self.importScripts(ne);const ge=s.plugin.isParsed();J(ge?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ne}`),ge)}}catch(ne){J(ne.toString())}}getAvailableImages(B){let V=this.availableImages[B];return V||(V=[]),V}getLayerIndex(B){let V=this.layerIndexes[B];return V||(V=this.layerIndexes[B]=new F),V}getWorkerSource(B,V,J){return this.workerSources[B]||(this.workerSources[B]={}),this.workerSources[B][V]||(this.workerSources[B][V]={}),this.workerSources[B][V][J]||(this.workerSources[B][V][J]=new this.workerSourceTypes[V]({send:(ne,ge,ke,Ae,ye,ze)=>{this.actor.send(ne,ge,ke,B,ye,ze)},scheduler:this.actor.scheduler},this.getLayerIndex(B),this.getAvailableImages(B),this.isSpriteLoaded[B])),this.workerSources[B][V][J]}getDEMWorkerSource(B,V){return this.demWorkerSources[B]||(this.demWorkerSources[B]={}),this.demWorkerSources[B][V]||(this.demWorkerSources[B][V]=new N),this.demWorkerSources[B][V]}enforceCacheSizeLimit(B,V){s.enforceCacheSizeLimit(V)}getWorkerPerformanceMetrics(B,V,J){J(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Er(self)),Er}),T(["./shared"],function(s){function D(c,n){if(Array.isArray(c)){if(!Array.isArray(n)||c.length!==n.length)return!1;for(let a=0;a<c.length;a++)if(!D(c[a],n[a]))return!1;return!0}if(typeof c=="object"&&c!==null&&n!==null){if(typeof n!="object"||Object.keys(c).length!==Object.keys(n).length)return!1;for(const a in c)if(!D(c[a],n[a]))return!1;return!0}return c===n}var O=F;function F(c){return!function(n){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var d,_,g=new Blob([""],{type:"text/javascript"}),w=URL.createObjectURL(g);try{_=new Worker(w),d=!0}catch{d=!1}return _&&_.terminate(),URL.revokeObjectURL(w),d}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var d=document.createElement("canvas");d.width=d.height=1;var _=d.getContext("2d");if(!_)return!1;var g=_.getImageData(0,0,1,1);return g&&g.width===d.width}()?(N[a=n&&n.failIfMajorPerformanceCaveat]===void 0&&(N[a]=function(d){var _,g=function(w){var E=document.createElement("canvas"),C=Object.create(F.webGLContextAttributes);return C.failIfMajorPerformanceCaveat=w,E.getContext("webgl",C)||E.getContext("experimental-webgl",C)}(d);if(!g)return!1;try{_=g.createShader(g.VERTEX_SHADER)}catch{return!1}return!(!_||g.isContextLost())&&(g.shaderSource(_,"void main() {}"),g.compileShader(_),g.getShaderParameter(_,g.COMPILE_STATUS)===!0)}(a)),N[a]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var a}(c)}var N={};function q(c,n,a){const d=s.window.document.createElement(c);return n!==void 0&&(d.className=n),a&&a.appendChild(d),d}function Z(c,n,a){const d=s.window.document.createElementNS("http://www.w3.org/2000/svg",c);for(const _ of Object.keys(n))d.setAttributeNS(null,_,n[_]);return a&&a.appendChild(d),d}F.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ae=s.window.document&&s.window.document.documentElement.style,le=ae&&ae.userSelect!==void 0?"userSelect":"WebkitUserSelect";let xe;function He(){ae&&le&&(xe=ae[le],ae[le]="none")}function Ee(){ae&&le&&(ae[le]=xe)}function Le(c){c.preventDefault(),c.stopPropagation(),s.window.removeEventListener("click",Le,!0)}function Ne(){s.window.addEventListener("click",Le,!0),s.window.setTimeout(()=>{s.window.removeEventListener("click",Le,!0)},0)}function Se(c,n){const a=c.getBoundingClientRect();return De(c,a,n)}function Pe(c,n){const a=c.getBoundingClientRect(),d=[];for(let _=0;_<n.length;_++)d.push(De(c,a,n[_]));return d}function we(c){return s.window.InstallTrigger!==void 0&&c.button===2&&c.ctrlKey&&s.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:c.button}function De(c,n,a){const d=c.offsetWidth===n.width?1:c.offsetWidth/n.width;return new s.pointGeometry((a.clientX-n.left)*d,(a.clientY-n.top)*d)}function Ke(c,n){var a=n[0],d=n[1],_=n[2],g=n[3],w=a*g-_*d;return w?(c[0]=g*(w=1/w),c[1]=-d*w,c[2]=-_*w,c[3]=a*w,c):null}function Ue(c){const{userImage:n}=c;return!!(n&&n.render&&n.render())&&(c.data.replace(new Uint8Array(n.data.buffer)),!0)}class nt extends s.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:a,callback:d}of this.requestors)this._notify(a,d);this.requestors=[]}}hasImage(n){return!!this.getImage(n)}getImage(n){return this.images[n]}addImage(n,a){this._validate(n,a)&&(this.images[n]=a)}_validate(n,a){let d=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new s.ErrorEvent(new Error(`Image "${n}" has invalid "stretchX" value`))),d=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new s.ErrorEvent(new Error(`Image "${n}" has invalid "stretchY" value`))),d=!1),this._validateContent(a.content,a)||(this.fire(new s.ErrorEvent(new Error(`Image "${n}" has invalid "content" value`))),d=!1),d}_validateStretch(n,a){if(!n)return!0;let d=0;for(const _ of n){if(_[0]<d||_[1]<_[0]||a<_[1])return!1;d=_[1]}return!0}_validateContent(n,a){return!(n&&(n.length!==4||n[0]<0||a.data.width<n[0]||n[1]<0||a.data.height<n[1]||n[2]<0||a.data.width<n[2]||n[3]<0||a.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,a){a.version=this.images[n].version+1,this.images[n]=a,this.updatedImages[n]=!0}removeImage(n){const a=this.images[n];delete this.images[n],delete this.patterns[n],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,a){let d=!0;if(!this.isLoaded())for(const _ of n)this.images[_]||(d=!1);this.isLoaded()||d?this._notify(n,a):this.requestors.push({ids:n,callback:a})}_notify(n,a){const d={};for(const _ of n){this.images[_]||this.fire(new s.Event("styleimagemissing",{id:_}));const g=this.images[_];g?d[_]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,hasRenderCallback:Boolean(g.userImage&&g.userImage.render)}:s.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}a(null,d)}getPixelSize(){const{width:n,height:a}=this.atlasImage;return{width:n,height:a}}getPattern(n){const a=this.patterns[n],d=this.getImage(n);if(!d)return null;if(a&&a.position.version===d.version)return a.position;if(a)a.position.version=d.version;else{const _={w:d.data.width+2,h:d.data.height+2,x:0,y:0},g=new s.ImagePosition(_,d);this.patterns[n]={bin:_,position:g}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const a=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.Texture(n,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const g in this.patterns)n.push(this.patterns[g].bin);const{w:a,h:d}=s.potpack(n),_=this.atlasImage;_.resize({width:a||1,height:d||1});for(const g in this.patterns){const{bin:w}=this.patterns[g],E=w.x+1,C=w.y+1,k=this.images[g].data,z=k.width,R=k.height;s.RGBAImage.copy(k,_,{x:0,y:0},{x:E,y:C},{width:z,height:R}),s.RGBAImage.copy(k,_,{x:0,y:R-1},{x:E,y:C-1},{width:z,height:1}),s.RGBAImage.copy(k,_,{x:0,y:0},{x:E,y:C+R},{width:z,height:1}),s.RGBAImage.copy(k,_,{x:z-1,y:0},{x:E-1,y:C},{width:1,height:R}),s.RGBAImage.copy(k,_,{x:0,y:0},{x:E+z,y:C},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const a of n){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const d=this.images[a];Ue(d)&&this.updateImage(a,d)}}}const $e=new s.Properties({anchor:new s.DataConstantProperty(s.spec.light.anchor),position:new class{constructor(){this.specification=s.spec.light.position}possiblyEvaluate(c,n){return function([a,d,_]){const g=s.degToRad(d+90),w=s.degToRad(_);return{x:a*Math.cos(g)*Math.sin(w),y:a*Math.sin(g)*Math.sin(w),z:a*Math.cos(w),azimuthal:d,polar:_}}(c.expression.evaluate(n))}interpolate(c,n,a){return{x:s.number(c.x,n.x,a),y:s.number(c.y,n.y,a),z:s.number(c.z,n.z,a),azimuthal:s.number(c.azimuthal,n.azimuthal,a),polar:s.number(c.polar,n.polar,a)}}},color:new s.DataConstantProperty(s.spec.light.color),intensity:new s.DataConstantProperty(s.spec.light.intensity)}),Ge="-transition";class Ye extends s.Evented{constructor(n){super(),this._transitionable=new s.Transitionable($e),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,a={}){if(!this._validate(s.validateLight,n,a))for(const d in n){const _=n[d];s.endsWith(d,Ge)?this._transitionable.setTransition(d.slice(0,-Ge.length),_):this._transitionable.setValue(d,_)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,d){return(!d||d.validate!==!1)&&s.emitValidationErrors(this,n.call(s.validateStyle,s.extend({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}const Ft=new s.Properties({source:new s.DataConstantProperty(s.spec.terrain.source),exaggeration:new s.DataConstantProperty(s.spec.terrain.exaggeration)}),Ht="-transition";class ot extends s.Evented{constructor(n,a){super(),this._transitionable=new s.Transitionable(Ft),this.set(n),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=a}get(){return this._transitionable.serialize()}set(n){for(const a in n){const d=n[a];s.endsWith(a,Ht)?this._transitionable.setTransition(a.slice(0,-Ht.length),d):this._transitionable.setValue(a,d)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}}function At(c,n,a,d){const _=s.smoothstep(45,65,a),[g,w]=di(c,d),E=s.length(n);let C=1-Math.min(1,Math.exp((E-g)/(w-g)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*_*c.alpha}function di(c,n){const a=.5/Math.tan(.5*n);return[c.range[0]+a,c.range[1]+a]}const Fe=new s.Properties({range:new s.DataConstantProperty(s.spec.fog.range),color:new s.DataConstantProperty(s.spec.fog.color),"high-color":new s.DataConstantProperty(s.spec.fog["high-color"]),"space-color":new s.DataConstantProperty(s.spec.fog["space-color"]),"horizon-blend":new s.DataConstantProperty(s.spec.fog["horizon-blend"]),"star-intensity":new s.DataConstantProperty(s.spec.fog["star-intensity"])}),_t="-transition";class xt extends s.Evented{constructor(n,a){super(),this._transitionable=new s.Transitionable(Fe),this.set(n),this._transitioning=this._transitionable.untransitioned(),this._transform=a}get state(){const n=this._transform,a=n.projection.name==="globe",d=s.globeToMercatorTransition(n.zoom),_=this.properties.get("range"),g=[.5,3];return{range:a?[s.number(g[0],_[0],d),s.number(g[1],_[1],d)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,a={}){if(!this._validate(s.validateFog,n,a)){for(const d of Object.keys(s.spec.fog))n&&n[d]===void 0&&(n[d]=s.spec.fog[d].default);for(const d in n){const _=n[d];s.endsWith(d,_t)?this._transitionable.setTransition(d.slice(0,-_t.length),_):this._transitionable.setValue(d,_)}}}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.smoothstep(45,65,n))*a.a}getOpacityAtLatLng(n,a){return this._transform.projection.supportsFog?function(d,_,g){const w=s.MercatorCoordinate.fromLngLat(_),E=g.elevation?g.elevation.getAtPointOrZero(w):0,C=[w.x,w.y,E];return s.transformMat4(C,C,g.mercatorFogMatrix),At(d,C,g.pitch,g._fov)}(this.state,n,a):0}getFovAdjustedRange(n){return this._transform.projection.supportsFog?di(this.state,n):[0,1]}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,d){return(!d||d.validate!==!1)&&s.emitValidationErrors(this,n.call(s.validateStyle,s.extend({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}class Bt{constructor(n,a){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=s.uniqueId();const d=this.workerPool.acquire(this.id);for(let _=0;_<d.length;_++){const g=new Bt.Actor(d[_],a,this.id);g.name=`Worker ${_}`,this.actors.push(g)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,a,d){s.asyncAll(this.actors,(_,g)=>{_.send(n,a,g)},d=d||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}function pi(c,n,a){return n*(s.EXTENT/(c.tileSize*Math.pow(2,a-c.tileID.overscaledZ)))}Bt.Actor=s.Actor;class Ci{constructor(n,a,d,_){this.screenBounds=n,this.cameraPoint=a,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=d,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(n,a){let d,_;if(n instanceof s.pointGeometry||typeof n[0]=="number"){const g=s.pointGeometry.convert(n);d=[s.pointGeometry.convert(n)],_=a.isPointAboveHorizon(g)}else{const g=s.pointGeometry.convert(n[0]),w=s.pointGeometry.convert(n[1]);d=[g,w],_=s.polygonizeBounds(g,w).every(E=>a.isPointAboveHorizon(E))}return new Ci(d,a.getCameraPoint(),_,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return s.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const a=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new s.pointGeometry(1,1)):this.screenBounds[1],_=s.polygonizeBounds(a,d,0,!1);return this.cameraPoint.y>d.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<d.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=d.x?_[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(_[3]=this.cameraPoint)),s.bufferConvexPolygon(_,n)}bufferedCameraGeometryGlobe(n){const a=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new s.pointGeometry(1,1)):this.screenBounds[1],_=s.polygonizeBounds(a,d,n),g=this.cameraPoint.clone();switch(3*((g.y>a.y)+(g.y>d.y))+((g.x>a.x)+(g.x>d.x))){case 0:_[0]=g,_[4]=g.clone();break;case 1:_.splice(1,0,g);break;case 2:_[1]=g;break;case 3:_.splice(4,0,g);break;case 5:_.splice(2,0,g);break;case 6:_[3]=g;break;case 7:_.splice(3,0,g);break;case 8:_[2]=g}return _}containsTile(n,a,d,_=0){const g=n.queryPadding/a._pixelsPerMercatorPixel+1,w=d?this._bufferedCameraMercator(g,a):this._bufferedScreenMercator(g,a);let E=n.tileID.wrap+(w.unwrapped?_:0);const C=w.polygon.map(X=>s.getTilePoint(n.tileTransform,X,E));if(!s.polygonIntersectsBox(C,0,0,s.EXTENT,s.EXTENT))return;E=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);const k=this.screenGeometryMercator.polygon.map(X=>s.getTileVec3(n.tileTransform,X,E)),z=k.map(X=>new s.pointGeometry(X[0],X[1])),R=a.getFreeCameraOptions().position||new s.MercatorCoordinate(0,0,0),j=s.getTileVec3(n.tileTransform,R,E),K=k.map(X=>{const G=s.sub(X,X,j);return s.normalize(G,G),new s.Ray(j,G)}),W=pi(n,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:K,bufferedTilespaceGeometry:C,bufferedTilespaceBounds:(H=s.getBounds(C),H.min.x=s.clamp(H.min.x,0,s.EXTENT),H.min.y=s.clamp(H.min.y,0,s.EXTENT),H.max.x=s.clamp(H.max.x,0,s.EXTENT),H.max.y=s.clamp(H.max.y,0,s.EXTENT),H),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:W};var H}_bufferedScreenMercator(n,a){const d=Jt(n);if(this._screenRaycastCache[d])return this._screenRaycastCache[d];{let _;return _=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),a):{polygon:this.bufferedScreenGeometry(n).map(g=>a.pointCoordinate3D(g)),unwrapped:!0},this._screenRaycastCache[d]=_,_}}_bufferedCameraMercator(n,a){const d=Jt(n);if(this._cameraRaycastCache[d])return this._cameraRaycastCache[d];{let _;return _=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),a):{polygon:this.bufferedCameraGeometry(n).map(g=>a.pointCoordinate3D(g)),unwrapped:!0},this._cameraRaycastCache[d]=_,_}}_projectAndResample(n,a){const d=function(g,w){const E=s.multiply([],w.pixelMatrix,w.globeMatrix),C=[0,-s.GLOBE_RADIUS,0,1],k=[0,s.GLOBE_RADIUS,0,1],z=[0,0,0,1];s.transformMat4$1(C,C,E),s.transformMat4$1(k,k,E),s.transformMat4$1(z,z,E);const R=new s.pointGeometry(C[0]/C[3],C[1]/C[3]),j=new s.pointGeometry(k[0]/k[3],k[1]/k[3]),K=s.polygonContainsPoint(g,R)&&C[3]<z[3],W=s.polygonContainsPoint(g,j)&&k[3]<z[3];if(!K&&!W)return null;const H=function(pe,ue,be){for(let Be=1;Be<pe.length;Be++){const dt=Yt(ue.pointCoordinate3D(pe[Be-1]).x),Ie=Yt(ue.pointCoordinate3D(pe[Be]).x);if(be<0){if(dt<Ie)return{idx:Be,t:-dt/(Ie-1-dt)}}else if(Ie<dt)return{idx:Be,t:(1-dt)/(Ie+1-dt)}}return null}(g,w,K?-1:1);if(!H)return null;const{idx:X,t:G}=H;let te=X>1?Kt(g.slice(0,X),w):[],Y=X<g.length?Kt(g.slice(X),w):[];te=te.map(pe=>new s.pointGeometry(Yt(pe.x),pe.y)),Y=Y.map(pe=>new s.pointGeometry(Yt(pe.x),pe.y));const me=[...te];me.length===0&&me.push(Y[Y.length-1]);const fe=s.number(me[me.length-1].y,(Y.length===0?te[0]:Y[0]).y,G);let oe;return oe=K?[new s.pointGeometry(0,fe),new s.pointGeometry(0,0),new s.pointGeometry(1,0),new s.pointGeometry(1,fe)]:[new s.pointGeometry(1,fe),new s.pointGeometry(1,1),new s.pointGeometry(0,1),new s.pointGeometry(0,fe)],me.push(...oe),Y.length===0?me.push(te[0]):me.push(...Y),{polygon:me.map(pe=>new s.MercatorCoordinate(pe.x,pe.y)),unwrapped:!1}}(n,a);if(d)return d;const _=function(g,w){let E=!1,C=-1/0,k=0;for(let R=0;R<g.length-1;R++)g[R].x>C&&(C=g[R].x,k=R);for(let R=0;R<g.length-1;R++){const j=(k+R)%(g.length-1),K=g[j],W=g[j+1];Math.abs(K.x-W.x)>.5&&(K.x<W.x?(K.x+=1,j===0&&(g[g.length-1].x+=1)):(W.x+=1,j+1===g.length-1&&(g[0].x+=1)),E=!0)}const z=s.mercatorXfromLng(w.center.lng);return E&&z<Math.abs(z-1)&&g.forEach(R=>{R.x-=1}),{polygon:g,unwrapped:E}}(Kt(n,a).map(g=>new s.pointGeometry(Yt(g.x),g.y)),a);return{polygon:_.polygon.map(g=>new s.MercatorCoordinate(g.x,g.y)),unwrapped:_.unwrapped}}}function Kt(c,n){return s.resample(c,a=>{const d=n.pointCoordinate3D(a);a.x=d.x,a.y=d.y},1/256)}function Yt(c){return c<0?1+c%1:c%1}function Jt(c){return 100*c|0}function Et(c,n,a,d,_){const g=function(w,E){if(w)return _(w);if(E){const C=s.pick(s.extend(E,c),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);E.vector_layers&&(C.vectorLayers=E.vector_layers,C.vectorLayerIds=C.vectorLayers.map(k=>k.id)),E.language_options&&(C.languageOptions=E.language_options),E.language&&E.language[E.id]&&(C.language=E.language[E.id]),E.worldview_options&&(C.worldviewOptions=E.worldview_options),E.worldview?C.worldview=E.worldview[E.id]:E.worldview_default&&(C.worldview=E.worldview_default),C.tiles=n.canonicalizeTileset(C,c.url),_(null,C)}};return c.url?s.getJSON(n.transformRequest(n.normalizeSourceURL(c.url,null,a,d),s.ResourceType.Source),g):s.exported.frame(()=>g(null,c))}class Ri{constructor(n,a,d){this.bounds=s.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=a||0,this.maxzoom=d||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const a=Math.pow(2,n.z),d=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*a),_=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*a),g=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*a),w=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*a);return n.x>=d&&n.x<g&&n.y>=_&&n.y<w}}class Tn{constructor(n,a,d){this.context=n;const _=n.gl;this.buffer=_.createBuffer(),this.dynamicDraw=Boolean(d),this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const de={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ce{constructor(n,a,d,_){this.length=a.length,this.attributes=d,this.itemSize=a.bytesPerElement,this.dynamicDraw=_,this.context=n;const g=n.gl;this.buffer=g.createBuffer(),n.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,a){for(let d=0;d<this.attributes.length;d++){const _=a.attributes[this.attributes[d].name];_!==void 0&&n.enableVertexAttribArray(_)}}setVertexAttribPointers(n,a,d){for(let _=0;_<this.attributes.length;_++){const g=this.attributes[_],w=a.attributes[g.name];w!==void 0&&n.vertexAttribPointer(w,g.components,n[de[g.type]],!1,this.itemSize,g.offset+this.itemSize*(d||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Re{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ct extends Re{getDefault(){return s.Color.transparent}set(n){const a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class ut extends Re{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class bt extends Re{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Mt extends Re{getDefault(){return[!0,!0,!0,!0]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class gt extends Re{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Xe extends Re{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class ht extends Re{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const a=this.current;(n.func!==a.func||n.ref!==a.ref||n.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class qt extends Re{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Nt extends Re{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=n,this.dirty=!1}}class Zt extends Re{getDefault(){return[0,1]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class ti extends Re{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=n,this.dirty=!1}}class mi extends Re{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class Di extends Re{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.BLEND):a.disable(a.BLEND),this.current=n,this.dirty=!1}}class si extends Re{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class Ai extends Re{getDefault(){return s.Color.transparent}set(n){const a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class hn extends Re{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class gr extends Re{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=n,this.dirty=!1}}class Cn extends Re{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class zn extends Re{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}class qr extends Re{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}}class gn extends Re{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class Pn extends Re{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Pr extends Re{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class Ao extends Re{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Yo extends Re{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Es extends Re{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class pa extends Re{getDefault(){return null}set(n){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Dr extends Re{constructor(n){super(n),this.vao=n.extVertexArrayObject}getDefault(){return null}set(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)}}class Lr extends Re{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class io extends Re{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class no extends Re{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class An extends Re{constructor(n,a){super(n),this.context=n,this.parent=a}getDefault(){return null}}class Er extends An{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Q extends An{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class B extends Q{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class V{constructor(n,a,d,_){this.context=n,this.width=a,this.height=d;const g=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new Er(n,g),_&&(this.depthAttachment=new Q(n,g))}destroy(){const n=this.context.gl,a=this.colorAttachment.get();if(a&&n.deleteTexture(a),this.depthAttachment){const d=this.depthAttachment.get();d&&n.deleteRenderbuffer(d)}n.deleteFramebuffer(this.framebuffer)}}class J{constructor(n){this.gl=n,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ct(this),this.clearDepth=new ut(this),this.clearStencil=new bt(this),this.colorMask=new Mt(this),this.depthMask=new gt(this),this.stencilMask=new Xe(this),this.stencilFunc=new ht(this),this.stencilOp=new qt(this),this.stencilTest=new Nt(this),this.depthRange=new Zt(this),this.depthTest=new ti(this),this.depthFunc=new mi(this),this.blend=new Di(this),this.blendFunc=new si(this),this.blendColor=new Ai(this),this.blendEquation=new hn(this),this.cullFace=new gr(this),this.cullFaceSide=new Cn(this),this.frontFace=new zn(this),this.program=new qr(this),this.activeTexture=new gn(this),this.viewport=new Pn(this),this.bindFramebuffer=new Pr(this),this.bindRenderbuffer=new Ao(this),this.bindTexture=new Yo(this),this.bindVertexBuffer=new Es(this),this.bindElementBuffer=new pa(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Dr(this),this.pixelStoreUnpack=new Lr(this),this.pixelStoreUnpackPremultiplyAlpha=new io(this),this.pixelStoreUnpackFlipY=new no(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extTextureHalfFloat=n.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(n.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=n.getExtension("OES_standard_derivatives"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,a){return new Tn(this,n,a)}createVertexBuffer(n,a,d){return new Ce(this,n,a,d)}createRenderbuffer(n,a,d){const _=this.gl,g=_.createRenderbuffer();return this.bindRenderbuffer.set(g),_.renderbufferStorage(_.RENDERBUFFER,n,a,d),this.bindRenderbuffer.set(null),g}createFramebuffer(n,a,d){return new V(this,n,a,d)}clear({color:n,depth:a,stencil:d}){const _=this.gl;let g=0;n&&(g|=_.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(g|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),d!==void 0&&(g|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),_.clear(g)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){D(n.blendFunction,s.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ne extends s.Evented{constructor(n,a,d,_){super(),this.id=n,this.dispatcher=d,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},a),s.extend(this,s.pick(a,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Et(this._options,this.map._requestManager,null,null,(n,a)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new s.ErrorEvent(n)):a&&(s.extend(this,a),a.bounds&&(this.tileBounds=new Ri(a.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(a.tiles),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return s.extend({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,a){const d=s.exported.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),d,this.tileSize);n.request=s.getImage(this.map._requestManager.transformRequest(_,s.ResourceType.Tile),(g,w,E,C)=>(delete n.request,n.aborted?(n.state="unloaded",a(null)):g?(n.state="errored",a(g)):w?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:E,expires:C}),n.setTexture(w,this.map.painter),n.state="loaded",s.cacheEntryPossiblyAdded(this.dispatcher),void a(null)):a(null)))}static loadTileData(n,a,d){n.setTexture(a,d)}static unloadTileData(n,a){n.texture&&a.saveTileTexture(n.texture)}abortTile(n,a){n.request&&(n.request.cancel(),delete n.request),a()}unloadTile(n,a){n.texture&&this.map.painter.saveTileTexture(n.texture),a()}hasTransition(){return!1}}let ge;function ke(c,n,a,d,_,g,w,E){const C=[c,a,_,n,d,g,1,1,1],k=[w,E,1],z=s.adjoint([],C),[R,j,K]=s.transformMat3(k,k,s.transpose(z,z));return s.multiply$1(C,[R,0,0,0,j,0,0,0,K],C)}class Ae extends s.Evented{constructor(n,a,d,_){super(),this.id=n,this.dispatcher=d,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=a}load(n,a){this._loaded=a||!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),(d,_)=>{if(this._loaded=!0,d)this.fire(new s.ErrorEvent(d));else if(_){const{HTMLImageElement:g}=s.window;this.image=_ instanceof g?s.exported.getImageData(_):_,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading()}})}loaded(){return this._loaded}updateImage(n){return this.image&&n.url?(this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(n){this.coordinates=n,this._boundsArray=void 0;const a=n.map(s.MercatorCoordinate.fromLngLat);return this.tileID=function(d){let _=1/0,g=1/0,w=-1/0,E=-1/0;for(const R of d)_=Math.min(_,R.x),g=Math.min(g,R.y),w=Math.max(w,R.x),E=Math.max(E,R.y);const C=Math.max(w-_,E-g),k=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),z=Math.pow(2,k);return new s.CanonicalTileID(k,Math.floor((_+w)/2*z),Math.floor((g+E)/2*z))}(a),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(n){for(const C in this.tiles){const k=this.tiles[C];k.state!=="loaded"&&(k.state="loaded",k.texture=this.texture)}if(this._boundsArray)return;const a=s.tileTransform(this.tileID,this.map.transform.projection),[d,_,g,w]=this.coordinates.map(C=>{const k=a.projection.project(C[0],C[1]);return s.getTilePoint(a,k)._round()});this.perspectiveTransform=function(C,k,z,R,j,K,W,H,X,G){const te=ke(0,0,C,0,0,k,C,k),Y=ke(z,R,j,K,W,H,X,G);return s.multiply$1(Y,s.adjoint(te,te),Y),[Y[6]/Y[8]*C/s.EXTENT,Y[7]/Y[8]*k/s.EXTENT]}(this.width,this.height,d.x,d.y,_.x,_.y,w.x,w.y,g.x,g.y);const E=this._boundsArray=new s.StructArrayLayout4i8;E.emplaceBack(d.x,d.y,0,0),E.emplaceBack(_.x,_.y,s.EXTENT,0),E.emplaceBack(w.x,w.y,0,s.EXTENT),E.emplaceBack(g.x,g.y,s.EXTENT,s.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=n.createVertexBuffer(E,s.boundsAttributes.members),this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const n=this.map.painter.context,a=n.gl;this.texture?this.texture.update(this.image):(this.texture=new s.Texture(n,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._prepareData(n)}loadTile(n,a){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},a(null)):(n.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ye={vector:class extends s.Evented{constructor(c,n,a,d){if(super(),this.id=c,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(n,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d),this._tileWorkers={},this._deduped=new s.DedupedRequest}load(c){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"}));const n=this.language||this.map._language,a=this.worldview||this.map._worldview;this._tileJSONRequest=Et(this._options,this.map._requestManager,n,a,(d,_)=>{this._tileJSONRequest=null,this._loaded=!0,d?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code. Found: ${n}`),a&&a.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new s.ErrorEvent(d))):_&&(s.extend(this,_),_.bounds&&(this.tileBounds=new Ri(_.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(_.tiles,this.map._requestManager._customAccessToken),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(d)})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}setSourceProperty(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.load(()=>{const n=this.map.style._getSourceCaches(this.id);for(const a of n)a.clearTiles()})}setTiles(c){return this.setSourceProperty(()=>{this._options.tiles=c}),this}setUrl(c){return this.setSourceProperty(()=>{this.url=c,this._options.url=c}),this}_setLanguage(c){return c===this.language||this.setSourceProperty(()=>{this.language=c}),this}_setWorldview(c){return c===this.worldview?this:this.worldviewOptions&&c&&!this.worldviewOptions[c]?(console.warn(`Vector tile source "${this.id}" does not support worldview "${c}".`),this):(this.setSourceProperty(()=>{this.worldview=c}),this)}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return s.extend({},this._options)}loadTile(c,n){const a=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(a,s.ResourceType.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:c.isSymbolTile};if(d.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired")c.state==="loading"?c.reloadCallback=n:c.request=c.actor.send("reloadTile",d,_.bind(this));else if(c.actor=this._tileWorkers[a]=this._tileWorkers[a]||this.dispatcher.getActor(),this.dispatcher.ready)c.request=c.actor.send("loadTile",d,_.bind(this),void 0,!0);else{const g=s.loadVectorTile.call({deduped:this._deduped},d,(w,E)=>{w||!E?_.call(this,w):(d.data={cacheControl:E.cacheControl,expires:E.expires,rawData:E.rawData.slice(0)},c.actor&&c.actor.send("loadTile",d,_.bind(this),void 0,!0))},!0);c.request={cancel:g}}function _(g,w){return delete c.request,c.aborted?n(null):g&&g.status!==404?n(g):(w&&w.resourceTiming&&(c.resourceTiming=w.resourceTiming),this.map._refreshExpiredTiles&&w&&c.setExpiryData(w),c.loadVectorData(w,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id})}unloadTile(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:ne,"raster-dem":class extends ne{constructor(c,n,a,d){super(c,n,a,d),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(c,n){const a=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function d(_,g){_&&(c.state="errored",n(_)),g&&(c.dem=g,c.dem.onDeserialize(),c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0,c.state="loaded",n(null))}c.request=s.getImage(this.map._requestManager.transformRequest(a,s.ResourceType.Tile),function(_,g,w,E){if(delete c.request,c.aborted)c.state="unloaded",n(null);else if(_)c.state="errored",n(_);else if(g){this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:w,expires:E});const C=s.window.ImageBitmap&&g instanceof s.window.ImageBitmap&&(ge==null&&(ge=s.window.OffscreenCanvas&&new s.window.OffscreenCanvas(1,1).getContext("2d")&&typeof s.window.createImageBitmap=="function"),ge),k=1-(g.width-s.prevPowerOfTwo(g.width))/2;k<1||c.neighboringTiles||(c.neighboringTiles=this._getNeighboringTiles(c.tileID));const z=C?g:s.exported.getImageData(g,k),R={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:z,encoding:this.encoding,padding:k};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",R,d.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(c){const n=c.canonical,a=Math.pow(2,n.z),d=(n.x-1+a)%a,_=n.x===0?c.wrap-1:c.wrap,g=(n.x+1+a)%a,w=n.x+1===a?c.wrap+1:c.wrap,E={};return E[new s.OverscaledTileID(c.overscaledZ,_,n.z,d,n.y).key]={backfilled:!1},E[new s.OverscaledTileID(c.overscaledZ,w,n.z,g,n.y).key]={backfilled:!1},n.y>0&&(E[new s.OverscaledTileID(c.overscaledZ,_,n.z,d,n.y-1).key]={backfilled:!1},E[new s.OverscaledTileID(c.overscaledZ,c.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},E[new s.OverscaledTileID(c.overscaledZ,w,n.z,g,n.y-1).key]={backfilled:!1}),n.y+1<a&&(E[new s.OverscaledTileID(c.overscaledZ,_,n.z,d,n.y+1).key]={backfilled:!1},E[new s.OverscaledTileID(c.overscaledZ,c.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},E[new s.OverscaledTileID(c.overscaledZ,w,n.z,g,n.y+1).key]={backfilled:!1}),E}unloadTile(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded"}},geojson:class extends s.Evented{constructor(c,n,a,d){super(),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(d),this._data=n.data,this._options=s.extend({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const _=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*_,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*_,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:s.EXTENT,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*_,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(c){this.map=c,this.setData(this._data)}setData(c){return this._data=c,this._updateWorkerData(),this}getClusterExpansionZoom(c,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},n),this}getClusterChildren(c,n){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},n),this}getClusterLeaves(c,n,a,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:n,offset:a},d),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.Event("dataloading",{dataType:"source"})),this._loaded=!1;const c=s.extend({},this.workerOptions),n=this._data;typeof n=="string"?(c.request=this.map._requestManager.transformRequest(s.exported.resolveURL(n),s.ResourceType.Source),c.request.collectResourceTiming=this._collectResourceTiming):c.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,c,(a,d)=>{if(this._loaded=!0,this._pendingLoad=null,a)this.fire(new s.ErrorEvent(a));else{const _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&d&&d.resourceTiming&&d.resourceTiming[this.id]&&(_.resourceTiming=d.resourceTiming[this.id]),this.fire(new s.Event("data",_)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(c,n){const a=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(a,{type:this.type,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(d,_)=>(delete c.request,c.unloadVectorData(),c.aborted?n(null):d?n(d):(c.loadVectorData(_,this.map.painter,a==="reloadTile"),n(null))),void 0,a==="loadTile")}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0}unloadTile(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Ae{constructor(c,n,a,d){super(c,n,a,d),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const c=this.options;this.urls=[];for(const n of c.urls)this.urls.push(this.map._requestManager.transformRequest(n,s.ResourceType.Source).url);s.getVideo(this.urls,(n,a)=>{this._loaded=!0,n?this.fire(new s.ErrorEvent(n)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(c){if(this.video){const n=this.video.seekable;c<n.start(0)||c>n.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=c}}getVideo(){return this.video}onAdd(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const c=this.map.painter.context,n=c.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new s.Texture(c,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(c)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Ae,canvas:class extends Ae{constructor(c,n,a,d){super(c,n,a,d),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(g=>typeof g!="number"))||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${c}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${c}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${c}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof s.window.HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${c}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${c}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof s.window.HTMLCanvasElement?this.options.canvas:s.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.Texture(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const c of[this.canvas.width,this.canvas.height])if(isNaN(c)||c<=0)return!0;return!1}},custom:class extends s.Evented{constructor(c,n,a,d){super(),this.id=c,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=n,this.setEventedParent(d),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ri(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.coveringTiles=this._coveringTiles.bind(this),s.extend(this,s.pick(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(c){this._map=c,this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(c),this.load()}onRemove(c){this._implementation.onRemove&&this._implementation.onRemove(c)}hasTile(c){if(this._implementation.hasTile){const{x:n,y:a,z:d}=c.canonical;return this._implementation.hasTile({x:n,y:a,z:d})}return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,n){const{x:a,y:d,z:_}=c.tileID.canonical,g=new s.window.AbortController,w=this._implementation.loadTile({x:a,y:d,z:_},{signal:g.signal});if(!w)return this.loadTileData(c,{width:this.tileSize,height:this.tileSize,data:null}),c.state="loaded",n(null);w.cancel=()=>g.abort(),c.request=w.then(function(E){return delete c.request,c.aborted?(c.state="unloaded",n(null)):E?function(C){return C instanceof s.window.ImageData||C instanceof s.window.ImageBitmap||C instanceof s.window.HTMLCanvasElement}(E)?(this.loadTileData(c,E),c.state="loaded",void n(null)):(c.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(c,{width:this.tileSize,height:this.tileSize,data:null}),c.state="loaded",n(null))}.bind(this)).catch(E=>{E.code!==20&&(c.state="errored",n(E))})}loadTileData(c,n){ne.loadTileData(c,n,this._map.painter)}unloadTileData(c){ne.unloadTileData(c,this._map.painter)}prepareTile(c){if(!this._implementation.prepareTile)return null;const{x:n,y:a,z:d}=c.tileID.canonical,_=this._implementation.prepareTile({x:n,y:a,z:d});return _?(this.loadTileData(c,_),c.state="loaded",_):null}unloadTile(c,n){if(this.unloadTileData(c),this._implementation.unloadTile){const{x:a,y:d,z:_}=c.tileID.canonical;this._implementation.unloadTile({x:a,y:d,z:_})}n()}abortTile(c,n){c.request&&c.request.cancel&&(c.request.cancel(),delete c.request),n()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(c=>({x:c.canonical.x,y:c.canonical.y,z:c.canonical.z}))}_update(){this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}}},ze=function(c,n,a,d){const _=new ye[n.type](c,n,a,d);if(_.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${_.id}`);return s.bindAll(["load","abort","unload","serialize","prepare"],_),_};function Qe(c,n){const a=s.identity([]);return s.scale(a,a,[.5*c.width,.5*-c.height,1]),s.translate(a,a,[1,-1,0]),s.multiply(a,a,c.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(a)}function Ct(c,n,a,d,_,g,w,E=!1){const C=c.tilesIn(d,w,E);C.sort($t);const k=[];for(const R of C)k.push({wrappedTileID:R.tile.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(n,a,c._state,R,_,g,Qe(c.transform,R.tile.tileID),E)});const z=function(R){const j={},K={};for(const W of R){const H=W.queryResults,X=W.wrappedTileID,G=K[X]=K[X]||{};for(const te in H){const Y=H[te],me=G[te]=G[te]||{},fe=j[te]=j[te]||[];for(const oe of Y)me[oe.featureIndex]||(me[oe.featureIndex]=!0,fe.push(oe))}}return j}(k);for(const R in z)z[R].forEach(j=>{const K=j.feature,W=K.layer;W&&W.type!=="background"&&W.type!=="sky"&&(K.source=W.source,W["source-layer"]&&(K.sourceLayer=W["source-layer"]),K.state=K.id!==void 0?c.getFeatureState(W["source-layer"],K.id):{})});return z}function st(c,n){const a=c.getRenderableIds().map(g=>c.getTileByID(g)),d=[],_={};for(let g=0;g<a.length;g++){const w=a[g],E=w.tileID.canonical.key;_[E]||(_[E]=!0,w.querySourceFeatures(d,n))}return d}function $t(c,n){const a=c.tileID,d=n.tileID;return a.overscaledZ-d.overscaledZ||a.canonical.y-d.canonical.y||a.wrap-d.wrap||a.canonical.x-d.canonical.x}function Xt(){return qa.workerClass!=null?new qa.workerClass:new s.window.Worker(qa.workerUrl)}const jt="mapboxgl_preloaded_worker_pool";class Qt{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<Qt.workerCount;)this.workers.push(new Xt);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[jt]}numActive(){return Object.keys(this.active).length}}let ci;function Li(){return ci||(ci=new Qt),ci}function he(c,n){const a={};for(const d in c)d!=="ref"&&(a[d]=c[d]);return s.refProperties.forEach(d=>{d in n&&(a[d]=n[d])}),a}function vt(c){c=c.slice();const n=Object.create(null);for(let a=0;a<c.length;a++)n[c[a].id]=c[a];for(let a=0;a<c.length;a++)"ref"in c[a]&&(c[a]=he(c[a],n[c[a].ref]));return c}Qt.workerCount=2;const Ze={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Me(c,n,a){a.push({command:Ze.addSource,args:[c,n[c]]})}function Ti(c,n,a){n.push({command:Ze.removeSource,args:[c]}),a[c]=!0}function ni(c,n,a,d){Ti(c,a,d),Me(c,n,a)}function Gi(c,n,a){let d;for(d in c[a])if(c[a].hasOwnProperty(d)&&d!=="data"&&!D(c[a][d],n[a][d]))return!1;for(d in n[a])if(n[a].hasOwnProperty(d)&&d!=="data"&&!D(c[a][d],n[a][d]))return!1;return!0}function Mn(c,n,a,d,_,g){let w;for(w in n=n||{},c=c||{})c.hasOwnProperty(w)&&(D(c[w],n[w])||a.push({command:g,args:[d,w,n[w],_]}));for(w in n)n.hasOwnProperty(w)&&!c.hasOwnProperty(w)&&(D(c[w],n[w])||a.push({command:g,args:[d,w,n[w],_]}))}function Jn(c){return c.id}function yl(c,n){return c[n.id]=n,c}class Pp{constructor(n,a){this.reset(n,a)}reset(n,a){this.points=n||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=s.clamp(n,0,1);let a=1,d=this._distances[a];const _=n*this.paddedLength+this.padding;for(;d<_&&a<this._distances.length;)d=this._distances[++a];const g=a-1,w=this._distances[g],E=d-w,C=E>0?(_-w)/E:0;return this.points[g].mult(1-C).add(this.points[a].mult(C))}}class Ss{constructor(n,a,d){const _=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(n/d),this.yCellCount=Math.ceil(a/d);for(let w=0;w<this.xCellCount*this.yCellCount;w++)_.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=a,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,a,d,_,g){this._forEachCell(a,d,_,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(a),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(g)}insertCircle(n,a,d,_){this._forEachCell(a-_,d-_,a+_,d+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(a),this.circles.push(d),this.circles.push(_)}_insertBoxCell(n,a,d,_,g,w){this.boxCells[g].push(w)}_insertCircleCell(n,a,d,_,g,w){this.circleCells[g].push(w)}_query(n,a,d,_,g,w){if(d<0||n>this.width||_<0||a>this.height)return!g&&[];const E=[];if(n<=0&&a<=0&&this.width<=d&&this.height<=_){if(g)return!0;for(let C=0;C<this.boxKeys.length;C++)E.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const k=this.circles[3*C],z=this.circles[3*C+1],R=this.circles[3*C+2];E.push({key:this.circleKeys[C],x1:k-R,y1:z-R,x2:k+R,y2:z+R})}return w?E.filter(w):E}return this._forEachCell(n,a,d,_,this._queryCell,E,{hitTest:g,seenUids:{box:{},circle:{}}},w),g?E.length>0:E}_queryCircle(n,a,d,_,g){const w=n-d,E=n+d,C=a-d,k=a+d;if(E<0||w>this.width||k<0||C>this.height)return!_&&[];const z=[];return this._forEachCell(w,C,E,k,this._queryCellCircle,z,{hitTest:_,circle:{x:n,y:a,radius:d},seenUids:{box:{},circle:{}}},g),_?z.length>0:z}query(n,a,d,_,g){return this._query(n,a,d,_,!1,g)}hitTest(n,a,d,_,g){return this._query(n,a,d,_,!0,g)}hitTestCircle(n,a,d,_){return this._queryCircle(n,a,d,!0,_)}_queryCell(n,a,d,_,g,w,E,C){const k=E.seenUids,z=this.boxCells[g];if(z!==null){const j=this.bboxes;for(const K of z)if(!k.box[K]){k.box[K]=!0;const W=4*K;if(n<=j[W+2]&&a<=j[W+3]&&d>=j[W+0]&&_>=j[W+1]&&(!C||C(this.boxKeys[K]))){if(E.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[K],x1:j[W],y1:j[W+1],x2:j[W+2],y2:j[W+3]})}}}const R=this.circleCells[g];if(R!==null){const j=this.circles;for(const K of R)if(!k.circle[K]){k.circle[K]=!0;const W=3*K;if(this._circleAndRectCollide(j[W],j[W+1],j[W+2],n,a,d,_)&&(!C||C(this.circleKeys[K]))){if(E.hitTest)return w.push(!0),!0;{const H=j[W],X=j[W+1],G=j[W+2];w.push({key:this.circleKeys[K],x1:H-G,y1:X-G,x2:H+G,y2:X+G})}}}}}_queryCellCircle(n,a,d,_,g,w,E,C){const k=E.circle,z=E.seenUids,R=this.boxCells[g];if(R!==null){const K=this.bboxes;for(const W of R)if(!z.box[W]){z.box[W]=!0;const H=4*W;if(this._circleAndRectCollide(k.x,k.y,k.radius,K[H+0],K[H+1],K[H+2],K[H+3])&&(!C||C(this.boxKeys[W])))return w.push(!0),!0}}const j=this.circleCells[g];if(j!==null){const K=this.circles;for(const W of j)if(!z.circle[W]){z.circle[W]=!0;const H=3*W;if(this._circlesCollide(K[H],K[H+1],K[H+2],k.x,k.y,k.radius)&&(!C||C(this.circleKeys[W])))return w.push(!0),!0}}}_forEachCell(n,a,d,_,g,w,E,C){const k=this._convertToXCellCoord(n),z=this._convertToYCellCoord(a),R=this._convertToXCellCoord(d),j=this._convertToYCellCoord(_);for(let K=k;K<=R;K++)for(let W=z;W<=j;W++)if(g.call(this,n,a,d,_,this.xCellCount*W+K,w,E,C))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,a,d,_,g,w){const E=_-n,C=g-a,k=d+w;return k*k>E*E+C*C}_circleAndRectCollide(n,a,d,_,g,w,E){const C=(w-_)/2,k=Math.abs(n-(_+C));if(k>C+d)return!1;const z=(E-g)/2,R=Math.abs(a-(g+z));if(R>z+d)return!1;if(k<=C||R<=z)return!0;const j=k-C,K=R-z;return j*j+K*K<=d*d}}const zt=Math.tan(85*Math.PI/180);function yi(c,n,a,d,_,g,w){const E=s.create();if(a)if(g.name==="globe"){const C=s.calculateGlobeLabelMatrix(_,n);s.multiply(E,E,C)}else{const C=Ke([],w);E[0]=C[0],E[1]=C[1],E[4]=C[2],E[5]=C[3],d||s.rotateZ(E,E,_.angle)}else s.multiply(E,_.labelPlaneMatrix,c);return E}function vi(c,n,a,d,_,g,w){const E=yi(c,n,a,d,_,g,w);return g.name==="globe"&&a||(E[2]=E[6]=E[10]=E[14]=0),E}function Br(c,n,a,d,_,g,w){if(a){if(g.name==="globe"){const E=yi(c,n,a,d,_,g,w);return s.invert(E,E),s.multiply(E,c,E),E}{const E=s.clone(c),C=s.identity([]);return C[0]=w[0],C[1]=w[1],C[4]=w[2],C[5]=w[3],s.multiply(E,E,C),d||s.rotateZ(E,E,-_.angle),E}}return _.glCoordMatrix}function Rr(c,n,a=0){const d=[c.x,c.y,a,1];a?s.transformMat4$1(d,d,n):Qn(d,d,n);const _=d[3];return{point:[d[0]/_,d[1]/_,d[2]/_],signedDistanceFromCamera:_}}function ui(c,n){const a=[c[0],c[1],c[2],1];s.transformMat4$1(a,a,n);const d=a[3];return{point:[a[0]/d,a[1]/d,a[2]/d],signedDistanceFromCamera:d}}function ma(c,n){return Math.min(.5+c/n*.5,1.5)}function _a(c,n){const a=c[0]/c[3],d=c[1]/c[3];return a>=-n[0]&&a<=n[0]&&d>=-n[1]&&d<=n[1]}function ga(c,n,a,d,_,g,w,E,C,k){const z=a.transform,R=d?c.textSizeData:c.iconSizeData,j=s.evaluateSizeForZoom(R,a.transform.zoom),K=z.projection.name==="globe",W=[256/a.width*2+1,256/a.height*2+1],H=d?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;H.clear();let X=null;K&&(X=d?c.text.globeExtVertexArray:c.icon.globeExtVertexArray);const G=c.lineVertexArray,te=d?c.text.placedSymbolArray:c.icon.placedSymbolArray,Y=a.transform.width/a.transform.height;let me=!1;for(let fe=0;fe<te.length;fe++){const oe=te.get(fe);if(oe.writingMode!==s.WritingMode.vertical||me||fe!==0&&te.get(fe-1).writingMode===s.WritingMode.horizontal||(me=!0),(oe.hidden||oe.writingMode===s.WritingMode.vertical)&&!me){Io(oe.numGlyphs,H);continue}me=!1;const pe=new s.pointGeometry(oe.tileAnchorX,oe.tileAnchorY),ue=C?C(pe):[0,0,0],be=z.projection.projectTilePoint(pe.x,pe.y,k.canonical),Be=[be.x+ue[0],be.y+ue[1],be.z+ue[2]],dt=[...Be,1];if(s.transformMat4$1(dt,dt,n),!_a(dt,W)){Io(oe.numGlyphs,H);continue}const Ie=ma(a.transform.cameraToCenterDistance,dt[3]),Je=s.evaluateSizeForFeature(R,j,oe),rt=w?Je/Ie:Je*Ie,wt=Rr(new s.pointGeometry(Be[0],Be[1]),_,Be[2]);if(wt.signedDistanceFromCamera<=0){Io(oe.numGlyphs,H);continue}let qe={};const mt=w?null:C,it=Jh(oe,rt,!1,E,n,_,g,c.glyphOffsetArray,G,H,X,wt.point,pe,qe,Y,mt,z.projection,k,w);me=it.useVertical,mt&&it.needsFlipping&&(qe={}),(it.notEnoughRoom||me||it.needsFlipping&&Jh(oe,rt,!0,E,n,_,g,c.glyphOffsetArray,G,H,X,wt.point,pe,qe,Y,mt,z.projection,k,w).notEnoughRoom)&&Io(oe.numGlyphs,H)}d?(c.text.dynamicLayoutVertexBuffer.updateData(H),X&&c.text.globeExtVertexBuffer.updateData(X)):(c.icon.dynamicLayoutVertexBuffer.updateData(H),X&&c.icon.globeExtVertexBuffer.updateData(X))}function yr(c,n,a,d,_,g,w,E,C,k,z,R,j,K,W,H){const X=E.glyphStartIndex+E.numGlyphs,G=E.lineStartIndex,te=E.lineStartIndex+E.lineLength,Y=n.getoffsetX(E.glyphStartIndex),me=n.getoffsetX(X-1),fe=Mo(c*Y,a,d,_,g,w,E.segment,G,te,C,k,z,R,j,!0,K,W,H);if(!fe)return null;const oe=Mo(c*me,a,d,_,g,w,E.segment,G,te,C,k,z,R,j,!0,K,W,H);return oe?{first:fe,last:oe}:null}function an(c,n,a,d){return c.writingMode===s.WritingMode.horizontal&&Math.abs(a.y-n.y)>Math.abs(a.x-n.x)*d?{useVertical:!0}:c.writingMode===s.WritingMode.vertical?n.y<a.y?{needsFlipping:!0}:null:c.flipState!==0&&function(_,g,w){const E=(g.x-_.x)*w;return E===0||Math.abs((g.y-_.y)/E)>zt}(n,a,d)?c.flipState===1?{needsFlipping:!0}:null:n.x>a.x?{needsFlipping:!0}:null}function Jh(c,n,a,d,_,g,w,E,C,k,z,R,j,K,W,H,X,G,te){const Y=n/24,me=c.lineOffsetX*Y,fe=c.lineOffsetY*Y;let oe;if(c.numGlyphs>1){const pe=c.glyphStartIndex+c.numGlyphs,ue=c.lineStartIndex,be=c.lineStartIndex+c.lineLength,Be=yr(Y,E,me,fe,a,R,j,c,C,g,K,H,!1,X,G,te);if(!Be)return{notEnoughRoom:!0};const dt=ui(Be.first.point,w).point,Ie=ui(Be.last.point,w).point,Je=new s.pointGeometry(dt[0],dt[1]),rt=new s.pointGeometry(Ie[0],Ie[1]);if(d&&!a){const wt=an(c,Je,rt,W);if(c.flipState=wt&&wt.needsFlipping?1:2,wt)return wt}oe=[Be.first];for(let wt=c.glyphStartIndex+1;wt<pe-1;wt++)oe.push(Mo(Y*E.getoffsetX(wt),me,fe,a,R,j,c.segment,ue,be,C,g,K,H,!1,!1,X,G,te));oe.push(Be.last)}else{if(d&&!a){const ue=Rr(j,_).point,be=c.lineStartIndex+c.segment+1,Be=new s.pointGeometry(C.getx(be),C.gety(be)),dt=Rr(Be,_),Ie=dt.signedDistanceFromCamera>0?dt.point:vl(j,Be,ue,1,_,void 0,X,G.canonical),Je=an(c,new s.pointGeometry(ue[0],ue[1]),new s.pointGeometry(Ie[0],Ie[1]),W);if(c.flipState=Je&&Je.needsFlipping?1:2,Je)return Je}const pe=Mo(Y*E.getoffsetX(c.glyphStartIndex),me,fe,a,R,j,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,C,g,K,H,!1,!1,X,G,te);if(!pe)return{notEnoughRoom:!0};oe=[pe]}if(z)for(const pe of oe)s.updateGlobeVertexNormal(z,k.length+0,pe.up[0],pe.up[1],pe.up[2]),s.updateGlobeVertexNormal(z,k.length+1,pe.up[0],pe.up[1],pe.up[2]),s.updateGlobeVertexNormal(z,k.length+2,pe.up[0],pe.up[1],pe.up[2]),s.updateGlobeVertexNormal(z,k.length+3,pe.up[0],pe.up[1],pe.up[2]),s.addDynamicAttributes(k,pe.point[0],pe.point[1],pe.point[2],pe.angle);else for(const pe of oe)s.addDynamicAttributes(k,pe.point[0],pe.point[1],pe.point[2],pe.angle);return{}}function Cs(c,n,a,d,_){const g=d.projectTilePoint(c.x,c.y,n);if(!_)return Rr(g,a,g.z);const w=_(c);return Rr(new s.pointGeometry(g.x+w[0],g.y+w[1]),a,g.z+w[2])}function vl(c,n,a,d,_,g,w,E){const C=Cs(c.add(c.sub(n)._unit()),E,_,w,g).point,k=s.sub([],a,C);return s.scaleAndAdd([],a,k,d/s.length(k))}function Mo(c,n,a,d,_,g,w,E,C,k,z,R,j,K,W,H,X,G){const te=d?c-n:c+n;let Y=te>0?1:-1,me=0;d&&(Y*=-1,me=Math.PI),Y<0&&(me+=Math.PI);let fe=Y>0?E+w:E+w+1,oe=_,pe=_,ue=0,be=0;const Be=Math.abs(te),dt=[],Ie=[];let Je=g;const rt=()=>{const Ut=fe-Y;return ue===0?g:new s.pointGeometry(k.getx(Ut),k.gety(Ut))},wt=()=>vl(rt(),Je,pe,Be-ue+1,z,j,H,X.canonical);for(;ue+be<=Be;){if(fe+=Y,fe<E||fe>=C)return null;if(pe=oe,dt.push(oe),K&&Ie.push(Je||rt()),oe=R[fe],oe===void 0){Je=new s.pointGeometry(k.getx(fe),k.gety(fe));const Ut=Cs(Je,X.canonical,z,H,j);oe=Ut.signedDistanceFromCamera>0?R[fe]=Ut.point:wt()}else Je=null;ue+=be,be=s.distance(pe,oe)}Je=Je||new s.pointGeometry(k.getx(fe),k.gety(fe));const qe=rt();W&&j&&(R[fe]=oe=R[fe]===void 0?oe:wt(),be=s.distance(pe,oe));const mt=(Be-ue)/be,it=Je.sub(qe).mult(mt)._add(qe),It=s.sub([],oe,pe),St=s.scaleAndAdd([],pe,It,mt);let Vt=[0,0,1],Wt=It[0],ii=It[1];if(G&&(Vt=H.upVector(X.canonical,it.x,it.y),Vt[0]!==0||Vt[1]!==0||Vt[2]!==1)){const Ut=[1,0,0],ai=[0,1,0];Ut[0]=Vt[2],Ut[1]=0,Ut[2]=-Vt[0],s.cross(ai,Vt,Ut),s.normalize(Ut,Ut),s.normalize(ai,ai),Wt=s.dot(It,Ut),ii=s.dot(It,ai)}if(a){const Ut=s.cross([],Vt,It);s.normalize(Ut,Ut),s.scaleAndAdd(St,St,Ut,a*Y)}const bi=me+Math.atan2(ii,Wt);return dt.push(St),K&&Ie.push(it),{point:St,angle:bi,path:dt,tilePath:Ie,up:Vt}}const $c=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Io(c,n){for(let a=0;a<c;a++){const d=n.length;n.resize(d+4),n.float32.set($c,4*d)}}function Qn(c,n,a){const d=n[0],_=n[1];return c[0]=a[0]*d+a[4]*_+a[12],c[1]=a[1]*d+a[5]*_+a[13],c[3]=a[3]*d+a[7]*_+a[15],c}const ji=100;class Gc{constructor(n,a,d=new Ss(n.width+200,n.height+200,25),_=new Ss(n.width+200,n.height+200,25)){this.transform=n,this.grid=d,this.ignoredGrid=_,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+ji,this.screenBottomBoundary=n.height+ji,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=a}placeCollisionBox(n,a,d,_,g,w,E,C){let k=d.projectedAnchorX,z=d.projectedAnchorY,R=d.projectedAnchorZ;const j=d.elevation,K=d.tileID;if(j&&K){const fe=n.getProjection().upVector(K.canonical,d.tileAnchorX,d.tileAnchorY),oe=n.getProjection().upVectorScale(K.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;k+=fe[0]*j*oe,z+=fe[1]*j*oe,R+=fe[2]*j*oe}const W=this.projectAndGetPerspectiveRatio(E,[k,z,R],d.tileID,n.projection.name==="globe"||!!j||this.transform.pitch>0,n.getProjection()),H=w*W.perspectiveRatio,X=(d.x1*a+_.x-d.padding)*H+W.point.x,G=(d.y1*a+_.y-d.padding)*H+W.point.y,te=(d.x2*a+_.x+d.padding)*H+W.point.x,Y=(d.y2*a+_.y+d.padding)*H+W.point.y,me=W.perspectiveRatio<=.55||W.occluded;return!this.isInsideGrid(X,G,te,Y)||!g&&this.grid.hitTest(X,G,te,Y,C)||me?{box:[],offscreen:!1,occluded:W.occluded}:{box:[X,G,te,Y],offscreen:this.isOffscreen(X,G,te,Y),occluded:!1}}placeCollisionCircles(n,a,d,_,g,w,E,C,k,z,R,j,K,W,H){const X=[],G=this.transform.elevation,te=G?G.getAtTileOffsetFunc(H,this.transform.center.lat,this.transform.worldSize,n.getProjection()):qe=>[0,0,0],Y=new s.pointGeometry(d.tileAnchorX,d.tileAnchorY),me=n.getProjection().projectTilePoint(d.tileAnchorX,d.tileAnchorY,H.canonical),fe=te(Y),oe=[me.x+fe[0],me.y+fe[1],me.z+fe[2]],pe=n.projection.name==="globe",ue=this.projectAndGetPerspectiveRatio(E,[oe[0],oe[1],oe[2]],H,pe||!!G||this.transform.pitch>0,n.getProjection()),{perspectiveRatio:be}=ue,Be=(R?w/be:w*be)/s.ONE_EM,dt=Rr(new s.pointGeometry(oe[0],oe[1]),C,oe[2]).point,Ie=ue.signedDistanceFromCamera>0?yr(Be,g,d.lineOffsetX*Be,d.lineOffsetY*Be,!1,dt,Y,d,_,C,{},G&&!R?te:null,R&&!!G,n.getProjection(),H,R):null;let Je=!1,rt=!1,wt=!0;if(Ie&&!ue.occluded){const qe=.5*K*be+W,mt=new s.pointGeometry(-100,-100),it=new s.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),It=new Pp,St=Ie.first,Vt=Ie.last;let Wt=[];for(let Ut=St.path.length-1;Ut>=1;Ut--)Wt.push(St.path[Ut]);for(let Ut=1;Ut<Vt.path.length;Ut++)Wt.push(Vt.path[Ut]);const ii=2.5*qe;if(k){const Ut=Wt.map(G&&!pe?(ai,Ii)=>{const en=te(Ii<St.path.length-1?St.tilePath[St.path.length-1-Ii]:Vt.tilePath[Ii-St.path.length+2]);return ai[2]=en[2],ui(ai,k)}:ai=>ui(ai,k));Wt=Ut.some(ai=>ai.signedDistanceFromCamera<=0)?[]:Ut.map(ai=>ai.point)}let bi=[];if(Wt.length>0){const Ut=Wt.map(qi=>new s.pointGeometry(qi[0],qi[1]));let ai=1/0,Ii=-1/0,en=1/0,dn=-1/0;for(let qi=0;qi<Ut.length;qi++)ai=Math.min(ai,Ut[qi].x),en=Math.min(en,Ut[qi].y),Ii=Math.max(Ii,Ut[qi].x),dn=Math.max(dn,Ut[qi].y);bi=ai>=mt.x&&Ii<=it.x&&en>=mt.y&&dn<=it.y?[Ut]:Ii<mt.x||ai>it.x||dn<mt.y||en>it.y?[]:s.clipLine([Ut],mt.x,mt.y,it.x,it.y)}for(const Ut of bi){It.reset(Ut,.25*qe);let ai=0;ai=It.length<=.5*qe?1:Math.ceil(It.paddedLength/ii)+1;for(let Ii=0;Ii<ai;Ii++){const en=Ii/Math.max(ai-1,1),dn=It.lerp(en),qi=dn.x+ji,Fn=dn.y+ji;X.push(qi,Fn,qe,0);const Vr=qi-qe,ao=Fn-qe,tn=qi+qe,rn=Fn+qe;if(wt=wt&&this.isOffscreen(Vr,ao,tn,rn),rt=rt||this.isInsideGrid(Vr,ao,tn,rn),!a&&this.grid.hitTestCircle(qi,Fn,qe,j)&&(Je=!0,!z))return{circles:[],offscreen:!1,collisionDetected:Je,occluded:!1}}}}return{circles:!z&&Je||!rt?[]:X,offscreen:wt,collisionDetected:Je,occluded:ue.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let d=1/0,_=1/0,g=-1/0,w=-1/0;for(const z of n){const R=new s.pointGeometry(z.x+ji,z.y+ji);d=Math.min(d,R.x),_=Math.min(_,R.y),g=Math.max(g,R.x),w=Math.max(w,R.y),a.push(R)}const E=this.grid.query(d,_,g,w).concat(this.ignoredGrid.query(d,_,g,w)),C={},k={};for(const z of E){const R=z.key;if(C[R.bucketInstanceId]===void 0&&(C[R.bucketInstanceId]={}),C[R.bucketInstanceId][R.featureIndex])continue;const j=[new s.pointGeometry(z.x1,z.y1),new s.pointGeometry(z.x2,z.y1),new s.pointGeometry(z.x2,z.y2),new s.pointGeometry(z.x1,z.y2)];s.polygonIntersectsPolygon(a,j)&&(C[R.bucketInstanceId][R.featureIndex]=!0,k[R.bucketInstanceId]===void 0&&(k[R.bucketInstanceId]=[]),k[R.bucketInstanceId].push(R.featureIndex))}return k}insertCollisionBox(n,a,d,_,g){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:_,collisionGroupID:g},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,a,d,_,g){const w=a?this.ignoredGrid:this.grid,E={bucketInstanceId:d,featureIndex:_,collisionGroupID:g};for(let C=0;C<n.length;C+=4)w.insertCircle(E,n[C],n[C+1],n[C+2])}projectAndGetPerspectiveRatio(n,a,d,_,g){const w=[a[0],a[1],a[2],1];let E=!1;if(a[2]||this.transform.pitch>0){s.transformMat4$1(w,w,n);const C=g.name==="globe";this.fogState&&d&&!C&&(E=function(k,z,R,j,K,W){const H=W.calculateFogTileMatrix(K),X=[z,R,j];return s.transformMat4(X,X,H),At(k,X,W.pitch,W._fov)}(this.fogState,a[0],a[1],a[2],d.toUnwrapped(),this.transform)>.9)}else Qn(w,w,n);return{point:new s.pointGeometry((w[0]/w[3]+1)/2*this.transform.width+ji,(-w[1]/w[3]+1)/2*this.transform.height+ji),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(g)/w[3]*.5,1.5),signedDistanceFromCamera:w[3],occluded:_&&w[2]>w[3]||E}}isOffscreen(n,a,d,_){return d<ji||n>=this.screenRightBoundary||_<ji||a>this.screenBottomBoundary}isInsideGrid(n,a,d,_){return d>=0&&n<this.gridRightBoundary&&_>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const n=s.identity([]);return s.translate(n,n,[-100,-100,0]),n}}function ya(c,n,a){const d=n.createTileMatrix(c,c.worldSize,a.toUnwrapped());return s.multiply(new Float32Array(16),c.projMatrix,d)}function lr(c,n,a){if(n.projection.name===a.projection.name)return c.projMatrix;const d=a.clone();return d.setProjection(n.projection),ya(d,n.getProjection(),c)}function cr(c,n,a){return n.name===a.projection.name?c.projMatrix:ya(a,n,c)}class Zc{constructor(n,a,d,_){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?a:-a))):_&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class ko{constructor(n,a,d,_,g,w=!1){this.text=new Zc(n?n.text:null,a,d,g),this.icon=new Zc(n?n.icon:null,a,_,g),this.clipped=w}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class yn{constructor(n,a,d,_=!1){this.text=n,this.icon=a,this.skipFade=d,this.clipped=_}}class va{constructor(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]}}class Wc{constructor(n,a,d,_,g){this.bucketInstanceId=n,this.featureIndex=a,this.sourceLayerIndex=d,this.bucketIndex=_,this.tileID=g}}class xa{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const a=++this.maxGroupID;this.collisionGroups[n]={ID:a,predicate:d=>d.collisionGroupID===a}}return this.collisionGroups[n]}}function Ln(c,n,a,d,_){const{horizontalAlign:g,verticalAlign:w}=s.getAnchorAlignment(c),E=-(g-.5)*n,C=-(w-.5)*a,k=s.evaluateVariableOffset(c,d);return new s.pointGeometry(E+k[0]*_,C+k[1]*_)}function ba(c,n,a,d,_){const g=new s.pointGeometry(c,n);return a&&g._rotate(d?_:-_),g}class Hc{constructor(n,a,d,_,g){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new Gc(this.transform,g),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new xa(d),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,a,d,_){const g=d.getBucket(a),w=d.latestFeatureIndex;if(!g||!w||a.id!==g.layerIds[0])return;const E=g.layers[0].layout,C=d.collisionBoxArray,k=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),z=d.tileSize/s.EXTENT,R=d.tileID.toUnwrapped();this.transform.setProjection(g.projection);const j=(K=d.tileID,W=g.getProjection(),H=this.transform,W.name===this.projection?H.calculateProjMatrix(K.toUnwrapped()):ya(H,W,K));var K,W,H;const X=E.get("text-pitch-alignment")==="map",G=E.get("text-rotation-alignment")==="map";a.compileFilter();const te=a.dynamicFilter(),Y=a.dynamicFilterNeedsFeature(),me=this.transform.calculatePixelsToTileUnitsMatrix(d),fe=vi(j,d.tileID.canonical,X,G,this.transform,g.getProjection(),me);let oe=null;if(X){const be=Br(j,d.tileID.canonical,X,G,this.transform,g.getProjection(),me);oe=s.multiply([],this.transform.labelPlaneMatrix,be)}let pe=null;te&&d.latestFeatureIndex&&(pe={unwrappedTileID:R,dynamicFilter:te,dynamicFilterNeedsFeature:Y,featureIndex:d.latestFeatureIndex}),this.retainedQueryData[g.bucketInstanceId]=new Wc(g.bucketInstanceId,w,g.sourceLayerIndex,g.index,d.tileID);const ue={bucket:g,layout:E,posMatrix:j,textLabelPlaneMatrix:fe,labelToScreenMatrix:oe,clippingData:pe,scale:k,textPixelRatio:z,holdingForFade:d.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(g.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.evaluateSizeForZoom(g.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(_)for(const be of g.sortKeyRanges){const{sortKey:Be,symbolInstanceStart:dt,symbolInstanceEnd:Ie}=be;n.push({sortKey:Be,symbolInstanceStart:dt,symbolInstanceEnd:Ie,parameters:ue})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:ue})}attemptAnchorPlacement(n,a,d,_,g,w,E,C,k,z,R,j,K,W,H,X,G,te){const Y=[j.textOffset0,j.textOffset1],me=Ln(n,d,_,Y,g),fe=this.collisionIndex.placeCollisionBox(W,g,a,ba(me.x,me.y,w,E,this.transform.angle),R,C,k,z.predicate);if((!X||this.collisionIndex.placeCollisionBox(W,W.getSymbolInstanceIconSize(te,this.transform.zoom,K),X,ba(me.x,me.y,w,E,this.transform.angle),R,C,k,z.predicate).box.length!==0)&&fe.box.length>0){let oe;return this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(oe=this.prevPlacement.variableOffsets[j.crossTileID].anchor),this.variableOffsets[j.crossTileID]={textOffset:Y,width:d,height:_,anchor:n,textScale:g,prevAnchor:oe},this.markUsedJustification(W,n,j,H),W.allowVerticalPlacement&&(this.markUsedOrientation(W,H,j),this.placedOrientations[j.crossTileID]=H),{shift:me,placedGlyphBoxes:fe}}}placeLayerBucketPart(n,a,d,_){const{bucket:g,layout:w,posMatrix:E,textLabelPlaneMatrix:C,labelToScreenMatrix:k,clippingData:z,textPixelRatio:R,holdingForFade:j,collisionBoxArray:K,partiallyEvaluatedTextSize:W,partiallyEvaluatedIconSize:H,collisionGroup:X}=n.parameters,G=w.get("text-optional"),te=w.get("icon-optional"),Y=w.get("text-allow-overlap"),me=w.get("icon-allow-overlap"),fe=w.get("text-rotation-alignment")==="map",oe=w.get("text-pitch-alignment")==="map",pe=w.get("icon-text-fit")!=="none",ue=w.get("symbol-z-order")==="viewport-y";this.transform.setProjection(g.projection);let be=Y&&(me||!g.hasIconData()||te),Be=me&&(Y||!g.hasTextData()||G);!g.collisionArrays&&K&&g.deserializeCollisionBoxes(K),d&&_&&g.updateCollisionDebugBuffers(this.transform.zoom,K);const dt=(Ie,Je,rt)=>{if(z){const tn={zoom:this.transform.zoom,pitch:this.transform.pitch};let rn=null;if(z.dynamicFilterNeedsFeature){const _i=this.retainedQueryData[g.bucketInstanceId];rn=z.featureIndex.loadFeature({featureIndex:Ie.featureIndex,bucketIndex:_i.bucketIndex,sourceLayerIndex:_i.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,z.dynamicFilter)(tn,rn,this.retainedQueryData[g.bucketInstanceId].tileID.canonical,new s.pointGeometry(Ie.tileAnchorX,Ie.tileAnchorY),this.transform.calculateDistanceTileData(z.unwrappedTileID)))return this.placements[Ie.crossTileID]=new yn(!1,!1,!1,!0),void(a[Ie.crossTileID]=!0)}if(a[Ie.crossTileID])return;if(j)return void(this.placements[Ie.crossTileID]=new yn(!1,!1,!1));let wt=!1,qe=!1,mt=!0,it=!1,It=!1,St=null,Vt={box:null,offscreen:null,occluded:null},Wt={box:null,offscreen:null,occluded:null},ii=null,bi=null,Ut=null,ai=0,Ii=0,en=0;rt.textFeatureIndex?ai=rt.textFeatureIndex:Ie.useRuntimeCollisionCircles&&(ai=Ie.featureIndex),rt.verticalTextFeatureIndex&&(Ii=rt.verticalTextFeatureIndex);const dn=tn=>{tn.tileID=this.retainedQueryData[g.bucketInstanceId].tileID,(this.transform.elevation||tn.elevation)&&(tn.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[g.bucketInstanceId].tileID,tn.tileAnchorX,tn.tileAnchorY):0)},qi=rt.textBox;if(qi){dn(qi);const tn=_i=>{let En=s.WritingMode.horizontal;if(g.allowVerticalPlacement&&!_i&&this.prevPlacement){const Zn=this.prevPlacement.placedOrientations[Ie.crossTileID];Zn&&(this.placedOrientations[Ie.crossTileID]=Zn,En=Zn,this.markUsedOrientation(g,En,Ie))}return En},rn=(_i,En)=>{if(g.allowVerticalPlacement&&Ie.numVerticalGlyphVertices>0&&rt.verticalTextBox){for(const Zn of g.writingModes)if(Zn===s.WritingMode.vertical?(Vt=En(),Wt=Vt):Vt=_i(),Vt&&Vt.box&&Vt.box.length)break}else Vt=_i()};if(w.get("text-variable-anchor")){let _i=w.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ie.crossTileID]){const Xi=this.prevPlacement.variableOffsets[Ie.crossTileID];_i.indexOf(Xi.anchor)>0&&(_i=_i.filter(Wn=>Wn!==Xi.anchor),_i.unshift(Xi.anchor))}const En=(Xi,Wn,is)=>{const er=g.getSymbolInstanceTextSize(W,Ie,this.transform.zoom,Je),ns=(Xi.x2-Xi.x1)*er+2*Xi.padding,rs=(Xi.y2-Xi.y1)*er+2*Xi.padding,os=pe&&!me?Wn:null;os&&dn(os);let tr={box:[],offscreen:!1,occluded:!1};const ss=Y?2*_i.length:_i.length;for(let Bo=0;Bo<ss;++Bo){const $a=this.attemptAnchorPlacement(_i[Bo%_i.length],Xi,ns,rs,er,fe,oe,R,E,X,Bo>=_i.length,Ie,Je,g,is,os,W,H);if($a&&(tr=$a.placedGlyphBoxes,tr&&tr.box&&tr.box.length)){wt=!0,St=$a.shift;break}}return tr};rn(()=>En(qi,rt.iconBox,s.WritingMode.horizontal),()=>{const Xi=rt.verticalTextBox;return Xi&&dn(Xi),g.allowVerticalPlacement&&!(Vt&&Vt.box&&Vt.box.length)&&Ie.numVerticalGlyphVertices>0&&Xi?En(Xi,rt.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Vt&&(wt=Vt.box,mt=Vt.offscreen,it=Vt.occluded);const Zn=tn(Vt&&Vt.box);if(!wt&&this.prevPlacement){const Xi=this.prevPlacement.variableOffsets[Ie.crossTileID];Xi&&(this.variableOffsets[Ie.crossTileID]=Xi,this.markUsedJustification(g,Xi.anchor,Ie,Zn))}}else{const _i=(En,Zn)=>{const Xi=g.getSymbolInstanceTextSize(W,Ie,this.transform.zoom,Je),Wn=this.collisionIndex.placeCollisionBox(g,Xi,En,new s.pointGeometry(0,0),Y,R,E,X.predicate);return Wn&&Wn.box&&Wn.box.length&&(this.markUsedOrientation(g,Zn,Ie),this.placedOrientations[Ie.crossTileID]=Zn),Wn};rn(()=>_i(qi,s.WritingMode.horizontal),()=>{const En=rt.verticalTextBox;return g.allowVerticalPlacement&&Ie.numVerticalGlyphVertices>0&&En?(dn(En),_i(En,s.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),tn(Vt&&Vt.box&&Vt.box.length)}}if(ii=Vt,wt=ii&&ii.box&&ii.box.length>0,mt=ii&&ii.offscreen,it=ii&&ii.occluded,Ie.useRuntimeCollisionCircles){const tn=g.text.placedSymbolArray.get(Ie.centerJustifiedTextSymbolIndex>=0?Ie.centerJustifiedTextSymbolIndex:Ie.verticalPlacedTextSymbolIndex),rn=s.evaluateSizeForFeature(g.textSizeData,W,tn),_i=w.get("text-padding");bi=this.collisionIndex.placeCollisionCircles(g,Y,tn,g.lineVertexArray,g.glyphOffsetArray,rn,E,C,k,d,oe,X.predicate,Ie.collisionCircleDiameter*rn/s.ONE_EM,_i,this.retainedQueryData[g.bucketInstanceId].tileID),wt=Y||bi.circles.length>0&&!bi.collisionDetected,mt=mt&&bi.offscreen,it=bi.occluded}if(rt.iconFeatureIndex&&(en=rt.iconFeatureIndex),rt.iconBox){const tn=rn=>{dn(rn);const _i=pe&&St?ba(St.x,St.y,fe,oe,this.transform.angle):new s.pointGeometry(0,0),En=g.getSymbolInstanceIconSize(H,this.transform.zoom,Je);return this.collisionIndex.placeCollisionBox(g,En,rn,_i,me,R,E,X.predicate)};Wt&&Wt.box&&Wt.box.length&&rt.verticalIconBox?(Ut=tn(rt.verticalIconBox),qe=Ut.box.length>0):(Ut=tn(rt.iconBox),qe=Ut.box.length>0),mt=mt&&Ut.offscreen,It=Ut.occluded}const Fn=G||Ie.numHorizontalGlyphVertices===0&&Ie.numVerticalGlyphVertices===0,Vr=te||Ie.numIconVertices===0;if(Fn||Vr?Vr?Fn||(qe=qe&&wt):wt=qe&&wt:qe=wt=qe&&wt,wt&&ii&&ii.box&&this.collisionIndex.insertCollisionBox(ii.box,w.get("text-ignore-placement"),g.bucketInstanceId,Wt&&Wt.box&&Ii?Ii:ai,X.ID),qe&&Ut&&this.collisionIndex.insertCollisionBox(Ut.box,w.get("icon-ignore-placement"),g.bucketInstanceId,en,X.ID),bi&&(wt&&this.collisionIndex.insertCollisionCircles(bi.circles,w.get("text-ignore-placement"),g.bucketInstanceId,ai,X.ID),d)){const tn=g.bucketInstanceId;let rn=this.collisionCircleArrays[tn];rn===void 0&&(rn=this.collisionCircleArrays[tn]=new va);for(let _i=0;_i<bi.circles.length;_i+=4)rn.circles.push(bi.circles[_i+0]),rn.circles.push(bi.circles[_i+1]),rn.circles.push(bi.circles[_i+2]),rn.circles.push(bi.collisionDetected?1:0)}const ao=g.projection.name!=="globe";be=be&&(ao||!it),Be=Be&&(ao||!It),this.placements[Ie.crossTileID]=new yn(wt||be,qe||Be,mt||g.justReloaded),a[Ie.crossTileID]=!0};if(ue){const Ie=g.getSortedSymbolIndexes(this.transform.angle);for(let Je=Ie.length-1;Je>=0;--Je){const rt=Ie[Je];dt(g.symbolInstances.get(rt),rt,g.collisionArrays[rt])}}else for(let Ie=n.symbolInstanceStart;Ie<n.symbolInstanceEnd;Ie++)dt(g.symbolInstances.get(Ie),Ie,g.collisionArrays[Ie]);if(d&&g.bucketInstanceId in this.collisionCircleArrays){const Ie=this.collisionCircleArrays[g.bucketInstanceId];s.invert(Ie.invProjMatrix,E),Ie.viewportMatrix=this.collisionIndex.getViewportMatrix()}g.justReloaded=!1}markUsedJustification(n,a,d,_){let g;g=_===s.WritingMode.vertical?d.verticalPlacedTextSymbolIndex:{left:d.leftJustifiedTextSymbolIndex,center:d.centerJustifiedTextSymbolIndex,right:d.rightJustifiedTextSymbolIndex}[s.getAnchorJustification(a)];const w=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex,d.verticalPlacedTextSymbolIndex];for(const E of w)E>=0&&(n.text.placedSymbolArray.get(E).crossTileID=g>=0&&E!==g?0:d.crossTileID)}markUsedOrientation(n,a,d){const _=a===s.WritingMode.horizontal||a===s.WritingMode.horizontalOnly?a:0,g=a===s.WritingMode.vertical?a:0,w=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex];for(const E of w)n.text.placedSymbolArray.get(E).placedOrientation=_;d.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(d.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let d=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const _=a?a.symbolFadeChange(n):1,g=a?a.opacities:{},w=a?a.variableOffsets:{},E=a?a.placedOrientations:{};for(const C in this.placements){const k=this.placements[C],z=g[C];z?(this.opacities[C]=new ko(z,_,k.text,k.icon,null,k.clipped),d=d||k.text!==z.text.placed||k.icon!==z.icon.placed):(this.opacities[C]=new ko(null,_,k.text,k.icon,k.skipFade,k.clipped),d=d||k.text||k.icon)}for(const C in g){const k=g[C];if(!this.opacities[C]){const z=new ko(k,_,!1,!1);z.isHidden()||(this.opacities[C]=z,d=d||k.text.placed||k.icon.placed)}}for(const C in w)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=w[C]);for(const C in E)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=E[C]);d?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:n)}updateLayerOpacities(n,a){const d={};for(const _ of a){const g=_.getBucket(n);g&&_.latestFeatureIndex&&n.id===g.layerIds[0]&&this.updateBucketOpacities(g,d,_.collisionBoxArray)}}updateBucketOpacities(n,a,d){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const _=n.layers[0].layout,g=!!n.layers[0].dynamicFilter(),w=new ko(null,0,!1,!1,!0),E=_.get("text-allow-overlap"),C=_.get("icon-allow-overlap"),k=_.get("text-variable-anchor"),z=_.get("text-rotation-alignment")==="map",R=_.get("text-pitch-alignment")==="map",j=_.get("icon-text-fit")!=="none",K=new ko(null,0,E&&(C||!n.hasIconData()||_.get("icon-optional")),C&&(E||!n.hasTextData()||_.get("text-optional")),!0);!n.collisionArrays&&d&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(d);const W=(X,G,te)=>{for(let Y=0;Y<G/4;Y++)X.opacityVertexArray.emplaceBack(te)};let H=0;for(let X=0;X<n.symbolInstances.length;X++){const G=n.symbolInstances.get(X),{numHorizontalGlyphVertices:te,numVerticalGlyphVertices:Y,crossTileID:me}=G;let fe=this.opacities[me];a[me]?fe=w:fe||(fe=K,this.opacities[me]=fe),a[me]=!0;const oe=te>0||Y>0,pe=G.numIconVertices>0,ue=this.placedOrientations[G.crossTileID],be=ue===s.WritingMode.vertical,Be=ue===s.WritingMode.horizontal||ue===s.WritingMode.horizontalOnly;if(!oe&&!pe||fe.isHidden()||H++,oe){const dt=Jo(fe.text);W(n.text,te,be?Or:dt),W(n.text,Y,Be?Or:dt);const Ie=fe.text.isHidden();[G.rightJustifiedTextSymbolIndex,G.centerJustifiedTextSymbolIndex,G.leftJustifiedTextSymbolIndex].forEach(wt=>{wt>=0&&(n.text.placedSymbolArray.get(wt).hidden=Ie||be?1:0)}),G.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(G.verticalPlacedTextSymbolIndex).hidden=Ie||Be?1:0);const Je=this.variableOffsets[G.crossTileID];Je&&this.markUsedJustification(n,Je.anchor,G,ue);const rt=this.placedOrientations[G.crossTileID];rt&&(this.markUsedJustification(n,"left",G,rt),this.markUsedOrientation(n,rt,G))}if(pe){const dt=Jo(fe.icon);G.placedIconSymbolIndex>=0&&(W(n.icon,G.numIconVertices,be?Or:dt),n.icon.placedSymbolArray.get(G.placedIconSymbolIndex).hidden=fe.icon.isHidden()),G.verticalPlacedIconSymbolIndex>=0&&(W(n.icon,G.numVerticalIconVertices,Be?Or:dt),n.icon.placedSymbolArray.get(G.verticalPlacedIconSymbolIndex).hidden=fe.icon.isHidden())}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const dt=n.collisionArrays[X];if(dt){let Ie=new s.pointGeometry(0,0),Je=!0;if(dt.textBox||dt.verticalTextBox){if(k){const wt=this.variableOffsets[me];wt?(Ie=Ln(wt.anchor,wt.width,wt.height,wt.textOffset,wt.textScale),z&&Ie._rotate(R?this.transform.angle:-this.transform.angle)):Je=!1}g&&(Je=!fe.clipped),dt.textBox&&Sr(n.textCollisionBox.collisionVertexArray,fe.text.placed,!Je||be,Ie.x,Ie.y),dt.verticalTextBox&&Sr(n.textCollisionBox.collisionVertexArray,fe.text.placed,!Je||Be,Ie.x,Ie.y)}const rt=Je&&Boolean(!Be&&dt.verticalIconBox);dt.iconBox&&Sr(n.iconCollisionBox.collisionVertexArray,fe.icon.placed,rt,j?Ie.x:0,j?Ie.y:0),dt.verticalIconBox&&Sr(n.iconCollisionBox.collisionVertexArray,fe.icon.placed,!rt,j?Ie.x:0,j?Ie.y:0)}}}if(n.fullyClipped=H===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const X=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=X.invProjMatrix,n.placementViewportMatrix=X.viewportMatrix,n.collisionCircleArray=X.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,a){const d=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*d>n}setStale(){this.stale=!0}}function Sr(c,n,a,d,_){c.emplaceBack(n?1:0,a?1:0,d||0,_||0),c.emplaceBack(n?1:0,a?1:0,d||0,_||0),c.emplaceBack(n?1:0,a?1:0,d||0,_||0),c.emplaceBack(n?1:0,a?1:0,d||0,_||0)}const wa=Math.pow(2,25),xl=Math.pow(2,24),Dp=Math.pow(2,17),Xc=Math.pow(2,16),As=Math.pow(2,9),Lp=Math.pow(2,8),Qh=Math.pow(2,1);function Jo(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;const n=c.placed?1:0,a=Math.floor(127*c.opacity);return a*wa+n*xl+a*Dp+n*Xc+a*As+n*Lp+a*Qh+n}const Or=0;class bl{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(n,a,d,_,g){const w=this._bucketParts;for(;this._currentTileIndex<n.length;)if(a.getBucketParts(w,_,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((E,C)=>E.sortKey-C.sortKey));this._currentPartIndex<w.length;){const E=w[this._currentPartIndex];if(a.placeLayerBucketPart(E,this._seenCrossTileIDs,d,E.symbolInstanceStart===0),this._currentPartIndex++,g())return!0}return!1}}class zo{constructor(n,a,d,_,g,w,E,C){this.placement=new Hc(n,g,w,E,C),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(n,a,d){const _=s.exported.now(),g=()=>{const w=s.exported.now()-_;return!this._forceFullPlacement&&w>2};for(;this._currentPlacementIndex>=0;){const w=a[n[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=E)&&(!w.maxzoom||w.maxzoom>E)){if(this._inProgressLayer||(this._inProgressLayer=new bl(w)),this._inProgressLayer.continuePlacement(d[w.source],this.placement,this._showCollisionBoxes,w,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const Kc=512/s.EXTENT/2;class wl{constructor(n,a,d){this.tileID=n,this.indexedSymbolInstances={},this.bucketInstanceId=d;for(let _=0;_<a.length;_++){const g=a.get(_),w=g.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:g.crossTileID,coord:this.getScaledCoordinates(g,n)})}}getScaledCoordinates(n,a){const d=Kc/Math.pow(2,a.canonical.z-this.tileID.canonical.z);return{x:Math.floor((a.canonical.x*s.EXTENT+n.tileAnchorX)*d),y:Math.floor((a.canonical.y*s.EXTENT+n.tileAnchorY)*d)}}findMatches(n,a,d){const _=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let g=0;g<n.length;g++){const w=n.get(g);if(w.crossTileID)continue;const E=this.indexedSymbolInstances[w.key];if(!E)continue;const C=this.getScaledCoordinates(w,a);for(const k of E)if(Math.abs(k.coord.x-C.x)<=_&&Math.abs(k.coord.y-C.y)<=_&&!d[k.crossTileID]){d[k.crossTileID]=!0,w.crossTileID=k.crossTileID;break}}}}class Bp{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Rp{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const a=Math.round((n-this.lng)/360);if(a!==0)for(const d in this.indexes){const _=this.indexes[d],g={};for(const w in _){const E=_[w];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+a),g[E.tileID.key]=E}this.indexes[d]=g}this.lng=n}addBucket(n,a,d){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let g=0;g<a.symbolInstances.length;g++)a.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});const _=this.usedCrossTileIDs[n.overscaledZ];for(const g in this.indexes){const w=this.indexes[g];if(Number(g)>n.overscaledZ)for(const E in w){const C=w[E];C.tileID.isChildOf(n)&&C.findMatches(a.symbolInstances,n,_)}else{const E=w[n.scaledTo(Number(g)).key];E&&E.findMatches(a.symbolInstances,n,_)}}for(let g=0;g<a.symbolInstances.length;g++){const w=a.symbolInstances.get(g);w.crossTileID||(w.crossTileID=d.generate(),_[w.crossTileID]=!0)}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new wl(n,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(n,a){for(const d in a.indexedSymbolInstances)for(const _ of a.indexedSymbolInstances[d])delete this.usedCrossTileIDs[n][_.crossTileID]}removeStaleBuckets(n){let a=!1;for(const d in this.indexes){const _=this.indexes[d];for(const g in _)n[_[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,_[g]),delete _[g],a=!0)}return a}}class Tl{constructor(){this.layerIndexes={},this.crossTileIDs=new Bp,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,a,d,_){let g=this.layerIndexes[n.id];g===void 0&&(g=this.layerIndexes[n.id]=new Rp);let w=!1;const E={};_.name!=="globe"&&g.handleWrapJump(d);for(const C of a){const k=C.getBucket(n);k&&n.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(C.tileID,k,this.crossTileIDs)&&(w=!0),E[k.bucketInstanceId]=!0)}return g.removeStaleBuckets(E)&&(w=!0),w}pruneUnusedLayers(n){const a={};n.forEach(d=>{a[d]=!0});for(const d in this.layerIndexes)a[d]||delete this.layerIndexes[d]}}const El=(c,n)=>s.emitValidationErrors(c,n&&n.filter(a=>a.identifier!=="source.canvas")),ed=s.pick(Ze,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Op=s.pick(Ze,["setCenter","setZoom","setBearing","setPitch"]),td={version:8,layers:[],sources:{}},Fp={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Cr extends s.Evented{constructor(n,a={}){super(),this.map=n,this.dispatcher=new Bt(Li(),this),this.imageManager=new nt,this.imageManager.setEventedParent(this),this.glyphManager=new s.GlyphManager(n._requestManager,a.localFontFamily?s.LocalGlyphMode.all:a.localIdeographFontFamily?s.LocalGlyphMode.ideographs:s.LocalGlyphMode.none,a.localFontFamily||a.localIdeographFontFamily),this.lineAtlas=new s.LineAtlas(256,512),this.crossTileSymbolIndex=new Tl,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new s.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());const d=this;this._rtlTextPluginCallback=Cr.registerForPluginStateChange(_=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(g,w)=>{if(s.triggerPluginCompletionEvent(g),w&&w.every(E=>E))for(const E in d._sourceCaches){const C=d._sourceCaches[E],k=C.getSource().type;k!=="vector"&&k!=="geojson"||C.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const g=this.getSource(_.sourceId);if(g&&g.vectorLayerIds)for(const w in this._layers){const E=this._layers[w];E.source===g.id&&this._validateLayer(E)}})}loadURL(n,a={}){this.fire(new s.Event("dataloading",{dataType:"style"}));const d=typeof a.validate=="boolean"?a.validate:!s.isMapboxURL(n);n=this.map._requestManager.normalizeStyleURL(n,a.accessToken);const _=this.map._requestManager.transformRequest(n,s.ResourceType.Style);this._request=s.getJSON(_,(g,w)=>{this._request=null,g?this.fire(new s.ErrorEvent(g)):w&&this._load(w,d)})}loadJSON(n,a={}){this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.exported.frame(()=>{this._request=null,this._load(n,a.validate!==!1)})}loadEmpty(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(td,!1)}_updateLayerCount(n,a){const d=a?1:-1;n.is3D()&&(this._num3DLayers+=d),n.type==="circle"&&(this._numCircleLayers+=d),n.type==="symbol"&&(this._numSymbolLayers+=d)}_load(n,a){if(a&&El(this,s.validateStyle(n)))return;this._loaded=!0,this.stylesheet=s.clone$1(n),this._updateMapProjection();for(const _ in n.sources)this.addSource(_,n.sources[_],{validate:!1});this._changed=!1,n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(n.glyphs);const d=vt(this.stylesheet.layers);this._order=d.map(_=>_.id),this._layers={},this._serializedLayers={};for(let _ of d)_=s.createStyleLayer(_),_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ye(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(n){this._spriteRequest=function(a,d,_){let g,w,E;const C=s.exported.devicePixelRatio>1?"@2x":"";let k=s.getJSON(d.transformRequest(d.normalizeSpriteURL(a,C,".json"),s.ResourceType.SpriteJSON),(j,K)=>{k=null,E||(E=j,g=K,R())}),z=s.getImage(d.transformRequest(d.normalizeSpriteURL(a,C,".png"),s.ResourceType.SpriteImage),(j,K)=>{z=null,E||(E=j,w=K,R())});function R(){if(E)_(E);else if(g&&w){const j=s.exported.getImageData(w),K={};for(const W in g){const{width:H,height:X,x:G,y:te,sdf:Y,pixelRatio:me,stretchX:fe,stretchY:oe,content:pe}=g[W],ue=new s.RGBAImage({width:H,height:X});s.RGBAImage.copy(j,ue,{x:G,y:te},{x:0,y:0},{width:H,height:X}),K[W]={data:ue,pixelRatio:me,sdf:Y,stretchX:fe,stretchY:oe,content:pe}}_(null,K)}}return{cancel(){k&&(k.cancel(),k=null),z&&(z.cancel(),z=null)}}}(n,this.map._requestManager,(a,d)=>{if(this._spriteRequest=null,a)this.fire(new s.ErrorEvent(a));else if(d)for(const _ in d)this.imageManager.addImage(_,d[_]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new s.Event("data",{dataType:"style"}))})}_validateLayer(n){const a=this.getSource(n.source);if(!a)return;const d=n.sourceLayer;d&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(d)===-1)&&this.fire(new s.ErrorEvent(new Error(`Source layer "${d}" does not exist on source "${a.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(n){const a=[];for(const d of n){const _=this._layers[d];_.type!=="custom"&&a.push(_.serialize())}return a}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(n){return!!this.terrain&&Fp[n.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(n){if(!this._loaded)return;const a=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(_.length||g.length)&&this._updateWorkerLayers(_,g);for(const w in this._updatedSources){const E=this._updatedSources[w];E==="reload"?this._reloadSource(w):E==="clear"&&this._clearSource(w)}this._updateTilesForChangedImages();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(n);this.light.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._resetUpdates()}const d={};for(const _ in this._sourceCaches){const g=this._sourceCaches[_];d[_]=g.used,g.used=!1}for(const _ of this._order){const g=this._layers[_];if(g.recalculate(n,this._availableImages),!g.isHidden(n.zoom)){const E=this._getLayerSourceCache(g);E&&(E.used=!0)}const w=this.map.painter;if(w){const E=g.getProgramIds();if(!E)continue;const C=g.getProgramConfiguration(n.zoom);for(const k of E)w.useProgram(k,C)}}for(const _ in d){const g=this._sourceCaches[_];d[_]!==g.used&&g.getSource().fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:g.getSource().id}))}this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),a&&this.fire(new s.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const a in this._sourceCaches)this._sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateWorkerLayers(n,a){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(n){if(this._checkLoaded(),El(this,s.validateStyle(n)))return!1;(n=s.clone$1(n)).layers=vt(n.layers);const a=function(_,g){if(!_)return[{command:Ze.setStyle,args:[g]}];let w=[];try{if(!D(_.version,g.version))return[{command:Ze.setStyle,args:[g]}];D(_.center,g.center)||w.push({command:Ze.setCenter,args:[g.center]}),D(_.zoom,g.zoom)||w.push({command:Ze.setZoom,args:[g.zoom]}),D(_.bearing,g.bearing)||w.push({command:Ze.setBearing,args:[g.bearing]}),D(_.pitch,g.pitch)||w.push({command:Ze.setPitch,args:[g.pitch]}),D(_.sprite,g.sprite)||w.push({command:Ze.setSprite,args:[g.sprite]}),D(_.glyphs,g.glyphs)||w.push({command:Ze.setGlyphs,args:[g.glyphs]}),D(_.transition,g.transition)||w.push({command:Ze.setTransition,args:[g.transition]}),D(_.light,g.light)||w.push({command:Ze.setLight,args:[g.light]}),D(_.fog,g.fog)||w.push({command:Ze.setFog,args:[g.fog]}),D(_.projection,g.projection)||w.push({command:Ze.setProjection,args:[g.projection]});const E={},C=[];(function(R,j,K,W){let H;for(H in j=j||{},R=R||{})R.hasOwnProperty(H)&&(j.hasOwnProperty(H)||Ti(H,K,W));for(H in j)j.hasOwnProperty(H)&&(R.hasOwnProperty(H)?D(R[H],j[H])||(R[H].type==="geojson"&&j[H].type==="geojson"&&Gi(R,j,H)?K.push({command:Ze.setGeoJSONSourceData,args:[H,j[H].data]}):ni(H,j,K,W)):Me(H,j,K))})(_.sources,g.sources,C,E);const k=[];_.layers&&_.layers.forEach(R=>{R.source&&E[R.source]?w.push({command:Ze.removeLayer,args:[R.id]}):k.push(R)});let z=_.terrain;z&&E[z.source]&&(w.push({command:Ze.setTerrain,args:[void 0]}),z=void 0),w=w.concat(C),D(z,g.terrain)||w.push({command:Ze.setTerrain,args:[g.terrain]}),function(R,j,K){j=j||[];const W=(R=R||[]).map(Jn),H=j.map(Jn),X=R.reduce(yl,{}),G=j.reduce(yl,{}),te=W.slice(),Y=Object.create(null);let me,fe,oe,pe,ue,be,Be;for(me=0,fe=0;me<W.length;me++)oe=W[me],G.hasOwnProperty(oe)?fe++:(K.push({command:Ze.removeLayer,args:[oe]}),te.splice(te.indexOf(oe,fe),1));for(me=0,fe=0;me<H.length;me++)oe=H[H.length-1-me],te[te.length-1-me]!==oe&&(X.hasOwnProperty(oe)?(K.push({command:Ze.removeLayer,args:[oe]}),te.splice(te.lastIndexOf(oe,te.length-fe),1)):fe++,be=te[te.length-me],K.push({command:Ze.addLayer,args:[G[oe],be]}),te.splice(te.length-me,0,oe),Y[oe]=!0);for(me=0;me<H.length;me++)if(oe=H[me],pe=X[oe],ue=G[oe],!Y[oe]&&!D(pe,ue))if(D(pe.source,ue.source)&&D(pe["source-layer"],ue["source-layer"])&&D(pe.type,ue.type)){for(Be in Mn(pe.layout,ue.layout,K,oe,null,Ze.setLayoutProperty),Mn(pe.paint,ue.paint,K,oe,null,Ze.setPaintProperty),D(pe.filter,ue.filter)||K.push({command:Ze.setFilter,args:[oe,ue.filter]}),D(pe.minzoom,ue.minzoom)&&D(pe.maxzoom,ue.maxzoom)||K.push({command:Ze.setLayerZoomRange,args:[oe,ue.minzoom,ue.maxzoom]}),pe)pe.hasOwnProperty(Be)&&Be!=="layout"&&Be!=="paint"&&Be!=="filter"&&Be!=="metadata"&&Be!=="minzoom"&&Be!=="maxzoom"&&(Be.indexOf("paint.")===0?Mn(pe[Be],ue[Be],K,oe,Be.slice(6),Ze.setPaintProperty):D(pe[Be],ue[Be])||K.push({command:Ze.setLayerProperty,args:[oe,Be,ue[Be]]}));for(Be in ue)ue.hasOwnProperty(Be)&&!pe.hasOwnProperty(Be)&&Be!=="layout"&&Be!=="paint"&&Be!=="filter"&&Be!=="metadata"&&Be!=="minzoom"&&Be!=="maxzoom"&&(Be.indexOf("paint.")===0?Mn(pe[Be],ue[Be],K,oe,Be.slice(6),Ze.setPaintProperty):D(pe[Be],ue[Be])||K.push({command:Ze.setLayerProperty,args:[oe,Be,ue[Be]]}))}else K.push({command:Ze.removeLayer,args:[oe]}),be=te[te.lastIndexOf(oe)+1],K.push({command:Ze.addLayer,args:[ue,be]})}(k,g.layers,w)}catch(E){console.warn("Unable to compute style diff:",E),w=[{command:Ze.setStyle,args:[g]}]}return w}(this.serialize(),n).filter(_=>!(_.command in Op));if(a.length===0)return!1;const d=a.filter(_=>!(_.command in ed));if(d.length>0)throw new Error(`Unimplemented: ${d.map(_=>_.command).join(", ")}.`);return a.forEach(_=>{_.command!=="setTransition"&&_.command!=="setProjection"&&this[_.command].apply(this,_.args)}),this.stylesheet=n,this._updateMapProjection(),!0}addImage(n,a){return this.getImage(n)?this.fire(new s.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,a),this._afterImageUpdated(n),this)}updateImage(n,a){this.imageManager.updateImage(n,a)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n),this._afterImageUpdated(n),this):this.fire(new s.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(n,a,d={}){if(this._checkLoaded(),this.getSource(n)!==void 0)throw new Error("There is already a source with this ID");if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(s.validateSource,`sources.${n}`,a,null,d))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const _=ze(n,a,this.dispatcher,this);_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(n),source:_.serialize(),sourceId:n}));const g=w=>{const E=(w?"symbol:":"other:")+n,C=this._sourceCaches[E]=new s.SourceCache(E,_,w);(w?this._symbolSourceCaches:this._otherSourceCaches)[n]=C,C.style=this,C.onAdd(this.map)};g(!1),a.type!=="vector"&&a.type!=="geojson"||g(!0),_.onAdd&&_.onAdd(this.map),this._changed=!0}removeSource(n){this._checkLoaded();const a=this.getSource(n);if(!a)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===n)return this.fire(new s.ErrorEvent(new Error(`Source "${n}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.get().source===n)return this.fire(new s.ErrorEvent(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const d=this._getSourceCaches(n);for(const _ of d)delete this._sourceCaches[_.id],delete this._updatedSources[_.id],_.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles();return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(n,a){this._checkLoaded(),this.getSource(n).setData(a),this._changed=!0}getSource(n){const a=this._getSourceCache(n);return a&&a.getSource()}addLayer(n,a,d={}){this._checkLoaded();const _=n.id;if(this.getLayer(_))return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${_}" already exists on this map`)));let g;if(n.type==="custom"){if(El(this,s.validateCustomStyleLayer(n)))return;g=s.createStyleLayer(n)}else{if(typeof n.source=="object"&&(this.addSource(_,n.source),n=s.clone$1(n),n=s.extend(n,{source:_})),this._validate(s.validateLayer,`layers.${_}`,n,{arrayIndex:-1},d))return;g=s.createStyleLayer(n),this._validateLayer(g),g.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[g.id]=g.serialize(),this._updateLayerCount(g,!0)}const w=a?this._order.indexOf(a):this._order.length;if(a&&w===-1)return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${a}" does not exist on this map.`)));this._order.splice(w,0,_),this._layerOrderChanged=!0,this._layers[_]=g;const E=this._getLayerSourceCache(g);if(this._removedLayers[_]&&g.source&&E&&g.type!=="custom"){const C=this._removedLayers[_];delete this._removedLayers[_],C.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",E.pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(n,a){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===a)return;const d=this._order.indexOf(n);this._order.splice(d,1);const _=a?this._order.indexOf(a):this._order.length;a&&_===-1?this.fire(new s.ErrorEvent(new Error(`Layer with id "${a}" does not exist on this map.`))):(this._order.splice(_,0,n),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(n){this._checkLoaded();const a=this._layers[n];if(!a)return void this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be removed.`)));a.setEventedParent(null),this._updateLayerCount(a,!1);const d=this._order.indexOf(n);this._order.splice(d,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=a,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],a.onRemove&&a.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(n){return this._layers[n]}hasLayer(n){return n in this._layers}hasLayerType(n){for(const a in this._layers)if(this._layers[a].type===n)return!0;return!1}setLayerZoomRange(n,a,d){this._checkLoaded();const _=this.getLayer(n);_?_.minzoom===a&&_.maxzoom===d||(a!=null&&(_.minzoom=a),d!=null&&(_.maxzoom=d),this._updateLayer(_)):this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(n,a,d={}){this._checkLoaded();const _=this.getLayer(n);if(_){if(!D(_.filter,a))return a==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(s.validateFilter,`layers.${_.id}.filter`,a,{layerType:_.type},d)||(_.filter=s.clone$1(a),this._updateLayer(_)))}else this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be filtered.`)))}getFilter(n){const a=this.getLayer(n);return a&&s.clone$1(a.filter)}setLayoutProperty(n,a,d,_={}){this._checkLoaded();const g=this.getLayer(n);g?D(g.getLayoutProperty(a),d)||(g.setLayoutProperty(a,d,_),this._updateLayer(g)):this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(n,a){const d=this.getLayer(n);if(d)return d.getLayoutProperty(a);this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style.`)))}setPaintProperty(n,a,d,_={}){this._checkLoaded();const g=this.getLayer(n);g?D(g.getPaintProperty(a),d)||(g.setPaintProperty(a,d,_)&&this._updateLayer(g),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(n,a){const d=this.getLayer(n);return d&&d.getPaintProperty(a)}setFeatureState(n,a){this._checkLoaded();const d=n.source,_=n.sourceLayer,g=this.getSource(d);if(!g)return void this.fire(new s.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)));const w=g.type;if(w==="geojson"&&_)return void this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(w==="vector"&&!_)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided.")));const E=this._getSourceCaches(d);for(const C of E)C.setFeatureState(_,n.id,a)}removeFeatureState(n,a){this._checkLoaded();const d=n.source,_=this.getSource(d);if(!_)return void this.fire(new s.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)));const g=_.type,w=g==="vector"?n.sourceLayer:void 0;if(g==="vector"&&!w)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const E=this._getSourceCaches(d);for(const C of E)C.removeFeatureState(w,n.id,a)}getFeatureState(n){this._checkLoaded();const a=n.source,d=n.sourceLayer,_=this.getSource(a);if(_){if(_.type!=="vector"||d)return n.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(a)[0].getFeatureState(d,n.id);this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const n={};for(const a in this._sourceCaches){const d=this._sourceCaches[a].getSource();n[d.id]||(n[d.id]=d.serialize())}return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:n,layers:this._serializeLayers(this._order)},a=>a!==void 0)}_updateLayer(n){this._updatedLayers[n.id]=!0;const a=this._getLayerSourceCache(n);n.source&&!this._updatedSources[n.source]&&a&&a.getSource().type!=="raster"&&(this._updatedSources[n.source]="reload",a.pause()),this._changed=!0,n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const a=w=>this._layers[w].type==="fill-extrusion",d={},_=[];for(let w=this._order.length-1;w>=0;w--){const E=this._order[w];if(a(E)){d[E]=w;for(const C of n){const k=C[E];if(k)for(const z of k)_.push(z)}}}_.sort((w,E)=>E.intersectionZ-w.intersectionZ);const g=[];for(let w=this._order.length-1;w>=0;w--){const E=this._order[w];if(a(E))for(let C=_.length-1;C>=0;C--){const k=_[C].feature;if(d[k.layer.id]<w)break;g.push(k),_.pop()}else for(const C of n){const k=C[E];if(k)for(const z of k)g.push(z.feature)}}return g}queryRenderedFeatures(n,a,d){a&&a.filter&&this._validate(s.validateFilter,"queryRenderedFeatures.filter",a.filter,null,a);const _={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const C of a.layers){const k=this._layers[C];if(!k)return this.fire(new s.ErrorEvent(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];_[k.source]=!0}}const g=[];a.availableImages=this._availableImages;const w=a&&a.layers?a.layers.some(C=>{const k=this.getLayer(C);return k&&k.is3D()}):this.has3DLayers(),E=Ci.createFromScreenPoints(n,d);for(const C in this._sourceCaches){const k=this._sourceCaches[C].getSource().id;a.layers&&!_[k]||g.push(Ct(this._sourceCaches[C],this._layers,this._serializedLayers,E,a,d,w,!!this.map._showQueryGeometry))}return this.placement&&g.push(function(C,k,z,R,j,K,W){const H={},X=K.queryRenderedSymbols(R),G=[];for(const te of Object.keys(X).map(Number))G.push(W[te]);G.sort($t);for(const te of G){const Y=te.featureIndex.lookupSymbolFeatures(X[te.bucketInstanceId],k,te.bucketIndex,te.sourceLayerIndex,j.filter,j.layers,j.availableImages,C);for(const me in Y){const fe=H[me]=H[me]||[],oe=Y[me];oe.sort((pe,ue)=>{const be=te.featureSortOrder;if(be){const Be=be.indexOf(pe.featureIndex);return be.indexOf(ue.featureIndex)-Be}return ue.featureIndex-pe.featureIndex});for(const pe of oe)fe.push(pe)}}for(const te in H)H[te].forEach(Y=>{const me=Y.feature,fe=z(C[te]).getFeatureState(me.layer["source-layer"],me.id);me.source=me.layer.source,me.layer["source-layer"]&&(me.sourceLayer=me.layer["source-layer"]),me.state=fe});return H}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),E.screenGeometry,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(n,a){a&&a.filter&&this._validate(s.validateFilter,"querySourceFeatures.filter",a.filter,null,a);const d=this._getSourceCaches(n);let _=[];for(const g of d)_=_.concat(st(g,a));return _}addSourceType(n,a,d){return Cr.getSourceType(n)?d(new Error(`A source type called "${n}" already exists.`)):(Cr.setSourceType(n,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:a.workerSourceURL},d):d(null,null))}getLight(){return this.light.getLight()}setLight(n,a={}){this._checkLoaded();const d=this.light.getLight();let _=!1;for(const w in n)if(!D(n[w],d[w])){_=!0;break}if(!_)return;const g=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(n,a),this.light.updateTransitions(g)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,a=1){if(this._checkLoaded(),!n)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(a===1){if(typeof n.source=="object"){const d="terrain-dem-src";this.addSource(d,n.source),n=s.clone$1(n),n=s.extend(n,{source:d})}if(this._validate(s.validateTerrain,"terrain",n))return}if(!this.terrain||this.terrain&&a!==this.terrain.drapeRenderMode)this._createTerrain(n,a);else{const d=this.terrain,_=d.get();for(const g of Object.keys(s.spec.terrain))!n.hasOwnProperty(g)&&s.spec.terrain[g].default&&(n[g]=s.spec.terrain[g].default);for(const g in n)if(!D(n[g],_[g])){d.set(n),this.stylesheet.terrain=n;const w=this._setTransitionParameters({duration:0});d.updateTransitions(w);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const a=this.fog=new xt(n,this.map.transform);this.stylesheet.fog=n;const d=this._setTransitionParameters({duration:0});a.updateTransitions(d)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog,d=a.get();Object.keys(n).length===0&&a.set(n);for(const _ in n)if(!D(n[_],d[_])){a.set(n),this.stylesheet.fog=n;const g=this._setTransitionParameters({duration:0});a.updateTransitions(g);break}}else this._createFog(n);this._markersNeedUpdate=!0}_setTransitionParameters(n){return{now:s.exported.now(),transition:s.extend(n,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const n=this._order.filter(d=>this.isLayerDraped(this._layers[d])),a=this._order.filter(d=>!this.isLayerDraped(this._layers[d]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...a)}_createTerrain(n,a){const d=this.terrain=new ot(n,a);this.stylesheet.terrain=n,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const _=this._setTransitionParameters({duration:0});d.updateTransitions(_)}_force3DLayerUpdate(){for(const n in this._layers){const a=this._layers[n];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const a=this._layers[n];a.type==="symbol"&&this._updateLayer(a)}}_validate(n,a,d,_,g={}){return(!g||g.validate!==!1)&&El(this,n.call(s.validateStyle,s.extend({key:a,style:this.serialize(),value:d,styleSpec:s.spec},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this._sourceCaches)this._sourceCaches[n].clearTiles(),this._sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(n){const a=this._getSourceCaches(n);for(const d of a)d.clearTiles()}_reloadSource(n){const a=this._getSourceCaches(n);for(const d of a)d.resume(),d.reload()}_updateSources(n){for(const a in this._sourceCaches)this._sourceCaches[a].update(n)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const a=this._sourceCaches[n];a.resume(),a.reload()}}_updatePlacement(n,a,d,_,g=!1){let w=!1,E=!1;const C={};for(const k of this._order){const z=this._layers[k];if(z.type!=="symbol")continue;if(!C[z.source]){const j=this._getLayerSourceCache(z);if(!j)continue;C[z.source]=j.getRenderableIds(!0).map(K=>j.getTileByID(K)).sort((K,W)=>W.tileID.overscaledZ-K.tileID.overscaledZ||(K.tileID.isLessThan(W.tileID)?-1:1))}const R=this.crossTileSymbolIndex.addLayer(z,C[z.source],n.center.lng,n.projection);w=w||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),g=g||this._layerOrderChanged||d===0,this._layerOrderChanged&&this.fire(new s.Event("neworder")),(g||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.exported.now(),n.zoom))&&(this.pauseablePlacement=new zo(n,this._order,g,a,d,_,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,C),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.exported.now()),E=!0),w&&this.pauseablePlacement.placement.setStale()),E||w)for(const k of this._order){const z=this._layers[k];z.type==="symbol"&&this.placement.updateLayerOpacities(z,C[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.exported.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,a,d){this.imageManager.getImages(a.icons,d),this._updateTilesForChangedImages();const _=g=>{g&&g.setDependencies(a.tileID.key,a.type,a.icons)};_(this._otherSourceCaches[a.source]),_(this._symbolSourceCaches[a.source])}getGlyphs(n,a,d){this.glyphManager.getGlyphs(a.stacks,d)}getResource(n,a,d){return s.makeRequest(a,d)}_getSourceCache(n){return this._otherSourceCaches[n]}_getLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}_getSourceCaches(n){const a=[];return this._otherSourceCaches[n]&&a.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&a.push(this._symbolSourceCaches[n]),a}_isSourceCacheLoaded(n){const a=this._getSourceCaches(n);return a.length===0?(this.fire(new s.ErrorEvent(new Error(`There is no source with ID '${n}'`))),!1):a.every(d=>d.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Cr.getSourceType=function(c){return ye[c]},Cr.setSourceType=function(c,n){ye[c]=n},Cr.registerForPluginStateChange=s.registerForPluginStateChange;var Yc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Jc="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Qc=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,eu=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Ms=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let Sl={},Qo={};const Po=[];es(Yc,Po),es(Qc,Po),es(eu,Po),es(Ms,Po),Sl=Bi("",Qc),Qo=Bi(Ms,eu);const Ta=Bi(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Cl=Yc,Al=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var Ml={background:Bi(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Bi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Bi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);
#else 
mat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Bi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Bi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Bi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Bi("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Bi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Bi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Bi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Bi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Bi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Bi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Bi(`uniform lowp vec3 u_lightpos;varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
void main() {vec4 color=v_color;
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color_normal(color.xyz,normalize(v_normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying highp vec3 v_normal;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;vec3 pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_normal=normal;v_depth=gl_Position.w;
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Bi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Bi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Bi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Bi(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
highp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);
#else
vec4 out_color=color;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Bi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Bi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Bi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
vec4 offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Bi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
vec4 offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Bi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Bi(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Bi(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Bi(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Jc),skyboxGradient:Bi(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Jc),skyboxCapture:Bi(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Bi(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);vec4 color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
vec4 color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;
#ifdef GLOBE_POLES
vec3 up_vector=normalize(globe_pos)*u_tile_up_scale;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Bi(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);
#ifdef PROJECTION_GLOBE_VIEW
float globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));float horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
float horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function es(c,n){const a=c.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let d of a)if(d=d.trim(),d[0]==="#"&&d.includes("if")&&!d.includes("endif")){d=d.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const _=d.split(" ");for(const g of _)n.includes(g)||n.push(g)}}function Bi(c,n){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=n.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),_={},g=[...Po];return es(c,g),es(n,g),{fragmentSource:c=c.replace(a,(w,E,C,k,z)=>(_[z]=!0,E==="define"?`
#ifndef HAS_UNIFORM_u_${z}
varying ${C} ${k} ${z};
#else
uniform ${C} ${k} u_${z};
#endif
`:`
#ifdef HAS_UNIFORM_u_${z}
    ${C} ${k} ${z} = u_${z};
#endif
`)),vertexSource:n=n.replace(a,(w,E,C,k,z)=>{const R=k==="float"?"vec2":"vec4",j=z.match(/color/)?"color":R;return _[z]?E==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
attribute ${C} ${R} a_${z};
varying ${C} ${k} ${z};
#else
uniform ${C} ${k} u_${z};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = a_${z};
#else
    ${C} ${k} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = unpack_mix_${j}(a_${z}, u_${z}_t);
#else
    ${C} ${k} ${z} = u_${z};
#endif
`:E==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
attribute ${C} ${R} a_${z};
#else
uniform ${C} ${k} u_${z};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${C} ${k} ${z} = a_${z};
#else
    ${C} ${k} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${C} ${k} ${z} = unpack_mix_${j}(a_${z}, u_${z}_t);
#else
    ${C} ${k} ${z} = u_${z};
#endif
`}),staticAttributes:d,usedDefines:g}}class Il{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,a,d,_,g,w,E){this.context=n;let C=this.boundPaintVertexBuffers.length!==_.length;for(let z=0;!C&&z<_.length;z++)this.boundPaintVertexBuffers[z]!==_[z]&&(C=!0);let k=this.boundDynamicVertexBuffers.length!==E.length;for(let z=0;!k&&z<E.length;z++)this.boundDynamicVertexBuffers[z]!==E[z]&&(k=!0);if(!n.extVertexArrayObject||!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==d||C||k||this.boundIndexBuffer!==g||this.boundVertexOffset!==w)this.freshBind(a,d,_,g,w,E);else{n.bindVertexArrayOES.set(this.vao);for(const z of E)z&&z.bind();g&&g.dynamicDraw&&g.bind()}}freshBind(n,a,d,_,g,w){let E;const C=n.numAttributes,k=this.context,z=k.gl;if(k.extVertexArrayObject)this.vao&&this.destroy(),this.vao=k.extVertexArrayObject.createVertexArrayOES(),k.bindVertexArrayOES.set(this.vao),E=0,this.boundProgram=n,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=_,this.boundVertexOffset=g,this.boundDynamicVertexBuffers=w;else{E=k.currentNumAttributes||0;for(let R=C;R<E;R++)z.disableVertexAttribArray(R)}a.enableAttributes(z,n),a.bind(),a.setVertexAttribPointers(z,n,g);for(const R of d)R.enableAttributes(z,n),R.bind(),R.setVertexAttribPointers(z,n,g);for(const R of w)R&&(R.enableAttributes(z,n),R.bind(),R.setVertexAttribPointers(z,n,g));_&&_.bind(),k.currentNumAttributes=C}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function tu(c,n){const a=Math.pow(2,n.canonical.z),d=n.canonical.y;return[new s.MercatorCoordinate(0,d/a).toLngLat().lat,new s.MercatorCoordinate(0,(d+1)/a).toLngLat().lat]}function iu(c,n,a,d,_,g,w){const E=c.context,C=E.gl,k=a.fbo;if(!k)return;c.prepareDrawTile();const z=c.useProgram("hillshade");E.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,k.colorAttachment.get());const R=((H,X,G,te)=>{const Y=G.paint.get("hillshade-shadow-color"),me=G.paint.get("hillshade-highlight-color"),fe=G.paint.get("hillshade-accent-color");let oe=G.paint.get("hillshade-illumination-direction")*(Math.PI/180);G.paint.get("hillshade-illumination-anchor")==="viewport"&&(oe-=H.transform.angle);const pe=!H.options.moving;return{u_matrix:te||H.transform.calculateProjMatrix(X.tileID.toUnwrapped(),pe),u_image:0,u_latrange:tu(0,X.tileID),u_light:[G.paint.get("hillshade-exaggeration"),oe],u_shadow:Y,u_highlight:me,u_accent:fe}})(c,a,d,c.terrain?n.projMatrix:null);c.prepareDrawProgram(E,z,n.toUnwrapped());const{tileBoundsBuffer:j,tileBoundsIndexBuffer:K,tileBoundsSegments:W}=c.getTileBoundsBuffers(a);z.draw(E,C.TRIANGLES,_,g,w,s.CullFaceMode.disabled,R,d.id,j,K,W)}function Mi(c,n,a){if(!n.needsDEMTextureUpload)return;const d=c.context,_=d.gl;d.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||c.getTileTexture(a.stride);const g=a.getPixels();n.demTexture?n.demTexture.update(g,{premultiply:!1}):n.demTexture=new s.Texture(d,g,_.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function Is(c,n,a,d,_,g){const w=c.context,E=w.gl;if(!n.dem)return;const C=n.dem;if(w.activeTexture.set(E.TEXTURE1),Mi(c,n,C),!n.demTexture)return;n.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE);const k=C.dim;w.activeTexture.set(E.TEXTURE0);let z=n.fbo;if(!z){const W=new s.Texture(w,{width:k,height:k,data:null},E.RGBA);W.bind(E.LINEAR,E.CLAMP_TO_EDGE),z=n.fbo=w.createFramebuffer(k,k,!0),z.colorAttachment.set(W.texture)}w.bindFramebuffer.set(z.framebuffer),w.viewport.set([0,0,k,k]);const{tileBoundsBuffer:R,tileBoundsIndexBuffer:j,tileBoundsSegments:K}=c.getMercatorTileBoundsBuffers();c.useProgram("hillshadePrepare").draw(w,E.TRIANGLES,d,_,g,s.CullFaceMode.disabled,((W,H)=>{const X=H.stride,G=s.create();return s.ortho(G,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate(G,G,[0,-s.EXTENT,0]),{u_matrix:G,u_image:1,u_dimension:[X,X],u_zoom:W.overscaledZ,u_unpack:H.unpackVector}})(n.tileID,C),a.id,R,j,K),n.needsHillshadePrepare=!1}const Ea=c=>({u_matrix:new s.UniformMatrix4f(c),u_image0:new s.Uniform1i(c),u_skirt_height:new s.Uniform1f(c)}),nu=(c,n)=>({u_matrix:c,u_image0:0,u_skirt_height:n}),ru=(c,n,a,d,_,g,w,E,C,k,z,R,j,K)=>({u_proj_matrix:Float32Array.from(c),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(d),u_merc_matrix:a,u_zoom_transition:_,u_merc_center:g,u_image0:0,u_frustum_tl:w,u_frustum_tr:E,u_frustum_br:C,u_frustum_bl:k,u_globe_pos:z,u_globe_radius:R,u_viewport:j,u_grid_matrix:K?Float32Array.from(K):new Float32Array(9)});function ou(c,n){return c!=null&&n!=null&&!(!c.hasData()||!n.hasData())&&c.demTexture!=null&&n.demTexture!=null&&c.tileID.key!==n.tileID.key}const Do=new class{constructor(){this.operations={}}newMorphing(c,n,a,d,_){if(c in this.operations){const g=this.operations[c];g.to.tileID.key!==a.tileID.key&&(g.queued=a)}else this.operations[c]={startTime:d,phase:0,duration:_,from:n,to:a,queued:null}}getMorphValuesForProxy(c){if(!(c in this.operations))return null;const n=this.operations[c];return{from:n.from,to:n.to,phase:n.phase}}update(c){for(const n in this.operations){const a=this.operations[n];for(a.phase=(c-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,c)){delete this.operations[n];break}}}_nextOp(c,n){return!!c.queued&&(c.from=c.to,c.to=c.queued,c.queued=null,c.phase=0,c.startTime=n,!0)}_validOp(c){return c.from.hasData()&&c.to.hasData()}},Sa={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Vp(c,n){const a=1<<c.z;return!n&&(c.x===0||c.x===a-1)||c.y===0||c.y===a-1}const su=c=>({u_matrix:c});function kl(c,n,a,d,_){if(_>0){const g=s.exported.now(),w=(g-c.timeAdded)/_,E=n?(g-n.timeAdded)/_:-1,C=a.getSource(),k=d.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),z=!n||Math.abs(n.tileID.overscaledZ-k)>Math.abs(c.tileID.overscaledZ-k),R=z&&c.refreshedUponExpiration?1:s.clamp(z?w:1-E,0,1);return c.refreshedUponExpiration&&w>=1&&(c.refreshedUponExpiration=!1),n?{opacity:1,mix:1-R}:{opacity:R,mix:0}}return{opacity:1,mix:0}}class au extends s.SourceCache{constructor(n){const a={type:"raster-dem",maxzoom:n.transform.maxZoom},d=new Bt(Li(),null),_=ze("mock-dem",a,d,n.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,a){n.state="loaded",a(null)}}class lu extends s.SourceCache{constructor(n){const a=ze("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new Bt(Li(),null),n.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,a,d){if(n.freezeTileCoverage)return;this.transform=n;const _=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((g,w)=>{if(g[w.key]="",!this._tiles[w.key]){const E=new s.Tile(w,this._source.tileSize*w.overscaleFactor(),n.tileZoom);E.state="loaded",this._tiles[w.key]=E}return g},{});for(const g in this._tiles)g in _||(this.freeFBO(g),this._tiles[g].unloadVectorData(),delete this._tiles[g])}freeFBO(n){const a=this.proxyCachedFBO[n];if(a!==void 0){const d=Object.values(a);this.renderCachePool.push(...d),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class zl extends s.OverscaledTileID{constructor(n,a,d){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=a,this.projMatrix=d}}class id extends s.Elevation{constructor(n,a){super(),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[d,_,g]=function(C){const k=new s.StructArrayLayout4i8,z=new s.StructArrayLayout3ui6,R=131;k.reserve(17161),z.reserve(33800);const j=s.EXTENT/128,K=s.EXTENT+j/2,W=K+j;for(let X=-j;X<W;X+=j)for(let G=-j;G<W;G+=j){const te=G<0||G>K||X<0||X>K?24575:0,Y=s.clamp(Math.round(G),0,s.EXTENT),me=s.clamp(Math.round(X),0,s.EXTENT);k.emplaceBack(Y+te,me,Y,me)}const H=(X,G)=>{const te=G*R+X;z.emplaceBack(te+1,te,te+R),z.emplaceBack(te+R,te+R+1,te+1)};for(let X=1;X<129;X++)for(let G=1;G<129;G++)H(G,X);return[0,129].forEach(X=>{for(let G=0;G<130;G++)H(G,X),H(X,G)}),[k,z,32768]}(),w=n.context;this.gridBuffer=w.createVertexBuffer(d,s.boundsAttributes.members),this.gridIndexBuffer=w.createIndexBuffer(_),this.gridSegments=s.SegmentVector.simpleSegment(0,0,d.length,_.length),this.gridNoSkirtSegments=s.SegmentVector.simpleSegment(0,0,d.length,g),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new lu(a.map),this.orthoMatrix=s.create(),s.ortho(this.orthoMatrix,0,s.EXTENT,0,s.EXTENT,0,1);const E=w.gl;this._overlapStencilMode=new s.StencilMode({func:E.GEQUAL,mask:255},0,255,E.KEEP,E.KEEP,E.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new au(a.map)}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),n.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=n,this._checkRenderCacheEfficiency()}update(n,a,d){if(n&&n.terrain){this._style!==n&&(this.style=n),this.enabled=!0;const _=n.terrain.properties;this.sourceCache=n.terrain.drapeRenderMode===0?this._mockSourceCache:n._getSourceCache(_.get("source")),this._exaggeration=_.get("exaggeration");const g=()=>{this.sourceCache.used&&s.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const w=this.getScaledDemTileSize();this.sourceCache.update(a,w,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,g(),this._initializing=!0),g(),a.updateElevation(!d),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const n=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||n.efficiency!==100&&s.warnOnce(`Terrain render cache efficiency is not optimal (${n.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${n.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._sourceCaches)this._style._sourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,d=this.painter.transform;this._initializing&&(this._initializing=d._centerAltitude===0&&this.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(d.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=a.getIds().map(C=>{const k=a.getTileByID(C).tileID;return k.projMatrix=d.calculateProjMatrix(k.toUnwrapped()),k});(function(C,k){const z=k.transform.pointCoordinate(k.transform.getCameraPoint()),R=new s.pointGeometry(z.x,z.y);C.sort((j,K)=>{if(K.overscaledZ-j.overscaledZ)return K.overscaledZ-j.overscaledZ;const W=new s.pointGeometry(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),H=new s.pointGeometry(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),X=R.mult(1<<j.canonical.z);return X.x-=.5,X.y-=.5,X.distSqr(W)-X.distSqr(H)})})(_,this.painter),this._previousZoom=d.zoom;const g=this.proxyToSource||{};this.proxyToSource={},_.forEach(C=>{this.proxyToSource[C.key]={}}),this.terrainTileForTile={};const w=this._style._sourceCaches;for(const C in w){const k=w[C];if(!k.used||(k!==this.sourceCache&&this.resetTileLookupCache(k.id),this._setupProxiedCoordsForOrtho(k,n[C],g),k.usedForTerrain))continue;const z=n[C];k.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[a.id]=_.map(C=>new zl(C,C.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(g),this.renderingToTexture=!1,this._updateTimestamp=s.exported.now();const E={};this._visibleDemTiles=[];for(const C of this.proxyCoords){const k=this.terrainTileForTile[C.key];if(!k)continue;const z=k.tileID.key;z in E||(this._visibleDemTiles.push(k),E[z]=z)}}_assignTerrainTiles(n){this._initializing||n.forEach(a=>{if(this.terrainTileForTile[a.key])return;const d=this._findTileCoveringTileID(a,this.sourceCache);d&&(this.terrainTileForTile[a.key]=d)})}_prepareDEMTextures(){const n=this.painter.context,a=n.gl;for(const d in this.terrainTileForTile){const _=this.terrainTileForTile[d],g=_.dem;!g||_.demTexture&&!_.needsDEMTextureUpload||(n.activeTexture.set(a.TEXTURE1),Mi(this.painter,_,g))}}_prepareDemTileUniforms(n,a,d,_){if(!a||a.demTexture==null)return!1;const g=n.tileID.canonical,w=Math.pow(2,a.tileID.canonical.z-g.z),E=_||"";return d[`u_dem_tl${E}`]=[g.x*w%1,g.y*w%1],d[`u_dem_scale${E}`]=w,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,a=n.gl;if(!this._emptyDepthBufferTexture){const d=new s.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new s.Texture(n,d,a.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0;const a=this._visibleDemTiles.reduce((d,_)=>{if(!_.dem)return d;const g=_.dem.tree.minimums[0];return g>0&&n++,d+g},0);return n?a/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,a=n.gl;n.activeTexture.set(a.TEXTURE2);const d=this._getLoadedAreaMinimum(),_=new s.RGBAImage({width:1,height:1},new Uint8Array(s.DEMData.pack(d,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let g=this._emptyDEMTexture;return g?g.update(_,{premultiply:!1}):g=this._emptyDEMTexture=new s.Texture(n,_,a.RGBA,{premultiply:!1}),g}setupElevationDraw(n,a,d){const _=this.painter.context,g=_.gl,w=(E=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:s.DEMData.getUnpackVector(E),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var E;w.u_dem_size=this.sourceCache.getSource().tileSize,w.u_exaggeration=this.exaggeration();const C=this.painter.transform,k=C.projection,z=n.tileID.canonical;w.u_tile_tl_up=k.upVector(z,0,0),w.u_tile_tr_up=k.upVector(z,s.EXTENT,0),w.u_tile_br_up=k.upVector(z,s.EXTENT,s.EXTENT),w.u_tile_bl_up=k.upVector(z,0,s.EXTENT),w.u_tile_up_scale=d&&d.useDenormalizedUpVectorScale?s.GLOBE_METERS_TO_ECEF:k.upVectorScale(z,C.center.lat,C.worldSize).metersToTile;let R=null,j=null,K=1;if(d&&d.morphing&&this._useVertexMorphing){const W=d.morphing.srcDemTile,H=d.morphing.dstDemTile;K=d.morphing.phase,W&&H&&(this._prepareDemTileUniforms(n,W,w,"_prev")&&(j=W),this._prepareDemTileUniforms(n,H,w)&&(R=H))}if(j&&R?(_.activeTexture.set(g.TEXTURE2),R.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE,g.NEAREST),_.activeTexture.set(g.TEXTURE4),j.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE,g.NEAREST),w.u_dem_lerp=K):(R=this.terrainTileForTile[n.tileID.key],_.activeTexture.set(g.TEXTURE2),(this._prepareDemTileUniforms(n,R,w)?R.demTexture:this.emptyDEMTexture).bind(g.NEAREST,g.CLAMP_TO_EDGE)),_.activeTexture.set(g.TEXTURE3),d&&d.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),this._depthFBO&&(w.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),w.u_depth_size_inv=[1,1]),d&&d.useMeterToDem&&R){const W=(1<<R.tileID.canonical.z)*s.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;w.u_meter_to_dem=W}d&&d.labelPlaneMatrixInv&&(w.u_label_plane_matrix_inv=d.labelPlaneMatrixInv),a.setTerrainUniformValues(_,w)}renderToBackBuffer(n){const a=this.painter,d=this.painter.context;n.length!==0&&(d.bindFramebuffer.set(null),d.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,g,w,E,C){if(_.transform.projection.name==="globe")(function(k,z,R,j,K){const W=k.context,H=W.gl;let X,G;const te=k.options.showTerrainWireframe?2:0,Y=k.transform,me=s.globeUseCustomAntiAliasing(k,W,Y),fe=(wt,qe)=>{if(G===wt)return;const mt=[Sa[wt],"PROJECTION_GLOBE_VIEW"];me&&mt.push("CUSTOM_ANTIALIASING"),qe&&mt.push(Sa[te]),X=k.useProgram("globeRaster",null,mt),G=wt},oe=k.colorModeForRenderPass(),pe=new s.DepthMode(H.LEQUAL,s.DepthMode.ReadWrite,k.depthRangeFor3D);Do.update(K);const ue=s.calculateGlobeMercatorMatrix(Y),be=[s.mercatorXfromLng(Y.center.lng),s.mercatorYfromLat(Y.center.lat)],Be=te?[!1,!0]:[!1],dt=k.globeSharedBuffers,Ie=[Y.width*s.exported.devicePixelRatio,Y.height*s.exported.devicePixelRatio],Je=Float32Array.from(Y.globeMatrix),rt={useDenormalizedUpVectorScale:!0};if(Be.forEach(wt=>{G=-1;const qe=wt?H.LINES:H.TRIANGLES;for(const mt of j){const it=R.getTile(mt),It=s.StencilMode.disabled,St=z.prevTerrainTileForTile[mt.key],Vt=z.terrainTileForTile[mt.key];ou(St,Vt)&&Do.newMorphing(mt.key,St,Vt,K,250),W.activeTexture.set(H.TEXTURE0),it.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);const Wt=Do.getMorphValuesForProxy(mt.key),ii=Wt?1:0;Wt&&s.extend$1(rt,{morphing:{srcDemTile:Wt.from,dstDemTile:Wt.to,phase:s.easeCubicInOut(Wt.phase)}});const bi=s.tileCornersToBounds(mt.canonical),Ut=s.getLatitudinalLod(bi.getCenter().lat),ai=s.getGridMatrix(mt.canonical,bi,Ut),Ii=s.globeNormalizeECEF(s.globeTileBounds(mt.canonical)),en=ru(Y.projMatrix,Je,ue,Ii,s.globeToMercatorTransition(Y.zoom),be,Y.frustumCorners.TL,Y.frustumCorners.TR,Y.frustumCorners.BR,Y.frustumCorners.BL,Y.globeCenterInViewSpace,Y.globeRadius,Ie,ai);if(fe(ii,wt),z.setupElevationDraw(it,X,rt),k.prepareDrawProgram(W,X,mt.toUnwrapped()),dt){const[dn,qi,Fn]=wt?dt.getWirefameBuffers(k.context,Ut):dt.getGridBuffers(Ut);X.draw(W,qe,pe,It,oe,s.CullFaceMode.backCCW,en,"globe_raster",dn,qi,Fn)}}}),dt){const wt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];me&&wt.push("CUSTOM_ANTIALIASING"),X=k.useProgram("globeRaster",null,wt);for(const qe of j){const{x:mt,y:it,z:It}=qe.canonical,St=it===0,Vt=it===(1<<It)-1,[Wt,ii,bi,Ut]=dt.getPoleBuffers(It);if(Ut&&(St||Vt)){const ai=R.getTile(qe);W.activeTexture.set(H.TEXTURE0),ai.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);let Ii=s.globePoleMatrixForTile(It,mt,Y);const en=s.globeNormalizeECEF(s.globeTileBounds(qe.canonical)),dn=(qi,Fn)=>qi.draw(W,H.TRIANGLES,pe,s.StencilMode.disabled,oe,s.CullFaceMode.disabled,ru(Y.projMatrix,Ii,Ii,en,0,be,Y.frustumCorners.TL,Y.frustumCorners.TR,Y.frustumCorners.BR,Y.frustumCorners.BL,Y.globeCenterInViewSpace,Y.globeRadius,Ie),"globe_pole_raster",Fn,bi,Ut);z.setupElevationDraw(ai,X,rt),k.prepareDrawProgram(W,X,qe.toUnwrapped()),St&&dn(X,Wt),Vt&&(Ii=s.scale(s.create(),Ii,[1,-1,1]),dn(X,ii))}}}})(_,g,w,E,C);else{const k=_.context,z=k.gl;let R,j;const K=_.options.showTerrainWireframe?2:0,W=(Y,me)=>{if(j===Y)return;const fe=[Sa[Y]];me&&fe.push(Sa[K]),R=_.useProgram("terrainRaster",null,fe),j=Y},H=_.colorModeForRenderPass(),X=new s.DepthMode(z.LEQUAL,s.DepthMode.ReadWrite,_.depthRangeFor3D);Do.update(C);const G=_.transform,te=6*Math.pow(1.5,22-G.zoom)*g.exaggeration();(K?[!1,!0]:[!1]).forEach(Y=>{j=-1;const me=Y?z.LINES:z.TRIANGLES,[fe,oe]=Y?g.getWirefameBuffer():[g.gridIndexBuffer,g.gridSegments];for(const pe of E){const ue=w.getTile(pe),be=s.StencilMode.disabled,Be=g.prevTerrainTileForTile[pe.key],dt=g.terrainTileForTile[pe.key];ou(Be,dt)&&Do.newMorphing(pe.key,Be,dt,C,250),k.activeTexture.set(z.TEXTURE0),ue.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST);const Ie=Do.getMorphValuesForProxy(pe.key),Je=Ie?1:0;let rt;Ie&&(rt={morphing:{srcDemTile:Ie.from,dstDemTile:Ie.to,phase:s.easeCubicInOut(Ie.phase)}});const wt=nu(pe.projMatrix,Vp(pe.canonical,G.renderWorldCopies)?te/10:te);W(Je,Y),g.setupElevationDraw(ue,R,rt),_.prepareDrawProgram(k,R,pe.toUnwrapped()),R.draw(k,me,X,be,H,s.CullFaceMode.backCCW,wt,"terrain_raster",g.gridBuffer,fe,oe)}})}}(a,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const a=this.painter,d=this.painter.context,_=this.proxySourceCache,g=this.proxiedCoords[_.id],w=this._drapedRenderBatches.shift(),E=[],C=a.style.order;let k=0;for(const z of g){const R=_.getTileByID(z.proxyTileKey),j=_.proxyCachedFBO[z.key]?_.proxyCachedFBO[z.key][n]:void 0,K=j!==void 0?_.renderCache[j]:this.pool[k++],W=j!==void 0;if(R.texture=K.tex,W&&!K.dirty){E.push(R.tileID);continue}let H;d.bindFramebuffer.set(K.fb.framebuffer),this.renderedToTile=!1,K.dirty&&(d.clear({color:s.Color.transparent,stencil:0}),K.dirty=!1);for(let X=w.start;X<=w.end;++X){const G=a.style._layers[C[X]];if(G.isHidden(a.transform.zoom))continue;const te=a.style._getLayerSourceCache(G),Y=te?this.proxyToSource[z.key][te.id]:[z];if(!Y)continue;const me=Y;d.viewport.set([0,0,K.fb.width,K.fb.height]),H!==(te?te.id:null)&&(this._setupStencil(K,Y,G,te),H=te?te.id:null),a.renderLayer(a,te,G,me)}this.renderedToTile?(K.dirty=!0,E.push(R.tileID)):W||--k,k===5&&(k=0,this.renderToBackBuffer(E))}return this.renderToBackBuffer(E),this.renderingToTexture=!1,d.bindFramebuffer.set(null),d.viewport.set([0,0,a.width,a.height]),w.end+1}postRender(){}renderCacheEfficiency(n){const a=n.order.length;if(a===0)return{efficiency:100};let d,_=0,g=0,w=!1;for(let E=0;E<a;++E){const C=n._layers[n.order[E]];this._style.isLayerDraped(C)?(w&&++_,++g):w||(w=!0,d=C.id)}return g===0?{efficiency:100}:{efficiency:100*(1-_/g),firstUndrapedLayer:d}}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{n=Math.min(n,a.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,a,d){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(g=>g.dem).map(g=>{const w=g.tileID,E=1<<w.overscaledZ,{x:C,y:k}=w.canonical,z=C/E,R=(C+1)/E,j=k/E,K=(k+1)/E;return{minx:z,miny:j,maxx:R,maxy:K,t:g.dem.tree.raycastRoot(z,j,R,K,n,a,d),tile:g}});_.sort((g,w)=>(g.t!==null?g.t:Number.MAX_VALUE)-(w.t!==null?w.t:Number.MAX_VALUE));for(const g of _){if(g.t==null)return null;const w=g.tile.dem.tree.raycast(g.minx,g.miny,g.maxx,g.maxy,n,a,d);if(w!=null)return w}return null}_createFBO(){const n=this.painter.context,a=n.gl,d=this.drapeBufferSize;n.activeTexture.set(a.TEXTURE0);const _=new s.Texture(n,{width:d[0],height:d[1],data:null},a.RGBA);_.bind(a.LINEAR,a.CLAMP_TO_EDGE);const g=n.createFramebuffer(d[0],d[1],!1);return g.colorAttachment.set(_.texture),g.depthAttachment=new B(n,g.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,d[0],d[1]),this._stencilRef=0,g.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):g.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&!n.extTextureFilterAnisotropicForceOff&&a.texParameterf(a.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:g,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const n in this._style._sourceCaches)if(this._style._sourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const a=this._style._layers[n],d=a.isHidden(this.painter.transform.zoom),_=a.getCrossfadeParameters(),g=!!_&&_.t!==1,w=a.hasTransition();return a.type!=="custom"&&!d&&(g||w)})}_clearRasterFadeFromRenderCache(){let n=!1;for(const a in this._style._sourceCaches)if(this._style._sourceCaches[a]._source instanceof ne){n=!0;break}if(n)for(let a=0;a<this._style.order.length;++a){const d=this._style._layers[this._style.order[a]],_=d.isHidden(this.painter.transform.zoom),g=this._style._getLayerSourceCache(d);if(d.type!=="raster"||_||!g)continue;const w=d.paint.get("raster-fade-duration");for(const E of this.proxyCoords){const C=this.proxyToSource[E.key][g.id];if(C)for(const k of C){const z=kl(g.getTile(k),g.findLoadedParent(k,0),g,this.painter.transform,w);(z.opacity!==1||z.mix!==0)&&this._clearRenderCacheForTile(g.id,k)}}}}_setupDrapedRenderBatches(){const n=this._style.order,a=n.length;if(a===0)return;const d=[];let _,g=0,w=this._style._layers[n[g]];for(;!this._style.isLayerDraped(w)&&w.isHidden(this.painter.transform.zoom)&&++g<a;)w=this._style._layers[n[g]];for(;g<a;++g){const E=this._style._layers[n[g]];E.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(E)?_===void 0&&(_=g):_!==void 0&&(d.push({start:_,end:g-1}),_=void 0))}_!==void 0&&d.push({start:_,end:g-1}),this._drapedRenderBatches=d}_setupRenderCache(n){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const w=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let E=0;E<w.length;++E){const C=Object.values(w[E]);a.renderCachePool.push(...C)}}return}this._clearRasterFadeFromRenderCache();const d=this.proxyCoords,_=this._tilesDirty;for(let w=d.length-1;w>=0;w--){const E=d[w];if(a.getTileByID(E.key),a.proxyCachedFBO[E.key]!==void 0){const C=n[E.key],k=this.proxyToSource[E.key];let z=0;for(const R in k){const j=k[R],K=C[R];if(!K||K.length!==j.length||j.some((W,H)=>W!==K[H]||_[R]&&_[R].hasOwnProperty(W.key))){z=-1;break}++z}for(const R in a.proxyCachedFBO[E.key])a.renderCache[a.proxyCachedFBO[E.key][R]].dirty=z<0||z!==Object.values(C).length}}const g=[...this._drapedRenderBatches];g.sort((w,E)=>E.end-E.start-(w.end-w.start));for(const w of g)for(const E of d){if(a.proxyCachedFBO[E.key])continue;let C=a.renderCachePool.pop();C===void 0&&a.renderCache.length<50&&(C=a.renderCache.length,a.renderCache.push(this._createFBO())),C!==void 0&&(a.proxyCachedFBO[E.key]={},a.proxyCachedFBO[E.key][w.start]=C,a.renderCache[C].dirty=!0)}this._tilesDirty={}}_setupStencil(n,a,d,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const g=this.painter.context,w=g.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let E;if(d.isTileClipped())E=a.length,this._overlapStencilMode.test={func:w.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);E=1,this._overlapStencilMode.test={func:w.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+E>255&&(g.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=E,this._overlapStencilMode.ref=this._stencilRef,d.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):s.StencilMode.disabled}_renderTileClippingMasks(n,a){const d=this.painter,_=this.painter.context,g=_.gl;d._tileClippingMaskIDs={},_.setColorMode(s.ColorMode.disabled),_.setDepthMode(s.DepthMode.disabled);const w=d.useProgram("clippingMask");for(const E of n){const C=d._tileClippingMaskIDs[E.key]=--a;w.draw(_,g.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:g.ALWAYS,mask:0},C,255,g.KEEP,g.KEEP,g.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,su(E.projMatrix),"$clipping",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}pointCoordinate(n){const a=this.painter.transform;if(n.x<0||n.x>a.width||n.y<0||n.y>a.height)return null;const d=[n.x,n.y,1,1];s.transformMat4$1(d,d,a.pixelMatrixInverse),s.scale$1(d,d,1/d[3]),d[0]/=a.worldSize,d[1]/=a.worldSize;const _=a._camera.position,g=s.mercatorZfromAltitude(1,a.center.lat),w=[_[0],_[1],_[2]/g,0],E=s.subtract([],d.slice(0,3),w);s.normalize(E,E);const C=this.raycast(w,E,this._exaggeration);return C!==null&&C?(s.scaleAndAdd(w,w,E,C),w[3]=w[2],w[2]*=g,w):null}drawDepth(){const n=this.painter,a=n.context,d=this.proxySourceCache,_=Math.ceil(n.width),g=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===_&&this._depthFBO.height===g||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const w=a.gl,E=a.createFramebuffer(_,g,!0);a.activeTexture.set(w.TEXTURE0);const C=new s.Texture(a,{width:_,height:g,data:null},w.RGBA);C.bind(w.NEAREST,w.CLAMP_TO_EDGE),E.colorAttachment.set(C.texture);const k=a.createRenderbuffer(a.gl.DEPTH_COMPONENT16,_,g);E.depthAttachment.set(k),this._depthFBO=E,this._depthTexture=C}a.bindFramebuffer.set(this._depthFBO.framebuffer),a.viewport.set([0,0,_,g]),function(w,E,C,k){if(w.transform.projection.name==="globe")return;const z=w.context,R=z.gl;z.clear({depth:1});const j=w.useProgram("terrainDepth"),K=new s.DepthMode(R.LESS,s.DepthMode.ReadWrite,w.depthRangeFor3D);for(const W of k){const H=C.getTile(W),X=nu(W.projMatrix,0);E.setupElevationDraw(H,j),j.draw(z,R.TRIANGLES,K,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.backCCW,X,"terrain_depth",E.gridBuffer,E.gridIndexBuffer,E.gridNoSkirtSegments)}}(n,this,d,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,a,d){if(n.getSource()instanceof Ae)return this._setupProxiedCoordsForImageSource(n,a,d);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const _=this.proxiedCoords[n.id]=[],g=this.proxyCoords;for(let E=0;E<g.length;E++){const C=g[E],k=this._findTileCoveringTileID(C,n);if(k){const z=this._createProxiedId(C,k,d[C.key]&&d[C.key][n.id]);_.push(z),this.proxyToSource[C.key][n.id]=[z]}}let w=!1;for(let E=0;E<a.length;E++){const C=n.getTile(a[E]);if(!C||!C.hasData())continue;const k=this._findTileCoveringTileID(C.tileID,this.proxySourceCache);if(k&&k.tileID.canonical.z!==C.tileID.canonical.z){const z=this.proxyToSource[k.tileID.key][n.id],R=this._createProxiedId(k.tileID,C,d[k.tileID.key]&&d[k.tileID.key][n.id]);z?z.splice(z.length-1,0,R):this.proxyToSource[k.tileID.key][n.id]=[R],_.push(R),w=!0}}this._sourceTilesOverlap[n.id]=w}_setupProxiedCoordsForImageSource(n,a,d){if(!n.getSource().loaded())return;const _=this.proxiedCoords[n.id]=[],g=this.proxyCoords,w=n.getSource(),E=new s.pointGeometry(w.tileID.x,w.tileID.y)._div(1<<w.tileID.z),C=w.coordinates.map(s.MercatorCoordinate.fromLngLat).reduce((z,R)=>(z.min.x=Math.min(z.min.x,R.x-E.x),z.min.y=Math.min(z.min.y,R.y-E.y),z.max.x=Math.max(z.max.x,R.x-E.x),z.max.y=Math.max(z.max.y,R.y-E.y),z),{min:new s.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),k=(z,R)=>{const j=z.wrap+z.canonical.x/(1<<z.canonical.z),K=z.canonical.y/(1<<z.canonical.z),W=s.EXTENT/(1<<z.canonical.z),H=R.wrap+R.canonical.x/(1<<R.canonical.z),X=R.canonical.y/(1<<R.canonical.z);return j+W<H+C.min.x||j>H+C.max.x||K+W<X+C.min.y||K>X+C.max.y};for(let z=0;z<g.length;z++){const R=g[z];for(let j=0;j<a.length;j++){const K=n.getTile(a[j]);if(!K||!K.hasData()||k(R,K.tileID))continue;const W=this._createProxiedId(R,K,d[R.key]&&d[R.key][n.id]),H=this.proxyToSource[R.key][n.id];H?H.push(W):this.proxyToSource[R.key][n.id]=[W],_.push(W)}}}_createProxiedId(n,a,d){let _=this.orthoMatrix;if(d){const g=d.find(w=>w.key===a.tileID.key);if(g)return g}if(a.tileID.key!==n.key){const g=n.canonical.z-a.tileID.canonical.z;let w,E,C;_=s.create();const k=a.tileID.wrap-n.wrap<<n.overscaledZ;g>0?(w=s.EXTENT>>g,E=w*((a.tileID.canonical.x<<g)-n.canonical.x+k),C=w*((a.tileID.canonical.y<<g)-n.canonical.y)):(w=s.EXTENT<<-g,E=s.EXTENT*(a.tileID.canonical.x-(n.canonical.x+k<<-g)),C=s.EXTENT*(a.tileID.canonical.y-(n.canonical.y<<-g))),s.ortho(_,0,w,0,w,0,1),s.translate(_,_,[E,C,0])}return new zl(a.tileID,n.key,_)}_findTileCoveringTileID(n,a){let d=a.getTile(n);if(d&&d.hasData())return d;const _=this._findCoveringTileCache[a.id],g=_[n.key];if(d=g?a.getTileByID(g):null,d&&d.hasData()||g===null)return d;let w=d?d.tileID:n,E=w.overscaledZ;const C=a.getSource().minzoom,k=[];if(!g){const R=a.getSource().maxzoom;if(n.canonical.z>=R){const j=n.canonical.z-R;a.getSource().reparseOverscaled?(E=Math.max(n.canonical.z+2,a.transform.tileZoom),w=new s.OverscaledTileID(E,n.wrap,R,n.canonical.x>>j,n.canonical.y>>j)):j!==0&&(E=R,w=new s.OverscaledTileID(E,n.wrap,R,n.canonical.x>>j,n.canonical.y>>j))}w.key!==n.key&&(k.push(w.key),d=a.getTile(w))}const z=R=>{k.forEach(j=>{_[j]=R}),k.length=0};for(E-=1;E>=C&&(!d||!d.hasData());E--){d&&z(d.tileID.key);const R=w.calculateScaledKey(E);if(d=a.getTileByID(R),d&&d.hasData())break;const j=_[R];if(j===null)break;j===void 0?k.push(R):d=a.getTileByID(j)}return z(d?d.tileID.key:null),d&&d.hasData()?d:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,a){let d=this._tilesDirty[n];d||(d=this._tilesDirty[n]={}),d[a.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const n=function(a){let d=0;const _=new s.StructArrayLayout2ui4,g=131;for(let w=1;w<129;w++){for(let E=1;E<129;E++)d=w*g+E,_.emplaceBack(d,d+1),_.emplaceBack(d,d+g),_.emplaceBack(d+1,d+g),w===128&&_.emplaceBack(d+g,d+g+1);_.emplaceBack(d+1,d+1+g)}return _}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(n),this.wireframeSegments=s.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,n.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class cu{static cacheKey(n,a,d,_){let g=`${a}${_?_.cacheKey:""}`;for(const w of d)n.usedDefines.includes(w)&&(g+=`/${w}`);return g}constructor(n,a,d,_,g,w){const E=n.gl;this.program=E.createProgram();const C=function(X){const G=[];for(let te=0;te<X.length;te++){if(X[te]===null)continue;const Y=X[te].split(" ");G.push(Y.pop())}return G}(d.staticAttributes),k=_?_.getBinderAttributes():[],z=C.concat(k);let R=_?_.defines():[];R=R.concat(w.map(X=>`#define ${X}`));const j=R.concat(n.extStandardDerivatives?`#extension GL_OES_standard_derivatives : enable
`.concat(Al):Al,Al,Cl,Ta.fragmentSource,Qo.fragmentSource,d.fragmentSource).join(`
`),K=R.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Cl,Ta.vertexSource,Qo.vertexSource,Sl.vertexSource,d.vertexSource).join(`
`),W=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(W,j),E.compileShader(W),E.attachShader(this.program,W);const H=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())this.failedToCreate=!0;else{E.shaderSource(H,K),E.compileShader(H),E.attachShader(this.program,H),this.attributes={},this.numAttributes=z.length;for(let X=0;X<this.numAttributes;X++)z[X]&&(E.bindAttribLocation(this.program,X,z[X]),this.attributes[z[X]]=X);E.linkProgram(this.program),E.deleteShader(H),E.deleteShader(W),this.fixedUniforms=g(n),this.binderUniforms=_?_.getUniforms(n):[],w.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=(X=>({u_dem:new s.Uniform1i(X),u_dem_prev:new s.Uniform1i(X),u_dem_unpack:new s.Uniform4f(X),u_dem_tl:new s.Uniform2f(X),u_dem_scale:new s.Uniform1f(X),u_dem_tl_prev:new s.Uniform2f(X),u_dem_scale_prev:new s.Uniform1f(X),u_dem_size:new s.Uniform1f(X),u_dem_lerp:new s.Uniform1f(X),u_exaggeration:new s.Uniform1f(X),u_depth:new s.Uniform1i(X),u_depth_size_inv:new s.Uniform2f(X),u_meter_to_dem:new s.Uniform1f(X),u_label_plane_matrix_inv:new s.UniformMatrix4f(X),u_tile_tl_up:new s.Uniform3f(X),u_tile_tr_up:new s.Uniform3f(X),u_tile_br_up:new s.Uniform3f(X),u_tile_bl_up:new s.Uniform3f(X),u_tile_up_scale:new s.Uniform1f(X)}))(n)),w.indexOf("FOG")!==-1&&(this.fogUniforms=(X=>({u_fog_matrix:new s.UniformMatrix4f(X),u_fog_range:new s.Uniform2f(X),u_fog_color:new s.Uniform4f(X),u_fog_horizon_blend:new s.Uniform1f(X),u_fog_temporal_offset:new s.Uniform1f(X),u_frustum_tl:new s.Uniform3f(X),u_frustum_tr:new s.Uniform3f(X),u_frustum_br:new s.Uniform3f(X),u_frustum_bl:new s.Uniform3f(X),u_globe_pos:new s.Uniform3f(X),u_globe_radius:new s.Uniform1f(X),u_globe_transition:new s.Uniform1f(X),u_is_globe:new s.Uniform1i(X),u_viewport:new s.Uniform2f(X)}))(n))}}setTerrainUniformValues(n,a){if(!this.terrainUniforms)return;const d=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in a)d[_].set(this.program,_,a[_])}}setFogUniformValues(n,a){if(!this.fogUniforms)return;const d=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in a)d[_].set(this.program,_,a[_])}}draw(n,a,d,_,g,w,E,C,k,z,R,j,K,W,H){const X=n.gl;if(this.failedToCreate)return;n.program.set(this.program),n.setDepthMode(d),n.setStencilMode(_),n.setColorMode(g),n.setCullFace(w);for(const te of Object.keys(this.fixedUniforms))this.fixedUniforms[te].set(this.program,te,E[te]);W&&W.setUniforms(this.program,n,this.binderUniforms,j,{zoom:K});const G={[X.LINES]:2,[X.TRIANGLES]:3,[X.LINE_STRIP]:1}[a];for(const te of R.get()){const Y=te.vaos||(te.vaos={});(Y[C]||(Y[C]=new Il)).bind(n,this,k,W?W.getPaintVertexBuffers():[],z,te.vertexOffset,H||[]),X.drawElements(a,te.primitiveLength*G,X.UNSIGNED_SHORT,te.primitiveOffset*G*2)}}}function nd(c,n,a){const d=1/pi(a,1,n.transform.tileZoom),_=Math.pow(2,a.tileID.overscaledZ),g=a.tileSize*Math.pow(2,n.transform.tileZoom)/_,w=g*(a.tileID.canonical.x+a.tileID.wrap*_),E=g*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[d,c.fromScale,c.toScale],u_fade:c.t,u_pixel_coord_upper:[w>>16,E>>16],u_pixel_coord_lower:[65535&w,65535&E]}}const Ca=s.create(),ks=(c,n,a,d,_,g,w,E,C,k,z)=>{const R=n.style.light,j=R.properties.get("position"),K=[j.x,j.y,j.z],W=s.create$1();R.properties.get("anchor")==="viewport"&&(s.fromRotation(W,-n.transform.angle),s.transformMat3(K,K,W));const H=R.properties.get("color"),X=n.transform,G={u_matrix:c,u_lightpos:K,u_lightintensity:R.properties.get("intensity"),u_lightcolor:[H.r,H.g,H.b],u_vertical_gradient:+a,u_opacity:d,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ca,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:_,u_edge_radius:g};return X.projection.name==="globe"&&(G.u_tile_id=[w.canonical.x,w.canonical.y,1<<w.canonical.z],G.u_zoom_transition=C,G.u_inv_rot_matrix=z,G.u_merc_center=k,G.u_up_dir=X.projection.upVector(new s.CanonicalTileID(0,0,0),k[0]*s.EXTENT,k[1]*s.EXTENT),G.u_height_lift=E),G},rd=(c,n,a,d,_,g,w,E,C,k,z,R,j)=>{const K=ks(c,n,a,d,_,g,w,k,z,R,j),W={u_height_factor:-Math.pow(2,w.overscaledZ)/C.tileSize/8};return s.extend(K,nd(E,n,C),W)},Aa=c=>({u_matrix:c}),Pl=(c,n,a,d)=>s.extend(Aa(c),nd(a,n,d)),$r=(c,n)=>({u_matrix:c,u_world:n}),uu=(c,n,a,d,_)=>s.extend(Pl(c,n,a,d),{u_world:_}),od=s.create(),hu=(c,n,a,d,_,g)=>{const w=c.transform,E=w.projection.name==="globe";let C;if(g.paint.get("circle-pitch-alignment")==="map")if(E){const z=s.globePixelsToTileUnits(w.zoom,n.canonical)*w._pixelsPerMercatorPixel;C=Float32Array.from([z,0,0,z])}else C=w.calculatePixelsToTileUnitsMatrix(a);else C=new Float32Array([w.pixelsToGLUnits[0],0,0,w.pixelsToGLUnits[1]]);const k={u_camera_to_center_distance:w.cameraToCenterDistance,u_matrix:c.translatePosMatrix(n.projMatrix,a,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_device_pixel_ratio:s.exported.devicePixelRatio,u_extrude_scale:C,u_inv_rot_matrix:od,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(E){k.u_inv_rot_matrix=d,k.u_merc_center=_,k.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],k.u_zoom_transition=s.globeToMercatorTransition(w.zoom);const z=_[0]*s.EXTENT,R=_[1]*s.EXTENT;k.u_up_dir=w.projection.upVector(new s.CanonicalTileID(0,0,0),z,R)}return k},sd=c=>{const n=[];return c.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),c.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n},du=(c,n,a,d)=>{const _=s.EXTENT/a.tileSize;return{u_matrix:c,u_camera_to_center_distance:n.getCameraToCenterDistance(d),u_extrude_scale:[n.pixelsToGLUnits[0]/_,n.pixelsToGLUnits[1]/_]}},ad=(c,n,a=1)=>({u_matrix:c,u_color:n,u_overlay:0,u_overlay_scale:a}),fu=s.create(),Up=(c,n,a,d,_,g,w)=>{const E=c.transform,C=E.projection.name==="globe",k=C?s.globePixelsToTileUnits(E.zoom,n.canonical)*E._pixelsPerMercatorPixel:pi(a,1,g),z={u_matrix:n.projMatrix,u_extrude_scale:k,u_intensity:w,u_inv_rot_matrix:fu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){z.u_inv_rot_matrix=d,z.u_merc_center=_,z.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],z.u_zoom_transition=s.globeToMercatorTransition(E.zoom);const R=_[0]*s.EXTENT,j=_[1]*s.EXTENT;z.u_up_dir=E.projection.upVector(new s.CanonicalTileID(0,0,0),R,j)}return z},Dl=(c,n,a,d,_,g,w,E)=>{const C=c.transform,k=C.calculatePixelsToTileUnitsMatrix(n),z={u_matrix:ld(c,n,a,_),u_pixels_to_tile_units:k,u_device_pixel_ratio:w,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:g,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:E};if(Bl(a)){const R=Ll(n,c.transform);z.u_texsize=n.lineAtlasTexture.size,z.u_scale=[R,d.fromScale,d.toScale],z.u_mix=d.t}return z},Np=(c,n,a,d,_,g)=>{const w=c.transform,E=Ll(n,w);return{u_matrix:ld(c,n,a,_),u_texsize:n.imageAtlasTexture.size,u_pixels_to_tile_units:w.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:g,u_image:0,u_scale:[E,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Ll(c,n){return 1/pi(c,1,n.tileZoom)}function ld(c,n,a,d){return c.translatePosMatrix(d||n.tileID.projMatrix,n,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}function Bl(c){const n=c.paint.get("line-dasharray").value;return n.value||n.kind!=="constant"}const jp=(c,n,a,d,_,g)=>{return{u_matrix:c,u_tl_parent:n,u_scale_parent:a,u_fade_t:d.mix,u_opacity:d.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(E=_.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(w=_.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:Rl(_.paint.get("raster-hue-rotate")),u_perspective_transform:g};var w,E};function Rl(c){c*=Math.PI/180;const n=Math.sin(c),a=Math.cos(c);return[(2*a+1)/3,(-Math.sqrt(3)*n-a+1)/3,(Math.sqrt(3)*n-a+1)/3]}const cd=s.create(),pu=(c,n,a,d,_,g,w,E,C,k,z,R,j,K,W,H)=>{const X=_.transform,G={u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:X.cameraToCenterDistance,u_rotate_symbol:+a,u_aspect_ratio:X.width/X.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:g,u_label_plane_matrix:w,u_coord_matrix:E,u_is_text:+C,u_pitch_with_map:+d,u_texsize:k,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:cd,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:cd,u_up_vector:[0,-1,0]};return H.name==="globe"&&(G.u_tile_id=[z.canonical.x,z.canonical.y,1<<z.canonical.z],G.u_zoom_transition=R,G.u_inv_rot_matrix=K,G.u_merc_center=j,G.u_camera_forward=X._camera.forward(),G.u_ecef_origin=s.globeECEFOrigin(X.globeMatrix,z.toUnwrapped()),G.u_tile_matrix=Float32Array.from(X.globeMatrix),G.u_up_vector=W),G},mu=(c,n,a,d,_,g,w,E,C,k,z,R,j,K,W,H,X)=>s.extend(pu(c,n,a,d,_,g,w,E,C,k,R,j,K,W,H,X),{u_gamma_scale:d?_.transform.cameraToCenterDistance*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:s.exported.devicePixelRatio,u_is_halo:+z}),zs=(c,n,a,d,_,g,w,E,C,k,z,R,j,K,W,H)=>s.extend(mu(c,n,a,d,_,g,w,E,!0,C,!0,z,R,j,K,W,H),{u_texsize_icon:k,u_texture_icon:1}),qp=(c,n,a)=>({u_matrix:c,u_opacity:n,u_color:a}),$p=(c,n,a,d,_,g)=>s.extend(function(w,E,C,k){const z=C.imageManager.getPattern(w.from.toString()),R=C.imageManager.getPattern(w.to.toString()),{width:j,height:K}=C.imageManager.getPixelSize(),W=Math.pow(2,k.tileID.overscaledZ),H=k.tileSize*Math.pow(2,C.transform.tileZoom)/W,X=H*(k.tileID.canonical.x+k.tileID.wrap*W),G=H*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:R.tl,u_pattern_br_b:R.br,u_texsize:[j,K],u_mix:E.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:R.displaySize,u_scale_a:E.fromScale,u_scale_b:E.toScale,u_tile_units_to_pixels:1/pi(k,1,C.transform.tileZoom),u_pixel_coord_upper:[X>>16,G>>16],u_pixel_coord_lower:[65535&X,65535&G]}}(d,g,a,_),{u_matrix:c,u_opacity:n}),Gp={fillExtrusion:c=>({u_matrix:new s.UniformMatrix4f(c),u_lightpos:new s.Uniform3f(c),u_lightintensity:new s.Uniform1f(c),u_lightcolor:new s.Uniform3f(c),u_vertical_gradient:new s.Uniform1f(c),u_opacity:new s.Uniform1f(c),u_edge_radius:new s.Uniform1f(c),u_ao:new s.Uniform2f(c),u_tile_id:new s.Uniform3f(c),u_zoom_transition:new s.Uniform1f(c),u_inv_rot_matrix:new s.UniformMatrix4f(c),u_merc_center:new s.Uniform2f(c),u_up_dir:new s.Uniform3f(c),u_height_lift:new s.Uniform1f(c)}),fillExtrusionPattern:c=>({u_matrix:new s.UniformMatrix4f(c),u_lightpos:new s.Uniform3f(c),u_lightintensity:new s.Uniform1f(c),u_lightcolor:new s.Uniform3f(c),u_vertical_gradient:new s.Uniform1f(c),u_height_factor:new s.Uniform1f(c),u_edge_radius:new s.Uniform1f(c),u_ao:new s.Uniform2f(c),u_tile_id:new s.Uniform3f(c),u_zoom_transition:new s.Uniform1f(c),u_inv_rot_matrix:new s.UniformMatrix4f(c),u_merc_center:new s.Uniform2f(c),u_up_dir:new s.Uniform3f(c),u_height_lift:new s.Uniform1f(c),u_image:new s.Uniform1i(c),u_texsize:new s.Uniform2f(c),u_pixel_coord_upper:new s.Uniform2f(c),u_pixel_coord_lower:new s.Uniform2f(c),u_scale:new s.Uniform3f(c),u_fade:new s.Uniform1f(c),u_opacity:new s.Uniform1f(c)}),fill:c=>({u_matrix:new s.UniformMatrix4f(c)}),fillPattern:c=>({u_matrix:new s.UniformMatrix4f(c),u_image:new s.Uniform1i(c),u_texsize:new s.Uniform2f(c),u_pixel_coord_upper:new s.Uniform2f(c),u_pixel_coord_lower:new s.Uniform2f(c),u_scale:new s.Uniform3f(c),u_fade:new s.Uniform1f(c)}),fillOutline:c=>({u_matrix:new s.UniformMatrix4f(c),u_world:new s.Uniform2f(c)}),fillOutlinePattern:c=>({u_matrix:new s.UniformMatrix4f(c),u_world:new s.Uniform2f(c),u_image:new s.Uniform1i(c),u_texsize:new s.Uniform2f(c),u_pixel_coord_upper:new s.Uniform2f(c),u_pixel_coord_lower:new s.Uniform2f(c),u_scale:new s.Uniform3f(c),u_fade:new s.Uniform1f(c)}),circle:c=>({u_camera_to_center_distance:new s.Uniform1f(c),u_extrude_scale:new s.UniformMatrix2f(c),u_device_pixel_ratio:new s.Uniform1f(c),u_matrix:new s.UniformMatrix4f(c),u_inv_rot_matrix:new s.UniformMatrix4f(c),u_merc_center:new s.Uniform2f(c),u_tile_id:new s.Uniform3f(c),u_zoom_transition:new s.Uniform1f(c),u_up_dir:new s.Uniform3f(c)}),collisionBox:c=>({u_matrix:new s.UniformMatrix4f(c),u_camera_to_center_distance:new s.Uniform1f(c),u_extrude_scale:new s.Uniform2f(c)}),collisionCircle:c=>({u_matrix:new s.UniformMatrix4f(c),u_inv_matrix:new s.UniformMatrix4f(c),u_camera_to_center_distance:new s.Uniform1f(c),u_viewport_size:new s.Uniform2f(c)}),debug:c=>({u_color:new s.UniformColor(c),u_matrix:new s.UniformMatrix4f(c),u_overlay:new s.Uniform1i(c),u_overlay_scale:new s.Uniform1f(c)}),clippingMask:c=>({u_matrix:new s.UniformMatrix4f(c)}),heatmap:c=>({u_extrude_scale:new s.Uniform1f(c),u_intensity:new s.Uniform1f(c),u_matrix:new s.UniformMatrix4f(c),u_inv_rot_matrix:new s.UniformMatrix4f(c),u_merc_center:new s.Uniform2f(c),u_tile_id:new s.Uniform3f(c),u_zoom_transition:new s.Uniform1f(c),u_up_dir:new s.Uniform3f(c)}),heatmapTexture:c=>({u_image:new s.Uniform1i(c),u_color_ramp:new s.Uniform1i(c),u_opacity:new s.Uniform1f(c)}),hillshade:c=>({u_matrix:new s.UniformMatrix4f(c),u_image:new s.Uniform1i(c),u_latrange:new s.Uniform2f(c),u_light:new s.Uniform2f(c),u_shadow:new s.UniformColor(c),u_highlight:new s.UniformColor(c),u_accent:new s.UniformColor(c)}),hillshadePrepare:c=>({u_matrix:new s.UniformMatrix4f(c),u_image:new s.Uniform1i(c),u_dimension:new s.Uniform2f(c),u_zoom:new s.Uniform1f(c),u_unpack:new s.Uniform4f(c)}),line:c=>({u_matrix:new s.UniformMatrix4f(c),u_pixels_to_tile_units:new s.UniformMatrix2f(c),u_device_pixel_ratio:new s.Uniform1f(c),u_units_to_pixels:new s.Uniform2f(c),u_dash_image:new s.Uniform1i(c),u_gradient_image:new s.Uniform1i(c),u_image_height:new s.Uniform1f(c),u_texsize:new s.Uniform2f(c),u_scale:new s.Uniform3f(c),u_mix:new s.Uniform1f(c),u_alpha_discard_threshold:new s.Uniform1f(c),u_trim_offset:new s.Uniform2f(c)}),linePattern:c=>({u_matrix:new s.UniformMatrix4f(c),u_texsize:new s.Uniform2f(c),u_pixels_to_tile_units:new s.UniformMatrix2f(c),u_device_pixel_ratio:new s.Uniform1f(c),u_image:new s.Uniform1i(c),u_units_to_pixels:new s.Uniform2f(c),u_scale:new s.Uniform3f(c),u_fade:new s.Uniform1f(c),u_alpha_discard_threshold:new s.Uniform1f(c)}),raster:c=>({u_matrix:new s.UniformMatrix4f(c),u_tl_parent:new s.Uniform2f(c),u_scale_parent:new s.Uniform1f(c),u_fade_t:new s.Uniform1f(c),u_opacity:new s.Uniform1f(c),u_image0:new s.Uniform1i(c),u_image1:new s.Uniform1i(c),u_brightness_low:new s.Uniform1f(c),u_brightness_high:new s.Uniform1f(c),u_saturation_factor:new s.Uniform1f(c),u_contrast_factor:new s.Uniform1f(c),u_spin_weights:new s.Uniform3f(c),u_perspective_transform:new s.Uniform2f(c)}),symbolIcon:c=>({u_is_size_zoom_constant:new s.Uniform1i(c),u_is_size_feature_constant:new s.Uniform1i(c),u_size_t:new s.Uniform1f(c),u_size:new s.Uniform1f(c),u_camera_to_center_distance:new s.Uniform1f(c),u_rotate_symbol:new s.Uniform1i(c),u_aspect_ratio:new s.Uniform1f(c),u_fade_change:new s.Uniform1f(c),u_matrix:new s.UniformMatrix4f(c),u_label_plane_matrix:new s.UniformMatrix4f(c),u_coord_matrix:new s.UniformMatrix4f(c),u_is_text:new s.Uniform1i(c),u_pitch_with_map:new s.Uniform1i(c),u_texsize:new s.Uniform2f(c),u_tile_id:new s.Uniform3f(c),u_zoom_transition:new s.Uniform1f(c),u_inv_rot_matrix:new s.UniformMatrix4f(c),u_merc_center:new s.Uniform2f(c),u_camera_forward:new s.Uniform3f(c),u_tile_matrix:new s.UniformMatrix4f(c),u_up_vector:new s.Uniform3f(c),u_ecef_origin:new s.Uniform3f(c),u_texture:new s.Uniform1i(c)}),symbolSDF:c=>({u_is_size_zoom_constant:new s.Uniform1i(c),u_is_size_feature_constant:new s.Uniform1i(c),u_size_t:new s.Uniform1f(c),u_size:new s.Uniform1f(c),u_camera_to_center_distance:new s.Uniform1f(c),u_rotate_symbol:new s.Uniform1i(c),u_aspect_ratio:new s.Uniform1f(c),u_fade_change:new s.Uniform1f(c),u_matrix:new s.UniformMatrix4f(c),u_label_plane_matrix:new s.UniformMatrix4f(c),u_coord_matrix:new s.UniformMatrix4f(c),u_is_text:new s.Uniform1i(c),u_pitch_with_map:new s.Uniform1i(c),u_texsize:new s.Uniform2f(c),u_texture:new s.Uniform1i(c),u_gamma_scale:new s.Uniform1f(c),u_device_pixel_ratio:new s.Uniform1f(c),u_tile_id:new s.Uniform3f(c),u_zoom_transition:new s.Uniform1f(c),u_inv_rot_matrix:new s.UniformMatrix4f(c),u_merc_center:new s.Uniform2f(c),u_camera_forward:new s.Uniform3f(c),u_tile_matrix:new s.UniformMatrix4f(c),u_up_vector:new s.Uniform3f(c),u_ecef_origin:new s.Uniform3f(c),u_is_halo:new s.Uniform1i(c)}),symbolTextAndIcon:c=>({u_is_size_zoom_constant:new s.Uniform1i(c),u_is_size_feature_constant:new s.Uniform1i(c),u_size_t:new s.Uniform1f(c),u_size:new s.Uniform1f(c),u_camera_to_center_distance:new s.Uniform1f(c),u_rotate_symbol:new s.Uniform1i(c),u_aspect_ratio:new s.Uniform1f(c),u_fade_change:new s.Uniform1f(c),u_matrix:new s.UniformMatrix4f(c),u_label_plane_matrix:new s.UniformMatrix4f(c),u_coord_matrix:new s.UniformMatrix4f(c),u_is_text:new s.Uniform1i(c),u_pitch_with_map:new s.Uniform1i(c),u_texsize:new s.Uniform2f(c),u_texsize_icon:new s.Uniform2f(c),u_texture:new s.Uniform1i(c),u_texture_icon:new s.Uniform1i(c),u_gamma_scale:new s.Uniform1f(c),u_device_pixel_ratio:new s.Uniform1f(c),u_is_halo:new s.Uniform1i(c)}),background:c=>({u_matrix:new s.UniformMatrix4f(c),u_opacity:new s.Uniform1f(c),u_color:new s.UniformColor(c)}),backgroundPattern:c=>({u_matrix:new s.UniformMatrix4f(c),u_opacity:new s.Uniform1f(c),u_image:new s.Uniform1i(c),u_pattern_tl_a:new s.Uniform2f(c),u_pattern_br_a:new s.Uniform2f(c),u_pattern_tl_b:new s.Uniform2f(c),u_pattern_br_b:new s.Uniform2f(c),u_texsize:new s.Uniform2f(c),u_mix:new s.Uniform1f(c),u_pattern_size_a:new s.Uniform2f(c),u_pattern_size_b:new s.Uniform2f(c),u_scale_a:new s.Uniform1f(c),u_scale_b:new s.Uniform1f(c),u_pixel_coord_upper:new s.Uniform2f(c),u_pixel_coord_lower:new s.Uniform2f(c),u_tile_units_to_pixels:new s.Uniform1f(c)}),terrainRaster:Ea,terrainDepth:Ea,skybox:c=>({u_matrix:new s.UniformMatrix4f(c),u_sun_direction:new s.Uniform3f(c),u_cubemap:new s.Uniform1i(c),u_opacity:new s.Uniform1f(c),u_temporal_offset:new s.Uniform1f(c)}),skyboxGradient:c=>({u_matrix:new s.UniformMatrix4f(c),u_color_ramp:new s.Uniform1i(c),u_center_direction:new s.Uniform3f(c),u_radius:new s.Uniform1f(c),u_opacity:new s.Uniform1f(c),u_temporal_offset:new s.Uniform1f(c)}),skyboxCapture:c=>({u_matrix_3f:new s.UniformMatrix3f(c),u_sun_direction:new s.Uniform3f(c),u_sun_intensity:new s.Uniform1f(c),u_color_tint_r:new s.Uniform4f(c),u_color_tint_m:new s.Uniform4f(c),u_luminance:new s.Uniform1f(c)}),globeRaster:c=>({u_proj_matrix:new s.UniformMatrix4f(c),u_globe_matrix:new s.UniformMatrix4f(c),u_normalize_matrix:new s.UniformMatrix4f(c),u_merc_matrix:new s.UniformMatrix4f(c),u_zoom_transition:new s.Uniform1f(c),u_merc_center:new s.Uniform2f(c),u_image0:new s.Uniform1i(c),u_grid_matrix:new s.UniformMatrix3f(c),u_frustum_tl:new s.Uniform3f(c),u_frustum_tr:new s.Uniform3f(c),u_frustum_br:new s.Uniform3f(c),u_frustum_bl:new s.Uniform3f(c),u_globe_pos:new s.Uniform3f(c),u_globe_radius:new s.Uniform1f(c),u_viewport:new s.Uniform2f(c)}),globeAtmosphere:c=>({u_frustum_tl:new s.Uniform3f(c),u_frustum_tr:new s.Uniform3f(c),u_frustum_br:new s.Uniform3f(c),u_frustum_bl:new s.Uniform3f(c),u_horizon:new s.Uniform1f(c),u_transition:new s.Uniform1f(c),u_fadeout_range:new s.Uniform1f(c),u_color:new s.Uniform4f(c),u_high_color:new s.Uniform4f(c),u_space_color:new s.Uniform4f(c),u_star_intensity:new s.Uniform1f(c),u_star_density:new s.Uniform1f(c),u_star_size:new s.Uniform1f(c),u_temporal_offset:new s.Uniform1f(c),u_horizon_angle:new s.Uniform1f(c),u_rotation_matrix:new s.UniformMatrix4f(c)})};let Ol;function ud(c,n,a,d,_,g,w){const E=c.context,C=E.gl,k=c.transform,z=c.useProgram("collisionBox"),R=[];let j=0,K=0;for(let me=0;me<d.length;me++){const fe=d[me],oe=n.getTile(fe),pe=oe.getBucket(a);if(!pe)continue;const ue=lr(fe,pe,k);let be=ue;_[0]===0&&_[1]===0||(be=c.translatePosMatrix(ue,oe,_,g));const Be=w?pe.textCollisionBox:pe.iconCollisionBox,dt=pe.collisionCircleArray;if(dt.length>0){const Ie=s.create(),Je=be;s.mul(Ie,pe.placementInvProjMatrix,k.glCoordMatrix),s.mul(Ie,Ie,pe.placementViewportMatrix),R.push({circleArray:dt,circleOffset:K,transform:Je,invTransform:Ie,projection:pe.getProjection()}),j+=dt.length/4,K=j}Be&&(c.terrain&&c.terrain.setupElevationDraw(oe,z),z.draw(E,C.LINES,s.DepthMode.disabled,s.StencilMode.disabled,c.colorModeForRenderPass(),s.CullFaceMode.disabled,du(be,k,oe,pe.getProjection()),a.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,null,k.zoom,null,[Be.collisionVertexBuffer,Be.collisionVertexBufferExt]))}if(!w||!R.length)return;const W=c.useProgram("collisionCircle"),H=new s.StructArrayLayout2f1f2i16;H.resize(4*j),H._trim();let X=0;for(const me of R)for(let fe=0;fe<me.circleArray.length/4;fe++){const oe=4*fe,pe=me.circleArray[oe+0],ue=me.circleArray[oe+1],be=me.circleArray[oe+2],Be=me.circleArray[oe+3];H.emplace(X++,pe,ue,be,Be,0),H.emplace(X++,pe,ue,be,Be,1),H.emplace(X++,pe,ue,be,Be,2),H.emplace(X++,pe,ue,be,Be,3)}(!Ol||Ol.length<2*j)&&(Ol=function(me){const fe=2*me,oe=new s.StructArrayLayout3ui6;oe.resize(fe),oe._trim();for(let pe=0;pe<fe;pe++){const ue=6*pe;oe.uint16[ue+0]=4*pe+0,oe.uint16[ue+1]=4*pe+1,oe.uint16[ue+2]=4*pe+2,oe.uint16[ue+3]=4*pe+2,oe.uint16[ue+4]=4*pe+3,oe.uint16[ue+5]=4*pe+0}return oe}(j));const G=E.createIndexBuffer(Ol,!0),te=E.createVertexBuffer(H,s.collisionCircleLayout.members,!0);for(const me of R){const fe={u_matrix:me.transform,u_inv_matrix:me.invTransform,u_camera_to_center_distance:(Y=k).getCameraToCenterDistance(me.projection),u_viewport_size:[Y.width,Y.height]};W.draw(E,C.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,c.colorModeForRenderPass(),s.CullFaceMode.disabled,fe,a.id,te,G,s.SegmentVector.simpleSegment(0,2*me.circleOffset,me.circleArray.length,me.circleArray.length/2),null,k.zoom)}var Y;te.destroy(),G.destroy()}const hd=s.create();function _u(c,n,a,d,_,g){const{horizontalAlign:w,verticalAlign:E}=s.getAnchorAlignment(c),C=-(w-.5)*n,k=-(E-.5)*a,z=s.evaluateVariableOffset(c,d);return new s.pointGeometry((C/_+z[0])*g,(k/_+z[1])*g)}function gu(c,n,a,d,_,g,w,E,C,k,z){const R=c.text.placedSymbolArray,j=c.text.dynamicLayoutVertexArray,K=c.icon.dynamicLayoutVertexArray,W={},H=cr(E,c.getProjection(),g),X=g.elevation,G=c.getProjection().upVectorScale(E.canonical,g.center.lat,g.worldSize);j.clear();for(let te=0;te<R.length;te++){const Y=R.get(te),me=c.allowVerticalPlacement&&!Y.placedOrientation,fe=Y.hidden||!Y.crossTileID||me?null:d[Y.crossTileID];if(fe){const oe=new s.pointGeometry(Y.tileAnchorX,Y.tileAnchorY),pe=c.getProjection().upVector(E.canonical,oe.x,oe.y),ue=X?X.getAtTileOffset(E,oe.x,oe.y):0,be=ui([Y.projectedAnchorX+ue*pe[0]*G.metersToTile,Y.projectedAnchorY+ue*pe[1]*G.metersToTile,Y.projectedAnchorZ+ue*pe[2]*G.metersToTile],a?H:w),Be=ma(g.getCameraToCenterDistance(c.getProjection()),be.signedDistanceFromCamera);let dt=_.evaluateSizeForFeature(c.textSizeData,k,Y)*Be/s.ONE_EM;a&&(dt*=c.tilePixelRatio/C);const{width:Ie,height:Je,anchor:rt,textOffset:wt,textScale:qe}=fe,mt=_u(rt,Ie,Je,wt,qe,dt);let it;if(a){const St=oe.add(mt),{x:Vt,y:Wt,z:ii}=c.getProjection().projectTilePoint(St.x,St.y,E.canonical);it=ui([Vt+ue*pe[0]*G.metersToTile,Wt+ue*pe[1]*G.metersToTile,ii+ue*pe[2]*G.metersToTile],w).point}else{const St=n?mt.rotate(-g.angle):mt;it=[be.point[0]+St.x,be.point[1]+St.y,0]}const It=c.allowVerticalPlacement&&Y.placedOrientation===s.WritingMode.vertical?Math.PI/2:0;for(let St=0;St<Y.numGlyphs;St++)s.addDynamicAttributes(j,it[0],it[1],it[2],It);z&&Y.associatedIconIndex>=0&&(W[Y.associatedIconIndex]={shiftedAnchor:it,angle:It})}else Io(Y.numGlyphs,j)}if(z){K.clear();const te=c.icon.placedSymbolArray;for(let Y=0;Y<te.length;Y++){const me=te.get(Y);if(me.hidden)Io(me.numGlyphs,K);else{const fe=W[Y];if(fe)for(let oe=0;oe<me.numGlyphs;oe++)s.addDynamicAttributes(K,fe.shiftedAnchor[0],fe.shiftedAnchor[1],fe.shiftedAnchor[2],fe.angle);else Io(me.numGlyphs,K)}}c.icon.dynamicLayoutVertexBuffer.updateData(K)}c.text.dynamicLayoutVertexBuffer.updateData(j)}function dd(c,n,a){return a.iconsInText&&n?"symbolTextAndIcon":c?"symbolSDF":"symbolIcon"}function yu(c,n,a,d,_,g,w,E,C,k,z,R){const j=c.context,K=j.gl,W=c.transform,H=E==="map",X=C==="map",G=H&&a.layout.get("symbol-placement")!=="point",te=H&&!X&&!G,Y=a.layout.get("symbol-sort-key").constantOr(1)!==void 0;let me=!1;const fe=c.depthModeForSublayer(0,s.DepthMode.ReadOnly),oe=[s.mercatorXfromLng(W.center.lng),s.mercatorYfromLat(W.center.lat)],pe=a.layout.get("text-variable-anchor"),ue=W.projection.name==="globe",be=[],Be=[0,-1,0];let dt=Be;!ue&&!W.mercatorFromTransition||H||(dt=function(Ie){const Je=Ie._camera.getWorldToCamera(Ie.worldSize,1),rt=s.multiply([],Je,Ie.globeMatrix);s.invert(rt,rt);const wt=[0,0,0],qe=[0,1,0,0];return s.transformMat4$1(qe,qe,rt),wt[0]=qe[0],wt[1]=qe[1],wt[2]=qe[2],s.normalize(wt,wt),wt}(W));for(const Ie of d){const Je=n.getTile(Ie),rt=Je.getBucket(a);if(!rt||rt.projection.name==="mercator"&&ue)continue;const wt=_?rt.text:rt.icon;if(!wt||rt.fullyClipped||!wt.segments.get().length)continue;const qe=wt.programConfigurations.get(a.id),mt=_||rt.sdfIcons,it=_?rt.textSizeData:rt.iconSizeData,It=X||W.pitch!==0,St=s.evaluateSizeForZoom(it,W.zoom);let Vt,Wt,ii,bi,Ut=[0,0],ai=null;if(_){if(Wt=Je.glyphAtlasTexture,ii=K.LINEAR,Vt=Je.glyphAtlasTexture.size,rt.iconsInText){Ut=Je.imageAtlasTexture.size,ai=Je.imageAtlasTexture;const tr=it.kind==="composite"||it.kind==="camera";bi=It||c.options.rotating||c.options.zooming||tr?K.LINEAR:K.NEAREST}}else{const tr=a.layout.get("icon-size").constantOr(0)!==1||rt.iconsNeedLinear;Wt=Je.imageAtlasTexture,ii=mt||c.options.rotating||c.options.zooming||tr||It?K.LINEAR:K.NEAREST,Vt=Je.imageAtlasTexture.size}const Ii=rt.projection.name==="globe",en=Ii?dt:Be,dn=Ii?s.globeToMercatorTransition(W.zoom):0,qi=cr(Ie,rt.getProjection(),W),Fn=W.calculatePixelsToTileUnitsMatrix(Je),Vr=yi(qi,Je.tileID.canonical,X,H,W,rt.getProjection(),Fn),ao=c.terrain&&X&&G?s.invert(s.create(),Vr):hd,tn=Br(qi,Je.tileID.canonical,X,H,W,rt.getProjection(),Fn),rn=pe&&rt.hasTextData(),_i=a.layout.get("icon-text-fit")!=="none"&&rn&&rt.hasIconData();if(G){const tr=W.elevation,ss=tr?tr.getAtTileOffsetFunc(Ie,W.center.lat,W.worldSize,rt.getProjection()):$a=>[0,0,0],Bo=vi(qi,Je.tileID.canonical,X,H,W,rt.getProjection(),Fn);ga(rt,qi,c,_,Bo,tn,X,k,ss,Ie)}const En=G||_&&pe||_i,Zn=c.translatePosMatrix(qi,Je,g,w),Xi=En?hd:Vr,Wn=c.translatePosMatrix(tn,Je,g,w,!0),is=rt.getProjection().createInversionMatrix(W,Ie.canonical),er=[];c.terrain&&X&&er.push("PITCH_WITH_MAP_TERRAIN"),Ii&&er.push("PROJECTION_GLOBE_VIEW"),En&&er.push("PROJECTED_POS_ON_VIEWPORT");const ns=mt&&a.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let rs;rs=mt?rt.iconsInText?zs(it.kind,St,te,X,c,Zn,Xi,Wn,Vt,Ut,Ie,dn,oe,is,en,rt.getProjection()):mu(it.kind,St,te,X,c,Zn,Xi,Wn,_,Vt,!0,Ie,dn,oe,is,en,rt.getProjection()):pu(it.kind,St,te,X,c,Zn,Xi,Wn,_,Vt,Ie,dn,oe,is,en,rt.getProjection());const os={program:c.useProgram(dd(mt,_,rt),qe,er),buffers:wt,uniformValues:rs,atlasTexture:Wt,atlasTextureIcon:ai,atlasInterpolation:ii,atlasInterpolationIcon:bi,isSDF:mt,hasHalo:ns,tile:Je,labelPlaneMatrixInv:ao};if(Y&&rt.canOverlap){me=!0;const tr=wt.segments.get();for(const ss of tr)be.push({segments:new s.SegmentVector([ss]),sortKey:ss.sortKey,state:os})}else be.push({segments:wt.segments,sortKey:0,state:os})}me&&be.sort((Ie,Je)=>Ie.sortKey-Je.sortKey);for(const Ie of be){const Je=Ie.state;if(c.terrain&&c.terrain.setupElevationDraw(Je.tile,Je.program,{useDepthForOcclusion:!ue,labelPlaneMatrixInv:Je.labelPlaneMatrixInv}),j.activeTexture.set(K.TEXTURE0),Je.atlasTexture.bind(Je.atlasInterpolation,K.CLAMP_TO_EDGE),Je.atlasTextureIcon&&(j.activeTexture.set(K.TEXTURE1),Je.atlasTextureIcon&&Je.atlasTextureIcon.bind(Je.atlasInterpolationIcon,K.CLAMP_TO_EDGE)),Je.isSDF){const rt=Je.uniformValues;Je.hasHalo&&(rt.u_is_halo=1,vu(Je.buffers,Ie.segments,a,c,Je.program,fe,z,R,rt)),rt.u_is_halo=0}vu(Je.buffers,Ie.segments,a,c,Je.program,fe,z,R,Je.uniformValues)}}function vu(c,n,a,d,_,g,w,E,C){const k=d.context,z=[c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer,c.globeExtVertexBuffer];_.draw(k,k.gl.TRIANGLES,g,w,E,s.CullFaceMode.disabled,C,a.id,c.layoutVertexBuffer,c.indexBuffer,n,a.paint,d.transform.zoom,c.programConfigurations.get(a.id),z)}function Fl(c,n,a,d,_,g,w){const E=c.context.gl,C=a.paint.get("fill-pattern"),k=C&&C.constantOr(1),z=a.getCrossfadeParameters();let R,j,K,W,H;w?(j=k&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=E.LINES):(j=k?"fillPattern":"fill",R=E.TRIANGLES);for(const X of d){const G=n.getTile(X);if(k&&!G.patternsLoaded())continue;const te=G.getBucket(a);if(!te)continue;c.prepareDrawTile();const Y=te.programConfigurations.get(a.id),me=c.useProgram(j,Y);k&&(c.context.activeTexture.set(E.TEXTURE0),G.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),Y.updatePaintBuffers(z));const fe=C.constantOr(null);if(fe&&G.imageAtlas){const pe=G.imageAtlas,ue=pe.patternPositions[fe.to.toString()],be=pe.patternPositions[fe.from.toString()];ue&&be&&Y.setConstantPatternPositions(ue,be)}const oe=c.translatePosMatrix(X.projMatrix,G,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(w){W=te.indexBuffer2,H=te.segments2;const pe=c.terrain&&c.terrain.renderingToTexture?c.terrain.drapeBufferSize:[E.drawingBufferWidth,E.drawingBufferHeight];K=j==="fillOutlinePattern"&&k?uu(oe,c,z,G,pe):$r(oe,pe)}else W=te.indexBuffer,H=te.segments,K=k?Pl(oe,c,z,G):Aa(oe);c.prepareDrawProgram(c.context,me,X.toUnwrapped()),me.draw(c.context,R,_,c.stencilModeForClipping(X),g,s.CullFaceMode.disabled,K,a.id,te.layoutVertexBuffer,W,H,a.paint,c.transform.zoom,Y)}}function ro(c,n,a,d,_,g,w){const E=c.context,C=E.gl,k=c.transform,z=a.paint.get("fill-extrusion-pattern"),R=z.constantOr(1),j=a.getCrossfadeParameters(),K=a.paint.get("fill-extrusion-opacity"),W=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),a.paint.get("fill-extrusion-ambient-occlusion-radius")],H=a.layout.get("fill-extrusion-edge-radius"),X=k.projection.name==="globe"?s.fillExtrusionHeightLift():0,G=k.projection.name==="globe",te=G?s.globeToMercatorTransition(k.zoom):0,Y=[s.mercatorXfromLng(k.center.lng),s.mercatorYfromLat(k.center.lat)],me=[];G&&(me.push("PROJECTION_GLOBE_VIEW"),c.style.terrainSetForDrapingOnly()&&me.push("TERRAIN")),W[0]>0&&me.push("FAUX_AO");for(const fe of d){const oe=n.getTile(fe),pe=oe.getBucket(a);if(!pe||pe.projection.name!==k.projection.name)continue;const ue=pe.programConfigurations.get(a.id),be=c.useProgram(R?"fillExtrusionPattern":"fillExtrusion",ue,me);if(c.terrain){const qe=c.terrain;if(c.style.terrainSetForDrapingOnly())qe.setupElevationDraw(oe,be,{useMeterToDem:!0});else{if(!pe.enableTerrain)continue;if(qe.setupElevationDraw(oe,be,{useMeterToDem:!0}),Ma(E,n,fe,pe,a,qe),!pe.centroidVertexBuffer){const mt=be.attributes.a_centroid_pos;mt!==void 0&&C.vertexAttrib2f(mt,0,0)}}}R&&(c.context.activeTexture.set(C.TEXTURE0),oe.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),ue.updatePaintBuffers(j));const Be=z.constantOr(null);if(Be&&oe.imageAtlas){const qe=oe.imageAtlas,mt=qe.patternPositions[Be.to.toString()],it=qe.patternPositions[Be.from.toString()];mt&&it&&ue.setConstantPatternPositions(mt,it)}const dt=c.translatePosMatrix(fe.projMatrix,oe,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Ie=k.projection.createInversionMatrix(k,fe.canonical),Je=a.paint.get("fill-extrusion-vertical-gradient"),rt=R?rd(dt,c,Je,K,W,H,fe,j,oe,X,te,Y,Ie):ks(dt,c,Je,K,W,H,fe,X,te,Y,Ie);c.prepareDrawProgram(E,be,fe.toUnwrapped());const wt=[];c.terrain&&wt.push(pe.centroidVertexBuffer),G&&wt.push(pe.layoutVertexExtBuffer),be.draw(E,E.gl.TRIANGLES,_,g,w,s.CullFaceMode.backCCW,rt,a.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,a.paint,c.transform.zoom,ue,wt)}}function Ma(c,n,a,d,_,g){const w=[G=>{let te=G.canonical.x-1,Y=G.wrap;return te<0&&(te=(1<<G.canonical.z)-1,Y--),new s.OverscaledTileID(G.overscaledZ,Y,G.canonical.z,te,G.canonical.y)},G=>{let te=G.canonical.x+1,Y=G.wrap;return te===1<<G.canonical.z&&(te=0,Y++),new s.OverscaledTileID(G.overscaledZ,Y,G.canonical.z,te,G.canonical.y)},G=>new s.OverscaledTileID(G.overscaledZ,G.wrap,G.canonical.z,G.canonical.x,(G.canonical.y===0?1<<G.canonical.z:G.canonical.y)-1),G=>new s.OverscaledTileID(G.overscaledZ,G.wrap,G.canonical.z,G.canonical.x,G.canonical.y===(1<<G.canonical.z)-1?0:G.canonical.y+1)],E=G=>{const te=n.getSource().minzoom,Y=fe=>{const oe=n.getTileByID(fe);if(oe&&oe.hasData())return oe.getBucket(_)},me=[0,-1,1];for(const fe of me){if(G.overscaledZ+fe<te)continue;const oe=Y(G.calculateScaledKey(G.overscaledZ+fe));if(oe)return oe}},C=[0,0,0],k=(G,te)=>(C[0]=Math.min(G.min.y,te.min.y),C[1]=Math.max(G.max.y,te.max.y),C[2]=s.EXTENT-te.min.x>G.max.x?te.min.x-s.EXTENT:G.max.x,C),z=(G,te)=>(C[0]=Math.min(G.min.x,te.min.x),C[1]=Math.max(G.max.x,te.max.x),C[2]=s.EXTENT-te.min.y>G.max.y?te.min.y-s.EXTENT:G.max.y,C),R=[(G,te)=>k(G,te),(G,te)=>k(te,G),(G,te)=>z(G,te),(G,te)=>z(te,G)],j=new s.pointGeometry(0,0);let K,W,H;const X=(G,te,Y,me,fe)=>{const oe=[[me?Y:G,me?G:Y,0],[me?Y:te,me?te:Y,0]],pe=fe<0?s.EXTENT+fe:fe,ue=[me?pe:(G+te)/2,me?(G+te)/2:pe,0];return Y===0&&fe<0||Y!==0&&fe>0?g.getForTilePoints(H,[ue],!0,W):oe.push(ue),g.getForTilePoints(a,oe,!0,K),Math.max(oe[0][2],oe[1][2],ue[2])/g.exaggeration()};for(let G=0;G<4;G++){const te=(G<2?1:5)-G,Y=d.borders[G];if(Y.length===0)continue;const me=H=w[G](a),fe=E(me);if(!(fe&&fe instanceof s.FillExtrusionBucket&&fe.enableTerrain)||d.borderDoneWithNeighborZ[G]===fe.canonical.z&&fe.borderDoneWithNeighborZ[te]===d.canonical.z||(W=g.findDEMTileFor(me),!W||!W.dem))continue;if(!K){const be=g.findDEMTileFor(a);if(!be||!be.dem)return;K=be}const oe=fe.borders[te];let pe=0;const ue=fe.borderDoneWithNeighborZ[te]!==d.canonical.z;if(d.canonical.z===fe.canonical.z){for(let be=0;be<Y.length;be++){const Be=d.featuresOnBorder[Y[be]],dt=Be.borders[G];let Ie;for(;pe<oe.length&&(Ie=fe.featuresOnBorder[oe[pe]],!(Ie.borders[te][1]>dt[0]+3));)ue&&fe.encodeCentroid(void 0,Ie,!1),pe++;if(Ie&&pe<oe.length){const Je=pe;let rt=0;for(;!(Ie.borders[te][0]>dt[1]-3)&&(rt++,++pe!==oe.length);)Ie=fe.featuresOnBorder[oe[pe]];if(Ie=fe.featuresOnBorder[oe[Je]],Be.intersectsCount()>1||Ie.intersectsCount()>1||rt!==1){rt!==1&&(pe=Je),d.encodeCentroid(void 0,Be,!1),ue&&fe.encodeCentroid(void 0,Ie,!1);continue}const wt=R[G](Be,Ie),qe=G%2?s.EXTENT-1:0;j.x=X(wt[0],Math.min(s.EXTENT-1,wt[1]),qe,G<2,wt[2]),j.y=0,d.encodeCentroid(j,Be,!1),ue&&fe.encodeCentroid(j,Ie,!1)}else d.encodeCentroid(void 0,Be,!1)}d.borderDoneWithNeighborZ[G]=fe.canonical.z,d.needsCentroidUpdate=!0,ue&&(fe.borderDoneWithNeighborZ[te]=d.canonical.z,fe.needsCentroidUpdate=!0)}else{for(const be of Y)d.encodeCentroid(void 0,d.featuresOnBorder[be],!1);if(ue){for(const be of oe)fe.encodeCentroid(void 0,fe.featuresOnBorder[be],!1);fe.borderDoneWithNeighborZ[te]=d.canonical.z,fe.needsCentroidUpdate=!0}d.borderDoneWithNeighborZ[G]=fe.canonical.z,d.needsCentroidUpdate=!0}}(d.needsCentroidUpdate||!d.centroidVertexBuffer&&d.centroidVertexArray.length!==0)&&d.uploadCentroid(c)}const fd=new s.Color(1,0,0,1),Ps=new s.Color(0,1,0,1),Ds=new s.Color(0,0,1,1),pd=new s.Color(1,0,1,1),xu=new s.Color(0,1,1,1);function Oi(c,n,a){const d=c.context,_=c.transform,g=d.gl,w=_.projection.name==="globe",E=w?["PROJECTION_GLOBE_VIEW"]:null;let C=a.projMatrix;if(w&&s.globeToMercatorTransition(_.zoom)>0){const Be=s.transitionTileAABBinECEF(a.canonical,_),dt=s.globeDenormalizeECEF(Be);C=s.multiply(new Float32Array(16),_.globeMatrix,dt),s.multiply(C,_.projMatrix,C)}const k=c.useProgram("debug",null,E),z=n.getTileByID(a.key);c.terrain&&c.terrain.setupElevationDraw(z,k);const R=s.DepthMode.disabled,j=s.StencilMode.disabled,K=c.colorModeForRenderPass(),W="$debug";d.activeTexture.set(g.TEXTURE0),c.emptyTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),w?z._makeGlobeTileDebugBuffers(c.context,_):z._makeDebugTileBoundsBuffers(c.context,_.projection);const H=z._tileDebugBuffer||c.debugBuffer,X=z._tileDebugIndexBuffer||c.debugIndexBuffer,G=z._tileDebugSegments||c.debugSegments;k.draw(d,g.LINE_STRIP,R,j,K,s.CullFaceMode.disabled,ad(C,s.Color.red),W,H,X,G,null,null,null,[z._globeTileDebugBorderBuffer]);const te=z.latestRawTileData,Y=Math.floor((te&&te.byteLength||0)/1024),me=n.getTile(a).tileSize,fe=512/Math.min(me,512)*(a.overscaledZ/_.zoom)*.5;let oe=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(oe+=` => ${a.overscaledZ}`),oe+=` ${Y}kb`,function(Be,dt){Be.initDebugOverlayCanvas();const Ie=Be.debugOverlayCanvas,Je=Be.context.gl,rt=Be.debugOverlayCanvas.getContext("2d");rt.clearRect(0,0,Ie.width,Ie.height),rt.shadowColor="white",rt.shadowBlur=2,rt.lineWidth=1.5,rt.strokeStyle="white",rt.textBaseline="top",rt.font="bold 36px Open Sans, sans-serif",rt.fillText(dt,5,5),rt.strokeText(dt,5,5),Be.debugOverlayTexture.update(Ie),Be.debugOverlayTexture.bind(Je.LINEAR,Je.CLAMP_TO_EDGE)}(c,oe);const pe=z._tileDebugTextBuffer||c.debugBuffer,ue=z._tileDebugTextIndexBuffer||c.quadTriangleIndexBuffer,be=z._tileDebugTextSegments||c.debugSegments;k.draw(d,g.TRIANGLES,R,j,s.ColorMode.alphaBlended,s.CullFaceMode.disabled,ad(C,s.Color.transparent,fe),W,pe,ue,be,null,null,null,[z._globeTileDebugTextBuffer])}function Ia(c,n,a,d){ka(c,0,n+a/2,c.transform.width,a,d)}function md(c,n,a,d){ka(c,n-a/2,0,a,c.transform.height,d)}function ka(c,n,a,d,_,g){const w=c.context,E=w.gl;E.enable(E.SCISSOR_TEST),E.scissor(n*s.exported.devicePixelRatio,a*s.exported.devicePixelRatio,d*s.exported.devicePixelRatio,_*s.exported.devicePixelRatio),w.clear({color:g}),E.disable(E.SCISSOR_TEST)}const za=s.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Zp}=za;function Lo(c,n,a,d){c.emplaceBack(n,a,d)}class bu{constructor(n){this.vertexArray=new s.StructArrayLayout3f12,this.indices=new s.StructArrayLayout3ui6,Lo(this.vertexArray,-1,-1,1),Lo(this.vertexArray,1,-1,1),Lo(this.vertexArray,-1,1,1),Lo(this.vertexArray,1,1,1),Lo(this.vertexArray,-1,-1,-1),Lo(this.vertexArray,1,-1,-1),Lo(this.vertexArray,-1,1,-1),Lo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,Zp),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=s.SegmentVector.simpleSegment(0,0,36,12)}}function Ls(c,n,a,d,_,g){const w=c.gl,E=n.paint.get("sky-atmosphere-color"),C=n.paint.get("sky-atmosphere-halo-color"),k=n.paint.get("sky-atmosphere-sun-intensity"),z=((R,j,K,W,H)=>({u_matrix_3f:R,u_sun_direction:j,u_sun_intensity:K,u_color_tint_r:[W.r,W.g,W.b,W.a],u_color_tint_m:[H.r,H.g,H.b,H.a],u_luminance:5e-5}))(s.fromMat4(s.create$1(),d),_,k,E,C);w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+g,n.skyboxTexture,0),a.draw(c,w.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.frontCW,z,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const wu=s.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Vl{constructor(n){const a=new s.StructArrayLayout5f20;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);const d=new s.StructArrayLayout3ui6;d.emplaceBack(0,1,2),d.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(a,wu.members),this.indexBuffer=n.createIndexBuffer(d),this.segments=s.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Bs={symbol:function(c,n,a,d,_){if(c.renderPass!=="translucent")return;const g=s.StencilMode.disabled,w=c.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(E,C,k,z,R,j,K){const W=C.transform,H=R==="map",X=j==="map";for(const G of E){const te=z.getTile(G),Y=te.getBucket(k);if(!Y||!Y.text||!Y.text.segments.get().length)continue;const me=s.evaluateSizeForZoom(Y.textSizeData,W.zoom),fe=cr(G,Y.getProjection(),W),oe=W.calculatePixelsToTileUnitsMatrix(te),pe=yi(fe,te.tileID.canonical,X,H,W,Y.getProjection(),oe),ue=k.layout.get("icon-text-fit")!=="none"&&Y.hasIconData();if(me){const be=Math.pow(2,W.zoom-te.tileID.overscaledZ);gu(Y,H,X,K,s.symbolSize,W,pe,G,be,me,ue)}}}(d,c,a,n,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),_),a.paint.get("icon-opacity").constantOr(1)!==0&&yu(c,n,a,d,!1,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),a.layout.get("icon-rotation-alignment"),a.layout.get("icon-pitch-alignment"),a.layout.get("icon-keep-upright"),g,w),a.paint.get("text-opacity").constantOr(1)!==0&&yu(c,n,a,d,!0,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),a.layout.get("text-keep-upright"),g,w),n.map.showCollisionBoxes&&(ud(c,n,a,d,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),ud(c,n,a,d,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(c,n,a,d){if(c.renderPass!=="translucent")return;const _=a.paint.get("circle-opacity"),g=a.paint.get("circle-stroke-width"),w=a.paint.get("circle-stroke-opacity"),E=a.layout.get("circle-sort-key").constantOr(1)!==void 0;if(_.constantOr(1)===0&&(g.constantOr(1)===0||w.constantOr(1)===0))return;const C=c.context,k=C.gl,z=c.transform,R=c.depthModeForSublayer(0,s.DepthMode.ReadOnly),j=s.StencilMode.disabled,K=c.colorModeForRenderPass(),W=z.projection.name==="globe",H=[s.mercatorXfromLng(z.center.lng),s.mercatorYfromLat(z.center.lat)],X=[];for(let te=0;te<d.length;te++){const Y=d[te],me=n.getTile(Y),fe=me.getBucket(a);if(!fe||fe.projection.name!==z.projection.name)continue;const oe=fe.programConfigurations.get(a.id),pe=sd(a);W&&pe.push("PROJECTION_GLOBE_VIEW");const ue=c.useProgram("circle",oe,pe),be=fe.layoutVertexBuffer,Be=fe.globeExtVertexBuffer,dt=fe.indexBuffer,Ie=z.projection.createInversionMatrix(z,Y.canonical),Je={programConfiguration:oe,program:ue,layoutVertexBuffer:be,globeExtVertexBuffer:Be,indexBuffer:dt,uniformValues:hu(c,Y,me,Ie,H,a),tile:me};if(E){const rt=fe.segments.get();for(const wt of rt)X.push({segments:new s.SegmentVector([wt]),sortKey:wt.sortKey,state:Je})}else X.push({segments:fe.segments,sortKey:0,state:Je})}E&&X.sort((te,Y)=>te.sortKey-Y.sortKey);const G={useDepthForOcclusion:!W};for(const te of X){const{programConfiguration:Y,program:me,layoutVertexBuffer:fe,globeExtVertexBuffer:oe,indexBuffer:pe,uniformValues:ue,tile:be}=te.state,Be=te.segments;c.terrain&&c.terrain.setupElevationDraw(be,me,G),c.prepareDrawProgram(C,me,be.tileID.toUnwrapped()),me.draw(C,k.TRIANGLES,R,j,K,s.CullFaceMode.disabled,ue,a.id,fe,pe,Be,a.paint,z.zoom,Y,[oe])}},heatmap:function(c,n,a,d){if(a.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){const _=c.context,g=_.gl,w=s.StencilMode.disabled,E=new s.ColorMode([g.ONE,g.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(K,W,H,X){const G=K.gl,te=W.width*X,Y=W.height*X;K.activeTexture.set(G.TEXTURE1),K.viewport.set([0,0,te,Y]);let me=H.heatmapFbo;if(!me||me&&(me.width!==te||me.height!==Y)){me&&me.destroy();const fe=G.createTexture();G.bindTexture(G.TEXTURE_2D,fe),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MAG_FILTER,G.LINEAR),me=H.heatmapFbo=K.createFramebuffer(te,Y,!1),function(oe,pe,ue,be,Be,dt){const Ie=oe.gl;Ie.texImage2D(Ie.TEXTURE_2D,0,Ie.RGBA,Be,dt,0,Ie.RGBA,oe.extRenderToTextureHalfFloat?oe.extTextureHalfFloat.HALF_FLOAT_OES:Ie.UNSIGNED_BYTE,null),be.colorAttachment.set(ue)}(K,0,fe,me,te,Y)}else G.bindTexture(G.TEXTURE_2D,me.colorAttachment.get()),K.bindFramebuffer.set(me.framebuffer)})(_,c,a,c.transform.projection.name==="globe"?.5:.25),_.clear({color:s.Color.transparent});const C=c.transform,k=C.projection.name==="globe",z=k?["PROJECTION_GLOBE_VIEW"]:null,R=k?s.CullFaceMode.frontCCW:s.CullFaceMode.disabled,j=[s.mercatorXfromLng(C.center.lng),s.mercatorYfromLat(C.center.lat)];for(let K=0;K<d.length;K++){const W=d[K];if(n.hasRenderableParent(W))continue;const H=n.getTile(W),X=H.getBucket(a);if(!X||X.projection.name!==C.projection.name)continue;const G=X.programConfigurations.get(a.id),te=c.useProgram("heatmap",G,z),{zoom:Y}=c.transform;c.terrain&&c.terrain.setupElevationDraw(H,te),c.prepareDrawProgram(_,te,W.toUnwrapped());const me=C.projection.createInversionMatrix(C,W.canonical);te.draw(_,g.TRIANGLES,s.DepthMode.disabled,w,E,R,Up(c,W,H,me,j,Y,a.paint.get("heatmap-intensity")),a.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,a.paint,c.transform.zoom,G,k?[X.globeExtVertexBuffer]:null)}_.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(_,g){const w=_.context,E=w.gl,C=g.heatmapFbo;if(!C)return;w.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,C.colorAttachment.get()),w.activeTexture.set(E.TEXTURE1);let k=g.colorRampTexture;k||(k=g.colorRampTexture=new s.Texture(w,g.colorRamp,E.RGBA)),k.bind(E.LINEAR,E.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(w,E.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,_.colorModeForRenderPass(),s.CullFaceMode.disabled,((z,R,j,K)=>({u_image:0,u_color_ramp:1,u_opacity:R.paint.get("heatmap-opacity")}))(0,g),g.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,g.paint,_.transform.zoom)}(c,a))},line:function(c,n,a,d){if(c.renderPass!=="translucent")return;const _=a.paint.get("line-opacity"),g=a.paint.get("line-width");if(_.constantOr(1)===0||g.constantOr(1)===0)return;const w=c.depthModeForSublayer(0,s.DepthMode.ReadOnly),E=c.colorModeForRenderPass(),C=c.terrain&&c.terrain.renderingToTexture?1:s.exported.devicePixelRatio,k=a.paint.get("line-dasharray"),z=k.constantOr(1),R=a.layout.get("line-cap"),j=a.paint.get("line-pattern"),K=j.constantOr(1),W=a.paint.get("line-gradient"),H=a.getCrossfadeParameters(),X=K?"linePattern":"line",G=c.context,te=G.gl,Y=(fe=>{const oe=[];Bl(fe)&&oe.push("RENDER_LINE_DASH"),fe.paint.get("line-gradient")&&oe.push("RENDER_LINE_GRADIENT");const pe=fe.paint.get("line-trim-offset");pe[0]===0&&pe[1]===0||oe.push("RENDER_LINE_TRIM_OFFSET");const ue=fe.paint.get("line-pattern").constantOr(1),be=fe.paint.get("line-opacity").constantOr(1)!==1;return!ue&&be&&oe.push("RENDER_LINE_ALPHA_DISCARD"),oe})(a);let me=Y.includes("RENDER_LINE_ALPHA_DISCARD");c.terrain&&c.terrain.clipOrMaskOverlapStencilType()&&(me=!1);for(const fe of d){const oe=n.getTile(fe);if(K&&!oe.patternsLoaded())continue;const pe=oe.getBucket(a);if(!pe)continue;c.prepareDrawTile();const ue=pe.programConfigurations.get(a.id),be=c.useProgram(X,ue,Y),Be=j.constantOr(null);if(Be&&oe.imageAtlas){const it=oe.imageAtlas,It=it.patternPositions[Be.to.toString()],St=it.patternPositions[Be.from.toString()];It&&St&&ue.setConstantPatternPositions(It,St)}const dt=k.constantOr(null),Ie=R.constantOr(null);if(!K&&dt&&Ie&&oe.lineAtlas){const it=oe.lineAtlas,It=it.getDash(dt.to,Ie),St=it.getDash(dt.from,Ie);It&&St&&ue.setConstantPatternPositions(It,St)}let[Je,rt]=a.paint.get("line-trim-offset");(Ie==="round"||Ie==="square")&&Je!==rt&&(Je===0&&(Je-=1),rt===1&&(rt+=1));const wt=c.terrain?fe.projMatrix:null,qe=K?Np(c,oe,a,H,wt,C):Dl(c,oe,a,H,wt,pe.lineClipsArray.length,C,[Je,rt]);if(W){const it=pe.gradients[a.id];let It=it.texture;if(a.gradientVersion!==it.version){let St=256;if(a.stepInterpolant){const Vt=n.getSource().maxzoom,Wt=fe.canonical.z===Vt?Math.ceil(1<<c.transform.maxZoom-fe.canonical.z):1;St=s.clamp(s.nextPowerOfTwo(pe.maxLineLength/s.EXTENT*1024*Wt),256,G.maxTextureSize)}it.gradient=s.renderColorRamp({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:St,image:it.gradient||void 0,clips:pe.lineClipsArray}),it.texture?it.texture.update(it.gradient):it.texture=new s.Texture(G,it.gradient,te.RGBA),it.version=a.gradientVersion,It=it.texture}G.activeTexture.set(te.TEXTURE1),It.bind(a.stepInterpolant?te.NEAREST:te.LINEAR,te.CLAMP_TO_EDGE)}z&&(G.activeTexture.set(te.TEXTURE0),oe.lineAtlasTexture.bind(te.LINEAR,te.REPEAT),ue.updatePaintBuffers(H)),K&&(G.activeTexture.set(te.TEXTURE0),oe.imageAtlasTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE),ue.updatePaintBuffers(H)),c.prepareDrawProgram(G,be,fe.toUnwrapped());const mt=it=>{be.draw(G,te.TRIANGLES,w,it,E,s.CullFaceMode.disabled,qe,a.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,a.paint,c.transform.zoom,ue,[pe.layoutVertexBuffer2])};if(me){const it=c.stencilModeForClipping(fe).ref;it===0&&c.terrain&&G.clear({stencil:0});const It={func:te.EQUAL,mask:255};qe.u_alpha_discard_threshold=.8,mt(new s.StencilMode(It,it,255,te.KEEP,te.KEEP,te.INVERT)),qe.u_alpha_discard_threshold=0,mt(new s.StencilMode(It,it,255,te.KEEP,te.KEEP,te.KEEP))}else mt(c.stencilModeForClipping(fe))}me&&(c.resetStencilClippingMasks(),c.terrain&&G.clear({stencil:0}))},fill:function(c,n,a,d){const _=a.paint.get("fill-color"),g=a.paint.get("fill-opacity");if(g.constantOr(1)===0)return;const w=c.colorModeForRenderPass(),E=a.paint.get("fill-pattern"),C=c.opaquePassEnabledForLayer()&&!E.constantOr(1)&&_.constantOr(s.Color.transparent).a===1&&g.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===C){const k=c.depthModeForSublayer(1,c.renderPass==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly);Fl(c,n,a,d,k,w,!1)}if(c.renderPass==="translucent"&&a.paint.get("fill-antialias")){const k=c.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,s.DepthMode.ReadOnly);Fl(c,n,a,d,k,w,!0)}},"fill-extrusion":function(c,n,a,d){const _=a.paint.get("fill-extrusion-opacity");if(_!==0&&c.renderPass==="translucent"){const g=new s.DepthMode(c.context.gl.LEQUAL,s.DepthMode.ReadWrite,c.depthRangeFor3D);if(_!==1||a.paint.get("fill-extrusion-pattern").constantOr(1))ro(c,n,a,d,g,s.StencilMode.disabled,s.ColorMode.disabled),ro(c,n,a,d,g,c.stencilModeFor3D(),c.colorModeForRenderPass()),c.resetStencilClippingMasks();else{const w=c.colorModeForRenderPass();ro(c,n,a,d,g,s.StencilMode.disabled,w)}}},hillshade:function(c,n,a,d){if(c.renderPass!=="offscreen"&&c.renderPass!=="translucent")return;const _=c.context,g=c.depthModeForSublayer(0,s.DepthMode.ReadOnly),w=c.colorModeForRenderPass(),E=c.terrain&&c.terrain.renderingToTexture,[C,k]=c.renderPass!=="translucent"||E?[{},d]:c.stencilConfigForOverlap(d);for(const z of k){const R=n.getTile(z);if(R.needsHillshadePrepare&&c.renderPass==="offscreen")Is(c,R,a,g,s.StencilMode.disabled,w);else if(c.renderPass==="translucent"){const j=E&&c.terrain?c.terrain.stencilModeForRTTOverlap(z):C[z.overscaledZ];iu(c,z,R,a,g,j,w)}}_.viewport.set([0,0,c.width,c.height]),c.resetStencilClippingMasks()},raster:function(c,n,a,d,_,g){if(c.renderPass!=="translucent"||a.paint.get("raster-opacity")===0||!d.length)return;const w=c.context,E=w.gl,C=n.getSource(),k=c.useProgram("raster"),z=c.colorModeForRenderPass(),R=c.terrain&&c.terrain.renderingToTexture,[j,K]=C instanceof Ae||R?[{},d]:c.stencilConfigForOverlap(d),W=K[K.length-1].overscaledZ,H=!c.options.moving;for(const X of K){const G=R?s.DepthMode.disabled:c.depthModeForSublayer(X.overscaledZ-W,a.paint.get("raster-opacity")===1?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly,E.LESS),te=X.toUnwrapped(),Y=n.getTile(X);if(R&&(!Y||!Y.hasData()))continue;const me=R?X.projMatrix:c.transform.calculateProjMatrix(te,H),fe=c.terrain&&R?c.terrain.stencilModeForRTTOverlap(X):j[X.overscaledZ],oe=g?0:a.paint.get("raster-fade-duration");Y.registerFadeDuration(oe);const pe=n.findLoadedParent(X,0),ue=kl(Y,pe,n,c.transform,oe);let be,Be;c.terrain&&c.terrain.prepareDrawTile();const dt=a.paint.get("raster-resampling")==="nearest"?E.NEAREST:E.LINEAR;w.activeTexture.set(E.TEXTURE0),Y.texture.bind(dt,E.CLAMP_TO_EDGE),w.activeTexture.set(E.TEXTURE1),pe?(pe.texture.bind(dt,E.CLAMP_TO_EDGE),be=Math.pow(2,pe.tileID.overscaledZ-Y.tileID.overscaledZ),Be=[Y.tileID.canonical.x*be%1,Y.tileID.canonical.y*be%1]):Y.texture.bind(dt,E.CLAMP_TO_EDGE);const Ie=jp(me,Be||[0,0],be||1,ue,a,C instanceof Ae?C.perspectiveTransform:[0,0]);if(c.prepareDrawProgram(w,k,te),C instanceof Ae)C.boundsBuffer&&C.boundsSegments&&k.draw(w,E.TRIANGLES,G,s.StencilMode.disabled,z,s.CullFaceMode.disabled,Ie,a.id,C.boundsBuffer,c.quadTriangleIndexBuffer,C.boundsSegments);else{const{tileBoundsBuffer:Je,tileBoundsIndexBuffer:rt,tileBoundsSegments:wt}=c.getTileBoundsBuffers(Y);k.draw(w,E.TRIANGLES,G,fe,z,s.CullFaceMode.disabled,Ie,a.id,Je,rt,wt)}}c.resetStencilClippingMasks()},background:function(c,n,a,d){const _=a.paint.get("background-color"),g=a.paint.get("background-opacity");if(g===0)return;const w=c.context,E=w.gl,C=c.transform,k=C.tileSize,z=a.paint.get("background-pattern");if(c.isPatternMissing(z))return;const R=!z&&_.a===1&&g===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass!==R)return;const j=s.StencilMode.disabled,K=c.depthModeForSublayer(0,R==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly),W=c.colorModeForRenderPass(),H=c.useProgram(z?"backgroundPattern":"background");let X,G=d;G||(X=c.getBackgroundTiles(),G=Object.values(X).map(Y=>Y.tileID)),z&&(w.activeTexture.set(E.TEXTURE0),c.imageManager.bind(c.context));const te=a.getCrossfadeParameters();for(const Y of G){const me=Y.toUnwrapped(),fe=d?Y.projMatrix:c.transform.calculateProjMatrix(me);c.prepareDrawTile();const oe=n?n.getTile(Y):X?X[Y.key]:new s.Tile(Y,k,C.zoom,c),pe=z?$p(fe,g,c,z,{tileID:Y,tileSize:k},te):qp(fe,g,_);c.prepareDrawProgram(w,H,me);const{tileBoundsBuffer:ue,tileBoundsIndexBuffer:be,tileBoundsSegments:Be}=c.getTileBoundsBuffers(oe);H.draw(w,E.TRIANGLES,K,j,W,s.CullFaceMode.disabled,pe,a.id,ue,be,Be)}},sky:function(c,n,a){const d=c.transform,_=d.projection.name==="mercator"||d.projection.name==="globe"?1:s.smoothstep(7,8,d.zoom),g=a.paint.get("sky-opacity")*_;if(g===0)return;const w=c.context,E=a.paint.get("sky-type"),C=new s.DepthMode(w.gl.LEQUAL,s.DepthMode.ReadOnly,[0,1]),k=c.frameCounter/1e3%1;E==="atmosphere"?c.renderPass==="offscreen"?a.needsSkyboxCapture(c)&&(function(z,R,j,K){const W=z.context,H=W.gl;let X=R.skyboxFbo;if(!X){X=R.skyboxFbo=W.createFramebuffer(32,32,!1),R.skyboxGeometry=new bu(W),R.skyboxTexture=W.gl.createTexture(),H.bindTexture(H.TEXTURE_CUBE_MAP,R.skyboxTexture),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_S,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_T,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MIN_FILTER,H.LINEAR),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MAG_FILTER,H.LINEAR);for(let me=0;me<6;++me)H.texImage2D(H.TEXTURE_CUBE_MAP_POSITIVE_X+me,0,H.RGBA,32,32,0,H.RGBA,H.UNSIGNED_BYTE,null)}W.bindFramebuffer.set(X.framebuffer),W.viewport.set([0,0,32,32]);const G=R.getCenter(z,!0),te=z.useProgram("skyboxCapture"),Y=new Float64Array(16);s.identity(Y),s.rotateY(Y,Y,.5*-Math.PI),Ls(W,R,te,Y,G,0),s.identity(Y),s.rotateY(Y,Y,.5*Math.PI),Ls(W,R,te,Y,G,1),s.identity(Y),s.rotateX(Y,Y,.5*-Math.PI),Ls(W,R,te,Y,G,2),s.identity(Y),s.rotateX(Y,Y,.5*Math.PI),Ls(W,R,te,Y,G,3),s.identity(Y),Ls(W,R,te,Y,G,4),s.identity(Y),s.rotateY(Y,Y,Math.PI),Ls(W,R,te,Y,G,5),W.viewport.set([0,0,z.width,z.height])}(c,a),a.markSkyboxValid(c)):c.renderPass==="sky"&&function(z,R,j,K,W){const H=z.context,X=H.gl,G=z.transform,te=z.useProgram("skybox");H.activeTexture.set(X.TEXTURE0),X.bindTexture(X.TEXTURE_CUBE_MAP,R.skyboxTexture);const Y=((me,fe,oe,pe,ue)=>({u_matrix:me,u_sun_direction:fe,u_cubemap:0,u_opacity:pe,u_temporal_offset:ue}))(G.skyboxMatrix,R.getCenter(z,!1),0,K,W);z.prepareDrawProgram(H,te),te.draw(H,X.TRIANGLES,j,s.StencilMode.disabled,z.colorModeForRenderPass(),s.CullFaceMode.backCW,Y,"skybox",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(c,a,C,g,k):E==="gradient"&&c.renderPass==="sky"&&function(z,R,j,K,W){const H=z.context,X=H.gl,G=z.transform,te=z.useProgram("skyboxGradient");R.skyboxGeometry||(R.skyboxGeometry=new bu(H)),H.activeTexture.set(X.TEXTURE0);let Y=R.colorRampTexture;Y||(Y=R.colorRampTexture=new s.Texture(H,R.colorRamp,X.RGBA)),Y.bind(X.LINEAR,X.CLAMP_TO_EDGE);const me=((fe,oe,pe,ue,be)=>({u_matrix:fe,u_color_ramp:0,u_center_direction:oe,u_radius:s.degToRad(pe),u_opacity:ue,u_temporal_offset:be}))(G.skyboxMatrix,R.getCenter(z,!1),R.paint.get("sky-gradient-radius"),K,W);z.prepareDrawProgram(H,te),te.draw(H,X.TRIANGLES,j,s.StencilMode.disabled,z.colorModeForRenderPass(),s.CullFaceMode.backCW,me,"skyboxGradient",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(c,a,C,g,k)},debug:function(c,n,a){for(let d=0;d<a.length;d++)Oi(c,n,a[d])},custom:function(c,n,a){const d=c.context,_=a.implementation;if(c.transform.projection.unsupportedLayers&&c.transform.projection.unsupportedLayers.includes("custom"))s.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(c.renderPass==="offscreen"){const g=_.prerender;g&&(c.setCustomLayerDefaults(),d.setColorMode(c.colorModeForRenderPass()),g.call(_,d.gl,c.transform.customLayerMatrix()),d.setDirty(),c.setBaseState())}else if(c.renderPass==="translucent"){c.setCustomLayerDefaults(),d.setColorMode(c.colorModeForRenderPass()),d.setStencilMode(s.StencilMode.disabled);const g=_.renderingMode==="3d"?new s.DepthMode(c.context.gl.LEQUAL,s.DepthMode.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,s.DepthMode.ReadOnly);d.setDepthMode(g),_.render(d.gl,c.transform.customLayerMatrix()),d.setDirty(),c.setBaseState(),d.bindFramebuffer.set(null)}}};class Tu{constructor(n,a){this.context=new J(n),this.transform=a,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=s.SourceCache.maxUnderzooming+s.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Tl,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(n,a){const d=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(d||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new id(this,n));const _=this._terrain;this.transform.elevation=d?_:null,_.update(n,this.transform,a)}_updateFog(n){const a=n.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[d,_]=a.getFovAdjustedRange(this.transform._fov);if(d>_)return void(this.transform.fogCullDistSq=null);const g=d+.78*(_-d);this.transform.fogCullDistSq=g*g}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(n,a){if(this.width=n*s.exported.devicePixelRatio,this.height=a*s.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style.order)this.style._layers[d].resize()}setup(){const n=this.context,a=new s.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(s.EXTENT,0),a.emplaceBack(0,s.EXTENT),a.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(a,s.posAttributes.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);const d=new s.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(s.EXTENT,0),d.emplaceBack(0,s.EXTENT),d.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=n.createVertexBuffer(d,s.posAttributes.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);const _=new s.StructArrayLayout2i4;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(_,s.posAttributes.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);const g=new s.StructArrayLayout4i8;g.emplaceBack(0,0,0,0),g.emplaceBack(s.EXTENT,0,s.EXTENT,0),g.emplaceBack(0,s.EXTENT,0,s.EXTENT),g.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.mercatorBoundsBuffer=n.createVertexBuffer(g,s.boundsAttributes.members),this.mercatorBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);const w=new s.StructArrayLayout3ui6;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(w);const E=new s.StructArrayLayout1ui2;for(const k of[0,1,3,2,0])E.emplaceBack(k);this.debugIndexBuffer=n.createIndexBuffer(E),this.emptyTexture=new s.Texture(n,new s.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA),this.identityMat=s.create();const C=this.context.gl;this.stencilClearMode=new s.StencilMode({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.loadTimeStamps.push(s.window.performance.now()),this.atmosphereBuffer=new Vl(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context,a=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(n,a.TRIANGLES,s.DepthMode.disabled,this.stencilClearMode,s.ColorMode.disabled,s.CullFaceMode.disabled,su(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,a,d){if(!a||this.currentStencilSource===a.id||!n.isTileClipped()||!d||d.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let E=!1;for(const C of d)if(this._tileClippingMaskIDs[C.key]===void 0){E=!0;break}if(!E)return}this.currentStencilSource=a.id;const _=this.context,g=_.gl;this.nextStencilID+d.length>256&&this.clearStencil(),_.setColorMode(s.ColorMode.disabled),_.setDepthMode(s.DepthMode.disabled);const w=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of d){const C=a.getTile(E),k=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,{tileBoundsBuffer:z,tileBoundsIndexBuffer:R,tileBoundsSegments:j}=this.getTileBoundsBuffers(C);w.draw(_,g.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:g.ALWAYS,mask:0},k,255,g.KEEP,g.KEEP,g.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,su(E.projMatrix),"$clipping",z,R,j)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,a=this.context.gl;return new s.StencilMode({func:a.NOTEQUAL,mask:255},n,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const a=this.context.gl;return new s.StencilMode({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(n){const a=this.context.gl,d=n.sort((w,E)=>E.overscaledZ-w.overscaledZ),_=d[d.length-1].overscaledZ,g=d[0].overscaledZ-_+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const w={};for(let E=0;E<g;E++)w[E+_]=new s.StencilMode({func:a.GEQUAL,mask:255},E+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=g,[w,d]}return[{[_]:s.StencilMode.disabled},d]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new s.ColorMode([n.CONSTANT_COLOR,n.ONE],new s.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?s.ColorMode.unblended:s.ColorMode.alphaBlended}depthModeForSublayer(n,a,d){if(!this.opaquePassEnabledForLayer())return s.DepthMode.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new s.DepthMode(d||this.context.gl.LEQUAL,a,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,a){this.style=n,this.options=a,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(s.exported.now()),this.imageManager.beginFrame();const d=this.style.order,_=this.style._sourceCaches;for(const C in _){const k=_[C];k.used&&k.prepare(this.context)}const g={},w={},E={};for(const C in _){const k=_[C];g[C]=k.getVisibleCoordinates(),w[C]=g[C].slice().reverse(),E[C]=k.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let C=0;C<d.length;C++)if(this.style._layers[d[C]].is3D()){this.opaquePassCutoff=C;break}if(this.terrain&&(this.terrain.updateTileBinding(E),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.GlobeSharedBuffers(this.context)),s.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const C of d){const k=this.style._layers[C],z=n._getLayerSourceCache(k);if(!k.hasOffscreenPass()||k.isHidden(this.transform.zoom))continue;const R=z?w[z.id]:void 0;(k.type==="custom"||k.isSky()||R&&R.length)&&this.renderLayer(this,z,k,R)}if(this.depthRangeFor3D=[0,1-(n.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:a.showOverdrawInspector?s.Color.black:s.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){const C=this.style._layers[d[this.currentLayer]],k=n._getLayerSourceCache(C);if(C.isSky())continue;const z=k?w[k.id]:void 0;this._renderTileClippingMasks(C,k,z),this.renderLayer(this,k,C,z)}if(this.style.fog&&this.transform.projection.supportsFog&&function(C,k){const z=C.context,R=z.gl,j=C.transform,K=new s.DepthMode(R.LEQUAL,s.DepthMode.ReadOnly,[0,1]),W=C.useProgram("globeAtmosphere",null,j.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),H=s.globeToMercatorTransition(j.zoom),X=k.properties.get("color").toArray01(),G=k.properties.get("high-color").toArray01(),te=k.properties.get("space-color").toArray01PremultipliedAlpha(),Y=s.identity$1([]);s.rotateY$1(Y,Y,-s.degToRad(j._center.lng)),s.rotateX$1(Y,Y,s.degToRad(j._center.lat)),s.rotateZ$1(Y,Y,j.angle),s.rotateX$1(Y,Y,-j._pitch);const me=s.fromQuat(new Float32Array(16),Y),fe=s.mapValue(k.properties.get("star-intensity"),0,1,0,.25),oe=5e-4,pe=s.mapValue(k.properties.get("horizon-blend"),0,1,oe,.25),ue=s.globeUseCustomAntiAliasing(C,z,j)&&pe===oe?j.worldSize/(2*Math.PI*1.025)-1:j.globeRadius,be=C.frameCounter/1e3%1,Be=s.length(j.globeCenterInViewSpace),dt=Math.sqrt(Math.pow(Be,2)-Math.pow(ue,2)),Ie=Math.acos(dt/Be),Je=((wt,qe,mt,it,It,St,Vt,Wt,ii,bi,Ut,ai,Ii,en)=>({u_frustum_tl:wt,u_frustum_tr:qe,u_frustum_br:mt,u_frustum_bl:it,u_horizon:It,u_transition:St,u_fadeout_range:Vt,u_color:Wt,u_high_color:ii,u_space_color:bi,u_star_intensity:Ut,u_star_size:5*s.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:ai,u_horizon_angle:Ii,u_rotation_matrix:en}))(j.frustumCorners.TL,j.frustumCorners.TR,j.frustumCorners.BR,j.frustumCorners.BL,j.frustumCorners.horizon,H,pe,X,G,te,fe,be,Ie,me);C.prepareDrawProgram(z,W);const rt=C.atmosphereBuffer;rt&&W.draw(z,R.TRIANGLES,K,s.StencilMode.disabled,s.ColorMode.alphaBlended,s.CullFaceMode.backCW,Je,"skybox",rt.vertexBuffer,rt.indexBuffer,rt.segments)}(this,this.style.fog),this.renderPass="sky",(s.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){const C=this.style._layers[d[this.currentLayer]],k=n._getLayerSourceCache(C);C.isSky()&&this.renderLayer(this,k,C,k?w[k.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;){const C=this.style._layers[d[this.currentLayer]],k=n._getLayerSourceCache(C);if(C.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(C)){if(C.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const z=k?(C.type==="symbol"?E:w)[k.id]:void 0;this._renderTileClippingMasks(C,k,k?g[k.id]:void 0),this.renderLayer(this,k,C,z),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let C=null;s.values(this.style._layers).forEach(k=>{const z=n._getLayerSourceCache(k);z&&!k.isHidden(this.transform.zoom)&&(!C||C.getSource().maxzoom<z.getSource().maxzoom)&&(C=z)}),C&&this.options.showTileBoundaries&&Bs.debug(this,C,C.getVisibleCoordinates())}this.options.showPadding&&function(C){const k=C.transform.padding;Ia(C,C.transform.height-(k.top||0),3,fd),Ia(C,k.bottom||0,3,Ps),md(C,k.left||0,3,Ds),md(C,C.transform.width-(k.right||0),3,pd);const z=C.transform.centerPoint;(function(R,j,K,W){ka(R,j-1,K-10,2,20,W),ka(R,j-10,K-1,20,2,W)})(C,z.x,C.transform.height-z.y,xu)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(s.window.performance.now()),this.saveCanvasCopy())}}renderLayer(n,a,d,_){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="sky"||d.type==="custom"||_&&_.length)&&(this.id=d.id,this.gpuTimingStart(d),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(d.type)||Bs[d.type](n,a,d,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;let d=this.gpuTimers[n.id];d||(d=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:a.createQueryEXT()}),d.calls++,a.beginQueryEXT(a.TIME_ELAPSED_EXT,d.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,a=n.createQueryEXT();this.deferredRenderGpuTimeQueries.push(a),n.beginQueryEXT(n.TIME_ELAPSED_EXT,a)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const a={};for(const d in n){const _=n[d],g=this.context.extTimerQuery,w=g.getQueryObjectEXT(_.query,g.QUERY_RESULT_EXT)/1e6;g.deleteQueryEXT(_.query),a[d]=w}return a}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const a=this.context.extTimerQuery;let d=0;for(const _ of n)d+=a.getQueryObjectEXT(_,a.QUERY_RESULT_EXT)/1e6,a.deleteQueryEXT(_);return d}translatePosMatrix(n,a,d,_,g){if(!d[0]&&!d[1])return n;const w=g?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(w){const k=Math.sin(w),z=Math.cos(w);d=[d[0]*z-d[1]*k,d[0]*k+d[1]*z]}const E=[g?d[0]:pi(a,d[0],this.transform.zoom),g?d[1]:pi(a,d[1],this.transform.zoom),0],C=new Float32Array(16);return s.translate(C,n,E),C}saveTileTexture(n){const a=this._tileTextures[n.size[0]];a?a.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const a=this._tileTextures[n];return a&&a.length>0?a.pop():null}isPatternMissing(n){if(!n)return!1;if(!n.from||!n.to)return!0;const a=this.imageManager.getPattern(n.from.toString()),d=this.imageManager.getPattern(n.to.toString());return!a||!d}currentGlobalDefines(){const n=this.terrain&&this.terrain.renderingToTexture,a=this.style&&this.style.fog,d=[];return this.terrain&&!this.terrain.renderingToTexture&&d.push("TERRAIN"),a&&!n&&a.getOpacity(this.transform.pitch)!==0&&d.push("FOG"),n&&d.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&d.push("OVERDRAW_INSPECTOR"),d}useProgram(n,a,d){this.cache=this.cache||{};const _=d||[],g=this.currentGlobalDefines().concat(_),w=cu.cacheKey(Ml[n],n,g,a);return this.cache[w]||(this.cache[w]=new cu(this.context,n,Ml[n],a,Gp[n],g)),this.cache[w]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=s.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(n,a,d){if(this.terrain&&this.terrain.renderingToTexture)return;const _=this.style.fog;if(_){const g=_.getOpacity(this.transform.pitch),w=((E,C,k,z,R,j,K,W,H,X,G)=>{const te=E.transform,Y=C.properties.get("color").toArray01();Y[3]=z;const me=E.frameCounter/1e3%1;return{u_fog_matrix:k?te.calculateFogTileMatrix(k):E.identityMat,u_fog_range:C.getFovAdjustedRange(te._fov),u_fog_color:Y,u_fog_horizon_blend:C.properties.get("horizon-blend"),u_fog_temporal_offset:me,u_frustum_tl:R,u_frustum_tr:j,u_frustum_br:K,u_frustum_bl:W,u_globe_pos:H,u_globe_radius:X,u_viewport:G,u_globe_transition:s.globeToMercatorTransition(te.zoom),u_is_globe:+(te.projection.name==="globe")}})(this,_,d,g,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.exported.devicePixelRatio,this.transform.height*s.exported.devicePixelRatio]);a.setFogUniformValues(n,w)}}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const n=this.context.gl,a=n.createTexture();return n.bindTexture(n.TEXTURE_2D,a),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,a=this._backgroundTiles={},d=this.transform.coveringTiles({tileSize:512});for(const _ of d)a[_.key]=n[_.key]||new s.Tile(_,512,this.transform.tileZoom,this);return a}clearBackgroundTiles(){this._backgroundTiles={}}}class Pa{constructor(n=0,a=0,d=0,_=0){if(isNaN(n)||n<0||isNaN(a)||a<0||isNaN(d)||d<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=a,this.left=d,this.right=_}interpolate(n,a,d){return a.top!=null&&n.top!=null&&(this.top=s.number(n.top,a.top,d)),a.bottom!=null&&n.bottom!=null&&(this.bottom=s.number(n.bottom,a.bottom,d)),a.left!=null&&n.left!=null&&(this.left=s.number(n.left,a.left,d)),a.right!=null&&n.right!=null&&(this.right=s.number(n.right,a.right,d)),this}getCenter(n,a){const d=s.clamp((this.left+n-this.right)/2,0,n),_=s.clamp((this.top+a-this.bottom)/2,0,a);return new s.pointGeometry(d,_)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new Pa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Eu(c,n){const a=s.getColumn(c,3);s.fromQuat(c,n),s.setColumn(c,3,a)}function Rs(c,n){const a=s.identity$1([]);return s.rotateZ$1(a,a,-n),s.rotateX$1(a,a,-c),a}function Os(c,n){const a=[c[0],c[1],0],d=[n[0],n[1],0];if(s.length(a)>=1e-15){const w=s.normalize([],a);s.scale$2(d,w,s.dot(d,w)),n[0]=d[0],n[1]=d[1]}const _=s.cross([],n,c);if(s.len(_)<1e-15)return null;const g=Math.atan2(-_[1],_[0]);return Rs(Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2]),g)}class Pt{constructor(n,a){this.position=n,this.orientation=a}get position(){return this._position}set position(n){if(n){const a=n instanceof s.MercatorCoordinate?n:new s.MercatorCoordinate(n[0],n[1],n[2]);this._renderWorldCopies&&(a.x=s.wrap(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(n,a){if(this.orientation=null,!this.position)return;const d=this._elevation?this._elevation.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(n)):0,_=this.position,g=s.MercatorCoordinate.fromLngLat(n,d),w=[g.x-_.x,g.y-_.y,g.z-_.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=Os(w,a)}setPitchBearing(n,a){this.orientation=Rs(s.degToRad(n),s.degToRad(-a))}}class vr{constructor(n,a){this._transform=s.identity([]),this.orientation=a,this.position=n}get mercatorPosition(){const n=this.position;return new s.MercatorCoordinate(n[0],n[1],n[2])}get position(){const n=s.getColumn(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var a;n&&s.setColumn(this._transform,3,[(a=n)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||s.identity$1([]),n&&Eu(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,a){this._orientation=Rs(n,a),Eu(this._transform,this._orientation)}forward(){const n=s.getColumn(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=s.getColumn(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=s.getColumn(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,a){const d=new Float64Array(16);return s.invert(d,this.getWorldToCamera(n,a)),d}getWorldToCameraPosition(n,a,d){const _=this.position;s.scale$2(_,_,-n);const g=new Float64Array(16);return s.fromScaling(g,[d,d,d]),s.translate(g,g,_),g[10]*=a,g}getWorldToCamera(n,a){const d=new Float64Array(16),_=new Float64Array(4),g=this.position;return s.conjugate(_,this._orientation),s.scale$2(g,g,-n),s.fromQuat(d,_),s.translate(d,d,g),d[1]*=-1,d[5]*=-1,d[9]*=-1,d[13]*=-1,d[8]*=a,d[9]*=a,d[10]*=a,d[11]*=a,d}getCameraToClipPerspective(n,a,d,_){const g=new Float64Array(16);return s.perspective(g,n,a,d,_),g}getDistanceToElevation(n){const a=n===0?0:s.mercatorZfromAltitude(n,this.position[1]),d=this.forward();return(a-this.position[2])/d[2]}clone(){return new vr([...this.position],[...this.orientation])}}function Su(c,n){const a=Da(c.projection,c.zoom,c.width,c.height),d=function(g,w,E,C,k){const z=new s.LngLat(E.lng-180*Fr,E.lat),R=new s.LngLat(E.lng+180*Fr,E.lat),j=g.project(z.lng,z.lat),K=g.project(R.lng,R.lat),W=-Math.atan2(K.y-j.y,K.x-j.x),H=s.MercatorCoordinate.fromLngLat(E);H.y=s.clamp(H.y,-.999975,.999975);const X=H.toLngLat(),G=g.project(X.lng,X.lat),te=s.MercatorCoordinate.fromLngLat(X);te.x+=Fr;const Y=te.toLngLat(),me=g.project(Y.lng,Y.lat),fe=La(me.x-G.x,me.y-G.y,W),oe=s.MercatorCoordinate.fromLngLat(X);oe.y+=Fr;const pe=oe.toLngLat(),ue=g.project(pe.lng,pe.lat),be=La(ue.x-G.x,ue.y-G.y,W),Be=Math.abs(fe.x)/Math.abs(be.y),dt=s.identity([]);s.rotateZ(dt,dt,-W*(1-(k?0:C)));const Ie=s.identity([]);return s.scale(Ie,Ie,[1,1-(1-Be)*C,1]),Ie[4]=-be.x/be.y*C,s.rotateZ(Ie,Ie,W),s.multiply(Ie,dt,Ie),Ie}(c.projection,0,c.center,a,n),_=Cu(c);return s.scale(d,d,[_,_,1]),d}function Cu(c){const n=c.projection,a=Da(c.projection,c.zoom,c.width,c.height),d=Au(n,c.center),_=Au(n,s.LngLat.convert(n.center));return Math.pow(2,d*a+(1-a)*_)}function Da(c,n,a,d,_=1/0){const g=c.range;if(!g)return 0;const w=Math.min(_,Math.max(a,d)),E=Math.log(w/1024)/Math.LN2;return s.smoothstep(g[0]+E,g[1]+E,n)}const Fr=1/4e4;function Au(c,n){const a=s.clamp(n.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),d=new s.LngLat(n.lng-180*Fr,a),_=new s.LngLat(n.lng+180*Fr,a),g=c.project(d.lng,a),w=c.project(_.lng,a),E=s.MercatorCoordinate.fromLngLat(d),C=s.MercatorCoordinate.fromLngLat(_),k=w.x-g.x,z=w.y-g.y,R=C.x-E.x,j=C.y-E.y,K=Math.sqrt((R*R+j*j)/(k*k+z*z));return Math.log(K)/Math.LN2}function La(c,n,a){const d=Math.cos(a),_=Math.sin(a);return{x:c*d-n*_,y:c*_+n*d}}class Ba{constructor(n,a,d,_,g,w,E){this.tileSize=512,this._renderWorldCopies=g===void 0||g,this._minZoom=n||0,this._maxZoom=a||22,this._minPitch=d==null?0:d,this._maxPitch=_==null?60:_,this.setProjection(w),this.setMaxBounds(E),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Pa,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new vr,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const n=new Ba(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(n){const a=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||a)&&this._updateCameraOnTerrain(),(n||a)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return s.pick(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const a=this.projection?this.getProjection():void 0;this.projection=s.getProjection(this.projectionOptions);const d=!D(a,this.getProjection());return d&&this._calcMatrices(),this.mercatorFromTransition=!1,d}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.getProjection({name:"mercator"});const a=n!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.pointGeometry(this.width,this.height)}get bearing(){return s.wrap(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const a=-n*Math.PI/180;var d;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=(d=new s.ARRAY_TYPE(4),s.ARRAY_TYPE!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d),function(_,g,w){var E=g[0],C=g[1],k=g[2],z=g[3],R=Math.sin(w),j=Math.cos(w);_[0]=E*j+k*R,_[1]=C*j+z*R,_[2]=E*-R+k*j,_[3]=C*-R+z*j}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const a=s.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=n/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const a=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const n=this._elevation;this._centerAltitude=n.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=n.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],d=this.horizonLineFromTop();let _=0,g=0;for(let w=0;w<a.length;w++){const E=new s.pointGeometry(a[w][0]*this.width,d+a[w][1]*(this.height-d)),C=n.pointCoordinate(E);if(!C)continue;const k=1/Math.hypot(C[0]-this._camera.position[0],C[1]-this._camera.position[1]);_+=C[3]*k,g+=k}return g===0?NaN:_/g}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),d=this.pixelsPerMeter/this.worldSize*a,_=this._mercatorZfromZoom(n),g=this._mercatorZfromZoom(this._maxZoom),w=Math.max(_-d,g);this._setZoom(this._zoomFromMercatorZ(w))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let d;d=n.z<this._camera.position[2]?[a.x,a.y,a.z]:[n.x,n.y,n.z];const _=s.length(s.sub([],this._camera.position,d));return s.clamp(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let a=!1;if(n.orientation&&!s.exactEquals(n.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(n.orientation)),n.position){const d=[n.position.x,n.position.y,n.position.z];s.exactEquals$1(d,this._camera.position)||(this._setCameraPosition(d),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,a=new Pt;return a.position=new s.MercatorCoordinate(n[0],n[1],n[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(n){if(!s.length$1(n))return!1;s.normalize$1(n,n);const a=s.transformQuat([],[0,0,-1],n),d=s.transformQuat([],[0,-1,0],n);if(d[2]<0)return!1;const _=Os(a,d);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(n){const a=this.zoomScale(this.minZoom)*this.tileSize,d=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;n[2]=s.clamp(n[2],_/d,_/a),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,a,d){this._unmodified=!1,this._edgeInsets.interpolate(n,a,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const a=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(n){const a=[new s.UnwrappedTileID(0,n)];if(this.renderWorldCopies){const d=this.pointCoordinate(new s.pointGeometry(0,0)),_=this.pointCoordinate(new s.pointGeometry(this.width,0)),g=this.pointCoordinate(new s.pointGeometry(this.width,this.height)),w=this.pointCoordinate(new s.pointGeometry(0,this.height)),E=Math.floor(Math.min(d.x,_.x,g.x,w.x)),C=Math.floor(Math.max(d.x,_.x,g.x,w.x)),k=1;for(let z=E-k;z<=C+k;z++)z!==0&&a.push(new s.UnwrappedTileID(z,n))}return a}coveringTiles(n){let a=this.coveringZoomLevel(n);const d=a,_=this.elevation&&!n.isTerrainDEM,g=this.projection.name==="mercator";if(n.minzoom!==void 0&&a<n.minzoom)return[];n.maxzoom!==void 0&&a>n.maxzoom&&(a=n.maxzoom);const w=this.locationCoordinate(this.center),E=this.center.lat,C=1<<a,k=[C*w.x,C*w.y,0],z=this.projection.name==="globe",R=!z,j=s.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,R),K=z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),W=C*s.mercatorZfromAltitude(1,this.center.lat),H=this._camera.position[2]/s.mercatorZfromAltitude(1,this.center.lat),X=[C*K.x,C*K.y,H*(R?1:W)],G=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),te=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?a:0,Y=n.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,me=n.isTerrainDEM?-Y:this._elevation?this._elevation.getMinElevationBelowMSL():0,fe=this.projection.isReprojectedInTileSpace?Cu(this):1,oe=qe=>{const it=new s.MercatorCoordinate(qe.x+25e-6,qe.y,qe.z),It=new s.MercatorCoordinate(qe.x,qe.y+25e-6,qe.z),St=qe.toLngLat(),Vt=it.toLngLat(),Wt=It.toLngLat(),ii=this.locationCoordinate(St),bi=this.locationCoordinate(Vt),Ut=this.locationCoordinate(Wt),ai=Math.hypot(bi.x-ii.x,bi.y-ii.y),Ii=Math.hypot(Ut.x-ii.x,Ut.y-ii.y);return Math.sqrt(ai*Ii)*fe/25e-6},pe=qe=>{const mt=Y,it=me;return{aabb:s.tileAABB(this,C,0,0,0,qe,it,mt,this.projection),zoom:0,x:0,y:0,minZ:it,maxZ:mt,wrap:qe,fullyVisible:!1}},ue=[];let be=[];const Be=a,dt=n.reparseOverscaled?d:a,Ie=qe=>qe*qe,Je=Ie((H-this._centerAltitude)*W),rt=qe=>{if(!this._elevation||!qe.tileID||!g)return;const mt=this._elevation.getMinMaxForTile(qe.tileID),it=qe.aabb;mt?(it.min[2]=mt.min,it.max[2]=mt.max,it.center[2]=(it.min[2]+it.max[2])/2):(qe.shouldSplit=wt(qe),qe.shouldSplit||(it.min[2]=it.max[2]=it.center[2]=this._centerAltitude))},wt=qe=>{if(qe.zoom<te)return!0;if(qe.zoom===Be)return!1;if(qe.shouldSplit!=null)return qe.shouldSplit;const mt=qe.aabb.distanceX(X),it=qe.aabb.distanceY(X);let It=Je,St=1;if(z){It=Ie(qe.aabb.distanceZ(X));const Wt=Math.pow(2,qe.zoom),ii=s.latFromMercatorY((qe.y+1)/Wt),bi=s.latFromMercatorY(qe.y/Wt),Ut=Math.min(Math.max(E,ii),bi),ai=s.circumferenceAtLatitude(Ut)/s.circumferenceAtLatitude(E);if(St=Ut===E?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ai/this._mercatorScaleRatio),this.zoom<=s.GLOBE_ZOOM_THRESHOLD_MIN&&qe.zoom===Be-1&&ai>=.9)return!0}else if(_&&(It=Ie(qe.aabb.distanceZ(X)*W)),this.projection.isReprojectedInTileSpace&&d<=5){const Wt=Math.pow(2,qe.zoom),ii=oe(new s.MercatorCoordinate((qe.x+.5)/Wt,(qe.y+.5)/Wt));St=ii>.85?1:ii}const Vt=mt*mt+it*it+It;return Vt<Ie((1<<Be-qe.zoom)*G*St*((Wt,ii)=>{if(ii*Ie(.707)<Wt)return 1;const bi=Math.sqrt(ii/Wt);return bi/(1.4144271570014144+(Math.pow(1.1,bi-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(It,Je),Vt))};if(this.renderWorldCopies)for(let qe=1;qe<=3;qe++)ue.push(pe(-qe)),ue.push(pe(qe));for(ue.push(pe(0));ue.length>0;){const qe=ue.pop(),mt=qe.x,it=qe.y;let It=qe.fullyVisible;if(!It){const St=qe.aabb.intersects(j);if(St===0)continue;It=St===2}if(qe.zoom!==Be&&wt(qe))for(let St=0;St<4;St++){const Vt=(mt<<1)+St%2,Wt=(it<<1)+(St>>1),ii={aabb:g?qe.aabb.quadrant(St):s.tileAABB(this,C,qe.zoom+1,Vt,Wt,qe.wrap,qe.minZ,qe.maxZ,this.projection),zoom:qe.zoom+1,x:Vt,y:Wt,wrap:qe.wrap,fullyVisible:It,tileID:void 0,shouldSplit:void 0,minZ:qe.minZ,maxZ:qe.maxZ};_&&!z&&(ii.tileID=new s.OverscaledTileID(qe.zoom+1===Be?dt:qe.zoom+1,qe.wrap,qe.zoom+1,Vt,Wt),rt(ii)),ue.push(ii)}else{const St=qe.zoom===Be?dt:qe.zoom;if(n.minzoom&&n.minzoom>St)continue;const Vt=k[0]-(.5+mt+(qe.wrap<<qe.zoom))*(1<<a-qe.zoom),Wt=k[1]-.5-it,ii=qe.tileID?qe.tileID:new s.OverscaledTileID(St,qe.wrap,qe.zoom,mt,it);be.push({tileID:ii,distanceSq:Vt*Vt+Wt*Wt})}}if(this.fogCullDistSq){const qe=this.fogCullDistSq,mt=this.horizonLineFromTop();be=be.filter(it=>{const It=[0,0,0,1],St=[s.EXTENT,s.EXTENT,0,1],Vt=this.calculateFogTileMatrix(it.tileID.toUnwrapped());s.transformMat4$1(It,It,Vt),s.transformMat4$1(St,St,Vt);const Wt=s.getAABBPointSquareDist(It,St);if(Wt===0)return!0;let ii=!1;const bi=this._elevation;if(bi&&Wt>qe&&mt!==0){const Ut=this.calculateProjMatrix(it.tileID.toUnwrapped());let ai;n.isTerrainDEM||(ai=bi.getMinMaxForTile(it.tileID)),ai||(ai={min:me,max:Y});const Ii=s.furthestTileCorner(this.rotation),en=[Ii[0]*s.EXTENT,Ii[1]*s.EXTENT,ai.max];s.transformMat4(en,en,Ut),ii=(1-en[1])*this.height*.5<mt}return Wt<qe||ii})}return be.sort((qe,mt)=>qe.distanceSq-mt.distanceSq).map(qe=>qe.tileID)}resize(n,a){this.width=n,this.height=a,this.pixelsToGLUnits=[2/n,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const a=s.clamp(n.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),d=this.projection.project(n.lng,a);return new s.pointGeometry(d.x*this.worldSize,d.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(n,a){let d,_;const g=this.centerPoint;if(this.projection.name==="globe"){const E=this.worldSize;d=(a.x-g.x)/E,_=(a.y-g.y)/E}else{const E=this.pointCoordinate(a),C=this.pointCoordinate(g);d=E.x-C.x,_=E.y-C.y}const w=this.locationCoordinate(n);this.setLocation(new s.MercatorCoordinate(w.x-d,w.y-_))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,a){const d=a?s.mercatorZfromAltitude(a,n.lat):void 0,_=this.projection.project(n.lng,n.lat);return new s.MercatorCoordinate(_.x,_.y,d)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,a){const d=a!=null?a:this._centerAltitude,_=[n.x,n.y,0,1],g=[n.x,n.y,1,1];s.transformMat4$1(_,_,this.pixelMatrixInverse),s.transformMat4$1(g,g,this.pixelMatrixInverse);const w=g[3];s.scale$1(_,_,1/_[3]),s.scale$1(g,g,1/w);const E=_[2],C=g[2];return{p0:_,p1:g,t:E===C?0:(d-E)/(C-E)}}screenPointToMercatorRay(n){const a=[n.x,n.y,0,1],d=[n.x,n.y,1,1];return s.transformMat4$1(a,a,this.pixelMatrixInverse),s.transformMat4$1(d,d,this.pixelMatrixInverse),s.scale$1(a,a,1/a[3]),s.scale$1(d,d,1/d[3]),a[2]=s.mercatorZfromAltitude(a[2],this._center.lat)*this.worldSize,d[2]=s.mercatorZfromAltitude(d[2],this._center.lat)*this.worldSize,s.scale$1(a,a,1/this.worldSize),s.scale$1(d,d,1/this.worldSize),new s.Ray([a[0],a[1],a[2]],s.normalize([],s.sub([],d,a)))}rayIntersectionCoordinate(n){const{p0:a,p1:d,t:_}=n,g=s.mercatorZfromAltitude(a[2],this._center.lat),w=s.mercatorZfromAltitude(d[2],this._center.lat);return new s.MercatorCoordinate(s.number(a[0],d[0],_)/this.worldSize,s.number(a[1],d[1],_)/this.worldSize,s.number(g,w,_))}pointCoordinate(n,a=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,a)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let a=this.projection.pointCoordinate3D(this,n.x,n.y);if(a)return new s.MercatorCoordinate(a[0],a[1],a[2]);let d=0,_=this.horizonLineFromTop();if(n.y>_)return this.pointCoordinate(n);const g=.02*_,w=n.clone();for(let E=0;E<10&&_-d>g;E++){w.y=s.number(d,_,.66);const C=this.projection.pointCoordinate3D(this,w.x,w.y);C?(_=w.y,a=C):d=w.y}return a?new s.MercatorCoordinate(a[0],a[1],a[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}_coordinatePoint(n,a){const d=a&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,_=[n.x*this.worldSize,n.y*this.worldSize,d+n.toAltitude(),1];return s.transformMat4$1(_,_,this.pixelMatrix),_[3]>0?new s.pointGeometry(_[0]/_[3],_[1]/_[3]):new s.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(n,a){const d=new s.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),_=new s.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),g=new s.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),w=new s.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let E=this.pointCoordinate(d,n),C=this.pointCoordinate(_,n);const k=this.pointCoordinate(g,a),z=this.pointCoordinate(w,a),R=(j,K)=>(K.y-j.y)/(K.x-j.x);return E.y>1&&C.y>=0?E=new s.MercatorCoordinate((1-z.y)/R(z,E)+z.x,1):E.y<0&&C.y<=1&&(E=new s.MercatorCoordinate(-z.y/R(z,E)+z.x,0)),C.y>1&&E.y>=0?C=new s.MercatorCoordinate((1-k.y)/R(k,C)+k.x,1):C.y<0&&E.y<=1&&(C=new s.MercatorCoordinate(-k.y/R(k,C)+k.x,0)),new s.LngLatBounds().extend(this.coordinateLocation(E)).extend(this.coordinateLocation(C)).extend(this.coordinateLocation(z)).extend(this.coordinateLocation(k))}_getBounds3D(){const n=this.elevation;if(!n.visibleDemTiles.length)return this._getBounds(0,0);const a=n.visibleDemTiles.reduce((d,_)=>{if(_.dem){const g=_.dem.tree;d.min=Math.min(d.min,g.minimums[0]),d.max=Math.max(d.max,g.maximums[0])}return d},{min:Number.MAX_VALUE,max:0});return this._getBounds(a.min*n.exaggeration(),a.max*n.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(n=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,d=this.height/2-a*(1-this._horizonShift);return n?Math.max(0,d):d}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-s.MAX_MERCATOR_LATITUDE,this.maxLat=s.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=s.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=s.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=s.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,a){return this.projection.createTileMatrix(this,a,n)}calculateDistanceTileData(n){const a=n.key,d=this._distanceTileDataCache;if(d[a])return d[a];const _=n.canonical,g=1/this.height,w=this.cameraWorldSize/this.zoomScale(_.z),E=(_.x+Math.pow(2,_.z)*n.wrap)*w,C=_.y*w,k=this.point,z=this.angle,R=Math.sin(-z),j=-Math.cos(-z);return d[a]={bearing:[R,j],center:[(k.x-E)*g,(k.y-C)*g],scale:w/s.EXTENT*g},d[a]}calculateFogTileMatrix(n){const a=n.key,d=this._fogTileMatrixCache;if(d[a])return d[a];const _=this.projection.createTileMatrix(this,this.cameraWorldSize,n);return s.multiply(_,this.worldToFogMatrix,_),d[a]=new Float32Array(_),d[a]}calculateProjMatrix(n,a=!1){const d=n.key,_=a?this._alignedProjMatrixCache:this._projMatrixCache;if(_[d])return _[d];const g=this.calculatePosMatrix(n,this.worldSize);return s.multiply(g,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:a?this.alignedProjMatrix:this.projMatrix,g),_[d]=new Float32Array(g),_[d]}calculatePixelsToTileUnitsMatrix(n){const a=n.tileID.key,d=this._pixelsToTileUnitsCache;if(d[a])return d[a];const _=function(g,w){const{scale:E}=g.tileTransform,C=E*s.EXTENT/(g.tileSize*Math.pow(2,w.zoom-g.tileID.overscaledZ+g.tileID.canonical.z));return k=new Float32Array(4),j=(z=w.inverseAdjustmentMatrix)[1],K=z[2],W=z[3],X=(R=[C,C])[1],k[0]=z[0]*(H=R[0]),k[1]=j*H,k[2]=K*X,k[3]=W*X,k;var k,z,R,j,K,W,H,X}(n,this);return d[a]=_,d[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const a=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(a),_=this._camera.forward(),g=s.mercatorZfromAltitude(1,this._center.lat);d[2]/=g,_[2]/=g,s.normalize(_,_);const w=n.raycast(d,_,n.exaggeration());if(w){const E=s.scaleAndAdd([],d,_,w),C=new s.MercatorCoordinate(E[0],E[1],s.mercatorZfromAltitude(E[2],s.latFromMercatorY(E[1]))),k=(C.z+s.length([C.x-d[0],C.y-d[1],C.z-d[2]*g]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(k),this._centerAltitude=C.toAltitude(),this._center=this.coordinateLocation(C),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const n=this._elevation;this._updateCameraState();const a=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(a),_=n.getAtPointOrZero(new s.MercatorCoordinate(...d)),g=this._minimumHeightOverTerrain()*Math.cos(s.degToRad(this._maxPitch)),w=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*_;if(w<g){const E=this.locationCoordinate(this._center,this._centerAltitude),C=[E.x-d[0],E.y-d[1],E.z-d[2]],k=s.length(C);C[2]-=(g-w)/this._pixelsPerMercatorPixel;const z=s.length(C);if(z===0)return;s.scale$2(C,C,k/z*this._pixelsPerMercatorPixel),this._camera.position=[E.x-C[0],E.y-C[1],E.z*this._pixelsPerMercatorPixel-C[2]],this._camera.orientation=Os(C,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const j=this.center;return j.lat=s.clamp(j.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(j.lng=s.clamp(j.lng,this.minLng,this.maxLng)),this.center=j,void(this._constraining=!1)}const a=this._unmodified,{x:d,y:_}=this.point;let g=0,w=d,E=_;const C=this.width/2,k=this.height/2,z=this.worldMinY*this.scale,R=this.worldMaxY*this.scale;if(_-k<z&&(E=z+k),_+k>R&&(E=R-k),R-z<this.height&&(g=Math.max(g,this.height/(R-z)),E=(R+z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const j=this.worldMinX*this.scale,K=this.worldMaxX*this.scale,W=this.worldSize/2-(j+K)/2;w=(d+W+this.worldSize)%this.worldSize-W,w-C<j&&(w=j+C),w+C>K&&(w=K-C),K-j<this.width&&(g=Math.max(g,this.width/(K-j)),w=(K+j)/2)}w===d&&E===_||(this.center=this.unproject(new s.pointGeometry(w,E))),g&&(this.zoom+=this.scaleZoom(g)),this._constrainCameraAltitude(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,a=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.mercatorZfromAltitude(1,this.center.lat)/s.mercatorZfromAltitude(1,s.GLOBE_SCALE_MATCH_LATITUDE));const d=Da(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,d),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const _=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?a:1),g=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);g[8]=2*-n.x/this.width,g[9]=2*n.y/this.height;let w=s.mul([],g,_);if(this.projection.isReprojectedInTileSpace){const fe=this.locationCoordinate(this.center),oe=s.identity([]);s.translate(oe,oe,[fe.x*this.worldSize,fe.y*this.worldSize,0]),s.multiply(oe,oe,Su(this)),s.translate(oe,oe,[-fe.x*this.worldSize,-fe.y*this.worldSize,0]),s.multiply(w,w,oe),this.inverseAdjustmentMatrix=function(pe){const ue=Su(pe,!0);return Ke([],[ue[0],ue[1],ue[4],ue[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=s.scale([],w,[this.worldSize,this.worldSize,this.worldSize/a,1]),this.projMatrix=w,this.invProjMatrix=s.invert(new Float64Array(16),this.projMatrix);const E=s.invert([],g);this.frustumCorners=s.FrustumCorners.fromInvProjectionMatrix(E,this.horizonLineFromTop(),this.height);const C=new Float32Array(16);s.identity(C),s.scale(C,C,[1,-1,1]),s.rotateX(C,C,this._pitch),s.rotateZ(C,C,this.angle);const k=s.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),z=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;k[8]=2*-n.x/this.width,k[9]=2*(n.y+z)/this.height,this.skyboxMatrix=s.multiply(C,k,C);const R=this.point,j=R.x,K=R.y,W=this.width%2/2,H=this.height%2/2,X=Math.cos(this.angle),G=Math.sin(this.angle),te=j-Math.round(j)+X*W+G*H,Y=K-Math.round(K)+X*H+G*W,me=new Float64Array(w);if(s.translate(me,me,[te>.5?te-1:te,Y>.5?Y-1:Y,0]),this.alignedProjMatrix=me,w=s.create(),s.scale(w,w,[this.width/2,-this.height/2,1]),s.translate(w,w,[1,-1,0]),this.labelPlaneMatrix=w,w=s.create(),s.scale(w,w,[1,-1,1]),s.translate(w,w,[-1,-1,0]),s.scale(w,w,[2/this.width,2/this.height,1]),this.glCoordMatrix=w,this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},w=s.invert(new Float64Array(16),this.pixelMatrix),!w)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=w,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.calculateGlobeMatrix(this);const fe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.transformMat4(fe,fe,_),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=w;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSize,a=this.cameraPixelsPerMeter,d=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,g=[n,n,a];s.scale$2(g,g,_),s.scale$2(d,d,-1),s.multiply$2(d,d,g);const w=s.create();s.translate(w,w,d),s.scale(w,w,g),this.mercatorFogMatrix=w,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,a,_)}_computeCameraPosition(n){const a=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,d=this._camera.forward(),_=this.point,g=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-n/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-d[0]*g,_.y/this.worldSize-d[1]*g,n/this.worldSize*this._centerAltitude-d[2]*g]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),d=n[2];let _=1;d>0&&(_=Math.min((a-this._camera.position[2])/d,1)),this._camera.position=s.scaleAndAdd([],this._camera.position,n,_),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const n=this._camera.position,a=this._camera.forward(),{pitch:d,bearing:_}=this._camera.getPitchBearing(),g=s.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,w=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.degToRad(this._maxPitch)),E=Math.max((n[2]-g)/Math.cos(d),w),C=this._zoomFromMercatorZ(E);s.scaleAndAdd(n,n,a,E),this._pitch=s.clamp(d,s.degToRad(this.minPitch),s.degToRad(this.maxPitch)),this.angle=s.wrap(_,-Math.PI,Math.PI),this._setZoom(s.clamp(C,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.MercatorCoordinate(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,a){const d=Math.min(n.x,a.x),_=Math.max(n.x,a.x),g=Math.min(n.y,a.y),w=Math.max(n.y,a.y);if(g<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const E=[new s.pointGeometry(d,g),new s.pointGeometry(_,w),new s.pointGeometry(d,w),new s.pointGeometry(_,g)],C=this.renderWorldCopies?-3:0,k=this.renderWorldCopies?4:1;for(const z of E){const R=this.pointRayIntersection(z);if(R.t<0)return!0;const j=this.rayIntersectionCoordinate(R);if(j.x<C||j.y<0||j.x>k||j.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.pointGeometry(0,0),new s.pointGeometry(this.width,this.height))}zoomDeltaToMovement(n,a){const d=s.length(s.sub([],this._camera.position,n)),_=this._zoomFromMercatorZ(d)+a;return d-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){const n=function(a,d){const _=[a[0],a[1],a[2],1];s.transformMat4$1(_,_,d);const g=Math.max(_[3],1e-6);return[_[0]/g,_[1]/g,_[2]/g,g]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.pointGeometry(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.pointGeometry(0,n))}}getCameraToCenterDistance(n){const a=Da(n,this.zoom,this.width,this.height,1024),d=n.pixelSpaceConversion(this.center.lat,this.worldSize,a);return .5/Math.tan(.5*this._fov)*this.height*d}}function Ra(c,n){let a=!1,d=null;const _=()=>{d=null,a&&(c(),d=setTimeout(_,n),a=!1)};return()=>(a=!0,d||_(),d)}class _d{constructor(n){this._hashName=n&&encodeURIComponent(n),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ra(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,s.window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),s.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const a=Mu(n);if(this._hashName){const d=this._hashName;let _=!1;const g=s.window.location.hash.slice(1).split("&").map(w=>{const E=w.split("=")[0];return E===d?(_=!0,`${E}=${a}`):w}).filter(w=>w);return _||g.push(`${d}=${a}`),`#${g.join("&")}`}return`#${a}`}_getCurrentHash(){const n=s.window.location.hash.replace("#","");if(this._hashName){let a;return n.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(a=d)}),(a&&a[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const a=this._getCurrentHash();if(a.length>=3&&!a.some(d=>isNaN(d))){const d=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(a[3]||0):n.getBearing();return n.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:d,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){const n=s.window.location.href.replace(/(#.+)?$/,this.getHashString());s.window.history.replaceState(s.window.history.state,null,n)}}function Mu(c,n){const a=c.getCenter(),d=Math.round(100*c.getZoom())/100,_=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,_),w=Math.round(a.lng*g)/g,E=Math.round(a.lat*g)/g,C=c.getBearing(),k=c.getPitch();let z=n?`/${w}/${E}/${d}`:`${d}/${E}/${w}`;return(C||k)&&(z+="/"+Math.round(10*C)/10),k&&(z+=`/${Math.round(k)}`),z}const oo={linearity:.3,easing:s.bezier(0,0,.3,1)},Wp=s.extend({deceleration:2500,maxSpeed:1400},oo),Hp=s.extend({deceleration:20,maxSpeed:1400},oo),gd=s.extend({deceleration:1e3,maxSpeed:360},oo),Ul=s.extend({deceleration:1e3,maxSpeed:90},oo);class Iu{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.exported.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,a=s.exported.now();for(;n.length>0&&a-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,pan:new s.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)a.zoom+=g.zoomDelta||0,a.bearing+=g.bearingDelta||0,a.pitch+=g.pitchDelta||0,g.panDelta&&a.pan._add(g.panDelta),g.around&&(a.around=g.around),g.pinchAround&&(a.pinchAround=g.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(a.pan.mag()){const g=Fa(a.pan.mag(),d,s.extend({},Wp,n||{}));_.offset=a.pan.mult(g.amount/a.pan.mag()),_.center=this._map.transform.center,Oa(_,g)}if(a.zoom){const g=Fa(a.zoom,d,Hp);_.zoom=this._map.transform.zoom+g.amount,Oa(_,g)}if(a.bearing){const g=Fa(a.bearing,d,gd);_.bearing=this._map.transform.bearing+s.clamp(g.amount,-179,179),Oa(_,g)}if(a.pitch){const g=Fa(a.pitch,d,Ul);_.pitch=this._map.transform.pitch+g.amount,Oa(_,g)}if(_.zoom||_.bearing){const g=a.pinchAround===void 0?a.around:a.pinchAround;_.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function Oa(c,n){(!c.duration||c.duration<n.duration)&&(c.duration=n.duration,c.easing=n.easing)}function Fa(c,n,a){const{maxSpeed:d,linearity:_,deceleration:g}=a,w=s.clamp(c*_/(n/1e3),-d,d),E=Math.abs(w)/(g*_);return{easing:a.easing,duration:1e3*E,amount:w*(E/2)}}class Gn extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,d,_={}){const g=Se(a.getCanvasContainer(),d),w=a.unproject(g);super(n,s.extend({point:g,lngLat:w,originalEvent:d},_)),this._defaultPrevented=!1,this.target=a}}class Fs extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,d){const _=n==="touchend"?d.changedTouches:d.touches,g=Pe(a.getCanvasContainer(),_),w=g.map(C=>a.unproject(C)),E=g.reduce((C,k,z,R)=>C.add(k.div(R.length)),new s.pointGeometry(0,0));super(n,{points:g,point:E,lngLats:w,lngLat:a.unproject(E),originalEvent:d}),this._defaultPrevented=!1}}class yd extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,d){super(n,{originalEvent:d}),this._defaultPrevented=!1}}class vd{constructor(n,a){this._map=n,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new yd(n.type,this._map,n))}mousedown(n,a){return this._mousedownPos=a,this._firePreventable(new Gn(n.type,this._map,n))}mouseup(n){this._map.fire(new Gn(n.type,this._map,n))}preclick(n){const a=s.extend({},n);a.type="preclick",this._map.fire(new Gn(a.type,this._map,a))}click(n,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(n),this._map.fire(new Gn(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new Gn(n.type,this._map,n))}mouseover(n){this._map.fire(new Gn(n.type,this._map,n))}mouseout(n){this._map.fire(new Gn(n.type,this._map,n))}touchstart(n){return this._firePreventable(new Fs(n.type,this._map,n))}touchmove(n){this._map.fire(new Fs(n.type,this._map,n))}touchend(n){this._map.fire(new Fs(n.type,this._map,n))}touchcancel(n){this._map.fire(new Fs(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xd{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new Gn(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Gn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new Gn(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class bd{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,a){this.isEnabled()&&n.shiftKey&&n.button===0&&(He(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(n,a){if(!this._active)return;const d=a;if(this._lastPos.equals(d)||!this._box&&d.dist(this._startPos)<this._clickTolerance)return;const _=this._startPos;this._lastPos=d,this._box||(this._box=q("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const g=Math.min(_.x,d.x),w=Math.max(_.x,d.x),E=Math.min(_.y,d.y),C=Math.max(_.y,d.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${g}px,${E}px)`,this._box.style.width=w-g+"px",this._box.style.height=C-E+"px")})}mouseupWindow(n,a){if(!this._active||n.button!==0)return;const d=this._startPos,_=a;if(this.reset(),Ne(),d.x!==_.x||d.y!==_.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:g=>g.fitScreenCoordinates(d,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ee(),delete this._startPos,delete this._lastPos}_fireEvent(n,a){return this._map.fire(new s.Event(n,{originalEvent:a}))}}function Nl(c,n){const a={};for(let d=0;d<c.length;d++)a[c[d].identifier]=n[d];return a}class Vs{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,a,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),d.length===this.numTouches&&(this.centroid=function(_){const g=new s.pointGeometry(0,0);for(const w of _)g._add(w);return g.div(_.length)}(a),this.touches=Nl(d,a)))}touchmove(n,a,d){if(this.aborted||!this.centroid)return;const _=Nl(d,a);for(const g in this.touches){const w=this.touches[g],E=_[g];(!E||E.dist(w)>30)&&(this.aborted=!0)}}touchend(n,a,d){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class jl{constructor(n){this.singleTap=new Vs(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,a,d){this.singleTap.touchstart(n,a,d)}touchmove(n,a,d){this.singleTap.touchmove(n,a,d)}touchend(n,a,d){const _=this.singleTap.touchend(n,a,d);if(_){const g=n.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(_)<30;if(g&&w||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class wd{constructor(){this._zoomIn=new jl({numTouches:1,numTaps:2}),this._zoomOut=new jl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,a,d){this._zoomIn.touchstart(n,a,d),this._zoomOut.touchstart(n,a,d)}touchmove(n,a,d){this._zoomIn.touchmove(n,a,d),this._zoomOut.touchmove(n,a,d)}touchend(n,a,d){const _=this._zoomIn.touchend(n,a,d),g=this._zoomOut.touchend(n,a,d);return _?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(_)},{originalEvent:n})}):g?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(g)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Td={0:1,2:2};class ql{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,a){return!1}_move(n,a){return{}}mousedown(n,a){if(this._lastPoint)return;const d=we(n);this._correctButton(n,d)&&(this._lastPoint=a,this._eventButton=d)}mousemoveWindow(n,a){const d=this._lastPoint;if(d){if(n.preventDefault(),this._eventButton!=null&&function(_,g){const w=Td[g];return _.buttons===void 0||(_.buttons&w)!==w}(n,this._eventButton))this.reset();else if(this._moved||!(a.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(d,a)}}mouseupWindow(n){this._lastPoint&&we(n)===this._eventButton&&(this._moved&&Ne(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ed extends ql{mousedown(n,a){super.mousedown(n,a),this._lastPoint&&(this._active=!0)}_correctButton(n,a){return a===0&&!n.ctrlKey}_move(n,a){return{around:a,panDelta:a.sub(n)}}}class ku extends ql{_correctButton(n,a){return a===0&&n.ctrlKey||a===2}_move(n,a){const d=.8*(a.x-n.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(n){n.preventDefault()}}class On extends ql{_correctButton(n,a){return a===0&&n.ctrlKey||a===2}_move(n,a){const d=-.5*(a.y-n.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(n){n.preventDefault()}}class Xp{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),s.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.pointGeometry(0,0)}touchstart(n,a,d){return this._calculateTransform(n,a,d)}touchmove(n,a,d){if(this._active&&!(d.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(d.length===1&&!s.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,a,d)}}touchend(n,a,d){this._calculateTransform(n,a,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,a,d){d.length>0&&(this._active=!0);const _=Nl(d,a),g=new s.pointGeometry(0,0),w=new s.pointGeometry(0,0);let E=0;for(const k in _){const z=_[k],R=this._touches[k];R&&(g._add(z),w._add(z.sub(R)),E++,_[k]=z)}if(this._touches=_,E<this._minTouches||!w.mag())return;const C=w.div(E);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(E),panDelta:C}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=q("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class $l{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,a,d){return{}}touchstart(n,a,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([a[0],a[1]]))}touchmove(n,a,d){const _=this._firstTwoTouches;if(!_)return;n.preventDefault();const[g,w]=_,E=Gl(d,a,g),C=Gl(d,a,w);if(!E||!C)return;const k=this._aroundCenter?null:E.add(C).div(2);return this._move([E,C],k,n)}touchend(n,a,d){if(!this._firstTwoTouches)return;const[_,g]=this._firstTwoTouches,w=Gl(d,a,_),E=Gl(d,a,g);w&&E||(this._active&&Ne(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Gl(c,n,a){for(let d=0;d<c.length;d++)if(c[d].identifier===a)return n[d]}function Sd(c,n){return Math.log(c/n)/Math.LN2}class so extends $l{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,a){const d=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(Sd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Sd(this._distance,d),pinchAround:a}}}function zu(c,n){return 180*c.angleWith(n)/Math.PI}class Us extends $l{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,a){const d=this._vector;if(this._vector=n[0].sub(n[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:zu(this._vector,d),pinchAround:a}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const a=25/(Math.PI*this._minDiameter)*360,d=zu(n,this._startVector);return Math.abs(d)<a}}function Ar(c){return Math.abs(c.y)>Math.abs(c.x)}class Zl extends $l{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,Ar(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,a,d){const _=this._lastPoints;if(!_)return;const g=n[0].sub(_[0]),w=n[1].sub(_[1]);return this._map._cooperativeGestures&&d.touches.length<3||(this._valid=this.gestureBeginsVertically(g,w,d.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(g.y+w.y)/2*-.5})}gestureBeginsVertically(n,a,d){if(this._valid!==void 0)return this._valid;const _=n.mag()>=2,g=a.mag()>=2;if(!_&&!g)return;if(!_||!g)return this._firstMove==null&&(this._firstMove=d),d-this._firstMove<100&&void 0;const w=n.y>0==a.y>0;return Ar(n)&&Ar(a)&&w}}const Rt={panStep:100,bearingStep:15,pitchStep:10};class Cd{constructor(){const n=Rt;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let a=0,d=0,_=0,g=0,w=0;switch(n.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:n.shiftKey?d=-1:(n.preventDefault(),g=-1);break;case 39:n.shiftKey?d=1:(n.preventDefault(),g=1);break;case 38:n.shiftKey?_=1:(n.preventDefault(),w=-1);break;case 40:n.shiftKey?_=-1:(n.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(d=0,_=0),{cameraAnimation:E=>{const C=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:Ad,zoom:a?Math.round(C)+a*(n.shiftKey?2:1):C,bearing:E.getBearing()+d*this._bearingStep,pitch:E.getPitch()+_*this._pitchStep,offset:[-g*this._panStep,-w*this._panStep],center:E.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ad(c){return c*(2-c)}const Ns=4.000244140625;class Va{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._handler=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,s.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||s.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=n.deltaMode===s.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const d=s.exported.now(),_=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,a!==0&&a%Ns==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(_*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),n.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=n,this._delta-=a,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=Se(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform,a=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const C=this._type==="wheel"&&Math.abs(this._delta)>Ns?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&k!==0&&(k=1/k);const z=a(),R=Math.pow(2,z),j=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):R;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(j*k))),this._type==="wheel"&&(this._startZoom=z,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:a(),_=this._startZoom,g=this._easing;let w,E=!1;if(this._type==="wheel"&&_&&g){const C=Math.min((s.exported.now()-this._lastWheelEventTime)/200,1),k=g(C);w=s.number(_,d,k),C<1?this._frameId||(this._frameId=!0):E=!0}else w=d,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:w-a(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let a=s.ease;if(this._prevEase){const d=this._prevEase,_=(s.exported.now()-d.start)/d.duration,g=d.easing(_+.01)-d.easing(_),w=.27/Math.sqrt(g*g+1e-4)*.01,E=Math.sqrt(.0729-w*w);a=s.bezier(w,E,.25,1)}return this._prevEase={start:s.exported.now(),duration:n,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=q("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(s.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Md{constructor(n,a){this._clickZoom=n,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Id{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,a){return n.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(n.shiftKey?-1:1),around:d.unproject(a)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class kd{constructor(){this._tap=new jl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,a,d){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=a[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(n,a,d))}touchmove(n,a,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const _=a[0],g=_.y-this._swipePoint.y;return this._swipePoint=_,n.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(n,a,d)}touchend(n,a,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(n,a,d)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zd{constructor(n,a,d){this._el=n,this._mousePan=a,this._touchPan=d}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Pd{constructor(n,a,d){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=a,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Dd{constructor(n,a,d,_){this._el=n,this._touchZoom=a,this._touchRotate=d,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ua=c=>c.zoom||c.drag||c.pitch||c.rotate;class Wl extends s.Event{}class Pu{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,a){const d=s.sub([],a,n);this.radius=s.length(d[2]<0?s.div([],d,this.constants):[d[0],d[1],0])}projectRay(n){s.div(n,n,this.constants),s.normalize(n,n),s.mul$1(n,n,this.constants);const a=s.scale$2([],n,this.radius);if(a[2]>0){const d=s.scale$2([],[0,0,1],s.dot(a,[0,0,1])),_=s.scale$2([],s.normalize([],[a[0],a[1],0]),this.radius),g=s.add([],a,s.scale$2([],s.sub([],s.add([],_,d),a),2));a[0]=g[0],a[1]=g[1]}return a}}function ts(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class Ld{constructor(n,a){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Iu(n),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Pu,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),s.bindAll(["handleEvent","handleWindowEvent"],this);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[s.window.document,"mousemove",{capture:!0}],[s.window.document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[s.window,"blur",void 0]];for(const[_,g,w]of this._listeners)_.addEventListener(g,_===s.window.document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[n,a,d]of this._listeners)n.removeEventListener(a,n===s.window.document?this.handleWindowEvent:this.handleEvent,d)}_addDefaultHandlers(n){const a=this._map,d=a.getCanvasContainer();this._add("mapEvent",new vd(a,n));const _=a.boxZoom=new bd(a,n);this._add("boxZoom",_);const g=new wd,w=new Id;a.doubleClickZoom=new Md(w,g),this._add("tapZoom",g),this._add("clickZoom",w);const E=new kd;this._add("tapDragZoom",E);const C=a.touchPitch=new Zl(a);this._add("touchPitch",C);const k=new ku(n),z=new On(n);a.dragRotate=new Pd(n,k,z),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const R=new Ed(n),j=new Xp(a,n);a.dragPan=new zd(d,R,j),this._add("mousePan",R),this._add("touchPan",j,["touchZoom","touchRotate"]);const K=new Us,W=new so;a.touchZoomRotate=new Dd(d,W,K,E),this._add("touchRotate",K,["touchPan","touchZoom"]),this._add("touchZoom",W,["touchPan","touchRotate"]),this._add("blockableMapEvent",new xd(a));const H=a.scrollZoom=new Va(a,this);this._add("scrollZoom",H,["mousePan"]);const X=a.keyboard=new Cd;this._add("keyboard",X);for(const G of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[G]&&a[G].enable(n[G])}_add(n,a,d){this._handlers.push({handlerName:n,handler:a,allowed:d}),this._handlersById[n]=a}stop(n){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ua(this._eventsInProgress)||this.isZooming()}_blockedByActive(n,a,d){for(const _ in n)if(_!==d&&(!a||a.indexOf(_)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const a=[];for(const d of n)this._el.contains(d.target)&&a.push(d);return a}handleEvent(n,a){this._updatingCamera=!0;const d=n.type==="renderFrame",_=d?void 0:n,g={needsRenderFrame:!1},w={},E={},C=n.touches?this._getMapTouches(n.touches):void 0,k=C?Pe(this._el,C):d?void 0:Se(this._el,n);for(const{handlerName:j,handler:K,allowed:W}of this._handlers){if(!K.isEnabled())continue;let H;this._blockedByActive(E,W,j)?K.reset():K[a||n.type]&&(H=K[a||n.type](n,k,C),this.mergeHandlerResult(g,w,H,j,_),H&&H.needsRenderFrame&&this._triggerRenderFrame()),(H||K.isActive())&&(E[j]=K)}const z={};for(const j in this._previousActiveHandlers)E[j]||(z[j]=_);this._previousActiveHandlers=E,(Object.keys(z).length||ts(g))&&(this._changes.push([g,w,z]),this._triggerRenderFrame()),(Object.keys(E).length||ts(g))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:R}=g;R&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],R(this._map))}mergeHandlerResult(n,a,d,_,g){if(!d)return;s.extend(n,d);const w={handlerName:_,originalEvent:d.originalEvent||g};d.zoomDelta!==void 0&&(a.zoom=w),d.panDelta!==void 0&&(a.drag=w),d.pitchDelta!==void 0&&(a.pitch=w),d.bearingDelta!==void 0&&(a.rotate=w)}_applyChanges(){const n={},a={},d={};for(const[_,g,w]of this._changes)_.panDelta&&(n.panDelta=(n.panDelta||new s.pointGeometry(0,0))._add(_.panDelta)),_.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(n.around=_.around),_.aroundCoord!==void 0&&(n.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(n.pinchAround=_.pinchAround),_.noInertia&&(n.noInertia=_.noInertia),s.extend(a,g),s.extend(d,w);this._updateMapTransform(n,a,d),this._changes=[]}_updateMapTransform(n,a,d){const _=this._map,g=_.transform,w=te=>[te.x,te.y,te.z];if((te=>{const Y=this._eventsInProgress.drag;return Y&&!this._handlersById[Y.handlerName].isActive()})()&&!ts(n)){const te=g.zoom;g.cameraElevationReference="sea",g.recenterOnTerrain(),g.cameraElevationReference="ground",te!==g.zoom&&this._map._update(!0)}if(!ts(n))return void this._fireEvents(a,d,!0);let{panDelta:E,zoomDelta:C,bearingDelta:k,pitchDelta:z,around:R,aroundCoord:j,pinchAround:K}=n;K!==void 0&&(R=K),(te=>a.drag&&!this._eventsInProgress.drag)()&&R&&(this._dragOrigin=w(g.pointCoordinate3D(R)),this._trackingEllipsoid.setup(g._camera.position,this._dragOrigin)),g.cameraElevationReference="sea",_._stop(!0),R=R||_.transform.centerPoint,k&&(g.bearing+=k),z&&(g.pitch+=z),g._updateCameraState();const W=[0,0,0];if(E)if(g.projection.name==="mercator"){const te=this._trackingEllipsoid.projectRay(g.screenPointToMercatorRay(R).dir),Y=this._trackingEllipsoid.projectRay(g.screenPointToMercatorRay(R.sub(E)).dir);W[0]=Y[0]-te[0],W[1]=Y[1]-te[1]}else{const te=g.pointCoordinate(R);if(g.projection.name==="globe"){E=E.rotate(-g.angle);const Y=g._pixelsPerMercatorPixel/g.worldSize;W[0]=-E.x*s.mercatorScale(s.latFromMercatorY(te.y))*Y,W[1]=-E.y*s.mercatorScale(g.center.lat)*Y}else{const Y=g.pointCoordinate(R.sub(E));te&&Y&&(W[0]=Y.x-te.x,W[1]=Y.y-te.y)}}const H=g.zoom,X=[0,0,0];if(C){const te=w(j||g.pointCoordinate3D(R)),Y={dir:s.normalize([],s.sub([],te,g._camera.position))};if(Y.dir[2]<0){const me=g.zoomDeltaToMovement(te,C);s.scale$2(X,Y.dir,me)}}const G=s.add(W,W,X);g._translateCameraConstrained(G),C&&Math.abs(g.zoom-H)>1e-4&&g.recenterOnTerrain(),g.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(a,d,!0)}_fireEvents(n,a,d){const _=Ua(this._eventsInProgress),g=Ua(n),w={};for(const z in n){const{originalEvent:R}=n[z];this._eventsInProgress[z]||(w[`${z}start`]=R),this._eventsInProgress[z]=n[z]}!_&&g&&this._fireEvent("movestart",g.originalEvent);for(const z in w)this._fireEvent(z,w[z]);g&&this._fireEvent("move",g.originalEvent);for(const z in n){const{originalEvent:R}=n[z];this._fireEvent(z,R)}const E={};let C;for(const z in this._eventsInProgress){const{handlerName:R,originalEvent:j}=this._eventsInProgress[z];this._handlersById[R].isActive()||(delete this._eventsInProgress[z],C=a[R]||j,E[`${z}end`]=C)}for(const z in E)this._fireEvent(z,E[z]);const k=Ua(this._eventsInProgress);if(d&&(_||g)&&!k){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;z?(R(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:C})):(this._map.fire(new s.Event("moveend",{originalEvent:C})),R(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,a){this._map.fire(new s.Event(n,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new Wl("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Du="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Bd extends s.Evented{constructor(n,a){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=a.bearingSnap,s.bindAll(["_renderFrameCallback"],this)}getCenter(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(n,a){return this.jumpTo({center:n},a)}panBy(n,a,d){return n=s.pointGeometry.convert(n).mult(-1),this.panTo(this.transform.center,s.extend({offset:n},a),d)}panTo(n,a,d){return this.easeTo(s.extend({center:n},a),d)}getZoom(){return this.transform.zoom}setZoom(n,a){return this.jumpTo({zoom:n},a),this}zoomTo(n,a,d){return this.easeTo(s.extend({zoom:n},a),d)}zoomIn(n,a){return this.zoomTo(this.getZoom()+1,n,a),this}zoomOut(n,a){return this.zoomTo(this.getZoom()-1,n,a),this}getBearing(){return this.transform.bearing}setBearing(n,a){return this.jumpTo({bearing:n},a),this}getPadding(){return this.transform.padding}setPadding(n,a){return this.jumpTo({padding:n},a),this}rotateTo(n,a,d){return this.easeTo(s.extend({bearing:n},a),d)}resetNorth(n,a){return this.rotateTo(0,s.extend({duration:1e3},n),a),this}resetNorthPitch(n,a){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},n),a),this}snapToNorth(n,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,a):this}getPitch(){return this.transform.pitch}setPitch(n,a){return this.jumpTo({pitch:n},a),this}cameraForBounds(n,a){this.transform.projection.name==="globe"&&s.warnOnce('Globe projection does not support cameraForBounds API, this API may behave unexpectedly."'),n=s.LngLatBounds.convert(n);const d=a&&a.bearing||0;return this._cameraForBoxAndBearing(n.getNorthWest(),n.getSouthEast(),d,a)}_extendCameraOptions(n){const a={top:0,bottom:0,right:0,left:0};if(typeof(n=s.extend({padding:a,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=="number"){const d=n.padding;n.padding={top:d,bottom:d,right:d,left:d}}return n.padding=s.extend(a,n.padding),n}_cameraForBoxAndBearing(n,a,d,_){const g=this._extendCameraOptions(_),w=this.transform,E=w.padding,C=w.project(s.LngLat.convert(n)),k=w.project(s.LngLat.convert(a)),z=new s.pointGeometry(C.x,k.y),R=new s.pointGeometry(k.x,C.y),j=-s.degToRad(d),K=C.rotate(j),W=k.rotate(j),H=z.rotate(j),X=R.rotate(j),G=new s.pointGeometry(Math.max(K.x,W.x,H.x,X.x),Math.max(K.y,W.y,H.y,X.y)),te=new s.pointGeometry(Math.min(K.x,W.x,H.x,X.x),Math.min(K.y,W.y,H.y,X.y)),Y=G.sub(te),me=(w.width-((E.left||0)+(E.right||0)+g.padding.left+g.padding.right))/Y.x,fe=(w.height-((E.top||0)+(E.bottom||0)+g.padding.top+g.padding.bottom))/Y.y;if(fe<0||me<0)return void s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const oe=Math.min(w.scaleZoom(w.scale*Math.min(me,fe)),g.maxZoom),pe=typeof g.offset.x=="number"&&typeof g.offset.y=="number"?new s.pointGeometry(g.offset.x,g.offset.y):s.pointGeometry.convert(g.offset),ue=new s.pointGeometry((g.padding.left-g.padding.right)/2,(g.padding.top-g.padding.bottom)/2).rotate(d*Math.PI/180),be=pe.add(ue).mult(w.scale/w.zoomScale(oe));return{center:w.unproject(C.add(k).div(2).sub(be)),zoom:oe,bearing:d}}_cameraForBox(n,a,d,_,g){const w=this._extendCameraOptions(g);d=d||0,_=_||0,n=s.LngLat.convert(n),a=s.LngLat.convert(a);const E=this.transform.clone();E.padding=w.padding;const C=this.getFreeCameraOptions(),k=new s.LngLat(.5*(n.lng+a.lng),.5*(n.lat+a.lat)),z=.5*(d+_);if(E._camera.position[2]<s.mercatorZfromAltitude(z,k.lat))return void s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");C.lookAtPoint(k),E.setFreeCameraOptions(C);const R=s.MercatorCoordinate.fromLngLat(n),j=s.MercatorCoordinate.fromLngLat(a),K=E.pointRayIntersection(E.centerPoint,z),W=[(H=E.rayIntersectionCoordinate(K)).x,H.y,H.z];var H;const X=E.screenPointToMercatorRay(E.centerPoint),G=E.projection.name!=="globe";let te,Y=0;do{const me=Math.floor(E.zoom),fe=1<<me,oe=Math.min(fe*R.x,fe*j.x),pe=Math.min(fe*R.y,fe*j.y),ue=Math.max(fe*R.x,fe*j.x),be=Math.max(fe*R.y,fe*j.y),Be=new s.Aabb([oe,pe,d],[ue,be,_]),dt=s.Frustum.fromInvProjectionMatrix(E.invProjMatrix,E.worldSize,me,G);if(Be.intersects(dt)!==2){te&&(E._camera.position=s.scaleAndAdd([],E._camera.position,X.dir,-te),E._updateStateFromCamera());break}const Ie=s.sub([],E._camera.position,W);te=.5*s.length(Ie),E._camera.position=s.scaleAndAdd([],E._camera.position,X.dir,te);try{E._updateStateFromCamera()}catch{return void s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++Y<10);return{center:E.center,zoom:E.zoom,bearing:E.bearing,pitch:E.pitch}}fitBounds(n,a,d){return this.transform.projection.name==="globe"&&s.warnOnce("Globe projection does not support fitBounds API, this API may behave unexpectedly."),this._fitInternal(this.cameraForBounds(n,a),a,d)}_raycastElevationBox(n,a){const d=this.transform.elevation;if(!d)return;const _=new s.pointGeometry(n.x,a.y),g=new s.pointGeometry(a.x,n.y),w=d.pointCoordinate(n);if(!w)return;const E=d.pointCoordinate(a);if(!E)return;const C=d.pointCoordinate(_);if(!C)return;const k=d.pointCoordinate(g);if(!k)return;const z=new s.MercatorCoordinate(w[0],w[1]).toLngLat(),R=new s.MercatorCoordinate(E[0],E[1]).toLngLat(),j=new s.MercatorCoordinate(C[0],C[1]).toLngLat(),K=new s.MercatorCoordinate(k[0],k[1]).toLngLat(),W=Math.min(z.lng,Math.min(R.lng,Math.min(j.lng,K.lng))),H=Math.min(z.lat,Math.min(R.lat,Math.min(j.lat,K.lat))),X=Math.max(z.lng,Math.max(R.lng,Math.max(j.lng,K.lng))),G=Math.max(z.lat,Math.max(R.lat,Math.max(j.lat,K.lat))),te=Math.min(w[3],Math.min(E[3],Math.min(C[3],k[3]))),Y=Math.max(w[3],Math.max(E[3],Math.max(C[3],k[3])));return{minLngLat:new s.LngLat(W,H),maxLngLat:new s.LngLat(X,G),minAltitude:te,maxAltitude:Y}}fitScreenCoordinates(n,a,d,_,g){let w,E,C,k;this.transform.projection.name==="globe"&&s.warnOnce("Globe projection does not support fitScreenCoordinates API, this API may behave unexpectedly.");const z=s.pointGeometry.convert(n),R=s.pointGeometry.convert(a),j=this._raycastElevationBox(z,R);if(j)w=j.minLngLat,E=j.maxLngLat,C=j.minAltitude,k=j.maxAltitude;else{if(this.transform.anyCornerOffEdge(z,R))return this;w=this.transform.pointLocation(z),E=this.transform.pointLocation(R)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(s.pointGeometry.convert(n)),this.transform.pointLocation(s.pointGeometry.convert(a)),d,_):this._cameraForBox(w,E,C,k,_),_,g)}_fitInternal(n,a,d){return n?(delete(a=s.extend(n,a)).padding,a.linear?this.easeTo(a,d):this.flyTo(a,d)):this}jumpTo(n,a){this.stop();const d=n.preloadOnly?this.transform.clone():this.transform;let _=!1,g=!1,w=!1;return"zoom"in n&&d.zoom!==+n.zoom&&(_=!0,d.zoom=+n.zoom),n.center!==void 0&&(d.center=s.LngLat.convert(n.center)),"bearing"in n&&d.bearing!==+n.bearing&&(g=!0,d.bearing=+n.bearing),"pitch"in n&&d.pitch!==+n.pitch&&(w=!0,d.pitch=+n.pitch),n.padding==null||d.isPaddingEqual(n.padding)||(d.padding=n.padding),n.preloadOnly?(this._preloadTiles(d),this):(this.fire(new s.Event("movestart",a)).fire(new s.Event("move",a)),_&&this.fire(new s.Event("zoomstart",a)).fire(new s.Event("zoom",a)).fire(new s.Event("zoomend",a)),g&&this.fire(new s.Event("rotatestart",a)).fire(new s.Event("rotate",a)).fire(new s.Event("rotateend",a)),w&&this.fire(new s.Event("pitchstart",a)).fire(new s.Event("pitch",a)).fire(new s.Event("pitchend",a)),this.fire(new s.Event("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.warnOnce(Du),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,a){const d=this.transform;if(!d.projection.supportsFreeCamera)return s.warnOnce(Du),this;this.stop();const _=d.zoom,g=d.pitch,w=d.bearing;d.setFreeCameraOptions(n);const E=_!==d.zoom,C=g!==d.pitch,k=w!==d.bearing;return this.fire(new s.Event("movestart",a)).fire(new s.Event("move",a)),E&&this.fire(new s.Event("zoomstart",a)).fire(new s.Event("zoom",a)).fire(new s.Event("zoomend",a)),k&&this.fire(new s.Event("rotatestart",a)).fire(new s.Event("rotate",a)).fire(new s.Event("rotateend",a)),C&&this.fire(new s.Event("pitchstart",a)).fire(new s.Event("pitch",a)).fire(new s.Event("pitchend",a)),this.fire(new s.Event("moveend",a)),this}easeTo(n,a){this._stop(!1,n.easeId),((n=s.extend({offset:[0,0],duration:500,easing:s.ease},n)).animate===!1||!n.essential&&s.exported.prefersReducedMotion)&&(n.duration=0);const d=this.transform,_=this.getZoom(),g=this.getBearing(),w=this.getPitch(),E=this.getPadding(),C="zoom"in n?+n.zoom:_,k="bearing"in n?this._normalizeBearing(n.bearing,g):g,z="pitch"in n?+n.pitch:w,R="padding"in n?n.padding:d.padding,j=s.pointGeometry.convert(n.offset);let K,W,H;if(d.projection.name==="globe"){const be=s.MercatorCoordinate.fromLngLat(d.center),Be=j.rotate(-d.angle);be.x+=Be.x/d.worldSize,be.y+=Be.y/d.worldSize;const dt=be.toLngLat(),Ie=s.LngLat.convert(n.center||dt);this._normalizeCenter(Ie),K=d.centerPoint.add(Be),W=new s.pointGeometry(be.x,be.y).mult(d.worldSize),H=new s.pointGeometry(s.mercatorXfromLng(Ie.lng),s.mercatorYfromLat(Ie.lat)).mult(d.worldSize).sub(W)}else{K=d.centerPoint.add(j);const be=d.pointLocation(K),Be=s.LngLat.convert(n.center||be);this._normalizeCenter(Be),W=d.project(be),H=d.project(Be).sub(W)}const X=d.zoomScale(C-_);let G,te;n.around&&(G=s.LngLat.convert(n.around),te=d.locationPoint(G));const Y=this._zooming||C!==_,me=this._rotating||g!==k,fe=this._pitching||z!==w,oe=!d.isPaddingEqual(R),pe=be=>Be=>{if(Y&&(be.zoom=s.number(_,C,Be)),me&&(be.bearing=s.number(g,k,Be)),fe&&(be.pitch=s.number(w,z,Be)),oe&&(be.interpolatePadding(E,R,Be),K=be.centerPoint.add(j)),G)be.setLocationAtPoint(G,te);else{const dt=be.zoomScale(be.zoom-_),Ie=C>_?Math.min(2,X):Math.max(.5,X),Je=Math.pow(Ie,1-Be),rt=be.unproject(W.add(H.mult(Be*Je)).mult(dt));be.setLocationAtPoint(be.renderWorldCopies?rt.wrap():rt,K)}return n.preloadOnly||this._fireMoveEvents(a),be};if(n.preloadOnly){const be=this._emulate(pe,n.duration,d);return this._preloadTiles(be),this}const ue={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Y,this._rotating=me,this._pitching=fe,this._padding=oe,this._easeId=n.easeId,this._prepareEase(a,n.noMoveStart,ue),this._ease(pe(d),be=>{d.recenterOnTerrain(),this._afterEase(a,be)},n),this}_prepareEase(n,a,d={}){this._moving=!0,this.transform.cameraElevationReference="sea",a||d.moving||this.fire(new s.Event("movestart",n)),this._zooming&&!d.zooming&&this.fire(new s.Event("zoomstart",n)),this._rotating&&!d.rotating&&this.fire(new s.Event("rotatestart",n)),this._pitching&&!d.pitching&&this.fire(new s.Event("pitchstart",n))}_fireMoveEvents(n){this.fire(new s.Event("move",n)),this._zooming&&this.fire(new s.Event("zoom",n)),this._rotating&&this.fire(new s.Event("rotate",n)),this._pitching&&this.fire(new s.Event("pitch",n))}_afterEase(n,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const d=this._zooming,_=this._rotating,g=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new s.Event("zoomend",n)),_&&this.fire(new s.Event("rotateend",n)),g&&this.fire(new s.Event("pitchend",n)),this.fire(new s.Event("moveend",n))}flyTo(n,a){if(!n.essential&&s.exported.prefersReducedMotion){const It=s.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(It,a)}this.stop(),n=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},n);const d=this.transform,_=this.getZoom(),g=this.getBearing(),w=this.getPitch(),E=this.getPadding(),C="zoom"in n?s.clamp(+n.zoom,d.minZoom,d.maxZoom):_,k="bearing"in n?this._normalizeBearing(n.bearing,g):g,z="pitch"in n?+n.pitch:w,R="padding"in n?n.padding:d.padding,j=d.zoomScale(C-_),K=s.pointGeometry.convert(n.offset);let W=d.centerPoint.add(K);const H=d.pointLocation(W),X=s.LngLat.convert(n.center||H);this._normalizeCenter(X);const G=d.project(H),te=d.project(X).sub(G);let Y=n.curve;const me=Math.max(d.width,d.height),fe=me/j,oe=te.mag();if("minZoom"in n){const It=s.clamp(Math.min(n.minZoom,_,C),d.minZoom,d.maxZoom),St=me/d.zoomScale(It-_);Y=Math.sqrt(St/oe*2)}const pe=Y*Y;function ue(It){const St=(fe*fe-me*me+(It?-1:1)*pe*pe*oe*oe)/(2*(It?fe:me)*pe*oe);return Math.log(Math.sqrt(St*St+1)-St)}function be(It){return(Math.exp(It)-Math.exp(-It))/2}function Be(It){return(Math.exp(It)+Math.exp(-It))/2}const dt=ue(0);let Ie=function(It){return Be(dt)/Be(dt+Y*It)},Je=function(It){return me*((Be(dt)*(be(St=dt+Y*It)/Be(St))-be(dt))/pe)/oe;var St},rt=(ue(1)-dt)/Y;if(Math.abs(oe)<1e-6||!isFinite(rt)){if(Math.abs(me-fe)<1e-6)return this.easeTo(n,a);const It=fe<me?-1:1;rt=Math.abs(Math.log(fe/me))/Y,Je=function(){return 0},Ie=function(St){return Math.exp(It*Y*St)}}n.duration="duration"in n?+n.duration:1e3*rt/("screenSpeed"in n?+n.screenSpeed/Y:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const wt=g!==k,qe=z!==w,mt=!d.isPaddingEqual(R),it=It=>St=>{const Vt=St*rt,Wt=1/Ie(Vt);It.zoom=St===1?C:_+It.scaleZoom(Wt),wt&&(It.bearing=s.number(g,k,St)),qe&&(It.pitch=s.number(w,z,St)),mt&&(It.interpolatePadding(E,R,St),W=It.centerPoint.add(K));const ii=St===1?X:It.unproject(G.add(te.mult(Je(Vt))).mult(Wt));return It.setLocationAtPoint(It.renderWorldCopies?ii.wrap():ii,W),It._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(a),It};if(n.preloadOnly){const It=this._emulate(it,n.duration,d);return this._preloadTiles(It),this}return this._zooming=!0,this._rotating=wt,this._pitching=qe,this._padding=mt,this._prepareEase(a,!1),this._ease(it(d),()=>this._afterEase(a),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const d=this._onEaseEnd;this._onEaseEnd=void 0,d.call(this,a)}if(!n){const d=this.handlers;d&&d.stop(!1)}return this}_ease(n,a,d){d.animate===!1||d.duration===0?(n(1),a()):(this._easeStart=s.exported.now(),this._easeOptions=d,this._onEaseFrame=n,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((s.exported.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,a){n=s.wrap(n,-180,180);const d=Math.abs(n-a);return Math.abs(n-360-a)<d&&(n-=360),Math.abs(n+360-a)<d&&(n+=360),n}_normalizeCenter(n){const a=this.transform;if(!a.renderWorldCopies||a.maxBounds)return;const d=n.lng-a.center.lng;n.lng+=d>180?-360:d<-180?360:0}_emulate(n,a,d){const _=Math.ceil(15*a/1e3),g=[],w=n(d.clone());for(let E=0;E<=_;E++){const C=w(E/_);g.push(C.clone())}return g}}class Lu{constructor(n={}){this.options=n,s.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const a=this.options&&this.options.compact;return this._map=n,this._container=q("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=q("button","mapboxgl-ctrl-attrib-button",this._container),q("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=q("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,a){const d=this._map._getUIString(`AttributionControl.${a}`);n.setAttribute("aria-label",d),n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",d)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.config.ACCESS_TOKEN}];if(n){const d=a.reduce((_,g,w)=>(g.value&&(_+=`${g.key}=${g.value}${w<a.length-1?"&":""}`),_),"?");n.href=`${s.config.FEEDBACK_URL}/${d}#${Mu(this._map,!0)}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const a=this._map.style._sourceCaches;for(const _ in a){const g=a[_];if(g.used){const w=g.getSource();w.attribution&&n.indexOf(w.attribution)<0&&n.push(w.attribution)}}n.sort((_,g)=>_.length-g.length),n=n.filter((_,g)=>{for(let w=g+1;w<n.length;w++)if(n[w].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const d=n.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,n.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Bu{constructor(){s.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=q("div","mapboxgl-ctrl");const a=q("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const a in n){const d=n[a].getSource();if(d.hasOwnProperty("mapbox_logo")&&!d.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const a=n[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class Ru{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const a=++this._id;return this._queue.push({callback:n,id:a,cancelled:!1}),a}remove(n){const a=this._currentlyRunning,d=a?this._queue.concat(a):this._queue;for(const _ of d)if(_.id===n)return void(_.cancelled=!0)}run(n=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const d of a)if(!d.cancelled&&(d.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Ou(c,n,a){if(c=new s.LngLat(c.lng,c.lat),n){const d=new s.LngLat(c.lng-360,c.lat),_=new s.LngLat(c.lng+360,c.lat),g=360*Math.ceil(Math.abs(c.lng-a.center.lng)/360),w=a.locationPoint(c).distSqr(n),E=n.x<0||n.y<0||n.x>a.width||n.y>a.height;a.locationPoint(d).distSqr(n)<w&&(E||Math.abs(d.lng-a.center.lng)<g)?c=d:a.locationPoint(_).distSqr(n)<w&&(E||Math.abs(_.lng-a.center.lng)<g)&&(c=_)}for(;Math.abs(c.lng-a.center.lng)>180;){const d=a.locationPoint(c);if(d.x>=0&&d.y>=0&&d.x<=a.width&&d.y<=a.height)break;c.lng>a.center.lng?c.lng-=360:c.lng+=360}return c}const Na={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Hl extends s.Evented{constructor(n,a){if(super(),(n instanceof s.window.HTMLElement||a)&&(n=s.extend({element:n},a)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),n&&n.element)this._element=n.element,this._offset=s.pointGeometry.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=q("div");const _=41,g=27,w=Z("svg",{display:"block",height:_*this._scale+"px",width:g*this._scale+"px",viewBox:`0 0 ${g} ${_}`},this._element),E=Z("radialGradient",{id:"shadowGradient"},Z("defs",{},w));Z("stop",{offset:"10%","stop-opacity":.4},E),Z("stop",{offset:"100%","stop-opacity":.05},E),Z("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},w),Z("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},w),Z("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},w),Z("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},w),this._offset=s.pointGeometry.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",_=>{_.preventDefault()}),this._element.addEventListener("mousedown",_=>{_.preventDefault()});const d=this._element.classList;for(const _ in Na)d.remove(`mapboxgl-marker-anchor-${_}`);d.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=s.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const a=n.code,d=n.charCode||n.keyCode;a!=="Space"&&a!=="Enter"&&d!==32&&d!==13||this.togglePopup()}_onMapClick(n){const a=n.originalEvent.target,d=this._element;this._popup&&(a===d||d.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map;if(!n)return!1;const a=n.unproject(this._pos),d=n.getFreeCameraOptions();if(!d.position)return!1;const _=d.position.toLngLat();return _.distanceTo(a)<.9*_.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const a=this._pos;if(!a||a.x<0||a.x>n.transform.width||a.y<0||a.y>n.transform.height)return void this._clearFadeTimer();const d=n.unproject(a);let _;n._showingGlobe()&&s.isLngLatBehindGlobe(n.transform,this._lngLat)?_=0:(_=1-n._queryFogOpacity(d),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(_*=.2)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const a=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${Na[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${a.x}px,${a.y}px)
        `}_calculateXYTransform(){const n=this._pos,a=this._map,d=this.getPitchAlignment();if(!a||!n||d!=="map")return"";if(!a._showingGlobe()){const C=a.getPitch();return C?`rotateX(${C}deg)`:""}const _=s.radToDeg(s.globeTiltAtLngLat(a.transform,this._lngLat)),g=n.sub(s.globeCenterToScreenPoint(a.transform)),w=Math.abs(g.x)+Math.abs(g.y);if(w===0)return"";const E=_/w;return`rotateX(${-g.y*E}deg) rotateY(${g.x*E}deg)`}_calculateZTransform(){const n=this._pos,a=this._map;if(!a||!n)return"";let d=0;const _=this.getRotationAlignment();if(_==="map")if(a._showingGlobe()){const g=a.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),w=a.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(g);d=s.radToDeg(Math.atan2(w.y,w.x))-90}else d=-a.getBearing();else if(_==="horizon"){const g=s.smoothstep(4,6,a.getZoom()),w=s.globeCenterToScreenPoint(a.transform);w.y+=g*a.transform.height;const E=n.sub(w),C=s.radToDeg(Math.atan2(E.y,E.x));d=(C>90?C-270:C+90)*(1-g)}return d+=this._rotation,d?`rotateZ(${d}deg)`:""}_update(n){s.window.cancelAnimationFrame(this._updateFrameId);const a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=Ou(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat),n===!0?this._updateFrameId=s.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),a._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=s.pointGeometry.convert(n),this._update(),this}_onMove(n){const a=this._map;if(a){if(!this._isDragging){const d=this._clickTolerance||a._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=a.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"}_addDragHandler(n){const a=this._map;a&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos),this._pointerdownPos=n.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const a=this._map;return a&&(n?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}}class Rd{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const a=s.easeCubicInOut((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,a,d){this._start=this.getValue(a),this._end=n,this._startTime=a,this._endTime=a+d}}const Od={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Fd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function ja(c){c.parentNode&&c.parentNode.removeChild(c)}const Vd={showCompass:!0,showZoom:!0,visualizePitch:!1};class Fu{constructor(n,a,d=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new ku({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,d&&(this.mousePitch=new On({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(n,a){this.mouseRotate.mousedown(n,a),this.mousePitch&&this.mousePitch.mousedown(n,a),He()}move(n,a){const d=this.map,_=this.mouseRotate.mousemoveWindow(n,a),g=_&&_.bearingDelta;if(g&&d.setBearing(d.getBearing()+g),this.mousePitch){const w=this.mousePitch.mousemoveWindow(n,a),E=w&&w.pitchDelta;E&&d.setPitch(d.getPitch()+E)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ee(),s.window.removeEventListener("mousemove",this.mousemove),s.window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(s.extend({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),Se(this.element,n)),s.window.addEventListener("mousemove",this.mousemove),s.window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,Se(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Pe(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=Pe(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Ud={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Vu={maxWidth:100,unit:"metric"};function Uu(c,n,a){const d=Xl(n),_=d/n,g={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[a];this._map._requestDomTask(()=>{this._container.style.width=c*_+"px",this._container.innerHTML=`${d}&nbsp;${g}`})}function Xl(c){const n=Math.pow(10,`${Math.floor(c)}`.length-1);let a=c/n;return a=a>=10?10:a>=5?5:a>=3?3:a>=2?2:a>=1?1:function(d){const _=Math.pow(10,Math.ceil(-Math.log(d)/Math.LN10));return Math.round(d*_)/_}(a),n*a}const Kp={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Yp=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Kl(c=new s.pointGeometry(0,0),n="bottom"){if(typeof c=="number"){const a=Math.round(Math.sqrt(.5*Math.pow(c,2)));switch(n){case"top":return new s.pointGeometry(0,c);case"top-left":return new s.pointGeometry(a,a);case"top-right":return new s.pointGeometry(-a,a);case"bottom":return new s.pointGeometry(0,-c);case"bottom-left":return new s.pointGeometry(a,-a);case"bottom-right":return new s.pointGeometry(-a,-a);case"left":return new s.pointGeometry(c,0);case"right":return new s.pointGeometry(-c,0)}return new s.pointGeometry(0,0)}return c instanceof s.pointGeometry||Array.isArray(c)?s.pointGeometry.convert(c):s.pointGeometry.convert(c[n]||[0,0])}const qa={version:s.version,supported:O,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:class extends Bd{constructor(c){if((c=s.extend({},Fd,c)).minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(c.antialias&&s.isSafariWithAntialiasingBug(s.window)&&(c.antialias=!1,s.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ba(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies),c),this._interactive=c.interactive,this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=c.preserveDrawingBuffer,this._antialias=c.antialias,this._trackResize=c.trackResize,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles,this._fadeDuration=c.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=c.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=c.collectResourceTiming,this._optimizeForTerrain=c.optimizeForTerrain,this._language=c.language==="auto"?s.window.navigator.language:c.language,this._worldview=c.worldview,this._renderTaskQueue=new Ru,this._domRenderTaskQueue=new Ru,this._controls=[],this._markers=[],this._mapId=s.uniqueId(),this._locale=s.extend({},Od,c.locale),this._clickTolerance=c.clickTolerance,this._cooperativeGestures=c.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Rd(0),this._useExplicitProjection=!1,this._requestManager=new s.RequestManager(c.transformRequest,c.accessToken,c.testMode),this._silenceAuthErrors=!!c.testMode,typeof c.container=="string"){if(this._container=s.window.document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof s.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(this._container.childNodes.length>0&&s.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),c.maxBounds&&this.setMaxBounds(c.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),s.window!==void 0&&(s.window.addEventListener("online",this._onWindowOnline,!1),s.window.addEventListener("resize",this._onWindowResize,!1),s.window.addEventListener("orientationchange",this._onWindowResize,!1),s.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Ld(this,c),this._localFontFamily=c.localFontFamily,this._localIdeographFontFamily=c.localIdeographFontFamily,c.style&&this.setStyle(c.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),c.projection&&this.setProjection(c.projection),this._hash=c.hash&&new _d(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,s.extend({},c.fitBoundsOptions,{duration:0})))),this.resize(),c.attributionControl&&this.addControl(new Lu({customAttribution:c.customAttribution})),this._logoControl=new Bu,this.addControl(this._logoControl,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new s.Event(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new s.Event(`${n.dataType}dataloading`,n))})}_getMapId(){return this._mapId}addControl(c,n){if(n===void 0&&(n=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=c.onAdd(this);this._controls.push(c);const d=this._controlPositions[n];return n.indexOf("bottom")!==-1?d.insertBefore(a,d.firstChild):d.appendChild(a),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(c);return n>-1&&this._controls.splice(n,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(c){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new s.Event("movestart",c)).fire(new s.Event("move",c)),this.fire(new s.Event("resize",c)),n&&this.fire(new s.Event("moveend",c)),this}getBounds(){return this.transform.projection.name==="globe"&&s.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(c){return this.transform.setMaxBounds(s.LngLatBounds.convert(c)),this._update()}setMinZoom(c){if((c=c==null?-2:c)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c?this.setZoom(c):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c==null?22:c)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c?this.setZoom(c):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c==null?0:c)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c?this.setPitch(c):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c==null?85:c)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c?this.setPitch(c):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this._update()}getLanguage(){return this._language}setLanguage(c){if(this._language=c==="auto"?s.window.navigator.language:c,this.style)for(const n in this.style._sourceCaches){const a=this.style._sourceCaches[n]._source;a._setLanguage&&a._setLanguage(this._language)}for(const n of this._controls)n._setLanguage&&n._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(c){if(this._worldview=c,this.style)for(const n in this.style._sourceCaches){const a=this.style._sourceCaches[n]._source;a._setWorldview&&a._setWorldview(c)}return this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(c){return this._lazyInitEmptyStyle(),c?typeof c=="string"&&(c={name:c}):c=null,this._useExplicitProjection=!!c,this._prioritizeAndUpdateProjection(c,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const c=this.transform,n=c.projection.name;let a;n==="globe"&&c.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?(c.setMercatorFromTransition(),a=!0):n==="mercator"&&c.zoom<s.GLOBE_ZOOM_THRESHOLD_MAX&&(c.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(c,n){return this._updateProjection(c||n||{name:"mercator"})}_updateProjection(c){let n;if(n=c.name==="globe"&&this.transform.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(c),this.style.applyProjectionUpdate(),n){this.painter.clearBackgroundTiles();for(const a in this.style._sourceCaches)this.style._sourceCaches[a].clearTiles();this._update(!0)}return this}project(c){return this.transform.locationPoint3D(s.LngLat.convert(c))}unproject(c){return this.transform.pointLocation3D(s.pointGeometry.convert(c))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(c,n,a){if(c==="mouseenter"||c==="mouseover"){let d=!1;const _=w=>{const E=n.filter(k=>this.getLayer(k)),C=E.length?this.queryRenderedFeatures(w.point,{layers:E}):[];C.length?d||(d=!0,a.call(this,new Gn(c,this,w.originalEvent,{features:C}))):d=!1},g=()=>{d=!1};return{layers:new Set(n),listener:a,delegates:{mousemove:_,mouseout:g}}}if(c==="mouseleave"||c==="mouseout"){let d=!1;const _=w=>{const E=n.filter(C=>this.getLayer(C));(E.length?this.queryRenderedFeatures(w.point,{layers:E}):[]).length?d=!0:d&&(d=!1,a.call(this,new Gn(c,this,w.originalEvent)))},g=w=>{d&&(d=!1,a.call(this,new Gn(c,this,w.originalEvent)))};return{layers:new Set(n),listener:a,delegates:{mousemove:_,mouseout:g}}}{const d=_=>{const g=n.filter(E=>this.getLayer(E)),w=g.length?this.queryRenderedFeatures(_.point,{layers:g}):[];w.length&&(_.features=w,a.call(this,_),delete _.features)};return{layers:new Set(n),listener:a,delegates:{[c]:d}}}}on(c,n,a){if(a===void 0)return super.on(c,n);Array.isArray(n)||(n=[n]);const d=this._createDelegatedListener(c,n,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(d);for(const _ in d.delegates)this.on(_,d.delegates[_]);return this}once(c,n,a){if(a===void 0)return super.once(c,n);Array.isArray(n)||(n=[n]);const d=this._createDelegatedListener(c,n,a);for(const _ in d.delegates)this.once(_,d.delegates[_]);return this}off(c,n,a){if(a===void 0)return super.off(c,n);n=new Set(Array.isArray(n)?n:[n]);const d=(g,w)=>{if(g.size!==w.size)return!1;for(const E of g)if(!w.has(E))return!1;return!0},_=this._delegatedListeners?this._delegatedListeners[c]:void 0;return _&&(g=>{for(let w=0;w<g.length;w++){const E=g[w];if(E.listener===a&&d(E.layers,n)){for(const C in E.delegates)this.off(C,E.delegates[C]);return g.splice(w,1),this}}})(_),this}queryRenderedFeatures(c,n){return this.style?(n!==void 0||c===void 0||c instanceof s.pointGeometry||Array.isArray(c)||(n=c,c=void 0),this.style.queryRenderedFeatures(c=c||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(c,n){return this.style.querySourceFeatures(c,n)}queryTerrainElevation(c,n){const a=this.transform.elevation;return a?(n=s.extend({},{exaggerated:!0},n),a.getAtPoint(s.MercatorCoordinate.fromLngLat(c),null,n.exaggerated)):null}setStyle(c,n){return(n=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&c?(this._diffStyle(c,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(c,n))}_getUIString(c){const n=this._locale[c];if(n==null)throw new Error(`Missing UI string '${c}'`);return n}_updateStyle(c,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),c&&(this.style=new Cr(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof c=="string"?this.style.loadURL(c):this.style.loadJSON(c)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Cr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(c,n){if(typeof c=="string"){const a=this._requestManager.normalizeStyleURL(c),d=this._requestManager.transformRequest(a,s.ResourceType.Style);s.getJSON(d,(_,g)=>{_?this.fire(new s.ErrorEvent(_)):g&&this._updateDiff(g,n)})}else typeof c=="object"&&this._updateDiff(c,n)}_updateDiff(c,n){try{this.style.setState(c)&&this._update(!0)}catch(a){s.warnOnce(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(c,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.warnOnce("There is no style added to the map."),!1)}addSource(c,n){return this._lazyInitEmptyStyle(),this.style.addSource(c,n),this._update(!0)}isSourceLoaded(c){return!!this.style&&this.style._isSourceCacheLoaded(c)}areTilesLoaded(){const c=this.style&&this.style._sourceCaches;for(const n in c){const a=c[n]._tiles;for(const d in a){const _=a[d];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}addSourceType(c,n,a){this._lazyInitEmptyStyle(),this.style.addSourceType(c,n,a)}removeSource(c){return this.style.removeSource(c),this._updateTerrain(),this._update(!0)}getSource(c){return this.style.getSource(c)}addImage(c,n,{pixelRatio:a=1,sdf:d=!1,stretchX:_,stretchY:g,content:w}={}){if(this._lazyInitEmptyStyle(),n instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&n instanceof s.window.ImageBitmap){const{width:E,height:C,data:k}=s.exported.getImageData(n);this.style.addImage(c,{data:new s.RGBAImage({width:E,height:C},k),pixelRatio:a,stretchX:_,stretchY:g,content:w,sdf:d,version:0})}else if(n.width===void 0||n.height===void 0)this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:E,height:C}=n,k=n;this.style.addImage(c,{data:new s.RGBAImage({width:E,height:C},new Uint8Array(k.data)),pixelRatio:a,stretchX:_,stretchY:g,content:w,sdf:d,version:0,userImage:k}),k.onAdd&&k.onAdd(this,c)}}updateImage(c,n){const a=this.style.getImage(c);if(!a)return void this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=n instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&n instanceof s.window.ImageBitmap?s.exported.getImageData(n):n,{width:_,height:g}=d;_!==void 0&&g!==void 0?_===a.data.width&&g===a.data.height?(a.data.replace(d.data,!(n instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&n instanceof s.window.ImageBitmap)),this.style.updateImage(c,a)):this.fire(new s.ErrorEvent(new Error(`The width and height of the updated image (${_}, ${g})
                must be that same as the previous version of the image
                (${a.data.width}, ${a.data.height})`))):this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(c){return c?!!this.style.getImage(c):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(c)}loadImage(c,n){s.getImage(this._requestManager.transformRequest(c,s.ResourceType.Image),(a,d)=>{n(a,d instanceof s.window.HTMLImageElement?s.exported.getImageData(d):d)})}listImages(){return this.style.listImages()}addLayer(c,n){return this._lazyInitEmptyStyle(),this.style.addLayer(c,n),this._update(!0)}moveLayer(c,n){return this.style.moveLayer(c,n),this._update(!0)}removeLayer(c){return this.style.removeLayer(c),this._update(!0)}getLayer(c){return this.style.getLayer(c)}setLayerZoomRange(c,n,a){return this.style.setLayerZoomRange(c,n,a),this._update(!0)}setFilter(c,n,a={}){return this.style.setFilter(c,n,a),this._update(!0)}getFilter(c){return this.style.getFilter(c)}setPaintProperty(c,n,a,d={}){return this.style.setPaintProperty(c,n,a,d),this._update(!0)}getPaintProperty(c,n){return this.style.getPaintProperty(c,n)}setLayoutProperty(c,n,a,d={}){return this.style.setLayoutProperty(c,n,a,d),this._update(!0)}getLayoutProperty(c,n){return this.style.getLayoutProperty(c,n)}setLight(c,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(c,n),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(c){return this._lazyInitEmptyStyle(),!c&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(c),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(c){return this._lazyInitEmptyStyle(),this.style.setFog(c),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(c){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.LngLat.convert(c),this.transform):0}setFeatureState(c,n){return this.style.setFeatureState(c,n),this._update()}removeFeatureState(c,n){return this.style.removeFeatureState(c,n),this._update()}getFeatureState(c){return this.style.getFeatureState(c)}_updateContainerDimensions(){if(!this._container)return;const c=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let a,d,_,g=this._container;for(;g&&(!d||!_);){const w=s.window.getComputedStyle(g).transform;w&&w!=="none"&&(a=w.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(d=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(_=a[3])),g=g.parentElement}this._containerWidth=d?Math.abs(c/d):c,this._containerHeight=_?Math.abs(n/_):n}_detectMissingCSS(){s.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const c=this._container;c.classList.add("mapboxgl-map"),(this._missingCSSCanary=q("div","mapboxgl-canary",c)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=q("div","mapboxgl-canvas-container",c);this._interactive&&n.classList.add("mapboxgl-interactive"),this._canvas=q("canvas","mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const a=this._controlContainer=q("div","mapboxgl-control-container",c),d=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{d[_]=q("div",`mapboxgl-ctrl-${_}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(c,n){const a=s.exported.devicePixelRatio||1;this._canvas.width=a*Math.ceil(c),this._canvas.height=a*Math.ceil(n),this._canvas.style.width=`${c}px`,this._canvas.style.height=`${n}px`}_addMarker(c){this._markers.push(c)}_removeMarker(c){const n=this._markers.indexOf(c);n!==-1&&this._markers.splice(n,1)}_setupPainter(){const c=s.extend({},O.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl",c)||this._canvas.getContext("experimental-webgl",c);n?(s.storeAuthState(n,!0),this.painter=new Tu(n,this.transform),this.on("data",a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.exported$1.testSupport(n)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(c){c.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:c}))}_contextRestored(c){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:c}))}_onMapScroll(c){if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(c){return this.style?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_requestDomTask(c){!this.loaded()||this.loaded()&&!this.isMoving()?c():this._domRenderTaskQueue.add(c)}_render(c){let n;const a=this.painter.context.extTimerQuery,d=s.exported.now();if(this.listens("gpu-timing-frame")&&(n=a.createQueryEXT(),a.beginQueryEXT(a.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(c),this._domRenderTaskQueue.run(c),this._removed)return;this._updateProjectionTransition();let _=!1;const g=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const C=this.transform.zoom,k=this.transform.pitch,z=s.exported.now();this.style.zoomHistory.update(C,z);const R=new s.EvaluationParameters(C,{now:z,fadeDuration:g,pitch:k,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),j=R.crossFadingFactor();j===1&&j===this._crossFadingFactor||(_=!0,this._crossFadingFactor=j),this.style.update(R)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let w=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),w=this._updateAverageElevation(d),this.style._updateSources(this.transform),this._forceMarkerUpdate()):w=this._updateAverageElevation(d),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,g,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:g,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.Event("load"))),this.style&&(this.style.hasTransitions()||_)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const C=s.exported.now()-d;a.endQueryEXT(a.TIME_ELAPSED_EXT,n),setTimeout(()=>{const k=a.getQueryObjectEXT(n,a.QUERY_RESULT_EXT)/1e6;a.deleteQueryEXT(n),this.fire(new s.Event("gpu-timing-frame",{cpuTime:C,gpuTime:k})),s.window.performance.mark("frame-gpu",{startTime:d,detail:{gpuTime:k}})},50)}if(this.listens("gpu-timing-layer")){const C=this.painter.collectGpuTimers();setTimeout(()=>{const k=this.painter.queryGpuTimers(C);this.fire(new s.Event("gpu-timing-layer",{layerTimes:k}))},50)}if(this.listens("gpu-timing-deferred-render")){const C=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const k=this.painter.queryGpuTimeDeferredRender(C);this.fire(new s.Event("gpu-timing-deferred-render",{gpuTime:k}))},50)}const E=this._sourcesDirty||this._styleDirty||this._placementDirty||w;if(E||this._repaint)this.triggerRepaint();else{const C=!this.isMoving()&&this.loaded();if(C&&(w=this._updateAverageElevation(d,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),C&&(this.fire(new s.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const k=this._calculateSpeedIndex();this.fire(new s.Event("speedindexcompleted",{speedIndex:k})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||E||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const c of this._markers)c._update()}_updateAverageElevation(c,n=!1){const a=d=>(this.transform.averageElevation=d,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);if((n||c-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(c)){const d=this.transform.averageElevation;let _=this.transform.sampleAverageElevation(),g=!1;this.transform.elevation&&(g=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(_)?_=0:this._averageElevationLastSampledAt=c;const w=Math.abs(d-_);if(w>1){if(this._isInitialLoad||g)return this._averageElevation.jumpTo(_),a(_);this._averageElevation.easeTo(_,c,300)}else if(w>1e-4)return this._averageElevation.jumpTo(_),a(_)}return!!this._averageElevation.isEasing(c)&&a(this._averageElevation.getValue(c))}_authenticate(){s.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,c=>{if(c&&(c.message===s.AUTH_ERR_MSG||c.status===401)){const n=this.painter.context.gl;s.storeAuthState(n,!1),this._logoControl instanceof Bu&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),s.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const c=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const a=this.painter.context.gl,d=a.createFramebuffer();function _(g){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,g,0);const w=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,w),w}return a.bindFramebuffer(a.FRAMEBUFFER,d),this._canvasPixelComparison(_(c),n.canvasCopies.map(_),n.timeStamps)}_canvasPixelComparison(c,n,a){let d=a[1]-a[0];const _=c.length/4;for(let g=0;g<n.length;g++){const w=n[g];let E=0;for(let C=0;C<w.length;C+=4)w[C]===c[C]&&w[C+1]===c[C+1]&&w[C+2]===c[C+2]&&w[C+3]===c[C+3]&&(E+=1);d+=(a[g+2]-a[g+1])*(1-E/_)}return d}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),s.window!==void 0&&(s.window.removeEventListener("resize",this._onWindowResize,!1),s.window.removeEventListener("orientationchange",this._onWindowResize,!1),s.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.removeEventListener("online",this._onWindowOnline,!1));const c=this.painter.context.gl.getExtension("WEBGL_lose_context");c&&c.loseContext(),ja(this._canvasContainer),ja(this._controlContainer),ja(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),s.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new s.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(c){this._renderNextFrame=this._renderNextFrame||c,this.style&&!this._frame&&(this._frame=s.exported.frame(n=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(n)}))}_preloadTiles(c){const n=this.style?Object.values(this.style._sourceCaches):[];return s.asyncAll(n,(a,d)=>a._preloadTiles(c,d),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(c){this._trackResize&&this.resize({originalEvent:c})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(c){this._showTerrainWireframe!==c&&(this._showTerrainWireframe=c,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(c){this._speedIndexTiming!==c&&(this._speedIndexTiming=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}_setCacheLimits(c,n){s.setCacheLimits(c,n)}get version(){return s.version}},NavigationControl:class{constructor(c){this.options=s.extend({},Vd,c),this._container=q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),q("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),q("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:n}):a.resetNorth({},{originalEvent:n}))}),this._compassIcon=q("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const c=this._map;if(!c)return;const n=c.getZoom(),a=n===c.getMaxZoom(),d=n===c.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){const c=this._map;if(!c)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(c.transform.pitch*(Math.PI/180)),.5)}) rotateX(${c.transform.pitch}deg) rotateZ(${c.transform.angle*(180/Math.PI)}deg)`:`rotate(${c.transform.angle*(180/Math.PI)}deg)`;c._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),c.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&c.on("pitch",this._rotateCompassArrow),c.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Fu(c,this._compass,this.options.visualizePitch)),this._container}onRemove(){const c=this._map;c&&(this._container.remove(),this.options.showZoom&&c.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&c.off("pitch",this._rotateCompassArrow),c.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(c,n){const a=q("button",c,this._container);return a.type="button",a.addEventListener("click",n),a}_setButtonTitle(c,n){if(!this._map)return;const a=this._map._getUIString(`NavigationControl.${n}`);c.setAttribute("aria-label",a),c.firstElementChild&&c.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends s.Evented{constructor(c){super(),this.options=s.extend({geolocation:s.window.navigator.geolocation},Ud,c),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ra(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(c){return this._map=c,this._container=q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(c){this._supportsGeolocation!==void 0?c(this._supportsGeolocation):s.window.navigator.permissions!==void 0?s.window.navigator.permissions.query({name:"geolocation"}).then(n=>{this._supportsGeolocation=n.state!=="denied",c(this._supportsGeolocation)}):(this._supportsGeolocation=!!this.options.geolocation,c(this._supportsGeolocation))}_isOutOfMapMaxBounds(c){const n=this._map.getMaxBounds(),a=c.coords;return!!n&&(a.longitude<n.getWest()||a.longitude>n.getEast()||a.latitude<n.getSouth()||a.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",c)),this._finish()}}_updateCamera(c){const n=new s.LngLat(c.coords.longitude,c.coords.latitude),a=c.coords.accuracy,d=this._map.getBearing(),_=s.extend({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(a),_,{geolocateSource:!0})}_updateMarker(c){if(c){const n=new s.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const c=this._map.transform,n=s.mercatorZfromAltitude(1,c._center.lat)*c.worldSize,a=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",c)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(c){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=q("button","mapboxgl-ctrl-geolocate",this._container),q("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",c===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=q("div","mapboxgl-user-location"),this._dotElement.appendChild(q("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(q("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Hl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=q("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Hl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.Event("trackuserlocationend")))})}_onDeviceOrientation(c){this._userLocationDotMarker&&(c.webkitCompassHeading?this._heading=c.webkitCompassHeading:c.absolute===!0&&(this._heading=-1*c.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(c={maximumAge:6e5,timeout:0},this._noTimeout=!0):(c=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,c),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const c=()=>{s.window.addEventListener("ondeviceorientationabsolute"in s.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};s.window.DeviceMotionEvent!==void 0&&typeof s.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&c()}).catch(console.error):c()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),s.window.removeEventListener("deviceorientation",this._onDeviceOrientation),s.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Lu,ScaleControl:class{constructor(c){this.options=s.extend({},Vu,c),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=Uu.bind(this)),s.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const c=this.options.maxWidth||100,n=this._map,a=n._containerHeight/2,d=n._containerWidth/2-c/2,_=n.unproject([d,a]),g=n.unproject([d+c,a]),w=_.distanceTo(g);if(this.options.unit==="imperial"){const E=3.2808*w;E>5280?this._setScale(c,E/5280,"mile"):this._setScale(c,E,"foot")}else this.options.unit==="nautical"?this._setScale(c,w/1852,"nautical-mile"):w>=1e3?this._setScale(c,w/1e3,"kilometer"):this._setScale(c,w,"meter")}_setScale(c,n,a){const d=Xl(n),_=d/n;this._map._requestDomTask(()=>{this._container.style.width=c*_+"px",this._container.innerHTML=a!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:a}).format(d):`${d}&nbsp;nm`})}onAdd(c){return this._map=c,this._language=c.getLanguage(),this._container=q("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(c){this._language=c,this._update()}setUnit(c){this.options.unit=c,this._update()}},FullscreenControl:class{constructor(c){this._fullscreen=!1,c&&c.container&&(c.container instanceof s.window.HTMLElement?this._container=c.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in s.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in s.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,s.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!s.window.document.fullscreenEnabled&&!s.window.document.webkitFullscreenEnabled)}_setupUI(){const c=this._fullscreenButton=q("button","mapboxgl-ctrl-fullscreen",this._controlContainer);q("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),s.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",c)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(s.window.document.fullscreenElement||s.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?s.window.document.exitFullscreen?s.window.document.exitFullscreen():s.window.document.webkitCancelFullScreen&&s.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.Evented{constructor(c){super(),this.options=s.extend(Object.create(Kp),c),s.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(c&&c.className?c.className.trim().split(/\s+/):[])}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&c.on("preclick",this._onClose),this.options.closeOnMove&&c.on("move",this._onClose),c.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(c.on("mousemove",this._onMouseEvent),c.on("mouseup",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")):c.on("move",this._update),this.fire(new s.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const c=this._map;return c&&(c.off("move",this._update),c.off("move",this._onClose),c.off("preclick",this._onClose),c.off("click",this._onClose),c.off("remove",this.remove),c.off("mousemove",this._onMouseEvent),c.off("mouseup",this._onMouseEvent),c.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new s.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(c){this._lngLat=s.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const c=this._map;return c&&(c.off("move",this._update),c.on("mousemove",this._onMouseEvent),c.on("drag",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(s.window.document.createTextNode(c))}setHTML(c){const n=s.window.document.createDocumentFragment(),a=s.window.document.createElement("body");let d;for(a.innerHTML=c;d=a.firstChild,d;)n.appendChild(d);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=q("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(c),this.options.closeButton){const a=this._closeButton=q("button","mapboxgl-popup-close-button",n);a.type="button",a.setAttribute("aria-label","Close popup"),a.setAttribute("aria-hidden","true"),a.innerHTML="&#215;",a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(c){return this._classList.add(c),this._updateClassList(),this}removeClassName(c){return this._classList.delete(c),this._updateClassList(),this}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){let n;return this._classList.delete(c)?n=!1:(this._classList.add(c),n=!0),this._updateClassList(),n}_onMouseEvent(c){this._update(c.point)}_getAnchor(c){if(this.options.anchor)return this.options.anchor;const n=this._map,a=this._container,d=this._pos;if(!n||!a||!d)return"bottom";const _=a.offsetWidth,g=a.offsetHeight,w=d.x<_/2,E=d.x>n.transform.width-_/2;if(d.y+c<g)return w?"top-left":E?"top-right":"top";if(d.y>n.transform.height-g){if(w)return"bottom-left";if(E)return"bottom-right"}return w?"left":E?"right":"bottom"}_updateClassList(){const c=this._container;if(!c)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),c.className=n.join(" ")}_update(c){const n=this._map,a=this._content;if(!n||!this._lngLat&&!this._trackPointer||!a)return;let d=this._container;if(d||(d=this._container=q("div","mapboxgl-popup",n.getContainer()),this._tip=q("div","mapboxgl-popup-tip",d),d.appendChild(a)),this.options.maxWidth&&d.style.maxWidth!==this.options.maxWidth&&(d.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ou(this._lngLat,this._pos,n.transform)),!this._trackPointer||c){const _=this._pos=this._trackPointer&&c?c:n.project(this._lngLat),g=Kl(this.options.offset),w=this._anchor=this._getAnchor(g.y),E=Kl(this.options.offset,w),C=_.add(E).round();n._requestDomTask(()=>{this._container&&w&&(this._container.style.transform=`${Na[w]} translate(${C.x}px,${C.y}px)`)})}if(!this._marker&&n._showingGlobe()){const _=s.isLngLatBehindGlobe(n.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const c=this._container.querySelector(Yp);c&&c.focus()}_onClose(){this.remove()}_setOpacity(c){this._container&&(this._container.style.opacity=`${c}`),this._content&&(this._content.style.pointerEvents=c?"auto":"none")}},Marker:Hl,Style:Cr,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.pointGeometry,MercatorCoordinate:s.MercatorCoordinate,FreeCameraOptions:Pt,Evented:s.Evented,config:s.config,prewarm:function(){Li().acquire(jt)},clearPrewarmedResources:function(){const c=ci;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(jt),ci=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return s.config.ACCESS_TOKEN},set accessToken(c){s.config.ACCESS_TOKEN=c},get baseApiUrl(){return s.config.API_URL},set baseApiUrl(c){s.config.API_URL=c},get workerCount(){return Qt.workerCount},set workerCount(c){Qt.workerCount=c},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){s.config.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage(c){s.clearTileCache(c)},workerUrl:"",workerClass:null,setNow:s.exported.setNow,restoreNow:s.exported.restoreNow};return qa});var A=x;return A})})(gw);const w_=gw.exports;const Kk=(r,u)=>{const p=r.__vccOpts||r;for(const[y,x]of u)p[y]=x;return p},Yk={__name:"Mapbox",setup(r){const u=Ot();return w_.accessToken="pk.eyJ1IjoicnViZW5kZWRpZWdvOTAiLCJhIjoiY2t5anF6M2ltMHYxdDJ2cW9lNHZmc3JteiJ9.-WS08Ja1iIvjKvBNRX_X9w",ar(()=>{try{const p=new w_.Map({container:u.value,style:"mapbox://styles/mapbox/streets-v11",center:[-3.3257027308061775,40.49381049145687],zoom:13,projection:"globe"}),y=new w_.Marker().setLngLat([-3.3257027308061775,40.49381049145687]).addTo(p);p.on("style.load",()=>{p.setFog({})})}catch(p){console.error(p)}}),(p,y)=>(qn(),ha("div",{class:"map-container",ref_key:"mapContainer",ref:u},null,512))}},Jk=Kk(Yk,[["__scopeId","data-v-bcbcb3dd"]]),Qk=gi("div",{class:"col-12 column",style:{padding:"1rem"}},[gi("p",{class:"text-justify"},[Xo("Os esperamos en "),gi("strong",null,[gi("u",null,"La Vega del Henares")]),Xo(" donde celebraremos nuestro matrimonio junto a nuestros seres queridos.")])],-1),ez={style:{display:"flex","justify-content":"center","align-items":"center","margin-top":"1rem"}},tz={href:"http://maps.google.com/?q=Carretera Madrid Barcelona, 0 Km 33, N-II, 28801 Alcal\xE1 de Henares, Madrid",style:{"text-decoration":"none"}},iz={__name:"Lugar",setup(r){return(u,p)=>(qn(),ha(or,null,[Lt(Nc,{title:"Lugar"}),Qk,Lt(Jk),gi("div",ez,[gi("a",tz,[Lt(Qr,{color:"black",icon:"map",label:"Ir a Google Maps",rounded:""})])])],64))}},nz=gi("div",{class:"col-12 column",style:{padding:"1rem"}},[gi("p",{class:"text-justify"},"\xA1Ayudanos con la m\xFAsica! A\xF1ade tus canciones favoritas para disfrutar de ellas en la fiesta despu\xE9s de la c\xF3mida. Tambi\xE9n puedes ver la m\xFAsica a\xF1adida por los dem\xE1s invitados.")],-1),rz={style:{display:"flex","justify-content":"center","align-items":"center",width:"100%"}},oz={style:{display:"flex","justify-content":"center"}},sz=gi("br",null,null,-1),az={__name:"Musica",setup(r){const u=Ot(""),p=()=>{console.log("add music")};return(y,x)=>(qn(),ha(or,null,[Lt(Nc,{title:"M\xFAsica"}),nz,gi("div",rz,[Lt(Xb,{onSubmit:p,class:"q-gutter-md",style:{width:"95%",display:"flex","flex-direction":"column"}},{default:Qi(()=>[Lt(Ah,{color:"blue-12",modelValue:u.value,"onUpdate:modelValue":x[0]||(x[0]=T=>u.value=T),"lazy-rules":"","label-slot":"",rules:[T=>T&&T.length>0||"Campo obligatorio"]},{prepend:Qi(()=>[Lt(kn,{name:"music_note"})]),label:Qi(()=>[Xo(" Canci\xF3n ")]),_:1},8,["modelValue","rules"]),gi("div",oz,[Lt(Qr,{style:{width:"60%"},type:"submit",color:"black",icon:"playlist_add",label:"A\xF1adir",rounded:""})]),sz]),_:1})])],64))}},lz=AS('<div class="col-12 column" style="padding:1rem;"><p class="text-justify">Vuestra presencia ser\xE1 nuestro mejor regalo. A\xFAn as\xED, si quieres contribuir en nuestra futura vida juntos, os facilitamos el n\xFAmero de cuenta.</p><div class="flex col-12" style="display:flex;justify-content:center;align-items:center;"><p class="text-justify"><strong>ES8801986139751066924632</strong></p></div><p class="text-justify">Tres cosas hay en la vida; salud, dinero y amor. Afortunadamente nos sobran salud y amor.</p></div><p style="color:red;">EL NUMERO DE CUENTA NO ES ESE, CAMBIAR</p>',2),cz={__name:"Regalos",setup(r){return(u,p)=>(qn(),ha(or,null,[Lt(Nc,{title:"Regalos"}),lz],64))}},uz={class:"column",style:{"z-index":"0"}},hz={href:"https://api.whatsapp.com/send?phone=+34689529238",class:"col-6",style:{"text-decoration":"inherit"}},dz={href:"https://api.whatsapp.com/send?phone=+34665091123",class:"col-6",style:{"text-decoration":"inherit"}},fz={__name:"App",setup(r){const u=Ot("Inicio"),p=x=>{document.body.scrollTop=document.documentElement.scrollTop=0,u.value=x},y=Ot("");return ar(async()=>{y.value=await sk()}),(x,T)=>(qn(),_o(PA,{view:"hHh LpR lFf"},{default:Qi(()=>[Lt(bA,{elevated:"",class:"bg-primary text-white"},{default:Qi(()=>[Lt(Eb,{class:"col-12",src:sg(UA),style:{height:"100px"},fit:"fill"},null,8,["src"])]),_:1}),Lt(SA,null,{default:Qi(()=>[Lt(EA,{style:{"z-index":"1"},position:"top-left",offset:[10,10]},{default:Qi(()=>[Lt(VA,{class:"column",onHandleTabSelected:T[0]||(T[0]=A=>p(A))})]),_:1}),gi("div",uz,[u.value==="Asistencia"?(qn(),_o(bk,{key:0})):mc("",!0),u.value==="Inicio"?(qn(),_o(Gk,{key:1})):mc("",!0),u.value==="Itinerario"?(qn(),_o(Xk,{key:2})):mc("",!0),u.value==="Lugar"?(qn(),_o(iz,{key:3})):mc("",!0),u.value==="M\xFAsica"?(qn(),_o(az,{key:4})):mc("",!0),u.value==="Regalos"?(qn(),_o(cz,{key:5})):mc("",!0)])]),_:1}),Lt(AA,{elevated:"",class:"q-pa-md bg-grey-8"},{default:Qi(()=>[Lt(CA,{class:"row justify-end"},{default:Qi(()=>[gi("a",hz,[Lt(u0,{avatar:"https://cdn.quasar.dev/img/avatar1.jpg",text:["\xBFDudas?"],sent:""})]),gi("a",dz,[Lt(u0,{avatar:"https://cdn.quasar.dev/img/avatar2.jpg",text:["\xA1Clicka!"],sent:""})])]),_:1})]),_:1})]),_:1}))}},vw=Q1(fz);Tb.setDefaults({position:"center",timeout:5e3,textColor:"white",actions:[{icon:"close",color:"white"}]});vw.use(UC,{plugins:{Notify:Tb}});vw.mount("#app");

(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const b of document.querySelectorAll('link[rel="modulepreload"]'))y(b);new MutationObserver(b=>{for(const E of b)if(E.type==="childList")for(const M of E.addedNodes)M.tagName==="LINK"&&M.rel==="modulepreload"&&y(M)}).observe(document,{childList:!0,subtree:!0});function p(b){const E={};return b.integrity&&(E.integrity=b.integrity),b.referrerpolicy&&(E.referrerPolicy=b.referrerpolicy),b.crossorigin==="use-credentials"?E.credentials="include":b.crossorigin==="anonymous"?E.credentials="omit":E.credentials="same-origin",E}function y(b){if(b.ep)return;b.ep=!0;const E=p(b);fetch(b.href,E)}})();function L_(r,h){const p=Object.create(null),y=r.split(",");for(let b=0;b<y.length;b++)p[y[b]]=!0;return h?b=>!!p[b.toLowerCase()]:b=>!!p[b]}const v2="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",x2=L_(v2);function V0(r){return!!r||r===""}function B_(r){if(vi(r)){const h={};for(let p=0;p<r.length;p++){const y=r[p],b=qn(y)?T2(y):B_(y);if(b)for(const E in b)h[E]=b[E]}return h}else{if(qn(r))return r;if(vn(r))return r}}const b2=/;(?![^(]*\))/g,w2=/:(.+)/;function T2(r){const h={};return r.split(b2).forEach(p=>{if(p){const y=p.split(w2);y.length>1&&(h[y[0].trim()]=y[1].trim())}}),h}function R_(r){let h="";if(qn(r))h=r;else if(vi(r))for(let p=0;p<r.length;p++){const y=R_(r[p]);y&&(h+=y+" ")}else if(vn(r))for(const p in r)r[p]&&(h+=p+" ");return h.trim()}const ea=r=>qn(r)?r:r==null?"":vi(r)||vn(r)&&(r.toString===q0||!Ei(r.toString))?JSON.stringify(r,U0,2):String(r),U0=(r,h)=>h&&h.__v_isRef?U0(r,h.value):bc(h)?{[`Map(${h.size})`]:[...h.entries()].reduce((p,[y,b])=>(p[`${y} =>`]=b,p),{})}:N0(h)?{[`Set(${h.size})`]:[...h.values()]}:vn(h)&&!vi(h)&&!$0(h)?String(h):h,cn={},xc=[],vo=()=>{},E2=()=>!1,S2=/^on[^a-z]/,Qf=r=>S2.test(r),F_=r=>r.startsWith("onUpdate:"),or=Object.assign,O_=(r,h)=>{const p=r.indexOf(h);p>-1&&r.splice(p,1)},C2=Object.prototype.hasOwnProperty,Ui=(r,h)=>C2.call(r,h),vi=Array.isArray,bc=r=>ep(r)==="[object Map]",N0=r=>ep(r)==="[object Set]",Ei=r=>typeof r=="function",qn=r=>typeof r=="string",V_=r=>typeof r=="symbol",vn=r=>r!==null&&typeof r=="object",j0=r=>vn(r)&&Ei(r.then)&&Ei(r.catch),q0=Object.prototype.toString,ep=r=>q0.call(r),A2=r=>ep(r).slice(8,-1),$0=r=>ep(r)==="[object Object]",U_=r=>qn(r)&&r!=="NaN"&&r[0]!=="-"&&""+parseInt(r,10)===r,kf=L_(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),tp=r=>{const h=Object.create(null);return p=>h[p]||(h[p]=r(p))},M2=/-(\w)/g,Cc=tp(r=>r.replace(M2,(h,p)=>p?p.toUpperCase():"")),I2=/\B([A-Z])/g,zc=tp(r=>r.replace(I2,"-$1").toLowerCase()),G0=tp(r=>r.charAt(0).toUpperCase()+r.slice(1)),Wm=tp(r=>r?`on${G0(r)}`:""),Sh=(r,h)=>!Object.is(r,h),xh=(r,h)=>{for(let p=0;p<r.length;p++)r[p](h)},Rf=(r,h,p)=>{Object.defineProperty(r,h,{configurable:!0,enumerable:!1,value:p})},Z0=r=>{const h=parseFloat(r);return isNaN(h)?r:h};let Qv;const k2=()=>Qv||(Qv=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});let Uo;class z2{constructor(h=!1){this.active=!0,this.effects=[],this.cleanups=[],!h&&Uo&&(this.parent=Uo,this.index=(Uo.scopes||(Uo.scopes=[])).push(this)-1)}run(h){if(this.active){const p=Uo;try{return Uo=this,h()}finally{Uo=p}}}on(){Uo=this}off(){Uo=this.parent}stop(h){if(this.active){let p,y;for(p=0,y=this.effects.length;p<y;p++)this.effects[p].stop();for(p=0,y=this.cleanups.length;p<y;p++)this.cleanups[p]();if(this.scopes)for(p=0,y=this.scopes.length;p<y;p++)this.scopes[p].stop(!0);if(this.parent&&!h){const b=this.parent.scopes.pop();b&&b!==this&&(this.parent.scopes[this.index]=b,b.index=this.index)}this.active=!1}}}function P2(r,h=Uo){h&&h.active&&h.effects.push(r)}const N_=r=>{const h=new Set(r);return h.w=0,h.n=0,h},W0=r=>(r.w&sa)>0,H0=r=>(r.n&sa)>0,D2=({deps:r})=>{if(r.length)for(let h=0;h<r.length;h++)r[h].w|=sa},L2=r=>{const{deps:h}=r;if(h.length){let p=0;for(let y=0;y<h.length;y++){const b=h[y];W0(b)&&!H0(b)?b.delete(r):h[p++]=b,b.w&=~sa,b.n&=~sa}h.length=p}},d_=new WeakMap;let _h=0,sa=1;const f_=30;let _o;const ul=Symbol(""),p_=Symbol("");class j_{constructor(h,p=null,y){this.fn=h,this.scheduler=p,this.active=!0,this.deps=[],this.parent=void 0,P2(this,y)}run(){if(!this.active)return this.fn();let h=_o,p=ra;for(;h;){if(h===this)return;h=h.parent}try{return this.parent=_o,_o=this,ra=!0,sa=1<<++_h,_h<=f_?D2(this):ex(this),this.fn()}finally{_h<=f_&&L2(this),sa=1<<--_h,_o=this.parent,ra=p,this.parent=void 0,this.deferStop&&this.stop()}}stop(){_o===this?this.deferStop=!0:this.active&&(ex(this),this.onStop&&this.onStop(),this.active=!1)}}function ex(r){const{deps:h}=r;if(h.length){for(let p=0;p<h.length;p++)h[p].delete(r);h.length=0}}let ra=!0;const X0=[];function Pc(){X0.push(ra),ra=!1}function Dc(){const r=X0.pop();ra=r===void 0?!0:r}function jr(r,h,p){if(ra&&_o){let y=d_.get(r);y||d_.set(r,y=new Map);let b=y.get(p);b||y.set(p,b=N_()),K0(b)}}function K0(r,h){let p=!1;_h<=f_?H0(r)||(r.n|=sa,p=!W0(r)):p=!r.has(_o),p&&(r.add(_o),_o.deps.push(r))}function _s(r,h,p,y,b,E){const M=d_.get(r);if(!M)return;let s=[];if(h==="clear")s=[...M.values()];else if(p==="length"&&vi(r))M.forEach((D,V)=>{(V==="length"||V>=y)&&s.push(D)});else switch(p!==void 0&&s.push(M.get(p)),h){case"add":vi(r)?U_(p)&&s.push(M.get("length")):(s.push(M.get(ul)),bc(r)&&s.push(M.get(p_)));break;case"delete":vi(r)||(s.push(M.get(ul)),bc(r)&&s.push(M.get(p_)));break;case"set":bc(r)&&s.push(M.get(ul));break}if(s.length===1)s[0]&&m_(s[0]);else{const D=[];for(const V of s)V&&D.push(...V);m_(N_(D))}}function m_(r,h){const p=vi(r)?r:[...r];for(const y of p)y.computed&&tx(y);for(const y of p)y.computed||tx(y)}function tx(r,h){(r!==_o||r.allowRecurse)&&(r.scheduler?r.scheduler():r.run())}const B2=L_("__proto__,__v_isRef,__isVue"),Y0=new Set(Object.getOwnPropertyNames(Symbol).filter(r=>r!=="arguments"&&r!=="caller").map(r=>Symbol[r]).filter(V_)),R2=q_(),F2=q_(!1,!0),O2=q_(!0),ix=V2();function V2(){const r={};return["includes","indexOf","lastIndexOf"].forEach(h=>{r[h]=function(...p){const y=Li(this);for(let E=0,M=this.length;E<M;E++)jr(y,"get",E+"");const b=y[h](...p);return b===-1||b===!1?y[h](...p.map(Li)):b}}),["push","pop","shift","unshift","splice"].forEach(h=>{r[h]=function(...p){Pc();const y=Li(this)[h].apply(this,p);return Dc(),y}}),r}function q_(r=!1,h=!1){return function(y,b,E){if(b==="__v_isReactive")return!r;if(b==="__v_isReadonly")return r;if(b==="__v_isShallow")return h;if(b==="__v_raw"&&E===(r?h?tE:i1:h?t1:e1).get(y))return y;const M=vi(y);if(!r&&M&&Ui(ix,b))return Reflect.get(ix,b,E);const s=Reflect.get(y,b,E);return(V_(b)?Y0.has(b):B2(b))||(r||jr(y,"get",b),h)?s:pr(s)?M&&U_(b)?s:s.value:vn(s)?r?n1(s):$o(s):s}}const U2=J0(),N2=J0(!0);function J0(r=!1){return function(p,y,b,E){let M=p[y];if(Ac(M)&&pr(M)&&!pr(b))return!1;if(!r&&(!Ff(b)&&!Ac(b)&&(M=Li(M),b=Li(b)),!vi(p)&&pr(M)&&!pr(b)))return M.value=b,!0;const s=vi(p)&&U_(y)?Number(y)<p.length:Ui(p,y),D=Reflect.set(p,y,b,E);return p===Li(E)&&(s?Sh(b,M)&&_s(p,"set",y,b):_s(p,"add",y,b)),D}}function j2(r,h){const p=Ui(r,h);r[h];const y=Reflect.deleteProperty(r,h);return y&&p&&_s(r,"delete",h,void 0),y}function q2(r,h){const p=Reflect.has(r,h);return(!V_(h)||!Y0.has(h))&&jr(r,"has",h),p}function $2(r){return jr(r,"iterate",vi(r)?"length":ul),Reflect.ownKeys(r)}const Q0={get:R2,set:U2,deleteProperty:j2,has:q2,ownKeys:$2},G2={get:O2,set(r,h){return!0},deleteProperty(r,h){return!0}},Z2=or({},Q0,{get:F2,set:N2}),$_=r=>r,ip=r=>Reflect.getPrototypeOf(r);function _f(r,h,p=!1,y=!1){r=r.__v_raw;const b=Li(r),E=Li(h);p||(h!==E&&jr(b,"get",h),jr(b,"get",E));const{has:M}=ip(b),s=y?$_:p?W_:Ch;if(M.call(b,h))return s(r.get(h));if(M.call(b,E))return s(r.get(E));r!==b&&r.get(h)}function gf(r,h=!1){const p=this.__v_raw,y=Li(p),b=Li(r);return h||(r!==b&&jr(y,"has",r),jr(y,"has",b)),r===b?p.has(r):p.has(r)||p.has(b)}function yf(r,h=!1){return r=r.__v_raw,!h&&jr(Li(r),"iterate",ul),Reflect.get(r,"size",r)}function nx(r){r=Li(r);const h=Li(this);return ip(h).has.call(h,r)||(h.add(r),_s(h,"add",r,r)),this}function rx(r,h){h=Li(h);const p=Li(this),{has:y,get:b}=ip(p);let E=y.call(p,r);E||(r=Li(r),E=y.call(p,r));const M=b.call(p,r);return p.set(r,h),E?Sh(h,M)&&_s(p,"set",r,h):_s(p,"add",r,h),this}function ox(r){const h=Li(this),{has:p,get:y}=ip(h);let b=p.call(h,r);b||(r=Li(r),b=p.call(h,r)),y&&y.call(h,r);const E=h.delete(r);return b&&_s(h,"delete",r,void 0),E}function sx(){const r=Li(this),h=r.size!==0,p=r.clear();return h&&_s(r,"clear",void 0,void 0),p}function vf(r,h){return function(y,b){const E=this,M=E.__v_raw,s=Li(M),D=h?$_:r?W_:Ch;return!r&&jr(s,"iterate",ul),M.forEach((V,N)=>y.call(b,D(V),D(N),E))}}function xf(r,h,p){return function(...y){const b=this.__v_raw,E=Li(b),M=bc(E),s=r==="entries"||r===Symbol.iterator&&M,D=r==="keys"&&M,V=b[r](...y),N=p?$_:h?W_:Ch;return!h&&jr(E,"iterate",D?p_:ul),{next(){const{value:U,done:q}=V.next();return q?{value:U,done:q}:{value:s?[N(U[0]),N(U[1])]:N(U),done:q}},[Symbol.iterator](){return this}}}}function Ks(r){return function(...h){return r==="delete"?!1:this}}function W2(){const r={get(E){return _f(this,E)},get size(){return yf(this)},has:gf,add:nx,set:rx,delete:ox,clear:sx,forEach:vf(!1,!1)},h={get(E){return _f(this,E,!1,!0)},get size(){return yf(this)},has:gf,add:nx,set:rx,delete:ox,clear:sx,forEach:vf(!1,!0)},p={get(E){return _f(this,E,!0)},get size(){return yf(this,!0)},has(E){return gf.call(this,E,!0)},add:Ks("add"),set:Ks("set"),delete:Ks("delete"),clear:Ks("clear"),forEach:vf(!0,!1)},y={get(E){return _f(this,E,!0,!0)},get size(){return yf(this,!0)},has(E){return gf.call(this,E,!0)},add:Ks("add"),set:Ks("set"),delete:Ks("delete"),clear:Ks("clear"),forEach:vf(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(E=>{r[E]=xf(E,!1,!1),p[E]=xf(E,!0,!1),h[E]=xf(E,!1,!0),y[E]=xf(E,!0,!0)}),[r,p,h,y]}const[H2,X2,K2,Y2]=W2();function G_(r,h){const p=h?r?Y2:K2:r?X2:H2;return(y,b,E)=>b==="__v_isReactive"?!r:b==="__v_isReadonly"?r:b==="__v_raw"?y:Reflect.get(Ui(p,b)&&b in y?p:y,b,E)}const J2={get:G_(!1,!1)},Q2={get:G_(!1,!0)},eE={get:G_(!0,!1)},e1=new WeakMap,t1=new WeakMap,i1=new WeakMap,tE=new WeakMap;function iE(r){switch(r){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function nE(r){return r.__v_skip||!Object.isExtensible(r)?0:iE(A2(r))}function $o(r){return Ac(r)?r:Z_(r,!1,Q0,J2,e1)}function rE(r){return Z_(r,!1,Z2,Q2,t1)}function n1(r){return Z_(r,!0,G2,eE,i1)}function Z_(r,h,p,y,b){if(!vn(r)||r.__v_raw&&!(h&&r.__v_isReactive))return r;const E=b.get(r);if(E)return E;const M=nE(r);if(M===0)return r;const s=new Proxy(r,M===2?y:p);return b.set(r,s),s}function wc(r){return Ac(r)?wc(r.__v_raw):!!(r&&r.__v_isReactive)}function Ac(r){return!!(r&&r.__v_isReadonly)}function Ff(r){return!!(r&&r.__v_isShallow)}function r1(r){return wc(r)||Ac(r)}function Li(r){const h=r&&r.__v_raw;return h?Li(h):r}function np(r){return Rf(r,"__v_skip",!0),r}const Ch=r=>vn(r)?$o(r):r,W_=r=>vn(r)?n1(r):r;function o1(r){ra&&_o&&(r=Li(r),K0(r.dep||(r.dep=N_())))}function s1(r,h){r=Li(r),r.dep&&m_(r.dep)}function pr(r){return!!(r&&r.__v_isRef===!0)}function Rt(r){return oE(r,!1)}function oE(r,h){return pr(r)?r:new sE(r,h)}class sE{constructor(h,p){this.__v_isShallow=p,this.dep=void 0,this.__v_isRef=!0,this._rawValue=p?h:Li(h),this._value=p?h:Ch(h)}get value(){return o1(this),this._value}set value(h){const p=this.__v_isShallow||Ff(h)||Ac(h);h=p?h:Li(h),Sh(h,this._rawValue)&&(this._rawValue=h,this._value=p?h:Ch(h),s1(this))}}function H_(r){return pr(r)?r.value:r}const aE={get:(r,h,p)=>H_(Reflect.get(r,h,p)),set:(r,h,p,y)=>{const b=r[h];return pr(b)&&!pr(p)?(b.value=p,!0):Reflect.set(r,h,p,y)}};function a1(r){return wc(r)?r:new Proxy(r,aE)}var l1;class lE{constructor(h,p,y,b){this._setter=p,this.dep=void 0,this.__v_isRef=!0,this[l1]=!1,this._dirty=!0,this.effect=new j_(h,()=>{this._dirty||(this._dirty=!0,s1(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!b,this.__v_isReadonly=y}get value(){const h=Li(this);return o1(h),(h._dirty||!h._cacheable)&&(h._dirty=!1,h._value=h.effect.run()),h._value}set value(h){this._setter(h)}}l1="__v_isReadonly";function cE(r,h,p=!1){let y,b;const E=Ei(r);return E?(y=r,b=vo):(y=r.get,b=r.set),new lE(y,b,E||!b,p)}function oa(r,h,p,y){let b;try{b=y?r(...y):r()}catch(E){rp(E,h,p)}return b}function Qr(r,h,p,y){if(Ei(r)){const E=oa(r,h,p,y);return E&&j0(E)&&E.catch(M=>{rp(M,h,p)}),E}const b=[];for(let E=0;E<r.length;E++)b.push(Qr(r[E],h,p,y));return b}function rp(r,h,p,y=!0){const b=h?h.vnode:null;if(h){let E=h.parent;const M=h.proxy,s=p;for(;E;){const V=E.ec;if(V){for(let N=0;N<V.length;N++)if(V[N](r,M,s)===!1)return}E=E.parent}const D=h.appContext.config.errorHandler;if(D){oa(D,null,10,[r,M,s]);return}}uE(r,p,b,y)}function uE(r,h,p,y=!0){console.error(r)}let Ah=!1,__=!1;const fr=[];let qo=0;const Tc=[];let fs=null,rl=0;const c1=Promise.resolve();let X_=null;function pn(r){const h=X_||c1;return r?h.then(this?r.bind(this):r):h}function hE(r){let h=qo+1,p=fr.length;for(;h<p;){const y=h+p>>>1;Mh(fr[y])<r?h=y+1:p=y}return h}function K_(r){(!fr.length||!fr.includes(r,Ah&&r.allowRecurse?qo+1:qo))&&(r.id==null?fr.push(r):fr.splice(hE(r.id),0,r),u1())}function u1(){!Ah&&!__&&(__=!0,X_=c1.then(d1))}function dE(r){const h=fr.indexOf(r);h>qo&&fr.splice(h,1)}function fE(r){vi(r)?Tc.push(...r):(!fs||!fs.includes(r,r.allowRecurse?rl+1:rl))&&Tc.push(r),u1()}function ax(r,h=Ah?qo+1:0){for(;h<fr.length;h++){const p=fr[h];p&&p.pre&&(fr.splice(h,1),h--,p())}}function h1(r){if(Tc.length){const h=[...new Set(Tc)];if(Tc.length=0,fs){fs.push(...h);return}for(fs=h,fs.sort((p,y)=>Mh(p)-Mh(y)),rl=0;rl<fs.length;rl++)fs[rl]();fs=null,rl=0}}const Mh=r=>r.id==null?1/0:r.id,pE=(r,h)=>{const p=Mh(r)-Mh(h);if(p===0){if(r.pre&&!h.pre)return-1;if(h.pre&&!r.pre)return 1}return p};function d1(r){__=!1,Ah=!0,fr.sort(pE);const h=vo;try{for(qo=0;qo<fr.length;qo++){const p=fr[qo];p&&p.active!==!1&&oa(p,null,14)}}finally{qo=0,fr.length=0,h1(),Ah=!1,X_=null,(fr.length||Tc.length)&&d1()}}function mE(r,h,...p){if(r.isUnmounted)return;const y=r.vnode.props||cn;let b=p;const E=h.startsWith("update:"),M=E&&h.slice(7);if(M&&M in y){const N=`${M==="modelValue"?"model":M}Modifiers`,{number:U,trim:q}=y[N]||cn;q&&(b=p.map(Y=>Y.trim())),U&&(b=p.map(Z0))}let s,D=y[s=Wm(h)]||y[s=Wm(Cc(h))];!D&&E&&(D=y[s=Wm(zc(h))]),D&&Qr(D,r,6,b);const V=y[s+"Once"];if(V){if(!r.emitted)r.emitted={};else if(r.emitted[s])return;r.emitted[s]=!0,Qr(V,r,6,b)}}function f1(r,h,p=!1){const y=h.emitsCache,b=y.get(r);if(b!==void 0)return b;const E=r.emits;let M={},s=!1;if(!Ei(r)){const D=V=>{const N=f1(V,h,!0);N&&(s=!0,or(M,N))};!p&&h.mixins.length&&h.mixins.forEach(D),r.extends&&D(r.extends),r.mixins&&r.mixins.forEach(D)}return!E&&!s?(vn(r)&&y.set(r,null),null):(vi(E)?E.forEach(D=>M[D]=null):or(M,E),vn(r)&&y.set(r,M),M)}function op(r,h){return!r||!Qf(h)?!1:(h=h.slice(2).replace(/Once$/,""),Ui(r,h[0].toLowerCase()+h.slice(1))||Ui(r,zc(h))||Ui(r,h))}let go=null,p1=null;function Of(r){const h=go;return go=r,p1=r&&r.type.__scopeId||null,h}function Ln(r,h=go,p){if(!h||r._n)return r;const y=(...b)=>{y._d&&yx(-1);const E=Of(h),M=r(...b);return Of(E),y._d&&yx(1),M};return y._n=!0,y._c=!0,y._d=!0,y}function Hm(r){const{type:h,vnode:p,proxy:y,withProxy:b,props:E,propsOptions:[M],slots:s,attrs:D,emit:V,render:N,renderCache:U,data:q,setupState:Y,ctx:_e,inheritAttrs:ve}=r;let ze,Ye;const we=Of(r);try{if(p.shapeFlag&4){const Ge=b||y;ze=No(N.call(Ge,Ge,U,E,Y,q,_e)),Ye=D}else{const Ge=h;ze=No(Ge.length>1?Ge(E,{attrs:D,slots:s,emit:V}):Ge(E,null)),Ye=h.props?D:_E(D)}}catch(Ge){Th.length=0,rp(Ge,r,1),ze=Ut(xo)}let Ue=ze;if(Ye&&ve!==!1){const Ge=Object.keys(Ye),{shapeFlag:Se}=Ue;Ge.length&&Se&7&&(M&&Ge.some(F_)&&(Ye=gE(Ye,M)),Ue=gs(Ue,Ye))}return p.dirs&&(Ue=gs(Ue),Ue.dirs=Ue.dirs?Ue.dirs.concat(p.dirs):p.dirs),p.transition&&(Ue.transition=p.transition),ze=Ue,Of(we),ze}const _E=r=>{let h;for(const p in r)(p==="class"||p==="style"||Qf(p))&&((h||(h={}))[p]=r[p]);return h},gE=(r,h)=>{const p={};for(const y in r)(!F_(y)||!(y.slice(9)in h))&&(p[y]=r[y]);return p};function yE(r,h,p){const{props:y,children:b,component:E}=r,{props:M,children:s,patchFlag:D}=h,V=E.emitsOptions;if(h.dirs||h.transition)return!0;if(p&&D>=0){if(D&1024)return!0;if(D&16)return y?lx(y,M,V):!!M;if(D&8){const N=h.dynamicProps;for(let U=0;U<N.length;U++){const q=N[U];if(M[q]!==y[q]&&!op(V,q))return!0}}}else return(b||s)&&(!s||!s.$stable)?!0:y===M?!1:y?M?lx(y,M,V):!0:!!M;return!1}function lx(r,h,p){const y=Object.keys(h);if(y.length!==Object.keys(r).length)return!0;for(let b=0;b<y.length;b++){const E=y[b];if(h[E]!==r[E]&&!op(p,E))return!0}return!1}function vE({vnode:r,parent:h},p){for(;h&&h.subTree===r;)(r=h.vnode).el=p,h=h.parent}const m1=r=>r.__isSuspense;function xE(r,h){h&&h.pendingBranch?vi(r)?h.effects.push(...r):h.effects.push(r):fE(r)}function Bh(r,h){if(rr){let p=rr.provides;const y=rr.parent&&rr.parent.provides;y===p&&(p=rr.provides=Object.create(y)),p[r]=h}}function Zo(r,h,p=!1){const y=rr||go;if(y){const b=y.parent==null?y.vnode.appContext&&y.vnode.appContext.provides:y.parent.provides;if(b&&r in b)return b[r];if(arguments.length>1)return p&&Ei(h)?h.call(y.proxy):h}}const cx={};function ri(r,h,p){return _1(r,h,p)}function _1(r,h,{immediate:p,deep:y,flush:b,onTrack:E,onTrigger:M}=cn){const s=rr;let D,V=!1,N=!1;if(pr(r)?(D=()=>r.value,V=Ff(r)):wc(r)?(D=()=>r,y=!0):vi(r)?(N=!0,V=r.some(Ye=>wc(Ye)||Ff(Ye)),D=()=>r.map(Ye=>{if(pr(Ye))return Ye.value;if(wc(Ye))return al(Ye);if(Ei(Ye))return oa(Ye,s,2)})):Ei(r)?h?D=()=>oa(r,s,2):D=()=>{if(!(s&&s.isUnmounted))return U&&U(),Qr(r,s,3,[q])}:D=vo,h&&y){const Ye=D;D=()=>al(Ye())}let U,q=Ye=>{U=ze.onStop=()=>{oa(Ye,s,4)}};if(kh)return q=vo,h?p&&Qr(h,s,3,[D(),N?[]:void 0,q]):D(),vo;let Y=N?[]:cx;const _e=()=>{if(!!ze.active)if(h){const Ye=ze.run();(y||V||(N?Ye.some((we,Ue)=>Sh(we,Y[Ue])):Sh(Ye,Y)))&&(U&&U(),Qr(h,s,3,[Ye,Y===cx?void 0:Y,q]),Y=Ye)}else ze.run()};_e.allowRecurse=!!h;let ve;b==="sync"?ve=_e:b==="post"?ve=()=>ir(_e,s&&s.suspense):(_e.pre=!0,s&&(_e.id=s.uid),ve=()=>K_(_e));const ze=new j_(D,ve);return h?p?_e():Y=ze.run():b==="post"?ir(ze.run.bind(ze),s&&s.suspense):ze.run(),()=>{ze.stop(),s&&s.scope&&O_(s.scope.effects,ze)}}function bE(r,h,p){const y=this.proxy,b=qn(r)?r.includes(".")?g1(y,r):()=>y[r]:r.bind(y,y);let E;Ei(h)?E=h:(E=h.handler,p=h);const M=rr;Ic(this);const s=_1(b,E.bind(y),p);return M?Ic(M):hl(),s}function g1(r,h){const p=h.split(".");return()=>{let y=r;for(let b=0;b<p.length&&y;b++)y=y[p[b]];return y}}function al(r,h){if(!vn(r)||r.__v_skip||(h=h||new Set,h.has(r)))return r;if(h.add(r),pr(r))al(r.value,h);else if(vi(r))for(let p=0;p<r.length;p++)al(r[p],h);else if(N0(r)||bc(r))r.forEach(p=>{al(p,h)});else if($0(r))for(const p in r)al(r[p],h);return r}function wE(){const r={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return mr(()=>{r.isMounted=!0}),mn(()=>{r.isUnmounting=!0}),r}const Xr=[Function,Array],TE={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Xr,onEnter:Xr,onAfterEnter:Xr,onEnterCancelled:Xr,onBeforeLeave:Xr,onLeave:Xr,onAfterLeave:Xr,onLeaveCancelled:Xr,onBeforeAppear:Xr,onAppear:Xr,onAfterAppear:Xr,onAppearCancelled:Xr},setup(r,{slots:h}){const p=Vi(),y=wE();let b;return()=>{const E=h.default&&x1(h.default(),!0);if(!E||!E.length)return;let M=E[0];if(E.length>1){for(const ve of E)if(ve.type!==xo){M=ve;break}}const s=Li(r),{mode:D}=s;if(y.isLeaving)return Xm(M);const V=ux(M);if(!V)return Xm(M);const N=g_(V,s,y,p);Vf(V,N);const U=p.subTree,q=U&&ux(U);let Y=!1;const{getTransitionKey:_e}=V.type;if(_e){const ve=_e();b===void 0?b=ve:ve!==b&&(b=ve,Y=!0)}if(q&&q.type!==xo&&(!ol(V,q)||Y)){const ve=g_(q,s,y,p);if(Vf(q,ve),D==="out-in")return y.isLeaving=!0,ve.afterLeave=()=>{y.isLeaving=!1,p.update()},Xm(M);D==="in-out"&&V.type!==xo&&(ve.delayLeave=(ze,Ye,we)=>{const Ue=v1(y,q);Ue[String(q.key)]=q,ze._leaveCb=()=>{Ye(),ze._leaveCb=void 0,delete N.delayedLeave},N.delayedLeave=we})}return M}}},y1=TE;function v1(r,h){const{leavingVNodes:p}=r;let y=p.get(h.type);return y||(y=Object.create(null),p.set(h.type,y)),y}function g_(r,h,p,y){const{appear:b,mode:E,persisted:M=!1,onBeforeEnter:s,onEnter:D,onAfterEnter:V,onEnterCancelled:N,onBeforeLeave:U,onLeave:q,onAfterLeave:Y,onLeaveCancelled:_e,onBeforeAppear:ve,onAppear:ze,onAfterAppear:Ye,onAppearCancelled:we}=h,Ue=String(r.key),Ge=v1(p,r),Se=(Pe,Xe)=>{Pe&&Qr(Pe,y,9,Xe)},De=(Pe,Xe)=>{const Ve=Xe[1];Se(Pe,Xe),vi(Pe)?Pe.every(nt=>nt.length<=1)&&Ve():Pe.length<=1&&Ve()},be={mode:E,persisted:M,beforeEnter(Pe){let Xe=s;if(!p.isMounted)if(b)Xe=ve||s;else return;Pe._leaveCb&&Pe._leaveCb(!0);const Ve=Ge[Ue];Ve&&ol(r,Ve)&&Ve.el._leaveCb&&Ve.el._leaveCb(),Se(Xe,[Pe])},enter(Pe){let Xe=D,Ve=V,nt=N;if(!p.isMounted)if(b)Xe=ze||D,Ve=Ye||V,nt=we||N;else return;let qe=!1;const $e=Pe._enterCb=Ke=>{qe||(qe=!0,Ke?Se(nt,[Pe]):Se(Ve,[Pe]),be.delayedLeave&&be.delayedLeave(),Pe._enterCb=void 0)};Xe?De(Xe,[Pe,$e]):$e()},leave(Pe,Xe){const Ve=String(r.key);if(Pe._enterCb&&Pe._enterCb(!0),p.isUnmounting)return Xe();Se(U,[Pe]);let nt=!1;const qe=Pe._leaveCb=$e=>{nt||(nt=!0,Xe(),$e?Se(_e,[Pe]):Se(Y,[Pe]),Pe._leaveCb=void 0,Ge[Ve]===r&&delete Ge[Ve])};Ge[Ve]=r,q?De(q,[Pe,qe]):qe()},clone(Pe){return g_(Pe,h,p,y)}};return be}function Xm(r){if(sp(r))return r=gs(r),r.children=null,r}function ux(r){return sp(r)?r.children?r.children[0]:void 0:r}function Vf(r,h){r.shapeFlag&6&&r.component?Vf(r.component.subTree,h):r.shapeFlag&128?(r.ssContent.transition=h.clone(r.ssContent),r.ssFallback.transition=h.clone(r.ssFallback)):r.transition=h}function x1(r,h=!1,p){let y=[],b=0;for(let E=0;E<r.length;E++){let M=r[E];const s=p==null?M.key:String(p)+String(M.key!=null?M.key:E);M.type===wr?(M.patchFlag&128&&b++,y=y.concat(x1(M.children,h,s))):(h||M.type!==xo)&&y.push(s!=null?gs(M,{key:s}):M)}if(b>1)for(let E=0;E<y.length;E++)y[E].patchFlag=-2;return y}function EE(r){return Ei(r)?{setup:r,name:r.name}:r}const bh=r=>!!r.type.__asyncLoader,sp=r=>r.type.__isKeepAlive,SE={name:"KeepAlive",__isKeepAlive:!0,props:{include:[String,RegExp,Array],exclude:[String,RegExp,Array],max:[String,Number]},setup(r,{slots:h}){const p=Vi(),y=p.ctx;if(!y.renderer)return()=>{const we=h.default&&h.default();return we&&we.length===1?we[0]:we};const b=new Map,E=new Set;let M=null;const s=p.suspense,{renderer:{p:D,m:V,um:N,o:{createElement:U}}}=y,q=U("div");y.activate=(we,Ue,Ge,Se,De)=>{const be=we.component;V(we,Ue,Ge,0,s),D(be.vnode,we,Ue,Ge,be,s,Se,we.slotScopeIds,De),ir(()=>{be.isDeactivated=!1,be.a&&xh(be.a);const Pe=we.props&&we.props.onVnodeMounted;Pe&&Yr(Pe,be.parent,we)},s)},y.deactivate=we=>{const Ue=we.component;V(we,q,null,1,s),ir(()=>{Ue.da&&xh(Ue.da);const Ge=we.props&&we.props.onVnodeUnmounted;Ge&&Yr(Ge,Ue.parent,we),Ue.isDeactivated=!0},s)};function Y(we){Km(we),N(we,p,s,!0)}function _e(we){b.forEach((Ue,Ge)=>{const Se=bx(Ue.type);Se&&(!we||!we(Se))&&ve(Ge)})}function ve(we){const Ue=b.get(we);!M||Ue.type!==M.type?Y(Ue):M&&Km(M),b.delete(we),E.delete(we)}ri(()=>[r.include,r.exclude],([we,Ue])=>{we&&_e(Ge=>gh(we,Ge)),Ue&&_e(Ge=>!gh(Ue,Ge))},{flush:"post",deep:!0});let ze=null;const Ye=()=>{ze!=null&&b.set(ze,Ym(p.subTree))};return mr(Ye),eg(Ye),mn(()=>{b.forEach(we=>{const{subTree:Ue,suspense:Ge}=p,Se=Ym(Ue);if(we.type===Se.type){Km(Se);const De=Se.component.da;De&&ir(De,Ge);return}Y(we)})}),()=>{if(ze=null,!h.default)return null;const we=h.default(),Ue=we[0];if(we.length>1)return M=null,we;if(!jf(Ue)||!(Ue.shapeFlag&4)&&!(Ue.shapeFlag&128))return M=null,Ue;let Ge=Ym(Ue);const Se=Ge.type,De=bx(bh(Ge)?Ge.type.__asyncResolved||{}:Se),{include:be,exclude:Pe,max:Xe}=r;if(be&&(!De||!gh(be,De))||Pe&&De&&gh(Pe,De))return M=Ge,Ue;const Ve=Ge.key==null?Se:Ge.key,nt=b.get(Ve);return Ge.el&&(Ge=gs(Ge),Ue.shapeFlag&128&&(Ue.ssContent=Ge)),ze=Ve,nt?(Ge.el=nt.el,Ge.component=nt.component,Ge.transition&&Vf(Ge,Ge.transition),Ge.shapeFlag|=512,E.delete(Ve),E.add(Ve)):(E.add(Ve),Xe&&E.size>parseInt(Xe,10)&&ve(E.values().next().value)),Ge.shapeFlag|=256,M=Ge,m1(Ue.type)?Ue:Ge}}},CE=SE;function gh(r,h){return vi(r)?r.some(p=>gh(p,h)):qn(r)?r.split(",").includes(h):r.test?r.test(h):!1}function Y_(r,h){b1(r,"a",h)}function Rh(r,h){b1(r,"da",h)}function b1(r,h,p=rr){const y=r.__wdc||(r.__wdc=()=>{let b=p;for(;b;){if(b.isDeactivated)return;b=b.parent}return r()});if(ap(h,y,p),p){let b=p.parent;for(;b&&b.parent;)sp(b.parent.vnode)&&AE(y,h,p,b),b=b.parent}}function AE(r,h,p,y){const b=ap(h,r,y,!0);lp(()=>{O_(y[h],b)},p)}function Km(r){let h=r.shapeFlag;h&256&&(h-=256),h&512&&(h-=512),r.shapeFlag=h}function Ym(r){return r.shapeFlag&128?r.ssContent:r}function ap(r,h,p=rr,y=!1){if(p){const b=p[r]||(p[r]=[]),E=h.__weh||(h.__weh=(...M)=>{if(p.isUnmounted)return;Pc(),Ic(p);const s=Qr(h,p,r,M);return hl(),Dc(),s});return y?b.unshift(E):b.push(E),E}}const vs=r=>(h,p=rr)=>(!kh||r==="sp")&&ap(r,(...y)=>h(...y),p),J_=vs("bm"),mr=vs("m"),Q_=vs("bu"),eg=vs("u"),mn=vs("bum"),lp=vs("um"),ME=vs("sp"),IE=vs("rtg"),kE=vs("rtc");function zE(r,h=rr){ap("ec",r,h)}function tg(r,h){const p=go;if(p===null)return r;const y=up(p)||p.proxy,b=r.dirs||(r.dirs=[]);for(let E=0;E<h.length;E++){let[M,s,D,V=cn]=h[E];Ei(M)&&(M={mounted:M,updated:M}),M.deep&&al(s),b.push({dir:M,instance:y,value:s,oldValue:void 0,arg:D,modifiers:V})}return r}function Qa(r,h,p,y){const b=r.dirs,E=h&&h.dirs;for(let M=0;M<b.length;M++){const s=b[M];E&&(s.oldValue=E[M].value);let D=s.dir[y];D&&(Pc(),Qr(D,p,8,[r.el,s,r,h]),Dc())}}const PE=Symbol(),y_=r=>r?P1(r)?up(r)||r.proxy:y_(r.parent):null,Uf=or(Object.create(null),{$:r=>r,$el:r=>r.vnode.el,$data:r=>r.data,$props:r=>r.props,$attrs:r=>r.attrs,$slots:r=>r.slots,$refs:r=>r.refs,$parent:r=>y_(r.parent),$root:r=>y_(r.root),$emit:r=>r.emit,$options:r=>ig(r),$forceUpdate:r=>r.f||(r.f=()=>K_(r.update)),$nextTick:r=>r.n||(r.n=pn.bind(r.proxy)),$watch:r=>bE.bind(r)}),DE={get({_:r},h){const{ctx:p,setupState:y,data:b,props:E,accessCache:M,type:s,appContext:D}=r;let V;if(h[0]!=="$"){const Y=M[h];if(Y!==void 0)switch(Y){case 1:return y[h];case 2:return b[h];case 4:return p[h];case 3:return E[h]}else{if(y!==cn&&Ui(y,h))return M[h]=1,y[h];if(b!==cn&&Ui(b,h))return M[h]=2,b[h];if((V=r.propsOptions[0])&&Ui(V,h))return M[h]=3,E[h];if(p!==cn&&Ui(p,h))return M[h]=4,p[h];v_&&(M[h]=0)}}const N=Uf[h];let U,q;if(N)return h==="$attrs"&&jr(r,"get",h),N(r);if((U=s.__cssModules)&&(U=U[h]))return U;if(p!==cn&&Ui(p,h))return M[h]=4,p[h];if(q=D.config.globalProperties,Ui(q,h))return q[h]},set({_:r},h,p){const{data:y,setupState:b,ctx:E}=r;return b!==cn&&Ui(b,h)?(b[h]=p,!0):y!==cn&&Ui(y,h)?(y[h]=p,!0):Ui(r.props,h)||h[0]==="$"&&h.slice(1)in r?!1:(E[h]=p,!0)},has({_:{data:r,setupState:h,accessCache:p,ctx:y,appContext:b,propsOptions:E}},M){let s;return!!p[M]||r!==cn&&Ui(r,M)||h!==cn&&Ui(h,M)||(s=E[0])&&Ui(s,M)||Ui(y,M)||Ui(Uf,M)||Ui(b.config.globalProperties,M)},defineProperty(r,h,p){return p.get!=null?r._.accessCache[h]=0:Ui(p,"value")&&this.set(r,h,p.value,null),Reflect.defineProperty(r,h,p)}};let v_=!0;function LE(r){const h=ig(r),p=r.proxy,y=r.ctx;v_=!1,h.beforeCreate&&hx(h.beforeCreate,r,"bc");const{data:b,computed:E,methods:M,watch:s,provide:D,inject:V,created:N,beforeMount:U,mounted:q,beforeUpdate:Y,updated:_e,activated:ve,deactivated:ze,beforeDestroy:Ye,beforeUnmount:we,destroyed:Ue,unmounted:Ge,render:Se,renderTracked:De,renderTriggered:be,errorCaptured:Pe,serverPrefetch:Xe,expose:Ve,inheritAttrs:nt,components:qe,directives:$e,filters:Ke}=h;if(V&&BE(V,y,null,r.appContext.config.unwrapInjectedRef),M)for(const ot in M){const At=M[ot];Ei(At)&&(y[ot]=At.bind(p))}if(b){const ot=b.call(p,p);vn(ot)&&(r.data=$o(ot))}if(v_=!0,E)for(const ot in E){const At=E[ot],di=Ei(At)?At.bind(p,p):Ei(At.get)?At.get.bind(p,p):vo,Fe=!Ei(At)&&Ei(At.set)?At.set.bind(p):vo,_t=xe({get:di,set:Fe});Object.defineProperty(y,ot,{enumerable:!0,configurable:!0,get:()=>_t.value,set:xt=>_t.value=xt})}if(s)for(const ot in s)w1(s[ot],y,p,ot);if(D){const ot=Ei(D)?D.call(p):D;Reflect.ownKeys(ot).forEach(At=>{Bh(At,ot[At])})}N&&hx(N,r,"c");function Ht(ot,At){vi(At)?At.forEach(di=>ot(di.bind(p))):At&&ot(At.bind(p))}if(Ht(J_,U),Ht(mr,q),Ht(Q_,Y),Ht(eg,_e),Ht(Y_,ve),Ht(Rh,ze),Ht(zE,Pe),Ht(kE,De),Ht(IE,be),Ht(mn,we),Ht(lp,Ge),Ht(ME,Xe),vi(Ve))if(Ve.length){const ot=r.exposed||(r.exposed={});Ve.forEach(At=>{Object.defineProperty(ot,At,{get:()=>p[At],set:di=>p[At]=di})})}else r.exposed||(r.exposed={});Se&&r.render===vo&&(r.render=Se),nt!=null&&(r.inheritAttrs=nt),qe&&(r.components=qe),$e&&(r.directives=$e)}function BE(r,h,p=vo,y=!1){vi(r)&&(r=x_(r));for(const b in r){const E=r[b];let M;vn(E)?"default"in E?M=Zo(E.from||b,E.default,!0):M=Zo(E.from||b):M=Zo(E),pr(M)&&y?Object.defineProperty(h,b,{enumerable:!0,configurable:!0,get:()=>M.value,set:s=>M.value=s}):h[b]=M}}function hx(r,h,p){Qr(vi(r)?r.map(y=>y.bind(h.proxy)):r.bind(h.proxy),h,p)}function w1(r,h,p,y){const b=y.includes(".")?g1(p,y):()=>p[y];if(qn(r)){const E=h[r];Ei(E)&&ri(b,E)}else if(Ei(r))ri(b,r.bind(p));else if(vn(r))if(vi(r))r.forEach(E=>w1(E,h,p,y));else{const E=Ei(r.handler)?r.handler.bind(p):h[r.handler];Ei(E)&&ri(b,E,r)}}function ig(r){const h=r.type,{mixins:p,extends:y}=h,{mixins:b,optionsCache:E,config:{optionMergeStrategies:M}}=r.appContext,s=E.get(h);let D;return s?D=s:!b.length&&!p&&!y?D=h:(D={},b.length&&b.forEach(V=>Nf(D,V,M,!0)),Nf(D,h,M)),vn(h)&&E.set(h,D),D}function Nf(r,h,p,y=!1){const{mixins:b,extends:E}=h;E&&Nf(r,E,p,!0),b&&b.forEach(M=>Nf(r,M,p,!0));for(const M in h)if(!(y&&M==="expose")){const s=RE[M]||p&&p[M];r[M]=s?s(r[M],h[M]):h[M]}return r}const RE={data:dx,props:nl,emits:nl,methods:nl,computed:nl,beforeCreate:br,created:br,beforeMount:br,mounted:br,beforeUpdate:br,updated:br,beforeDestroy:br,beforeUnmount:br,destroyed:br,unmounted:br,activated:br,deactivated:br,errorCaptured:br,serverPrefetch:br,components:nl,directives:nl,watch:OE,provide:dx,inject:FE};function dx(r,h){return h?r?function(){return or(Ei(r)?r.call(this,this):r,Ei(h)?h.call(this,this):h)}:h:r}function FE(r,h){return nl(x_(r),x_(h))}function x_(r){if(vi(r)){const h={};for(let p=0;p<r.length;p++)h[r[p]]=r[p];return h}return r}function br(r,h){return r?[...new Set([].concat(r,h))]:h}function nl(r,h){return r?or(or(Object.create(null),r),h):h}function OE(r,h){if(!r)return h;if(!h)return r;const p=or(Object.create(null),r);for(const y in h)p[y]=br(r[y],h[y]);return p}function VE(r,h,p,y=!1){const b={},E={};Rf(E,cp,1),r.propsDefaults=Object.create(null),T1(r,h,b,E);for(const M in r.propsOptions[0])M in b||(b[M]=void 0);p?r.props=y?b:rE(b):r.type.props?r.props=b:r.props=E,r.attrs=E}function UE(r,h,p,y){const{props:b,attrs:E,vnode:{patchFlag:M}}=r,s=Li(b),[D]=r.propsOptions;let V=!1;if((y||M>0)&&!(M&16)){if(M&8){const N=r.vnode.dynamicProps;for(let U=0;U<N.length;U++){let q=N[U];if(op(r.emitsOptions,q))continue;const Y=h[q];if(D)if(Ui(E,q))Y!==E[q]&&(E[q]=Y,V=!0);else{const _e=Cc(q);b[_e]=b_(D,s,_e,Y,r,!1)}else Y!==E[q]&&(E[q]=Y,V=!0)}}}else{T1(r,h,b,E)&&(V=!0);let N;for(const U in s)(!h||!Ui(h,U)&&((N=zc(U))===U||!Ui(h,N)))&&(D?p&&(p[U]!==void 0||p[N]!==void 0)&&(b[U]=b_(D,s,U,void 0,r,!0)):delete b[U]);if(E!==s)for(const U in E)(!h||!Ui(h,U)&&!0)&&(delete E[U],V=!0)}V&&_s(r,"set","$attrs")}function T1(r,h,p,y){const[b,E]=r.propsOptions;let M=!1,s;if(h)for(let D in h){if(kf(D))continue;const V=h[D];let N;b&&Ui(b,N=Cc(D))?!E||!E.includes(N)?p[N]=V:(s||(s={}))[N]=V:op(r.emitsOptions,D)||(!(D in y)||V!==y[D])&&(y[D]=V,M=!0)}if(E){const D=Li(p),V=s||cn;for(let N=0;N<E.length;N++){const U=E[N];p[U]=b_(b,D,U,V[U],r,!Ui(V,U))}}return M}function b_(r,h,p,y,b,E){const M=r[p];if(M!=null){const s=Ui(M,"default");if(s&&y===void 0){const D=M.default;if(M.type!==Function&&Ei(D)){const{propsDefaults:V}=b;p in V?y=V[p]:(Ic(b),y=V[p]=D.call(null,h),hl())}else y=D}M[0]&&(E&&!s?y=!1:M[1]&&(y===""||y===zc(p))&&(y=!0))}return y}function E1(r,h,p=!1){const y=h.propsCache,b=y.get(r);if(b)return b;const E=r.props,M={},s=[];let D=!1;if(!Ei(r)){const N=U=>{D=!0;const[q,Y]=E1(U,h,!0);or(M,q),Y&&s.push(...Y)};!p&&h.mixins.length&&h.mixins.forEach(N),r.extends&&N(r.extends),r.mixins&&r.mixins.forEach(N)}if(!E&&!D)return vn(r)&&y.set(r,xc),xc;if(vi(E))for(let N=0;N<E.length;N++){const U=Cc(E[N]);fx(U)&&(M[U]=cn)}else if(E)for(const N in E){const U=Cc(N);if(fx(U)){const q=E[N],Y=M[U]=vi(q)||Ei(q)?{type:q}:q;if(Y){const _e=_x(Boolean,Y.type),ve=_x(String,Y.type);Y[0]=_e>-1,Y[1]=ve<0||_e<ve,(_e>-1||Ui(Y,"default"))&&s.push(U)}}}const V=[M,s];return vn(r)&&y.set(r,V),V}function fx(r){return r[0]!=="$"}function px(r){const h=r&&r.toString().match(/^\s*function (\w+)/);return h?h[1]:r===null?"null":""}function mx(r,h){return px(r)===px(h)}function _x(r,h){return vi(h)?h.findIndex(p=>mx(p,r)):Ei(h)&&mx(h,r)?0:-1}const S1=r=>r[0]==="_"||r==="$stable",ng=r=>vi(r)?r.map(No):[No(r)],NE=(r,h,p)=>{if(h._n)return h;const y=Ln((...b)=>ng(h(...b)),p);return y._c=!1,y},C1=(r,h,p)=>{const y=r._ctx;for(const b in r){if(S1(b))continue;const E=r[b];if(Ei(E))h[b]=NE(b,E,y);else if(E!=null){const M=ng(E);h[b]=()=>M}}},A1=(r,h)=>{const p=ng(h);r.slots.default=()=>p},jE=(r,h)=>{if(r.vnode.shapeFlag&32){const p=h._;p?(r.slots=Li(h),Rf(h,"_",p)):C1(h,r.slots={})}else r.slots={},h&&A1(r,h);Rf(r.slots,cp,1)},qE=(r,h,p)=>{const{vnode:y,slots:b}=r;let E=!0,M=cn;if(y.shapeFlag&32){const s=h._;s?p&&s===1?E=!1:(or(b,h),!p&&s===1&&delete b._):(E=!h.$stable,C1(h,b)),M=h}else h&&(A1(r,h),M={default:1});if(E)for(const s in b)!S1(s)&&!(s in M)&&delete b[s]};function M1(){return{app:null,config:{isNativeTag:E2,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let $E=0;function GE(r,h){return function(y,b=null){Ei(y)||(y=Object.assign({},y)),b!=null&&!vn(b)&&(b=null);const E=M1(),M=new Set;let s=!1;const D=E.app={_uid:$E++,_component:y,_props:b,_container:null,_context:E,_instance:null,version:hS,get config(){return E.config},set config(V){},use(V,...N){return M.has(V)||(V&&Ei(V.install)?(M.add(V),V.install(D,...N)):Ei(V)&&(M.add(V),V(D,...N))),D},mixin(V){return E.mixins.includes(V)||E.mixins.push(V),D},component(V,N){return N?(E.components[V]=N,D):E.components[V]},directive(V,N){return N?(E.directives[V]=N,D):E.directives[V]},mount(V,N,U){if(!s){const q=Ut(y,b);return q.appContext=E,N&&h?h(q,V):r(q,V,U),s=!0,D._container=V,V.__vue_app__=D,up(q.component)||q.component.proxy}},unmount(){s&&(r(null,D._container),delete D._container.__vue_app__)},provide(V,N){return E.provides[V]=N,D}};return D}}function w_(r,h,p,y,b=!1){if(vi(r)){r.forEach((q,Y)=>w_(q,h&&(vi(h)?h[Y]:h),p,y,b));return}if(bh(y)&&!b)return;const E=y.shapeFlag&4?up(y.component)||y.component.proxy:y.el,M=b?null:E,{i:s,r:D}=r,V=h&&h.r,N=s.refs===cn?s.refs={}:s.refs,U=s.setupState;if(V!=null&&V!==D&&(qn(V)?(N[V]=null,Ui(U,V)&&(U[V]=null)):pr(V)&&(V.value=null)),Ei(D))oa(D,s,12,[M,N]);else{const q=qn(D),Y=pr(D);if(q||Y){const _e=()=>{if(r.f){const ve=q?N[D]:D.value;b?vi(ve)&&O_(ve,E):vi(ve)?ve.includes(E)||ve.push(E):q?(N[D]=[E],Ui(U,D)&&(U[D]=N[D])):(D.value=[E],r.k&&(N[r.k]=D.value))}else q?(N[D]=M,Ui(U,D)&&(U[D]=M)):Y&&(D.value=M,r.k&&(N[r.k]=M))};M?(_e.id=-1,ir(_e,p)):_e()}}}const ir=xE;function ZE(r){return WE(r)}function WE(r,h){const p=k2();p.__VUE__=!0;const{insert:y,remove:b,patchProp:E,createElement:M,createText:s,createComment:D,setText:V,setElementText:N,parentNode:U,nextSibling:q,setScopeId:Y=vo,insertStaticContent:_e}=r,ve=(ue,Te,Be,ct=null,ut=null,bt=null,Mt=!1,gt=null,He=!!Te.dynamicChildren)=>{if(ue===Te)return;ue&&!ol(ue,Te)&&(ct=Yt(ue),xt(ue,ut,bt,!0),ue=null),Te.patchFlag===-2&&(He=!1,Te.dynamicChildren=null);const{type:ht,ref:qt,shapeFlag:Nt}=Te;switch(ht){case og:ze(ue,Te,Be,ct);break;case xo:Ye(ue,Te,Be,ct);break;case zf:ue==null&&we(Te,Be,ct,Mt);break;case wr:qe(ue,Te,Be,ct,ut,bt,Mt,gt,He);break;default:Nt&1?Se(ue,Te,Be,ct,ut,bt,Mt,gt,He):Nt&6?$e(ue,Te,Be,ct,ut,bt,Mt,gt,He):(Nt&64||Nt&128)&&ht.process(ue,Te,Be,ct,ut,bt,Mt,gt,He,Et)}qt!=null&&ut&&w_(qt,ue&&ue.ref,bt,Te||ue,!Te)},ze=(ue,Te,Be,ct)=>{if(ue==null)y(Te.el=s(Te.children),Be,ct);else{const ut=Te.el=ue.el;Te.children!==ue.children&&V(ut,Te.children)}},Ye=(ue,Te,Be,ct)=>{ue==null?y(Te.el=D(Te.children||""),Be,ct):Te.el=ue.el},we=(ue,Te,Be,ct)=>{[ue.el,ue.anchor]=_e(ue.children,Te,Be,ct,ue.el,ue.anchor)},Ue=({el:ue,anchor:Te},Be,ct)=>{let ut;for(;ue&&ue!==Te;)ut=q(ue),y(ue,Be,ct),ue=ut;y(Te,Be,ct)},Ge=({el:ue,anchor:Te})=>{let Be;for(;ue&&ue!==Te;)Be=q(ue),b(ue),ue=Be;b(Te)},Se=(ue,Te,Be,ct,ut,bt,Mt,gt,He)=>{Mt=Mt||Te.type==="svg",ue==null?De(Te,Be,ct,ut,bt,Mt,gt,He):Xe(ue,Te,ut,bt,Mt,gt,He)},De=(ue,Te,Be,ct,ut,bt,Mt,gt)=>{let He,ht;const{type:qt,props:Nt,shapeFlag:Zt,transition:ti,dirs:mi}=ue;if(He=ue.el=M(ue.type,bt,Nt&&Nt.is,Nt),Zt&8?N(He,ue.children):Zt&16&&Pe(ue.children,He,null,ct,ut,bt&&qt!=="foreignObject",Mt,gt),mi&&Qa(ue,null,ct,"created"),Nt){for(const si in Nt)si!=="value"&&!kf(si)&&E(He,si,null,Nt[si],bt,ue.children,ct,ut,Kt);"value"in Nt&&E(He,"value",null,Nt.value),(ht=Nt.onVnodeBeforeMount)&&Yr(ht,ct,ue)}be(He,ue,ue.scopeId,Mt,ct),mi&&Qa(ue,null,ct,"beforeMount");const zi=(!ut||ut&&!ut.pendingBranch)&&ti&&!ti.persisted;zi&&ti.beforeEnter(He),y(He,Te,Be),((ht=Nt&&Nt.onVnodeMounted)||zi||mi)&&ir(()=>{ht&&Yr(ht,ct,ue),zi&&ti.enter(He),mi&&Qa(ue,null,ct,"mounted")},ut)},be=(ue,Te,Be,ct,ut)=>{if(Be&&Y(ue,Be),ct)for(let bt=0;bt<ct.length;bt++)Y(ue,ct[bt]);if(ut){let bt=ut.subTree;if(Te===bt){const Mt=ut.vnode;be(ue,Mt,Mt.scopeId,Mt.slotScopeIds,ut.parent)}}},Pe=(ue,Te,Be,ct,ut,bt,Mt,gt,He=0)=>{for(let ht=He;ht<ue.length;ht++){const qt=ue[ht]=gt?ta(ue[ht]):No(ue[ht]);ve(null,qt,Te,Be,ct,ut,bt,Mt,gt)}},Xe=(ue,Te,Be,ct,ut,bt,Mt)=>{const gt=Te.el=ue.el;let{patchFlag:He,dynamicChildren:ht,dirs:qt}=Te;He|=ue.patchFlag&16;const Nt=ue.props||cn,Zt=Te.props||cn;let ti;Be&&el(Be,!1),(ti=Zt.onVnodeBeforeUpdate)&&Yr(ti,Be,Te,ue),qt&&Qa(Te,ue,Be,"beforeUpdate"),Be&&el(Be,!0);const mi=ut&&Te.type!=="foreignObject";if(ht?Ve(ue.dynamicChildren,ht,gt,Be,ct,mi,bt):Mt||At(ue,Te,gt,null,Be,ct,mi,bt,!1),He>0){if(He&16)nt(gt,Te,Nt,Zt,Be,ct,ut);else if(He&2&&Nt.class!==Zt.class&&E(gt,"class",null,Zt.class,ut),He&4&&E(gt,"style",Nt.style,Zt.style,ut),He&8){const zi=Te.dynamicProps;for(let si=0;si<zi.length;si++){const Ci=zi[si],un=Nt[Ci],_r=Zt[Ci];(_r!==un||Ci==="value")&&E(gt,Ci,un,_r,ut,ue.children,Be,ct,Kt)}}He&1&&ue.children!==Te.children&&N(gt,Te.children)}else!Mt&&ht==null&&nt(gt,Te,Nt,Zt,Be,ct,ut);((ti=Zt.onVnodeUpdated)||qt)&&ir(()=>{ti&&Yr(ti,Be,Te,ue),qt&&Qa(Te,ue,Be,"updated")},ct)},Ve=(ue,Te,Be,ct,ut,bt,Mt)=>{for(let gt=0;gt<Te.length;gt++){const He=ue[gt],ht=Te[gt],qt=He.el&&(He.type===wr||!ol(He,ht)||He.shapeFlag&70)?U(He.el):Be;ve(He,ht,qt,null,ct,ut,bt,Mt,!0)}},nt=(ue,Te,Be,ct,ut,bt,Mt)=>{if(Be!==ct){if(Be!==cn)for(const gt in Be)!kf(gt)&&!(gt in ct)&&E(ue,gt,Be[gt],null,Mt,Te.children,ut,bt,Kt);for(const gt in ct){if(kf(gt))continue;const He=ct[gt],ht=Be[gt];He!==ht&&gt!=="value"&&E(ue,gt,ht,He,Mt,Te.children,ut,bt,Kt)}"value"in ct&&E(ue,"value",Be.value,ct.value)}},qe=(ue,Te,Be,ct,ut,bt,Mt,gt,He)=>{const ht=Te.el=ue?ue.el:s(""),qt=Te.anchor=ue?ue.anchor:s("");let{patchFlag:Nt,dynamicChildren:Zt,slotScopeIds:ti}=Te;ti&&(gt=gt?gt.concat(ti):ti),ue==null?(y(ht,Be,ct),y(qt,Be,ct),Pe(Te.children,Be,qt,ut,bt,Mt,gt,He)):Nt>0&&Nt&64&&Zt&&ue.dynamicChildren?(Ve(ue.dynamicChildren,Zt,Be,ut,bt,Mt,gt),(Te.key!=null||ut&&Te===ut.subTree)&&rg(ue,Te,!0)):At(ue,Te,Be,qt,ut,bt,Mt,gt,He)},$e=(ue,Te,Be,ct,ut,bt,Mt,gt,He)=>{Te.slotScopeIds=gt,ue==null?Te.shapeFlag&512?ut.ctx.activate(Te,Be,ct,Mt,He):Ke(Te,Be,ct,ut,bt,Mt,He):Ft(ue,Te,He)},Ke=(ue,Te,Be,ct,ut,bt,Mt)=>{const gt=ue.component=oS(ue,ct,ut);if(sp(ue)&&(gt.ctx.renderer=Et),sS(gt),gt.asyncDep){if(ut&&ut.registerDep(gt,Ht),!ue.el){const He=gt.subTree=Ut(xo);Ye(null,He,Te,Be)}return}Ht(gt,ue,Te,Be,ut,bt,Mt)},Ft=(ue,Te,Be)=>{const ct=Te.component=ue.component;if(yE(ue,Te,Be))if(ct.asyncDep&&!ct.asyncResolved){ot(ct,Te,Be);return}else ct.next=Te,dE(ct.update),ct.update();else Te.el=ue.el,ct.vnode=Te},Ht=(ue,Te,Be,ct,ut,bt,Mt)=>{const gt=()=>{if(ue.isMounted){let{next:qt,bu:Nt,u:Zt,parent:ti,vnode:mi}=ue,zi=qt,si;el(ue,!1),qt?(qt.el=mi.el,ot(ue,qt,Mt)):qt=mi,Nt&&xh(Nt),(si=qt.props&&qt.props.onVnodeBeforeUpdate)&&Yr(si,ti,qt,mi),el(ue,!0);const Ci=Hm(ue),un=ue.subTree;ue.subTree=Ci,ve(un,Ci,U(un.el),Yt(un),ue,ut,bt),qt.el=Ci.el,zi===null&&vE(ue,Ci.el),Zt&&ir(Zt,ut),(si=qt.props&&qt.props.onVnodeUpdated)&&ir(()=>Yr(si,ti,qt,mi),ut)}else{let qt;const{el:Nt,props:Zt}=Te,{bm:ti,m:mi,parent:zi}=ue,si=bh(Te);if(el(ue,!1),ti&&xh(ti),!si&&(qt=Zt&&Zt.onVnodeBeforeMount)&&Yr(qt,zi,Te),el(ue,!0),Nt&&xn){const Ci=()=>{ue.subTree=Hm(ue),xn(Nt,ue.subTree,ue,ut,null)};si?Te.type.__asyncLoader().then(()=>!ue.isUnmounted&&Ci()):Ci()}else{const Ci=ue.subTree=Hm(ue);ve(null,Ci,Be,ct,ue,ut,bt),Te.el=Ci.el}if(mi&&ir(mi,ut),!si&&(qt=Zt&&Zt.onVnodeMounted)){const Ci=Te;ir(()=>Yr(qt,zi,Ci),ut)}(Te.shapeFlag&256||zi&&bh(zi.vnode)&&zi.vnode.shapeFlag&256)&&ue.a&&ir(ue.a,ut),ue.isMounted=!0,Te=Be=ct=null}},He=ue.effect=new j_(gt,()=>K_(ht),ue.scope),ht=ue.update=()=>He.run();ht.id=ue.uid,el(ue,!0),ht()},ot=(ue,Te,Be)=>{Te.component=ue;const ct=ue.vnode.props;ue.vnode=Te,ue.next=null,UE(ue,Te.props,ct,Be),qE(ue,Te.children,Be),Pc(),ax(),Dc()},At=(ue,Te,Be,ct,ut,bt,Mt,gt,He=!1)=>{const ht=ue&&ue.children,qt=ue?ue.shapeFlag:0,Nt=Te.children,{patchFlag:Zt,shapeFlag:ti}=Te;if(Zt>0){if(Zt&128){Fe(ht,Nt,Be,ct,ut,bt,Mt,gt,He);return}else if(Zt&256){di(ht,Nt,Be,ct,ut,bt,Mt,gt,He);return}}ti&8?(qt&16&&Kt(ht,ut,bt),Nt!==ht&&N(Be,Nt)):qt&16?ti&16?Fe(ht,Nt,Be,ct,ut,bt,Mt,gt,He):Kt(ht,ut,bt,!0):(qt&8&&N(Be,""),ti&16&&Pe(Nt,Be,ct,ut,bt,Mt,gt,He))},di=(ue,Te,Be,ct,ut,bt,Mt,gt,He)=>{ue=ue||xc,Te=Te||xc;const ht=ue.length,qt=Te.length,Nt=Math.min(ht,qt);let Zt;for(Zt=0;Zt<Nt;Zt++){const ti=Te[Zt]=He?ta(Te[Zt]):No(Te[Zt]);ve(ue[Zt],ti,Be,null,ut,bt,Mt,gt,He)}ht>qt?Kt(ue,ut,bt,!0,!1,Nt):Pe(Te,Be,ct,ut,bt,Mt,gt,He,Nt)},Fe=(ue,Te,Be,ct,ut,bt,Mt,gt,He)=>{let ht=0;const qt=Te.length;let Nt=ue.length-1,Zt=qt-1;for(;ht<=Nt&&ht<=Zt;){const ti=ue[ht],mi=Te[ht]=He?ta(Te[ht]):No(Te[ht]);if(ol(ti,mi))ve(ti,mi,Be,null,ut,bt,Mt,gt,He);else break;ht++}for(;ht<=Nt&&ht<=Zt;){const ti=ue[Nt],mi=Te[Zt]=He?ta(Te[Zt]):No(Te[Zt]);if(ol(ti,mi))ve(ti,mi,Be,null,ut,bt,Mt,gt,He);else break;Nt--,Zt--}if(ht>Nt){if(ht<=Zt){const ti=Zt+1,mi=ti<qt?Te[ti].el:ct;for(;ht<=Zt;)ve(null,Te[ht]=He?ta(Te[ht]):No(Te[ht]),Be,mi,ut,bt,Mt,gt,He),ht++}}else if(ht>Zt)for(;ht<=Nt;)xt(ue[ht],ut,bt,!0),ht++;else{const ti=ht,mi=ht,zi=new Map;for(ht=mi;ht<=Zt;ht++){const _n=Te[ht]=He?ta(Te[ht]):No(Te[ht]);_n.key!=null&&zi.set(_n.key,ht)}let si,Ci=0;const un=Zt-mi+1;let _r=!1,En=0;const In=new Array(un);for(ht=0;ht<un;ht++)In[ht]=0;for(ht=ti;ht<=Nt;ht++){const _n=ue[ht];if(Ci>=un){xt(_n,ut,bt,!0);continue}let kn;if(_n.key!=null)kn=zi.get(_n.key);else for(si=mi;si<=Zt;si++)if(In[si-mi]===0&&ol(_n,Te[si])){kn=si;break}kn===void 0?xt(_n,ut,bt,!0):(In[kn-mi]=ht+1,kn>=En?En=kn:_r=!0,ve(_n,Te[kn],Be,null,ut,bt,Mt,gt,He),Ci++)}const qr=_r?HE(In):xc;for(si=qr.length-1,ht=un-1;ht>=0;ht--){const _n=mi+ht,kn=Te[_n],Pr=_n+1<qt?Te[_n+1].el:ct;In[ht]===0?ve(null,kn,Be,Pr,ut,bt,Mt,gt,He):_r&&(si<0||ht!==qr[si]?_t(kn,Be,Pr,2):si--)}}},_t=(ue,Te,Be,ct,ut=null)=>{const{el:bt,type:Mt,transition:gt,children:He,shapeFlag:ht}=ue;if(ht&6){_t(ue.component.subTree,Te,Be,ct);return}if(ht&128){ue.suspense.move(Te,Be,ct);return}if(ht&64){Mt.move(ue,Te,Be,Et);return}if(Mt===wr){y(bt,Te,Be);for(let Nt=0;Nt<He.length;Nt++)_t(He[Nt],Te,Be,ct);y(ue.anchor,Te,Be);return}if(Mt===zf){Ue(ue,Te,Be);return}if(ct!==2&&ht&1&&gt)if(ct===0)gt.beforeEnter(bt),y(bt,Te,Be),ir(()=>gt.enter(bt),ut);else{const{leave:Nt,delayLeave:Zt,afterLeave:ti}=gt,mi=()=>y(bt,Te,Be),zi=()=>{Nt(bt,()=>{mi(),ti&&ti()})};Zt?Zt(bt,mi,zi):zi()}else y(bt,Te,Be)},xt=(ue,Te,Be,ct=!1,ut=!1)=>{const{type:bt,props:Mt,ref:gt,children:He,dynamicChildren:ht,shapeFlag:qt,patchFlag:Nt,dirs:Zt}=ue;if(gt!=null&&w_(gt,null,Be,ue,!0),qt&256){Te.ctx.deactivate(ue);return}const ti=qt&1&&Zt,mi=!bh(ue);let zi;if(mi&&(zi=Mt&&Mt.onVnodeBeforeUnmount)&&Yr(zi,Te,ue),qt&6)Si(ue.component,Be,ct);else{if(qt&128){ue.suspense.unmount(Be,ct);return}ti&&Qa(ue,null,Te,"beforeUnmount"),qt&64?ue.type.remove(ue,Te,Be,ut,Et,ct):ht&&(bt!==wr||Nt>0&&Nt&64)?Kt(ht,Te,Be,!1,!0):(bt===wr&&Nt&384||!ut&&qt&16)&&Kt(He,Te,Be),ct&&Lt(ue)}(mi&&(zi=Mt&&Mt.onVnodeUnmounted)||ti)&&ir(()=>{zi&&Yr(zi,Te,ue),ti&&Qa(ue,null,Te,"unmounted")},Be)},Lt=ue=>{const{type:Te,el:Be,anchor:ct,transition:ut}=ue;if(Te===wr){pi(Be,ct);return}if(Te===zf){Ge(ue);return}const bt=()=>{b(Be),ut&&!ut.persisted&&ut.afterLeave&&ut.afterLeave()};if(ue.shapeFlag&1&&ut&&!ut.persisted){const{leave:Mt,delayLeave:gt}=ut,He=()=>Mt(Be,bt);gt?gt(ue.el,bt,He):He()}else bt()},pi=(ue,Te)=>{let Be;for(;ue!==Te;)Be=q(ue),b(ue),ue=Be;b(Te)},Si=(ue,Te,Be)=>{const{bum:ct,scope:ut,update:bt,subTree:Mt,um:gt}=ue;ct&&xh(ct),ut.stop(),bt&&(bt.active=!1,xt(Mt,ue,Te,Be)),gt&&ir(gt,Te),ir(()=>{ue.isUnmounted=!0},Te),Te&&Te.pendingBranch&&!Te.isUnmounted&&ue.asyncDep&&!ue.asyncResolved&&ue.suspenseId===Te.pendingId&&(Te.deps--,Te.deps===0&&Te.resolve())},Kt=(ue,Te,Be,ct=!1,ut=!1,bt=0)=>{for(let Mt=bt;Mt<ue.length;Mt++)xt(ue[Mt],Te,Be,ct,ut)},Yt=ue=>ue.shapeFlag&6?Yt(ue.component.subTree):ue.shapeFlag&128?ue.suspense.next():q(ue.anchor||ue.el),Jt=(ue,Te,Be)=>{ue==null?Te._vnode&&xt(Te._vnode,null,null,!0):ve(Te._vnode||null,ue,Te,null,null,null,Be),ax(),h1(),Te._vnode=ue},Et={p:ve,um:xt,m:_t,r:Lt,mt:Ke,mc:Pe,pc:At,pbc:Ve,n:Yt,o:r};let Bi,xn;return h&&([Bi,xn]=h(Et)),{render:Jt,hydrate:Bi,createApp:GE(Jt,Bi)}}function el({effect:r,update:h},p){r.allowRecurse=h.allowRecurse=p}function rg(r,h,p=!1){const y=r.children,b=h.children;if(vi(y)&&vi(b))for(let E=0;E<y.length;E++){const M=y[E];let s=b[E];s.shapeFlag&1&&!s.dynamicChildren&&((s.patchFlag<=0||s.patchFlag===32)&&(s=b[E]=ta(b[E]),s.el=M.el),p||rg(M,s))}}function HE(r){const h=r.slice(),p=[0];let y,b,E,M,s;const D=r.length;for(y=0;y<D;y++){const V=r[y];if(V!==0){if(b=p[p.length-1],r[b]<V){h[y]=b,p.push(y);continue}for(E=0,M=p.length-1;E<M;)s=E+M>>1,r[p[s]]<V?E=s+1:M=s;V<r[p[E]]&&(E>0&&(h[y]=p[E-1]),p[E]=y)}}for(E=p.length,M=p[E-1];E-- >0;)p[E]=M,M=h[M];return p}const XE=r=>r.__isTeleport,wh=r=>r&&(r.disabled||r.disabled===""),gx=r=>typeof SVGElement<"u"&&r instanceof SVGElement,T_=(r,h)=>{const p=r&&r.to;return qn(p)?h?h(p):null:p},KE={__isTeleport:!0,process(r,h,p,y,b,E,M,s,D,V){const{mc:N,pc:U,pbc:q,o:{insert:Y,querySelector:_e,createText:ve,createComment:ze}}=V,Ye=wh(h.props);let{shapeFlag:we,children:Ue,dynamicChildren:Ge}=h;if(r==null){const Se=h.el=ve(""),De=h.anchor=ve("");Y(Se,p,y),Y(De,p,y);const be=h.target=T_(h.props,_e),Pe=h.targetAnchor=ve("");be&&(Y(Pe,be),M=M||gx(be));const Xe=(Ve,nt)=>{we&16&&N(Ue,Ve,nt,b,E,M,s,D)};Ye?Xe(p,De):be&&Xe(be,Pe)}else{h.el=r.el;const Se=h.anchor=r.anchor,De=h.target=r.target,be=h.targetAnchor=r.targetAnchor,Pe=wh(r.props),Xe=Pe?p:De,Ve=Pe?Se:be;if(M=M||gx(De),Ge?(q(r.dynamicChildren,Ge,Xe,b,E,M,s),rg(r,h,!0)):D||U(r,h,Xe,Ve,b,E,M,s,!1),Ye)Pe||bf(h,p,Se,V,1);else if((h.props&&h.props.to)!==(r.props&&r.props.to)){const nt=h.target=T_(h.props,_e);nt&&bf(h,nt,null,V,0)}else Pe&&bf(h,De,be,V,1)}},remove(r,h,p,y,{um:b,o:{remove:E}},M){const{shapeFlag:s,children:D,anchor:V,targetAnchor:N,target:U,props:q}=r;if(U&&E(N),(M||!wh(q))&&(E(V),s&16))for(let Y=0;Y<D.length;Y++){const _e=D[Y];b(_e,h,p,!0,!!_e.dynamicChildren)}},move:bf,hydrate:YE};function bf(r,h,p,{o:{insert:y},m:b},E=2){E===0&&y(r.targetAnchor,h,p);const{el:M,anchor:s,shapeFlag:D,children:V,props:N}=r,U=E===2;if(U&&y(M,h,p),(!U||wh(N))&&D&16)for(let q=0;q<V.length;q++)b(V[q],h,p,2);U&&y(s,h,p)}function YE(r,h,p,y,b,E,{o:{nextSibling:M,parentNode:s,querySelector:D}},V){const N=h.target=T_(h.props,D);if(N){const U=N._lpa||N.firstChild;if(h.shapeFlag&16)if(wh(h.props))h.anchor=V(M(r),h,s(r),p,y,b,E),h.targetAnchor=U;else{h.anchor=M(r);let q=U;for(;q;)if(q=M(q),q&&q.nodeType===8&&q.data==="teleport anchor"){h.targetAnchor=q,N._lpa=h.targetAnchor&&M(h.targetAnchor);break}V(U,h,N,p,y,b,E)}}return h.anchor&&M(h.anchor)}const JE=KE,wr=Symbol(void 0),og=Symbol(void 0),xo=Symbol(void 0),zf=Symbol(void 0),Th=[];let yo=null;function nr(r=!1){Th.push(yo=r?null:[])}function QE(){Th.pop(),yo=Th[Th.length-1]||null}let Ih=1;function yx(r){Ih+=r}function I1(r){return r.dynamicChildren=Ih>0?yo||xc:null,QE(),Ih>0&&yo&&yo.push(r),r}function la(r,h,p,y,b,E){return I1(ki(r,h,p,y,b,E,!0))}function ps(r,h,p,y,b){return I1(Ut(r,h,p,y,b,!0))}function jf(r){return r?r.__v_isVNode===!0:!1}function ol(r,h){return r.type===h.type&&r.key===h.key}const cp="__vInternal",k1=({key:r})=>r!=null?r:null,Pf=({ref:r,ref_key:h,ref_for:p})=>r!=null?qn(r)||pr(r)||Ei(r)?{i:go,r,k:h,f:!!p}:r:null;function ki(r,h=null,p=null,y=0,b=null,E=r===wr?0:1,M=!1,s=!1){const D={__v_isVNode:!0,__v_skip:!0,type:r,props:h,key:h&&k1(h),ref:h&&Pf(h),scopeId:p1,slotScopeIds:null,children:p,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:E,patchFlag:y,dynamicProps:b,dynamicChildren:null,appContext:null};return s?(sg(D,p),E&128&&r.normalize(D)):p&&(D.shapeFlag|=qn(p)?8:16),Ih>0&&!M&&yo&&(D.patchFlag>0||E&6)&&D.patchFlag!==32&&yo.push(D),D}const Ut=eS;function eS(r,h=null,p=null,y=0,b=null,E=!1){if((!r||r===PE)&&(r=xo),jf(r)){const s=gs(r,h,!0);return p&&sg(s,p),Ih>0&&!E&&yo&&(s.shapeFlag&6?yo[yo.indexOf(r)]=s:yo.push(s)),s.patchFlag|=-2,s}if(uS(r)&&(r=r.__vccOpts),h){h=tS(h);let{class:s,style:D}=h;s&&!qn(s)&&(h.class=R_(s)),vn(D)&&(r1(D)&&!vi(D)&&(D=or({},D)),h.style=B_(D))}const M=qn(r)?1:m1(r)?128:XE(r)?64:vn(r)?4:Ei(r)?2:0;return ki(r,h,p,y,b,M,E,!0)}function tS(r){return r?r1(r)||cp in r?or({},r):r:null}function gs(r,h,p=!1){const{props:y,ref:b,patchFlag:E,children:M}=r,s=h?iS(y||{},h):y;return{__v_isVNode:!0,__v_skip:!0,type:r.type,props:s,key:s&&k1(s),ref:h&&h.ref?p&&b?vi(b)?b.concat(Pf(h)):[b,Pf(h)]:Pf(h):b,scopeId:r.scopeId,slotScopeIds:r.slotScopeIds,children:M,target:r.target,targetAnchor:r.targetAnchor,staticCount:r.staticCount,shapeFlag:r.shapeFlag,patchFlag:h&&r.type!==wr?E===-1?16:E|16:E,dynamicProps:r.dynamicProps,dynamicChildren:r.dynamicChildren,appContext:r.appContext,dirs:r.dirs,transition:r.transition,component:r.component,suspense:r.suspense,ssContent:r.ssContent&&gs(r.ssContent),ssFallback:r.ssFallback&&gs(r.ssFallback),el:r.el,anchor:r.anchor}}function Mc(r=" ",h=0){return Ut(og,null,r,h)}function z1(r,h){const p=Ut(zf,null,r);return p.staticCount=h,p}function fc(r="",h=!1){return h?(nr(),ps(xo,null,r)):Ut(xo,null,r)}function No(r){return r==null||typeof r=="boolean"?Ut(xo):vi(r)?Ut(wr,null,r.slice()):typeof r=="object"?ta(r):Ut(og,null,String(r))}function ta(r){return r.el===null&&r.patchFlag!==-1||r.memo?r:gs(r)}function sg(r,h){let p=0;const{shapeFlag:y}=r;if(h==null)h=null;else if(vi(h))p=16;else if(typeof h=="object")if(y&65){const b=h.default;b&&(b._c&&(b._d=!1),sg(r,b()),b._c&&(b._d=!0));return}else{p=32;const b=h._;!b&&!(cp in h)?h._ctx=go:b===3&&go&&(go.slots._===1?h._=1:(h._=2,r.patchFlag|=1024))}else Ei(h)?(h={default:h,_ctx:go},p=32):(h=String(h),y&64?(p=16,h=[Mc(h)]):p=8);r.children=h,r.shapeFlag|=p}function iS(...r){const h={};for(let p=0;p<r.length;p++){const y=r[p];for(const b in y)if(b==="class")h.class!==y.class&&(h.class=R_([h.class,y.class]));else if(b==="style")h.style=B_([h.style,y.style]);else if(Qf(b)){const E=h[b],M=y[b];M&&E!==M&&!(vi(E)&&E.includes(M))&&(h[b]=E?[].concat(E,M):M)}else b!==""&&(h[b]=y[b])}return h}function Yr(r,h,p,y=null){Qr(r,h,7,[p,y])}const nS=M1();let rS=0;function oS(r,h,p){const y=r.type,b=(h?h.appContext:r.appContext)||nS,E={uid:rS++,vnode:r,type:y,parent:h,appContext:b,root:null,next:null,subTree:null,effect:null,update:null,scope:new z2(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:h?h.provides:Object.create(b.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:E1(y,b),emitsOptions:f1(y,b),emit:null,emitted:null,propsDefaults:cn,inheritAttrs:y.inheritAttrs,ctx:cn,data:cn,props:cn,attrs:cn,slots:cn,refs:cn,setupState:cn,setupContext:null,suspense:p,suspenseId:p?p.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return E.ctx={_:E},E.root=h?h.root:E,E.emit=mE.bind(null,E),r.ce&&r.ce(E),E}let rr=null;const Vi=()=>rr||go,Ic=r=>{rr=r,r.scope.on()},hl=()=>{rr&&rr.scope.off(),rr=null};function P1(r){return r.vnode.shapeFlag&4}let kh=!1;function sS(r,h=!1){kh=h;const{props:p,children:y}=r.vnode,b=P1(r);VE(r,p,b,h),jE(r,y);const E=b?aS(r,h):void 0;return kh=!1,E}function aS(r,h){const p=r.type;r.accessCache=Object.create(null),r.proxy=np(new Proxy(r.ctx,DE));const{setup:y}=p;if(y){const b=r.setupContext=y.length>1?cS(r):null;Ic(r),Pc();const E=oa(y,r,0,[r.props,b]);if(Dc(),hl(),j0(E)){if(E.then(hl,hl),h)return E.then(M=>{vx(r,M,h)}).catch(M=>{rp(M,r,0)});r.asyncDep=E}else vx(r,E,h)}else D1(r,h)}function vx(r,h,p){Ei(h)?r.type.__ssrInlineRender?r.ssrRender=h:r.render=h:vn(h)&&(r.setupState=a1(h)),D1(r,p)}let xx;function D1(r,h,p){const y=r.type;if(!r.render){if(!h&&xx&&!y.render){const b=y.template||ig(r).template;if(b){const{isCustomElement:E,compilerOptions:M}=r.appContext.config,{delimiters:s,compilerOptions:D}=y,V=or(or({isCustomElement:E,delimiters:s},M),D);y.render=xx(b,V)}}r.render=y.render||vo}Ic(r),Pc(),LE(r),Dc(),hl()}function lS(r){return new Proxy(r.attrs,{get(h,p){return jr(r,"get","$attrs"),h[p]}})}function cS(r){const h=y=>{r.exposed=y||{}};let p;return{get attrs(){return p||(p=lS(r))},slots:r.slots,emit:r.emit,expose:h}}function up(r){if(r.exposed)return r.exposeProxy||(r.exposeProxy=new Proxy(a1(np(r.exposed)),{get(h,p){if(p in h)return h[p];if(p in Uf)return Uf[p](r)}}))}function bx(r,h=!0){return Ei(r)?r.displayName||r.name:r.name||h&&r.__name}function uS(r){return Ei(r)&&"__vccOpts"in r}const xe=(r,h)=>cE(r,h,kh);function ke(r,h,p){const y=arguments.length;return y===2?vn(h)&&!vi(h)?jf(h)?Ut(r,null,[h]):Ut(r,h):Ut(r,null,h):(y>3?p=Array.prototype.slice.call(arguments,2):y===3&&jf(p)&&(p=[p]),Ut(r,h,p))}const hS="3.2.40",dS="http://www.w3.org/2000/svg",sl=typeof document<"u"?document:null,wx=sl&&sl.createElement("template"),fS={insert:(r,h,p)=>{h.insertBefore(r,p||null)},remove:r=>{const h=r.parentNode;h&&h.removeChild(r)},createElement:(r,h,p,y)=>{const b=h?sl.createElementNS(dS,r):sl.createElement(r,p?{is:p}:void 0);return r==="select"&&y&&y.multiple!=null&&b.setAttribute("multiple",y.multiple),b},createText:r=>sl.createTextNode(r),createComment:r=>sl.createComment(r),setText:(r,h)=>{r.nodeValue=h},setElementText:(r,h)=>{r.textContent=h},parentNode:r=>r.parentNode,nextSibling:r=>r.nextSibling,querySelector:r=>sl.querySelector(r),setScopeId(r,h){r.setAttribute(h,"")},insertStaticContent(r,h,p,y,b,E){const M=p?p.previousSibling:h.lastChild;if(b&&(b===E||b.nextSibling))for(;h.insertBefore(b.cloneNode(!0),p),!(b===E||!(b=b.nextSibling)););else{wx.innerHTML=y?`<svg>${r}</svg>`:r;const s=wx.content;if(y){const D=s.firstChild;for(;D.firstChild;)s.appendChild(D.firstChild);s.removeChild(D)}h.insertBefore(s,p)}return[M?M.nextSibling:h.firstChild,p?p.previousSibling:h.lastChild]}};function pS(r,h,p){const y=r._vtc;y&&(h=(h?[h,...y]:[...y]).join(" ")),h==null?r.removeAttribute("class"):p?r.setAttribute("class",h):r.className=h}function mS(r,h,p){const y=r.style,b=qn(p);if(p&&!b){for(const E in p)E_(y,E,p[E]);if(h&&!qn(h))for(const E in h)p[E]==null&&E_(y,E,"")}else{const E=y.display;b?h!==p&&(y.cssText=p):h&&r.removeAttribute("style"),"_vod"in r&&(y.display=E)}}const Tx=/\s*!important$/;function E_(r,h,p){if(vi(p))p.forEach(y=>E_(r,h,y));else if(p==null&&(p=""),h.startsWith("--"))r.setProperty(h,p);else{const y=_S(r,h);Tx.test(p)?r.setProperty(zc(y),p.replace(Tx,""),"important"):r[y]=p}}const Ex=["Webkit","Moz","ms"],Jm={};function _S(r,h){const p=Jm[h];if(p)return p;let y=Cc(h);if(y!=="filter"&&y in r)return Jm[h]=y;y=G0(y);for(let b=0;b<Ex.length;b++){const E=Ex[b]+y;if(E in r)return Jm[h]=E}return h}const Sx="http://www.w3.org/1999/xlink";function gS(r,h,p,y,b){if(y&&h.startsWith("xlink:"))p==null?r.removeAttributeNS(Sx,h.slice(6,h.length)):r.setAttributeNS(Sx,h,p);else{const E=x2(h);p==null||E&&!V0(p)?r.removeAttribute(h):r.setAttribute(h,E?"":p)}}function yS(r,h,p,y,b,E,M){if(h==="innerHTML"||h==="textContent"){y&&M(y,b,E),r[h]=p==null?"":p;return}if(h==="value"&&r.tagName!=="PROGRESS"&&!r.tagName.includes("-")){r._value=p;const D=p==null?"":p;(r.value!==D||r.tagName==="OPTION")&&(r.value=D),p==null&&r.removeAttribute(h);return}let s=!1;if(p===""||p==null){const D=typeof r[h];D==="boolean"?p=V0(p):p==null&&D==="string"?(p="",s=!0):D==="number"&&(p=0,s=!0)}try{r[h]=p}catch{}s&&r.removeAttribute(h)}const[L1,vS]=(()=>{let r=Date.now,h=!1;if(typeof window<"u"){Date.now()>document.createEvent("Event").timeStamp&&(r=performance.now.bind(performance));const p=navigator.userAgent.match(/firefox\/(\d+)/i);h=!!(p&&Number(p[1])<=53)}return[r,h]})();let S_=0;const xS=Promise.resolve(),bS=()=>{S_=0},wS=()=>S_||(xS.then(bS),S_=L1());function TS(r,h,p,y){r.addEventListener(h,p,y)}function ES(r,h,p,y){r.removeEventListener(h,p,y)}function SS(r,h,p,y,b=null){const E=r._vei||(r._vei={}),M=E[h];if(y&&M)M.value=y;else{const[s,D]=CS(h);if(y){const V=E[h]=AS(y,b);TS(r,s,V,D)}else M&&(ES(r,s,M,D),E[h]=void 0)}}const Cx=/(?:Once|Passive|Capture)$/;function CS(r){let h;if(Cx.test(r)){h={};let y;for(;y=r.match(Cx);)r=r.slice(0,r.length-y[0].length),h[y[0].toLowerCase()]=!0}return[r[2]===":"?r.slice(3):zc(r.slice(2)),h]}function AS(r,h){const p=y=>{const b=y.timeStamp||L1();(vS||b>=p.attached-1)&&Qr(MS(y,p.value),h,5,[y])};return p.value=r,p.attached=wS(),p}function MS(r,h){if(vi(h)){const p=r.stopImmediatePropagation;return r.stopImmediatePropagation=()=>{p.call(r),r._stopped=!0},h.map(y=>b=>!b._stopped&&y&&y(b))}else return h}const Ax=/^on[a-z]/,IS=(r,h,p,y,b=!1,E,M,s,D)=>{h==="class"?pS(r,y,b):h==="style"?mS(r,p,y):Qf(h)?F_(h)||SS(r,h,p,y,M):(h[0]==="."?(h=h.slice(1),!0):h[0]==="^"?(h=h.slice(1),!1):kS(r,h,y,b))?yS(r,h,y,E,M,s,D):(h==="true-value"?r._trueValue=y:h==="false-value"&&(r._falseValue=y),gS(r,h,y,b))};function kS(r,h,p,y){return y?!!(h==="innerHTML"||h==="textContent"||h in r&&Ax.test(h)&&Ei(p)):h==="spellcheck"||h==="draggable"||h==="translate"||h==="form"||h==="list"&&r.tagName==="INPUT"||h==="type"&&r.tagName==="TEXTAREA"||Ax.test(h)&&qn(p)?!1:h in r}const Ys="transition",uh="animation",ys=(r,{slots:h})=>ke(y1,zS(r),h);ys.displayName="Transition";const B1={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};ys.props=or({},y1.props,B1);const tl=(r,h=[])=>{vi(r)?r.forEach(p=>p(...h)):r&&r(...h)},Mx=r=>r?vi(r)?r.some(h=>h.length>1):r.length>1:!1;function zS(r){const h={};for(const qe in r)qe in B1||(h[qe]=r[qe]);if(r.css===!1)return h;const{name:p="v",type:y,duration:b,enterFromClass:E=`${p}-enter-from`,enterActiveClass:M=`${p}-enter-active`,enterToClass:s=`${p}-enter-to`,appearFromClass:D=E,appearActiveClass:V=M,appearToClass:N=s,leaveFromClass:U=`${p}-leave-from`,leaveActiveClass:q=`${p}-leave-active`,leaveToClass:Y=`${p}-leave-to`}=r,_e=PS(b),ve=_e&&_e[0],ze=_e&&_e[1],{onBeforeEnter:Ye,onEnter:we,onEnterCancelled:Ue,onLeave:Ge,onLeaveCancelled:Se,onBeforeAppear:De=Ye,onAppear:be=we,onAppearCancelled:Pe=Ue}=h,Xe=(qe,$e,Ke)=>{il(qe,$e?N:s),il(qe,$e?V:M),Ke&&Ke()},Ve=(qe,$e)=>{qe._isLeaving=!1,il(qe,U),il(qe,Y),il(qe,q),$e&&$e()},nt=qe=>($e,Ke)=>{const Ft=qe?be:we,Ht=()=>Xe($e,qe,Ke);tl(Ft,[$e,Ht]),Ix(()=>{il($e,qe?D:E),Js($e,qe?N:s),Mx(Ft)||kx($e,y,ve,Ht)})};return or(h,{onBeforeEnter(qe){tl(Ye,[qe]),Js(qe,E),Js(qe,M)},onBeforeAppear(qe){tl(De,[qe]),Js(qe,D),Js(qe,V)},onEnter:nt(!1),onAppear:nt(!0),onLeave(qe,$e){qe._isLeaving=!0;const Ke=()=>Ve(qe,$e);Js(qe,U),BS(),Js(qe,q),Ix(()=>{!qe._isLeaving||(il(qe,U),Js(qe,Y),Mx(Ge)||kx(qe,y,ze,Ke))}),tl(Ge,[qe,Ke])},onEnterCancelled(qe){Xe(qe,!1),tl(Ue,[qe])},onAppearCancelled(qe){Xe(qe,!0),tl(Pe,[qe])},onLeaveCancelled(qe){Ve(qe),tl(Se,[qe])}})}function PS(r){if(r==null)return null;if(vn(r))return[Qm(r.enter),Qm(r.leave)];{const h=Qm(r);return[h,h]}}function Qm(r){return Z0(r)}function Js(r,h){h.split(/\s+/).forEach(p=>p&&r.classList.add(p)),(r._vtc||(r._vtc=new Set)).add(h)}function il(r,h){h.split(/\s+/).forEach(y=>y&&r.classList.remove(y));const{_vtc:p}=r;p&&(p.delete(h),p.size||(r._vtc=void 0))}function Ix(r){requestAnimationFrame(()=>{requestAnimationFrame(r)})}let DS=0;function kx(r,h,p,y){const b=r._endId=++DS,E=()=>{b===r._endId&&y()};if(p)return setTimeout(E,p);const{type:M,timeout:s,propCount:D}=LS(r,h);if(!M)return y();const V=M+"end";let N=0;const U=()=>{r.removeEventListener(V,q),E()},q=Y=>{Y.target===r&&++N>=D&&U()};setTimeout(()=>{N<D&&U()},s+1),r.addEventListener(V,q)}function LS(r,h){const p=window.getComputedStyle(r),y=_e=>(p[_e]||"").split(", "),b=y(Ys+"Delay"),E=y(Ys+"Duration"),M=zx(b,E),s=y(uh+"Delay"),D=y(uh+"Duration"),V=zx(s,D);let N=null,U=0,q=0;h===Ys?M>0&&(N=Ys,U=M,q=E.length):h===uh?V>0&&(N=uh,U=V,q=D.length):(U=Math.max(M,V),N=U>0?M>V?Ys:uh:null,q=N?N===Ys?E.length:D.length:0);const Y=N===Ys&&/\b(transform|all)(,|$)/.test(p[Ys+"Property"]);return{type:N,timeout:U,propCount:q,hasTransform:Y}}function zx(r,h){for(;r.length<h.length;)r=r.concat(r);return Math.max(...h.map((p,y)=>Px(p)+Px(r[y])))}function Px(r){return Number(r.slice(0,-1).replace(",","."))*1e3}function BS(){return document.body.offsetHeight}const RS=or({patchProp:IS},fS);let Dx;function FS(){return Dx||(Dx=ZE(RS))}const OS=(...r)=>{const h=FS().createApp(...r),{mount:p}=h;return h.mount=y=>{const b=VS(y);if(!b)return;const E=h._component;!Ei(E)&&!E.render&&!E.template&&(E.template=b.innerHTML),b.innerHTML="";const M=p(b,!1,b instanceof SVGElement);return b instanceof Element&&(b.removeAttribute("v-cloak"),b.setAttribute("data-v-app","")),M},h};function VS(r){return qn(r)?document.querySelector(r):r}function hp(r,h,p,y){return Object.defineProperty(r,h,{get:p,set:y,enumerable:!0}),r}const bo=Rt(!1);let dp;function US(r,h){const p=/(edg|edge|edga|edgios)\/([\w.]+)/.exec(r)||/(opr)[\/]([\w.]+)/.exec(r)||/(vivaldi)[\/]([\w.]+)/.exec(r)||/(chrome|crios)[\/]([\w.]+)/.exec(r)||/(version)(applewebkit)[\/]([\w.]+).*(safari)[\/]([\w.]+)/.exec(r)||/(webkit)[\/]([\w.]+).*(version)[\/]([\w.]+).*(safari)[\/]([\w.]+)/.exec(r)||/(firefox|fxios)[\/]([\w.]+)/.exec(r)||/(webkit)[\/]([\w.]+)/.exec(r)||/(opera)(?:.*version|)[\/]([\w.]+)/.exec(r)||[];return{browser:p[5]||p[3]||p[1]||"",version:p[2]||p[4]||"0",versionNumber:p[4]||p[2]||"0",platform:h[0]||""}}function NS(r){return/(ipad)/.exec(r)||/(ipod)/.exec(r)||/(windows phone)/.exec(r)||/(iphone)/.exec(r)||/(kindle)/.exec(r)||/(silk)/.exec(r)||/(android)/.exec(r)||/(win)/.exec(r)||/(mac)/.exec(r)||/(linux)/.exec(r)||/(cros)/.exec(r)||/(playbook)/.exec(r)||/(bb)/.exec(r)||/(blackberry)/.exec(r)||[]}const R1="ontouchstart"in window||window.navigator.maxTouchPoints>0;function jS(r){dp={is:{...r}},delete r.mac,delete r.desktop;const h=Math.min(window.innerHeight,window.innerWidth)>414?"ipad":"iphone";Object.assign(r,{mobile:!0,ios:!0,platform:h,[h]:!0})}function qS(r){const h=r.toLowerCase(),p=NS(h),y=US(h,p),b={};y.browser&&(b[y.browser]=!0,b.version=y.version,b.versionNumber=parseInt(y.versionNumber,10)),y.platform&&(b[y.platform]=!0);const E=b.android||b.ios||b.bb||b.blackberry||b.ipad||b.iphone||b.ipod||b.kindle||b.playbook||b.silk||b["windows phone"];return E===!0||h.indexOf("mobile")>-1?(b.mobile=!0,b.edga||b.edgios?(b.edge=!0,y.browser="edge"):b.crios?(b.chrome=!0,y.browser="chrome"):b.fxios&&(b.firefox=!0,y.browser="firefox")):b.desktop=!0,(b.ipod||b.ipad||b.iphone)&&(b.ios=!0),b["windows phone"]&&(b.winphone=!0,delete b["windows phone"]),(b.chrome||b.opr||b.safari||b.vivaldi||b.mobile===!0&&b.ios!==!0&&E!==!0)&&(b.webkit=!0),b.edg&&(y.browser="edgechromium",b.edgeChromium=!0),(b.safari&&b.blackberry||b.bb)&&(y.browser="blackberry",b.blackberry=!0),b.safari&&b.playbook&&(y.browser="playbook",b.playbook=!0),b.opr&&(y.browser="opera",b.opera=!0),b.safari&&b.android&&(y.browser="android",b.android=!0),b.safari&&b.kindle&&(y.browser="kindle",b.kindle=!0),b.safari&&b.silk&&(y.browser="silk",b.silk=!0),b.vivaldi&&(y.browser="vivaldi",b.vivaldi=!0),b.name=y.browser,b.platform=y.platform,h.indexOf("electron")>-1?b.electron=!0:document.location.href.indexOf("-extension://")>-1?b.bex=!0:(window.Capacitor!==void 0?(b.capacitor=!0,b.nativeMobile=!0,b.nativeMobileWrapper="capacitor"):(window._cordovaNative!==void 0||window.cordova!==void 0)&&(b.cordova=!0,b.nativeMobile=!0,b.nativeMobileWrapper="cordova"),R1===!0&&b.mac===!0&&(b.desktop===!0&&b.safari===!0||b.nativeMobile===!0&&b.android!==!0&&b.ios!==!0&&b.ipad!==!0)&&jS(b)),b}const Lx=navigator.userAgent||navigator.vendor||window.opera,$S={has:{touch:!1,webStorage:!1},within:{iframe:!1}},dn={userAgent:Lx,is:qS(Lx),has:{touch:R1},within:{iframe:window.self!==window.top}},qf={install(r){const{$q:h}=r;bo.value===!0?(r.onSSRHydrated.push(()=>{bo.value=!1,Object.assign(h.platform,dn),dp=void 0}),h.platform=$o(this)):h.platform=this}};{let r;hp(dn.has,"webStorage",()=>{if(r!==void 0)return r;try{if(window.localStorage)return r=!0,!0}catch{}return r=!1,!1}),dn.is.ios===!0&&window.navigator.vendor.toLowerCase().indexOf("apple"),bo.value===!0?Object.assign(qf,dn,dp,$S):Object.assign(qf,dn)}const fp=(r,h)=>{const p=$o(r);for(const y in r)hp(h,y,()=>p[y],b=>{p[y]=b});return h},Bn={hasPassive:!1,passiveCapture:!0,notPassiveCapture:!0};try{const r=Object.defineProperty({},"passive",{get(){Object.assign(Bn,{hasPassive:!0,passive:{passive:!0},notPassive:{passive:!1},passiveCapture:{passive:!0,capture:!0},notPassiveCapture:{passive:!1,capture:!0}})}});window.addEventListener("qtest",null,r),window.removeEventListener("qtest",null,r)}catch{}function Wo(){}function GS(r){return r.button===0}function $f(r){return r.touches&&r.touches[0]?r=r.touches[0]:r.changedTouches&&r.changedTouches[0]?r=r.changedTouches[0]:r.targetTouches&&r.targetTouches[0]&&(r=r.targetTouches[0]),{top:r.clientY,left:r.clientX}}function ZS(r){if(r.path)return r.path;if(r.composedPath)return r.composedPath();const h=[];let p=r.target;for(;p;){if(h.push(p),p.tagName==="HTML")return h.push(document),h.push(window),h;p=p.parentElement}}function jo(r){r.stopPropagation()}function Nr(r){r.cancelable!==!1&&r.preventDefault()}function Mn(r){r.cancelable!==!1&&r.preventDefault(),r.stopPropagation()}function e_(r,h){if(r===void 0||h===!0&&r.__dragPrevented===!0)return;const p=h===!0?y=>{y.__dragPrevented=!0,y.addEventListener("dragstart",Nr,Bn.notPassiveCapture)}:y=>{delete y.__dragPrevented,y.removeEventListener("dragstart",Nr,Bn.notPassiveCapture)};r.querySelectorAll("a, img").forEach(p)}function ll(r,h,p){const y=`__q_${h}_evt`;r[y]=r[y]!==void 0?r[y].concat(p):p,p.forEach(b=>{b[0].addEventListener(b[1],r[b[2]],Bn[b[3]])})}function Eh(r,h){const p=`__q_${h}_evt`;r[p]!==void 0&&(r[p].forEach(y=>{y[0].removeEventListener(y[1],r[y[2]],Bn[y[3]])}),r[p]=void 0)}function ag(r,h=250,p){let y;function b(){const E=arguments,M=()=>{y=void 0,p!==!0&&r.apply(this,E)};clearTimeout(y),p===!0&&y===void 0&&r.apply(this,E),y=setTimeout(M,h)}return b.cancel=()=>{clearTimeout(y)},b}const t_=["sm","md","lg","xl"],{passive:Bx}=Bn,WS=fp({width:0,height:0,name:"xs",sizes:{sm:600,md:1024,lg:1440,xl:1920},lt:{sm:!0,md:!0,lg:!0,xl:!0},gt:{xs:!1,sm:!1,md:!1,lg:!1},xs:!0,sm:!1,md:!1,lg:!1,xl:!1},{setSizes:Wo,setDebounce:Wo,install({$q:r,onSSRHydrated:h}){if(r.screen=this,this.__installed===!0){r.config.screen!==void 0&&(r.config.screen.bodyClasses===!1?document.body.classList.remove(`screen--${this.name}`):this.__update(!0));return}const{visualViewport:p}=window,y=p||window,b=document.scrollingElement||document.documentElement,E=p===void 0||dn.is.mobile===!0?()=>[Math.max(window.innerWidth,b.clientWidth),Math.max(window.innerHeight,b.clientHeight)]:()=>[p.width*p.scale+window.innerWidth-b.clientWidth,p.height*p.scale+window.innerHeight-b.clientHeight],M=r.config.screen!==void 0&&r.config.screen.bodyClasses===!0;this.__update=U=>{const[q,Y]=E();if(Y!==this.height&&(this.height=Y),q!==this.width)this.width=q;else if(U!==!0)return;let _e=this.sizes;this.gt.xs=q>=_e.sm,this.gt.sm=q>=_e.md,this.gt.md=q>=_e.lg,this.gt.lg=q>=_e.xl,this.lt.sm=q<_e.sm,this.lt.md=q<_e.md,this.lt.lg=q<_e.lg,this.lt.xl=q<_e.xl,this.xs=this.lt.sm,this.sm=this.gt.xs===!0&&this.lt.md===!0,this.md=this.gt.sm===!0&&this.lt.lg===!0,this.lg=this.gt.md===!0&&this.lt.xl===!0,this.xl=this.gt.lg,_e=this.xs===!0&&"xs"||this.sm===!0&&"sm"||this.md===!0&&"md"||this.lg===!0&&"lg"||"xl",_e!==this.name&&(M===!0&&(document.body.classList.remove(`screen--${this.name}`),document.body.classList.add(`screen--${_e}`)),this.name=_e)};let s,D={},V=16;this.setSizes=U=>{t_.forEach(q=>{U[q]!==void 0&&(D[q]=U[q])})},this.setDebounce=U=>{V=U};const N=()=>{const U=getComputedStyle(document.body);U.getPropertyValue("--q-size-sm")&&t_.forEach(q=>{this.sizes[q]=parseInt(U.getPropertyValue(`--q-size-${q}`),10)}),this.setSizes=q=>{t_.forEach(Y=>{q[Y]&&(this.sizes[Y]=q[Y])}),this.__update(!0)},this.setDebounce=q=>{s!==void 0&&y.removeEventListener("resize",s,Bx),s=q>0?ag(this.__update,q):this.__update,y.addEventListener("resize",s,Bx)},this.setDebounce(V),Object.keys(D).length>0?(this.setSizes(D),D=void 0):this.__update(),M===!0&&this.name==="xs"&&document.body.classList.add("screen--xs")};bo.value===!0?h.push(N):N()}}),dr=fp({isActive:!1,mode:!1},{__media:void 0,set(r){dr.mode=r,r==="auto"?(dr.__media===void 0&&(dr.__media=window.matchMedia("(prefers-color-scheme: dark)"),dr.__updateMedia=()=>{dr.set("auto")},dr.__media.addListener(dr.__updateMedia)),r=dr.__media.matches):dr.__media!==void 0&&(dr.__media.removeListener(dr.__updateMedia),dr.__media=void 0),dr.isActive=r===!0,document.body.classList.remove(`body--${r===!0?"light":"dark"}`),document.body.classList.add(`body--${r===!0?"dark":"light"}`)},toggle(){dr.set(dr.isActive===!1)},install({$q:r,onSSRHydrated:h,ssrContext:p}){const{dark:y}=r.config;if(r.dark=this,this.__installed===!0&&y===void 0)return;this.isActive=y===!0;const b=y!==void 0?y:!1;if(bo.value===!0){const E=s=>{this.__fromSSR=s},M=this.set;this.set=E,E(b),h.push(()=>{this.set=M,this.set(this.__fromSSR)})}else this.set(b)}}),F1=()=>!0;function HS(r){return typeof r=="string"&&r!==""&&r!=="/"&&r!=="#/"}function XS(r){return r.startsWith("#")===!0&&(r=r.substring(1)),r.startsWith("/")===!1&&(r="/"+r),r.endsWith("/")===!0&&(r=r.substring(0,r.length-1)),"#"+r}function KS(r){if(r.backButtonExit===!1)return()=>!1;if(r.backButtonExit==="*")return F1;const h=["#/"];return Array.isArray(r.backButtonExit)===!0&&h.push(...r.backButtonExit.filter(HS).map(XS)),()=>h.includes(window.location.hash)}const zh={__history:[],add:Wo,remove:Wo,install({$q:r}){if(this.__installed===!0)return;const{cordova:h,capacitor:p}=dn.is;if(h!==!0&&p!==!0)return;const y=r.config[h===!0?"cordova":"capacitor"];if(y!==void 0&&y.backButton===!1||p===!0&&(window.Capacitor===void 0||window.Capacitor.Plugins.App===void 0))return;this.add=M=>{M.condition===void 0&&(M.condition=F1),this.__history.push(M)},this.remove=M=>{const s=this.__history.indexOf(M);s>=0&&this.__history.splice(s,1)};const b=KS(Object.assign({backButtonExit:!0},y)),E=()=>{if(this.__history.length){const M=this.__history[this.__history.length-1];M.condition()===!0&&(this.__history.pop(),M.handler())}else b()===!0?navigator.app.exitApp():window.history.back()};h===!0?document.addEventListener("deviceready",()=>{document.addEventListener("backbutton",E,!1)}):window.Capacitor.Plugins.App.addListener("backButton",E)}},Rx={isoName:"en-US",nativeName:"English (US)",label:{clear:"Clear",ok:"OK",cancel:"Cancel",close:"Close",set:"Set",select:"Select",reset:"Reset",remove:"Remove",update:"Update",create:"Create",search:"Search",filter:"Filter",refresh:"Refresh",expand:r=>r?`Expand "${r}"`:"Expand",collapse:r=>r?`Collapse "${r}"`:"Collapse"},date:{days:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),daysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),firstDayOfWeek:0,format24h:!1,pluralDay:"days"},table:{noData:"No data available",noResults:"No matching records found",loading:"Loading...",selectedRecords:r=>r===1?"1 record selected.":(r===0?"No":r)+" records selected.",recordsPerPage:"Records per page:",allRows:"All",pagination:(r,h,p)=>r+"-"+h+" of "+p,columns:"Columns"},editor:{url:"URL",bold:"Bold",italic:"Italic",strikethrough:"Strikethrough",underline:"Underline",unorderedList:"Unordered List",orderedList:"Ordered List",subscript:"Subscript",superscript:"Superscript",hyperlink:"Hyperlink",toggleFullscreen:"Toggle Fullscreen",quote:"Quote",left:"Left align",center:"Center align",right:"Right align",justify:"Justify align",print:"Print",outdent:"Decrease indentation",indent:"Increase indentation",removeFormat:"Remove formatting",formatting:"Formatting",fontSize:"Font Size",align:"Align",hr:"Insert Horizontal Rule",undo:"Undo",redo:"Redo",heading1:"Heading 1",heading2:"Heading 2",heading3:"Heading 3",heading4:"Heading 4",heading5:"Heading 5",heading6:"Heading 6",paragraph:"Paragraph",code:"Code",size1:"Very small",size2:"A bit small",size3:"Normal",size4:"Medium-large",size5:"Big",size6:"Very big",size7:"Maximum",defaultFont:"Default Font",viewSource:"View Source"},tree:{noNodes:"No nodes available",noResults:"No matching nodes found"}};function Fx(){const r=Array.isArray(navigator.languages)===!0&&navigator.languages.length>0?navigator.languages[0]:navigator.language;if(typeof r=="string")return r.split(/[-_]/).map((h,p)=>p===0?h.toLowerCase():p>1||h.length<4?h.toUpperCase():h[0].toUpperCase()+h.slice(1).toLowerCase()).join("-")}const ia=fp({__langPack:{}},{getLocale:Fx,set(r=Rx,h){const p={...r,rtl:r.rtl===!0,getLocale:Fx};{const y=document.documentElement;y.setAttribute("dir",p.rtl===!0?"rtl":"ltr"),y.setAttribute("lang",p.isoName),p.set=ia.set,Object.assign(ia.__langPack,p),ia.props=p,ia.isoName=p.isoName,ia.nativeName=p.nativeName}},install({$q:r,lang:h,ssrContext:p}){r.lang=ia.__langPack,this.__installed===!0?h!==void 0&&this.set(h):this.set(h||Rx)}});function YS(r,h,p=document.body){if(typeof r!="string")throw new TypeError("Expected a string as propName");if(typeof h!="string")throw new TypeError("Expected a string as value");if(!(p instanceof Element))throw new TypeError("Expected a DOM element");p.style.setProperty(`--q-${r}`,h)}let O1=!1;function JS(r){O1=r.isComposing===!0}function lg(r){return O1===!0||r!==Object(r)||r.isComposing===!0||r.qKeyEvent===!0}function aa(r,h){return lg(r)===!0?!1:[].concat(h).includes(r.keyCode)}function QS(r){if(r.ios===!0)return"ios";if(r.android===!0)return"android"}function eC({is:r,has:h,within:p},y){const b=[r.desktop===!0?"desktop":"mobile",`${h.touch===!1?"no-":""}touch`];if(r.mobile===!0){const E=QS(r);E!==void 0&&b.push("platform-"+E)}if(r.nativeMobile===!0){const E=r.nativeMobileWrapper;b.push(E),b.push("native-mobile"),r.ios===!0&&(y[E]===void 0||y[E].iosStatusBarPadding!==!1)&&b.push("q-ios-padding")}else r.electron===!0?b.push("electron"):r.bex===!0&&b.push("bex");return p.iframe===!0&&b.push("within-iframe"),b}function tC(){const r=document.body.className;let h=r;dp!==void 0&&(h=h.replace("desktop","platform-ios mobile")),dn.has.touch===!0&&(h=h.replace("no-touch","touch")),dn.within.iframe===!0&&(h+=" within-iframe"),r!==h&&(document.body.className=h)}function iC(r){for(const h in r)YS(h,r[h])}const nC={install(r){if(this.__installed!==!0){if(bo.value===!0)tC();else{const{$q:h}=r;h.config.brand!==void 0&&iC(h.config.brand);const p=eC(dn,h.config);document.body.classList.add.apply(document.body.classList,p)}dn.is.ios===!0&&document.body.addEventListener("touchstart",Wo),window.addEventListener("keydown",JS,!0)}}},rC={name:"material-icons",type:{positive:"check_circle",negative:"warning",info:"info",warning:"priority_high"},arrow:{up:"arrow_upward",right:"arrow_forward",down:"arrow_downward",left:"arrow_back",dropdown:"arrow_drop_down"},chevron:{left:"chevron_left",right:"chevron_right"},colorPicker:{spectrum:"gradient",tune:"tune",palette:"style"},pullToRefresh:{icon:"refresh"},carousel:{left:"chevron_left",right:"chevron_right",up:"keyboard_arrow_up",down:"keyboard_arrow_down",navigationIcon:"lens"},chip:{remove:"cancel",selected:"check"},datetime:{arrowLeft:"chevron_left",arrowRight:"chevron_right",now:"access_time",today:"today"},editor:{bold:"format_bold",italic:"format_italic",strikethrough:"strikethrough_s",underline:"format_underlined",unorderedList:"format_list_bulleted",orderedList:"format_list_numbered",subscript:"vertical_align_bottom",superscript:"vertical_align_top",hyperlink:"link",toggleFullscreen:"fullscreen",quote:"format_quote",left:"format_align_left",center:"format_align_center",right:"format_align_right",justify:"format_align_justify",print:"print",outdent:"format_indent_decrease",indent:"format_indent_increase",removeFormat:"format_clear",formatting:"text_format",fontSize:"format_size",align:"format_align_left",hr:"remove",undo:"undo",redo:"redo",heading:"format_size",code:"code",size:"format_size",font:"font_download",viewSource:"code"},expansionItem:{icon:"keyboard_arrow_down",denseIcon:"arrow_drop_down"},fab:{icon:"add",activeIcon:"close"},field:{clear:"cancel",error:"error"},pagination:{first:"first_page",prev:"keyboard_arrow_left",next:"keyboard_arrow_right",last:"last_page"},rating:{icon:"grade"},stepper:{done:"check",active:"edit",error:"warning"},tabs:{left:"chevron_left",right:"chevron_right",up:"keyboard_arrow_up",down:"keyboard_arrow_down"},table:{arrowUp:"arrow_upward",warning:"warning",firstPage:"first_page",prevPage:"chevron_left",nextPage:"chevron_right",lastPage:"last_page"},tree:{icon:"play_arrow"},uploader:{done:"done",clear:"clear",add:"add_box",upload:"cloud_upload",removeQueue:"clear_all",removeUploaded:"done_all"}},Gf=fp({iconMapFn:null,__icons:{}},{set(r,h){const p={...r,rtl:r.rtl===!0};p.set=Gf.set,Object.assign(Gf.__icons,p)},install({$q:r,iconSet:h,ssrContext:p}){r.config.iconMapFn!==void 0&&(this.iconMapFn=r.config.iconMapFn),r.iconSet=this.__icons,hp(r,"iconMapFn",()=>this.iconMapFn,y=>{this.iconMapFn=y}),this.__installed===!0?h!==void 0&&this.set(h):this.set(h||rC)}}),oC="_q_",V1="_q_t_",Fh="_q_l_",sC="_q_pc_",U1="_q_f_",aC="_q_fo_",Zf={};let N1=!1;function lC(){N1=!0}function na(r,h){if(r===h)return!0;if(r!==null&&h!==null&&typeof r=="object"&&typeof h=="object"){if(r.constructor!==h.constructor)return!1;let p,y;if(r.constructor===Array){if(p=r.length,p!==h.length)return!1;for(y=p;y--!==0;)if(na(r[y],h[y])!==!0)return!1;return!0}if(r.constructor===Map){if(r.size!==h.size)return!1;for(y=r.entries().next();y.done!==!0;){if(h.has(y.value[0])!==!0)return!1;y=y.next()}for(y=r.entries().next();y.done!==!0;){if(na(y.value[1],h.get(y.value[0]))!==!0)return!1;y=y.next()}return!0}if(r.constructor===Set){if(r.size!==h.size)return!1;for(y=r.entries().next();y.done!==!0;){if(h.has(y.value[0])!==!0)return!1;y=y.next()}return!0}if(r.buffer!=null&&r.buffer.constructor===ArrayBuffer){if(p=r.length,p!==h.length)return!1;for(y=p;y--!==0;)if(r[y]!==h[y])return!1;return!0}if(r.constructor===RegExp)return r.source===h.source&&r.flags===h.flags;if(r.valueOf!==Object.prototype.valueOf)return r.valueOf()===h.valueOf();if(r.toString!==Object.prototype.toString)return r.toString()===h.toString();const b=Object.keys(r).filter(E=>r[E]!==void 0);if(p=b.length,p!==Object.keys(h).filter(E=>h[E]!==void 0).length)return!1;for(y=p;y--!==0;){const E=b[y];if(na(r[E],h[E])!==!0)return!1}return!0}return r!==r&&h!==h}function Ox(r){return r!==null&&typeof r=="object"&&Array.isArray(r)!==!0}function cC(r){return typeof r=="number"&&isFinite(r)}const Vx=[qf,nC,dr,WS,zh,ia,Gf];function Ux(r,h){h.forEach(p=>{p.install(r),p.__installed=!0})}function uC(r,h,p){r.config.globalProperties.$q=p.$q,r.provide(oC,p.$q),Ux(p,Vx),h.components!==void 0&&Object.values(h.components).forEach(y=>{Ox(y)===!0&&y.name!==void 0&&r.component(y.name,y)}),h.directives!==void 0&&Object.values(h.directives).forEach(y=>{Ox(y)===!0&&y.name!==void 0&&r.directive(y.name,y)}),h.plugins!==void 0&&Ux(p,Object.values(h.plugins).filter(y=>typeof y.install=="function"&&Vx.includes(y)===!1)),bo.value===!0&&(p.$q.onSSRHydrated=()=>{p.onSSRHydrated.forEach(y=>{y()}),p.$q.onSSRHydrated=()=>{}})}const hC=function(r,h={}){const p={version:"2.9.2"};N1===!1?(h.config!==void 0&&Object.assign(Zf,h.config),p.config={...Zf},lC()):p.config=h.config||{},uC(r,h,{parentApp:r,$q:p,lang:h.lang,iconSet:h.iconSet,onSSRHydrated:[]})},dC={version:"2.9.2",install:hC,lang:ia,iconSet:Gf};const C_={xs:18,sm:24,md:32,lg:38,xl:46},pp={size:String};function mp(r,h=C_){return xe(()=>r.size!==void 0?{fontSize:r.size in h?`${h[r.size]}px`:r.size}:null)}const fC={size:{type:[Number,String],default:"1em"},color:String};function pC(r){return{cSize:xe(()=>r.size in C_?`${C_[r.size]}px`:r.size),classes:xe(()=>"q-spinner"+(r.color?` text-${r.color}`:""))}}const Hi=r=>np(EE(r)),cg=r=>np(r),ug=Hi({name:"QSpinner",props:{...fC,thickness:{type:Number,default:5}},setup(r){const{cSize:h,classes:p}=pC(r);return()=>ke("svg",{class:p.value+" q-spinner-mat",width:h.value,height:h.value,viewBox:"25 25 50 50"},[ke("circle",{class:"path",cx:"50",cy:"50",r:"20",fill:"none",stroke:"currentColor","stroke-width":r.thickness,"stroke-miterlimit":"10"})])}}),mC={ratio:[String,Number]};function _C(r,h){return xe(()=>{const p=Number(r.ratio||(h!==void 0?h.value:void 0));return isNaN(p)!==!0&&p>0?{paddingBottom:`${100/p}%`}:null})}function Tn(r,h){return r!==void 0&&r()||h}function hg(r,h){if(r!==void 0){const p=r();if(p!=null)return p.slice()}return h}function Jr(r,h){return r!==void 0?h.concat(r()):h}function gC(r,h){return r===void 0?h:h!==void 0?h.concat(r()):r()}function j1(r,h,p,y,b,E){h.key=y+b;const M=ke(r,h,p);return b===!0?tg(M,E()):M}const yC=16/9,vC=Hi({name:"QImg",props:{...mC,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:yC},placeholderSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(r,{slots:h,emit:p}){const y=Rt(r.initialRatio),b=_C(r,y);let E;const M=[Rt(null),Rt(r.placeholderSrc!==void 0?{src:r.placeholderSrc}:null)],s=Rt(0),D=Rt(!1),V=Rt(!1),N=xe(()=>`q-img q-img--${r.noNativeMenu===!0?"no-":""}menu`),U=xe(()=>({width:r.width,height:r.height})),q=xe(()=>`q-img__image ${r.imgClass!==void 0?r.imgClass+" ":""}q-img__image--with${r.noTransition===!0?"out":""}-transition`),Y=xe(()=>({...r.imgStyle,objectFit:r.fit,objectPosition:r.position}));ri(()=>_e(),ve);function _e(){return r.src||r.srcset||r.sizes?{src:r.src,srcset:r.srcset,sizes:r.sizes}:null}function ve(be){if(clearTimeout(E),V.value=!1,be===null){D.value=!1,M[0].value=null,M[1].value=null;return}D.value=!0,M[s.value].value=be}function ze({target:be}){E!==null&&(clearTimeout(E),y.value=be.naturalHeight===0?.5:be.naturalWidth/be.naturalHeight,Ye(be,1))}function Ye(be,Pe){E===null||Pe===1e3||(be.complete===!0?we(be):E=setTimeout(()=>{Ye(be,Pe+1)},50))}function we(be){E!==null&&(s.value=s.value===1?0:1,M[s.value].value=null,D.value=!1,V.value=!1,p("load",be.currentSrc||be.src))}function Ue(be){clearTimeout(E),D.value=!1,V.value=!0,M[0].value=null,M[1].value=null,p("error",be)}function Ge(be,Pe){return ke("div",{class:"q-img__container absolute-full",key:be},Pe)}function Se(be){const Pe=M[be].value,Xe={key:"img_"+be,class:q.value,style:Y.value,crossorigin:r.crossorigin,decoding:r.decoding,referrerpolicy:r.referrerpolicy,height:r.height,width:r.width,loading:r.loading,fetchpriority:r.fetchpriority,"aria-hidden":"true",draggable:r.draggable,...Pe};return s.value===be?(Xe.class+=" q-img__image--waiting",Object.assign(Xe,{onLoad:ze,onError:Ue})):Xe.class+=" q-img__image--loaded",Ge("img"+be,ke("img",Xe))}function De(){return D.value!==!0?ke("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},Tn(h[V.value===!0?"error":"default"])):ke("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},h.loading!==void 0?h.loading():r.noSpinner===!0?void 0:[ke(ug,{color:r.spinnerColor,size:r.spinnerSize})])}return ve(_e()),mn(()=>{clearTimeout(E),E=null}),()=>{const be=[];return b.value!==null&&be.push(ke("div",{key:"filler",style:b.value})),V.value!==!0&&(M[0].value!==null&&be.push(Se(0)),M[1].value!==null&&be.push(Se(1))),be.push(ke(ys,{name:"q-transition--fade"},De)),ke("div",{class:N.value,style:U.value,role:"img","aria-label":r.alt},be)}}});function xC(){const r=Rt(!bo.value);return r.value===!1&&mr(()=>{r.value=!0}),r}const q1=typeof ResizeObserver<"u",Nx=q1===!0?{}:{style:"display:block;position:absolute;top:0;left:0;right:0;bottom:0;height:100%;width:100%;overflow:hidden;pointer-events:none;z-index:-1;",url:"about:blank"},Wf=Hi({name:"QResizeObserver",props:{debounce:{type:[String,Number],default:100}},emits:["resize"],setup(r,{emit:h}){let p=null,y,b={width:-1,height:-1};function E(N){N===!0||r.debounce===0||r.debounce==="0"?M():p===null&&(p=setTimeout(M,r.debounce))}function M(){if(clearTimeout(p),p=null,y){const{offsetWidth:N,offsetHeight:U}=y;(N!==b.width||U!==b.height)&&(b={width:N,height:U},h("resize",b))}}const{proxy:s}=Vi();if(q1===!0){let N;return mr(()=>{pn(()=>{y=s.$el.parentNode,y&&(N=new ResizeObserver(E),N.observe(y),M())})}),mn(()=>{clearTimeout(p),N!==void 0&&(N.disconnect!==void 0?N.disconnect():y&&N.unobserve(y))}),Wo}else{let q=function(){clearTimeout(p),U!==void 0&&(U.removeEventListener!==void 0&&U.removeEventListener("resize",E,Bn.passive),U=void 0)},Y=function(){q(),y&&y.contentDocument&&(U=y.contentDocument.defaultView,U.addEventListener("resize",E,Bn.passive),M())};var D=q,V=Y;const N=xC();let U;return mr(()=>{pn(()=>{y=s.$el,y&&Y()})}),mn(q),s.trigger=E,()=>{if(N.value===!0)return ke("object",{style:Nx.style,tabindex:-1,type:"text/html",data:Nx.url,"aria-hidden":"true",onLoad:Y})}}}}),bC=Hi({name:"QHeader",props:{modelValue:{type:Boolean,default:!0},reveal:Boolean,revealOffset:{type:Number,default:250},bordered:Boolean,elevated:Boolean,heightHint:{type:[String,Number],default:50}},emits:["reveal","focusin"],setup(r,{slots:h,emit:p}){const{proxy:{$q:y}}=Vi(),b=Zo(Fh,()=>{console.error("QHeader needs to be child of QLayout")}),E=Rt(parseInt(r.heightHint,10)),M=Rt(!0),s=xe(()=>r.reveal===!0||b.view.value.indexOf("H")>-1||y.platform.is.ios&&b.isContainer.value===!0),D=xe(()=>{if(r.modelValue!==!0)return 0;if(s.value===!0)return M.value===!0?E.value:0;const we=E.value-b.scroll.value.position;return we>0?we:0}),V=xe(()=>r.modelValue!==!0||s.value===!0&&M.value!==!0),N=xe(()=>r.modelValue===!0&&V.value===!0&&r.reveal===!0),U=xe(()=>"q-header q-layout__section--marginal "+(s.value===!0?"fixed":"absolute")+"-top"+(r.bordered===!0?" q-header--bordered":"")+(V.value===!0?" q-header--hidden":"")+(r.modelValue!==!0?" q-layout--prevent-focus":"")),q=xe(()=>{const we=b.rows.value.top,Ue={};return we[0]==="l"&&b.left.space===!0&&(Ue[y.lang.rtl===!0?"right":"left"]=`${b.left.size}px`),we[2]==="r"&&b.right.space===!0&&(Ue[y.lang.rtl===!0?"left":"right"]=`${b.right.size}px`),Ue});function Y(we,Ue){b.update("header",we,Ue)}function _e(we,Ue){we.value!==Ue&&(we.value=Ue)}function ve({height:we}){_e(E,we),Y("size",we)}function ze(we){N.value===!0&&_e(M,!0),p("focusin",we)}ri(()=>r.modelValue,we=>{Y("space",we),_e(M,!0),b.animate()}),ri(D,we=>{Y("offset",we)}),ri(()=>r.reveal,we=>{we===!1&&_e(M,r.modelValue)}),ri(M,we=>{b.animate(),p("reveal",we)}),ri(b.scroll,we=>{r.reveal===!0&&_e(M,we.direction==="up"||we.position<=r.revealOffset||we.position-we.inflectionPoint<100)});const Ye={};return b.instances.header=Ye,r.modelValue===!0&&Y("size",E.value),Y("space",r.modelValue),Y("offset",D.value),mn(()=>{b.instances.header===Ye&&(b.instances.header=void 0,Y("size",0),Y("offset",0),Y("space",!1))}),()=>{const we=hg(h.default,[]);return r.elevated===!0&&we.push(ke("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),we.push(ke(Wf,{debounce:0,onResize:ve})),ke("header",{class:U.value,style:q.value,onFocusin:ze},we)}}}),wC={position:{type:String,default:"bottom-right",validator:r=>["top-right","top-left","bottom-right","bottom-left","top","right","bottom","left"].includes(r)},offset:{type:Array,validator:r=>r.length===2},expand:Boolean};function TC(){const{props:r,proxy:{$q:h}}=Vi(),p=Zo(Fh,()=>{console.error("QPageSticky needs to be child of QLayout")}),y=xe(()=>{const U=r.position;return{top:U.indexOf("top")>-1,right:U.indexOf("right")>-1,bottom:U.indexOf("bottom")>-1,left:U.indexOf("left")>-1,vertical:U==="top"||U==="bottom",horizontal:U==="left"||U==="right"}}),b=xe(()=>p.header.offset),E=xe(()=>p.right.offset),M=xe(()=>p.footer.offset),s=xe(()=>p.left.offset),D=xe(()=>{let U=0,q=0;const Y=y.value,_e=h.lang.rtl===!0?-1:1;Y.top===!0&&b.value!==0?q=`${b.value}px`:Y.bottom===!0&&M.value!==0&&(q=`${-M.value}px`),Y.left===!0&&s.value!==0?U=`${_e*s.value}px`:Y.right===!0&&E.value!==0&&(U=`${-_e*E.value}px`);const ve={transform:`translate(${U}, ${q})`};return r.offset&&(ve.margin=`${r.offset[1]}px ${r.offset[0]}px`),Y.vertical===!0?(s.value!==0&&(ve[h.lang.rtl===!0?"right":"left"]=`${s.value}px`),E.value!==0&&(ve[h.lang.rtl===!0?"left":"right"]=`${E.value}px`)):Y.horizontal===!0&&(b.value!==0&&(ve.top=`${b.value}px`),M.value!==0&&(ve.bottom=`${M.value}px`)),ve}),V=xe(()=>`q-page-sticky row flex-center fixed-${r.position} q-page-sticky--${r.expand===!0?"expand":"shrink"}`);function N(U){const q=Tn(U.default);return ke("div",{class:V.value,style:D.value},r.expand===!0?q:[ke("div",q)])}return{$layout:p,getStickyContent:N}}const EC=Hi({name:"QPageSticky",props:wC,setup(r,{slots:h}){const{getStickyContent:p}=TC();return()=>p(h)}}),SC=Hi({name:"QPageContainer",setup(r,{slots:h}){const{proxy:{$q:p}}=Vi(),y=Zo(Fh,()=>{console.error("QPageContainer needs to be child of QLayout")});Bh(sC,!0);const b=xe(()=>{const E={};return y.header.space===!0&&(E.paddingTop=`${y.header.size}px`),y.right.space===!0&&(E[`padding${p.lang.rtl===!0?"Left":"Right"}`]=`${y.right.size}px`),y.footer.space===!0&&(E.paddingBottom=`${y.footer.size}px`),y.left.space===!0&&(E[`padding${p.lang.rtl===!0?"Right":"Left"}`]=`${y.left.size}px`),E});return()=>ke("div",{class:"q-page-container",style:b.value},Tn(h.default))}});function Df(r){if(Object(r.$parent)===r.$parent)return r.$parent;let{parent:h}=r.$;for(;Object(h)===h;){if(Object(h.proxy)===h.proxy)return h.proxy;h=h.parent}}function $1(r,h){typeof h.type=="symbol"?Array.isArray(h.children)===!0&&h.children.forEach(p=>{$1(r,p)}):r.add(h)}function G1(r){const h=new Set;return r.forEach(p=>{$1(h,p)}),Array.from(h)}function dg(r){return r.appContext.config.globalProperties.$router!==void 0}function Z1(r){return r.isUnmounted===!0||r.isDeactivated===!0}const jx=Hi({name:"QChatMessage",props:{sent:Boolean,label:String,bgColor:String,textColor:String,name:String,avatar:String,text:Array,stamp:String,size:String,labelHtml:Boolean,nameHtml:Boolean,textHtml:Boolean,stampHtml:Boolean},setup(r,{slots:h}){const p=xe(()=>r.sent===!0?"sent":"received"),y=xe(()=>`q-message-text-content q-message-text-content--${p.value}`+(r.textColor!==void 0?` text-${r.textColor}`:"")),b=xe(()=>`q-message-text q-message-text--${p.value}`+(r.bgColor!==void 0?` text-${r.bgColor}`:"")),E=xe(()=>"q-message-container row items-end no-wrap"+(r.sent===!0?" reverse":"")),M=xe(()=>r.size!==void 0?`col-${r.size}`:""),s=xe(()=>({msg:r.textHtml===!0?"innerHTML":"textContent",stamp:r.stampHtml===!0?"innerHTML":"textContent",name:r.nameHtml===!0?"innerHTML":"textContent",label:r.labelHtml===!0?"innerHTML":"textContent"}));function D(N){return h.stamp!==void 0?[N,ke("div",{class:"q-message-stamp"},h.stamp())]:r.stamp?[N,ke("div",{class:"q-message-stamp",[s.value.stamp]:r.stamp})]:[N]}function V(N,U){const q=U===!0?N.length>1?Y=>Y:Y=>ke("div",[Y]):Y=>ke("div",{[s.value.msg]:Y});return N.map((Y,_e)=>ke("div",{key:_e,class:b.value},[ke("div",{class:y.value},D(q(Y)))]))}return()=>{const N=[];h.avatar!==void 0?N.push(h.avatar()):r.avatar!==void 0&&N.push(ke("img",{class:`q-message-avatar q-message-avatar--${p.value}`,src:r.avatar,"aria-hidden":"true"}));const U=[];h.name!==void 0?U.push(ke("div",{class:`q-message-name q-message-name--${p.value}`},h.name())):r.name!==void 0&&U.push(ke("div",{class:`q-message-name q-message-name--${p.value}`,[s.value.name]:r.name})),h.default!==void 0?U.push(V(G1(h.default()),!0)):r.text!==void 0&&U.push(V(r.text)),N.push(ke("div",{class:M.value},U));const q=[];return h.label!==void 0?q.push(ke("div",{class:"q-message-label"},h.label())):r.label!==void 0&&q.push(ke("div",{class:"q-message-label",[s.value.label]:r.label})),q.push(ke("div",{class:E.value},N)),ke("div",{class:`q-message q-message-${p.value}`},q)}}}),CC=Hi({name:"QToolbar",props:{inset:Boolean},setup(r,{slots:h}){const p=xe(()=>"q-toolbar row no-wrap items-center"+(r.inset===!0?" q-toolbar--inset":""));return()=>ke("div",{class:p.value},Tn(h.default))}}),AC=Hi({name:"QFooter",props:{modelValue:{type:Boolean,default:!0},reveal:Boolean,bordered:Boolean,elevated:Boolean,heightHint:{type:[String,Number],default:50}},emits:["reveal","focusin"],setup(r,{slots:h,emit:p}){const{proxy:{$q:y}}=Vi(),b=Zo(Fh,()=>{console.error("QFooter needs to be child of QLayout")}),E=Rt(parseInt(r.heightHint,10)),M=Rt(!0),s=Rt(bo.value===!0||b.isContainer.value===!0?0:window.innerHeight),D=xe(()=>r.reveal===!0||b.view.value.indexOf("F")>-1||y.platform.is.ios&&b.isContainer.value===!0),V=xe(()=>b.isContainer.value===!0?b.containerHeight.value:s.value),N=xe(()=>{if(r.modelValue!==!0)return 0;if(D.value===!0)return M.value===!0?E.value:0;const Se=b.scroll.value.position+V.value+E.value-b.height.value;return Se>0?Se:0}),U=xe(()=>r.modelValue!==!0||D.value===!0&&M.value!==!0),q=xe(()=>r.modelValue===!0&&U.value===!0&&r.reveal===!0),Y=xe(()=>"q-footer q-layout__section--marginal "+(D.value===!0?"fixed":"absolute")+"-bottom"+(r.bordered===!0?" q-footer--bordered":"")+(U.value===!0?" q-footer--hidden":"")+(r.modelValue!==!0?" q-layout--prevent-focus"+(D.value!==!0?" hidden":""):"")),_e=xe(()=>{const Se=b.rows.value.bottom,De={};return Se[0]==="l"&&b.left.space===!0&&(De[y.lang.rtl===!0?"right":"left"]=`${b.left.size}px`),Se[2]==="r"&&b.right.space===!0&&(De[y.lang.rtl===!0?"left":"right"]=`${b.right.size}px`),De});function ve(Se,De){b.update("footer",Se,De)}function ze(Se,De){Se.value!==De&&(Se.value=De)}function Ye({height:Se}){ze(E,Se),ve("size",Se)}function we(){if(r.reveal!==!0)return;const{direction:Se,position:De,inflectionPoint:be}=b.scroll.value;ze(M,Se==="up"||De-be<100||b.height.value-V.value-De-E.value<300)}function Ue(Se){q.value===!0&&ze(M,!0),p("focusin",Se)}ri(()=>r.modelValue,Se=>{ve("space",Se),ze(M,!0),b.animate()}),ri(N,Se=>{ve("offset",Se)}),ri(()=>r.reveal,Se=>{Se===!1&&ze(M,r.modelValue)}),ri(M,Se=>{b.animate(),p("reveal",Se)}),ri([E,b.scroll,b.height],we),ri(()=>y.screen.height,Se=>{b.isContainer.value!==!0&&ze(s,Se)});const Ge={};return b.instances.footer=Ge,r.modelValue===!0&&ve("size",E.value),ve("space",r.modelValue),ve("offset",N.value),mn(()=>{b.instances.footer===Ge&&(b.instances.footer=void 0,ve("size",0),ve("offset",0),ve("space",!1))}),()=>{const Se=Jr(h.default,[ke(Wf,{debounce:0,onResize:Ye})]);return r.elevated===!0&&Se.push(ke("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),ke("footer",{class:Y.value,style:_e.value,onFocusin:Ue},Se)}}});function A_(r,h){const p=r.style;for(const y in h)p[y]=h[y]}function MC(r){if(r==null)return;if(typeof r=="string")try{return document.querySelector(r)||void 0}catch{return}const h=H_(r);if(h)return h.$el||h}function W1(r,h){if(r==null||r.contains(h)===!0)return!0;for(let p=r.nextElementSibling;p!==null;p=p.nextElementSibling)if(p.contains(h))return!0;return!1}const IC=[null,document,document.body,document.scrollingElement,document.documentElement];function H1(r,h){let p=MC(h);if(p===void 0){if(r==null)return window;p=r.closest(".scroll,.scroll-y,.overflow-auto")}return IC.includes(p)?window:p}function X1(r){return r===window?window.pageYOffset||window.scrollY||document.body.scrollTop||0:r.scrollTop}function K1(r){return r===window?window.pageXOffset||window.scrollX||document.body.scrollLeft||0:r.scrollLeft}let wf;function Lf(){if(wf!==void 0)return wf;const r=document.createElement("p"),h=document.createElement("div");A_(r,{width:"100%",height:"200px"}),A_(h,{position:"absolute",top:"0px",left:"0px",visibility:"hidden",width:"200px",height:"150px",overflow:"hidden"}),h.appendChild(r),document.body.appendChild(h);const p=r.offsetWidth;h.style.overflow="scroll";let y=r.offsetWidth;return p===y&&(y=h.clientWidth),h.remove(),wf=p-y,wf}function kC(r,h=!0){return!r||r.nodeType!==Node.ELEMENT_NODE?!1:h?r.scrollHeight>r.clientHeight&&(r.classList.contains("scroll")||r.classList.contains("overflow-auto")||["auto","scroll"].includes(window.getComputedStyle(r)["overflow-y"])):r.scrollWidth>r.clientWidth&&(r.classList.contains("scroll")||r.classList.contains("overflow-auto")||["auto","scroll"].includes(window.getComputedStyle(r)["overflow-x"]))}const{passive:qx}=Bn,zC=["both","horizontal","vertical"],PC=Hi({name:"QScrollObserver",props:{axis:{type:String,validator:r=>zC.includes(r),default:"vertical"},debounce:[String,Number],scrollTarget:{default:void 0}},emits:["scroll"],setup(r,{emit:h}){const p={position:{top:0,left:0},direction:"down",directionChanged:!1,delta:{top:0,left:0},inflectionPoint:{top:0,left:0}};let y=null,b,E;ri(()=>r.scrollTarget,()=>{D(),s()});function M(){y!==null&&y();const U=Math.max(0,X1(b)),q=K1(b),Y={top:U-p.position.top,left:q-p.position.left};if(r.axis==="vertical"&&Y.top===0||r.axis==="horizontal"&&Y.left===0)return;const _e=Math.abs(Y.top)>=Math.abs(Y.left)?Y.top<0?"up":"down":Y.left<0?"left":"right";p.position={top:U,left:q},p.directionChanged=p.direction!==_e,p.delta=Y,p.directionChanged===!0&&(p.direction=_e,p.inflectionPoint=p.position),h("scroll",{...p})}function s(){b=H1(E,r.scrollTarget),b.addEventListener("scroll",V,qx),V(!0)}function D(){b!==void 0&&(b.removeEventListener("scroll",V,qx),b=void 0)}function V(U){if(U===!0||r.debounce===0||r.debounce==="0")M();else if(y===null){const[q,Y]=r.debounce?[setTimeout(M,r.debounce),clearTimeout]:[requestAnimationFrame(M),cancelAnimationFrame];y=()=>{Y(q),y=null}}}const{proxy:N}=Vi();return mr(()=>{E=N.$el.parentNode,s()}),mn(()=>{y!==null&&y(),D()}),Object.assign(N,{trigger:V,getPosition:()=>p}),Wo}}),DC=Hi({name:"QLayout",props:{container:Boolean,view:{type:String,default:"hhh lpr fff",validator:r=>/^(h|l)h(h|r) lpr (f|l)f(f|r)$/.test(r.toLowerCase())},onScroll:Function,onScrollHeight:Function,onResize:Function},setup(r,{slots:h,emit:p}){const{proxy:{$q:y}}=Vi(),b=Rt(null),E=Rt(y.screen.height),M=Rt(r.container===!0?0:y.screen.width),s=Rt({position:0,direction:"down",inflectionPoint:0}),D=Rt(0),V=Rt(bo.value===!0?0:Lf()),N=xe(()=>"q-layout q-layout--"+(r.container===!0?"containerized":"standard")),U=xe(()=>r.container===!1?{minHeight:y.screen.height+"px"}:null),q=xe(()=>V.value!==0?{[y.lang.rtl===!0?"left":"right"]:`${V.value}px`}:null),Y=xe(()=>V.value!==0?{[y.lang.rtl===!0?"right":"left"]:0,[y.lang.rtl===!0?"left":"right"]:`-${V.value}px`,width:`calc(100% + ${V.value}px)`}:null);function _e(be){if(r.container===!0||document.qScrollPrevented!==!0){const Pe={position:be.position.top,direction:be.direction,directionChanged:be.directionChanged,inflectionPoint:be.inflectionPoint.top,delta:be.delta.top};s.value=Pe,r.onScroll!==void 0&&p("scroll",Pe)}}function ve(be){const{height:Pe,width:Xe}=be;let Ve=!1;E.value!==Pe&&(Ve=!0,E.value=Pe,r.onScrollHeight!==void 0&&p("scroll-height",Pe),Ye()),M.value!==Xe&&(Ve=!0,M.value=Xe),Ve===!0&&r.onResize!==void 0&&p("resize",be)}function ze({height:be}){D.value!==be&&(D.value=be,Ye())}function Ye(){if(r.container===!0){const be=E.value>D.value?Lf():0;V.value!==be&&(V.value=be)}}let we;const Ue={instances:{},view:xe(()=>r.view),isContainer:xe(()=>r.container),rootRef:b,height:E,containerHeight:D,scrollbarWidth:V,totalWidth:xe(()=>M.value+V.value),rows:xe(()=>{const be=r.view.toLowerCase().split(" ");return{top:be[0].split(""),middle:be[1].split(""),bottom:be[2].split("")}}),header:$o({size:0,offset:0,space:!1}),right:$o({size:300,offset:0,space:!1}),footer:$o({size:0,offset:0,space:!1}),left:$o({size:300,offset:0,space:!1}),scroll:s,animate(){we!==void 0?clearTimeout(we):document.body.classList.add("q-body--layout-animate"),we=setTimeout(()=>{document.body.classList.remove("q-body--layout-animate"),we=void 0},155)},update(be,Pe,Xe){Ue[be][Pe]=Xe}};if(Bh(Fh,Ue),Lf()>0){let Xe=function(){be=null,Pe.classList.remove("hide-scrollbar")},Ve=function(){if(be===null){if(Pe.scrollHeight>y.screen.height)return;Pe.classList.add("hide-scrollbar")}else clearTimeout(be);be=setTimeout(Xe,300)},nt=function(qe){be!==null&&qe==="remove"&&(clearTimeout(be),Xe()),window[`${qe}EventListener`]("resize",Ve)};var Ge=Xe,Se=Ve,De=nt;let be=null;const Pe=document.body;ri(()=>r.container!==!0?"add":"remove",nt),r.container!==!0&&nt("add"),lp(()=>{nt("remove")})}return()=>{const be=Jr(h.default,[ke(PC,{onScroll:_e}),ke(Wf,{onResize:ve})]),Pe=ke("div",{class:N.value,style:U.value,ref:r.container===!0?void 0:b,tabindex:-1},be);return r.container===!0?ke("div",{class:"q-layout-container overflow-hidden",ref:b},[ke(Wf,{onResize:ze}),ke("div",{class:"absolute-full",style:q.value},[ke("div",{class:"scroll",style:Y.value},[Pe])])]):Pe}}}),$x="0 0 24 24",Gx=r=>r,i_=r=>`ionicons ${r}`,Y1={"mdi-":r=>`mdi ${r}`,"icon-":Gx,"bt-":r=>`bt ${r}`,"eva-":r=>`eva ${r}`,"ion-md":i_,"ion-ios":i_,"ion-logo":i_,"iconfont ":Gx,"ti-":r=>`themify-icon ${r}`,"bi-":r=>`bootstrap-icons ${r}`},J1={o_:"-outlined",r_:"-round",s_:"-sharp"},Q1={sym_o_:"-outlined",sym_r_:"-rounded",sym_s_:"-sharp"},LC=new RegExp("^("+Object.keys(Y1).join("|")+")"),BC=new RegExp("^("+Object.keys(J1).join("|")+")"),Zx=new RegExp("^("+Object.keys(Q1).join("|")+")"),RC=/^[Mm]\s?[-+]?\.?\d/,FC=/^img:/,OC=/^svguse:/,VC=/^ion-/,UC=/^(fa-(solid|regular|light|brands|duotone|thin)|[lf]a[srlbdk]?) /,jn=Hi({name:"QIcon",props:{...pp,tag:{type:String,default:"i"},name:String,color:String,left:Boolean,right:Boolean},setup(r,{slots:h}){const{proxy:{$q:p}}=Vi(),y=mp(r),b=xe(()=>"q-icon"+(r.left===!0?" on-left":"")+(r.right===!0?" on-right":"")+(r.color!==void 0?` text-${r.color}`:"")),E=xe(()=>{let M,s=r.name;if(s==="none"||!s)return{none:!0};if(p.iconMapFn!==null){const N=p.iconMapFn(s);if(N!==void 0)if(N.icon!==void 0){if(s=N.icon,s==="none"||!s)return{none:!0}}else return{cls:N.cls,content:N.content!==void 0?N.content:" "}}if(RC.test(s)===!0){const[N,U=$x]=s.split("|");return{svg:!0,viewBox:U,nodes:N.split("&&").map(q=>{const[Y,_e,ve]=q.split("@@");return ke("path",{style:_e,d:Y,transform:ve})})}}if(FC.test(s)===!0)return{img:!0,src:s.substring(4)};if(OC.test(s)===!0){const[N,U=$x]=s.split("|");return{svguse:!0,src:N.substring(7),viewBox:U}}let D=" ";const V=s.match(LC);if(V!==null)M=Y1[V[1]](s);else if(UC.test(s)===!0)M=s;else if(VC.test(s)===!0)M=`ionicons ion-${p.platform.is.ios===!0?"ios":"md"}${s.substring(3)}`;else if(Zx.test(s)===!0){M="notranslate material-symbols";const N=s.match(Zx);N!==null&&(s=s.substring(6),M+=Q1[N[1]]),D=s}else{M="notranslate material-icons";const N=s.match(BC);N!==null&&(s=s.substring(2),M+=J1[N[1]]),D=s}return{cls:M,content:D}});return()=>{const M={class:b.value,style:y.value,"aria-hidden":"true",role:"presentation"};return E.value.none===!0?ke(r.tag,M,Tn(h.default)):E.value.img===!0?ke("span",M,Jr(h.default,[ke("img",{src:E.value.src})])):E.value.svg===!0?ke("span",M,Jr(h.default,[ke("svg",{viewBox:E.value.viewBox||"0 0 24 24"},E.value.nodes)])):E.value.svguse===!0?ke("span",M,Jr(h.default,[ke("svg",{viewBox:E.value.viewBox},[ke("use",{"xlink:href":E.value.src})])])):(E.value.cls!==void 0&&(M.class+=" "+E.value.cls),ke(r.tag,M,Jr(h.default,[E.value.content])))}}});function NC(r,h=250){let p=!1,y;return function(){return p===!1&&(p=!0,setTimeout(()=>{p=!1},h),y=r.apply(this,arguments)),y}}function Wx(r,h,p,y){p.modifiers.stop===!0&&jo(r);const b=p.modifiers.color;let E=p.modifiers.center;E=E===!0||y===!0;const M=document.createElement("span"),s=document.createElement("span"),D=$f(r),{left:V,top:N,width:U,height:q}=h.getBoundingClientRect(),Y=Math.sqrt(U*U+q*q),_e=Y/2,ve=`${(U-Y)/2}px`,ze=E?ve:`${D.left-V-_e}px`,Ye=`${(q-Y)/2}px`,we=E?Ye:`${D.top-N-_e}px`;s.className="q-ripple__inner",A_(s,{height:`${Y}px`,width:`${Y}px`,transform:`translate3d(${ze},${we},0) scale3d(.2,.2,1)`,opacity:0}),M.className=`q-ripple${b?" text-"+b:""}`,M.setAttribute("dir","ltr"),M.appendChild(s),h.appendChild(M);const Ue=()=>{M.remove(),clearTimeout(Ge)};p.abort.push(Ue);let Ge=setTimeout(()=>{s.classList.add("q-ripple__inner--enter"),s.style.transform=`translate3d(${ve},${Ye},0) scale3d(1,1,1)`,s.style.opacity=.2,Ge=setTimeout(()=>{s.classList.remove("q-ripple__inner--enter"),s.classList.add("q-ripple__inner--leave"),s.style.opacity=0,Ge=setTimeout(()=>{M.remove(),p.abort.splice(p.abort.indexOf(Ue),1)},275)},250)},50)}function Hx(r,{modifiers:h,value:p,arg:y}){const b=Object.assign({},r.cfg.ripple,h,p);r.modifiers={early:b.early===!0,stop:b.stop===!0,center:b.center===!0,color:b.color||y,keyCodes:[].concat(b.keyCodes||13)}}const eb=cg({name:"ripple",beforeMount(r,h){const p=h.instance.$.appContext.config.globalProperties.$q.config||{};if(p.ripple===!1)return;const y={cfg:p,enabled:h.value!==!1,modifiers:{},abort:[],start(b){y.enabled===!0&&b.qSkipRipple!==!0&&b.type===(y.modifiers.early===!0?"pointerdown":"click")&&Wx(b,r,y,b.qKeyEvent===!0)},keystart:NC(b=>{y.enabled===!0&&b.qSkipRipple!==!0&&aa(b,y.modifiers.keyCodes)===!0&&b.type===`key${y.modifiers.early===!0?"down":"up"}`&&Wx(b,r,y,!0)},300)};Hx(y,h),r.__qripple=y,ll(y,"main",[[r,"pointerdown","start","passive"],[r,"click","start","passive"],[r,"keydown","keystart","passive"],[r,"keyup","keystart","passive"]])},updated(r,h){if(h.oldValue!==h.value){const p=r.__qripple;p!==void 0&&(p.enabled=h.value!==!1,p.enabled===!0&&Object(h.value)===h.value&&Hx(p,h))}},beforeUnmount(r){const h=r.__qripple;h!==void 0&&(h.abort.forEach(p=>{p()}),Eh(h,"main"),delete r._qripple)}}),tb={left:"start",center:"center",right:"end",between:"between",around:"around",evenly:"evenly",stretch:"stretch"},jC=Object.keys(tb),qC={align:{type:String,validator:r=>jC.includes(r)}};function $C(r){return xe(()=>{const h=r.align===void 0?r.vertical===!0?"stretch":"left":r.align;return`${r.vertical===!0?"items":"justify"}-${tb[h]}`})}function Xx(r){return r?r.aliasOf?r.aliasOf.path:r.path:""}function Kx(r,h){return(r.aliasOf||r)===(h.aliasOf||h)}function GC(r,h){for(const p in h){const y=h[p],b=r[p];if(typeof y=="string"){if(y!==b)return!1}else if(Array.isArray(b)===!1||b.length!==y.length||y.some((E,M)=>E!==b[M]))return!1}return!0}function Yx(r,h){return Array.isArray(h)===!0?r.length===h.length&&r.every((p,y)=>p===h[y]):r.length===1&&r[0]===h}function ZC(r,h){return Array.isArray(r)===!0?Yx(r,h):Array.isArray(h)===!0?Yx(h,r):r===h}function WC(r,h){if(Object.keys(r).length!==Object.keys(h).length)return!1;for(const p in r)if(ZC(r[p],h[p])===!1)return!1;return!0}const ib={to:[String,Object],replace:Boolean,exact:Boolean,activeClass:{type:String,default:"q-router-link--active"},exactActiveClass:{type:String,default:"q-router-link--exact-active"},href:String,target:String,disable:Boolean};function nb({fallbackTag:r,useDisableForRouterLinkProps:h=!0}={}){const p=Vi(),{props:y,proxy:b,emit:E}=p,M=dg(p),s=xe(()=>y.disable!==!0&&y.href!==void 0),D=xe(h===!0?()=>M===!0&&y.disable!==!0&&s.value!==!0&&y.to!==void 0&&y.to!==null&&y.to!=="":()=>M===!0&&s.value!==!0&&y.to!==void 0&&y.to!==null&&y.to!==""),V=xe(()=>D.value===!0?we(y.to):null),N=xe(()=>V.value!==null),U=xe(()=>s.value===!0||N.value===!0),q=xe(()=>y.type==="a"||U.value===!0?"a":y.tag||r||"div"),Y=xe(()=>s.value===!0?{href:y.href,target:y.target}:N.value===!0?{href:V.value.href,target:y.target}:{}),_e=xe(()=>{if(N.value===!1)return-1;const{matched:Se}=V.value,{length:De}=Se,be=Se[De-1];if(be===void 0)return-1;const Pe=b.$route.matched;if(Pe.length===0)return-1;const Xe=Pe.findIndex(Kx.bind(null,be));if(Xe>-1)return Xe;const Ve=Xx(Se[De-2]);return De>1&&Xx(be)===Ve&&Pe[Pe.length-1].path!==Ve?Pe.findIndex(Kx.bind(null,Se[De-2])):Xe}),ve=xe(()=>N.value===!0&&_e.value!==-1&&GC(b.$route.params,V.value.params)),ze=xe(()=>ve.value===!0&&_e.value===b.$route.matched.length-1&&WC(b.$route.params,V.value.params)),Ye=xe(()=>N.value===!0?ze.value===!0?` ${y.exactActiveClass} ${y.activeClass}`:y.exact===!0?"":ve.value===!0?` ${y.activeClass}`:"":"");function we(Se){try{return b.$router.resolve(Se)}catch{}return null}function Ue(Se,{returnRouterError:De,to:be=y.to,replace:Pe=y.replace}={}){if(y.disable===!0)return Se.preventDefault(),Promise.resolve(!1);if(Se.metaKey||Se.altKey||Se.ctrlKey||Se.shiftKey||Se.button!==void 0&&Se.button!==0||y.target==="_blank")return Promise.resolve(!1);Se.preventDefault();const Xe=b.$router[Pe===!0?"replace":"push"](be);return De===!0?Xe:Xe.then(()=>{}).catch(()=>{})}function Ge(Se){if(N.value===!0){const De=be=>Ue(Se,be);E("click",Se,De),Se.defaultPrevented!==!0&&De()}else E("click",Se)}return{hasRouterLink:N,hasHrefLink:s,hasLink:U,linkTag:q,resolvedLink:V,linkIsActive:ve,linkIsExactActive:ze,linkClass:Ye,linkAttrs:Y,getLink:we,navigateToRouterLink:Ue,navigateOnClick:Ge}}const Jx={none:0,xs:4,sm:8,md:16,lg:24,xl:32},HC={xs:8,sm:10,md:14,lg:20,xl:24},XC=["button","submit","reset"],KC=/[^\s]\/[^\s]/,YC={...pp,...ib,type:{type:String,default:"button"},label:[Number,String],icon:String,iconRight:String,round:Boolean,square:Boolean,outline:Boolean,flat:Boolean,unelevated:Boolean,rounded:Boolean,push:Boolean,glossy:Boolean,size:String,fab:Boolean,fabMini:Boolean,padding:String,color:String,textColor:String,noCaps:Boolean,noWrap:Boolean,dense:Boolean,tabindex:[Number,String],ripple:{type:[Boolean,Object],default:!0},align:{...qC.align,default:"center"},stack:Boolean,stretch:Boolean,loading:{type:Boolean,default:null},disable:Boolean};function JC(r){const h=mp(r,HC),p=$C(r),{hasRouterLink:y,hasLink:b,linkTag:E,linkAttrs:M,navigateOnClick:s}=nb({fallbackTag:"button"}),D=xe(()=>{const ze=r.fab===!1&&r.fabMini===!1?h.value:{};return r.padding!==void 0?Object.assign({},ze,{padding:r.padding.split(/\s+/).map(Ye=>Ye in Jx?Jx[Ye]+"px":Ye).join(" "),minWidth:"0",minHeight:"0"}):ze}),V=xe(()=>r.rounded===!0||r.fab===!0||r.fabMini===!0),N=xe(()=>r.disable!==!0&&r.loading!==!0),U=xe(()=>N.value===!0?r.tabindex||0:-1),q=xe(()=>r.flat===!0?"flat":r.outline===!0?"outline":r.push===!0?"push":r.unelevated===!0?"unelevated":"standard"),Y=xe(()=>{const ze={tabindex:U.value};return b.value===!0?Object.assign(ze,M.value):XC.includes(r.type)===!0&&(ze.type=r.type),E.value==="a"?(r.disable===!0?ze["aria-disabled"]="true":ze.href===void 0&&(ze.role="button"),y.value!==!0&&KC.test(r.type)===!0&&(ze.type=r.type)):r.disable===!0&&(ze.disabled="",ze["aria-disabled"]="true"),r.loading===!0&&r.percentage!==void 0&&Object.assign(ze,{role:"progressbar","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":r.percentage}),ze}),_e=xe(()=>{let ze;r.color!==void 0?r.flat===!0||r.outline===!0?ze=`text-${r.textColor||r.color}`:ze=`bg-${r.color} text-${r.textColor||"white"}`:r.textColor&&(ze=`text-${r.textColor}`);const Ye=r.round===!0?"round":`rectangle${V.value===!0?" q-btn--rounded":r.square===!0?" q-btn--square":""}`;return`q-btn--${q.value} q-btn--${Ye}`+(ze!==void 0?" "+ze:"")+(N.value===!0?" q-btn--actionable q-focusable q-hoverable":r.disable===!0?" disabled":"")+(r.fab===!0?" q-btn--fab":r.fabMini===!0?" q-btn--fab-mini":"")+(r.noCaps===!0?" q-btn--no-uppercase":"")+(r.dense===!0?" q-btn--dense":"")+(r.stretch===!0?" no-border-radius self-stretch":"")+(r.glossy===!0?" glossy":"")+(r.square?" q-btn--square":"")}),ve=xe(()=>p.value+(r.stack===!0?" column":" row")+(r.noWrap===!0?" no-wrap text-no-wrap":"")+(r.loading===!0?" q-btn__content--hidden":""));return{classes:_e,style:D,innerClasses:ve,attributes:Y,hasLink:b,linkTag:E,navigateOnClick:s,isActionable:N}}const{passiveCapture:Kr}=Bn;let pc=null,mc=null,_c=null;const Go=Hi({name:"QBtn",props:{...YC,percentage:Number,darkPercentage:Boolean,onTouchstart:[Function,Array]},emits:["click","keydown","mousedown","keyup"],setup(r,{slots:h,emit:p}){const{proxy:y}=Vi(),{classes:b,style:E,innerClasses:M,attributes:s,hasLink:D,linkTag:V,navigateOnClick:N,isActionable:U}=JC(r),q=Rt(null),Y=Rt(null);let _e=null,ve,ze;const Ye=xe(()=>r.label!==void 0&&r.label!==null&&r.label!==""),we=xe(()=>r.disable===!0||r.ripple===!1?!1:{keyCodes:D.value===!0?[13,32]:[13],...r.ripple===!0?{}:r.ripple}),Ue=xe(()=>({center:r.round})),Ge=xe(()=>{const Ke=Math.max(0,Math.min(100,r.percentage));return Ke>0?{transition:"transform 0.6s",transform:`translateX(${Ke-100}%)`}:{}}),Se=xe(()=>{if(r.loading===!0)return{onMousedown:$e,onTouchstart:$e,onClick:$e,onKeydown:$e,onKeyup:$e};if(U.value===!0){const Ke={onClick:be,onKeydown:Pe,onMousedown:Ve};if(y.$q.platform.has.touch===!0){const Ft=r.onTouchstart!==void 0?"":"Passive";Ke[`onTouchstart${Ft}`]=Xe}return Ke}return{onClick:Mn}}),De=xe(()=>({ref:q,class:"q-btn q-btn-item non-selectable no-outline "+b.value,style:E.value,...s.value,...Se.value}));function be(Ke){if(q.value!==null){if(Ke!==void 0){if(Ke.defaultPrevented===!0)return;const Ft=document.activeElement;if(r.type==="submit"&&Ft!==document.body&&q.value.contains(Ft)===!1&&Ft.contains(q.value)===!1){q.value.focus();const Ht=()=>{document.removeEventListener("keydown",Mn,!0),document.removeEventListener("keyup",Ht,Kr),q.value!==null&&q.value.removeEventListener("blur",Ht,Kr)};document.addEventListener("keydown",Mn,!0),document.addEventListener("keyup",Ht,Kr),q.value.addEventListener("blur",Ht,Kr)}}N(Ke)}}function Pe(Ke){q.value!==null&&(p("keydown",Ke),aa(Ke,[13,32])===!0&&mc!==q.value&&(mc!==null&&qe(),Ke.defaultPrevented!==!0&&(q.value.focus(),mc=q.value,q.value.classList.add("q-btn--active"),document.addEventListener("keyup",nt,!0),q.value.addEventListener("blur",nt,Kr)),Mn(Ke)))}function Xe(Ke){q.value!==null&&(p("touchstart",Ke),Ke.defaultPrevented!==!0&&(pc!==q.value&&(pc!==null&&qe(),pc=q.value,_e=Ke.target,_e.addEventListener("touchcancel",nt,Kr),_e.addEventListener("touchend",nt,Kr)),ve=!0,clearTimeout(ze),ze=setTimeout(()=>{ve=!1},200)))}function Ve(Ke){q.value!==null&&(Ke.qSkipRipple=ve===!0,p("mousedown",Ke),Ke.defaultPrevented!==!0&&_c!==q.value&&(_c!==null&&qe(),_c=q.value,q.value.classList.add("q-btn--active"),document.addEventListener("mouseup",nt,Kr)))}function nt(Ke){if(q.value!==null&&!(Ke!==void 0&&Ke.type==="blur"&&document.activeElement===q.value)){if(Ke!==void 0&&Ke.type==="keyup"){if(mc===q.value&&aa(Ke,[13,32])===!0){const Ft=new MouseEvent("click",Ke);Ft.qKeyEvent=!0,Ke.defaultPrevented===!0&&Nr(Ft),Ke.cancelBubble===!0&&jo(Ft),q.value.dispatchEvent(Ft),Mn(Ke),Ke.qKeyEvent=!0}p("keyup",Ke)}qe()}}function qe(Ke){const Ft=Y.value;Ke!==!0&&(pc===q.value||_c===q.value)&&Ft!==null&&Ft!==document.activeElement&&(Ft.setAttribute("tabindex",-1),Ft.focus()),pc===q.value&&(_e!==null&&(_e.removeEventListener("touchcancel",nt,Kr),_e.removeEventListener("touchend",nt,Kr)),pc=_e=null),_c===q.value&&(document.removeEventListener("mouseup",nt,Kr),_c=null),mc===q.value&&(document.removeEventListener("keyup",nt,!0),q.value!==null&&q.value.removeEventListener("blur",nt,Kr),mc=null),q.value!==null&&q.value.classList.remove("q-btn--active")}function $e(Ke){Mn(Ke),Ke.qSkipRipple=!0}return mn(()=>{qe(!0)}),Object.assign(y,{click:be}),()=>{let Ke=[];r.icon!==void 0&&Ke.push(ke(jn,{name:r.icon,left:r.stack===!1&&Ye.value===!0,role:"img","aria-hidden":"true"})),Ye.value===!0&&Ke.push(ke("span",{class:"block"},[r.label])),Ke=Jr(h.default,Ke),r.iconRight!==void 0&&r.round===!1&&Ke.push(ke(jn,{name:r.iconRight,right:r.stack===!1&&Ye.value===!0,role:"img","aria-hidden":"true"}));const Ft=[ke("span",{class:"q-focus-helper",ref:Y})];return r.loading===!0&&r.percentage!==void 0&&Ft.push(ke("span",{class:"q-btn__progress absolute-full overflow-hidden"+(r.darkPercentage===!0?" q-btn__progress--dark":"")},[ke("span",{class:"q-btn__progress-indicator fit block",style:Ge.value})])),Ft.push(ke("span",{class:"q-btn__content text-center col items-center q-anchor--skip "+M.value},Ke)),r.loading!==null&&Ft.push(ke(ys,{name:"q-transition--fade"},()=>r.loading===!0?[ke("span",{key:"loading",class:"absolute-full flex flex-center"},h.loading!==void 0?h.loading():[ke(ug)])]:null)),tg(ke(V.value,De.value,Ft),[[eb,we.value,void 0,Ue.value]])}}}),QC=["top","right","bottom","left"],rb={type:{type:String,default:"a"},outline:Boolean,push:Boolean,flat:Boolean,unelevated:Boolean,color:String,textColor:String,glossy:Boolean,square:Boolean,padding:String,label:{type:[String,Number],default:""},labelPosition:{type:String,default:"right",validator:r=>QC.includes(r)},externalLabel:Boolean,hideLabel:{type:Boolean},labelClass:[Array,String,Object],labelStyle:[Array,String,Object],disable:Boolean,tabindex:[Number,String]};function ob(r,h){return{formClass:xe(()=>`q-fab--form-${r.square===!0?"square":"rounded"}`),stacked:xe(()=>r.externalLabel===!1&&["top","bottom"].includes(r.labelPosition)),labelProps:xe(()=>{if(r.externalLabel===!0){const p=r.hideLabel===null?h.value===!1:r.hideLabel;return{action:"push",data:{class:[r.labelClass,`q-fab__label q-tooltip--style q-fab__label--external q-fab__label--external-${r.labelPosition}`+(p===!0?" q-fab__label--external-hidden":"")],style:r.labelStyle}}}return{action:["left","top"].includes(r.labelPosition)?"unshift":"push",data:{class:[r.labelClass,`q-fab__label q-fab__label--internal q-fab__label--internal-${r.labelPosition}`+(r.hideLabel===!0?" q-fab__label--internal-hidden":"")],style:r.labelStyle}}})}}const sb={start:"self-end",center:"self-center",end:"self-start"},eA=Object.keys(sb),gc=Hi({name:"QFabAction",props:{...rb,icon:{type:String,default:""},anchor:{type:String,validator:r=>eA.includes(r)},to:[String,Object],replace:Boolean},emits:["click"],setup(r,{slots:h,emit:p}){const y=Zo(U1,()=>({showing:{value:!0},onChildClick:Wo})),{formClass:b,labelProps:E}=ob(r,y.showing),M=xe(()=>{const U=sb[r.anchor];return b.value+(U!==void 0?` ${U}`:"")}),s=xe(()=>r.disable===!0||y.showing.value!==!0);function D(U){y.onChildClick(U),p("click",U)}function V(){const U=[];return h.icon!==void 0?U.push(h.icon()):r.icon!==""&&U.push(ke(jn,{name:r.icon})),(r.label!==""||h.label!==void 0)&&U[E.value.action](ke("div",E.value.data,h.label!==void 0?h.label():[r.label])),Jr(h.default,U)}const N=Vi();return Object.assign(N.proxy,{click:D}),()=>ke(Go,{class:M.value,...r,noWrap:!0,stack:r.stacked,icon:void 0,label:void 0,noCaps:!0,fabMini:!0,disable:s.value,onClick:D},V)}}),fg={modelValue:{type:Boolean,default:null},"onUpdate:modelValue":[Function,Array]},pg=["before-show","show","before-hide","hide"];function mg({showing:r,canShow:h,hideOnRouteChange:p,handleShow:y,handleHide:b,processOnMount:E}){const M=Vi(),{props:s,emit:D,proxy:V}=M;let N;function U(we){r.value===!0?_e(we):q(we)}function q(we){if(s.disable===!0||we!==void 0&&we.qAnchorHandled===!0||h!==void 0&&h(we)!==!0)return;const Ue=s["onUpdate:modelValue"]!==void 0;Ue===!0&&(D("update:modelValue",!0),N=we,pn(()=>{N===we&&(N=void 0)})),(s.modelValue===null||Ue===!1)&&Y(we)}function Y(we){r.value!==!0&&(r.value=!0,D("before-show",we),y!==void 0?y(we):D("show",we))}function _e(we){if(s.disable===!0)return;const Ue=s["onUpdate:modelValue"]!==void 0;Ue===!0&&(D("update:modelValue",!1),N=we,pn(()=>{N===we&&(N=void 0)})),(s.modelValue===null||Ue===!1)&&ve(we)}function ve(we){r.value!==!1&&(r.value=!1,D("before-hide",we),b!==void 0?b(we):D("hide",we))}function ze(we){s.disable===!0&&we===!0?s["onUpdate:modelValue"]!==void 0&&D("update:modelValue",!1):we===!0!==r.value&&(we===!0?Y:ve)(N)}ri(()=>s.modelValue,ze),p!==void 0&&dg(M)===!0&&ri(()=>V.$route.fullPath,()=>{p.value===!0&&r.value===!0&&_e()}),E===!0&&mr(()=>{ze(s.modelValue)});const Ye={show:q,hide:_e,toggle:U};return Object.assign(V,Ye),Ye}let n_,Tf=0;const tr=new Array(256);for(let r=0;r<256;r++)tr[r]=(r+256).toString(16).substring(1);const tA=(()=>{const r=typeof crypto<"u"?crypto:typeof window<"u"?window.crypto||window.msCrypto:void 0;if(r!==void 0){if(r.randomBytes!==void 0)return r.randomBytes;if(r.getRandomValues!==void 0)return h=>{const p=new Uint8Array(h);return r.getRandomValues(p),p}}return h=>{const p=[];for(let y=h;y>0;y--)p.push(Math.floor(Math.random()*256));return p}})(),Qx=4096;function ab(){(n_===void 0||Tf+16>Qx)&&(Tf=0,n_=tA(Qx));const r=Array.prototype.slice.call(n_,Tf,Tf+=16);return r[6]=r[6]&15|64,r[8]=r[8]&63|128,tr[r[0]]+tr[r[1]]+tr[r[2]]+tr[r[3]]+"-"+tr[r[4]]+tr[r[5]]+"-"+tr[r[6]]+tr[r[7]]+"-"+tr[r[8]]+tr[r[9]]+"-"+tr[r[10]]+tr[r[11]]+tr[r[12]]+tr[r[13]]+tr[r[14]]+tr[r[15]]}const iA=["up","right","down","left"],nA=["left","center","right"],rA=Hi({name:"QFab",props:{...rb,...fg,icon:String,activeIcon:String,hideIcon:Boolean,hideLabel:{default:null},direction:{type:String,default:"right",validator:r=>iA.includes(r)},persistent:Boolean,verticalActionsAlign:{type:String,default:"center",validator:r=>nA.includes(r)}},emits:pg,setup(r,{slots:h}){const p=Rt(null),y=Rt(r.modelValue===!0),b=ab(),{proxy:{$q:E}}=Vi(),{formClass:M,labelProps:s}=ob(r,y),D=xe(()=>r.persistent!==!0),{hide:V,toggle:N}=mg({showing:y,hideOnRouteChange:D}),U=xe(()=>({opened:y.value})),q=xe(()=>`q-fab z-fab row inline justify-center q-fab--align-${r.verticalActionsAlign} ${M.value}`+(y.value===!0?" q-fab--opened":" q-fab--closed")),Y=xe(()=>`q-fab__actions flex no-wrap inline q-fab__actions--${r.direction} q-fab__actions--${y.value===!0?"opened":"closed"}`),_e=xe(()=>{const we={id:b};return y.value===!0?we.role="menu":we["aria-hidden"]="true",we}),ve=xe(()=>`q-fab__icon-holder  q-fab__icon-holder--${y.value===!0?"opened":"closed"}`);function ze(we,Ue){const Ge=h[we],Se=`q-fab__${we} absolute-full`;return Ge===void 0?ke(jn,{class:Se,name:r[Ue]||E.iconSet.fab[Ue]}):ke("div",{class:Se},Ge(U.value))}function Ye(){const we=[];return r.hideIcon!==!0&&we.push(ke("div",{class:ve.value},[ze("icon","icon"),ze("active-icon","activeIcon")])),(r.label!==""||h.label!==void 0)&&we[s.value.action](ke("div",s.value.data,h.label!==void 0?h.label(U.value):[r.label])),Jr(h.tooltip,we)}return Bh(U1,{showing:y,onChildClick(we){V(we),p.value!==null&&p.value.$el.focus()}}),()=>ke("div",{class:q.value},[ke(Go,{ref:p,class:M.value,...r,noWrap:!0,stack:r.stacked,align:void 0,icon:void 0,label:void 0,noCaps:!0,fab:!0,"aria-expanded":y.value===!0?"true":"false","aria-haspopup":"true","aria-controls":b,"aria-owns":b,onClick:N},Ye),ke("div",{class:Y.value,..._e.value},Tn(h.default))])}}),oA={__name:"ButtonDesplegable",emits:["handleTabSelected"],setup(r,{emit:h}){return(p,y)=>(nr(),ps(rA,{"vertical-actions-align":"left","label-position":"bottom",glossy:"",color:"black",padding:"5px",icon:"menu",direction:"down","text-color":"white","label-style":{color:"white",width:"75px"}},{default:Ln(()=>[Ut(gc,{onClick:y[0]||(y[0]=b=>p.$emit("handleTabSelected","Inicio")),color:"warning",icon:"favorite",label:"Inicio","label-style":{color:"white",width:"60px",fontSize:"80%",padding:0},padding:"5px"}),Ut(gc,{onClick:y[1]||(y[1]=b=>p.$emit("handleTabSelected","Lugar")),color:"accent",icon:"room",label:"Lugar","label-style":{color:"white",width:"60px",fontSize:"80%",padding:0},padding:"5px"}),Ut(gc,{onClick:y[2]||(y[2]=b=>p.$emit("handleTabSelected","Asistencia")),color:"warning",icon:"group_add",label:"Asistencia","label-style":{color:"white",width:"60px",fontSize:"80%",padding:0},padding:"5px"}),Ut(gc,{onClick:y[3]||(y[3]=b=>p.$emit("handleTabSelected","Itinerario")),color:"accent",icon:"alarm",label:"Itinerario","label-style":{color:"white",width:"60px",fontSize:"80%",padding:0},padding:"5px"}),Ut(gc,{onClick:y[4]||(y[4]=b=>p.$emit("handleTabSelected","Regalos")),color:"warning",icon:"card_giftcard",label:"Regalos","label-style":{color:"white",width:"60px",fontSize:"80%",padding:0},padding:"5px"}),Ut(gc,{onClick:y[5]||(y[5]=b=>p.$emit("handleTabSelected","M\xFAsica")),color:"accent",icon:"music_note",label:"M\xFAsica","label-style":{color:"white",width:"60px",fontSize:"80%",padding:0},padding:"5px"})]),_:1}))}},sA="/assets/manos.293ea533.jpg",ca={dark:{type:Boolean,default:null}};function ua(r,h){return xe(()=>r.dark===null?h.dark.isActive:r.dark)}function aA({validate:r,resetValidation:h,requiresQForm:p}){const y=Zo(aC,!1);if(y!==!1){const{props:b,proxy:E}=Vi();Object.assign(E,{validate:r,resetValidation:h}),ri(()=>b.disable,M=>{M===!0?(typeof h=="function"&&h(),y.unbindComponent(E)):y.bindComponent(E)}),mr(()=>{b.disable!==!0&&y.bindComponent(E)}),mn(()=>{b.disable!==!0&&y.unbindComponent(E)})}else p===!0&&console.error("Parent QForm not found on useFormChild()!")}const e0=/^#[0-9a-fA-F]{3}([0-9a-fA-F]{3})?$/,t0=/^#[0-9a-fA-F]{4}([0-9a-fA-F]{4})?$/,i0=/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{4}|[0-9a-fA-F]{6}|[0-9a-fA-F]{8})$/,Ef=/^rgb\(((0|[1-9][\d]?|1[\d]{0,2}|2[\d]?|2[0-4][\d]|25[0-5]),){2}(0|[1-9][\d]?|1[\d]{0,2}|2[\d]?|2[0-4][\d]|25[0-5])\)$/,Sf=/^rgba\(((0|[1-9][\d]?|1[\d]{0,2}|2[\d]?|2[0-4][\d]|25[0-5]),){2}(0|[1-9][\d]?|1[\d]{0,2}|2[\d]?|2[0-4][\d]|25[0-5]),(0|0\.[0-9]+[1-9]|0\.[1-9]+|1)\)$/,r_={date:r=>/^-?[\d]+\/[0-1]\d\/[0-3]\d$/.test(r),time:r=>/^([0-1]?\d|2[0-3]):[0-5]\d$/.test(r),fulltime:r=>/^([0-1]?\d|2[0-3]):[0-5]\d:[0-5]\d$/.test(r),timeOrFulltime:r=>/^([0-1]?\d|2[0-3]):[0-5]\d(:[0-5]\d)?$/.test(r),email:r=>/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(r),hexColor:r=>e0.test(r),hexaColor:r=>t0.test(r),hexOrHexaColor:r=>i0.test(r),rgbColor:r=>Ef.test(r),rgbaColor:r=>Sf.test(r),rgbOrRgbaColor:r=>Ef.test(r)||Sf.test(r),hexOrRgbColor:r=>e0.test(r)||Ef.test(r),hexaOrRgbaColor:r=>t0.test(r)||Sf.test(r),anyColor:r=>i0.test(r)||Ef.test(r)||Sf.test(r)},lA=[!0,!1,"ondemand"],cA={modelValue:{},error:{type:Boolean,default:null},errorMessage:String,noErrorIcon:Boolean,rules:Array,reactiveRules:Boolean,lazyRules:{type:[Boolean,String],validator:r=>lA.includes(r)}};function uA(r,h){const{props:p,proxy:y}=Vi(),b=Rt(!1),E=Rt(null),M=Rt(null);aA({validate:_e,resetValidation:Y});let s=0,D;const V=xe(()=>p.rules!==void 0&&p.rules!==null&&p.rules.length>0),N=xe(()=>p.disable!==!0&&V.value===!0),U=xe(()=>p.error===!0||b.value===!0),q=xe(()=>typeof p.errorMessage=="string"&&p.errorMessage.length>0?p.errorMessage:E.value);ri(()=>p.modelValue,()=>{ve()}),ri(()=>p.reactiveRules,Ye=>{Ye===!0?D===void 0&&(D=ri(()=>p.rules,()=>{ve(!0)})):D!==void 0&&(D(),D=void 0)},{immediate:!0}),ri(r,Ye=>{Ye===!0?M.value===null&&(M.value=!1):M.value===!1&&(M.value=!0,N.value===!0&&p.lazyRules!=="ondemand"&&h.value===!1&&ze())});function Y(){s++,h.value=!1,M.value=null,b.value=!1,E.value=null,ze.cancel()}function _e(Ye=p.modelValue){if(N.value!==!0)return!0;const we=++s,Ue=h.value!==!0?()=>{M.value=!0}:()=>{},Ge=(De,be)=>{De===!0&&Ue(),b.value=De,E.value=be||null,h.value=!1},Se=[];for(let De=0;De<p.rules.length;De++){const be=p.rules[De];let Pe;if(typeof be=="function"?Pe=be(Ye,r_):typeof be=="string"&&r_[be]!==void 0&&(Pe=r_[be](Ye)),Pe===!1||typeof Pe=="string")return Ge(!0,Pe),!1;Pe!==!0&&Pe!==void 0&&Se.push(Pe)}return Se.length===0?(Ge(!1),!0):(h.value=!0,Promise.all(Se).then(De=>{if(De===void 0||Array.isArray(De)===!1||De.length===0)return we===s&&Ge(!1),!0;const be=De.find(Pe=>Pe===!1||typeof Pe=="string");return we===s&&Ge(be!==void 0,be),be===void 0},De=>(we===s&&(console.error(De),Ge(!0)),!1)))}function ve(Ye){N.value===!0&&p.lazyRules!=="ondemand"&&(M.value===!0||p.lazyRules!==!0&&Ye!==!0)&&ze()}const ze=ag(_e,0);return mn(()=>{D!==void 0&&D(),ze.cancel()}),Object.assign(y,{resetValidation:Y,validate:_e}),hp(y,"hasError",()=>U.value),{isDirtyModel:M,hasRules:V,hasError:U,errorMessage:q,validate:_e,resetValidation:Y}}const n0=/^on[A-Z]/;function hA(r,h){const p={listeners:Rt({}),attributes:Rt({})};function y(){const b={},E={};for(const M in r)M!=="class"&&M!=="style"&&n0.test(M)===!1&&(b[M]=r[M]);for(const M in h.props)n0.test(M)===!0&&(E[M]=h.props[M]);p.attributes.value=b,p.listeners.value=E}return Q_(y),y(),p}let cl=[],Ph=[];function lb(r){Ph=Ph.filter(h=>h!==r)}function dA(r){lb(r),Ph.push(r)}function r0(r){lb(r),Ph.length===0&&cl.length>0&&(cl[cl.length-1](),cl=[])}function _p(r){Ph.length===0?r():cl.push(r)}function fA(r){cl=cl.filter(h=>h!==r)}function M_(r){return r===void 0?`f_${ab()}`:r}function Dh(r){return r!=null&&(""+r).length>0}const gp={...ca,...cA,label:String,stackLabel:Boolean,hint:String,hideHint:Boolean,prefix:String,suffix:String,labelColor:String,color:String,bgColor:String,filled:Boolean,outlined:Boolean,borderless:Boolean,standout:[Boolean,String],square:Boolean,loading:Boolean,labelSlot:Boolean,bottomSlots:Boolean,hideBottomSpace:Boolean,rounded:Boolean,dense:Boolean,itemAligned:Boolean,counter:Boolean,clearable:Boolean,clearIcon:String,disable:Boolean,readonly:Boolean,autofocus:Boolean,for:String,maxlength:[Number,String]},_g=["update:modelValue","clear","focus","blur","popup-show","popup-hide"];function gg(){const{props:r,attrs:h,proxy:p,vnode:y}=Vi();return{isDark:ua(r,p.$q),editable:xe(()=>r.disable!==!0&&r.readonly!==!0),innerLoading:Rt(!1),focused:Rt(!1),hasPopupOpen:!1,splitAttrs:hA(h,y),targetUid:Rt(M_(r.for)),rootRef:Rt(null),targetRef:Rt(null),controlRef:Rt(null)}}function yg(r){const{props:h,emit:p,slots:y,attrs:b,proxy:E}=Vi(),{$q:M}=E;let s;r.hasValue===void 0&&(r.hasValue=xe(()=>Dh(h.modelValue))),r.emitValue===void 0&&(r.emitValue=ot=>{p("update:modelValue",ot)}),r.controlEvents===void 0&&(r.controlEvents={onFocusin:Xe,onFocusout:Ve}),Object.assign(r,{clearValue:nt,onControlFocusin:Xe,onControlFocusout:Ve,focus:be}),r.computedCounter===void 0&&(r.computedCounter=xe(()=>{if(h.counter!==!1){const ot=typeof h.modelValue=="string"||typeof h.modelValue=="number"?(""+h.modelValue).length:Array.isArray(h.modelValue)===!0?h.modelValue.length:0,At=h.maxlength!==void 0?h.maxlength:h.maxValues;return ot+(At!==void 0?" / "+At:"")}}));const{isDirtyModel:D,hasRules:V,hasError:N,errorMessage:U,resetValidation:q}=uA(r.focused,r.innerLoading),Y=r.floatingLabel!==void 0?xe(()=>h.stackLabel===!0||r.focused.value===!0||r.floatingLabel.value===!0):xe(()=>h.stackLabel===!0||r.focused.value===!0||r.hasValue.value===!0),_e=xe(()=>h.bottomSlots===!0||h.hint!==void 0||V.value===!0||h.counter===!0||h.error!==null),ve=xe(()=>h.filled===!0?"filled":h.outlined===!0?"outlined":h.borderless===!0?"borderless":h.standout?"standout":"standard"),ze=xe(()=>`q-field row no-wrap items-start q-field--${ve.value}`+(r.fieldClass!==void 0?` ${r.fieldClass.value}`:"")+(h.rounded===!0?" q-field--rounded":"")+(h.square===!0?" q-field--square":"")+(Y.value===!0?" q-field--float":"")+(we.value===!0?" q-field--labeled":"")+(h.dense===!0?" q-field--dense":"")+(h.itemAligned===!0?" q-field--item-aligned q-item-type":"")+(r.isDark.value===!0?" q-field--dark":"")+(r.getControl===void 0?" q-field--auto-height":"")+(r.focused.value===!0?" q-field--focused":"")+(N.value===!0?" q-field--error":"")+(N.value===!0||r.focused.value===!0?" q-field--highlighted":"")+(h.hideBottomSpace!==!0&&_e.value===!0?" q-field--with-bottom":"")+(h.disable===!0?" q-field--disabled":h.readonly===!0?" q-field--readonly":"")),Ye=xe(()=>"q-field__control relative-position row no-wrap"+(h.bgColor!==void 0?` bg-${h.bgColor}`:"")+(N.value===!0?" text-negative":typeof h.standout=="string"&&h.standout.length>0&&r.focused.value===!0?` ${h.standout}`:h.color!==void 0?` text-${h.color}`:"")),we=xe(()=>h.labelSlot===!0||h.label!==void 0),Ue=xe(()=>"q-field__label no-pointer-events absolute ellipsis"+(h.labelColor!==void 0&&N.value!==!0?` text-${h.labelColor}`:"")),Ge=xe(()=>({id:r.targetUid.value,editable:r.editable.value,focused:r.focused.value,floatingLabel:Y.value,modelValue:h.modelValue,emitValue:r.emitValue})),Se=xe(()=>{const ot={for:r.targetUid.value};return h.disable===!0?ot["aria-disabled"]="true":h.readonly===!0&&(ot["aria-readonly"]="true"),ot});ri(()=>h.for,ot=>{r.targetUid.value=M_(ot)});function De(){const ot=document.activeElement;let At=r.targetRef!==void 0&&r.targetRef.value;At&&(ot===null||ot.id!==r.targetUid.value)&&(At.hasAttribute("tabindex")===!0||(At=At.querySelector("[tabindex]")),At&&At!==ot&&At.focus({preventScroll:!0}))}function be(){_p(De)}function Pe(){fA(De);const ot=document.activeElement;ot!==null&&r.rootRef.value.contains(ot)&&ot.blur()}function Xe(ot){clearTimeout(s),r.editable.value===!0&&r.focused.value===!1&&(r.focused.value=!0,p("focus",ot))}function Ve(ot,At){clearTimeout(s),s=setTimeout(()=>{document.hasFocus()===!0&&(r.hasPopupOpen===!0||r.controlRef===void 0||r.controlRef.value===null||r.controlRef.value.contains(document.activeElement)!==!1)||(r.focused.value===!0&&(r.focused.value=!1,p("blur",ot)),At!==void 0&&At())})}function nt(ot){Mn(ot),M.platform.is.mobile!==!0?(r.targetRef!==void 0&&r.targetRef.value||r.rootRef.value).focus():r.rootRef.value.contains(document.activeElement)===!0&&document.activeElement.blur(),h.type==="file"&&(r.inputRef.value.value=null),p("update:modelValue",null),p("clear",h.modelValue),pn(()=>{q(),M.platform.is.mobile!==!0&&(D.value=!1)})}function qe(){const ot=[];return y.prepend!==void 0&&ot.push(ke("div",{class:"q-field__prepend q-field__marginal row no-wrap items-center",key:"prepend",onClick:Nr},y.prepend())),ot.push(ke("div",{class:"q-field__control-container col relative-position row no-wrap q-anchor--skip"},$e())),N.value===!0&&h.noErrorIcon===!1&&ot.push(Ft("error",[ke(jn,{name:M.iconSet.field.error,color:"negative"})])),h.loading===!0||r.innerLoading.value===!0?ot.push(Ft("inner-loading-append",y.loading!==void 0?y.loading():[ke(ug,{color:h.color})])):h.clearable===!0&&r.hasValue.value===!0&&r.editable.value===!0&&ot.push(Ft("inner-clearable-append",[ke(jn,{class:"q-field__focusable-action",tag:"button",name:h.clearIcon||M.iconSet.field.clear,tabindex:0,type:"button","aria-hidden":null,role:null,onClick:nt})])),y.append!==void 0&&ot.push(ke("div",{class:"q-field__append q-field__marginal row no-wrap items-center",key:"append",onClick:Nr},y.append())),r.getInnerAppend!==void 0&&ot.push(Ft("inner-append",r.getInnerAppend())),r.getControlChild!==void 0&&ot.push(r.getControlChild()),ot}function $e(){const ot=[];return h.prefix!==void 0&&h.prefix!==null&&ot.push(ke("div",{class:"q-field__prefix no-pointer-events row items-center"},h.prefix)),r.getShadowControl!==void 0&&r.hasShadow.value===!0&&ot.push(r.getShadowControl()),r.getControl!==void 0?ot.push(r.getControl()):y.rawControl!==void 0?ot.push(y.rawControl()):y.control!==void 0&&ot.push(ke("div",{ref:r.targetRef,class:"q-field__native row",tabindex:-1,...r.splitAttrs.attributes.value,"data-autofocus":h.autofocus===!0||void 0},y.control(Ge.value))),we.value===!0&&ot.push(ke("div",{class:Ue.value},Tn(y.label,h.label))),h.suffix!==void 0&&h.suffix!==null&&ot.push(ke("div",{class:"q-field__suffix no-pointer-events row items-center"},h.suffix)),ot.concat(Tn(y.default))}function Ke(){let ot,At;N.value===!0?U.value!==null?(ot=[ke("div",{role:"alert"},U.value)],At=`q--slot-error-${U.value}`):(ot=Tn(y.error),At="q--slot-error"):(h.hideHint!==!0||r.focused.value===!0)&&(h.hint!==void 0?(ot=[ke("div",h.hint)],At=`q--slot-hint-${h.hint}`):(ot=Tn(y.hint),At="q--slot-hint"));const di=h.counter===!0||y.counter!==void 0;if(h.hideBottomSpace===!0&&di===!1&&ot===void 0)return;const Fe=ke("div",{key:At,class:"q-field__messages col"},ot);return ke("div",{class:"q-field__bottom row items-start q-field__bottom--"+(h.hideBottomSpace!==!0?"animated":"stale"),onClick:Nr},[h.hideBottomSpace===!0?Fe:ke(ys,{name:"q-transition--field-message"},()=>Fe),di===!0?ke("div",{class:"q-field__counter"},y.counter!==void 0?y.counter():r.computedCounter.value):null])}function Ft(ot,At){return At===null?null:ke("div",{key:ot,class:"q-field__append q-field__marginal row no-wrap items-center q-anchor--skip"},At)}let Ht=!1;return Rh(()=>{Ht=!0}),Y_(()=>{Ht===!0&&h.autofocus===!0&&E.focus()}),mr(()=>{bo.value===!0&&h.for===void 0&&(r.targetUid.value=M_()),h.autofocus===!0&&E.focus()}),mn(()=>{clearTimeout(s)}),Object.assign(E,{focus:be,blur:Pe}),function(){const At=r.getControl===void 0&&y.control===void 0?{...r.splitAttrs.attributes.value,"data-autofocus":h.autofocus===!0||void 0,...Se.value}:Se.value;return ke("label",{ref:r.rootRef,class:[ze.value,b.class],style:b.style,...At},[y.before!==void 0?ke("div",{class:"q-field__before q-field__marginal row no-wrap items-center",onClick:Nr},y.before()):null,ke("div",{class:"q-field__inner relative-position col self-stretch"},[ke("div",{ref:r.controlRef,class:Ye.value,tabindex:-1,...r.controlEvents},qe()),_e.value===!0?Ke():null]),y.after!==void 0?ke("div",{class:"q-field__after q-field__marginal row no-wrap items-center",onClick:Nr},y.after()):null])}}const o0={date:"####/##/##",datetime:"####/##/## ##:##",time:"##:##",fulltime:"##:##:##",phone:"(###) ### - ####",card:"#### #### #### ####"},Hf={"#":{pattern:"[\\d]",negate:"[^\\d]"},S:{pattern:"[a-zA-Z]",negate:"[^a-zA-Z]"},N:{pattern:"[0-9a-zA-Z]",negate:"[^0-9a-zA-Z]"},A:{pattern:"[a-zA-Z]",negate:"[^a-zA-Z]",transform:r=>r.toLocaleUpperCase()},a:{pattern:"[a-zA-Z]",negate:"[^a-zA-Z]",transform:r=>r.toLocaleLowerCase()},X:{pattern:"[0-9a-zA-Z]",negate:"[^0-9a-zA-Z]",transform:r=>r.toLocaleUpperCase()},x:{pattern:"[0-9a-zA-Z]",negate:"[^0-9a-zA-Z]",transform:r=>r.toLocaleLowerCase()}},cb=Object.keys(Hf);cb.forEach(r=>{Hf[r].regex=new RegExp(Hf[r].pattern)});const pA=new RegExp("\\\\([^.*+?^${}()|([\\]])|([.*+?^${}()|[\\]])|(["+cb.join("")+"])|(.)","g"),s0=/[.*+?^${}()|[\]\\]/g,Nn=String.fromCharCode(1),mA={mask:String,reverseFillMask:Boolean,fillMask:[Boolean,String],unmaskedValue:Boolean};function _A(r,h,p,y){let b,E,M,s;const D=Rt(null),V=Rt(U());function N(){return r.autogrow===!0||["textarea","text","search","url","tel","password"].includes(r.type)}ri(()=>r.type+r.autogrow,Y),ri(()=>r.mask,De=>{if(De!==void 0)_e(V.value,!0);else{const be=Ge(V.value);Y(),r.modelValue!==be&&h("update:modelValue",be)}}),ri(()=>r.fillMask+r.reverseFillMask,()=>{D.value===!0&&_e(V.value,!0)}),ri(()=>r.unmaskedValue,()=>{D.value===!0&&_e(V.value)});function U(){if(Y(),D.value===!0){const De=we(Ge(r.modelValue));return r.fillMask!==!1?Se(De):De}return r.modelValue}function q(De){if(De<b.length)return b.slice(-De);let be="",Pe=b;const Xe=Pe.indexOf(Nn);if(Xe>-1){for(let Ve=De-Pe.length;Ve>0;Ve--)be+=Nn;Pe=Pe.slice(0,Xe)+be+Pe.slice(Xe)}return Pe}function Y(){if(D.value=r.mask!==void 0&&r.mask.length>0&&N(),D.value===!1){s=void 0,b="",E="";return}const De=o0[r.mask]===void 0?r.mask:o0[r.mask],be=typeof r.fillMask=="string"&&r.fillMask.length>0?r.fillMask.slice(0,1):"_",Pe=be.replace(s0,"\\$&"),Xe=[],Ve=[],nt=[];let qe=r.reverseFillMask===!0,$e="",Ke="";De.replace(pA,(At,di,Fe,_t,xt)=>{if(_t!==void 0){const Lt=Hf[_t];nt.push(Lt),Ke=Lt.negate,qe===!0&&(Ve.push("(?:"+Ke+"+)?("+Lt.pattern+"+)?(?:"+Ke+"+)?("+Lt.pattern+"+)?"),qe=!1),Ve.push("(?:"+Ke+"+)?("+Lt.pattern+")?")}else if(Fe!==void 0)$e="\\"+(Fe==="\\"?"":Fe),nt.push(Fe),Xe.push("([^"+$e+"]+)?"+$e+"?");else{const Lt=di!==void 0?di:xt;$e=Lt==="\\"?"\\\\\\\\":Lt.replace(s0,"\\\\$&"),nt.push(Lt),Xe.push("([^"+$e+"]+)?"+$e+"?")}});const Ft=new RegExp("^"+Xe.join("")+"("+($e===""?".":"[^"+$e+"]")+"+)?["+$e+"]*$"),Ht=Ve.length-1,ot=Ve.map((At,di)=>di===0&&r.reverseFillMask===!0?new RegExp("^"+Pe+"*"+At):di===Ht?new RegExp("^"+At+"("+(Ke===""?".":Ke)+"+)?"+(r.reverseFillMask===!0?"$":Pe+"*")):new RegExp("^"+At));M=nt,s=At=>{const di=Ft.exec(At);di!==null&&(At=di.slice(1).join(""));const Fe=[],_t=ot.length;for(let xt=0,Lt=At;xt<_t;xt++){const pi=ot[xt].exec(Lt);if(pi===null)break;Lt=Lt.slice(pi.shift().length),Fe.push(...pi)}return Fe.length>0?Fe.join(""):At},b=nt.map(At=>typeof At=="string"?At:Nn).join(""),E=b.split(Nn).join(be)}function _e(De,be,Pe){const Xe=y.value,Ve=Xe.selectionEnd,nt=Xe.value.length-Ve,qe=Ge(De);be===!0&&Y();const $e=we(qe),Ke=r.fillMask!==!1?Se($e):$e,Ft=V.value!==Ke;Xe.value!==Ke&&(Xe.value=Ke),Ft===!0&&(V.value=Ke),document.activeElement===Xe&&pn(()=>{if(Ke===E){const ot=r.reverseFillMask===!0?E.length:0;Xe.setSelectionRange(ot,ot,"forward");return}if(Pe==="insertFromPaste"&&r.reverseFillMask!==!0){const ot=Ve-1;ze.right(Xe,ot,ot);return}if(["deleteContentBackward","deleteContentForward"].indexOf(Pe)>-1){const ot=r.reverseFillMask===!0?Ve===0?Ke.length>$e.length?1:0:Math.max(0,Ke.length-(Ke===E?0:Math.min($e.length,nt)+1))+1:Ve;Xe.setSelectionRange(ot,ot,"forward");return}if(r.reverseFillMask===!0)if(Ft===!0){const ot=Math.max(0,Ke.length-(Ke===E?0:Math.min($e.length,nt+1)));ot===1&&Ve===1?Xe.setSelectionRange(ot,ot,"forward"):ze.rightReverse(Xe,ot,ot)}else{const ot=Ke.length-nt;Xe.setSelectionRange(ot,ot,"backward")}else if(Ft===!0){const ot=Math.max(0,b.indexOf(Nn),Math.min($e.length,Ve)-1);ze.right(Xe,ot,ot)}else{const ot=Ve-1;ze.right(Xe,ot,ot)}});const Ht=r.unmaskedValue===!0?Ge(Ke):Ke;String(r.modelValue)!==Ht&&p(Ht,!0)}function ve(De,be,Pe){const Xe=we(Ge(De.value));be=Math.max(0,b.indexOf(Nn),Math.min(Xe.length,be)),De.setSelectionRange(be,Pe,"forward")}const ze={left(De,be,Pe,Xe){const Ve=b.slice(be-1).indexOf(Nn)===-1;let nt=Math.max(0,be-1);for(;nt>=0;nt--)if(b[nt]===Nn){be=nt,Ve===!0&&be++;break}if(nt<0&&b[be]!==void 0&&b[be]!==Nn)return ze.right(De,0,0);be>=0&&De.setSelectionRange(be,Xe===!0?Pe:be,"backward")},right(De,be,Pe,Xe){const Ve=De.value.length;let nt=Math.min(Ve,Pe+1);for(;nt<=Ve;nt++)if(b[nt]===Nn){Pe=nt;break}else b[nt-1]===Nn&&(Pe=nt);if(nt>Ve&&b[Pe-1]!==void 0&&b[Pe-1]!==Nn)return ze.left(De,Ve,Ve);De.setSelectionRange(Xe?be:Pe,Pe,"forward")},leftReverse(De,be,Pe,Xe){const Ve=q(De.value.length);let nt=Math.max(0,be-1);for(;nt>=0;nt--)if(Ve[nt-1]===Nn){be=nt;break}else if(Ve[nt]===Nn&&(be=nt,nt===0))break;if(nt<0&&Ve[be]!==void 0&&Ve[be]!==Nn)return ze.rightReverse(De,0,0);be>=0&&De.setSelectionRange(be,Xe===!0?Pe:be,"backward")},rightReverse(De,be,Pe,Xe){const Ve=De.value.length,nt=q(Ve),qe=nt.slice(0,Pe+1).indexOf(Nn)===-1;let $e=Math.min(Ve,Pe+1);for(;$e<=Ve;$e++)if(nt[$e-1]===Nn){Pe=$e,Pe>0&&qe===!0&&Pe--;break}if($e>Ve&&nt[Pe-1]!==void 0&&nt[Pe-1]!==Nn)return ze.leftReverse(De,Ve,Ve);De.setSelectionRange(Xe===!0?be:Pe,Pe,"forward")}};function Ye(De){if(lg(De)===!0)return;const be=y.value,Pe=be.selectionStart,Xe=be.selectionEnd;if(De.keyCode===37||De.keyCode===39){const Ve=ze[(De.keyCode===39?"right":"left")+(r.reverseFillMask===!0?"Reverse":"")];De.preventDefault(),Ve(be,Pe,Xe,De.shiftKey)}else De.keyCode===8&&r.reverseFillMask!==!0&&Pe===Xe?ze.left(be,Pe,Xe,!0):De.keyCode===46&&r.reverseFillMask===!0&&Pe===Xe&&ze.rightReverse(be,Pe,Xe,!0)}function we(De){if(De==null||De==="")return"";if(r.reverseFillMask===!0)return Ue(De);const be=M;let Pe=0,Xe="";for(let Ve=0;Ve<be.length;Ve++){const nt=De[Pe],qe=be[Ve];if(typeof qe=="string")Xe+=qe,nt===qe&&Pe++;else if(nt!==void 0&&qe.regex.test(nt))Xe+=qe.transform!==void 0?qe.transform(nt):nt,Pe++;else return Xe}return Xe}function Ue(De){const be=M,Pe=b.indexOf(Nn);let Xe=De.length-1,Ve="";for(let nt=be.length-1;nt>=0&&Xe>-1;nt--){const qe=be[nt];let $e=De[Xe];if(typeof qe=="string")Ve=qe+Ve,$e===qe&&Xe--;else if($e!==void 0&&qe.regex.test($e))do Ve=(qe.transform!==void 0?qe.transform($e):$e)+Ve,Xe--,$e=De[Xe];while(Pe===nt&&$e!==void 0&&qe.regex.test($e));else return Ve}return Ve}function Ge(De){return typeof De!="string"||s===void 0?typeof De=="number"?s(""+De):De:s(De)}function Se(De){return E.length-De.length<=0?De:r.reverseFillMask===!0&&De.length>0?E.slice(0,-De.length)+De:De+E.slice(De.length)}return{innerValue:V,hasMask:D,moveCursorForPaste:ve,updateMaskValue:_e,onMaskedKeydown:Ye}}const vg={name:String};function gA(r={}){return(h,p,y)=>{h[p](ke("input",{class:"hidden"+(y||""),...r.value}))}}function ub(r){return xe(()=>r.name||r.for)}function yA(r,h){function p(){const y=r.modelValue;try{const b="DataTransfer"in window?new DataTransfer:"ClipboardEvent"in window?new ClipboardEvent("").clipboardData:void 0;return Object(y)===y&&("length"in y?Array.from(y):[y]).forEach(E=>{b.items.add(E)}),{files:b.files}}catch{return{files:void 0}}}return xe(h===!0?()=>{if(r.type==="file")return p()}:p)}const vA=/[\u3000-\u303f\u3040-\u309f\u30a0-\u30ff\uff00-\uff9f\u4e00-\u9faf\u3400-\u4dbf]/,xA=/[\u4e00-\u9fff\u3400-\u4dbf\u{20000}-\u{2a6df}\u{2a700}-\u{2b73f}\u{2b740}-\u{2b81f}\u{2b820}-\u{2ceaf}\uf900-\ufaff\u3300-\u33ff\ufe30-\ufe4f\uf900-\ufaff\u{2f800}-\u{2fa1f}]/u,bA=/[\u3131-\u314e\u314f-\u3163\uac00-\ud7a3]/,wA=/[a-z0-9_ -]$/i;function hb(r){return function(p){if(p.type==="compositionend"||p.type==="change"){if(p.target.qComposing!==!0)return;p.target.qComposing=!1,r(p)}else p.type==="compositionupdate"&&p.target.qComposing!==!0&&typeof p.data=="string"&&(dn.is.firefox===!0?wA.test(p.data)===!1:vA.test(p.data)===!0||xA.test(p.data)===!0||bA.test(p.data)===!0)===!0&&(p.target.qComposing=!0)}}const Cf=Hi({name:"QInput",inheritAttrs:!1,props:{...gp,...mA,...vg,modelValue:{required:!1},shadowText:String,type:{type:String,default:"text"},debounce:[String,Number],autogrow:Boolean,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[..._g,"paste","change"],setup(r,{emit:h,attrs:p}){const{proxy:y}=Vi(),{$q:b}=y,E={};let M=NaN,s,D,V,N;const U=Rt(null),q=ub(r),{innerValue:Y,hasMask:_e,moveCursorForPaste:ve,updateMaskValue:ze,onMaskedKeydown:Ye}=_A(r,h,Ke,U),we=yA(r,!0),Ue=xe(()=>Dh(Y.value)),Ge=hb($e),Se=gg(),De=xe(()=>r.type==="textarea"||r.autogrow===!0),be=xe(()=>De.value===!0||["text","search","url","tel","password"].includes(r.type)),Pe=xe(()=>{const Fe={...Se.splitAttrs.listeners.value,onInput:$e,onPaste:qe,onChange:Ht,onBlur:ot,onFocus:jo};return Fe.onCompositionstart=Fe.onCompositionupdate=Fe.onCompositionend=Ge,_e.value===!0&&(Fe.onKeydown=Ye),r.autogrow===!0&&(Fe.onAnimationend=Ft),Fe}),Xe=xe(()=>{const Fe={tabindex:0,"data-autofocus":r.autofocus===!0||void 0,rows:r.type==="textarea"?6:void 0,"aria-label":r.label,name:q.value,...Se.splitAttrs.attributes.value,id:Se.targetUid.value,maxlength:r.maxlength,disabled:r.disable===!0,readonly:r.readonly===!0};return De.value===!1&&(Fe.type=r.type),r.autogrow===!0&&(Fe.rows=1),Fe});ri(()=>r.type,()=>{U.value&&(U.value.value=r.modelValue)}),ri(()=>r.modelValue,Fe=>{if(_e.value===!0){if(D===!0&&(D=!1,String(Fe)===M))return;ze(Fe)}else Y.value!==Fe&&(Y.value=Fe,r.type==="number"&&E.hasOwnProperty("value")===!0&&(s===!0?s=!1:delete E.value));r.autogrow===!0&&pn(Ft)}),ri(()=>r.autogrow,Fe=>{Fe===!0?pn(Ft):U.value!==null&&p.rows>0&&(U.value.style.height="auto")}),ri(()=>r.dense,()=>{r.autogrow===!0&&pn(Ft)});function Ve(){_p(()=>{const Fe=document.activeElement;U.value!==null&&U.value!==Fe&&(Fe===null||Fe.id!==Se.targetUid.value)&&U.value.focus({preventScroll:!0})})}function nt(){U.value!==null&&U.value.select()}function qe(Fe){if(_e.value===!0&&r.reverseFillMask!==!0){const _t=Fe.target;ve(_t,_t.selectionStart,_t.selectionEnd)}h("paste",Fe)}function $e(Fe){if(!Fe||!Fe.target)return;if(r.type==="file"){h("update:modelValue",Fe.target.files);return}const _t=Fe.target.value;if(Fe.target.qComposing===!0){E.value=_t;return}if(_e.value===!0)ze(_t,!1,Fe.inputType);else if(Ke(_t),be.value===!0&&Fe.target===document.activeElement){const{selectionStart:xt,selectionEnd:Lt}=Fe.target;xt!==void 0&&Lt!==void 0&&pn(()=>{Fe.target===document.activeElement&&_t.indexOf(Fe.target.value)===0&&Fe.target.setSelectionRange(xt,Lt)})}r.autogrow===!0&&Ft()}function Ke(Fe,_t){N=()=>{r.type!=="number"&&E.hasOwnProperty("value")===!0&&delete E.value,r.modelValue!==Fe&&M!==Fe&&(M=Fe,_t===!0&&(D=!0),h("update:modelValue",Fe),pn(()=>{M===Fe&&(M=NaN)})),N=void 0},r.type==="number"&&(s=!0,E.value=Fe),r.debounce!==void 0?(clearTimeout(V),E.value=Fe,V=setTimeout(N,r.debounce)):N()}function Ft(){requestAnimationFrame(()=>{const Fe=U.value;if(Fe!==null){const _t=Fe.parentNode.style,{overflow:xt}=Fe.style;b.platform.is.firefox!==!0&&(Fe.style.overflow="hidden"),Fe.style.height="1px",_t.marginBottom=Fe.scrollHeight-1+"px",Fe.style.height=Fe.scrollHeight+"px",Fe.style.overflow=xt,_t.marginBottom=""}})}function Ht(Fe){Ge(Fe),clearTimeout(V),N!==void 0&&N(),h("change",Fe.target.value)}function ot(Fe){Fe!==void 0&&jo(Fe),clearTimeout(V),N!==void 0&&N(),s=!1,D=!1,delete E.value,r.type!=="file"&&setTimeout(()=>{U.value!==null&&(U.value.value=Y.value!==void 0?Y.value:"")})}function At(){return E.hasOwnProperty("value")===!0?E.value:Y.value!==void 0?Y.value:""}mn(()=>{ot()}),mr(()=>{r.autogrow===!0&&Ft()}),Object.assign(Se,{innerValue:Y,fieldClass:xe(()=>`q-${De.value===!0?"textarea":"input"}`+(r.autogrow===!0?" q-textarea--autogrow":"")),hasShadow:xe(()=>r.type!=="file"&&typeof r.shadowText=="string"&&r.shadowText.length>0),inputRef:U,emitValue:Ke,hasValue:Ue,floatingLabel:xe(()=>Ue.value===!0||Dh(r.displayValue)),getControl:()=>ke(De.value===!0?"textarea":"input",{ref:U,class:["q-field__native q-placeholder",r.inputClass],style:r.inputStyle,...Xe.value,...Pe.value,...r.type!=="file"?{value:At()}:we.value}),getShadowControl:()=>ke("div",{class:"q-field__native q-field__shadow absolute-bottom no-pointer-events"+(De.value===!0?"":" text-no-wrap")},[ke("span",{class:"invisible"},At()),ke("span",r.shadowText)])});const di=yg(Se);return Object.assign(y,{focus:Ve,select:nt,getNativeElement:()=>U.value}),di}}),TA=Hi({name:"QField",inheritAttrs:!1,props:gp,emits:_g,setup(){return yg(gg())}}),EA={xs:8,sm:10,md:14,lg:20,xl:24},SA=Hi({name:"QChip",props:{...ca,...pp,dense:Boolean,icon:String,iconRight:String,iconRemove:String,iconSelected:String,label:[String,Number],color:String,textColor:String,modelValue:{type:Boolean,default:!0},selected:{type:Boolean,default:null},square:Boolean,outline:Boolean,clickable:Boolean,removable:Boolean,removeAriaLabel:String,tabindex:[String,Number],disable:Boolean,ripple:{type:[Boolean,Object],default:!0}},emits:["update:modelValue","update:selected","remove","click"],setup(r,{slots:h,emit:p}){const{proxy:{$q:y}}=Vi(),b=ua(r,y),E=mp(r,EA),M=xe(()=>r.selected===!0||r.icon!==void 0),s=xe(()=>r.selected===!0?r.iconSelected||y.iconSet.chip.selected:r.icon),D=xe(()=>r.iconRemove||y.iconSet.chip.remove),V=xe(()=>r.disable===!1&&(r.clickable===!0||r.selected!==null)),N=xe(()=>{const ze=r.outline===!0&&r.color||r.textColor;return"q-chip row inline no-wrap items-center"+(r.outline===!1&&r.color!==void 0?` bg-${r.color}`:"")+(ze?` text-${ze} q-chip--colored`:"")+(r.disable===!0?" disabled":"")+(r.dense===!0?" q-chip--dense":"")+(r.outline===!0?" q-chip--outline":"")+(r.selected===!0?" q-chip--selected":"")+(V.value===!0?" q-chip--clickable cursor-pointer non-selectable q-hoverable":"")+(r.square===!0?" q-chip--square":"")+(b.value===!0?" q-chip--dark q-dark":"")}),U=xe(()=>r.disable===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:r.tabindex||0,role:"button","aria-hidden":"false","aria-label":r.removeAriaLabel||y.lang.label.remove});function q(ze){ze.keyCode===13&&Y(ze)}function Y(ze){r.disable||(p("update:selected",!r.selected),p("click",ze))}function _e(ze){(ze.keyCode===void 0||ze.keyCode===13)&&(Mn(ze),r.disable===!1&&(p("update:modelValue",!1),p("remove")))}function ve(){const ze=[];V.value===!0&&ze.push(ke("div",{class:"q-focus-helper"})),M.value===!0&&ze.push(ke(jn,{class:"q-chip__icon q-chip__icon--left",name:s.value}));const Ye=r.label!==void 0?[ke("div",{class:"ellipsis"},[r.label])]:void 0;return ze.push(ke("div",{class:"q-chip__content col row no-wrap items-center q-anchor--skip"},gC(h.default,Ye))),r.iconRight&&ze.push(ke(jn,{class:"q-chip__icon q-chip__icon--right",name:r.iconRight})),r.removable===!0&&ze.push(ke(jn,{class:"q-chip__icon q-chip__icon--remove cursor-pointer",name:D.value,...U.value,onClick:_e,onKeyup:_e})),ze}return()=>{if(r.modelValue===!1)return;const ze={class:N.value,style:E.value};return V.value===!0&&Object.assign(ze,U.value,{onClick:Y,onKeyup:q}),j1("div",ze,ve(),"ripple",r.ripple!==!1&&r.disable!==!0,()=>[[eb,r.ripple]])}}}),CA=Hi({name:"QItem",props:{...ca,...ib,tag:{type:String,default:"div"},active:{type:Boolean,default:null},clickable:Boolean,dense:Boolean,insetLevel:Number,tabindex:[String,Number],focused:Boolean,manualFocus:Boolean},emits:["click","keyup"],setup(r,{slots:h,emit:p}){const{proxy:{$q:y}}=Vi(),b=ua(r,y),{hasLink:E,linkAttrs:M,linkClass:s,linkTag:D,navigateOnClick:V}=nb(),N=Rt(null),U=Rt(null),q=xe(()=>r.clickable===!0||E.value===!0||r.tag==="label"),Y=xe(()=>r.disable!==!0&&q.value===!0),_e=xe(()=>"q-item q-item-type row no-wrap"+(r.dense===!0?" q-item--dense":"")+(b.value===!0?" q-item--dark":"")+(E.value===!0&&r.active===null?s.value:r.active===!0?` q-item--active${r.activeClass!==void 0?` ${r.activeClass}`:""}`:"")+(r.disable===!0?" disabled":"")+(Y.value===!0?" q-item--clickable q-link cursor-pointer "+(r.manualFocus===!0?"q-manual-focusable":"q-focusable q-hoverable")+(r.focused===!0?" q-manual-focusable--focused":""):"")),ve=xe(()=>{if(r.insetLevel===void 0)return null;const Ue=y.lang.rtl===!0?"Right":"Left";return{["padding"+Ue]:16+r.insetLevel*56+"px"}});function ze(Ue){Y.value===!0&&(U.value!==null&&(Ue.qKeyEvent!==!0&&document.activeElement===N.value?U.value.focus():document.activeElement===U.value&&N.value.focus()),V(Ue))}function Ye(Ue){if(Y.value===!0&&aa(Ue,13)===!0){Mn(Ue),Ue.qKeyEvent=!0;const Ge=new MouseEvent("click",Ue);Ge.qKeyEvent=!0,N.value.dispatchEvent(Ge)}p("keyup",Ue)}function we(){const Ue=hg(h.default,[]);return Y.value===!0&&Ue.unshift(ke("div",{class:"q-focus-helper",tabindex:-1,ref:U})),Ue}return()=>{const Ue={ref:N,class:_e.value,style:ve.value,onClick:ze,onKeyup:Ye};return Y.value===!0?(Ue.tabindex=r.tabindex||"0",Object.assign(Ue,M.value)):q.value===!0&&(Ue["aria-disabled"]="true"),ke(D.value,Ue,we())}}}),AA=Hi({name:"QItemSection",props:{avatar:Boolean,thumbnail:Boolean,side:Boolean,top:Boolean,noWrap:Boolean},setup(r,{slots:h}){const p=xe(()=>`q-item__section column q-item__section--${r.avatar===!0||r.side===!0||r.thumbnail===!0?"side":"main"}`+(r.top===!0?" q-item__section--top justify-start":" justify-center")+(r.avatar===!0?" q-item__section--avatar":"")+(r.thumbnail===!0?" q-item__section--thumbnail":"")+(r.noWrap===!0?" q-item__section--nowrap":""));return()=>ke("div",{class:p.value},Tn(h.default))}}),MA=Hi({name:"QItemLabel",props:{overline:Boolean,caption:Boolean,header:Boolean,lines:[Number,String]},setup(r,{slots:h}){const p=xe(()=>parseInt(r.lines,10)),y=xe(()=>"q-item__label"+(r.overline===!0?" q-item__label--overline text-overline":"")+(r.caption===!0?" q-item__label--caption text-caption":"")+(r.header===!0?" q-item__label--header":"")+(p.value===1?" ellipsis":"")),b=xe(()=>r.lines!==void 0&&p.value>1?{overflow:"hidden",display:"-webkit-box","-webkit-box-orient":"vertical","-webkit-line-clamp":p.value}:null);return()=>ke("div",{style:b.value,class:y.value},Tn(h.default))}});function db(){if(window.getSelection!==void 0){const r=window.getSelection();r.empty!==void 0?r.empty():r.removeAllRanges!==void 0&&(r.removeAllRanges(),qf.is.mobile!==!0&&r.addRange(document.createRange()))}else document.selection!==void 0&&document.selection.empty()}const IA={target:{default:!0},noParentEvent:Boolean,contextMenu:Boolean};function kA({showing:r,avoidEmit:h,configureAnchorEl:p}){const{props:y,proxy:b,emit:E}=Vi(),M=Rt(null);let s;function D(Y){return M.value===null?!1:Y===void 0||Y.touches===void 0||Y.touches.length<=1}const V={};p===void 0&&(Object.assign(V,{hide(Y){b.hide(Y)},toggle(Y){b.toggle(Y),Y.qAnchorHandled=!0},toggleKey(Y){aa(Y,13)===!0&&V.toggle(Y)},contextClick(Y){b.hide(Y),Nr(Y),pn(()=>{b.show(Y),Y.qAnchorHandled=!0})},prevent:Nr,mobileTouch(Y){if(V.mobileCleanup(Y),D(Y)!==!0)return;b.hide(Y),M.value.classList.add("non-selectable");const _e=Y.target;ll(V,"anchor",[[_e,"touchmove","mobileCleanup","passive"],[_e,"touchend","mobileCleanup","passive"],[_e,"touchcancel","mobileCleanup","passive"],[M.value,"contextmenu","prevent","notPassive"]]),s=setTimeout(()=>{b.show(Y),Y.qAnchorHandled=!0},300)},mobileCleanup(Y){M.value.classList.remove("non-selectable"),clearTimeout(s),r.value===!0&&Y!==void 0&&db()}}),p=function(Y=y.contextMenu){if(y.noParentEvent===!0||M.value===null)return;let _e;Y===!0?b.$q.platform.is.mobile===!0?_e=[[M.value,"touchstart","mobileTouch","passive"]]:_e=[[M.value,"mousedown","hide","passive"],[M.value,"contextmenu","contextClick","notPassive"]]:_e=[[M.value,"click","toggle","passive"],[M.value,"keyup","toggleKey","passive"]],ll(V,"anchor",_e)});function N(){Eh(V,"anchor")}function U(Y){for(M.value=Y;M.value.classList.contains("q-anchor--skip");)M.value=M.value.parentNode;p()}function q(){if(y.target===!1||y.target===""||b.$el.parentNode===null)M.value=null;else if(y.target===!0)U(b.$el.parentNode);else{let Y=y.target;if(typeof y.target=="string")try{Y=document.querySelector(y.target)}catch{Y=void 0}Y!=null?(M.value=Y.$el||Y,p()):(M.value=null,console.error(`Anchor: target "${y.target}" not found`))}}return ri(()=>y.contextMenu,Y=>{M.value!==null&&(N(),p(Y))}),ri(()=>y.target,()=>{M.value!==null&&N(),q()}),ri(()=>y.noParentEvent,Y=>{M.value!==null&&(Y===!0?N():p())}),mr(()=>{q(),h!==!0&&y.modelValue===!0&&M.value===null&&E("update:modelValue",!1)}),mn(()=>{clearTimeout(s),N()}),{anchorEl:M,canShow:D,anchorEvents:V}}function zA(r,h){const p=Rt(null);let y;function b(s,D){const V=`${D!==void 0?"add":"remove"}EventListener`,N=D!==void 0?D:y;s!==window&&s[V]("scroll",N,Bn.passive),window[V]("scroll",N,Bn.passive),y=D}function E(){p.value!==null&&(b(p.value),p.value=null)}const M=ri(()=>r.noParentEvent,()=>{p.value!==null&&(E(),h())});return mn(M),{localScrollTarget:p,unconfigureScrollTarget:E,changeScrollEvent:b}}let PA=document.body;function DA(r){const h=document.createElement("div");if(r!==void 0&&(h.id=r),Zf.globalNodes!==void 0){const p=Zf.globalNodes.class;p!==void 0&&(h.className=p)}return PA.appendChild(h),h}function LA(r){r.remove()}const Ec=[];function BA(r){return Ec.find(h=>h.__qPortalInnerRef.value!==null&&h.__qPortalInnerRef.value.contains(r))}function fb(r,h){do{if(r.$options.name==="QMenu"){if(r.hide(h),r.$props.separateClosePopup===!0)return Df(r)}else if(r.__qPortalInnerRef!==void 0){const p=Df(r);return p!==void 0&&p.$options.name==="QPopupProxy"?(r.hide(h),p):r}r=Df(r)}while(r!=null)}function RA(r,h,p){for(;p!==0&&r!==void 0&&r!==null;){if(r.__qPortalInnerRef!==void 0){if(p--,r.$options.name==="QMenu"){r=fb(r,h);continue}r.hide(h)}r=Df(r)}}function FA(r){for(r=r.parent;r!=null;){if(r.type.name==="QGlobalDialog")return!0;if(r.type.name==="QDialog"||r.type.name==="QMenu")return!1;r=r.parent}return!1}function pb(r,h,p,y){const b=Rt(!1),E=Rt(!1);let M=null;const s={},D=y===!0&&FA(r);function V(U){if(U===!0){r0(s),E.value=!0;return}E.value=!1,b.value===!1&&(D===!1&&M===null&&(M=DA()),b.value=!0,Ec.push(r.proxy),dA(s))}function N(U){if(E.value=!1,U!==!0)return;r0(s),b.value=!1;const q=Ec.indexOf(r.proxy);q!==-1&&Ec.splice(q,1),M!==null&&(LA(M),M=null)}return lp(()=>{N(!0)}),r.proxy.__qPortalInnerRef=h,{showPortal:V,hidePortal:N,portalIsActive:b,portalIsAccessible:E,renderPortal:()=>D===!0?p():b.value===!0?[ke(JE,{to:M},p())]:void 0}}const mb={transitionShow:{type:String,default:"fade"},transitionHide:{type:String,default:"fade"},transitionDuration:{type:[String,Number],default:300}};function OA(r,h){const p=Rt(h.value);return ri(h,y=>{pn(()=>{p.value=y})}),{transition:xe(()=>"q-transition--"+(p.value===!0?r.transitionHide:r.transitionShow)),transitionStyle:xe(()=>`--q-transition-duration: ${r.transitionDuration}ms`)}}function _b(){let r;const h=Vi();function p(){r=void 0}return Rh(p),mn(p),{removeTick:p,registerTick(y){r=y,pn(()=>{r===y&&(Z1(h)===!1&&r(),r=void 0)})}}}function gb(){let r;const h=Vi();function p(){clearTimeout(r)}return Rh(p),mn(p),{removeTimeout:p,registerTimeout(y,b){clearTimeout(r),Z1(h)===!1&&(r=setTimeout(y,b))}}}const dl=[];let kc;function VA(r){kc=r.keyCode===27}function UA(){kc===!0&&(kc=!1)}function NA(r){kc===!0&&(kc=!1,aa(r,27)===!0&&dl[dl.length-1](r))}function yb(r){window[r]("keydown",VA),window[r]("blur",UA),window[r]("keyup",NA),kc=!1}function vb(r){dn.is.desktop===!0&&(dl.push(r),dl.length===1&&yb("addEventListener"))}function Xf(r){const h=dl.indexOf(r);h>-1&&(dl.splice(h,1),dl.length===0&&yb("removeEventListener"))}const fl=[];function xb(r){fl[fl.length-1](r)}function bb(r){dn.is.desktop===!0&&(fl.push(r),fl.length===1&&document.body.addEventListener("focusin",xb))}function I_(r){const h=fl.indexOf(r);h>-1&&(fl.splice(h,1),fl.length===0&&document.body.removeEventListener("focusin",xb))}let wb;const{notPassiveCapture:Kf}=Bn,pl=[];function Yf(r){clearTimeout(wb);const h=r.target;if(h===void 0||h.nodeType===8||h.classList.contains("no-pointer-events")===!0)return;let p=Ec.length-1;for(;p>=0;){const y=Ec[p].$;if(y.type.name!=="QDialog")break;if(y.props.seamless!==!0)return;p--}for(let y=pl.length-1;y>=0;y--){const b=pl[y];if((b.anchorEl.value===null||b.anchorEl.value.contains(h)===!1)&&(h===document.body||b.innerRef.value!==null&&b.innerRef.value.contains(h)===!1))r.qClickOutside=!0,b.onClickOutside(r);else return}}function jA(r){pl.push(r),pl.length===1&&(document.addEventListener("mousedown",Yf,Kf),document.addEventListener("touchstart",Yf,Kf))}function a0(r){const h=pl.findIndex(p=>p===r);h>-1&&(pl.splice(h,1),pl.length===0&&(clearTimeout(wb),document.removeEventListener("mousedown",Yf,Kf),document.removeEventListener("touchstart",Yf,Kf)))}let l0,c0;function u0(r){const h=r.split(" ");return h.length!==2?!1:["top","center","bottom"].includes(h[0])!==!0?(console.error("Anchor/Self position must start with one of top/center/bottom"),!1):["left","middle","right","start","end"].includes(h[1])!==!0?(console.error("Anchor/Self position must end with one of left/middle/right/start/end"),!1):!0}function qA(r){return r?!(r.length!==2||typeof r[0]!="number"||typeof r[1]!="number"):!0}const k_={"start#ltr":"left","start#rtl":"right","end#ltr":"right","end#rtl":"left"};["left","middle","right"].forEach(r=>{k_[`${r}#ltr`]=r,k_[`${r}#rtl`]=r});function h0(r,h){const p=r.split(" ");return{vertical:p[0],horizontal:k_[`${p[1]}#${h===!0?"rtl":"ltr"}`]}}function $A(r,h){let{top:p,left:y,right:b,bottom:E,width:M,height:s}=r.getBoundingClientRect();return h!==void 0&&(p-=h[1],y-=h[0],E+=h[1],b+=h[0],M+=h[0],s+=h[1]),{top:p,left:y,right:b,bottom:E,width:M,height:s,middle:y+(b-y)/2,center:p+(E-p)/2}}function GA(r){return{top:0,center:r.offsetHeight/2,bottom:r.offsetHeight,left:0,middle:r.offsetWidth/2,right:r.offsetWidth}}function ZA(r){if(dn.is.ios===!0&&window.visualViewport!==void 0){const s=document.body.style,{offsetLeft:D,offsetTop:V}=window.visualViewport;D!==l0&&(s.setProperty("--q-pe-left",D+"px"),l0=D),V!==c0&&(s.setProperty("--q-pe-top",V+"px"),c0=V)}let h;const{scrollLeft:p,scrollTop:y}=r.el;if(r.absoluteOffset===void 0)h=$A(r.anchorEl,r.cover===!0?[0,0]:r.offset);else{const{top:s,left:D}=r.anchorEl.getBoundingClientRect(),V=s+r.absoluteOffset.top,N=D+r.absoluteOffset.left;h={top:V,left:N,width:1,height:1,right:N+1,center:V,middle:N,bottom:V+1}}let b={maxHeight:r.maxHeight,maxWidth:r.maxWidth,visibility:"visible"};(r.fit===!0||r.cover===!0)&&(b.minWidth=h.width+"px",r.cover===!0&&(b.minHeight=h.height+"px")),Object.assign(r.el.style,b);const E=GA(r.el),M={top:h[r.anchorOrigin.vertical]-E[r.selfOrigin.vertical],left:h[r.anchorOrigin.horizontal]-E[r.selfOrigin.horizontal]};WA(M,h,E,r.anchorOrigin,r.selfOrigin),b={top:M.top+"px",left:M.left+"px"},M.maxHeight!==void 0&&(b.maxHeight=M.maxHeight+"px",h.height>M.maxHeight&&(b.minHeight=b.maxHeight)),M.maxWidth!==void 0&&(b.maxWidth=M.maxWidth+"px",h.width>M.maxWidth&&(b.minWidth=b.maxWidth)),Object.assign(r.el.style,b),r.el.scrollTop!==y&&(r.el.scrollTop=y),r.el.scrollLeft!==p&&(r.el.scrollLeft=p)}function WA(r,h,p,y,b){const E=p.bottom,M=p.right,s=Lf(),D=window.innerHeight-s,V=document.body.clientWidth;if(r.top<0||r.top+E>D)if(b.vertical==="center")r.top=h[y.vertical]>D/2?Math.max(0,D-E):0,r.maxHeight=Math.min(E,D);else if(h[y.vertical]>D/2){const N=Math.min(D,y.vertical==="center"?h.center:y.vertical===b.vertical?h.bottom:h.top);r.maxHeight=Math.min(E,N),r.top=Math.max(0,N-E)}else r.top=Math.max(0,y.vertical==="center"?h.center:y.vertical===b.vertical?h.top:h.bottom),r.maxHeight=Math.min(E,D-r.top);if(r.left<0||r.left+M>V)if(r.maxWidth=Math.min(M,V),b.horizontal==="middle")r.left=h[y.horizontal]>V/2?Math.max(0,V-M):0;else if(h[y.horizontal]>V/2){const N=Math.min(V,y.horizontal==="middle"?h.middle:y.horizontal===b.horizontal?h.right:h.left);r.maxWidth=Math.min(M,N),r.left=Math.max(0,N-r.maxWidth)}else r.left=Math.max(0,y.horizontal==="middle"?h.middle:y.horizontal===b.horizontal?h.left:h.right),r.maxWidth=Math.min(M,V-r.left)}const HA=Hi({name:"QMenu",inheritAttrs:!1,props:{...IA,...fg,...ca,...mb,persistent:Boolean,autoClose:Boolean,separateClosePopup:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,fit:Boolean,cover:Boolean,square:Boolean,anchor:{type:String,validator:u0},self:{type:String,validator:u0},offset:{type:Array,validator:qA},scrollTarget:{default:void 0},touchPosition:Boolean,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null}},emits:[...pg,"click","escape-key"],setup(r,{slots:h,emit:p,attrs:y}){let b=null,E,M,s;const D=Vi(),{proxy:V}=D,{$q:N}=V,U=Rt(null),q=Rt(!1),Y=xe(()=>r.persistent!==!0&&r.noRouteDismiss!==!0),_e=ua(r,N),{registerTick:ve,removeTick:ze}=_b(),{registerTimeout:Ye}=gb(),{transition:we,transitionStyle:Ue}=OA(r,q),{localScrollTarget:Ge,changeScrollEvent:Se,unconfigureScrollTarget:De}=zA(r,Lt),{anchorEl:be,canShow:Pe}=kA({showing:q}),{hide:Xe}=mg({showing:q,canShow:Pe,handleShow:Fe,handleHide:_t,hideOnRouteChange:Y,processOnMount:!0}),{showPortal:Ve,hidePortal:nt,renderPortal:qe}=pb(D,U,Jt),$e={anchorEl:be,innerRef:U,onClickOutside(Et){if(r.persistent!==!0&&q.value===!0)return Xe(Et),(Et.type==="touchstart"||Et.target.classList.contains("q-dialog__backdrop"))&&Mn(Et),!0}},Ke=xe(()=>h0(r.anchor||(r.cover===!0?"center middle":"bottom start"),N.lang.rtl)),Ft=xe(()=>r.cover===!0?Ke.value:h0(r.self||"top start",N.lang.rtl)),Ht=xe(()=>(r.square===!0?" q-menu--square":"")+(_e.value===!0?" q-menu--dark q-dark":"")),ot=xe(()=>r.autoClose===!0?{onClick:pi}:{}),At=xe(()=>q.value===!0&&r.persistent!==!0);ri(At,Et=>{Et===!0?(vb(Kt),jA($e)):(Xf(Kt),a0($e))});function di(){_p(()=>{let Et=U.value;Et&&Et.contains(document.activeElement)!==!0&&(Et=Et.querySelector("[autofocus], [data-autofocus]")||Et,Et.focus({preventScroll:!0}))})}function Fe(Et){if(b=r.noRefocus===!1?document.activeElement:null,bb(Si),Ve(),Lt(),E=void 0,Et!==void 0&&(r.touchPosition||r.contextMenu)){const Bi=$f(Et);if(Bi.left!==void 0){const{top:xn,left:ue}=be.value.getBoundingClientRect();E={left:Bi.left-ue,top:Bi.top-xn}}}M===void 0&&(M=ri(()=>N.screen.width+"|"+N.screen.height+"|"+r.self+"|"+r.anchor+"|"+N.lang.rtl,Yt)),r.noFocus!==!0&&document.activeElement.blur(),ve(()=>{Yt(),r.noFocus!==!0&&di()}),Ye(()=>{N.platform.is.ios===!0&&(s=r.autoClose,U.value.click()),Yt(),Ve(!0),p("show",Et)},r.transitionDuration)}function _t(Et){ze(),nt(),xt(!0),b!==null&&(Et===void 0||Et.qClickOutside!==!0)&&(b.focus(),b=null),Ye(()=>{nt(!0),p("hide",Et)},r.transitionDuration)}function xt(Et){E=void 0,M!==void 0&&(M(),M=void 0),(Et===!0||q.value===!0)&&(I_(Si),De(),a0($e),Xf(Kt)),Et!==!0&&(b=null)}function Lt(){(be.value!==null||r.scrollTarget!==void 0)&&(Ge.value=H1(be.value,r.scrollTarget),Se(Ge.value,Yt))}function pi(Et){s!==!0?(fb(V,Et),p("click",Et)):s=!1}function Si(Et){At.value===!0&&r.noFocus!==!0&&W1(U.value,Et.target)!==!0&&di()}function Kt(Et){p("escape-key"),Xe(Et)}function Yt(){const Et=U.value;Et===null||be.value===null||ZA({el:Et,offset:r.offset,anchorEl:be.value,anchorOrigin:Ke.value,selfOrigin:Ft.value,absoluteOffset:E,fit:r.fit,cover:r.cover,maxHeight:r.maxHeight,maxWidth:r.maxWidth})}function Jt(){return ke(ys,{name:we.value,appear:!0},()=>q.value===!0?ke("div",{role:"menu",...y,ref:U,tabindex:-1,class:["q-menu q-position-engine scroll"+Ht.value,y.class],style:[y.style,Ue.value],...ot.value},Tn(h.default)):null)}return mn(xt),Object.assign(V,{focus:di,updatePosition:Yt}),qe}});function XA(r,h,p){let y;function b(){y!==void 0&&(zh.remove(y),y=void 0)}return mn(()=>{r.value===!0&&b()}),{removeFromHistory:b,addToHistory(){y={condition:()=>p.value===!0,handler:h},zh.add(y)}}}let hh=0,o_,s_,yh,a_=!1,d0,f0,yc;function KA(r){YA(r)&&Mn(r)}function YA(r){if(r.target===document.body||r.target.classList.contains("q-layout__backdrop"))return!0;const h=ZS(r),p=r.shiftKey&&!r.deltaX,y=!p&&Math.abs(r.deltaX)<=Math.abs(r.deltaY),b=p||y?r.deltaY:r.deltaX;for(let E=0;E<h.length;E++){const M=h[E];if(kC(M,y))return y?b<0&&M.scrollTop===0?!0:b>0&&M.scrollTop+M.clientHeight===M.scrollHeight:b<0&&M.scrollLeft===0?!0:b>0&&M.scrollLeft+M.clientWidth===M.scrollWidth}return!0}function p0(r){r.target===document&&(document.scrollingElement.scrollTop=document.scrollingElement.scrollTop)}function Af(r){a_!==!0&&(a_=!0,requestAnimationFrame(()=>{a_=!1;const{height:h}=r.target,{clientHeight:p,scrollTop:y}=document.scrollingElement;(yh===void 0||h!==window.innerHeight)&&(yh=p-h,document.scrollingElement.scrollTop=y),y>yh&&(document.scrollingElement.scrollTop-=Math.ceil((y-yh)/8))}))}function m0(r){const h=document.body,p=window.visualViewport!==void 0;if(r==="add"){const{overflowY:y,overflowX:b}=window.getComputedStyle(h);o_=K1(window),s_=X1(window),d0=h.style.left,f0=h.style.top,h.style.left=`-${o_}px`,h.style.top=`-${s_}px`,b!=="hidden"&&(b==="scroll"||h.scrollWidth>window.innerWidth)&&h.classList.add("q-body--force-scrollbar-x"),y!=="hidden"&&(y==="scroll"||h.scrollHeight>window.innerHeight)&&h.classList.add("q-body--force-scrollbar-y"),h.classList.add("q-body--prevent-scroll"),document.qScrollPrevented=!0,dn.is.ios===!0&&(p===!0?(window.scrollTo(0,0),window.visualViewport.addEventListener("resize",Af,Bn.passiveCapture),window.visualViewport.addEventListener("scroll",Af,Bn.passiveCapture),window.scrollTo(0,0)):window.addEventListener("scroll",p0,Bn.passiveCapture))}dn.is.desktop===!0&&dn.is.mac===!0&&window[`${r}EventListener`]("wheel",KA,Bn.notPassive),r==="remove"&&(dn.is.ios===!0&&(p===!0?(window.visualViewport.removeEventListener("resize",Af,Bn.passiveCapture),window.visualViewport.removeEventListener("scroll",Af,Bn.passiveCapture)):window.removeEventListener("scroll",p0,Bn.passiveCapture)),h.classList.remove("q-body--prevent-scroll"),h.classList.remove("q-body--force-scrollbar-x"),h.classList.remove("q-body--force-scrollbar-y"),document.qScrollPrevented=!1,h.style.left=d0,h.style.top=f0,window.scrollTo(o_,s_),yh=void 0)}function JA(r){let h="add";if(r===!0){if(hh++,yc!==void 0){clearTimeout(yc),yc=void 0;return}if(hh>1)return}else{if(hh===0||(hh--,hh>0))return;if(h="remove",dn.is.ios===!0&&dn.is.nativeMobile===!0){clearTimeout(yc),yc=setTimeout(()=>{m0(h),yc=void 0},100);return}}m0(h)}function QA(){let r;return{preventBodyScroll(h){h!==r&&(r!==void 0||h===!0)&&(r=h,JA(h))}}}let Mf=0;const eM={standard:"fixed-full flex-center",top:"fixed-top justify-center",bottom:"fixed-bottom justify-center",right:"fixed-right items-center",left:"fixed-left items-center"},_0={standard:["scale","scale"],top:["slide-down","slide-up"],bottom:["slide-up","slide-down"],right:["slide-left","slide-right"],left:["slide-right","slide-left"]},Tb=Hi({name:"QDialog",inheritAttrs:!1,props:{...fg,...mb,transitionShow:String,transitionHide:String,persistent:Boolean,autoClose:Boolean,allowFocusOutside:Boolean,noEscDismiss:Boolean,noBackdropDismiss:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,noShake:Boolean,seamless:Boolean,maximized:Boolean,fullWidth:Boolean,fullHeight:Boolean,square:Boolean,position:{type:String,default:"standard",validator:r=>r==="standard"||["top","bottom","left","right"].includes(r)}},emits:[...pg,"shake","click","escape-key"],setup(r,{slots:h,emit:p,attrs:y}){const b=Vi(),E=Rt(null),M=Rt(!1),s=Rt(!1),D=Rt(!1);let V,N=null,U,q;const Y=xe(()=>r.persistent!==!0&&r.noRouteDismiss!==!0&&r.seamless!==!0),{preventBodyScroll:_e}=QA(),{registerTimeout:ve}=gb(),{registerTick:ze,removeTick:Ye}=_b(),{showPortal:we,hidePortal:Ue,portalIsAccessible:Ge,renderPortal:Se}=pb(b,E,Yt,!0),{hide:De}=mg({showing:M,hideOnRouteChange:Y,handleShow:ot,handleHide:At,processOnMount:!0}),{addToHistory:be,removeFromHistory:Pe}=XA(M,De,Y),Xe=xe(()=>`q-dialog__inner flex no-pointer-events q-dialog__inner--${r.maximized===!0?"maximized":"minimized"} q-dialog__inner--${r.position} ${eM[r.position]}`+(D.value===!0?" q-dialog__inner--animating":"")+(r.fullWidth===!0?" q-dialog__inner--fullwidth":"")+(r.fullHeight===!0?" q-dialog__inner--fullheight":"")+(r.square===!0?" q-dialog__inner--square":"")),Ve=xe(()=>"q-transition--"+(r.transitionShow===void 0?_0[r.position][0]:r.transitionShow)),nt=xe(()=>"q-transition--"+(r.transitionHide===void 0?_0[r.position][1]:r.transitionHide)),qe=xe(()=>s.value===!0?nt.value:Ve.value),$e=xe(()=>`--q-transition-duration: ${r.transitionDuration}ms`),Ke=xe(()=>M.value===!0&&r.seamless!==!0),Ft=xe(()=>r.autoClose===!0?{onClick:pi}:{}),Ht=xe(()=>[`q-dialog fullscreen no-pointer-events q-dialog--${Ke.value===!0?"modal":"seamless"}`,y.class]);ri(M,Jt=>{pn(()=>{s.value=Jt})}),ri(()=>r.maximized,Jt=>{M.value===!0&&Lt(Jt)}),ri(Ke,Jt=>{_e(Jt),Jt===!0?(bb(Kt),vb(_t)):(I_(Kt),Xf(_t))});function ot(Jt){be(),N=r.noRefocus===!1&&document.activeElement!==null?document.activeElement:null,Lt(r.maximized),we(),D.value=!0,r.noFocus!==!0?(document.activeElement!==null&&document.activeElement.blur(),ze(di)):Ye(),ve(()=>{if(b.proxy.$q.platform.is.ios===!0){if(r.seamless!==!0&&document.activeElement){const{top:Et,bottom:Bi}=document.activeElement.getBoundingClientRect(),{innerHeight:xn}=window,ue=window.visualViewport!==void 0?window.visualViewport.height:xn;Et>0&&Bi>ue/2&&(document.scrollingElement.scrollTop=Math.min(document.scrollingElement.scrollHeight-ue,Bi>=xn?1/0:Math.ceil(document.scrollingElement.scrollTop+Bi-ue/2))),document.activeElement.scrollIntoView()}q=!0,E.value.click(),q=!1}we(!0),D.value=!1,p("show",Jt)},r.transitionDuration)}function At(Jt){Ye(),Pe(),xt(!0),D.value=!0,Ue(),N!==null&&(N.focus(),N=null),ve(()=>{Ue(!0),D.value=!1,p("hide",Jt)},r.transitionDuration)}function di(Jt){_p(()=>{let Et=E.value;Et===null||Et.contains(document.activeElement)===!0||(Et=Et.querySelector(Jt||"[autofocus], [data-autofocus]")||Et,Et.focus({preventScroll:!0}))})}function Fe(){di(),p("shake");const Jt=E.value;Jt!==null&&(Jt.classList.remove("q-animate--scale"),Jt.classList.add("q-animate--scale"),clearTimeout(V),V=setTimeout(()=>{E.value!==null&&(Jt.classList.remove("q-animate--scale"),di())},170))}function _t(){r.seamless!==!0&&(r.persistent===!0||r.noEscDismiss===!0?r.maximized!==!0&&r.noShake!==!0&&Fe():(p("escape-key"),De()))}function xt(Jt){clearTimeout(V),(Jt===!0||M.value===!0)&&(Lt(!1),r.seamless!==!0&&(_e(!1),I_(Kt),Xf(_t))),Jt!==!0&&(N=null)}function Lt(Jt){Jt===!0?U!==!0&&(Mf<1&&document.body.classList.add("q-body--dialog"),Mf++,U=!0):U===!0&&(Mf<2&&document.body.classList.remove("q-body--dialog"),Mf--,U=!1)}function pi(Jt){q!==!0&&(De(Jt),p("click",Jt))}function Si(Jt){r.persistent!==!0&&r.noBackdropDismiss!==!0?De(Jt):r.noShake!==!0&&Fe()}function Kt(Jt){r.allowFocusOutside!==!0&&Ge.value===!0&&W1(E.value,Jt.target)!==!0&&di('[tabindex]:not([tabindex="-1"])')}Object.assign(b.proxy,{focus:di,shake:Fe,__updateRefocusTarget(Jt){N=Jt||null}}),mn(xt);function Yt(){return ke("div",{"aria-modal":"true",...y,class:Ht.value},[ke(ys,{name:"q-transition--fade",appear:!0},()=>Ke.value===!0?ke("div",{class:"q-dialog__backdrop fixed-full",style:$e.value,"aria-hidden":"true",onMousedown:Si}):null),ke(ys,{name:qe.value,appear:!0},()=>M.value===!0?ke("div",{ref:E,class:Xe.value,style:$e.value,tabindex:-1,...Ft.value},Tn(h.default)):null)])}return Se}});let Jf=!1;{const r=document.createElement("div");r.setAttribute("dir","rtl"),Object.assign(r.style,{width:"1px",height:"1px",overflow:"auto"});const h=document.createElement("div");Object.assign(h.style,{width:"1000px",height:"1px"}),document.body.appendChild(r),r.appendChild(h),r.scrollLeft=-1e3,Jf=r.scrollLeft>=0,r.remove()}const mo=1e3,tM=["start","center","end","start-force","center-force","end-force"],Eb=Array.prototype.filter,iM=window.getComputedStyle(document.body).overflowAnchor===void 0?Wo:function(r,h){r!==null&&(cancelAnimationFrame(r._qOverflowAnimationFrame),r._qOverflowAnimationFrame=requestAnimationFrame(()=>{if(r===null)return;const p=r.children||[];Eb.call(p,b=>b.dataset&&b.dataset.qVsAnchor!==void 0).forEach(b=>{delete b.dataset.qVsAnchor});const y=p[h];y&&y.dataset&&(y.dataset.qVsAnchor="")}))};function Sc(r,h){return r+h}function l_(r,h,p,y,b,E,M,s){const D=r===window?document.scrollingElement||document.documentElement:r,V=b===!0?"offsetWidth":"offsetHeight",N={scrollStart:0,scrollViewSize:-M-s,scrollMaxSize:0,offsetStart:-M,offsetEnd:-s};if(b===!0?(r===window?(N.scrollStart=window.pageXOffset||window.scrollX||document.body.scrollLeft||0,N.scrollViewSize+=document.documentElement.clientWidth):(N.scrollStart=D.scrollLeft,N.scrollViewSize+=D.clientWidth),N.scrollMaxSize=D.scrollWidth,E===!0&&(N.scrollStart=(Jf===!0?N.scrollMaxSize-N.scrollViewSize:0)-N.scrollStart)):(r===window?(N.scrollStart=window.pageYOffset||window.scrollY||document.body.scrollTop||0,N.scrollViewSize+=document.documentElement.clientHeight):(N.scrollStart=D.scrollTop,N.scrollViewSize+=D.clientHeight),N.scrollMaxSize=D.scrollHeight),p!==null)for(let U=p.previousElementSibling;U!==null;U=U.previousElementSibling)U.classList.contains("q-virtual-scroll--skip")===!1&&(N.offsetStart+=U[V]);if(y!==null)for(let U=y.nextElementSibling;U!==null;U=U.nextElementSibling)U.classList.contains("q-virtual-scroll--skip")===!1&&(N.offsetEnd+=U[V]);if(h!==r){const U=D.getBoundingClientRect(),q=h.getBoundingClientRect();b===!0?(N.offsetStart+=q.left-U.left,N.offsetEnd-=q.width):(N.offsetStart+=q.top-U.top,N.offsetEnd-=q.height),r!==window&&(N.offsetStart+=N.scrollStart),N.offsetEnd+=N.scrollMaxSize-N.offsetStart}return N}function g0(r,h,p,y){h==="end"&&(h=(r===window?document.body:r)[p===!0?"scrollWidth":"scrollHeight"]),r===window?p===!0?(y===!0&&(h=(Jf===!0?document.body.scrollWidth-document.documentElement.clientWidth:0)-h),window.scrollTo(h,window.pageYOffset||window.scrollY||document.body.scrollTop||0)):window.scrollTo(window.pageXOffset||window.scrollX||document.body.scrollLeft||0,h):p===!0?(y===!0&&(h=(Jf===!0?r.scrollWidth-r.offsetWidth:0)-h),r.scrollLeft=h):r.scrollTop=h}function dh(r,h,p,y){if(p>=y)return 0;const b=h.length,E=Math.floor(p/mo),M=Math.floor((y-1)/mo)+1;let s=r.slice(E,M).reduce(Sc,0);return p%mo!==0&&(s-=h.slice(E*mo,p).reduce(Sc,0)),y%mo!==0&&y!==b&&(s-=h.slice(y,M*mo).reduce(Sc,0)),s}const nM={virtualScrollSliceSize:{type:[Number,String],default:null},virtualScrollSliceRatioBefore:{type:[Number,String],default:1},virtualScrollSliceRatioAfter:{type:[Number,String],default:1},virtualScrollItemSize:{type:[Number,String],default:24},virtualScrollStickySizeStart:{type:[Number,String],default:0},virtualScrollStickySizeEnd:{type:[Number,String],default:0},tableColspan:[Number,String]},rM={virtualScrollHorizontal:Boolean,onVirtualScroll:Function,...nM};function oM({virtualScrollLength:r,getVirtualScrollTarget:h,getVirtualScrollEl:p,virtualScrollItemSizeComputed:y}){const b=Vi(),{props:E,emit:M,proxy:s}=b,{$q:D}=s;let V,N,U,q=[],Y;const _e=Rt(0),ve=Rt(0),ze=Rt({}),Ye=Rt(null),we=Rt(null),Ue=Rt(null),Ge=Rt({from:0,to:0}),Se=xe(()=>E.tableColspan!==void 0?E.tableColspan:100);y===void 0&&(y=xe(()=>E.virtualScrollItemSize));const De=xe(()=>y.value+";"+E.virtualScrollHorizontal),be=xe(()=>De.value+";"+E.virtualScrollSliceRatioBefore+";"+E.virtualScrollSliceRatioAfter);ri(be,()=>{Ht()}),ri(De,Pe);function Pe(){Ft(N,!0)}function Xe(_t){Ft(_t===void 0?N:_t)}function Ve(_t,xt){const Lt=h();if(Lt==null||Lt.nodeType===8)return;const pi=l_(Lt,p(),Ye.value,we.value,E.virtualScrollHorizontal,D.lang.rtl,E.virtualScrollStickySizeStart,E.virtualScrollStickySizeEnd);U!==pi.scrollViewSize&&Ht(pi.scrollViewSize),qe(Lt,pi,Math.min(r.value-1,Math.max(0,parseInt(_t,10)||0)),0,tM.indexOf(xt)>-1?xt:N>-1&&_t>N?"end":"start")}function nt(){const _t=h();if(_t==null||_t.nodeType===8)return;const xt=l_(_t,p(),Ye.value,we.value,E.virtualScrollHorizontal,D.lang.rtl,E.virtualScrollStickySizeStart,E.virtualScrollStickySizeEnd),Lt=r.value-1,pi=xt.scrollMaxSize-xt.offsetStart-xt.offsetEnd-ve.value;if(V===xt.scrollStart)return;if(xt.scrollMaxSize<=0){qe(_t,xt,0,0);return}U!==xt.scrollViewSize&&Ht(xt.scrollViewSize),$e(Ge.value.from);const Si=Math.floor(xt.scrollMaxSize-Math.max(xt.scrollViewSize,xt.offsetEnd)-Math.min(Y[Lt],xt.scrollViewSize/2));if(Si>0&&Math.ceil(xt.scrollStart)>=Si){qe(_t,xt,Lt,xt.scrollMaxSize-xt.offsetEnd-q.reduce(Sc,0));return}let Kt=0,Yt=xt.scrollStart-xt.offsetStart,Jt=Yt;if(Yt<=pi&&Yt+xt.scrollViewSize>=_e.value)Yt-=_e.value,Kt=Ge.value.from,Jt=Yt;else for(let Et=0;Yt>=q[Et]&&Kt<Lt;Et++)Yt-=q[Et],Kt+=mo;for(;Yt>0&&Kt<Lt;)Yt-=Y[Kt],Yt>-xt.scrollViewSize?(Kt++,Jt=Yt):Jt=Y[Kt]+Yt;qe(_t,xt,Kt,Jt)}function qe(_t,xt,Lt,pi,Si){const Kt=typeof Si=="string"&&Si.indexOf("-force")>-1,Yt=Kt===!0?Si.replace("-force",""):Si,Jt=Yt!==void 0?Yt:"start";let Et=Math.max(0,Lt-ze.value[Jt]),Bi=Et+ze.value.total;Bi>r.value&&(Bi=r.value,Et=Math.max(0,Bi-ze.value.total)),V=xt.scrollStart;const xn=Et!==Ge.value.from||Bi!==Ge.value.to;if(xn===!1&&Yt===void 0){At(Lt);return}const{activeElement:ue}=document,Te=Ue.value;xn===!0&&Te!==null&&Te!==ue&&Te.contains(ue)===!0&&(Te.addEventListener("focusout",Ke),setTimeout(()=>{Te!==null&&Te.removeEventListener("focusout",Ke)})),iM(Te,Lt-Et);const Be=Yt!==void 0?Y.slice(Et,Lt).reduce(Sc,0):0;if(xn===!0){const ct=Bi>=Ge.value.from&&Et<=Ge.value.to?Ge.value.to:Bi;Ge.value={from:Et,to:ct},_e.value=dh(q,Y,0,Et),ve.value=dh(q,Y,Bi,r.value),requestAnimationFrame(()=>{Ge.value.to!==Bi&&V===xt.scrollStart&&(Ge.value={from:Ge.value.from,to:Bi},ve.value=dh(q,Y,Bi,r.value))})}requestAnimationFrame(()=>{if(V!==xt.scrollStart)return;xn===!0&&$e(Et);const ct=Y.slice(Et,Lt).reduce(Sc,0),ut=ct+xt.offsetStart+_e.value,bt=ut+Y[Lt];let Mt=ut+pi;if(Yt!==void 0){const gt=ct-Be,He=xt.scrollStart+gt;Mt=Kt!==!0&&He<ut&&bt<He+xt.scrollViewSize?He:Yt==="end"?bt-xt.scrollViewSize:ut-(Yt==="start"?0:Math.round((xt.scrollViewSize-Y[Lt])/2))}V=Mt,g0(_t,Mt,E.virtualScrollHorizontal,D.lang.rtl),At(Lt)})}function $e(_t){const xt=Ue.value;if(xt){const Lt=Eb.call(xt.children,Et=>Et.classList&&Et.classList.contains("q-virtual-scroll--skip")===!1),pi=Lt.length,Si=E.virtualScrollHorizontal===!0?Et=>Et.getBoundingClientRect().width:Et=>Et.offsetHeight;let Kt=_t,Yt,Jt;for(let Et=0;Et<pi;){for(Yt=Si(Lt[Et]),Et++;Et<pi&&Lt[Et].classList.contains("q-virtual-scroll--with-prev")===!0;)Yt+=Si(Lt[Et]),Et++;Jt=Yt-Y[Kt],Jt!==0&&(Y[Kt]+=Jt,q[Math.floor(Kt/mo)]+=Jt),Kt++}}}function Ke(){Ue.value!==null&&Ue.value!==void 0&&Ue.value.focus()}function Ft(_t,xt){const Lt=1*y.value;(xt===!0||Array.isArray(Y)===!1)&&(Y=[]);const pi=Y.length;Y.length=r.value;for(let Kt=r.value-1;Kt>=pi;Kt--)Y[Kt]=Lt;const Si=Math.floor((r.value-1)/mo);q=[];for(let Kt=0;Kt<=Si;Kt++){let Yt=0;const Jt=Math.min((Kt+1)*mo,r.value);for(let Et=Kt*mo;Et<Jt;Et++)Yt+=Y[Et];q.push(Yt)}N=-1,V=void 0,_e.value=dh(q,Y,0,Ge.value.from),ve.value=dh(q,Y,Ge.value.to,r.value),_t>=0?($e(Ge.value.from),pn(()=>{Ve(_t)})):di()}function Ht(_t){if(_t===void 0&&typeof window<"u"){const Yt=h();Yt!=null&&Yt.nodeType!==8&&(_t=l_(Yt,p(),Ye.value,we.value,E.virtualScrollHorizontal,D.lang.rtl,E.virtualScrollStickySizeStart,E.virtualScrollStickySizeEnd).scrollViewSize)}U=_t;const xt=parseFloat(E.virtualScrollSliceRatioBefore)||0,Lt=parseFloat(E.virtualScrollSliceRatioAfter)||0,pi=1+xt+Lt,Si=_t===void 0||_t<=0?1:Math.ceil(_t/y.value),Kt=Math.max(1,Si,Math.ceil((E.virtualScrollSliceSize>0?E.virtualScrollSliceSize:10)/pi));ze.value={total:Math.ceil(Kt*pi),start:Math.ceil(Kt*xt),center:Math.ceil(Kt*(.5+xt)),end:Math.ceil(Kt*(1+xt)),view:Si}}function ot(_t,xt){const Lt=E.virtualScrollHorizontal===!0?"width":"height",pi={["--q-virtual-scroll-item-"+Lt]:y.value+"px"};return[_t==="tbody"?ke(_t,{class:"q-virtual-scroll__padding",key:"before",ref:Ye},[ke("tr",[ke("td",{style:{[Lt]:`${_e.value}px`,...pi},colspan:Se.value})])]):ke(_t,{class:"q-virtual-scroll__padding",key:"before",ref:Ye,style:{[Lt]:`${_e.value}px`,...pi}}),ke(_t,{class:"q-virtual-scroll__content",key:"content",ref:Ue,tabindex:-1},xt.flat()),_t==="tbody"?ke(_t,{class:"q-virtual-scroll__padding",key:"after",ref:we},[ke("tr",[ke("td",{style:{[Lt]:`${ve.value}px`,...pi},colspan:Se.value})])]):ke(_t,{class:"q-virtual-scroll__padding",key:"after",ref:we,style:{[Lt]:`${ve.value}px`,...pi}})]}function At(_t){N!==_t&&(E.onVirtualScroll!==void 0&&M("virtual-scroll",{index:_t,from:Ge.value.from,to:Ge.value.to-1,direction:_t<N?"decrease":"increase",ref:s}),N=_t)}Ht();const di=ag(nt,D.platform.is.ios===!0?120:35);J_(()=>{Ht()});let Fe=!1;return Rh(()=>{Fe=!0}),Y_(()=>{if(Fe!==!0)return;const _t=h();V!==void 0&&_t!==void 0&&_t!==null&&_t.nodeType!==8?g0(_t,V,E.virtualScrollHorizontal,D.lang.rtl):Ve(N)}),mn(()=>{di.cancel()}),Object.assign(s,{scrollTo:Ve,reset:Pe,refresh:Xe}),{virtualScrollSliceRange:Ge,virtualScrollSliceSizeComputed:ze,setVirtualScrollSize:Ht,onVirtualScrollEvt:di,localResetVirtualScroll:Ft,padVirtualScroll:ot,scrollTo:Ve,reset:Pe,refresh:Xe}}function y0(r,h,p){if(p<=h)return h;const y=p-h+1;let b=h+(r-h)%y;return b<h&&(b=y+b),b===0?0:b}const v0=r=>["add","add-unique","toggle"].includes(r),sM=".*+?^${}()|[]\\",aM=Object.keys(gp),x0=Hi({name:"QSelect",inheritAttrs:!1,props:{...rM,...vg,...gp,modelValue:{required:!0},multiple:Boolean,displayValue:[String,Number],displayValueHtml:Boolean,dropdownIcon:String,options:{type:Array,default:()=>[]},optionValue:[Function,String],optionLabel:[Function,String],optionDisable:[Function,String],hideSelected:Boolean,hideDropdownIcon:Boolean,fillInput:Boolean,maxValues:[Number,String],optionsDense:Boolean,optionsDark:{type:Boolean,default:null},optionsSelectedClass:String,optionsHtml:Boolean,optionsCover:Boolean,menuShrink:Boolean,menuAnchor:String,menuSelf:String,menuOffset:Array,popupContentClass:String,popupContentStyle:[String,Array,Object],useInput:Boolean,useChips:Boolean,newValueMode:{type:String,validator:v0},mapOptions:Boolean,emitValue:Boolean,inputDebounce:{type:[Number,String],default:500},inputClass:[Array,String,Object],inputStyle:[Array,String,Object],tabindex:{type:[String,Number],default:0},autocomplete:String,transitionShow:String,transitionHide:String,transitionDuration:[String,Number],behavior:{type:String,validator:r=>["default","menu","dialog"].includes(r),default:"default"},virtualScrollItemSize:{type:[Number,String],default:void 0},onNewValue:Function,onFilter:Function},emits:[..._g,"add","remove","input-value","new-value","keyup","keypress","keydown","filter-abort"],setup(r,{slots:h,emit:p}){const{proxy:y}=Vi(),{$q:b}=y,E=Rt(!1),M=Rt(!1),s=Rt(-1),D=Rt(""),V=Rt(!1),N=Rt(!1);let U,q,Y,_e,ve,ze,Ye,we,Ue;const Ge=Rt(null),Se=Rt(null),De=Rt(null),be=Rt(null),Pe=Rt(null),Xe=ub(r),Ve=hb(to),nt=xe(()=>Array.isArray(r.options)?r.options.length:0),qe=xe(()=>r.virtualScrollItemSize===void 0?r.optionsDense===!0?24:48:r.virtualScrollItemSize),{virtualScrollSliceRange:$e,virtualScrollSliceSizeComputed:Ke,localResetVirtualScroll:Ft,padVirtualScroll:Ht,onVirtualScrollEvt:ot,scrollTo:At,setVirtualScrollSize:di}=oM({virtualScrollLength:nt,getVirtualScrollTarget:bs,getVirtualScrollEl:Ho,virtualScrollItemSizeComputed:qe}),Fe=gg(),_t=xe(()=>{const ce=r.mapOptions===!0&&r.multiple!==!0,vt=r.modelValue!==void 0&&(r.modelValue!==null||ce===!0)?r.multiple===!0&&Array.isArray(r.modelValue)?r.modelValue:[r.modelValue]:[];if(r.mapOptions===!0&&Array.isArray(r.options)===!0){const Ze=r.mapOptions===!0&&q!==void 0?q:[],Ce=vt.map(wi=>_r(wi,Ze));return r.modelValue===null&&ce===!0?Ce.filter(wi=>wi!==null):Ce}return vt}),xt=xe(()=>{const ce={};return aM.forEach(vt=>{const Ze=r[vt];Ze!==void 0&&(ce[vt]=Ze)}),ce}),Lt=xe(()=>r.optionsDark===null?Fe.isDark.value:r.optionsDark),pi=xe(()=>Dh(_t.value)),Si=xe(()=>{let ce="q-field__input q-placeholder col";return r.hideSelected===!0||_t.value.length===0?[ce,r.inputClass]:(ce+=" q-field__input--padding",r.inputClass===void 0?ce:[ce,r.inputClass])}),Kt=xe(()=>(r.virtualScrollHorizontal===!0?"q-virtual-scroll--horizontal":"")+(r.popupContentClass?" "+r.popupContentClass:"")),Yt=xe(()=>nt.value===0),Jt=xe(()=>_t.value.map(ce=>He.value(ce)).join(", ")),Et=xe(()=>r.optionsHtml===!0?()=>!0:ce=>ce!=null&&ce.html===!0),Bi=xe(()=>r.displayValueHtml===!0||r.displayValue===void 0&&(r.optionsHtml===!0||_t.value.some(Et.value))),xn=xe(()=>Fe.focused.value===!0?r.tabindex:-1),ue=xe(()=>({tabindex:r.tabindex,role:"combobox","aria-label":r.label,"aria-readonly":r.readonly===!0?"true":"false","aria-autocomplete":r.useInput===!0?"list":"none","aria-expanded":E.value===!0?"true":"false","aria-owns":`${Fe.targetUid.value}_lb`,"aria-controls":`${Fe.targetUid.value}_lb`})),Te=xe(()=>{const ce={id:`${Fe.targetUid.value}_lb`,role:"listbox","aria-multiselectable":r.multiple===!0?"true":"false"};return s.value>=0&&(ce["aria-activedescendant"]=`${Fe.targetUid.value}_${s.value}`),ce}),Be=xe(()=>_t.value.map((ce,vt)=>({index:vt,opt:ce,html:Et.value(ce),selected:!0,removeAtIndex:mi,toggleOption:si,tabindex:xn.value}))),ct=xe(()=>{if(nt.value===0)return[];const{from:ce,to:vt}=$e.value;return r.options.slice(ce,vt).map((Ze,Ce)=>{const wi=ht.value(Ze)===!0,ni=ce+Ce,$i={clickable:!0,active:!1,activeClass:Mt.value,manualFocus:!0,focused:!1,disable:wi,tabindex:-1,dense:r.optionsDense,dark:Lt.value,role:"option",id:`${Fe.targetUid.value}_${ni}`,onClick:()=>{si(Ze)}};return wi!==!0&&(In(Ze)===!0&&($i.active=!0),s.value===ni&&($i.focused=!0),$i["aria-selected"]=$i.active===!0?"true":"false",b.platform.is.desktop===!0&&($i.onMousemove=()=>{E.value===!0&&Ci(ni)})),{index:ni,opt:Ze,html:Et.value(Ze),label:He.value(Ze),selected:$i.active,focused:$i.focused,toggleOption:si,setOptionIndex:Ci,itemProps:$i}})}),ut=xe(()=>r.dropdownIcon!==void 0?r.dropdownIcon:b.iconSet.arrow.dropdown),bt=xe(()=>r.optionsCover===!1&&r.outlined!==!0&&r.standout!==!0&&r.borderless!==!0&&r.rounded!==!0),Mt=xe(()=>r.optionsSelectedClass!==void 0?r.optionsSelectedClass:r.color!==void 0?`text-${r.color}`:""),gt=xe(()=>En(r.optionValue,"value")),He=xe(()=>En(r.optionLabel,"label")),ht=xe(()=>En(r.optionDisable,"disable")),qt=xe(()=>_t.value.map(ce=>gt.value(ce))),Nt=xe(()=>{const ce={onInput:to,onChange:Ve,onKeydown:wo,onKeyup:kn,onKeypress:Pr,onFocus:qr,onClick(vt){Y===!0&&jo(vt)}};return ce.onCompositionstart=ce.onCompositionupdate=ce.onCompositionend=Ve,ce});ri(_t,ce=>{q=ce,r.useInput===!0&&r.fillInput===!0&&r.multiple!==!0&&Fe.innerLoading.value!==!0&&(M.value!==!0&&E.value!==!0||pi.value!==!0)&&(_e!==!0&&st(),(M.value===!0||E.value===!0)&&Tr(""))},{immediate:!0}),ri(()=>r.fillInput,st),ri(E,$t),ri(nt,Xt);function Zt(ce){return r.emitValue===!0?gt.value(ce):ce}function ti(ce){if(ce>-1&&ce<_t.value.length)if(r.multiple===!0){const vt=r.modelValue.slice();p("remove",{index:ce,value:vt.splice(ce,1)[0]}),p("update:modelValue",vt)}else p("update:modelValue",null)}function mi(ce){ti(ce),Fe.focus()}function zi(ce,vt){const Ze=Zt(ce);if(r.multiple!==!0){r.fillInput===!0&&Sn(He.value(ce),!0,!0),p("update:modelValue",Ze);return}if(_t.value.length===0){p("add",{index:0,value:Ze}),p("update:modelValue",r.multiple===!0?[Ze]:Ze);return}if(vt===!0&&In(ce)===!0||r.maxValues!==void 0&&r.modelValue.length>=r.maxValues)return;const Ce=r.modelValue.slice();p("add",{index:Ce.length,value:Ze}),Ce.push(Ze),p("update:modelValue",Ce)}function si(ce,vt){if(Fe.editable.value!==!0||ce===void 0||ht.value(ce)===!0)return;const Ze=gt.value(ce);if(r.multiple!==!0){vt!==!0&&(Sn(r.fillInput===!0?He.value(ce):"",!0,!0),Ct()),Se.value!==null&&Se.value.focus(),(_t.value.length===0||na(gt.value(_t.value[0]),Ze)!==!0)&&p("update:modelValue",r.emitValue===!0?Ze:ce);return}if((Y!==!0||V.value===!0)&&Fe.focus(),qr(),_t.value.length===0){const ni=r.emitValue===!0?Ze:ce;p("add",{index:0,value:ni}),p("update:modelValue",r.multiple===!0?[ni]:ni);return}const Ce=r.modelValue.slice(),wi=qt.value.findIndex(ni=>na(ni,Ze));if(wi>-1)p("remove",{index:wi,value:Ce.splice(wi,1)[0]});else{if(r.maxValues!==void 0&&Ce.length>=r.maxValues)return;const ni=r.emitValue===!0?Ze:ce;p("add",{index:Ce.length,value:ni}),Ce.push(ni)}p("update:modelValue",Ce)}function Ci(ce){if(b.platform.is.desktop!==!0)return;const vt=ce>-1&&ce<nt.value?ce:-1;s.value!==vt&&(s.value=vt)}function un(ce=1,vt){if(E.value===!0){let Ze=s.value;do Ze=y0(Ze+ce,-1,nt.value-1);while(Ze!==-1&&Ze!==s.value&&ht.value(r.options[Ze])===!0);s.value!==Ze&&(Ci(Ze),At(Ze),vt!==!0&&r.useInput===!0&&r.fillInput===!0&&io(Ze>=0?He.value(r.options[Ze]):ze))}}function _r(ce,vt){const Ze=Ce=>na(gt.value(Ce),ce);return r.options.find(Ze)||vt.find(Ze)||ce}function En(ce,vt){const Ze=ce!==void 0?ce:vt;return typeof Ze=="function"?Ze:Ce=>Ce!==null&&typeof Ce=="object"&&Ze in Ce?Ce[Ze]:Ce}function In(ce){const vt=gt.value(ce);return qt.value.find(Ze=>na(Ze,vt))!==void 0}function qr(ce){r.useInput===!0&&Se.value!==null&&(ce===void 0||Se.value===ce.target&&ce.target.value===Jt.value)&&Se.value.select()}function _n(ce){aa(ce,27)===!0&&E.value===!0&&(jo(ce),Ct(),st()),p("keyup",ce)}function kn(ce){const{value:vt}=ce.target;if(ce.keyCode!==void 0){_n(ce);return}if(ce.target.value="",clearTimeout(U),st(),typeof vt=="string"&&vt.length>0){const Ze=vt.toLocaleLowerCase(),Ce=ni=>{const $i=r.options.find(Cn=>ni.value(Cn).toLocaleLowerCase()===Ze);return $i===void 0?!1:(_t.value.indexOf($i)===-1?si($i):Ct(),!0)},wi=ni=>{Ce(gt)!==!0&&(Ce(He)===!0||ni===!0||Tr(vt,!0,()=>wi(!0)))};wi()}else Fe.clearValue(ce)}function Pr(ce){p("keypress",ce)}function wo(ce){if(p("keydown",ce),lg(ce)===!0)return;const vt=D.value.length>0&&(r.newValueMode!==void 0||r.onNewValue!==void 0),Ze=ce.shiftKey!==!0&&r.multiple!==!0&&(s.value>-1||vt===!0);if(ce.keyCode===27){Nr(ce);return}if(ce.keyCode===9&&Ze===!1){Ie();return}if(ce.target===void 0||ce.target.id!==Fe.targetUid.value)return;if(ce.keyCode===40&&Fe.innerLoading.value!==!0&&E.value===!1){Mn(ce),Qe();return}if(ce.keyCode===8&&r.hideSelected!==!0&&D.value.length===0){r.multiple===!0&&Array.isArray(r.modelValue)===!0?ti(r.modelValue.length-1):r.multiple!==!0&&r.modelValue!==null&&p("update:modelValue",null);return}(ce.keyCode===35||ce.keyCode===36)&&(typeof D.value!="string"||D.value.length===0)&&(Mn(ce),s.value=-1,un(ce.keyCode===36?1:-1,r.multiple)),(ce.keyCode===33||ce.keyCode===34)&&Ke.value!==void 0&&(Mn(ce),s.value=Math.max(-1,Math.min(nt.value,s.value+(ce.keyCode===33?-1:1)*Ke.value.view)),un(ce.keyCode===33?1:-1,r.multiple)),(ce.keyCode===38||ce.keyCode===40)&&(Mn(ce),un(ce.keyCode===38?-1:1,r.multiple));const Ce=nt.value;if((we===void 0||Ue<Date.now())&&(we=""),Ce>0&&r.useInput!==!0&&ce.key!==void 0&&ce.key.length===1&&ce.altKey===ce.ctrlKey&&(ce.keyCode!==32||we.length>0)){E.value!==!0&&Qe(ce);const wi=ce.key.toLocaleLowerCase(),ni=we.length===1&&we[0]===wi;Ue=Date.now()+1500,ni===!1&&(Mn(ce),we+=wi);const $i=new RegExp("^"+we.split("").map(Kn=>sM.indexOf(Kn)>-1?"\\"+Kn:Kn).join(".*"),"i");let Cn=s.value;if(ni===!0||Cn<0||$i.test(He.value(r.options[Cn]))!==!0)do Cn=y0(Cn+1,-1,Ce-1);while(Cn!==s.value&&(ht.value(r.options[Cn])===!0||$i.test(He.value(r.options[Cn]))!==!0));s.value!==Cn&&pn(()=>{Ci(Cn),At(Cn),Cn>=0&&r.useInput===!0&&r.fillInput===!0&&io(He.value(r.options[Cn]))});return}if(!(ce.keyCode!==13&&(ce.keyCode!==32||r.useInput===!0||we!=="")&&(ce.keyCode!==9||Ze===!1))){if(ce.keyCode!==9&&Mn(ce),s.value>-1&&s.value<Ce){si(r.options[s.value]);return}if(vt===!0){const wi=(ni,$i)=>{if($i){if(v0($i)!==!0)return}else $i=r.newValueMode;if(ni==null)return;Sn("",r.multiple!==!0,!0),($i==="toggle"?si:zi)(ni,$i==="add-unique"),r.multiple!==!0&&(Se.value!==null&&Se.value.focus(),Ct())};if(r.onNewValue!==void 0?p("new-value",D.value,wi):wi(D.value),r.multiple!==!0)return}E.value===!0?Ie():Fe.innerLoading.value!==!0&&Qe()}}function Ho(){return Y===!0?Pe.value:De.value!==null&&De.value.__qPortalInnerRef.value!==null?De.value.__qPortalInnerRef.value:void 0}function bs(){return Ho()}function ha(){return r.hideSelected===!0?[]:h["selected-item"]!==void 0?Be.value.map(ce=>h["selected-item"](ce)).slice():h.selected!==void 0?[].concat(h.selected()):r.useChips===!0?Be.value.map((ce,vt)=>ke(SA,{key:"option-"+vt,removable:Fe.editable.value===!0&&ht.value(ce.opt)!==!0,dense:!0,textColor:r.color,tabindex:xn.value,onRemove(){ce.removeAtIndex(vt)}},()=>ke("span",{class:"ellipsis",[ce.html===!0?"innerHTML":"textContent"]:He.value(ce.opt)}))):[ke("span",{[Bi.value===!0?"innerHTML":"textContent"]:r.displayValue!==void 0?r.displayValue:Jt.value})]}function Dr(){if(Yt.value===!0)return h["no-option"]!==void 0?h["no-option"]({inputValue:D.value}):void 0;const ce=h.option!==void 0?h.option:Ze=>ke(CA,{key:Ze.index,...Ze.itemProps},()=>ke(AA,()=>ke(MA,()=>ke("span",{[Ze.html===!0?"innerHTML":"textContent"]:Ze.label}))));let vt=Ht("div",ct.value.map(ce));return h["before-options"]!==void 0&&(vt=h["before-options"]().concat(vt)),Jr(h["after-options"],vt)}function Lr(ce,vt){const Ze=vt===!0?{...ue.value,...Fe.splitAttrs.attributes.value}:void 0,Ce={ref:vt===!0?Se:void 0,key:"i_t",class:Si.value,style:r.inputStyle,value:D.value!==void 0?D.value:"",type:"search",...Ze,id:vt===!0?Fe.targetUid.value:void 0,maxlength:r.maxlength,autocomplete:r.autocomplete,"data-autofocus":ce!==!0&&r.autofocus===!0||void 0,disabled:r.disable===!0,readonly:r.readonly===!0,...Nt.value};return ce!==!0&&Y===!0&&(Array.isArray(Ce.class)===!0?Ce.class=[...Ce.class,"no-pointer-events"]:Ce.class+=" no-pointer-events"),ke("input",Ce)}function to(ce){clearTimeout(U),!(ce&&ce.target&&ce.target.qComposing===!0)&&(io(ce.target.value||""),_e=!0,ze=D.value,Fe.focused.value!==!0&&(Y!==!0||V.value===!0)&&Fe.focus(),r.onFilter!==void 0&&(U=setTimeout(()=>{Tr(D.value)},r.inputDebounce)))}function io(ce){D.value!==ce&&(D.value=ce,p("input-value",ce))}function Sn(ce,vt,Ze){_e=Ze!==!0,r.useInput===!0&&(io(ce),(vt===!0||Ze!==!0)&&(ze=ce),vt!==!0&&Tr(ce))}function Tr(ce,vt,Ze){if(r.onFilter===void 0||vt!==!0&&Fe.focused.value!==!0)return;Fe.innerLoading.value===!0?p("filter-abort"):(Fe.innerLoading.value=!0,N.value=!0),ce!==""&&r.multiple!==!0&&_t.value.length>0&&_e!==!0&&ce===He.value(_t.value[0])&&(ce="");const Ce=setTimeout(()=>{E.value===!0&&(E.value=!1)},10);clearTimeout(ve),ve=Ce,p("filter",ce,(wi,ni)=>{(vt===!0||Fe.focused.value===!0)&&ve===Ce&&(clearTimeout(ve),typeof wi=="function"&&wi(),N.value=!1,pn(()=>{Fe.innerLoading.value=!1,Fe.editable.value===!0&&(vt===!0?E.value===!0&&Ct():E.value===!0?$t(!0):E.value=!0),typeof ni=="function"&&pn(()=>{ni(y)}),typeof Ze=="function"&&pn(()=>{Ze(y)})}))},()=>{Fe.focused.value===!0&&ve===Ce&&(clearTimeout(ve),Fe.innerLoading.value=!1,N.value=!1),E.value===!0&&(E.value=!1)})}function Q(){return ke(HA,{ref:De,class:Kt.value,style:r.popupContentStyle,modelValue:E.value,fit:r.menuShrink!==!0,cover:r.optionsCover===!0&&Yt.value!==!0&&r.useInput!==!0,anchor:r.menuAnchor,self:r.menuSelf,offset:r.menuOffset,dark:Lt.value,noParentEvent:!0,noRefocus:!0,noFocus:!0,square:bt.value,transitionShow:r.transitionShow,transitionHide:r.transitionHide,transitionDuration:r.transitionDuration,separateClosePopup:!0,...Te.value,onScrollPassive:ot,onBeforeShow:Qt,onBeforeHide:B,onShow:F},Dr)}function B(ce){ci(ce),Ie()}function F(){di()}function J(ce){jo(ce),Se.value!==null&&Se.value.focus(),V.value=!0,window.scrollTo(window.pageXOffset||window.scrollX||document.body.scrollLeft||0,0)}function ne(ce){jo(ce),pn(()=>{V.value=!1})}function me(){const ce=[ke(TA,{class:`col-auto ${Fe.fieldClass.value}`,...xt.value,for:Fe.targetUid.value,dark:Lt.value,square:!0,loading:N.value,itemAligned:!1,filled:!0,stackLabel:D.value.length>0,...Fe.splitAttrs.listeners.value,onFocus:J,onBlur:ne},{...h,rawControl:()=>Fe.getControl(!0),before:void 0,after:void 0})];return E.value===!0&&ce.push(ke("div",{ref:Pe,class:Kt.value+" scroll",style:r.popupContentStyle,...Te.value,onClick:Nr,onScrollPassive:ot},Dr())),ke(Tb,{ref:be,modelValue:M.value,position:r.useInput===!0?"top":void 0,transitionShow:Ye,transitionHide:r.transitionHide,transitionDuration:r.transitionDuration,onBeforeShow:Qt,onBeforeHide:Me,onHide:Ee,onShow:ge},()=>ke("div",{class:"q-select__dialog"+(Lt.value===!0?" q-select__dialog--dark q-dark":"")+(V.value===!0?" q-select__dialog--focused":"")},ce))}function Me(ce){ci(ce),be.value!==null&&be.value.__updateRefocusTarget(Fe.rootRef.value.querySelector(".q-field__native > [tabindex]:last-child")),Fe.focused.value=!1}function Ee(ce){Ct(),Fe.focused.value===!1&&p("blur",ce),st()}function ge(){const ce=document.activeElement;(ce===null||ce.id!==Fe.targetUid.value)&&Se.value!==null&&Se.value!==ce&&Se.value.focus(),di()}function Ie(){M.value!==!0&&(s.value=-1,E.value===!0&&(E.value=!1),Fe.focused.value===!1&&(clearTimeout(ve),ve=void 0,Fe.innerLoading.value===!0&&(p("filter-abort"),Fe.innerLoading.value=!1,N.value=!1)))}function Qe(ce){Fe.editable.value===!0&&(Y===!0?(Fe.onControlFocusin(ce),M.value=!0,pn(()=>{Fe.focus()})):Fe.focus(),r.onFilter!==void 0?Tr(D.value):(Yt.value!==!0||h["no-option"]!==void 0)&&(E.value=!0))}function Ct(){M.value=!1,Ie()}function st(){r.useInput===!0&&Sn(r.multiple!==!0&&r.fillInput===!0&&_t.value.length>0&&He.value(_t.value[0])||"",!0,!0)}function $t(ce){let vt=-1;if(ce===!0){if(_t.value.length>0){const Ze=gt.value(_t.value[0]);vt=r.options.findIndex(Ce=>na(gt.value(Ce),Ze))}Ft(vt)}Ci(vt)}function Xt(ce,vt){E.value===!0&&Fe.innerLoading.value===!1&&(Ft(-1,!0),pn(()=>{E.value===!0&&Fe.innerLoading.value===!1&&(ce>vt?Ft():$t(!0))}))}function jt(){M.value===!1&&De.value!==null&&De.value.updatePosition()}function Qt(ce){ce!==void 0&&jo(ce),p("popup-show",ce),Fe.hasPopupOpen=!0,Fe.onControlFocusin(ce)}function ci(ce){ce!==void 0&&jo(ce),p("popup-hide",ce),Fe.hasPopupOpen=!1,Fe.onControlFocusout(ce)}function Pi(){Y=b.platform.is.mobile!==!0&&r.behavior!=="dialog"?!1:r.behavior!=="menu"&&(r.useInput===!0?h["no-option"]!==void 0||r.onFilter!==void 0||Yt.value===!1:!0),Ye=b.platform.is.ios===!0&&Y===!0&&r.useInput===!0?"fade":r.transitionShow}return Q_(Pi),eg(jt),Pi(),mn(()=>{clearTimeout(U)}),Object.assign(y,{showPopup:Qe,hidePopup:Ct,removeAtIndex:ti,add:zi,toggleOption:si,getOptionIndex:()=>s.value,setOptionIndex:Ci,moveOptionSelection:un,filter:Tr,updateMenuPosition:jt,updateInputValue:Sn,isOptionSelected:In,getEmittingOptionValue:Zt,isOptionDisabled:(...ce)=>ht.value.apply(null,ce)===!0,getOptionValue:(...ce)=>gt.value.apply(null,ce),getOptionLabel:(...ce)=>He.value.apply(null,ce)}),Object.assign(Fe,{innerValue:_t,fieldClass:xe(()=>`q-select q-field--auto-height q-select--with${r.useInput!==!0?"out":""}-input q-select--with${r.useChips!==!0?"out":""}-chips q-select--${r.multiple===!0?"multiple":"single"}`),inputRef:Ge,targetRef:Se,hasValue:pi,showPopup:Qe,floatingLabel:xe(()=>r.hideSelected!==!0&&pi.value===!0||typeof D.value=="number"||D.value.length>0||Dh(r.displayValue)),getControlChild:()=>{if(Fe.editable.value!==!1&&(M.value===!0||Yt.value!==!0||h["no-option"]!==void 0))return Y===!0?me():Q();Fe.hasPopupOpen===!0&&(Fe.hasPopupOpen=!1)},controlEvents:{onFocusin(ce){Fe.onControlFocusin(ce)},onFocusout(ce){Fe.onControlFocusout(ce,()=>{st(),Ie()})},onClick(ce){if(Nr(ce),Y!==!0&&E.value===!0){Ie(),Se.value!==null&&Se.value.focus();return}Qe(ce)}},getControl:ce=>{const vt=ha(),Ze=ce===!0||M.value!==!0||Y!==!0;if(r.useInput===!0)vt.push(Lr(ce,Ze));else if(Fe.editable.value===!0){const wi=Ze===!0?ue.value:void 0;vt.push(ke("input",{ref:Ze===!0?Se:void 0,key:"d_t",class:"q-select__focus-target",id:Ze===!0?Fe.targetUid.value:void 0,readonly:!0,"data-autofocus":ce!==!0&&r.autofocus===!0||void 0,...wi,onKeydown:wo,onKeyup:_n,onKeypress:Pr})),Ze===!0&&typeof r.autocomplete=="string"&&r.autocomplete.length>0&&vt.push(ke("input",{class:"q-select__autocomplete-input",autocomplete:r.autocomplete,tabindex:-1,onKeyup:kn}))}if(Xe.value!==void 0&&r.disable!==!0&&qt.value.length>0){const wi=qt.value.map(ni=>ke("option",{value:ni,selected:!0}));vt.push(ke("select",{class:"hidden",name:Xe.value,multiple:r.multiple},wi))}const Ce=r.useInput===!0||Ze!==!0?void 0:Fe.splitAttrs.attributes.value;return ke("div",{class:"q-field__native row items-center",...Ce},vt)},getInnerAppend:()=>r.loading!==!0&&N.value!==!0&&r.hideDropdownIcon!==!0?[ke(jn,{class:"q-select__dropdown-icon"+(E.value===!0?" rotate-180":""),name:ut.value})]:null}),yg(Fe)}});function lM(r,h){const p=Rt(null),y=xe(()=>r.disable===!0?null:ke("span",{ref:p,class:"no-outline",tabindex:-1}));function b(E){const M=h.value;E!==void 0&&E.type.indexOf("key")===0?M!==null&&document.activeElement!==M&&M.contains(document.activeElement)===!0&&M.focus():p.value!==null&&(E===void 0||M!==null&&M.contains(E.target)===!0)&&p.value.focus()}return{refocusTargetEl:y,refocusTarget:b}}const cM={xs:30,sm:35,md:40,lg:50,xl:60},uM={...ca,...pp,...vg,modelValue:{required:!0,default:null},val:{},trueValue:{default:!0},falseValue:{default:!1},indeterminateValue:{default:null},checkedIcon:String,uncheckedIcon:String,indeterminateIcon:String,toggleOrder:{type:String,validator:r=>r==="tf"||r==="ft"},toggleIndeterminate:Boolean,label:String,leftLabel:Boolean,color:String,keepColor:Boolean,dense:Boolean,disable:Boolean,tabindex:[String,Number]},hM=["update:modelValue"];function dM(r,h){const{props:p,slots:y,emit:b,proxy:E}=Vi(),{$q:M}=E,s=ua(p,M),D=Rt(null),{refocusTargetEl:V,refocusTarget:N}=lM(p,D),U=mp(p,cM),q=xe(()=>p.val!==void 0&&Array.isArray(p.modelValue)),Y=xe(()=>{const qe=Li(p.val);return q.value===!0?p.modelValue.findIndex($e=>Li($e)===qe):-1}),_e=xe(()=>q.value===!0?Y.value>-1:Li(p.modelValue)===Li(p.trueValue)),ve=xe(()=>q.value===!0?Y.value===-1:Li(p.modelValue)===Li(p.falseValue)),ze=xe(()=>_e.value===!1&&ve.value===!1),Ye=xe(()=>p.disable===!0?-1:p.tabindex||0),we=xe(()=>`q-${r} cursor-pointer no-outline row inline no-wrap items-center`+(p.disable===!0?" disabled":"")+(s.value===!0?` q-${r}--dark`:"")+(p.dense===!0?` q-${r}--dense`:"")+(p.leftLabel===!0?" reverse":"")),Ue=xe(()=>{const qe=_e.value===!0?"truthy":ve.value===!0?"falsy":"indet",$e=p.color!==void 0&&(p.keepColor===!0||(r==="toggle"?_e.value===!0:ve.value!==!0))?` text-${p.color}`:"";return`q-${r}__inner relative-position non-selectable q-${r}__inner--${qe}${$e}`}),Ge=xe(()=>{const qe={type:"checkbox"};return p.name!==void 0&&Object.assign(qe,{"^checked":_e.value===!0?"checked":void 0,name:p.name,value:q.value===!0?p.val:p.trueValue}),qe}),Se=gA(Ge),De=xe(()=>{const qe={tabindex:Ye.value,role:"checkbox","aria-label":p.label,"aria-checked":ze.value===!0?"mixed":_e.value===!0?"true":"false"};return p.disable===!0&&(qe["aria-disabled"]="true"),qe});function be(qe){qe!==void 0&&(Mn(qe),N(qe)),p.disable!==!0&&b("update:modelValue",Pe(),qe)}function Pe(){if(q.value===!0){if(_e.value===!0){const qe=p.modelValue.slice();return qe.splice(Y.value,1),qe}return p.modelValue.concat([p.val])}if(_e.value===!0){if(p.toggleOrder!=="ft"||p.toggleIndeterminate===!1)return p.falseValue}else if(ve.value===!0){if(p.toggleOrder==="ft"||p.toggleIndeterminate===!1)return p.trueValue}else return p.toggleOrder!=="ft"?p.trueValue:p.falseValue;return p.indeterminateValue}function Xe(qe){(qe.keyCode===13||qe.keyCode===32)&&Mn(qe)}function Ve(qe){(qe.keyCode===13||qe.keyCode===32)&&be(qe)}const nt=h(_e,ze);return Object.assign(E,{toggle:be}),()=>{const qe=nt();p.disable!==!0&&Se(qe,"unshift",` q-${r}__native absolute q-ma-none q-pa-none`);const $e=[ke("div",{class:Ue.value,style:U.value,"aria-hidden":"true"},qe)];V.value!==null&&$e.push(V.value);const Ke=p.label!==void 0?Jr(y.default,[p.label]):Tn(y.default);return Ke!==void 0&&$e.push(ke("div",{class:`q-${r}__label q-anchor--skip`},Ke)),ke("div",{ref:D,class:we.value,...De.value,onClick:be,onKeydown:Xe,onKeyup:Ve},$e)}}const fM=Hi({name:"QToggle",props:{...uM,icon:String,iconColor:String},emits:hM,setup(r){function h(p,y){const b=xe(()=>(p.value===!0?r.checkedIcon:y.value===!0?r.indeterminateIcon:r.uncheckedIcon)||r.icon),E=xe(()=>p.value===!0?r.iconColor:null);return()=>[ke("div",{class:"q-toggle__track"}),ke("div",{class:"q-toggle__thumb absolute flex flex-center no-wrap"},b.value!==void 0?[ke(jn,{name:b.value,color:E.value})]:void 0)]}return dM("toggle",h)}}),pM=ke("div",{class:"q-space"}),b0=Hi({name:"QSpace",setup(){return()=>pM}}),w0=Hi({name:"QCardSection",props:{tag:{type:String,default:"div"},horizontal:Boolean},setup(r,{slots:h}){const p=xe(()=>`q-card__section q-card__section--${r.horizontal===!0?"horiz row no-wrap":"vert"}`);return()=>ke(r.tag,{class:p.value},Tn(h.default))}}),mM=Hi({name:"QCard",props:{...ca,tag:{type:String,default:"div"},square:Boolean,flat:Boolean,bordered:Boolean},setup(r,{slots:h}){const{proxy:{$q:p}}=Vi(),y=ua(r,p),b=xe(()=>"q-card"+(y.value===!0?" q-card--dark q-dark":"")+(r.bordered===!0?" q-card--bordered":"")+(r.square===!0?" q-card--square no-border-radius":"")+(r.flat===!0?" q-card--flat no-shadow":""));return()=>ke(r.tag,{class:b.value},Tn(h.default))}});function T0(r){if(r===!1)return 0;if(r===!0||r===void 0)return 1;const h=parseInt(r,10);return isNaN(h)?0:h}const _M=cg({name:"close-popup",beforeMount(r,{value:h}){const p={depth:T0(h),handler(y){p.depth!==0&&setTimeout(()=>{const b=BA(r);b!==void 0&&RA(b,y,p.depth)})},handlerKey(y){aa(y,13)===!0&&p.handler(y)}};r.__qclosepopup=p,r.addEventListener("click",p.handler),r.addEventListener("keyup",p.handlerKey)},updated(r,{value:h,oldValue:p}){h!==p&&(r.__qclosepopup.depth=T0(h))},beforeUnmount(r){const h=r.__qclosepopup;r.removeEventListener("click",h.handler),r.removeEventListener("keyup",h.handlerKey),delete r.__qclosepopup}});const gM={style:{display:"flex","justify-content":"center","align-items":"center"}},yM={class:"title"},Oh={__name:"Title",props:{title:{type:String,default:!1}},setup(r){return(h,p)=>(nr(),la("div",gM,[ki("p",yM,ea(r.title),1)]))}},vM={class:"row",style:{"justify-content":"center","align-items":"center"}},xM={style:{width:"90%",display:"flex","flex-direction":"column",gap:"3rem"}},bM={style:{display:"flex","justify-content":"space-between"}},wM={style:{display:"flex","align-items":"center",gap:"1.2rem"}},TM=ki("p",{style:{color:"grey","font-size":"120%",padding:"0",margin:"0"}},"\xBFIr\xE1s en el autobus?",-1),EM={style:{display:"flex","justify-content":"center"}},SM=ki("br",null,null,-1),CM=ki("div",{style:{"font-weight":"900"}},"\xA1Por favor, revisa la informaci\xF3n!",-1),AM=ki("div",{style:{"font-weight":"900",display:"flex","justify-content":"center"}},[ki("p",null," \xBFDeseas enviar la informaci\xF3n? ")],-1),MM={style:{display:"flex","justify-content":"space-around"}},IM={__name:"Asistencia",setup(r){const h=$o({nombre:null,acompaniantesNombre:null,numAdultos:null,numNinios:null,alergias:null,bus:!1,observaciones:""}),p=[{label:0,value:0},{label:1,value:1},{label:2,value:2},{label:3,value:3},{label:4,value:4},{label:5,value:5},{label:6,value:6},{label:7,value:7},{label:8,value:8},{label:9,value:9},{label:10,value:10}],y=Rt(!1),b=M=>y.value=M,E=()=>{console.log("Post"),b(!1)};return(M,s)=>(nr(),la(wr,null,[Ut(Oh,{title:"Asistencia"}),ki("div",vM,[ki("div",xM,[Ut(Cf,{color:"blue-12",modelValue:h.nombre,"onUpdate:modelValue":s[0]||(s[0]=D=>h.nombre=D),label:"Nombre y apellidos"},{prepend:Ln(()=>[Ut(jn,{name:"person"})]),_:1},8,["modelValue"]),Ut(Cf,{modelValue:h.acompaniantesNombre,"onUpdate:modelValue":s[1]||(s[1]=D=>h.acompaniantesNombre=D),type:"textarea",label:"Nombre y apellidos de tus acompa\xF1antes"},{prepend:Ln(()=>[Ut(jn,{name:"group"})]),_:1},8,["modelValue"]),Ut(x0,{color:"blue-12",modelValue:h.numAdultos,"onUpdate:modelValue":s[2]||(s[2]=D=>h.numAdultos=D),options:p,label:"Menus adulto"},{prepend:Ln(()=>[Ut(jn,{name:"restaurant_menu"})]),_:1},8,["modelValue"]),Ut(x0,{color:"blue-12",modelValue:h.numNinios,"onUpdate:modelValue":s[3]||(s[3]=D=>h.numNinios=D),options:p,label:"Menus ni\xF1o"},{prepend:Ln(()=>[Ut(jn,{name:"local_pizza"})]),_:1},8,["modelValue"]),Ut(Cf,{modelValue:h.alergias,"onUpdate:modelValue":s[4]||(s[4]=D=>h.alergias=D),label:"Alergias e intolerancias"},{prepend:Ln(()=>[Ut(jn,{name:"bug_report"})]),_:1},8,["modelValue"]),ki("div",bM,[ki("div",wM,[Ut(jn,{style:{color:"grey","font-size":"140%"},name:"directions_bus"}),TM]),Ut(fM,{modelValue:h.bus,"onUpdate:modelValue":s[5]||(s[5]=D=>h.bus=D),"checked-icon":"check",color:"green","unchecked-icon":"clear"},null,8,["modelValue"])]),Ut(Cf,{modelValue:h.observaciones,"onUpdate:modelValue":s[6]||(s[6]=D=>h.observaciones=D),type:"textarea",label:"\xBFQuieres a\xF1adir algo m\xE1s?"},{prepend:Ln(()=>[Ut(jn,{name:"contact_support"})]),_:1},8,["modelValue"]),ki("div",EM,[Ut(Go,{style:{width:"50%"},color:"black",icon:"mail_outline",label:"Enviar",rounded:"",onClick:s[7]||(s[7]=D=>b(!0))})]),SM])]),Ut(Tb,{modelValue:y.value,"onUpdate:modelValue":s[10]||(s[10]=D=>y.value=D)},{default:Ln(()=>[Ut(mM,null,{default:Ln(()=>[Ut(w0,{class:"row items-center q-pb-none"},{default:Ln(()=>[CM,Ut(b0),tg(Ut(Go,{icon:"close",flat:"",round:"",dense:""},null,512),[[_M]])]),_:1}),Ut(w0,null,{default:Ln(()=>[ki("div",null,[ki("p",null,ea(`Nombre y apellidos:${h.nombre}`),1),ki("p",null,ea(`Nombre y apellidos de tus acompa\xF1antes:${h.acompaniantesNombre}`),1),ki("p",null,ea(`N\xFAmero de menus de adulto:${h.numAdultos.value}`),1),ki("p",null,ea(`N\xFAmero de menus de ni\xF1o:${h.numNinios.value}`),1),ki("p",null,ea(`Alergias e intolerancias:${h.alergias}`),1),ki("p",null,ea(`Ir\xE1s en autobus:${h.bus?"S\xED":"No"}`),1),ki("p",null,ea(`Otra informaci\xF3n:${h.observaciones}`),1)]),AM,Ut(b0),ki("div",MM,[Ut(Go,{style:{width:"40%"},color:"black",icon:"cancel",label:"No",rounded:"",onClick:s[8]||(s[8]=D=>b(!1))}),Ut(Go,{style:{width:"40%"},color:"black",icon:"mail_outline",label:"S\xED",rounded:"",onClick:s[9]||(s[9]=D=>E())})])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},xg={left:!0,right:!0,up:!0,down:!0,horizontal:!0,vertical:!0},kM=Object.keys(xg);xg.all=!0;function E0(r){const h={};for(const p of kM)r[p]===!0&&(h[p]=!0);return Object.keys(h).length===0?xg:(h.horizontal===!0?h.left=h.right=!0:h.left===!0&&h.right===!0&&(h.horizontal=!0),h.vertical===!0?h.up=h.down=!0:h.up===!0&&h.down===!0&&(h.vertical=!0),h.horizontal===!0&&h.vertical===!0&&(h.all=!0),h)}function S0(r,h){return h.event===void 0&&r.target!==void 0&&r.target.draggable!==!0&&typeof h.handler=="function"&&r.target.nodeName.toUpperCase()!=="INPUT"&&(r.qClonedBy===void 0||r.qClonedBy.indexOf(h.uid)===-1)}function zM(r){const h=[.06,6,50];return typeof r=="string"&&r.length&&r.split(":").forEach((p,y)=>{const b=parseFloat(p);b&&(h[y]=b)}),h}const PM=cg({name:"touch-swipe",beforeMount(r,{value:h,arg:p,modifiers:y}){if(y.mouse!==!0&&dn.has.touch!==!0)return;const b=y.mouseCapture===!0?"Capture":"",E={handler:h,sensitivity:zM(p),direction:E0(y),noop:Wo,mouseStart(M){S0(M,E)&&GS(M)&&(ll(E,"temp",[[document,"mousemove","move",`notPassive${b}`],[document,"mouseup","end","notPassiveCapture"]]),E.start(M,!0))},touchStart(M){if(S0(M,E)){const s=M.target;ll(E,"temp",[[s,"touchmove","move","notPassiveCapture"],[s,"touchcancel","end","notPassiveCapture"],[s,"touchend","end","notPassiveCapture"]]),E.start(M)}},start(M,s){dn.is.firefox===!0&&e_(r,!0);const D=$f(M);E.event={x:D.left,y:D.top,time:Date.now(),mouse:s===!0,dir:!1}},move(M){if(E.event===void 0)return;if(E.event.dir!==!1){Mn(M);return}const s=Date.now()-E.event.time;if(s===0)return;const D=$f(M),V=D.left-E.event.x,N=Math.abs(V),U=D.top-E.event.y,q=Math.abs(U);if(E.event.mouse!==!0){if(N<E.sensitivity[1]&&q<E.sensitivity[1]){E.end(M);return}}else if(N<E.sensitivity[2]&&q<E.sensitivity[2])return;const Y=N/s,_e=q/s;E.direction.vertical===!0&&N<q&&N<100&&_e>E.sensitivity[0]&&(E.event.dir=U<0?"up":"down"),E.direction.horizontal===!0&&N>q&&q<100&&Y>E.sensitivity[0]&&(E.event.dir=V<0?"left":"right"),E.direction.up===!0&&N<q&&U<0&&N<100&&_e>E.sensitivity[0]&&(E.event.dir="up"),E.direction.down===!0&&N<q&&U>0&&N<100&&_e>E.sensitivity[0]&&(E.event.dir="down"),E.direction.left===!0&&N>q&&V<0&&q<100&&Y>E.sensitivity[0]&&(E.event.dir="left"),E.direction.right===!0&&N>q&&V>0&&q<100&&Y>E.sensitivity[0]&&(E.event.dir="right"),E.event.dir!==!1?(Mn(M),E.event.mouse===!0&&(document.body.classList.add("no-pointer-events--children"),document.body.classList.add("non-selectable"),db(),E.styleCleanup=ve=>{E.styleCleanup=void 0,document.body.classList.remove("non-selectable");const ze=()=>{document.body.classList.remove("no-pointer-events--children")};ve===!0?setTimeout(ze,50):ze()}),E.handler({evt:M,touch:E.event.mouse!==!0,mouse:E.event.mouse,direction:E.event.dir,duration:s,distance:{x:N,y:q}})):E.end(M)},end(M){E.event!==void 0&&(Eh(E,"temp"),dn.is.firefox===!0&&e_(r,!1),E.styleCleanup!==void 0&&E.styleCleanup(!0),M!==void 0&&E.event.dir!==!1&&Mn(M),E.event=void 0)}};if(r.__qtouchswipe=E,y.mouse===!0){const M=y.mouseCapture===!0||y.mousecapture===!0?"Capture":"";ll(E,"main",[[r,"mousedown","mouseStart",`passive${M}`]])}dn.has.touch===!0&&ll(E,"main",[[r,"touchstart","touchStart",`passive${y.capture===!0?"Capture":""}`],[r,"touchmove","noop","notPassiveCapture"]])},updated(r,h){const p=r.__qtouchswipe;p!==void 0&&(h.oldValue!==h.value&&(typeof h.value!="function"&&p.end(),p.handler=h.value),p.direction=E0(h.modifiers))},beforeUnmount(r){const h=r.__qtouchswipe;h!==void 0&&(Eh(h,"main"),Eh(h,"temp"),dn.is.firefox===!0&&e_(r,!1),h.styleCleanup!==void 0&&h.styleCleanup(),delete r.__qtouchswipe)}});function DM(){const r=new Map;return{getCache:function(h,p){return r[h]===void 0?r[h]=p:r[h]},getCacheWithFn:function(h,p){return r[h]===void 0?r[h]=p():r[h]}}}const LM={name:{required:!0},disable:Boolean},C0={setup(r,{slots:h}){return()=>ke("div",{class:"q-panel scroll",role:"tabpanel"},Tn(h.default))}},BM={modelValue:{required:!0},animated:Boolean,infinite:Boolean,swipeable:Boolean,vertical:Boolean,transitionPrev:String,transitionNext:String,transitionDuration:{type:[String,Number],default:300},keepAlive:Boolean,keepAliveInclude:[String,Array,RegExp],keepAliveExclude:[String,Array,RegExp],keepAliveMax:Number},RM=["update:modelValue","before-transition","transition"];function FM(){const{props:r,emit:h,proxy:p}=Vi(),{getCacheWithFn:y}=DM();let b,E;const M=Rt(null),s=Rt(null);function D($e){const Ke=r.vertical===!0?"up":"left";be((p.$q.lang.rtl===!0?-1:1)*($e.direction===Ke?1:-1))}const V=xe(()=>[[PM,D,void 0,{horizontal:r.vertical!==!0,vertical:r.vertical,mouse:!0}]]),N=xe(()=>r.transitionPrev||`slide-${r.vertical===!0?"down":"right"}`),U=xe(()=>r.transitionNext||`slide-${r.vertical===!0?"up":"left"}`),q=xe(()=>`--q-transition-duration: ${r.transitionDuration}ms`),Y=xe(()=>typeof r.modelValue=="string"||typeof r.modelValue=="number"?r.modelValue:String(r.modelValue)),_e=xe(()=>({include:r.keepAliveInclude,exclude:r.keepAliveExclude,max:r.keepAliveMax})),ve=xe(()=>r.keepAliveInclude!==void 0||r.keepAliveExclude!==void 0);ri(()=>r.modelValue,($e,Ke)=>{const Ft=Ue($e)===!0?Ge($e):-1;E!==!0&&De(Ft===-1?0:Ft<Ge(Ke)?-1:1),M.value!==Ft&&(M.value=Ft,h("before-transition",$e,Ke),pn(()=>{h("transition",$e,Ke)}))});function ze(){be(1)}function Ye(){be(-1)}function we($e){h("update:modelValue",$e)}function Ue($e){return $e!=null&&$e!==""}function Ge($e){return b.findIndex(Ke=>Ke.props.name===$e&&Ke.props.disable!==""&&Ke.props.disable!==!0)}function Se(){return b.filter($e=>$e.props.disable!==""&&$e.props.disable!==!0)}function De($e){const Ke=$e!==0&&r.animated===!0&&M.value!==-1?"q-transition--"+($e===-1?N.value:U.value):null;s.value!==Ke&&(s.value=Ke)}function be($e,Ke=M.value){let Ft=Ke+$e;for(;Ft>-1&&Ft<b.length;){const Ht=b[Ft];if(Ht!==void 0&&Ht.props.disable!==""&&Ht.props.disable!==!0){De($e),E=!0,h("update:modelValue",Ht.props.name),setTimeout(()=>{E=!1});return}Ft+=$e}r.infinite===!0&&b.length>0&&Ke!==-1&&Ke!==b.length&&be($e,$e===-1?b.length:-1)}function Pe(){const $e=Ge(r.modelValue);return M.value!==$e&&(M.value=$e),!0}function Xe(){const $e=Ue(r.modelValue)===!0&&Pe()&&b[M.value];return r.keepAlive===!0?[ke(CE,_e.value,[ke(ve.value===!0?y(Y.value,()=>({...C0,name:Y.value})):C0,{key:Y.value,style:q.value},()=>$e)])]:[ke("div",{class:"q-panel scroll",style:q.value,key:Y.value,role:"tabpanel"},[$e])]}function Ve(){if(b.length!==0)return r.animated===!0?[ke(ys,{name:s.value},Xe)]:Xe()}function nt($e){return b=G1(Tn($e.default,[])).filter(Ke=>Ke.props!==null&&Ke.props.slot===void 0&&Ue(Ke.props.name)===!0),b.length}function qe(){return b}return Object.assign(p,{next:ze,previous:Ye,goTo:we}),{panelIndex:M,panelDirectives:V,updatePanelsList:nt,updatePanelIndex:Pe,getPanelContent:Ve,getEnabledPanels:Se,getPanels:qe,isValidPanelName:Ue,keepAliveProps:_e,needsUniqueKeepAliveWrapper:ve,goToPanelByOffset:be,goToPanel:we,nextPanel:ze,previousPanel:Ye}}const Qs=Hi({name:"QCarouselSlide",props:{...LM,imgSrc:String},setup(r,{slots:h}){const p=xe(()=>r.imgSrc?{backgroundImage:`url("${r.imgSrc}")`}:{});return()=>ke("div",{class:"q-carousel__slide",style:p.value},Tn(h.default))}});let fh=0;const OM={fullscreen:Boolean,noRouteFullscreenExit:Boolean},VM=["update:fullscreen","fullscreen"];function UM(){const r=Vi(),{props:h,emit:p,proxy:y}=r;let b,E,M;const s=Rt(!1);dg(r)===!0&&ri(()=>y.$route.fullPath,()=>{h.noRouteFullscreenExit!==!0&&N()}),ri(()=>h.fullscreen,U=>{s.value!==U&&D()}),ri(s,U=>{p("update:fullscreen",U),p("fullscreen",U)});function D(){s.value===!0?N():V()}function V(){s.value!==!0&&(s.value=!0,M=y.$el.parentNode,M.replaceChild(E,y.$el),document.body.appendChild(y.$el),fh++,fh===1&&document.body.classList.add("q-body--fullscreen-mixin"),b={handler:N},zh.add(b))}function N(){s.value===!0&&(b!==void 0&&(zh.remove(b),b=void 0),M.replaceChild(y.$el,E),s.value=!1,fh=Math.max(0,fh-1),fh===0&&(document.body.classList.remove("q-body--fullscreen-mixin"),y.$el.scrollIntoView!==void 0&&setTimeout(()=>{y.$el.scrollIntoView()})))}return J_(()=>{E=document.createElement("span")}),mr(()=>{h.fullscreen===!0&&V()}),mn(N),Object.assign(y,{toggleFullscreen:D,setFullscreen:V,exitFullscreen:N}),{inFullscreen:s,toggleFullscreen:D}}const NM=["top","right","bottom","left"],jM=["regular","flat","outline","push","unelevated"],qM=Hi({name:"QCarousel",props:{...ca,...BM,...OM,transitionPrev:{type:String,default:"fade"},transitionNext:{type:String,default:"fade"},height:String,padding:Boolean,controlColor:String,controlTextColor:String,controlType:{type:String,validator:r=>jM.includes(r),default:"flat"},autoplay:[Number,Boolean],arrows:Boolean,prevIcon:String,nextIcon:String,navigation:Boolean,navigationPosition:{type:String,validator:r=>NM.includes(r)},navigationIcon:String,navigationActiveIcon:String,thumbnails:Boolean},emits:[...VM,...RM],setup(r,{slots:h}){const{proxy:{$q:p}}=Vi(),y=ua(r,p);let b,E;const{updatePanelsList:M,getPanelContent:s,panelDirectives:D,goToPanel:V,previousPanel:N,nextPanel:U,getEnabledPanels:q,panelIndex:Y}=FM(),{inFullscreen:_e}=UM(),ve=xe(()=>_e.value!==!0&&r.height!==void 0?{height:r.height}:{}),ze=xe(()=>r.vertical===!0?"vertical":"horizontal"),Ye=xe(()=>`q-carousel q-panel-parent q-carousel--with${r.padding===!0?"":"out"}-padding`+(_e.value===!0?" fullscreen":"")+(y.value===!0?" q-carousel--dark q-dark":"")+(r.arrows===!0?` q-carousel--arrows-${ze.value}`:"")+(r.navigation===!0?` q-carousel--navigation-${Se.value}`:"")),we=xe(()=>{const Ve=[r.prevIcon||p.iconSet.carousel[r.vertical===!0?"up":"left"],r.nextIcon||p.iconSet.carousel[r.vertical===!0?"down":"right"]];return r.vertical===!1&&p.lang.rtl===!0?Ve.reverse():Ve}),Ue=xe(()=>r.navigationIcon||p.iconSet.carousel.navigationIcon),Ge=xe(()=>r.navigationActiveIcon||Ue.value),Se=xe(()=>r.navigationPosition||(r.vertical===!0?"right":"bottom")),De=xe(()=>({color:r.controlColor,textColor:r.controlTextColor,round:!0,[r.controlType]:!0,dense:!0}));ri(()=>r.modelValue,()=>{r.autoplay&&(clearInterval(b),be())}),ri(()=>r.autoplay,Ve=>{Ve?be():clearInterval(b)});function be(){const Ve=cC(r.autoplay)===!0?r.autoplay:5e3;b=setTimeout(Ve>=0?U:N,Math.abs(Ve))}mr(()=>{r.autoplay&&be()}),mn(()=>{clearInterval(b)});function Pe(Ve,nt){return ke("div",{class:`q-carousel__control q-carousel__navigation no-wrap absolute flex q-carousel__navigation--${Ve} q-carousel__navigation--${Se.value}`+(r.controlColor!==void 0?` text-${r.controlColor}`:"")},[ke("div",{class:"q-carousel__navigation-inner flex flex-center no-wrap"},q().map(nt))])}function Xe(){const Ve=[];if(r.navigation===!0){const nt=h["navigation-icon"]!==void 0?h["navigation-icon"]:$e=>ke(Go,{key:"nav"+$e.name,class:`q-carousel__navigation-icon q-carousel__navigation-icon--${$e.active===!0?"":"in"}active`,...$e.btnProps,onClick:$e.onClick}),qe=E-1;Ve.push(Pe("buttons",($e,Ke)=>{const Ft=$e.props.name,Ht=Y.value===Ke;return nt({index:Ke,maxIndex:qe,name:Ft,active:Ht,btnProps:{icon:Ht===!0?Ge.value:Ue.value,size:"sm",...De.value},onClick:()=>{V(Ft)}})}))}else if(r.thumbnails===!0){const nt=r.controlColor!==void 0?` text-${r.controlColor}`:"";Ve.push(Pe("thumbnails",qe=>{const $e=qe.props;return ke("img",{key:"tmb#"+$e.name,class:`q-carousel__thumbnail q-carousel__thumbnail--${$e.name===r.modelValue?"":"in"}active`+nt,src:$e.imgSrc||$e["img-src"],onClick:()=>{V($e.name)}})}))}return r.arrows===!0&&Y.value>=0&&((r.infinite===!0||Y.value>0)&&Ve.push(ke("div",{key:"prev",class:`q-carousel__control q-carousel__arrow q-carousel__prev-arrow q-carousel__prev-arrow--${ze.value} absolute flex flex-center`},[ke(Go,{icon:we.value[0],...De.value,onClick:N})])),(r.infinite===!0||Y.value<E-1)&&Ve.push(ke("div",{key:"next",class:`q-carousel__control q-carousel__arrow q-carousel__next-arrow q-carousel__next-arrow--${ze.value} absolute flex flex-center`},[ke(Go,{icon:we.value[1],...De.value,onClick:U})]))),Jr(h.control,Ve)}return()=>(E=M(h),ke("div",{class:Ye.value,style:ve.value},[j1("div",{class:"q-carousel__slides-container"},s(),"sl-cont",r.swipeable,()=>D.value)].concat(Xe())))}}),$M="/assets/restaurante.6e2a3953.jpeg",GM="/assets/boda-ali.232ec7ae.jpeg",ZM="/assets/boda-ana.8e21094f.jpeg",WM="/assets/cala.f0770073.jpeg",HM="/assets/gorra-verde.9b93d1c2.jpeg",XM="/assets/monte.3968e21c.jpeg",KM="/assets/thor.f22c0701.jpeg",YM="/assets/terrorista.3f475105.jpeg",JM=ki("div",{class:"col-12 column",style:{padding:"1rem"}},[ki("p",{class:"text-justify"},"\xA1Bienvenid@s! Despu\xE9s de vivir juntos en Madrid, pasar un confinamiento extricto, comprar una casa en Alcal\xE1 de Henares, el nacimiento de Iv\xE1n, retrasar una boda por su llegada e ir a cinco bodas de las cuales ninguna ha sido la nuestra... "),ki("p",{class:"text-justify"},[Mc("Nos complace anunciar que el pr\xF3ximo d\xEDa s\xE1bado "),ki("strong",null,[ki("u",null,"27 de Mayo de 2023")]),Mc(" celebraremos nuestro matrimonio junto a nuestros seres queridos.")])],-1),QM={__name:"Inicio",setup(r){const h=Rt(1),p=Rt(!0);return(y,b)=>(nr(),la(wr,null,[Ut(Oh,{title:"Inicio"}),JM,Ut(qM,{swipeable:"",animated:"",modelValue:h.value,"onUpdate:modelValue":b[0]||(b[0]=E=>h.value=E),thumbnails:"",autoplay:p.value,infinite:"","transition-prev":"slide-right","transition-next":"slide-left",onMouseenter:b[1]||(b[1]=E=>p.value=!1),onMouseleave:b[2]||(b[2]=E=>p.value=!0)},{default:Ln(()=>[Ut(Qs,{name:1,"img-src":$M}),Ut(Qs,{name:2,"img-src":GM}),Ut(Qs,{name:3,"img-src":ZM}),Ut(Qs,{name:4,"img-src":WM}),Ut(Qs,{name:5,"img-src":HM}),Ut(Qs,{name:6,"img-src":XM}),Ut(Qs,{name:7,"img-src":KM}),Ut(Qs,{name:8,"img-src":YM}),Mc(" > ")]),_:1},8,["modelValue","autoplay"])],64))}},ph=Hi({name:"QTimelineEntry",props:{heading:Boolean,tag:{type:String,default:"h3"},side:{type:String,default:"right",validator:r=>["left","right"].includes(r)},icon:String,avatar:String,color:String,title:String,subtitle:String,body:String},setup(r,{slots:h}){const p=Zo(V1,()=>{console.error("QTimelineEntry needs to be child of QTimeline")}),y=xe(()=>`q-timeline__entry q-timeline__entry--${r.side}`+(r.icon!==void 0||r.avatar!==void 0?" q-timeline__entry--icon":"")),b=xe(()=>`q-timeline__dot text-${r.color||p.color}`),E=xe(()=>p.layout==="comfortable"&&p.side==="left");return()=>{const M=hg(h.default,[]);if(r.body!==void 0&&M.unshift(r.body),r.heading===!0){const V=[ke("div"),ke("div"),ke(r.tag,{class:"q-timeline__heading-title"},M)];return ke("div",{class:"q-timeline__heading"},E.value===!0?V.reverse():V)}let s;r.icon!==void 0?s=[ke(jn,{class:"row items-center justify-center",name:r.icon})]:r.avatar!==void 0&&(s=[ke("img",{class:"q-timeline__dot-img",src:r.avatar})]);const D=[ke("div",{class:"q-timeline__subtitle"},[ke("span",{},Tn(h.subtitle,[r.subtitle]))]),ke("div",{class:b.value},s),ke("div",{class:"q-timeline__content"},[ke("h6",{class:"q-timeline__title"},Tn(h.title,[r.title]))].concat(M))];return ke("li",{class:y.value},E.value===!0?D.reverse():D)}}}),eI=Hi({name:"QTimeline",props:{...ca,color:{type:String,default:"primary"},side:{type:String,default:"right",validator:r=>["left","right"].includes(r)},layout:{type:String,default:"dense",validator:r=>["dense","comfortable","loose"].includes(r)}},setup(r,{slots:h}){const p=Vi(),y=ua(r,p.proxy.$q);Bh(V1,r);const b=xe(()=>`q-timeline q-timeline--${r.layout} q-timeline--${r.layout}--${r.side}`+(y.value===!0?" q-timeline--dark":""));return()=>ke("ul",{class:b.value},Tn(h.default))}}),tI={class:"col-12 column",style:{padding:"1rem"}},iI={class:"q-px-lg q-pb-md"},nI={__name:"Itinerario",setup(r){return(h,p)=>(nr(),la(wr,null,[Ut(Oh,{title:"Itinerario"}),ki("div",tI,[ki("div",iI,[Ut(eI,{color:"secondary"},{default:Ln(()=>[Ut(ph,{title:"Ceremonia",subtitle:"13:30H",icon:"church",body:"Un ofreciante dedicar\xE1 unas palabras. Adem\xE1s hablaran amigos y familiares de los novios.",color:"pink"}),Ut(ph,{title:"Coctel",subtitle:"14:30H",icon:"tapas",body:"Se servir\xE1 un magn\xEDfico coctel de bienvenida, en el cual habr\xE1 comida y bebida."}),Ut(ph,{title:"Comida",subtitle:"16:00",icon:"restaurant",color:"green",body:"Momento de disfrutar del men\xFA, cuanta con dos platos y postre."}),Ut(ph,{title:"Fiesta",subtitle:"18:00",icon:"nightlife",body:"Ser\xE1 hora de bailar y brindar para celebrar el matrimonio.",color:"red"}),Ut(ph,{title:"Recena",subtitle:"21:00",color:"orange",icon:"lunch_dining",body:"Una hora antes de finalizar la fiesta habr\xE1 una peque\xF1a sorpresa para cenar."})]),_:1})])])],64))}};var rI=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Sb={exports:{}};(function(r,h){(function(p,y){r.exports=y()})(rI,function(){var p,y,b;function E(s,D){if(!p)p=D;else if(!y)y=D;else{var V="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+p+")(sharedChunk); ("+y+")(sharedChunk); self.onerror = null;",N={};p(N),b=D(N),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(b.workerUrl=window.URL.createObjectURL(new Blob([V],{type:"text/javascript"})))}}E(["exports"],function(s){var D=typeof self<"u"?self:{},V=N;function N(i,e,t,o){this.cx=3*i,this.bx=3*(t-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=o,this.p2x=t,this.p2y=o}N.prototype.sampleCurveX=function(i){return((this.ax*i+this.bx)*i+this.cx)*i},N.prototype.sampleCurveY=function(i){return((this.ay*i+this.by)*i+this.cy)*i},N.prototype.sampleCurveDerivativeX=function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},N.prototype.solveCurveX=function(i,e){var t,o,l,u,f;for(e===void 0&&(e=1e-6),l=i,f=0;f<8;f++){if(u=this.sampleCurveX(l)-i,Math.abs(u)<e)return l;var m=this.sampleCurveDerivativeX(l);if(Math.abs(m)<1e-6)break;l-=u/m}if((l=i)<(t=0))return t;if(l>(o=1))return o;for(;t<o;){if(u=this.sampleCurveX(l),Math.abs(u-i)<e)return l;i>u?t=l:o=l,l=.5*(o-t)+t}return l},N.prototype.solve=function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))};var U=q;function q(i,e){this.x=i,this.y=e}q.prototype={clone:function(){return new q(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,t=i.y-this.y;return e*e+t*t},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),t=Math.sin(i),o=t*this.x+e*this.y;return this.x=e*this.x-t*this.y,this.y=o,this},_rotateAround:function(i,e){var t=Math.cos(i),o=Math.sin(i),l=e.y+o*(this.x-e.x)+t*(this.y-e.y);return this.x=e.x+t*(this.x-e.x)-o*(this.y-e.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},q.convert=function(i){return i instanceof q?i:Array.isArray(i)?new q(i[0],i[1]):i};const Y=Math.PI/180,_e=180/Math.PI;function ve(i){return i*Y}function ze(i){return i*_e}const Ye=[[0,0],[1,0],[1,1],[0,1]];function we(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,t=e*i;return 4*(i<.5?t:3*(i-e)+t-.75)}function Ue(i,e,t,o){const l=new V(i,e,t,o);return function(u){return l.solve(u)}}const Ge=Ue(.25,.1,.25,1);function Se(i,e,t){return Math.min(t,Math.max(e,i))}function De(i,e,t){return(t=Se((t-i)/(e-i),0,1))*t*(3-2*t)}function be(i,e,t){const o=t-e,l=((i-e)%o+o)%o+e;return l===e?t:l}function Pe(i,e,t){if(!i.length)return t(null,[]);let o=i.length;const l=new Array(i.length);let u=null;i.forEach((f,m)=>{e(f,(v,x)=>{v&&(u=v),l[m]=x,--o==0&&t(u,l)})})}function Xe(i){const e=[];for(const t in i)e.push(i[t]);return e}function Ve(i,...e){for(const t of e)for(const o in t)i[o]=t[o];return i}let nt=1;function qe(){return nt++}function $e(){return function i(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function Ke(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function Ft(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function Ht(i,e){i.forEach(t=>{e[t]&&(e[t]=e[t].bind(e))})}function ot(i,e){return i.indexOf(e,i.length-e.length)!==-1}function At(i,e,t){const o={};for(const l in i)o[l]=e.call(t||this,i[l],l,i);return o}function di(i,e,t){const o={};for(const l in i)e.call(t||this,i[l],l,i)&&(o[l]=i[l]);return o}function Fe(i){return Array.isArray(i)?i.map(Fe):typeof i=="object"&&i?At(i,Fe):i}const _t={};function xt(i){_t[i]||(typeof console<"u"&&console.warn(i),_t[i]=!0)}function Lt(i,e,t){return(t.y-i.y)*(e.x-i.x)>(e.y-i.y)*(t.x-i.x)}function pi(i){let e=0;for(let t,o,l=0,u=i.length,f=u-1;l<u;f=l++)t=i[l],o=i[f],e+=(o.x-t.x)*(t.y+o.y);return e}function Si(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Kt(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(t,o,l,u)=>{const f=l||u;return e[o]=!f||f.toLowerCase(),""}),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e}let Yt=null;function Jt(i){if(Yt==null){const e=i.navigator?i.navigator.userAgent:null;Yt=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Yt}function Et(i){try{const e=D[i];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Bi(i,e){return[i[4*e],i[4*e+1],i[4*e+2],i[4*e+3]]}const xn=D.performance;function ue(i){const e=i?i.url.toString():void 0;return xn.getEntriesByName(e)}var Te="2.10.0";let Be,ct,ut,bt;const Mt={now:()=>ut!==void 0?ut:D.performance.now(),setNow(i){ut=i},restoreNow(){ut=void 0},frame(i){const e=D.requestAnimationFrame(i);return{cancel:()=>D.cancelAnimationFrame(e)}},getImageData(i,e=0){const{width:t,height:o}=i;bt||(bt=D.document.createElement("canvas"));const l=bt.getContext("2d");if(!l)throw new Error("failed to create canvas 2d context");return(t>bt.width||o>bt.height)&&(bt.width=t,bt.height=o),l.clearRect(-e,-e,t+2*e,o+2*e),l.drawImage(i,0,0,t,o),l.getImageData(-e,-e,t+2*e,o+2*e)},resolveURL:i=>(Be||(Be=D.document.createElement("a")),Be.href=i,Be.href),get devicePixelRatio(){return D.devicePixelRatio},get prefersReducedMotion(){return!!D.matchMedia&&(ct==null&&(ct=D.matchMedia("(prefers-reduced-motion: reduce)")),ct.matches)}};let gt;const He={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(gt==null){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{gt=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):i}catch{gt=i}}return gt},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ht={supported:!1,testSupport:function(i){!Zt&&Nt&&(ti?mi(i):qt=i)}};let qt,Nt,Zt=!1,ti=!1;function mi(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,Nt),i.isContextLost())return;ht.supported=!0}catch{}i.deleteTexture(e),Zt=!0}D.document&&(Nt=D.document.createElement("img"),Nt.onload=function(){qt&&mi(qt),qt=null,ti=!0},Nt.onerror=function(){Zt=!0,qt=null},Nt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const zi="01",si="NO_ACCESS_TOKEN";function Ci(i){return i.indexOf("mapbox:")===0}function un(i){return He.API_URL_REGEX.test(i)}const _r=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function En(i){const e=i.match(_r);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function In(i){const e=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${e}`}function qr(i){if(!i)return null;const e=i.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(D.atob(e[1]).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class _n{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const t=qr(He.ACCESS_TOKEN);let o="";return o=t&&t.u?D.btoa(encodeURIComponent(t.u).replace(/%([0-9A-F]{2})/g,(l,u)=>String.fromCharCode(Number("0x"+u)))):He.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${o}`:`mapbox.eventData:${o}`}fetchEventData(){const e=Et("localStorage"),t=this.getStorageKey(),o=this.getStorageKey("uuid");if(e)try{const l=D.localStorage.getItem(t);l&&(this.eventData=JSON.parse(l));const u=D.localStorage.getItem(o);u&&(this.anonId=u)}catch{xt("Unable to read from LocalStorage")}}saveEventData(){const e=Et("localStorage"),t=this.getStorageKey(),o=this.getStorageKey("uuid");if(e)try{D.localStorage.setItem(o,this.anonId),Object.keys(this.eventData).length>=1&&D.localStorage.setItem(t,JSON.stringify(this.eventData))}catch{xt("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,t,o,l){if(!He.EVENTS_URL)return;const u=En(He.EVENTS_URL);u.params.push(`access_token=${l||He.ACCESS_TOKEN||""}`);const f={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:Te,skuId:zi,userId:this.anonId},m=t?Ve(f,t):f,v={url:In(u),headers:{"Content-Type":"text/plain"},body:JSON.stringify([m])};this.pendingRequest=Qe(v,x=>{this.pendingRequest=null,o(x),this.saveEventData(),this.processRequests(l)})}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const kn=new class extends _n{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,e){He.EVENTS_URL&&He.ACCESS_TOKEN&&Array.isArray(i)&&i.some(t=>Ci(t)||un(t))&&this.queueRequest(Date.now(),e)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=qr(He.ACCESS_TOKEN),t=e?e.u:He.ACCESS_TOKEN;let o=t!==this.eventData.tokenU;Ft(this.anonId)||(this.anonId=$e(),o=!0);const l=this.queue.shift();if(this.eventData.lastSuccess){const u=new Date(this.eventData.lastSuccess),f=new Date(l),m=(l-this.eventData.lastSuccess)/864e5;o=o||m>=1||m<-1||u.getDate()!==f.getDate()}else o=!0;o?this.postEvent(l,{"enabled.telemetry":!1},u=>{u||(this.eventData.lastSuccess=l,this.eventData.tokenU=t)},i):this.processRequests()}},Pr=kn.postTurnstileEvent.bind(kn),wo=new class extends _n{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,e,t,o){this.skuToken=e,this.errorCb=o,He.EVENTS_URL&&(t||He.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},t):this.errorCb(new Error(si)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:t}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Ft(this.anonId)||(this.anonId=$e()),this.postEvent(t,{skuToken:this.skuToken},o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},i))}},Ho=wo.postMapLoadEvent.bind(wo),bs=new class extends _n{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,e,t,o){if(!He.API_URL||!He.SESSION_PATH)return;const l=En(He.API_URL+He.SESSION_PATH);l.params.push(`sku=${e||""}`),l.params.push(`access_token=${o||He.ACCESS_TOKEN||""}`);const u={url:In(l),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Ct(u,f=>{this.pendingRequest=null,t(f),this.saveEventData(),this.processRequests(o)})}getSessionAPI(i,e,t,o){this.skuToken=e,this.errorCb=o,He.SESSION_PATH&&He.API_URL&&(t||He.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},t):this.errorCb(new Error(si)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:t}=this.queue.shift();e&&this.success[e]||this.getSession(t,this.skuToken,o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},i)}},ha=bs.getSessionAPI.bind(bs),Dr=new Set;let Lr,to=500,io=50,Sn={};function Tr(i){const e=F(i);let t,o;e&&e.forEach(u=>{const f=u.split("=");f[0]==="language"?t=f[1]:f[0]==="worldview"&&(o=f[1])});let l="mapbox-tiles";return t&&(l+=`-${t}`),o&&(l+=`-${o}`),l}function Q(){try{return D.caches}catch{}}function B(i){const e=Q();e&&!Sn[i]&&(Sn[i]=e.open(i))}function F(i){const e=i.indexOf("?");return e>0?i.slice(e+1).split("&"):[]}function J(i){const e=i.indexOf("?");if(e<0)return i;const t=F(i).filter(o=>{const l=o.split("=");return l[0]==="language"||l[0]==="worldview"});return t.length?`${i.slice(0,e)}?${t.join("&")}`:i.slice(0,e)}let ne=1/0;const me={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(me);class Me extends Error{constructor(e,t,o){t===401&&un(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ee=Si()?()=>self.worker&&self.worker.referrer:()=>(D.location.protocol==="blob:"?D.parent:D).location.href,ge=function(i,e){if(!(/^file:/.test(t=i.url)||/^file:/.test(Ee())&&!/^\w+:/.test(t))){if(D.fetch&&D.Request&&D.AbortController&&D.Request.prototype.hasOwnProperty("signal"))return function(o,l){const u=new D.AbortController,f=new D.Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:Ee(),signal:u.signal});let m=!1,v=!1;const x=(S=f.url).indexOf("sku=")>0&&un(S);var S;o.type==="json"&&f.headers.set("Accept","application/json");const A=(P,L,O)=>{if(v)return;if(P&&P.message!=="SecurityError"&&xt(P),L&&O)return I(L);const $=Date.now();D.fetch(f).then(ee=>{if(ee.ok){const se=x?ee.clone():null;return I(ee,se,$)}return l(new Me(ee.statusText,ee.status,o.url))}).catch(ee=>{ee.code!==20&&l(new Error(ee.message))})},I=(P,L,O)=>{(o.type==="arrayBuffer"?P.arrayBuffer():o.type==="json"?P.json():P.text()).then($=>{v||(L&&O&&function(ee,se,ie){const re=Tr(ee.url);if(B(re),!Sn[re])return;const pe={status:se.status,statusText:se.statusText,headers:new D.Headers};se.headers.forEach((Re,We)=>pe.headers.set(We,Re));const ae=Kt(se.headers.get("Cache-Control")||"");if(ae["no-store"])return;ae["max-age"]&&pe.headers.set("Expires",new Date(ie+1e3*ae["max-age"]).toUTCString());const Oe=pe.headers.get("Expires");Oe&&(new Date(Oe).getTime()-ie<42e4||function(Re,We){if(Lr===void 0)try{new Response(new ReadableStream),Lr=!0}catch{Lr=!1}Lr?We(Re.body):Re.blob().then(We)}(se,Re=>{const We=new D.Response(Re,pe);B(re),Sn[re]&&Sn[re].then(yt=>yt.put(J(ee.url),We)).catch(yt=>xt(yt.message))}))}(f,L,O),m=!0,l(null,$,P.headers.get("Cache-Control"),P.headers.get("Expires")))}).catch($=>{v||l(new Error($.message))})};return x?function(P,L){const O=Tr(P.url);if(B(O),!Sn[O])return L(null);const $=J(P.url);Sn[O].then(ee=>{ee.match($).then(se=>{const ie=function(re){if(!re)return!1;const pe=new Date(re.headers.get("Expires")||0),ae=Kt(re.headers.get("Cache-Control")||"");return pe>Date.now()&&!ae["no-cache"]}(se);ee.delete($),ie&&ee.put($,se.clone()),L(null,se,ie)}).catch(L)}).catch(L)}(f,A):A(null,null),{cancel:()=>{v=!0,m||u.abort()}}}(i,e);if(Si()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var t;return function(o,l){const u=new D.XMLHttpRequest;u.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(const f in o.headers)u.setRequestHeader(f,o.headers[f]);return o.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=o.credentials==="include",u.onerror=()=>{l(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let f=u.response;if(o.type==="json")try{f=JSON.parse(u.response)}catch(m){return l(m)}l(null,f,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else l(new Me(u.statusText,u.status,o.url))},u.send(o.body),{cancel:()=>u.abort()}}(i,e)},Ie=function(i,e){return ge(Ve(i,{type:"arrayBuffer"}),e)},Qe=function(i,e){return ge(Ve(i,{method:"POST"}),e)},Ct=function(i,e){return ge(Ve(i,{method:"GET"}),e)};function st(i){const e=D.document.createElement("a");return e.href=i,e.protocol===D.document.location.protocol&&e.host===D.document.location.host}const $t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Xt,jt;Xt=[],jt=0;const Qt=function(i,e){if(ht.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),jt>=He.MAX_PARALLEL_IMAGE_REQUESTS){const u={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Xt.push(u),u}jt++;let t=!1;const o=()=>{if(!t)for(t=!0,jt--;Xt.length&&jt<He.MAX_PARALLEL_IMAGE_REQUESTS;){const u=Xt.shift(),{requestParameters:f,callback:m,cancelled:v}=u;v||(u.cancel=Qt(f,m).cancel)}},l=Ie(i,(u,f,m,v)=>{o(),u?e(u):f&&(D.createImageBitmap?function(x,S){const A=new D.Blob([new Uint8Array(x)],{type:"image/png"});D.createImageBitmap(A).then(I=>{S(null,I)}).catch(I=>{S(new Error(`Could not load image because of ${I.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(f,(x,S)=>e(x,S,m,v)):function(x,S){const A=new D.Image,I=D.URL;A.onload=()=>{S(null,A),I.revokeObjectURL(A.src),A.onload=null,D.requestAnimationFrame(()=>{A.src=$t})},A.onerror=()=>S(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const P=new D.Blob([new Uint8Array(x)],{type:"image/png"});A.src=x.byteLength?I.createObjectURL(P):$t}(f,(x,S)=>e(x,S,m,v)))});return{cancel:()=>{l.cancel(),o()}}};function ci(i,e,t){t[i]&&t[i].indexOf(e)!==-1||(t[i]=t[i]||[],t[i].push(e))}function Pi(i,e,t){if(t&&t[i]){const o=t[i].indexOf(e);o!==-1&&t[i].splice(o,1)}}class ce{constructor(e,t={}){Ve(this,t),this.type=e}}class vt extends ce{constructor(e,t={}){super("error",Ve({error:e},t))}}class Ze{on(e,t){return this._listeners=this._listeners||{},ci(e,t,this._listeners),this}off(e,t){return Pi(e,t,this._listeners),Pi(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},ci(e,t,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,t){typeof e=="string"&&(e=new ce(e,t||{}));const o=e.type;if(this.listens(o)){e.target=this;const l=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const m of l)m.call(this,e);const u=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const m of u)Pi(o,m,this._oneTimeListeners),m.call(this,e);const f=this._eventedParent;f&&(Ve(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),f.fire(e))}else e instanceof vt&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}var Ce=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function wi(i,...e){for(const t of e)for(const o in t)i[o]=t[o];return i}function ni(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function $i(i){if(Array.isArray(i))return i.map($i);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const t in i)e[t]=$i(i[t]);return e}return ni(i)}class Cn extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}var Kn=Cn;class _l{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[o,l]of t)this.bindings[o]=l}concat(e){return new _l(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var bp=_l;const ws={kind:"null"},zt={kind:"number"},gi={kind:"string"},yi={kind:"boolean"},Br={kind:"color"},Rr={kind:"object"},ui={kind:"value"},da={kind:"collator"},fa={kind:"formatted"},pa={kind:"resolvedImage"};function gr(i,e){return{kind:"array",itemType:i,N:e}}function sn(i){if(i.kind==="array"){const e=sn(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const Nh=[ws,zt,gi,yi,Br,fa,Rr,gr(ui),pa];function Ts(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Ts(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const t of Nh)if(!Ts(t,e))return null}}return`Expected ${sn(i)} but found ${sn(e)} instead.`}function gl(i,e){return e.some(t=>t.kind===i.kind)}function To(i,e){return e.some(t=>t==="null"?i===null:t==="array"?Array.isArray(i):t==="object"?i&&!Array.isArray(i)&&typeof i=="object":t===typeof i)}function Rc(i){var e={exports:{}};return i(e,e.exports),e.exports}var Eo=Rc(function(i,e){var t={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function o(m){return(m=Math.round(m))<0?0:m>255?255:m}function l(m){return o(m[m.length-1]==="%"?parseFloat(m)/100*255:parseInt(m))}function u(m){return(v=m[m.length-1]==="%"?parseFloat(m)/100:parseFloat(m))<0?0:v>1?1:v;var v}function f(m,v,x){return x<0?x+=1:x>1&&(x-=1),6*x<1?m+(v-m)*x*6:2*x<1?v:3*x<2?m+(v-m)*(2/3-x)*6:m}try{e.parseCSSColor=function(m){var v,x=m.replace(/ /g,"").toLowerCase();if(x in t)return t[x].slice();if(x[0]==="#")return x.length===4?(v=parseInt(x.substr(1),16))>=0&&v<=4095?[(3840&v)>>4|(3840&v)>>8,240&v|(240&v)>>4,15&v|(15&v)<<4,1]:null:x.length===7&&(v=parseInt(x.substr(1),16))>=0&&v<=16777215?[(16711680&v)>>16,(65280&v)>>8,255&v,1]:null;var S=x.indexOf("("),A=x.indexOf(")");if(S!==-1&&A+1===x.length){var I=x.substr(0,S),P=x.substr(S+1,A-(S+1)).split(","),L=1;switch(I){case"rgba":if(P.length!==4)return null;L=u(P.pop());case"rgb":return P.length!==3?null:[l(P[0]),l(P[1]),l(P[2]),L];case"hsla":if(P.length!==4)return null;L=u(P.pop());case"hsl":if(P.length!==3)return null;var O=(parseFloat(P[0])%360+360)%360/360,$=u(P[1]),ee=u(P[2]),se=ee<=.5?ee*($+1):ee+$-ee*$,ie=2*ee-se;return[o(255*f(ie,se,O+1/3)),o(255*f(ie,se,O)),o(255*f(ie,se,O-1/3)),L];default:return null}}return null}}catch{}});class Yn{constructor(e,t,o,l=1){this.r=e,this.g=t,this.b=o,this.a=l}static parse(e){if(!e)return;if(e instanceof Yn)return e;if(typeof e!="string")return;const t=Eo.parseCSSColor(e);return t?new Yn(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3]):void 0}toString(){const[e,t,o,l]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(o)},${l})`}toArray(){const{r:e,g:t,b:o,a:l}=this;return l===0?[0,0,0,0]:[255*e/l,255*t/l,255*o/l,l]}toArray01(){const{r:e,g:t,b:o,a:l}=this;return l===0?[0,0,0,0]:[e/l,t/l,o/l,l]}toArray01PremultipliedAlpha(){const{r:e,g:t,b:o,a:l}=this;return[e,t,o,l]}}Yn.black=new Yn(0,0,0,1),Yn.white=new Yn(1,1,1,1),Yn.transparent=new Yn(0,0,0,0),Yn.red=new Yn(1,0,0,1),Yn.blue=new Yn(0,0,1,1);var Ni=Yn;class Fc{constructor(e,t,o){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ma{constructor(e,t,o,l,u){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=o,this.fontStack=l,this.textColor=u}}class sr{constructor(e){this.sections=e}static fromString(e){return new sr([new ma(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof sr?e:sr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.name]);continue}e.push(t.text);const o={};t.fontStack&&(o["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(o["font-scale"]=t.scale),t.textColor&&(o["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(o)}return e}}class ar{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new ar({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Oc(i,e,t,o){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[i,e,t,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[i,e,t,o]:[i,e,t]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function So(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Ni||i instanceof Fc||i instanceof sr||i instanceof ar)return!0;if(Array.isArray(i)){for(const e of i)if(!So(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!So(i[e]))return!1;return!0}return!1}function gn(i){if(i===null)return ws;if(typeof i=="string")return gi;if(typeof i=="boolean")return yi;if(typeof i=="number")return zt;if(i instanceof Ni)return Br;if(i instanceof Fc)return da;if(i instanceof sr)return fa;if(i instanceof ar)return pa;if(Array.isArray(i)){const e=i.length;let t;for(const o of i){const l=gn(o);if(t){if(t===l)continue;t=ui;break}t=l}return gr(t||ui,e)}return Rr}function _a(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof Ni||i instanceof sr||i instanceof ar?i.toString():JSON.stringify(i)}class Vc{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(e.length!==2)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!So(e[1]))return t.error("invalid value");const o=e[1];let l=gn(o);const u=t.expectedType;return l.kind!=="array"||l.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(l=u),new Vc(l,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ni?["rgba"].concat(this.value.toArray()):this.value instanceof sr?this.value.serialize():this.value}}var ga=Vc,Pn=class{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}};const ya={string:gi,number:zt,boolean:yi,object:Rr};class Uc{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let o,l=1;const u=e[0];if(u==="array"){let m,v;if(e.length>2){const x=e[1];if(typeof x!="string"||!(x in ya)||x==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);m=ya[x],l++}else m=ui;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);v=e[2],l++}o=gr(m,v)}else o=ya[u];const f=[];for(;l<e.length;l++){const m=t.parse(e[l],l,ui);if(!m)return null;f.push(m)}return new Uc(o,f)}evaluate(e){for(let t=0;t<this.args.length;t++){const o=this.args[t].evaluate(e);if(!Ts(this.type,gn(o)))return o;if(t===this.args.length-1)throw new Pn(`Expected value to be of type ${sn(this.type)}, but found ${sn(gn(o))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,t=[e.kind];if(e.kind==="array"){const o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){t.push(o.kind);const l=e.N;(typeof l=="number"||this.args.length>1)&&t.push(l)}}return t.concat(this.args.map(o=>o.serialize()))}}var Er=Uc;class va{constructor(e){this.type=fa,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return t.error("First argument must be an image or text section.");const l=[];let u=!1;for(let f=1;f<=e.length-1;++f){const m=e[f];if(u&&typeof m=="object"&&!Array.isArray(m)){u=!1;let v=null;if(m["font-scale"]&&(v=t.parse(m["font-scale"],1,zt),!v))return null;let x=null;if(m["text-font"]&&(x=t.parse(m["text-font"],1,gr(gi)),!x))return null;let S=null;if(m["text-color"]&&(S=t.parse(m["text-color"],1,Br),!S))return null;const A=l[l.length-1];A.scale=v,A.font=x,A.textColor=S}else{const v=t.parse(e[f],1,ui);if(!v)return null;const x=v.type.kind;if(x!=="string"&&x!=="value"&&x!=="null"&&x!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,l.push({content:v,scale:null,font:null,textColor:null})}}return new va(l)}evaluate(e){return new sr(this.sections.map(t=>{const o=t.content.evaluate(e);return gn(o)===pa?new ma("",o,null,null,null):new ma(_a(o),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const o={};t.scale&&(o["font-scale"]=t.scale.serialize()),t.font&&(o["text-font"]=t.font.serialize()),t.textColor&&(o["text-color"]=t.textColor.serialize()),e.push(o)}return e}}class yl{constructor(e){this.type=pa,this.input=e}static parse(e,t){if(e.length!==2)return t.error("Expected two arguments.");const o=t.parse(e[1],1,gi);return o?new yl(o):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),o=ar.fromString(t);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(t)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const wp={"to-boolean":yi,"to-color":Br,"to-number":zt,"to-string":gi};class Nc{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const o=e[0];if((o==="to-boolean"||o==="to-string")&&e.length!==2)return t.error("Expected one argument.");const l=wp[o],u=[];for(let f=1;f<e.length;f++){const m=t.parse(e[f],f,ui);if(!m)return null;u.push(m)}return new Nc(l,u)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let t,o;for(const l of this.args){if(t=l.evaluate(e),o=null,t instanceof Ni)return t;if(typeof t=="string"){const u=e.parseColor(t);if(u)return u}else if(Array.isArray(t)&&(o=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:Oc(t[0],t[1],t[2],t[3]),!o))return new Ni(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Pn(o||`Could not parse color from value '${typeof t=="string"?t:String(JSON.stringify(t))}'`)}if(this.type.kind==="number"){let t=null;for(const o of this.args){if(t=o.evaluate(e),t===null)return 0;const l=Number(t);if(!isNaN(l))return l}throw new Pn(`Could not convert ${JSON.stringify(t)} to number.`)}return this.type.kind==="formatted"?sr.fromString(_a(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?ar.fromString(_a(this.args[0].evaluate(e))):_a(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new va([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new yl(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(t=>{e.push(t.serialize())}),e}}var Es=Nc;const Tp=["Unknown","Point","LineString","Polygon"];var jh=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Tp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const i=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:t,y:o}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(t*e-i[0])+this.featureDistanceData.bearing[1]*(o*e-i[1])}return 0}parseColor(i){let e=this._parseColorCache[i];return e||(e=this._parseColorCache[i]=Ni.parse(i)),e}};class Xo{constructor(e,t,o,l){this.name=e,this.type=t,this._evaluate=o,this.args=l}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,t){const o=e[0],l=Xo.definitions[o];if(!l)return t.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const u=Array.isArray(l)?l[0]:l.type,f=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,m=f.filter(([x])=>!Array.isArray(x)||x.length===e.length-1);let v=null;for(const[x,S]of m){v=new Yo(t.registry,t.path,null,t.scope);const A=[];let I=!1;for(let P=1;P<e.length;P++){const L=e[P],O=Array.isArray(x)?x[P-1]:x.type,$=v.parse(L,1+A.length,O);if(!$){I=!0;break}A.push($)}if(!I)if(Array.isArray(x)&&x.length!==A.length)v.error(`Expected ${x.length} arguments, but found ${A.length} instead.`);else{for(let P=0;P<A.length;P++){const L=Array.isArray(x)?x[P]:x.type,O=A[P];v.concat(P+1).checkSubtype(L,O.type)}if(v.errors.length===0)return new Xo(o,u,S,A)}}if(m.length===1)t.errors.push(...v.errors);else{const x=(m.length?m:f).map(([A])=>{return I=A,Array.isArray(I)?`(${I.map(sn).join(", ")})`:`(${sn(I.type)}...)`;var I}).join(" | "),S=[];for(let A=1;A<e.length;A++){const I=t.parse(e[A],1+S.length);if(!I)return null;S.push(sn(I.type))}t.error(`Expected arguments of type ${x}, but found (${S.join(", ")}) instead.`)}return null}static register(e,t){Xo.definitions=t;for(const o in t)e[o]=Xo}}var Fr=Xo;class vl{constructor(e,t,o){this.type=da,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(e.length!==2)return t.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return t.error("Collator options argument must be an object.");const l=t.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,yi);if(!l)return null;const u=t.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,yi);if(!u)return null;let f=null;return o.locale&&(f=t.parse(o.locale,1,gi),!f)?null:new vl(l,u,f)}evaluate(e){return new Fc(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Co=8192;function jc(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function xl(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function Ep(i,e){const t=(180+i[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(t*l*Co),Math.round(o*l*Co)]}function Sp(i,e,t){const o=i[0]-e[0],l=i[1]-e[1],u=i[0]-t[0],f=i[1]-t[1];return o*f-u*l==0&&o*u<=0&&l*f<=0}function bl(i,e){let t=!1;for(let f=0,m=e.length;f<m;f++){const v=e[f];for(let x=0,S=v.length;x<S-1;x++){if(Sp(i,v[x],v[x+1]))return!1;(l=v[x])[1]>(o=i)[1]!=(u=v[x+1])[1]>o[1]&&o[0]<(u[0]-l[0])*(o[1]-l[1])/(u[1]-l[1])+l[0]&&(t=!t)}}var o,l,u;return t}function wl(i,e){for(let t=0;t<e.length;t++)if(bl(i,e[t]))return!0;return!1}function qh(i,e,t,o){const l=o[0]-t[0],u=o[1]-t[1],f=(i[0]-t[0])*u-l*(i[1]-t[1]),m=(e[0]-t[0])*u-l*(e[1]-t[1]);return f>0&&m<0||f<0&&m>0}function Cp(i,e,t){for(const x of t)for(let S=0;S<x.length-1;++S)if((m=[(f=x[S+1])[0]-(u=x[S])[0],f[1]-u[1]])[0]*(v=[(l=e)[0]-(o=i)[0],l[1]-o[1]])[1]-m[1]*v[0]!=0&&qh(o,l,u,f)&&qh(u,f,o,l))return!0;var o,l,u,f,m,v;return!1}function $h(i,e){for(let t=0;t<i.length;++t)if(!bl(i[t],e))return!1;for(let t=0;t<i.length-1;++t)if(Cp(i[t],i[t+1],e))return!1;return!0}function Ap(i,e){for(let t=0;t<e.length;t++)if($h(i,e[t]))return!0;return!1}function Sr(i,e,t){const o=[];for(let l=0;l<i.length;l++){const u=[];for(let f=0;f<i[l].length;f++){const m=Ep(i[l][f],t);jc(e,m),u.push(m)}o.push(u)}return o}function qc(i,e,t){const o=[];for(let l=0;l<i.length;l++){const u=Sr(i[l],e,t);o.push(u)}return o}function $c(i,e,t,o){if(i[0]<t[0]||i[0]>t[2]){const l=.5*o;let u=i[0]-t[0]>l?-o:t[0]-i[0]>l?o:0;u===0&&(u=i[0]-t[2]>l?-o:t[2]-i[0]>l?o:0),i[0]+=u}jc(e,i)}function Gc(i,e,t,o){const l=Math.pow(2,o.z)*Co,u=[o.x*Co,o.y*Co],f=[];if(!i)return f;for(const m of i)for(const v of m){const x=[v.x+u[0],v.y+u[1]];$c(x,e,t,l),f.push(x)}return f}function Zc(i,e,t,o){const l=Math.pow(2,o.z)*Co,u=[o.x*Co,o.y*Co],f=[];if(!i)return f;for(const v of i){const x=[];for(const S of v){const A=[S.x+u[0],S.y+u[1]];jc(e,A),x.push(A)}f.push(x)}if(e[2]-e[0]<=l/2){(m=e)[0]=m[1]=1/0,m[2]=m[3]=-1/0;for(const v of f)for(const x of v)$c(x,e,t,l)}var m;return f}class Ss{constructor(e,t){this.type=yi,this.geojson=e,this.geometries=t}static parse(e,t){if(e.length!==2)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(So(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let l=0;l<o.features.length;++l){const u=o.features[l].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Ss(o,o.features[l].geometry)}else if(o.type==="Feature"){const l=o.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new Ss(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Ss(o,o)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(t,o){const l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],f=t.canonicalID();if(!f)return!1;if(o.type==="Polygon"){const m=Sr(o.coordinates,u,f),v=Gc(t.geometry(),l,u,f);if(!xl(l,u))return!1;for(const x of v)if(!bl(x,m))return!1}if(o.type==="MultiPolygon"){const m=qc(o.coordinates,u,f),v=Gc(t.geometry(),l,u,f);if(!xl(l,u))return!1;for(const x of v)if(!wl(x,m))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(t,o){const l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],f=t.canonicalID();if(!f)return!1;if(o.type==="Polygon"){const m=Sr(o.coordinates,u,f),v=Zc(t.geometry(),l,u,f);if(!xl(l,u))return!1;for(const x of v)if(!$h(x,m))return!1}if(o.type==="MultiPolygon"){const m=qc(o.coordinates,u,f),v=Zc(t.geometry(),l,u,f);if(!xl(l,u))return!1;for(const x of v)if(!Ap(x,m))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Tl=Ss;function Ko(i){if(i instanceof Fr&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Tl)return!1;let e=!0;return i.eachChild(t=>{e&&!Ko(t)&&(e=!1)}),e}function Ao(i){if(i instanceof Fr&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(t=>{e&&!Ao(t)&&(e=!1)}),e}function xa(i,e){if(i instanceof Fr&&e.indexOf(i.name)>=0)return!1;let t=!0;return i.eachChild(o=>{t&&!xa(o,e)&&(t=!1)}),t}class El{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");const o=e[1];return t.scope.has(o)?new El(o,t.scope.get(o)):t.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Sl=El;class Cl{constructor(e,t=[],o,l=new bp,u=[]){this.registry=e,this.path=t,this.key=t.map(f=>`[${f}]`).join(""),this.scope=l,this.errors=u,this.expectedType=o}parse(e,t,o,l,u={}){return t?this.concat(t,o,l)._parse(e,u):this._parse(e,u)}_parse(e,t){function o(l,u,f){return f==="assert"?new Er(u,[l]):f==="coerce"?new Es(u,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=e[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const u=this.registry[l];if(u){let f=u.parse(e,this);if(!f)return null;if(this.expectedType){const m=this.expectedType,v=f.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||v.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(m,v))return null}else f=o(f,m,t.typeAnnotation||"coerce");else f=o(f,m,t.typeAnnotation||"assert")}if(!(f instanceof ga)&&f.type.kind!=="resolvedImage"&&Di(f)){const m=new jh;try{f=new ga(f.type,f.evaluate(m))}catch(v){return this.error(v.message),null}}return f}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,o){const l=typeof e=="number"?this.path.concat(e):this.path,u=o?this.scope.concat(o):this.scope;return new Cl(this.registry,l,t||null,u,this.errors)}error(e,...t){const o=`${this.key}${t.map(l=>`[${l}]`).join("")}`;this.errors.push(new Kn(o,e))}checkSubtype(e,t){const o=Ts(e,t);return o&&this.error(o),o}}var Yo=Cl;function Di(i){if(i instanceof Sl)return Di(i.boundExpression);if(i instanceof Fr&&i.name==="error"||i instanceof vl||i instanceof Tl)return!1;const e=i instanceof Es||i instanceof Er;let t=!0;return i.eachChild(o=>{t=e?t&&Di(o):t&&o instanceof ga}),!!t&&Ko(i)&&xa(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Al(i,e){const t=i.length-1;let o,l,u=0,f=t,m=0;for(;u<=f;)if(m=Math.floor((u+f)/2),o=i[m],l=i[m+1],o<=e){if(m===t||e<l)return m;u=m+1}else{if(!(o>e))throw new Pn("Input is not a number.");f=m-1}return 0}class Wc{constructor(e,t,o){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[l,u]of o)this.labels.push(l),this.outputs.push(u)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const o=t.parse(e[1],1,zt);if(!o)return null;const l=[];let u=null;t.expectedType&&t.expectedType.kind!=="value"&&(u=t.expectedType);for(let f=1;f<e.length;f+=2){const m=f===1?-1/0:e[f],v=e[f+1],x=f,S=f+1;if(typeof m!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',x);if(l.length&&l[l.length-1][0]>=m)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',x);const A=t.parse(v,S,u);if(!A)return null;u=u||A.type,l.push([m,A])}return new Wc(u,o,l)}evaluate(e){const t=this.labels,o=this.outputs;if(t.length===1)return o[0].evaluate(e);const l=this.input.evaluate(e);if(l<=t[0])return o[0].evaluate(e);const u=t.length;return l>=t[u-1]?o[u-1].evaluate(e):o[Al(t,l)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var Hc=Wc;function Ai(i,e,t){return i*(1-t)+e*t}function Cs(i,e,t){return i.map((o,l)=>Ai(o,e[l],t))}var ba=Object.freeze({__proto__:null,number:Ai,color:function(i,e,t){return new Ni(Ai(i.r,e.r,t),Ai(i.g,e.g,t),Ai(i.b,e.b,t),Ai(i.a,e.a,t))},array:Cs});const Xc=.95047,Kc=1.08883,Yc=4/29,Mo=6/29,wa=3*Mo*Mo,Mp=Math.PI/180,Jc=180/Math.PI;function Ml(i){return i>.008856451679035631?Math.pow(i,1/3):i/wa+Yc}function Qc(i){return i>Mo?i*i*i:wa*(i-Yc)}function eu(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function Il(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Gh(i){const e=Il(i.r),t=Il(i.g),o=Il(i.b),l=Ml((.4124564*e+.3575761*t+.1804375*o)/Xc),u=Ml((.2126729*e+.7151522*t+.072175*o)/1);return{l:116*u-16,a:500*(l-u),b:200*(u-Ml((.0193339*e+.119192*t+.9503041*o)/Kc)),alpha:i.a}}function tu(i){let e=(i.l+16)/116,t=isNaN(i.a)?e:e+i.a/500,o=isNaN(i.b)?e:e-i.b/200;return e=1*Qc(e),t=Xc*Qc(t),o=Kc*Qc(o),new Ni(eu(3.2404542*t-1.5371385*e-.4985314*o),eu(-.969266*t+1.8760108*e+.041556*o),eu(.0556434*t-.2040259*e+1.0572252*o),i.alpha)}function Zh(i,e,t){const o=e-i;return i+t*(o>180||o<-180?o-360*Math.round(o/360):o)}const Ta={forward:Gh,reverse:tu,interpolate:function(i,e,t){return{l:Ai(i.l,e.l,t),a:Ai(i.a,e.a,t),b:Ai(i.b,e.b,t),alpha:Ai(i.alpha,e.alpha,t)}}},As={forward:function(i){const{l:e,a:t,b:o}=Gh(i),l=Math.atan2(o,t)*Jc;return{h:l<0?l+360:l,c:Math.sqrt(t*t+o*o),l:e,alpha:i.a}},reverse:function(i){const e=i.h*Mp,t=i.c;return tu({l:i.l,a:Math.cos(e)*t,b:Math.sin(e)*t,alpha:i.alpha})},interpolate:function(i,e,t){return{h:Zh(i.h,e.h,t),c:Ai(i.c,e.c,t),l:Ai(i.l,e.l,t),alpha:Ai(i.alpha,e.alpha,t)}}};var Wh=Object.freeze({__proto__:null,lab:Ta,hcl:As});class Ea{constructor(e,t,o,l,u){this.type=e,this.operator=t,this.interpolation=o,this.input=l,this.labels=[],this.outputs=[];for(const[f,m]of u)this.labels.push(f),this.outputs.push(m)}static interpolationFactor(e,t,o,l){let u=0;if(e.name==="exponential")u=kl(t,e.base,o,l);else if(e.name==="linear")u=kl(t,1,o,l);else if(e.name==="cubic-bezier"){const f=e.controlPoints;u=new V(f[0],f[1],f[2],f[3]).solve(kl(t,1,o,l))}return u}static parse(e,t){let[o,l,u,...f]=e;if(!Array.isArray(l)||l.length===0)return t.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const x=l[1];if(typeof x!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:x}}else{if(l[0]!=="cubic-bezier")return t.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const x=l.slice(1);if(x.length!==4||x.some(S=>typeof S!="number"||S<0||S>1))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:x}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(u=t.parse(u,2,zt),!u)return null;const m=[];let v=null;o==="interpolate-hcl"||o==="interpolate-lab"?v=Br:t.expectedType&&t.expectedType.kind!=="value"&&(v=t.expectedType);for(let x=0;x<f.length;x+=2){const S=f[x],A=f[x+1],I=x+3,P=x+4;if(typeof S!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(m.length&&m[m.length-1][0]>=S)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',I);const L=t.parse(A,P,v);if(!L)return null;v=v||L.type,m.push([S,L])}return v.kind==="number"||v.kind==="color"||v.kind==="array"&&v.itemType.kind==="number"&&typeof v.N=="number"?new Ea(v,o,l,u,m):t.error(`Type ${sn(v)} is not interpolatable.`)}evaluate(e){const t=this.labels,o=this.outputs;if(t.length===1)return o[0].evaluate(e);const l=this.input.evaluate(e);if(l<=t[0])return o[0].evaluate(e);const u=t.length;if(l>=t[u-1])return o[u-1].evaluate(e);const f=Al(t,l),m=Ea.interpolationFactor(this.interpolation,l,t[f],t[f+1]),v=o[f].evaluate(e),x=o[f+1].evaluate(e);return this.operator==="interpolate"?ba[this.type.kind.toLowerCase()](v,x,m):this.operator==="interpolate-hcl"?As.reverse(As.interpolate(As.forward(v),As.forward(x),m)):Ta.reverse(Ta.interpolate(Ta.forward(v),Ta.forward(x),m))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let o=0;o<this.labels.length;o++)t.push(this.labels[o],this.outputs[o].serialize());return t}}function kl(i,e,t,o){const l=o-t,u=i-t;return l===0?0:e===1?u/l:(Math.pow(e,u)-1)/(Math.pow(e,l)-1)}var $r=Ea;class iu{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let o=null;const l=t.expectedType;l&&l.kind!=="value"&&(o=l);const u=[];for(const m of e.slice(1)){const v=t.parse(m,1+u.length,o,void 0,{typeAnnotation:"omit"});if(!v)return null;o=o||v.type,u.push(v)}const f=l&&u.some(m=>Ts(l,m.type));return new iu(f?ui:o,u)}evaluate(e){let t,o=null,l=0;for(const u of this.args){if(l++,o=u.evaluate(e),o&&o instanceof ar&&!o.available&&(t||(t=o),o=null,l===this.args.length))return t;if(o!==null)break}return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var Hh=iu;class nu{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let u=1;u<e.length-1;u+=2){const f=e[u];if(typeof f!="string")return t.error(`Expected string, but found ${typeof f} instead.`,u);if(/[^a-zA-Z0-9_]/.test(f))return t.error("Variable names must contain only alphanumeric characters or '_'.",u);const m=t.parse(e[u+1],u+1);if(!m)return null;o.push([f,m])}const l=t.parse(e[e.length-1],e.length-1,t.expectedType,o);return l?new nu(o,l):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,o]of this.bindings)e.push(t,o.serialize());return e.push(this.result.serialize()),e}}var Xh=nu;class ru{constructor(e,t,o){this.type=e,this.index=t,this.input=o}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=t.parse(e[1],1,zt),l=t.parse(e[2],2,gr(t.expectedType||ui));return o&&l?new ru(l.type.itemType,o,l):null}evaluate(e){const t=this.index.evaluate(e),o=this.input.evaluate(e);if(t<0)throw new Pn(`Array index out of bounds: ${t} < 0.`);if(t>=o.length)throw new Pn(`Array index out of bounds: ${t} > ${o.length-1}.`);if(t!==Math.floor(t))throw new Pn(`Array index must be an integer, but found ${t} instead.`);return o[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Kh=ru;class ou{constructor(e,t){this.type=yi,this.needle=e,this.haystack=t}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=t.parse(e[1],1,ui),l=t.parse(e[2],2,ui);return o&&l?gl(o.type,[yi,gi,zt,ws,ui])?new ou(o,l):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${sn(o.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(o==null)return!1;if(!To(t,["boolean","string","number","null"]))throw new Pn(`Expected first argument to be of type boolean, string, number or null, but found ${sn(gn(t))} instead.`);if(!To(o,["string","array"]))throw new Pn(`Expected second argument to be of type array or string, but found ${sn(gn(o))} instead.`);return o.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Ip=ou;class zl{constructor(e,t,o){this.type=zt,this.needle=e,this.haystack=t,this.fromIndex=o}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=t.parse(e[1],1,ui),l=t.parse(e[2],2,ui);if(!o||!l)return null;if(!gl(o.type,[yi,gi,zt,ws,ui]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${sn(o.type)} instead`);if(e.length===4){const u=t.parse(e[3],3,zt);return u?new zl(o,l,u):null}return new zl(o,l)}evaluate(e){const t=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!To(t,["boolean","string","number","null"]))throw new Pn(`Expected first argument to be of type boolean, string, number or null, but found ${sn(gn(t))} instead.`);if(!To(o,["string","array"]))throw new Pn(`Expected second argument to be of type array or string, but found ${sn(gn(o))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(e);return o.indexOf(t,l)}return o.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var kp=zl;class Pl{constructor(e,t,o,l,u,f){this.inputType=e,this.type=t,this.input=o,this.cases=l,this.outputs=u,this.otherwise=f}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let o,l;t.expectedType&&t.expectedType.kind!=="value"&&(l=t.expectedType);const u={},f=[];for(let x=2;x<e.length-1;x+=2){let S=e[x];const A=e[x+1];Array.isArray(S)||(S=[S]);const I=t.concat(x);if(S.length===0)return I.error("Expected at least one branch label.");for(const L of S){if(typeof L!="number"&&typeof L!="string")return I.error("Branch labels must be numbers or strings.");if(typeof L=="number"&&Math.abs(L)>Number.MAX_SAFE_INTEGER)return I.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof L=="number"&&Math.floor(L)!==L)return I.error("Numeric branch labels must be integer values.");if(o){if(I.checkSubtype(o,gn(L)))return null}else o=gn(L);if(u[String(L)]!==void 0)return I.error("Branch labels must be unique.");u[String(L)]=f.length}const P=t.parse(A,x,l);if(!P)return null;l=l||P.type,f.push(P)}const m=t.parse(e[1],1,ui);if(!m)return null;const v=t.parse(e[e.length-1],e.length-1,l);return v?m.type.kind!=="value"&&t.concat(1).checkSubtype(o,m.type)?null:new Pl(o,l,m,u,f,v):null}evaluate(e){const t=this.input.evaluate(e);return(gn(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),o=[],l={};for(const f of t){const m=l[this.cases[f]];m===void 0?(l[this.cases[f]]=o.length,o.push([this.cases[f],[f]])):o[m][1].push(f)}const u=f=>this.inputType.kind==="number"?Number(f):f;for(const[f,m]of o)e.push(m.length===1?u(m[0]):m.map(u)),e.push(this.outputs[f].serialize());return e.push(this.otherwise.serialize()),e}}var Yh=Pl;class Dl{constructor(e,t,o){this.type=e,this.branches=t,this.otherwise=o}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let o;t.expectedType&&t.expectedType.kind!=="value"&&(o=t.expectedType);const l=[];for(let f=1;f<e.length-1;f+=2){const m=t.parse(e[f],f,yi);if(!m)return null;const v=t.parse(e[f+1],f+1,o);if(!v)return null;l.push([m,v]),o=o||v.type}const u=t.parse(e[e.length-1],e.length-1,o);return u?new Dl(o,l,u):null}evaluate(e){for(const[t,o]of this.branches)if(t.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,o]of this.branches)e(t),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,t])=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var zp=Dl;class Ll{constructor(e,t,o,l){this.type=e,this.input=t,this.beginIndex=o,this.endIndex=l}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=t.parse(e[1],1,ui),l=t.parse(e[2],2,zt);if(!o||!l)return null;if(!gl(o.type,[gr(ui),gi,ui]))return t.error(`Expected first argument to be of type array or string, but found ${sn(o.type)} instead`);if(e.length===4){const u=t.parse(e[3],3,zt);return u?new Ll(o.type,o,l,u):null}return new Ll(o.type,o,l)}evaluate(e){const t=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!To(t,["string","array"]))throw new Pn(`Expected first argument to be of type array or string, but found ${sn(gn(t))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(e);return t.slice(o,l)}return t.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Jh=Ll;function su(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function au(i,e,t,o){return o.compare(e,t)===0}function Ms(i,e,t){const o=i!=="=="&&i!=="!=";return class Cb{constructor(u,f,m){this.type=yi,this.lhs=u,this.rhs=f,this.collator=m,this.hasUntypedArgument=u.type.kind==="value"||f.type.kind==="value"}static parse(u,f){if(u.length!==3&&u.length!==4)return f.error("Expected two or three arguments.");const m=u[0];let v=f.parse(u[1],1,ui);if(!v)return null;if(!su(m,v.type))return f.concat(1).error(`"${m}" comparisons are not supported for type '${sn(v.type)}'.`);let x=f.parse(u[2],2,ui);if(!x)return null;if(!su(m,x.type))return f.concat(2).error(`"${m}" comparisons are not supported for type '${sn(x.type)}'.`);if(v.type.kind!==x.type.kind&&v.type.kind!=="value"&&x.type.kind!=="value")return f.error(`Cannot compare types '${sn(v.type)}' and '${sn(x.type)}'.`);o&&(v.type.kind==="value"&&x.type.kind!=="value"?v=new Er(x.type,[v]):v.type.kind!=="value"&&x.type.kind==="value"&&(x=new Er(v.type,[x])));let S=null;if(u.length===4){if(v.type.kind!=="string"&&x.type.kind!=="string"&&v.type.kind!=="value"&&x.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(S=f.parse(u[3],3,da),!S)return null}return new Cb(v,x,S)}evaluate(u){const f=this.lhs.evaluate(u),m=this.rhs.evaluate(u);if(o&&this.hasUntypedArgument){const v=gn(f),x=gn(m);if(v.kind!==x.kind||v.kind!=="string"&&v.kind!=="number")throw new Pn(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${v.kind}, ${x.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const v=gn(f),x=gn(m);if(v.kind!=="string"||x.kind!=="string")return e(u,f,m)}return this.collator?t(u,f,m,this.collator.evaluate(u)):e(u,f,m)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){const u=[i];return this.eachChild(f=>{u.push(f.serialize())}),u}}}const Pp=Ms("==",function(i,e,t){return e===t},au),Dp=Ms("!=",function(i,e,t){return e!==t},function(i,e,t,o){return!au(0,e,t,o)}),Lp=Ms("<",function(i,e,t){return e<t},function(i,e,t,o){return o.compare(e,t)<0}),Bl=Ms(">",function(i,e,t){return e>t},function(i,e,t,o){return o.compare(e,t)>0}),Qh=Ms("<=",function(i,e,t){return e<=t},function(i,e,t,o){return o.compare(e,t)<=0}),ed=Ms(">=",function(i,e,t){return e>=t},function(i,e,t,o){return o.compare(e,t)>=0});class lu{constructor(e,t,o,l,u,f){this.type=gi,this.number=e,this.locale=t,this.currency=o,this.unit=l,this.minFractionDigits=u,this.maxFractionDigits=f}static parse(e,t){if(e.length!==3)return t.error("Expected two arguments.");const o=t.parse(e[1],1,zt);if(!o)return null;const l=e[2];if(typeof l!="object"||Array.isArray(l))return t.error("NumberFormat options argument must be an object.");let u=null;if(l.locale&&(u=t.parse(l.locale,1,gi),!u))return null;let f=null;if(l.currency&&(f=t.parse(l.currency,1,gi),!f))return null;let m=null;if(l.unit&&(m=t.parse(l.unit,1,gi),!m))return null;let v=null;if(l["min-fraction-digits"]&&(v=t.parse(l["min-fraction-digits"],1,zt),!v))return null;let x=null;return l["max-fraction-digits"]&&(x=t.parse(l["max-fraction-digits"],1,zt),!x)?null:new lu(o,u,f,m,v,x)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class cu{constructor(e){this.type=zt,this.input=e}static parse(e,t){if(e.length!==2)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=t.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?t.error(`Expected argument of type string or array, but found ${sn(o.type)} instead.`):new cu(o):null}evaluate(e){const t=this.input.evaluate(e);if(typeof t=="string"||Array.isArray(t))return t.length;throw new Pn(`Expected value to be of type string or array, but found ${sn(gn(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(t=>{e.push(t.serialize())}),e}}const td={"==":Pp,"!=":Dp,">":Bl,"<":Lp,">=":ed,"<=":Qh,array:Er,at:Kh,boolean:Er,case:zp,coalesce:Hh,collator:vl,format:va,image:yl,in:Ip,"index-of":kp,interpolate:$r,"interpolate-hcl":$r,"interpolate-lab":$r,length:cu,let:Xh,literal:ga,match:Yh,number:Er,"number-format":lu,object:Er,slice:Jh,step:Hc,string:Er,"to-boolean":Es,"to-color":Es,"to-number":Es,"to-string":Es,var:Sl,within:Tl};function uu(i,[e,t,o,l]){e=e.evaluate(i),t=t.evaluate(i),o=o.evaluate(i);const u=l?l.evaluate(i):1,f=Oc(e,t,o,u);if(f)throw new Pn(f);return new Ni(e/255*u,t/255*u,o/255*u,u)}function hu(i,e){return i in e}function Rl(i,e){const t=e[i];return t===void 0?null:t}function no(i){return{type:i}}Fr.register(td,{error:[{kind:"error"},[gi],(i,[e])=>{throw new Pn(e.evaluate(i))}],typeof:[gi,[ui],(i,[e])=>sn(gn(e.evaluate(i)))],"to-rgba":[gr(zt,4),[Br],(i,[e])=>e.evaluate(i).toArray()],rgb:[Br,[zt,zt,zt],uu],rgba:[Br,[zt,zt,zt,zt],uu],has:{type:yi,overloads:[[[gi],(i,[e])=>hu(e.evaluate(i),i.properties())],[[gi,Rr],(i,[e,t])=>hu(e.evaluate(i),t.evaluate(i))]]},get:{type:ui,overloads:[[[gi],(i,[e])=>Rl(e.evaluate(i),i.properties())],[[gi,Rr],(i,[e,t])=>Rl(e.evaluate(i),t.evaluate(i))]]},"feature-state":[ui,[gi],(i,[e])=>Rl(e.evaluate(i),i.featureState||{})],properties:[Rr,[],i=>i.properties()],"geometry-type":[gi,[],i=>i.geometryType()],id:[ui,[],i=>i.id()],zoom:[zt,[],i=>i.globals.zoom],pitch:[zt,[],i=>i.globals.pitch||0],"distance-from-center":[zt,[],i=>i.distanceFromCenter()],"heatmap-density":[zt,[],i=>i.globals.heatmapDensity||0],"line-progress":[zt,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[zt,[],i=>i.globals.skyRadialProgress||0],accumulated:[ui,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[zt,no(zt),(i,e)=>{let t=0;for(const o of e)t+=o.evaluate(i);return t}],"*":[zt,no(zt),(i,e)=>{let t=1;for(const o of e)t*=o.evaluate(i);return t}],"-":{type:zt,overloads:[[[zt,zt],(i,[e,t])=>e.evaluate(i)-t.evaluate(i)],[[zt],(i,[e])=>-e.evaluate(i)]]},"/":[zt,[zt,zt],(i,[e,t])=>e.evaluate(i)/t.evaluate(i)],"%":[zt,[zt,zt],(i,[e,t])=>e.evaluate(i)%t.evaluate(i)],ln2:[zt,[],()=>Math.LN2],pi:[zt,[],()=>Math.PI],e:[zt,[],()=>Math.E],"^":[zt,[zt,zt],(i,[e,t])=>Math.pow(e.evaluate(i),t.evaluate(i))],sqrt:[zt,[zt],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[zt,[zt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[zt,[zt],(i,[e])=>Math.log(e.evaluate(i))],log2:[zt,[zt],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[zt,[zt],(i,[e])=>Math.sin(e.evaluate(i))],cos:[zt,[zt],(i,[e])=>Math.cos(e.evaluate(i))],tan:[zt,[zt],(i,[e])=>Math.tan(e.evaluate(i))],asin:[zt,[zt],(i,[e])=>Math.asin(e.evaluate(i))],acos:[zt,[zt],(i,[e])=>Math.acos(e.evaluate(i))],atan:[zt,[zt],(i,[e])=>Math.atan(e.evaluate(i))],min:[zt,no(zt),(i,e)=>Math.min(...e.map(t=>t.evaluate(i)))],max:[zt,no(zt),(i,e)=>Math.max(...e.map(t=>t.evaluate(i)))],abs:[zt,[zt],(i,[e])=>Math.abs(e.evaluate(i))],round:[zt,[zt],(i,[e])=>{const t=e.evaluate(i);return t<0?-Math.round(-t):Math.round(t)}],floor:[zt,[zt],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[zt,[zt],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[yi,[gi,ui],(i,[e,t])=>i.properties()[e.value]===t.value],"filter-id-==":[yi,[ui],(i,[e])=>i.id()===e.value],"filter-type-==":[yi,[gi],(i,[e])=>i.geometryType()===e.value],"filter-<":[yi,[gi,ui],(i,[e,t])=>{const o=i.properties()[e.value],l=t.value;return typeof o==typeof l&&o<l}],"filter-id-<":[yi,[ui],(i,[e])=>{const t=i.id(),o=e.value;return typeof t==typeof o&&t<o}],"filter->":[yi,[gi,ui],(i,[e,t])=>{const o=i.properties()[e.value],l=t.value;return typeof o==typeof l&&o>l}],"filter-id->":[yi,[ui],(i,[e])=>{const t=i.id(),o=e.value;return typeof t==typeof o&&t>o}],"filter-<=":[yi,[gi,ui],(i,[e,t])=>{const o=i.properties()[e.value],l=t.value;return typeof o==typeof l&&o<=l}],"filter-id-<=":[yi,[ui],(i,[e])=>{const t=i.id(),o=e.value;return typeof t==typeof o&&t<=o}],"filter->=":[yi,[gi,ui],(i,[e,t])=>{const o=i.properties()[e.value],l=t.value;return typeof o==typeof l&&o>=l}],"filter-id->=":[yi,[ui],(i,[e])=>{const t=i.id(),o=e.value;return typeof t==typeof o&&t>=o}],"filter-has":[yi,[ui],(i,[e])=>e.value in i.properties()],"filter-has-id":[yi,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[yi,[gr(gi)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[yi,[gr(ui)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[yi,[gi,gr(ui)],(i,[e,t])=>t.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[yi,[gi,gr(ui)],(i,[e,t])=>function(o,l,u,f){for(;u<=f;){const m=u+f>>1;if(l[m]===o)return!0;l[m]>o?f=m-1:u=m+1}return!1}(i.properties()[e.value],t.value,0,t.value.length-1)],all:{type:yi,overloads:[[[yi,yi],(i,[e,t])=>e.evaluate(i)&&t.evaluate(i)],[no(yi),(i,e)=>{for(const t of e)if(!t.evaluate(i))return!1;return!0}]]},any:{type:yi,overloads:[[[yi,yi],(i,[e,t])=>e.evaluate(i)||t.evaluate(i)],[no(yi),(i,e)=>{for(const t of e)if(t.evaluate(i))return!0;return!1}]]},"!":[yi,[yi],(i,[e])=>!e.evaluate(i)],"is-supported-script":[yi,[gi],(i,[e])=>{const t=i.globals&&i.globals.isSupportedScript;return!t||t(e.evaluate(i))}],upcase:[gi,[gi],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[gi,[gi],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[gi,no(ui),(i,e)=>e.map(t=>_a(t.evaluate(i))).join("")],"resolved-locale":[gi,[da],(i,[e])=>e.evaluate(i).resolvedLocale()]});var Sa=td;function id(i){return{result:"success",value:i}}function Is(i){return{result:"error",value:i}}function ks(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function nd(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function du(i){return!!i.expression&&i.expression.interpolated}function Ri(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Ca(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function rd(i){return i}function Aa(i,e){const t=e.type==="color",o=i.stops&&typeof i.stops[0][0]=="object",l=o||!(o||i.property!==void 0),u=i.type||(du(e)?"exponential":"interval");if(t&&((i=wi({},i)).stops&&(i.stops=i.stops.map(x=>[x[0],Ni.parse(x[1])])),i.default=Ni.parse(i.default?i.default:e.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!Wh[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let f,m,v;if(u==="exponential")f=fu;else if(u==="interval")f=Io;else if(u==="categorical"){f=Bp,m=Object.create(null);for(const x of i.stops)m[x[0]]=x[1];v=typeof i.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);f=zs}if(o){const x={},S=[];for(let P=0;P<i.stops.length;P++){const L=i.stops[P],O=L[0].zoom;x[O]===void 0&&(x[O]={zoom:O,type:i.type,property:i.property,default:i.default,stops:[]},S.push(O)),x[O].stops.push([L[0].value,L[1]])}const A=[];for(const P of S)A.push([x[P].zoom,Aa(x[P],e)]);const I={name:"linear"};return{kind:"composite",interpolationType:I,interpolationFactor:$r.interpolationFactor.bind(void 0,I),zoomStops:A.map(P=>P[0]),evaluate:({zoom:P},L)=>fu({stops:A,base:i.base},e,P).evaluate(P,L)}}if(l){const x=u==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:x,interpolationFactor:$r.interpolationFactor.bind(void 0,x),zoomStops:i.stops.map(S=>S[0]),evaluate:({zoom:S})=>f(i,e,S,m,v)}}return{kind:"source",evaluate(x,S){const A=S&&S.properties?S.properties[i.property]:void 0;return A===void 0?Ma(i.default,e.default):f(i,e,A,m,v)}}}function Ma(i,e,t){return i!==void 0?i:e!==void 0?e:t!==void 0?t:void 0}function Bp(i,e,t,o,l){return Ma(typeof t===l?o[t]:void 0,i.default,e.default)}function Io(i,e,t){if(Ri(t)!=="number")return Ma(i.default,e.default);const o=i.stops.length;if(o===1||t<=i.stops[0][0])return i.stops[0][1];if(t>=i.stops[o-1][0])return i.stops[o-1][1];const l=Al(i.stops.map(u=>u[0]),t);return i.stops[l][1]}function fu(i,e,t){const o=i.base!==void 0?i.base:1;if(Ri(t)!=="number")return Ma(i.default,e.default);const l=i.stops.length;if(l===1||t<=i.stops[0][0])return i.stops[0][1];if(t>=i.stops[l-1][0])return i.stops[l-1][1];const u=Al(i.stops.map(S=>S[0]),t),f=function(S,A,I,P){const L=P-I,O=S-I;return L===0?0:A===1?O/L:(Math.pow(A,O)-1)/(Math.pow(A,L)-1)}(t,o,i.stops[u][0],i.stops[u+1][0]),m=i.stops[u][1],v=i.stops[u+1][1];let x=ba[e.type]||rd;if(i.colorSpace&&i.colorSpace!=="rgb"){const S=Wh[i.colorSpace];x=(A,I)=>S.reverse(S.interpolate(S.forward(A),S.forward(I),f))}return typeof m.evaluate=="function"?{evaluate(...S){const A=m.evaluate.apply(void 0,S),I=v.evaluate.apply(void 0,S);if(A!==void 0&&I!==void 0)return x(A,I,f)}}:x(m,v,f)}function zs(i,e,t){return e.type==="color"?t=Ni.parse(t):e.type==="formatted"?t=sr.fromString(t.toString()):e.type==="resolvedImage"?t=ar.fromString(t.toString()):Ri(t)===e.type||e.type==="enum"&&e.values[t]||(t=void 0),Ma(t,i.default,e.default)}class pu{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new jh,this._defaultValue=t?function(o){return o.type==="color"&&(Ca(o.default)||Array.isArray(o.default))?new Ni(0,0,0,0):o.type==="color"?Ni.parse(o.default)||null:o.default===void 0?null:o.default}(t):null,this._enumValues=t&&t.type==="enum"?t.values:null}evaluateWithoutErrorHandling(e,t,o,l,u,f,m,v){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=o,this._evaluator.canonical=l||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=f,this._evaluator.featureTileCoord=m||null,this._evaluator.featureDistanceData=v||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,o,l,u,f,m,v){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=o||null,this._evaluator.canonical=l||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=f||null,this._evaluator.featureTileCoord=m||null,this._evaluator.featureDistanceData=v||null;try{const x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new Pn(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(x)} instead.`);return x}catch(x){return this._warningHistory[x.message]||(this._warningHistory[x.message]=!0,typeof console<"u"&&console.warn(x.message)),this._defaultValue}}}function Fl(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Sa}function Ps(i,e){const t=new Yo(Sa,[],e?function(l){const u={color:Br,string:gi,number:zt,enum:gi,boolean:yi,formatted:fa,resolvedImage:pa};return l.type==="array"?gr(u[l.value]||ui,l.length):u[l.type]}(e):void 0),o=t.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?id(new pu(o,e)):Is(t.errors)}class mu{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!Ao(t.expression)}evaluateWithoutErrorHandling(e,t,o,l,u,f){return this._styleExpression.evaluateWithoutErrorHandling(e,t,o,l,u,f)}evaluate(e,t,o,l,u,f){return this._styleExpression.evaluate(e,t,o,l,u,f)}}class Ia{constructor(e,t,o,l){this.kind=e,this.zoomStops=o,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!Ao(t.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,t,o,l,u,f){return this._styleExpression.evaluateWithoutErrorHandling(e,t,o,l,u,f)}evaluate(e,t,o,l,u,f){return this._styleExpression.evaluate(e,t,o,l,u,f)}interpolationFactor(e,t,o){return this.interpolationType?$r.interpolationFactor(this.interpolationType,e,t,o):0}}function _u(i,e){if((i=Ps(i,e)).result==="error")return i;const t=i.value.expression,o=Ko(t);if(!o&&!ks(e))return Is([new Kn("","data expressions not supported")]);const l=xa(t,["zoom","pitch","distance-from-center"]);if(!l&&!nd(e))return Is([new Kn("","zoom expressions not supported")]);const u=Ls(t);return u||l?u instanceof Kn?Is([u]):u instanceof $r&&!du(e)?Is([new Kn("",'"interpolate" expressions cannot be used with this property')]):id(u?new Ia(o?"camera":"composite",i.value,u.labels,u instanceof $r?u.interpolation:void 0):new mu(o?"constant":"source",i.value)):Is([new Kn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ds{constructor(e,t){this._parameters=e,this._specification=t,wi(this,Aa(this._parameters,this._specification))}static deserialize(e){return new Ds(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ls(i){let e=null;if(i instanceof Xh)e=Ls(i.result);else if(i instanceof Hh){for(const t of i.args)if(e=Ls(t),e)break}else(i instanceof Hc||i instanceof $r)&&i.input instanceof Fr&&i.input.name==="zoom"&&(e=i);return e instanceof Kn||i.eachChild(t=>{const o=Ls(t);o instanceof Kn?e=o:!e&&o?e=new Kn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new Kn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class Pt{constructor(e,t,o,l){this.message=(e?`${e}: `:"")+o,l&&(this.identifier=l),t!=null&&t.__line__&&(this.line=t.__line__)}}function yr(i){const e=i.key,t=i.value,o=i.valueSpec||{},l=i.objectElementValidators||{},u=i.style,f=i.styleSpec;let m=[];const v=Ri(t);if(v!=="object")return[new Pt(e,t,`object expected, ${v} found`)];for(const x in t){const S=x.split(".")[0],A=o[S]||o["*"];let I;l[S]?I=l[S]:o[S]?I=Rn:l["*"]?I=l["*"]:o["*"]&&(I=Rn),I?m=m.concat(I({key:(e&&`${e}.`)+x,value:t[x],valueSpec:A,style:u,styleSpec:f,object:t,objectKey:x},t)):m.push(new Pt(e,t[x],`unknown property "${x}"`))}for(const x in o)l[x]||o[x].required&&o[x].default===void 0&&t[x]===void 0&&m.push(new Pt(e,t,`missing required property "${x}"`));return m}function gu(i){const e=i.value,t=i.valueSpec,o=i.style,l=i.styleSpec,u=i.key,f=i.arrayElementValidator||Rn;if(Ri(e)!=="array")return[new Pt(u,e,`array expected, ${Ri(e)} found`)];if(t.length&&e.length!==t.length)return[new Pt(u,e,`array length ${t.length} expected, length ${e.length} found`)];if(t["min-length"]&&e.length<t["min-length"])return[new Pt(u,e,`array length at least ${t["min-length"]} expected, length ${e.length} found`)];let m={type:t.value,values:t.values,minimum:t.minimum,maximum:t.maximum,function:void 0};l.$version<7&&(m.function=t.function),Ri(t.value)==="object"&&(m=t.value);let v=[];for(let x=0;x<e.length;x++)v=v.concat(f({array:e,arrayIndex:x,value:e[x],valueSpec:m,style:o,styleSpec:l,key:`${u}[${x}]`}));return v}function yu(i){const e=i.key,t=i.value,o=i.valueSpec;let l=Ri(t);if(l==="number"&&t!=t&&(l="NaN"),l!=="number")return[new Pt(e,t,`number expected, ${l} found`)];if("minimum"in o){let u=o.minimum;if(Ri(o.minimum)==="array"&&(u=o.minimum[i.arrayIndex]),t<u)return[new Pt(e,t,`${t} is less than the minimum value ${u}`)]}if("maximum"in o){let u=o.maximum;if(Ri(o.maximum)==="array"&&(u=o.maximum[i.arrayIndex]),t>u)return[new Pt(e,t,`${t} is greater than the maximum value ${u}`)]}return[]}function ka(i){const e=i.valueSpec,t=ni(i.value.type);let o,l,u,f={};const m=t!=="categorical"&&i.value.property===void 0,v=!m,x=Ri(i.value.stops)==="array"&&Ri(i.value.stops[0])==="array"&&Ri(i.value.stops[0][0])==="object",S=yr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(P){if(t==="identity")return[new Pt(P.key,P.value,'identity function may not have a "stops" property')];let L=[];const O=P.value;return L=L.concat(gu({key:P.key,value:O,valueSpec:P.valueSpec,style:P.style,styleSpec:P.styleSpec,arrayElementValidator:A})),Ri(O)==="array"&&O.length===0&&L.push(new Pt(P.key,O,"array must have at least one stop")),L},default:function(P){return Rn({key:P.key,value:P.value,valueSpec:e,style:P.style,styleSpec:P.styleSpec})}}});return t==="identity"&&m&&S.push(new Pt(i.key,i.value,'missing required property "property"')),t==="identity"||i.value.stops||S.push(new Pt(i.key,i.value,'missing required property "stops"')),t==="exponential"&&i.valueSpec.expression&&!du(i.valueSpec)&&S.push(new Pt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(v&&!ks(i.valueSpec)?S.push(new Pt(i.key,i.value,"property functions not supported")):m&&!nd(i.valueSpec)&&S.push(new Pt(i.key,i.value,"zoom functions not supported"))),t!=="categorical"&&!x||i.value.property!==void 0||S.push(new Pt(i.key,i.value,'"property" property is required')),S;function A(P){let L=[];const O=P.value,$=P.key;if(Ri(O)!=="array")return[new Pt($,O,`array expected, ${Ri(O)} found`)];if(O.length!==2)return[new Pt($,O,`array length 2 expected, length ${O.length} found`)];if(x){if(Ri(O[0])!=="object")return[new Pt($,O,`object expected, ${Ri(O[0])} found`)];if(O[0].zoom===void 0)return[new Pt($,O,"object stop key must have zoom")];if(O[0].value===void 0)return[new Pt($,O,"object stop key must have value")];const ee=ni(O[0].zoom);if(typeof ee!="number")return[new Pt($,O[0].zoom,"stop zoom values must be numbers")];if(u&&u>ee)return[new Pt($,O[0].zoom,"stop zoom values must appear in ascending order")];ee!==u&&(u=ee,l=void 0,f={}),L=L.concat(yr({key:`${$}[0]`,value:O[0],valueSpec:{zoom:{}},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{zoom:yu,value:I}}))}else L=L.concat(I({key:`${$}[0]`,value:O[0],valueSpec:{},style:P.style,styleSpec:P.styleSpec},O));return Fl($i(O[1]))?L.concat([new Pt(`${$}[1]`,O[1],"expressions are not allowed in function stops.")]):L.concat(Rn({key:`${$}[1]`,value:O[1],valueSpec:e,style:P.style,styleSpec:P.styleSpec}))}function I(P,L){const O=Ri(P.value),$=ni(P.value),ee=P.value!==null?P.value:L;if(o){if(O!==o)return[new Pt(P.key,ee,`${O} stop domain type must match previous stop domain type ${o}`)]}else o=O;if(O!=="number"&&O!=="string"&&O!=="boolean"&&typeof $!="number"&&typeof $!="string"&&typeof $!="boolean")return[new Pt(P.key,ee,"stop domain value must be a number, string, or boolean")];if(O!=="number"&&t!=="categorical"){let se=`number expected, ${O} found`;return ks(e)&&t===void 0&&(se+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Pt(P.key,ee,se)]}return t!=="categorical"||O!=="number"||typeof $=="number"&&isFinite($)&&Math.floor($)===$?t!=="categorical"&&O==="number"&&typeof $=="number"&&typeof l=="number"&&l!==void 0&&$<l?[new Pt(P.key,ee,"stop domain values must appear in ascending order")]:(l=$,t==="categorical"&&$ in f?[new Pt(P.key,ee,"stop domain values must be unique")]:(f[$]=!0,[])):[new Pt(P.key,ee,`integer expected, found ${String($)}`)]}}function Or(i){const e=(i.expressionContext==="property"?_u:Ps)($i(i.value),i.valueSpec);if(e.result==="error")return e.value.map(o=>new Pt(`${i.key}${o.key}`,i.value,o.message));const t=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!t.outputDefined())return[new Pt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Ao(t))return[new Pt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter")return vu(t,i);if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!xa(t,["zoom","feature-state"]))return[new Pt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Ko(t))return[new Pt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function vu(i,e){const t=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const l of e.valueSpec.expression.parameters)t.delete(l);if(t.size===0)return[];const o=[];return i instanceof Fr&&t.has(i.name)?[new Pt(e.key,e.value,`["${i.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(i.eachChild(l=>{o.push(...vu(l,e))}),o)}function za(i){const e=i.key,t=i.value,o=i.valueSpec,l=[];return Array.isArray(o.values)?o.values.indexOf(ni(t))===-1&&l.push(new Pt(e,t,`expected one of [${o.values.join(", ")}], ${JSON.stringify(t)} found`)):Object.keys(o.values).indexOf(ni(t))===-1&&l.push(new Pt(e,t,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(t)} found`)),l}function Pa(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!Pa(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Da(i,e="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Pa(i)||(i=Ol(i));const t=i;let o=!0;try{o=function(x){if(!ro(x))return x;let S=$i(x);return xu(S),S=od(S),S}(t)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(t,null,2)}
        `)}const l=Ce[`filter_${e}`],u=Ps(o,l);let f=null;if(u.result==="error")throw new Error(u.value.map(x=>`${x.key}: ${x.message}`).join(", "));f=(x,S,A)=>u.value.evaluate(x,S,{},A);let m=null,v=null;if(o!==t){const x=Ps(t,l);if(x.result==="error")throw new Error(x.value.map(S=>`${S.key}: ${S.message}`).join(", "));m=(S,A,I,P,L)=>x.value.evaluate(S,A,{},I,void 0,void 0,P,L),v=!Ko(x.value.expression)}return f=f,{filter:f,dynamicFilter:m||void 0,needGeometry:sd(o),needFeature:!!v}}function od(i){if(!Array.isArray(i))return i;const e=function(t){if(Rp.has(t[0])){for(let o=1;o<t.length;o++)if(ro(t[o]))return!0}return t}(i);return e===!0?e:e.map(t=>od(t))}function xu(i){let e=!1;const t=[];if(i[0]==="case"){for(let o=1;o<i.length-1;o+=2)e=e||ro(i[o]),t.push(i[o+1]);t.push(i[i.length-1])}else if(i[0]==="match"){e=e||ro(i[1]);for(let o=2;o<i.length-1;o+=2)t.push(i[o+1]);t.push(i[i.length-1])}else if(i[0]==="step"){e=e||ro(i[1]);for(let o=1;o<i.length-1;o+=2)t.push(i[o+1])}e&&(i.length=0,i.push("any",...t));for(let o=1;o<i.length;o++)xu(i[o])}function ro(i){if(!Array.isArray(i))return!1;if((e=i[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let t=1;t<i.length;t++)if(ro(i[t]))return!0;return!1}const Rp=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Fp(i,e){return i<e?-1:i>e?1:0}function sd(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(sd(i[e]))return!0;return!1}function Ol(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?bu(i[1],i[2],"=="):e==="!="?$n(bu(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?bu(i[1],i[2],e):e==="any"?(t=i.slice(1),["any"].concat(t.map(Ol))):e==="all"?["all"].concat(i.slice(1).map(Ol)):e==="none"?["all"].concat(i.slice(1).map(Ol).map($n)):e==="in"?La(i[1],i.slice(2)):e==="!in"?$n(La(i[1],i.slice(2))):e==="has"?Ba(i[1]):e==="!has"?$n(Ba(i[1])):e!=="within"||i;var t}function bu(i,e,t){switch(i){case"$type":return[`filter-type-${t}`,e];case"$id":return[`filter-id-${t}`,e];default:return[`filter-${t}`,i,e]}}function La(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(t=>typeof t!=typeof e[0])?["filter-in-large",i,["literal",e.sort(Fp)]]:["filter-in-small",i,["literal",e]]}}function Ba(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function $n(i){return["!",i]}function Bs(i){return Pa($i(i.value))?Or(wi({},i,{expressionContext:"filter",valueSpec:i.styleSpec[`filter_${i.layerType||"fill"}`]})):ad(i)}function ad(i){const e=i.value,t=i.key;if(Ri(e)!=="array")return[new Pt(t,e,`array expected, ${Ri(e)} found`)];const o=i.styleSpec;let l,u=[];if(e.length<1)return[new Pt(t,e,"filter array must have at least 1 element")];switch(u=u.concat(za({key:`${t}[0]`,value:e[0],valueSpec:o.filter_operator,style:i.style,styleSpec:i.styleSpec})),ni(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&ni(e[1])==="$type"&&u.push(new Pt(t,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&u.push(new Pt(t,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(l=Ri(e[1]),l!=="string"&&u.push(new Pt(`${t}[1]`,e[1],`string expected, ${l} found`)));for(let f=2;f<e.length;f++)l=Ri(e[f]),ni(e[1])==="$type"?u=u.concat(za({key:`${t}[${f}]`,value:e[f],valueSpec:o.geometry_type,style:i.style,styleSpec:i.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&u.push(new Pt(`${t}[${f}]`,e[f],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let f=1;f<e.length;f++)u=u.concat(ad({key:`${t}[${f}]`,value:e[f],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":l=Ri(e[1]),e.length!==2?u.push(new Pt(t,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="string"&&u.push(new Pt(`${t}[1]`,e[1],`string expected, ${l} found`));break;case"within":l=Ri(e[1]),e.length!==2?u.push(new Pt(t,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="object"&&u.push(new Pt(`${t}[1]`,e[1],`object expected, ${l} found`))}return u}function ld(i,e){const t=i.key,o=i.style,l=i.styleSpec,u=i.value,f=i.objectKey,m=l[`${e}_${i.layerType}`];if(!m)return[];const v=f.match(/^(.*)-transition$/);if(e==="paint"&&v&&m[v[1]]&&m[v[1]].transition)return Rn({key:t,value:u,valueSpec:l.transition,style:o,styleSpec:l});const x=i.valueSpec||m[f];if(!x)return[new Pt(t,u,`unknown property "${f}"`)];let S;if(Ri(u)==="string"&&ks(x)&&!x.tokens&&(S=/^{([^}]+)}$/.exec(u)))return[new Pt(t,u,`"${f}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(S[1])} }\`.`)];const A=[];return i.layerType==="symbol"&&(f==="text-field"&&o&&!o.glyphs&&A.push(new Pt(t,u,'use of "text-field" requires a style "glyphs" property')),f==="text-font"&&Ca($i(u))&&ni(u.type)==="identity"&&A.push(new Pt(t,u,'"text-font" does not support identity functions'))),A.concat(Rn({key:i.key,value:u,valueSpec:x,style:o,styleSpec:l,expressionContext:"property",propertyType:e,propertyKey:f}))}function cd(i){return ld(i,"paint")}function ud(i){return ld(i,"layout")}function Vl(i){let e=[];const t=i.value,o=i.key,l=i.style,u=i.styleSpec;t.type||t.ref||e.push(new Pt(o,t,'either "type" or "ref" is required'));let f=ni(t.type);const m=ni(t.ref);if(t.id){const v=ni(t.id);for(let x=0;x<i.arrayIndex;x++){const S=l.layers[x];ni(S.id)===v&&e.push(new Pt(o,t.id,`duplicate layer id "${t.id}", previously used at line ${S.id.__line__}`))}}if("ref"in t){let v;["type","source","source-layer","filter","layout"].forEach(x=>{x in t&&e.push(new Pt(o,t[x],`"${x}" is prohibited for ref layers`))}),l.layers.forEach(x=>{ni(x.id)===m&&(v=x)}),v?v.ref?e.push(new Pt(o,t.ref,"ref cannot reference another ref layer")):f=ni(v.type):typeof m=="string"&&e.push(new Pt(o,t.ref,`ref layer "${m}" not found`))}else if(f!=="background"&&f!=="sky")if(t.source){const v=l.sources&&l.sources[t.source],x=v&&ni(v.type);v?x==="vector"&&f==="raster"?e.push(new Pt(o,t.source,`layer "${t.id}" requires a raster source`)):x==="raster"&&f!=="raster"?e.push(new Pt(o,t.source,`layer "${t.id}" requires a vector source`)):x!=="vector"||t["source-layer"]?x==="raster-dem"&&f!=="hillshade"?e.push(new Pt(o,t.source,"raster-dem source can only be used with layer type 'hillshade'.")):f!=="line"||!t.paint||!t.paint["line-gradient"]&&!t.paint["line-trim-offset"]||x==="geojson"&&v.lineMetrics||e.push(new Pt(o,t,`layer "${t.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Pt(o,t,`layer "${t.id}" must specify a "source-layer"`)):e.push(new Pt(o,t.source,`source "${t.source}" not found`))}else e.push(new Pt(o,t,'missing required property "source"'));return e=e.concat(yr({key:o,value:t,valueSpec:u.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Rn({key:`${o}.type`,value:t.type,valueSpec:u.layer.type,style:i.style,styleSpec:i.styleSpec,object:t,objectKey:"type"}),filter:v=>Bs(wi({layerType:f},v)),layout:v=>yr({layer:t,key:v.key,value:v.value,valueSpec:{},style:v.style,styleSpec:v.styleSpec,objectElementValidators:{"*":x=>ud(wi({layerType:f},x))}}),paint:v=>yr({layer:t,key:v.key,value:v.value,valueSpec:{},style:v.style,styleSpec:v.styleSpec,objectElementValidators:{"*":x=>cd(wi({layerType:f},x))}})}})),e}function Rs(i){const e=i.value,t=i.key,o=Ri(e);return o!=="string"?[new Pt(t,e,`string expected, ${o} found`)]:[]}const Ul={promoteId:function({key:i,value:e}){if(Ri(e)==="string")return Rs({key:i,value:e});{const t=[];for(const o in e)t.push(...Rs({key:`${i}.${o}`,value:e[o]}));return t}}};function hd(i){const e=i.value,t=i.key,o=i.styleSpec,l=i.style;if(!e.type)return[new Pt(t,e,'"type" is required')];const u=ni(e.type);let f;switch(u){case"vector":case"raster":case"raster-dem":return f=yr({key:t,value:e,valueSpec:o[`source_${u.replace("-","_")}`],style:i.style,styleSpec:o,objectElementValidators:Ul}),f;case"geojson":if(f=yr({key:t,value:e,valueSpec:o.source_geojson,style:l,styleSpec:o,objectElementValidators:Ul}),e.cluster)for(const m in e.clusterProperties){const[v,x]=e.clusterProperties[m],S=typeof v=="string"?[v,["accumulated"],["get",m]]:v;f.push(...Or({key:`${t}.${m}.map`,value:x,expressionContext:"cluster-map"})),f.push(...Or({key:`${t}.${m}.reduce`,value:S,expressionContext:"cluster-reduce"}))}return f;case"video":return yr({key:t,value:e,valueSpec:o.source_video,style:l,styleSpec:o});case"image":return yr({key:t,value:e,valueSpec:o.source_image,style:l,styleSpec:o});case"canvas":return[new Pt(t,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return za({key:`${t}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:l,styleSpec:o})}}function dd(i){const e=i.value,t=i.styleSpec,o=t.light,l=i.style;let u=[];const f=Ri(e);if(e===void 0)return u;if(f!=="object")return u=u.concat([new Pt("light",e,`object expected, ${f} found`)]),u;for(const m in e){const v=m.match(/^(.*)-transition$/);u=u.concat(v&&o[v[1]]&&o[v[1]].transition?Rn({key:m,value:e[m],valueSpec:t.transition,style:l,styleSpec:t}):o[m]?Rn({key:m,value:e[m],valueSpec:o[m],style:l,styleSpec:t}):[new Pt(m,e[m],`unknown property "${m}"`)])}return u}function Nl(i){const e=i.value,t=i.key,o=i.style,l=i.styleSpec,u=l.terrain;let f=[];const m=Ri(e);if(e===void 0)return f;if(m!=="object")return f=f.concat([new Pt("terrain",e,`object expected, ${m} found`)]),f;for(const v in e){const x=v.match(/^(.*)-transition$/);f=f.concat(x&&u[x[1]]&&u[x[1]].transition?Rn({key:v,value:e[v],valueSpec:l.transition,style:o,styleSpec:l}):u[v]?Rn({key:v,value:e[v],valueSpec:u[v],style:o,styleSpec:l}):[new Pt(v,e[v],`unknown property "${v}"`)])}if(e.source){const v=o.sources&&o.sources[e.source],x=v&&ni(v.type);v?x!=="raster-dem"&&f.push(new Pt(t,e.source,`terrain cannot be used with a source of type ${String(x)}, it only be used with a "raster-dem" source type`)):f.push(new Pt(t,e.source,`source "${e.source}" not found`))}else f.push(new Pt(t,e,'terrain is missing required property "source"'));return f}function fd(i){const e=i.value,t=i.style,o=i.styleSpec,l=o.fog;let u=[];const f=Ri(e);if(e===void 0)return u;if(f!=="object")return u=u.concat([new Pt("fog",e,`object expected, ${f} found`)]),u;for(const m in e){const v=m.match(/^(.*)-transition$/);u=u.concat(v&&l[v[1]]&&l[v[1]].transition?Rn({key:m,value:e[m],valueSpec:o.transition,style:t,styleSpec:o}):l[m]?Rn({key:m,value:e[m],valueSpec:l[m],style:t,styleSpec:o}):[new Pt(m,e[m],`unknown property "${m}"`)])}return u}const wu={"*":()=>[],array:gu,boolean:function(i){const e=i.value,t=i.key,o=Ri(e);return o!=="boolean"?[new Pt(t,e,`boolean expected, ${o} found`)]:[]},number:yu,color:function(i){const e=i.key,t=i.value,o=Ri(t);return o!=="string"?[new Pt(e,t,`color expected, ${o} found`)]:Eo.parseCSSColor(t)===null?[new Pt(e,t,`color expected, "${t}" found`)]:[]},enum:za,filter:Bs,function:ka,layer:Vl,object:yr,source:hd,light:dd,terrain:Nl,fog:fd,string:Rs,formatted:function(i){return Rs(i).length===0?[]:Or(i)},resolvedImage:function(i){return Rs(i).length===0?[]:Or(i)},projection:function(i){const e=i.value,t=i.styleSpec,o=t.projection,l=i.style;let u=[];const f=Ri(e);if(f==="object")for(const m in e)u=u.concat(Rn({key:m,value:e[m],valueSpec:o[m],style:l,styleSpec:t}));else f!=="string"&&(u=u.concat([new Pt("projection",e,`object or string expected, ${f} found`)]));return u}};function Rn(i){const e=i.value,t=i.valueSpec,o=i.styleSpec;return t.expression&&Ca(ni(e))?ka(i):t.expression&&Fl($i(e))?Or(i):t.type&&wu[t.type]?wu[t.type](i):yr(wi({},i,{valueSpec:t.type?o[t.type]:t}))}function Op(i){const e=i.value,t=i.key,o=Rs(i);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new Pt(t,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new Pt(t,e,'"glyphs" url must include a "{range}" token'))),o}function jl(i,e=Ce){return oo(Rn({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:Op,"*":()=>[]}}))}const ql=i=>oo(cd(i)),pd=i=>oo(ud(i));function oo(i){return i.slice().sort((e,t)=>e.line&&t.line?e.line-t.line:0)}function Tu(i,e){let t=!1;if(e&&e.length)for(const o of e)i.fire(new vt(new Error(o.message))),t=!0;return t}var Fs=Cr;function Cr(i,e,t){var o=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var l=new Int32Array(this.arrayBuffer);i=l[0],this.d=(e=l[1])+2*(t=l[2]);for(var u=0;u<this.d*this.d;u++){var f=l[3+u],m=l[3+u+1];o.push(f===m?null:l.subarray(f,m))}var v=l[3+o.length+1];this.keys=l.subarray(l[3+o.length],v),this.bboxes=l.subarray(v),this.insert=this._insertReadonly}else{this.d=e+2*t;for(var x=0;x<this.d*this.d;x++)o.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=i,this.padding=t,this.scale=e/i,this.uid=0;var S=t/e*i;this.min=-S,this.max=i+S}Cr.prototype.insert=function(i,e,t,o,l){this._forEachCell(e,t,o,l,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(e),this.bboxes.push(t),this.bboxes.push(o),this.bboxes.push(l)},Cr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Cr.prototype._insertCell=function(i,e,t,o,l,u){this.cells[l].push(u)},Cr.prototype.query=function(i,e,t,o,l){var u=this.min,f=this.max;if(i<=u&&e<=u&&f<=t&&f<=o&&!l)return Array.prototype.slice.call(this.keys);var m=[];return this._forEachCell(i,e,t,o,this._queryCell,m,{},l),m},Cr.prototype._queryCell=function(i,e,t,o,l,u,f,m){var v=this.cells[l];if(v!==null)for(var x=this.keys,S=this.bboxes,A=0;A<v.length;A++){var I=v[A];if(f[I]===void 0){var P=4*I;(m?m(S[P+0],S[P+1],S[P+2],S[P+3]):i<=S[P+2]&&e<=S[P+3]&&t>=S[P+0]&&o>=S[P+1])?(f[I]=!0,u.push(x[I])):f[I]=!1}}},Cr.prototype._forEachCell=function(i,e,t,o,l,u,f,m){for(var v=this._convertToCellCoord(i),x=this._convertToCellCoord(e),S=this._convertToCellCoord(t),A=this._convertToCellCoord(o),I=v;I<=S;I++)for(var P=x;P<=A;P++){var L=this.d*P+I;if((!m||m(this._convertFromCellCoord(I),this._convertFromCellCoord(P),this._convertFromCellCoord(I+1),this._convertFromCellCoord(P+1)))&&l.call(this,i,e,t,o,L,u,f,m))return}},Cr.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},Cr.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},Cr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,e=3+this.cells.length+1+1,t=0,o=0;o<this.cells.length;o++)t+=this.cells[o].length;var l=new Int32Array(e+t+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;for(var u=e,f=0;f<i.length;f++){var m=i[f];l[3+f]=u,l.set(m,u),u+=m.length}return l[3+i.length]=u,l.set(this.keys,u),l[3+i.length+1]=u+=this.keys.length,l.set(this.bboxes,u),u+=this.bboxes.length,l.buffer};const $l={};function Bt(i,e,t={}){Object.defineProperty(i,"_classRegistryKey",{value:e,writeable:!1}),$l[e]={klass:i,omit:t.omit||[]}}Bt(Object,"Object"),Fs.serialize=function(i,e){const t=i.toArrayBuffer();return e&&e.push(t),{buffer:t}},Fs.deserialize=function(i){return new Fs(i.buffer)},Object.defineProperty(Fs,"name",{value:"Grid"}),Bt(Fs,"Grid"),Bt(Ni,"Color"),Bt(Error,"Error"),Bt(Me,"AJAXError"),Bt(ar,"ResolvedImage"),Bt(Ds,"StylePropertyFunction"),Bt(pu,"StyleExpression",{omit:["_evaluator"]}),Bt(Ia,"ZoomDependentExpression"),Bt(mu,"ZoomConstantExpression"),Bt(Fr,"CompoundExpression",{omit:["_evaluate"]});for(const i in Sa)$l[Sa[i]._classRegistryKey]||Bt(Sa[i],`Expression${i}`);function md(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function _d(i){return D.ImageBitmap&&i instanceof D.ImageBitmap}function Os(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(md(i)||_d(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const t=i;return e&&e.push(t.buffer),t}if(i instanceof D.ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const t=[];for(const o of i)t.push(Os(o,e));return t}if(typeof i=="object"){const t=i.constructor,o=t._classRegistryKey;if(!o)throw new Error(`can't serialize object of unregistered class ${o}`);const l=t.serialize?t.serialize(i,e):{};if(!t.serialize){for(const u in i)i.hasOwnProperty(u)&&($l[o].omit.indexOf(u)>=0||(l[u]=Os(i[u],e)));i instanceof Error&&(l.message=i.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(l.$name=o),l}throw new Error("can't serialize object of type "+typeof i)}function Ra(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||md(i)||_d(i)||ArrayBuffer.isView(i)||i instanceof D.ImageData)return i;if(Array.isArray(i))return i.map(Ra);if(typeof i=="object"){const e=i.$name||"Object",{klass:t}=$l[e];if(!t)throw new Error(`can't deserialize unregistered class ${e}`);if(t.deserialize)return t.deserialize(i);const o=Object.create(t.prototype);for(const l of Object.keys(i))l!=="$name"&&(o[l]=Ra(i[l]));return o}throw new Error("can't deserialize object of type "+typeof i)}class gd{constructor(){this.first=!0}update(e,t){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}const yd=i=>i>=1536&&i<=1791,vd=i=>i>=1872&&i<=1919,xd=i=>i>=2208&&i<=2303,bd=i=>i>=11904&&i<=12031,wd=i=>i>=12032&&i<=12255,Fa=i=>i>=12272&&i<=12287,Gl=i=>i>=12288&&i<=12351,Eu=i=>i>=12352&&i<=12447,Jo=i=>i>=12448&&i<=12543,Td=i=>i>=12544&&i<=12591,Su=i=>i>=12704&&i<=12735,Ed=i=>i>=12736&&i<=12783,Cu=i=>i>=12784&&i<=12799,Au=i=>i>=12800&&i<=13055,Mu=i=>i>=13056&&i<=13311,Iu=i=>i>=13312&&i<=19903,Oa=i=>i>=19968&&i<=40959,Zl=i=>i>=40960&&i<=42127,Sd=i=>i>=42128&&i<=42191,Cd=i=>i>=44032&&i<=55215,Ad=i=>i>=63744&&i<=64255,Va=i=>i>=64336&&i<=65023,Md=i=>i>=65040&&i<=65055,ku=i=>i>=65072&&i<=65103,Id=i=>i>=65104&&i<=65135,zu=i=>i>=65136&&i<=65279,Pu=i=>i>=65280&&i<=65519;function Wl(i){for(const e of i)if(Hl(e.charCodeAt(0)))return!0;return!1}function Vp(i){for(const e of i)if(!Up(e.charCodeAt(0)))return!1;return!0}function Up(i){return!(yd(i)||vd(i)||xd(i)||Va(i)||zu(i))}function Hl(i){return!(i!==746&&i!==747&&(i<4352||!(Su(i)||Td(i)||ku(i)&&!(i>=65097&&i<=65103)||Ad(i)||Mu(i)||bd(i)||Ed(i)||!(!Gl(i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Iu(i)||Oa(i)||Au(i)||(e=>e>=12592&&e<=12687)(i)||(e=>e>=43360&&e<=43391)(i)||(e=>e>=55216&&e<=55295)(i)||(e=>e>=4352&&e<=4607)(i)||Cd(i)||Eu(i)||Fa(i)||(e=>e>=12688&&e<=12703)(i)||wd(i)||Cu(i)||Jo(i)&&i!==12540||!(!Pu(i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Id(i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||(e=>e>=5120&&e<=5759)(i)||(e=>e>=6320&&e<=6399)(i)||Md(i)||(e=>e>=19904&&e<=19967)(i)||Zl(i)||Sd(i))))}function Ua(i){return!(Hl(i)||function(e){return!!((t=>t>=128&&t<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(t=>t>=8192&&t<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(t=>t>=8448&&t<=8527)(e)||(t=>t>=8528&&t<=8591)(e)||(t=>t>=8960&&t<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(t=>t>=9216&&t<=9279)(e)&&e!==9251||(t=>t>=9280&&t<=9311)(e)||(t=>t>=9312&&t<=9471)(e)||(t=>t>=9632&&t<=9727)(e)||(t=>t>=9728&&t<=9983)(e)&&!(e>=9754&&e<=9759)||(t=>t>=11008&&t<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Gl(e)||Jo(e)||(t=>t>=57344&&t<=63743)(e)||ku(e)||Id(e)||Pu(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function c(i){return i>=1424&&i<=2303||Va(i)||zu(i)}function n(i,e){return!(!e&&c(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||(t=>t>=6016&&t<=6143)(i))}function a(i){for(const e of i)if(c(e.charCodeAt(0)))return!0;return!1}const d="deferred",_="loading",g="loaded";let w=null,T="unavailable",C=null;const k=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(T="error"),w&&w(i)};function z(){R.fire(new ce("pluginStateChange",{pluginStatus:T,pluginURL:C}))}const R=new Ze,j=function(){return T},X=function(){if(T!==d||!C)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");T=_,z(),C&&Ie({url:C},i=>{i?k(i):(T=g,z())})},Z={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>T===g||Z.applyArabicShaping!=null,isLoading:()=>T===_,setState(i){T=i.pluginStatus,C=i.pluginURL},isParsed:()=>Z.applyArabicShaping!=null&&Z.processBidirectionalText!=null&&Z.processStyledBidirectionalText!=null,getPluginURL:()=>C};class W{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition,this.pitch=t.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new gd,this.transition={},this.pitch=0)}isSupportedScript(e){return function(t,o){for(const l of t)if(!n(l.charCodeAt(0),o))return!1;return!0}(e,Z.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,t=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*t}}}class H{constructor(e,t){this.property=e,this.value=t,this.expression=function(o,l){if(Ca(o))return new Ds(o,l);if(Fl(o)){const u=_u(o,l);if(u.result==="error")throw new Error(u.value.map(f=>`${f.key}: ${f.message}`).join(", "));return u.value}{let u=o;return typeof o=="string"&&l.type==="color"&&(u=Ni.parse(o)),{kind:"constant",evaluate:()=>u}}}(t===void 0?e.specification.default:t,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,t,o){return this.property.possiblyEvaluate(this,e,t,o)}}class G{constructor(e){this.property=e,this.value=new H(e,void 0)}transitioned(e,t){return new K(this.property,this.value,t,Ve({},e.transition,this.transition),e.now)}untransitioned(){return new K(this.property,this.value,null,{},0)}}class te{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Fe(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new G(this._values[e].property)),this._values[e].value=new H(this._values[e].property,t===null?void 0:Fe(t))}getTransition(e){return Fe(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new G(this._values[e].property)),this._values[e].transition=Fe(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const o=this.getValue(t);o!==void 0&&(e[t]=o);const l=this.getTransition(t);l!==void 0&&(e[`${t}-transition`]=l)}return e}transitioned(e,t){const o=new fe(this._properties);for(const l of Object.keys(this._values))o._values[l]=this._values[l].transitioned(e,t._values[l]);return o}untransitioned(){const e=new fe(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class K{constructor(e,t,o,l,u){const f=l.delay||0,m=l.duration||0;u=u||0,this.property=e,this.value=t,this.begin=u+f,this.end=this.begin+m,e.specification.transition&&(l.delay||l.duration)&&(this.prior=o)}possiblyEvaluate(e,t,o){const l=e.now||0,u=this.value.possiblyEvaluate(e,t,o),f=this.prior;if(f){if(l>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(l<this.begin)return f.possiblyEvaluate(e,t,o);{const m=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,t,o),u,we(m))}}return u}}class fe{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,o){const l=new de(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(e,t,o);return l}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class he{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Fe(this._values[e].value)}setValue(e,t){this._values[e]=new H(this._values[e].property,t===null?void 0:Fe(t))}serialize(){const e={};for(const t of Object.keys(this._values)){const o=this.getValue(t);o!==void 0&&(e[t]=o)}return e}possiblyEvaluate(e,t,o){const l=new de(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(e,t,o);return l}}class oe{constructor(e,t,o){this.property=e,this.value=t,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,t,o,l){return this.property.evaluate(this.value,this.parameters,e,t,o,l)}}class de{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class le{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,o){const l=ba[this.specification.type];return l?l(e,t,o):e}}class ye{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,o,l){return new oe(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(t,null,{},o,l)}:e.expression,t)}interpolate(e,t,o){if(e.value.kind!=="constant"||t.value.kind!=="constant")return e;if(e.value.value===void 0||t.value.value===void 0)return new oe(this,{kind:"constant",value:void 0},e.parameters);const l=ba[this.specification.type];return l?new oe(this,{kind:"constant",value:l(e.value.value,t.value.value,o)},e.parameters):e}evaluate(e,t,o,l,u,f){return e.kind==="constant"?e.value:e.evaluate(t,o,l,u,f)}}class Le extends ye{possiblyEvaluate(e,t,o,l){if(e.value===void 0)return new oe(this,{kind:"constant",value:void 0},t);if(e.expression.kind==="constant"){const u=e.expression.evaluate(t,null,{},o,l),f=e.property.specification.type==="resolvedImage"&&typeof u!="string"?u.name:u,m=this._calculate(f,f,f,t);return new oe(this,{kind:"constant",value:m},t)}if(e.expression.kind==="camera"){const u=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t);return new oe(this,{kind:"constant",value:u},t)}return new oe(this,e.expression,t)}evaluate(e,t,o,l,u,f){if(e.kind==="source"){const m=e.evaluate(t,o,l,u,f);return this._calculate(m,m,m,t)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},o,l),e.evaluate({zoom:Math.floor(t.zoom)},o,l),e.evaluate({zoom:Math.floor(t.zoom)+1},o,l),t):e.value}_calculate(e,t,o,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:t,other:o}:{from:o,to:t,other:e}}interpolate(e){return e}}class dt{constructor(e){this.specification=e}possiblyEvaluate(e,t,o,l){if(e.value!==void 0){if(e.expression.kind==="constant"){const u=e.expression.evaluate(t,null,{},o,l);return this._calculate(u,u,u,t)}return this._calculate(e.expression.evaluate(new W(Math.floor(t.zoom-1),t)),e.expression.evaluate(new W(Math.floor(t.zoom),t)),e.expression.evaluate(new W(Math.floor(t.zoom+1),t)),t)}}_calculate(e,t,o,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:o,to:t}}interpolate(e){return e}}class Ae{constructor(e){this.specification=e}possiblyEvaluate(e,t,o,l){return!!e.expression.evaluate(t,null,{},o,l)}interpolate(){return!1}}class Je{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new W(0,{});for(const o in e){const l=e[o];l.specification.overridable&&this.overridableProperties.push(o);const u=this.defaultPropertyValues[o]=new H(l,void 0),f=this.defaultTransitionablePropertyValues[o]=new G(l);this.defaultTransitioningPropertyValues[o]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=u.possiblyEvaluate(t)}}}function rt(i,e){return 256*(i=Se(Math.floor(i),0,255))+Se(Math.floor(e),0,255)}Bt(ye,"DataDrivenProperty"),Bt(le,"DataConstantProperty"),Bt(Le,"CrossFadedDataDrivenProperty"),Bt(dt,"CrossFadedProperty"),Bt(Ae,"ColorRampProperty");const wt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class je{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class mt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function it(i,e=1){let t=0,o=0;return{members:i.map(l=>{const u=wt[l.type].BYTES_PER_ELEMENT,f=t=It(t,Math.max(e,u)),m=l.components||1;return o=Math.max(o,u),t+=u*m,{name:l.name,type:l.type,components:m,offset:f}}),size:It(t,Math.max(o,e)),alignment:e}}function It(i,e){return Math.ceil(i/e)*e}class St extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const o=this.length;return this.resize(o+1),this.emplace(o,e,t)}emplace(e,t,o){const l=2*e;return this.int16[l+0]=t,this.int16[l+1]=o,e}}St.prototype.bytesPerElement=4,Bt(St,"StructArrayLayout2i4");class Ot extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,t,o)}emplace(e,t,o,l){const u=3*e;return this.int16[u+0]=t,this.int16[u+1]=o,this.int16[u+2]=l,e}}Ot.prototype.bytesPerElement=6,Bt(Ot,"StructArrayLayout3i6");class Wt extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,o,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,o,l)}emplace(e,t,o,l,u){const f=4*e;return this.int16[f+0]=t,this.int16[f+1]=o,this.int16[f+2]=l,this.int16[f+3]=u,e}}Wt.prototype.bytesPerElement=8,Bt(Wt,"StructArrayLayout4i8");class ii extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,o,l,u,f,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,t,o,l,u,f,m)}emplace(e,t,o,l,u,f,m,v){const x=6*e,S=12*e,A=3*e;return this.int16[x+0]=t,this.int16[x+1]=o,this.uint8[S+4]=l,this.uint8[S+5]=u,this.uint8[S+6]=f,this.uint8[S+7]=m,this.float32[A+2]=v,e}}ii.prototype.bytesPerElement=12,Bt(ii,"StructArrayLayout2i4ub1f12");class xi extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,o,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,o,l)}emplace(e,t,o,l,u){const f=4*e;return this.float32[f+0]=t,this.float32[f+1]=o,this.float32[f+2]=l,this.float32[f+3]=u,e}}xi.prototype.bytesPerElement=16,Bt(xi,"StructArrayLayout4f16");class Vt extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,o,l,u,f,m,v,x,S){const A=this.length;return this.resize(A+1),this.emplace(A,e,t,o,l,u,f,m,v,x,S)}emplace(e,t,o,l,u,f,m,v,x,S,A){const I=10*e;return this.uint16[I+0]=t,this.uint16[I+1]=o,this.uint16[I+2]=l,this.uint16[I+3]=u,this.uint16[I+4]=f,this.uint16[I+5]=m,this.uint16[I+6]=v,this.uint16[I+7]=x,this.uint16[I+8]=S,this.uint16[I+9]=A,e}}Vt.prototype.bytesPerElement=20,Bt(Vt,"StructArrayLayout10ui20");class ai extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,o,l,u,f,m,v){const x=this.length;return this.resize(x+1),this.emplace(x,e,t,o,l,u,f,m,v)}emplace(e,t,o,l,u,f,m,v,x){const S=8*e;return this.uint16[S+0]=t,this.uint16[S+1]=o,this.uint16[S+2]=l,this.uint16[S+3]=u,this.uint16[S+4]=f,this.uint16[S+5]=m,this.uint16[S+6]=v,this.uint16[S+7]=x,e}}ai.prototype.bytesPerElement=16,Bt(ai,"StructArrayLayout8ui16");class Mi extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,o,l,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,t,o,l,u,f)}emplace(e,t,o,l,u,f,m){const v=6*e;return this.int16[v+0]=t,this.int16[v+1]=o,this.int16[v+2]=l,this.int16[v+3]=u,this.int16[v+4]=f,this.int16[v+5]=m,e}}Mi.prototype.bytesPerElement=12,Bt(Mi,"StructArrayLayout6i12");class Qi extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,o,l,u,f,m,v,x,S,A,I){const P=this.length;return this.resize(P+1),this.emplace(P,e,t,o,l,u,f,m,v,x,S,A,I)}emplace(e,t,o,l,u,f,m,v,x,S,A,I,P){const L=12*e;return this.int16[L+0]=t,this.int16[L+1]=o,this.int16[L+2]=l,this.int16[L+3]=u,this.uint16[L+4]=f,this.uint16[L+5]=m,this.uint16[L+6]=v,this.uint16[L+7]=x,this.int16[L+8]=S,this.int16[L+9]=A,this.int16[L+10]=I,this.int16[L+11]=P,e}}Qi.prototype.bytesPerElement=24,Bt(Qi,"StructArrayLayout4i4ui4i24");class hn extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,o,l,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,t,o,l,u,f)}emplace(e,t,o,l,u,f,m){const v=10*e,x=5*e;return this.int16[v+0]=t,this.int16[v+1]=o,this.int16[v+2]=l,this.float32[x+2]=u,this.float32[x+3]=f,this.float32[x+4]=m,e}}hn.prototype.bytesPerElement=20,Bt(hn,"StructArrayLayout3i3f20");class ji extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}ji.prototype.bytesPerElement=4,Bt(ji,"StructArrayLayout1ul4");class Fn extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,o,l,u,f,m,v,x,S,A,I,P){const L=this.length;return this.resize(L+1),this.emplace(L,e,t,o,l,u,f,m,v,x,S,A,I,P)}emplace(e,t,o,l,u,f,m,v,x,S,A,I,P,L){const O=20*e,$=10*e;return this.int16[O+0]=t,this.int16[O+1]=o,this.int16[O+2]=l,this.int16[O+3]=u,this.int16[O+4]=f,this.float32[$+3]=m,this.float32[$+4]=v,this.float32[$+5]=x,this.float32[$+6]=S,this.int16[O+14]=A,this.uint32[$+8]=I,this.uint16[O+18]=P,this.uint16[O+19]=L,e}}Fn.prototype.bytesPerElement=40,Bt(Fn,"StructArrayLayout5i4f1i1ul2ui40");class Vr extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,o,l,u,f,m){const v=this.length;return this.resize(v+1),this.emplace(v,e,t,o,l,u,f,m)}emplace(e,t,o,l,u,f,m,v){const x=8*e;return this.int16[x+0]=t,this.int16[x+1]=o,this.int16[x+2]=l,this.int16[x+4]=u,this.int16[x+5]=f,this.int16[x+6]=m,this.int16[x+7]=v,e}}Vr.prototype.bytesPerElement=16,Bt(Vr,"StructArrayLayout3i2i2i16");class so extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,o,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,t,o,l,u)}emplace(e,t,o,l,u,f){const m=4*e,v=8*e;return this.float32[m+0]=t,this.float32[m+1]=o,this.float32[m+2]=l,this.int16[v+6]=u,this.int16[v+7]=f,e}}so.prototype.bytesPerElement=16,Bt(so,"StructArrayLayout2f1f2i16");class en extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,o,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,o,l)}emplace(e,t,o,l,u){const f=12*e,m=3*e;return this.uint8[f+0]=t,this.uint8[f+1]=o,this.float32[m+1]=l,this.float32[m+2]=u,e}}en.prototype.bytesPerElement=12,Bt(en,"StructArrayLayout2ub2f12");class nn extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,t,o)}emplace(e,t,o,l){const u=3*e;return this.float32[u+0]=t,this.float32[u+1]=o,this.float32[u+2]=l,e}}nn.prototype.bytesPerElement=12,Bt(nn,"StructArrayLayout3f12");class _i extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,t,o)}emplace(e,t,o,l){const u=3*e;return this.uint16[u+0]=t,this.uint16[u+1]=o,this.uint16[u+2]=l,e}}_i.prototype.bytesPerElement=6,Bt(_i,"StructArrayLayout3ui6");class bn extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,o,l,u,f,m,v,x,S,A,I,P,L,O,$,ee,se,ie,re,pe){const ae=this.length;return this.resize(ae+1),this.emplace(ae,e,t,o,l,u,f,m,v,x,S,A,I,P,L,O,$,ee,se,ie,re,pe)}emplace(e,t,o,l,u,f,m,v,x,S,A,I,P,L,O,$,ee,se,ie,re,pe,ae){const Oe=30*e,Re=15*e,We=60*e;return this.int16[Oe+0]=t,this.int16[Oe+1]=o,this.int16[Oe+2]=l,this.float32[Re+2]=u,this.float32[Re+3]=f,this.uint16[Oe+8]=m,this.uint16[Oe+9]=v,this.uint32[Re+5]=x,this.uint32[Re+6]=S,this.uint32[Re+7]=A,this.uint16[Oe+16]=I,this.uint16[Oe+17]=P,this.uint16[Oe+18]=L,this.float32[Re+10]=O,this.float32[Re+11]=$,this.uint8[We+48]=ee,this.uint8[We+49]=se,this.uint8[We+50]=ie,this.uint32[Re+13]=re,this.int16[Oe+28]=pe,this.uint8[We+58]=ae,e}}bn.prototype.bytesPerElement=60,Bt(bn,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Gn extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,o,l,u,f,m,v,x,S,A,I,P,L,O,$,ee,se,ie,re,pe,ae,Oe,Re,We,yt,Ne,et,at,tt){const ft=this.length;return this.resize(ft+1),this.emplace(ft,e,t,o,l,u,f,m,v,x,S,A,I,P,L,O,$,ee,se,ie,re,pe,ae,Oe,Re,We,yt,Ne,et,at,tt)}emplace(e,t,o,l,u,f,m,v,x,S,A,I,P,L,O,$,ee,se,ie,re,pe,ae,Oe,Re,We,yt,Ne,et,at,tt,ft){const lt=38*e,kt=19*e;return this.int16[lt+0]=t,this.int16[lt+1]=o,this.int16[lt+2]=l,this.float32[kt+2]=u,this.float32[kt+3]=f,this.int16[lt+8]=m,this.int16[lt+9]=v,this.int16[lt+10]=x,this.int16[lt+11]=S,this.int16[lt+12]=A,this.int16[lt+13]=I,this.uint16[lt+14]=P,this.uint16[lt+15]=L,this.uint16[lt+16]=O,this.uint16[lt+17]=$,this.uint16[lt+18]=ee,this.uint16[lt+19]=se,this.uint16[lt+20]=ie,this.uint16[lt+21]=re,this.uint16[lt+22]=pe,this.uint16[lt+23]=ae,this.uint16[lt+24]=Oe,this.uint16[lt+25]=Re,this.uint16[lt+26]=We,this.uint16[lt+27]=yt,this.uint16[lt+28]=Ne,this.uint32[kt+15]=et,this.float32[kt+16]=at,this.float32[kt+17]=tt,this.float32[kt+18]=ft,e}}Gn.prototype.bytesPerElement=76,Bt(Gn,"StructArrayLayout3i2f6i15ui1ul3f76");class Xi extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}Xi.prototype.bytesPerElement=4,Bt(Xi,"StructArrayLayout1f4");class Zn extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,o,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,t,o,l,u)}emplace(e,t,o,l,u,f){const m=5*e;return this.float32[m+0]=t,this.float32[m+1]=o,this.float32[m+2]=l,this.float32[m+3]=u,this.float32[m+4]=f,e}}Zn.prototype.bytesPerElement=20,Bt(Zn,"StructArrayLayout5f20");class Qo extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,o,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,o,l)}emplace(e,t,o,l,u){const f=6*e;return this.uint32[3*e+0]=t,this.uint16[f+2]=o,this.uint16[f+3]=l,this.uint16[f+4]=u,e}}Qo.prototype.bytesPerElement=12,Bt(Qo,"StructArrayLayout1ul3ui12");class Jn extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const o=this.length;return this.resize(o+1),this.emplace(o,e,t)}emplace(e,t,o){const l=2*e;return this.uint16[l+0]=t,this.uint16[l+1]=o,e}}Jn.prototype.bytesPerElement=4,Bt(Jn,"StructArrayLayout2ui4");class es extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}es.prototype.bytesPerElement=2,Bt(es,"StructArrayLayout1ui2");class ts extends mt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const o=this.length;return this.resize(o+1),this.emplace(o,e,t)}emplace(e,t,o){const l=2*e;return this.float32[l+0]=t,this.float32[l+1]=o,e}}ts.prototype.bytesPerElement=8,Bt(ts,"StructArrayLayout2f8");class is extends je{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}is.prototype.size=12;class Qn extends Mi{get(e){return new is(this,e)}}Bt(Qn,"FillExtrusionExtArray");class ns extends je{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ns.prototype.size=40;class ko extends Fn{get(e){return new ns(this,e)}}Bt(ko,"CollisionBoxArray");class Na extends je{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Na.prototype.size=60;class Cg extends bn{get(e){return new Na(this,e)}}Bt(Cg,"PlacedSymbolArray");class Ag extends je{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Ag.prototype.size=76;class Mg extends Gn{get(e){return new Ag(this,e)}}Bt(Mg,"SymbolInstanceArray");class Ig extends Xi{getoffsetX(e){return this.float32[1*e+0]}}Bt(Ig,"GlyphOffsetArray");class kg extends Ot{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Bt(kg,"SymbolLineVertexArray");class zg extends je{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}zg.prototype.size=12;class Pg extends Qo{get(e){return new zg(this,e)}}Bt(Pg,"FeatureIndexArray");class Dg extends je{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Dg.prototype.size=4;class Lg extends Jn{get(e){return new Dg(this,e)}}Bt(Lg,"FillExtrusionCentroidArray");class Bg extends je{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Bg.prototype.size=12;class Rg extends Mi{get(e){return new Bg(this,e)}}Bt(Rg,"CircleGlobeExtArray");const Hb=it([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Xb=it([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Fg=Rc(function(i){i.exports=function(e,t){var o,l,u,f,m,v,x,S;for(l=e.length-(o=3&e.length),u=t,m=3432918353,v=461845907,S=0;S<l;)x=255&e.charCodeAt(S)|(255&e.charCodeAt(++S))<<8|(255&e.charCodeAt(++S))<<16|(255&e.charCodeAt(++S))<<24,++S,u=27492+(65535&(f=5*(65535&(u=(u^=x=(65535&(x=(x=(65535&x)*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*v+(((x>>>16)*v&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(x=0,o){case 3:x^=(255&e.charCodeAt(S+2))<<16;case 2:x^=(255&e.charCodeAt(S+1))<<8;case 1:u^=x=(65535&(x=(x=(65535&(x^=255&e.charCodeAt(S)))*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*v+(((x>>>16)*v&65535)<<16)&4294967295}return u^=e.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0}}),Kb=Rc(function(i){i.exports=function(e,t){for(var o,l=e.length,u=t^l,f=0;l>=4;)o=1540483477*(65535&(o=255&e.charCodeAt(f)|(255&e.charCodeAt(++f))<<8|(255&e.charCodeAt(++f))<<16|(255&e.charCodeAt(++f))<<24))+((1540483477*(o>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),l-=4,++f;switch(l){case 3:u^=(255&e.charCodeAt(f+2))<<16;case 2:u^=(255&e.charCodeAt(f+1))<<8;case 1:u=1540483477*(65535&(u^=255&e.charCodeAt(f)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0}}),Du=Fg,Yb=Kb;Du.murmur3=Fg,Du.murmur2=Yb;class kd{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,o,l){this.ids.push(Og(e)),this.positions.push(t,o,l)}getPositions(e){const t=Og(e);let o=0,l=this.ids.length-1;for(;o<l;){const f=o+l>>1;this.ids[f]>=t?l=f:o=f+1}const u=[];for(;this.ids[o]===t;)u.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return u}static serialize(e,t){const o=new Float64Array(e.ids),l=new Uint32Array(e.positions);return Np(o,l,0,o.length-1),t&&t.push(o.buffer,l.buffer),{ids:o,positions:l}}static deserialize(e){const t=new kd;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function Og(i){const e=+i;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Du(String(i))}function Np(i,e,t,o){for(;t<o;){const l=i[t+o>>1];let u=t-1,f=o+1;for(;;){do u++;while(i[u]<l);do f--;while(i[f]>l);if(u>=f)break;zd(i,u,f),zd(e,3*u,3*f),zd(e,3*u+1,3*f+1),zd(e,3*u+2,3*f+2)}f-t<o-f?(Np(i,e,t,f),t=f+1):(Np(i,e,f+1,o),o=f)}}function zd(i,e,t){const o=i[e];i[e]=i[t],i[t]=o}Bt(kd,"FeaturePositionMap");class rs{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}}class Pd extends rs{constructor(e){super(e),this.current=0}set(e,t,o){this.fetchUniformLocation(e,t)&&this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class Vg extends rs{constructor(e){super(e),this.current=[0,0,0,0]}set(e,t,o){this.fetchUniformLocation(e,t)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3])))}}class Ug extends rs{constructor(e){super(e),this.current=Ni.transparent}set(e,t,o){this.fetchUniformLocation(e,t)&&(o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a)))}}const Jb=new Float32Array(16),Qb=new Float32Array(9),ew=new Float32Array(4);function jp(i){return[rt(255*i.r,255*i.g),rt(255*i.b,255*i.a)]}class Lu{constructor(e,t,o){this.value=e,this.uniformNames=t.map(l=>`u_${l}`),this.type=o}setUniform(e,t,o,l,u){t.set(e,u,l.constantOr(this.value))}getBinding(e,t){return this.type==="color"?new Ug(e):new Pd(e)}}class Xl{constructor(e,t){this.uniformNames=t.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,t){this.pixelRatioFrom=t.pixelRatio||1,this.pixelRatioTo=e.pixelRatio||1,this.patternFrom=t.tl.concat(t.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,t,o,l,u){const f=u==="u_pattern_to"||u==="u_dash_to"?this.patternTo:u==="u_pattern_from"||u==="u_dash_from"?this.patternFrom:u==="u_pixel_ratio_to"?this.pixelRatioTo:u==="u_pixel_ratio_from"?this.pixelRatioFrom:null;f&&t.set(e,u,f)}getBinding(e,t){return t==="u_pattern_from"||t==="u_pattern_to"||t==="u_dash_from"||t==="u_dash_to"?new Vg(e):new Pd(e)}}class os{constructor(e,t,o,l){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=t.map(u=>({name:`a_${u}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(e,t,o,l,u,f){const m=this.paintVertexArray.length,v=this.expression.evaluate(new W(0),t,{},u,l,f);this.paintVertexArray.resize(e),this._setPaintValue(m,e,v)}updatePaintArray(e,t,o,l,u){const f=this.expression.evaluate({zoom:0},o,l,void 0,u);this._setPaintValue(e,t,f)}_setPaintValue(e,t,o){if(this.type==="color"){const l=jp(o);for(let u=e;u<t;u++)this.paintVertexArray.emplace(u,l[0],l[1])}else{for(let l=e;l<t;l++)this.paintVertexArray.emplace(l,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ao{constructor(e,t,o,l,u,f){this.expression=e,this.uniformNames=t.map(m=>`u_${m}_t`),this.type=o,this.useIntegerZoom=l,this.zoom=u,this.maxValue=0,this.paintVertexAttributes=t.map(m=>({name:`a_${m}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,t,o,l,u,f){const m=this.expression.evaluate(new W(this.zoom),t,{},u,l,f),v=this.expression.evaluate(new W(this.zoom+1),t,{},u,l,f),x=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(x,e,m,v)}updatePaintArray(e,t,o,l,u){const f=this.expression.evaluate({zoom:this.zoom},o,l,void 0,u),m=this.expression.evaluate({zoom:this.zoom+1},o,l,void 0,u);this._setPaintValue(e,t,f,m)}_setPaintValue(e,t,o,l){if(this.type==="color"){const u=jp(o),f=jp(l);for(let m=e;m<t;m++)this.paintVertexArray.emplace(m,u[0],u[1],f[0],f[1])}else{for(let u=e;u<t;u++)this.paintVertexArray.emplace(u,o,l);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t,o,l,u){const f=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,m=Se(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);t.set(e,u,m)}getBinding(e,t){return new Pd(e)}}class Vs{constructor(e,t,o,l,u,f,m){this.expression=e,this.type=o,this.useIntegerZoom=l,this.zoom=u,this.layerId=m,this.paintVertexAttributes=(o==="array"?Xb:Hb).members;for(let v=0;v<t.length;++v);this.zoomInPaintVertexArray=new f,this.zoomOutPaintVertexArray=new f}populatePaintArray(e,t,o){const l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(l,e,t.patterns&&t.patterns[this.layerId],o)}updatePaintArray(e,t,o,l,u,f){this._setPaintValues(e,t,o.patterns&&o.patterns[this.layerId],f)}_setPaintValues(e,t,o,l){if(!l||!o)return;const{min:u,mid:f,max:m}=o,v=l[u],x=l[f],S=l[m];if(v&&x&&S)for(let A=e;A<t;A++)this._setPaintValue(this.zoomInPaintVertexArray,A,x,v),this._setPaintValue(this.zoomOutPaintVertexArray,A,x,S)}_setPaintValue(e,t,o,l){e.emplace(t,o.tl[0],o.tl[1],o.br[0],o.br[1],l.tl[0],l.tl[1],l.br[0],l.br[1],o.pixelRatio,l.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Us{constructor(e,t,o=()=>!0){this.binders={},this._buffers=[];const l=[];for(const u in e.paint._values){if(!o(u))continue;const f=e.paint.get(u);if(!(f instanceof oe&&ks(f.property.specification)))continue;const m=iw(u,e.type),v=f.value,x=f.property.specification.type,S=f.property.useIntegerZoom,A=f.property.specification["property-type"],I=A==="cross-faded"||A==="cross-faded-data-driven",P=String(u)==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(v.kind!=="constant"||P)if(v.kind==="source"||P||I){const L=Ng(u,x,"source");this.binders[u]=I?new Vs(v,m,x,S,t,L,e.id):new os(v,m,x,L),l.push(`/a_${u}`)}else{const L=Ng(u,x,"composite");this.binders[u]=new ao(v,m,x,S,t,L),l.push(`/z_${u}`)}else this.binders[u]=I?new Xl(v.value,m):new Lu(v.value,m,x),l.push(`/u_${u}`)}this.cacheKey=l.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof os||t instanceof ao?t.maxValue:0}populatePaintArrays(e,t,o,l,u,f){for(const m in this.binders){const v=this.binders[m];(v instanceof os||v instanceof ao||v instanceof Vs)&&v.populatePaintArray(e,t,o,l,u,f)}}setConstantPatternPositions(e,t){for(const o in this.binders){const l=this.binders[o];l instanceof Xl&&l.setConstantPatternPositions(e,t)}}updatePaintArrays(e,t,o,l,u,f){let m=!1;for(const v in e){const x=t.getPositions(v);for(const S of x){const A=o.feature(S.index);for(const I in this.binders){const P=this.binders[I];if((P instanceof os||P instanceof ao||P instanceof Vs)&&P.expression.isStateDependent===!0){const L=l.paint.get(I);P.expression=L.value,P.updatePaintArray(S.start,S.end,A,e[v],u,f),m=!0}}}}return m}defines(){const e=[];for(const t in this.binders){const o=this.binders[t];(o instanceof Lu||o instanceof Xl)&&e.push(...o.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const o=this.binders[t];if(o instanceof os||o instanceof ao||o instanceof Vs)for(let l=0;l<o.paintVertexAttributes.length;l++)e.push(o.paintVertexAttributes[l].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const o=this.binders[t];if(o instanceof Lu||o instanceof Xl||o instanceof ao)for(const l of o.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const t=[];for(const o in this.binders){const l=this.binders[o];if(l instanceof Lu||l instanceof Xl||l instanceof ao)for(const u of l.uniformNames)t.push({name:u,property:o,binding:l.getBinding(e,u)})}return t}setUniforms(e,t,o,l,u){for(const{name:f,property:m,binding:v}of o)this.binders[m].setUniform(e,v,u,l.get(m),f)}updatePaintBuffers(e){this._buffers=[];for(const t in this.binders){const o=this.binders[t];if(e&&o instanceof Vs){const l=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(o instanceof os||o instanceof ao)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const t in this.binders){const o=this.binders[t];(o instanceof os||o instanceof ao||o instanceof Vs)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof os||t instanceof ao||t instanceof Vs)&&t.destroy()}}}class ja{constructor(e,t,o=()=>!0){this.programConfigurations={};for(const l of e)this.programConfigurations[l.id]=new Us(l,t,o);this.needsUpload=!1,this._featureMap=new kd,this._bufferOffset=0}populatePaintArrays(e,t,o,l,u,f,m){for(const v in this.programConfigurations)this.programConfigurations[v].populatePaintArrays(e,t,l,u,f,m);t.id!==void 0&&this._featureMap.add(t.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,o,l,u){for(const f of o)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(e,this._featureMap,t,f,l,u)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const tw={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function iw(i,e){return tw[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}const nw={"line-pattern":{source:Vt,composite:Vt},"fill-pattern":{source:Vt,composite:Vt},"fill-extrusion-pattern":{source:Vt,composite:Vt},"line-dasharray":{source:ai,composite:ai}},rw={color:{source:ts,composite:xi},number:{source:Xi,composite:ts}};function Ng(i,e,t){const o=nw[i];return o&&o[t]||rw[e][t]}Bt(Lu,"ConstantBinder"),Bt(Xl,"CrossFadedConstantBinder"),Bt(os,"SourceExpressionBinder"),Bt(Vs,"CrossFadedCompositeBinder"),Bt(ao,"CompositeExpressionBinder"),Bt(Us,"ProgramConfiguration",{omit:["_buffers"]}),Bt(ja,"ProgramConfigurationSet");const Dd="-transition";class lo extends Ze{constructor(e,t){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),t.layout&&(this._unevaluatedLayout=new he(t.layout)),t.paint)){this._transitionablePaint=new te(t.paint);for(const o in e.paint)this.setPaintProperty(o,e.paint[o],{validate:!1});for(const o in e.layout)this.setLayoutProperty(o,e.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new de(t.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,o={}){t!=null&&this._validate(pd,`layers.${this.id}.layout.${e}`,e,t,o)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}getPaintProperty(e){return ot(e,Dd)?this._transitionablePaint.getTransition(e.slice(0,-Dd.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,o={}){if(t!=null&&this._validate(ql,`layers.${this.id}.paint.${e}`,e,t,o))return!1;if(ot(e,Dd))return this._transitionablePaint.setTransition(e.slice(0,-Dd.length),t||void 0),!1;{const l=this._transitionablePaint._values[e],u=l.property.specification["property-type"]==="cross-faded-data-driven",f=l.value.isDataDriven(),m=l.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);const v=this._transitionablePaint._values[e].value;return v.isDataDriven()||f||u||this._handleOverridablePaintPropertyUpdate(e,m,v)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,t,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),di(e,(t,o)=>!(t===void 0||o==="layout"&&!Object.keys(t).length||o==="paint"&&!Object.keys(t).length))}_validate(e,t,o,l,u={}){return(!u||u.validate!==!1)&&Tu(this,e.call(jl,{key:t,layerType:this.type,objectKey:o,value:l,styleSpec:Ce,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof oe&&ks(t.property.specification)&&(t.value.kind==="source"||t.value.kind==="composite")&&t.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Da(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const ow=it([{name:"a_pos",components:2,type:"Int16"}],4),sw=it([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class An{constructor(e=[]){this.segments=e}prepareSegment(e,t,o,l){let u=this.segments[this.segments.length-1];return e>An.MAX_VERTEX_ARRAY_LENGTH&&xt(`Max vertices per segment is ${An.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!u||u.vertexLength+e>An.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==l)&&(u={vertexOffset:t.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},l!==void 0&&(u.sortKey=l),this.segments.push(u)),u}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,o,l){return new An([{vertexOffset:e,primitiveOffset:t,vertexLength:o,primitiveLength:l,vaos:{},sortKey:0}])}}An.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Bt(An,"SegmentVector");var ei=8192;class Ns{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Oi?new Oi(e.lng,e.lat):Oi.convert(e),this}setSouthWest(e){return this._sw=e instanceof Oi?new Oi(e.lng,e.lat):Oi.convert(e),this}extend(e){const t=this._sw,o=this._ne;let l,u;if(e instanceof Oi)l=e,u=e;else{if(!(e instanceof Ns))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ns.convert(e)):this.extend(Oi.convert(e)):this;if(l=e._sw,u=e._ne,!l||!u)return this}return t||o?(t.lng=Math.min(l.lng,t.lng),t.lat=Math.min(l.lat,t.lat),o.lng=Math.max(u.lng,o.lng),o.lat=Math.max(u.lat,o.lat)):(this._sw=new Oi(l.lng,l.lat),this._ne=new Oi(u.lng,u.lat)),this}getCenter(){return new Oi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Oi(this.getWest(),this.getNorth())}getSouthEast(){return new Oi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:o}=Oi.convert(e);let l=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&l}static convert(e){return!e||e instanceof Ns?e:new Ns(e)}}const qp=63710088e-1;class Oi{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Oi(be(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,o=this.lat*t,l=e.lat*t,u=Math.sin(o)*Math.sin(l)+Math.cos(o)*Math.cos(l)*Math.cos((e.lng-this.lng)*t);return qp*Math.acos(Math.min(u,1))}toBounds(e=0){const t=360*e/40075017,o=t/Math.cos(Math.PI/180*this.lat);return new Ns(new Oi(this.lng-o,this.lat-t),new Oi(this.lng+o,this.lat+t))}static convert(e){if(e instanceof Oi)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Oi(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Oi(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const jg=2*Math.PI*qp;function $p(i){return jg*Math.cos(i*Math.PI/180)}function zo(i){return(180+i)/360}function ss(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Gr(i,e){return i/$p(e)}function Zr(i){return 360*i-180}function Wn(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function qg(i,e){return i*$p(Wn(e))}const Po=85.051129;function $g(i){return 1/Math.cos(i*Math.PI/180)}class Kl{constructor(e,t,o=0){this.x=+e,this.y=+t,this.z=+o}static fromLngLat(e,t=0){const o=Oi.convert(e);return new Kl(zo(o.lng),ss(o.lat),Gr(t,o.lat))}toLngLat(){return new Oi(Zr(this.x),Wn(this.y))}toAltitude(){return qg(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/jg*$g(Wn(this.y))}}function Gp(i,e,t,o,l,u,f,m,v){const x=(e+o)/2,S=(t+l)/2,A=new U(x,S);m(A),function(I,P,L,O,$,ee){const se=L-$,ie=O-ee;return Math.abs((O-P)*se-(L-I)*ie)/Math.hypot(se,ie)}(A.x,A.y,u.x,u.y,f.x,f.y)>=v?(Gp(i,e,t,x,S,u,A,m,v),Gp(i,x,S,o,l,A,f,m,v)):i.push(f)}function Gg(i,e,t){let o=i[0],l=o.x,u=o.y;e(o);const f=[o];for(let m=1;m<i.length;m++){const v=i[m],{x,y:S}=v;e(v),Gp(f,l,u,x,S,o,v,e,t),l=x,u=S,o=v}return f}function Zp(i,e,t,o,l){if(l(e,t)){const u=e.add(t).mult(.5);o(u),Zp(i,e,u,o,l),Zp(i,u,t,o,l)}else i.push(t)}function aw(i,e,t){let o=i[0];e(o);const l=[o];for(let u=1;u<i.length;u++){const f=i[u];e(f),Zp(l,o,f,e,t),o=f}return l}const Wp=Math.pow(2,14)-1,Zg=-Wp-1;function lw(i,e){const t=Math.round(i.x*e),o=Math.round(i.y*e);return i.x=Se(t,Zg,Wp),i.y=Se(o,Zg,Wp),(t<i.x||t>i.x+1||o<i.y||o>i.y+1)&&xt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function as(i,e,t){const o=i.loadGeometry(),l=i.extent,u=ei/l;if(e&&t&&t.projection.isReprojectedInTileSpace){const f=1<<e.z,{scale:m,x:v,y:x,projection:S}=t,A=I=>{const P=Zr((e.x+I.x/l)/f),L=Wn((e.y+I.y/l)/f),O=S.project(P,L);I.x=(O.x*m-v)*l,I.y=(O.y*m-x)*l};for(let I=0;I<o.length;I++)if(i.type!==1)o[I]=Gg(o[I],A,1);else{const P=[];for(const L of o[I])L.x<0||L.x>=l||L.y<0||L.y>=l||(A(L),P.push(L));o[I]=P}}for(const f of o)for(const m of f)lw(m,u);return o}function qa(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?as(i):[]}}function Ld(i,e,t,o,l){i.emplaceBack(2*e+(o+1)/2,2*t+(l+1)/2)}function Bd(i,e,t){i.emplaceBack(e.x,e.y,e.z,t[0]*16384,t[1]*16384,t[2]*16384)}class Hp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new St,this.indexArray=new _i,this.segments=new An,this.programConfigurations=new ja(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(e,t,o,l){const u=this.layers[0],f=[];let m=null;u.type==="circle"&&(m=u.layout.get("circle-sort-key"));for(const{feature:x,id:S,index:A,sourceLayerIndex:I}of e){const P=this.layers[0]._featureFilter.needGeometry,L=qa(x,P);if(!this.layers[0]._featureFilter.filter(new W(this.zoom),L,o))continue;const O=m?m.evaluate(L,{},o):void 0,$={id:S,properties:x.properties,type:x.type,sourceLayerIndex:I,index:A,geometry:P?L.geometry:as(x,o,l),patterns:{},sortKey:O};f.push($)}m&&f.sort((x,S)=>x.sortKey-S.sortKey);let v=null;l.projection.name==="globe"&&(this.globeExtVertexArray=new Rg,v=l.projection);for(const x of f){const{geometry:S,index:A,sourceLayerIndex:I}=x,P=e[A].feature;this.addFeature(x,S,A,t.availableImages,o,v),t.featureIndex.insert(P,S,A,I,this.index)}}update(e,t,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,o,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ow.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,sw.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,t,o,l,u,f){for(const m of t)for(const v of m){const x=v.x,S=v.y;if(x<0||x>=ei||S<0||S>=ei)continue;if(f){const P=f.projectTilePoint(x,S,u),L=f.upVector(u,x,S),O=this.globeExtVertexArray;Bd(O,P,L),Bd(O,P,L),Bd(O,P,L),Bd(O,P,L)}const A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),I=A.vertexLength;Ld(this.layoutVertexArray,x,S,-1,-1),Ld(this.layoutVertexArray,x,S,1,-1),Ld(this.layoutVertexArray,x,S,1,1),Ld(this.layoutVertexArray,x,S,-1,1),this.indexArray.emplaceBack(I,I+1,I+2),this.indexArray.emplaceBack(I,I+2,I+3),A.vertexLength+=4,A.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},l,u)}}function Wg(i,e){for(let t=0;t<i.length;t++)if($a(e,i[t]))return!0;for(let t=0;t<e.length;t++)if($a(i,e[t]))return!0;return!!Xp(i,e)}function cw(i,e,t){return!!$a(i,e)||!!Kp(e,i,t)}function Hg(i,e){if(i.length===1)return Kg(e,i[0]);for(let t=0;t<e.length;t++){const o=e[t];for(let l=0;l<o.length;l++)if($a(i,o[l]))return!0}for(let t=0;t<i.length;t++)if(Kg(e,i[t]))return!0;for(let t=0;t<e.length;t++)if(Xp(i,e[t]))return!0;return!1}function uw(i,e,t){if(i.length>1){if(Xp(i,e))return!0;for(let o=0;o<e.length;o++)if(Kp(e[o],i,t))return!0}for(let o=0;o<i.length;o++)if(Kp(i[o],e,t))return!0;return!1}function Xp(i,e){if(i.length===0||e.length===0)return!1;for(let t=0;t<i.length-1;t++){const o=i[t],l=i[t+1];for(let u=0;u<e.length-1;u++)if(hw(o,l,e[u],e[u+1]))return!0}return!1}function hw(i,e,t,o){return Lt(i,t,o)!==Lt(e,t,o)&&Lt(i,e,t)!==Lt(i,e,o)}function Kp(i,e,t){const o=t*t;if(e.length===1)return i.distSqr(e[0])<o;for(let l=1;l<e.length;l++)if(Xg(i,e[l-1],e[l])<o)return!0;return!1}function Xg(i,e,t){const o=e.distSqr(t);if(o===0)return i.distSqr(e);const l=((i.x-e.x)*(t.x-e.x)+(i.y-e.y)*(t.y-e.y))/o;return i.distSqr(l<0?e:l>1?t:t.sub(e)._mult(l)._add(e))}function Kg(i,e){let t,o,l,u=!1;for(let f=0;f<i.length;f++){t=i[f];for(let m=0,v=t.length-1;m<t.length;v=m++)o=t[m],l=t[v],o.y>e.y!=l.y>e.y&&e.x<(l.x-o.x)*(e.y-o.y)/(l.y-o.y)+o.x&&(u=!u)}return u}function $a(i,e){let t=!1;for(let o=0,l=i.length-1;o<i.length;l=o++){const u=i[o],f=i[l];u.y>e.y!=f.y>e.y&&e.x<(f.x-u.x)*(e.y-u.y)/(f.y-u.y)+u.x&&(t=!t)}return t}function Yg(i,e,t,o,l){for(const f of i)if(e<=f.x&&t<=f.y&&o>=f.x&&l>=f.y)return!0;const u=[new U(e,t),new U(e,l),new U(o,l),new U(o,t)];if(i.length>2){for(const f of u)if($a(i,f))return!0}for(let f=0;f<i.length-1;f++)if(dw(i[f],i[f+1],u))return!0;return!1}function dw(i,e,t){const o=t[0],l=t[2];if(i.x<o.x&&e.x<o.x||i.x>l.x&&e.x>l.x||i.y<o.y&&e.y<o.y||i.y>l.y&&e.y>l.y)return!1;const u=Lt(i,e,t[0]);return u!==Lt(i,e,t[1])||u!==Lt(i,e,t[2])||u!==Lt(i,e,t[3])}function Yl(i,e,t){const o=e.paint.get(i).value;return o.kind==="constant"?o.value:t.programConfigurations.get(e.id).getMaxValue(i)}function Rd(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Jg(i,e,t,o,l){if(!e[0]&&!e[1])return i;const u=U.convert(e)._mult(l);t==="viewport"&&u._rotate(-o);const f=[];for(let m=0;m<i.length;m++)f.push(i[m].sub(u));return f}function Qg(i,e,t,o){const l=U.convert(i)._mult(o);return e==="viewport"&&l._rotate(-t),l}Bt(Hp,"CircleBucket",{omit:["layers"]});const fw=new Je({"circle-sort-key":new ye(Ce.layout_circle["circle-sort-key"])});var pw={paint:new Je({"circle-radius":new ye(Ce.paint_circle["circle-radius"]),"circle-color":new ye(Ce.paint_circle["circle-color"]),"circle-blur":new ye(Ce.paint_circle["circle-blur"]),"circle-opacity":new ye(Ce.paint_circle["circle-opacity"]),"circle-translate":new le(Ce.paint_circle["circle-translate"]),"circle-translate-anchor":new le(Ce.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new le(Ce.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new le(Ce.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ye(Ce.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ye(Ce.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ye(Ce.paint_circle["circle-stroke-opacity"])}),layout:fw},Fd=1e-6,Ar=typeof Float32Array<"u"?Float32Array:Array;function ey(){var i=new Ar(9);return Ar!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function Do(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Yp(i,e){var t=e[0],o=e[1],l=e[2],u=e[3],f=e[4],m=e[5],v=e[6],x=e[7],S=e[8],A=e[9],I=e[10],P=e[11],L=e[12],O=e[13],$=e[14],ee=e[15],se=t*m-o*f,ie=t*v-l*f,re=t*x-u*f,pe=o*v-l*m,ae=o*x-u*m,Oe=l*x-u*v,Re=S*O-A*L,We=S*$-I*L,yt=S*ee-P*L,Ne=A*$-I*O,et=A*ee-P*O,at=I*ee-P*$,tt=se*at-ie*et+re*Ne+pe*yt-ae*We+Oe*Re;return tt?(i[0]=(m*at-v*et+x*Ne)*(tt=1/tt),i[1]=(l*et-o*at-u*Ne)*tt,i[2]=(O*Oe-$*ae+ee*pe)*tt,i[3]=(I*ae-A*Oe-P*pe)*tt,i[4]=(v*yt-f*at-x*We)*tt,i[5]=(t*at-l*yt+u*We)*tt,i[6]=($*re-L*Oe-ee*ie)*tt,i[7]=(S*Oe-I*re+P*ie)*tt,i[8]=(f*et-m*yt+x*Re)*tt,i[9]=(o*yt-t*et-u*Re)*tt,i[10]=(L*ae-O*re+ee*se)*tt,i[11]=(A*re-S*ae-P*se)*tt,i[12]=(m*We-f*Ne-v*Re)*tt,i[13]=(t*Ne-o*We+l*Re)*tt,i[14]=(O*ie-L*pe-$*se)*tt,i[15]=(S*pe-A*ie+I*se)*tt,i):null}function Jl(i,e,t){var o=e[0],l=e[1],u=e[2],f=e[3],m=e[4],v=e[5],x=e[6],S=e[7],A=e[8],I=e[9],P=e[10],L=e[11],O=e[12],$=e[13],ee=e[14],se=e[15],ie=t[0],re=t[1],pe=t[2],ae=t[3];return i[0]=ie*o+re*m+pe*A+ae*O,i[1]=ie*l+re*v+pe*I+ae*$,i[2]=ie*u+re*x+pe*P+ae*ee,i[3]=ie*f+re*S+pe*L+ae*se,i[4]=(ie=t[4])*o+(re=t[5])*m+(pe=t[6])*A+(ae=t[7])*O,i[5]=ie*l+re*v+pe*I+ae*$,i[6]=ie*u+re*x+pe*P+ae*ee,i[7]=ie*f+re*S+pe*L+ae*se,i[8]=(ie=t[8])*o+(re=t[9])*m+(pe=t[10])*A+(ae=t[11])*O,i[9]=ie*l+re*v+pe*I+ae*$,i[10]=ie*u+re*x+pe*P+ae*ee,i[11]=ie*f+re*S+pe*L+ae*se,i[12]=(ie=t[12])*o+(re=t[13])*m+(pe=t[14])*A+(ae=t[15])*O,i[13]=ie*l+re*v+pe*I+ae*$,i[14]=ie*u+re*x+pe*P+ae*ee,i[15]=ie*f+re*S+pe*L+ae*se,i}function Bu(i,e,t){var o,l,u,f,m,v,x,S,A,I,P,L,O=t[0],$=t[1],ee=t[2];return e===i?(i[12]=e[0]*O+e[4]*$+e[8]*ee+e[12],i[13]=e[1]*O+e[5]*$+e[9]*ee+e[13],i[14]=e[2]*O+e[6]*$+e[10]*ee+e[14],i[15]=e[3]*O+e[7]*$+e[11]*ee+e[15]):(l=e[1],u=e[2],f=e[3],m=e[4],v=e[5],x=e[6],S=e[7],A=e[8],I=e[9],P=e[10],L=e[11],i[0]=o=e[0],i[1]=l,i[2]=u,i[3]=f,i[4]=m,i[5]=v,i[6]=x,i[7]=S,i[8]=A,i[9]=I,i[10]=P,i[11]=L,i[12]=o*O+m*$+A*ee+e[12],i[13]=l*O+v*$+I*ee+e[13],i[14]=u*O+x*$+P*ee+e[14],i[15]=f*O+S*$+L*ee+e[15]),i}function Ga(i,e,t){var o=t[0],l=t[1],u=t[2];return i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i[3]=e[3]*o,i[4]=e[4]*l,i[5]=e[5]*l,i[6]=e[6]*l,i[7]=e[7]*l,i[8]=e[8]*u,i[9]=e[9]*u,i[10]=e[10]*u,i[11]=e[11]*u,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function Jp(i,e,t){var o=Math.sin(t),l=Math.cos(t),u=e[4],f=e[5],m=e[6],v=e[7],x=e[8],S=e[9],A=e[10],I=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=u*l+x*o,i[5]=f*l+S*o,i[6]=m*l+A*o,i[7]=v*l+I*o,i[8]=x*l-u*o,i[9]=S*l-f*o,i[10]=A*l-m*o,i[11]=I*l-v*o,i}function Od(i,e,t){var o=Math.sin(t),l=Math.cos(t),u=e[0],f=e[1],m=e[2],v=e[3],x=e[8],S=e[9],A=e[10],I=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=u*l-x*o,i[1]=f*l-S*o,i[2]=m*l-A*o,i[3]=v*l-I*o,i[8]=u*o+x*l,i[9]=f*o+S*l,i[10]=m*o+A*l,i[11]=v*o+I*l,i}function ty(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function iy(i,e,t){var o,l,u,f=t[0],m=t[1],v=t[2],x=Math.hypot(f,m,v);return x<Fd?null:(f*=x=1/x,m*=x,v*=x,o=Math.sin(e),l=Math.cos(e),i[0]=f*f*(u=1-l)+l,i[1]=m*f*u+v*o,i[2]=v*f*u-m*o,i[3]=0,i[4]=f*m*u-v*o,i[5]=m*m*u+l,i[6]=v*m*u+f*o,i[7]=0,i[8]=f*v*u+m*o,i[9]=m*v*u-f*o,i[10]=v*v*u+l,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var mw=Jl;function Qp(){var i=new Ar(3);return Ar!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function ny(i){var e=new Ar(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e}function Ru(i){return Math.hypot(i[0],i[1],i[2])}function Ql(i,e,t){var o=new Ar(3);return o[0]=i,o[1]=e,o[2]=t,o}function js(i,e,t){return i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i}function em(i,e,t){return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i}function ry(i,e,t){return i[0]=e[0]*t[0],i[1]=e[1]*t[1],i[2]=e[2]*t[2],i}function tm(i,e,t){return i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.min(e[2],t[2]),i}function im(i,e,t){return i[0]=Math.max(e[0],t[0]),i[1]=Math.max(e[1],t[1]),i[2]=Math.max(e[2],t[2]),i}function co(i,e,t){return i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i}function Vd(i,e,t,o){return i[0]=e[0]+t[0]*o,i[1]=e[1]+t[1]*o,i[2]=e[2]+t[2]*o,i}function lr(i,e){var t=e[0],o=e[1],l=e[2],u=t*t+o*o+l*l;return u>0&&(u=1/Math.sqrt(u)),i[0]=e[0]*u,i[1]=e[1]*u,i[2]=e[2]*u,i}function Wr(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function nm(i,e,t){var o=e[0],l=e[1],u=e[2],f=t[0],m=t[1],v=t[2];return i[0]=l*v-u*m,i[1]=u*f-o*v,i[2]=o*m-l*f,i}function zn(i,e,t){var o=e[0],l=e[1],u=e[2],f=t[3]*o+t[7]*l+t[11]*u+t[15];return i[0]=(t[0]*o+t[4]*l+t[8]*u+t[12])/(f=f||1),i[1]=(t[1]*o+t[5]*l+t[9]*u+t[13])/f,i[2]=(t[2]*o+t[6]*l+t[10]*u+t[14])/f,i}function oy(i,e,t){var o=t[0],l=t[1],u=t[2],f=e[0],m=e[1],v=e[2],x=l*v-u*m,S=u*f-o*v,A=o*m-l*f,I=l*A-u*S,P=u*x-o*A,L=o*S-l*x,O=2*t[3];return S*=O,A*=O,P*=2,L*=2,i[0]=f+(x*=O)+(I*=2),i[1]=m+S+P,i[2]=v+A+L,i}var Fu,uo=em,_w=ry,gw=Ru;function sy(i,e,t){return i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i}function Za(i,e,t){var o=e[0],l=e[1],u=e[2],f=e[3];return i[0]=t[0]*o+t[4]*l+t[8]*u+t[12]*f,i[1]=t[1]*o+t[5]*l+t[9]*u+t[13]*f,i[2]=t[2]*o+t[6]*l+t[10]*u+t[14]*f,i[3]=t[3]*o+t[7]*l+t[11]*u+t[15]*f,i}function ay(){var i=new Ar(4);return Ar!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function ly(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function cy(i,e,t){t*=.5;var o=e[0],l=e[1],u=e[2],f=e[3],m=Math.sin(t),v=Math.cos(t);return i[0]=o*v+f*m,i[1]=l*v+u*m,i[2]=u*v-l*m,i[3]=f*v-o*m,i}function uy(i,e,t){t*=.5;var o=e[0],l=e[1],u=e[2],f=e[3],m=Math.sin(t),v=Math.cos(t);return i[0]=o*v-u*m,i[1]=l*v+f*m,i[2]=u*v+o*m,i[3]=f*v-l*m,i}Qp(),Fu=new Ar(4),Ar!=Float32Array&&(Fu[0]=0,Fu[1]=0,Fu[2]=0,Fu[3]=0),Qp(),Ql(1,0,0),Ql(0,1,0),ay(),ay(),ey();class rm{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,o){const l=Wr(t,this.dir);if(Math.abs(l)<1e-6)return!1;const u=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1]+(e[2]-this.pos[2])*t[2])/l;return o[0]=this.pos[0]+this.dir[0]*u,o[1]=this.pos[1]+this.dir[1]*u,o[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(e,t,o){if(function(P,L){var O=P[0],$=P[1],ee=P[2],se=L[0],ie=L[1],re=L[2];return Math.abs(O-se)<=Fd*Math.max(1,Math.abs(O),Math.abs(se))&&Math.abs($-ie)<=Fd*Math.max(1,Math.abs($),Math.abs(ie))&&Math.abs(ee-re)<=Fd*Math.max(1,Math.abs(ee),Math.abs(re))}(this.pos,e)||t===0)return o[0]=o[1]=o[2]=0,!1;const[l,u,f]=this.dir,m=this.pos[0]-e[0],v=this.pos[1]-e[1],x=this.pos[2]-e[2],S=l*l+u*u+f*f,A=2*(m*l+v*u+x*f),I=A*A-4*S*(m*m+v*v+x*x-t*t);if(I<0){const P=Math.max(-A/2,0),L=m+l*P,O=v+u*P,$=x+f*P,ee=Math.hypot(L,O,$);return o[0]=L*t/ee,o[1]=O*t/ee,o[2]=$*t/ee,!1}{const P=(-A-Math.sqrt(I))/(2*S);if(P<0){const L=Math.hypot(m,v,x);return o[0]=m*t/L,o[1]=v*t/L,o[2]=x*t/L,!1}return o[0]=m+l*P,o[1]=v+u*P,o[2]=x+f*P,!0}}}class om{constructor(e,t,o,l,u){this.TL=e,this.TR=t,this.BR=o,this.BL=l,this.horizon=u}static fromInvProjectionMatrix(e,t,o){const l=[-1,1,1],u=[1,1,1],f=[1,-1,1],m=[-1,-1,1],v=zn(l,l,e),x=zn(u,u,e),S=zn(f,f,e),A=zn(m,m,e);return new om(v,x,S,A,t/o)}}class sm{constructor(e,t){this.points=e,this.planes=t}static fromInvProjectionMatrix(e,t,o,l){const u=Math.pow(2,o),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(v=>{const x=Za([],v,e),S=1/x[3]/t*u;return function(A,I,P){return A[0]=I[0]*P[0],A[1]=I[1]*P[1],A[2]=I[2]*P[2],A[3]=I[3]*P[3],A}(x,x,[S,S,l?1/x[3]:S,S])}),m=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(v=>{const x=lr([],nm([],uo([],f[v[0]],f[v[1]]),uo([],f[v[2]],f[v[1]]))),S=-Wr(x,f[v[1]]);return x.concat(S)});return new sm(f,m)}}class vr{static fromPoints(e){const t=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],o=[Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE];for(const l of e)t[0]=Math.min(t[0],l[0]),t[1]=Math.min(t[1],l[1]),t[2]=Math.min(t[2],l[2]),o[0]=Math.max(o[0],l[0]),o[1]=Math.max(o[1],l[1]),o[2]=Math.max(o[2],l[2]);return new vr(t,o)}constructor(e,t){this.min=e,this.max=t,this.center=co([],js([],this.min,this.max),.5)}quadrant(e){const t=[e%2==0,e<2],o=ny(this.min),l=ny(this.max);for(let u=0;u<t.length;u++)o[u]=t[u]?this.min[u]:this.center[u],l[u]=t[u]?this.center[u]:this.max[u];return l[2]=this.max[2],new vr(o,l)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){const t=this.getCorners();let o=!0;for(let l=0;l<e.planes.length;l++){const u=e.planes[l];let f=0;for(let m=0;m<t.length;m++)f+=Wr(u,t[m])+u[3]>=0;if(f===0)return 0;f!==t.length&&(o=!1)}if(o)return 2;for(let l=0;l<3;l++){let u=Number.MAX_VALUE,f=-Number.MAX_VALUE;for(let m=0;m<e.points.length;m++){const v=e.points[m][l]-this.min[l];u=Math.min(u,v),f=Math.max(f,v)}if(f<0||u>this.max[l]-this.min[l])return 0}return 1}}function hy(i,e,t,o,l,u,f,m,v){if(u&&i.queryGeometry.isAboveHorizon)return!1;u&&(v*=i.pixelToTileUnitsFactor);const x=i.tileID.canonical,S=t.projection.upVectorScale(x,t.center.lat,t.worldSize).metersToTile;for(const A of e)for(const I of A){const P=I.add(m),L=l&&t.elevation?t.elevation.exaggeration()*l.getElevationAt(P.x,P.y,!0):0,O=t.projection.projectTilePoint(P.x,P.y,x);if(L>0){const ie=t.projection.upVector(x,P.x,P.y);O.x+=ie[0]*S*L,O.y+=ie[1]*S*L,O.z+=ie[2]*S*L}const $=u?P:yw(O.x,O.y,O.z,o),ee=u?i.tilespaceRays.map(ie=>xw(ie,L)):i.queryGeometry.screenGeometry,se=Za([],[O.x,O.y,O.z,1],o);if(!f&&u?v*=se[3]/t.cameraToCenterDistance:f&&!u&&(v*=t.cameraToCenterDistance/se[3]),u){const ie=Wn((I.y/ei+x.y)/(1<<x.z));v/=t.projection.pixelsPerMeter(ie,1)/Gr(1,ie)}if(cw(ee,$,v))return!0}return!1}function yw(i,e,t,o){const l=Za([],[i,e,t,1],o);return new U(l[0]/l[3],l[1]/l[3])}const dy=Ql(0,0,0),vw=Ql(0,0,1);function xw(i,e){const t=Qp();return dy[2]=e,i.intersectsPlane(dy,vw,t),new U(t[0],t[1])}class fy extends Hp{}function py(i,{width:e,height:t},o,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*t*o)throw new RangeError("mismatched image size")}else l=new Uint8Array(e*t*o);return i.width=e,i.height=t,i.data=l,i}function my(i,e,t){const{width:o,height:l}=e;o===i.width&&l===i.height||(am(i,e,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,o),height:Math.min(i.height,l)},t),i.width=o,i.height=l,i.data=e.data)}function am(i,e,t,o,l,u){if(l.width===0||l.height===0)return e;if(l.width>i.width||l.height>i.height||t.x>i.width-l.width||t.y>i.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||o.x>e.width-l.width||o.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const f=i.data,m=e.data;for(let v=0;v<l.height;v++){const x=((t.y+v)*i.width+t.x)*u,S=((o.y+v)*e.width+o.x)*u;for(let A=0;A<l.width*u;A++)m[S+A]=f[x+A]}return e}Bt(fy,"HeatmapBucket",{omit:["layers"]});class ls{constructor(e,t){py(this,e,1,t)}resize(e){my(this,new ls(e),1)}clone(){return new ls({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,o,l,u){am(e,t,o,l,u,1)}}class Mr{constructor(e,t){py(this,e,4,t)}resize(e){my(this,new Mr(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Mr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,o,l,u){am(e,t,o,l,u,4)}}Bt(ls,"AlphaImage"),Bt(Mr,"RGBAImage");var bw={paint:new Je({"heatmap-radius":new ye(Ce.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ye(Ce.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new le(Ce.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ae(Ce.paint_heatmap["heatmap-color"]),"heatmap-opacity":new le(Ce.paint_heatmap["heatmap-opacity"])})};function lm(i){const e={},t=i.resolution||256,o=i.clips?i.clips.length:1,l=i.image||new Mr({width:t,height:o}),u=(f,m,v)=>{e[i.evaluationKey]=v;const x=i.expression.evaluate(e);l.data[f+m+0]=Math.floor(255*x.r/x.a),l.data[f+m+1]=Math.floor(255*x.g/x.a),l.data[f+m+2]=Math.floor(255*x.b/x.a),l.data[f+m+3]=Math.floor(255*x.a)};if(i.clips)for(let f=0,m=0;f<o;++f,m+=4*t)for(let v=0,x=0;v<t;v++,x+=4){const S=v/(t-1),{start:A,end:I}=i.clips[f];u(m,x,A*(1-S)+I*S)}else for(let f=0,m=0;f<t;f++,m+=4)u(0,m,f/(t-1));return l}var ww={paint:new Je({"hillshade-illumination-direction":new le(Ce.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new le(Ce.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new le(Ce.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new le(Ce.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new le(Ce.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new le(Ce.paint_hillshade["hillshade-accent-color"])})};const Tw=it([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ew}=Tw;var Ud=Nd,Sw=Nd;function Nd(i,e,t){t=t||2;var o,l,u,f,m,v,x,S=e&&e.length,A=S?e[0]*t:i.length,I=_y(i,0,A,t,!0),P=[];if(!I||I.next===I.prev)return P;if(S&&(I=function(O,$,ee,se){var ie,re,pe,ae=[];for(ie=0,re=$.length;ie<re;ie++)(pe=_y(O,$[ie]*se,ie<re-1?$[ie+1]*se:O.length,se,!1))===pe.next&&(pe.steiner=!0),ae.push(Dw(pe));for(ae.sort(kw),ie=0;ie<ae.length;ie++)ee=zw(ae[ie],ee);return ee}(i,e,I,t)),i.length>80*t){o=u=i[0],l=f=i[1];for(var L=t;L<A;L+=t)(m=i[L])<o&&(o=m),(v=i[L+1])<l&&(l=v),m>u&&(u=m),v>f&&(f=v);x=(x=Math.max(u-o,f-l))!==0?32767/x:0}return Ou(I,P,t,o,l,x,0),P}function _y(i,e,t,o,l){var u,f;if(l===hm(i,e,t,o)>0)for(u=e;u<t;u+=o)f=vy(u,i[u],i[u+1],f);else for(u=t-o;u>=e;u-=o)f=vy(u,i[u],i[u+1],f);return f&&jd(f,f.next)&&(Uu(f),f=f.next),f}function Wa(i,e){if(!i)return i;e||(e=i);var t,o=i;do if(t=!1,o.steiner||!jd(o,o.next)&&wn(o.prev,o,o.next)!==0)o=o.next;else{if(Uu(o),(o=e=o.prev)===o.next)break;t=!0}while(t||o!==e);return e}function Ou(i,e,t,o,l,u,f){if(i){!f&&u&&function(S,A,I,P){var L=S;do L.z===0&&(L.z=cm(L.x,L.y,A,I,P)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==S);L.prevZ.nextZ=null,L.prevZ=null,function(O){var $,ee,se,ie,re,pe,ae,Oe,Re=1;do{for(ee=O,O=null,re=null,pe=0;ee;){for(pe++,se=ee,ae=0,$=0;$<Re&&(ae++,se=se.nextZ);$++);for(Oe=Re;ae>0||Oe>0&&se;)ae!==0&&(Oe===0||!se||ee.z<=se.z)?(ie=ee,ee=ee.nextZ,ae--):(ie=se,se=se.nextZ,Oe--),re?re.nextZ=ie:O=ie,ie.prevZ=re,re=ie;ee=se}re.nextZ=null,Re*=2}while(pe>1)}(L)}(i,o,l,u);for(var m,v,x=i;i.prev!==i.next;)if(m=i.prev,v=i.next,u?Aw(i,o,l,u):Cw(i))e.push(m.i/t|0),e.push(i.i/t|0),e.push(v.i/t|0),Uu(i),i=v.next,x=v.next;else if((i=v)===x){f?f===1?Ou(i=Mw(Wa(i),e,t),e,t,o,l,u,2):f===2&&Iw(i,e,t,o,l,u):Ou(Wa(i),e,t,o,l,u,1);break}}}function Cw(i){var e=i.prev,t=i,o=i.next;if(wn(e,t,o)>=0)return!1;for(var l=e.x,u=t.x,f=o.x,m=e.y,v=t.y,x=o.y,S=l<u?l<f?l:f:u<f?u:f,A=m<v?m<x?m:x:v<x?v:x,I=l>u?l>f?l:f:u>f?u:f,P=m>v?m>x?m:x:v>x?v:x,L=o.next;L!==e;){if(L.x>=S&&L.x<=I&&L.y>=A&&L.y<=P&&ec(l,m,u,v,f,x,L.x,L.y)&&wn(L.prev,L,L.next)>=0)return!1;L=L.next}return!0}function Aw(i,e,t,o){var l=i.prev,u=i,f=i.next;if(wn(l,u,f)>=0)return!1;for(var m=l.x,v=u.x,x=f.x,S=l.y,A=u.y,I=f.y,P=m<v?m<x?m:x:v<x?v:x,L=S<A?S<I?S:I:A<I?A:I,O=m>v?m>x?m:x:v>x?v:x,$=S>A?S>I?S:I:A>I?A:I,ee=cm(P,L,e,t,o),se=cm(O,$,e,t,o),ie=i.prevZ,re=i.nextZ;ie&&ie.z>=ee&&re&&re.z<=se;){if(ie.x>=P&&ie.x<=O&&ie.y>=L&&ie.y<=$&&ie!==l&&ie!==f&&ec(m,S,v,A,x,I,ie.x,ie.y)&&wn(ie.prev,ie,ie.next)>=0||(ie=ie.prevZ,re.x>=P&&re.x<=O&&re.y>=L&&re.y<=$&&re!==l&&re!==f&&ec(m,S,v,A,x,I,re.x,re.y)&&wn(re.prev,re,re.next)>=0))return!1;re=re.nextZ}for(;ie&&ie.z>=ee;){if(ie.x>=P&&ie.x<=O&&ie.y>=L&&ie.y<=$&&ie!==l&&ie!==f&&ec(m,S,v,A,x,I,ie.x,ie.y)&&wn(ie.prev,ie,ie.next)>=0)return!1;ie=ie.prevZ}for(;re&&re.z<=se;){if(re.x>=P&&re.x<=O&&re.y>=L&&re.y<=$&&re!==l&&re!==f&&ec(m,S,v,A,x,I,re.x,re.y)&&wn(re.prev,re,re.next)>=0)return!1;re=re.nextZ}return!0}function Mw(i,e,t){var o=i;do{var l=o.prev,u=o.next.next;!jd(l,u)&&gy(l,o,o.next,u)&&Vu(l,u)&&Vu(u,l)&&(e.push(l.i/t|0),e.push(o.i/t|0),e.push(u.i/t|0),Uu(o),Uu(o.next),o=i=u),o=o.next}while(o!==i);return Wa(o)}function Iw(i,e,t,o,l,u){var f=i;do{for(var m=f.next.next;m!==f.prev;){if(f.i!==m.i&&Lw(f,m)){var v=yy(f,m);return f=Wa(f,f.next),v=Wa(v,v.next),Ou(f,e,t,o,l,u,0),void Ou(v,e,t,o,l,u,0)}m=m.next}f=f.next}while(f!==i)}function kw(i,e){return i.x-e.x}function zw(i,e){var t=function(l,u){var f,m=u,v=l.x,x=l.y,S=-1/0;do{if(x<=m.y&&x>=m.next.y&&m.next.y!==m.y){var A=m.x+(x-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(A<=v&&A>S&&(S=A,f=m.x<m.next.x?m:m.next,A===v))return f}m=m.next}while(m!==u);if(!f)return null;var I,P=f,L=f.x,O=f.y,$=1/0;m=f;do v>=m.x&&m.x>=L&&v!==m.x&&ec(x<O?v:S,x,L,O,x<O?S:v,x,m.x,m.y)&&(I=Math.abs(x-m.y)/(v-m.x),Vu(m,l)&&(I<$||I===$&&(m.x>f.x||m.x===f.x&&Pw(f,m)))&&(f=m,$=I)),m=m.next;while(m!==P);return f}(i,e);if(!t)return e;var o=yy(t,i);return Wa(o,o.next),Wa(t,t.next)}function Pw(i,e){return wn(i.prev,i,e.prev)<0&&wn(e.next,i,i.next)<0}function cm(i,e,t,o,l){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-t)*l|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*l|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Dw(i){var e=i,t=i;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==i);return t}function ec(i,e,t,o,l,u,f,m){return(l-f)*(e-m)>=(i-f)*(u-m)&&(i-f)*(o-m)>=(t-f)*(e-m)&&(t-f)*(u-m)>=(l-f)*(o-m)}function Lw(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(t,o){var l=t;do{if(l.i!==t.i&&l.next.i!==t.i&&l.i!==o.i&&l.next.i!==o.i&&gy(l,l.next,t,o))return!0;l=l.next}while(l!==t);return!1}(i,e)&&(Vu(i,e)&&Vu(e,i)&&function(t,o){var l=t,u=!1,f=(t.x+o.x)/2,m=(t.y+o.y)/2;do l.y>m!=l.next.y>m&&l.next.y!==l.y&&f<(l.next.x-l.x)*(m-l.y)/(l.next.y-l.y)+l.x&&(u=!u),l=l.next;while(l!==t);return u}(i,e)&&(wn(i.prev,i,e.prev)||wn(i,e.prev,e))||jd(i,e)&&wn(i.prev,i,i.next)>0&&wn(e.prev,e,e.next)>0)}function wn(i,e,t){return(e.y-i.y)*(t.x-e.x)-(e.x-i.x)*(t.y-e.y)}function jd(i,e){return i.x===e.x&&i.y===e.y}function gy(i,e,t,o){var l=$d(wn(i,e,t)),u=$d(wn(i,e,o)),f=$d(wn(t,o,i)),m=$d(wn(t,o,e));return l!==u&&f!==m||!(l!==0||!qd(i,t,e))||!(u!==0||!qd(i,o,e))||!(f!==0||!qd(t,i,o))||!(m!==0||!qd(t,e,o))}function qd(i,e,t){return e.x<=Math.max(i.x,t.x)&&e.x>=Math.min(i.x,t.x)&&e.y<=Math.max(i.y,t.y)&&e.y>=Math.min(i.y,t.y)}function $d(i){return i>0?1:i<0?-1:0}function Vu(i,e){return wn(i.prev,i,i.next)<0?wn(i,e,i.next)>=0&&wn(i,i.prev,e)>=0:wn(i,e,i.prev)<0||wn(i,i.next,e)<0}function yy(i,e){var t=new um(i.i,i.x,i.y),o=new um(e.i,e.x,e.y),l=i.next,u=e.prev;return i.next=e,e.prev=i,t.next=l,l.prev=t,o.next=t,t.prev=o,u.next=o,o.prev=u,o}function vy(i,e,t,o){var l=new um(i,e,t);return o?(l.next=o.next,l.prev=o,o.next.prev=l,o.next=l):(l.prev=l,l.next=l),l}function Uu(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function um(i,e,t){this.i=i,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function hm(i,e,t,o){for(var l=0,u=e,f=t-o;u<t;u+=o)l+=(i[f]-i[u])*(i[u+1]+i[f+1]),f=u;return l}function Bw(i,e,t,o,l){xy(i,e,t||0,o||i.length-1,l||Rw)}function xy(i,e,t,o,l){for(;o>t;){if(o-t>600){var u=o-t+1,f=e-t+1,m=Math.log(u),v=.5*Math.exp(2*m/3),x=.5*Math.sqrt(m*v*(u-v)/u)*(f-u/2<0?-1:1);xy(i,e,Math.max(t,Math.floor(e-f*v/u+x)),Math.min(o,Math.floor(e+(u-f)*v/u+x)),l)}var S=i[e],A=t,I=o;for(Nu(i,t,e),l(i[o],S)>0&&Nu(i,t,o);A<I;){for(Nu(i,A,I),A++,I--;l(i[A],S)<0;)A++;for(;l(i[I],S)>0;)I--}l(i[t],S)===0?Nu(i,t,I):Nu(i,++I,o),I<=e&&(t=I+1),e<=I&&(o=I-1)}}function Nu(i,e,t){var o=i[e];i[e]=i[t],i[t]=o}function Rw(i,e){return i<e?-1:i>e?1:0}function dm(i,e){const t=i.length;if(t<=1)return[i];const o=[];let l,u;for(let f=0;f<t;f++){const m=pi(i[f]);m!==0&&(i[f].area=Math.abs(m),u===void 0&&(u=m<0),u===m<0?(l&&o.push(l),l=[i[f]]):l.push(i[f]))}if(l&&o.push(l),e>1)for(let f=0;f<o.length;f++)o[f].length<=e||(Bw(o[f],e,1,o[f].length-1,Fw),o[f]=o[f].slice(0,e));return o}function Fw(i,e){return e.area-i.area}function fm(i,e,t){const o=t.patternDependencies;let l=!1;for(const u of e){const f=u.paint.get(`${i}-pattern`);f.isConstant()||(l=!0);const m=f.constantOr(null);m&&(l=!0,o[m.to]=!0,o[m.from]=!0)}return l}function pm(i,e,t,o,l){const u=l.patternDependencies;for(const f of e){const m=f.paint.get(`${i}-pattern`).value;if(m.kind!=="constant"){let v=m.evaluate({zoom:o-1},t,{},l.availableImages),x=m.evaluate({zoom:o},t,{},l.availableImages),S=m.evaluate({zoom:o+1},t,{},l.availableImages);v=v&&v.name?v.name:v,x=x&&x.name?x.name:x,S=S&&S.name?S.name:S,u[v]=!0,u[x]=!0,u[S]=!0,t.patterns[f.id]={min:v,mid:x,max:S}}}return t}Nd.deviation=function(i,e,t,o){var l=e&&e.length,u=Math.abs(hm(i,0,l?e[0]*t:i.length,t));if(l)for(var f=0,m=e.length;f<m;f++)u-=Math.abs(hm(i,e[f]*t,f<m-1?e[f+1]*t:i.length,t));var v=0;for(f=0;f<o.length;f+=3){var x=o[f]*t,S=o[f+1]*t,A=o[f+2]*t;v+=Math.abs((i[x]-i[A])*(i[S+1]-i[x+1])-(i[x]-i[S])*(i[A+1]-i[x+1]))}return u===0&&v===0?0:Math.abs((v-u)/u)},Nd.flatten=function(i){for(var e=i[0][0].length,t={vertices:[],holes:[],dimensions:e},o=0,l=0;l<i.length;l++){for(var u=0;u<i[l].length;u++)for(var f=0;f<e;f++)t.vertices.push(i[l][u][f]);l>0&&t.holes.push(o+=i[l-1].length)}return t},Ud.default=Sw;class Gd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new St,this.indexArray=new _i,this.indexArray2=new Jn,this.programConfigurations=new ja(e.layers,e.zoom),this.segments=new An,this.segments2=new An,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.projection=e.projection}populate(e,t,o,l){this.hasPattern=fm("fill",this.layers,t);const u=this.layers[0].layout.get("fill-sort-key"),f=[];for(const{feature:m,id:v,index:x,sourceLayerIndex:S}of e){const A=this.layers[0]._featureFilter.needGeometry,I=qa(m,A);if(!this.layers[0]._featureFilter.filter(new W(this.zoom),I,o))continue;const P=u?u.evaluate(I,{},o,t.availableImages):void 0,L={id:v,properties:m.properties,type:m.type,sourceLayerIndex:S,index:x,geometry:A?I.geometry:as(m,o,l),patterns:{},sortKey:P};f.push(L)}u&&f.sort((m,v)=>m.sortKey-v.sortKey);for(const m of f){const{geometry:v,index:x,sourceLayerIndex:S}=m;if(this.hasPattern){const A=pm("fill",this.layers,m,this.zoom,t);this.patternFeatures.push(A)}else this.addFeature(m,v,x,o,{},t.availableImages);t.featureIndex.insert(e[x].feature,v,x,S,this.index)}}update(e,t,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,o,l)}addFeatures(e,t,o,l,u){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,t,o,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ew),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,o,l,u,f=[]){for(const m of dm(t,500)){let v=0;for(const L of m)v+=L.length;const x=this.segments.prepareSegment(v,this.layoutVertexArray,this.indexArray),S=x.vertexLength,A=[],I=[];for(const L of m){if(L.length===0)continue;L!==m[0]&&I.push(A.length/2);const O=this.segments2.prepareSegment(L.length,this.layoutVertexArray,this.indexArray2),$=O.vertexLength;this.layoutVertexArray.emplaceBack(L[0].x,L[0].y),this.indexArray2.emplaceBack($+L.length-1,$),A.push(L[0].x),A.push(L[0].y);for(let ee=1;ee<L.length;ee++)this.layoutVertexArray.emplaceBack(L[ee].x,L[ee].y),this.indexArray2.emplaceBack($+ee-1,$+ee),A.push(L[ee].x),A.push(L[ee].y);O.vertexLength+=L.length,O.primitiveLength+=L.length}const P=Ud(A,I);for(let L=0;L<P.length;L+=3)this.indexArray.emplaceBack(S+P[L],S+P[L+1],S+P[L+2]);x.vertexLength+=v,x.primitiveLength+=P.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,u,f,l)}}Bt(Gd,"FillBucket",{omit:["layers","patternFeatures"]});const Ow=new Je({"fill-sort-key":new ye(Ce.layout_fill["fill-sort-key"])});var Vw={paint:new Je({"fill-antialias":new le(Ce.paint_fill["fill-antialias"]),"fill-opacity":new ye(Ce.paint_fill["fill-opacity"]),"fill-color":new ye(Ce.paint_fill["fill-color"]),"fill-outline-color":new ye(Ce.paint_fill["fill-outline-color"]),"fill-translate":new le(Ce.paint_fill["fill-translate"]),"fill-translate-anchor":new le(Ce.paint_fill["fill-translate-anchor"]),"fill-pattern":new Le(Ce.paint_fill["fill-pattern"])}),layout:Ow};const Uw=it([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Nw=it([{name:"a_centroid_pos",components:2,type:"Uint16"}]),jw=it([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:qw}=Uw;var by=tc;function tc(i,e,t,o,l){this.properties={},this.extent=t,this.type=0,this._pbf=i,this._geometry=-1,this._keys=o,this._values=l,i.readFields($w,this,e)}function $w(i,e,t){i==1?e.id=t.readVarint():i==2?function(o,l){for(var u=o.readVarint()+o.pos;o.pos<u;){var f=l._keys[o.readVarint()],m=l._values[o.readVarint()];l.properties[f]=m}}(t,e):i==3?e.type=t.readVarint():i==4&&(e._geometry=t.pos)}function Gw(i){for(var e,t,o=0,l=0,u=i.length,f=u-1;l<u;f=l++)o+=((t=i[f]).x-(e=i[l]).x)*(e.y+t.y);return o}tc.types=["Unknown","Point","LineString","Polygon"],tc.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,t=i.readVarint()+i.pos,o=1,l=0,u=0,f=0,m=[];i.pos<t;){if(l<=0){var v=i.readVarint();o=7&v,l=v>>3}if(l--,o===1||o===2)u+=i.readSVarint(),f+=i.readSVarint(),o===1&&(e&&m.push(e),e=[]),e.push(new U(u,f));else{if(o!==7)throw new Error("unknown command "+o);e&&e.push(e[0].clone())}}return e&&m.push(e),m},tc.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,t=1,o=0,l=0,u=0,f=1/0,m=-1/0,v=1/0,x=-1/0;i.pos<e;){if(o<=0){var S=i.readVarint();t=7&S,o=S>>3}if(o--,t===1||t===2)(l+=i.readSVarint())<f&&(f=l),l>m&&(m=l),(u+=i.readSVarint())<v&&(v=u),u>x&&(x=u);else if(t!==7)throw new Error("unknown command "+t)}return[f,v,m,x]},tc.prototype.toGeoJSON=function(i,e,t){var o,l,u=this.extent*Math.pow(2,t),f=this.extent*i,m=this.extent*e,v=this.loadGeometry(),x=tc.types[this.type];function S(P){for(var L=0;L<P.length;L++){var O=P[L];P[L]=[360*(O.x+f)/u-180,360/Math.PI*Math.atan(Math.exp((180-360*(O.y+m)/u)*Math.PI/180))-90]}}switch(this.type){case 1:var A=[];for(o=0;o<v.length;o++)A[o]=v[o][0];S(v=A);break;case 2:for(o=0;o<v.length;o++)S(v[o]);break;case 3:for(v=function(P){var L=P.length;if(L<=1)return[P];for(var O,$,ee=[],se=0;se<L;se++){var ie=Gw(P[se]);ie!==0&&($===void 0&&($=ie<0),$===ie<0?(O&&ee.push(O),O=[P[se]]):O.push(P[se]))}return O&&ee.push(O),ee}(v),o=0;o<v.length;o++)for(l=0;l<v[o].length;l++)S(v[o][l])}v.length===1?v=v[0]:x="Multi"+x;var I={type:"Feature",geometry:{type:x,coordinates:v},properties:this.properties};return"id"in this&&(I.id=this.id),I};var wy=Ty;function Ty(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Zw,this,e),this.length=this._features.length}function Zw(i,e,t){i===15?e.version=t.readVarint():i===1?e.name=t.readString():i===5?e.extent=t.readVarint():i===2?e._features.push(t.pos):i===3?e._keys.push(t.readString()):i===4&&e._values.push(function(o){for(var l=null,u=o.readVarint()+o.pos;o.pos<u;){var f=o.readVarint()>>3;l=f===1?o.readString():f===2?o.readFloat():f===3?o.readDouble():f===4?o.readVarint64():f===5?o.readVarint():f===6?o.readSVarint():f===7?o.readBoolean():null}return l}(t))}function Ww(i,e,t){if(i===3){var o=new wy(t,t.readVarint()+t.pos);o.length&&(e[o.name]=o)}}Ty.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new by(this._pbf,e,this.extent,this._keys,this._values)};var Ha={VectorTile:function(i,e){this.layers=i.readFields(Ww,{},e)},VectorTileFeature:by,VectorTileLayer:wy};function Zd(i,e,t,o){const l=[],u=o===0?(f,m,v,x,S,A)=>{f.push(new U(A,v+(A-m)/(x-m)*(S-v)))}:(f,m,v,x,S,A)=>{f.push(new U(m+(A-v)/(S-v)*(x-m),A))};for(const f of i){const m=[];for(const v of f){if(v.length<=2)continue;const x=[];for(let I=0;I<v.length-1;I++){const P=v[I].x,L=v[I].y,O=v[I+1].x,$=v[I+1].y,ee=o===0?P:L,se=o===0?O:$;ee<e?se>e&&u(x,P,L,O,$,e):ee>t?se<t&&u(x,P,L,O,$,t):x.push(v[I]),se<e&&ee>=e&&u(x,P,L,O,$,e),se>t&&ee<=t&&u(x,P,L,O,$,t)}let S=v[v.length-1];const A=o===0?S.x:S.y;A>=e&&A<=t&&x.push(S),x.length&&(S=x[x.length-1],x[0].x===S.x&&x[0].y===S.y||x.push(x[0]),m.push(x))}m.length&&l.push(m)}return l}const Hw=Ha.VectorTileFeature.types,Xw=Math.pow(2,13);function ju(i,e,t,o,l,u,f,m){i.emplaceBack((e<<1)+f,(t<<1)+u,(Math.floor(o*Xw)<<1)+l,Math.round(m))}function qu(i,e,t){i.emplaceBack(e.x,e.y,e.z,t[0]*16384,t[1]*16384,t[2]*16384)}class Ey{constructor(){this.acc=new U(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new U(e.x,e.y),this.max=new U(e.x,e.y))}append(e,t){this.currentPolyCount.edges++,this.acc._add(e);const o=this.min,l=this.max;e.x<o.x?o.x=e.x:e.x>l.x&&(l.x=e.x),e.y<o.y?o.y=e.y:e.y>l.y&&(l.y=e.y),((e.x===0||e.x===ei)&&e.x===t.x)!=((e.y===0||e.y===ei)&&e.y===t.y)&&this.processBorderOverlap(e,t),t.x<0!=e.x<0&&this.addBorderIntersection(0,Ai(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>ei!=e.x>ei&&this.addBorderIntersection(1,Ai(t.y,e.y,(ei-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,Ai(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>ei!=e.y>ei&&this.addBorderIntersection(3,Ai(t.x,e.x,(ei-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const o=this.borders[e];t<o[0]&&(o[0]=t),t>o[1]&&(o[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const o=e.x===0?0:1;this.addBorderIntersection(o,t.y),this.addBorderIntersection(o,e.y)}else{const o=e.y===0?2:3;this.addBorderIntersection(o,t.x),this.addBorderIntersection(o,e.x)}}centroid(){const e=this.polyCount.reduce((t,o)=>t+o.edges,0);return e!==0?this.acc.div(e)._round():new U(0,0)}span(){return new U(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,t)=>e+ +(t[0]!==Number.MAX_VALUE),0)}}class $u{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new Wt,this.centroidVertexArray=new Lg,this.indexArray=new _i,this.programConfigurations=new ja(e.layers,e.zoom),this.segments=new An,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.enableTerrain=e.enableTerrain}populate(e,t,o,l){this.features=[],this.hasPattern=fm("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(u){const f=Math.exp(Math.PI*(1-u.y/(1<<u.z)*2));return 80150034*f/(f*f+1)/ei/(1<<u.z)}(o),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:u,id:f,index:m,sourceLayerIndex:v}of e){const x=this.layers[0]._featureFilter.needGeometry,S=qa(u,x);if(!this.layers[0]._featureFilter.filter(new W(this.zoom),S,o))continue;const A={id:f,sourceLayerIndex:v,index:m,geometry:x?S.geometry:as(u,o,l),properties:u.properties,type:u.type,patterns:{}},I=this.layoutVertexArray.length;this.hasPattern?this.features.push(pm("fill-extrusion",this.layers,A,this.zoom,t)):this.addFeature(A,A.geometry,m,o,{},t.availableImages,l),t.featureIndex.insert(u,A.geometry,m,v,this.index,I)}this.sortBorders()}addFeatures(e,t,o,l,u){for(const f of this.features){const{geometry:m}=f;this.addFeature(f,m,f.index,t,o,l,u)}this.sortBorders()}update(e,t,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,o,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,qw),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,jw.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Nw.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,o,l,u,f,m){const v=[new U(0,0),new U(ei,ei)],x=m.projection,S=x.name==="globe",A=this.enableTerrain&&!S?new Ey:null,I=Hw[e.type]==="Polygon";S&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Qn);const P=dm(t,500);for(let ee=P.length-1;ee>=0;ee--){const se=P[ee];(se.length===0||(L=se[0]).every(ie=>ie.x<=0)||L.every(ie=>ie.x>=ei)||L.every(ie=>ie.y<=0)||L.every(ie=>ie.y>=ei))&&P.splice(ee,1)}var L;let O;if(S)O=zy(P,v,l);else{O=[];for(const ee of P)O.push({polygon:ee,bounds:v})}const $=I?this.edgeRadius:0;for(const{polygon:ee,bounds:se}of O){let ie=0,re=0;for(const ae of ee)I&&!ae[0].equals(ae[ae.length-1])&&ae.push(ae[0]),re+=I?ae.length-1:ae.length;const pe=this.segments.prepareSegment((I?5:4)*re,this.layoutVertexArray,this.indexArray);if(I){const ae=[],Oe=[];ie=pe.vertexLength;for(const We of ee){let yt,Ne;We.length&&We!==ee[0]&&Oe.push(ae.length/2),yt=We[1].sub(We[0])._perp()._unit();for(let et=1;et<We.length;et++){const at=We[et],tt=We[et===We.length-1?1:et+1];let{x:ft,y:lt}=at;if($){Ne=tt.sub(at)._perp()._unit();const kt=yt.add(Ne)._unit(),li=$*Math.min(4,1/(yt.x*kt.x+yt.y*kt.y));ft+=li*kt.x,lt+=li*kt.y,yt=Ne}ju(this.layoutVertexArray,ft,lt,0,0,1,1,0),pe.vertexLength++,ae.push(at.x,at.y),S&&qu(this.layoutVertexExtArray,x.projectTilePoint(ft,lt,l),x.upVector(l,ft,lt))}}const Re=Ud(ae,Oe);for(let We=0;We<Re.length;We+=3)this.indexArray.emplaceBack(ie+Re[We],ie+Re[We+2],ie+Re[We+1]),pe.primitiveLength++}for(const ae of ee){A&&ae.length&&A.startRing(ae[0]);let Oe,Re,We,yt=ae.length>4&&My(ae[ae.length-2],ae[0],ae[1]),Ne=$?Kw(ae[ae.length-2],ae[0],ae[1],$):0;Re=ae[1].sub(ae[0])._perp()._unit();for(let et=1,at=0;et<ae.length;et++){let tt=ae[et-1],ft=ae[et];const lt=ae[et===ae.length-1?1:et+1];if(A&&I&&A.currentPolyCount.top++,Ay(ft,tt,se)){$&&(Re=lt.sub(ft)._perp()._unit());continue}A&&A.append(ft,tt);const kt=ft.sub(tt)._perp(),li=kt.x/(Math.abs(kt.x)+Math.abs(kt.y)),hi=kt.y>0?1:0,Gt=tt.dist(ft);if(at+Gt>32768&&(at=0),$){We=lt.sub(ft)._perp()._unit();let Dt=Cy(tt,ft,lt,Sy(Re,We),$);isNaN(Dt)&&(Dt=0);const Yi=ft.sub(tt)._unit();tt=tt.add(Yi.mult(Ne))._round(),ft=ft.add(Yi.mult(-Dt))._round(),Ne=Dt,Re=We}const Tt=pe.vertexLength,bi=ae.length>4&&My(tt,ft,lt);let oi=Iy(at,yt,!0);if(ju(this.layoutVertexArray,tt.x,tt.y,li,hi,0,0,oi),ju(this.layoutVertexArray,tt.x,tt.y,li,hi,0,1,oi),at+=Gt,oi=Iy(at,bi,!1),yt=bi,ju(this.layoutVertexArray,ft.x,ft.y,li,hi,0,0,oi),ju(this.layoutVertexArray,ft.x,ft.y,li,hi,0,1,oi),pe.vertexLength+=4,this.indexArray.emplaceBack(Tt+0,Tt+1,Tt+2),this.indexArray.emplaceBack(Tt+1,Tt+3,Tt+2),pe.primitiveLength+=2,$){const Dt=ie+(et===1?ae.length-2:et-2),Yi=et===1?ie:Dt+1;if(this.indexArray.emplaceBack(Tt+1,Dt,Tt+3),this.indexArray.emplaceBack(Dt,Yi,Tt+3),pe.primitiveLength+=2,Oe===void 0&&(Oe=Tt),!Ay(lt,ae[et],se)){const Gi=et===ae.length-1?Oe:pe.vertexLength;this.indexArray.emplaceBack(Tt+2,Tt+3,Gi),this.indexArray.emplaceBack(Tt+3,Gi+1,Gi),this.indexArray.emplaceBack(Tt+3,Yi,Gi+1),pe.primitiveLength+=3}}if(S){const Dt=this.layoutVertexExtArray,Yi=x.projectTilePoint(tt.x,tt.y,l),Gi=x.projectTilePoint(ft.x,ft.y,l),rn=x.upVector(l,tt.x,tt.y),fi=x.upVector(l,ft.x,ft.y);qu(Dt,Yi,rn),qu(Dt,Yi,rn),qu(Dt,Gi,fi),qu(Dt,Gi,fi)}}I&&(ie+=ae.length-1)}}if(A&&A.polyCount.length>0){if(A.borders){A.vertexArrayOffset=this.centroidVertexArray.length;const ee=A.borders,se=this.featuresOnBorder.push(A)-1;for(let ie=0;ie<4;ie++)ee[ie][0]!==Number.MAX_VALUE&&this.borders[ie].push(se)}this.encodeCentroid(A.borders?void 0:A.centroid(),A)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,u,f,l)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((t,o)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[o].borders[e][0])}encodeCentroid(e,t,o=!0){let l,u;if(e)if(e.y!==0){const m=t.span()._mult(this.tileToMeter);l=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(m.x/10)),u=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(m.y/10))}else l=Math.ceil(7*(e.x+450)),u=0;else l=0,u=+o;let f=o?this.centroidVertexArray.length:t.vertexArrayOffset;for(const m of t.polyCount){o&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*m.edges+m.top);for(let v=0;v<m.top;v++)this.centroidVertexArray.emplace(f++,l,u);for(let v=0;v<2*m.edges;v++)this.centroidVertexArray.emplace(f++,0,u),this.centroidVertexArray.emplace(f++,l,u)}}}function Sy(i,e){const t=i.add(e)._unit();return i.x*t.x+i.y*t.y}function Kw(i,e,t,o){const l=e.sub(i)._perp()._unit(),u=t.sub(e)._perp()._unit();return Cy(i,e,t,Sy(l,u),o)}function Cy(i,e,t,o,l){const u=Math.sqrt(1-o*o);return Math.min(i.dist(e)/3,e.dist(t)/3,l*u/o)}function Ay(i,e,t){return i.x<t[0].x&&e.x<t[0].x||i.x>t[1].x&&e.x>t[1].x||i.y<t[0].y&&e.y<t[0].y||i.y>t[1].y&&e.y>t[1].y}function My(i,e,t){if(i.x<0||i.x>=ei||e.x<0||e.x>=ei||t.x<0||t.x>=ei)return!1;const o=t.sub(e),l=o.perp(),u=i.sub(e);return(o.x*u.x+o.y*u.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(u.x*u.x+u.y*u.y))>-.866&&l.x*u.x+l.y*u.y<0}function Iy(i,e,t){const o=e?2|i:-3&i;return t?1|o:-2&o}function ky(){const i=Math.PI/32,e=Math.tan(i),t=qp;return t*Math.sqrt(1+2*e*e)-t}function zy(i,e,t){const o=1<<t.z,l=Zr(t.x/o),u=Zr((t.x+1)/o),f=Wn(t.y/o),m=Wn((t.y+1)/o);return function(v,x,S,A,I=0,P){const L=[];if(!v.length||!S||!A)return L;const O=(ae,Oe)=>{for(const Re of ae)L.push({polygon:Re,bounds:Oe})},$=Math.ceil(Math.log2(S)),ee=Math.ceil(Math.log2(A)),se=$-ee,ie=[];for(let ae=0;ae<Math.abs(se);ae++)ie.push(se>0?0:1);for(let ae=0;ae<Math.min($,ee);ae++)ie.push(0),ie.push(1);let re=v;if(re=Zd(re,x[0].y-I,x[1].y+I,1),re=Zd(re,x[0].x-I,x[1].x+I,0),!re.length)return L;const pe=[];for(ie.length?pe.push({polygons:re,bounds:x,depth:0}):O(re,x);pe.length;){const ae=pe.pop(),Oe=ae.depth,Re=ie[Oe],We=ae.bounds[0],yt=ae.bounds[1],Ne=Re===0?We.x:We.y,et=Re===0?yt.x:yt.y,at=P?P(Re,Ne,et):.5*(Ne+et),tt=Zd(ae.polygons,Ne-I,at+I,Re),ft=Zd(ae.polygons,at-I,et+I,Re);if(tt.length){const lt=[We,new U(Re===0?at:yt.x,Re===1?at:yt.y)];ie.length>Oe+1?pe.push({polygons:tt,bounds:lt,depth:Oe+1}):O(tt,lt)}if(ft.length){const lt=[new U(Re===0?at:We.x,Re===1?at:We.y),yt];ie.length>Oe+1?pe.push({polygons:ft,bounds:lt,depth:Oe+1}):O(ft,lt)}}return L}(i,e,Math.ceil((u-l)/11.25),Math.ceil((f-m)/11.25),1,(v,x,S)=>{if(v===0)return .5*(x+S);{const A=Wn((t.y+x/ei)/o);return(ss(.5*(Wn((t.y+S/ei)/o)+A))*o-t.y)*ei}})}Bt($u,"FillExtrusionBucket",{omit:["layers","features"]}),Bt(Ey,"PartMetadata");const Yw=new Je({"fill-extrusion-edge-radius":new le(Ce["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Jw={paint:new Je({"fill-extrusion-opacity":new le(Ce["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ye(Ce["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new le(Ce["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new le(Ce["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Le(Ce["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ye(Ce["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ye(Ce["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new le(Ce["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new le(Ce["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new le(Ce["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:Yw};function Py(i,e,t){var o=2*Math.PI*6378137/256/Math.pow(2,t);return[i*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class Wd{constructor(e,t,o){this.z=e,this.x=t,this.y=o,this.key=Gu(0,e,e,t,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){const o=function(u,f,m){var v=Py(256*u,256*(f=Math.pow(2,m)-f-1),m),x=Py(256*(u+1),256*(f+1),m);return v[0]+","+v[1]+","+x[0]+","+x[1]}(this.x,this.y,this.z),l=function(u,f,m){let v,x="";for(let S=u;S>0;S--)v=1<<S-1,x+=(f&v?1:0)+(m&v?2:0);return x}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(t==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Dy{constructor(e,t){this.wrap=e,this.canonical=t,this.key=Gu(e,t.z,t.z,t.x,t.y)}}class cr{constructor(e,t,o,l,u){this.overscaledZ=e,this.wrap=t,this.canonical=new Wd(o,+l,+u),this.key=t===0&&e===o?this.canonical.key:Gu(t,e,o,l,u)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new cr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new cr(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t=!0){if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return Gu(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const o=this.canonical.z-e;return Gu(this.wrap*+t,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new cr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,o=2*this.canonical.x,l=2*this.canonical.y;return[new cr(t,this.wrap,t,o,l),new cr(t,this.wrap,t,o+1,l),new cr(t,this.wrap,t,o,l+1),new cr(t,this.wrap,t,o+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new cr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new cr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Dy(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Gu(i,e,t,o,l){const u=1<<Math.min(t,22);let f=u*(l%u)+o%u;return i&&t<22&&(f+=u*u*((i<0?-2*i-1:2*i)%(1<<2*(22-t)))),16*(32*f+t)+(e-t)}function Zu(i,e){return i.x*e.x+i.y*e.y}function Ly(i,e){if(i.length===1){let t=0;const o=e[t++];let l;for(;!l||o.equals(l);)if(l=e[t++],!l)return 1/0;for(;t<e.length;t++){const u=e[t],f=i[0],m=l.sub(o),v=u.sub(o),x=f.sub(o),S=Zu(m,m),A=Zu(m,v),I=Zu(v,v),P=Zu(x,m),L=Zu(x,v),O=S*I-A*A,$=(I*P-A*L)/O,ee=(S*L-A*P)/O,se=o.z*(1-$-ee)+l.z*$+u.z*ee;if(isFinite(se))return se}return 1/0}{let t=1/0;for(const o of e)t=Math.min(t,o.z);return t}}function Hd(i){const e=new U(i[0],i[1]);return e.z=i[2],e}function By(i,e,t,o,l,u,f,m){const v=f*l.getElevationAt(i,e,!0,!0),x=u[0]!==0,S=x?u[1]===0?f*(u[0]/7-450):f*function(A,I,P){const L=Math.floor(I[0]/8),O=Math.floor(I[1]/8),$=10*(I[0]-8*L),ee=10*(I[1]-8*O),se=A.getElevationAt(L,O,!0,!0),ie=A.getMeterToDEM(P),re=Math.floor(.5*($*ie-1)),pe=Math.floor(.5*(ee*ie-1)),ae=A.tileCoordToPixel(L,O),Oe=2*re+1,Re=2*pe+1,We=function(ft,lt,kt,li,hi){return[ft.getElevationAtPixel(lt,kt,!0),ft.getElevationAtPixel(lt+hi,kt,!0),ft.getElevationAtPixel(lt,kt+hi,!0),ft.getElevationAtPixel(lt+li,kt+hi,!0)]}(A,ae.x-re,ae.y-pe,Oe,Re),yt=Math.abs(We[0]-We[1]),Ne=Math.abs(We[2]-We[3]),et=Math.abs(We[0]-We[2])+Math.abs(We[1]-We[3]),at=Math.min(.25,.5*ie*(yt+Ne)/Oe),tt=Math.min(.25,.5*ie*et/Re);return se+Math.max(at*$,tt*ee)}(l,u,m):v;return{base:v+(t===0)?-1:t,top:x?Math.max(S+o,v+t+2):v+o}}Bt(Wd,"CanonicalTileID"),Bt(cr,"OverscaledTileID",{omit:["projMatrix"]});const Qw=it([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:eT}=Qw,tT=it([{name:"a_packed",components:4,type:"Float32"}]),{members:iT}=tT,nT=Ha.VectorTileFeature.types,rT=Math.cos(Math.PI/180*37.5);class Xd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(t=>{this.gradients[t.id]={}}),this.layoutVertexArray=new ii,this.layoutVertexArray2=new xi,this.indexArray=new _i,this.programConfigurations=new ja(e.layers,e.zoom),this.segments=new An,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(e,t,o,l){this.hasPattern=fm("line",this.layers,t);const u=this.layers[0].layout.get("line-sort-key"),f=[];for(const{feature:S,id:A,index:I,sourceLayerIndex:P}of e){const L=this.layers[0]._featureFilter.needGeometry,O=qa(S,L);if(!this.layers[0]._featureFilter.filter(new W(this.zoom),O,o))continue;const $=u?u.evaluate(O,{},o):void 0,ee={id:A,properties:S.properties,type:S.type,sourceLayerIndex:P,index:I,geometry:L?O.geometry:as(S,o,l),patterns:{},sortKey:$};f.push(ee)}u&&f.sort((S,A)=>S.sortKey-A.sortKey);const{lineAtlas:m,featureIndex:v}=t,x=this.addConstantDashes(m);for(const S of f){const{geometry:A,index:I,sourceLayerIndex:P}=S;if(x&&this.addFeatureDashes(S,m),this.hasPattern){const L=pm("line",this.layers,S,this.zoom,t);this.patternFeatures.push(L)}else this.addFeature(S,A,I,o,m.positions,t.availableImages);v.insert(e[I].feature,A,I,P,this.index)}}addConstantDashes(e){let t=!1;for(const o of this.layers){const l=o.paint.get("line-dasharray").value,u=o.layout.get("line-cap").value;if(l.kind!=="constant"||u.kind!=="constant")t=!0;else{const f=u.value,m=l.value;if(!m)continue;e.addDash(m.from,f),e.addDash(m.to,f),m.other&&e.addDash(m.other,f)}}return t}addFeatureDashes(e,t){const o=this.zoom;for(const l of this.layers){const u=l.paint.get("line-dasharray").value,f=l.layout.get("line-cap").value;if(u.kind==="constant"&&f.kind==="constant")continue;let m,v,x,S,A,I;if(u.kind==="constant"){const $=u.value;if(!$)continue;m=$.other||$.to,v=$.to,x=$.from}else m=u.evaluate({zoom:o-1},e),v=u.evaluate({zoom:o},e),x=u.evaluate({zoom:o+1},e);f.kind==="constant"?S=A=I=f.value:(S=f.evaluate({zoom:o-1},e),A=f.evaluate({zoom:o},e),I=f.evaluate({zoom:o+1},e)),t.addDash(m,S),t.addDash(v,A),t.addDash(x,I);const P=t.getKey(m,S),L=t.getKey(v,A),O=t.getKey(x,I);e.patterns[l.id]={min:P,mid:L,max:O}}}update(e,t,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,o,l)}addFeatures(e,t,o,l,u){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,t,o,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,iT)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,eT),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,o,l,u,f){const m=this.layers[0].layout,v=m.get("line-join").evaluate(e,{}),x=m.get("line-cap").evaluate(e,{}),S=m.get("line-miter-limit"),A=m.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const I of t)this.addLine(I,e,v,x,S,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,u,f,l)}addLine(e,t,o,l,u,f){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ee=0;ee<e.length-1;ee++)this.totalDistance+=e[ee].dist(e[ee+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const m=nT[t.type]==="Polygon";let v=e.length;for(;v>=2&&e[v-1].equals(e[v-2]);)v--;let x=0;for(;x<v-1&&e[x].equals(e[x+1]);)x++;if(v<(m?3:2))return;o==="bevel"&&(u=1.05);const S=this.overscaling<=16?122880/(512*this.overscaling):0,A=this.segments.prepareSegment(10*v,this.layoutVertexArray,this.indexArray);let I,P,L,O,$;this.e1=this.e2=-1,m&&(I=e[v-2],$=e[x].sub(I)._unit()._perp());for(let ee=x;ee<v;ee++){if(L=ee===v-1?m?e[x+1]:void 0:e[ee+1],L&&e[ee].equals(L))continue;$&&(O=$),I&&(P=I),I=e[ee],$=L?L.sub(I)._unit()._perp():O,O=O||$;let se=O.add($);se.x===0&&se.y===0||se._unit();const ie=O.x*$.x+O.y*$.y,re=se.x*$.x+se.y*$.y,pe=re!==0?1/re:1/0,ae=2*Math.sqrt(2-2*re),Oe=re<rT&&P&&L,Re=O.x*$.y-O.y*$.x>0;if(Oe&&ee>x){const Ne=I.dist(P);if(Ne>2*S){const et=I.sub(I.sub(P)._mult(S/Ne)._round());this.updateDistance(P,et),this.addCurrentVertex(et,O,0,0,A),P=et}}const We=P&&L;let yt=We?o:m?"butt":l;if(We&&yt==="round"&&(pe<f?yt="miter":pe<=2&&(yt="fakeround")),yt==="miter"&&pe>u&&(yt="bevel"),yt==="bevel"&&(pe>2&&(yt="flipbevel"),pe<u&&(yt="miter")),P&&this.updateDistance(P,I),yt==="miter")se._mult(pe),this.addCurrentVertex(I,se,0,0,A);else if(yt==="flipbevel"){if(pe>100)se=$.mult(-1);else{const Ne=pe*O.add($).mag()/O.sub($).mag();se._perp()._mult(Ne*(Re?-1:1))}this.addCurrentVertex(I,se,0,0,A),this.addCurrentVertex(I,se.mult(-1),0,0,A)}else if(yt==="bevel"||yt==="fakeround"){const Ne=-Math.sqrt(pe*pe-1),et=Re?Ne:0,at=Re?0:Ne;if(P&&this.addCurrentVertex(I,O,et,at,A),yt==="fakeround"){const tt=Math.round(180*ae/Math.PI/20);for(let ft=1;ft<tt;ft++){let lt=ft/tt;if(lt!==.5){const li=lt-.5;lt+=lt*li*(lt-1)*((1.0904+ie*(ie*(3.55645-1.43519*ie)-3.2452))*li*li+(.848013+ie*(.215638*ie-1.06021)))}const kt=$.sub(O)._mult(lt)._add(O)._unit()._mult(Re?-1:1);this.addHalfVertex(I,kt.x,kt.y,!1,Re,0,A)}}L&&this.addCurrentVertex(I,$,-et,-at,A)}else if(yt==="butt")this.addCurrentVertex(I,se,0,0,A);else if(yt==="square"){const Ne=P?1:-1;P||this.addCurrentVertex(I,se,Ne,Ne,A),this.addCurrentVertex(I,se,0,0,A),P&&this.addCurrentVertex(I,se,Ne,Ne,A)}else yt==="round"&&(P&&(this.addCurrentVertex(I,O,0,0,A),this.addCurrentVertex(I,O,1,1,A,!0)),L&&(this.addCurrentVertex(I,$,-1,-1,A,!0),this.addCurrentVertex(I,$,0,0,A)));if(Oe&&ee<v-1){const Ne=I.dist(L);if(Ne>2*S){const et=I.add(L.sub(I)._mult(S/Ne)._round());this.updateDistance(I,et),this.addCurrentVertex(et,$,0,0,A),I=et}}}}addCurrentVertex(e,t,o,l,u,f=!1){const m=t.y*l-t.x,v=-t.y-t.x*l;this.addHalfVertex(e,t.x+t.y*o,t.y-t.x*o,f,!1,o,u),this.addHalfVertex(e,m,v,f,!0,-l,u)}addHalfVertex({x:e,y:t},o,l,u,f,m,v){this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(t<<1)+(f?1:0),Math.round(63*o)+128,Math.round(63*l)+128,1+(m===0?0:m<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const x=v.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,x),v.primitiveLength++),f?this.e2=x:this.e1=x}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}Bt(Xd,"LineBucket",{omit:["layers","patternFeatures"]});const oT=new Je({"line-cap":new ye(Ce.layout_line["line-cap"]),"line-join":new ye(Ce.layout_line["line-join"]),"line-miter-limit":new le(Ce.layout_line["line-miter-limit"]),"line-round-limit":new le(Ce.layout_line["line-round-limit"]),"line-sort-key":new ye(Ce.layout_line["line-sort-key"])});var Ry={paint:new Je({"line-opacity":new ye(Ce.paint_line["line-opacity"]),"line-color":new ye(Ce.paint_line["line-color"]),"line-translate":new le(Ce.paint_line["line-translate"]),"line-translate-anchor":new le(Ce.paint_line["line-translate-anchor"]),"line-width":new ye(Ce.paint_line["line-width"]),"line-gap-width":new ye(Ce.paint_line["line-gap-width"]),"line-offset":new ye(Ce.paint_line["line-offset"]),"line-blur":new ye(Ce.paint_line["line-blur"]),"line-dasharray":new Le(Ce.paint_line["line-dasharray"]),"line-pattern":new Le(Ce.paint_line["line-pattern"]),"line-gradient":new Ae(Ce.paint_line["line-gradient"]),"line-trim-offset":new le(Ce.paint_line["line-trim-offset"])}),layout:oT};const Fy=new class extends ye{possiblyEvaluate(i,e){return e=new W(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,t,o){return e=Ve({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,t,o)}}(Ry.paint.properties["line-width"].specification);function Oy(i,e){return e>0?e+2*i:i}Fy.useIntegerZoom=!0;const sT=it([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),aT=it([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),lT=it([{name:"a_projected_pos",components:4,type:"Float32"}],4);it([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const cT=it([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),uT=it([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);it([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Vy=it([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),hT=it([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);it([{name:"triangle",components:3,type:"Uint16"}]),it([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),it([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),it([{type:"Float32",name:"offsetX"}]),it([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Hn=24;const Lo=128;function mm(i,e){const{expression:t}=e;if(t.kind==="constant")return{kind:"constant",layoutSize:t.evaluate(new W(i+1))};if(t.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:l}=t;let u=0;for(;u<o.length&&o[u]<=i;)u++;u=Math.max(0,u-1);let f=u;for(;f<o.length&&o[f]<i+1;)f++;f=Math.min(o.length-1,f);const m=o[u],v=o[f];return t.kind==="composite"?{kind:"composite",minZoom:m,maxZoom:v,interpolationType:l}:{kind:"camera",minZoom:m,maxZoom:v,minSize:t.evaluate(new W(m)),maxSize:t.evaluate(new W(v)),interpolationType:l}}}function Kd(i,{uSize:e,uSizeT:t},{lowerSize:o,upperSize:l}){return i.kind==="source"?o/Lo:i.kind==="composite"?Ai(o/Lo,l/Lo,t):e}function ic(i,e){let t=0,o=0;if(i.kind==="constant")o=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:l,minZoom:u,maxZoom:f}=i,m=l?Se($r.interpolationFactor(l,e,u,f),0,1):0;i.kind==="camera"?o=Ai(i.minSize,i.maxSize,m):t=m}return{uSizeT:t,uSize:o}}var dT=Object.freeze({__proto__:null,getSizeData:mm,evaluateSizeForFeature:Kd,evaluateSizeForZoom:ic,SIZE_PACK_FACTOR:Lo});function fT(i,e,t){return i.sections.forEach(o=>{o.text=function(l,u,f){const m=u.layout.get("text-transform").evaluate(f,{});return m==="uppercase"?l=l.toLocaleUpperCase():m==="lowercase"&&(l=l.toLocaleLowerCase()),Z.applyArabicShaping&&(l=Z.applyArabicShaping(l)),l}(o.text,e,t)}),i}const Wu={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function pT(i){return i==="\uFE36"||i==="\uFE48"||i==="\uFE38"||i==="\uFE44"||i==="\uFE42"||i==="\uFE3E"||i==="\uFE3C"||i==="\uFE3A"||i==="\uFE18"||i==="\uFE40"||i==="\uFE10"||i==="\uFE13"||i==="\uFE14"||i==="\uFF40"||i==="\uFFE3"||i==="\uFE11"||i==="\uFE12"}function mT(i){return i==="\uFE35"||i==="\uFE47"||i==="\uFE37"||i==="\uFE43"||i==="\uFE41"||i==="\uFE3D"||i==="\uFE3B"||i==="\uFE39"||i==="\uFE17"||i==="\uFE3F"}var Uy=function(i,e,t,o,l){var u,f,m=8*l-o-1,v=(1<<m)-1,x=v>>1,S=-7,A=t?l-1:0,I=t?-1:1,P=i[e+A];for(A+=I,u=P&(1<<-S)-1,P>>=-S,S+=m;S>0;u=256*u+i[e+A],A+=I,S-=8);for(f=u&(1<<-S)-1,u>>=-S,S+=o;S>0;f=256*f+i[e+A],A+=I,S-=8);if(u===0)u=1-x;else{if(u===v)return f?NaN:1/0*(P?-1:1);f+=Math.pow(2,o),u-=x}return(P?-1:1)*f*Math.pow(2,u-o)},Ny=function(i,e,t,o,l,u){var f,m,v,x=8*u-l-1,S=(1<<x)-1,A=S>>1,I=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,P=o?0:u-1,L=o?1:-1,O=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(m=isNaN(e)?1:0,f=S):(f=Math.floor(Math.log(e)/Math.LN2),e*(v=Math.pow(2,-f))<1&&(f--,v*=2),(e+=f+A>=1?I/v:I*Math.pow(2,1-A))*v>=2&&(f++,v/=2),f+A>=S?(m=0,f=S):f+A>=1?(m=(e*v-1)*Math.pow(2,l),f+=A):(m=e*Math.pow(2,A-1)*Math.pow(2,l),f=0));l>=8;i[t+P]=255&m,P+=L,m/=256,l-=8);for(f=f<<l|m,x+=l;x>0;i[t+P]=255&f,P+=L,f/=256,x-=8);i[t+P-L]|=128*O},Hu=Ki;function Ki(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Ki.Varint=0,Ki.Fixed64=1,Ki.Bytes=2,Ki.Fixed32=5;var _m=4294967296,jy=1/_m,qy=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function cs(i){return i.type===Ki.Bytes?i.readVarint()+i.pos:i.pos+1}function nc(i,e,t){return t?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function $y(i,e,t){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));t.realloc(o);for(var l=t.pos-1;l>=i;l--)t.buf[l+o]=t.buf[l]}function _T(i,e){for(var t=0;t<i.length;t++)e.writeVarint(i[t])}function gT(i,e){for(var t=0;t<i.length;t++)e.writeSVarint(i[t])}function yT(i,e){for(var t=0;t<i.length;t++)e.writeFloat(i[t])}function vT(i,e){for(var t=0;t<i.length;t++)e.writeDouble(i[t])}function xT(i,e){for(var t=0;t<i.length;t++)e.writeBoolean(i[t])}function bT(i,e){for(var t=0;t<i.length;t++)e.writeFixed32(i[t])}function wT(i,e){for(var t=0;t<i.length;t++)e.writeSFixed32(i[t])}function TT(i,e){for(var t=0;t<i.length;t++)e.writeFixed64(i[t])}function ET(i,e){for(var t=0;t<i.length;t++)e.writeSFixed64(i[t])}function Yd(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function rc(i,e,t){i[t]=e,i[t+1]=e>>>8,i[t+2]=e>>>16,i[t+3]=e>>>24}function Gy(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function ST(i,e,t){e.glyphs=[],i===1&&t.readMessage(CT,e)}function CT(i,e,t){if(i===3){const{id:o,bitmap:l,width:u,height:f,left:m,top:v,advance:x}=t.readMessage(AT,{});e.glyphs.push({id:o,bitmap:new ls({width:u+6,height:f+6},l),metrics:{width:u,height:f,left:m,top:v,advance:x}})}else i===4?e.ascender=t.readSVarint():i===5&&(e.descender=t.readSVarint())}function AT(i,e,t){i===1?e.id=t.readVarint():i===2?e.bitmap=t.readBytes():i===3?e.width=t.readVarint():i===4?e.height=t.readVarint():i===5?e.left=t.readSVarint():i===6?e.top=t.readSVarint():i===7&&(e.advance=t.readVarint())}function gm(i){let e=0,t=0;for(const f of i)e+=f.w*f.h,t=Math.max(t,f.w);i.sort((f,m)=>m.h-f.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),t),h:1/0}];let l=0,u=0;for(const f of i)for(let m=o.length-1;m>=0;m--){const v=o[m];if(!(f.w>v.w||f.h>v.h)){if(f.x=v.x,f.y=v.y,u=Math.max(u,f.y+f.h),l=Math.max(l,f.x+f.w),f.w===v.w&&f.h===v.h){const x=o.pop();m<o.length&&(o[m]=x)}else f.h===v.h?(v.x+=f.w,v.w-=f.w):f.w===v.w?(v.y+=f.h,v.h-=f.h):(o.push({x:v.x+f.w,y:v.y,w:v.w-f.w,h:f.h}),v.y+=f.h,v.h-=f.h);break}}return{w:l,h:u,fill:e/(l*u)||0}}Ki.prototype={destroy:function(){this.buf=null},readFields:function(i,e,t){for(t=t||this.length;this.pos<t;){var o=this.readVarint(),l=o>>3,u=this.pos;this.type=7&o,i(l,e,this),this.pos===u&&this.skip(o)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=Yd(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Gy(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Yd(this.buf,this.pos)+Yd(this.buf,this.pos+4)*_m;return this.pos+=8,i},readSFixed64:function(){var i=Yd(this.buf,this.pos)+Gy(this.buf,this.pos+4)*_m;return this.pos+=8,i},readFloat:function(){var i=Uy(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Uy(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,t,o=this.buf;return e=127&(t=o[this.pos++]),t<128?e:(e|=(127&(t=o[this.pos++]))<<7,t<128?e:(e|=(127&(t=o[this.pos++]))<<14,t<128?e:(e|=(127&(t=o[this.pos++]))<<21,t<128?e:function(l,u,f){var m,v,x=f.buf;if(m=(112&(v=x[f.pos++]))>>4,v<128||(m|=(127&(v=x[f.pos++]))<<3,v<128)||(m|=(127&(v=x[f.pos++]))<<10,v<128)||(m|=(127&(v=x[f.pos++]))<<17,v<128)||(m|=(127&(v=x[f.pos++]))<<24,v<128)||(m|=(1&(v=x[f.pos++]))<<31,v<128))return nc(l,m,u);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(t=o[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&qy?function(t,o,l){return qy.decode(t.subarray(o,l))}(this.buf,e,i):function(t,o,l){for(var u="",f=o;f<l;){var m,v,x,S=t[f],A=null,I=S>239?4:S>223?3:S>191?2:1;if(f+I>l)break;I===1?S<128&&(A=S):I===2?(192&(m=t[f+1]))==128&&(A=(31&S)<<6|63&m)<=127&&(A=null):I===3?(v=t[f+2],(192&(m=t[f+1]))==128&&(192&v)==128&&((A=(15&S)<<12|(63&m)<<6|63&v)<=2047||A>=55296&&A<=57343)&&(A=null)):I===4&&(v=t[f+2],x=t[f+3],(192&(m=t[f+1]))==128&&(192&v)==128&&(192&x)==128&&((A=(15&S)<<18|(63&m)<<12|(63&v)<<6|63&x)<=65535||A>=1114112)&&(A=null)),A===null?(A=65533,I=1):A>65535&&(A-=65536,u+=String.fromCharCode(A>>>10&1023|55296),A=56320|1023&A),u+=String.fromCharCode(A),f+=I}return u}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Ki.Bytes)return i.push(this.readVarint(e));var t=cs(this);for(i=i||[];this.pos<t;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Ki.Bytes)return i.push(this.readSVarint());var e=cs(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Ki.Bytes)return i.push(this.readBoolean());var e=cs(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Ki.Bytes)return i.push(this.readFloat());var e=cs(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Ki.Bytes)return i.push(this.readDouble());var e=cs(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Ki.Bytes)return i.push(this.readFixed32());var e=cs(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Ki.Bytes)return i.push(this.readSFixed32());var e=cs(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Ki.Bytes)return i.push(this.readFixed64());var e=cs(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Ki.Bytes)return i.push(this.readSFixed64());var e=cs(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Ki.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ki.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ki.Fixed32)this.pos+=4;else{if(e!==Ki.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var t=new Uint8Array(e);t.set(this.buf),this.buf=t,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),rc(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),rc(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),rc(this.buf,-1&i,this.pos),rc(this.buf,Math.floor(i*jy),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),rc(this.buf,-1&i,this.pos),rc(this.buf,Math.floor(i*jy),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,t){var o,l;if(e>=0?(o=e%4294967296|0,l=e/4294967296|0):(l=~(-e/4294967296),4294967295^(o=~(-e%4294967296))?o=o+1|0:(o=0,l=l+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(u,f,m){m.buf[m.pos++]=127&u|128,u>>>=7,m.buf[m.pos++]=127&u|128,u>>>=7,m.buf[m.pos++]=127&u|128,u>>>=7,m.buf[m.pos++]=127&u|128,m.buf[m.pos]=127&(u>>>=7)}(o,0,t),function(u,f){var m=(7&u)<<4;f.buf[f.pos++]|=m|((u>>>=3)?128:0),u&&(f.buf[f.pos++]=127&u|((u>>>=7)?128:0),u&&(f.buf[f.pos++]=127&u|((u>>>=7)?128:0),u&&(f.buf[f.pos++]=127&u|((u>>>=7)?128:0),u&&(f.buf[f.pos++]=127&u|((u>>>=7)?128:0),u&&(f.buf[f.pos++]=127&u)))))}(l,t)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(o,l,u){for(var f,m,v=0;v<l.length;v++){if((f=l.charCodeAt(v))>55295&&f<57344){if(!m){f>56319||v+1===l.length?(o[u++]=239,o[u++]=191,o[u++]=189):m=f;continue}if(f<56320){o[u++]=239,o[u++]=191,o[u++]=189,m=f;continue}f=m-55296<<10|f-56320|65536,m=null}else m&&(o[u++]=239,o[u++]=191,o[u++]=189,m=null);f<128?o[u++]=f:(f<2048?o[u++]=f>>6|192:(f<65536?o[u++]=f>>12|224:(o[u++]=f>>18|240,o[u++]=f>>12&63|128),o[u++]=f>>6&63|128),o[u++]=63&f|128)}return u}(this.buf,i,this.pos);var t=this.pos-e;t>=128&&$y(e,t,this),this.pos=e-1,this.writeVarint(t),this.pos+=t},writeFloat:function(i){this.realloc(4),Ny(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Ny(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var t=0;t<e;t++)this.buf[this.pos++]=i[t]},writeRawMessage:function(i,e){this.pos++;var t=this.pos;i(e,this);var o=this.pos-t;o>=128&&$y(t,o,this),this.pos=t-1,this.writeVarint(o),this.pos+=o},writeMessage:function(i,e,t){this.writeTag(i,Ki.Bytes),this.writeRawMessage(e,t)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,_T,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,gT,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,xT,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,yT,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,vT,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,bT,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,wT,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,TT,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,ET,e)},writeBytesField:function(i,e){this.writeTag(i,Ki.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Ki.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Ki.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Ki.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Ki.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Ki.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Ki.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Ki.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Ki.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Ki.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,Boolean(e))}};class ym{constructor(e,{pixelRatio:t,version:o,stretchX:l,stretchY:u,content:f}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=l,this.stretchY=u,this.content=f,this.version=o}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Zy{constructor(e,t){const o={},l={};this.haveRenderCallbacks=[];const u=[];this.addImages(e,o,u),this.addImages(t,l,u);const{w:f,h:m}=gm(u),v=new Mr({width:f||1,height:m||1});for(const x in e){const S=e[x],A=o[x].paddedRect;Mr.copy(S.data,v,{x:0,y:0},{x:A.x+1,y:A.y+1},S.data)}for(const x in t){const S=t[x],A=l[x].paddedRect,I=A.x+1,P=A.y+1,L=S.data.width,O=S.data.height;Mr.copy(S.data,v,{x:0,y:0},{x:I,y:P},S.data),Mr.copy(S.data,v,{x:0,y:O-1},{x:I,y:P-1},{width:L,height:1}),Mr.copy(S.data,v,{x:0,y:0},{x:I,y:P+O},{width:L,height:1}),Mr.copy(S.data,v,{x:L-1,y:0},{x:I-1,y:P},{width:1,height:O}),Mr.copy(S.data,v,{x:0,y:0},{x:I+L,y:P},{width:1,height:O})}this.image=v,this.iconPositions=o,this.patternPositions=l}addImages(e,t,o){for(const l in e){const u=e[l],f={x:0,y:0,w:u.data.width+2,h:u.data.height+2};o.push(f),t[l]=new ym(f,u),u.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(e,t){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(o=>e.hasImage(o)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),t),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),t)}patchUpdatedImage(e,t,o){if(!e||!t||e.version===t.version)return;e.version=t.version;const[l,u]=e.tl;o.update(t.data,void 0,{x:l,y:u})}}Bt(ym,"ImagePosition"),Bt(Zy,"ImageAtlas");const Ur={horizontal:1,vertical:2,horizontalOnly:3};class Xu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const o=new Xu;return o.scale=e||1,o.fontStack=t,o}static forImage(e){const t=new Xu;return t.imageName=e,t}}class oc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const o=new oc;for(let l=0;l<e.sections.length;l++){const u=e.sections[l];u.image?o.addImageSection(u):o.addTextSection(u,t)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(t,o){let l="";for(let u=0;u<t.length;u++){const f=t.charCodeAt(u+1)||null,m=t.charCodeAt(u-1)||null;l+=!o&&(f&&Ua(f)&&!Wu[t[u+1]]||m&&Ua(m)&&!Wu[t[u-1]])||!Wu[t[u]]?t[u]:Wu[t[u]]}return l}(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&Jd[this.text.charCodeAt(o)];o++)e++;let t=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&Jd[this.text.charCodeAt(o)];o--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const o=new oc;return o.text=this.text.substring(e,t),o.sectionIndex=this.sectionIndex.slice(e,t),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,t)=>Math.max(e,this.sections[t].scale),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(Xu.forText(e.scale,e.fontStack||t));const o=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(o)}addImageSection(e){const t=e.image?e.image.name:"";if(t.length===0)return void xt("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(Xu.forImage(t)),this.sectionIndex.push(this.sections.length-1)):xt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function vm(i,e,t,o,l,u,f,m,v,x,S,A,I,P,L,O){const $=oc.fromFeature(i,l);let ee;A===Ur.vertical&&$.verticalizePunctuation(I);const{processBidirectionalText:se,processStyledBidirectionalText:ie}=Z;if(se&&$.sections.length===1){ee=[];const ae=se($.toString(),xm($,x,u,e,o,P,L));for(const Oe of ae){const Re=new oc;Re.text=Oe,Re.sections=$.sections;for(let We=0;We<Oe.length;We++)Re.sectionIndex.push(0);ee.push(Re)}}else if(ie){ee=[];const ae=ie($.text,$.sectionIndex,xm($,x,u,e,o,P,L));for(const Oe of ae){const Re=new oc;Re.text=Oe[0],Re.sectionIndex=Oe[1],Re.sections=$.sections,ee.push(Re)}}else ee=function(ae,Oe){const Re=[],We=ae.text;let yt=0;for(const Ne of Oe)Re.push(ae.substring(yt,Ne)),yt=Ne;return yt<We.length&&Re.push(ae.substring(yt,We.length)),Re}($,xm($,x,u,e,o,P,L));const re=[],pe={positionedLines:re,text:$.toString(),top:S[1],bottom:S[1],left:S[0],right:S[0],writingMode:A,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ae,Oe,Re,We,yt,Ne,et,at,tt,ft,lt,kt){let li=0,hi=0,Gt=0;const Tt=at==="right"?1:at==="left"?0:.5;let bi=!1;for(const fi of yt){const Ii=fi.getSections();for(const Ji of Ii){if(Ji.imageName)continue;const Zi=Oe[Ji.fontStack];if(Zi&&(bi=Zi.ascender!==void 0&&Zi.descender!==void 0,!bi))break}if(!bi)break}let oi=0;for(const fi of yt){fi.trim();const Ii=fi.getMaxScale(),Ji=(Ii-1)*Hn,Zi={positionedGlyphs:[],lineOffset:0};ae.positionedLines[oi]=Zi;const qi=Zi.positionedGlyphs;let tn=0;if(!fi.length()){hi+=Ne,++oi;continue}let an=0,On=0;for(let Ti=0;Ti<fi.length();Ti++){const fn=fi.getSection(Ti),er=fi.getSectionIndex(Ti),Fi=fi.getCharCode(Ti);let ln=fn.scale,ur=null,on=null,yn=null,Vn=Hn,Dn=0;const Xn=!(tt===Ur.horizontal||!lt&&!Hl(Fi)||lt&&(Jd[Fi]||(Dt=Fi,yd(Dt)||vd(Dt)||xd(Dt)||Va(Dt)||zu(Dt))));if(fn.imageName){const hr=We[fn.imageName];if(!hr)continue;yn=fn.imageName,ae.iconsInText=ae.iconsInText||!0,on=hr.paddedRect;const Un=hr.displaySize;ln=ln*Hn/kt,ur={width:Un[0],height:Un[1],left:1,top:-3,advance:Xn?Un[1]:Un[0],localGlyph:!1},Dn=bi?-ur.height*ln:Ii*Hn-17-Un[1]*ln,Vn=ur.advance;const ds=(Xn?Un[0]:Un[1])*ln-Hn*Ii;ds>0&&ds>tn&&(tn=ds)}else{const hr=Re[fn.fontStack];if(!hr)continue;hr[Fi]&&(on=hr[Fi]);const Un=Oe[fn.fontStack];if(!Un)continue;const ds=Un.glyphs[Fi];if(!ds)continue;if(ur=ds.metrics,Vn=Fi!==8203?Hn:0,bi){const dc=Un.ascender!==void 0?Math.abs(Un.ascender):0,ah=Un.descender!==void 0?Math.abs(Un.descender):0,lh=(dc+ah)*ln;an<lh&&(an=lh,On=(dc-ah)/2*ln),Dn=-dc*ln}else Dn=(Ii-ln)*Hn-17}Xn?(ae.verticalizable=!0,qi.push({glyph:Fi,imageName:yn,x:li,y:hi+Dn,vertical:Xn,scale:ln,localGlyph:ur.localGlyph,fontStack:fn.fontStack,sectionIndex:er,metrics:ur,rect:on}),li+=Vn*ln+ft):(qi.push({glyph:Fi,imageName:yn,x:li,y:hi+Dn,vertical:Xn,scale:ln,localGlyph:ur.localGlyph,fontStack:fn.fontStack,sectionIndex:er,metrics:ur,rect:on}),li+=ur.advance*ln+ft)}qi.length!==0&&(Gt=Math.max(li-ft,Gt),bi?Yy(qi,Tt,tn,On,Ne*Ii/2):Yy(qi,Tt,tn,0,Ne/2)),li=0;const xr=Ne*Ii+tn;Zi.lineOffset=Math.max(tn,Ji),hi+=xr,++oi}var Dt;const Yi=hi,{horizontalAlign:Gi,verticalAlign:rn}=bm(et);(function(fi,Ii,Ji,Zi,qi,tn){const an=(Ii-Ji)*qi,On=-tn*Zi;for(const xr of fi)for(const Ti of xr.positionedGlyphs)Ti.x+=an,Ti.y+=On})(ae.positionedLines,Tt,Gi,rn,Gt,Yi),ae.top+=-rn*Yi,ae.bottom=ae.top+Yi,ae.left+=-Gi*Gt,ae.right=ae.left+Gt,ae.hasBaseline=bi}(pe,e,t,o,ee,f,m,v,A,x,I,O),!function(ae){for(const Oe of ae)if(Oe.positionedGlyphs.length!==0)return!1;return!0}(re)&&pe}const Jd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},MT={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Wy(i,e,t,o,l,u){if(e.imageName){const f=o[e.imageName];return f?f.displaySize[0]*e.scale*Hn/u+l:0}{const f=t[e.fontStack],m=f&&f.glyphs[i];return m?m.metrics.advance*e.scale+l:0}}function Hy(i,e,t,o){const l=Math.pow(i-e,2);return o?i<e?l/2:2*l:l+Math.abs(t)*t}function IT(i,e,t){let o=0;return i===10&&(o-=1e4),t&&(o+=150),i!==40&&i!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function Xy(i,e,t,o,l,u){let f=null,m=Hy(e,t,l,u);for(const v of o){const x=Hy(e-v.x,t,l,u)+v.badness;x<=m&&(f=v,m=x)}return{index:i,x:e,priorBreak:f,badness:m}}function Ky(i){return i?Ky(i.priorBreak).concat(i.index):[]}function xm(i,e,t,o,l,u,f){if(u!=="point")return[];if(!i)return[];const m=[],v=function(I,P,L,O,$,ee){let se=0;for(let ie=0;ie<I.length();ie++){const re=I.getSection(ie);se+=Wy(I.getCharCode(ie),re,O,$,P,ee)}return se/Math.max(1,Math.ceil(se/L))}(i,e,t,o,l,f),x=i.text.indexOf("\u200B")>=0;let S=0;for(let I=0;I<i.length();I++){const P=i.getSection(I),L=i.getCharCode(I);if(Jd[L]||(S+=Wy(L,P,o,l,e,f)),I<i.length()-1){const O=!((A=L)<11904||!(Su(A)||Td(A)||ku(A)||Ad(A)||Mu(A)||bd(A)||Ed(A)||Gl(A)||Iu(A)||Oa(A)||Au(A)||Pu(A)||Eu(A)||Fa(A)||wd(A)||Cu(A)||Jo(A)||Md(A)||Sd(A)||Zl(A)));(MT[L]||O||P.imageName)&&m.push(Xy(I+1,S,v,m,IT(L,i.getCharCode(I+1),O&&x),!1))}}var A;return Ky(Xy(i.length(),S,v,m,0,!0))}function bm(i){let e=.5,t=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":t=1;break;case"top":case"top-right":case"top-left":t=0}return{horizontalAlign:e,verticalAlign:t}}function Yy(i,e,t,o,l){if(!(e||t||o||l))return;const u=i.length-1,f=i[u],m=(f.x+f.metrics.advance*f.scale)*e;for(let v=0;v<=u;v++)i[v].x-=m,i[v].y+=t+o+l}function kT(i,e,t){const{horizontalAlign:o,verticalAlign:l}=bm(t),u=e[0]-i.displaySize[0]*o,f=e[1]-i.displaySize[1]*l;return{image:i,top:f,bottom:f+i.displaySize[1],left:u,right:u+i.displaySize[0]}}function Jy(i,e,t,o,l,u){const f=i.image;let m;if(f.content){const $=f.content,ee=f.pixelRatio||1;m=[$[0]/ee,$[1]/ee,f.displaySize[0]-$[2]/ee,f.displaySize[1]-$[3]/ee]}const v=e.left*u,x=e.right*u;let S,A,I,P;t==="width"||t==="both"?(P=l[0]+v-o[3],A=l[0]+x+o[1]):(P=l[0]+(v+x-f.displaySize[0])/2,A=P+f.displaySize[0]);const L=e.top*u,O=e.bottom*u;return t==="height"||t==="both"?(S=l[1]+L-o[0],I=l[1]+O+o[2]):(S=l[1]+(L+O-f.displaySize[1])/2,I=S+f.displaySize[1]),{image:f,top:S,right:A,bottom:I,left:P,collisionPadding:m}}class us extends U{constructor(e,t,o,l,u){super(e,t),this.angle=l,this.z=o,u!==void 0&&(this.segment=u)}clone(){return new us(this.x,this.y,this.z,this.angle,this.segment)}}function Qy(i,e,t,o,l){if(e.segment===void 0)return!0;let u=e,f=e.segment+1,m=0;for(;m>-t/2;){if(f--,f<0)return!1;m-=i[f].dist(u),u=i[f]}m+=i[f].dist(i[f+1]),f++;const v=[];let x=0;for(;m<t/2;){const S=i[f],A=i[f+1];if(!A)return!1;let I=i[f-1].angleTo(S)-S.angleTo(A);for(I=Math.abs((I+3*Math.PI)%(2*Math.PI)-Math.PI),v.push({distance:m,angleDelta:I}),x+=I;m-v[0].distance>o;)x-=v.shift().angleDelta;if(x>l)return!1;f++,m+=S.dist(A)}return!0}function ev(i){let e=0;for(let t=0;t<i.length-1;t++)e+=i[t].dist(i[t+1]);return e}function tv(i,e,t){return i?.6*e*t:0}function iv(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function zT(i,e,t,o,l,u){const f=tv(t,l,u),m=iv(t,o)*u;let v=0;const x=ev(i)/2;for(let S=0;S<i.length-1;S++){const A=i[S],I=i[S+1],P=A.dist(I);if(v+P>x){const L=(x-v)/P,O=Ai(A.x,I.x,L),$=Ai(A.y,I.y,L),ee=new us(O,$,0,I.angleTo(A),S);return!f||Qy(i,ee,m,f,e)?ee:void 0}v+=P}}function PT(i,e,t,o,l,u,f,m,v){const x=tv(o,u,f),S=iv(o,l),A=S*f,I=i[0].x===0||i[0].x===v||i[0].y===0||i[0].y===v;return e-A<e/4&&(e=A+e/4),nv(i,I?e/2*m%e:(S/2+2*u)*f*m%e,e,x,t,A,I,!1,v)}function nv(i,e,t,o,l,u,f,m,v){const x=u/2,S=ev(i);let A=0,I=e-t,P=[];for(let L=0;L<i.length-1;L++){const O=i[L],$=i[L+1],ee=O.dist($),se=$.angleTo(O);for(;I+t<A+ee;){I+=t;const ie=(I-A)/ee,re=Ai(O.x,$.x,ie),pe=Ai(O.y,$.y,ie);if(re>=0&&re<v&&pe>=0&&pe<v&&I-x>=0&&I+x<=S){const ae=new us(re,pe,0,se,L);ae._round(),o&&!Qy(i,ae,u,o,l)||P.push(ae)}}A+=ee}return m||P.length||f||(P=nv(i,A/2,t,o,l,u,f,!0,v)),P}function rv(i,e,t,o,l){const u=[];for(let f=0;f<i.length;f++){const m=i[f];let v;for(let x=0;x<m.length-1;x++){let S=m[x],A=m[x+1];S.x<e&&A.x<e||(S.x<e?S=new U(e,S.y+(e-S.x)/(A.x-S.x)*(A.y-S.y))._round():A.x<e&&(A=new U(e,S.y+(e-S.x)/(A.x-S.x)*(A.y-S.y))._round()),S.y<t&&A.y<t||(S.y<t?S=new U(S.x+(t-S.y)/(A.y-S.y)*(A.x-S.x),t)._round():A.y<t&&(A=new U(S.x+(t-S.y)/(A.y-S.y)*(A.x-S.x),t)._round()),S.x>=o&&A.x>=o||(S.x>=o?S=new U(o,S.y+(o-S.x)/(A.x-S.x)*(A.y-S.y))._round():A.x>=o&&(A=new U(o,S.y+(o-S.x)/(A.x-S.x)*(A.y-S.y))._round()),S.y>=l&&A.y>=l||(S.y>=l?S=new U(S.x+(l-S.y)/(A.y-S.y)*(A.x-S.x),l)._round():A.y>=l&&(A=new U(S.x+(l-S.y)/(A.y-S.y)*(A.x-S.x),l)._round()),v&&S.equals(v[v.length-1])||(v=[S],u.push(v)),v.push(A)))))}}return u}Bt(us,"Anchor");const Ku=1e20;function ov(i,e,t,o,l,u,f,m,v){for(let x=e;x<e+o;x++)sv(i,t*u+x,u,l,f,m,v);for(let x=t;x<t+l;x++)sv(i,x*u+e,1,o,f,m,v)}function sv(i,e,t,o,l,u,f){u[0]=0,f[0]=-Ku,f[1]=Ku,l[0]=i[e];for(let m=1,v=0,x=0;m<o;m++){l[m]=i[e+m*t];const S=m*m;do{const A=u[v];x=(l[m]-l[A]+S-A*A)/(m-A)/2}while(x<=f[v]&&--v>-1);v++,u[v]=m,f[v]=x,f[v+1]=Ku}for(let m=0,v=0;m<o;m++){for(;f[v+1]<m;)v++;const x=u[v],S=m-x;i[e+m*t]=l[x]+S*S}}const wm={none:0,ideographs:1,all:2};class sc{constructor(e,t,o){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=o,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,t){const o=[];for(const l in e)for(const u of e[l])o.push({stack:l,id:u});Pe(o,({stack:l,id:u},f)=>{let m=this.entries[l];m||(m=this.entries[l]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let v=m.glyphs[u];if(v!==void 0)return void f(null,{stack:l,id:u,glyph:v});if(v=this._tinySDF(m,l,u),v)return m.glyphs[u]=v,void f(null,{stack:l,id:u,glyph:v});const x=Math.floor(u/256);if(256*x>65535)return void f(new Error("glyphs > 65535 not supported"));if(m.ranges[x])return void f(null,{stack:l,id:u,glyph:v});let S=m.requests[x];S||(S=m.requests[x]=[],sc.loadGlyphRange(l,x,this.url,this.requestManager,(A,I)=>{if(I){m.ascender=I.ascender,m.descender=I.descender;for(const P in I.glyphs)this._doesCharSupportLocalGlyph(+P)||(m.glyphs[+P]=I.glyphs[+P]);m.ranges[x]=!0}for(const P of S)P(A,I);delete m.requests[x]})),S.push((A,I)=>{A?f(A):I&&f(null,{stack:l,id:u,glyph:I.glyphs[u]||null})})},(l,u)=>{if(l)t(l);else if(u){const f={};for(const{stack:m,id:v,glyph:x}of u)f[m]===void 0&&(f[m]={}),f[m].glyphs===void 0&&(f[m].glyphs={}),f[m].glyphs[v]=x&&{id:x.id,bitmap:x.bitmap.clone(),metrics:x.metrics},f[m].ascender=this.entries[m].ascender,f[m].descender=this.entries[m].descender;t(null,f)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==wm.none&&(this.localGlyphMode===wm.all?!!this.localFontFamily:!!this.localFontFamily&&(Oa(e)||Cd(e)||Eu(e)||Jo(e)||Gl(e)))}_tinySDF(e,t,o){const l=this.localFontFamily;if(!l||!this._doesCharSupportLocalGlyph(o))return;let u=e.tinySDF;if(!u){let O="400";/bold/i.test(t)?O="900":/medium/i.test(t)?O="500":/light/i.test(t)&&(O="200"),u=e.tinySDF=new sc.TinySDF({fontFamily:l,fontWeight:O,fontSize:48,buffer:6,radius:16}),u.fontWeight=O}if(this.localGlyphs[u.fontWeight][o])return this.localGlyphs[u.fontWeight][o];const f=String.fromCharCode(o),{data:m,width:v,height:x,glyphWidth:S,glyphHeight:A,glyphLeft:I,glyphTop:P,glyphAdvance:L}=u.draw(f);return this.localGlyphs[u.fontWeight][o]={id:o,bitmap:new ls({width:v,height:x},m),metrics:{width:S/2,height:A/2,left:I/2,top:P/2-27,advance:L/2,localGlyph:!0}}}}function av(i,e,t,o){const l=[],u=i.image,f=u.pixelRatio,m=u.paddedRect.w-2,v=u.paddedRect.h-2,x=i.right-i.left,S=i.bottom-i.top,A=u.stretchX||[[0,m]],I=u.stretchY||[[0,v]],P=(Ne,et)=>Ne+et[1]-et[0],L=A.reduce(P,0),O=I.reduce(P,0),$=m-L,ee=v-O;let se=0,ie=L,re=0,pe=O,ae=0,Oe=$,Re=0,We=ee;if(u.content&&o){const Ne=u.content;se=Qd(A,0,Ne[0]),re=Qd(I,0,Ne[1]),ie=Qd(A,Ne[0],Ne[2]),pe=Qd(I,Ne[1],Ne[3]),ae=Ne[0]-se,Re=Ne[1]-re,Oe=Ne[2]-Ne[0]-ie,We=Ne[3]-Ne[1]-pe}const yt=(Ne,et,at,tt)=>{const ft=ef(Ne.stretch-se,ie,x,i.left),lt=tf(Ne.fixed-ae,Oe,Ne.stretch,L),kt=ef(et.stretch-re,pe,S,i.top),li=tf(et.fixed-Re,We,et.stretch,O),hi=ef(at.stretch-se,ie,x,i.left),Gt=tf(at.fixed-ae,Oe,at.stretch,L),Tt=ef(tt.stretch-re,pe,S,i.top),bi=tf(tt.fixed-Re,We,tt.stretch,O),oi=new U(ft,kt),Dt=new U(hi,kt),Yi=new U(hi,Tt),Gi=new U(ft,Tt),rn=new U(lt/f,li/f),fi=new U(Gt/f,bi/f),Ii=e*Math.PI/180;if(Ii){const qi=Math.sin(Ii),tn=Math.cos(Ii),an=[tn,-qi,qi,tn];oi._matMult(an),Dt._matMult(an),Gi._matMult(an),Yi._matMult(an)}const Ji=Ne.stretch+Ne.fixed,Zi=et.stretch+et.fixed;return{tl:oi,tr:Dt,bl:Gi,br:Yi,tex:{x:u.paddedRect.x+1+Ji,y:u.paddedRect.y+1+Zi,w:at.stretch+at.fixed-Ji,h:tt.stretch+tt.fixed-Zi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:rn,pixelOffsetBR:fi,minFontScaleX:Oe/f/x,minFontScaleY:We/f/S,isSDF:t}};if(o&&(u.stretchX||u.stretchY)){const Ne=lv(A,$,L),et=lv(I,ee,O);for(let at=0;at<Ne.length-1;at++){const tt=Ne[at],ft=Ne[at+1];for(let lt=0;lt<et.length-1;lt++)l.push(yt(tt,et[lt],ft,et[lt+1]))}}else l.push(yt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:m+1},{fixed:0,stretch:v+1}));return l}function Qd(i,e,t){let o=0;for(const l of i)o+=Math.max(e,Math.min(t,l[1]))-Math.max(e,Math.min(t,l[0]));return o}function lv(i,e,t){const o=[{fixed:-1,stretch:0}];for(const[l,u]of i){const f=o[o.length-1];o.push({fixed:l-f.stretch,stretch:f.stretch}),o.push({fixed:l-f.stretch,stretch:f.stretch+(u-l)})}return o.push({fixed:e+1,stretch:t}),o}function ef(i,e,t,o){return i/e*t+o}function tf(i,e,t,o){return i-e*t/o}function DT(i,e,t,o){const l=e+i.positionedLines[o].lineOffset;return o===0?t+l/2:t+(l+(e+i.positionedLines[o-1].lineOffset))/2}sc.loadGlyphRange=function(i,e,t,o,l){const u=256*e,f=u+255,m=o.transformRequest(o.normalizeGlyphsURL(t).replace("{fontstack}",i).replace("{range}",`${u}-${f}`),me.Glyphs);Ie(m,(v,x)=>{if(v)l(v);else if(x){const S={},A=function(I){return new Hu(I).readFields(ST,{})}(x);for(const I of A.glyphs)S[I.id]=I;l(null,{glyphs:S,ascender:A.ascender,descender:A.descender})}})},sc.TinySDF=class{constructor({fontSize:i=24,buffer:e=3,radius:t=8,cutoff:o=.25,fontFamily:l="sans-serif",fontWeight:u="normal",fontStyle:f="normal"}={}){this.buffer=e,this.cutoff=o,this.radius=t;const m=this.size=i+4*e,v=this._createCanvas(m),x=this.ctx=v.getContext("2d",{willReadFrequently:!0});x.font=`${f} ${u} ${i}px ${l}`,x.textBaseline="alphabetic",x.textAlign="left",x.fillStyle="black",this.gridOuter=new Float64Array(m*m),this.gridInner=new Float64Array(m*m),this.f=new Float64Array(m),this.z=new Float64Array(m+1),this.v=new Uint16Array(m)}_createCanvas(i){const e=document.createElement("canvas");return e.width=e.height=i,e}draw(i){const{width:e,actualBoundingBoxAscent:t,actualBoundingBoxDescent:o,actualBoundingBoxLeft:l,actualBoundingBoxRight:u}=this.ctx.measureText(i),f=Math.ceil(t),m=Math.min(this.size-this.buffer,Math.ceil(u-l)),v=Math.min(this.size-this.buffer,f+Math.ceil(o)),x=m+2*this.buffer,S=v+2*this.buffer,A=Math.max(x*S,0),I=new Uint8ClampedArray(A),P={data:I,width:x,height:S,glyphWidth:m,glyphHeight:v,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(m===0||v===0)return P;const{ctx:L,buffer:O,gridInner:$,gridOuter:ee}=this;L.clearRect(O,O,m,v),L.fillText(i,O,O+f);const se=L.getImageData(O,O,m,v);ee.fill(Ku,0,A),$.fill(0,0,A);for(let ie=0;ie<v;ie++)for(let re=0;re<m;re++){const pe=se.data[4*(ie*m+re)+3]/255;if(pe===0)continue;const ae=(ie+O)*x+re+O;if(pe===1)ee[ae]=0,$[ae]=Ku;else{const Oe=.5-pe;ee[ae]=Oe>0?Oe*Oe:0,$[ae]=Oe<0?Oe*Oe:0}}ov(ee,0,0,x,S,x,this.f,this.v,this.z),ov($,O,O,m,v,x,this.f,this.v,this.z);for(let ie=0;ie<A;ie++){const re=Math.sqrt(ee[ie])-Math.sqrt($[ie]);I[ie]=Math.round(255-255*(re/this.radius+this.cutoff))}return P}};class LT{constructor(e=[],t=BT){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:o}=this,l=t[e];for(;e>0;){const u=e-1>>1,f=t[u];if(o(l,f)>=0)break;t[e]=f,e=u}t[e]=l}_down(e){const{data:t,compare:o}=this,l=this.length>>1,u=t[e];for(;e<l;){let f=1+(e<<1),m=t[f];const v=f+1;if(v<this.length&&o(t[v],m)<0&&(f=v,m=t[v]),o(m,u)>=0)break;t[e]=m,e=f}t[e]=u}}function BT(i,e){return i<e?-1:i>e?1:0}function RT(i,e=1,t=!1){let o=1/0,l=1/0,u=-1/0,f=-1/0;const m=i[0];for(let P=0;P<m.length;P++){const L=m[P];(!P||L.x<o)&&(o=L.x),(!P||L.y<l)&&(l=L.y),(!P||L.x>u)&&(u=L.x),(!P||L.y>f)&&(f=L.y)}const v=Math.min(u-o,f-l);let x=v/2;const S=new LT([],FT);if(v===0)return new U(o,l);for(let P=o;P<u;P+=v)for(let L=l;L<f;L+=v)S.push(new ac(P+x,L+x,x,i));let A=function(P){let L=0,O=0,$=0;const ee=P[0];for(let se=0,ie=ee.length,re=ie-1;se<ie;re=se++){const pe=ee[se],ae=ee[re],Oe=pe.x*ae.y-ae.x*pe.y;O+=(pe.x+ae.x)*Oe,$+=(pe.y+ae.y)*Oe,L+=3*Oe}return new ac(O/L,$/L,0,P)}(i),I=S.length;for(;S.length;){const P=S.pop();(P.d>A.d||!A.d)&&(A=P,t&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,I)),P.max-A.d<=e||(x=P.h/2,S.push(new ac(P.p.x-x,P.p.y-x,x,i)),S.push(new ac(P.p.x+x,P.p.y-x,x,i)),S.push(new ac(P.p.x-x,P.p.y+x,x,i)),S.push(new ac(P.p.x+x,P.p.y+x,x,i)),I+=4)}return t&&(console.log(`num probes: ${I}`),console.log(`best distance: ${A.d}`)),A.p}function FT(i,e){return e.max-i.max}function ac(i,e,t,o){this.p=new U(i,e),this.h=t,this.d=function(l,u){let f=!1,m=1/0;for(let v=0;v<u.length;v++){const x=u[v];for(let S=0,A=x.length,I=A-1;S<A;I=S++){const P=x[S],L=x[I];P.y>l.y!=L.y>l.y&&l.x<(L.x-P.x)*(l.y-P.y)/(L.y-P.y)+P.x&&(f=!f),m=Math.min(m,Xg(l,P,L))}}return(f?1:-1)*Math.sqrt(m)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}const Tm=Number.POSITIVE_INFINITY,OT=Math.sqrt(2);function cv(i,e){return e[1]!==Tm?function(t,o,l){let u=0,f=0;switch(o=Math.abs(o),l=Math.abs(l),t){case"top-right":case"top-left":case"top":f=l-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-l}switch(t){case"top-right":case"bottom-right":case"right":u=-o;break;case"top-left":case"bottom-left":case"left":u=o}return[u,f]}(i,e[0],e[1]):function(t,o){let l=0,u=0;o<0&&(o=0);const f=o/OT;switch(t){case"top-right":case"top-left":u=f-7;break;case"bottom-right":case"bottom-left":u=7-f;break;case"bottom":u=7-o;break;case"top":u=o-7}switch(t){case"top-right":case"bottom-right":l=-f;break;case"top-left":case"bottom-left":l=f;break;case"left":l=o;break;case"right":l=-o}return[l,u]}(i,e[0])}function VT(i,e,t,o,l,u,f,m,v,x){i.createArrays(),i.tilePixelRatio=ei/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const S=i.layers[0].layout,A=i.layers[0]._unevaluatedLayout._values,I={};if(i.textSizeData.kind==="composite"){const{minZoom:O,maxZoom:$}=i.textSizeData;I.compositeTextSizes=[A["text-size"].possiblyEvaluate(new W(O),m),A["text-size"].possiblyEvaluate(new W($),m)]}if(i.iconSizeData.kind==="composite"){const{minZoom:O,maxZoom:$}=i.iconSizeData;I.compositeIconSizes=[A["icon-size"].possiblyEvaluate(new W(O),m),A["icon-size"].possiblyEvaluate(new W($),m)]}I.layoutTextSize=A["text-size"].possiblyEvaluate(new W(v+1),m),I.layoutIconSize=A["icon-size"].possiblyEvaluate(new W(v+1),m),I.textMaxSize=A["text-size"].possiblyEvaluate(new W(18),m);const P=S.get("text-rotation-alignment")==="map"&&S.get("symbol-placement")!=="point",L=S.get("text-size");for(const O of i.features){const $=S.get("text-font").evaluate(O,{},m).join(","),ee=L.evaluate(O,{},m),se=I.layoutTextSize.evaluate(O,{},m),ie=(I.layoutIconSize.evaluate(O,{},m),{horizontal:{},vertical:void 0}),re=O.text;let pe,ae=[0,0];if(re){const We=re.toString(),yt=S.get("text-letter-spacing").evaluate(O,{},m)*Hn,Ne=S.get("text-line-height").evaluate(O,{},m)*Hn,et=Vp(We)?yt:0,at=S.get("text-anchor").evaluate(O,{},m),tt=S.get("text-variable-anchor");if(!tt){const Gt=S.get("text-radial-offset").evaluate(O,{},m);ae=Gt?cv(at,[Gt*Hn,Tm]):S.get("text-offset").evaluate(O,{},m).map(Tt=>Tt*Hn)}let ft=P?"center":S.get("text-justify").evaluate(O,{},m);const lt=S.get("symbol-placement"),kt=lt==="point",li=lt==="point"?S.get("text-max-width").evaluate(O,{},m)*Hn:0,hi=Gt=>{i.allowVerticalPlacement&&Wl(We)&&(ie.vertical=vm(re,e,t,l,$,li,Ne,at,Gt,et,ae,Ur.vertical,!0,lt,se,ee))};if(!P&&tt){const Gt=ft==="auto"?tt.map(bi=>Em(bi)):[ft];let Tt=!1;for(let bi=0;bi<Gt.length;bi++){const oi=Gt[bi];if(!ie.horizontal[oi])if(Tt)ie.horizontal[oi]=ie.horizontal[0];else{const Dt=vm(re,e,t,l,$,li,Ne,"center",oi,et,ae,Ur.horizontal,!1,lt,se,ee);Dt&&(ie.horizontal[oi]=Dt,Tt=Dt.positionedLines.length===1)}}hi("left")}else{if(ft==="auto"&&(ft=Em(at)),kt||S.get("text-writing-mode").indexOf("horizontal")>=0||!Wl(We)){const Gt=vm(re,e,t,l,$,li,Ne,at,ft,et,ae,Ur.horizontal,!1,lt,se,ee);Gt&&(ie.horizontal[ft]=Gt)}hi(lt==="point"?"left":ft)}}let Oe=!1;if(O.icon&&O.icon.name){const We=o[O.icon.name];We&&(pe=kT(l[O.icon.name],S.get("icon-offset").evaluate(O,{},m),S.get("icon-anchor").evaluate(O,{},m)),Oe=We.sdf,i.sdfIcons===void 0?i.sdfIcons=We.sdf:i.sdfIcons!==We.sdf&&xt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(We.pixelRatio!==i.pixelRatio||S.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const Re=hv(ie.horizontal)||ie.vertical;i.iconsInText||(i.iconsInText=!!Re&&Re.iconsInText),(Re||pe)&&UT(i,O,ie,pe,o,I,se,0,ae,Oe,f,m,x)}u&&i.generateCollisionDebugBuffers(v,i.collisionBoxArray)}function Em(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function UT(i,e,t,o,l,u,f,m,v,x,S,A,I){let P=u.textMaxSize.evaluate(e,{},A);P===void 0&&(P=f);const L=i.layers[0].layout,O=L.get("icon-offset").evaluate(e,{},A),$=hv(t.horizontal)||t.vertical,ee=I.name==="globe",se=f/24,ie=i.tilePixelRatio*P/24,re=(et=i.overscaling,i.zoom>18&&et>2&&(et>>=1),Math.max(ei/(512*et),1)*L.get("symbol-spacing")),pe=L.get("text-padding")*i.tilePixelRatio,ae=L.get("icon-padding")*i.tilePixelRatio,Oe=ve(L.get("text-max-angle")),Re=L.get("text-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",We=L.get("icon-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",yt=L.get("symbol-placement"),Ne=re/2;var et;const at=L.get("icon-text-fit");let tt;o&&at!=="none"&&(i.allowVerticalPlacement&&t.vertical&&(tt=Jy(o,t.vertical,at,L.get("icon-text-fit-padding"),O,se)),$&&(o=Jy(o,$,at,L.get("icon-text-fit-padding"),O,se)));const ft=(lt,kt,li)=>{if(kt.x<0||kt.x>=ei||kt.y<0||kt.y>=ei)return;let hi=null;if(ee){const{x:Gt,y:Tt,z:bi}=I.projectTilePoint(kt.x,kt.y,li);hi={anchor:new us(Gt,Tt,bi,0,void 0),up:I.upVector(li,kt.x,kt.y)}}(function(Gt,Tt,bi,oi,Dt,Yi,Gi,rn,fi,Ii,Ji,Zi,qi,tn,an,On,xr,Ti,fn,er,Fi,ln,ur,on,yn){const Vn=Gt.addToLineVertexArray(Tt,oi);let Dn,Xn,hr,Un,ds,dc,ah,lh=0,Hv=0,Xv=0,Kv=0,Nm=-1,jm=-1;const Vo={};let Yv=Du("");const Ya=bi?bi.anchor:Tt;let qm=0,$m=0;if(fi._unevaluatedLayout.getValue("text-radial-offset")===void 0?[qm,$m]=fi.layout.get("text-offset").evaluate(Fi,{},yn).map(Ir=>Ir*Hn):(qm=fi.layout.get("text-radial-offset").evaluate(Fi,{},yn)*Hn,$m=Tm),Gt.allowVerticalPlacement&&Dt.vertical){const Ir=Dt.vertical;if(an)dc=Sm(Ir),rn&&(ah=Sm(rn));else{const kr=fi.layout.get("text-rotate").evaluate(Fi,{},yn)+90;hr=nf(Ii,Ya,Tt,Ji,Zi,qi,Ir,tn,kr,On),rn&&(Un=nf(Ii,Ya,Tt,Ji,Zi,qi,rn,Ti,kr))}}if(Yi){const Ir=fi.layout.get("icon-rotate").evaluate(Fi,{},yn),kr=fi.layout.get("icon-text-fit")!=="none",ch=av(Yi,Ir,ur,kr),Zm=rn?av(rn,Ir,ur,kr):void 0;Xn=nf(Ii,Ya,Tt,Ji,Zi,qi,Yi,Ti,Ir),lh=4*ch.length;const Jv=Gt.iconSizeData;let Ja=null;Jv.kind==="source"?(Ja=[Lo*fi.layout.get("icon-size").evaluate(Fi,{},yn)],Ja[0]>qs&&xt(`${Gt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Jv.kind==="composite"&&(Ja=[Lo*ln.compositeIconSizes[0].evaluate(Fi,{},yn),Lo*ln.compositeIconSizes[1].evaluate(Fi,{},yn)],(Ja[0]>qs||Ja[1]>qs)&&xt(`${Gt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Gt.addSymbols(Gt.icon,ch,Ja,er,fn,Fi,!1,bi,Tt,Vn.lineStartIndex,Vn.lineLength,-1,on,yn),Nm=Gt.icon.placedSymbolArray.length-1,Zm&&(Hv=4*Zm.length,Gt.addSymbols(Gt.icon,Zm,Ja,er,fn,Fi,Ur.vertical,bi,Tt,Vn.lineStartIndex,Vn.lineLength,-1,on,yn),jm=Gt.icon.placedSymbolArray.length-1)}for(const Ir in Dt.horizontal){const kr=Dt.horizontal[Ir];Dn||(Yv=Du(kr.text),an?ds=Sm(kr):Dn=nf(Ii,Ya,Tt,Ji,Zi,qi,kr,tn,fi.layout.get("text-rotate").evaluate(Fi,{},yn),On));const ch=kr.positionedLines.length===1;if(Xv+=uv(Gt,bi,Tt,kr,Gi,fi,an,Fi,On,Vn,Dt.vertical?Ur.horizontal:Ur.horizontalOnly,ch?Object.keys(Dt.horizontal):[Ir],Vo,Nm,ln,on,yn),ch)break}Dt.vertical&&(Kv+=uv(Gt,bi,Tt,Dt.vertical,Gi,fi,an,Fi,On,Vn,Ur.vertical,["vertical"],Vo,jm,ln,on,yn));let Xs=-1;const Gm=(Ir,kr)=>Ir?Math.max(Ir,kr):kr;Xs=Gm(ds,Xs),Xs=Gm(dc,Xs),Xs=Gm(ah,Xs);const y2=Xs>-1?1:0;Gt.glyphOffsetArray.length>=Gs.MAX_GLYPHS&&xt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Fi.sortKey!==void 0&&Gt.addToSortKeyRanges(Gt.symbolInstances.length,Fi.sortKey),Gt.symbolInstances.emplaceBack(Ya.x,Ya.y,Ya.z,Tt.x,Tt.y,Vo.right>=0?Vo.right:-1,Vo.center>=0?Vo.center:-1,Vo.left>=0?Vo.left:-1,Vo.vertical>=0?Vo.vertical:-1,Nm,jm,Yv,Dn!==void 0?Dn:Gt.collisionBoxArray.length,Dn!==void 0?Dn+1:Gt.collisionBoxArray.length,hr!==void 0?hr:Gt.collisionBoxArray.length,hr!==void 0?hr+1:Gt.collisionBoxArray.length,Xn!==void 0?Xn:Gt.collisionBoxArray.length,Xn!==void 0?Xn+1:Gt.collisionBoxArray.length,Un||Gt.collisionBoxArray.length,Un?Un+1:Gt.collisionBoxArray.length,Ji,Xv,Kv,lh,Hv,y2,0,qm,$m,Xs)})(i,kt,hi,lt,t,o,l,tt,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,pe,Re,v,0,ae,We,O,e,u,x,S,A)};if(yt==="line")for(const lt of rv(e.geometry,0,0,ei,ei)){const kt=PT(lt,re,Oe,t.vertical||$,o,24,ie,i.overscaling,ei);for(const li of kt){const hi=$;hi&&NT(i,hi.text,Ne,li)||ft(lt,li,A)}}else if(yt==="line-center"){for(const lt of e.geometry)if(lt.length>1){const kt=zT(lt,Oe,t.vertical||$,o,24,ie);kt&&ft(lt,kt,A)}}else if(e.type==="Polygon")for(const lt of dm(e.geometry,0)){const kt=RT(lt,16);ft(lt[0],new us(kt.x,kt.y,0,0,void 0),A)}else if(e.type==="LineString")for(const lt of e.geometry)ft(lt,new us(lt[0].x,lt[0].y,0,0,void 0),A);else if(e.type==="Point")for(const lt of e.geometry)for(const kt of lt)ft([kt],new us(kt.x,kt.y,0,0,void 0),A)}const qs=32640;function uv(i,e,t,o,l,u,f,m,v,x,S,A,I,P,L,O,$){const ee=function(re,pe,ae,Oe,Re,We,yt,Ne){const et=[];if(pe.positionedLines.length===0)return et;const at=Oe.layout.get("text-rotate").evaluate(We,{})*Math.PI/180,tt=function(hi){const Gt=hi[0],Tt=hi[1],bi=Gt*Tt;return bi>0?[Gt,-Tt]:bi<0?[-Gt,Tt]:Gt===0?[Tt,Gt]:[Tt,-Gt]}(ae);let ft=Math.abs(pe.top-pe.bottom);for(const hi of pe.positionedLines)ft-=hi.lineOffset;const lt=pe.positionedLines.length,kt=ft/lt;let li=pe.top-ae[1];for(let hi=0;hi<lt;++hi){const Gt=pe.positionedLines[hi];li=DT(pe,kt,li,hi);for(const Tt of Gt.positionedGlyphs){if(!Tt.rect)continue;const bi=Tt.rect||{};let oi=4,Dt=!0,Yi=1,Gi=0;if(Tt.imageName){const on=yt[Tt.imageName];if(!on)continue;if(on.sdf){xt("SDF images are not supported in formatted text and will be ignored.");continue}Dt=!1,Yi=on.pixelRatio,oi=1/Yi}const rn=(Re||Ne)&&Tt.vertical,fi=Tt.metrics.advance*Tt.scale/2,Ii=Tt.metrics,Ji=Tt.rect;if(Ji===null)continue;Ne&&pe.verticalizable&&(Gi=Tt.imageName?fi-Tt.metrics.width*Tt.scale/2:0);const Zi=Re?[Tt.x+fi,Tt.y]:[0,0];let qi=[0,0],tn=[0,0],an=!1;Re||(rn?(tn=[Tt.x+fi+tt[0],Tt.y+tt[1]-Gi],an=!0):qi=[Tt.x+fi+ae[0],Tt.y+ae[1]-Gi]);const On=Ji.w*Tt.scale/(Yi*(Tt.localGlyph?2:1)),xr=Ji.h*Tt.scale/(Yi*(Tt.localGlyph?2:1));let Ti,fn,er,Fi;if(rn){const on=Tt.y-li,yn=new U(-fi,fi-on),Vn=-Math.PI/2,Dn=new U(...tn);Ti=new U(-fi+qi[0],qi[1]),Ti._rotateAround(Vn,yn)._add(Dn),Ti.x+=-on+fi,Ti.y-=(Ii.left-oi)*Tt.scale;const Xn=Tt.imageName?Ii.advance*Tt.scale:Hn*Tt.scale,hr=String.fromCharCode(Tt.glyph);pT(hr)?Ti.x+=(1-oi)*Tt.scale:mT(hr)?Ti.x+=Xn-Ii.height*Tt.scale+(-oi-1)*Tt.scale:Ti.x+=Tt.imageName||Ii.width+2*oi===Ji.w&&Ii.height+2*oi===Ji.h?(Xn-xr)/2:(Xn-(Ii.height+2*oi)*Tt.scale)/2,fn=new U(Ti.x,Ti.y-On),er=new U(Ti.x+xr,Ti.y),Fi=new U(Ti.x+xr,Ti.y-On)}else{const on=(Ii.left-oi)*Tt.scale-fi+qi[0],yn=(-Ii.top-oi)*Tt.scale+qi[1],Vn=on+On,Dn=yn+xr;Ti=new U(on,yn),fn=new U(Vn,yn),er=new U(on,Dn),Fi=new U(Vn,Dn)}if(at){let on;on=Re?new U(0,0):an?new U(tt[0],tt[1]):new U(ae[0],ae[1]),Ti._rotateAround(at,on),fn._rotateAround(at,on),er._rotateAround(at,on),Fi._rotateAround(at,on)}const ln=new U(0,0),ur=new U(0,0);et.push({tl:Ti,tr:fn,bl:er,br:Fi,tex:bi,writingMode:pe.writingMode,glyphOffset:Zi,sectionIndex:Tt.sectionIndex,isSDF:Dt,pixelOffsetTL:ln,pixelOffsetBR:ur,minFontScaleX:0,minFontScaleY:0})}}return et}(0,o,v,u,f,m,l,i.allowVerticalPlacement),se=i.textSizeData;let ie=null;se.kind==="source"?(ie=[Lo*u.layout.get("text-size").evaluate(m,{},$)],ie[0]>qs&&xt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):se.kind==="composite"&&(ie=[Lo*L.compositeTextSizes[0].evaluate(m,{},$),Lo*L.compositeTextSizes[1].evaluate(m,{},$)],(ie[0]>qs||ie[1]>qs)&&xt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,ee,ie,v,f,m,S,e,t,x.lineStartIndex,x.lineLength,P,O,$);for(const re of A)I[re]=i.text.placedSymbolArray.length-1;return 4*ee.length}function hv(i){for(const e in i)return i[e];return null}function nf(i,e,t,o,l,u,f,m,v,x){let S=f.top,A=f.bottom,I=f.left,P=f.right;const L=f.collisionPadding;if(L&&(I-=L[0],S-=L[1],P+=L[2],A+=L[3]),v){const O=new U(I,S),$=new U(P,S),ee=new U(I,A),se=new U(P,A),ie=ve(v);let re=new U(0,0);x&&(re=new U(x[0],x[1])),O._rotateAround(ie,re),$._rotateAround(ie,re),ee._rotateAround(ie,re),se._rotateAround(ie,re),I=Math.min(O.x,$.x,ee.x,se.x),P=Math.max(O.x,$.x,ee.x,se.x),S=Math.min(O.y,$.y,ee.y,se.y),A=Math.max(O.y,$.y,ee.y,se.y)}return i.emplaceBack(e.x,e.y,e.z,t.x,t.y,I,S,P,A,m,o,l,u),i.length-1}function Sm(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const e=i.bottom-i.top;return e>0?Math.max(10,e):null}function NT(i,e,t,o){const l=i.compareText;if(e in l){const u=l[e];for(let f=u.length-1;f>=0;f--)if(o.dist(u[f])<t)return!0}else l[e]=[];return l[e].push(o),!1}const jT=it([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:dv}=jT,fv=it([{name:"a_pos_3",components:3,type:"Int16"}]);var Yu=it([{name:"a_pos",type:"Int16",components:2}]);const hs=ei/Math.PI/2,Cm=2*Gr(1,0)*hs*Math.PI,lc=[64,32,16],ho=-hs,fo=hs,qT=[new vr([ho,ho,ho],[fo,fo,fo]),new vr([ho,ho,ho],[0,0,fo]),new vr([0,ho,ho],[fo,0,fo]),new vr([ho,0,ho],[0,fo,fo]),new vr([0,0,ho],[fo,fo,fo])];function pv(i,e,t,o=!0){const l=co([],i._camera.position,i.worldSize),u=[e,t,1,1];Za(u,u,i.pixelMatrixInverse),sy(u,u,1/u[3]);const f=lr([],uo([],u,l)),m=i.globeMatrix,v=[m[12],m[13],m[14]],x=uo([],v,l),S=Ru(x),A=lr([],x),I=i.worldSize/(2*Math.PI),P=Wr(A,f),L=Math.asin(I/S);if(L<Math.acos(P)){if(!o)return null;const yt=[],Ne=[];co(yt,f,S/P),lr(Ne,uo(Ne,yt,x)),lr(f,js(f,x,co(f,Ne,Math.tan(L)*S)))}const O=[];new rm(l,f).closestPointOnSphere(v,I,O);const $=lr([],Bi(m,0)),ee=lr([],Bi(m,1)),se=lr([],Bi(m,2)),ie=Wr($,O),re=Wr(ee,O),pe=Wr(se,O),ae=ze(Math.asin(-re/I));let Oe=ze(Math.atan2(ie,pe));Oe=i.center.lng+function(yt,Ne){const et=(Ne-yt+180)%360-180;return et<-180?et+360:et}(i.center.lng,Oe);const Re=zo(Oe),We=Se(ss(ae),0,1);return new Kl(Re,We)}class $T{constructor(e,t,o){this.a=uo([],e,o),this.b=uo([],t,o),this.center=o;const l=lr([],this.a),u=lr([],this.b);this.angle=Math.acos(Wr(l,u))}}function Am(i,e){if(i.angle===0)return null;let t;return t=i.a[e]===0?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[e]/i.a[e]/Math.sin(i.angle)-1/Math.tan(i.angle)),t<0||t>1?null:function(o,l,u,f){const m=Math.sin(u);return o*(Math.sin((1-f)*u)/m)+l*(Math.sin(f*u)/m)}(i.a[e],i.b[e],i.angle,Se(t,0,1))+i.center[e]}function Bo(i){if(i.z<=1)return qT[i.z+2*i.y+i.x];const e=Mm(rf(i));return vr.fromPoints(e)}function mv(i,e){const t=eh(e.zoom);if(t===0)return Bo(i);const o=rf(i),l=Mm(o),u=zo(o.getWest())*e.worldSize,f=zo(o.getEast())*e.worldSize,m=ss(o.getNorth())*e.worldSize,v=ss(o.getSouth())*e.worldSize,x=[u,m,0],S=[f,m,0],A=[u,v,0],I=[f,v,0],P=Yp([],e.globeMatrix);return zn(x,x,P),zn(S,S,P),zn(A,A,P),zn(I,I,P),l[0]=Cs(l[0],A,t),l[1]=Cs(l[1],I,t),l[2]=Cs(l[2],S,t),l[3]=Cs(l[3],x,t),vr.fromPoints(l)}function _v(i,e,t,o,l){for(const u of t)zn(u,u,o),co(u,u,l),tm(i,i,u),im(e,e,u)}function GT(i,e,t){const o=e/i.worldSize,l=Number.MAX_VALUE,u=[-l,-l,-l],f=[l,l,l],m=i.globeMatrix;if(t.z<=1)return _v(f,u,Bo(t).getCorners(),m,o),new vr(f,u);const v=rf(t),x=Mm(v);if(_v(f,u,x,m,o),v.contains(i.center)){u[2]=0;const Oe=i.point,Re=[Oe.x*o,Oe.y*o,0];return tm(f,f,Re),im(u,u,Re),new vr(f,u)}const S=[m[12]*o,m[13]*o,m[14]*o],A=v.getCenter(),I=Se(i.center.lat,-85.051129,Po),P=Se(A.lat,-85.051129,Po),L=zo(i.center.lng),O=ss(I);let $=L-zo(A.lng);const ee=O-ss(P);$>.5?$-=1:$<-.5&&($+=1);let se=0;Math.abs($)>Math.abs(ee)?se=$>=0?1:3:(se=ee>=0?0:2,Vd(S,S,[m[4]*o,m[5]*o,m[6]*o],-Math.sin(ve(ee>=0?v.getSouth():v.getNorth()))*hs));const ie=x[se],re=x[(se+1)%4],pe=new $T(ie,re,S),ae=[Am(pe,0)||ie[0],Am(pe,1)||ie[1],Am(pe,2)||ie[2]];return f[2]=Math.min(ie[2],re[2]),tm(f,f,ae),im(u,u,ae),new vr(f,u)}function rf({x:i,y:e,z:t}){const o=1/(1<<t),l=new Oi(Zr(i*o),Wn((e+1)*o)),u=new Oi(Zr((i+1)*o),Wn(e*o));return new Ns(l,u)}function Mm(i){const e=ve(i.getNorth()),t=ve(i.getSouth()),o=Math.cos(e),l=Math.cos(t),u=Math.sin(e),f=Math.sin(t),m=i.getWest(),v=i.getEast();return[cc(l,f,m),cc(l,f,v),cc(o,u,v),cc(o,u,m)]}function cc(i,e,t,o=hs){return t=ve(t),[i*Math.sin(t)*o,-e*o,i*Math.cos(t)*o]}function of(i,e,t){return cc(Math.cos(ve(i)),Math.sin(ve(i)),e,t)}function Ju(i,e,t,o){const l=1<<t.z,u=(i/ei+t.x)/l;return of(Wn((e/ei+t.y)/l),Zr(u),o)}function sf({min:i,max:e}){return 16383/Math.max(e[0]-i[0],e[1]-i[1],e[2]-i[2])}const gv=new Float64Array(16);function Qu(i){const e=sf(i),t=ty(gv,[e,e,e]);return Bu(t,t,((o=[])[0]=-(l=i.min)[0],o[1]=-l[1],o[2]=-l[2],o));var o,l}function Im(i){const e=(o=i.min,(t=gv)[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=o[0],t[13]=o[1],t[14]=o[2],t[15]=1,t);var t,o;const l=1/sf(i);return Ga(e,e,[l,l,l])}function yv(i,e,t,o,l){const u=function(v){const x=ei/(2*Math.PI);return v/(2*Math.PI)/x}(t),f=[i,e,-t/(2*Math.PI)],m=Do(new Float64Array(16));return Bu(m,m,f),Ga(m,m,[u,u,u]),Jp(m,m,ve(-l)),Od(m,m,ve(-o)),m}function eh(i){return De(5,6,i)}function vv(i,e){const t=of(e.lat,e.lng);return u=(o=em([],function(P){const L=of(P._center.lat,P._center.lng);let O=nm([],Ql(0,1,0),L);const $=iy([],-P.angle,L);O=zn(O,O,$),iy($,-P._pitch,O);const ee=lr([],L);return co(ee,ee,P.cameraToCenterDistance/P.pixelsPerMeter*Cm),zn(ee,ee,$),js([],L,ee)}(i),t))[0],f=o[1],m=o[2],v=(l=t)[0],x=l[1],S=l[2],I=(A=Math.sqrt(u*u+f*f+m*m)*Math.sqrt(v*v+x*x+S*S))&&Wr(o,l)/A,Math.acos(Math.min(Math.max(I,-1),1));var o,l,u,f,m,v,x,S,A,I}const xv=ve(85),ZT=Math.cos(xv),WT=Math.sin(xv);function bv(i,e){const t=i.fovAboveCenter,o=i.elevation?i.elevation.getMinElevationBelowMSL()*e:0,l=(i._camera.position[2]*i.worldSize-o)/Math.cos(i._pitch),u=Math.sin(t)*l/Math.sin(Math.max(Math.PI/2-i._pitch-t,.01)),f=Math.sin(i._pitch)*u+l;return Math.min(1.01*f,l*(1/i._horizonShift))}function Xa(i,e){if(!e.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:e};const t=Math.pow(2,-i.z),o=i.x*t,l=(i.x+1)*t,u=i.y*t,f=(i.y+1)*t,m=Zr(o),v=Zr(l),x=Wn(u),S=Wn(f),A=e.project(m,x),I=e.project(v,x),P=e.project(v,S),L=e.project(m,S);let O=Math.min(A.x,I.x,P.x,L.x),$=Math.min(A.y,I.y,P.y,L.y),ee=Math.max(A.x,I.x,P.x,L.x),se=Math.max(A.y,I.y,P.y,L.y);const ie=t/16;function re(ae,Oe,Re,We,yt,Ne){const et=(Re+yt)/2,at=(We+Ne)/2,tt=e.project(Zr(et),Wn(at)),ft=Math.max(0,O-tt.x,$-tt.y,tt.x-ee,tt.y-se);O=Math.min(O,tt.x),ee=Math.max(ee,tt.x),$=Math.min($,tt.y),se=Math.max(se,tt.y),ft>ie&&(re(ae,tt,Re,We,et,at),re(tt,Oe,et,at,yt,Ne))}re(A,I,o,u,l,u),re(I,P,l,u,l,f),re(P,L,l,f,o,f),re(L,A,o,f,o,u),O-=ie,$-=ie,ee+=ie,se+=ie;const pe=1/Math.max(ee-O,se-$);return{scale:pe,x:O*pe,y:$*pe,x2:ee*pe,y2:se*pe,projection:e}}const HT=Do(new Float32Array(16));class $s{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new Oi(0,0)}projectTilePoint(e,t,o){return{x:e,y:t,z:0}}locationPoint(e,t,o=!0){return e._coordinatePoint(e.locationCoordinate(t),o)}pixelsPerMeter(e,t){return Gr(1,e)*t}pixelSpaceConversion(e,t,o){return 1}farthestPixelDistance(e){return bv(e,e.pixelsPerMeter)}pointCoordinate(e,t,o,l){const u=e.horizonLineFromTop(!1),f=new U(t,Math.max(u,o));return e.rayIntersectionCoordinate(e.pointRayIntersection(f,l))}pointCoordinate3D(e,t,o){const l=new U(t,o);if(e.elevation)return e.elevation.pointCoordinate(l);{const u=this.pointCoordinate(e,l.x,l.y,0);return[u.x,u.y,u.z]}}isPointAboveHorizon(e,t){if(e.elevation)return!this.pointCoordinate3D(e,t.x,t.y);const o=e.horizonLineFromTop();return t.y<o}createInversionMatrix(e,t){return HT}createTileMatrix(e,t,o){let l,u,f;const m=o.canonical,v=Do(new Float64Array(16));if(this.isReprojectedInTileSpace){const x=Xa(m,this);l=1,u=x.x+o.wrap*x.scale,f=x.y,Ga(v,v,[l/x.scale,l/x.scale,e.pixelsPerMeter/t])}else l=t/e.zoomScale(m.z),u=(m.x+Math.pow(2,m.z)*o.wrap)*l,f=m.y*l;return Bu(v,v,[u,f,0]),Ga(v,v,[l/ei,l/ei,1]),v}upVector(e,t,o){return[0,0,1]}upVectorScale(e,t,o){return{metersToTile:1}}}class XT extends $s{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,o]=this.parallels=e.parallels||[29.5,45.5],l=Math.sin(ve(t));this.n=(l+Math.sin(ve(o)))/2,this.c=1+l*(2*this.n-l),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n:o,c:l,r0:u}=this,f=ve(e-this.center[0]),m=ve(t),v=Math.sqrt(l-2*o*Math.sin(m))/o;return{x:v*Math.sin(f*o),y:v*Math.cos(f*o)-u,z:0}}unproject(e,t){const{n:o,c:l,r0:u}=this,f=u+t;let m=Math.atan2(e,Math.abs(f))*Math.sign(f);f*o<0&&(m-=Math.PI*Math.sign(e)*Math.sign(f));const v=ve(this.center[0])*o;m=be(m,-Math.PI-v,Math.PI-v);const x=ze(m/o)+this.center[0],S=Math.asin(Se((l-(e*e+f*f)*o*o)/(2*o),-1,1)),A=Se(ze(S),-85.051129,Po);return new Oi(x,A)}}const th=1.340264,ih=-.081106,nh=893e-6,rh=.003796,af=Math.sqrt(3)/2;class KT extends $s{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const o=Math.asin(af*Math.sin(t)),l=o*o,u=l*l*l;return{x:.5*(e*Math.cos(o)/(af*(th+3*ih*l+u*(7*nh+9*rh*l)))/Math.PI+.5),y:1-.5*(o*(th+ih*l+u*(nh+rh*l))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let o=t=(2*(1-t)-1)*Math.PI,l=o*o,u=l*l*l;for(let S,A,I,P=0;P<12&&(A=o*(th+ih*l+u*(nh+rh*l))-t,I=th+3*ih*l+u*(7*nh+9*rh*l),S=A/I,o=Se(o-S,-Math.PI/3,Math.PI/3),l=o*o,u=l*l*l,!(Math.abs(S)<1e-12));++P);const f=af*e*(th+3*ih*l+u*(7*nh+9*rh*l))/Math.cos(o),m=Math.asin(Math.sin(o)/af),v=Se(180*f/Math.PI,-180,180),x=Se(180*m/Math.PI,-85.051129,Po);return new Oi(v,x)}}class YT extends $s{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const o=360*(e-.5),l=Se(360*(.5-t),-85.051129,Po);return new Oi(o,l)}}const uc=Math.PI/2;function lf(i){return Math.tan((uc+i)/2)}class JT extends $s{constructor(e){super(e),this.center=e.center||[0,30];const[t,o]=this.parallels=e.parallels||[30,30],l=ve(t),u=ve(o),f=Math.cos(l);this.n=l===u?Math.sin(l):Math.log(f/Math.cos(u))/Math.log(lf(u)/lf(l)),this.f=f*Math.pow(lf(l),this.n)/this.n}project(e,t){t=ve(t),e=ve(e-this.center[0]);const o=1e-6,{n:l,f:u}=this;u>0?t<-uc+o&&(t=-uc+o):t>uc-o&&(t=uc-o);const f=u/Math.pow(lf(t),l),m=f*Math.sin(l*e),v=u-f*Math.cos(l*e);return{x:.5*(m/Math.PI+.5),y:1-.5*(v/Math.PI+.5),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,t=(2*(1-t)-.5)*Math.PI;const{n:o,f:l}=this,u=l-t,f=Math.sign(u),m=Math.sign(o)*Math.sqrt(e*e+u*u);let v=Math.atan2(e,Math.abs(u))*f;u*o<0&&(v-=Math.PI*Math.sign(e)*f);const x=Se(ze(v/o)+this.center[0],-180,180),S=Se(ze(2*Math.atan(Math.pow(l/m,1/o))-uc),-85.051129,Po);return new Oi(x,S)}}class wv extends $s{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:zo(e),y:ss(t),z:0}}unproject(e,t){const o=Zr(e),l=Wn(t);return new Oi(o,l)}}const Tv=ve(Po);class QT extends $s{project(e,t){const o=(t=ve(t))*t,l=o*o;return{x:.5*((e=ve(e))*(.8707-.131979*o+l*(l*(.003971*o-.001529*l)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+o*(.015085+l*(.028874*o-.044475-.005916*l)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let o=t=(2*(1-t)-1)*Math.PI,l=25,u=0,f=o*o;do{f=o*o;const x=f*f;u=(o*(1.007226+f*(.015085+x*(.028874*f-.044475-.005916*x)))-t)/(1.007226+f*(.045255+x*(.259866*f-.311325-.005916*11*x))),o=Se(o-u,-Tv,Tv)}while(Math.abs(u)>1e-6&&--l>0);f=o*o;const m=Se(ze(e/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),v=ze(o);return new Oi(m,v)}}const Ev=ve(Po);class e2 extends $s{project(e,t){t=ve(t),e=ve(e);const o=Math.cos(t),l=2/Math.PI,u=Math.acos(o*Math.cos(e/2)),f=Math.sin(u)/u,m=.5*(e*l+2*o*Math.sin(e/2)/f)||0,v=.5*(t+Math.sin(t)/f)||0;return{x:.5*(m/Math.PI+.5),y:1-.5*(v/Math.PI+1),z:0}}unproject(e,t){let o=e=(2*e-.5)*Math.PI,l=t=(2*(1-t)-1)*Math.PI,u=25;const f=1e-6;let m=0,v=0;do{const x=Math.cos(l),S=Math.sin(l),A=2*S*x,I=S*S,P=x*x,L=Math.cos(o/2),O=Math.sin(o/2),$=2*L*O,ee=O*O,se=1-P*L*L,ie=se?1/se:0,re=se?Math.acos(x*L)*Math.sqrt(1/se):0,pe=.5*(2*re*x*O+2*o/Math.PI)-e,ae=.5*(re*S+l)-t,Oe=.5*ie*(P*ee+re*x*L*I)+1/Math.PI,Re=ie*($*A/4-re*S*O),We=.125*ie*(A*O-re*S*P*$),yt=.5*ie*(I*L+re*ee*x)+.5,Ne=Re*We-yt*Oe;m=(ae*Re-pe*yt)/Ne,v=(pe*We-ae*Oe)/Ne,o=Se(o-m,-Math.PI,Math.PI),l=Se(l-v,-Ev,Ev)}while((Math.abs(m)>f||Math.abs(v)>f)&&--u>0);return new Oi(ze(o),ze(l))}}class Sv extends $s{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ve(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:o,cosPhi:l}=this;return{x:ve(e)*l*o+.5,y:-Math.sin(ve(t))/l*o+.5,z:0}}unproject(e,t){const{scale:o,cosPhi:l}=this,u=-(t-.5)/o,f=Se(ze((e-.5)/o)/l,-180,180),m=Math.asin(Se(u*l,-1,1)),v=Se(ze(m),-85.051129,Po);return new Oi(f,v)}}class t2 extends wv{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,t,o){const l=Ju(e,t,o);return zn(l,l,Qu(Bo(o))),{x:l[0],y:l[1],z:l[2]}}locationPoint(e,t){const o=of(t.lat,t.lng),l=lr([],o),u=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(t),e._centerAltitude):e._centerAltitude;Vd(o,o,l,Gr(1,0)*ei*u);const f=Do(new Float64Array(16));return Jl(f,e.pixelMatrix,e.globeMatrix),zn(o,o,f),new U(o[0],o[1])}pixelsPerMeter(e,t){return Gr(1,0)*t}pixelSpaceConversion(e,t,o){const l=Ai(Gr(1,45)*t,Gr(1,e)*t,o);return this.pixelsPerMeter(e,t)/l}createTileMatrix(e,t,o){const l=Im(Bo(o.canonical));return Jl(new Float64Array(16),e.globeMatrix,l)}createInversionMatrix(e,t){const{center:o}=e,l=Qu(Bo(t));return Od(l,l,ve(o.lng)),Jp(l,l,ve(o.lat)),Ga(l,l,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(l)}pointCoordinate(e,t,o,l){return pv(e,t,o,!0)||new Kl(0,0)}pointCoordinate3D(e,t,o){const l=this.pointCoordinate(e,t,o,0);return[l.x,l.y,l.z]}isPointAboveHorizon(e,t){return!pv(e,t.x,t.y,!1)}farthestPixelDistance(e){const t=function(l,u){const f=l.cameraToCenterDistance,m=l._centerAltitude*u,v=l._camera,x=l._camera.forward(),S=js([],co([],x,-f),[0,0,m]),A=l.worldSize/(2*Math.PI),I=[0,0,-A],P=l.width/l.height,L=Math.tan(l.fovAboveCenter),O=co([],v.up(),L),$=co([],v.right(),L*P),ee=lr([],js([],js([],x,O),$)),se=[];let ie;if(new rm(S,ee).closestPointOnSphere(I,A,se)){const re=js([],se,I),pe=uo([],re,S);ie=Math.cos(l.fovAboveCenter)*Ru(pe)}else{const re=uo([],S,I),pe=uo([],I,S);lr(pe,pe);const ae=Ru(re)-A;ie=Math.sqrt(ae*(ae+2*A));const Oe=Math.acos(ie/(A+ae))-Math.acos(Wr(x,pe));ie*=Math.cos(Oe)}return 1.01*ie}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),o=eh(e.zoom);if(o>0){const l=bv(e,Gr(1,e.center.lat)*e.worldSize),u=e.worldSize/(2*Math.PI),f=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Ai(t,l+u*(1-Math.cos(f)),Math.pow(o,10))}return t}upVector(e,t,o){return Ju(t,o,e,1)}upVectorScale(e){return{metersToTile:Cm*sf(Bo(e))}}}function Cv(i){const e=i.parallels,t=!!e&&Math.abs(e[0]+e[1])<.01;switch(i.name){case"mercator":return new wv(i);case"equirectangular":return new YT(i);case"naturalEarth":return new QT(i);case"equalEarth":return new KT(i);case"winkelTripel":return new e2(i);case"albers":return t?new Sv(i):new XT(i);case"lambertConformalConic":return t?new Sv(i):new JT(i);case"globe":return new t2(i)}throw new Error(`Invalid projection name: ${i.name}`)}const i2=Ha.VectorTileFeature.types,n2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function cf(i,e,t,o,l,u,f,m,v,x,S,A,I){const P=m?Math.min(qs,Math.round(m[0])):0,L=m?Math.min(qs,Math.round(m[1])):0;i.emplaceBack(e,t,Math.round(32*o),Math.round(32*l),u,f,(P<<1)+(v?1:0),L,16*x,16*S,256*A,256*I)}function uf(i,e,t,o,l,u,f){i.emplaceBack(e,t,o,l,u,f)}function hf(i,e,t,o,l){i.emplaceBack(e,t,o,l),i.emplaceBack(e,t,o,l),i.emplaceBack(e,t,o,l),i.emplaceBack(e,t,o,l)}function r2(i){for(const e of i.sections)if(a(e.text))return!0;return!1}class km{constructor(e){this.layoutVertexArray=new Qi,this.indexArray=new _i,this.programConfigurations=e,this.segments=new An,this.dynamicLayoutVertexArray=new xi,this.opacityVertexArray=new ji,this.placedSymbolArray=new Cg,this.globeExtVertexArray=new hn}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,t,o,l){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,sT.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,lT.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,n2,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,aT.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Bt(km,"SymbolBuffers");class zm{constructor(e,t,o){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new o,this.segments=new An,this.collisionVertexArray=new en,this.collisionVertexArrayExt=new nn}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,cT.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,uT.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Bt(zm,"CollisionBuffers");class Gs{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(f=>f.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Do([]),this.placementViewportMatrix=Do([]);const t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=mm(this.zoom,t["text-size"]),this.iconSizeData=mm(this.zoom,t["icon-size"]);const o=this.layers[0].layout,l=o.get("symbol-sort-key"),u=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&l.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(f=>Ur[f]),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new km(new ja(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new km(new ja(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Ig,this.lineVertexArray=new kg,this.symbolInstances=new Mg}calculateGlyphDependencies(e,t,o,l,u){for(let f=0;f<e.length;f++)if(t[e.charCodeAt(f)]=!0,l&&u){const m=Wu[e.charAt(f)];m&&(t[m.charCodeAt(0)]=!0)}}populate(e,t,o,l){const u=this.layers[0],f=u.layout,m=this.projection.name==="globe",v=f.get("text-font"),x=f.get("text-field"),S=f.get("icon-image"),A=(x.value.kind!=="constant"||x.value.value instanceof sr&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),I=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,P=f.get("symbol-sort-key");if(this.features=[],!A&&!I)return;const L=t.iconDependencies,O=t.glyphDependencies,$=t.availableImages,ee=new W(this.zoom);for(const{feature:se,id:ie,index:re,sourceLayerIndex:pe}of e){const ae=u._featureFilter.needGeometry,Oe=qa(se,ae);if(!u._featureFilter.filter(ee,Oe,o))continue;if(ae||(Oe.geometry=as(se,o,l)),m&&se.type!==1&&o.z<=5){const Ne=Oe.geometry,et=.98078528056;for(let at=0;at<Ne.length;at++)Ne[at]=aw(Ne[at],tt=>tt,(tt,ft)=>Wr(Ju(tt.x,tt.y,o,1),Ju(ft.x,ft.y,o,1))<et)}let Re,We;if(A){const Ne=u.getValueAndResolveTokens("text-field",Oe,o,$),et=sr.factory(Ne);r2(et)&&(this.hasRTLText=!0),(!this.hasRTLText||j()==="unavailable"||this.hasRTLText&&Z.isParsed())&&(Re=fT(et,u,Oe))}if(I){const Ne=u.getValueAndResolveTokens("icon-image",Oe,o,$);We=Ne instanceof ar?Ne:ar.fromString(Ne)}if(!Re&&!We)continue;const yt=this.sortFeaturesByKey?P.evaluate(Oe,{},o):void 0;if(this.features.push({id:ie,text:Re,icon:We,index:re,sourceLayerIndex:pe,geometry:Oe.geometry,properties:se.properties,type:i2[se.type],sortKey:yt}),We&&(L[We.name]=!0),Re){const Ne=v.evaluate(Oe,{},o).join(","),et=f.get("text-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ur.vertical)>=0;for(const at of Re.sections)if(at.image)L[at.image.name]=!0;else{const tt=Wl(Re.toString()),ft=at.fontStack||Ne,lt=O[ft]=O[ft]||{};this.calculateGlyphDependencies(at.text,lt,et,this.allowVerticalPlacement,tt)}}}f.get("symbol-placement")==="line"&&(this.features=function(se){const ie={},re={},pe=[];let ae=0;function Oe(Ne){pe.push(se[Ne]),ae++}function Re(Ne,et,at){const tt=re[Ne];return delete re[Ne],re[et]=tt,pe[tt].geometry[0].pop(),pe[tt].geometry[0]=pe[tt].geometry[0].concat(at[0]),tt}function We(Ne,et,at){const tt=ie[et];return delete ie[et],ie[Ne]=tt,pe[tt].geometry[0].shift(),pe[tt].geometry[0]=at[0].concat(pe[tt].geometry[0]),tt}function yt(Ne,et,at){const tt=at?et[0][et[0].length-1]:et[0][0];return`${Ne}:${tt.x}:${tt.y}`}for(let Ne=0;Ne<se.length;Ne++){const et=se[Ne],at=et.geometry,tt=et.text?et.text.toString():null;if(!tt){Oe(Ne);continue}const ft=yt(tt,at),lt=yt(tt,at,!0);if(ft in re&&lt in ie&&re[ft]!==ie[lt]){const kt=We(ft,lt,at),li=Re(ft,lt,pe[kt].geometry);delete ie[ft],delete re[lt],re[yt(tt,pe[li].geometry,!0)]=li,pe[kt].geometry=null}else ft in re?Re(ft,lt,at):lt in ie?We(ft,lt,at):(Oe(Ne),ie[ft]=ae-1,re[lt]=ae-1)}return pe.filter(Ne=>Ne.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((se,ie)=>se.sortKey-ie.sortKey)}update(e,t,o,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,o,l),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,o,l))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Cv(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const o=this.lineVertexArray.length,l=e.segment;if(l!==void 0){let u=e.dist(t[l+1]),f=e.dist(t[l]);const m={};for(let v=l+1;v<t.length;v++)m[v]={x:t[v].x,y:t[v].y,tileUnitDistanceFromAnchor:u},v<t.length-1&&(u+=t[v+1].dist(t[v]));for(let v=l||0;v>=0;v--)m[v]={x:t[v].x,y:t[v].y,tileUnitDistanceFromAnchor:f},v>0&&(f+=t[v-1].dist(t[v]));for(let v=0;v<t.length;v++){const x=m[v];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,t,o,l,u,f,m,v,x,S,A,I,P,L){const O=e.indexArray,$=e.layoutVertexArray,ee=e.globeExtVertexArray,se=e.segments.prepareSegment(4*t.length,$,O,this.canOverlap?f.sortKey:void 0),ie=this.glyphOffsetArray.length,re=se.vertexLength,pe=this.allowVerticalPlacement&&m===Ur.vertical?Math.PI/2:0,ae=f.text&&f.text.sections;for(let Re=0;Re<t.length;Re++){const{tl:We,tr:yt,bl:Ne,br:et,tex:at,pixelOffsetTL:tt,pixelOffsetBR:ft,minFontScaleX:lt,minFontScaleY:kt,glyphOffset:li,isSDF:hi,sectionIndex:Gt}=t[Re],Tt=se.vertexLength,bi=li[1];if(cf($,x.x,x.y,We.x,bi+We.y,at.x,at.y,o,hi,tt.x,tt.y,lt,kt),cf($,x.x,x.y,yt.x,bi+yt.y,at.x+at.w,at.y,o,hi,ft.x,tt.y,lt,kt),cf($,x.x,x.y,Ne.x,bi+Ne.y,at.x,at.y+at.h,o,hi,tt.x,ft.y,lt,kt),cf($,x.x,x.y,et.x,bi+et.y,at.x+at.w,at.y+at.h,o,hi,ft.x,ft.y,lt,kt),v){const oi=v.anchor,Dt=v.up;uf(ee,oi.x,oi.y,oi.z,Dt[0],Dt[1],Dt[2]),uf(ee,oi.x,oi.y,oi.z,Dt[0],Dt[1],Dt[2]),uf(ee,oi.x,oi.y,oi.z,Dt[0],Dt[1],Dt[2]),uf(ee,oi.x,oi.y,oi.z,Dt[0],Dt[1],Dt[2]),hf(e.dynamicLayoutVertexArray,oi.x,oi.y,oi.z,pe)}else hf(e.dynamicLayoutVertexArray,x.x,x.y,x.z,pe);O.emplaceBack(Tt,Tt+1,Tt+2),O.emplaceBack(Tt+1,Tt+2,Tt+3),se.vertexLength+=4,se.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(li[0]),Re!==t.length-1&&Gt===t[Re+1].sectionIndex||e.programConfigurations.populatePaintArrays($.length,f,f.index,{},P,L,ae&&ae[Gt])}const Oe=v?v.anchor:x;e.placedSymbolArray.emplaceBack(Oe.x,Oe.y,Oe.z,x.x,x.y,ie,this.glyphOffsetArray.length-ie,re,S,A,x.segment,o?o[0]:0,o?o[1]:0,l[0],l[1],m,0,!1,0,I,0)}_commitLayoutVertex(e,t,o,l,u,f,m){e.emplaceBack(t,o,l,u,f,Math.round(m.x),Math.round(m.y))}_addCollisionDebugVertices(e,t,o,l,u,f,m){const v=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),x=v.vertexLength,S=m.tileAnchorX,A=m.tileAnchorY;for(let P=0;P<4;P++)o.collisionVertexArray.emplaceBack(0,0,0,0);o.collisionVertexArrayExt.emplaceBack(t,-e.padding,-e.padding),o.collisionVertexArrayExt.emplaceBack(t,e.padding,-e.padding),o.collisionVertexArrayExt.emplaceBack(t,e.padding,e.padding),o.collisionVertexArrayExt.emplaceBack(t,-e.padding,e.padding),this._commitLayoutVertex(o.layoutVertexArray,l,u,f,S,A,new U(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,l,u,f,S,A,new U(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,l,u,f,S,A,new U(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,l,u,f,S,A,new U(e.x1,e.y2)),v.vertexLength+=4;const I=o.indexArray;I.emplaceBack(x,x+1),I.emplaceBack(x+1,x+2),I.emplaceBack(x+2,x+3),I.emplaceBack(x+3,x),v.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,o,l,u,f){for(let m=l;m<u;m++){const v=o.get(m),x=this.getSymbolInstanceTextSize(e,f,t,m);this._addCollisionDebugVertices(v,x,this.textCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,f)}}_addIconDebugCollisionBoxes(e,t,o,l,u,f){for(let m=l;m<u;m++){const v=o.get(m),x=this.getSymbolInstanceIconSize(e,t,m);this._addCollisionDebugVertices(v,x,this.iconCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,f)}}generateCollisionDebugBuffers(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new zm(Vr,Vy.members,Jn),this.iconCollisionBox=new zm(Vr,Vy.members,Jn);const o=ic(this.iconSizeData,e),l=ic(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){const f=this.symbolInstances.get(u);this._addTextDebugCollisionBoxes(l,e,t,f.textBoxStartIndex,f.textBoxEndIndex,f),this._addTextDebugCollisionBoxes(l,e,t,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f),this._addIconDebugCollisionBoxes(o,e,t,f.iconBoxStartIndex,f.iconBoxEndIndex,f),this._addIconDebugCollisionBoxes(o,e,t,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f)}}getSymbolInstanceTextSize(e,t,o,l){const u=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:l),f=Kd(this.textSizeData,e,u)/Hn;return this.tilePixelRatio*f}getSymbolInstanceIconSize(e,t,o){const l=this.icon.placedSymbolArray.get(o),u=Kd(this.iconSizeData,e,l);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(e,t,o){e.emplaceBack(t,-o,-o),e.emplaceBack(t,o,-o),e.emplaceBack(t,o,o),e.emplaceBack(t,-o,o)}_updateTextDebugCollisionBoxes(e,t,o,l,u,f){for(let m=l;m<u;m++){const v=o.get(m),x=this.getSymbolInstanceTextSize(e,f,t,m);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,x,v.padding)}}_updateIconDebugCollisionBoxes(e,t,o,l,u){for(let f=l;f<u;f++){const m=o.get(f),v=this.getSymbolInstanceIconSize(e,t,f);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,v,m.padding)}}updateCollisionDebugBuffers(e,t){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const o=ic(this.iconSizeData,e),l=ic(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){const f=this.symbolInstances.get(u);this._updateTextDebugCollisionBoxes(l,e,t,f.textBoxStartIndex,f.textBoxEndIndex,f),this._updateTextDebugCollisionBoxes(l,e,t,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f),this._updateIconDebugCollisionBoxes(o,e,t,f.iconBoxStartIndex,f.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(o,e,t,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,o,l,u,f,m,v,x){const S={};for(let A=t;A<o;A++){const I=e.get(A);S.textBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,padding:I.padding,projectedAnchorX:I.projectedAnchorX,projectedAnchorY:I.projectedAnchorY,projectedAnchorZ:I.projectedAnchorZ,tileAnchorX:I.tileAnchorX,tileAnchorY:I.tileAnchorY},S.textFeatureIndex=I.featureIndex;break}for(let A=l;A<u;A++){const I=e.get(A);S.verticalTextBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,padding:I.padding,projectedAnchorX:I.projectedAnchorX,projectedAnchorY:I.projectedAnchorY,projectedAnchorZ:I.projectedAnchorZ,tileAnchorX:I.tileAnchorX,tileAnchorY:I.tileAnchorY},S.verticalTextFeatureIndex=I.featureIndex;break}for(let A=f;A<m;A++){const I=e.get(A);S.iconBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,padding:I.padding,projectedAnchorX:I.projectedAnchorX,projectedAnchorY:I.projectedAnchorY,projectedAnchorZ:I.projectedAnchorZ,tileAnchorX:I.tileAnchorX,tileAnchorY:I.tileAnchorY},S.iconFeatureIndex=I.featureIndex;break}for(let A=v;A<x;A++){const I=e.get(A);S.verticalIconBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,padding:I.padding,projectedAnchorX:I.projectedAnchorX,projectedAnchorY:I.projectedAnchorY,projectedAnchorZ:I.projectedAnchorZ,tileAnchorX:I.tileAnchorX,tileAnchorY:I.tileAnchorY},S.verticalIconFeatureIndex=I.featureIndex;break}return S}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const o=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,t){const o=e.placedSymbolArray.get(t),l=o.vertexStartIndex+4*o.numGlyphs;for(let u=o.vertexStartIndex;u<l;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const t=Math.sin(e),o=Math.cos(e),l=[],u=[],f=[];for(let m=0;m<this.symbolInstances.length;++m){f.push(m);const v=this.symbolInstances.get(m);l.push(0|Math.round(t*v.tileAnchorX+o*v.tileAnchorY)),u.push(v.featureIndex)}return f.sort((m,v)=>l[m]-l[v]||u[v]-u[m]),f}addToSortKeyRanges(e,t){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===t?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const o=this.symbolInstances.get(t);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((l,u,f)=>{l>=0&&f.indexOf(l)===u&&this.addIndicesForPlacedSymbol(this.text,l)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Bt(Gs,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Gs.MAX_GLYPHS=65535,Gs.addDynamicAttributes=hf;const o2=new Je({"symbol-placement":new le(Ce.layout_symbol["symbol-placement"]),"symbol-spacing":new le(Ce.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new le(Ce.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ye(Ce.layout_symbol["symbol-sort-key"]),"symbol-z-order":new le(Ce.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new le(Ce.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new le(Ce.layout_symbol["icon-ignore-placement"]),"icon-optional":new le(Ce.layout_symbol["icon-optional"]),"icon-rotation-alignment":new le(Ce.layout_symbol["icon-rotation-alignment"]),"icon-size":new ye(Ce.layout_symbol["icon-size"]),"icon-text-fit":new le(Ce.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new le(Ce.layout_symbol["icon-text-fit-padding"]),"icon-image":new ye(Ce.layout_symbol["icon-image"]),"icon-rotate":new ye(Ce.layout_symbol["icon-rotate"]),"icon-padding":new le(Ce.layout_symbol["icon-padding"]),"icon-keep-upright":new le(Ce.layout_symbol["icon-keep-upright"]),"icon-offset":new ye(Ce.layout_symbol["icon-offset"]),"icon-anchor":new ye(Ce.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new le(Ce.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new le(Ce.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new le(Ce.layout_symbol["text-rotation-alignment"]),"text-field":new ye(Ce.layout_symbol["text-field"]),"text-font":new ye(Ce.layout_symbol["text-font"]),"text-size":new ye(Ce.layout_symbol["text-size"]),"text-max-width":new ye(Ce.layout_symbol["text-max-width"]),"text-line-height":new ye(Ce.layout_symbol["text-line-height"]),"text-letter-spacing":new ye(Ce.layout_symbol["text-letter-spacing"]),"text-justify":new ye(Ce.layout_symbol["text-justify"]),"text-radial-offset":new ye(Ce.layout_symbol["text-radial-offset"]),"text-variable-anchor":new le(Ce.layout_symbol["text-variable-anchor"]),"text-anchor":new ye(Ce.layout_symbol["text-anchor"]),"text-max-angle":new le(Ce.layout_symbol["text-max-angle"]),"text-writing-mode":new le(Ce.layout_symbol["text-writing-mode"]),"text-rotate":new ye(Ce.layout_symbol["text-rotate"]),"text-padding":new le(Ce.layout_symbol["text-padding"]),"text-keep-upright":new le(Ce.layout_symbol["text-keep-upright"]),"text-transform":new ye(Ce.layout_symbol["text-transform"]),"text-offset":new ye(Ce.layout_symbol["text-offset"]),"text-allow-overlap":new le(Ce.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new le(Ce.layout_symbol["text-ignore-placement"]),"text-optional":new le(Ce.layout_symbol["text-optional"])});var Pm={paint:new Je({"icon-opacity":new ye(Ce.paint_symbol["icon-opacity"]),"icon-color":new ye(Ce.paint_symbol["icon-color"]),"icon-halo-color":new ye(Ce.paint_symbol["icon-halo-color"]),"icon-halo-width":new ye(Ce.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ye(Ce.paint_symbol["icon-halo-blur"]),"icon-translate":new le(Ce.paint_symbol["icon-translate"]),"icon-translate-anchor":new le(Ce.paint_symbol["icon-translate-anchor"]),"text-opacity":new ye(Ce.paint_symbol["text-opacity"]),"text-color":new ye(Ce.paint_symbol["text-color"],{runtimeType:Br,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new ye(Ce.paint_symbol["text-halo-color"]),"text-halo-width":new ye(Ce.paint_symbol["text-halo-width"]),"text-halo-blur":new ye(Ce.paint_symbol["text-halo-blur"]),"text-translate":new le(Ce.paint_symbol["text-translate"]),"text-translate-anchor":new le(Ce.paint_symbol["text-translate-anchor"])}),layout:o2};class Av{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:ws,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Bt(Av,"FormatSectionOverride",{omit:["defaultValue"]});class df extends lo{constructor(e){super(e,Pm)}recalculate(e,t){super.recalculate(e,t),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const o=this.layout.get("text-writing-mode");if(o){const l=[];for(const u of o)l.indexOf(u)<0&&l.push(u);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,t,o,l){const u=this.layout.get(e).evaluate(t,{},o,l),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||Fl(f.value)||!u?u:function(m,v){return v.replace(/{([^{}]+)}/g,(x,S)=>S in m?String(m[S]):"")}(t.properties,u)}createBucket(e){return new Gs(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Pm.paint.overridableProperties){if(!df.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),o=new Av(t),l=new pu(o,t.property.specification);let u=null;u=t.value.kind==="constant"||t.value.kind==="source"?new mu("source",l):new Ia("composite",l,t.value.zoomStops,t.value._interpolationType),this.paint._values[e]=new oe(t.property,u,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,o){return!(!this.layout||t.isDataDriven()||o.isDataDriven())&&df.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const o=e.get("text-field"),l=Pm.paint.properties[t];let u=!1;const f=m=>{for(const v of m)if(l.overrides&&l.overrides.hasOverride(v))return void(u=!0)};if(o.value.kind==="constant"&&o.value.value instanceof sr)f(o.value.value.sections);else if(o.value.kind==="source"){const m=x=>{u||(x instanceof ga&&gn(x.value)===fa?f(x.value.sections):x instanceof va?f(x.sections):x.eachChild(m))},v=o.value;v._styleExpression&&m(v._styleExpression.expression)}return u}getProgramConfiguration(e){return new Us(this,e)}}var s2={paint:new Je({"background-color":new le(Ce.paint_background["background-color"]),"background-pattern":new dt(Ce.paint_background["background-pattern"]),"background-opacity":new le(Ce.paint_background["background-opacity"])})},a2={paint:new Je({"raster-opacity":new le(Ce.paint_raster["raster-opacity"]),"raster-hue-rotate":new le(Ce.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new le(Ce.paint_raster["raster-brightness-min"]),"raster-brightness-max":new le(Ce.paint_raster["raster-brightness-max"]),"raster-saturation":new le(Ce.paint_raster["raster-saturation"]),"raster-contrast":new le(Ce.paint_raster["raster-contrast"]),"raster-resampling":new le(Ce.paint_raster["raster-resampling"]),"raster-fade-duration":new le(Ce.paint_raster["raster-fade-duration"])})};class l2 extends lo{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var c2={paint:new Je({"sky-type":new le(Ce.paint_sky["sky-type"]),"sky-atmosphere-sun":new le(Ce.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new le(Ce.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new le(Ce.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new le(Ce.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ae(Ce.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new le(Ce.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new le(Ce.paint_sky["sky-atmosphere-color"]),"sky-opacity":new le(Ce.paint_sky["sky-opacity"])})};function Dm(i,e,t){const o=[0,0,1],l=ly([]);return uy(l,l,t?-ve(i)+Math.PI:ve(i)),cy(l,l,-ve(e)),oy(o,o,l),lr(o,o)}const u2={circle:class extends lo{constructor(i){super(i,pw)}createBucket(i){return new Hp(i)}queryRadius(i){const e=i;return Yl("circle-radius",this,e)+Yl("circle-stroke-width",this,e)+Rd(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,t,o,l,u,f,m){const v=Qg(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),x=this.paint.get("circle-radius").evaluate(e,t)+this.paint.get("circle-stroke-width").evaluate(e,t);return hy(i,o,u,f,m,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",v,x)}getProgramIds(){return["circle"]}getProgramConfiguration(i){return new Us(this,i)}},heatmap:class extends lo{createBucket(i){return new fy(i)}constructor(i){super(i,bw),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=lm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return Yl("heatmap-radius",this,i)}queryIntersectsFeature(i,e,t,o,l,u,f,m){const v=this.paint.get("heatmap-radius").evaluate(e,t);return hy(i,o,u,f,m,!0,!0,new U(0,0),v)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(i){return new Us(this,i)}},hillshade:class extends lo{constructor(i){super(i,ww)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends lo{constructor(i){super(i,Vw)}getProgramIds(){const i=this.paint.get("fill-pattern"),e=i&&i.constantOr(1),t=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&t.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),t}getProgramConfiguration(i){return new Us(this,i)}recalculate(i,e){super.recalculate(i,e);const t=this.paint._values["fill-outline-color"];t.value.kind==="constant"&&t.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Gd(i)}queryRadius(){return Rd(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,t,o,l,u){return!i.queryGeometry.isAboveHorizon&&Hg(Jg(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),o)}isTileClipped(){return!0}},"fill-extrusion":class extends lo{constructor(i){super(i,Jw)}createBucket(i){return new $u(i)}queryRadius(){return Rd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(i){return new Us(this,i)}queryIntersectsFeature(i,e,t,o,l,u,f,m,v){const x=Qg(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),S=this.paint.get("fill-extrusion-height").evaluate(e,t),A=this.paint.get("fill-extrusion-base").evaluate(e,t),I=[0,0],P=m&&u.elevation,L=u.elevation?u.elevation.exaggeration():1,O=i.tile.getBucket(this);if(P&&O instanceof $u){const se=O.centroidVertexArray,ie=v+1;if(ie<se.length){const re=se.get(ie);I[0]=re.a_centroid_pos0,I[1]=re.a_centroid_pos1}}if(I[0]===0&&I[1]===1)return!1;u.projection.name==="globe"&&(o=zy([o],[new U(0,0),new U(ei,ei)],i.tileID.canonical).map(se=>se.polygon).flat());const $=function(se,ie,re,pe,ae,Oe,Re,We,yt,Ne,et){return se.projection.name==="globe"?function(at,tt,ft,lt,kt,li,hi,Gt,Tt,bi,oi){const Dt=[],Yi=[],Gi=at.projection.upVectorScale(oi,at.center.lat,at.worldSize).metersToTile,rn=[0,0,0,1],fi=[0,0,0,1],Ii=(Zi,qi,tn,an)=>{Zi[0]=qi,Zi[1]=tn,Zi[2]=an,Zi[3]=1},Ji=ky();ft>0&&(ft+=Ji),lt+=Ji;for(const Zi of tt){const qi=[],tn=[];for(const an of Zi){const On=an.x+kt.x,xr=an.y+kt.y,Ti=at.projection.projectTilePoint(On,xr,oi),fn=at.projection.upVector(oi,an.x,an.y);let er=ft,Fi=lt;if(hi){const ln=By(On,xr,ft,lt,hi,Gt,Tt,bi);er+=ln.base,Fi+=ln.top}ft!==0?Ii(rn,Ti.x+fn[0]*Gi*er,Ti.y+fn[1]*Gi*er,Ti.z+fn[2]*Gi*er):Ii(rn,Ti.x,Ti.y,Ti.z),Ii(fi,Ti.x+fn[0]*Gi*Fi,Ti.y+fn[1]*Gi*Fi,Ti.z+fn[2]*Gi*Fi),zn(rn,rn,li),zn(fi,fi,li),qi.push(Hd(rn)),tn.push(Hd(fi))}Dt.push(qi),Yi.push(tn)}return[Dt,Yi]}(se,ie,re,pe,ae,Oe,Re,We,yt,Ne,et):Re?function(at,tt,ft,lt,kt,li,hi,Gt,Tt){const bi=[],oi=[],Dt=[0,0,0,1];for(const Yi of at){const Gi=[],rn=[];for(const fi of Yi){const Ii=fi.x+lt.x,Ji=fi.y+lt.y,Zi=By(Ii,Ji,tt,ft,li,hi,Gt,Tt);Dt[0]=Ii,Dt[1]=Ji,Dt[2]=Zi.base,Dt[3]=1,Za(Dt,Dt,kt),Dt[3]=Math.max(Dt[3],1e-5);const qi=Hd([Dt[0]/Dt[3],Dt[1]/Dt[3],Dt[2]/Dt[3]]);Dt[0]=Ii,Dt[1]=Ji,Dt[2]=Zi.top,Dt[3]=1,Za(Dt,Dt,kt),Dt[3]=Math.max(Dt[3],1e-5);const tn=Hd([Dt[0]/Dt[3],Dt[1]/Dt[3],Dt[2]/Dt[3]]);Gi.push(qi),rn.push(tn)}bi.push(Gi),oi.push(rn)}return[bi,oi]}(ie,re,pe,ae,Oe,Re,We,yt,Ne):function(at,tt,ft,lt,kt){const li=[],hi=[],Gt=kt[8]*tt,Tt=kt[9]*tt,bi=kt[10]*tt,oi=kt[11]*tt,Dt=kt[8]*ft,Yi=kt[9]*ft,Gi=kt[10]*ft,rn=kt[11]*ft;for(const fi of at){const Ii=[],Ji=[];for(const Zi of fi){const qi=Zi.x+lt.x,tn=Zi.y+lt.y,an=kt[0]*qi+kt[4]*tn+kt[12],On=kt[1]*qi+kt[5]*tn+kt[13],xr=kt[2]*qi+kt[6]*tn+kt[14],Ti=kt[3]*qi+kt[7]*tn+kt[15],fn=an+Gt,er=On+Tt,Fi=xr+bi,ln=Math.max(Ti+oi,1e-5),ur=an+Dt,on=On+Yi,yn=xr+Gi,Vn=Math.max(Ti+rn,1e-5),Dn=new U(fn/ln,er/ln);Dn.z=Fi/ln,Ii.push(Dn);const Xn=new U(ur/Vn,on/Vn);Xn.z=yn/Vn,Ji.push(Xn)}li.push(Ii),hi.push(Ji)}return[li,hi]}(ie,re,pe,ae,Oe)}(u,o,A,S,x,f,P?m:null,I,L,u.center.lat,i.tileID.canonical),ee=i.queryGeometry;return function(se,ie,re){let pe=1/0;Hg(re,ie)&&(pe=Ly(re,ie[0]));for(let ae=0;ae<ie.length;ae++){const Oe=ie[ae],Re=se[ae];for(let We=0;We<Oe.length-1;We++){const yt=Oe[We],Ne=[yt,Oe[We+1],Re[We+1],Re[We],yt];Wg(re,Ne)&&(pe=Math.min(pe,Ly(re,Ne)))}}return pe!==1/0&&pe}($[0],$[1],ee.isPointQuery()?ee.screenBounds:ee.screenGeometry)}},line:class extends lo{constructor(i){super(i,Ry),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Hc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=Fy.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Xd(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(i){return new Us(this,i)}queryRadius(i){const e=i,t=Oy(Yl("line-width",this,e),Yl("line-gap-width",this,e)),o=Yl("line-offset",this,e);return t/2+Math.abs(o)+Rd(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,t,o,l,u){if(i.queryGeometry.isAboveHorizon)return!1;const f=Jg(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),m=i.pixelToTileUnitsFactor/2*Oy(this.paint.get("line-width").evaluate(e,t),this.paint.get("line-gap-width").evaluate(e,t)),v=this.paint.get("line-offset").evaluate(e,t);return v&&(o=function(x,S){const A=[],I=new U(0,0);for(let P=0;P<x.length;P++){const L=x[P],O=[];for(let $=0;$<L.length;$++){const ee=L[$-1],se=L[$],ie=L[$+1],re=$===0?I:se.sub(ee)._unit()._perp(),pe=$===L.length-1?I:ie.sub(se)._unit()._perp(),ae=re._add(pe)._unit();ae._mult(1/(ae.x*pe.x+ae.y*pe.y)),O.push(ae._mult(S)._add(se))}A.push(O)}return A}(o,v*i.pixelToTileUnitsFactor)),function(x,S,A){for(let I=0;I<S.length;I++){const P=S[I];if(x.length>=3){for(let L=0;L<P.length;L++)if($a(x,P[L]))return!0}if(uw(x,P,A))return!0}return!1}(f,o,m)}isTileClipped(){return!0}},symbol:df,background:class extends lo{constructor(i){super(i,s2)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends lo{constructor(i){super(i,a2)}getProgramIds(){return["raster"]}},sky:class extends lo{constructor(i){super(i,c2),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=lm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(i,e){if(this.paint.get("sky-type")==="atmosphere"){const o=this.paint.get("sky-atmosphere-sun"),l=!o,u=i.style.light,f=u.properties.get("position");return l&&u.properties.get("anchor")==="viewport"&&xt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),l?Dm(f.azimuthal,90-f.polar,e):Dm(o[0],90-o[1],e)}const t=this.paint.get("sky-gradient-center");return Dm(t[0],90-t[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}}};class oh{constructor(e,t,o,l){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(t,l)}update(e,t,o){const{width:l,height:u}=e,{context:f}=this,{gl:m}=f,{HTMLImageElement:v,HTMLCanvasElement:x,HTMLVideoElement:S,ImageData:A,ImageBitmap:I}=D;if(m.bindTexture(m.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===m.RGBA&&(!t||t.premultiply!==!1)),o||this.size&&this.size[0]===l&&this.size[1]===u){const{x:P,y:L}=o||{x:0,y:0};e instanceof v||e instanceof x||e instanceof S||e instanceof A||I&&e instanceof I?m.texSubImage2D(m.TEXTURE_2D,0,P,L,m.RGBA,m.UNSIGNED_BYTE,e):m.texSubImage2D(m.TEXTURE_2D,0,P,L,l,u,m.RGBA,m.UNSIGNED_BYTE,e.data)}else this.size=[l,u],e instanceof v||e instanceof x||e instanceof S||e instanceof A||I&&e instanceof I?m.texImage2D(m.TEXTURE_2D,0,this.format,this.format,m.UNSIGNED_BYTE,e):m.texImage2D(m.TEXTURE_2D,0,this.format,l,u,0,this.format,m.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(t&&t.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&m.generateMipmap(m.TEXTURE_2D)}bind(e,t){const{context:o}=this,{gl:l}=o;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.filter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,this.useMipmap?e===l.NEAREST?l.NEAREST_MIPMAP_NEAREST:l.LINEAR_MIPMAP_NEAREST:e),this.filter=e),t!==this.wrap&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,t),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,t),this.wrap=t)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Lm{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new ls({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const o=this.getKey(e,t);return this.positions[o]}trim(){const e=this.width,t=this.height=Ke(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,o){const l=[];let u=e.length%2==1?-e[e.length-1]*o:0,f=e[0]*o,m=!0;l.push({left:u,right:f,isDash:m,zeroLength:e[0]===0});let v=e[0];for(let x=1;x<e.length;x++){m=!m;const S=e[x];u=v*o,v+=S,f=v*o,l.push({left:u,right:f,isDash:m,zeroLength:S===0})}return l}addRoundDash(e,t,o){const l=t/2;for(let u=-o;u<=o;u++){const f=this.width*(this.nextRow+o+u);let m=0,v=e[m];for(let x=0;x<this.width;x++){x/v.right>1&&(v=e[++m]);const S=Math.abs(x-v.left),A=Math.abs(x-v.right),I=Math.min(S,A);let P;const L=u/o*(l+1);if(v.isDash){const O=l-Math.abs(L);P=Math.sqrt(I*I+O*O)}else P=l-Math.sqrt(I*I+L*L);this.image.data[f+x]=Math.max(0,Math.min(255,P+128))}}}addRegularDash(e,t){for(let v=e.length-1;v>=0;--v){const x=e[v],S=e[v+1];x.zeroLength?e.splice(v,1):S&&S.isDash===x.isDash&&(S.left=x.left,e.splice(v,1))}const o=e[0],l=e[e.length-1];o.isDash===l.isDash&&(o.left=l.left-this.width,l.right=o.right+this.width);const u=this.width*this.nextRow;let f=0,m=e[f];for(let v=0;v<this.width;v++){v/m.right>1&&(m=e[++f]);const x=Math.abs(v-m.left),S=Math.abs(v-m.right),A=Math.min(x,S);this.image.data[u+v]=Math.max(0,Math.min(255,(m.isDash?A:-A)+t+128))}}addDash(e,t){const o=this.getKey(e,t);if(this.positions[o])return this.positions[o];const l=t==="round",u=l?7:0,f=2*u+1;if(this.nextRow+f>this.height)return xt("LineAtlas out of space"),null;e.length===0&&e.push(1);let m=0;for(let S=0;S<e.length;S++)e[S]<0&&(xt("Negative value is found in line dasharray, replacing values with 0"),e[S]=0),m+=e[S];if(m!==0){const S=this.width/m,A=this.getDashRanges(e,this.width,S);l?this.addRoundDash(A,S,u):this.addRegularDash(A,t==="square"?.5*S:0)}const v=this.nextRow+u;this.nextRow+=f;const x={tl:[v,u],br:[m,0]};return this.positions[o]=x,x}}Bt(Lm,"LineAtlas");class h2{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class d2{constructor(){this.tasks={},this.taskQueue=[],Ht(["process"],this),this.invoker=new h2(this.process),this.nextId=0}add(e,t){const o=this.nextId++,l=function({type:u,isSymbolTile:f,zoom:m}){return m=m||0,u==="message"?0:u!=="maybePrepare"||f?u!=="parseTile"||f?u==="parseTile"&&f?300-m:u==="maybePrepare"&&f?400-m:500:200-m:100-m}(t);if(l===0){Si();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[o]={fn:e,metadata:t,priority:l,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){Si();try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let l=0;l<this.taskQueue.length;l++){const u=this.tasks[this.taskQueue[l]];u.priority<t&&(t=u.priority,e=l)}if(e===null)return null;const o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}class Mv{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const o=e[t];this._stringToNumber[o]=t,this._numberToString[t]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const f2=["tile","layer","source","sourceLayer","state"];class Iv{constructor(e,t,o,l,u){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=o,this._y=l,this.properties=e.properties,this.id=u}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const t of f2)this[t]!==void 0&&(e[t]=this[t]);return e}}const Hr=32,Ro=33,Zs=new Uint16Array(8184);for(let i=0;i<2046;i++){let e=i+2,t=0,o=0,l=0,u=0,f=0,m=0;for(1&e?l=u=f=Hr:t=o=m=Hr;(e>>=1)>1;){const x=t+l>>1,S=o+u>>1;1&e?(l=t,u=o,t=f,o=m):(t=l,o=u,l=f,u=m),f=x,m=S}const v=4*i;Zs[v+0]=t,Zs[v+1]=o,Zs[v+2]=l,Zs[v+3]=u}const Fo=new Uint16Array(2178),Ws=new Uint8Array(1089),ff=new Uint16Array(1089);function kv(i){return i===0?-.03125:i===32?.03125:0}var zv=it([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Pv={type:2,extent:ei,loadGeometry:()=>[[new U(0,0),new U(8193,0),new U(8193,8193),new U(0,8193),new U(0,0)]]};class Bm{constructor(e,t,o,l,u){this.tileID=e,this.uid=qe(),this.uses=0,this.tileSize=t,this.tileZoom=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=u,this.expiredRequestCount=0,this.state="loading",l&&l.transform&&(this.projection=l.transform.projection)}registerFadeDuration(e){const t=e+this.timeAdded;t<Mt.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Xa(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,t,o){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(l,u){const f={};if(!u)return f;for(const m of l){const v=m.layerIds.map(x=>u.getLayer(x)).filter(Boolean);if(v.length!==0){m.layers=v,m.stateDependentLayerIds&&(m.stateDependentLayers=m.stateDependentLayerIds.map(x=>v.filter(S=>S.id===x)[0]));for(const x of v)f[x.id]=m}}return f}(e.buckets,t.style),this.hasSymbolBuckets=!1;for(const l in this.buckets){const u=this.buckets[l];if(u instanceof Gs){if(this.hasSymbolBuckets=!0,!o)break;u.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const l in this.buckets){const u=this.buckets[l];if(u instanceof Gs&&u.hasRTLText){this.hasRTLText=!0,Z.isLoading()||Z.isLoaded()||j()!=="deferred"||X();break}}this.queryPadding=0;for(const l in this.buckets){const u=this.buckets[l];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(l).queryRadius(u))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new ko}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const o in this.buckets){const l=this.buckets[o];l.uploadPending()&&l.upload(e)}const t=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new oh(e,this.imageAtlas.image,t.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new oh(e,this.glyphAtlasImage,t.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new oh(e,this.lineAtlas.image,t.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,t,o,l,u,f,m,v){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:l,pixelPosMatrix:m,transform:f,params:u,tileTransform:this.tileTransform},e,t,o):{}}querySourceFeatures(e,t){const o=this.latestFeatureIndex;if(!o||!o.rawTileData)return;const l=o.loadVTLayers(),u=t?t.sourceLayer:"",f=l._geojsonTileLayer||l[u];if(!f)return;const m=Da(t&&t.filter),{z:v,x,y:S}=this.tileID.canonical,A={z:v,x,y:S};for(let I=0;I<f.length;I++){const P=f.feature(I);if(m.needGeometry){const $=qa(P,!0);if(!m.filter(new W(this.tileID.overscaledZ),$,this.tileID.canonical))continue}else if(!m.filter(new W(this.tileID.overscaledZ),P))continue;const L=o.getId(P,u),O=new Iv(P,v,x,S,L);O.tile=A,e.push(O)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const t=this.expirationTime;if(e.cacheControl){const o=Kt(e.cacheControl);o["max-age"]&&(this.expirationTime=Date.now()+1e3*o["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const o=Date.now();let l=!1;if(this.expirationTime>o)l=!1;else if(t)if(this.expirationTime<t)l=!0;else{const u=this.expirationTime-t;u?this.expirationTime=o+Math.max(u,3e4):l=!0}else l=!0;l?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!t)return;const o=this.latestFeatureIndex.loadVTLayers(),l=t.style.listImages();for(const u in this.buckets){if(!t.style.hasLayer(u))continue;const f=this.buckets[u],m=f.layers[0].sourceLayer||"_geojsonTileLayer",v=o[m],x=e[m];if(!v||!x||Object.keys(x).length===0)continue;if(f.update(x,v,l,this.imageAtlas&&this.imageAtlas.patternPositions||{}),f instanceof Xd||f instanceof Gd){const A=t.style._getSourceCache(f.layers[0].source);t._terrain&&t._terrain.enabled&&A&&f.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(A.id,this.tileID)}const S=t&&t.style&&t.style.getLayer(u);S&&(this.queryPadding=Math.max(this.queryPadding,S.queryRadius(f)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Mt.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Mt.now()+e}setTexture(e,t){const o=t.context,l=o.gl;this.texture=t.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new oh(o,e,l.RGBA,{useMipmap:!0}),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),o.extTextureFilterAnisotropic&&l.texParameterf(l.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax))}setDependencies(e,t){const o={};for(const l of t)o[l]=!0;this.dependencies[e]=o}hasDependency(e,t){for(const o of e){const l=this.dependencies[o];if(l){for(const u of t)if(l[u])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,t){if(!t||t.name==="mercator"||this._tileDebugBuffer)return;const o=as(Pv,this.tileID.canonical,this.tileTransform)[0],l=new St,u=new es;for(let f=0;f<o.length;f++){const{x:m,y:v}=o[f];l.emplaceBack(m,v),u.emplaceBack(f)}u.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(u),this._tileDebugBuffer=e.createVertexBuffer(l,Yu.members),this._tileDebugSegments=An.simpleSegment(0,0,l.length,u.length)}_makeTileBoundsBuffers(e,t){if(this._tileBoundsBuffer||!t||t.name==="mercator")return;const o=as(Pv,this.tileID.canonical,this.tileTransform)[0];let l,u;if(this.isRaster){const f=function(m,v){const x=Xa(m,v),S=Math.pow(2,m.z);for(let $=0;$<Ro;$++)for(let ee=0;ee<Ro;ee++){const se=Zr((m.x+(ee+kv(ee))/Hr)/S),ie=Wn((m.y+($+kv($))/Hr)/S),re=v.project(se,ie),pe=$*Ro+ee;Fo[2*pe+0]=Math.round((re.x*x.scale-x.x)*ei),Fo[2*pe+1]=Math.round((re.y*x.scale-x.y)*ei)}Ws.fill(0),ff.fill(0);for(let $=2045;$>=0;$--){const ee=4*$,se=Zs[ee+0],ie=Zs[ee+1],re=Zs[ee+2],pe=Zs[ee+3],ae=se+re>>1,Oe=ie+pe>>1,Re=ae+Oe-ie,We=Oe+se-ae,yt=ie*Ro+se,Ne=pe*Ro+re,et=Oe*Ro+ae,at=Math.hypot((Fo[2*yt+0]+Fo[2*Ne+0])/2-Fo[2*et+0],(Fo[2*yt+1]+Fo[2*Ne+1])/2-Fo[2*et+1])>=16;if(Ws[et]=Ws[et]||(at?1:0),$<1022){const tt=(ie+We>>1)*Ro+(se+Re>>1),ft=(pe+We>>1)*Ro+(re+Re>>1);Ws[et]=Ws[et]||Ws[tt]||Ws[ft]}}const A=new Wt,I=new _i;let P=0;function L($,ee){const se=ee*Ro+$;return ff[se]===0&&(A.emplaceBack(Fo[2*se+0],Fo[2*se+1],$*ei/Hr,ee*ei/Hr),ff[se]=++P),ff[se]-1}function O($,ee,se,ie,re,pe){const ae=$+se>>1,Oe=ee+ie>>1;if(Math.abs($-re)+Math.abs(ee-pe)>1&&Ws[Oe*Ro+ae])O(re,pe,$,ee,ae,Oe),O(se,ie,re,pe,ae,Oe);else{const Re=L($,ee),We=L(se,ie),yt=L(re,pe);I.emplaceBack(Re,We,yt)}}return O(0,0,Hr,Hr,Hr,0),O(Hr,Hr,0,0,0,Hr),{vertices:A,indices:I}}(this.tileID.canonical,t);l=f.vertices,u=f.indices}else{l=new Wt,u=new _i;for(const{x:m,y:v}of o)l.emplaceBack(m,v,0,0);const f=Ud(l.int16,void 0,4);for(let m=0;m<f.length;m+=3)u.emplaceBack(f[m],f[m+1],f[m+2])}this._tileBoundsBuffer=e.createVertexBuffer(l,zv.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(u),this._tileBoundsSegments=An.simpleSegment(0,0,l.length,u.length)}_makeGlobeTileDebugBuffers(e,t){const o=t.projection;if(!o||o.name!=="globe"||t.freezeTileCoverage)return;const l=this.tileID.canonical,u=Qu(mv(l,t)),f=eh(t.zoom);let m;f>0&&(m=Yp(new Float64Array(16),t.globeMatrix));const v=(l.x+.5)/(1<<l.z)-zo(t.center.lng);let x=0;v>.5?x=-1:v<-.5&&(x=1),this._makeGlobeTileDebugBorderBuffer(e,l,t,u,m,f,x),this._makeGlobeTileDebugTextBuffer(e,l,t,u,m,f,x)}_globePoint(e,t,o,l,u,f,m,v){let x=Ju(e,t,o);if(f){const S=1<<o.z,A=[((e/ei+o.x)/S+v)*l,(t/ei+o.y)/S*l,0];zn(A,A,f),x=Cs(x,A,m)}return zn(x,x,u)}_makeGlobeTileDebugBorderBuffer(e,t,o,l,u,f,m){const v=new St,x=new es,S=new Ot,A=(P,L,O,$,ee)=>{const se=(O-P)/(ee-1),ie=($-L)/(ee-1),re=v.length;for(let pe=0;pe<ee;pe++){const ae=P+pe*se,Oe=L+pe*ie;v.emplaceBack(ae,Oe);const Re=this._globePoint(ae,Oe,t,o.worldSize,l,u,f,m);S.emplaceBack(Re[0],Re[1],Re[2]),x.emplaceBack(re+pe)}},I=ei;A(0,0,I,0,16),A(I,0,I,I,16),A(I,I,0,I,16),A(0,I,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(x),this._tileDebugBuffer=e.createVertexBuffer(v,Yu.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(S,fv.members),this._tileDebugSegments=An.simpleSegment(0,0,v.length,x.length)}_makeGlobeTileDebugTextBuffer(e,t,o,l,u,f,m){const v=new St,x=new _i,S=new Ot,A=25;x.reserve(32),v.reserve(A),S.reserve(A);const I=(P,L)=>A*P+L;for(let P=0;P<A;P++){const L=2048*P;for(let O=0;O<A;O++){const $=2048*O;v.emplaceBack($,L);const ee=this._globePoint($,L,t,o.worldSize,l,u,f,m);S.emplaceBack(ee[0],ee[1],ee[2])}}for(let P=0;P<4;P++)for(let L=0;L<4;L++){const O=I(P,L),$=I(P,L+1),ee=I(P+1,L),se=I(P+1,L+1);x.emplaceBack(O,$,ee),x.emplaceBack(ee,$,se)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(x),this._tileDebugTextBuffer=e.createVertexBuffer(v,Yu.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(S,fv.members),this._tileDebugTextSegments=An.simpleSegment(0,0,A,32)}}class p2{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,t,o){const l=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][l]=this.stateChanges[e][l]||{},Ve(this.stateChanges[e][l],o),this.deletedStates[e]===null){this.deletedStates[e]={};for(const u in this.state[e])u!==l&&(this.deletedStates[e][u]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][l]===null){this.deletedStates[e][l]={};for(const u in this.state[e][l])o[u]||(this.deletedStates[e][l][u]=null)}else for(const u in o)this.deletedStates[e]&&this.deletedStates[e][l]&&this.deletedStates[e][l][u]===null&&delete this.deletedStates[e][l][u]}removeFeatureState(e,t,o){if(this.deletedStates[e]===null)return;const l=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},o&&t!==void 0)this.deletedStates[e][l]!==null&&(this.deletedStates[e][l]=this.deletedStates[e][l]||{},this.deletedStates[e][l][o]=null);else if(t!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][l])for(o in this.deletedStates[e][l]={},this.stateChanges[e][l])this.deletedStates[e][l][o]=null;else this.deletedStates[e][l]=null;else this.deletedStates[e]=null}getState(e,t){const o=String(t),l=Ve({},(this.state[e]||{})[o],(this.stateChanges[e]||{})[o]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const u=this.deletedStates[e][t];if(u===null)return{};for(const f in u)delete l[f]}return l}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,t){const o={};for(const l in this.stateChanges){this.state[l]=this.state[l]||{};const u={};for(const f in this.stateChanges[l])this.state[l][f]||(this.state[l][f]={}),Ve(this.state[l][f],this.stateChanges[l][f]),u[f]=this.state[l][f];o[l]=u}for(const l in this.deletedStates){this.state[l]=this.state[l]||{};const u={};if(this.deletedStates[l]===null)for(const f in this.state[l])u[f]={},this.state[l][f]={};else for(const f in this.deletedStates[l]){if(this.deletedStates[l][f]===null)this.state[l][f]={};else for(const m of Object.keys(this.deletedStates[l][f]))delete this.state[l][f][m];u[f]=this.state[l][f]}o[l]=o[l]||{},Ve(o[l],u)}if(this.stateChanges={},this.deletedStates={},Object.keys(o).length!==0)for(const l in e)e[l].setFeatureState(o,t)}}class Dv{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const o=this.toIdx(e,t);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function Lv(i,e,t,o){let l=0,u=Number.MAX_VALUE;for(let f=0;f<3;f++)if(Math.abs(o[f])<1e-15){if(t[f]<i[f]||t[f]>e[f])return null}else{const m=1/o[f];let v=(i[f]-t[f])*m,x=(e[f]-t[f])*m;if(v>x){const S=v;v=x,x=S}if(v>l&&(l=v),x<u&&(u=x),l>u)return null}return l}function Bv(i,e,t,o,l,u,f,m,v,x,S){const A=o-i,I=l-e,P=u-t,L=f-i,O=m-e,$=v-t,ee=S[1]*$-S[2]*O,se=S[2]*L-S[0]*$,ie=S[0]*O-S[1]*L,re=A*ee+I*se+P*ie;if(Math.abs(re)<1e-15)return null;const pe=1/re,ae=x[0]-i,Oe=x[1]-e,Re=x[2]-t,We=(ae*ee+Oe*se+Re*ie)*pe;if(We<0||We>1)return null;const yt=Oe*P-Re*I,Ne=Re*A-ae*P,et=ae*I-Oe*A,at=(S[0]*yt+S[1]*Ne+S[2]*et)*pe;return at<0||We+at>1?null:(L*yt+O*Ne+$*et)*pe}function Rv(i,e,t){return(i-e)/(t-e)}function Fv(i,e,t,o,l,u,f,m,v){const x=1<<t,S=u-o,A=f-l,I=(i+1)/x*S+o,P=(e+0)/x*A+l,L=(e+1)/x*A+l;m[0]=(i+0)/x*S+o,m[1]=P,v[0]=I,v[1]=L}class Ov{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(u){const f=Math.ceil(Math.log2(u.dim/8)),m=[];let v=Math.ceil(Math.pow(2,f));const x=1/v,S=(P,L,O,$,ee)=>{const se=$?1:0,ie=(P+1)*O-se,re=L*O,pe=(L+1)*O-se;ee[0]=P*O,ee[1]=re,ee[2]=ie,ee[3]=pe};let A=new Dv(v);const I=[];for(let P=0;P<v*v;P++){S(P%v,Math.floor(P/v),x,!1,I);const L=Hs(I[0],I[1],u),O=Hs(I[2],I[1],u),$=Hs(I[2],I[3],u),ee=Hs(I[0],I[3],u);A.minimums.push(Math.min(L,O,$,ee)),A.maximums.push(Math.max(L,O,$,ee)),A.leaves.push(1)}for(m.push(A),v/=2;v>=1;v/=2){const P=m[m.length-1];A=new Dv(v);for(let L=0;L<v*v;L++){S(L%v,Math.floor(L/v),2,!0,I);const O=P.getElevation(I[0],I[1]),$=P.getElevation(I[2],I[1]),ee=P.getElevation(I[2],I[3]),se=P.getElevation(I[0],I[3]),ie=P.isLeaf(I[0],I[1]),re=P.isLeaf(I[2],I[1]),pe=P.isLeaf(I[2],I[3]),ae=P.isLeaf(I[0],I[3]),Oe=Math.min(O.min,$.min,ee.min,se.min),Re=Math.max(O.max,$.max,ee.max,se.max),We=ie&&re&&pe&&ae;A.maximums.push(Re),A.minimums.push(Oe),A.leaves.push(Re-Oe<=5&&We?1:0)}m.push(A)}return m}(this.dem),o=t.length-1,l=t[o];this._addNode(l.minimums[0],l.maximums[0],l.leaves[0]),this._construct(t,0,0,o,0)}raycastRoot(e,t,o,l,u,f,m=1){return Lv([e,t,-100],[o,l,this.maximums[0]*m],u,f)}raycast(e,t,o,l,u,f,m=1){if(!this.nodeCount)return null;const v=this.raycastRoot(e,t,o,l,u,f,m);if(v==null)return null;const x=[],S=[],A=[],I=[],P=[{idx:0,t:v,nodex:0,nodey:0,depth:0}];for(;P.length>0;){const{idx:L,t:O,nodex:$,nodey:ee,depth:se}=P.pop();if(this.leaves[L]){Fv($,ee,se,e,t,o,l,A,I);const re=1<<se,pe=($+0)/re,ae=($+1)/re,Oe=(ee+0)/re,Re=(ee+1)/re,We=Hs(pe,Oe,this.dem)*m,yt=Hs(ae,Oe,this.dem)*m,Ne=Hs(ae,Re,this.dem)*m,et=Hs(pe,Re,this.dem)*m,at=Bv(A[0],A[1],We,I[0],A[1],yt,I[0],I[1],Ne,u,f),tt=Bv(I[0],I[1],Ne,A[0],I[1],et,A[0],A[1],We,u,f),ft=Math.min(at!==null?at:Number.MAX_VALUE,tt!==null?tt:Number.MAX_VALUE);if(ft!==Number.MAX_VALUE)return ft;{const lt=Vd([],u,f,O);if(Vv(We,yt,et,Ne,Rv(lt[0],A[0],I[0]),Rv(lt[1],A[1],I[1]))>=lt[2])return O}continue}let ie=0;for(let re=0;re<this._siblingOffset.length;re++){Fv(($<<1)+this._siblingOffset[re][0],(ee<<1)+this._siblingOffset[re][1],se+1,e,t,o,l,A,I),A[2]=-100,I[2]=this.maximums[this.childOffsets[L]+re]*m;const pe=Lv(A,I,u,f);if(pe!=null){const ae=pe;x[re]=ae;let Oe=!1;for(let Re=0;Re<ie&&!Oe;Re++)ae>=x[S[Re]]&&(S.splice(Re,0,re),Oe=!0);Oe||(S[ie]=re),ie++}}for(let re=0;re<ie;re++){const pe=S[re];P.push({idx:this.childOffsets[L]+pe,t:x[pe],nodex:($<<1)+this._siblingOffset[pe][0],nodey:(ee<<1)+this._siblingOffset[pe][1],depth:se+1})}}return null}_addNode(e,t,o){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,o,l,u){if(e[l].isLeaf(t,o)===1)return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);const f=l-1,m=e[f];let v=0,x=0;for(let S=0;S<this._siblingOffset.length;S++){const A=2*t+this._siblingOffset[S][0],I=2*o+this._siblingOffset[S][1],P=m.getElevation(A,I),L=m.isLeaf(A,I),O=this._addNode(P.min,P.max,L);L&&(v|=1<<S),x||(x=O)}for(let S=0;S<this._siblingOffset.length;S++)v&1<<S||this._construct(e,2*t+this._siblingOffset[S][0],2*o+this._siblingOffset[S][1],f,x+S)}}function Vv(i,e,t,o,l,u){return Ai(Ai(i,t,u),Ai(e,o,u),l)}function Hs(i,e,t){const o=t.dim,l=Se(i*o-.5,0,o-1),u=Se(e*o-.5,0,o-1),f=Math.floor(l),m=Math.floor(u),v=Math.min(f+1,o-1),x=Math.min(m+1,o-1);return Vv(t.get(f,m),t.get(v,m),t.get(f,x),t.get(v,x),l-f,u-m)}const Uv={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class pf{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,o,l=!1,u=!1){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return xt(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=t.height;const f=this.dim=t.height-2,m=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.encoding=o||"mapbox",this.borderReady=l,!l){for(let v=0;v<f;v++)m[this._idx(-1,v)]=m[this._idx(0,v)],m[this._idx(f,v)]=m[this._idx(f-1,v)],m[this._idx(v,-1)]=m[this._idx(v,0)],m[this._idx(v,f)]=m[this._idx(v,f-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(f,-1)]=m[this._idx(f-1,0)],m[this._idx(-1,f)]=m[this._idx(0,f-1)],m[this._idx(f,f)]=m[this._idx(f-1,f-1)],u&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Ov(this)}get(e,t,o=!1){o&&(e=Se(e,-1,this.dim),t=Se(t,-1,this.dim));const l=4*this._idx(e,t);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[l],this.pixels[l+1],this.pixels[l+2])}static getUnpackVector(e){return Uv[e]}get unpackVector(){return Uv[this.encoding]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}_unpackMapbox(e,t,o){return(256*e*256+256*t+o)/10-1e4}_unpackTerrarium(e,t,o){return 256*e+t+o/256-32768}static pack(e,t){const o=[0,0,0,0],l=pf.getUnpackVector(t);let u=Math.floor((e+l[3])/l[2]);return o[2]=u%256,u=Math.floor(u/256),o[1]=u%256,u=Math.floor(u/256),o[0]=u,o}getPixels(){return new Mr({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=t*this.dim,u=t*this.dim+this.dim,f=o*this.dim,m=o*this.dim+this.dim;switch(t){case-1:l=u-1;break;case 1:u=l+1}switch(o){case-1:f=m-1;break;case 1:m=f+1}const v=-t*this.dim,x=-o*this.dim;for(let S=f;S<m;S++)for(let A=l;A<u;A++){const I=4*this._idx(A,S),P=4*this._idx(A+v,S+x);this.pixels[I+0]=e.pixels[P+0],this.pixels[I+1]=e.pixels[P+1],this.pixels[I+2]=e.pixels[P+2],this.pixels[I+3]=e.pixels[P+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Bt(pf,"DEMData"),Bt(Ov,"DemMinMaxQuadTree",{omit:["dem"]});class m2{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,o){const l=e.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const u={value:t,timeout:void 0};if(o!==void 0&&(u.timeout=setTimeout(()=>{this.remove(e,u)},o)),this.data[l].push(u),this.order.push(l),this.order.length>this.max){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const o=e.wrapped().key,l=t===void 0?0:this.data[o].indexOf(t),u=this.data[o][l];return this.data[o].splice(l,1),u.timeout&&clearTimeout(u.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(u.value),this.order.splice(this.order.indexOf(o),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(e){const t=[];for(const o in this.data)for(const l of this.data[o])e(l.value)||t.push(l);for(const o of t)this.remove(o.value.tileID,o)}}class hc{constructor(e,t,o){this.func=e,this.mask=t,this.range=o}}hc.ReadOnly=!1,hc.ReadWrite=!0,hc.disabled=new hc(519,hc.ReadOnly,[0,1]);const Rm=7680;class Fm{constructor(e,t,o,l,u,f){this.test=e,this.ref=t,this.mask=o,this.fail=l,this.depthFail=u,this.pass=f}}Fm.disabled=new Fm({func:519,mask:0},0,0,Rm,Rm,Rm);class Oo{constructor(e,t,o){this.blendFunction=e,this.blendColor=t,this.mask=o}}Oo.Replace=[1,0],Oo.disabled=new Oo(Oo.Replace,Ni.transparent,[!1,!1,!1,!1]),Oo.unblended=new Oo(Oo.Replace,Ni.transparent,[!0,!0,!0,!0]),Oo.alphaBlended=new Oo([1,771],Ni.transparent,[!0,!0,!0,!0]);const Om=1029,Vm=2305;class po{constructor(e,t,o){this.enable=e,this.mode=t,this.frontFace=o}}po.disabled=new po(!1,Om,Vm),po.backCCW=new po(!0,Om,Vm),po.backCW=new po(!0,Om,2304),po.frontCW=new po(!0,1028,2304),po.frontCCW=new po(!0,1028,Vm);class Ka extends Ze{constructor(e,t,o){super(),this.id=e,this._onlySymbols=o,t.on("data",l=>{l.dataType==="source"&&l.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&l.dataType==="source"&&l.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),t.on("error",()=>{this._sourceErrored=!0}),this._source=t,this._tiles={},this._cache=new m2(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new p2,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const t=this._tiles[e];if(t.state!=="loaded"&&t.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const t in this._tiles){const o=this._tiles[t];this._source.prepareTile(o)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,o.tileID),o.upload(e),o.prepare(this.map.style.imageManager)}else for(const t in this._tiles){const o=this._tiles[t];o.upload(e),o.prepare(this.map.style.imageManager)}}getIds(){return Xe(this._tiles).map(e=>e.tileID).sort(Nv).map(e=>e.key)}getRenderableIds(e){const t=[];for(const o in this._tiles)this._isIdRenderable(+o,e)&&t.push(this._tiles[o]);return e?t.sort((o,l)=>{const u=o.tileID,f=l.tileID,m=new U(u.canonical.x,u.canonical.y)._rotate(this.transform.angle),v=new U(f.canonical.x,f.canonical.y)._rotate(this.transform.angle);return u.overscaledZ-f.overscaledZ||v.y-m.y||v.x-m.x}).map(o=>o.tileID.key):t.map(o=>o.tileID).sort(Nv).map(o=>o.key)}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const o=this._tiles[e];o&&(o.state!=="loading"&&(o.state=t),this._loadTile(o,this._tileLoaded.bind(this,o,e,t)))}_tileLoaded(e,t,o,l){if(l)if(e.state="errored",l.status!==404)this._source.fire(new vt(l,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const u=this.map.painter.terrain;this.update(this.transform,u.getScaledDemTileSize(),!0),u.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Mt.now(),o==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new ce("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let l=0;l<t.length;l++){const u=t[l];if(e.neighboringTiles&&e.neighboringTiles[u]){const f=this.getTileByID(u);o(e,f),o(f,e)}}function o(l,u){if(!l.dem||l.dem.borderReady)return;l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0;let f=u.tileID.canonical.x-l.tileID.canonical.x;const m=u.tileID.canonical.y-l.tileID.canonical.y,v=Math.pow(2,l.tileID.canonical.z),x=u.tileID.key;f===0&&m===0||Math.abs(m)>1||(Math.abs(f)>1&&(Math.abs(f+v)===1?f+=v:Math.abs(f-v)===1&&(f-=v)),u.dem&&l.dem&&(l.dem.backfillBorder(u.dem,f,m),l.neighboringTiles&&l.neighboringTiles[x]&&(l.neighboringTiles[x].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,o,l){for(const u in this._tiles){let f=this._tiles[u];if(l[u]||!f.hasData()||f.tileID.overscaledZ<=t||f.tileID.overscaledZ>o)continue;let m=f.tileID;for(;f&&f.tileID.overscaledZ>t+1;){const x=f.tileID.scaledTo(f.tileID.overscaledZ-1);f=this._tiles[x.key],f&&f.hasData()&&(m=x)}let v=m;for(;v.overscaledZ>t;)if(v=v.scaledTo(v.overscaledZ-1),e[v.key]){l[m.key]=m;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const o=this._loadedParentTiles[e.key];return o&&o.tileID.overscaledZ>=t?o:null}for(let o=e.overscaledZ-1;o>=t;o--){const l=e.scaledTo(o),u=this._getLoadedTile(l);if(u)return u}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const o=Math.ceil(e.width/t)+1,l=Math.ceil(e.height/t)+1,u=Math.floor(o*l*5),f=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,u):u,m=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,f):f;this._cache.setMaxSize(m)}handleWrapJump(e){const t=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,t){const o={};for(const l in this._tiles){const u=this._tiles[l];u.tileID=u.tileID.unwrapTo(u.tileID.wrap+t),o[u.tileID.key]=u}this._tiles=o;for(const l in this._timers)clearTimeout(this._timers[l]),delete this._timers[l];for(const l in this._tiles)this._setTileReloadTimer(+l,this._tiles[l])}}update(e,t,o){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!o)return;let l;this.updateCacheSize(e,t),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(m=>new cr(m.canonical.z,m.wrap,m.canonical.z,m.canonical.x,m.canonical.y)):(l=e.coveringTiles({tileSize:t||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!o,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(l=l.filter(m=>this._source.hasTile(m)))):l=[];const u=this._updateRetainedTiles(l);if(jv(this._source.type)&&l.length!==0){const m={},v={},x=Object.keys(u);for(const A of x){const I=u[A],P=this._tiles[A];if(!P||P.fadeEndTime&&P.fadeEndTime<=Mt.now())continue;const L=this.findLoadedParent(I,Math.max(I.overscaledZ-Ka.maxOverzooming,this._source.minzoom));L&&(this._addTile(L.tileID),m[L.tileID.key]=L.tileID),v[A]=I}const S=l[l.length-1].overscaledZ;for(const A in this._tiles){const I=this._tiles[A];if(u[A]||!I.hasData())continue;let P=I.tileID;for(;P.overscaledZ>S;){P=P.scaledTo(P.overscaledZ-1);const L=this._tiles[P.key];if(L&&L.hasData()&&v[P.key]){u[A]=I.tileID;break}}}for(const A in m)u[A]||(this._coveredTiles[A]=!0,u[A]=m[A])}for(const m in u)this._tiles[m].clearFadeHold();const f=function(m,v){const x=[];for(const S in m)S in v||x.push(S);return x}(this._tiles,u);for(const m of f){const v=this._tiles[m];v.hasSymbolBuckets&&!v.holdingForFade()?v.setHoldDuration(this.map._fadeDuration):v.hasSymbolBuckets&&!v.symbolFadeFinished()||this._removeTile(+m)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(e.length===0)return t;const o={},l=e.reduce((x,S)=>Math.min(x,S.overscaledZ),1/0),u=e[0].overscaledZ,f=Math.max(u-Ka.maxOverzooming,this._source.minzoom),m=Math.max(u+Ka.maxUnderzooming,this._source.minzoom),v={};for(const x of e){const S=this._addTile(x);t[x.key]=x,S.hasData()||l<this._source.maxzoom&&(v[x.key]=x)}this._retainLoadedChildren(v,l,m,t);for(const x of e){let S=this._tiles[x.key];if(S.hasData())continue;if(x.canonical.z>=this._source.maxzoom){const I=x.children(this._source.maxzoom)[0],P=this.getTile(I);if(P&&P.hasData()){t[I.key]=I;continue}}else{const I=x.children(this._source.maxzoom);if(t[I[0].key]&&t[I[1].key]&&t[I[2].key]&&t[I[3].key])continue}let A=S.wasRequested();for(let I=x.overscaledZ-1;I>=f;--I){const P=x.scaledTo(I);if(o[P.key]||(o[P.key]=!0,S=this.getTile(P),!S&&A&&(S=this._addTile(P)),S&&(t[P.key]=P,A=S.wasRequested(),S.hasData())))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let o,l=this._tiles[e].tileID;for(;l.overscaledZ>0;){if(l.key in this._loadedParentTiles){o=this._loadedParentTiles[l.key];break}t.push(l.key);const u=l.scaledTo(l.overscaledZ-1);if(o=this._getLoadedTile(u),o)break;l=u}for(const u of t)this._loadedParentTiles[u]=o}}_addTile(e){let t=this._tiles[e.key];if(t)return this._source.prepareTile&&this._source.prepareTile(t),t;t=this._cache.getAndRemove(e),t&&(this._setTileReloadTimer(e.key,t),t.tileID=e,this._state.initializeTileState(t,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t)));const o=Boolean(t);if(!o){const l=this.map?this.map.painter:null;t=new Bm(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,l,this._isRaster),this._source.prepareTile&&this._source.prepareTile(t)||this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))}return t?(t.uses++,this._tiles[e.key]=t,o||this._source.fire(new ce("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const o=t.getExpiryTimeout();o&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},o))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&t.state!=="reloading"?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,t,o){const l=[],u=this.transform;if(!u)return l;const f=u.projection.name==="globe",m=zo(u.center.lng);for(const v in this._tiles){const x=this._tiles[v];if(o&&x.clearQueryDebugViz(),x.holdingForFade())continue;let S;if(f){const A=x.tileID.canonical;if(A.z===0){const I=[Math.abs(Se(m,...sh(A,-1))-m),Math.abs(Se(m,...sh(A,1))-m)];S=[0,2*I.indexOf(Math.min(...I))-1]}else{const I=[Math.abs(Se(m,...sh(A,-1))-m),Math.abs(Se(m,...sh(A,0))-m),Math.abs(Se(m,...sh(A,1))-m)];S=[I.indexOf(Math.min(...I))-1]}}else S=[0];for(const A of S){const I=e.containsTile(x,u,t,A);I&&l.push(I)}}return l}getVisibleCoordinates(e){const t=this.getRenderableIds(e).map(o=>this._tiles[o].tileID);for(const o of t)o.projMatrix=this.transform.calculateProjMatrix(o.toUnwrapped());return t}hasTransition(){if(this._source.hasTransition())return!0;if(jv(this._source.type))for(const e in this._tiles){const t=this._tiles[e];if(t.fadeEndTime!==void 0&&t.fadeEndTime>=Mt.now())return!0}return!1}setFeatureState(e,t,o){this._state.updateState(e=e||"_geojsonTileLayer",t,o)}removeFeatureState(e,t,o){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,o)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,o){const l=this._tiles[e];l&&l.setDependencies(t,o)}reloadTilesForDependencies(e,t){for(const o in this._tiles)this._tiles[o].hasDependency(e,t)&&this._reloadTile(+o,"reloading");this._cache.filter(o=>!o.hasDependency(e,t))}_preloadTiles(e,t){const o=new Map,l=Array.isArray(e)?e:[e],u=this.map.painter.terrain,f=this.usedForTerrain&&u?u.getScaledDemTileSize():this._source.tileSize;for(const m of l){const v=m.coveringTiles({tileSize:f,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const x of v)o.set(x.key,x);this.usedForTerrain&&m.updateElevation(!1)}Pe(Array.from(o.values()),(m,v)=>{const x=new Bm(m,this._source.tileSize*m.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(x,S=>{this._source.type==="raster-dem"&&x.dem&&this._backfillDEM(x),v(S,x)})},t)}}function Nv(i,e){const t=Math.abs(2*i.wrap)-+(i.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||o-t||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x}function jv(i){return i==="raster"||i==="image"||i==="video"}function sh(i,e){const t=1<<i.z;return[i.x/t+e,(i.x+1)/t+e]}Ka.maxOverzooming=10,Ka.maxUnderzooming=3;class mf{constructor(e,t,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=o}static create(e,t,o){const l=o||e.findDEMTileFor(t);if(!l||!l.dem)return;const u=l.dem,f=l.tileID,m=1<<t.canonical.z-f.canonical.z;return new mf(l,l.tileSize/ei/m,[(t.canonical.x/m-f.canonical.x)*u.dim,(t.canonical.y/m-f.canonical.y)*u.dim])}tileCoordToPixel(e,t){const o=t*this._scale+this._offset[1],l=Math.floor(e*this._scale+this._offset[0]),u=Math.floor(o);return new U(l,u)}getElevationAt(e,t,o,l){const u=e*this._scale+this._offset[0],f=t*this._scale+this._offset[1],m=Math.floor(u),v=Math.floor(f),x=this._dem;return l=!!l,o?Ai(Ai(x.get(m,v,l),x.get(m,v+1,l),f-v),Ai(x.get(m+1,v,l),x.get(m+1,v+1,l),f-v),u-m):x.get(m,v,l)}getElevationAtPixel(e,t,o){return this._dem.get(e,t,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Gr(1,e)*this._dem.stride}}class qv{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Fs(ei,16,0),this.featureIndexArray=new Pg,this.promoteId=t}insert(e,t,o,l,u,f=0){const m=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,l,u,f);const v=this.grid;for(let x=0;x<t.length;x++){const S=t[x],A=[1/0,1/0,-1/0,-1/0];for(let I=0;I<S.length;I++){const P=S[I];A[0]=Math.min(A[0],P.x),A[1]=Math.min(A[1],P.y),A[2]=Math.max(A[2],P.x),A[3]=Math.max(A[3],P.y)}A[0]<ei&&A[1]<ei&&A[2]>=0&&A[3]>=0&&v.insert(m,A[0],A[1],A[2],A[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ha.VectorTile(new Hu(this.rawTileData)).layers,this.sourceLayerCoder=new Mv(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t,o,l){this.loadVTLayers();const u=e.params||{},f=Da(u.filter),m=e.tileResult,v=e.transform,x=m.bufferedTilespaceBounds,S=this.grid.query(x.min.x,x.min.y,x.max.x,x.max.y,(L,O,$,ee)=>Yg(m.bufferedTilespaceGeometry,L,O,$,ee));S.sort(_2);let A=null;v.elevation&&S.length>0&&(A=mf.create(v.elevation,this.tileID));const I={};let P;for(let L=0;L<S.length;L++){const O=S[L];if(O===P)continue;P=O;const $=this.featureIndexArray.get(O);let ee=null;this.loadMatchingFeature(I,$,f,u.layers,u.availableImages,t,o,l,(se,ie,re,pe=0)=>(ee||(ee=as(se,this.tileID.canonical,e.tileTransform)),ie.queryIntersectsFeature(m,se,re,ee,this.z,e.transform,e.pixelPosMatrix,A,pe)))}return I}loadMatchingFeature(e,t,o,l,u,f,m,v,x){const{featureIndex:S,bucketIndex:A,sourceLayerIndex:I,layoutVertexArrayOffset:P}=t,L=this.bucketLayerIDs[A];if(l&&!function(se,ie){for(let re=0;re<se.length;re++)if(ie.indexOf(se[re])>=0)return!0;return!1}(l,L))return;const O=this.sourceLayerCoder.decode(I),$=this.vtLayers[O].feature(S);if(o.needGeometry){const se=qa($,!0);if(!o.filter(new W(this.tileID.overscaledZ),se,this.tileID.canonical))return}else if(!o.filter(new W(this.tileID.overscaledZ),$))return;const ee=this.getId($,O);for(let se=0;se<L.length;se++){const ie=L[se];if(l&&l.indexOf(ie)<0)continue;const re=f[ie];if(!re)continue;let pe={};ee!==void 0&&v&&(pe=v.getState(re.sourceLayer||"_geojsonTileLayer",ee));const ae=Ve({},m[ie]);ae.paint=$v(ae.paint,re.paint,$,pe,u),ae.layout=$v(ae.layout,re.layout,$,pe,u);const Oe=!x||x($,re,pe,P);if(!Oe)continue;const Re=new Iv($,this.z,this.x,this.y,ee);Re.layer=ae;let We=e[ie];We===void 0&&(We=e[ie]=[]),We.push({featureIndex:S,feature:Re,intersectionZ:Oe})}}lookupSymbolFeatures(e,t,o,l,u,f,m,v){const x={};this.loadVTLayers();const S=Da(u);for(const A of e)this.loadMatchingFeature(x,{bucketIndex:o,sourceLayerIndex:l,featureIndex:A,layoutVertexArrayOffset:0},S,f,m,v,t);return x}loadFeature(e){const{featureIndex:t,sourceLayerIndex:o}=e;this.loadVTLayers();const l=this.sourceLayerCoder.decode(o),u=this.vtFeatures[l];if(u[t])return u[t];const f=this.vtLayers[l].feature(t);return u[t]=f,f}hasLayer(e){for(const t of this.bucketLayerIDs)for(const o of t)if(e===o)return!0;return!1}getId(e,t){let o=e.id;return this.promoteId&&(o=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[t]],typeof o=="boolean"&&(o=Number(o))),o}}function $v(i,e,t,o,l){return At(i,(u,f)=>{const m=e instanceof de?e.get(f):null;return m&&m.evaluate?m.evaluate(t,o,l):m})}function _2(i,e){return e-i}Bt(qv,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Gv{constructor(e){const t={},o=[];for(const m in e){const v=e[m],x=t[m]={};for(const S in v.glyphs){const A=v.glyphs[+S];if(!A||A.bitmap.width===0||A.bitmap.height===0)continue;const I=A.metrics.localGlyph?2:1,P={x:0,y:0,w:A.bitmap.width+2*I,h:A.bitmap.height+2*I};o.push(P),x[S]=P}}const{w:l,h:u}=gm(o),f=new ls({width:l||1,height:u||1});for(const m in e){const v=e[m];for(const x in v.glyphs){const S=v.glyphs[+x];if(!S||S.bitmap.width===0||S.bitmap.height===0)continue;const A=t[m][x],I=S.metrics.localGlyph?2:1;ls.copy(S.bitmap,f,{x:0,y:0},{x:A.x+I,y:A.y+I},S.bitmap)}}this.image=f,this.positions=t}}Bt(Gv,"GlyphAtlas");class g2{constructor(e){this.tileID=new cr(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Xa(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,t,o,l,u){this.status="parsing",this.data=e,this.collisionBoxArray=new ko;const f=new Mv(Object.keys(e.layers).sort()),m=new qv(this.tileID,this.promoteId);m.bucketLayerIDs=[];const v={},x=new Lm(256,256),S={featureIndex:m,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:x,availableImages:o},A=t.familiesBySource[this.source];for(const pe in A){const ae=e.layers[pe];if(!ae)continue;let Oe=!1,Re=!1;for(const Ne of A[pe])Ne[0].type==="symbol"?Oe=!0:Re=!0;if(this.isSymbolTile===!0&&!Oe||this.isSymbolTile===!1&&!Re)continue;ae.version===1&&xt(`Vector tile source "${this.source}" layer "${pe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const We=f.encode(pe),yt=[];for(let Ne=0;Ne<ae.length;Ne++){const et=ae.feature(Ne),at=m.getId(et,pe);yt.push({feature:et,id:at,index:Ne,sourceLayerIndex:We})}for(const Ne of A[pe]){const et=Ne[0];this.isSymbolTile!==void 0&&et.type==="symbol"!==this.isSymbolTile||et.minzoom&&this.zoom<Math.floor(et.minzoom)||et.maxzoom&&this.zoom>=et.maxzoom||et.visibility!=="none"&&(Um(Ne,this.zoom,o),(v[et.id]=et.createBucket({index:m.bucketLayerIDs.length,layers:Ne,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:We,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:o})).populate(yt,S,this.tileID.canonical,this.tileTransform),m.bucketLayerIDs.push(Ne.map(at=>at.id)))}}let I,P,L,O;x.trim();const $={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ee=At(S.glyphDependencies,pe=>Object.keys(pe).map(Number));Object.keys(ee).length?l.send("getGlyphs",{uid:this.uid,stacks:ee},(pe,ae)=>{I||(I=pe,P=ae,re.call(this))},void 0,!1,$):P={};const se=Object.keys(S.iconDependencies);se.length?l.send("getImages",{icons:se,source:this.source,tileID:this.tileID,type:"icons"},(pe,ae)=>{I||(I=pe,L=ae,re.call(this))},void 0,!1,$):L={};const ie=Object.keys(S.patternDependencies);function re(){if(I)return u(I);if(P&&L&&O){const pe=new Gv(P),ae=new Zy(L,O);for(const Oe in v){const Re=v[Oe];Re instanceof Gs?(Um(Re.layers,this.zoom,o),VT(Re,P,pe.positions,L,ae.iconPositions,this.showCollisionBoxes,o,this.tileID.canonical,this.tileZoom,this.projection)):Re.hasPattern&&(Re instanceof Xd||Re instanceof Gd||Re instanceof $u)&&(Um(Re.layers,this.zoom,o),Re.addFeatures(S,this.tileID.canonical,ae.patternPositions,o,this.tileTransform))}this.status="done",u(null,{buckets:Xe(v).filter(Oe=>!Oe.isEmpty()),featureIndex:m,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:pe.image,lineAtlas:x,imageAtlas:ae,glyphMap:this.returnDependencies?P:null,iconMap:this.returnDependencies?L:null,glyphPositions:this.returnDependencies?pe.positions:null})}}ie.length?l.send("getImages",{icons:ie,source:this.source,tileID:this.tileID,type:"patterns"},(pe,ae)=>{I||(I=pe,O=ae,re.call(this))},void 0,!1,$):O={},re.call(this)}}function Um(i,e,t){const o=new W(e);for(const l of i)l.recalculate(o,t)}class Zv{constructor(e){this.entries={},this.scheduler=e}request(e,t,o,l){const u=this.entries[e]=this.entries[e]||{callbacks:[]};if(u.result){const[f,m]=u.result;return this.scheduler?this.scheduler.add(()=>{l(f,m)},t):l(f,m),()=>{}}return u.callbacks.push(l),u.cancel||(u.cancel=o((f,m)=>{u.result=[f,m];for(const v of u.callbacks)this.scheduler?this.scheduler.add(()=>{v(f,m)},t):v(f,m);setTimeout(()=>delete this.entries[e],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(f=>f!==l),u.callbacks.length||(u.cancel(),delete this.entries[e]))}}}function Wv(i,e,t){const o=JSON.stringify(i.request);return i.data&&(this.deduped.entries[o]={result:[null,i.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},l=>{const u=Ie(i.request,(f,m,v,x)=>{f?l(f):m&&l(null,{vectorTile:t?void 0:new Ha.VectorTile(new Hu(m)),rawData:m,cacheControl:v,expires:x})});return()=>{u.cancel(),l()}},e)}s.ARRAY_TYPE=Ar,s.AUTH_ERR_MSG=si,s.Aabb=vr,s.Actor=class{constructor(i,e,t){this.target=i,this.parent=e,this.mapId=t,this.callbacks={},this.cancelCallbacks={},Ht(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Si()?i:D,this.scheduler=new d2}send(i,e,t,o,l=!1,u){const f=Math.round(1e18*Math.random()).toString(36).substring(0,10);t&&(t.metadata=u,this.callbacks[f]=t);const m=Jt(this.globalScope)?void 0:[];return this.target.postMessage({id:f,type:i,hasCallback:!!t,targetMapId:o,mustQueue:l,sourceMapId:this.mapId,data:Os(e,m)},m),{cancel:()=>{t&&delete this.callbacks[f],this.target.postMessage({id:f,type:"<cancel>",targetMapId:o,sourceMapId:this.mapId})}}}receive(i){const e=i.data,t=e.id;if(t&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const o=this.cancelCallbacks[t];delete this.cancelCallbacks[t],o&&o.cancel()}else if(e.mustQueue||Si()){const o=this.callbacks[t];this.cancelCallbacks[t]=this.scheduler.add(()=>this.processTask(t,e),o&&o.metadata||{type:"message"})}else this.processTask(t,e)}processTask(i,e){if(e.type==="<response>"){const t=this.callbacks[i];delete this.callbacks[i],t&&(e.error?t(Ra(e.error)):t(null,Ra(e.data)))}else{const t=Jt(this.globalScope)?void 0:[],o=e.hasCallback?(u,f)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:u?Os(u):null,data:Os(f,t)},t)}:u=>{},l=Ra(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,l,o);else if(this.parent.getWorkerSource){const u=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,u[0],l.source)[u[1]](l,o)}else o(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.CanonicalTileID=Wd,s.Color=Ni,s.ColorMode=Oo,s.CullFaceMode=po,s.DEMData=pf,s.DataConstantProperty=le,s.DedupedRequest=Zv,s.DepthMode=hc,s.EXTENT=ei,s.Elevation=class{isDataAvailableAtPoint(i){const e=this._source();if(!e||i.y<0||i.y>1)return!1;const t=e.getSource().maxzoom,o=1<<t,l=Math.floor(i.x),u=Math.floor((i.x-l)*o),f=Math.floor(i.y*o),m=this.findDEMTileFor(new cr(t,l,t,u,f));return!(!m||!m.dem)}getAtPointOrZero(i,e=0){return this.getAtPoint(i,e)||0}getAtPoint(i,e,t=!0){e==null&&(e=null);const o=this._source();if(!o||i.y<0||i.y>1)return e;const l=o.getSource().maxzoom,u=1<<l,f=Math.floor(i.x),m=i.x-f,v=new cr(l,f,l,Math.floor(m*u),Math.floor(i.y*u)),x=this.findDEMTileFor(v);if(!x||!x.dem)return e;const S=x.dem,A=1<<x.tileID.canonical.z,I=(m*A-x.tileID.canonical.x)*S.dim,P=(i.y*A-x.tileID.canonical.y)*S.dim,L=Math.floor(I),O=Math.floor(P);return(t?this.exaggeration():1)*Ai(Ai(S.get(L,O),S.get(L,O+1),P-O),Ai(S.get(L+1,O),S.get(L+1,O+1),P-O),I-L)}getAtTileOffset(i,e,t){const o=1<<i.canonical.z;return this.getAtPointOrZero(new Kl(i.wrap+(i.canonical.x+e/ei)/o,(i.canonical.y+t/ei)/o))}getAtTileOffsetFunc(i,e,t,o){return l=>{const u=this.getAtTileOffset(i,l.x,l.y),f=o.upVector(i.canonical,l.x,l.y);return co(f,f,u*o.upVectorScale(i.canonical,e,t).metersToTile),f}}getForTilePoints(i,e,t,o){const l=mf.create(this,i,o);return!!l&&(e.forEach(u=>{u[2]=this.exaggeration()*l.getElevationAt(u[0],u[1],t)}),!0)}getMinMaxForTile(i){const e=this.findDEMTileFor(i);if(!e||!e.dem)return null;const t=e.dem.tree,o=e.tileID,l=1<<i.canonical.z-o.canonical.z;let u=i.canonical.x/l-o.canonical.x,f=i.canonical.y/l-o.canonical.y,m=0;for(let v=0;v<i.canonical.z-o.canonical.z&&!t.leaves[m];v++){u*=2,f*=2;const x=2*Math.floor(f)+Math.floor(u);m=t.childOffsets[m]+x,u%=1,f%=1}return{min:this.exaggeration()*t.minimums[m],max:this.exaggeration()*t.maximums[m]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,e,t){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},s.ErrorEvent=vt,s.EvaluationParameters=W,s.Event=ce,s.Evented=Ze,s.FillExtrusionBucket=$u,s.Frustum=sm,s.FrustumCorners=om,s.GLOBE_METERS_TO_ECEF=Cm,s.GLOBE_RADIUS=hs,s.GLOBE_SCALE_MATCH_LATITUDE=45,s.GLOBE_ZOOM_THRESHOLD_MAX=6,s.GLOBE_ZOOM_THRESHOLD_MIN=5,s.GlobeSharedBuffers=class{constructor(i){this._createGrid(i),this._createPoles(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const i of this._poleSegments)i.destroy();for(const i of this._gridSegments)i.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const i of this._wireframeSegments)i.destroy()}}_createGrid(i){const e=new St,t=new _i,o=65;for(let l=0;l<o;l++)for(let u=0;u<o;u++)e.emplaceBack(u,l);this._gridSegments=[];for(let l=0,u=0;l<lc.length;l++){const f=lc[l];for(let v=0;v<f;v++)for(let x=0;x<64;x++){const S=v*o+x;t.emplaceBack(S+1,S,S+o),t.emplaceBack(S+o,S+o+1,S+1)}const m=64*f*2;this._gridSegments.push(An.simpleSegment(0,u,(f+1)*o,m)),u+=m}this._gridBuffer=i.createVertexBuffer(e,Yu.members),this._gridIndexBuffer=i.createIndexBuffer(t,!0)}_createPoles(i){const e=new _i;for(let l=0;l<=64;l++)e.emplaceBack(0,l+1,l+2);this._poleIndexBuffer=i.createIndexBuffer(e,!0);const t=new Zn,o=new Zn;this._poleSegments=[];for(let l=0,u=0;l<5;l++){const f=360/(1<<l);t.emplaceBack(0,-hs,0,.5,0),o.emplaceBack(0,-hs,0,.5,1);for(let m=0;m<=64;m++){const v=m/64,x=Ai(0,f,v),[S,A,I]=cc(ZT,WT,x,hs);t.emplaceBack(S,A,I,v,0),o.emplaceBack(S,A,I,v,1)}this._poleSegments.push(An.simpleSegment(u,0,66,64)),u+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(t,dv,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(o,dv,!1)}getGridBuffers(i){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[i]]}getPoleBuffers(i){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}getWirefameBuffers(i,e){if(!this._wireframeSegments){const t=new Jn,o=64,l=o+1;this._wireframeSegments=[];for(let u=0,f=0;u<lc.length;u++){const m=lc[u];for(let x=0;x<m;x++)for(let S=0;S<o;S++){const A=x*l+S;t.emplaceBack(A,A+1),t.emplaceBack(A,A+l),t.emplaceBack(A,A+l+1)}const v=m*o*3;this._wireframeSegments.push(An.simpleSegment(0,f,(m+1)*l,v)),f+=v}this._wireframeIndexBuffer=i.createIndexBuffer(t)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},s.GlyphManager=sc,s.ImagePosition=ym,s.LineAtlas=Lm,s.LngLat=Oi,s.LngLatBounds=Ns,s.LocalGlyphMode=wm,s.MAX_MERCATOR_LATITUDE=Po,s.MercatorCoordinate=Kl,s.ONE_EM=Hn,s.OverscaledTileID=cr,s.Properties=Je,s.RGBAImage=Mr,s.Ray=rm,s.RequestManager=class{constructor(i,e,t){this._transformRequestFn=i,this._customAccessToken=e,this._silenceAuthErrors=!!t,this._createSkuToken()}_createSkuToken(){const i=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",zi,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,e){return this._transformRequestFn&&this._transformRequestFn(i,e)||{url:i}}normalizeStyleURL(i,e){if(!Ci(i))return i;const t=En(i);return t.path=`/styles/v1${t.path}`,this._makeAPIURL(t,this._customAccessToken||e)}normalizeGlyphsURL(i,e){if(!Ci(i))return i;const t=En(i);return t.path=`/fonts/v1${t.path}`,this._makeAPIURL(t,this._customAccessToken||e)}normalizeSourceURL(i,e,t,o){if(!Ci(i))return i;const l=En(i);return l.path=`/v4/${l.authority}.json`,l.params.push("secure"),t&&l.params.push(`language=${t}`),o&&l.params.push(`worldview=${o}`),this._makeAPIURL(l,this._customAccessToken||e)}normalizeSpriteURL(i,e,t,o){const l=En(i);return Ci(i)?(l.path=`/styles/v1${l.path}/sprite${e}${t}`,this._makeAPIURL(l,this._customAccessToken||o)):(l.path+=`${e}${t}`,In(l))}normalizeTileURL(i,e,t){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!Ci(i))return i;const o=En(i);o.path=o.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||t&&o.authority!=="raster"&&t===512?"@2x":""}${ht.supported?".webp":"$1"}`),o.authority==="raster"?o.path=`/${He.RASTER_URL_PREFIX}${o.path}`:(o.path=o.path.replace(/^.+\/v4\//,"/"),o.path=`/${He.TILE_URL_VERSION}${o.path}`);const l=this._customAccessToken||function(u){for(const f of u){const m=f.match(/^access_token=(.*)$/);if(m)return m[1]}return null}(o.params)||He.ACCESS_TOKEN;return He.REQUIRE_ACCESS_TOKEN&&l&&this._skuToken&&o.params.push(`sku=${this._skuToken}`),this._makeAPIURL(o,l)}canonicalizeTileURL(i,e){const t=En(i);if(!t.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!t.path.match(/\.[\w]+$/))return i;let o="mapbox://";t.path.match(/^\/raster\/v1\//)?o+=`raster/${t.path.replace(`/${He.RASTER_URL_PREFIX}/`,"")}`:o+=`tiles/${t.path.replace(`/${He.TILE_URL_VERSION}/`,"")}`;let l=t.params;return e&&(l=l.filter(u=>!u.match(/^access_token=/))),l.length&&(o+=`?${l.join("&")}`),o}canonicalizeTileset(i,e){const t=!!e&&Ci(e),o=[];for(const l of i.tiles||[])un(l)?o.push(this.canonicalizeTileURL(l,t)):o.push(l);return o}_makeAPIURL(i,e){const t="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",o=En(He.API_URL);if(i.protocol=o.protocol,i.authority=o.authority,i.protocol==="http"){const l=i.params.indexOf("secure");l>=0&&i.params.splice(l,1)}if(o.path!=="/"&&(i.path=`${o.path}${i.path}`),!He.REQUIRE_ACCESS_TOKEN)return In(i);if(e=e||He.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${t}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${t}`)}return i.params=i.params.filter(l=>l.indexOf("access_token")===-1),i.params.push(`access_token=${e||""}`),In(i)}},s.ResourceType=me,s.SegmentVector=An,s.SourceCache=Ka,s.StencilMode=Fm,s.StructArrayLayout1ui2=es,s.StructArrayLayout2f1f2i16=so,s.StructArrayLayout2i4=St,s.StructArrayLayout2ui4=Jn,s.StructArrayLayout3f12=nn,s.StructArrayLayout3ui6=_i,s.StructArrayLayout4i8=Wt,s.StructArrayLayout5f20=Zn,s.Texture=oh,s.Tile=Bm,s.Transitionable=te,s.Uniform1f=Pd,s.Uniform1i=class extends rs{constructor(i){super(i),this.current=0}set(i,e,t){this.fetchUniformLocation(i,e)&&this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},s.Uniform2f=class extends rs{constructor(i){super(i),this.current=[0,0]}set(i,e,t){this.fetchUniformLocation(i,e)&&(t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1])))}},s.Uniform3f=class extends rs{constructor(i){super(i),this.current=[0,0,0]}set(i,e,t){this.fetchUniformLocation(i,e)&&(t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2])))}},s.Uniform4f=Vg,s.UniformColor=Ug,s.UniformMatrix2f=class extends rs{constructor(i){super(i),this.current=ew}set(i,e,t){if(this.fetchUniformLocation(i,e)){for(let o=0;o<4;o++)if(t[o]!==this.current[o]){this.current=t,this.gl.uniformMatrix2fv(this.location,!1,t);break}}}},s.UniformMatrix3f=class extends rs{constructor(i){super(i),this.current=Qb}set(i,e,t){if(this.fetchUniformLocation(i,e)){for(let o=0;o<9;o++)if(t[o]!==this.current[o]){this.current=t,this.gl.uniformMatrix3fv(this.location,!1,t);break}}}},s.UniformMatrix4f=class extends rs{constructor(i){super(i),this.current=Jb}set(i,e,t){if(this.fetchUniformLocation(i,e)){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let o=1;o<16;o++)if(t[o]!==this.current[o]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}}},s.UnwrappedTileID=Dy,s.ValidationError=Pt,s.VectorTileWorkerSource=class extends Ze{constructor(i,e,t,o,l){super(),this.actor=i,this.layerIndex=e,this.availableImages=t,this.loadVectorData=l||Wv,this.loading={},this.loaded={},this.deduped=new Zv(i.scheduler),this.isSpriteLoaded=o,this.scheduler=i.scheduler}loadTile(i,e){const t=i.uid,o=i&&i.request,l=o&&o.collectResourceTiming,u=this.loading[t]=new g2(i);u.abort=this.loadVectorData(i,(f,m)=>{const v=!this.loading[t];if(delete this.loading[t],v||f||!m)return u.status="done",v||(this.loaded[t]=u),e(f);const x=m.rawData,S={};m.expires&&(S.expires=m.expires),m.cacheControl&&(S.cacheControl=m.cacheControl),u.vectorTile=m.vectorTile||new Ha.VectorTile(new Hu(x));const A=()=>{u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,(I,P)=>{if(I||!P)return e(I);const L={};if(l){const O=ue(o);O.length>0&&(L.resourceTiming=JSON.parse(JSON.stringify(O)))}e(null,Ve({rawTileData:x.slice(0)},P,S,L))})};this.isSpriteLoaded?A():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(A,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):A()}),this.loaded=this.loaded||{},this.loaded[t]=u})}reloadTile(i,e){const t=this.loaded,o=i.uid,l=this;if(t&&t[o]){const u=t[o];u.showCollisionBoxes=i.showCollisionBoxes,u.enableTerrain=!!i.enableTerrain,u.projection=i.projection,u.tileTransform=Xa(i.tileID.canonical,i.projection);const f=(m,v)=>{const x=u.reloadCallback;x&&(delete u.reloadCallback,u.parse(u.vectorTile,l.layerIndex,this.availableImages,l.actor,x)),e(m,v)};u.status==="parsing"?u.reloadCallback=f:u.status==="done"&&(u.vectorTile?u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,f):f())}}abortTile(i,e){const t=i.uid,o=this.loading[t];o&&(o.abort&&o.abort(),delete this.loading[t]),e()}removeTile(i,e){const t=this.loaded,o=i.uid;t&&t[o]&&delete t[o],e()}},s.WritingMode=Ur,s.ZoomHistory=gd,s.add=js,s.addDynamicAttributes=hf,s.adjoint=function(i,e){var t=e[0],o=e[1],l=e[2],u=e[3],f=e[4],m=e[5],v=e[6],x=e[7],S=e[8];return i[0]=f*S-m*x,i[1]=l*x-o*S,i[2]=o*m-l*f,i[3]=m*v-u*S,i[4]=t*S-l*v,i[5]=l*u-t*m,i[6]=u*x-f*v,i[7]=o*v-t*x,i[8]=t*f-o*u,i},s.asyncAll=Pe,s.bezier=Ue,s.bindAll=Ht,s.boundsAttributes=zv,s.bufferConvexPolygon=function(i,e){const t=[];for(let o=0;o<i.length;o++){const l=be(o-1,-1,i.length-1),u=be(o+1,-1,i.length-1),f=i[o],m=i[u],v=i[l].sub(f).unit(),x=m.sub(f).unit(),S=x.angleWithSep(v.x,v.y),A=v.add(x).unit().mult(-1*e/Math.sin(S/2));t.push(f.add(A))}return t},s.cacheEntryPossiblyAdded=function(i){ne++,ne>io&&(i.getActor().send("enforceCacheSizeLimit",to),ne=0)},s.calculateGlobeLabelMatrix=function(i,e){const{x:t,y:o}=i.point,l=yv(t,o,i.worldSize/i._pixelsPerMercatorPixel,0,0);return Jl(l,l,Im(Bo(e)))},s.calculateGlobeMatrix=function(i){const{x:e,y:t}=i.point,{lng:o,lat:l}=i._center;return yv(e,t,i.worldSize,o,l)},s.calculateGlobeMercatorMatrix=function(i){const e=i.pixelsPerMeter,t=e/Gr(1,i.center.lat),o=Do(new Float64Array(16));return Bu(o,o,[i.point.x,i.point.y,0]),Ga(o,o,[t,t,e]),Float32Array.from(o)},s.circumferenceAtLatitude=$p,s.clamp=Se,s.clearTileCache=function(i){const e=Q(),t=[];for(const o in Sn)e&&t.push(e.delete(o)),delete Sn[o];i&&Promise.all(t).catch(i).then(()=>i())},s.clipLine=rv,s.clone=function(i){var e=new Ar(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},s.clone$1=Fe,s.collisionCircleLayout=hT,s.config=He,s.conjugate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i},s.create=function(){var i=new Ar(16);return Ar!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},s.create$1=ey,s.createExpression=Ps,s.createLayout=it,s.createStyleLayer=function(i){return i.type==="custom"?new l2(i):new u2[i.type](i)},s.cross=nm,s.degToRad=ve,s.distance=function(i,e){return Math.hypot(e[0]-i[0],e[1]-i[1],e[2]-i[2])},s.div=function(i,e,t){return i[0]=e[0]/t[0],i[1]=e[1]/t[1],i[2]=e[2]/t[2],i},s.dot=Wr,s.ease=Ge,s.easeCubicInOut=we,s.emitValidationErrors=Tu,s.endsWith=ot,s.enforceCacheSizeLimit=function(i){for(const e in Sn)B(e),Sn[e].then(t=>{t.keys().then(o=>{for(let l=0;l<o.length-i;l++)t.delete(o[l])})})},s.evaluateSizeForFeature=Kd,s.evaluateSizeForZoom=ic,s.evaluateVariableOffset=cv,s.evented=R,s.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]},s.exactEquals$1=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]},s.exported=Mt,s.exported$1=ht,s.extend=Ve,s.extend$1=wi,s.fillExtrusionHeightLift=ky,s.filterObject=di,s.fromMat4=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],i},s.fromQuat=function(i,e){var t=e[0],o=e[1],l=e[2],u=e[3],f=t+t,m=o+o,v=l+l,x=t*f,S=o*f,A=o*m,I=l*f,P=l*m,L=l*v,O=u*f,$=u*m,ee=u*v;return i[0]=1-A-L,i[1]=S+ee,i[2]=I-$,i[3]=0,i[4]=S-ee,i[5]=1-x-L,i[6]=P+O,i[7]=0,i[8]=I+$,i[9]=P-O,i[10]=1-x-A,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},s.fromRotation=function(i,e){var t=Math.sin(e),o=Math.cos(e);return i[0]=o,i[1]=t,i[2]=0,i[3]=-t,i[4]=o,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},s.fromScaling=ty,s.furthestTileCorner=function(i){const e=Math.round((i+45+360)%360/90)%4;return Ye[e]},s.getAABBPointSquareDist=function(i,e,t){let o=0;for(let l=0;l<2;++l){const u=t?t[l]:0;i[l]>u&&(o+=(i[l]-u)*(i[l]-u)),e[l]<u&&(o+=(u-e[l])*(u-e[l]))}return o},s.getAnchorAlignment=bm,s.getAnchorJustification=Em,s.getBounds=function(i){let e=1/0,t=1/0,o=-1/0,l=-1/0;for(const u of i)e=Math.min(e,u.x),t=Math.min(t,u.y),o=Math.max(o,u.x),l=Math.max(l,u.y);return{min:new U(e,t),max:new U(o,l)}},s.getColumn=Bi,s.getGridMatrix=function(i,e,t){const o=e.getNorth(),l=e.getSouth(),u=e.getWest(),f=.015625;return[0,(e.getEast()-u)*f,1<<i.z,(l-o)/lc[t],0,i.y,o,u,f]},s.getImage=Qt,s.getJSON=function(i,e){return ge(Ve(i,{type:"json"}),e)},s.getLatitudinalLod=function(i){const e=80.051129;i=Se(i,-80.051129,e)/e*90;const t=Math.pow(Math.abs(Math.sin(ve(i))),3);return Math.round(t*(lc.length-1))},s.getMapSessionAPI=ha,s.getPerformanceMeasurement=ue,s.getProjection=Cv,s.getRTLTextPluginStatus=j,s.getReferrer=Ee,s.getTilePoint=function(i,{x:e,y:t},o=0){return new U(((e-o)*i.scale-i.x)*ei,(t*i.scale-i.y)*ei)},s.getTileVec3=function(i,e,t=0){return Ql(((e.x-t)*i.scale-i.x)*ei,(e.y*i.scale-i.y)*ei,qg(e.z,e.y))},s.getVideo=function(i,e){const t=D.document.createElement("video");t.muted=!0,t.onloadstart=function(){e(null,t)};for(let o=0;o<i.length;o++){const l=D.document.createElement("source");st(i[o])||(t.crossOrigin="Anonymous"),l.src=i[o],t.appendChild(l)}return{cancel:()=>{}}},s.globeCenterToScreenPoint=function(i){const e=[0,0,0],t=Do(new Float64Array(16));return Jl(t,i.pixelMatrix,i.globeMatrix),zn(e,e,t),new U(e[0],e[1])},s.globeDenormalizeECEF=Im,s.globeECEFOrigin=function(i,e){const t=[0,0,0];return zn(t,t,Qu(Bo(e.canonical))),zn(t,t,i),t},s.globeNormalizeECEF=Qu,s.globePixelsToTileUnits=function(i,e){return ei/(512*Math.pow(2,i))*sf(Bo(e))},s.globePoleMatrixForTile=function(i,e,t){const o=Do(new Float64Array(16)),l=(e/(1<<i)-.5)*Math.PI*2;return Od(o,t.globeMatrix,l),Float32Array.from(o)},s.globeTileBounds=Bo,s.globeTiltAtLngLat=vv,s.globeToMercatorTransition=eh,s.globeUseCustomAntiAliasing=function(i,e,t){const o=eh(t.zoom),l=i.style.map._antialias,u=!!e.extStandardDerivatives,f=e.extStandardDerivativesForceOff||i.terrain&&i.terrain.exaggeration()>0;return o===0&&!l&&!f&&u},s.identity=Do,s.identity$1=ly,s.invert=Yp,s.isFullscreen=function(){return!!D.document.fullscreenElement||!!D.document.webkitFullscreenElement},s.isLngLatBehindGlobe=function(i,e){return vv(i,e)>Math.PI/2*1.01},s.isMapAuthenticated=function(i){return Dr.has(i)},s.isMapboxURL=Ci,s.isSafariWithAntialiasingBug=function(i){const e=i.navigator?i.navigator.userAgent:null;return!!Jt(i)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.latFromMercatorY=Wn,s.len=gw,s.length=Ru,s.length$1=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},s.loadVectorTile=Wv,s.makeRequest=ge,s.mapValue=function(i,e,t,o,l){return Se((i-e)/(t-e)*(l-o)+o,o,l)},s.mercatorScale=$g,s.mercatorXfromLng=zo,s.mercatorYfromLat=ss,s.mercatorZfromAltitude=Gr,s.mul=mw,s.mul$1=_w,s.multiply=Jl,s.multiply$1=function(i,e,t){var o=e[0],l=e[1],u=e[2],f=e[3],m=e[4],v=e[5],x=e[6],S=e[7],A=e[8],I=t[0],P=t[1],L=t[2],O=t[3],$=t[4],ee=t[5],se=t[6],ie=t[7],re=t[8];return i[0]=I*o+P*f+L*x,i[1]=I*l+P*m+L*S,i[2]=I*u+P*v+L*A,i[3]=O*o+$*f+ee*x,i[4]=O*l+$*m+ee*S,i[5]=O*u+$*v+ee*A,i[6]=se*o+ie*f+re*x,i[7]=se*l+ie*m+re*S,i[8]=se*u+ie*v+re*A,i},s.multiply$2=ry,s.nextPowerOfTwo=Ke,s.normalize=lr,s.normalize$1=function(i,e){var t=e[0],o=e[1],l=e[2],u=e[3],f=t*t+o*o+l*l+u*u;return f>0&&(f=1/Math.sqrt(f)),i[0]=t*f,i[1]=o*f,i[2]=l*f,i[3]=u*f,i},s.number=Ai,s.ortho=function(i,e,t,o,l,u,f){var m=1/(e-t),v=1/(o-l),x=1/(u-f);return i[0]=-2*m,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*v,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*x,i[11]=0,i[12]=(e+t)*m,i[13]=(l+o)*v,i[14]=(f+u)*x,i[15]=1,i},s.pbf=Hu,s.perspective=function(i,e,t,o,l){var u,f=1/Math.tan(e/2);return i[0]=f/t,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=f,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,l!=null&&l!==1/0?(i[10]=(l+o)*(u=1/(o-l)),i[14]=2*l*o*u):(i[10]=-1,i[14]=-2*o),i},s.pick=function(i,e){const t={};for(let o=0;o<e.length;o++){const l=e[o];l in i&&(t[l]=i[l])}return t},s.plugin=Z,s.pointGeometry=U,s.polygonContainsPoint=$a,s.polygonIntersectsBox=Yg,s.polygonIntersectsPolygon=Wg,s.polygonizeBounds=function(i,e,t=0,o=!0){const l=new U(t,t),u=i.sub(l),f=e.add(l),m=[u,new U(f.x,u.y),f,new U(u.x,f.y)];return o&&m.push(u.clone()),m},s.posAttributes=Yu,s.postMapLoadEvent=Ho,s.postTurnstileEvent=Pr,s.potpack=gm,s.prevPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},s.radToDeg=ze,s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.registerForPluginStateChange=function(i){return i({pluginStatus:T,pluginURL:C}),R.on("pluginStateChange",i),i},s.removeAuthState=function(i){Dr.delete(i)},s.renderColorRamp=lm,s.resample=Gg,s.rotateX=Jp,s.rotateX$1=cy,s.rotateY=Od,s.rotateY$1=uy,s.rotateZ=function(i,e,t){var o=Math.sin(t),l=Math.cos(t),u=e[0],f=e[1],m=e[2],v=e[3],x=e[4],S=e[5],A=e[6],I=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=u*l+x*o,i[1]=f*l+S*o,i[2]=m*l+A*o,i[3]=v*l+I*o,i[4]=x*l-u*o,i[5]=S*l-f*o,i[6]=A*l-m*o,i[7]=I*l-v*o,i},s.rotateZ$1=function(i,e,t){t*=.5;var o=e[0],l=e[1],u=e[2],f=e[3],m=Math.sin(t),v=Math.cos(t);return i[0]=o*v+l*m,i[1]=l*v-o*m,i[2]=u*v+f*m,i[3]=f*v-u*m,i},s.scale=Ga,s.scale$1=sy,s.scale$2=co,s.scaleAndAdd=Vd,s.setCacheLimits=function(i,e){to=i,io=e},s.setColumn=function(i,e,t){i[4*e+0]=t[0],i[4*e+1]=t[1],i[4*e+2]=t[2],i[4*e+3]=t[3]},s.setRTLTextPlugin=function(i,e,t=!1){if(T===d||T===_||T===g)throw new Error("setRTLTextPlugin cannot be called multiple times.");C=Mt.resolveURL(i),T=d,w=e,z(),t||X()},s.smoothstep=De,s.spec=Ce,s.storeAuthState=function(i,e){e?Dr.add(i):Dr.delete(i)},s.sub=uo,s.subtract=em,s.symbolSize=dT,s.tileAABB=function(i,e,t,o,l,u,f,m,v){if(v.name==="globe")return GT(i,e,new Wd(t,o,l));const x=Xa({z:t,x:o,y:l},v);return new vr([(u+x.x/x.scale)*e,e*(x.y/x.scale),f],[(u+x.x2/x.scale)*e,e*(x.y2/x.scale),m])},s.tileCornersToBounds=rf,s.tileTransform=Xa,s.transformMat3=function(i,e,t){var o=e[0],l=e[1],u=e[2];return i[0]=o*t[0]+l*t[3]+u*t[6],i[1]=o*t[1]+l*t[4]+u*t[7],i[2]=o*t[2]+l*t[5]+u*t[8],i},s.transformMat4=zn,s.transformMat4$1=Za,s.transformQuat=oy,s.transitionTileAABBinECEF=mv,s.translate=Bu,s.transpose=function(i,e){if(i===e){var t=e[1],o=e[2],l=e[5];i[1]=e[3],i[2]=e[6],i[3]=t,i[5]=e[7],i[6]=o,i[7]=l}else i[0]=e[0],i[1]=e[3],i[2]=e[6],i[3]=e[1],i[4]=e[4],i[5]=e[7],i[6]=e[2],i[7]=e[5],i[8]=e[8];return i},s.triggerPluginCompletionEvent=k,s.uniqueId=qe,s.updateGlobeVertexNormal=function(i,e,t,o,l){const u=5*e+2;i.float32[u+0]=t,i.float32[u+1]=o,i.float32[u+2]=l},s.validateCustomStyleLayer=function(i){const e=[],t=i.id;return t===void 0&&e.push({message:`layers.${t}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${t}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${t}: property "renderingMode" must be either "2d" or "3d"`}),e},s.validateFilter=i=>oo(Bs(i)),s.validateFog=i=>oo(fd(i)),s.validateLayer=i=>oo(Vl(i)),s.validateLight=i=>oo(dd(i)),s.validateSource=i=>oo(hd(i)),s.validateStyle=jl,s.validateTerrain=i=>oo(Nl(i)),s.values=Xe,s.vectorTile=Ha,s.version=Te,s.warnOnce=xt,s.window=D,s.wrap=be}),E(["./shared"],function(s){function D(Q){if(typeof Q=="number"||typeof Q=="boolean"||typeof Q=="string"||Q==null)return JSON.stringify(Q);if(Array.isArray(Q)){let F="[";for(const J of Q)F+=`${D(J)},`;return`${F}]`}let B="{";for(const F of Object.keys(Q).sort())B+=`${F}:${D(Q[F])},`;return`${B}}`}function V(Q){let B="";for(const F of s.refProperties)B+=`/${D(Q[F])}`;return B}class N{constructor(B){this.keyCache={},B&&this.replace(B)}replace(B){this._layerConfigs={},this._layers={},this.update(B,[])}update(B,F){for(const ne of B)this._layerConfigs[ne.id]=ne,(this._layers[ne.id]=s.createStyleLayer(ne)).compileFilter(),this.keyCache[ne.id]&&delete this.keyCache[ne.id];for(const ne of F)delete this.keyCache[ne],delete this._layerConfigs[ne],delete this._layers[ne];this.familiesBySource={};const J=function(ne,me){const Me={};for(let ge=0;ge<ne.length;ge++){const Ie=me&&me[ne[ge].id]||V(ne[ge]);me&&(me[ne[ge].id]=Ie);let Qe=Me[Ie];Qe||(Qe=Me[Ie]=[]),Qe.push(ne[ge])}const Ee=[];for(const ge in Me)Ee.push(Me[ge]);return Ee}(s.values(this._layerConfigs),this.keyCache);for(const ne of J){const me=ne.map(Ct=>this._layers[Ct.id]),Me=me[0];if(Me.visibility==="none")continue;const Ee=Me.source||"";let ge=this.familiesBySource[Ee];ge||(ge=this.familiesBySource[Ee]={});const Ie=Me.sourceLayer||"_geojsonTileLayer";let Qe=ge[Ie];Qe||(Qe=ge[Ie]=[]),Qe.push(me)}}}class U{loadTile(B,F){const{uid:J,encoding:ne,rawImageData:me,padding:Me,buildQuadTree:Ee}=B,ge=s.window.ImageBitmap&&me instanceof s.window.ImageBitmap?this.getImageData(me,Me):me;F(null,new s.DEMData(J,ge,ne,Me<1,Ee))}getImageData(B,F){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(B.width,B.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=B.width,this.offscreenCanvas.height=B.height,this.offscreenCanvasContext.drawImage(B,0,0,B.width,B.height);const J=this.offscreenCanvasContext.getImageData(-F,-F,B.width+2*F,B.height+2*F);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),J}}var q=function Q(B,F){var J,ne=B&&B.type;if(ne==="FeatureCollection")for(J=0;J<B.features.length;J++)Q(B.features[J],F);else if(ne==="GeometryCollection")for(J=0;J<B.geometries.length;J++)Q(B.geometries[J],F);else if(ne==="Feature")Q(B.geometry,F);else if(ne==="Polygon")Y(B.coordinates,F);else if(ne==="MultiPolygon")for(J=0;J<B.coordinates.length;J++)Y(B.coordinates[J],F);return B};function Y(Q,B){if(Q.length!==0){_e(Q[0],B);for(var F=1;F<Q.length;F++)_e(Q[F],!B)}}function _e(Q,B){for(var F=0,J=0,ne=0,me=Q.length,Me=me-1;ne<me;Me=ne++){var Ee=(Q[ne][0]-Q[Me][0])*(Q[Me][1]+Q[ne][1]),ge=F+Ee;J+=Math.abs(F)>=Math.abs(Ee)?F-ge+Ee:Ee-ge+F,F=ge}F+J>=0!=!!B&&Q.reverse()}const ve=s.vectorTile.VectorTileFeature.prototype.toGeoJSON;class ze{constructor(B){this._feature=B,this.extent=s.EXTENT,this.type=B.type,this.properties=B.tags,"id"in B&&!isNaN(B.id)&&(this.id=parseInt(B.id,10))}loadGeometry(){if(this._feature.type===1){const B=[];for(const F of this._feature.geometry)B.push([new s.pointGeometry(F[0],F[1])]);return B}{const B=[];for(const F of this._feature.geometry){const J=[];for(const ne of F)J.push(new s.pointGeometry(ne[0],ne[1]));B.push(J)}return B}}toGeoJSON(B,F,J){return ve.call(this,B,F,J)}}class Ye{constructor(B){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=B.length,this._features=B}feature(B){return new ze(this._features[B])}}var we=s.vectorTile.VectorTileFeature,Ue=Ge;function Ge(Q,B){this.options=B||{},this.features=Q,this.length=Q.length}function Se(Q,B){this.id=typeof Q.id=="number"?Q.id:void 0,this.type=Q.type,this.rawGeometry=Q.type===1?[Q.geometry]:Q.geometry,this.properties=Q.tags,this.extent=B||4096}Ge.prototype.feature=function(Q){return new Se(this.features[Q],this.options.extent)},Se.prototype.loadGeometry=function(){var Q=this.rawGeometry;this.geometry=[];for(var B=0;B<Q.length;B++){for(var F=Q[B],J=[],ne=0;ne<F.length;ne++)J.push(new s.pointGeometry(F[ne][0],F[ne][1]));this.geometry.push(J)}return this.geometry},Se.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Q=this.geometry,B=1/0,F=-1/0,J=1/0,ne=-1/0,me=0;me<Q.length;me++)for(var Me=Q[me],Ee=0;Ee<Me.length;Ee++){var ge=Me[Ee];B=Math.min(B,ge.x),F=Math.max(F,ge.x),J=Math.min(J,ge.y),ne=Math.max(ne,ge.y)}return[B,J,F,ne]},Se.prototype.toGeoJSON=we.prototype.toGeoJSON;var De=Pe,be=Ue;function Pe(Q){var B=new s.pbf;return function(F,J){for(var ne in F.layers)J.writeMessage(3,Xe,F.layers[ne])}(Q,B),B.finish()}function Xe(Q,B){var F;B.writeVarintField(15,Q.version||1),B.writeStringField(1,Q.name||""),B.writeVarintField(5,Q.extent||4096);var J={keys:[],values:[],keycache:{},valuecache:{}};for(F=0;F<Q.length;F++)J.feature=Q.feature(F),B.writeMessage(2,Ve,J);var ne=J.keys;for(F=0;F<ne.length;F++)B.writeStringField(3,ne[F]);var me=J.values;for(F=0;F<me.length;F++)B.writeMessage(4,Ft,me[F])}function Ve(Q,B){var F=Q.feature;F.id!==void 0&&B.writeVarintField(1,F.id),B.writeMessage(2,nt,Q),B.writeVarintField(3,F.type),B.writeMessage(4,Ke,F)}function nt(Q,B){var F=Q.feature,J=Q.keys,ne=Q.values,me=Q.keycache,Me=Q.valuecache;for(var Ee in F.properties){var ge=F.properties[Ee],Ie=me[Ee];if(ge!==null){Ie===void 0&&(J.push(Ee),me[Ee]=Ie=J.length-1),B.writeVarint(Ie);var Qe=typeof ge;Qe!=="string"&&Qe!=="boolean"&&Qe!=="number"&&(ge=JSON.stringify(ge));var Ct=Qe+":"+ge,st=Me[Ct];st===void 0&&(ne.push(ge),Me[Ct]=st=ne.length-1),B.writeVarint(st)}}}function qe(Q,B){return(B<<3)+(7&Q)}function $e(Q){return Q<<1^Q>>31}function Ke(Q,B){for(var F=Q.loadGeometry(),J=Q.type,ne=0,me=0,Me=F.length,Ee=0;Ee<Me;Ee++){var ge=F[Ee],Ie=1;J===1&&(Ie=ge.length),B.writeVarint(qe(1,Ie));for(var Qe=J===3?ge.length-1:ge.length,Ct=0;Ct<Qe;Ct++){Ct===1&&J!==1&&B.writeVarint(qe(2,Qe-1));var st=ge[Ct].x-ne,$t=ge[Ct].y-me;B.writeVarint($e(st)),B.writeVarint($e($t)),ne+=st,me+=$t}J===3&&B.writeVarint(qe(7,1))}}function Ft(Q,B){var F=typeof Q;F==="string"?B.writeStringField(1,Q):F==="boolean"?B.writeBooleanField(7,Q):F==="number"&&(Q%1!=0?B.writeDoubleField(3,Q):Q<0?B.writeSVarintField(6,Q):B.writeVarintField(5,Q))}function Ht(Q,B,F,J,ne,me){if(ne-J<=F)return;const Me=J+ne>>1;ot(Q,B,Me,J,ne,me%2),Ht(Q,B,F,J,Me-1,me+1),Ht(Q,B,F,Me+1,ne,me+1)}function ot(Q,B,F,J,ne,me){for(;ne>J;){if(ne-J>600){const Ie=ne-J+1,Qe=F-J+1,Ct=Math.log(Ie),st=.5*Math.exp(2*Ct/3),$t=.5*Math.sqrt(Ct*st*(Ie-st)/Ie)*(Qe-Ie/2<0?-1:1);ot(Q,B,F,Math.max(J,Math.floor(F-Qe*st/Ie+$t)),Math.min(ne,Math.floor(F+(Ie-Qe)*st/Ie+$t)),me)}const Me=B[2*F+me];let Ee=J,ge=ne;for(At(Q,B,J,F),B[2*ne+me]>Me&&At(Q,B,J,ne);Ee<ge;){for(At(Q,B,Ee,ge),Ee++,ge--;B[2*Ee+me]<Me;)Ee++;for(;B[2*ge+me]>Me;)ge--}B[2*J+me]===Me?At(Q,B,J,ge):(ge++,At(Q,B,ge,ne)),ge<=F&&(J=ge+1),F<=ge&&(ne=ge-1)}}function At(Q,B,F,J){di(Q,F,J),di(B,2*F,2*J),di(B,2*F+1,2*J+1)}function di(Q,B,F){const J=Q[B];Q[B]=Q[F],Q[F]=J}function Fe(Q,B,F,J){const ne=Q-F,me=B-J;return ne*ne+me*me}De.fromVectorTileJs=Pe,De.fromGeojsonVt=function(Q,B){B=B||{};var F={};for(var J in Q)F[J]=new Ue(Q[J].features,B),F[J].name=J,F[J].version=B.version,F[J].extent=B.extent;return Pe({layers:F})},De.GeoJSONWrapper=be;const _t=Q=>Q[0],xt=Q=>Q[1];class Lt{constructor(B,F=_t,J=xt,ne=64,me=Float64Array){this.nodeSize=ne,this.points=B;const Me=B.length<65536?Uint16Array:Uint32Array,Ee=this.ids=new Me(B.length),ge=this.coords=new me(2*B.length);for(let Ie=0;Ie<B.length;Ie++)Ee[Ie]=Ie,ge[2*Ie]=F(B[Ie]),ge[2*Ie+1]=J(B[Ie]);Ht(Ee,ge,ne,0,Ee.length-1,0)}range(B,F,J,ne){return function(me,Me,Ee,ge,Ie,Qe,Ct){const st=[0,me.length-1,0],$t=[];let Xt,jt;for(;st.length;){const Qt=st.pop(),ci=st.pop(),Pi=st.pop();if(ci-Pi<=Ct){for(let Ze=Pi;Ze<=ci;Ze++)Xt=Me[2*Ze],jt=Me[2*Ze+1],Xt>=Ee&&Xt<=Ie&&jt>=ge&&jt<=Qe&&$t.push(me[Ze]);continue}const ce=Math.floor((Pi+ci)/2);Xt=Me[2*ce],jt=Me[2*ce+1],Xt>=Ee&&Xt<=Ie&&jt>=ge&&jt<=Qe&&$t.push(me[ce]);const vt=(Qt+1)%2;(Qt===0?Ee<=Xt:ge<=jt)&&(st.push(Pi),st.push(ce-1),st.push(vt)),(Qt===0?Ie>=Xt:Qe>=jt)&&(st.push(ce+1),st.push(ci),st.push(vt))}return $t}(this.ids,this.coords,B,F,J,ne,this.nodeSize)}within(B,F,J){return function(ne,me,Me,Ee,ge,Ie){const Qe=[0,ne.length-1,0],Ct=[],st=ge*ge;for(;Qe.length;){const $t=Qe.pop(),Xt=Qe.pop(),jt=Qe.pop();if(Xt-jt<=Ie){for(let vt=jt;vt<=Xt;vt++)Fe(me[2*vt],me[2*vt+1],Me,Ee)<=st&&Ct.push(ne[vt]);continue}const Qt=Math.floor((jt+Xt)/2),ci=me[2*Qt],Pi=me[2*Qt+1];Fe(ci,Pi,Me,Ee)<=st&&Ct.push(ne[Qt]);const ce=($t+1)%2;($t===0?Me-ge<=ci:Ee-ge<=Pi)&&(Qe.push(jt),Qe.push(Qt-1),Qe.push(ce)),($t===0?Me+ge>=ci:Ee+ge>=Pi)&&(Qe.push(Qt+1),Qe.push(Xt),Qe.push(ce))}return Ct}(this.ids,this.coords,B,F,J,this.nodeSize)}}const pi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Q=>Q},Si=Math.fround||(Kt=new Float32Array(1),Q=>(Kt[0]=+Q,Kt[0]));var Kt;class Yt{constructor(B){this.options=ct(Object.create(pi),B),this.trees=new Array(this.options.maxZoom+1)}load(B){const{log:F,minZoom:J,maxZoom:ne,nodeSize:me}=this.options;F&&console.time("total time");const Me=`prepare ${B.length} points`;F&&console.time(Me),this.points=B;let Ee=[];for(let ge=0;ge<B.length;ge++)B[ge].geometry&&Ee.push(Et(B[ge],ge));this.trees[ne+1]=new Lt(Ee,ut,bt,me,Float32Array),F&&console.timeEnd(Me);for(let ge=ne;ge>=J;ge--){const Ie=+Date.now();Ee=this._cluster(Ee,ge),this.trees[ge]=new Lt(Ee,ut,bt,me,Float32Array),F&&console.log("z%d: %d clusters in %dms",ge,Ee.length,+Date.now()-Ie)}return F&&console.timeEnd("total time"),this}getClusters(B,F){let J=((B[0]+180)%360+360)%360-180;const ne=Math.max(-90,Math.min(90,B[1]));let me=B[2]===180?180:((B[2]+180)%360+360)%360-180;const Me=Math.max(-90,Math.min(90,B[3]));if(B[2]-B[0]>=360)J=-180,me=180;else if(J>me){const Qe=this.getClusters([J,ne,180,Me],F),Ct=this.getClusters([-180,ne,me,Me],F);return Qe.concat(Ct)}const Ee=this.trees[this._limitZoom(F)],ge=Ee.range(ue(J),Te(Me),ue(me),Te(ne)),Ie=[];for(const Qe of ge){const Ct=Ee.points[Qe];Ie.push(Ct.numPoints?Bi(Ct):this.points[Ct.index])}return Ie}getChildren(B){const F=this._getOriginId(B),J=this._getOriginZoom(B),ne="No cluster with the specified id.",me=this.trees[J];if(!me)throw new Error(ne);const Me=me.points[F];if(!Me)throw new Error(ne);const Ee=this.options.radius/(this.options.extent*Math.pow(2,J-1)),ge=me.within(Me.x,Me.y,Ee),Ie=[];for(const Qe of ge){const Ct=me.points[Qe];Ct.parentId===B&&Ie.push(Ct.numPoints?Bi(Ct):this.points[Ct.index])}if(Ie.length===0)throw new Error(ne);return Ie}getLeaves(B,F,J){const ne=[];return this._appendLeaves(ne,B,F=F||10,J=J||0,0),ne}getTile(B,F,J){const ne=this.trees[this._limitZoom(B)],me=Math.pow(2,B),{extent:Me,radius:Ee}=this.options,ge=Ee/Me,Ie=(J-ge)/me,Qe=(J+1+ge)/me,Ct={features:[]};return this._addTileFeatures(ne.range((F-ge)/me,Ie,(F+1+ge)/me,Qe),ne.points,F,J,me,Ct),F===0&&this._addTileFeatures(ne.range(1-ge/me,Ie,1,Qe),ne.points,me,J,me,Ct),F===me-1&&this._addTileFeatures(ne.range(0,Ie,ge/me,Qe),ne.points,-1,J,me,Ct),Ct.features.length?Ct:null}getClusterExpansionZoom(B){let F=this._getOriginZoom(B)-1;for(;F<=this.options.maxZoom;){const J=this.getChildren(B);if(F++,J.length!==1)break;B=J[0].properties.cluster_id}return F}_appendLeaves(B,F,J,ne,me){const Me=this.getChildren(F);for(const Ee of Me){const ge=Ee.properties;if(ge&&ge.cluster?me+ge.point_count<=ne?me+=ge.point_count:me=this._appendLeaves(B,ge.cluster_id,J,ne,me):me<ne?me++:B.push(Ee),B.length===J)break}return me}_addTileFeatures(B,F,J,ne,me,Me){for(const Ee of B){const ge=F[Ee],Ie=ge.numPoints;let Qe,Ct,st;if(Ie)Qe=xn(ge),Ct=ge.x,st=ge.y;else{const jt=this.points[ge.index];Qe=jt.properties,Ct=ue(jt.geometry.coordinates[0]),st=Te(jt.geometry.coordinates[1])}const $t={type:1,geometry:[[Math.round(this.options.extent*(Ct*me-J)),Math.round(this.options.extent*(st*me-ne))]],tags:Qe};let Xt;Ie?Xt=ge.id:this.options.generateId?Xt=ge.index:this.points[ge.index].id&&(Xt=this.points[ge.index].id),Xt!==void 0&&($t.id=Xt),Me.features.push($t)}}_limitZoom(B){return Math.max(this.options.minZoom,Math.min(+B,this.options.maxZoom+1))}_cluster(B,F){const J=[],{radius:ne,extent:me,reduce:Me,minPoints:Ee}=this.options,ge=ne/(me*Math.pow(2,F));for(let Ie=0;Ie<B.length;Ie++){const Qe=B[Ie];if(Qe.zoom<=F)continue;Qe.zoom=F;const Ct=this.trees[F+1],st=Ct.within(Qe.x,Qe.y,ge),$t=Qe.numPoints||1;let Xt=$t;for(const jt of st){const Qt=Ct.points[jt];Qt.zoom>F&&(Xt+=Qt.numPoints||1)}if(Xt>$t&&Xt>=Ee){let jt=Qe.x*$t,Qt=Qe.y*$t,ci=Me&&$t>1?this._map(Qe,!0):null;const Pi=(Ie<<5)+(F+1)+this.points.length;for(const ce of st){const vt=Ct.points[ce];if(vt.zoom<=F)continue;vt.zoom=F;const Ze=vt.numPoints||1;jt+=vt.x*Ze,Qt+=vt.y*Ze,vt.parentId=Pi,Me&&(ci||(ci=this._map(Qe,!0)),Me(ci,this._map(vt)))}Qe.parentId=Pi,J.push(Jt(jt/Xt,Qt/Xt,Pi,Xt,ci))}else if(J.push(Qe),Xt>1)for(const jt of st){const Qt=Ct.points[jt];Qt.zoom<=F||(Qt.zoom=F,J.push(Qt))}}return J}_getOriginId(B){return B-this.points.length>>5}_getOriginZoom(B){return(B-this.points.length)%32}_map(B,F){if(B.numPoints)return F?ct({},B.properties):B.properties;const J=this.points[B.index].properties,ne=this.options.map(J);return F&&ne===J?ct({},ne):ne}}function Jt(Q,B,F,J,ne){return{x:Si(Q),y:Si(B),zoom:1/0,id:F,parentId:-1,numPoints:J,properties:ne}}function Et(Q,B){const[F,J]=Q.geometry.coordinates;return{x:Si(ue(F)),y:Si(Te(J)),zoom:1/0,index:B,parentId:-1}}function Bi(Q){return{type:"Feature",id:Q.id,properties:xn(Q),geometry:{type:"Point",coordinates:[(B=Q.x,360*(B-.5)),Be(Q.y)]}};var B}function xn(Q){const B=Q.numPoints,F=B>=1e4?`${Math.round(B/1e3)}k`:B>=1e3?Math.round(B/100)/10+"k":B;return ct(ct({},Q.properties),{cluster:!0,cluster_id:Q.id,point_count:B,point_count_abbreviated:F})}function ue(Q){return Q/360+.5}function Te(Q){const B=Math.sin(Q*Math.PI/180),F=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return F<0?0:F>1?1:F}function Be(Q){const B=(180-360*Q)*Math.PI/180;return 360*Math.atan(Math.exp(B))/Math.PI-90}function ct(Q,B){for(const F in B)Q[F]=B[F];return Q}function ut(Q){return Q.x}function bt(Q){return Q.y}function Mt(Q,B,F,J){for(var ne,me=J,Me=F-B>>1,Ee=F-B,ge=Q[B],Ie=Q[B+1],Qe=Q[F],Ct=Q[F+1],st=B+3;st<F;st+=3){var $t=gt(Q[st],Q[st+1],ge,Ie,Qe,Ct);if($t>me)ne=st,me=$t;else if($t===me){var Xt=Math.abs(st-Me);Xt<Ee&&(ne=st,Ee=Xt)}}me>J&&(ne-B>3&&Mt(Q,B,ne,J),Q[ne+2]=me,F-ne>3&&Mt(Q,ne,F,J))}function gt(Q,B,F,J,ne,me){var Me=ne-F,Ee=me-J;if(Me!==0||Ee!==0){var ge=((Q-F)*Me+(B-J)*Ee)/(Me*Me+Ee*Ee);ge>1?(F=ne,J=me):ge>0&&(F+=Me*ge,J+=Ee*ge)}return(Me=Q-F)*Me+(Ee=B-J)*Ee}function He(Q,B,F,J){var ne={id:Q===void 0?null:Q,type:B,geometry:F,tags:J,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(me){var Me=me.geometry,Ee=me.type;if(Ee==="Point"||Ee==="MultiPoint"||Ee==="LineString")ht(me,Me);else if(Ee==="Polygon"||Ee==="MultiLineString")for(var ge=0;ge<Me.length;ge++)ht(me,Me[ge]);else if(Ee==="MultiPolygon")for(ge=0;ge<Me.length;ge++)for(var Ie=0;Ie<Me[ge].length;Ie++)ht(me,Me[ge][Ie])}(ne),ne}function ht(Q,B){for(var F=0;F<B.length;F+=3)Q.minX=Math.min(Q.minX,B[F]),Q.minY=Math.min(Q.minY,B[F+1]),Q.maxX=Math.max(Q.maxX,B[F]),Q.maxY=Math.max(Q.maxY,B[F+1])}function qt(Q,B,F,J){if(B.geometry){var ne=B.geometry.coordinates,me=B.geometry.type,Me=Math.pow(F.tolerance/((1<<F.maxZoom)*F.extent),2),Ee=[],ge=B.id;if(F.promoteId?ge=B.properties[F.promoteId]:F.generateId&&(ge=J||0),me==="Point")Nt(ne,Ee);else if(me==="MultiPoint")for(var Ie=0;Ie<ne.length;Ie++)Nt(ne[Ie],Ee);else if(me==="LineString")Zt(ne,Ee,Me,!1);else if(me==="MultiLineString"){if(F.lineMetrics){for(Ie=0;Ie<ne.length;Ie++)Zt(ne[Ie],Ee=[],Me,!1),Q.push(He(ge,"LineString",Ee,B.properties));return}ti(ne,Ee,Me,!1)}else if(me==="Polygon")ti(ne,Ee,Me,!0);else{if(me!=="MultiPolygon"){if(me==="GeometryCollection"){for(Ie=0;Ie<B.geometry.geometries.length;Ie++)qt(Q,{id:ge,geometry:B.geometry.geometries[Ie],properties:B.properties},F,J);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ie=0;Ie<ne.length;Ie++){var Qe=[];ti(ne[Ie],Qe,Me,!0),Ee.push(Qe)}}Q.push(He(ge,me,Ee,B.properties))}}function Nt(Q,B){B.push(mi(Q[0])),B.push(zi(Q[1])),B.push(0)}function Zt(Q,B,F,J){for(var ne,me,Me=0,Ee=0;Ee<Q.length;Ee++){var ge=mi(Q[Ee][0]),Ie=zi(Q[Ee][1]);B.push(ge),B.push(Ie),B.push(0),Ee>0&&(Me+=J?(ne*Ie-ge*me)/2:Math.sqrt(Math.pow(ge-ne,2)+Math.pow(Ie-me,2))),ne=ge,me=Ie}var Qe=B.length-3;B[2]=1,Mt(B,0,Qe,F),B[Qe+2]=1,B.size=Math.abs(Me),B.start=0,B.end=B.size}function ti(Q,B,F,J){for(var ne=0;ne<Q.length;ne++){var me=[];Zt(Q[ne],me,F,J),B.push(me)}}function mi(Q){return Q/360+.5}function zi(Q){var B=Math.sin(Q*Math.PI/180),F=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return F<0?0:F>1?1:F}function si(Q,B,F,J,ne,me,Me,Ee){if(J/=B,me>=(F/=B)&&Me<J)return Q;if(Me<F||me>=J)return null;for(var ge=[],Ie=0;Ie<Q.length;Ie++){var Qe=Q[Ie],Ct=Qe.geometry,st=Qe.type,$t=ne===0?Qe.minX:Qe.minY,Xt=ne===0?Qe.maxX:Qe.maxY;if($t>=F&&Xt<J)ge.push(Qe);else if(!(Xt<F||$t>=J)){var jt=[];if(st==="Point"||st==="MultiPoint")Ci(Ct,jt,F,J,ne);else if(st==="LineString")un(Ct,jt,F,J,ne,!1,Ee.lineMetrics);else if(st==="MultiLineString")En(Ct,jt,F,J,ne,!1);else if(st==="Polygon")En(Ct,jt,F,J,ne,!0);else if(st==="MultiPolygon")for(var Qt=0;Qt<Ct.length;Qt++){var ci=[];En(Ct[Qt],ci,F,J,ne,!0),ci.length&&jt.push(ci)}if(jt.length){if(Ee.lineMetrics&&st==="LineString"){for(Qt=0;Qt<jt.length;Qt++)ge.push(He(Qe.id,st,jt[Qt],Qe.tags));continue}st!=="LineString"&&st!=="MultiLineString"||(jt.length===1?(st="LineString",jt=jt[0]):st="MultiLineString"),st!=="Point"&&st!=="MultiPoint"||(st=jt.length===3?"Point":"MultiPoint"),ge.push(He(Qe.id,st,jt,Qe.tags))}}}return ge.length?ge:null}function Ci(Q,B,F,J,ne){for(var me=0;me<Q.length;me+=3){var Me=Q[me+ne];Me>=F&&Me<=J&&(B.push(Q[me]),B.push(Q[me+1]),B.push(Q[me+2]))}}function un(Q,B,F,J,ne,me,Me){for(var Ee,ge,Ie=_r(Q),Qe=ne===0?qr:_n,Ct=Q.start,st=0;st<Q.length-3;st+=3){var $t=Q[st],Xt=Q[st+1],jt=Q[st+2],Qt=Q[st+3],ci=Q[st+4],Pi=ne===0?$t:Xt,ce=ne===0?Qt:ci,vt=!1;Me&&(Ee=Math.sqrt(Math.pow($t-Qt,2)+Math.pow(Xt-ci,2))),Pi<F?ce>F&&(ge=Qe(Ie,$t,Xt,Qt,ci,F),Me&&(Ie.start=Ct+Ee*ge)):Pi>J?ce<J&&(ge=Qe(Ie,$t,Xt,Qt,ci,J),Me&&(Ie.start=Ct+Ee*ge)):In(Ie,$t,Xt,jt),ce<F&&Pi>=F&&(ge=Qe(Ie,$t,Xt,Qt,ci,F),vt=!0),ce>J&&Pi<=J&&(ge=Qe(Ie,$t,Xt,Qt,ci,J),vt=!0),!me&&vt&&(Me&&(Ie.end=Ct+Ee*ge),B.push(Ie),Ie=_r(Q)),Me&&(Ct+=Ee)}var Ze=Q.length-3;$t=Q[Ze],Xt=Q[Ze+1],jt=Q[Ze+2],(Pi=ne===0?$t:Xt)>=F&&Pi<=J&&In(Ie,$t,Xt,jt),Ze=Ie.length-3,me&&Ze>=3&&(Ie[Ze]!==Ie[0]||Ie[Ze+1]!==Ie[1])&&In(Ie,Ie[0],Ie[1],Ie[2]),Ie.length&&B.push(Ie)}function _r(Q){var B=[];return B.size=Q.size,B.start=Q.start,B.end=Q.end,B}function En(Q,B,F,J,ne,me){for(var Me=0;Me<Q.length;Me++)un(Q[Me],B,F,J,ne,me,!1)}function In(Q,B,F,J){Q.push(B),Q.push(F),Q.push(J)}function qr(Q,B,F,J,ne,me){var Me=(me-B)/(J-B);return Q.push(me),Q.push(F+(ne-F)*Me),Q.push(1),Me}function _n(Q,B,F,J,ne,me){var Me=(me-F)/(ne-F);return Q.push(B+(J-B)*Me),Q.push(me),Q.push(1),Me}function kn(Q,B){for(var F=[],J=0;J<Q.length;J++){var ne,me=Q[J],Me=me.type;if(Me==="Point"||Me==="MultiPoint"||Me==="LineString")ne=Pr(me.geometry,B);else if(Me==="MultiLineString"||Me==="Polygon"){ne=[];for(var Ee=0;Ee<me.geometry.length;Ee++)ne.push(Pr(me.geometry[Ee],B))}else if(Me==="MultiPolygon")for(ne=[],Ee=0;Ee<me.geometry.length;Ee++){for(var ge=[],Ie=0;Ie<me.geometry[Ee].length;Ie++)ge.push(Pr(me.geometry[Ee][Ie],B));ne.push(ge)}F.push(He(me.id,Me,ne,me.tags))}return F}function Pr(Q,B){var F=[];F.size=Q.size,Q.start!==void 0&&(F.start=Q.start,F.end=Q.end);for(var J=0;J<Q.length;J+=3)F.push(Q[J]+B,Q[J+1],Q[J+2]);return F}function wo(Q,B){if(Q.transformed)return Q;var F,J,ne,me=1<<Q.z,Me=Q.x,Ee=Q.y;for(F=0;F<Q.features.length;F++){var ge=Q.features[F],Ie=ge.geometry,Qe=ge.type;if(ge.geometry=[],Qe===1)for(J=0;J<Ie.length;J+=2)ge.geometry.push(Ho(Ie[J],Ie[J+1],B,me,Me,Ee));else for(J=0;J<Ie.length;J++){var Ct=[];for(ne=0;ne<Ie[J].length;ne+=2)Ct.push(Ho(Ie[J][ne],Ie[J][ne+1],B,me,Me,Ee));ge.geometry.push(Ct)}}return Q.transformed=!0,Q}function Ho(Q,B,F,J,ne,me){return[Math.round(F*(Q*J-ne)),Math.round(F*(B*J-me))]}function bs(Q,B,F,J,ne){for(var me=B===ne.maxZoom?0:ne.tolerance/((1<<B)*ne.extent),Me={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:F,y:J,z:B,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ee=0;Ee<Q.length;Ee++){Me.numFeatures++,ha(Me,Q[Ee],me,ne);var ge=Q[Ee].minX,Ie=Q[Ee].minY,Qe=Q[Ee].maxX,Ct=Q[Ee].maxY;ge<Me.minX&&(Me.minX=ge),Ie<Me.minY&&(Me.minY=Ie),Qe>Me.maxX&&(Me.maxX=Qe),Ct>Me.maxY&&(Me.maxY=Ct)}return Me}function ha(Q,B,F,J){var ne=B.geometry,me=B.type,Me=[];if(me==="Point"||me==="MultiPoint")for(var Ee=0;Ee<ne.length;Ee+=3)Me.push(ne[Ee]),Me.push(ne[Ee+1]),Q.numPoints++,Q.numSimplified++;else if(me==="LineString")Dr(Me,ne,Q,F,!1,!1);else if(me==="MultiLineString"||me==="Polygon")for(Ee=0;Ee<ne.length;Ee++)Dr(Me,ne[Ee],Q,F,me==="Polygon",Ee===0);else if(me==="MultiPolygon")for(var ge=0;ge<ne.length;ge++){var Ie=ne[ge];for(Ee=0;Ee<Ie.length;Ee++)Dr(Me,Ie[Ee],Q,F,!0,Ee===0)}if(Me.length){var Qe=B.tags||null;if(me==="LineString"&&J.lineMetrics){for(var Ct in Qe={},B.tags)Qe[Ct]=B.tags[Ct];Qe.mapbox_clip_start=ne.start/ne.size,Qe.mapbox_clip_end=ne.end/ne.size}var st={geometry:Me,type:me==="Polygon"||me==="MultiPolygon"?3:me==="LineString"||me==="MultiLineString"?2:1,tags:Qe};B.id!==null&&(st.id=B.id),Q.features.push(st)}}function Dr(Q,B,F,J,ne,me){var Me=J*J;if(J>0&&B.size<(ne?Me:J))F.numPoints+=B.length/3;else{for(var Ee=[],ge=0;ge<B.length;ge+=3)(J===0||B[ge+2]>Me)&&(F.numSimplified++,Ee.push(B[ge]),Ee.push(B[ge+1])),F.numPoints++;ne&&function(Ie,Qe){for(var Ct=0,st=0,$t=Ie.length,Xt=$t-2;st<$t;Xt=st,st+=2)Ct+=(Ie[st]-Ie[Xt])*(Ie[st+1]+Ie[Xt+1]);if(Ct>0===Qe)for(st=0,$t=Ie.length;st<$t/2;st+=2){var jt=Ie[st],Qt=Ie[st+1];Ie[st]=Ie[$t-2-st],Ie[st+1]=Ie[$t-1-st],Ie[$t-2-st]=jt,Ie[$t-1-st]=Qt}}(Ee,me),Q.push(Ee)}}function Lr(Q,B){var F=(B=this.options=function(ne,me){for(var Me in me)ne[Me]=me[Me];return ne}(Object.create(this.options),B)).debug;if(F&&console.time("preprocess data"),B.maxZoom<0||B.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(B.promoteId&&B.generateId)throw new Error("promoteId and generateId cannot be used together.");var J=function(ne,me){var Me=[];if(ne.type==="FeatureCollection")for(var Ee=0;Ee<ne.features.length;Ee++)qt(Me,ne.features[Ee],me,Ee);else qt(Me,ne.type==="Feature"?ne:{geometry:ne},me);return Me}(Q,B);this.tiles={},this.tileCoords=[],F&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",B.indexMaxZoom,B.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(J=function(ne,me){var Me=me.buffer/me.extent,Ee=ne,ge=si(ne,1,-1-Me,Me,0,-1,2,me),Ie=si(ne,1,1-Me,2+Me,0,-1,2,me);return(ge||Ie)&&(Ee=si(ne,1,-Me,1+Me,0,-1,2,me)||[],ge&&(Ee=kn(ge,1).concat(Ee)),Ie&&(Ee=Ee.concat(kn(Ie,-1)))),Ee}(J,B)).length&&this.splitTile(J,0,0,0),F&&(J.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function to(Q,B,F){return 32*((1<<Q)*F+B)+Q}function io(Q,B){const F=Q.tileID.canonical;if(!this._geoJSONIndex)return B(null,null);const J=this._geoJSONIndex.getTile(F.z,F.x,F.y);if(!J)return B(null,null);const ne=new Ye(J.features);let me=De(ne);me.byteOffset===0&&me.byteLength===me.buffer.byteLength||(me=new Uint8Array(me)),B(null,{vectorTile:ne,rawData:me.buffer})}Lr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Lr.prototype.splitTile=function(Q,B,F,J,ne,me,Me){for(var Ee=[Q,B,F,J],ge=this.options,Ie=ge.debug;Ee.length;){J=Ee.pop(),F=Ee.pop(),B=Ee.pop(),Q=Ee.pop();var Qe=1<<B,Ct=to(B,F,J),st=this.tiles[Ct];if(!st&&(Ie>1&&console.time("creation"),st=this.tiles[Ct]=bs(Q,B,F,J,ge),this.tileCoords.push({z:B,x:F,y:J}),Ie)){Ie>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",B,F,J,st.numFeatures,st.numPoints,st.numSimplified),console.timeEnd("creation"));var $t="z"+B;this.stats[$t]=(this.stats[$t]||0)+1,this.total++}if(st.source=Q,ne){if(B===ge.maxZoom||B===ne)continue;var Xt=1<<ne-B;if(F!==Math.floor(me/Xt)||J!==Math.floor(Me/Xt))continue}else if(B===ge.indexMaxZoom||st.numPoints<=ge.indexMaxPoints)continue;if(st.source=null,Q.length!==0){Ie>1&&console.time("clipping");var jt,Qt,ci,Pi,ce,vt,Ze=.5*ge.buffer/ge.extent,Ce=.5-Ze,wi=.5+Ze,ni=1+Ze;jt=Qt=ci=Pi=null,ce=si(Q,Qe,F-Ze,F+wi,0,st.minX,st.maxX,ge),vt=si(Q,Qe,F+Ce,F+ni,0,st.minX,st.maxX,ge),Q=null,ce&&(jt=si(ce,Qe,J-Ze,J+wi,1,st.minY,st.maxY,ge),Qt=si(ce,Qe,J+Ce,J+ni,1,st.minY,st.maxY,ge),ce=null),vt&&(ci=si(vt,Qe,J-Ze,J+wi,1,st.minY,st.maxY,ge),Pi=si(vt,Qe,J+Ce,J+ni,1,st.minY,st.maxY,ge),vt=null),Ie>1&&console.timeEnd("clipping"),Ee.push(jt||[],B+1,2*F,2*J),Ee.push(Qt||[],B+1,2*F,2*J+1),Ee.push(ci||[],B+1,2*F+1,2*J),Ee.push(Pi||[],B+1,2*F+1,2*J+1)}}},Lr.prototype.getTile=function(Q,B,F){var J=this.options,ne=J.extent,me=J.debug;if(Q<0||Q>24)return null;var Me=1<<Q,Ee=to(Q,B=(B%Me+Me)%Me,F);if(this.tiles[Ee])return wo(this.tiles[Ee],ne);me>1&&console.log("drilling down to z%d-%d-%d",Q,B,F);for(var ge,Ie=Q,Qe=B,Ct=F;!ge&&Ie>0;)Ie--,Qe=Math.floor(Qe/2),Ct=Math.floor(Ct/2),ge=this.tiles[to(Ie,Qe,Ct)];return ge&&ge.source?(me>1&&console.log("found parent tile z%d-%d-%d",Ie,Qe,Ct),me>1&&console.time("drilling down"),this.splitTile(ge.source,Ie,Qe,Ct,Q,B,F),me>1&&console.timeEnd("drilling down"),this.tiles[Ee]?wo(this.tiles[Ee],ne):null):null};class Sn extends s.VectorTileWorkerSource{constructor(B,F,J,ne,me){super(B,F,J,ne,io),me&&(this.loadGeoJSON=me)}loadData(B,F){const J=B&&B.request,ne=J&&J.collectResourceTiming;this.loadGeoJSON(B,(me,Me)=>{if(me||!Me)return F(me);if(typeof Me!="object")return F(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`));{q(Me,!0);try{if(B.filter){const ge=s.createExpression(B.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ge.result==="error")throw new Error(ge.value.map(Qe=>`${Qe.key}: ${Qe.message}`).join(", "));const Ie=Me.features.filter(Qe=>ge.value.evaluate({zoom:0},Qe));Me={type:"FeatureCollection",features:Ie}}this._geoJSONIndex=B.cluster?new Yt(function({superclusterOptions:ge,clusterProperties:Ie}){if(!Ie||!ge)return ge;const Qe={},Ct={},st={accumulated:null,zoom:0},$t={properties:null},Xt=Object.keys(Ie);for(const jt of Xt){const[Qt,ci]=Ie[jt],Pi=s.createExpression(ci),ce=s.createExpression(typeof Qt=="string"?[Qt,["accumulated"],["get",jt]]:Qt);Qe[jt]=Pi.value,Ct[jt]=ce.value}return ge.map=jt=>{$t.properties=jt;const Qt={};for(const ci of Xt)Qt[ci]=Qe[ci].evaluate(st,$t);return Qt},ge.reduce=(jt,Qt)=>{$t.properties=Qt;for(const ci of Xt)st.accumulated=jt[ci],jt[ci]=Ct[ci].evaluate(st,$t)},ge}(B)).load(Me.features):function(ge,Ie){return new Lr(ge,Ie)}(Me,B.geojsonVtOptions)}catch(ge){return F(ge)}this.loaded={};const Ee={};if(ne){const ge=s.getPerformanceMeasurement(J);ge&&(Ee.resourceTiming={},Ee.resourceTiming[B.source]=JSON.parse(JSON.stringify(ge)))}F(null,Ee)}})}reloadTile(B,F){const J=this.loaded;return J&&J[B.uid]?super.reloadTile(B,F):this.loadTile(B,F)}loadGeoJSON(B,F){if(B.request)s.getJSON(B.request,F);else{if(typeof B.data!="string")return F(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`));try{return F(null,JSON.parse(B.data))}catch{return F(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(B,F){try{F(null,this._geoJSONIndex.getClusterExpansionZoom(B.clusterId))}catch(J){F(J)}}getClusterChildren(B,F){try{F(null,this._geoJSONIndex.getChildren(B.clusterId))}catch(J){F(J)}}getClusterLeaves(B,F){try{F(null,this._geoJSONIndex.getLeaves(B.clusterId,B.limit,B.offset))}catch(J){F(J)}}}class Tr{constructor(B){this.self=B,this.actor=new s.Actor(B,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.getProjection({name:"mercator"}),this.workerSourceTypes={vector:s.VectorTileWorkerSource,geojson:Sn},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(F,J)=>{if(this.workerSourceTypes[F])throw new Error(`Worker source with name "${F}" already registered.`);this.workerSourceTypes[F]=J},this.self.registerRTLTextPlugin=F=>{if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=F.applyArabicShaping,s.plugin.processBidirectionalText=F.processBidirectionalText,s.plugin.processStyledBidirectionalText=F.processStyledBidirectionalText}}clearCaches(B,F,J){delete this.layerIndexes[B],delete this.availableImages[B],delete this.workerSources[B],delete this.demWorkerSources[B],J()}checkIfReady(B,F,J){J()}setReferrer(B,F){this.referrer=F}spriteLoaded(B,F){this.isSpriteLoaded[B]=F;for(const J in this.workerSources[B]){const ne=this.workerSources[B][J];for(const me in ne)ne[me]instanceof s.VectorTileWorkerSource&&(ne[me].isSpriteLoaded=F,ne[me].fire(new s.Event("isSpriteLoaded")))}}setImages(B,F,J){this.availableImages[B]=F;for(const ne in this.workerSources[B]){const me=this.workerSources[B][ne];for(const Me in me)me[Me].availableImages=F}J()}enableTerrain(B,F,J){this.terrain=F,J()}setProjection(B,F){this.projections[B]=s.getProjection(F)}setLayers(B,F,J){this.getLayerIndex(B).replace(F),J()}updateLayers(B,F,J){this.getLayerIndex(B).update(F.layers,F.removedIds),J()}loadTile(B,F,J){const ne=this.enableTerrain?s.extend({enableTerrain:this.terrain},F):F;ne.projection=this.projections[B]||this.defaultProjection,this.getWorkerSource(B,F.type,F.source).loadTile(ne,J)}loadDEMTile(B,F,J){const ne=this.enableTerrain?s.extend({buildQuadTree:this.terrain},F):F;this.getDEMWorkerSource(B,F.source).loadTile(ne,J)}reloadTile(B,F,J){const ne=this.enableTerrain?s.extend({enableTerrain:this.terrain},F):F;ne.projection=this.projections[B]||this.defaultProjection,this.getWorkerSource(B,F.type,F.source).reloadTile(ne,J)}abortTile(B,F,J){this.getWorkerSource(B,F.type,F.source).abortTile(F,J)}removeTile(B,F,J){this.getWorkerSource(B,F.type,F.source).removeTile(F,J)}removeSource(B,F,J){if(!this.workerSources[B]||!this.workerSources[B][F.type]||!this.workerSources[B][F.type][F.source])return;const ne=this.workerSources[B][F.type][F.source];delete this.workerSources[B][F.type][F.source],ne.removeSource!==void 0?ne.removeSource(F,J):J()}loadWorkerSource(B,F,J){try{this.self.importScripts(F.url),J()}catch(ne){J(ne.toString())}}syncRTLPluginState(B,F,J){try{s.plugin.setState(F);const ne=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&ne!=null){this.self.importScripts(ne);const me=s.plugin.isParsed();J(me?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ne}`),me)}}catch(ne){J(ne.toString())}}getAvailableImages(B){let F=this.availableImages[B];return F||(F=[]),F}getLayerIndex(B){let F=this.layerIndexes[B];return F||(F=this.layerIndexes[B]=new N),F}getWorkerSource(B,F,J){return this.workerSources[B]||(this.workerSources[B]={}),this.workerSources[B][F]||(this.workerSources[B][F]={}),this.workerSources[B][F][J]||(this.workerSources[B][F][J]=new this.workerSourceTypes[F]({send:(ne,me,Me,Ee,ge,Ie)=>{this.actor.send(ne,me,Me,B,ge,Ie)},scheduler:this.actor.scheduler},this.getLayerIndex(B),this.getAvailableImages(B),this.isSpriteLoaded[B])),this.workerSources[B][F][J]}getDEMWorkerSource(B,F){return this.demWorkerSources[B]||(this.demWorkerSources[B]={}),this.demWorkerSources[B][F]||(this.demWorkerSources[B][F]=new U),this.demWorkerSources[B][F]}enforceCacheSizeLimit(B,F){s.enforceCacheSizeLimit(F)}getWorkerPerformanceMetrics(B,F,J){J(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Tr(self)),Tr}),E(["./shared"],function(s){function D(c,n){if(Array.isArray(c)){if(!Array.isArray(n)||c.length!==n.length)return!1;for(let a=0;a<c.length;a++)if(!D(c[a],n[a]))return!1;return!0}if(typeof c=="object"&&c!==null&&n!==null){if(typeof n!="object"||Object.keys(c).length!==Object.keys(n).length)return!1;for(const a in c)if(!D(c[a],n[a]))return!1;return!0}return c===n}var V=N;function N(c){return!function(n){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var d,_,g=new Blob([""],{type:"text/javascript"}),w=URL.createObjectURL(g);try{_=new Worker(w),d=!0}catch{d=!1}return _&&_.terminate(),URL.revokeObjectURL(w),d}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var d=document.createElement("canvas");d.width=d.height=1;var _=d.getContext("2d");if(!_)return!1;var g=_.getImageData(0,0,1,1);return g&&g.width===d.width}()?(U[a=n&&n.failIfMajorPerformanceCaveat]===void 0&&(U[a]=function(d){var _,g=function(w){var T=document.createElement("canvas"),C=Object.create(N.webGLContextAttributes);return C.failIfMajorPerformanceCaveat=w,T.getContext("webgl",C)||T.getContext("experimental-webgl",C)}(d);if(!g)return!1;try{_=g.createShader(g.VERTEX_SHADER)}catch{return!1}return!(!_||g.isContextLost())&&(g.shaderSource(_,"void main() {}"),g.compileShader(_),g.getShaderParameter(_,g.COMPILE_STATUS)===!0)}(a)),U[a]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var a}(c)}var U={};function q(c,n,a){const d=s.window.document.createElement(c);return n!==void 0&&(d.className=n),a&&a.appendChild(d),d}function Y(c,n,a){const d=s.window.document.createElementNS("http://www.w3.org/2000/svg",c);for(const _ of Object.keys(n))d.setAttributeNS(null,_,n[_]);return a&&a.appendChild(d),d}N.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const _e=s.window.document&&s.window.document.documentElement.style,ve=_e&&_e.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ze;function Ye(){_e&&ve&&(ze=_e[ve],_e[ve]="none")}function we(){_e&&ve&&(_e[ve]=ze)}function Ue(c){c.preventDefault(),c.stopPropagation(),s.window.removeEventListener("click",Ue,!0)}function Ge(){s.window.addEventListener("click",Ue,!0),s.window.setTimeout(()=>{s.window.removeEventListener("click",Ue,!0)},0)}function Se(c,n){const a=c.getBoundingClientRect();return Pe(c,a,n)}function De(c,n){const a=c.getBoundingClientRect(),d=[];for(let _=0;_<n.length;_++)d.push(Pe(c,a,n[_]));return d}function be(c){return s.window.InstallTrigger!==void 0&&c.button===2&&c.ctrlKey&&s.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:c.button}function Pe(c,n,a){const d=c.offsetWidth===n.width?1:c.offsetWidth/n.width;return new s.pointGeometry((a.clientX-n.left)*d,(a.clientY-n.top)*d)}function Xe(c,n){var a=n[0],d=n[1],_=n[2],g=n[3],w=a*g-_*d;return w?(c[0]=g*(w=1/w),c[1]=-d*w,c[2]=-_*w,c[3]=a*w,c):null}function Ve(c){const{userImage:n}=c;return!!(n&&n.render&&n.render())&&(c.data.replace(new Uint8Array(n.data.buffer)),!0)}class nt extends s.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:a,callback:d}of this.requestors)this._notify(a,d);this.requestors=[]}}hasImage(n){return!!this.getImage(n)}getImage(n){return this.images[n]}addImage(n,a){this._validate(n,a)&&(this.images[n]=a)}_validate(n,a){let d=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new s.ErrorEvent(new Error(`Image "${n}" has invalid "stretchX" value`))),d=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new s.ErrorEvent(new Error(`Image "${n}" has invalid "stretchY" value`))),d=!1),this._validateContent(a.content,a)||(this.fire(new s.ErrorEvent(new Error(`Image "${n}" has invalid "content" value`))),d=!1),d}_validateStretch(n,a){if(!n)return!0;let d=0;for(const _ of n){if(_[0]<d||_[1]<_[0]||a<_[1])return!1;d=_[1]}return!0}_validateContent(n,a){return!(n&&(n.length!==4||n[0]<0||a.data.width<n[0]||n[1]<0||a.data.height<n[1]||n[2]<0||a.data.width<n[2]||n[3]<0||a.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,a){a.version=this.images[n].version+1,this.images[n]=a,this.updatedImages[n]=!0}removeImage(n){const a=this.images[n];delete this.images[n],delete this.patterns[n],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,a){let d=!0;if(!this.isLoaded())for(const _ of n)this.images[_]||(d=!1);this.isLoaded()||d?this._notify(n,a):this.requestors.push({ids:n,callback:a})}_notify(n,a){const d={};for(const _ of n){this.images[_]||this.fire(new s.Event("styleimagemissing",{id:_}));const g=this.images[_];g?d[_]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,hasRenderCallback:Boolean(g.userImage&&g.userImage.render)}:s.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}a(null,d)}getPixelSize(){const{width:n,height:a}=this.atlasImage;return{width:n,height:a}}getPattern(n){const a=this.patterns[n],d=this.getImage(n);if(!d)return null;if(a&&a.position.version===d.version)return a.position;if(a)a.position.version=d.version;else{const _={w:d.data.width+2,h:d.data.height+2,x:0,y:0},g=new s.ImagePosition(_,d);this.patterns[n]={bin:_,position:g}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const a=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.Texture(n,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const g in this.patterns)n.push(this.patterns[g].bin);const{w:a,h:d}=s.potpack(n),_=this.atlasImage;_.resize({width:a||1,height:d||1});for(const g in this.patterns){const{bin:w}=this.patterns[g],T=w.x+1,C=w.y+1,k=this.images[g].data,z=k.width,R=k.height;s.RGBAImage.copy(k,_,{x:0,y:0},{x:T,y:C},{width:z,height:R}),s.RGBAImage.copy(k,_,{x:0,y:R-1},{x:T,y:C-1},{width:z,height:1}),s.RGBAImage.copy(k,_,{x:0,y:0},{x:T,y:C+R},{width:z,height:1}),s.RGBAImage.copy(k,_,{x:z-1,y:0},{x:T-1,y:C},{width:1,height:R}),s.RGBAImage.copy(k,_,{x:0,y:0},{x:T+z,y:C},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const a of n){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const d=this.images[a];Ve(d)&&this.updateImage(a,d)}}}const qe=new s.Properties({anchor:new s.DataConstantProperty(s.spec.light.anchor),position:new class{constructor(){this.specification=s.spec.light.position}possiblyEvaluate(c,n){return function([a,d,_]){const g=s.degToRad(d+90),w=s.degToRad(_);return{x:a*Math.cos(g)*Math.sin(w),y:a*Math.sin(g)*Math.sin(w),z:a*Math.cos(w),azimuthal:d,polar:_}}(c.expression.evaluate(n))}interpolate(c,n,a){return{x:s.number(c.x,n.x,a),y:s.number(c.y,n.y,a),z:s.number(c.z,n.z,a),azimuthal:s.number(c.azimuthal,n.azimuthal,a),polar:s.number(c.polar,n.polar,a)}}},color:new s.DataConstantProperty(s.spec.light.color),intensity:new s.DataConstantProperty(s.spec.light.intensity)}),$e="-transition";class Ke extends s.Evented{constructor(n){super(),this._transitionable=new s.Transitionable(qe),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,a={}){if(!this._validate(s.validateLight,n,a))for(const d in n){const _=n[d];s.endsWith(d,$e)?this._transitionable.setTransition(d.slice(0,-$e.length),_):this._transitionable.setValue(d,_)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,d){return(!d||d.validate!==!1)&&s.emitValidationErrors(this,n.call(s.validateStyle,s.extend({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}const Ft=new s.Properties({source:new s.DataConstantProperty(s.spec.terrain.source),exaggeration:new s.DataConstantProperty(s.spec.terrain.exaggeration)}),Ht="-transition";class ot extends s.Evented{constructor(n,a){super(),this._transitionable=new s.Transitionable(Ft),this.set(n),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=a}get(){return this._transitionable.serialize()}set(n){for(const a in n){const d=n[a];s.endsWith(a,Ht)?this._transitionable.setTransition(a.slice(0,-Ht.length),d):this._transitionable.setValue(a,d)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}}function At(c,n,a,d){const _=s.smoothstep(45,65,a),[g,w]=di(c,d),T=s.length(n);let C=1-Math.min(1,Math.exp((T-g)/(w-g)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*_*c.alpha}function di(c,n){const a=.5/Math.tan(.5*n);return[c.range[0]+a,c.range[1]+a]}const Fe=new s.Properties({range:new s.DataConstantProperty(s.spec.fog.range),color:new s.DataConstantProperty(s.spec.fog.color),"high-color":new s.DataConstantProperty(s.spec.fog["high-color"]),"space-color":new s.DataConstantProperty(s.spec.fog["space-color"]),"horizon-blend":new s.DataConstantProperty(s.spec.fog["horizon-blend"]),"star-intensity":new s.DataConstantProperty(s.spec.fog["star-intensity"])}),_t="-transition";class xt extends s.Evented{constructor(n,a){super(),this._transitionable=new s.Transitionable(Fe),this.set(n),this._transitioning=this._transitionable.untransitioned(),this._transform=a}get state(){const n=this._transform,a=n.projection.name==="globe",d=s.globeToMercatorTransition(n.zoom),_=this.properties.get("range"),g=[.5,3];return{range:a?[s.number(g[0],_[0],d),s.number(g[1],_[1],d)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,a={}){if(!this._validate(s.validateFog,n,a)){for(const d of Object.keys(s.spec.fog))n&&n[d]===void 0&&(n[d]=s.spec.fog[d].default);for(const d in n){const _=n[d];s.endsWith(d,_t)?this._transitionable.setTransition(d.slice(0,-_t.length),_):this._transitionable.setValue(d,_)}}}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.smoothstep(45,65,n))*a.a}getOpacityAtLatLng(n,a){return this._transform.projection.supportsFog?function(d,_,g){const w=s.MercatorCoordinate.fromLngLat(_),T=g.elevation?g.elevation.getAtPointOrZero(w):0,C=[w.x,w.y,T];return s.transformMat4(C,C,g.mercatorFogMatrix),At(d,C,g.pitch,g._fov)}(this.state,n,a):0}getFovAdjustedRange(n){return this._transform.projection.supportsFog?di(this.state,n):[0,1]}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,d){return(!d||d.validate!==!1)&&s.emitValidationErrors(this,n.call(s.validateStyle,s.extend({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}class Lt{constructor(n,a){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=s.uniqueId();const d=this.workerPool.acquire(this.id);for(let _=0;_<d.length;_++){const g=new Lt.Actor(d[_],a,this.id);g.name=`Worker ${_}`,this.actors.push(g)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,a,d){s.asyncAll(this.actors,(_,g)=>{_.send(n,a,g)},d=d||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}function pi(c,n,a){return n*(s.EXTENT/(c.tileSize*Math.pow(2,a-c.tileID.overscaledZ)))}Lt.Actor=s.Actor;class Si{constructor(n,a,d,_){this.screenBounds=n,this.cameraPoint=a,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=d,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(n,a){let d,_;if(n instanceof s.pointGeometry||typeof n[0]=="number"){const g=s.pointGeometry.convert(n);d=[s.pointGeometry.convert(n)],_=a.isPointAboveHorizon(g)}else{const g=s.pointGeometry.convert(n[0]),w=s.pointGeometry.convert(n[1]);d=[g,w],_=s.polygonizeBounds(g,w).every(T=>a.isPointAboveHorizon(T))}return new Si(d,a.getCameraPoint(),_,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return s.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const a=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new s.pointGeometry(1,1)):this.screenBounds[1],_=s.polygonizeBounds(a,d,0,!1);return this.cameraPoint.y>d.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<d.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=d.x?_[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(_[3]=this.cameraPoint)),s.bufferConvexPolygon(_,n)}bufferedCameraGeometryGlobe(n){const a=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new s.pointGeometry(1,1)):this.screenBounds[1],_=s.polygonizeBounds(a,d,n),g=this.cameraPoint.clone();switch(3*((g.y>a.y)+(g.y>d.y))+((g.x>a.x)+(g.x>d.x))){case 0:_[0]=g,_[4]=g.clone();break;case 1:_.splice(1,0,g);break;case 2:_[1]=g;break;case 3:_.splice(4,0,g);break;case 5:_.splice(2,0,g);break;case 6:_[3]=g;break;case 7:_.splice(3,0,g);break;case 8:_[2]=g}return _}containsTile(n,a,d,_=0){const g=n.queryPadding/a._pixelsPerMercatorPixel+1,w=d?this._bufferedCameraMercator(g,a):this._bufferedScreenMercator(g,a);let T=n.tileID.wrap+(w.unwrapped?_:0);const C=w.polygon.map(H=>s.getTilePoint(n.tileTransform,H,T));if(!s.polygonIntersectsBox(C,0,0,s.EXTENT,s.EXTENT))return;T=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);const k=this.screenGeometryMercator.polygon.map(H=>s.getTileVec3(n.tileTransform,H,T)),z=k.map(H=>new s.pointGeometry(H[0],H[1])),R=a.getFreeCameraOptions().position||new s.MercatorCoordinate(0,0,0),j=s.getTileVec3(n.tileTransform,R,T),X=k.map(H=>{const G=s.sub(H,H,j);return s.normalize(G,G),new s.Ray(j,G)}),Z=pi(n,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:X,bufferedTilespaceGeometry:C,bufferedTilespaceBounds:(W=s.getBounds(C),W.min.x=s.clamp(W.min.x,0,s.EXTENT),W.min.y=s.clamp(W.min.y,0,s.EXTENT),W.max.x=s.clamp(W.max.x,0,s.EXTENT),W.max.y=s.clamp(W.max.y,0,s.EXTENT),W),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:Z};var W}_bufferedScreenMercator(n,a){const d=Jt(n);if(this._screenRaycastCache[d])return this._screenRaycastCache[d];{let _;return _=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),a):{polygon:this.bufferedScreenGeometry(n).map(g=>a.pointCoordinate3D(g)),unwrapped:!0},this._screenRaycastCache[d]=_,_}}_bufferedCameraMercator(n,a){const d=Jt(n);if(this._cameraRaycastCache[d])return this._cameraRaycastCache[d];{let _;return _=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),a):{polygon:this.bufferedCameraGeometry(n).map(g=>a.pointCoordinate3D(g)),unwrapped:!0},this._cameraRaycastCache[d]=_,_}}_projectAndResample(n,a){const d=function(g,w){const T=s.multiply([],w.pixelMatrix,w.globeMatrix),C=[0,-s.GLOBE_RADIUS,0,1],k=[0,s.GLOBE_RADIUS,0,1],z=[0,0,0,1];s.transformMat4$1(C,C,T),s.transformMat4$1(k,k,T),s.transformMat4$1(z,z,T);const R=new s.pointGeometry(C[0]/C[3],C[1]/C[3]),j=new s.pointGeometry(k[0]/k[3],k[1]/k[3]),X=s.polygonContainsPoint(g,R)&&C[3]<z[3],Z=s.polygonContainsPoint(g,j)&&k[3]<z[3];if(!X&&!Z)return null;const W=function(de,le,ye){for(let Le=1;Le<de.length;Le++){const dt=Yt(le.pointCoordinate3D(de[Le-1]).x),Ae=Yt(le.pointCoordinate3D(de[Le]).x);if(ye<0){if(dt<Ae)return{idx:Le,t:-dt/(Ae-1-dt)}}else if(Ae<dt)return{idx:Le,t:(1-dt)/(Ae+1-dt)}}return null}(g,w,X?-1:1);if(!W)return null;const{idx:H,t:G}=W;let te=H>1?Kt(g.slice(0,H),w):[],K=H<g.length?Kt(g.slice(H),w):[];te=te.map(de=>new s.pointGeometry(Yt(de.x),de.y)),K=K.map(de=>new s.pointGeometry(Yt(de.x),de.y));const fe=[...te];fe.length===0&&fe.push(K[K.length-1]);const he=s.number(fe[fe.length-1].y,(K.length===0?te[0]:K[0]).y,G);let oe;return oe=X?[new s.pointGeometry(0,he),new s.pointGeometry(0,0),new s.pointGeometry(1,0),new s.pointGeometry(1,he)]:[new s.pointGeometry(1,he),new s.pointGeometry(1,1),new s.pointGeometry(0,1),new s.pointGeometry(0,he)],fe.push(...oe),K.length===0?fe.push(te[0]):fe.push(...K),{polygon:fe.map(de=>new s.MercatorCoordinate(de.x,de.y)),unwrapped:!1}}(n,a);if(d)return d;const _=function(g,w){let T=!1,C=-1/0,k=0;for(let R=0;R<g.length-1;R++)g[R].x>C&&(C=g[R].x,k=R);for(let R=0;R<g.length-1;R++){const j=(k+R)%(g.length-1),X=g[j],Z=g[j+1];Math.abs(X.x-Z.x)>.5&&(X.x<Z.x?(X.x+=1,j===0&&(g[g.length-1].x+=1)):(Z.x+=1,j+1===g.length-1&&(g[0].x+=1)),T=!0)}const z=s.mercatorXfromLng(w.center.lng);return T&&z<Math.abs(z-1)&&g.forEach(R=>{R.x-=1}),{polygon:g,unwrapped:T}}(Kt(n,a).map(g=>new s.pointGeometry(Yt(g.x),g.y)),a);return{polygon:_.polygon.map(g=>new s.MercatorCoordinate(g.x,g.y)),unwrapped:_.unwrapped}}}function Kt(c,n){return s.resample(c,a=>{const d=n.pointCoordinate3D(a);a.x=d.x,a.y=d.y},1/256)}function Yt(c){return c<0?1+c%1:c%1}function Jt(c){return 100*c|0}function Et(c,n,a,d,_){const g=function(w,T){if(w)return _(w);if(T){const C=s.pick(s.extend(T,c),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);T.vector_layers&&(C.vectorLayers=T.vector_layers,C.vectorLayerIds=C.vectorLayers.map(k=>k.id)),T.language_options&&(C.languageOptions=T.language_options),T.language&&T.language[T.id]&&(C.language=T.language[T.id]),T.worldview_options&&(C.worldviewOptions=T.worldview_options),T.worldview?C.worldview=T.worldview[T.id]:T.worldview_default&&(C.worldview=T.worldview_default),C.tiles=n.canonicalizeTileset(C,c.url),_(null,C)}};return c.url?s.getJSON(n.transformRequest(n.normalizeSourceURL(c.url,null,a,d),s.ResourceType.Source),g):s.exported.frame(()=>g(null,c))}class Bi{constructor(n,a,d){this.bounds=s.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=a||0,this.maxzoom=d||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const a=Math.pow(2,n.z),d=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*a),_=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*a),g=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*a),w=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*a);return n.x>=d&&n.x<g&&n.y>=_&&n.y<w}}class xn{constructor(n,a,d){this.context=n;const _=n.gl;this.buffer=_.createBuffer(),this.dynamicDraw=Boolean(d),this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ue={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Te{constructor(n,a,d,_){this.length=a.length,this.attributes=d,this.itemSize=a.bytesPerElement,this.dynamicDraw=_,this.context=n;const g=n.gl;this.buffer=g.createBuffer(),n.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,a){for(let d=0;d<this.attributes.length;d++){const _=a.attributes[this.attributes[d].name];_!==void 0&&n.enableVertexAttribArray(_)}}setVertexAttribPointers(n,a,d){for(let _=0;_<this.attributes.length;_++){const g=this.attributes[_],w=a.attributes[g.name];w!==void 0&&n.vertexAttribPointer(w,g.components,n[ue[g.type]],!1,this.itemSize,g.offset+this.itemSize*(d||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Be{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ct extends Be{getDefault(){return s.Color.transparent}set(n){const a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class ut extends Be{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class bt extends Be{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Mt extends Be{getDefault(){return[!0,!0,!0,!0]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class gt extends Be{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class He extends Be{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class ht extends Be{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const a=this.current;(n.func!==a.func||n.ref!==a.ref||n.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class qt extends Be{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Nt extends Be{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=n,this.dirty=!1}}class Zt extends Be{getDefault(){return[0,1]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class ti extends Be{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=n,this.dirty=!1}}class mi extends Be{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class zi extends Be{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.BLEND):a.disable(a.BLEND),this.current=n,this.dirty=!1}}class si extends Be{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class Ci extends Be{getDefault(){return s.Color.transparent}set(n){const a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class un extends Be{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class _r extends Be{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=n,this.dirty=!1}}class En extends Be{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class In extends Be{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}class qr extends Be{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}}class _n extends Be{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class kn extends Be{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Pr extends Be{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class wo extends Be{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Ho extends Be{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class bs extends Be{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class ha extends Be{getDefault(){return null}set(n){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Dr extends Be{constructor(n){super(n),this.vao=n.extVertexArrayObject}getDefault(){return null}set(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)}}class Lr extends Be{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class to extends Be{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class io extends Be{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Sn extends Be{constructor(n,a){super(n),this.context=n,this.parent=a}getDefault(){return null}}class Tr extends Sn{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Q extends Sn{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class B extends Q{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class F{constructor(n,a,d,_){this.context=n,this.width=a,this.height=d;const g=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new Tr(n,g),_&&(this.depthAttachment=new Q(n,g))}destroy(){const n=this.context.gl,a=this.colorAttachment.get();if(a&&n.deleteTexture(a),this.depthAttachment){const d=this.depthAttachment.get();d&&n.deleteRenderbuffer(d)}n.deleteFramebuffer(this.framebuffer)}}class J{constructor(n){this.gl=n,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ct(this),this.clearDepth=new ut(this),this.clearStencil=new bt(this),this.colorMask=new Mt(this),this.depthMask=new gt(this),this.stencilMask=new He(this),this.stencilFunc=new ht(this),this.stencilOp=new qt(this),this.stencilTest=new Nt(this),this.depthRange=new Zt(this),this.depthTest=new ti(this),this.depthFunc=new mi(this),this.blend=new zi(this),this.blendFunc=new si(this),this.blendColor=new Ci(this),this.blendEquation=new un(this),this.cullFace=new _r(this),this.cullFaceSide=new En(this),this.frontFace=new In(this),this.program=new qr(this),this.activeTexture=new _n(this),this.viewport=new kn(this),this.bindFramebuffer=new Pr(this),this.bindRenderbuffer=new wo(this),this.bindTexture=new Ho(this),this.bindVertexBuffer=new bs(this),this.bindElementBuffer=new ha(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Dr(this),this.pixelStoreUnpack=new Lr(this),this.pixelStoreUnpackPremultiplyAlpha=new to(this),this.pixelStoreUnpackFlipY=new io(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extTextureHalfFloat=n.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(n.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=n.getExtension("OES_standard_derivatives"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,a){return new xn(this,n,a)}createVertexBuffer(n,a,d){return new Te(this,n,a,d)}createRenderbuffer(n,a,d){const _=this.gl,g=_.createRenderbuffer();return this.bindRenderbuffer.set(g),_.renderbufferStorage(_.RENDERBUFFER,n,a,d),this.bindRenderbuffer.set(null),g}createFramebuffer(n,a,d){return new F(this,n,a,d)}clear({color:n,depth:a,stencil:d}){const _=this.gl;let g=0;n&&(g|=_.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(g|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),d!==void 0&&(g|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),_.clear(g)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){D(n.blendFunction,s.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ne extends s.Evented{constructor(n,a,d,_){super(),this.id=n,this.dispatcher=d,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},a),s.extend(this,s.pick(a,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Et(this._options,this.map._requestManager,null,null,(n,a)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new s.ErrorEvent(n)):a&&(s.extend(this,a),a.bounds&&(this.tileBounds=new Bi(a.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(a.tiles),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return s.extend({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,a){const d=s.exported.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),d,this.tileSize);n.request=s.getImage(this.map._requestManager.transformRequest(_,s.ResourceType.Tile),(g,w,T,C)=>(delete n.request,n.aborted?(n.state="unloaded",a(null)):g?(n.state="errored",a(g)):w?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:T,expires:C}),n.setTexture(w,this.map.painter),n.state="loaded",s.cacheEntryPossiblyAdded(this.dispatcher),void a(null)):a(null)))}static loadTileData(n,a,d){n.setTexture(a,d)}static unloadTileData(n,a){n.texture&&a.saveTileTexture(n.texture)}abortTile(n,a){n.request&&(n.request.cancel(),delete n.request),a()}unloadTile(n,a){n.texture&&this.map.painter.saveTileTexture(n.texture),a()}hasTransition(){return!1}}let me;function Me(c,n,a,d,_,g,w,T){const C=[c,a,_,n,d,g,1,1,1],k=[w,T,1],z=s.adjoint([],C),[R,j,X]=s.transformMat3(k,k,s.transpose(z,z));return s.multiply$1(C,[R,0,0,0,j,0,0,0,X],C)}class Ee extends s.Evented{constructor(n,a,d,_){super(),this.id=n,this.dispatcher=d,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=a}load(n,a){this._loaded=a||!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),(d,_)=>{if(this._loaded=!0,d)this.fire(new s.ErrorEvent(d));else if(_){const{HTMLImageElement:g}=s.window;this.image=_ instanceof g?s.exported.getImageData(_):_,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading()}})}loaded(){return this._loaded}updateImage(n){return this.image&&n.url?(this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(n){this.coordinates=n,this._boundsArray=void 0;const a=n.map(s.MercatorCoordinate.fromLngLat);return this.tileID=function(d){let _=1/0,g=1/0,w=-1/0,T=-1/0;for(const R of d)_=Math.min(_,R.x),g=Math.min(g,R.y),w=Math.max(w,R.x),T=Math.max(T,R.y);const C=Math.max(w-_,T-g),k=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),z=Math.pow(2,k);return new s.CanonicalTileID(k,Math.floor((_+w)/2*z),Math.floor((g+T)/2*z))}(a),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(n){for(const C in this.tiles){const k=this.tiles[C];k.state!=="loaded"&&(k.state="loaded",k.texture=this.texture)}if(this._boundsArray)return;const a=s.tileTransform(this.tileID,this.map.transform.projection),[d,_,g,w]=this.coordinates.map(C=>{const k=a.projection.project(C[0],C[1]);return s.getTilePoint(a,k)._round()});this.perspectiveTransform=function(C,k,z,R,j,X,Z,W,H,G){const te=Me(0,0,C,0,0,k,C,k),K=Me(z,R,j,X,Z,W,H,G);return s.multiply$1(K,s.adjoint(te,te),K),[K[6]/K[8]*C/s.EXTENT,K[7]/K[8]*k/s.EXTENT]}(this.width,this.height,d.x,d.y,_.x,_.y,w.x,w.y,g.x,g.y);const T=this._boundsArray=new s.StructArrayLayout4i8;T.emplaceBack(d.x,d.y,0,0),T.emplaceBack(_.x,_.y,s.EXTENT,0),T.emplaceBack(w.x,w.y,0,s.EXTENT),T.emplaceBack(g.x,g.y,s.EXTENT,s.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=n.createVertexBuffer(T,s.boundsAttributes.members),this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const n=this.map.painter.context,a=n.gl;this.texture?this.texture.update(this.image):(this.texture=new s.Texture(n,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._prepareData(n)}loadTile(n,a){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},a(null)):(n.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ge={vector:class extends s.Evented{constructor(c,n,a,d){if(super(),this.id=c,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(n,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d),this._tileWorkers={},this._deduped=new s.DedupedRequest}load(c){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"}));const n=this.language||this.map._language,a=this.worldview||this.map._worldview;this._tileJSONRequest=Et(this._options,this.map._requestManager,n,a,(d,_)=>{this._tileJSONRequest=null,this._loaded=!0,d?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code. Found: ${n}`),a&&a.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new s.ErrorEvent(d))):_&&(s.extend(this,_),_.bounds&&(this.tileBounds=new Bi(_.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(_.tiles,this.map._requestManager._customAccessToken),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(d)})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}setSourceProperty(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.load(()=>{const n=this.map.style._getSourceCaches(this.id);for(const a of n)a.clearTiles()})}setTiles(c){return this.setSourceProperty(()=>{this._options.tiles=c}),this}setUrl(c){return this.setSourceProperty(()=>{this.url=c,this._options.url=c}),this}_setLanguage(c){return c===this.language||this.setSourceProperty(()=>{this.language=c}),this}_setWorldview(c){return c===this.worldview?this:this.worldviewOptions&&c&&!this.worldviewOptions[c]?(console.warn(`Vector tile source "${this.id}" does not support worldview "${c}".`),this):(this.setSourceProperty(()=>{this.worldview=c}),this)}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return s.extend({},this._options)}loadTile(c,n){const a=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(a,s.ResourceType.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:c.isSymbolTile};if(d.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired")c.state==="loading"?c.reloadCallback=n:c.request=c.actor.send("reloadTile",d,_.bind(this));else if(c.actor=this._tileWorkers[a]=this._tileWorkers[a]||this.dispatcher.getActor(),this.dispatcher.ready)c.request=c.actor.send("loadTile",d,_.bind(this),void 0,!0);else{const g=s.loadVectorTile.call({deduped:this._deduped},d,(w,T)=>{w||!T?_.call(this,w):(d.data={cacheControl:T.cacheControl,expires:T.expires,rawData:T.rawData.slice(0)},c.actor&&c.actor.send("loadTile",d,_.bind(this),void 0,!0))},!0);c.request={cancel:g}}function _(g,w){return delete c.request,c.aborted?n(null):g&&g.status!==404?n(g):(w&&w.resourceTiming&&(c.resourceTiming=w.resourceTiming),this.map._refreshExpiredTiles&&w&&c.setExpiryData(w),c.loadVectorData(w,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id})}unloadTile(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:ne,"raster-dem":class extends ne{constructor(c,n,a,d){super(c,n,a,d),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(c,n){const a=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function d(_,g){_&&(c.state="errored",n(_)),g&&(c.dem=g,c.dem.onDeserialize(),c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0,c.state="loaded",n(null))}c.request=s.getImage(this.map._requestManager.transformRequest(a,s.ResourceType.Tile),function(_,g,w,T){if(delete c.request,c.aborted)c.state="unloaded",n(null);else if(_)c.state="errored",n(_);else if(g){this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:w,expires:T});const C=s.window.ImageBitmap&&g instanceof s.window.ImageBitmap&&(me==null&&(me=s.window.OffscreenCanvas&&new s.window.OffscreenCanvas(1,1).getContext("2d")&&typeof s.window.createImageBitmap=="function"),me),k=1-(g.width-s.prevPowerOfTwo(g.width))/2;k<1||c.neighboringTiles||(c.neighboringTiles=this._getNeighboringTiles(c.tileID));const z=C?g:s.exported.getImageData(g,k),R={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:z,encoding:this.encoding,padding:k};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",R,d.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(c){const n=c.canonical,a=Math.pow(2,n.z),d=(n.x-1+a)%a,_=n.x===0?c.wrap-1:c.wrap,g=(n.x+1+a)%a,w=n.x+1===a?c.wrap+1:c.wrap,T={};return T[new s.OverscaledTileID(c.overscaledZ,_,n.z,d,n.y).key]={backfilled:!1},T[new s.OverscaledTileID(c.overscaledZ,w,n.z,g,n.y).key]={backfilled:!1},n.y>0&&(T[new s.OverscaledTileID(c.overscaledZ,_,n.z,d,n.y-1).key]={backfilled:!1},T[new s.OverscaledTileID(c.overscaledZ,c.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},T[new s.OverscaledTileID(c.overscaledZ,w,n.z,g,n.y-1).key]={backfilled:!1}),n.y+1<a&&(T[new s.OverscaledTileID(c.overscaledZ,_,n.z,d,n.y+1).key]={backfilled:!1},T[new s.OverscaledTileID(c.overscaledZ,c.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},T[new s.OverscaledTileID(c.overscaledZ,w,n.z,g,n.y+1).key]={backfilled:!1}),T}unloadTile(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded"}},geojson:class extends s.Evented{constructor(c,n,a,d){super(),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(d),this._data=n.data,this._options=s.extend({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const _=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*_,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*_,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:s.EXTENT,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*_,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(c){this.map=c,this.setData(this._data)}setData(c){return this._data=c,this._updateWorkerData(),this}getClusterExpansionZoom(c,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},n),this}getClusterChildren(c,n){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},n),this}getClusterLeaves(c,n,a,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:n,offset:a},d),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.Event("dataloading",{dataType:"source"})),this._loaded=!1;const c=s.extend({},this.workerOptions),n=this._data;typeof n=="string"?(c.request=this.map._requestManager.transformRequest(s.exported.resolveURL(n),s.ResourceType.Source),c.request.collectResourceTiming=this._collectResourceTiming):c.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,c,(a,d)=>{if(this._loaded=!0,this._pendingLoad=null,a)this.fire(new s.ErrorEvent(a));else{const _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&d&&d.resourceTiming&&d.resourceTiming[this.id]&&(_.resourceTiming=d.resourceTiming[this.id]),this.fire(new s.Event("data",_)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(c,n){const a=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(a,{type:this.type,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(d,_)=>(delete c.request,c.unloadVectorData(),c.aborted?n(null):d?n(d):(c.loadVectorData(_,this.map.painter,a==="reloadTile"),n(null))),void 0,a==="loadTile")}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0}unloadTile(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Ee{constructor(c,n,a,d){super(c,n,a,d),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const c=this.options;this.urls=[];for(const n of c.urls)this.urls.push(this.map._requestManager.transformRequest(n,s.ResourceType.Source).url);s.getVideo(this.urls,(n,a)=>{this._loaded=!0,n?this.fire(new s.ErrorEvent(n)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(c){if(this.video){const n=this.video.seekable;c<n.start(0)||c>n.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=c}}getVideo(){return this.video}onAdd(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const c=this.map.painter.context,n=c.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new s.Texture(c,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(c)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Ee,canvas:class extends Ee{constructor(c,n,a,d){super(c,n,a,d),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(g=>typeof g!="number"))||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${c}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${c}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${c}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof s.window.HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${c}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${c}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof s.window.HTMLCanvasElement?this.options.canvas:s.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.Texture(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const c of[this.canvas.width,this.canvas.height])if(isNaN(c)||c<=0)return!0;return!1}},custom:class extends s.Evented{constructor(c,n,a,d){super(),this.id=c,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=n,this.setEventedParent(d),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Bi(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.coveringTiles=this._coveringTiles.bind(this),s.extend(this,s.pick(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(c){this._map=c,this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(c),this.load()}onRemove(c){this._implementation.onRemove&&this._implementation.onRemove(c)}hasTile(c){if(this._implementation.hasTile){const{x:n,y:a,z:d}=c.canonical;return this._implementation.hasTile({x:n,y:a,z:d})}return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,n){const{x:a,y:d,z:_}=c.tileID.canonical,g=new s.window.AbortController,w=this._implementation.loadTile({x:a,y:d,z:_},{signal:g.signal});if(!w)return this.loadTileData(c,{width:this.tileSize,height:this.tileSize,data:null}),c.state="loaded",n(null);w.cancel=()=>g.abort(),c.request=w.then(function(T){return delete c.request,c.aborted?(c.state="unloaded",n(null)):T?function(C){return C instanceof s.window.ImageData||C instanceof s.window.ImageBitmap||C instanceof s.window.HTMLCanvasElement}(T)?(this.loadTileData(c,T),c.state="loaded",void n(null)):(c.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(c,{width:this.tileSize,height:this.tileSize,data:null}),c.state="loaded",n(null))}.bind(this)).catch(T=>{T.code!==20&&(c.state="errored",n(T))})}loadTileData(c,n){ne.loadTileData(c,n,this._map.painter)}unloadTileData(c){ne.unloadTileData(c,this._map.painter)}prepareTile(c){if(!this._implementation.prepareTile)return null;const{x:n,y:a,z:d}=c.tileID.canonical,_=this._implementation.prepareTile({x:n,y:a,z:d});return _?(this.loadTileData(c,_),c.state="loaded",_):null}unloadTile(c,n){if(this.unloadTileData(c),this._implementation.unloadTile){const{x:a,y:d,z:_}=c.tileID.canonical;this._implementation.unloadTile({x:a,y:d,z:_})}n()}abortTile(c,n){c.request&&c.request.cancel&&(c.request.cancel(),delete c.request),n()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(c=>({x:c.canonical.x,y:c.canonical.y,z:c.canonical.z}))}_update(){this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Ie=function(c,n,a,d){const _=new ge[n.type](c,n,a,d);if(_.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${_.id}`);return s.bindAll(["load","abort","unload","serialize","prepare"],_),_};function Qe(c,n){const a=s.identity([]);return s.scale(a,a,[.5*c.width,.5*-c.height,1]),s.translate(a,a,[1,-1,0]),s.multiply(a,a,c.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(a)}function Ct(c,n,a,d,_,g,w,T=!1){const C=c.tilesIn(d,w,T);C.sort($t);const k=[];for(const R of C)k.push({wrappedTileID:R.tile.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(n,a,c._state,R,_,g,Qe(c.transform,R.tile.tileID),T)});const z=function(R){const j={},X={};for(const Z of R){const W=Z.queryResults,H=Z.wrappedTileID,G=X[H]=X[H]||{};for(const te in W){const K=W[te],fe=G[te]=G[te]||{},he=j[te]=j[te]||[];for(const oe of K)fe[oe.featureIndex]||(fe[oe.featureIndex]=!0,he.push(oe))}}return j}(k);for(const R in z)z[R].forEach(j=>{const X=j.feature,Z=X.layer;Z&&Z.type!=="background"&&Z.type!=="sky"&&(X.source=Z.source,Z["source-layer"]&&(X.sourceLayer=Z["source-layer"]),X.state=X.id!==void 0?c.getFeatureState(Z["source-layer"],X.id):{})});return z}function st(c,n){const a=c.getRenderableIds().map(g=>c.getTileByID(g)),d=[],_={};for(let g=0;g<a.length;g++){const w=a[g],T=w.tileID.canonical.key;_[T]||(_[T]=!0,w.querySourceFeatures(d,n))}return d}function $t(c,n){const a=c.tileID,d=n.tileID;return a.overscaledZ-d.overscaledZ||a.canonical.y-d.canonical.y||a.wrap-d.wrap||a.canonical.x-d.canonical.x}function Xt(){return Ua.workerClass!=null?new Ua.workerClass:new s.window.Worker(Ua.workerUrl)}const jt="mapboxgl_preloaded_worker_pool";class Qt{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<Qt.workerCount;)this.workers.push(new Xt);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[jt]}numActive(){return Object.keys(this.active).length}}let ci;function Pi(){return ci||(ci=new Qt),ci}function ce(c,n){const a={};for(const d in c)d!=="ref"&&(a[d]=c[d]);return s.refProperties.forEach(d=>{d in n&&(a[d]=n[d])}),a}function vt(c){c=c.slice();const n=Object.create(null);for(let a=0;a<c.length;a++)n[c[a].id]=c[a];for(let a=0;a<c.length;a++)"ref"in c[a]&&(c[a]=ce(c[a],n[c[a].ref]));return c}Qt.workerCount=2;const Ze={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Ce(c,n,a){a.push({command:Ze.addSource,args:[c,n[c]]})}function wi(c,n,a){n.push({command:Ze.removeSource,args:[c]}),a[c]=!0}function ni(c,n,a,d){wi(c,a,d),Ce(c,n,a)}function $i(c,n,a){let d;for(d in c[a])if(c[a].hasOwnProperty(d)&&d!=="data"&&!D(c[a][d],n[a][d]))return!1;for(d in n[a])if(n[a].hasOwnProperty(d)&&d!=="data"&&!D(c[a][d],n[a][d]))return!1;return!0}function Cn(c,n,a,d,_,g){let w;for(w in n=n||{},c=c||{})c.hasOwnProperty(w)&&(D(c[w],n[w])||a.push({command:g,args:[d,w,n[w],_]}));for(w in n)n.hasOwnProperty(w)&&!c.hasOwnProperty(w)&&(D(c[w],n[w])||a.push({command:g,args:[d,w,n[w],_]}))}function Kn(c){return c.id}function _l(c,n){return c[n.id]=n,c}class bp{constructor(n,a){this.reset(n,a)}reset(n,a){this.points=n||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=s.clamp(n,0,1);let a=1,d=this._distances[a];const _=n*this.paddedLength+this.padding;for(;d<_&&a<this._distances.length;)d=this._distances[++a];const g=a-1,w=this._distances[g],T=d-w,C=T>0?(_-w)/T:0;return this.points[g].mult(1-C).add(this.points[a].mult(C))}}class ws{constructor(n,a,d){const _=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(n/d),this.yCellCount=Math.ceil(a/d);for(let w=0;w<this.xCellCount*this.yCellCount;w++)_.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=a,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,a,d,_,g){this._forEachCell(a,d,_,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(a),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(g)}insertCircle(n,a,d,_){this._forEachCell(a-_,d-_,a+_,d+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(a),this.circles.push(d),this.circles.push(_)}_insertBoxCell(n,a,d,_,g,w){this.boxCells[g].push(w)}_insertCircleCell(n,a,d,_,g,w){this.circleCells[g].push(w)}_query(n,a,d,_,g,w){if(d<0||n>this.width||_<0||a>this.height)return!g&&[];const T=[];if(n<=0&&a<=0&&this.width<=d&&this.height<=_){if(g)return!0;for(let C=0;C<this.boxKeys.length;C++)T.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const k=this.circles[3*C],z=this.circles[3*C+1],R=this.circles[3*C+2];T.push({key:this.circleKeys[C],x1:k-R,y1:z-R,x2:k+R,y2:z+R})}return w?T.filter(w):T}return this._forEachCell(n,a,d,_,this._queryCell,T,{hitTest:g,seenUids:{box:{},circle:{}}},w),g?T.length>0:T}_queryCircle(n,a,d,_,g){const w=n-d,T=n+d,C=a-d,k=a+d;if(T<0||w>this.width||k<0||C>this.height)return!_&&[];const z=[];return this._forEachCell(w,C,T,k,this._queryCellCircle,z,{hitTest:_,circle:{x:n,y:a,radius:d},seenUids:{box:{},circle:{}}},g),_?z.length>0:z}query(n,a,d,_,g){return this._query(n,a,d,_,!1,g)}hitTest(n,a,d,_,g){return this._query(n,a,d,_,!0,g)}hitTestCircle(n,a,d,_){return this._queryCircle(n,a,d,!0,_)}_queryCell(n,a,d,_,g,w,T,C){const k=T.seenUids,z=this.boxCells[g];if(z!==null){const j=this.bboxes;for(const X of z)if(!k.box[X]){k.box[X]=!0;const Z=4*X;if(n<=j[Z+2]&&a<=j[Z+3]&&d>=j[Z+0]&&_>=j[Z+1]&&(!C||C(this.boxKeys[X]))){if(T.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[X],x1:j[Z],y1:j[Z+1],x2:j[Z+2],y2:j[Z+3]})}}}const R=this.circleCells[g];if(R!==null){const j=this.circles;for(const X of R)if(!k.circle[X]){k.circle[X]=!0;const Z=3*X;if(this._circleAndRectCollide(j[Z],j[Z+1],j[Z+2],n,a,d,_)&&(!C||C(this.circleKeys[X]))){if(T.hitTest)return w.push(!0),!0;{const W=j[Z],H=j[Z+1],G=j[Z+2];w.push({key:this.circleKeys[X],x1:W-G,y1:H-G,x2:W+G,y2:H+G})}}}}}_queryCellCircle(n,a,d,_,g,w,T,C){const k=T.circle,z=T.seenUids,R=this.boxCells[g];if(R!==null){const X=this.bboxes;for(const Z of R)if(!z.box[Z]){z.box[Z]=!0;const W=4*Z;if(this._circleAndRectCollide(k.x,k.y,k.radius,X[W+0],X[W+1],X[W+2],X[W+3])&&(!C||C(this.boxKeys[Z])))return w.push(!0),!0}}const j=this.circleCells[g];if(j!==null){const X=this.circles;for(const Z of j)if(!z.circle[Z]){z.circle[Z]=!0;const W=3*Z;if(this._circlesCollide(X[W],X[W+1],X[W+2],k.x,k.y,k.radius)&&(!C||C(this.circleKeys[Z])))return w.push(!0),!0}}}_forEachCell(n,a,d,_,g,w,T,C){const k=this._convertToXCellCoord(n),z=this._convertToYCellCoord(a),R=this._convertToXCellCoord(d),j=this._convertToYCellCoord(_);for(let X=k;X<=R;X++)for(let Z=z;Z<=j;Z++)if(g.call(this,n,a,d,_,this.xCellCount*Z+X,w,T,C))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,a,d,_,g,w){const T=_-n,C=g-a,k=d+w;return k*k>T*T+C*C}_circleAndRectCollide(n,a,d,_,g,w,T){const C=(w-_)/2,k=Math.abs(n-(_+C));if(k>C+d)return!1;const z=(T-g)/2,R=Math.abs(a-(g+z));if(R>z+d)return!1;if(k<=C||R<=z)return!0;const j=k-C,X=R-z;return j*j+X*X<=d*d}}const zt=Math.tan(85*Math.PI/180);function gi(c,n,a,d,_,g,w){const T=s.create();if(a)if(g.name==="globe"){const C=s.calculateGlobeLabelMatrix(_,n);s.multiply(T,T,C)}else{const C=Xe([],w);T[0]=C[0],T[1]=C[1],T[4]=C[2],T[5]=C[3],d||s.rotateZ(T,T,_.angle)}else s.multiply(T,_.labelPlaneMatrix,c);return T}function yi(c,n,a,d,_,g,w){const T=gi(c,n,a,d,_,g,w);return g.name==="globe"&&a||(T[2]=T[6]=T[10]=T[14]=0),T}function Br(c,n,a,d,_,g,w){if(a){if(g.name==="globe"){const T=gi(c,n,a,d,_,g,w);return s.invert(T,T),s.multiply(T,c,T),T}{const T=s.clone(c),C=s.identity([]);return C[0]=w[0],C[1]=w[1],C[4]=w[2],C[5]=w[3],s.multiply(T,T,C),d||s.rotateZ(T,T,-_.angle),T}}return _.glCoordMatrix}function Rr(c,n,a=0){const d=[c.x,c.y,a,1];a?s.transformMat4$1(d,d,n):Yn(d,d,n);const _=d[3];return{point:[d[0]/_,d[1]/_,d[2]/_],signedDistanceFromCamera:_}}function ui(c,n){const a=[c[0],c[1],c[2],1];s.transformMat4$1(a,a,n);const d=a[3];return{point:[a[0]/d,a[1]/d,a[2]/d],signedDistanceFromCamera:d}}function da(c,n){return Math.min(.5+c/n*.5,1.5)}function fa(c,n){const a=c[0]/c[3],d=c[1]/c[3];return a>=-n[0]&&a<=n[0]&&d>=-n[1]&&d<=n[1]}function pa(c,n,a,d,_,g,w,T,C,k){const z=a.transform,R=d?c.textSizeData:c.iconSizeData,j=s.evaluateSizeForZoom(R,a.transform.zoom),X=z.projection.name==="globe",Z=[256/a.width*2+1,256/a.height*2+1],W=d?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;W.clear();let H=null;X&&(H=d?c.text.globeExtVertexArray:c.icon.globeExtVertexArray);const G=c.lineVertexArray,te=d?c.text.placedSymbolArray:c.icon.placedSymbolArray,K=a.transform.width/a.transform.height;let fe=!1;for(let he=0;he<te.length;he++){const oe=te.get(he);if(oe.writingMode!==s.WritingMode.vertical||fe||he!==0&&te.get(he-1).writingMode===s.WritingMode.horizontal||(fe=!0),(oe.hidden||oe.writingMode===s.WritingMode.vertical)&&!fe){Eo(oe.numGlyphs,W);continue}fe=!1;const de=new s.pointGeometry(oe.tileAnchorX,oe.tileAnchorY),le=C?C(de):[0,0,0],ye=z.projection.projectTilePoint(de.x,de.y,k.canonical),Le=[ye.x+le[0],ye.y+le[1],ye.z+le[2]],dt=[...Le,1];if(s.transformMat4$1(dt,dt,n),!fa(dt,Z)){Eo(oe.numGlyphs,W);continue}const Ae=da(a.transform.cameraToCenterDistance,dt[3]),Je=s.evaluateSizeForFeature(R,j,oe),rt=w?Je/Ae:Je*Ae,wt=Rr(new s.pointGeometry(Le[0],Le[1]),_,Le[2]);if(wt.signedDistanceFromCamera<=0){Eo(oe.numGlyphs,W);continue}let je={};const mt=w?null:C,it=Nh(oe,rt,!1,T,n,_,g,c.glyphOffsetArray,G,W,H,wt.point,de,je,K,mt,z.projection,k,w);fe=it.useVertical,mt&&it.needsFlipping&&(je={}),(it.notEnoughRoom||fe||it.needsFlipping&&Nh(oe,rt,!0,T,n,_,g,c.glyphOffsetArray,G,W,H,wt.point,de,je,K,mt,z.projection,k,w).notEnoughRoom)&&Eo(oe.numGlyphs,W)}d?(c.text.dynamicLayoutVertexBuffer.updateData(W),H&&c.text.globeExtVertexBuffer.updateData(H)):(c.icon.dynamicLayoutVertexBuffer.updateData(W),H&&c.icon.globeExtVertexBuffer.updateData(H))}function gr(c,n,a,d,_,g,w,T,C,k,z,R,j,X,Z,W){const H=T.glyphStartIndex+T.numGlyphs,G=T.lineStartIndex,te=T.lineStartIndex+T.lineLength,K=n.getoffsetX(T.glyphStartIndex),fe=n.getoffsetX(H-1),he=To(c*K,a,d,_,g,w,T.segment,G,te,C,k,z,R,j,!0,X,Z,W);if(!he)return null;const oe=To(c*fe,a,d,_,g,w,T.segment,G,te,C,k,z,R,j,!0,X,Z,W);return oe?{first:he,last:oe}:null}function sn(c,n,a,d){return c.writingMode===s.WritingMode.horizontal&&Math.abs(a.y-n.y)>Math.abs(a.x-n.x)*d?{useVertical:!0}:c.writingMode===s.WritingMode.vertical?n.y<a.y?{needsFlipping:!0}:null:c.flipState!==0&&function(_,g,w){const T=(g.x-_.x)*w;return T===0||Math.abs((g.y-_.y)/T)>zt}(n,a,d)?c.flipState===1?{needsFlipping:!0}:null:n.x>a.x?{needsFlipping:!0}:null}function Nh(c,n,a,d,_,g,w,T,C,k,z,R,j,X,Z,W,H,G,te){const K=n/24,fe=c.lineOffsetX*K,he=c.lineOffsetY*K;let oe;if(c.numGlyphs>1){const de=c.glyphStartIndex+c.numGlyphs,le=c.lineStartIndex,ye=c.lineStartIndex+c.lineLength,Le=gr(K,T,fe,he,a,R,j,c,C,g,X,W,!1,H,G,te);if(!Le)return{notEnoughRoom:!0};const dt=ui(Le.first.point,w).point,Ae=ui(Le.last.point,w).point,Je=new s.pointGeometry(dt[0],dt[1]),rt=new s.pointGeometry(Ae[0],Ae[1]);if(d&&!a){const wt=sn(c,Je,rt,Z);if(c.flipState=wt&&wt.needsFlipping?1:2,wt)return wt}oe=[Le.first];for(let wt=c.glyphStartIndex+1;wt<de-1;wt++)oe.push(To(K*T.getoffsetX(wt),fe,he,a,R,j,c.segment,le,ye,C,g,X,W,!1,!1,H,G,te));oe.push(Le.last)}else{if(d&&!a){const le=Rr(j,_).point,ye=c.lineStartIndex+c.segment+1,Le=new s.pointGeometry(C.getx(ye),C.gety(ye)),dt=Rr(Le,_),Ae=dt.signedDistanceFromCamera>0?dt.point:gl(j,Le,le,1,_,void 0,H,G.canonical),Je=sn(c,new s.pointGeometry(le[0],le[1]),new s.pointGeometry(Ae[0],Ae[1]),Z);if(c.flipState=Je&&Je.needsFlipping?1:2,Je)return Je}const de=To(K*T.getoffsetX(c.glyphStartIndex),fe,he,a,R,j,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,C,g,X,W,!1,!1,H,G,te);if(!de)return{notEnoughRoom:!0};oe=[de]}if(z)for(const de of oe)s.updateGlobeVertexNormal(z,k.length+0,de.up[0],de.up[1],de.up[2]),s.updateGlobeVertexNormal(z,k.length+1,de.up[0],de.up[1],de.up[2]),s.updateGlobeVertexNormal(z,k.length+2,de.up[0],de.up[1],de.up[2]),s.updateGlobeVertexNormal(z,k.length+3,de.up[0],de.up[1],de.up[2]),s.addDynamicAttributes(k,de.point[0],de.point[1],de.point[2],de.angle);else for(const de of oe)s.addDynamicAttributes(k,de.point[0],de.point[1],de.point[2],de.angle);return{}}function Ts(c,n,a,d,_){const g=d.projectTilePoint(c.x,c.y,n);if(!_)return Rr(g,a,g.z);const w=_(c);return Rr(new s.pointGeometry(g.x+w[0],g.y+w[1]),a,g.z+w[2])}function gl(c,n,a,d,_,g,w,T){const C=Ts(c.add(c.sub(n)._unit()),T,_,w,g).point,k=s.sub([],a,C);return s.scaleAndAdd([],a,k,d/s.length(k))}function To(c,n,a,d,_,g,w,T,C,k,z,R,j,X,Z,W,H,G){const te=d?c-n:c+n;let K=te>0?1:-1,fe=0;d&&(K*=-1,fe=Math.PI),K<0&&(fe+=Math.PI);let he=K>0?T+w:T+w+1,oe=_,de=_,le=0,ye=0;const Le=Math.abs(te),dt=[],Ae=[];let Je=g;const rt=()=>{const Vt=he-K;return le===0?g:new s.pointGeometry(k.getx(Vt),k.gety(Vt))},wt=()=>gl(rt(),Je,de,Le-le+1,z,j,W,H.canonical);for(;le+ye<=Le;){if(he+=K,he<T||he>=C)return null;if(de=oe,dt.push(oe),X&&Ae.push(Je||rt()),oe=R[he],oe===void 0){Je=new s.pointGeometry(k.getx(he),k.gety(he));const Vt=Ts(Je,H.canonical,z,W,j);oe=Vt.signedDistanceFromCamera>0?R[he]=Vt.point:wt()}else Je=null;le+=ye,ye=s.distance(de,oe)}Je=Je||new s.pointGeometry(k.getx(he),k.gety(he));const je=rt();Z&&j&&(R[he]=oe=R[he]===void 0?oe:wt(),ye=s.distance(de,oe));const mt=(Le-le)/ye,it=Je.sub(je).mult(mt)._add(je),It=s.sub([],oe,de),St=s.scaleAndAdd([],de,It,mt);let Ot=[0,0,1],Wt=It[0],ii=It[1];if(G&&(Ot=W.upVector(H.canonical,it.x,it.y),Ot[0]!==0||Ot[1]!==0||Ot[2]!==1)){const Vt=[1,0,0],ai=[0,1,0];Vt[0]=Ot[2],Vt[1]=0,Vt[2]=-Ot[0],s.cross(ai,Ot,Vt),s.normalize(Vt,Vt),s.normalize(ai,ai),Wt=s.dot(It,Vt),ii=s.dot(It,ai)}if(a){const Vt=s.cross([],Ot,It);s.normalize(Vt,Vt),s.scaleAndAdd(St,St,Vt,a*K)}const xi=fe+Math.atan2(ii,Wt);return dt.push(St),X&&Ae.push(it),{point:St,angle:xi,path:dt,tilePath:Ae,up:Ot}}const Rc=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Eo(c,n){for(let a=0;a<c;a++){const d=n.length;n.resize(d+4),n.float32.set(Rc,4*d)}}function Yn(c,n,a){const d=n[0],_=n[1];return c[0]=a[0]*d+a[4]*_+a[12],c[1]=a[1]*d+a[5]*_+a[13],c[3]=a[3]*d+a[7]*_+a[15],c}const Ni=100;class Fc{constructor(n,a,d=new ws(n.width+200,n.height+200,25),_=new ws(n.width+200,n.height+200,25)){this.transform=n,this.grid=d,this.ignoredGrid=_,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+Ni,this.screenBottomBoundary=n.height+Ni,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=a}placeCollisionBox(n,a,d,_,g,w,T,C){let k=d.projectedAnchorX,z=d.projectedAnchorY,R=d.projectedAnchorZ;const j=d.elevation,X=d.tileID;if(j&&X){const he=n.getProjection().upVector(X.canonical,d.tileAnchorX,d.tileAnchorY),oe=n.getProjection().upVectorScale(X.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;k+=he[0]*j*oe,z+=he[1]*j*oe,R+=he[2]*j*oe}const Z=this.projectAndGetPerspectiveRatio(T,[k,z,R],d.tileID,n.projection.name==="globe"||!!j||this.transform.pitch>0,n.getProjection()),W=w*Z.perspectiveRatio,H=(d.x1*a+_.x-d.padding)*W+Z.point.x,G=(d.y1*a+_.y-d.padding)*W+Z.point.y,te=(d.x2*a+_.x+d.padding)*W+Z.point.x,K=(d.y2*a+_.y+d.padding)*W+Z.point.y,fe=Z.perspectiveRatio<=.55||Z.occluded;return!this.isInsideGrid(H,G,te,K)||!g&&this.grid.hitTest(H,G,te,K,C)||fe?{box:[],offscreen:!1,occluded:Z.occluded}:{box:[H,G,te,K],offscreen:this.isOffscreen(H,G,te,K),occluded:!1}}placeCollisionCircles(n,a,d,_,g,w,T,C,k,z,R,j,X,Z,W){const H=[],G=this.transform.elevation,te=G?G.getAtTileOffsetFunc(W,this.transform.center.lat,this.transform.worldSize,n.getProjection()):je=>[0,0,0],K=new s.pointGeometry(d.tileAnchorX,d.tileAnchorY),fe=n.getProjection().projectTilePoint(d.tileAnchorX,d.tileAnchorY,W.canonical),he=te(K),oe=[fe.x+he[0],fe.y+he[1],fe.z+he[2]],de=n.projection.name==="globe",le=this.projectAndGetPerspectiveRatio(T,[oe[0],oe[1],oe[2]],W,de||!!G||this.transform.pitch>0,n.getProjection()),{perspectiveRatio:ye}=le,Le=(R?w/ye:w*ye)/s.ONE_EM,dt=Rr(new s.pointGeometry(oe[0],oe[1]),C,oe[2]).point,Ae=le.signedDistanceFromCamera>0?gr(Le,g,d.lineOffsetX*Le,d.lineOffsetY*Le,!1,dt,K,d,_,C,{},G&&!R?te:null,R&&!!G,n.getProjection(),W,R):null;let Je=!1,rt=!1,wt=!0;if(Ae&&!le.occluded){const je=.5*X*ye+Z,mt=new s.pointGeometry(-100,-100),it=new s.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),It=new bp,St=Ae.first,Ot=Ae.last;let Wt=[];for(let Vt=St.path.length-1;Vt>=1;Vt--)Wt.push(St.path[Vt]);for(let Vt=1;Vt<Ot.path.length;Vt++)Wt.push(Ot.path[Vt]);const ii=2.5*je;if(k){const Vt=Wt.map(G&&!de?(ai,Mi)=>{const Qi=te(Mi<St.path.length-1?St.tilePath[St.path.length-1-Mi]:Ot.tilePath[Mi-St.path.length+2]);return ai[2]=Qi[2],ui(ai,k)}:ai=>ui(ai,k));Wt=Vt.some(ai=>ai.signedDistanceFromCamera<=0)?[]:Vt.map(ai=>ai.point)}let xi=[];if(Wt.length>0){const Vt=Wt.map(ji=>new s.pointGeometry(ji[0],ji[1]));let ai=1/0,Mi=-1/0,Qi=1/0,hn=-1/0;for(let ji=0;ji<Vt.length;ji++)ai=Math.min(ai,Vt[ji].x),Qi=Math.min(Qi,Vt[ji].y),Mi=Math.max(Mi,Vt[ji].x),hn=Math.max(hn,Vt[ji].y);xi=ai>=mt.x&&Mi<=it.x&&Qi>=mt.y&&hn<=it.y?[Vt]:Mi<mt.x||ai>it.x||hn<mt.y||Qi>it.y?[]:s.clipLine([Vt],mt.x,mt.y,it.x,it.y)}for(const Vt of xi){It.reset(Vt,.25*je);let ai=0;ai=It.length<=.5*je?1:Math.ceil(It.paddedLength/ii)+1;for(let Mi=0;Mi<ai;Mi++){const Qi=Mi/Math.max(ai-1,1),hn=It.lerp(Qi),ji=hn.x+Ni,Fn=hn.y+Ni;H.push(ji,Fn,je,0);const Vr=ji-je,so=Fn-je,en=ji+je,nn=Fn+je;if(wt=wt&&this.isOffscreen(Vr,so,en,nn),rt=rt||this.isInsideGrid(Vr,so,en,nn),!a&&this.grid.hitTestCircle(ji,Fn,je,j)&&(Je=!0,!z))return{circles:[],offscreen:!1,collisionDetected:Je,occluded:!1}}}}return{circles:!z&&Je||!rt?[]:H,offscreen:wt,collisionDetected:Je,occluded:le.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let d=1/0,_=1/0,g=-1/0,w=-1/0;for(const z of n){const R=new s.pointGeometry(z.x+Ni,z.y+Ni);d=Math.min(d,R.x),_=Math.min(_,R.y),g=Math.max(g,R.x),w=Math.max(w,R.y),a.push(R)}const T=this.grid.query(d,_,g,w).concat(this.ignoredGrid.query(d,_,g,w)),C={},k={};for(const z of T){const R=z.key;if(C[R.bucketInstanceId]===void 0&&(C[R.bucketInstanceId]={}),C[R.bucketInstanceId][R.featureIndex])continue;const j=[new s.pointGeometry(z.x1,z.y1),new s.pointGeometry(z.x2,z.y1),new s.pointGeometry(z.x2,z.y2),new s.pointGeometry(z.x1,z.y2)];s.polygonIntersectsPolygon(a,j)&&(C[R.bucketInstanceId][R.featureIndex]=!0,k[R.bucketInstanceId]===void 0&&(k[R.bucketInstanceId]=[]),k[R.bucketInstanceId].push(R.featureIndex))}return k}insertCollisionBox(n,a,d,_,g){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:_,collisionGroupID:g},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,a,d,_,g){const w=a?this.ignoredGrid:this.grid,T={bucketInstanceId:d,featureIndex:_,collisionGroupID:g};for(let C=0;C<n.length;C+=4)w.insertCircle(T,n[C],n[C+1],n[C+2])}projectAndGetPerspectiveRatio(n,a,d,_,g){const w=[a[0],a[1],a[2],1];let T=!1;if(a[2]||this.transform.pitch>0){s.transformMat4$1(w,w,n);const C=g.name==="globe";this.fogState&&d&&!C&&(T=function(k,z,R,j,X,Z){const W=Z.calculateFogTileMatrix(X),H=[z,R,j];return s.transformMat4(H,H,W),At(k,H,Z.pitch,Z._fov)}(this.fogState,a[0],a[1],a[2],d.toUnwrapped(),this.transform)>.9)}else Yn(w,w,n);return{point:new s.pointGeometry((w[0]/w[3]+1)/2*this.transform.width+Ni,(-w[1]/w[3]+1)/2*this.transform.height+Ni),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(g)/w[3]*.5,1.5),signedDistanceFromCamera:w[3],occluded:_&&w[2]>w[3]||T}}isOffscreen(n,a,d,_){return d<Ni||n>=this.screenRightBoundary||_<Ni||a>this.screenBottomBoundary}isInsideGrid(n,a,d,_){return d>=0&&n<this.gridRightBoundary&&_>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const n=s.identity([]);return s.translate(n,n,[-100,-100,0]),n}}function ma(c,n,a){const d=n.createTileMatrix(c,c.worldSize,a.toUnwrapped());return s.multiply(new Float32Array(16),c.projMatrix,d)}function sr(c,n,a){if(n.projection.name===a.projection.name)return c.projMatrix;const d=a.clone();return d.setProjection(n.projection),ma(d,n.getProjection(),c)}function ar(c,n,a){return n.name===a.projection.name?c.projMatrix:ma(a,n,c)}class Oc{constructor(n,a,d,_){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?a:-a))):_&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class So{constructor(n,a,d,_,g,w=!1){this.text=new Oc(n?n.text:null,a,d,g),this.icon=new Oc(n?n.icon:null,a,_,g),this.clipped=w}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class gn{constructor(n,a,d,_=!1){this.text=n,this.icon=a,this.skipFade=d,this.clipped=_}}class _a{constructor(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]}}class Vc{constructor(n,a,d,_,g){this.bucketInstanceId=n,this.featureIndex=a,this.sourceLayerIndex=d,this.bucketIndex=_,this.tileID=g}}class ga{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const a=++this.maxGroupID;this.collisionGroups[n]={ID:a,predicate:d=>d.collisionGroupID===a}}return this.collisionGroups[n]}}function Pn(c,n,a,d,_){const{horizontalAlign:g,verticalAlign:w}=s.getAnchorAlignment(c),T=-(g-.5)*n,C=-(w-.5)*a,k=s.evaluateVariableOffset(c,d);return new s.pointGeometry(T+k[0]*_,C+k[1]*_)}function ya(c,n,a,d,_){const g=new s.pointGeometry(c,n);return a&&g._rotate(d?_:-_),g}class Uc{constructor(n,a,d,_,g){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new Fc(this.transform,g),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new ga(d),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,a,d,_){const g=d.getBucket(a),w=d.latestFeatureIndex;if(!g||!w||a.id!==g.layerIds[0])return;const T=g.layers[0].layout,C=d.collisionBoxArray,k=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),z=d.tileSize/s.EXTENT,R=d.tileID.toUnwrapped();this.transform.setProjection(g.projection);const j=(X=d.tileID,Z=g.getProjection(),W=this.transform,Z.name===this.projection?W.calculateProjMatrix(X.toUnwrapped()):ma(W,Z,X));var X,Z,W;const H=T.get("text-pitch-alignment")==="map",G=T.get("text-rotation-alignment")==="map";a.compileFilter();const te=a.dynamicFilter(),K=a.dynamicFilterNeedsFeature(),fe=this.transform.calculatePixelsToTileUnitsMatrix(d),he=yi(j,d.tileID.canonical,H,G,this.transform,g.getProjection(),fe);let oe=null;if(H){const ye=Br(j,d.tileID.canonical,H,G,this.transform,g.getProjection(),fe);oe=s.multiply([],this.transform.labelPlaneMatrix,ye)}let de=null;te&&d.latestFeatureIndex&&(de={unwrappedTileID:R,dynamicFilter:te,dynamicFilterNeedsFeature:K,featureIndex:d.latestFeatureIndex}),this.retainedQueryData[g.bucketInstanceId]=new Vc(g.bucketInstanceId,w,g.sourceLayerIndex,g.index,d.tileID);const le={bucket:g,layout:T,posMatrix:j,textLabelPlaneMatrix:he,labelToScreenMatrix:oe,clippingData:de,scale:k,textPixelRatio:z,holdingForFade:d.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(g.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.evaluateSizeForZoom(g.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(_)for(const ye of g.sortKeyRanges){const{sortKey:Le,symbolInstanceStart:dt,symbolInstanceEnd:Ae}=ye;n.push({sortKey:Le,symbolInstanceStart:dt,symbolInstanceEnd:Ae,parameters:le})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:le})}attemptAnchorPlacement(n,a,d,_,g,w,T,C,k,z,R,j,X,Z,W,H,G,te){const K=[j.textOffset0,j.textOffset1],fe=Pn(n,d,_,K,g),he=this.collisionIndex.placeCollisionBox(Z,g,a,ya(fe.x,fe.y,w,T,this.transform.angle),R,C,k,z.predicate);if((!H||this.collisionIndex.placeCollisionBox(Z,Z.getSymbolInstanceIconSize(te,this.transform.zoom,X),H,ya(fe.x,fe.y,w,T,this.transform.angle),R,C,k,z.predicate).box.length!==0)&&he.box.length>0){let oe;return this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(oe=this.prevPlacement.variableOffsets[j.crossTileID].anchor),this.variableOffsets[j.crossTileID]={textOffset:K,width:d,height:_,anchor:n,textScale:g,prevAnchor:oe},this.markUsedJustification(Z,n,j,W),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,W,j),this.placedOrientations[j.crossTileID]=W),{shift:fe,placedGlyphBoxes:he}}}placeLayerBucketPart(n,a,d,_){const{bucket:g,layout:w,posMatrix:T,textLabelPlaneMatrix:C,labelToScreenMatrix:k,clippingData:z,textPixelRatio:R,holdingForFade:j,collisionBoxArray:X,partiallyEvaluatedTextSize:Z,partiallyEvaluatedIconSize:W,collisionGroup:H}=n.parameters,G=w.get("text-optional"),te=w.get("icon-optional"),K=w.get("text-allow-overlap"),fe=w.get("icon-allow-overlap"),he=w.get("text-rotation-alignment")==="map",oe=w.get("text-pitch-alignment")==="map",de=w.get("icon-text-fit")!=="none",le=w.get("symbol-z-order")==="viewport-y";this.transform.setProjection(g.projection);let ye=K&&(fe||!g.hasIconData()||te),Le=fe&&(K||!g.hasTextData()||G);!g.collisionArrays&&X&&g.deserializeCollisionBoxes(X),d&&_&&g.updateCollisionDebugBuffers(this.transform.zoom,X);const dt=(Ae,Je,rt)=>{if(z){const en={zoom:this.transform.zoom,pitch:this.transform.pitch};let nn=null;if(z.dynamicFilterNeedsFeature){const _i=this.retainedQueryData[g.bucketInstanceId];nn=z.featureIndex.loadFeature({featureIndex:Ae.featureIndex,bucketIndex:_i.bucketIndex,sourceLayerIndex:_i.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,z.dynamicFilter)(en,nn,this.retainedQueryData[g.bucketInstanceId].tileID.canonical,new s.pointGeometry(Ae.tileAnchorX,Ae.tileAnchorY),this.transform.calculateDistanceTileData(z.unwrappedTileID)))return this.placements[Ae.crossTileID]=new gn(!1,!1,!1,!0),void(a[Ae.crossTileID]=!0)}if(a[Ae.crossTileID])return;if(j)return void(this.placements[Ae.crossTileID]=new gn(!1,!1,!1));let wt=!1,je=!1,mt=!0,it=!1,It=!1,St=null,Ot={box:null,offscreen:null,occluded:null},Wt={box:null,offscreen:null,occluded:null},ii=null,xi=null,Vt=null,ai=0,Mi=0,Qi=0;rt.textFeatureIndex?ai=rt.textFeatureIndex:Ae.useRuntimeCollisionCircles&&(ai=Ae.featureIndex),rt.verticalTextFeatureIndex&&(Mi=rt.verticalTextFeatureIndex);const hn=en=>{en.tileID=this.retainedQueryData[g.bucketInstanceId].tileID,(this.transform.elevation||en.elevation)&&(en.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[g.bucketInstanceId].tileID,en.tileAnchorX,en.tileAnchorY):0)},ji=rt.textBox;if(ji){hn(ji);const en=_i=>{let bn=s.WritingMode.horizontal;if(g.allowVerticalPlacement&&!_i&&this.prevPlacement){const Gn=this.prevPlacement.placedOrientations[Ae.crossTileID];Gn&&(this.placedOrientations[Ae.crossTileID]=Gn,bn=Gn,this.markUsedOrientation(g,bn,Ae))}return bn},nn=(_i,bn)=>{if(g.allowVerticalPlacement&&Ae.numVerticalGlyphVertices>0&&rt.verticalTextBox){for(const Gn of g.writingModes)if(Gn===s.WritingMode.vertical?(Ot=bn(),Wt=Ot):Ot=_i(),Ot&&Ot.box&&Ot.box.length)break}else Ot=_i()};if(w.get("text-variable-anchor")){let _i=w.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ae.crossTileID]){const Xi=this.prevPlacement.variableOffsets[Ae.crossTileID];_i.indexOf(Xi.anchor)>0&&(_i=_i.filter(Zn=>Zn!==Xi.anchor),_i.unshift(Xi.anchor))}const bn=(Xi,Zn,Qo)=>{const Jn=g.getSymbolInstanceTextSize(Z,Ae,this.transform.zoom,Je),es=(Xi.x2-Xi.x1)*Jn+2*Xi.padding,ts=(Xi.y2-Xi.y1)*Jn+2*Xi.padding,is=de&&!fe?Zn:null;is&&hn(is);let Qn={box:[],offscreen:!1,occluded:!1};const ns=K?2*_i.length:_i.length;for(let ko=0;ko<ns;++ko){const Na=this.attemptAnchorPlacement(_i[ko%_i.length],Xi,es,ts,Jn,he,oe,R,T,H,ko>=_i.length,Ae,Je,g,Qo,is,Z,W);if(Na&&(Qn=Na.placedGlyphBoxes,Qn&&Qn.box&&Qn.box.length)){wt=!0,St=Na.shift;break}}return Qn};nn(()=>bn(ji,rt.iconBox,s.WritingMode.horizontal),()=>{const Xi=rt.verticalTextBox;return Xi&&hn(Xi),g.allowVerticalPlacement&&!(Ot&&Ot.box&&Ot.box.length)&&Ae.numVerticalGlyphVertices>0&&Xi?bn(Xi,rt.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Ot&&(wt=Ot.box,mt=Ot.offscreen,it=Ot.occluded);const Gn=en(Ot&&Ot.box);if(!wt&&this.prevPlacement){const Xi=this.prevPlacement.variableOffsets[Ae.crossTileID];Xi&&(this.variableOffsets[Ae.crossTileID]=Xi,this.markUsedJustification(g,Xi.anchor,Ae,Gn))}}else{const _i=(bn,Gn)=>{const Xi=g.getSymbolInstanceTextSize(Z,Ae,this.transform.zoom,Je),Zn=this.collisionIndex.placeCollisionBox(g,Xi,bn,new s.pointGeometry(0,0),K,R,T,H.predicate);return Zn&&Zn.box&&Zn.box.length&&(this.markUsedOrientation(g,Gn,Ae),this.placedOrientations[Ae.crossTileID]=Gn),Zn};nn(()=>_i(ji,s.WritingMode.horizontal),()=>{const bn=rt.verticalTextBox;return g.allowVerticalPlacement&&Ae.numVerticalGlyphVertices>0&&bn?(hn(bn),_i(bn,s.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),en(Ot&&Ot.box&&Ot.box.length)}}if(ii=Ot,wt=ii&&ii.box&&ii.box.length>0,mt=ii&&ii.offscreen,it=ii&&ii.occluded,Ae.useRuntimeCollisionCircles){const en=g.text.placedSymbolArray.get(Ae.centerJustifiedTextSymbolIndex>=0?Ae.centerJustifiedTextSymbolIndex:Ae.verticalPlacedTextSymbolIndex),nn=s.evaluateSizeForFeature(g.textSizeData,Z,en),_i=w.get("text-padding");xi=this.collisionIndex.placeCollisionCircles(g,K,en,g.lineVertexArray,g.glyphOffsetArray,nn,T,C,k,d,oe,H.predicate,Ae.collisionCircleDiameter*nn/s.ONE_EM,_i,this.retainedQueryData[g.bucketInstanceId].tileID),wt=K||xi.circles.length>0&&!xi.collisionDetected,mt=mt&&xi.offscreen,it=xi.occluded}if(rt.iconFeatureIndex&&(Qi=rt.iconFeatureIndex),rt.iconBox){const en=nn=>{hn(nn);const _i=de&&St?ya(St.x,St.y,he,oe,this.transform.angle):new s.pointGeometry(0,0),bn=g.getSymbolInstanceIconSize(W,this.transform.zoom,Je);return this.collisionIndex.placeCollisionBox(g,bn,nn,_i,fe,R,T,H.predicate)};Wt&&Wt.box&&Wt.box.length&&rt.verticalIconBox?(Vt=en(rt.verticalIconBox),je=Vt.box.length>0):(Vt=en(rt.iconBox),je=Vt.box.length>0),mt=mt&&Vt.offscreen,It=Vt.occluded}const Fn=G||Ae.numHorizontalGlyphVertices===0&&Ae.numVerticalGlyphVertices===0,Vr=te||Ae.numIconVertices===0;if(Fn||Vr?Vr?Fn||(je=je&&wt):wt=je&&wt:je=wt=je&&wt,wt&&ii&&ii.box&&this.collisionIndex.insertCollisionBox(ii.box,w.get("text-ignore-placement"),g.bucketInstanceId,Wt&&Wt.box&&Mi?Mi:ai,H.ID),je&&Vt&&this.collisionIndex.insertCollisionBox(Vt.box,w.get("icon-ignore-placement"),g.bucketInstanceId,Qi,H.ID),xi&&(wt&&this.collisionIndex.insertCollisionCircles(xi.circles,w.get("text-ignore-placement"),g.bucketInstanceId,ai,H.ID),d)){const en=g.bucketInstanceId;let nn=this.collisionCircleArrays[en];nn===void 0&&(nn=this.collisionCircleArrays[en]=new _a);for(let _i=0;_i<xi.circles.length;_i+=4)nn.circles.push(xi.circles[_i+0]),nn.circles.push(xi.circles[_i+1]),nn.circles.push(xi.circles[_i+2]),nn.circles.push(xi.collisionDetected?1:0)}const so=g.projection.name!=="globe";ye=ye&&(so||!it),Le=Le&&(so||!It),this.placements[Ae.crossTileID]=new gn(wt||ye,je||Le,mt||g.justReloaded),a[Ae.crossTileID]=!0};if(le){const Ae=g.getSortedSymbolIndexes(this.transform.angle);for(let Je=Ae.length-1;Je>=0;--Je){const rt=Ae[Je];dt(g.symbolInstances.get(rt),rt,g.collisionArrays[rt])}}else for(let Ae=n.symbolInstanceStart;Ae<n.symbolInstanceEnd;Ae++)dt(g.symbolInstances.get(Ae),Ae,g.collisionArrays[Ae]);if(d&&g.bucketInstanceId in this.collisionCircleArrays){const Ae=this.collisionCircleArrays[g.bucketInstanceId];s.invert(Ae.invProjMatrix,T),Ae.viewportMatrix=this.collisionIndex.getViewportMatrix()}g.justReloaded=!1}markUsedJustification(n,a,d,_){let g;g=_===s.WritingMode.vertical?d.verticalPlacedTextSymbolIndex:{left:d.leftJustifiedTextSymbolIndex,center:d.centerJustifiedTextSymbolIndex,right:d.rightJustifiedTextSymbolIndex}[s.getAnchorJustification(a)];const w=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex,d.verticalPlacedTextSymbolIndex];for(const T of w)T>=0&&(n.text.placedSymbolArray.get(T).crossTileID=g>=0&&T!==g?0:d.crossTileID)}markUsedOrientation(n,a,d){const _=a===s.WritingMode.horizontal||a===s.WritingMode.horizontalOnly?a:0,g=a===s.WritingMode.vertical?a:0,w=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex];for(const T of w)n.text.placedSymbolArray.get(T).placedOrientation=_;d.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(d.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let d=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const _=a?a.symbolFadeChange(n):1,g=a?a.opacities:{},w=a?a.variableOffsets:{},T=a?a.placedOrientations:{};for(const C in this.placements){const k=this.placements[C],z=g[C];z?(this.opacities[C]=new So(z,_,k.text,k.icon,null,k.clipped),d=d||k.text!==z.text.placed||k.icon!==z.icon.placed):(this.opacities[C]=new So(null,_,k.text,k.icon,k.skipFade,k.clipped),d=d||k.text||k.icon)}for(const C in g){const k=g[C];if(!this.opacities[C]){const z=new So(k,_,!1,!1);z.isHidden()||(this.opacities[C]=z,d=d||k.text.placed||k.icon.placed)}}for(const C in w)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=w[C]);for(const C in T)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=T[C]);d?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:n)}updateLayerOpacities(n,a){const d={};for(const _ of a){const g=_.getBucket(n);g&&_.latestFeatureIndex&&n.id===g.layerIds[0]&&this.updateBucketOpacities(g,d,_.collisionBoxArray)}}updateBucketOpacities(n,a,d){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const _=n.layers[0].layout,g=!!n.layers[0].dynamicFilter(),w=new So(null,0,!1,!1,!0),T=_.get("text-allow-overlap"),C=_.get("icon-allow-overlap"),k=_.get("text-variable-anchor"),z=_.get("text-rotation-alignment")==="map",R=_.get("text-pitch-alignment")==="map",j=_.get("icon-text-fit")!=="none",X=new So(null,0,T&&(C||!n.hasIconData()||_.get("icon-optional")),C&&(T||!n.hasTextData()||_.get("text-optional")),!0);!n.collisionArrays&&d&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(d);const Z=(H,G,te)=>{for(let K=0;K<G/4;K++)H.opacityVertexArray.emplaceBack(te)};let W=0;for(let H=0;H<n.symbolInstances.length;H++){const G=n.symbolInstances.get(H),{numHorizontalGlyphVertices:te,numVerticalGlyphVertices:K,crossTileID:fe}=G;let he=this.opacities[fe];a[fe]?he=w:he||(he=X,this.opacities[fe]=he),a[fe]=!0;const oe=te>0||K>0,de=G.numIconVertices>0,le=this.placedOrientations[G.crossTileID],ye=le===s.WritingMode.vertical,Le=le===s.WritingMode.horizontal||le===s.WritingMode.horizontalOnly;if(!oe&&!de||he.isHidden()||W++,oe){const dt=Xo(he.text);Z(n.text,te,ye?Fr:dt),Z(n.text,K,Le?Fr:dt);const Ae=he.text.isHidden();[G.rightJustifiedTextSymbolIndex,G.centerJustifiedTextSymbolIndex,G.leftJustifiedTextSymbolIndex].forEach(wt=>{wt>=0&&(n.text.placedSymbolArray.get(wt).hidden=Ae||ye?1:0)}),G.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(G.verticalPlacedTextSymbolIndex).hidden=Ae||Le?1:0);const Je=this.variableOffsets[G.crossTileID];Je&&this.markUsedJustification(n,Je.anchor,G,le);const rt=this.placedOrientations[G.crossTileID];rt&&(this.markUsedJustification(n,"left",G,rt),this.markUsedOrientation(n,rt,G))}if(de){const dt=Xo(he.icon);G.placedIconSymbolIndex>=0&&(Z(n.icon,G.numIconVertices,ye?Fr:dt),n.icon.placedSymbolArray.get(G.placedIconSymbolIndex).hidden=he.icon.isHidden()),G.verticalPlacedIconSymbolIndex>=0&&(Z(n.icon,G.numVerticalIconVertices,Le?Fr:dt),n.icon.placedSymbolArray.get(G.verticalPlacedIconSymbolIndex).hidden=he.icon.isHidden())}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const dt=n.collisionArrays[H];if(dt){let Ae=new s.pointGeometry(0,0),Je=!0;if(dt.textBox||dt.verticalTextBox){if(k){const wt=this.variableOffsets[fe];wt?(Ae=Pn(wt.anchor,wt.width,wt.height,wt.textOffset,wt.textScale),z&&Ae._rotate(R?this.transform.angle:-this.transform.angle)):Je=!1}g&&(Je=!he.clipped),dt.textBox&&Er(n.textCollisionBox.collisionVertexArray,he.text.placed,!Je||ye,Ae.x,Ae.y),dt.verticalTextBox&&Er(n.textCollisionBox.collisionVertexArray,he.text.placed,!Je||Le,Ae.x,Ae.y)}const rt=Je&&Boolean(!Le&&dt.verticalIconBox);dt.iconBox&&Er(n.iconCollisionBox.collisionVertexArray,he.icon.placed,rt,j?Ae.x:0,j?Ae.y:0),dt.verticalIconBox&&Er(n.iconCollisionBox.collisionVertexArray,he.icon.placed,!rt,j?Ae.x:0,j?Ae.y:0)}}}if(n.fullyClipped=W===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const H=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=H.invProjMatrix,n.placementViewportMatrix=H.viewportMatrix,n.collisionCircleArray=H.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,a){const d=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*d>n}setStale(){this.stale=!0}}function Er(c,n,a,d,_){c.emplaceBack(n?1:0,a?1:0,d||0,_||0),c.emplaceBack(n?1:0,a?1:0,d||0,_||0),c.emplaceBack(n?1:0,a?1:0,d||0,_||0),c.emplaceBack(n?1:0,a?1:0,d||0,_||0)}const va=Math.pow(2,25),yl=Math.pow(2,24),wp=Math.pow(2,17),Nc=Math.pow(2,16),Es=Math.pow(2,9),Tp=Math.pow(2,8),jh=Math.pow(2,1);function Xo(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;const n=c.placed?1:0,a=Math.floor(127*c.opacity);return a*va+n*yl+a*wp+n*Nc+a*Es+n*Tp+a*jh+n}const Fr=0;class vl{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(n,a,d,_,g){const w=this._bucketParts;for(;this._currentTileIndex<n.length;)if(a.getBucketParts(w,_,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((T,C)=>T.sortKey-C.sortKey));this._currentPartIndex<w.length;){const T=w[this._currentPartIndex];if(a.placeLayerBucketPart(T,this._seenCrossTileIDs,d,T.symbolInstanceStart===0),this._currentPartIndex++,g())return!0}return!1}}class Co{constructor(n,a,d,_,g,w,T,C){this.placement=new Uc(n,g,w,T,C),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(n,a,d){const _=s.exported.now(),g=()=>{const w=s.exported.now()-_;return!this._forceFullPlacement&&w>2};for(;this._currentPlacementIndex>=0;){const w=a[n[this._currentPlacementIndex]],T=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=T)&&(!w.maxzoom||w.maxzoom>T)){if(this._inProgressLayer||(this._inProgressLayer=new vl(w)),this._inProgressLayer.continuePlacement(d[w.source],this.placement,this._showCollisionBoxes,w,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const jc=512/s.EXTENT/2;class xl{constructor(n,a,d){this.tileID=n,this.indexedSymbolInstances={},this.bucketInstanceId=d;for(let _=0;_<a.length;_++){const g=a.get(_),w=g.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:g.crossTileID,coord:this.getScaledCoordinates(g,n)})}}getScaledCoordinates(n,a){const d=jc/Math.pow(2,a.canonical.z-this.tileID.canonical.z);return{x:Math.floor((a.canonical.x*s.EXTENT+n.tileAnchorX)*d),y:Math.floor((a.canonical.y*s.EXTENT+n.tileAnchorY)*d)}}findMatches(n,a,d){const _=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let g=0;g<n.length;g++){const w=n.get(g);if(w.crossTileID)continue;const T=this.indexedSymbolInstances[w.key];if(!T)continue;const C=this.getScaledCoordinates(w,a);for(const k of T)if(Math.abs(k.coord.x-C.x)<=_&&Math.abs(k.coord.y-C.y)<=_&&!d[k.crossTileID]){d[k.crossTileID]=!0,w.crossTileID=k.crossTileID;break}}}}class Ep{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Sp{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const a=Math.round((n-this.lng)/360);if(a!==0)for(const d in this.indexes){const _=this.indexes[d],g={};for(const w in _){const T=_[w];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+a),g[T.tileID.key]=T}this.indexes[d]=g}this.lng=n}addBucket(n,a,d){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let g=0;g<a.symbolInstances.length;g++)a.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});const _=this.usedCrossTileIDs[n.overscaledZ];for(const g in this.indexes){const w=this.indexes[g];if(Number(g)>n.overscaledZ)for(const T in w){const C=w[T];C.tileID.isChildOf(n)&&C.findMatches(a.symbolInstances,n,_)}else{const T=w[n.scaledTo(Number(g)).key];T&&T.findMatches(a.symbolInstances,n,_)}}for(let g=0;g<a.symbolInstances.length;g++){const w=a.symbolInstances.get(g);w.crossTileID||(w.crossTileID=d.generate(),_[w.crossTileID]=!0)}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new xl(n,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(n,a){for(const d in a.indexedSymbolInstances)for(const _ of a.indexedSymbolInstances[d])delete this.usedCrossTileIDs[n][_.crossTileID]}removeStaleBuckets(n){let a=!1;for(const d in this.indexes){const _=this.indexes[d];for(const g in _)n[_[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,_[g]),delete _[g],a=!0)}return a}}class bl{constructor(){this.layerIndexes={},this.crossTileIDs=new Ep,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,a,d,_){let g=this.layerIndexes[n.id];g===void 0&&(g=this.layerIndexes[n.id]=new Sp);let w=!1;const T={};_.name!=="globe"&&g.handleWrapJump(d);for(const C of a){const k=C.getBucket(n);k&&n.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(C.tileID,k,this.crossTileIDs)&&(w=!0),T[k.bucketInstanceId]=!0)}return g.removeStaleBuckets(T)&&(w=!0),w}pruneUnusedLayers(n){const a={};n.forEach(d=>{a[d]=!0});for(const d in this.layerIndexes)a[d]||delete this.layerIndexes[d]}}const wl=(c,n)=>s.emitValidationErrors(c,n&&n.filter(a=>a.identifier!=="source.canvas")),qh=s.pick(Ze,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Cp=s.pick(Ze,["setCenter","setZoom","setBearing","setPitch"]),$h={version:8,layers:[],sources:{}},Ap={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Sr extends s.Evented{constructor(n,a={}){super(),this.map=n,this.dispatcher=new Lt(Pi(),this),this.imageManager=new nt,this.imageManager.setEventedParent(this),this.glyphManager=new s.GlyphManager(n._requestManager,a.localFontFamily?s.LocalGlyphMode.all:a.localIdeographFontFamily?s.LocalGlyphMode.ideographs:s.LocalGlyphMode.none,a.localFontFamily||a.localIdeographFontFamily),this.lineAtlas=new s.LineAtlas(256,512),this.crossTileSymbolIndex=new bl,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new s.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());const d=this;this._rtlTextPluginCallback=Sr.registerForPluginStateChange(_=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(g,w)=>{if(s.triggerPluginCompletionEvent(g),w&&w.every(T=>T))for(const T in d._sourceCaches){const C=d._sourceCaches[T],k=C.getSource().type;k!=="vector"&&k!=="geojson"||C.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const g=this.getSource(_.sourceId);if(g&&g.vectorLayerIds)for(const w in this._layers){const T=this._layers[w];T.source===g.id&&this._validateLayer(T)}})}loadURL(n,a={}){this.fire(new s.Event("dataloading",{dataType:"style"}));const d=typeof a.validate=="boolean"?a.validate:!s.isMapboxURL(n);n=this.map._requestManager.normalizeStyleURL(n,a.accessToken);const _=this.map._requestManager.transformRequest(n,s.ResourceType.Style);this._request=s.getJSON(_,(g,w)=>{this._request=null,g?this.fire(new s.ErrorEvent(g)):w&&this._load(w,d)})}loadJSON(n,a={}){this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.exported.frame(()=>{this._request=null,this._load(n,a.validate!==!1)})}loadEmpty(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load($h,!1)}_updateLayerCount(n,a){const d=a?1:-1;n.is3D()&&(this._num3DLayers+=d),n.type==="circle"&&(this._numCircleLayers+=d),n.type==="symbol"&&(this._numSymbolLayers+=d)}_load(n,a){if(a&&wl(this,s.validateStyle(n)))return;this._loaded=!0,this.stylesheet=s.clone$1(n),this._updateMapProjection();for(const _ in n.sources)this.addSource(_,n.sources[_],{validate:!1});this._changed=!1,n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(n.glyphs);const d=vt(this.stylesheet.layers);this._order=d.map(_=>_.id),this._layers={},this._serializedLayers={};for(let _ of d)_=s.createStyleLayer(_),_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ke(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(n){this._spriteRequest=function(a,d,_){let g,w,T;const C=s.exported.devicePixelRatio>1?"@2x":"";let k=s.getJSON(d.transformRequest(d.normalizeSpriteURL(a,C,".json"),s.ResourceType.SpriteJSON),(j,X)=>{k=null,T||(T=j,g=X,R())}),z=s.getImage(d.transformRequest(d.normalizeSpriteURL(a,C,".png"),s.ResourceType.SpriteImage),(j,X)=>{z=null,T||(T=j,w=X,R())});function R(){if(T)_(T);else if(g&&w){const j=s.exported.getImageData(w),X={};for(const Z in g){const{width:W,height:H,x:G,y:te,sdf:K,pixelRatio:fe,stretchX:he,stretchY:oe,content:de}=g[Z],le=new s.RGBAImage({width:W,height:H});s.RGBAImage.copy(j,le,{x:G,y:te},{x:0,y:0},{width:W,height:H}),X[Z]={data:le,pixelRatio:fe,sdf:K,stretchX:he,stretchY:oe,content:de}}_(null,X)}}return{cancel(){k&&(k.cancel(),k=null),z&&(z.cancel(),z=null)}}}(n,this.map._requestManager,(a,d)=>{if(this._spriteRequest=null,a)this.fire(new s.ErrorEvent(a));else if(d)for(const _ in d)this.imageManager.addImage(_,d[_]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new s.Event("data",{dataType:"style"}))})}_validateLayer(n){const a=this.getSource(n.source);if(!a)return;const d=n.sourceLayer;d&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(d)===-1)&&this.fire(new s.ErrorEvent(new Error(`Source layer "${d}" does not exist on source "${a.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(n){const a=[];for(const d of n){const _=this._layers[d];_.type!=="custom"&&a.push(_.serialize())}return a}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(n){return!!this.terrain&&Ap[n.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(n){if(!this._loaded)return;const a=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(_.length||g.length)&&this._updateWorkerLayers(_,g);for(const w in this._updatedSources){const T=this._updatedSources[w];T==="reload"?this._reloadSource(w):T==="clear"&&this._clearSource(w)}this._updateTilesForChangedImages();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(n);this.light.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._resetUpdates()}const d={};for(const _ in this._sourceCaches){const g=this._sourceCaches[_];d[_]=g.used,g.used=!1}for(const _ of this._order){const g=this._layers[_];if(g.recalculate(n,this._availableImages),!g.isHidden(n.zoom)){const T=this._getLayerSourceCache(g);T&&(T.used=!0)}const w=this.map.painter;if(w){const T=g.getProgramIds();if(!T)continue;const C=g.getProgramConfiguration(n.zoom);for(const k of T)w.useProgram(k,C)}}for(const _ in d){const g=this._sourceCaches[_];d[_]!==g.used&&g.getSource().fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:g.getSource().id}))}this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),a&&this.fire(new s.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const a in this._sourceCaches)this._sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateWorkerLayers(n,a){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(n){if(this._checkLoaded(),wl(this,s.validateStyle(n)))return!1;(n=s.clone$1(n)).layers=vt(n.layers);const a=function(_,g){if(!_)return[{command:Ze.setStyle,args:[g]}];let w=[];try{if(!D(_.version,g.version))return[{command:Ze.setStyle,args:[g]}];D(_.center,g.center)||w.push({command:Ze.setCenter,args:[g.center]}),D(_.zoom,g.zoom)||w.push({command:Ze.setZoom,args:[g.zoom]}),D(_.bearing,g.bearing)||w.push({command:Ze.setBearing,args:[g.bearing]}),D(_.pitch,g.pitch)||w.push({command:Ze.setPitch,args:[g.pitch]}),D(_.sprite,g.sprite)||w.push({command:Ze.setSprite,args:[g.sprite]}),D(_.glyphs,g.glyphs)||w.push({command:Ze.setGlyphs,args:[g.glyphs]}),D(_.transition,g.transition)||w.push({command:Ze.setTransition,args:[g.transition]}),D(_.light,g.light)||w.push({command:Ze.setLight,args:[g.light]}),D(_.fog,g.fog)||w.push({command:Ze.setFog,args:[g.fog]}),D(_.projection,g.projection)||w.push({command:Ze.setProjection,args:[g.projection]});const T={},C=[];(function(R,j,X,Z){let W;for(W in j=j||{},R=R||{})R.hasOwnProperty(W)&&(j.hasOwnProperty(W)||wi(W,X,Z));for(W in j)j.hasOwnProperty(W)&&(R.hasOwnProperty(W)?D(R[W],j[W])||(R[W].type==="geojson"&&j[W].type==="geojson"&&$i(R,j,W)?X.push({command:Ze.setGeoJSONSourceData,args:[W,j[W].data]}):ni(W,j,X,Z)):Ce(W,j,X))})(_.sources,g.sources,C,T);const k=[];_.layers&&_.layers.forEach(R=>{R.source&&T[R.source]?w.push({command:Ze.removeLayer,args:[R.id]}):k.push(R)});let z=_.terrain;z&&T[z.source]&&(w.push({command:Ze.setTerrain,args:[void 0]}),z=void 0),w=w.concat(C),D(z,g.terrain)||w.push({command:Ze.setTerrain,args:[g.terrain]}),function(R,j,X){j=j||[];const Z=(R=R||[]).map(Kn),W=j.map(Kn),H=R.reduce(_l,{}),G=j.reduce(_l,{}),te=Z.slice(),K=Object.create(null);let fe,he,oe,de,le,ye,Le;for(fe=0,he=0;fe<Z.length;fe++)oe=Z[fe],G.hasOwnProperty(oe)?he++:(X.push({command:Ze.removeLayer,args:[oe]}),te.splice(te.indexOf(oe,he),1));for(fe=0,he=0;fe<W.length;fe++)oe=W[W.length-1-fe],te[te.length-1-fe]!==oe&&(H.hasOwnProperty(oe)?(X.push({command:Ze.removeLayer,args:[oe]}),te.splice(te.lastIndexOf(oe,te.length-he),1)):he++,ye=te[te.length-fe],X.push({command:Ze.addLayer,args:[G[oe],ye]}),te.splice(te.length-fe,0,oe),K[oe]=!0);for(fe=0;fe<W.length;fe++)if(oe=W[fe],de=H[oe],le=G[oe],!K[oe]&&!D(de,le))if(D(de.source,le.source)&&D(de["source-layer"],le["source-layer"])&&D(de.type,le.type)){for(Le in Cn(de.layout,le.layout,X,oe,null,Ze.setLayoutProperty),Cn(de.paint,le.paint,X,oe,null,Ze.setPaintProperty),D(de.filter,le.filter)||X.push({command:Ze.setFilter,args:[oe,le.filter]}),D(de.minzoom,le.minzoom)&&D(de.maxzoom,le.maxzoom)||X.push({command:Ze.setLayerZoomRange,args:[oe,le.minzoom,le.maxzoom]}),de)de.hasOwnProperty(Le)&&Le!=="layout"&&Le!=="paint"&&Le!=="filter"&&Le!=="metadata"&&Le!=="minzoom"&&Le!=="maxzoom"&&(Le.indexOf("paint.")===0?Cn(de[Le],le[Le],X,oe,Le.slice(6),Ze.setPaintProperty):D(de[Le],le[Le])||X.push({command:Ze.setLayerProperty,args:[oe,Le,le[Le]]}));for(Le in le)le.hasOwnProperty(Le)&&!de.hasOwnProperty(Le)&&Le!=="layout"&&Le!=="paint"&&Le!=="filter"&&Le!=="metadata"&&Le!=="minzoom"&&Le!=="maxzoom"&&(Le.indexOf("paint.")===0?Cn(de[Le],le[Le],X,oe,Le.slice(6),Ze.setPaintProperty):D(de[Le],le[Le])||X.push({command:Ze.setLayerProperty,args:[oe,Le,le[Le]]}))}else X.push({command:Ze.removeLayer,args:[oe]}),ye=te[te.lastIndexOf(oe)+1],X.push({command:Ze.addLayer,args:[le,ye]})}(k,g.layers,w)}catch(T){console.warn("Unable to compute style diff:",T),w=[{command:Ze.setStyle,args:[g]}]}return w}(this.serialize(),n).filter(_=>!(_.command in Cp));if(a.length===0)return!1;const d=a.filter(_=>!(_.command in qh));if(d.length>0)throw new Error(`Unimplemented: ${d.map(_=>_.command).join(", ")}.`);return a.forEach(_=>{_.command!=="setTransition"&&_.command!=="setProjection"&&this[_.command].apply(this,_.args)}),this.stylesheet=n,this._updateMapProjection(),!0}addImage(n,a){return this.getImage(n)?this.fire(new s.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,a),this._afterImageUpdated(n),this)}updateImage(n,a){this.imageManager.updateImage(n,a)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n),this._afterImageUpdated(n),this):this.fire(new s.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(n,a,d={}){if(this._checkLoaded(),this.getSource(n)!==void 0)throw new Error("There is already a source with this ID");if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(s.validateSource,`sources.${n}`,a,null,d))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const _=Ie(n,a,this.dispatcher,this);_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(n),source:_.serialize(),sourceId:n}));const g=w=>{const T=(w?"symbol:":"other:")+n,C=this._sourceCaches[T]=new s.SourceCache(T,_,w);(w?this._symbolSourceCaches:this._otherSourceCaches)[n]=C,C.style=this,C.onAdd(this.map)};g(!1),a.type!=="vector"&&a.type!=="geojson"||g(!0),_.onAdd&&_.onAdd(this.map),this._changed=!0}removeSource(n){this._checkLoaded();const a=this.getSource(n);if(!a)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===n)return this.fire(new s.ErrorEvent(new Error(`Source "${n}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.get().source===n)return this.fire(new s.ErrorEvent(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const d=this._getSourceCaches(n);for(const _ of d)delete this._sourceCaches[_.id],delete this._updatedSources[_.id],_.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles();return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(n,a){this._checkLoaded(),this.getSource(n).setData(a),this._changed=!0}getSource(n){const a=this._getSourceCache(n);return a&&a.getSource()}addLayer(n,a,d={}){this._checkLoaded();const _=n.id;if(this.getLayer(_))return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${_}" already exists on this map`)));let g;if(n.type==="custom"){if(wl(this,s.validateCustomStyleLayer(n)))return;g=s.createStyleLayer(n)}else{if(typeof n.source=="object"&&(this.addSource(_,n.source),n=s.clone$1(n),n=s.extend(n,{source:_})),this._validate(s.validateLayer,`layers.${_}`,n,{arrayIndex:-1},d))return;g=s.createStyleLayer(n),this._validateLayer(g),g.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[g.id]=g.serialize(),this._updateLayerCount(g,!0)}const w=a?this._order.indexOf(a):this._order.length;if(a&&w===-1)return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${a}" does not exist on this map.`)));this._order.splice(w,0,_),this._layerOrderChanged=!0,this._layers[_]=g;const T=this._getLayerSourceCache(g);if(this._removedLayers[_]&&g.source&&T&&g.type!=="custom"){const C=this._removedLayers[_];delete this._removedLayers[_],C.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",T.pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(n,a){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===a)return;const d=this._order.indexOf(n);this._order.splice(d,1);const _=a?this._order.indexOf(a):this._order.length;a&&_===-1?this.fire(new s.ErrorEvent(new Error(`Layer with id "${a}" does not exist on this map.`))):(this._order.splice(_,0,n),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(n){this._checkLoaded();const a=this._layers[n];if(!a)return void this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be removed.`)));a.setEventedParent(null),this._updateLayerCount(a,!1);const d=this._order.indexOf(n);this._order.splice(d,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=a,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],a.onRemove&&a.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(n){return this._layers[n]}hasLayer(n){return n in this._layers}hasLayerType(n){for(const a in this._layers)if(this._layers[a].type===n)return!0;return!1}setLayerZoomRange(n,a,d){this._checkLoaded();const _=this.getLayer(n);_?_.minzoom===a&&_.maxzoom===d||(a!=null&&(_.minzoom=a),d!=null&&(_.maxzoom=d),this._updateLayer(_)):this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(n,a,d={}){this._checkLoaded();const _=this.getLayer(n);if(_){if(!D(_.filter,a))return a==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(s.validateFilter,`layers.${_.id}.filter`,a,{layerType:_.type},d)||(_.filter=s.clone$1(a),this._updateLayer(_)))}else this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be filtered.`)))}getFilter(n){const a=this.getLayer(n);return a&&s.clone$1(a.filter)}setLayoutProperty(n,a,d,_={}){this._checkLoaded();const g=this.getLayer(n);g?D(g.getLayoutProperty(a),d)||(g.setLayoutProperty(a,d,_),this._updateLayer(g)):this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(n,a){const d=this.getLayer(n);if(d)return d.getLayoutProperty(a);this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style.`)))}setPaintProperty(n,a,d,_={}){this._checkLoaded();const g=this.getLayer(n);g?D(g.getPaintProperty(a),d)||(g.setPaintProperty(a,d,_)&&this._updateLayer(g),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(n,a){const d=this.getLayer(n);return d&&d.getPaintProperty(a)}setFeatureState(n,a){this._checkLoaded();const d=n.source,_=n.sourceLayer,g=this.getSource(d);if(!g)return void this.fire(new s.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)));const w=g.type;if(w==="geojson"&&_)return void this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(w==="vector"&&!_)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided.")));const T=this._getSourceCaches(d);for(const C of T)C.setFeatureState(_,n.id,a)}removeFeatureState(n,a){this._checkLoaded();const d=n.source,_=this.getSource(d);if(!_)return void this.fire(new s.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)));const g=_.type,w=g==="vector"?n.sourceLayer:void 0;if(g==="vector"&&!w)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const T=this._getSourceCaches(d);for(const C of T)C.removeFeatureState(w,n.id,a)}getFeatureState(n){this._checkLoaded();const a=n.source,d=n.sourceLayer,_=this.getSource(a);if(_){if(_.type!=="vector"||d)return n.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(a)[0].getFeatureState(d,n.id);this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const n={};for(const a in this._sourceCaches){const d=this._sourceCaches[a].getSource();n[d.id]||(n[d.id]=d.serialize())}return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:n,layers:this._serializeLayers(this._order)},a=>a!==void 0)}_updateLayer(n){this._updatedLayers[n.id]=!0;const a=this._getLayerSourceCache(n);n.source&&!this._updatedSources[n.source]&&a&&a.getSource().type!=="raster"&&(this._updatedSources[n.source]="reload",a.pause()),this._changed=!0,n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const a=w=>this._layers[w].type==="fill-extrusion",d={},_=[];for(let w=this._order.length-1;w>=0;w--){const T=this._order[w];if(a(T)){d[T]=w;for(const C of n){const k=C[T];if(k)for(const z of k)_.push(z)}}}_.sort((w,T)=>T.intersectionZ-w.intersectionZ);const g=[];for(let w=this._order.length-1;w>=0;w--){const T=this._order[w];if(a(T))for(let C=_.length-1;C>=0;C--){const k=_[C].feature;if(d[k.layer.id]<w)break;g.push(k),_.pop()}else for(const C of n){const k=C[T];if(k)for(const z of k)g.push(z.feature)}}return g}queryRenderedFeatures(n,a,d){a&&a.filter&&this._validate(s.validateFilter,"queryRenderedFeatures.filter",a.filter,null,a);const _={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const C of a.layers){const k=this._layers[C];if(!k)return this.fire(new s.ErrorEvent(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];_[k.source]=!0}}const g=[];a.availableImages=this._availableImages;const w=a&&a.layers?a.layers.some(C=>{const k=this.getLayer(C);return k&&k.is3D()}):this.has3DLayers(),T=Si.createFromScreenPoints(n,d);for(const C in this._sourceCaches){const k=this._sourceCaches[C].getSource().id;a.layers&&!_[k]||g.push(Ct(this._sourceCaches[C],this._layers,this._serializedLayers,T,a,d,w,!!this.map._showQueryGeometry))}return this.placement&&g.push(function(C,k,z,R,j,X,Z){const W={},H=X.queryRenderedSymbols(R),G=[];for(const te of Object.keys(H).map(Number))G.push(Z[te]);G.sort($t);for(const te of G){const K=te.featureIndex.lookupSymbolFeatures(H[te.bucketInstanceId],k,te.bucketIndex,te.sourceLayerIndex,j.filter,j.layers,j.availableImages,C);for(const fe in K){const he=W[fe]=W[fe]||[],oe=K[fe];oe.sort((de,le)=>{const ye=te.featureSortOrder;if(ye){const Le=ye.indexOf(de.featureIndex);return ye.indexOf(le.featureIndex)-Le}return le.featureIndex-de.featureIndex});for(const de of oe)he.push(de)}}for(const te in W)W[te].forEach(K=>{const fe=K.feature,he=z(C[te]).getFeatureState(fe.layer["source-layer"],fe.id);fe.source=fe.layer.source,fe.layer["source-layer"]&&(fe.sourceLayer=fe.layer["source-layer"]),fe.state=he});return W}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),T.screenGeometry,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(n,a){a&&a.filter&&this._validate(s.validateFilter,"querySourceFeatures.filter",a.filter,null,a);const d=this._getSourceCaches(n);let _=[];for(const g of d)_=_.concat(st(g,a));return _}addSourceType(n,a,d){return Sr.getSourceType(n)?d(new Error(`A source type called "${n}" already exists.`)):(Sr.setSourceType(n,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:a.workerSourceURL},d):d(null,null))}getLight(){return this.light.getLight()}setLight(n,a={}){this._checkLoaded();const d=this.light.getLight();let _=!1;for(const w in n)if(!D(n[w],d[w])){_=!0;break}if(!_)return;const g=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(n,a),this.light.updateTransitions(g)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,a=1){if(this._checkLoaded(),!n)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(a===1){if(typeof n.source=="object"){const d="terrain-dem-src";this.addSource(d,n.source),n=s.clone$1(n),n=s.extend(n,{source:d})}if(this._validate(s.validateTerrain,"terrain",n))return}if(!this.terrain||this.terrain&&a!==this.terrain.drapeRenderMode)this._createTerrain(n,a);else{const d=this.terrain,_=d.get();for(const g of Object.keys(s.spec.terrain))!n.hasOwnProperty(g)&&s.spec.terrain[g].default&&(n[g]=s.spec.terrain[g].default);for(const g in n)if(!D(n[g],_[g])){d.set(n),this.stylesheet.terrain=n;const w=this._setTransitionParameters({duration:0});d.updateTransitions(w);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const a=this.fog=new xt(n,this.map.transform);this.stylesheet.fog=n;const d=this._setTransitionParameters({duration:0});a.updateTransitions(d)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog,d=a.get();Object.keys(n).length===0&&a.set(n);for(const _ in n)if(!D(n[_],d[_])){a.set(n),this.stylesheet.fog=n;const g=this._setTransitionParameters({duration:0});a.updateTransitions(g);break}}else this._createFog(n);this._markersNeedUpdate=!0}_setTransitionParameters(n){return{now:s.exported.now(),transition:s.extend(n,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const n=this._order.filter(d=>this.isLayerDraped(this._layers[d])),a=this._order.filter(d=>!this.isLayerDraped(this._layers[d]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...a)}_createTerrain(n,a){const d=this.terrain=new ot(n,a);this.stylesheet.terrain=n,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const _=this._setTransitionParameters({duration:0});d.updateTransitions(_)}_force3DLayerUpdate(){for(const n in this._layers){const a=this._layers[n];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const a=this._layers[n];a.type==="symbol"&&this._updateLayer(a)}}_validate(n,a,d,_,g={}){return(!g||g.validate!==!1)&&wl(this,n.call(s.validateStyle,s.extend({key:a,style:this.serialize(),value:d,styleSpec:s.spec},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this._sourceCaches)this._sourceCaches[n].clearTiles(),this._sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(n){const a=this._getSourceCaches(n);for(const d of a)d.clearTiles()}_reloadSource(n){const a=this._getSourceCaches(n);for(const d of a)d.resume(),d.reload()}_updateSources(n){for(const a in this._sourceCaches)this._sourceCaches[a].update(n)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const a=this._sourceCaches[n];a.resume(),a.reload()}}_updatePlacement(n,a,d,_,g=!1){let w=!1,T=!1;const C={};for(const k of this._order){const z=this._layers[k];if(z.type!=="symbol")continue;if(!C[z.source]){const j=this._getLayerSourceCache(z);if(!j)continue;C[z.source]=j.getRenderableIds(!0).map(X=>j.getTileByID(X)).sort((X,Z)=>Z.tileID.overscaledZ-X.tileID.overscaledZ||(X.tileID.isLessThan(Z.tileID)?-1:1))}const R=this.crossTileSymbolIndex.addLayer(z,C[z.source],n.center.lng,n.projection);w=w||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),g=g||this._layerOrderChanged||d===0,this._layerOrderChanged&&this.fire(new s.Event("neworder")),(g||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.exported.now(),n.zoom))&&(this.pauseablePlacement=new Co(n,this._order,g,a,d,_,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,C),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.exported.now()),T=!0),w&&this.pauseablePlacement.placement.setStale()),T||w)for(const k of this._order){const z=this._layers[k];z.type==="symbol"&&this.placement.updateLayerOpacities(z,C[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.exported.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,a,d){this.imageManager.getImages(a.icons,d),this._updateTilesForChangedImages();const _=g=>{g&&g.setDependencies(a.tileID.key,a.type,a.icons)};_(this._otherSourceCaches[a.source]),_(this._symbolSourceCaches[a.source])}getGlyphs(n,a,d){this.glyphManager.getGlyphs(a.stacks,d)}getResource(n,a,d){return s.makeRequest(a,d)}_getSourceCache(n){return this._otherSourceCaches[n]}_getLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}_getSourceCaches(n){const a=[];return this._otherSourceCaches[n]&&a.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&a.push(this._symbolSourceCaches[n]),a}_isSourceCacheLoaded(n){const a=this._getSourceCaches(n);return a.length===0?(this.fire(new s.ErrorEvent(new Error(`There is no source with ID '${n}'`))),!1):a.every(d=>d.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Sr.getSourceType=function(c){return ge[c]},Sr.setSourceType=function(c,n){ge[c]=n},Sr.registerForPluginStateChange=s.registerForPluginStateChange;var qc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,$c="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Gc=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Zc=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Ss=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let Tl={},Ko={};const Ao=[];Yo(qc,Ao),Yo(Gc,Ao),Yo(Zc,Ao),Yo(Ss,Ao),Tl=Di("",Gc),Ko=Di(Ss,Zc);const xa=Di(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),El=qc,Sl=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var Cl={background:Di(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Di(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Di(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);
#else 
mat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Di("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Di(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Di(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Di("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Di("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Di("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Di(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Di(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Di(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Di(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Di(`uniform lowp vec3 u_lightpos;varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
void main() {vec4 color=v_color;
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color_normal(color.xyz,normalize(v_normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying highp vec3 v_normal;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;vec3 pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_normal=normal;v_depth=gl_Position.w;
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Di(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Di(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Di(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Di(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
highp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);
#else
vec4 out_color=color;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Di(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Di(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Di(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
vec4 offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Di(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
vec4 offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Di(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Di(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Di(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Di(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,$c),skyboxGradient:Di(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,$c),skyboxCapture:Di(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Di(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);vec4 color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
vec4 color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;
#ifdef GLOBE_POLES
vec3 up_vector=normalize(globe_pos)*u_tile_up_scale;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Di(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);
#ifdef PROJECTION_GLOBE_VIEW
float globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));float horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
float horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Yo(c,n){const a=c.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let d of a)if(d=d.trim(),d[0]==="#"&&d.includes("if")&&!d.includes("endif")){d=d.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const _=d.split(" ");for(const g of _)n.includes(g)||n.push(g)}}function Di(c,n){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=n.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),_={},g=[...Ao];return Yo(c,g),Yo(n,g),{fragmentSource:c=c.replace(a,(w,T,C,k,z)=>(_[z]=!0,T==="define"?`
#ifndef HAS_UNIFORM_u_${z}
varying ${C} ${k} ${z};
#else
uniform ${C} ${k} u_${z};
#endif
`:`
#ifdef HAS_UNIFORM_u_${z}
    ${C} ${k} ${z} = u_${z};
#endif
`)),vertexSource:n=n.replace(a,(w,T,C,k,z)=>{const R=k==="float"?"vec2":"vec4",j=z.match(/color/)?"color":R;return _[z]?T==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
attribute ${C} ${R} a_${z};
varying ${C} ${k} ${z};
#else
uniform ${C} ${k} u_${z};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = a_${z};
#else
    ${C} ${k} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = unpack_mix_${j}(a_${z}, u_${z}_t);
#else
    ${C} ${k} ${z} = u_${z};
#endif
`:T==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
attribute ${C} ${R} a_${z};
#else
uniform ${C} ${k} u_${z};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${C} ${k} ${z} = a_${z};
#else
    ${C} ${k} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${C} ${k} ${z} = unpack_mix_${j}(a_${z}, u_${z}_t);
#else
    ${C} ${k} ${z} = u_${z};
#endif
`}),staticAttributes:d,usedDefines:g}}class Al{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,a,d,_,g,w,T){this.context=n;let C=this.boundPaintVertexBuffers.length!==_.length;for(let z=0;!C&&z<_.length;z++)this.boundPaintVertexBuffers[z]!==_[z]&&(C=!0);let k=this.boundDynamicVertexBuffers.length!==T.length;for(let z=0;!k&&z<T.length;z++)this.boundDynamicVertexBuffers[z]!==T[z]&&(k=!0);if(!n.extVertexArrayObject||!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==d||C||k||this.boundIndexBuffer!==g||this.boundVertexOffset!==w)this.freshBind(a,d,_,g,w,T);else{n.bindVertexArrayOES.set(this.vao);for(const z of T)z&&z.bind();g&&g.dynamicDraw&&g.bind()}}freshBind(n,a,d,_,g,w){let T;const C=n.numAttributes,k=this.context,z=k.gl;if(k.extVertexArrayObject)this.vao&&this.destroy(),this.vao=k.extVertexArrayObject.createVertexArrayOES(),k.bindVertexArrayOES.set(this.vao),T=0,this.boundProgram=n,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=_,this.boundVertexOffset=g,this.boundDynamicVertexBuffers=w;else{T=k.currentNumAttributes||0;for(let R=C;R<T;R++)z.disableVertexAttribArray(R)}a.enableAttributes(z,n),a.bind(),a.setVertexAttribPointers(z,n,g);for(const R of d)R.enableAttributes(z,n),R.bind(),R.setVertexAttribPointers(z,n,g);for(const R of w)R&&(R.enableAttributes(z,n),R.bind(),R.setVertexAttribPointers(z,n,g));_&&_.bind(),k.currentNumAttributes=C}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Wc(c,n){const a=Math.pow(2,n.canonical.z),d=n.canonical.y;return[new s.MercatorCoordinate(0,d/a).toLngLat().lat,new s.MercatorCoordinate(0,(d+1)/a).toLngLat().lat]}function Hc(c,n,a,d,_,g,w){const T=c.context,C=T.gl,k=a.fbo;if(!k)return;c.prepareDrawTile();const z=c.useProgram("hillshade");T.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,k.colorAttachment.get());const R=((W,H,G,te)=>{const K=G.paint.get("hillshade-shadow-color"),fe=G.paint.get("hillshade-highlight-color"),he=G.paint.get("hillshade-accent-color");let oe=G.paint.get("hillshade-illumination-direction")*(Math.PI/180);G.paint.get("hillshade-illumination-anchor")==="viewport"&&(oe-=W.transform.angle);const de=!W.options.moving;return{u_matrix:te||W.transform.calculateProjMatrix(H.tileID.toUnwrapped(),de),u_image:0,u_latrange:Wc(0,H.tileID),u_light:[G.paint.get("hillshade-exaggeration"),oe],u_shadow:K,u_highlight:fe,u_accent:he}})(c,a,d,c.terrain?n.projMatrix:null);c.prepareDrawProgram(T,z,n.toUnwrapped());const{tileBoundsBuffer:j,tileBoundsIndexBuffer:X,tileBoundsSegments:Z}=c.getTileBoundsBuffers(a);z.draw(T,C.TRIANGLES,_,g,w,s.CullFaceMode.disabled,R,d.id,j,X,Z)}function Ai(c,n,a){if(!n.needsDEMTextureUpload)return;const d=c.context,_=d.gl;d.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||c.getTileTexture(a.stride);const g=a.getPixels();n.demTexture?n.demTexture.update(g,{premultiply:!1}):n.demTexture=new s.Texture(d,g,_.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function Cs(c,n,a,d,_,g){const w=c.context,T=w.gl;if(!n.dem)return;const C=n.dem;if(w.activeTexture.set(T.TEXTURE1),Ai(c,n,C),!n.demTexture)return;n.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE);const k=C.dim;w.activeTexture.set(T.TEXTURE0);let z=n.fbo;if(!z){const Z=new s.Texture(w,{width:k,height:k,data:null},T.RGBA);Z.bind(T.LINEAR,T.CLAMP_TO_EDGE),z=n.fbo=w.createFramebuffer(k,k,!0),z.colorAttachment.set(Z.texture)}w.bindFramebuffer.set(z.framebuffer),w.viewport.set([0,0,k,k]);const{tileBoundsBuffer:R,tileBoundsIndexBuffer:j,tileBoundsSegments:X}=c.getMercatorTileBoundsBuffers();c.useProgram("hillshadePrepare").draw(w,T.TRIANGLES,d,_,g,s.CullFaceMode.disabled,((Z,W)=>{const H=W.stride,G=s.create();return s.ortho(G,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate(G,G,[0,-s.EXTENT,0]),{u_matrix:G,u_image:1,u_dimension:[H,H],u_zoom:Z.overscaledZ,u_unpack:W.unpackVector}})(n.tileID,C),a.id,R,j,X),n.needsHillshadePrepare=!1}const ba=c=>({u_matrix:new s.UniformMatrix4f(c),u_image0:new s.Uniform1i(c),u_skirt_height:new s.Uniform1f(c)}),Xc=(c,n)=>({u_matrix:c,u_image0:0,u_skirt_height:n}),Kc=(c,n,a,d,_,g,w,T,C,k,z,R,j,X)=>({u_proj_matrix:Float32Array.from(c),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(d),u_merc_matrix:a,u_zoom_transition:_,u_merc_center:g,u_image0:0,u_frustum_tl:w,u_frustum_tr:T,u_frustum_br:C,u_frustum_bl:k,u_globe_pos:z,u_globe_radius:R,u_viewport:j,u_grid_matrix:X?Float32Array.from(X):new Float32Array(9)});function Yc(c,n){return c!=null&&n!=null&&!(!c.hasData()||!n.hasData())&&c.demTexture!=null&&n.demTexture!=null&&c.tileID.key!==n.tileID.key}const Mo=new class{constructor(){this.operations={}}newMorphing(c,n,a,d,_){if(c in this.operations){const g=this.operations[c];g.to.tileID.key!==a.tileID.key&&(g.queued=a)}else this.operations[c]={startTime:d,phase:0,duration:_,from:n,to:a,queued:null}}getMorphValuesForProxy(c){if(!(c in this.operations))return null;const n=this.operations[c];return{from:n.from,to:n.to,phase:n.phase}}update(c){for(const n in this.operations){const a=this.operations[n];for(a.phase=(c-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,c)){delete this.operations[n];break}}}_nextOp(c,n){return!!c.queued&&(c.from=c.to,c.to=c.queued,c.queued=null,c.phase=0,c.startTime=n,!0)}_validOp(c){return c.from.hasData()&&c.to.hasData()}},wa={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Mp(c,n){const a=1<<c.z;return!n&&(c.x===0||c.x===a-1)||c.y===0||c.y===a-1}const Jc=c=>({u_matrix:c});function Ml(c,n,a,d,_){if(_>0){const g=s.exported.now(),w=(g-c.timeAdded)/_,T=n?(g-n.timeAdded)/_:-1,C=a.getSource(),k=d.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),z=!n||Math.abs(n.tileID.overscaledZ-k)>Math.abs(c.tileID.overscaledZ-k),R=z&&c.refreshedUponExpiration?1:s.clamp(z?w:1-T,0,1);return c.refreshedUponExpiration&&w>=1&&(c.refreshedUponExpiration=!1),n?{opacity:1,mix:1-R}:{opacity:R,mix:0}}return{opacity:1,mix:0}}class Qc extends s.SourceCache{constructor(n){const a={type:"raster-dem",maxzoom:n.transform.maxZoom},d=new Lt(Pi(),null),_=Ie("mock-dem",a,d,n.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,a){n.state="loaded",a(null)}}class eu extends s.SourceCache{constructor(n){const a=Ie("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new Lt(Pi(),null),n.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,a,d){if(n.freezeTileCoverage)return;this.transform=n;const _=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((g,w)=>{if(g[w.key]="",!this._tiles[w.key]){const T=new s.Tile(w,this._source.tileSize*w.overscaleFactor(),n.tileZoom);T.state="loaded",this._tiles[w.key]=T}return g},{});for(const g in this._tiles)g in _||(this.freeFBO(g),this._tiles[g].unloadVectorData(),delete this._tiles[g])}freeFBO(n){const a=this.proxyCachedFBO[n];if(a!==void 0){const d=Object.values(a);this.renderCachePool.push(...d),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Il extends s.OverscaledTileID{constructor(n,a,d){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=a,this.projMatrix=d}}class Gh extends s.Elevation{constructor(n,a){super(),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[d,_,g]=function(C){const k=new s.StructArrayLayout4i8,z=new s.StructArrayLayout3ui6,R=131;k.reserve(17161),z.reserve(33800);const j=s.EXTENT/128,X=s.EXTENT+j/2,Z=X+j;for(let H=-j;H<Z;H+=j)for(let G=-j;G<Z;G+=j){const te=G<0||G>X||H<0||H>X?24575:0,K=s.clamp(Math.round(G),0,s.EXTENT),fe=s.clamp(Math.round(H),0,s.EXTENT);k.emplaceBack(K+te,fe,K,fe)}const W=(H,G)=>{const te=G*R+H;z.emplaceBack(te+1,te,te+R),z.emplaceBack(te+R,te+R+1,te+1)};for(let H=1;H<129;H++)for(let G=1;G<129;G++)W(G,H);return[0,129].forEach(H=>{for(let G=0;G<130;G++)W(G,H),W(H,G)}),[k,z,32768]}(),w=n.context;this.gridBuffer=w.createVertexBuffer(d,s.boundsAttributes.members),this.gridIndexBuffer=w.createIndexBuffer(_),this.gridSegments=s.SegmentVector.simpleSegment(0,0,d.length,_.length),this.gridNoSkirtSegments=s.SegmentVector.simpleSegment(0,0,d.length,g),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new eu(a.map),this.orthoMatrix=s.create(),s.ortho(this.orthoMatrix,0,s.EXTENT,0,s.EXTENT,0,1);const T=w.gl;this._overlapStencilMode=new s.StencilMode({func:T.GEQUAL,mask:255},0,255,T.KEEP,T.KEEP,T.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Qc(a.map)}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),n.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=n,this._checkRenderCacheEfficiency()}update(n,a,d){if(n&&n.terrain){this._style!==n&&(this.style=n),this.enabled=!0;const _=n.terrain.properties;this.sourceCache=n.terrain.drapeRenderMode===0?this._mockSourceCache:n._getSourceCache(_.get("source")),this._exaggeration=_.get("exaggeration");const g=()=>{this.sourceCache.used&&s.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const w=this.getScaledDemTileSize();this.sourceCache.update(a,w,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,g(),this._initializing=!0),g(),a.updateElevation(!d),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const n=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||n.efficiency!==100&&s.warnOnce(`Terrain render cache efficiency is not optimal (${n.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${n.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._sourceCaches)this._style._sourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,d=this.painter.transform;this._initializing&&(this._initializing=d._centerAltitude===0&&this.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(d.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=a.getIds().map(C=>{const k=a.getTileByID(C).tileID;return k.projMatrix=d.calculateProjMatrix(k.toUnwrapped()),k});(function(C,k){const z=k.transform.pointCoordinate(k.transform.getCameraPoint()),R=new s.pointGeometry(z.x,z.y);C.sort((j,X)=>{if(X.overscaledZ-j.overscaledZ)return X.overscaledZ-j.overscaledZ;const Z=new s.pointGeometry(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),W=new s.pointGeometry(X.canonical.x+(1<<X.canonical.z)*X.wrap,X.canonical.y),H=R.mult(1<<j.canonical.z);return H.x-=.5,H.y-=.5,H.distSqr(Z)-H.distSqr(W)})})(_,this.painter),this._previousZoom=d.zoom;const g=this.proxyToSource||{};this.proxyToSource={},_.forEach(C=>{this.proxyToSource[C.key]={}}),this.terrainTileForTile={};const w=this._style._sourceCaches;for(const C in w){const k=w[C];if(!k.used||(k!==this.sourceCache&&this.resetTileLookupCache(k.id),this._setupProxiedCoordsForOrtho(k,n[C],g),k.usedForTerrain))continue;const z=n[C];k.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[a.id]=_.map(C=>new Il(C,C.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(g),this.renderingToTexture=!1,this._updateTimestamp=s.exported.now();const T={};this._visibleDemTiles=[];for(const C of this.proxyCoords){const k=this.terrainTileForTile[C.key];if(!k)continue;const z=k.tileID.key;z in T||(this._visibleDemTiles.push(k),T[z]=z)}}_assignTerrainTiles(n){this._initializing||n.forEach(a=>{if(this.terrainTileForTile[a.key])return;const d=this._findTileCoveringTileID(a,this.sourceCache);d&&(this.terrainTileForTile[a.key]=d)})}_prepareDEMTextures(){const n=this.painter.context,a=n.gl;for(const d in this.terrainTileForTile){const _=this.terrainTileForTile[d],g=_.dem;!g||_.demTexture&&!_.needsDEMTextureUpload||(n.activeTexture.set(a.TEXTURE1),Ai(this.painter,_,g))}}_prepareDemTileUniforms(n,a,d,_){if(!a||a.demTexture==null)return!1;const g=n.tileID.canonical,w=Math.pow(2,a.tileID.canonical.z-g.z),T=_||"";return d[`u_dem_tl${T}`]=[g.x*w%1,g.y*w%1],d[`u_dem_scale${T}`]=w,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,a=n.gl;if(!this._emptyDepthBufferTexture){const d=new s.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new s.Texture(n,d,a.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0;const a=this._visibleDemTiles.reduce((d,_)=>{if(!_.dem)return d;const g=_.dem.tree.minimums[0];return g>0&&n++,d+g},0);return n?a/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,a=n.gl;n.activeTexture.set(a.TEXTURE2);const d=this._getLoadedAreaMinimum(),_=new s.RGBAImage({width:1,height:1},new Uint8Array(s.DEMData.pack(d,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let g=this._emptyDEMTexture;return g?g.update(_,{premultiply:!1}):g=this._emptyDEMTexture=new s.Texture(n,_,a.RGBA,{premultiply:!1}),g}setupElevationDraw(n,a,d){const _=this.painter.context,g=_.gl,w=(T=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:s.DEMData.getUnpackVector(T),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var T;w.u_dem_size=this.sourceCache.getSource().tileSize,w.u_exaggeration=this.exaggeration();const C=this.painter.transform,k=C.projection,z=n.tileID.canonical;w.u_tile_tl_up=k.upVector(z,0,0),w.u_tile_tr_up=k.upVector(z,s.EXTENT,0),w.u_tile_br_up=k.upVector(z,s.EXTENT,s.EXTENT),w.u_tile_bl_up=k.upVector(z,0,s.EXTENT),w.u_tile_up_scale=d&&d.useDenormalizedUpVectorScale?s.GLOBE_METERS_TO_ECEF:k.upVectorScale(z,C.center.lat,C.worldSize).metersToTile;let R=null,j=null,X=1;if(d&&d.morphing&&this._useVertexMorphing){const Z=d.morphing.srcDemTile,W=d.morphing.dstDemTile;X=d.morphing.phase,Z&&W&&(this._prepareDemTileUniforms(n,Z,w,"_prev")&&(j=Z),this._prepareDemTileUniforms(n,W,w)&&(R=W))}if(j&&R?(_.activeTexture.set(g.TEXTURE2),R.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE,g.NEAREST),_.activeTexture.set(g.TEXTURE4),j.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE,g.NEAREST),w.u_dem_lerp=X):(R=this.terrainTileForTile[n.tileID.key],_.activeTexture.set(g.TEXTURE2),(this._prepareDemTileUniforms(n,R,w)?R.demTexture:this.emptyDEMTexture).bind(g.NEAREST,g.CLAMP_TO_EDGE)),_.activeTexture.set(g.TEXTURE3),d&&d.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),this._depthFBO&&(w.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),w.u_depth_size_inv=[1,1]),d&&d.useMeterToDem&&R){const Z=(1<<R.tileID.canonical.z)*s.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;w.u_meter_to_dem=Z}d&&d.labelPlaneMatrixInv&&(w.u_label_plane_matrix_inv=d.labelPlaneMatrixInv),a.setTerrainUniformValues(_,w)}renderToBackBuffer(n){const a=this.painter,d=this.painter.context;n.length!==0&&(d.bindFramebuffer.set(null),d.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,g,w,T,C){if(_.transform.projection.name==="globe")(function(k,z,R,j,X){const Z=k.context,W=Z.gl;let H,G;const te=k.options.showTerrainWireframe?2:0,K=k.transform,fe=s.globeUseCustomAntiAliasing(k,Z,K),he=(wt,je)=>{if(G===wt)return;const mt=[wa[wt],"PROJECTION_GLOBE_VIEW"];fe&&mt.push("CUSTOM_ANTIALIASING"),je&&mt.push(wa[te]),H=k.useProgram("globeRaster",null,mt),G=wt},oe=k.colorModeForRenderPass(),de=new s.DepthMode(W.LEQUAL,s.DepthMode.ReadWrite,k.depthRangeFor3D);Mo.update(X);const le=s.calculateGlobeMercatorMatrix(K),ye=[s.mercatorXfromLng(K.center.lng),s.mercatorYfromLat(K.center.lat)],Le=te?[!1,!0]:[!1],dt=k.globeSharedBuffers,Ae=[K.width*s.exported.devicePixelRatio,K.height*s.exported.devicePixelRatio],Je=Float32Array.from(K.globeMatrix),rt={useDenormalizedUpVectorScale:!0};if(Le.forEach(wt=>{G=-1;const je=wt?W.LINES:W.TRIANGLES;for(const mt of j){const it=R.getTile(mt),It=s.StencilMode.disabled,St=z.prevTerrainTileForTile[mt.key],Ot=z.terrainTileForTile[mt.key];Yc(St,Ot)&&Mo.newMorphing(mt.key,St,Ot,X,250),Z.activeTexture.set(W.TEXTURE0),it.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);const Wt=Mo.getMorphValuesForProxy(mt.key),ii=Wt?1:0;Wt&&s.extend$1(rt,{morphing:{srcDemTile:Wt.from,dstDemTile:Wt.to,phase:s.easeCubicInOut(Wt.phase)}});const xi=s.tileCornersToBounds(mt.canonical),Vt=s.getLatitudinalLod(xi.getCenter().lat),ai=s.getGridMatrix(mt.canonical,xi,Vt),Mi=s.globeNormalizeECEF(s.globeTileBounds(mt.canonical)),Qi=Kc(K.projMatrix,Je,le,Mi,s.globeToMercatorTransition(K.zoom),ye,K.frustumCorners.TL,K.frustumCorners.TR,K.frustumCorners.BR,K.frustumCorners.BL,K.globeCenterInViewSpace,K.globeRadius,Ae,ai);if(he(ii,wt),z.setupElevationDraw(it,H,rt),k.prepareDrawProgram(Z,H,mt.toUnwrapped()),dt){const[hn,ji,Fn]=wt?dt.getWirefameBuffers(k.context,Vt):dt.getGridBuffers(Vt);H.draw(Z,je,de,It,oe,s.CullFaceMode.backCCW,Qi,"globe_raster",hn,ji,Fn)}}}),dt){const wt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];fe&&wt.push("CUSTOM_ANTIALIASING"),H=k.useProgram("globeRaster",null,wt);for(const je of j){const{x:mt,y:it,z:It}=je.canonical,St=it===0,Ot=it===(1<<It)-1,[Wt,ii,xi,Vt]=dt.getPoleBuffers(It);if(Vt&&(St||Ot)){const ai=R.getTile(je);Z.activeTexture.set(W.TEXTURE0),ai.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);let Mi=s.globePoleMatrixForTile(It,mt,K);const Qi=s.globeNormalizeECEF(s.globeTileBounds(je.canonical)),hn=(ji,Fn)=>ji.draw(Z,W.TRIANGLES,de,s.StencilMode.disabled,oe,s.CullFaceMode.disabled,Kc(K.projMatrix,Mi,Mi,Qi,0,ye,K.frustumCorners.TL,K.frustumCorners.TR,K.frustumCorners.BR,K.frustumCorners.BL,K.globeCenterInViewSpace,K.globeRadius,Ae),"globe_pole_raster",Fn,xi,Vt);z.setupElevationDraw(ai,H,rt),k.prepareDrawProgram(Z,H,je.toUnwrapped()),St&&hn(H,Wt),Ot&&(Mi=s.scale(s.create(),Mi,[1,-1,1]),hn(H,ii))}}}})(_,g,w,T,C);else{const k=_.context,z=k.gl;let R,j;const X=_.options.showTerrainWireframe?2:0,Z=(K,fe)=>{if(j===K)return;const he=[wa[K]];fe&&he.push(wa[X]),R=_.useProgram("terrainRaster",null,he),j=K},W=_.colorModeForRenderPass(),H=new s.DepthMode(z.LEQUAL,s.DepthMode.ReadWrite,_.depthRangeFor3D);Mo.update(C);const G=_.transform,te=6*Math.pow(1.5,22-G.zoom)*g.exaggeration();(X?[!1,!0]:[!1]).forEach(K=>{j=-1;const fe=K?z.LINES:z.TRIANGLES,[he,oe]=K?g.getWirefameBuffer():[g.gridIndexBuffer,g.gridSegments];for(const de of T){const le=w.getTile(de),ye=s.StencilMode.disabled,Le=g.prevTerrainTileForTile[de.key],dt=g.terrainTileForTile[de.key];Yc(Le,dt)&&Mo.newMorphing(de.key,Le,dt,C,250),k.activeTexture.set(z.TEXTURE0),le.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST);const Ae=Mo.getMorphValuesForProxy(de.key),Je=Ae?1:0;let rt;Ae&&(rt={morphing:{srcDemTile:Ae.from,dstDemTile:Ae.to,phase:s.easeCubicInOut(Ae.phase)}});const wt=Xc(de.projMatrix,Mp(de.canonical,G.renderWorldCopies)?te/10:te);Z(Je,K),g.setupElevationDraw(le,R,rt),_.prepareDrawProgram(k,R,de.toUnwrapped()),R.draw(k,fe,H,ye,W,s.CullFaceMode.backCCW,wt,"terrain_raster",g.gridBuffer,he,oe)}})}}(a,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const a=this.painter,d=this.painter.context,_=this.proxySourceCache,g=this.proxiedCoords[_.id],w=this._drapedRenderBatches.shift(),T=[],C=a.style.order;let k=0;for(const z of g){const R=_.getTileByID(z.proxyTileKey),j=_.proxyCachedFBO[z.key]?_.proxyCachedFBO[z.key][n]:void 0,X=j!==void 0?_.renderCache[j]:this.pool[k++],Z=j!==void 0;if(R.texture=X.tex,Z&&!X.dirty){T.push(R.tileID);continue}let W;d.bindFramebuffer.set(X.fb.framebuffer),this.renderedToTile=!1,X.dirty&&(d.clear({color:s.Color.transparent,stencil:0}),X.dirty=!1);for(let H=w.start;H<=w.end;++H){const G=a.style._layers[C[H]];if(G.isHidden(a.transform.zoom))continue;const te=a.style._getLayerSourceCache(G),K=te?this.proxyToSource[z.key][te.id]:[z];if(!K)continue;const fe=K;d.viewport.set([0,0,X.fb.width,X.fb.height]),W!==(te?te.id:null)&&(this._setupStencil(X,K,G,te),W=te?te.id:null),a.renderLayer(a,te,G,fe)}this.renderedToTile?(X.dirty=!0,T.push(R.tileID)):Z||--k,k===5&&(k=0,this.renderToBackBuffer(T))}return this.renderToBackBuffer(T),this.renderingToTexture=!1,d.bindFramebuffer.set(null),d.viewport.set([0,0,a.width,a.height]),w.end+1}postRender(){}renderCacheEfficiency(n){const a=n.order.length;if(a===0)return{efficiency:100};let d,_=0,g=0,w=!1;for(let T=0;T<a;++T){const C=n._layers[n.order[T]];this._style.isLayerDraped(C)?(w&&++_,++g):w||(w=!0,d=C.id)}return g===0?{efficiency:100}:{efficiency:100*(1-_/g),firstUndrapedLayer:d}}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{n=Math.min(n,a.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,a,d){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(g=>g.dem).map(g=>{const w=g.tileID,T=1<<w.overscaledZ,{x:C,y:k}=w.canonical,z=C/T,R=(C+1)/T,j=k/T,X=(k+1)/T;return{minx:z,miny:j,maxx:R,maxy:X,t:g.dem.tree.raycastRoot(z,j,R,X,n,a,d),tile:g}});_.sort((g,w)=>(g.t!==null?g.t:Number.MAX_VALUE)-(w.t!==null?w.t:Number.MAX_VALUE));for(const g of _){if(g.t==null)return null;const w=g.tile.dem.tree.raycast(g.minx,g.miny,g.maxx,g.maxy,n,a,d);if(w!=null)return w}return null}_createFBO(){const n=this.painter.context,a=n.gl,d=this.drapeBufferSize;n.activeTexture.set(a.TEXTURE0);const _=new s.Texture(n,{width:d[0],height:d[1],data:null},a.RGBA);_.bind(a.LINEAR,a.CLAMP_TO_EDGE);const g=n.createFramebuffer(d[0],d[1],!1);return g.colorAttachment.set(_.texture),g.depthAttachment=new B(n,g.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,d[0],d[1]),this._stencilRef=0,g.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):g.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&!n.extTextureFilterAnisotropicForceOff&&a.texParameterf(a.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:g,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const n in this._style._sourceCaches)if(this._style._sourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const a=this._style._layers[n],d=a.isHidden(this.painter.transform.zoom),_=a.getCrossfadeParameters(),g=!!_&&_.t!==1,w=a.hasTransition();return a.type!=="custom"&&!d&&(g||w)})}_clearRasterFadeFromRenderCache(){let n=!1;for(const a in this._style._sourceCaches)if(this._style._sourceCaches[a]._source instanceof ne){n=!0;break}if(n)for(let a=0;a<this._style.order.length;++a){const d=this._style._layers[this._style.order[a]],_=d.isHidden(this.painter.transform.zoom),g=this._style._getLayerSourceCache(d);if(d.type!=="raster"||_||!g)continue;const w=d.paint.get("raster-fade-duration");for(const T of this.proxyCoords){const C=this.proxyToSource[T.key][g.id];if(C)for(const k of C){const z=Ml(g.getTile(k),g.findLoadedParent(k,0),g,this.painter.transform,w);(z.opacity!==1||z.mix!==0)&&this._clearRenderCacheForTile(g.id,k)}}}}_setupDrapedRenderBatches(){const n=this._style.order,a=n.length;if(a===0)return;const d=[];let _,g=0,w=this._style._layers[n[g]];for(;!this._style.isLayerDraped(w)&&w.isHidden(this.painter.transform.zoom)&&++g<a;)w=this._style._layers[n[g]];for(;g<a;++g){const T=this._style._layers[n[g]];T.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(T)?_===void 0&&(_=g):_!==void 0&&(d.push({start:_,end:g-1}),_=void 0))}_!==void 0&&d.push({start:_,end:g-1}),this._drapedRenderBatches=d}_setupRenderCache(n){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const w=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let T=0;T<w.length;++T){const C=Object.values(w[T]);a.renderCachePool.push(...C)}}return}this._clearRasterFadeFromRenderCache();const d=this.proxyCoords,_=this._tilesDirty;for(let w=d.length-1;w>=0;w--){const T=d[w];if(a.getTileByID(T.key),a.proxyCachedFBO[T.key]!==void 0){const C=n[T.key],k=this.proxyToSource[T.key];let z=0;for(const R in k){const j=k[R],X=C[R];if(!X||X.length!==j.length||j.some((Z,W)=>Z!==X[W]||_[R]&&_[R].hasOwnProperty(Z.key))){z=-1;break}++z}for(const R in a.proxyCachedFBO[T.key])a.renderCache[a.proxyCachedFBO[T.key][R]].dirty=z<0||z!==Object.values(C).length}}const g=[...this._drapedRenderBatches];g.sort((w,T)=>T.end-T.start-(w.end-w.start));for(const w of g)for(const T of d){if(a.proxyCachedFBO[T.key])continue;let C=a.renderCachePool.pop();C===void 0&&a.renderCache.length<50&&(C=a.renderCache.length,a.renderCache.push(this._createFBO())),C!==void 0&&(a.proxyCachedFBO[T.key]={},a.proxyCachedFBO[T.key][w.start]=C,a.renderCache[C].dirty=!0)}this._tilesDirty={}}_setupStencil(n,a,d,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const g=this.painter.context,w=g.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let T;if(d.isTileClipped())T=a.length,this._overlapStencilMode.test={func:w.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);T=1,this._overlapStencilMode.test={func:w.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+T>255&&(g.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=T,this._overlapStencilMode.ref=this._stencilRef,d.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):s.StencilMode.disabled}_renderTileClippingMasks(n,a){const d=this.painter,_=this.painter.context,g=_.gl;d._tileClippingMaskIDs={},_.setColorMode(s.ColorMode.disabled),_.setDepthMode(s.DepthMode.disabled);const w=d.useProgram("clippingMask");for(const T of n){const C=d._tileClippingMaskIDs[T.key]=--a;w.draw(_,g.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:g.ALWAYS,mask:0},C,255,g.KEEP,g.KEEP,g.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,Jc(T.projMatrix),"$clipping",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}pointCoordinate(n){const a=this.painter.transform;if(n.x<0||n.x>a.width||n.y<0||n.y>a.height)return null;const d=[n.x,n.y,1,1];s.transformMat4$1(d,d,a.pixelMatrixInverse),s.scale$1(d,d,1/d[3]),d[0]/=a.worldSize,d[1]/=a.worldSize;const _=a._camera.position,g=s.mercatorZfromAltitude(1,a.center.lat),w=[_[0],_[1],_[2]/g,0],T=s.subtract([],d.slice(0,3),w);s.normalize(T,T);const C=this.raycast(w,T,this._exaggeration);return C!==null&&C?(s.scaleAndAdd(w,w,T,C),w[3]=w[2],w[2]*=g,w):null}drawDepth(){const n=this.painter,a=n.context,d=this.proxySourceCache,_=Math.ceil(n.width),g=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===_&&this._depthFBO.height===g||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const w=a.gl,T=a.createFramebuffer(_,g,!0);a.activeTexture.set(w.TEXTURE0);const C=new s.Texture(a,{width:_,height:g,data:null},w.RGBA);C.bind(w.NEAREST,w.CLAMP_TO_EDGE),T.colorAttachment.set(C.texture);const k=a.createRenderbuffer(a.gl.DEPTH_COMPONENT16,_,g);T.depthAttachment.set(k),this._depthFBO=T,this._depthTexture=C}a.bindFramebuffer.set(this._depthFBO.framebuffer),a.viewport.set([0,0,_,g]),function(w,T,C,k){if(w.transform.projection.name==="globe")return;const z=w.context,R=z.gl;z.clear({depth:1});const j=w.useProgram("terrainDepth"),X=new s.DepthMode(R.LESS,s.DepthMode.ReadWrite,w.depthRangeFor3D);for(const Z of k){const W=C.getTile(Z),H=Xc(Z.projMatrix,0);T.setupElevationDraw(W,j),j.draw(z,R.TRIANGLES,X,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.backCCW,H,"terrain_depth",T.gridBuffer,T.gridIndexBuffer,T.gridNoSkirtSegments)}}(n,this,d,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,a,d){if(n.getSource()instanceof Ee)return this._setupProxiedCoordsForImageSource(n,a,d);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const _=this.proxiedCoords[n.id]=[],g=this.proxyCoords;for(let T=0;T<g.length;T++){const C=g[T],k=this._findTileCoveringTileID(C,n);if(k){const z=this._createProxiedId(C,k,d[C.key]&&d[C.key][n.id]);_.push(z),this.proxyToSource[C.key][n.id]=[z]}}let w=!1;for(let T=0;T<a.length;T++){const C=n.getTile(a[T]);if(!C||!C.hasData())continue;const k=this._findTileCoveringTileID(C.tileID,this.proxySourceCache);if(k&&k.tileID.canonical.z!==C.tileID.canonical.z){const z=this.proxyToSource[k.tileID.key][n.id],R=this._createProxiedId(k.tileID,C,d[k.tileID.key]&&d[k.tileID.key][n.id]);z?z.splice(z.length-1,0,R):this.proxyToSource[k.tileID.key][n.id]=[R],_.push(R),w=!0}}this._sourceTilesOverlap[n.id]=w}_setupProxiedCoordsForImageSource(n,a,d){if(!n.getSource().loaded())return;const _=this.proxiedCoords[n.id]=[],g=this.proxyCoords,w=n.getSource(),T=new s.pointGeometry(w.tileID.x,w.tileID.y)._div(1<<w.tileID.z),C=w.coordinates.map(s.MercatorCoordinate.fromLngLat).reduce((z,R)=>(z.min.x=Math.min(z.min.x,R.x-T.x),z.min.y=Math.min(z.min.y,R.y-T.y),z.max.x=Math.max(z.max.x,R.x-T.x),z.max.y=Math.max(z.max.y,R.y-T.y),z),{min:new s.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),k=(z,R)=>{const j=z.wrap+z.canonical.x/(1<<z.canonical.z),X=z.canonical.y/(1<<z.canonical.z),Z=s.EXTENT/(1<<z.canonical.z),W=R.wrap+R.canonical.x/(1<<R.canonical.z),H=R.canonical.y/(1<<R.canonical.z);return j+Z<W+C.min.x||j>W+C.max.x||X+Z<H+C.min.y||X>H+C.max.y};for(let z=0;z<g.length;z++){const R=g[z];for(let j=0;j<a.length;j++){const X=n.getTile(a[j]);if(!X||!X.hasData()||k(R,X.tileID))continue;const Z=this._createProxiedId(R,X,d[R.key]&&d[R.key][n.id]),W=this.proxyToSource[R.key][n.id];W?W.push(Z):this.proxyToSource[R.key][n.id]=[Z],_.push(Z)}}}_createProxiedId(n,a,d){let _=this.orthoMatrix;if(d){const g=d.find(w=>w.key===a.tileID.key);if(g)return g}if(a.tileID.key!==n.key){const g=n.canonical.z-a.tileID.canonical.z;let w,T,C;_=s.create();const k=a.tileID.wrap-n.wrap<<n.overscaledZ;g>0?(w=s.EXTENT>>g,T=w*((a.tileID.canonical.x<<g)-n.canonical.x+k),C=w*((a.tileID.canonical.y<<g)-n.canonical.y)):(w=s.EXTENT<<-g,T=s.EXTENT*(a.tileID.canonical.x-(n.canonical.x+k<<-g)),C=s.EXTENT*(a.tileID.canonical.y-(n.canonical.y<<-g))),s.ortho(_,0,w,0,w,0,1),s.translate(_,_,[T,C,0])}return new Il(a.tileID,n.key,_)}_findTileCoveringTileID(n,a){let d=a.getTile(n);if(d&&d.hasData())return d;const _=this._findCoveringTileCache[a.id],g=_[n.key];if(d=g?a.getTileByID(g):null,d&&d.hasData()||g===null)return d;let w=d?d.tileID:n,T=w.overscaledZ;const C=a.getSource().minzoom,k=[];if(!g){const R=a.getSource().maxzoom;if(n.canonical.z>=R){const j=n.canonical.z-R;a.getSource().reparseOverscaled?(T=Math.max(n.canonical.z+2,a.transform.tileZoom),w=new s.OverscaledTileID(T,n.wrap,R,n.canonical.x>>j,n.canonical.y>>j)):j!==0&&(T=R,w=new s.OverscaledTileID(T,n.wrap,R,n.canonical.x>>j,n.canonical.y>>j))}w.key!==n.key&&(k.push(w.key),d=a.getTile(w))}const z=R=>{k.forEach(j=>{_[j]=R}),k.length=0};for(T-=1;T>=C&&(!d||!d.hasData());T--){d&&z(d.tileID.key);const R=w.calculateScaledKey(T);if(d=a.getTileByID(R),d&&d.hasData())break;const j=_[R];if(j===null)break;j===void 0?k.push(R):d=a.getTileByID(j)}return z(d?d.tileID.key:null),d&&d.hasData()?d:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,a){let d=this._tilesDirty[n];d||(d=this._tilesDirty[n]={}),d[a.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const n=function(a){let d=0;const _=new s.StructArrayLayout2ui4,g=131;for(let w=1;w<129;w++){for(let T=1;T<129;T++)d=w*g+T,_.emplaceBack(d,d+1),_.emplaceBack(d,d+g),_.emplaceBack(d+1,d+g),w===128&&_.emplaceBack(d+g,d+g+1);_.emplaceBack(d+1,d+1+g)}return _}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(n),this.wireframeSegments=s.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,n.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class tu{static cacheKey(n,a,d,_){let g=`${a}${_?_.cacheKey:""}`;for(const w of d)n.usedDefines.includes(w)&&(g+=`/${w}`);return g}constructor(n,a,d,_,g,w){const T=n.gl;this.program=T.createProgram();const C=function(H){const G=[];for(let te=0;te<H.length;te++){if(H[te]===null)continue;const K=H[te].split(" ");G.push(K.pop())}return G}(d.staticAttributes),k=_?_.getBinderAttributes():[],z=C.concat(k);let R=_?_.defines():[];R=R.concat(w.map(H=>`#define ${H}`));const j=R.concat(n.extStandardDerivatives?`#extension GL_OES_standard_derivatives : enable
`.concat(Sl):Sl,Sl,El,xa.fragmentSource,Ko.fragmentSource,d.fragmentSource).join(`
`),X=R.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,El,xa.vertexSource,Ko.vertexSource,Tl.vertexSource,d.vertexSource).join(`
`),Z=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);T.shaderSource(Z,j),T.compileShader(Z),T.attachShader(this.program,Z);const W=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(W,X),T.compileShader(W),T.attachShader(this.program,W),this.attributes={},this.numAttributes=z.length;for(let H=0;H<this.numAttributes;H++)z[H]&&(T.bindAttribLocation(this.program,H,z[H]),this.attributes[z[H]]=H);T.linkProgram(this.program),T.deleteShader(W),T.deleteShader(Z),this.fixedUniforms=g(n),this.binderUniforms=_?_.getUniforms(n):[],w.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=(H=>({u_dem:new s.Uniform1i(H),u_dem_prev:new s.Uniform1i(H),u_dem_unpack:new s.Uniform4f(H),u_dem_tl:new s.Uniform2f(H),u_dem_scale:new s.Uniform1f(H),u_dem_tl_prev:new s.Uniform2f(H),u_dem_scale_prev:new s.Uniform1f(H),u_dem_size:new s.Uniform1f(H),u_dem_lerp:new s.Uniform1f(H),u_exaggeration:new s.Uniform1f(H),u_depth:new s.Uniform1i(H),u_depth_size_inv:new s.Uniform2f(H),u_meter_to_dem:new s.Uniform1f(H),u_label_plane_matrix_inv:new s.UniformMatrix4f(H),u_tile_tl_up:new s.Uniform3f(H),u_tile_tr_up:new s.Uniform3f(H),u_tile_br_up:new s.Uniform3f(H),u_tile_bl_up:new s.Uniform3f(H),u_tile_up_scale:new s.Uniform1f(H)}))(n)),w.indexOf("FOG")!==-1&&(this.fogUniforms=(H=>({u_fog_matrix:new s.UniformMatrix4f(H),u_fog_range:new s.Uniform2f(H),u_fog_color:new s.Uniform4f(H),u_fog_horizon_blend:new s.Uniform1f(H),u_fog_temporal_offset:new s.Uniform1f(H),u_frustum_tl:new s.Uniform3f(H),u_frustum_tr:new s.Uniform3f(H),u_frustum_br:new s.Uniform3f(H),u_frustum_bl:new s.Uniform3f(H),u_globe_pos:new s.Uniform3f(H),u_globe_radius:new s.Uniform1f(H),u_globe_transition:new s.Uniform1f(H),u_is_globe:new s.Uniform1i(H),u_viewport:new s.Uniform2f(H)}))(n))}}setTerrainUniformValues(n,a){if(!this.terrainUniforms)return;const d=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in a)d[_].set(this.program,_,a[_])}}setFogUniformValues(n,a){if(!this.fogUniforms)return;const d=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in a)d[_].set(this.program,_,a[_])}}draw(n,a,d,_,g,w,T,C,k,z,R,j,X,Z,W){const H=n.gl;if(this.failedToCreate)return;n.program.set(this.program),n.setDepthMode(d),n.setStencilMode(_),n.setColorMode(g),n.setCullFace(w);for(const te of Object.keys(this.fixedUniforms))this.fixedUniforms[te].set(this.program,te,T[te]);Z&&Z.setUniforms(this.program,n,this.binderUniforms,j,{zoom:X});const G={[H.LINES]:2,[H.TRIANGLES]:3,[H.LINE_STRIP]:1}[a];for(const te of R.get()){const K=te.vaos||(te.vaos={});(K[C]||(K[C]=new Al)).bind(n,this,k,Z?Z.getPaintVertexBuffers():[],z,te.vertexOffset,W||[]),H.drawElements(a,te.primitiveLength*G,H.UNSIGNED_SHORT,te.primitiveOffset*G*2)}}}function Zh(c,n,a){const d=1/pi(a,1,n.transform.tileZoom),_=Math.pow(2,a.tileID.overscaledZ),g=a.tileSize*Math.pow(2,n.transform.tileZoom)/_,w=g*(a.tileID.canonical.x+a.tileID.wrap*_),T=g*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[d,c.fromScale,c.toScale],u_fade:c.t,u_pixel_coord_upper:[w>>16,T>>16],u_pixel_coord_lower:[65535&w,65535&T]}}const Ta=s.create(),As=(c,n,a,d,_,g,w,T,C,k,z)=>{const R=n.style.light,j=R.properties.get("position"),X=[j.x,j.y,j.z],Z=s.create$1();R.properties.get("anchor")==="viewport"&&(s.fromRotation(Z,-n.transform.angle),s.transformMat3(X,X,Z));const W=R.properties.get("color"),H=n.transform,G={u_matrix:c,u_lightpos:X,u_lightintensity:R.properties.get("intensity"),u_lightcolor:[W.r,W.g,W.b],u_vertical_gradient:+a,u_opacity:d,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ta,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:_,u_edge_radius:g};return H.projection.name==="globe"&&(G.u_tile_id=[w.canonical.x,w.canonical.y,1<<w.canonical.z],G.u_zoom_transition=C,G.u_inv_rot_matrix=z,G.u_merc_center=k,G.u_up_dir=H.projection.upVector(new s.CanonicalTileID(0,0,0),k[0]*s.EXTENT,k[1]*s.EXTENT),G.u_height_lift=T),G},Wh=(c,n,a,d,_,g,w,T,C,k,z,R,j)=>{const X=As(c,n,a,d,_,g,w,k,z,R,j),Z={u_height_factor:-Math.pow(2,w.overscaledZ)/C.tileSize/8};return s.extend(X,Zh(T,n,C),Z)},Ea=c=>({u_matrix:c}),kl=(c,n,a,d)=>s.extend(Ea(c),Zh(a,n,d)),$r=(c,n)=>({u_matrix:c,u_world:n}),iu=(c,n,a,d,_)=>s.extend(kl(c,n,a,d),{u_world:_}),Hh=s.create(),nu=(c,n,a,d,_,g)=>{const w=c.transform,T=w.projection.name==="globe";let C;if(g.paint.get("circle-pitch-alignment")==="map")if(T){const z=s.globePixelsToTileUnits(w.zoom,n.canonical)*w._pixelsPerMercatorPixel;C=Float32Array.from([z,0,0,z])}else C=w.calculatePixelsToTileUnitsMatrix(a);else C=new Float32Array([w.pixelsToGLUnits[0],0,0,w.pixelsToGLUnits[1]]);const k={u_camera_to_center_distance:w.cameraToCenterDistance,u_matrix:c.translatePosMatrix(n.projMatrix,a,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_device_pixel_ratio:s.exported.devicePixelRatio,u_extrude_scale:C,u_inv_rot_matrix:Hh,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(T){k.u_inv_rot_matrix=d,k.u_merc_center=_,k.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],k.u_zoom_transition=s.globeToMercatorTransition(w.zoom);const z=_[0]*s.EXTENT,R=_[1]*s.EXTENT;k.u_up_dir=w.projection.upVector(new s.CanonicalTileID(0,0,0),z,R)}return k},Xh=c=>{const n=[];return c.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),c.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n},ru=(c,n,a,d)=>{const _=s.EXTENT/a.tileSize;return{u_matrix:c,u_camera_to_center_distance:n.getCameraToCenterDistance(d),u_extrude_scale:[n.pixelsToGLUnits[0]/_,n.pixelsToGLUnits[1]/_]}},Kh=(c,n,a=1)=>({u_matrix:c,u_color:n,u_overlay:0,u_overlay_scale:a}),ou=s.create(),Ip=(c,n,a,d,_,g,w)=>{const T=c.transform,C=T.projection.name==="globe",k=C?s.globePixelsToTileUnits(T.zoom,n.canonical)*T._pixelsPerMercatorPixel:pi(a,1,g),z={u_matrix:n.projMatrix,u_extrude_scale:k,u_intensity:w,u_inv_rot_matrix:ou,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){z.u_inv_rot_matrix=d,z.u_merc_center=_,z.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],z.u_zoom_transition=s.globeToMercatorTransition(T.zoom);const R=_[0]*s.EXTENT,j=_[1]*s.EXTENT;z.u_up_dir=T.projection.upVector(new s.CanonicalTileID(0,0,0),R,j)}return z},zl=(c,n,a,d,_,g,w,T)=>{const C=c.transform,k=C.calculatePixelsToTileUnitsMatrix(n),z={u_matrix:Yh(c,n,a,_),u_pixels_to_tile_units:k,u_device_pixel_ratio:w,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:g,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:T};if(Dl(a)){const R=Pl(n,c.transform);z.u_texsize=n.lineAtlasTexture.size,z.u_scale=[R,d.fromScale,d.toScale],z.u_mix=d.t}return z},kp=(c,n,a,d,_,g)=>{const w=c.transform,T=Pl(n,w);return{u_matrix:Yh(c,n,a,_),u_texsize:n.imageAtlasTexture.size,u_pixels_to_tile_units:w.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:g,u_image:0,u_scale:[T,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Pl(c,n){return 1/pi(c,1,n.tileZoom)}function Yh(c,n,a,d){return c.translatePosMatrix(d||n.tileID.projMatrix,n,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}function Dl(c){const n=c.paint.get("line-dasharray").value;return n.value||n.kind!=="constant"}const zp=(c,n,a,d,_,g)=>{return{u_matrix:c,u_tl_parent:n,u_scale_parent:a,u_fade_t:d.mix,u_opacity:d.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(T=_.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(w=_.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:Ll(_.paint.get("raster-hue-rotate")),u_perspective_transform:g};var w,T};function Ll(c){c*=Math.PI/180;const n=Math.sin(c),a=Math.cos(c);return[(2*a+1)/3,(-Math.sqrt(3)*n-a+1)/3,(Math.sqrt(3)*n-a+1)/3]}const Jh=s.create(),su=(c,n,a,d,_,g,w,T,C,k,z,R,j,X,Z,W)=>{const H=_.transform,G={u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:H.cameraToCenterDistance,u_rotate_symbol:+a,u_aspect_ratio:H.width/H.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:g,u_label_plane_matrix:w,u_coord_matrix:T,u_is_text:+C,u_pitch_with_map:+d,u_texsize:k,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Jh,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Jh,u_up_vector:[0,-1,0]};return W.name==="globe"&&(G.u_tile_id=[z.canonical.x,z.canonical.y,1<<z.canonical.z],G.u_zoom_transition=R,G.u_inv_rot_matrix=X,G.u_merc_center=j,G.u_camera_forward=H._camera.forward(),G.u_ecef_origin=s.globeECEFOrigin(H.globeMatrix,z.toUnwrapped()),G.u_tile_matrix=Float32Array.from(H.globeMatrix),G.u_up_vector=Z),G},au=(c,n,a,d,_,g,w,T,C,k,z,R,j,X,Z,W,H)=>s.extend(su(c,n,a,d,_,g,w,T,C,k,R,j,X,Z,W,H),{u_gamma_scale:d?_.transform.cameraToCenterDistance*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:s.exported.devicePixelRatio,u_is_halo:+z}),Ms=(c,n,a,d,_,g,w,T,C,k,z,R,j,X,Z,W)=>s.extend(au(c,n,a,d,_,g,w,T,!0,C,!0,z,R,j,X,Z,W),{u_texsize_icon:k,u_texture_icon:1}),Pp=(c,n,a)=>({u_matrix:c,u_opacity:n,u_color:a}),Dp=(c,n,a,d,_,g)=>s.extend(function(w,T,C,k){const z=C.imageManager.getPattern(w.from.toString()),R=C.imageManager.getPattern(w.to.toString()),{width:j,height:X}=C.imageManager.getPixelSize(),Z=Math.pow(2,k.tileID.overscaledZ),W=k.tileSize*Math.pow(2,C.transform.tileZoom)/Z,H=W*(k.tileID.canonical.x+k.tileID.wrap*Z),G=W*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:R.tl,u_pattern_br_b:R.br,u_texsize:[j,X],u_mix:T.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:R.displaySize,u_scale_a:T.fromScale,u_scale_b:T.toScale,u_tile_units_to_pixels:1/pi(k,1,C.transform.tileZoom),u_pixel_coord_upper:[H>>16,G>>16],u_pixel_coord_lower:[65535&H,65535&G]}}(d,g,a,_),{u_matrix:c,u_opacity:n}),Lp={fillExtrusion:c=>({u_matrix:new s.UniformMatrix4f(c),u_lightpos:new s.Uniform3f(c),u_lightintensity:new s.Uniform1f(c),u_lightcolor:new s.Uniform3f(c),u_vertical_gradient:new s.Uniform1f(c),u_opacity:new s.Uniform1f(c),u_edge_radius:new s.Uniform1f(c),u_ao:new s.Uniform2f(c),u_tile_id:new s.Uniform3f(c),u_zoom_transition:new s.Uniform1f(c),u_inv_rot_matrix:new s.UniformMatrix4f(c),u_merc_center:new s.Uniform2f(c),u_up_dir:new s.Uniform3f(c),u_height_lift:new s.Uniform1f(c)}),fillExtrusionPattern:c=>({u_matrix:new s.UniformMatrix4f(c),u_lightpos:new s.Uniform3f(c),u_lightintensity:new s.Uniform1f(c),u_lightcolor:new s.Uniform3f(c),u_vertical_gradient:new s.Uniform1f(c),u_height_factor:new s.Uniform1f(c),u_edge_radius:new s.Uniform1f(c),u_ao:new s.Uniform2f(c),u_tile_id:new s.Uniform3f(c),u_zoom_transition:new s.Uniform1f(c),u_inv_rot_matrix:new s.UniformMatrix4f(c),u_merc_center:new s.Uniform2f(c),u_up_dir:new s.Uniform3f(c),u_height_lift:new s.Uniform1f(c),u_image:new s.Uniform1i(c),u_texsize:new s.Uniform2f(c),u_pixel_coord_upper:new s.Uniform2f(c),u_pixel_coord_lower:new s.Uniform2f(c),u_scale:new s.Uniform3f(c),u_fade:new s.Uniform1f(c),u_opacity:new s.Uniform1f(c)}),fill:c=>({u_matrix:new s.UniformMatrix4f(c)}),fillPattern:c=>({u_matrix:new s.UniformMatrix4f(c),u_image:new s.Uniform1i(c),u_texsize:new s.Uniform2f(c),u_pixel_coord_upper:new s.Uniform2f(c),u_pixel_coord_lower:new s.Uniform2f(c),u_scale:new s.Uniform3f(c),u_fade:new s.Uniform1f(c)}),fillOutline:c=>({u_matrix:new s.UniformMatrix4f(c),u_world:new s.Uniform2f(c)}),fillOutlinePattern:c=>({u_matrix:new s.UniformMatrix4f(c),u_world:new s.Uniform2f(c),u_image:new s.Uniform1i(c),u_texsize:new s.Uniform2f(c),u_pixel_coord_upper:new s.Uniform2f(c),u_pixel_coord_lower:new s.Uniform2f(c),u_scale:new s.Uniform3f(c),u_fade:new s.Uniform1f(c)}),circle:c=>({u_camera_to_center_distance:new s.Uniform1f(c),u_extrude_scale:new s.UniformMatrix2f(c),u_device_pixel_ratio:new s.Uniform1f(c),u_matrix:new s.UniformMatrix4f(c),u_inv_rot_matrix:new s.UniformMatrix4f(c),u_merc_center:new s.Uniform2f(c),u_tile_id:new s.Uniform3f(c),u_zoom_transition:new s.Uniform1f(c),u_up_dir:new s.Uniform3f(c)}),collisionBox:c=>({u_matrix:new s.UniformMatrix4f(c),u_camera_to_center_distance:new s.Uniform1f(c),u_extrude_scale:new s.Uniform2f(c)}),collisionCircle:c=>({u_matrix:new s.UniformMatrix4f(c),u_inv_matrix:new s.UniformMatrix4f(c),u_camera_to_center_distance:new s.Uniform1f(c),u_viewport_size:new s.Uniform2f(c)}),debug:c=>({u_color:new s.UniformColor(c),u_matrix:new s.UniformMatrix4f(c),u_overlay:new s.Uniform1i(c),u_overlay_scale:new s.Uniform1f(c)}),clippingMask:c=>({u_matrix:new s.UniformMatrix4f(c)}),heatmap:c=>({u_extrude_scale:new s.Uniform1f(c),u_intensity:new s.Uniform1f(c),u_matrix:new s.UniformMatrix4f(c),u_inv_rot_matrix:new s.UniformMatrix4f(c),u_merc_center:new s.Uniform2f(c),u_tile_id:new s.Uniform3f(c),u_zoom_transition:new s.Uniform1f(c),u_up_dir:new s.Uniform3f(c)}),heatmapTexture:c=>({u_image:new s.Uniform1i(c),u_color_ramp:new s.Uniform1i(c),u_opacity:new s.Uniform1f(c)}),hillshade:c=>({u_matrix:new s.UniformMatrix4f(c),u_image:new s.Uniform1i(c),u_latrange:new s.Uniform2f(c),u_light:new s.Uniform2f(c),u_shadow:new s.UniformColor(c),u_highlight:new s.UniformColor(c),u_accent:new s.UniformColor(c)}),hillshadePrepare:c=>({u_matrix:new s.UniformMatrix4f(c),u_image:new s.Uniform1i(c),u_dimension:new s.Uniform2f(c),u_zoom:new s.Uniform1f(c),u_unpack:new s.Uniform4f(c)}),line:c=>({u_matrix:new s.UniformMatrix4f(c),u_pixels_to_tile_units:new s.UniformMatrix2f(c),u_device_pixel_ratio:new s.Uniform1f(c),u_units_to_pixels:new s.Uniform2f(c),u_dash_image:new s.Uniform1i(c),u_gradient_image:new s.Uniform1i(c),u_image_height:new s.Uniform1f(c),u_texsize:new s.Uniform2f(c),u_scale:new s.Uniform3f(c),u_mix:new s.Uniform1f(c),u_alpha_discard_threshold:new s.Uniform1f(c),u_trim_offset:new s.Uniform2f(c)}),linePattern:c=>({u_matrix:new s.UniformMatrix4f(c),u_texsize:new s.Uniform2f(c),u_pixels_to_tile_units:new s.UniformMatrix2f(c),u_device_pixel_ratio:new s.Uniform1f(c),u_image:new s.Uniform1i(c),u_units_to_pixels:new s.Uniform2f(c),u_scale:new s.Uniform3f(c),u_fade:new s.Uniform1f(c),u_alpha_discard_threshold:new s.Uniform1f(c)}),raster:c=>({u_matrix:new s.UniformMatrix4f(c),u_tl_parent:new s.Uniform2f(c),u_scale_parent:new s.Uniform1f(c),u_fade_t:new s.Uniform1f(c),u_opacity:new s.Uniform1f(c),u_image0:new s.Uniform1i(c),u_image1:new s.Uniform1i(c),u_brightness_low:new s.Uniform1f(c),u_brightness_high:new s.Uniform1f(c),u_saturation_factor:new s.Uniform1f(c),u_contrast_factor:new s.Uniform1f(c),u_spin_weights:new s.Uniform3f(c),u_perspective_transform:new s.Uniform2f(c)}),symbolIcon:c=>({u_is_size_zoom_constant:new s.Uniform1i(c),u_is_size_feature_constant:new s.Uniform1i(c),u_size_t:new s.Uniform1f(c),u_size:new s.Uniform1f(c),u_camera_to_center_distance:new s.Uniform1f(c),u_rotate_symbol:new s.Uniform1i(c),u_aspect_ratio:new s.Uniform1f(c),u_fade_change:new s.Uniform1f(c),u_matrix:new s.UniformMatrix4f(c),u_label_plane_matrix:new s.UniformMatrix4f(c),u_coord_matrix:new s.UniformMatrix4f(c),u_is_text:new s.Uniform1i(c),u_pitch_with_map:new s.Uniform1i(c),u_texsize:new s.Uniform2f(c),u_tile_id:new s.Uniform3f(c),u_zoom_transition:new s.Uniform1f(c),u_inv_rot_matrix:new s.UniformMatrix4f(c),u_merc_center:new s.Uniform2f(c),u_camera_forward:new s.Uniform3f(c),u_tile_matrix:new s.UniformMatrix4f(c),u_up_vector:new s.Uniform3f(c),u_ecef_origin:new s.Uniform3f(c),u_texture:new s.Uniform1i(c)}),symbolSDF:c=>({u_is_size_zoom_constant:new s.Uniform1i(c),u_is_size_feature_constant:new s.Uniform1i(c),u_size_t:new s.Uniform1f(c),u_size:new s.Uniform1f(c),u_camera_to_center_distance:new s.Uniform1f(c),u_rotate_symbol:new s.Uniform1i(c),u_aspect_ratio:new s.Uniform1f(c),u_fade_change:new s.Uniform1f(c),u_matrix:new s.UniformMatrix4f(c),u_label_plane_matrix:new s.UniformMatrix4f(c),u_coord_matrix:new s.UniformMatrix4f(c),u_is_text:new s.Uniform1i(c),u_pitch_with_map:new s.Uniform1i(c),u_texsize:new s.Uniform2f(c),u_texture:new s.Uniform1i(c),u_gamma_scale:new s.Uniform1f(c),u_device_pixel_ratio:new s.Uniform1f(c),u_tile_id:new s.Uniform3f(c),u_zoom_transition:new s.Uniform1f(c),u_inv_rot_matrix:new s.UniformMatrix4f(c),u_merc_center:new s.Uniform2f(c),u_camera_forward:new s.Uniform3f(c),u_tile_matrix:new s.UniformMatrix4f(c),u_up_vector:new s.Uniform3f(c),u_ecef_origin:new s.Uniform3f(c),u_is_halo:new s.Uniform1i(c)}),symbolTextAndIcon:c=>({u_is_size_zoom_constant:new s.Uniform1i(c),u_is_size_feature_constant:new s.Uniform1i(c),u_size_t:new s.Uniform1f(c),u_size:new s.Uniform1f(c),u_camera_to_center_distance:new s.Uniform1f(c),u_rotate_symbol:new s.Uniform1i(c),u_aspect_ratio:new s.Uniform1f(c),u_fade_change:new s.Uniform1f(c),u_matrix:new s.UniformMatrix4f(c),u_label_plane_matrix:new s.UniformMatrix4f(c),u_coord_matrix:new s.UniformMatrix4f(c),u_is_text:new s.Uniform1i(c),u_pitch_with_map:new s.Uniform1i(c),u_texsize:new s.Uniform2f(c),u_texsize_icon:new s.Uniform2f(c),u_texture:new s.Uniform1i(c),u_texture_icon:new s.Uniform1i(c),u_gamma_scale:new s.Uniform1f(c),u_device_pixel_ratio:new s.Uniform1f(c),u_is_halo:new s.Uniform1i(c)}),background:c=>({u_matrix:new s.UniformMatrix4f(c),u_opacity:new s.Uniform1f(c),u_color:new s.UniformColor(c)}),backgroundPattern:c=>({u_matrix:new s.UniformMatrix4f(c),u_opacity:new s.Uniform1f(c),u_image:new s.Uniform1i(c),u_pattern_tl_a:new s.Uniform2f(c),u_pattern_br_a:new s.Uniform2f(c),u_pattern_tl_b:new s.Uniform2f(c),u_pattern_br_b:new s.Uniform2f(c),u_texsize:new s.Uniform2f(c),u_mix:new s.Uniform1f(c),u_pattern_size_a:new s.Uniform2f(c),u_pattern_size_b:new s.Uniform2f(c),u_scale_a:new s.Uniform1f(c),u_scale_b:new s.Uniform1f(c),u_pixel_coord_upper:new s.Uniform2f(c),u_pixel_coord_lower:new s.Uniform2f(c),u_tile_units_to_pixels:new s.Uniform1f(c)}),terrainRaster:ba,terrainDepth:ba,skybox:c=>({u_matrix:new s.UniformMatrix4f(c),u_sun_direction:new s.Uniform3f(c),u_cubemap:new s.Uniform1i(c),u_opacity:new s.Uniform1f(c),u_temporal_offset:new s.Uniform1f(c)}),skyboxGradient:c=>({u_matrix:new s.UniformMatrix4f(c),u_color_ramp:new s.Uniform1i(c),u_center_direction:new s.Uniform3f(c),u_radius:new s.Uniform1f(c),u_opacity:new s.Uniform1f(c),u_temporal_offset:new s.Uniform1f(c)}),skyboxCapture:c=>({u_matrix_3f:new s.UniformMatrix3f(c),u_sun_direction:new s.Uniform3f(c),u_sun_intensity:new s.Uniform1f(c),u_color_tint_r:new s.Uniform4f(c),u_color_tint_m:new s.Uniform4f(c),u_luminance:new s.Uniform1f(c)}),globeRaster:c=>({u_proj_matrix:new s.UniformMatrix4f(c),u_globe_matrix:new s.UniformMatrix4f(c),u_normalize_matrix:new s.UniformMatrix4f(c),u_merc_matrix:new s.UniformMatrix4f(c),u_zoom_transition:new s.Uniform1f(c),u_merc_center:new s.Uniform2f(c),u_image0:new s.Uniform1i(c),u_grid_matrix:new s.UniformMatrix3f(c),u_frustum_tl:new s.Uniform3f(c),u_frustum_tr:new s.Uniform3f(c),u_frustum_br:new s.Uniform3f(c),u_frustum_bl:new s.Uniform3f(c),u_globe_pos:new s.Uniform3f(c),u_globe_radius:new s.Uniform1f(c),u_viewport:new s.Uniform2f(c)}),globeAtmosphere:c=>({u_frustum_tl:new s.Uniform3f(c),u_frustum_tr:new s.Uniform3f(c),u_frustum_br:new s.Uniform3f(c),u_frustum_bl:new s.Uniform3f(c),u_horizon:new s.Uniform1f(c),u_transition:new s.Uniform1f(c),u_fadeout_range:new s.Uniform1f(c),u_color:new s.Uniform4f(c),u_high_color:new s.Uniform4f(c),u_space_color:new s.Uniform4f(c),u_star_intensity:new s.Uniform1f(c),u_star_density:new s.Uniform1f(c),u_star_size:new s.Uniform1f(c),u_temporal_offset:new s.Uniform1f(c),u_horizon_angle:new s.Uniform1f(c),u_rotation_matrix:new s.UniformMatrix4f(c)})};let Bl;function Qh(c,n,a,d,_,g,w){const T=c.context,C=T.gl,k=c.transform,z=c.useProgram("collisionBox"),R=[];let j=0,X=0;for(let fe=0;fe<d.length;fe++){const he=d[fe],oe=n.getTile(he),de=oe.getBucket(a);if(!de)continue;const le=sr(he,de,k);let ye=le;_[0]===0&&_[1]===0||(ye=c.translatePosMatrix(le,oe,_,g));const Le=w?de.textCollisionBox:de.iconCollisionBox,dt=de.collisionCircleArray;if(dt.length>0){const Ae=s.create(),Je=ye;s.mul(Ae,de.placementInvProjMatrix,k.glCoordMatrix),s.mul(Ae,Ae,de.placementViewportMatrix),R.push({circleArray:dt,circleOffset:X,transform:Je,invTransform:Ae,projection:de.getProjection()}),j+=dt.length/4,X=j}Le&&(c.terrain&&c.terrain.setupElevationDraw(oe,z),z.draw(T,C.LINES,s.DepthMode.disabled,s.StencilMode.disabled,c.colorModeForRenderPass(),s.CullFaceMode.disabled,ru(ye,k,oe,de.getProjection()),a.id,Le.layoutVertexBuffer,Le.indexBuffer,Le.segments,null,k.zoom,null,[Le.collisionVertexBuffer,Le.collisionVertexBufferExt]))}if(!w||!R.length)return;const Z=c.useProgram("collisionCircle"),W=new s.StructArrayLayout2f1f2i16;W.resize(4*j),W._trim();let H=0;for(const fe of R)for(let he=0;he<fe.circleArray.length/4;he++){const oe=4*he,de=fe.circleArray[oe+0],le=fe.circleArray[oe+1],ye=fe.circleArray[oe+2],Le=fe.circleArray[oe+3];W.emplace(H++,de,le,ye,Le,0),W.emplace(H++,de,le,ye,Le,1),W.emplace(H++,de,le,ye,Le,2),W.emplace(H++,de,le,ye,Le,3)}(!Bl||Bl.length<2*j)&&(Bl=function(fe){const he=2*fe,oe=new s.StructArrayLayout3ui6;oe.resize(he),oe._trim();for(let de=0;de<he;de++){const le=6*de;oe.uint16[le+0]=4*de+0,oe.uint16[le+1]=4*de+1,oe.uint16[le+2]=4*de+2,oe.uint16[le+3]=4*de+2,oe.uint16[le+4]=4*de+3,oe.uint16[le+5]=4*de+0}return oe}(j));const G=T.createIndexBuffer(Bl,!0),te=T.createVertexBuffer(W,s.collisionCircleLayout.members,!0);for(const fe of R){const he={u_matrix:fe.transform,u_inv_matrix:fe.invTransform,u_camera_to_center_distance:(K=k).getCameraToCenterDistance(fe.projection),u_viewport_size:[K.width,K.height]};Z.draw(T,C.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,c.colorModeForRenderPass(),s.CullFaceMode.disabled,he,a.id,te,G,s.SegmentVector.simpleSegment(0,2*fe.circleOffset,fe.circleArray.length,fe.circleArray.length/2),null,k.zoom)}var K;te.destroy(),G.destroy()}const ed=s.create();function lu(c,n,a,d,_,g){const{horizontalAlign:w,verticalAlign:T}=s.getAnchorAlignment(c),C=-(w-.5)*n,k=-(T-.5)*a,z=s.evaluateVariableOffset(c,d);return new s.pointGeometry((C/_+z[0])*g,(k/_+z[1])*g)}function cu(c,n,a,d,_,g,w,T,C,k,z){const R=c.text.placedSymbolArray,j=c.text.dynamicLayoutVertexArray,X=c.icon.dynamicLayoutVertexArray,Z={},W=ar(T,c.getProjection(),g),H=g.elevation,G=c.getProjection().upVectorScale(T.canonical,g.center.lat,g.worldSize);j.clear();for(let te=0;te<R.length;te++){const K=R.get(te),fe=c.allowVerticalPlacement&&!K.placedOrientation,he=K.hidden||!K.crossTileID||fe?null:d[K.crossTileID];if(he){const oe=new s.pointGeometry(K.tileAnchorX,K.tileAnchorY),de=c.getProjection().upVector(T.canonical,oe.x,oe.y),le=H?H.getAtTileOffset(T,oe.x,oe.y):0,ye=ui([K.projectedAnchorX+le*de[0]*G.metersToTile,K.projectedAnchorY+le*de[1]*G.metersToTile,K.projectedAnchorZ+le*de[2]*G.metersToTile],a?W:w),Le=da(g.getCameraToCenterDistance(c.getProjection()),ye.signedDistanceFromCamera);let dt=_.evaluateSizeForFeature(c.textSizeData,k,K)*Le/s.ONE_EM;a&&(dt*=c.tilePixelRatio/C);const{width:Ae,height:Je,anchor:rt,textOffset:wt,textScale:je}=he,mt=lu(rt,Ae,Je,wt,je,dt);let it;if(a){const St=oe.add(mt),{x:Ot,y:Wt,z:ii}=c.getProjection().projectTilePoint(St.x,St.y,T.canonical);it=ui([Ot+le*de[0]*G.metersToTile,Wt+le*de[1]*G.metersToTile,ii+le*de[2]*G.metersToTile],w).point}else{const St=n?mt.rotate(-g.angle):mt;it=[ye.point[0]+St.x,ye.point[1]+St.y,0]}const It=c.allowVerticalPlacement&&K.placedOrientation===s.WritingMode.vertical?Math.PI/2:0;for(let St=0;St<K.numGlyphs;St++)s.addDynamicAttributes(j,it[0],it[1],it[2],It);z&&K.associatedIconIndex>=0&&(Z[K.associatedIconIndex]={shiftedAnchor:it,angle:It})}else Eo(K.numGlyphs,j)}if(z){X.clear();const te=c.icon.placedSymbolArray;for(let K=0;K<te.length;K++){const fe=te.get(K);if(fe.hidden)Eo(fe.numGlyphs,X);else{const he=Z[K];if(he)for(let oe=0;oe<fe.numGlyphs;oe++)s.addDynamicAttributes(X,he.shiftedAnchor[0],he.shiftedAnchor[1],he.shiftedAnchor[2],he.angle);else Eo(fe.numGlyphs,X)}}c.icon.dynamicLayoutVertexBuffer.updateData(X)}c.text.dynamicLayoutVertexBuffer.updateData(j)}function td(c,n,a){return a.iconsInText&&n?"symbolTextAndIcon":c?"symbolSDF":"symbolIcon"}function uu(c,n,a,d,_,g,w,T,C,k,z,R){const j=c.context,X=j.gl,Z=c.transform,W=T==="map",H=C==="map",G=W&&a.layout.get("symbol-placement")!=="point",te=W&&!H&&!G,K=a.layout.get("symbol-sort-key").constantOr(1)!==void 0;let fe=!1;const he=c.depthModeForSublayer(0,s.DepthMode.ReadOnly),oe=[s.mercatorXfromLng(Z.center.lng),s.mercatorYfromLat(Z.center.lat)],de=a.layout.get("text-variable-anchor"),le=Z.projection.name==="globe",ye=[],Le=[0,-1,0];let dt=Le;!le&&!Z.mercatorFromTransition||W||(dt=function(Ae){const Je=Ae._camera.getWorldToCamera(Ae.worldSize,1),rt=s.multiply([],Je,Ae.globeMatrix);s.invert(rt,rt);const wt=[0,0,0],je=[0,1,0,0];return s.transformMat4$1(je,je,rt),wt[0]=je[0],wt[1]=je[1],wt[2]=je[2],s.normalize(wt,wt),wt}(Z));for(const Ae of d){const Je=n.getTile(Ae),rt=Je.getBucket(a);if(!rt||rt.projection.name==="mercator"&&le)continue;const wt=_?rt.text:rt.icon;if(!wt||rt.fullyClipped||!wt.segments.get().length)continue;const je=wt.programConfigurations.get(a.id),mt=_||rt.sdfIcons,it=_?rt.textSizeData:rt.iconSizeData,It=H||Z.pitch!==0,St=s.evaluateSizeForZoom(it,Z.zoom);let Ot,Wt,ii,xi,Vt=[0,0],ai=null;if(_){if(Wt=Je.glyphAtlasTexture,ii=X.LINEAR,Ot=Je.glyphAtlasTexture.size,rt.iconsInText){Vt=Je.imageAtlasTexture.size,ai=Je.imageAtlasTexture;const Qn=it.kind==="composite"||it.kind==="camera";xi=It||c.options.rotating||c.options.zooming||Qn?X.LINEAR:X.NEAREST}}else{const Qn=a.layout.get("icon-size").constantOr(0)!==1||rt.iconsNeedLinear;Wt=Je.imageAtlasTexture,ii=mt||c.options.rotating||c.options.zooming||Qn||It?X.LINEAR:X.NEAREST,Ot=Je.imageAtlasTexture.size}const Mi=rt.projection.name==="globe",Qi=Mi?dt:Le,hn=Mi?s.globeToMercatorTransition(Z.zoom):0,ji=ar(Ae,rt.getProjection(),Z),Fn=Z.calculatePixelsToTileUnitsMatrix(Je),Vr=gi(ji,Je.tileID.canonical,H,W,Z,rt.getProjection(),Fn),so=c.terrain&&H&&G?s.invert(s.create(),Vr):ed,en=Br(ji,Je.tileID.canonical,H,W,Z,rt.getProjection(),Fn),nn=de&&rt.hasTextData(),_i=a.layout.get("icon-text-fit")!=="none"&&nn&&rt.hasIconData();if(G){const Qn=Z.elevation,ns=Qn?Qn.getAtTileOffsetFunc(Ae,Z.center.lat,Z.worldSize,rt.getProjection()):Na=>[0,0,0],ko=yi(ji,Je.tileID.canonical,H,W,Z,rt.getProjection(),Fn);pa(rt,ji,c,_,ko,en,H,k,ns,Ae)}const bn=G||_&&de||_i,Gn=c.translatePosMatrix(ji,Je,g,w),Xi=bn?ed:Vr,Zn=c.translatePosMatrix(en,Je,g,w,!0),Qo=rt.getProjection().createInversionMatrix(Z,Ae.canonical),Jn=[];c.terrain&&H&&Jn.push("PITCH_WITH_MAP_TERRAIN"),Mi&&Jn.push("PROJECTION_GLOBE_VIEW"),bn&&Jn.push("PROJECTED_POS_ON_VIEWPORT");const es=mt&&a.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ts;ts=mt?rt.iconsInText?Ms(it.kind,St,te,H,c,Gn,Xi,Zn,Ot,Vt,Ae,hn,oe,Qo,Qi,rt.getProjection()):au(it.kind,St,te,H,c,Gn,Xi,Zn,_,Ot,!0,Ae,hn,oe,Qo,Qi,rt.getProjection()):su(it.kind,St,te,H,c,Gn,Xi,Zn,_,Ot,Ae,hn,oe,Qo,Qi,rt.getProjection());const is={program:c.useProgram(td(mt,_,rt),je,Jn),buffers:wt,uniformValues:ts,atlasTexture:Wt,atlasTextureIcon:ai,atlasInterpolation:ii,atlasInterpolationIcon:xi,isSDF:mt,hasHalo:es,tile:Je,labelPlaneMatrixInv:so};if(K&&rt.canOverlap){fe=!0;const Qn=wt.segments.get();for(const ns of Qn)ye.push({segments:new s.SegmentVector([ns]),sortKey:ns.sortKey,state:is})}else ye.push({segments:wt.segments,sortKey:0,state:is})}fe&&ye.sort((Ae,Je)=>Ae.sortKey-Je.sortKey);for(const Ae of ye){const Je=Ae.state;if(c.terrain&&c.terrain.setupElevationDraw(Je.tile,Je.program,{useDepthForOcclusion:!le,labelPlaneMatrixInv:Je.labelPlaneMatrixInv}),j.activeTexture.set(X.TEXTURE0),Je.atlasTexture.bind(Je.atlasInterpolation,X.CLAMP_TO_EDGE),Je.atlasTextureIcon&&(j.activeTexture.set(X.TEXTURE1),Je.atlasTextureIcon&&Je.atlasTextureIcon.bind(Je.atlasInterpolationIcon,X.CLAMP_TO_EDGE)),Je.isSDF){const rt=Je.uniformValues;Je.hasHalo&&(rt.u_is_halo=1,hu(Je.buffers,Ae.segments,a,c,Je.program,he,z,R,rt)),rt.u_is_halo=0}hu(Je.buffers,Ae.segments,a,c,Je.program,he,z,R,Je.uniformValues)}}function hu(c,n,a,d,_,g,w,T,C){const k=d.context,z=[c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer,c.globeExtVertexBuffer];_.draw(k,k.gl.TRIANGLES,g,w,T,s.CullFaceMode.disabled,C,a.id,c.layoutVertexBuffer,c.indexBuffer,n,a.paint,d.transform.zoom,c.programConfigurations.get(a.id),z)}function Rl(c,n,a,d,_,g,w){const T=c.context.gl,C=a.paint.get("fill-pattern"),k=C&&C.constantOr(1),z=a.getCrossfadeParameters();let R,j,X,Z,W;w?(j=k&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=T.LINES):(j=k?"fillPattern":"fill",R=T.TRIANGLES);for(const H of d){const G=n.getTile(H);if(k&&!G.patternsLoaded())continue;const te=G.getBucket(a);if(!te)continue;c.prepareDrawTile();const K=te.programConfigurations.get(a.id),fe=c.useProgram(j,K);k&&(c.context.activeTexture.set(T.TEXTURE0),G.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),K.updatePaintBuffers(z));const he=C.constantOr(null);if(he&&G.imageAtlas){const de=G.imageAtlas,le=de.patternPositions[he.to.toString()],ye=de.patternPositions[he.from.toString()];le&&ye&&K.setConstantPatternPositions(le,ye)}const oe=c.translatePosMatrix(H.projMatrix,G,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(w){Z=te.indexBuffer2,W=te.segments2;const de=c.terrain&&c.terrain.renderingToTexture?c.terrain.drapeBufferSize:[T.drawingBufferWidth,T.drawingBufferHeight];X=j==="fillOutlinePattern"&&k?iu(oe,c,z,G,de):$r(oe,de)}else Z=te.indexBuffer,W=te.segments,X=k?kl(oe,c,z,G):Ea(oe);c.prepareDrawProgram(c.context,fe,H.toUnwrapped()),fe.draw(c.context,R,_,c.stencilModeForClipping(H),g,s.CullFaceMode.disabled,X,a.id,te.layoutVertexBuffer,Z,W,a.paint,c.transform.zoom,K)}}function no(c,n,a,d,_,g,w){const T=c.context,C=T.gl,k=c.transform,z=a.paint.get("fill-extrusion-pattern"),R=z.constantOr(1),j=a.getCrossfadeParameters(),X=a.paint.get("fill-extrusion-opacity"),Z=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),a.paint.get("fill-extrusion-ambient-occlusion-radius")],W=a.layout.get("fill-extrusion-edge-radius"),H=k.projection.name==="globe"?s.fillExtrusionHeightLift():0,G=k.projection.name==="globe",te=G?s.globeToMercatorTransition(k.zoom):0,K=[s.mercatorXfromLng(k.center.lng),s.mercatorYfromLat(k.center.lat)],fe=[];G&&(fe.push("PROJECTION_GLOBE_VIEW"),c.style.terrainSetForDrapingOnly()&&fe.push("TERRAIN")),Z[0]>0&&fe.push("FAUX_AO");for(const he of d){const oe=n.getTile(he),de=oe.getBucket(a);if(!de||de.projection.name!==k.projection.name)continue;const le=de.programConfigurations.get(a.id),ye=c.useProgram(R?"fillExtrusionPattern":"fillExtrusion",le,fe);if(c.terrain){const je=c.terrain;if(c.style.terrainSetForDrapingOnly())je.setupElevationDraw(oe,ye,{useMeterToDem:!0});else{if(!de.enableTerrain)continue;if(je.setupElevationDraw(oe,ye,{useMeterToDem:!0}),Sa(T,n,he,de,a,je),!de.centroidVertexBuffer){const mt=ye.attributes.a_centroid_pos;mt!==void 0&&C.vertexAttrib2f(mt,0,0)}}}R&&(c.context.activeTexture.set(C.TEXTURE0),oe.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),le.updatePaintBuffers(j));const Le=z.constantOr(null);if(Le&&oe.imageAtlas){const je=oe.imageAtlas,mt=je.patternPositions[Le.to.toString()],it=je.patternPositions[Le.from.toString()];mt&&it&&le.setConstantPatternPositions(mt,it)}const dt=c.translatePosMatrix(he.projMatrix,oe,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Ae=k.projection.createInversionMatrix(k,he.canonical),Je=a.paint.get("fill-extrusion-vertical-gradient"),rt=R?Wh(dt,c,Je,X,Z,W,he,j,oe,H,te,K,Ae):As(dt,c,Je,X,Z,W,he,H,te,K,Ae);c.prepareDrawProgram(T,ye,he.toUnwrapped());const wt=[];c.terrain&&wt.push(de.centroidVertexBuffer),G&&wt.push(de.layoutVertexExtBuffer),ye.draw(T,T.gl.TRIANGLES,_,g,w,s.CullFaceMode.backCCW,rt,a.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,a.paint,c.transform.zoom,le,wt)}}function Sa(c,n,a,d,_,g){const w=[G=>{let te=G.canonical.x-1,K=G.wrap;return te<0&&(te=(1<<G.canonical.z)-1,K--),new s.OverscaledTileID(G.overscaledZ,K,G.canonical.z,te,G.canonical.y)},G=>{let te=G.canonical.x+1,K=G.wrap;return te===1<<G.canonical.z&&(te=0,K++),new s.OverscaledTileID(G.overscaledZ,K,G.canonical.z,te,G.canonical.y)},G=>new s.OverscaledTileID(G.overscaledZ,G.wrap,G.canonical.z,G.canonical.x,(G.canonical.y===0?1<<G.canonical.z:G.canonical.y)-1),G=>new s.OverscaledTileID(G.overscaledZ,G.wrap,G.canonical.z,G.canonical.x,G.canonical.y===(1<<G.canonical.z)-1?0:G.canonical.y+1)],T=G=>{const te=n.getSource().minzoom,K=he=>{const oe=n.getTileByID(he);if(oe&&oe.hasData())return oe.getBucket(_)},fe=[0,-1,1];for(const he of fe){if(G.overscaledZ+he<te)continue;const oe=K(G.calculateScaledKey(G.overscaledZ+he));if(oe)return oe}},C=[0,0,0],k=(G,te)=>(C[0]=Math.min(G.min.y,te.min.y),C[1]=Math.max(G.max.y,te.max.y),C[2]=s.EXTENT-te.min.x>G.max.x?te.min.x-s.EXTENT:G.max.x,C),z=(G,te)=>(C[0]=Math.min(G.min.x,te.min.x),C[1]=Math.max(G.max.x,te.max.x),C[2]=s.EXTENT-te.min.y>G.max.y?te.min.y-s.EXTENT:G.max.y,C),R=[(G,te)=>k(G,te),(G,te)=>k(te,G),(G,te)=>z(G,te),(G,te)=>z(te,G)],j=new s.pointGeometry(0,0);let X,Z,W;const H=(G,te,K,fe,he)=>{const oe=[[fe?K:G,fe?G:K,0],[fe?K:te,fe?te:K,0]],de=he<0?s.EXTENT+he:he,le=[fe?de:(G+te)/2,fe?(G+te)/2:de,0];return K===0&&he<0||K!==0&&he>0?g.getForTilePoints(W,[le],!0,Z):oe.push(le),g.getForTilePoints(a,oe,!0,X),Math.max(oe[0][2],oe[1][2],le[2])/g.exaggeration()};for(let G=0;G<4;G++){const te=(G<2?1:5)-G,K=d.borders[G];if(K.length===0)continue;const fe=W=w[G](a),he=T(fe);if(!(he&&he instanceof s.FillExtrusionBucket&&he.enableTerrain)||d.borderDoneWithNeighborZ[G]===he.canonical.z&&he.borderDoneWithNeighborZ[te]===d.canonical.z||(Z=g.findDEMTileFor(fe),!Z||!Z.dem))continue;if(!X){const ye=g.findDEMTileFor(a);if(!ye||!ye.dem)return;X=ye}const oe=he.borders[te];let de=0;const le=he.borderDoneWithNeighborZ[te]!==d.canonical.z;if(d.canonical.z===he.canonical.z){for(let ye=0;ye<K.length;ye++){const Le=d.featuresOnBorder[K[ye]],dt=Le.borders[G];let Ae;for(;de<oe.length&&(Ae=he.featuresOnBorder[oe[de]],!(Ae.borders[te][1]>dt[0]+3));)le&&he.encodeCentroid(void 0,Ae,!1),de++;if(Ae&&de<oe.length){const Je=de;let rt=0;for(;!(Ae.borders[te][0]>dt[1]-3)&&(rt++,++de!==oe.length);)Ae=he.featuresOnBorder[oe[de]];if(Ae=he.featuresOnBorder[oe[Je]],Le.intersectsCount()>1||Ae.intersectsCount()>1||rt!==1){rt!==1&&(de=Je),d.encodeCentroid(void 0,Le,!1),le&&he.encodeCentroid(void 0,Ae,!1);continue}const wt=R[G](Le,Ae),je=G%2?s.EXTENT-1:0;j.x=H(wt[0],Math.min(s.EXTENT-1,wt[1]),je,G<2,wt[2]),j.y=0,d.encodeCentroid(j,Le,!1),le&&he.encodeCentroid(j,Ae,!1)}else d.encodeCentroid(void 0,Le,!1)}d.borderDoneWithNeighborZ[G]=he.canonical.z,d.needsCentroidUpdate=!0,le&&(he.borderDoneWithNeighborZ[te]=d.canonical.z,he.needsCentroidUpdate=!0)}else{for(const ye of K)d.encodeCentroid(void 0,d.featuresOnBorder[ye],!1);if(le){for(const ye of oe)he.encodeCentroid(void 0,he.featuresOnBorder[ye],!1);he.borderDoneWithNeighborZ[te]=d.canonical.z,he.needsCentroidUpdate=!0}d.borderDoneWithNeighborZ[G]=he.canonical.z,d.needsCentroidUpdate=!0}}(d.needsCentroidUpdate||!d.centroidVertexBuffer&&d.centroidVertexArray.length!==0)&&d.uploadCentroid(c)}const id=new s.Color(1,0,0,1),Is=new s.Color(0,1,0,1),ks=new s.Color(0,0,1,1),nd=new s.Color(1,0,1,1),du=new s.Color(0,1,1,1);function Ri(c,n,a){const d=c.context,_=c.transform,g=d.gl,w=_.projection.name==="globe",T=w?["PROJECTION_GLOBE_VIEW"]:null;let C=a.projMatrix;if(w&&s.globeToMercatorTransition(_.zoom)>0){const Le=s.transitionTileAABBinECEF(a.canonical,_),dt=s.globeDenormalizeECEF(Le);C=s.multiply(new Float32Array(16),_.globeMatrix,dt),s.multiply(C,_.projMatrix,C)}const k=c.useProgram("debug",null,T),z=n.getTileByID(a.key);c.terrain&&c.terrain.setupElevationDraw(z,k);const R=s.DepthMode.disabled,j=s.StencilMode.disabled,X=c.colorModeForRenderPass(),Z="$debug";d.activeTexture.set(g.TEXTURE0),c.emptyTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),w?z._makeGlobeTileDebugBuffers(c.context,_):z._makeDebugTileBoundsBuffers(c.context,_.projection);const W=z._tileDebugBuffer||c.debugBuffer,H=z._tileDebugIndexBuffer||c.debugIndexBuffer,G=z._tileDebugSegments||c.debugSegments;k.draw(d,g.LINE_STRIP,R,j,X,s.CullFaceMode.disabled,Kh(C,s.Color.red),Z,W,H,G,null,null,null,[z._globeTileDebugBorderBuffer]);const te=z.latestRawTileData,K=Math.floor((te&&te.byteLength||0)/1024),fe=n.getTile(a).tileSize,he=512/Math.min(fe,512)*(a.overscaledZ/_.zoom)*.5;let oe=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(oe+=` => ${a.overscaledZ}`),oe+=` ${K}kb`,function(Le,dt){Le.initDebugOverlayCanvas();const Ae=Le.debugOverlayCanvas,Je=Le.context.gl,rt=Le.debugOverlayCanvas.getContext("2d");rt.clearRect(0,0,Ae.width,Ae.height),rt.shadowColor="white",rt.shadowBlur=2,rt.lineWidth=1.5,rt.strokeStyle="white",rt.textBaseline="top",rt.font="bold 36px Open Sans, sans-serif",rt.fillText(dt,5,5),rt.strokeText(dt,5,5),Le.debugOverlayTexture.update(Ae),Le.debugOverlayTexture.bind(Je.LINEAR,Je.CLAMP_TO_EDGE)}(c,oe);const de=z._tileDebugTextBuffer||c.debugBuffer,le=z._tileDebugTextIndexBuffer||c.quadTriangleIndexBuffer,ye=z._tileDebugTextSegments||c.debugSegments;k.draw(d,g.TRIANGLES,R,j,s.ColorMode.alphaBlended,s.CullFaceMode.disabled,Kh(C,s.Color.transparent,he),Z,de,le,ye,null,null,null,[z._globeTileDebugTextBuffer])}function Ca(c,n,a,d){Aa(c,0,n+a/2,c.transform.width,a,d)}function rd(c,n,a,d){Aa(c,n-a/2,0,a,c.transform.height,d)}function Aa(c,n,a,d,_,g){const w=c.context,T=w.gl;T.enable(T.SCISSOR_TEST),T.scissor(n*s.exported.devicePixelRatio,a*s.exported.devicePixelRatio,d*s.exported.devicePixelRatio,_*s.exported.devicePixelRatio),w.clear({color:g}),T.disable(T.SCISSOR_TEST)}const Ma=s.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Bp}=Ma;function Io(c,n,a,d){c.emplaceBack(n,a,d)}class fu{constructor(n){this.vertexArray=new s.StructArrayLayout3f12,this.indices=new s.StructArrayLayout3ui6,Io(this.vertexArray,-1,-1,1),Io(this.vertexArray,1,-1,1),Io(this.vertexArray,-1,1,1),Io(this.vertexArray,1,1,1),Io(this.vertexArray,-1,-1,-1),Io(this.vertexArray,1,-1,-1),Io(this.vertexArray,-1,1,-1),Io(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,Bp),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=s.SegmentVector.simpleSegment(0,0,36,12)}}function zs(c,n,a,d,_,g){const w=c.gl,T=n.paint.get("sky-atmosphere-color"),C=n.paint.get("sky-atmosphere-halo-color"),k=n.paint.get("sky-atmosphere-sun-intensity"),z=((R,j,X,Z,W)=>({u_matrix_3f:R,u_sun_direction:j,u_sun_intensity:X,u_color_tint_r:[Z.r,Z.g,Z.b,Z.a],u_color_tint_m:[W.r,W.g,W.b,W.a],u_luminance:5e-5}))(s.fromMat4(s.create$1(),d),_,k,T,C);w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+g,n.skyboxTexture,0),a.draw(c,w.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.frontCW,z,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const pu=s.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Fl{constructor(n){const a=new s.StructArrayLayout5f20;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);const d=new s.StructArrayLayout3ui6;d.emplaceBack(0,1,2),d.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(a,pu.members),this.indexBuffer=n.createIndexBuffer(d),this.segments=s.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Ps={symbol:function(c,n,a,d,_){if(c.renderPass!=="translucent")return;const g=s.StencilMode.disabled,w=c.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(T,C,k,z,R,j,X){const Z=C.transform,W=R==="map",H=j==="map";for(const G of T){const te=z.getTile(G),K=te.getBucket(k);if(!K||!K.text||!K.text.segments.get().length)continue;const fe=s.evaluateSizeForZoom(K.textSizeData,Z.zoom),he=ar(G,K.getProjection(),Z),oe=Z.calculatePixelsToTileUnitsMatrix(te),de=gi(he,te.tileID.canonical,H,W,Z,K.getProjection(),oe),le=k.layout.get("icon-text-fit")!=="none"&&K.hasIconData();if(fe){const ye=Math.pow(2,Z.zoom-te.tileID.overscaledZ);cu(K,W,H,X,s.symbolSize,Z,de,G,ye,fe,le)}}}(d,c,a,n,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),_),a.paint.get("icon-opacity").constantOr(1)!==0&&uu(c,n,a,d,!1,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),a.layout.get("icon-rotation-alignment"),a.layout.get("icon-pitch-alignment"),a.layout.get("icon-keep-upright"),g,w),a.paint.get("text-opacity").constantOr(1)!==0&&uu(c,n,a,d,!0,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),a.layout.get("text-keep-upright"),g,w),n.map.showCollisionBoxes&&(Qh(c,n,a,d,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),Qh(c,n,a,d,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(c,n,a,d){if(c.renderPass!=="translucent")return;const _=a.paint.get("circle-opacity"),g=a.paint.get("circle-stroke-width"),w=a.paint.get("circle-stroke-opacity"),T=a.layout.get("circle-sort-key").constantOr(1)!==void 0;if(_.constantOr(1)===0&&(g.constantOr(1)===0||w.constantOr(1)===0))return;const C=c.context,k=C.gl,z=c.transform,R=c.depthModeForSublayer(0,s.DepthMode.ReadOnly),j=s.StencilMode.disabled,X=c.colorModeForRenderPass(),Z=z.projection.name==="globe",W=[s.mercatorXfromLng(z.center.lng),s.mercatorYfromLat(z.center.lat)],H=[];for(let te=0;te<d.length;te++){const K=d[te],fe=n.getTile(K),he=fe.getBucket(a);if(!he||he.projection.name!==z.projection.name)continue;const oe=he.programConfigurations.get(a.id),de=Xh(a);Z&&de.push("PROJECTION_GLOBE_VIEW");const le=c.useProgram("circle",oe,de),ye=he.layoutVertexBuffer,Le=he.globeExtVertexBuffer,dt=he.indexBuffer,Ae=z.projection.createInversionMatrix(z,K.canonical),Je={programConfiguration:oe,program:le,layoutVertexBuffer:ye,globeExtVertexBuffer:Le,indexBuffer:dt,uniformValues:nu(c,K,fe,Ae,W,a),tile:fe};if(T){const rt=he.segments.get();for(const wt of rt)H.push({segments:new s.SegmentVector([wt]),sortKey:wt.sortKey,state:Je})}else H.push({segments:he.segments,sortKey:0,state:Je})}T&&H.sort((te,K)=>te.sortKey-K.sortKey);const G={useDepthForOcclusion:!Z};for(const te of H){const{programConfiguration:K,program:fe,layoutVertexBuffer:he,globeExtVertexBuffer:oe,indexBuffer:de,uniformValues:le,tile:ye}=te.state,Le=te.segments;c.terrain&&c.terrain.setupElevationDraw(ye,fe,G),c.prepareDrawProgram(C,fe,ye.tileID.toUnwrapped()),fe.draw(C,k.TRIANGLES,R,j,X,s.CullFaceMode.disabled,le,a.id,he,de,Le,a.paint,z.zoom,K,[oe])}},heatmap:function(c,n,a,d){if(a.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){const _=c.context,g=_.gl,w=s.StencilMode.disabled,T=new s.ColorMode([g.ONE,g.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(X,Z,W,H){const G=X.gl,te=Z.width*H,K=Z.height*H;X.activeTexture.set(G.TEXTURE1),X.viewport.set([0,0,te,K]);let fe=W.heatmapFbo;if(!fe||fe&&(fe.width!==te||fe.height!==K)){fe&&fe.destroy();const he=G.createTexture();G.bindTexture(G.TEXTURE_2D,he),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MAG_FILTER,G.LINEAR),fe=W.heatmapFbo=X.createFramebuffer(te,K,!1),function(oe,de,le,ye,Le,dt){const Ae=oe.gl;Ae.texImage2D(Ae.TEXTURE_2D,0,Ae.RGBA,Le,dt,0,Ae.RGBA,oe.extRenderToTextureHalfFloat?oe.extTextureHalfFloat.HALF_FLOAT_OES:Ae.UNSIGNED_BYTE,null),ye.colorAttachment.set(le)}(X,0,he,fe,te,K)}else G.bindTexture(G.TEXTURE_2D,fe.colorAttachment.get()),X.bindFramebuffer.set(fe.framebuffer)})(_,c,a,c.transform.projection.name==="globe"?.5:.25),_.clear({color:s.Color.transparent});const C=c.transform,k=C.projection.name==="globe",z=k?["PROJECTION_GLOBE_VIEW"]:null,R=k?s.CullFaceMode.frontCCW:s.CullFaceMode.disabled,j=[s.mercatorXfromLng(C.center.lng),s.mercatorYfromLat(C.center.lat)];for(let X=0;X<d.length;X++){const Z=d[X];if(n.hasRenderableParent(Z))continue;const W=n.getTile(Z),H=W.getBucket(a);if(!H||H.projection.name!==C.projection.name)continue;const G=H.programConfigurations.get(a.id),te=c.useProgram("heatmap",G,z),{zoom:K}=c.transform;c.terrain&&c.terrain.setupElevationDraw(W,te),c.prepareDrawProgram(_,te,Z.toUnwrapped());const fe=C.projection.createInversionMatrix(C,Z.canonical);te.draw(_,g.TRIANGLES,s.DepthMode.disabled,w,T,R,Ip(c,Z,W,fe,j,K,a.paint.get("heatmap-intensity")),a.id,H.layoutVertexBuffer,H.indexBuffer,H.segments,a.paint,c.transform.zoom,G,k?[H.globeExtVertexBuffer]:null)}_.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(_,g){const w=_.context,T=w.gl,C=g.heatmapFbo;if(!C)return;w.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,C.colorAttachment.get()),w.activeTexture.set(T.TEXTURE1);let k=g.colorRampTexture;k||(k=g.colorRampTexture=new s.Texture(w,g.colorRamp,T.RGBA)),k.bind(T.LINEAR,T.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(w,T.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,_.colorModeForRenderPass(),s.CullFaceMode.disabled,((z,R,j,X)=>({u_image:0,u_color_ramp:1,u_opacity:R.paint.get("heatmap-opacity")}))(0,g),g.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,g.paint,_.transform.zoom)}(c,a))},line:function(c,n,a,d){if(c.renderPass!=="translucent")return;const _=a.paint.get("line-opacity"),g=a.paint.get("line-width");if(_.constantOr(1)===0||g.constantOr(1)===0)return;const w=c.depthModeForSublayer(0,s.DepthMode.ReadOnly),T=c.colorModeForRenderPass(),C=c.terrain&&c.terrain.renderingToTexture?1:s.exported.devicePixelRatio,k=a.paint.get("line-dasharray"),z=k.constantOr(1),R=a.layout.get("line-cap"),j=a.paint.get("line-pattern"),X=j.constantOr(1),Z=a.paint.get("line-gradient"),W=a.getCrossfadeParameters(),H=X?"linePattern":"line",G=c.context,te=G.gl,K=(he=>{const oe=[];Dl(he)&&oe.push("RENDER_LINE_DASH"),he.paint.get("line-gradient")&&oe.push("RENDER_LINE_GRADIENT");const de=he.paint.get("line-trim-offset");de[0]===0&&de[1]===0||oe.push("RENDER_LINE_TRIM_OFFSET");const le=he.paint.get("line-pattern").constantOr(1),ye=he.paint.get("line-opacity").constantOr(1)!==1;return!le&&ye&&oe.push("RENDER_LINE_ALPHA_DISCARD"),oe})(a);let fe=K.includes("RENDER_LINE_ALPHA_DISCARD");c.terrain&&c.terrain.clipOrMaskOverlapStencilType()&&(fe=!1);for(const he of d){const oe=n.getTile(he);if(X&&!oe.patternsLoaded())continue;const de=oe.getBucket(a);if(!de)continue;c.prepareDrawTile();const le=de.programConfigurations.get(a.id),ye=c.useProgram(H,le,K),Le=j.constantOr(null);if(Le&&oe.imageAtlas){const it=oe.imageAtlas,It=it.patternPositions[Le.to.toString()],St=it.patternPositions[Le.from.toString()];It&&St&&le.setConstantPatternPositions(It,St)}const dt=k.constantOr(null),Ae=R.constantOr(null);if(!X&&dt&&Ae&&oe.lineAtlas){const it=oe.lineAtlas,It=it.getDash(dt.to,Ae),St=it.getDash(dt.from,Ae);It&&St&&le.setConstantPatternPositions(It,St)}let[Je,rt]=a.paint.get("line-trim-offset");(Ae==="round"||Ae==="square")&&Je!==rt&&(Je===0&&(Je-=1),rt===1&&(rt+=1));const wt=c.terrain?he.projMatrix:null,je=X?kp(c,oe,a,W,wt,C):zl(c,oe,a,W,wt,de.lineClipsArray.length,C,[Je,rt]);if(Z){const it=de.gradients[a.id];let It=it.texture;if(a.gradientVersion!==it.version){let St=256;if(a.stepInterpolant){const Ot=n.getSource().maxzoom,Wt=he.canonical.z===Ot?Math.ceil(1<<c.transform.maxZoom-he.canonical.z):1;St=s.clamp(s.nextPowerOfTwo(de.maxLineLength/s.EXTENT*1024*Wt),256,G.maxTextureSize)}it.gradient=s.renderColorRamp({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:St,image:it.gradient||void 0,clips:de.lineClipsArray}),it.texture?it.texture.update(it.gradient):it.texture=new s.Texture(G,it.gradient,te.RGBA),it.version=a.gradientVersion,It=it.texture}G.activeTexture.set(te.TEXTURE1),It.bind(a.stepInterpolant?te.NEAREST:te.LINEAR,te.CLAMP_TO_EDGE)}z&&(G.activeTexture.set(te.TEXTURE0),oe.lineAtlasTexture.bind(te.LINEAR,te.REPEAT),le.updatePaintBuffers(W)),X&&(G.activeTexture.set(te.TEXTURE0),oe.imageAtlasTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE),le.updatePaintBuffers(W)),c.prepareDrawProgram(G,ye,he.toUnwrapped());const mt=it=>{ye.draw(G,te.TRIANGLES,w,it,T,s.CullFaceMode.disabled,je,a.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,a.paint,c.transform.zoom,le,[de.layoutVertexBuffer2])};if(fe){const it=c.stencilModeForClipping(he).ref;it===0&&c.terrain&&G.clear({stencil:0});const It={func:te.EQUAL,mask:255};je.u_alpha_discard_threshold=.8,mt(new s.StencilMode(It,it,255,te.KEEP,te.KEEP,te.INVERT)),je.u_alpha_discard_threshold=0,mt(new s.StencilMode(It,it,255,te.KEEP,te.KEEP,te.KEEP))}else mt(c.stencilModeForClipping(he))}fe&&(c.resetStencilClippingMasks(),c.terrain&&G.clear({stencil:0}))},fill:function(c,n,a,d){const _=a.paint.get("fill-color"),g=a.paint.get("fill-opacity");if(g.constantOr(1)===0)return;const w=c.colorModeForRenderPass(),T=a.paint.get("fill-pattern"),C=c.opaquePassEnabledForLayer()&&!T.constantOr(1)&&_.constantOr(s.Color.transparent).a===1&&g.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===C){const k=c.depthModeForSublayer(1,c.renderPass==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly);Rl(c,n,a,d,k,w,!1)}if(c.renderPass==="translucent"&&a.paint.get("fill-antialias")){const k=c.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,s.DepthMode.ReadOnly);Rl(c,n,a,d,k,w,!0)}},"fill-extrusion":function(c,n,a,d){const _=a.paint.get("fill-extrusion-opacity");if(_!==0&&c.renderPass==="translucent"){const g=new s.DepthMode(c.context.gl.LEQUAL,s.DepthMode.ReadWrite,c.depthRangeFor3D);if(_!==1||a.paint.get("fill-extrusion-pattern").constantOr(1))no(c,n,a,d,g,s.StencilMode.disabled,s.ColorMode.disabled),no(c,n,a,d,g,c.stencilModeFor3D(),c.colorModeForRenderPass()),c.resetStencilClippingMasks();else{const w=c.colorModeForRenderPass();no(c,n,a,d,g,s.StencilMode.disabled,w)}}},hillshade:function(c,n,a,d){if(c.renderPass!=="offscreen"&&c.renderPass!=="translucent")return;const _=c.context,g=c.depthModeForSublayer(0,s.DepthMode.ReadOnly),w=c.colorModeForRenderPass(),T=c.terrain&&c.terrain.renderingToTexture,[C,k]=c.renderPass!=="translucent"||T?[{},d]:c.stencilConfigForOverlap(d);for(const z of k){const R=n.getTile(z);if(R.needsHillshadePrepare&&c.renderPass==="offscreen")Cs(c,R,a,g,s.StencilMode.disabled,w);else if(c.renderPass==="translucent"){const j=T&&c.terrain?c.terrain.stencilModeForRTTOverlap(z):C[z.overscaledZ];Hc(c,z,R,a,g,j,w)}}_.viewport.set([0,0,c.width,c.height]),c.resetStencilClippingMasks()},raster:function(c,n,a,d,_,g){if(c.renderPass!=="translucent"||a.paint.get("raster-opacity")===0||!d.length)return;const w=c.context,T=w.gl,C=n.getSource(),k=c.useProgram("raster"),z=c.colorModeForRenderPass(),R=c.terrain&&c.terrain.renderingToTexture,[j,X]=C instanceof Ee||R?[{},d]:c.stencilConfigForOverlap(d),Z=X[X.length-1].overscaledZ,W=!c.options.moving;for(const H of X){const G=R?s.DepthMode.disabled:c.depthModeForSublayer(H.overscaledZ-Z,a.paint.get("raster-opacity")===1?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly,T.LESS),te=H.toUnwrapped(),K=n.getTile(H);if(R&&(!K||!K.hasData()))continue;const fe=R?H.projMatrix:c.transform.calculateProjMatrix(te,W),he=c.terrain&&R?c.terrain.stencilModeForRTTOverlap(H):j[H.overscaledZ],oe=g?0:a.paint.get("raster-fade-duration");K.registerFadeDuration(oe);const de=n.findLoadedParent(H,0),le=Ml(K,de,n,c.transform,oe);let ye,Le;c.terrain&&c.terrain.prepareDrawTile();const dt=a.paint.get("raster-resampling")==="nearest"?T.NEAREST:T.LINEAR;w.activeTexture.set(T.TEXTURE0),K.texture.bind(dt,T.CLAMP_TO_EDGE),w.activeTexture.set(T.TEXTURE1),de?(de.texture.bind(dt,T.CLAMP_TO_EDGE),ye=Math.pow(2,de.tileID.overscaledZ-K.tileID.overscaledZ),Le=[K.tileID.canonical.x*ye%1,K.tileID.canonical.y*ye%1]):K.texture.bind(dt,T.CLAMP_TO_EDGE);const Ae=zp(fe,Le||[0,0],ye||1,le,a,C instanceof Ee?C.perspectiveTransform:[0,0]);if(c.prepareDrawProgram(w,k,te),C instanceof Ee)C.boundsBuffer&&C.boundsSegments&&k.draw(w,T.TRIANGLES,G,s.StencilMode.disabled,z,s.CullFaceMode.disabled,Ae,a.id,C.boundsBuffer,c.quadTriangleIndexBuffer,C.boundsSegments);else{const{tileBoundsBuffer:Je,tileBoundsIndexBuffer:rt,tileBoundsSegments:wt}=c.getTileBoundsBuffers(K);k.draw(w,T.TRIANGLES,G,he,z,s.CullFaceMode.disabled,Ae,a.id,Je,rt,wt)}}c.resetStencilClippingMasks()},background:function(c,n,a,d){const _=a.paint.get("background-color"),g=a.paint.get("background-opacity");if(g===0)return;const w=c.context,T=w.gl,C=c.transform,k=C.tileSize,z=a.paint.get("background-pattern");if(c.isPatternMissing(z))return;const R=!z&&_.a===1&&g===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass!==R)return;const j=s.StencilMode.disabled,X=c.depthModeForSublayer(0,R==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly),Z=c.colorModeForRenderPass(),W=c.useProgram(z?"backgroundPattern":"background");let H,G=d;G||(H=c.getBackgroundTiles(),G=Object.values(H).map(K=>K.tileID)),z&&(w.activeTexture.set(T.TEXTURE0),c.imageManager.bind(c.context));const te=a.getCrossfadeParameters();for(const K of G){const fe=K.toUnwrapped(),he=d?K.projMatrix:c.transform.calculateProjMatrix(fe);c.prepareDrawTile();const oe=n?n.getTile(K):H?H[K.key]:new s.Tile(K,k,C.zoom,c),de=z?Dp(he,g,c,z,{tileID:K,tileSize:k},te):Pp(he,g,_);c.prepareDrawProgram(w,W,fe);const{tileBoundsBuffer:le,tileBoundsIndexBuffer:ye,tileBoundsSegments:Le}=c.getTileBoundsBuffers(oe);W.draw(w,T.TRIANGLES,X,j,Z,s.CullFaceMode.disabled,de,a.id,le,ye,Le)}},sky:function(c,n,a){const d=c.transform,_=d.projection.name==="mercator"||d.projection.name==="globe"?1:s.smoothstep(7,8,d.zoom),g=a.paint.get("sky-opacity")*_;if(g===0)return;const w=c.context,T=a.paint.get("sky-type"),C=new s.DepthMode(w.gl.LEQUAL,s.DepthMode.ReadOnly,[0,1]),k=c.frameCounter/1e3%1;T==="atmosphere"?c.renderPass==="offscreen"?a.needsSkyboxCapture(c)&&(function(z,R,j,X){const Z=z.context,W=Z.gl;let H=R.skyboxFbo;if(!H){H=R.skyboxFbo=Z.createFramebuffer(32,32,!1),R.skyboxGeometry=new fu(Z),R.skyboxTexture=Z.gl.createTexture(),W.bindTexture(W.TEXTURE_CUBE_MAP,R.skyboxTexture),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MAG_FILTER,W.LINEAR);for(let fe=0;fe<6;++fe)W.texImage2D(W.TEXTURE_CUBE_MAP_POSITIVE_X+fe,0,W.RGBA,32,32,0,W.RGBA,W.UNSIGNED_BYTE,null)}Z.bindFramebuffer.set(H.framebuffer),Z.viewport.set([0,0,32,32]);const G=R.getCenter(z,!0),te=z.useProgram("skyboxCapture"),K=new Float64Array(16);s.identity(K),s.rotateY(K,K,.5*-Math.PI),zs(Z,R,te,K,G,0),s.identity(K),s.rotateY(K,K,.5*Math.PI),zs(Z,R,te,K,G,1),s.identity(K),s.rotateX(K,K,.5*-Math.PI),zs(Z,R,te,K,G,2),s.identity(K),s.rotateX(K,K,.5*Math.PI),zs(Z,R,te,K,G,3),s.identity(K),zs(Z,R,te,K,G,4),s.identity(K),s.rotateY(K,K,Math.PI),zs(Z,R,te,K,G,5),Z.viewport.set([0,0,z.width,z.height])}(c,a),a.markSkyboxValid(c)):c.renderPass==="sky"&&function(z,R,j,X,Z){const W=z.context,H=W.gl,G=z.transform,te=z.useProgram("skybox");W.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_CUBE_MAP,R.skyboxTexture);const K=((fe,he,oe,de,le)=>({u_matrix:fe,u_sun_direction:he,u_cubemap:0,u_opacity:de,u_temporal_offset:le}))(G.skyboxMatrix,R.getCenter(z,!1),0,X,Z);z.prepareDrawProgram(W,te),te.draw(W,H.TRIANGLES,j,s.StencilMode.disabled,z.colorModeForRenderPass(),s.CullFaceMode.backCW,K,"skybox",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(c,a,C,g,k):T==="gradient"&&c.renderPass==="sky"&&function(z,R,j,X,Z){const W=z.context,H=W.gl,G=z.transform,te=z.useProgram("skyboxGradient");R.skyboxGeometry||(R.skyboxGeometry=new fu(W)),W.activeTexture.set(H.TEXTURE0);let K=R.colorRampTexture;K||(K=R.colorRampTexture=new s.Texture(W,R.colorRamp,H.RGBA)),K.bind(H.LINEAR,H.CLAMP_TO_EDGE);const fe=((he,oe,de,le,ye)=>({u_matrix:he,u_color_ramp:0,u_center_direction:oe,u_radius:s.degToRad(de),u_opacity:le,u_temporal_offset:ye}))(G.skyboxMatrix,R.getCenter(z,!1),R.paint.get("sky-gradient-radius"),X,Z);z.prepareDrawProgram(W,te),te.draw(W,H.TRIANGLES,j,s.StencilMode.disabled,z.colorModeForRenderPass(),s.CullFaceMode.backCW,fe,"skyboxGradient",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(c,a,C,g,k)},debug:function(c,n,a){for(let d=0;d<a.length;d++)Ri(c,n,a[d])},custom:function(c,n,a){const d=c.context,_=a.implementation;if(c.transform.projection.unsupportedLayers&&c.transform.projection.unsupportedLayers.includes("custom"))s.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(c.renderPass==="offscreen"){const g=_.prerender;g&&(c.setCustomLayerDefaults(),d.setColorMode(c.colorModeForRenderPass()),g.call(_,d.gl,c.transform.customLayerMatrix()),d.setDirty(),c.setBaseState())}else if(c.renderPass==="translucent"){c.setCustomLayerDefaults(),d.setColorMode(c.colorModeForRenderPass()),d.setStencilMode(s.StencilMode.disabled);const g=_.renderingMode==="3d"?new s.DepthMode(c.context.gl.LEQUAL,s.DepthMode.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,s.DepthMode.ReadOnly);d.setDepthMode(g),_.render(d.gl,c.transform.customLayerMatrix()),d.setDirty(),c.setBaseState(),d.bindFramebuffer.set(null)}}};class mu{constructor(n,a){this.context=new J(n),this.transform=a,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=s.SourceCache.maxUnderzooming+s.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new bl,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(n,a){const d=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(d||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Gh(this,n));const _=this._terrain;this.transform.elevation=d?_:null,_.update(n,this.transform,a)}_updateFog(n){const a=n.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[d,_]=a.getFovAdjustedRange(this.transform._fov);if(d>_)return void(this.transform.fogCullDistSq=null);const g=d+.78*(_-d);this.transform.fogCullDistSq=g*g}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(n,a){if(this.width=n*s.exported.devicePixelRatio,this.height=a*s.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style.order)this.style._layers[d].resize()}setup(){const n=this.context,a=new s.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(s.EXTENT,0),a.emplaceBack(0,s.EXTENT),a.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(a,s.posAttributes.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);const d=new s.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(s.EXTENT,0),d.emplaceBack(0,s.EXTENT),d.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=n.createVertexBuffer(d,s.posAttributes.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);const _=new s.StructArrayLayout2i4;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(_,s.posAttributes.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);const g=new s.StructArrayLayout4i8;g.emplaceBack(0,0,0,0),g.emplaceBack(s.EXTENT,0,s.EXTENT,0),g.emplaceBack(0,s.EXTENT,0,s.EXTENT),g.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.mercatorBoundsBuffer=n.createVertexBuffer(g,s.boundsAttributes.members),this.mercatorBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);const w=new s.StructArrayLayout3ui6;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(w);const T=new s.StructArrayLayout1ui2;for(const k of[0,1,3,2,0])T.emplaceBack(k);this.debugIndexBuffer=n.createIndexBuffer(T),this.emptyTexture=new s.Texture(n,new s.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA),this.identityMat=s.create();const C=this.context.gl;this.stencilClearMode=new s.StencilMode({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.loadTimeStamps.push(s.window.performance.now()),this.atmosphereBuffer=new Fl(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context,a=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(n,a.TRIANGLES,s.DepthMode.disabled,this.stencilClearMode,s.ColorMode.disabled,s.CullFaceMode.disabled,Jc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,a,d){if(!a||this.currentStencilSource===a.id||!n.isTileClipped()||!d||d.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let T=!1;for(const C of d)if(this._tileClippingMaskIDs[C.key]===void 0){T=!0;break}if(!T)return}this.currentStencilSource=a.id;const _=this.context,g=_.gl;this.nextStencilID+d.length>256&&this.clearStencil(),_.setColorMode(s.ColorMode.disabled),_.setDepthMode(s.DepthMode.disabled);const w=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const T of d){const C=a.getTile(T),k=this._tileClippingMaskIDs[T.key]=this.nextStencilID++,{tileBoundsBuffer:z,tileBoundsIndexBuffer:R,tileBoundsSegments:j}=this.getTileBoundsBuffers(C);w.draw(_,g.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:g.ALWAYS,mask:0},k,255,g.KEEP,g.KEEP,g.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,Jc(T.projMatrix),"$clipping",z,R,j)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,a=this.context.gl;return new s.StencilMode({func:a.NOTEQUAL,mask:255},n,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const a=this.context.gl;return new s.StencilMode({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(n){const a=this.context.gl,d=n.sort((w,T)=>T.overscaledZ-w.overscaledZ),_=d[d.length-1].overscaledZ,g=d[0].overscaledZ-_+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const w={};for(let T=0;T<g;T++)w[T+_]=new s.StencilMode({func:a.GEQUAL,mask:255},T+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=g,[w,d]}return[{[_]:s.StencilMode.disabled},d]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new s.ColorMode([n.CONSTANT_COLOR,n.ONE],new s.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?s.ColorMode.unblended:s.ColorMode.alphaBlended}depthModeForSublayer(n,a,d){if(!this.opaquePassEnabledForLayer())return s.DepthMode.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new s.DepthMode(d||this.context.gl.LEQUAL,a,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,a){this.style=n,this.options=a,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(s.exported.now()),this.imageManager.beginFrame();const d=this.style.order,_=this.style._sourceCaches;for(const C in _){const k=_[C];k.used&&k.prepare(this.context)}const g={},w={},T={};for(const C in _){const k=_[C];g[C]=k.getVisibleCoordinates(),w[C]=g[C].slice().reverse(),T[C]=k.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let C=0;C<d.length;C++)if(this.style._layers[d[C]].is3D()){this.opaquePassCutoff=C;break}if(this.terrain&&(this.terrain.updateTileBinding(T),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.GlobeSharedBuffers(this.context)),s.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const C of d){const k=this.style._layers[C],z=n._getLayerSourceCache(k);if(!k.hasOffscreenPass()||k.isHidden(this.transform.zoom))continue;const R=z?w[z.id]:void 0;(k.type==="custom"||k.isSky()||R&&R.length)&&this.renderLayer(this,z,k,R)}if(this.depthRangeFor3D=[0,1-(n.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:a.showOverdrawInspector?s.Color.black:s.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){const C=this.style._layers[d[this.currentLayer]],k=n._getLayerSourceCache(C);if(C.isSky())continue;const z=k?w[k.id]:void 0;this._renderTileClippingMasks(C,k,z),this.renderLayer(this,k,C,z)}if(this.style.fog&&this.transform.projection.supportsFog&&function(C,k){const z=C.context,R=z.gl,j=C.transform,X=new s.DepthMode(R.LEQUAL,s.DepthMode.ReadOnly,[0,1]),Z=C.useProgram("globeAtmosphere",null,j.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),W=s.globeToMercatorTransition(j.zoom),H=k.properties.get("color").toArray01(),G=k.properties.get("high-color").toArray01(),te=k.properties.get("space-color").toArray01PremultipliedAlpha(),K=s.identity$1([]);s.rotateY$1(K,K,-s.degToRad(j._center.lng)),s.rotateX$1(K,K,s.degToRad(j._center.lat)),s.rotateZ$1(K,K,j.angle),s.rotateX$1(K,K,-j._pitch);const fe=s.fromQuat(new Float32Array(16),K),he=s.mapValue(k.properties.get("star-intensity"),0,1,0,.25),oe=5e-4,de=s.mapValue(k.properties.get("horizon-blend"),0,1,oe,.25),le=s.globeUseCustomAntiAliasing(C,z,j)&&de===oe?j.worldSize/(2*Math.PI*1.025)-1:j.globeRadius,ye=C.frameCounter/1e3%1,Le=s.length(j.globeCenterInViewSpace),dt=Math.sqrt(Math.pow(Le,2)-Math.pow(le,2)),Ae=Math.acos(dt/Le),Je=((wt,je,mt,it,It,St,Ot,Wt,ii,xi,Vt,ai,Mi,Qi)=>({u_frustum_tl:wt,u_frustum_tr:je,u_frustum_br:mt,u_frustum_bl:it,u_horizon:It,u_transition:St,u_fadeout_range:Ot,u_color:Wt,u_high_color:ii,u_space_color:xi,u_star_intensity:Vt,u_star_size:5*s.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:ai,u_horizon_angle:Mi,u_rotation_matrix:Qi}))(j.frustumCorners.TL,j.frustumCorners.TR,j.frustumCorners.BR,j.frustumCorners.BL,j.frustumCorners.horizon,W,de,H,G,te,he,ye,Ae,fe);C.prepareDrawProgram(z,Z);const rt=C.atmosphereBuffer;rt&&Z.draw(z,R.TRIANGLES,X,s.StencilMode.disabled,s.ColorMode.alphaBlended,s.CullFaceMode.backCW,Je,"skybox",rt.vertexBuffer,rt.indexBuffer,rt.segments)}(this,this.style.fog),this.renderPass="sky",(s.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){const C=this.style._layers[d[this.currentLayer]],k=n._getLayerSourceCache(C);C.isSky()&&this.renderLayer(this,k,C,k?w[k.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;){const C=this.style._layers[d[this.currentLayer]],k=n._getLayerSourceCache(C);if(C.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(C)){if(C.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const z=k?(C.type==="symbol"?T:w)[k.id]:void 0;this._renderTileClippingMasks(C,k,k?g[k.id]:void 0),this.renderLayer(this,k,C,z),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let C=null;s.values(this.style._layers).forEach(k=>{const z=n._getLayerSourceCache(k);z&&!k.isHidden(this.transform.zoom)&&(!C||C.getSource().maxzoom<z.getSource().maxzoom)&&(C=z)}),C&&this.options.showTileBoundaries&&Ps.debug(this,C,C.getVisibleCoordinates())}this.options.showPadding&&function(C){const k=C.transform.padding;Ca(C,C.transform.height-(k.top||0),3,id),Ca(C,k.bottom||0,3,Is),rd(C,k.left||0,3,ks),rd(C,C.transform.width-(k.right||0),3,nd);const z=C.transform.centerPoint;(function(R,j,X,Z){Aa(R,j-1,X-10,2,20,Z),Aa(R,j-10,X-1,20,2,Z)})(C,z.x,C.transform.height-z.y,du)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(s.window.performance.now()),this.saveCanvasCopy())}}renderLayer(n,a,d,_){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="sky"||d.type==="custom"||_&&_.length)&&(this.id=d.id,this.gpuTimingStart(d),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(d.type)||Ps[d.type](n,a,d,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;let d=this.gpuTimers[n.id];d||(d=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:a.createQueryEXT()}),d.calls++,a.beginQueryEXT(a.TIME_ELAPSED_EXT,d.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,a=n.createQueryEXT();this.deferredRenderGpuTimeQueries.push(a),n.beginQueryEXT(n.TIME_ELAPSED_EXT,a)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const a={};for(const d in n){const _=n[d],g=this.context.extTimerQuery,w=g.getQueryObjectEXT(_.query,g.QUERY_RESULT_EXT)/1e6;g.deleteQueryEXT(_.query),a[d]=w}return a}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const a=this.context.extTimerQuery;let d=0;for(const _ of n)d+=a.getQueryObjectEXT(_,a.QUERY_RESULT_EXT)/1e6,a.deleteQueryEXT(_);return d}translatePosMatrix(n,a,d,_,g){if(!d[0]&&!d[1])return n;const w=g?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(w){const k=Math.sin(w),z=Math.cos(w);d=[d[0]*z-d[1]*k,d[0]*k+d[1]*z]}const T=[g?d[0]:pi(a,d[0],this.transform.zoom),g?d[1]:pi(a,d[1],this.transform.zoom),0],C=new Float32Array(16);return s.translate(C,n,T),C}saveTileTexture(n){const a=this._tileTextures[n.size[0]];a?a.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const a=this._tileTextures[n];return a&&a.length>0?a.pop():null}isPatternMissing(n){if(!n)return!1;if(!n.from||!n.to)return!0;const a=this.imageManager.getPattern(n.from.toString()),d=this.imageManager.getPattern(n.to.toString());return!a||!d}currentGlobalDefines(){const n=this.terrain&&this.terrain.renderingToTexture,a=this.style&&this.style.fog,d=[];return this.terrain&&!this.terrain.renderingToTexture&&d.push("TERRAIN"),a&&!n&&a.getOpacity(this.transform.pitch)!==0&&d.push("FOG"),n&&d.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&d.push("OVERDRAW_INSPECTOR"),d}useProgram(n,a,d){this.cache=this.cache||{};const _=d||[],g=this.currentGlobalDefines().concat(_),w=tu.cacheKey(Cl[n],n,g,a);return this.cache[w]||(this.cache[w]=new tu(this.context,n,Cl[n],a,Lp[n],g)),this.cache[w]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=s.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(n,a,d){if(this.terrain&&this.terrain.renderingToTexture)return;const _=this.style.fog;if(_){const g=_.getOpacity(this.transform.pitch),w=((T,C,k,z,R,j,X,Z,W,H,G)=>{const te=T.transform,K=C.properties.get("color").toArray01();K[3]=z;const fe=T.frameCounter/1e3%1;return{u_fog_matrix:k?te.calculateFogTileMatrix(k):T.identityMat,u_fog_range:C.getFovAdjustedRange(te._fov),u_fog_color:K,u_fog_horizon_blend:C.properties.get("horizon-blend"),u_fog_temporal_offset:fe,u_frustum_tl:R,u_frustum_tr:j,u_frustum_br:X,u_frustum_bl:Z,u_globe_pos:W,u_globe_radius:H,u_viewport:G,u_globe_transition:s.globeToMercatorTransition(te.zoom),u_is_globe:+(te.projection.name==="globe")}})(this,_,d,g,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.exported.devicePixelRatio,this.transform.height*s.exported.devicePixelRatio]);a.setFogUniformValues(n,w)}}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const n=this.context.gl,a=n.createTexture();return n.bindTexture(n.TEXTURE_2D,a),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,a=this._backgroundTiles={},d=this.transform.coveringTiles({tileSize:512});for(const _ of d)a[_.key]=n[_.key]||new s.Tile(_,512,this.transform.tileZoom,this);return a}clearBackgroundTiles(){this._backgroundTiles={}}}class Ia{constructor(n=0,a=0,d=0,_=0){if(isNaN(n)||n<0||isNaN(a)||a<0||isNaN(d)||d<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=a,this.left=d,this.right=_}interpolate(n,a,d){return a.top!=null&&n.top!=null&&(this.top=s.number(n.top,a.top,d)),a.bottom!=null&&n.bottom!=null&&(this.bottom=s.number(n.bottom,a.bottom,d)),a.left!=null&&n.left!=null&&(this.left=s.number(n.left,a.left,d)),a.right!=null&&n.right!=null&&(this.right=s.number(n.right,a.right,d)),this}getCenter(n,a){const d=s.clamp((this.left+n-this.right)/2,0,n),_=s.clamp((this.top+a-this.bottom)/2,0,a);return new s.pointGeometry(d,_)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new Ia(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function _u(c,n){const a=s.getColumn(c,3);s.fromQuat(c,n),s.setColumn(c,3,a)}function Ds(c,n){const a=s.identity$1([]);return s.rotateZ$1(a,a,-n),s.rotateX$1(a,a,-c),a}function Ls(c,n){const a=[c[0],c[1],0],d=[n[0],n[1],0];if(s.length(a)>=1e-15){const w=s.normalize([],a);s.scale$2(d,w,s.dot(d,w)),n[0]=d[0],n[1]=d[1]}const _=s.cross([],n,c);if(s.len(_)<1e-15)return null;const g=Math.atan2(-_[1],_[0]);return Ds(Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2]),g)}class Pt{constructor(n,a){this.position=n,this.orientation=a}get position(){return this._position}set position(n){if(n){const a=n instanceof s.MercatorCoordinate?n:new s.MercatorCoordinate(n[0],n[1],n[2]);this._renderWorldCopies&&(a.x=s.wrap(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(n,a){if(this.orientation=null,!this.position)return;const d=this._elevation?this._elevation.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(n)):0,_=this.position,g=s.MercatorCoordinate.fromLngLat(n,d),w=[g.x-_.x,g.y-_.y,g.z-_.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=Ls(w,a)}setPitchBearing(n,a){this.orientation=Ds(s.degToRad(n),s.degToRad(-a))}}class yr{constructor(n,a){this._transform=s.identity([]),this.orientation=a,this.position=n}get mercatorPosition(){const n=this.position;return new s.MercatorCoordinate(n[0],n[1],n[2])}get position(){const n=s.getColumn(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var a;n&&s.setColumn(this._transform,3,[(a=n)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||s.identity$1([]),n&&_u(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,a){this._orientation=Ds(n,a),_u(this._transform,this._orientation)}forward(){const n=s.getColumn(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=s.getColumn(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=s.getColumn(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,a){const d=new Float64Array(16);return s.invert(d,this.getWorldToCamera(n,a)),d}getWorldToCameraPosition(n,a,d){const _=this.position;s.scale$2(_,_,-n);const g=new Float64Array(16);return s.fromScaling(g,[d,d,d]),s.translate(g,g,_),g[10]*=a,g}getWorldToCamera(n,a){const d=new Float64Array(16),_=new Float64Array(4),g=this.position;return s.conjugate(_,this._orientation),s.scale$2(g,g,-n),s.fromQuat(d,_),s.translate(d,d,g),d[1]*=-1,d[5]*=-1,d[9]*=-1,d[13]*=-1,d[8]*=a,d[9]*=a,d[10]*=a,d[11]*=a,d}getCameraToClipPerspective(n,a,d,_){const g=new Float64Array(16);return s.perspective(g,n,a,d,_),g}getDistanceToElevation(n){const a=n===0?0:s.mercatorZfromAltitude(n,this.position[1]),d=this.forward();return(a-this.position[2])/d[2]}clone(){return new yr([...this.position],[...this.orientation])}}function gu(c,n){const a=ka(c.projection,c.zoom,c.width,c.height),d=function(g,w,T,C,k){const z=new s.LngLat(T.lng-180*Or,T.lat),R=new s.LngLat(T.lng+180*Or,T.lat),j=g.project(z.lng,z.lat),X=g.project(R.lng,R.lat),Z=-Math.atan2(X.y-j.y,X.x-j.x),W=s.MercatorCoordinate.fromLngLat(T);W.y=s.clamp(W.y,-.999975,.999975);const H=W.toLngLat(),G=g.project(H.lng,H.lat),te=s.MercatorCoordinate.fromLngLat(H);te.x+=Or;const K=te.toLngLat(),fe=g.project(K.lng,K.lat),he=za(fe.x-G.x,fe.y-G.y,Z),oe=s.MercatorCoordinate.fromLngLat(H);oe.y+=Or;const de=oe.toLngLat(),le=g.project(de.lng,de.lat),ye=za(le.x-G.x,le.y-G.y,Z),Le=Math.abs(he.x)/Math.abs(ye.y),dt=s.identity([]);s.rotateZ(dt,dt,-Z*(1-(k?0:C)));const Ae=s.identity([]);return s.scale(Ae,Ae,[1,1-(1-Le)*C,1]),Ae[4]=-ye.x/ye.y*C,s.rotateZ(Ae,Ae,Z),s.multiply(Ae,dt,Ae),Ae}(c.projection,0,c.center,a,n),_=yu(c);return s.scale(d,d,[_,_,1]),d}function yu(c){const n=c.projection,a=ka(c.projection,c.zoom,c.width,c.height),d=vu(n,c.center),_=vu(n,s.LngLat.convert(n.center));return Math.pow(2,d*a+(1-a)*_)}function ka(c,n,a,d,_=1/0){const g=c.range;if(!g)return 0;const w=Math.min(_,Math.max(a,d)),T=Math.log(w/1024)/Math.LN2;return s.smoothstep(g[0]+T,g[1]+T,n)}const Or=1/4e4;function vu(c,n){const a=s.clamp(n.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),d=new s.LngLat(n.lng-180*Or,a),_=new s.LngLat(n.lng+180*Or,a),g=c.project(d.lng,a),w=c.project(_.lng,a),T=s.MercatorCoordinate.fromLngLat(d),C=s.MercatorCoordinate.fromLngLat(_),k=w.x-g.x,z=w.y-g.y,R=C.x-T.x,j=C.y-T.y,X=Math.sqrt((R*R+j*j)/(k*k+z*z));return Math.log(X)/Math.LN2}function za(c,n,a){const d=Math.cos(a),_=Math.sin(a);return{x:c*d-n*_,y:c*_+n*d}}class Pa{constructor(n,a,d,_,g,w,T){this.tileSize=512,this._renderWorldCopies=g===void 0||g,this._minZoom=n||0,this._maxZoom=a||22,this._minPitch=d==null?0:d,this._maxPitch=_==null?60:_,this.setProjection(w),this.setMaxBounds(T),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Ia,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new yr,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const n=new Pa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(n){const a=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||a)&&this._updateCameraOnTerrain(),(n||a)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return s.pick(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const a=this.projection?this.getProjection():void 0;this.projection=s.getProjection(this.projectionOptions);const d=!D(a,this.getProjection());return d&&this._calcMatrices(),this.mercatorFromTransition=!1,d}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.getProjection({name:"mercator"});const a=n!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.pointGeometry(this.width,this.height)}get bearing(){return s.wrap(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const a=-n*Math.PI/180;var d;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=(d=new s.ARRAY_TYPE(4),s.ARRAY_TYPE!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d),function(_,g,w){var T=g[0],C=g[1],k=g[2],z=g[3],R=Math.sin(w),j=Math.cos(w);_[0]=T*j+k*R,_[1]=C*j+z*R,_[2]=T*-R+k*j,_[3]=C*-R+z*j}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const a=s.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=n/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const a=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const n=this._elevation;this._centerAltitude=n.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=n.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],d=this.horizonLineFromTop();let _=0,g=0;for(let w=0;w<a.length;w++){const T=new s.pointGeometry(a[w][0]*this.width,d+a[w][1]*(this.height-d)),C=n.pointCoordinate(T);if(!C)continue;const k=1/Math.hypot(C[0]-this._camera.position[0],C[1]-this._camera.position[1]);_+=C[3]*k,g+=k}return g===0?NaN:_/g}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),d=this.pixelsPerMeter/this.worldSize*a,_=this._mercatorZfromZoom(n),g=this._mercatorZfromZoom(this._maxZoom),w=Math.max(_-d,g);this._setZoom(this._zoomFromMercatorZ(w))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let d;d=n.z<this._camera.position[2]?[a.x,a.y,a.z]:[n.x,n.y,n.z];const _=s.length(s.sub([],this._camera.position,d));return s.clamp(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let a=!1;if(n.orientation&&!s.exactEquals(n.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(n.orientation)),n.position){const d=[n.position.x,n.position.y,n.position.z];s.exactEquals$1(d,this._camera.position)||(this._setCameraPosition(d),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,a=new Pt;return a.position=new s.MercatorCoordinate(n[0],n[1],n[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(n){if(!s.length$1(n))return!1;s.normalize$1(n,n);const a=s.transformQuat([],[0,0,-1],n),d=s.transformQuat([],[0,-1,0],n);if(d[2]<0)return!1;const _=Ls(a,d);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(n){const a=this.zoomScale(this.minZoom)*this.tileSize,d=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;n[2]=s.clamp(n[2],_/d,_/a),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,a,d){this._unmodified=!1,this._edgeInsets.interpolate(n,a,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const a=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(n){const a=[new s.UnwrappedTileID(0,n)];if(this.renderWorldCopies){const d=this.pointCoordinate(new s.pointGeometry(0,0)),_=this.pointCoordinate(new s.pointGeometry(this.width,0)),g=this.pointCoordinate(new s.pointGeometry(this.width,this.height)),w=this.pointCoordinate(new s.pointGeometry(0,this.height)),T=Math.floor(Math.min(d.x,_.x,g.x,w.x)),C=Math.floor(Math.max(d.x,_.x,g.x,w.x)),k=1;for(let z=T-k;z<=C+k;z++)z!==0&&a.push(new s.UnwrappedTileID(z,n))}return a}coveringTiles(n){let a=this.coveringZoomLevel(n);const d=a,_=this.elevation&&!n.isTerrainDEM,g=this.projection.name==="mercator";if(n.minzoom!==void 0&&a<n.minzoom)return[];n.maxzoom!==void 0&&a>n.maxzoom&&(a=n.maxzoom);const w=this.locationCoordinate(this.center),T=this.center.lat,C=1<<a,k=[C*w.x,C*w.y,0],z=this.projection.name==="globe",R=!z,j=s.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,R),X=z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Z=C*s.mercatorZfromAltitude(1,this.center.lat),W=this._camera.position[2]/s.mercatorZfromAltitude(1,this.center.lat),H=[C*X.x,C*X.y,W*(R?1:Z)],G=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),te=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?a:0,K=n.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,fe=n.isTerrainDEM?-K:this._elevation?this._elevation.getMinElevationBelowMSL():0,he=this.projection.isReprojectedInTileSpace?yu(this):1,oe=je=>{const it=new s.MercatorCoordinate(je.x+25e-6,je.y,je.z),It=new s.MercatorCoordinate(je.x,je.y+25e-6,je.z),St=je.toLngLat(),Ot=it.toLngLat(),Wt=It.toLngLat(),ii=this.locationCoordinate(St),xi=this.locationCoordinate(Ot),Vt=this.locationCoordinate(Wt),ai=Math.hypot(xi.x-ii.x,xi.y-ii.y),Mi=Math.hypot(Vt.x-ii.x,Vt.y-ii.y);return Math.sqrt(ai*Mi)*he/25e-6},de=je=>{const mt=K,it=fe;return{aabb:s.tileAABB(this,C,0,0,0,je,it,mt,this.projection),zoom:0,x:0,y:0,minZ:it,maxZ:mt,wrap:je,fullyVisible:!1}},le=[];let ye=[];const Le=a,dt=n.reparseOverscaled?d:a,Ae=je=>je*je,Je=Ae((W-this._centerAltitude)*Z),rt=je=>{if(!this._elevation||!je.tileID||!g)return;const mt=this._elevation.getMinMaxForTile(je.tileID),it=je.aabb;mt?(it.min[2]=mt.min,it.max[2]=mt.max,it.center[2]=(it.min[2]+it.max[2])/2):(je.shouldSplit=wt(je),je.shouldSplit||(it.min[2]=it.max[2]=it.center[2]=this._centerAltitude))},wt=je=>{if(je.zoom<te)return!0;if(je.zoom===Le)return!1;if(je.shouldSplit!=null)return je.shouldSplit;const mt=je.aabb.distanceX(H),it=je.aabb.distanceY(H);let It=Je,St=1;if(z){It=Ae(je.aabb.distanceZ(H));const Wt=Math.pow(2,je.zoom),ii=s.latFromMercatorY((je.y+1)/Wt),xi=s.latFromMercatorY(je.y/Wt),Vt=Math.min(Math.max(T,ii),xi),ai=s.circumferenceAtLatitude(Vt)/s.circumferenceAtLatitude(T);if(St=Vt===T?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ai/this._mercatorScaleRatio),this.zoom<=s.GLOBE_ZOOM_THRESHOLD_MIN&&je.zoom===Le-1&&ai>=.9)return!0}else if(_&&(It=Ae(je.aabb.distanceZ(H)*Z)),this.projection.isReprojectedInTileSpace&&d<=5){const Wt=Math.pow(2,je.zoom),ii=oe(new s.MercatorCoordinate((je.x+.5)/Wt,(je.y+.5)/Wt));St=ii>.85?1:ii}const Ot=mt*mt+it*it+It;return Ot<Ae((1<<Le-je.zoom)*G*St*((Wt,ii)=>{if(ii*Ae(.707)<Wt)return 1;const xi=Math.sqrt(ii/Wt);return xi/(1.4144271570014144+(Math.pow(1.1,xi-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(It,Je),Ot))};if(this.renderWorldCopies)for(let je=1;je<=3;je++)le.push(de(-je)),le.push(de(je));for(le.push(de(0));le.length>0;){const je=le.pop(),mt=je.x,it=je.y;let It=je.fullyVisible;if(!It){const St=je.aabb.intersects(j);if(St===0)continue;It=St===2}if(je.zoom!==Le&&wt(je))for(let St=0;St<4;St++){const Ot=(mt<<1)+St%2,Wt=(it<<1)+(St>>1),ii={aabb:g?je.aabb.quadrant(St):s.tileAABB(this,C,je.zoom+1,Ot,Wt,je.wrap,je.minZ,je.maxZ,this.projection),zoom:je.zoom+1,x:Ot,y:Wt,wrap:je.wrap,fullyVisible:It,tileID:void 0,shouldSplit:void 0,minZ:je.minZ,maxZ:je.maxZ};_&&!z&&(ii.tileID=new s.OverscaledTileID(je.zoom+1===Le?dt:je.zoom+1,je.wrap,je.zoom+1,Ot,Wt),rt(ii)),le.push(ii)}else{const St=je.zoom===Le?dt:je.zoom;if(n.minzoom&&n.minzoom>St)continue;const Ot=k[0]-(.5+mt+(je.wrap<<je.zoom))*(1<<a-je.zoom),Wt=k[1]-.5-it,ii=je.tileID?je.tileID:new s.OverscaledTileID(St,je.wrap,je.zoom,mt,it);ye.push({tileID:ii,distanceSq:Ot*Ot+Wt*Wt})}}if(this.fogCullDistSq){const je=this.fogCullDistSq,mt=this.horizonLineFromTop();ye=ye.filter(it=>{const It=[0,0,0,1],St=[s.EXTENT,s.EXTENT,0,1],Ot=this.calculateFogTileMatrix(it.tileID.toUnwrapped());s.transformMat4$1(It,It,Ot),s.transformMat4$1(St,St,Ot);const Wt=s.getAABBPointSquareDist(It,St);if(Wt===0)return!0;let ii=!1;const xi=this._elevation;if(xi&&Wt>je&&mt!==0){const Vt=this.calculateProjMatrix(it.tileID.toUnwrapped());let ai;n.isTerrainDEM||(ai=xi.getMinMaxForTile(it.tileID)),ai||(ai={min:fe,max:K});const Mi=s.furthestTileCorner(this.rotation),Qi=[Mi[0]*s.EXTENT,Mi[1]*s.EXTENT,ai.max];s.transformMat4(Qi,Qi,Vt),ii=(1-Qi[1])*this.height*.5<mt}return Wt<je||ii})}return ye.sort((je,mt)=>je.distanceSq-mt.distanceSq).map(je=>je.tileID)}resize(n,a){this.width=n,this.height=a,this.pixelsToGLUnits=[2/n,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const a=s.clamp(n.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),d=this.projection.project(n.lng,a);return new s.pointGeometry(d.x*this.worldSize,d.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(n,a){let d,_;const g=this.centerPoint;if(this.projection.name==="globe"){const T=this.worldSize;d=(a.x-g.x)/T,_=(a.y-g.y)/T}else{const T=this.pointCoordinate(a),C=this.pointCoordinate(g);d=T.x-C.x,_=T.y-C.y}const w=this.locationCoordinate(n);this.setLocation(new s.MercatorCoordinate(w.x-d,w.y-_))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,a){const d=a?s.mercatorZfromAltitude(a,n.lat):void 0,_=this.projection.project(n.lng,n.lat);return new s.MercatorCoordinate(_.x,_.y,d)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,a){const d=a!=null?a:this._centerAltitude,_=[n.x,n.y,0,1],g=[n.x,n.y,1,1];s.transformMat4$1(_,_,this.pixelMatrixInverse),s.transformMat4$1(g,g,this.pixelMatrixInverse);const w=g[3];s.scale$1(_,_,1/_[3]),s.scale$1(g,g,1/w);const T=_[2],C=g[2];return{p0:_,p1:g,t:T===C?0:(d-T)/(C-T)}}screenPointToMercatorRay(n){const a=[n.x,n.y,0,1],d=[n.x,n.y,1,1];return s.transformMat4$1(a,a,this.pixelMatrixInverse),s.transformMat4$1(d,d,this.pixelMatrixInverse),s.scale$1(a,a,1/a[3]),s.scale$1(d,d,1/d[3]),a[2]=s.mercatorZfromAltitude(a[2],this._center.lat)*this.worldSize,d[2]=s.mercatorZfromAltitude(d[2],this._center.lat)*this.worldSize,s.scale$1(a,a,1/this.worldSize),s.scale$1(d,d,1/this.worldSize),new s.Ray([a[0],a[1],a[2]],s.normalize([],s.sub([],d,a)))}rayIntersectionCoordinate(n){const{p0:a,p1:d,t:_}=n,g=s.mercatorZfromAltitude(a[2],this._center.lat),w=s.mercatorZfromAltitude(d[2],this._center.lat);return new s.MercatorCoordinate(s.number(a[0],d[0],_)/this.worldSize,s.number(a[1],d[1],_)/this.worldSize,s.number(g,w,_))}pointCoordinate(n,a=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,a)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let a=this.projection.pointCoordinate3D(this,n.x,n.y);if(a)return new s.MercatorCoordinate(a[0],a[1],a[2]);let d=0,_=this.horizonLineFromTop();if(n.y>_)return this.pointCoordinate(n);const g=.02*_,w=n.clone();for(let T=0;T<10&&_-d>g;T++){w.y=s.number(d,_,.66);const C=this.projection.pointCoordinate3D(this,w.x,w.y);C?(_=w.y,a=C):d=w.y}return a?new s.MercatorCoordinate(a[0],a[1],a[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}_coordinatePoint(n,a){const d=a&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,_=[n.x*this.worldSize,n.y*this.worldSize,d+n.toAltitude(),1];return s.transformMat4$1(_,_,this.pixelMatrix),_[3]>0?new s.pointGeometry(_[0]/_[3],_[1]/_[3]):new s.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(n,a){const d=new s.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),_=new s.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),g=new s.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),w=new s.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let T=this.pointCoordinate(d,n),C=this.pointCoordinate(_,n);const k=this.pointCoordinate(g,a),z=this.pointCoordinate(w,a),R=(j,X)=>(X.y-j.y)/(X.x-j.x);return T.y>1&&C.y>=0?T=new s.MercatorCoordinate((1-z.y)/R(z,T)+z.x,1):T.y<0&&C.y<=1&&(T=new s.MercatorCoordinate(-z.y/R(z,T)+z.x,0)),C.y>1&&T.y>=0?C=new s.MercatorCoordinate((1-k.y)/R(k,C)+k.x,1):C.y<0&&T.y<=1&&(C=new s.MercatorCoordinate(-k.y/R(k,C)+k.x,0)),new s.LngLatBounds().extend(this.coordinateLocation(T)).extend(this.coordinateLocation(C)).extend(this.coordinateLocation(z)).extend(this.coordinateLocation(k))}_getBounds3D(){const n=this.elevation;if(!n.visibleDemTiles.length)return this._getBounds(0,0);const a=n.visibleDemTiles.reduce((d,_)=>{if(_.dem){const g=_.dem.tree;d.min=Math.min(d.min,g.minimums[0]),d.max=Math.max(d.max,g.maximums[0])}return d},{min:Number.MAX_VALUE,max:0});return this._getBounds(a.min*n.exaggeration(),a.max*n.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(n=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,d=this.height/2-a*(1-this._horizonShift);return n?Math.max(0,d):d}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-s.MAX_MERCATOR_LATITUDE,this.maxLat=s.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=s.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=s.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=s.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,a){return this.projection.createTileMatrix(this,a,n)}calculateDistanceTileData(n){const a=n.key,d=this._distanceTileDataCache;if(d[a])return d[a];const _=n.canonical,g=1/this.height,w=this.cameraWorldSize/this.zoomScale(_.z),T=(_.x+Math.pow(2,_.z)*n.wrap)*w,C=_.y*w,k=this.point,z=this.angle,R=Math.sin(-z),j=-Math.cos(-z);return d[a]={bearing:[R,j],center:[(k.x-T)*g,(k.y-C)*g],scale:w/s.EXTENT*g},d[a]}calculateFogTileMatrix(n){const a=n.key,d=this._fogTileMatrixCache;if(d[a])return d[a];const _=this.projection.createTileMatrix(this,this.cameraWorldSize,n);return s.multiply(_,this.worldToFogMatrix,_),d[a]=new Float32Array(_),d[a]}calculateProjMatrix(n,a=!1){const d=n.key,_=a?this._alignedProjMatrixCache:this._projMatrixCache;if(_[d])return _[d];const g=this.calculatePosMatrix(n,this.worldSize);return s.multiply(g,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:a?this.alignedProjMatrix:this.projMatrix,g),_[d]=new Float32Array(g),_[d]}calculatePixelsToTileUnitsMatrix(n){const a=n.tileID.key,d=this._pixelsToTileUnitsCache;if(d[a])return d[a];const _=function(g,w){const{scale:T}=g.tileTransform,C=T*s.EXTENT/(g.tileSize*Math.pow(2,w.zoom-g.tileID.overscaledZ+g.tileID.canonical.z));return k=new Float32Array(4),j=(z=w.inverseAdjustmentMatrix)[1],X=z[2],Z=z[3],H=(R=[C,C])[1],k[0]=z[0]*(W=R[0]),k[1]=j*W,k[2]=X*H,k[3]=Z*H,k;var k,z,R,j,X,Z,W,H}(n,this);return d[a]=_,d[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const a=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(a),_=this._camera.forward(),g=s.mercatorZfromAltitude(1,this._center.lat);d[2]/=g,_[2]/=g,s.normalize(_,_);const w=n.raycast(d,_,n.exaggeration());if(w){const T=s.scaleAndAdd([],d,_,w),C=new s.MercatorCoordinate(T[0],T[1],s.mercatorZfromAltitude(T[2],s.latFromMercatorY(T[1]))),k=(C.z+s.length([C.x-d[0],C.y-d[1],C.z-d[2]*g]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(k),this._centerAltitude=C.toAltitude(),this._center=this.coordinateLocation(C),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const n=this._elevation;this._updateCameraState();const a=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(a),_=n.getAtPointOrZero(new s.MercatorCoordinate(...d)),g=this._minimumHeightOverTerrain()*Math.cos(s.degToRad(this._maxPitch)),w=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*_;if(w<g){const T=this.locationCoordinate(this._center,this._centerAltitude),C=[T.x-d[0],T.y-d[1],T.z-d[2]],k=s.length(C);C[2]-=(g-w)/this._pixelsPerMercatorPixel;const z=s.length(C);if(z===0)return;s.scale$2(C,C,k/z*this._pixelsPerMercatorPixel),this._camera.position=[T.x-C[0],T.y-C[1],T.z*this._pixelsPerMercatorPixel-C[2]],this._camera.orientation=Ls(C,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const j=this.center;return j.lat=s.clamp(j.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(j.lng=s.clamp(j.lng,this.minLng,this.maxLng)),this.center=j,void(this._constraining=!1)}const a=this._unmodified,{x:d,y:_}=this.point;let g=0,w=d,T=_;const C=this.width/2,k=this.height/2,z=this.worldMinY*this.scale,R=this.worldMaxY*this.scale;if(_-k<z&&(T=z+k),_+k>R&&(T=R-k),R-z<this.height&&(g=Math.max(g,this.height/(R-z)),T=(R+z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const j=this.worldMinX*this.scale,X=this.worldMaxX*this.scale,Z=this.worldSize/2-(j+X)/2;w=(d+Z+this.worldSize)%this.worldSize-Z,w-C<j&&(w=j+C),w+C>X&&(w=X-C),X-j<this.width&&(g=Math.max(g,this.width/(X-j)),w=(X+j)/2)}w===d&&T===_||(this.center=this.unproject(new s.pointGeometry(w,T))),g&&(this.zoom+=this.scaleZoom(g)),this._constrainCameraAltitude(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,a=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.mercatorZfromAltitude(1,this.center.lat)/s.mercatorZfromAltitude(1,s.GLOBE_SCALE_MATCH_LATITUDE));const d=ka(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,d),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const _=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?a:1),g=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);g[8]=2*-n.x/this.width,g[9]=2*n.y/this.height;let w=s.mul([],g,_);if(this.projection.isReprojectedInTileSpace){const he=this.locationCoordinate(this.center),oe=s.identity([]);s.translate(oe,oe,[he.x*this.worldSize,he.y*this.worldSize,0]),s.multiply(oe,oe,gu(this)),s.translate(oe,oe,[-he.x*this.worldSize,-he.y*this.worldSize,0]),s.multiply(w,w,oe),this.inverseAdjustmentMatrix=function(de){const le=gu(de,!0);return Xe([],[le[0],le[1],le[4],le[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=s.scale([],w,[this.worldSize,this.worldSize,this.worldSize/a,1]),this.projMatrix=w,this.invProjMatrix=s.invert(new Float64Array(16),this.projMatrix);const T=s.invert([],g);this.frustumCorners=s.FrustumCorners.fromInvProjectionMatrix(T,this.horizonLineFromTop(),this.height);const C=new Float32Array(16);s.identity(C),s.scale(C,C,[1,-1,1]),s.rotateX(C,C,this._pitch),s.rotateZ(C,C,this.angle);const k=s.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),z=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;k[8]=2*-n.x/this.width,k[9]=2*(n.y+z)/this.height,this.skyboxMatrix=s.multiply(C,k,C);const R=this.point,j=R.x,X=R.y,Z=this.width%2/2,W=this.height%2/2,H=Math.cos(this.angle),G=Math.sin(this.angle),te=j-Math.round(j)+H*Z+G*W,K=X-Math.round(X)+H*W+G*Z,fe=new Float64Array(w);if(s.translate(fe,fe,[te>.5?te-1:te,K>.5?K-1:K,0]),this.alignedProjMatrix=fe,w=s.create(),s.scale(w,w,[this.width/2,-this.height/2,1]),s.translate(w,w,[1,-1,0]),this.labelPlaneMatrix=w,w=s.create(),s.scale(w,w,[1,-1,1]),s.translate(w,w,[-1,-1,0]),s.scale(w,w,[2/this.width,2/this.height,1]),this.glCoordMatrix=w,this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},w=s.invert(new Float64Array(16),this.pixelMatrix),!w)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=w,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.calculateGlobeMatrix(this);const he=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.transformMat4(he,he,_),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=w;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSize,a=this.cameraPixelsPerMeter,d=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,g=[n,n,a];s.scale$2(g,g,_),s.scale$2(d,d,-1),s.multiply$2(d,d,g);const w=s.create();s.translate(w,w,d),s.scale(w,w,g),this.mercatorFogMatrix=w,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,a,_)}_computeCameraPosition(n){const a=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,d=this._camera.forward(),_=this.point,g=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-n/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-d[0]*g,_.y/this.worldSize-d[1]*g,n/this.worldSize*this._centerAltitude-d[2]*g]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),d=n[2];let _=1;d>0&&(_=Math.min((a-this._camera.position[2])/d,1)),this._camera.position=s.scaleAndAdd([],this._camera.position,n,_),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const n=this._camera.position,a=this._camera.forward(),{pitch:d,bearing:_}=this._camera.getPitchBearing(),g=s.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,w=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.degToRad(this._maxPitch)),T=Math.max((n[2]-g)/Math.cos(d),w),C=this._zoomFromMercatorZ(T);s.scaleAndAdd(n,n,a,T),this._pitch=s.clamp(d,s.degToRad(this.minPitch),s.degToRad(this.maxPitch)),this.angle=s.wrap(_,-Math.PI,Math.PI),this._setZoom(s.clamp(C,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.MercatorCoordinate(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,a){const d=Math.min(n.x,a.x),_=Math.max(n.x,a.x),g=Math.min(n.y,a.y),w=Math.max(n.y,a.y);if(g<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const T=[new s.pointGeometry(d,g),new s.pointGeometry(_,w),new s.pointGeometry(d,w),new s.pointGeometry(_,g)],C=this.renderWorldCopies?-3:0,k=this.renderWorldCopies?4:1;for(const z of T){const R=this.pointRayIntersection(z);if(R.t<0)return!0;const j=this.rayIntersectionCoordinate(R);if(j.x<C||j.y<0||j.x>k||j.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.pointGeometry(0,0),new s.pointGeometry(this.width,this.height))}zoomDeltaToMovement(n,a){const d=s.length(s.sub([],this._camera.position,n)),_=this._zoomFromMercatorZ(d)+a;return d-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){const n=function(a,d){const _=[a[0],a[1],a[2],1];s.transformMat4$1(_,_,d);const g=Math.max(_[3],1e-6);return[_[0]/g,_[1]/g,_[2]/g,g]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.pointGeometry(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.pointGeometry(0,n))}}getCameraToCenterDistance(n){const a=ka(n,this.zoom,this.width,this.height,1024),d=n.pixelSpaceConversion(this.center.lat,this.worldSize,a);return .5/Math.tan(.5*this._fov)*this.height*d}}function Da(c,n){let a=!1,d=null;const _=()=>{d=null,a&&(c(),d=setTimeout(_,n),a=!1)};return()=>(a=!0,d||_(),d)}class od{constructor(n){this._hashName=n&&encodeURIComponent(n),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Da(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,s.window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),s.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const a=xu(n);if(this._hashName){const d=this._hashName;let _=!1;const g=s.window.location.hash.slice(1).split("&").map(w=>{const T=w.split("=")[0];return T===d?(_=!0,`${T}=${a}`):w}).filter(w=>w);return _||g.push(`${d}=${a}`),`#${g.join("&")}`}return`#${a}`}_getCurrentHash(){const n=s.window.location.hash.replace("#","");if(this._hashName){let a;return n.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(a=d)}),(a&&a[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const a=this._getCurrentHash();if(a.length>=3&&!a.some(d=>isNaN(d))){const d=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(a[3]||0):n.getBearing();return n.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:d,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){const n=s.window.location.href.replace(/(#.+)?$/,this.getHashString());s.window.history.replaceState(s.window.history.state,null,n)}}function xu(c,n){const a=c.getCenter(),d=Math.round(100*c.getZoom())/100,_=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,_),w=Math.round(a.lng*g)/g,T=Math.round(a.lat*g)/g,C=c.getBearing(),k=c.getPitch();let z=n?`/${w}/${T}/${d}`:`${d}/${T}/${w}`;return(C||k)&&(z+="/"+Math.round(10*C)/10),k&&(z+=`/${Math.round(k)}`),z}const ro={linearity:.3,easing:s.bezier(0,0,.3,1)},Rp=s.extend({deceleration:2500,maxSpeed:1400},ro),Fp=s.extend({deceleration:20,maxSpeed:1400},ro),sd=s.extend({deceleration:1e3,maxSpeed:360},ro),Ol=s.extend({deceleration:1e3,maxSpeed:90},ro);class bu{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.exported.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,a=s.exported.now();for(;n.length>0&&a-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,pan:new s.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)a.zoom+=g.zoomDelta||0,a.bearing+=g.bearingDelta||0,a.pitch+=g.pitchDelta||0,g.panDelta&&a.pan._add(g.panDelta),g.around&&(a.around=g.around),g.pinchAround&&(a.pinchAround=g.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(a.pan.mag()){const g=Ba(a.pan.mag(),d,s.extend({},Rp,n||{}));_.offset=a.pan.mult(g.amount/a.pan.mag()),_.center=this._map.transform.center,La(_,g)}if(a.zoom){const g=Ba(a.zoom,d,Fp);_.zoom=this._map.transform.zoom+g.amount,La(_,g)}if(a.bearing){const g=Ba(a.bearing,d,sd);_.bearing=this._map.transform.bearing+s.clamp(g.amount,-179,179),La(_,g)}if(a.pitch){const g=Ba(a.pitch,d,Ol);_.pitch=this._map.transform.pitch+g.amount,La(_,g)}if(_.zoom||_.bearing){const g=a.pinchAround===void 0?a.around:a.pinchAround;_.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function La(c,n){(!c.duration||c.duration<n.duration)&&(c.duration=n.duration,c.easing=n.easing)}function Ba(c,n,a){const{maxSpeed:d,linearity:_,deceleration:g}=a,w=s.clamp(c*_/(n/1e3),-d,d),T=Math.abs(w)/(g*_);return{easing:a.easing,duration:1e3*T,amount:w*(T/2)}}class $n extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,d,_={}){const g=Se(a.getCanvasContainer(),d),w=a.unproject(g);super(n,s.extend({point:g,lngLat:w,originalEvent:d},_)),this._defaultPrevented=!1,this.target=a}}class Bs extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,d){const _=n==="touchend"?d.changedTouches:d.touches,g=De(a.getCanvasContainer(),_),w=g.map(C=>a.unproject(C)),T=g.reduce((C,k,z,R)=>C.add(k.div(R.length)),new s.pointGeometry(0,0));super(n,{points:g,point:T,lngLats:w,lngLat:a.unproject(T),originalEvent:d}),this._defaultPrevented=!1}}class ad extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,d){super(n,{originalEvent:d}),this._defaultPrevented=!1}}class ld{constructor(n,a){this._map=n,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new ad(n.type,this._map,n))}mousedown(n,a){return this._mousedownPos=a,this._firePreventable(new $n(n.type,this._map,n))}mouseup(n){this._map.fire(new $n(n.type,this._map,n))}preclick(n){const a=s.extend({},n);a.type="preclick",this._map.fire(new $n(a.type,this._map,a))}click(n,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(n),this._map.fire(new $n(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new $n(n.type,this._map,n))}mouseover(n){this._map.fire(new $n(n.type,this._map,n))}mouseout(n){this._map.fire(new $n(n.type,this._map,n))}touchstart(n){return this._firePreventable(new Bs(n.type,this._map,n))}touchmove(n){this._map.fire(new Bs(n.type,this._map,n))}touchend(n){this._map.fire(new Bs(n.type,this._map,n))}touchcancel(n){this._map.fire(new Bs(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class cd{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new $n(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new $n("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new $n(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ud{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,a){this.isEnabled()&&n.shiftKey&&n.button===0&&(Ye(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(n,a){if(!this._active)return;const d=a;if(this._lastPos.equals(d)||!this._box&&d.dist(this._startPos)<this._clickTolerance)return;const _=this._startPos;this._lastPos=d,this._box||(this._box=q("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const g=Math.min(_.x,d.x),w=Math.max(_.x,d.x),T=Math.min(_.y,d.y),C=Math.max(_.y,d.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${g}px,${T}px)`,this._box.style.width=w-g+"px",this._box.style.height=C-T+"px")})}mouseupWindow(n,a){if(!this._active||n.button!==0)return;const d=this._startPos,_=a;if(this.reset(),Ge(),d.x!==_.x||d.y!==_.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:g=>g.fitScreenCoordinates(d,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),we(),delete this._startPos,delete this._lastPos}_fireEvent(n,a){return this._map.fire(new s.Event(n,{originalEvent:a}))}}function Vl(c,n){const a={};for(let d=0;d<c.length;d++)a[c[d].identifier]=n[d];return a}class Rs{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,a,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),d.length===this.numTouches&&(this.centroid=function(_){const g=new s.pointGeometry(0,0);for(const w of _)g._add(w);return g.div(_.length)}(a),this.touches=Vl(d,a)))}touchmove(n,a,d){if(this.aborted||!this.centroid)return;const _=Vl(d,a);for(const g in this.touches){const w=this.touches[g],T=_[g];(!T||T.dist(w)>30)&&(this.aborted=!0)}}touchend(n,a,d){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Ul{constructor(n){this.singleTap=new Rs(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,a,d){this.singleTap.touchstart(n,a,d)}touchmove(n,a,d){this.singleTap.touchmove(n,a,d)}touchend(n,a,d){const _=this.singleTap.touchend(n,a,d);if(_){const g=n.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(_)<30;if(g&&w||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class hd{constructor(){this._zoomIn=new Ul({numTouches:1,numTaps:2}),this._zoomOut=new Ul({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,a,d){this._zoomIn.touchstart(n,a,d),this._zoomOut.touchstart(n,a,d)}touchmove(n,a,d){this._zoomIn.touchmove(n,a,d),this._zoomOut.touchmove(n,a,d)}touchend(n,a,d){const _=this._zoomIn.touchend(n,a,d),g=this._zoomOut.touchend(n,a,d);return _?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(_)},{originalEvent:n})}):g?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(g)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const dd={0:1,2:2};class Nl{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,a){return!1}_move(n,a){return{}}mousedown(n,a){if(this._lastPoint)return;const d=be(n);this._correctButton(n,d)&&(this._lastPoint=a,this._eventButton=d)}mousemoveWindow(n,a){const d=this._lastPoint;if(d){if(n.preventDefault(),this._eventButton!=null&&function(_,g){const w=dd[g];return _.buttons===void 0||(_.buttons&w)!==w}(n,this._eventButton))this.reset();else if(this._moved||!(a.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(d,a)}}mouseupWindow(n){this._lastPoint&&be(n)===this._eventButton&&(this._moved&&Ge(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class fd extends Nl{mousedown(n,a){super.mousedown(n,a),this._lastPoint&&(this._active=!0)}_correctButton(n,a){return a===0&&!n.ctrlKey}_move(n,a){return{around:a,panDelta:a.sub(n)}}}class wu extends Nl{_correctButton(n,a){return a===0&&n.ctrlKey||a===2}_move(n,a){const d=.8*(a.x-n.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(n){n.preventDefault()}}class Rn extends Nl{_correctButton(n,a){return a===0&&n.ctrlKey||a===2}_move(n,a){const d=-.5*(a.y-n.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(n){n.preventDefault()}}class Op{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),s.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.pointGeometry(0,0)}touchstart(n,a,d){return this._calculateTransform(n,a,d)}touchmove(n,a,d){if(this._active&&!(d.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(d.length===1&&!s.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,a,d)}}touchend(n,a,d){this._calculateTransform(n,a,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,a,d){d.length>0&&(this._active=!0);const _=Vl(d,a),g=new s.pointGeometry(0,0),w=new s.pointGeometry(0,0);let T=0;for(const k in _){const z=_[k],R=this._touches[k];R&&(g._add(z),w._add(z.sub(R)),T++,_[k]=z)}if(this._touches=_,T<this._minTouches||!w.mag())return;const C=w.div(T);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(T),panDelta:C}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=q("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class jl{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,a,d){return{}}touchstart(n,a,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([a[0],a[1]]))}touchmove(n,a,d){const _=this._firstTwoTouches;if(!_)return;n.preventDefault();const[g,w]=_,T=ql(d,a,g),C=ql(d,a,w);if(!T||!C)return;const k=this._aroundCenter?null:T.add(C).div(2);return this._move([T,C],k,n)}touchend(n,a,d){if(!this._firstTwoTouches)return;const[_,g]=this._firstTwoTouches,w=ql(d,a,_),T=ql(d,a,g);w&&T||(this._active&&Ge(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ql(c,n,a){for(let d=0;d<c.length;d++)if(c[d].identifier===a)return n[d]}function pd(c,n){return Math.log(c/n)/Math.LN2}class oo extends jl{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,a){const d=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(pd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:pd(this._distance,d),pinchAround:a}}}function Tu(c,n){return 180*c.angleWith(n)/Math.PI}class Fs extends jl{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,a){const d=this._vector;if(this._vector=n[0].sub(n[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Tu(this._vector,d),pinchAround:a}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const a=25/(Math.PI*this._minDiameter)*360,d=Tu(n,this._startVector);return Math.abs(d)<a}}function Cr(c){return Math.abs(c.y)>Math.abs(c.x)}class $l extends jl{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,Cr(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,a,d){const _=this._lastPoints;if(!_)return;const g=n[0].sub(_[0]),w=n[1].sub(_[1]);return this._map._cooperativeGestures&&d.touches.length<3||(this._valid=this.gestureBeginsVertically(g,w,d.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(g.y+w.y)/2*-.5})}gestureBeginsVertically(n,a,d){if(this._valid!==void 0)return this._valid;const _=n.mag()>=2,g=a.mag()>=2;if(!_&&!g)return;if(!_||!g)return this._firstMove==null&&(this._firstMove=d),d-this._firstMove<100&&void 0;const w=n.y>0==a.y>0;return Cr(n)&&Cr(a)&&w}}const Bt={panStep:100,bearingStep:15,pitchStep:10};class md{constructor(){const n=Bt;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let a=0,d=0,_=0,g=0,w=0;switch(n.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:n.shiftKey?d=-1:(n.preventDefault(),g=-1);break;case 39:n.shiftKey?d=1:(n.preventDefault(),g=1);break;case 38:n.shiftKey?_=1:(n.preventDefault(),w=-1);break;case 40:n.shiftKey?_=-1:(n.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(d=0,_=0),{cameraAnimation:T=>{const C=T.getZoom();T.easeTo({duration:300,easeId:"keyboardHandler",easing:_d,zoom:a?Math.round(C)+a*(n.shiftKey?2:1):C,bearing:T.getBearing()+d*this._bearingStep,pitch:T.getPitch()+_*this._pitchStep,offset:[-g*this._panStep,-w*this._panStep],center:T.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function _d(c){return c*(2-c)}const Os=4.000244140625;class Ra{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._handler=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,s.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||s.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=n.deltaMode===s.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const d=s.exported.now(),_=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,a!==0&&a%Os==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(_*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),n.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=n,this._delta-=a,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=Se(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform,a=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const C=this._type==="wheel"&&Math.abs(this._delta)>Os?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&k!==0&&(k=1/k);const z=a(),R=Math.pow(2,z),j=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):R;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(j*k))),this._type==="wheel"&&(this._startZoom=z,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:a(),_=this._startZoom,g=this._easing;let w,T=!1;if(this._type==="wheel"&&_&&g){const C=Math.min((s.exported.now()-this._lastWheelEventTime)/200,1),k=g(C);w=s.number(_,d,k),C<1?this._frameId||(this._frameId=!0):T=!0}else w=d,T=!0;return this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!T,zoomDelta:w-a(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let a=s.ease;if(this._prevEase){const d=this._prevEase,_=(s.exported.now()-d.start)/d.duration,g=d.easing(_+.01)-d.easing(_),w=.27/Math.sqrt(g*g+1e-4)*.01,T=Math.sqrt(.0729-w*w);a=s.bezier(w,T,.25,1)}return this._prevEase={start:s.exported.now(),duration:n,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=q("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(s.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class gd{constructor(n,a){this._clickZoom=n,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class yd{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,a){return n.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(n.shiftKey?-1:1),around:d.unproject(a)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vd{constructor(){this._tap=new Ul({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,a,d){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=a[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(n,a,d))}touchmove(n,a,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const _=a[0],g=_.y-this._swipePoint.y;return this._swipePoint=_,n.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(n,a,d)}touchend(n,a,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(n,a,d)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xd{constructor(n,a,d){this._el=n,this._mousePan=a,this._touchPan=d}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class bd{constructor(n,a,d){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=a,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class wd{constructor(n,a,d,_){this._el=n,this._touchZoom=a,this._touchRotate=d,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Fa=c=>c.zoom||c.drag||c.pitch||c.rotate;class Gl extends s.Event{}class Eu{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,a){const d=s.sub([],a,n);this.radius=s.length(d[2]<0?s.div([],d,this.constants):[d[0],d[1],0])}projectRay(n){s.div(n,n,this.constants),s.normalize(n,n),s.mul$1(n,n,this.constants);const a=s.scale$2([],n,this.radius);if(a[2]>0){const d=s.scale$2([],[0,0,1],s.dot(a,[0,0,1])),_=s.scale$2([],s.normalize([],[a[0],a[1],0]),this.radius),g=s.add([],a,s.scale$2([],s.sub([],s.add([],_,d),a),2));a[0]=g[0],a[1]=g[1]}return a}}function Jo(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class Td{constructor(n,a){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new bu(n),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Eu,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),s.bindAll(["handleEvent","handleWindowEvent"],this);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[s.window.document,"mousemove",{capture:!0}],[s.window.document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[s.window,"blur",void 0]];for(const[_,g,w]of this._listeners)_.addEventListener(g,_===s.window.document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[n,a,d]of this._listeners)n.removeEventListener(a,n===s.window.document?this.handleWindowEvent:this.handleEvent,d)}_addDefaultHandlers(n){const a=this._map,d=a.getCanvasContainer();this._add("mapEvent",new ld(a,n));const _=a.boxZoom=new ud(a,n);this._add("boxZoom",_);const g=new hd,w=new yd;a.doubleClickZoom=new gd(w,g),this._add("tapZoom",g),this._add("clickZoom",w);const T=new vd;this._add("tapDragZoom",T);const C=a.touchPitch=new $l(a);this._add("touchPitch",C);const k=new wu(n),z=new Rn(n);a.dragRotate=new bd(n,k,z),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const R=new fd(n),j=new Op(a,n);a.dragPan=new xd(d,R,j),this._add("mousePan",R),this._add("touchPan",j,["touchZoom","touchRotate"]);const X=new Fs,Z=new oo;a.touchZoomRotate=new wd(d,Z,X,T),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",Z,["touchPan","touchRotate"]),this._add("blockableMapEvent",new cd(a));const W=a.scrollZoom=new Ra(a,this);this._add("scrollZoom",W,["mousePan"]);const H=a.keyboard=new md;this._add("keyboard",H);for(const G of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[G]&&a[G].enable(n[G])}_add(n,a,d){this._handlers.push({handlerName:n,handler:a,allowed:d}),this._handlersById[n]=a}stop(n){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Fa(this._eventsInProgress)||this.isZooming()}_blockedByActive(n,a,d){for(const _ in n)if(_!==d&&(!a||a.indexOf(_)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const a=[];for(const d of n)this._el.contains(d.target)&&a.push(d);return a}handleEvent(n,a){this._updatingCamera=!0;const d=n.type==="renderFrame",_=d?void 0:n,g={needsRenderFrame:!1},w={},T={},C=n.touches?this._getMapTouches(n.touches):void 0,k=C?De(this._el,C):d?void 0:Se(this._el,n);for(const{handlerName:j,handler:X,allowed:Z}of this._handlers){if(!X.isEnabled())continue;let W;this._blockedByActive(T,Z,j)?X.reset():X[a||n.type]&&(W=X[a||n.type](n,k,C),this.mergeHandlerResult(g,w,W,j,_),W&&W.needsRenderFrame&&this._triggerRenderFrame()),(W||X.isActive())&&(T[j]=X)}const z={};for(const j in this._previousActiveHandlers)T[j]||(z[j]=_);this._previousActiveHandlers=T,(Object.keys(z).length||Jo(g))&&(this._changes.push([g,w,z]),this._triggerRenderFrame()),(Object.keys(T).length||Jo(g))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:R}=g;R&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],R(this._map))}mergeHandlerResult(n,a,d,_,g){if(!d)return;s.extend(n,d);const w={handlerName:_,originalEvent:d.originalEvent||g};d.zoomDelta!==void 0&&(a.zoom=w),d.panDelta!==void 0&&(a.drag=w),d.pitchDelta!==void 0&&(a.pitch=w),d.bearingDelta!==void 0&&(a.rotate=w)}_applyChanges(){const n={},a={},d={};for(const[_,g,w]of this._changes)_.panDelta&&(n.panDelta=(n.panDelta||new s.pointGeometry(0,0))._add(_.panDelta)),_.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(n.around=_.around),_.aroundCoord!==void 0&&(n.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(n.pinchAround=_.pinchAround),_.noInertia&&(n.noInertia=_.noInertia),s.extend(a,g),s.extend(d,w);this._updateMapTransform(n,a,d),this._changes=[]}_updateMapTransform(n,a,d){const _=this._map,g=_.transform,w=te=>[te.x,te.y,te.z];if((te=>{const K=this._eventsInProgress.drag;return K&&!this._handlersById[K.handlerName].isActive()})()&&!Jo(n)){const te=g.zoom;g.cameraElevationReference="sea",g.recenterOnTerrain(),g.cameraElevationReference="ground",te!==g.zoom&&this._map._update(!0)}if(!Jo(n))return void this._fireEvents(a,d,!0);let{panDelta:T,zoomDelta:C,bearingDelta:k,pitchDelta:z,around:R,aroundCoord:j,pinchAround:X}=n;X!==void 0&&(R=X),(te=>a.drag&&!this._eventsInProgress.drag)()&&R&&(this._dragOrigin=w(g.pointCoordinate3D(R)),this._trackingEllipsoid.setup(g._camera.position,this._dragOrigin)),g.cameraElevationReference="sea",_._stop(!0),R=R||_.transform.centerPoint,k&&(g.bearing+=k),z&&(g.pitch+=z),g._updateCameraState();const Z=[0,0,0];if(T)if(g.projection.name==="mercator"){const te=this._trackingEllipsoid.projectRay(g.screenPointToMercatorRay(R).dir),K=this._trackingEllipsoid.projectRay(g.screenPointToMercatorRay(R.sub(T)).dir);Z[0]=K[0]-te[0],Z[1]=K[1]-te[1]}else{const te=g.pointCoordinate(R);if(g.projection.name==="globe"){T=T.rotate(-g.angle);const K=g._pixelsPerMercatorPixel/g.worldSize;Z[0]=-T.x*s.mercatorScale(s.latFromMercatorY(te.y))*K,Z[1]=-T.y*s.mercatorScale(g.center.lat)*K}else{const K=g.pointCoordinate(R.sub(T));te&&K&&(Z[0]=K.x-te.x,Z[1]=K.y-te.y)}}const W=g.zoom,H=[0,0,0];if(C){const te=w(j||g.pointCoordinate3D(R)),K={dir:s.normalize([],s.sub([],te,g._camera.position))};if(K.dir[2]<0){const fe=g.zoomDeltaToMovement(te,C);s.scale$2(H,K.dir,fe)}}const G=s.add(Z,Z,H);g._translateCameraConstrained(G),C&&Math.abs(g.zoom-W)>1e-4&&g.recenterOnTerrain(),g.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(a,d,!0)}_fireEvents(n,a,d){const _=Fa(this._eventsInProgress),g=Fa(n),w={};for(const z in n){const{originalEvent:R}=n[z];this._eventsInProgress[z]||(w[`${z}start`]=R),this._eventsInProgress[z]=n[z]}!_&&g&&this._fireEvent("movestart",g.originalEvent);for(const z in w)this._fireEvent(z,w[z]);g&&this._fireEvent("move",g.originalEvent);for(const z in n){const{originalEvent:R}=n[z];this._fireEvent(z,R)}const T={};let C;for(const z in this._eventsInProgress){const{handlerName:R,originalEvent:j}=this._eventsInProgress[z];this._handlersById[R].isActive()||(delete this._eventsInProgress[z],C=a[R]||j,T[`${z}end`]=C)}for(const z in T)this._fireEvent(z,T[z]);const k=Fa(this._eventsInProgress);if(d&&(_||g)&&!k){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;z?(R(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:C})):(this._map.fire(new s.Event("moveend",{originalEvent:C})),R(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,a){this._map.fire(new s.Event(n,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new Gl("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Su="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ed extends s.Evented{constructor(n,a){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=a.bearingSnap,s.bindAll(["_renderFrameCallback"],this)}getCenter(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(n,a){return this.jumpTo({center:n},a)}panBy(n,a,d){return n=s.pointGeometry.convert(n).mult(-1),this.panTo(this.transform.center,s.extend({offset:n},a),d)}panTo(n,a,d){return this.easeTo(s.extend({center:n},a),d)}getZoom(){return this.transform.zoom}setZoom(n,a){return this.jumpTo({zoom:n},a),this}zoomTo(n,a,d){return this.easeTo(s.extend({zoom:n},a),d)}zoomIn(n,a){return this.zoomTo(this.getZoom()+1,n,a),this}zoomOut(n,a){return this.zoomTo(this.getZoom()-1,n,a),this}getBearing(){return this.transform.bearing}setBearing(n,a){return this.jumpTo({bearing:n},a),this}getPadding(){return this.transform.padding}setPadding(n,a){return this.jumpTo({padding:n},a),this}rotateTo(n,a,d){return this.easeTo(s.extend({bearing:n},a),d)}resetNorth(n,a){return this.rotateTo(0,s.extend({duration:1e3},n),a),this}resetNorthPitch(n,a){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},n),a),this}snapToNorth(n,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,a):this}getPitch(){return this.transform.pitch}setPitch(n,a){return this.jumpTo({pitch:n},a),this}cameraForBounds(n,a){this.transform.projection.name==="globe"&&s.warnOnce('Globe projection does not support cameraForBounds API, this API may behave unexpectedly."'),n=s.LngLatBounds.convert(n);const d=a&&a.bearing||0;return this._cameraForBoxAndBearing(n.getNorthWest(),n.getSouthEast(),d,a)}_extendCameraOptions(n){const a={top:0,bottom:0,right:0,left:0};if(typeof(n=s.extend({padding:a,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=="number"){const d=n.padding;n.padding={top:d,bottom:d,right:d,left:d}}return n.padding=s.extend(a,n.padding),n}_cameraForBoxAndBearing(n,a,d,_){const g=this._extendCameraOptions(_),w=this.transform,T=w.padding,C=w.project(s.LngLat.convert(n)),k=w.project(s.LngLat.convert(a)),z=new s.pointGeometry(C.x,k.y),R=new s.pointGeometry(k.x,C.y),j=-s.degToRad(d),X=C.rotate(j),Z=k.rotate(j),W=z.rotate(j),H=R.rotate(j),G=new s.pointGeometry(Math.max(X.x,Z.x,W.x,H.x),Math.max(X.y,Z.y,W.y,H.y)),te=new s.pointGeometry(Math.min(X.x,Z.x,W.x,H.x),Math.min(X.y,Z.y,W.y,H.y)),K=G.sub(te),fe=(w.width-((T.left||0)+(T.right||0)+g.padding.left+g.padding.right))/K.x,he=(w.height-((T.top||0)+(T.bottom||0)+g.padding.top+g.padding.bottom))/K.y;if(he<0||fe<0)return void s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const oe=Math.min(w.scaleZoom(w.scale*Math.min(fe,he)),g.maxZoom),de=typeof g.offset.x=="number"&&typeof g.offset.y=="number"?new s.pointGeometry(g.offset.x,g.offset.y):s.pointGeometry.convert(g.offset),le=new s.pointGeometry((g.padding.left-g.padding.right)/2,(g.padding.top-g.padding.bottom)/2).rotate(d*Math.PI/180),ye=de.add(le).mult(w.scale/w.zoomScale(oe));return{center:w.unproject(C.add(k).div(2).sub(ye)),zoom:oe,bearing:d}}_cameraForBox(n,a,d,_,g){const w=this._extendCameraOptions(g);d=d||0,_=_||0,n=s.LngLat.convert(n),a=s.LngLat.convert(a);const T=this.transform.clone();T.padding=w.padding;const C=this.getFreeCameraOptions(),k=new s.LngLat(.5*(n.lng+a.lng),.5*(n.lat+a.lat)),z=.5*(d+_);if(T._camera.position[2]<s.mercatorZfromAltitude(z,k.lat))return void s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");C.lookAtPoint(k),T.setFreeCameraOptions(C);const R=s.MercatorCoordinate.fromLngLat(n),j=s.MercatorCoordinate.fromLngLat(a),X=T.pointRayIntersection(T.centerPoint,z),Z=[(W=T.rayIntersectionCoordinate(X)).x,W.y,W.z];var W;const H=T.screenPointToMercatorRay(T.centerPoint),G=T.projection.name!=="globe";let te,K=0;do{const fe=Math.floor(T.zoom),he=1<<fe,oe=Math.min(he*R.x,he*j.x),de=Math.min(he*R.y,he*j.y),le=Math.max(he*R.x,he*j.x),ye=Math.max(he*R.y,he*j.y),Le=new s.Aabb([oe,de,d],[le,ye,_]),dt=s.Frustum.fromInvProjectionMatrix(T.invProjMatrix,T.worldSize,fe,G);if(Le.intersects(dt)!==2){te&&(T._camera.position=s.scaleAndAdd([],T._camera.position,H.dir,-te),T._updateStateFromCamera());break}const Ae=s.sub([],T._camera.position,Z);te=.5*s.length(Ae),T._camera.position=s.scaleAndAdd([],T._camera.position,H.dir,te);try{T._updateStateFromCamera()}catch{return void s.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++K<10);return{center:T.center,zoom:T.zoom,bearing:T.bearing,pitch:T.pitch}}fitBounds(n,a,d){return this.transform.projection.name==="globe"&&s.warnOnce("Globe projection does not support fitBounds API, this API may behave unexpectedly."),this._fitInternal(this.cameraForBounds(n,a),a,d)}_raycastElevationBox(n,a){const d=this.transform.elevation;if(!d)return;const _=new s.pointGeometry(n.x,a.y),g=new s.pointGeometry(a.x,n.y),w=d.pointCoordinate(n);if(!w)return;const T=d.pointCoordinate(a);if(!T)return;const C=d.pointCoordinate(_);if(!C)return;const k=d.pointCoordinate(g);if(!k)return;const z=new s.MercatorCoordinate(w[0],w[1]).toLngLat(),R=new s.MercatorCoordinate(T[0],T[1]).toLngLat(),j=new s.MercatorCoordinate(C[0],C[1]).toLngLat(),X=new s.MercatorCoordinate(k[0],k[1]).toLngLat(),Z=Math.min(z.lng,Math.min(R.lng,Math.min(j.lng,X.lng))),W=Math.min(z.lat,Math.min(R.lat,Math.min(j.lat,X.lat))),H=Math.max(z.lng,Math.max(R.lng,Math.max(j.lng,X.lng))),G=Math.max(z.lat,Math.max(R.lat,Math.max(j.lat,X.lat))),te=Math.min(w[3],Math.min(T[3],Math.min(C[3],k[3]))),K=Math.max(w[3],Math.max(T[3],Math.max(C[3],k[3])));return{minLngLat:new s.LngLat(Z,W),maxLngLat:new s.LngLat(H,G),minAltitude:te,maxAltitude:K}}fitScreenCoordinates(n,a,d,_,g){let w,T,C,k;this.transform.projection.name==="globe"&&s.warnOnce("Globe projection does not support fitScreenCoordinates API, this API may behave unexpectedly.");const z=s.pointGeometry.convert(n),R=s.pointGeometry.convert(a),j=this._raycastElevationBox(z,R);if(j)w=j.minLngLat,T=j.maxLngLat,C=j.minAltitude,k=j.maxAltitude;else{if(this.transform.anyCornerOffEdge(z,R))return this;w=this.transform.pointLocation(z),T=this.transform.pointLocation(R)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(s.pointGeometry.convert(n)),this.transform.pointLocation(s.pointGeometry.convert(a)),d,_):this._cameraForBox(w,T,C,k,_),_,g)}_fitInternal(n,a,d){return n?(delete(a=s.extend(n,a)).padding,a.linear?this.easeTo(a,d):this.flyTo(a,d)):this}jumpTo(n,a){this.stop();const d=n.preloadOnly?this.transform.clone():this.transform;let _=!1,g=!1,w=!1;return"zoom"in n&&d.zoom!==+n.zoom&&(_=!0,d.zoom=+n.zoom),n.center!==void 0&&(d.center=s.LngLat.convert(n.center)),"bearing"in n&&d.bearing!==+n.bearing&&(g=!0,d.bearing=+n.bearing),"pitch"in n&&d.pitch!==+n.pitch&&(w=!0,d.pitch=+n.pitch),n.padding==null||d.isPaddingEqual(n.padding)||(d.padding=n.padding),n.preloadOnly?(this._preloadTiles(d),this):(this.fire(new s.Event("movestart",a)).fire(new s.Event("move",a)),_&&this.fire(new s.Event("zoomstart",a)).fire(new s.Event("zoom",a)).fire(new s.Event("zoomend",a)),g&&this.fire(new s.Event("rotatestart",a)).fire(new s.Event("rotate",a)).fire(new s.Event("rotateend",a)),w&&this.fire(new s.Event("pitchstart",a)).fire(new s.Event("pitch",a)).fire(new s.Event("pitchend",a)),this.fire(new s.Event("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.warnOnce(Su),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,a){const d=this.transform;if(!d.projection.supportsFreeCamera)return s.warnOnce(Su),this;this.stop();const _=d.zoom,g=d.pitch,w=d.bearing;d.setFreeCameraOptions(n);const T=_!==d.zoom,C=g!==d.pitch,k=w!==d.bearing;return this.fire(new s.Event("movestart",a)).fire(new s.Event("move",a)),T&&this.fire(new s.Event("zoomstart",a)).fire(new s.Event("zoom",a)).fire(new s.Event("zoomend",a)),k&&this.fire(new s.Event("rotatestart",a)).fire(new s.Event("rotate",a)).fire(new s.Event("rotateend",a)),C&&this.fire(new s.Event("pitchstart",a)).fire(new s.Event("pitch",a)).fire(new s.Event("pitchend",a)),this.fire(new s.Event("moveend",a)),this}easeTo(n,a){this._stop(!1,n.easeId),((n=s.extend({offset:[0,0],duration:500,easing:s.ease},n)).animate===!1||!n.essential&&s.exported.prefersReducedMotion)&&(n.duration=0);const d=this.transform,_=this.getZoom(),g=this.getBearing(),w=this.getPitch(),T=this.getPadding(),C="zoom"in n?+n.zoom:_,k="bearing"in n?this._normalizeBearing(n.bearing,g):g,z="pitch"in n?+n.pitch:w,R="padding"in n?n.padding:d.padding,j=s.pointGeometry.convert(n.offset);let X,Z,W;if(d.projection.name==="globe"){const ye=s.MercatorCoordinate.fromLngLat(d.center),Le=j.rotate(-d.angle);ye.x+=Le.x/d.worldSize,ye.y+=Le.y/d.worldSize;const dt=ye.toLngLat(),Ae=s.LngLat.convert(n.center||dt);this._normalizeCenter(Ae),X=d.centerPoint.add(Le),Z=new s.pointGeometry(ye.x,ye.y).mult(d.worldSize),W=new s.pointGeometry(s.mercatorXfromLng(Ae.lng),s.mercatorYfromLat(Ae.lat)).mult(d.worldSize).sub(Z)}else{X=d.centerPoint.add(j);const ye=d.pointLocation(X),Le=s.LngLat.convert(n.center||ye);this._normalizeCenter(Le),Z=d.project(ye),W=d.project(Le).sub(Z)}const H=d.zoomScale(C-_);let G,te;n.around&&(G=s.LngLat.convert(n.around),te=d.locationPoint(G));const K=this._zooming||C!==_,fe=this._rotating||g!==k,he=this._pitching||z!==w,oe=!d.isPaddingEqual(R),de=ye=>Le=>{if(K&&(ye.zoom=s.number(_,C,Le)),fe&&(ye.bearing=s.number(g,k,Le)),he&&(ye.pitch=s.number(w,z,Le)),oe&&(ye.interpolatePadding(T,R,Le),X=ye.centerPoint.add(j)),G)ye.setLocationAtPoint(G,te);else{const dt=ye.zoomScale(ye.zoom-_),Ae=C>_?Math.min(2,H):Math.max(.5,H),Je=Math.pow(Ae,1-Le),rt=ye.unproject(Z.add(W.mult(Le*Je)).mult(dt));ye.setLocationAtPoint(ye.renderWorldCopies?rt.wrap():rt,X)}return n.preloadOnly||this._fireMoveEvents(a),ye};if(n.preloadOnly){const ye=this._emulate(de,n.duration,d);return this._preloadTiles(ye),this}const le={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=K,this._rotating=fe,this._pitching=he,this._padding=oe,this._easeId=n.easeId,this._prepareEase(a,n.noMoveStart,le),this._ease(de(d),ye=>{d.recenterOnTerrain(),this._afterEase(a,ye)},n),this}_prepareEase(n,a,d={}){this._moving=!0,this.transform.cameraElevationReference="sea",a||d.moving||this.fire(new s.Event("movestart",n)),this._zooming&&!d.zooming&&this.fire(new s.Event("zoomstart",n)),this._rotating&&!d.rotating&&this.fire(new s.Event("rotatestart",n)),this._pitching&&!d.pitching&&this.fire(new s.Event("pitchstart",n))}_fireMoveEvents(n){this.fire(new s.Event("move",n)),this._zooming&&this.fire(new s.Event("zoom",n)),this._rotating&&this.fire(new s.Event("rotate",n)),this._pitching&&this.fire(new s.Event("pitch",n))}_afterEase(n,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const d=this._zooming,_=this._rotating,g=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new s.Event("zoomend",n)),_&&this.fire(new s.Event("rotateend",n)),g&&this.fire(new s.Event("pitchend",n)),this.fire(new s.Event("moveend",n))}flyTo(n,a){if(!n.essential&&s.exported.prefersReducedMotion){const It=s.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(It,a)}this.stop(),n=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},n);const d=this.transform,_=this.getZoom(),g=this.getBearing(),w=this.getPitch(),T=this.getPadding(),C="zoom"in n?s.clamp(+n.zoom,d.minZoom,d.maxZoom):_,k="bearing"in n?this._normalizeBearing(n.bearing,g):g,z="pitch"in n?+n.pitch:w,R="padding"in n?n.padding:d.padding,j=d.zoomScale(C-_),X=s.pointGeometry.convert(n.offset);let Z=d.centerPoint.add(X);const W=d.pointLocation(Z),H=s.LngLat.convert(n.center||W);this._normalizeCenter(H);const G=d.project(W),te=d.project(H).sub(G);let K=n.curve;const fe=Math.max(d.width,d.height),he=fe/j,oe=te.mag();if("minZoom"in n){const It=s.clamp(Math.min(n.minZoom,_,C),d.minZoom,d.maxZoom),St=fe/d.zoomScale(It-_);K=Math.sqrt(St/oe*2)}const de=K*K;function le(It){const St=(he*he-fe*fe+(It?-1:1)*de*de*oe*oe)/(2*(It?he:fe)*de*oe);return Math.log(Math.sqrt(St*St+1)-St)}function ye(It){return(Math.exp(It)-Math.exp(-It))/2}function Le(It){return(Math.exp(It)+Math.exp(-It))/2}const dt=le(0);let Ae=function(It){return Le(dt)/Le(dt+K*It)},Je=function(It){return fe*((Le(dt)*(ye(St=dt+K*It)/Le(St))-ye(dt))/de)/oe;var St},rt=(le(1)-dt)/K;if(Math.abs(oe)<1e-6||!isFinite(rt)){if(Math.abs(fe-he)<1e-6)return this.easeTo(n,a);const It=he<fe?-1:1;rt=Math.abs(Math.log(he/fe))/K,Je=function(){return 0},Ae=function(St){return Math.exp(It*K*St)}}n.duration="duration"in n?+n.duration:1e3*rt/("screenSpeed"in n?+n.screenSpeed/K:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const wt=g!==k,je=z!==w,mt=!d.isPaddingEqual(R),it=It=>St=>{const Ot=St*rt,Wt=1/Ae(Ot);It.zoom=St===1?C:_+It.scaleZoom(Wt),wt&&(It.bearing=s.number(g,k,St)),je&&(It.pitch=s.number(w,z,St)),mt&&(It.interpolatePadding(T,R,St),Z=It.centerPoint.add(X));const ii=St===1?H:It.unproject(G.add(te.mult(Je(Ot))).mult(Wt));return It.setLocationAtPoint(It.renderWorldCopies?ii.wrap():ii,Z),It._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(a),It};if(n.preloadOnly){const It=this._emulate(it,n.duration,d);return this._preloadTiles(It),this}return this._zooming=!0,this._rotating=wt,this._pitching=je,this._padding=mt,this._prepareEase(a,!1),this._ease(it(d),()=>this._afterEase(a),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const d=this._onEaseEnd;this._onEaseEnd=void 0,d.call(this,a)}if(!n){const d=this.handlers;d&&d.stop(!1)}return this}_ease(n,a,d){d.animate===!1||d.duration===0?(n(1),a()):(this._easeStart=s.exported.now(),this._easeOptions=d,this._onEaseFrame=n,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((s.exported.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,a){n=s.wrap(n,-180,180);const d=Math.abs(n-a);return Math.abs(n-360-a)<d&&(n-=360),Math.abs(n+360-a)<d&&(n+=360),n}_normalizeCenter(n){const a=this.transform;if(!a.renderWorldCopies||a.maxBounds)return;const d=n.lng-a.center.lng;n.lng+=d>180?-360:d<-180?360:0}_emulate(n,a,d){const _=Math.ceil(15*a/1e3),g=[],w=n(d.clone());for(let T=0;T<=_;T++){const C=w(T/_);g.push(C.clone())}return g}}class Cu{constructor(n={}){this.options=n,s.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const a=this.options&&this.options.compact;return this._map=n,this._container=q("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=q("button","mapboxgl-ctrl-attrib-button",this._container),q("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=q("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,a){const d=this._map._getUIString(`AttributionControl.${a}`);n.setAttribute("aria-label",d),n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",d)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.config.ACCESS_TOKEN}];if(n){const d=a.reduce((_,g,w)=>(g.value&&(_+=`${g.key}=${g.value}${w<a.length-1?"&":""}`),_),"?");n.href=`${s.config.FEEDBACK_URL}/${d}#${xu(this._map,!0)}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const a=this._map.style._sourceCaches;for(const _ in a){const g=a[_];if(g.used){const w=g.getSource();w.attribution&&n.indexOf(w.attribution)<0&&n.push(w.attribution)}}n.sort((_,g)=>_.length-g.length),n=n.filter((_,g)=>{for(let w=g+1;w<n.length;w++)if(n[w].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const d=n.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,n.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Au{constructor(){s.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=q("div","mapboxgl-ctrl");const a=q("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const a in n){const d=n[a].getSource();if(d.hasOwnProperty("mapbox_logo")&&!d.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const a=n[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class Mu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const a=++this._id;return this._queue.push({callback:n,id:a,cancelled:!1}),a}remove(n){const a=this._currentlyRunning,d=a?this._queue.concat(a):this._queue;for(const _ of d)if(_.id===n)return void(_.cancelled=!0)}run(n=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const d of a)if(!d.cancelled&&(d.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Iu(c,n,a){if(c=new s.LngLat(c.lng,c.lat),n){const d=new s.LngLat(c.lng-360,c.lat),_=new s.LngLat(c.lng+360,c.lat),g=360*Math.ceil(Math.abs(c.lng-a.center.lng)/360),w=a.locationPoint(c).distSqr(n),T=n.x<0||n.y<0||n.x>a.width||n.y>a.height;a.locationPoint(d).distSqr(n)<w&&(T||Math.abs(d.lng-a.center.lng)<g)?c=d:a.locationPoint(_).distSqr(n)<w&&(T||Math.abs(_.lng-a.center.lng)<g)&&(c=_)}for(;Math.abs(c.lng-a.center.lng)>180;){const d=a.locationPoint(c);if(d.x>=0&&d.y>=0&&d.x<=a.width&&d.y<=a.height)break;c.lng>a.center.lng?c.lng-=360:c.lng+=360}return c}const Oa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Zl extends s.Evented{constructor(n,a){if(super(),(n instanceof s.window.HTMLElement||a)&&(n=s.extend({element:n},a)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),n&&n.element)this._element=n.element,this._offset=s.pointGeometry.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=q("div");const _=41,g=27,w=Y("svg",{display:"block",height:_*this._scale+"px",width:g*this._scale+"px",viewBox:`0 0 ${g} ${_}`},this._element),T=Y("radialGradient",{id:"shadowGradient"},Y("defs",{},w));Y("stop",{offset:"10%","stop-opacity":.4},T),Y("stop",{offset:"100%","stop-opacity":.05},T),Y("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},w),Y("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},w),Y("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},w),Y("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},w),this._offset=s.pointGeometry.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",_=>{_.preventDefault()}),this._element.addEventListener("mousedown",_=>{_.preventDefault()});const d=this._element.classList;for(const _ in Oa)d.remove(`mapboxgl-marker-anchor-${_}`);d.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=s.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const a=n.code,d=n.charCode||n.keyCode;a!=="Space"&&a!=="Enter"&&d!==32&&d!==13||this.togglePopup()}_onMapClick(n){const a=n.originalEvent.target,d=this._element;this._popup&&(a===d||d.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map;if(!n)return!1;const a=n.unproject(this._pos),d=n.getFreeCameraOptions();if(!d.position)return!1;const _=d.position.toLngLat();return _.distanceTo(a)<.9*_.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const a=this._pos;if(!a||a.x<0||a.x>n.transform.width||a.y<0||a.y>n.transform.height)return void this._clearFadeTimer();const d=n.unproject(a);let _;n._showingGlobe()&&s.isLngLatBehindGlobe(n.transform,this._lngLat)?_=0:(_=1-n._queryFogOpacity(d),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(_*=.2)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const a=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${Oa[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${a.x}px,${a.y}px)
        `}_calculateXYTransform(){const n=this._pos,a=this._map,d=this.getPitchAlignment();if(!a||!n||d!=="map")return"";if(!a._showingGlobe()){const C=a.getPitch();return C?`rotateX(${C}deg)`:""}const _=s.radToDeg(s.globeTiltAtLngLat(a.transform,this._lngLat)),g=n.sub(s.globeCenterToScreenPoint(a.transform)),w=Math.abs(g.x)+Math.abs(g.y);if(w===0)return"";const T=_/w;return`rotateX(${-g.y*T}deg) rotateY(${g.x*T}deg)`}_calculateZTransform(){const n=this._pos,a=this._map;if(!a||!n)return"";let d=0;const _=this.getRotationAlignment();if(_==="map")if(a._showingGlobe()){const g=a.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),w=a.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(g);d=s.radToDeg(Math.atan2(w.y,w.x))-90}else d=-a.getBearing();else if(_==="horizon"){const g=s.smoothstep(4,6,a.getZoom()),w=s.globeCenterToScreenPoint(a.transform);w.y+=g*a.transform.height;const T=n.sub(w),C=s.radToDeg(Math.atan2(T.y,T.x));d=(C>90?C-270:C+90)*(1-g)}return d+=this._rotation,d?`rotateZ(${d}deg)`:""}_update(n){s.window.cancelAnimationFrame(this._updateFrameId);const a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=Iu(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat),n===!0?this._updateFrameId=s.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),a._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=s.pointGeometry.convert(n),this._update(),this}_onMove(n){const a=this._map;if(a){if(!this._isDragging){const d=this._clickTolerance||a._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=a.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"}_addDragHandler(n){const a=this._map;a&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos),this._pointerdownPos=n.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const a=this._map;return a&&(n?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}}class Sd{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const a=s.easeCubicInOut((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,a,d){this._start=this.getValue(a),this._end=n,this._startTime=a,this._endTime=a+d}}const Cd={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Ad={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Va(c){c.parentNode&&c.parentNode.removeChild(c)}const Md={showCompass:!0,showZoom:!0,visualizePitch:!1};class ku{constructor(n,a,d=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new wu({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,d&&(this.mousePitch=new Rn({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(n,a){this.mouseRotate.mousedown(n,a),this.mousePitch&&this.mousePitch.mousedown(n,a),Ye()}move(n,a){const d=this.map,_=this.mouseRotate.mousemoveWindow(n,a),g=_&&_.bearingDelta;if(g&&d.setBearing(d.getBearing()+g),this.mousePitch){const w=this.mousePitch.mousemoveWindow(n,a),T=w&&w.pitchDelta;T&&d.setPitch(d.getPitch()+T)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){we(),s.window.removeEventListener("mousemove",this.mousemove),s.window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(s.extend({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),Se(this.element,n)),s.window.addEventListener("mousemove",this.mousemove),s.window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,Se(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=De(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=De(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Id={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},zu={maxWidth:100,unit:"metric"};function Pu(c,n,a){const d=Wl(n),_=d/n,g={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[a];this._map._requestDomTask(()=>{this._container.style.width=c*_+"px",this._container.innerHTML=`${d}&nbsp;${g}`})}function Wl(c){const n=Math.pow(10,`${Math.floor(c)}`.length-1);let a=c/n;return a=a>=10?10:a>=5?5:a>=3?3:a>=2?2:a>=1?1:function(d){const _=Math.pow(10,Math.ceil(-Math.log(d)/Math.LN10));return Math.round(d*_)/_}(a),n*a}const Vp={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Up=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Hl(c=new s.pointGeometry(0,0),n="bottom"){if(typeof c=="number"){const a=Math.round(Math.sqrt(.5*Math.pow(c,2)));switch(n){case"top":return new s.pointGeometry(0,c);case"top-left":return new s.pointGeometry(a,a);case"top-right":return new s.pointGeometry(-a,a);case"bottom":return new s.pointGeometry(0,-c);case"bottom-left":return new s.pointGeometry(a,-a);case"bottom-right":return new s.pointGeometry(-a,-a);case"left":return new s.pointGeometry(c,0);case"right":return new s.pointGeometry(-c,0)}return new s.pointGeometry(0,0)}return c instanceof s.pointGeometry||Array.isArray(c)?s.pointGeometry.convert(c):s.pointGeometry.convert(c[n]||[0,0])}const Ua={version:s.version,supported:V,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:class extends Ed{constructor(c){if((c=s.extend({},Ad,c)).minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(c.antialias&&s.isSafariWithAntialiasingBug(s.window)&&(c.antialias=!1,s.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Pa(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies),c),this._interactive=c.interactive,this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=c.preserveDrawingBuffer,this._antialias=c.antialias,this._trackResize=c.trackResize,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles,this._fadeDuration=c.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=c.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=c.collectResourceTiming,this._optimizeForTerrain=c.optimizeForTerrain,this._language=c.language==="auto"?s.window.navigator.language:c.language,this._worldview=c.worldview,this._renderTaskQueue=new Mu,this._domRenderTaskQueue=new Mu,this._controls=[],this._markers=[],this._mapId=s.uniqueId(),this._locale=s.extend({},Cd,c.locale),this._clickTolerance=c.clickTolerance,this._cooperativeGestures=c.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Sd(0),this._useExplicitProjection=!1,this._requestManager=new s.RequestManager(c.transformRequest,c.accessToken,c.testMode),this._silenceAuthErrors=!!c.testMode,typeof c.container=="string"){if(this._container=s.window.document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof s.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(this._container.childNodes.length>0&&s.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),c.maxBounds&&this.setMaxBounds(c.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),s.window!==void 0&&(s.window.addEventListener("online",this._onWindowOnline,!1),s.window.addEventListener("resize",this._onWindowResize,!1),s.window.addEventListener("orientationchange",this._onWindowResize,!1),s.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Td(this,c),this._localFontFamily=c.localFontFamily,this._localIdeographFontFamily=c.localIdeographFontFamily,c.style&&this.setStyle(c.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),c.projection&&this.setProjection(c.projection),this._hash=c.hash&&new od(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,s.extend({},c.fitBoundsOptions,{duration:0})))),this.resize(),c.attributionControl&&this.addControl(new Cu({customAttribution:c.customAttribution})),this._logoControl=new Au,this.addControl(this._logoControl,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new s.Event(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new s.Event(`${n.dataType}dataloading`,n))})}_getMapId(){return this._mapId}addControl(c,n){if(n===void 0&&(n=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=c.onAdd(this);this._controls.push(c);const d=this._controlPositions[n];return n.indexOf("bottom")!==-1?d.insertBefore(a,d.firstChild):d.appendChild(a),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(c);return n>-1&&this._controls.splice(n,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(c){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new s.Event("movestart",c)).fire(new s.Event("move",c)),this.fire(new s.Event("resize",c)),n&&this.fire(new s.Event("moveend",c)),this}getBounds(){return this.transform.projection.name==="globe"&&s.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(c){return this.transform.setMaxBounds(s.LngLatBounds.convert(c)),this._update()}setMinZoom(c){if((c=c==null?-2:c)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c?this.setZoom(c):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c==null?22:c)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c?this.setZoom(c):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c==null?0:c)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c?this.setPitch(c):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c==null?85:c)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c?this.setPitch(c):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this._update()}getLanguage(){return this._language}setLanguage(c){if(this._language=c==="auto"?s.window.navigator.language:c,this.style)for(const n in this.style._sourceCaches){const a=this.style._sourceCaches[n]._source;a._setLanguage&&a._setLanguage(this._language)}for(const n of this._controls)n._setLanguage&&n._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(c){if(this._worldview=c,this.style)for(const n in this.style._sourceCaches){const a=this.style._sourceCaches[n]._source;a._setWorldview&&a._setWorldview(c)}return this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(c){return this._lazyInitEmptyStyle(),c?typeof c=="string"&&(c={name:c}):c=null,this._useExplicitProjection=!!c,this._prioritizeAndUpdateProjection(c,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const c=this.transform,n=c.projection.name;let a;n==="globe"&&c.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?(c.setMercatorFromTransition(),a=!0):n==="mercator"&&c.zoom<s.GLOBE_ZOOM_THRESHOLD_MAX&&(c.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(c,n){return this._updateProjection(c||n||{name:"mercator"})}_updateProjection(c){let n;if(n=c.name==="globe"&&this.transform.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(c),this.style.applyProjectionUpdate(),n){this.painter.clearBackgroundTiles();for(const a in this.style._sourceCaches)this.style._sourceCaches[a].clearTiles();this._update(!0)}return this}project(c){return this.transform.locationPoint3D(s.LngLat.convert(c))}unproject(c){return this.transform.pointLocation3D(s.pointGeometry.convert(c))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(c,n,a){if(c==="mouseenter"||c==="mouseover"){let d=!1;const _=w=>{const T=n.filter(k=>this.getLayer(k)),C=T.length?this.queryRenderedFeatures(w.point,{layers:T}):[];C.length?d||(d=!0,a.call(this,new $n(c,this,w.originalEvent,{features:C}))):d=!1},g=()=>{d=!1};return{layers:new Set(n),listener:a,delegates:{mousemove:_,mouseout:g}}}if(c==="mouseleave"||c==="mouseout"){let d=!1;const _=w=>{const T=n.filter(C=>this.getLayer(C));(T.length?this.queryRenderedFeatures(w.point,{layers:T}):[]).length?d=!0:d&&(d=!1,a.call(this,new $n(c,this,w.originalEvent)))},g=w=>{d&&(d=!1,a.call(this,new $n(c,this,w.originalEvent)))};return{layers:new Set(n),listener:a,delegates:{mousemove:_,mouseout:g}}}{const d=_=>{const g=n.filter(T=>this.getLayer(T)),w=g.length?this.queryRenderedFeatures(_.point,{layers:g}):[];w.length&&(_.features=w,a.call(this,_),delete _.features)};return{layers:new Set(n),listener:a,delegates:{[c]:d}}}}on(c,n,a){if(a===void 0)return super.on(c,n);Array.isArray(n)||(n=[n]);const d=this._createDelegatedListener(c,n,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(d);for(const _ in d.delegates)this.on(_,d.delegates[_]);return this}once(c,n,a){if(a===void 0)return super.once(c,n);Array.isArray(n)||(n=[n]);const d=this._createDelegatedListener(c,n,a);for(const _ in d.delegates)this.once(_,d.delegates[_]);return this}off(c,n,a){if(a===void 0)return super.off(c,n);n=new Set(Array.isArray(n)?n:[n]);const d=(g,w)=>{if(g.size!==w.size)return!1;for(const T of g)if(!w.has(T))return!1;return!0},_=this._delegatedListeners?this._delegatedListeners[c]:void 0;return _&&(g=>{for(let w=0;w<g.length;w++){const T=g[w];if(T.listener===a&&d(T.layers,n)){for(const C in T.delegates)this.off(C,T.delegates[C]);return g.splice(w,1),this}}})(_),this}queryRenderedFeatures(c,n){return this.style?(n!==void 0||c===void 0||c instanceof s.pointGeometry||Array.isArray(c)||(n=c,c=void 0),this.style.queryRenderedFeatures(c=c||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(c,n){return this.style.querySourceFeatures(c,n)}queryTerrainElevation(c,n){const a=this.transform.elevation;return a?(n=s.extend({},{exaggerated:!0},n),a.getAtPoint(s.MercatorCoordinate.fromLngLat(c),null,n.exaggerated)):null}setStyle(c,n){return(n=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&c?(this._diffStyle(c,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(c,n))}_getUIString(c){const n=this._locale[c];if(n==null)throw new Error(`Missing UI string '${c}'`);return n}_updateStyle(c,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),c&&(this.style=new Sr(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof c=="string"?this.style.loadURL(c):this.style.loadJSON(c)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Sr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(c,n){if(typeof c=="string"){const a=this._requestManager.normalizeStyleURL(c),d=this._requestManager.transformRequest(a,s.ResourceType.Style);s.getJSON(d,(_,g)=>{_?this.fire(new s.ErrorEvent(_)):g&&this._updateDiff(g,n)})}else typeof c=="object"&&this._updateDiff(c,n)}_updateDiff(c,n){try{this.style.setState(c)&&this._update(!0)}catch(a){s.warnOnce(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(c,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.warnOnce("There is no style added to the map."),!1)}addSource(c,n){return this._lazyInitEmptyStyle(),this.style.addSource(c,n),this._update(!0)}isSourceLoaded(c){return!!this.style&&this.style._isSourceCacheLoaded(c)}areTilesLoaded(){const c=this.style&&this.style._sourceCaches;for(const n in c){const a=c[n]._tiles;for(const d in a){const _=a[d];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}addSourceType(c,n,a){this._lazyInitEmptyStyle(),this.style.addSourceType(c,n,a)}removeSource(c){return this.style.removeSource(c),this._updateTerrain(),this._update(!0)}getSource(c){return this.style.getSource(c)}addImage(c,n,{pixelRatio:a=1,sdf:d=!1,stretchX:_,stretchY:g,content:w}={}){if(this._lazyInitEmptyStyle(),n instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&n instanceof s.window.ImageBitmap){const{width:T,height:C,data:k}=s.exported.getImageData(n);this.style.addImage(c,{data:new s.RGBAImage({width:T,height:C},k),pixelRatio:a,stretchX:_,stretchY:g,content:w,sdf:d,version:0})}else if(n.width===void 0||n.height===void 0)this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:T,height:C}=n,k=n;this.style.addImage(c,{data:new s.RGBAImage({width:T,height:C},new Uint8Array(k.data)),pixelRatio:a,stretchX:_,stretchY:g,content:w,sdf:d,version:0,userImage:k}),k.onAdd&&k.onAdd(this,c)}}updateImage(c,n){const a=this.style.getImage(c);if(!a)return void this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=n instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&n instanceof s.window.ImageBitmap?s.exported.getImageData(n):n,{width:_,height:g}=d;_!==void 0&&g!==void 0?_===a.data.width&&g===a.data.height?(a.data.replace(d.data,!(n instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&n instanceof s.window.ImageBitmap)),this.style.updateImage(c,a)):this.fire(new s.ErrorEvent(new Error(`The width and height of the updated image (${_}, ${g})
                must be that same as the previous version of the image
                (${a.data.width}, ${a.data.height})`))):this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(c){return c?!!this.style.getImage(c):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(c)}loadImage(c,n){s.getImage(this._requestManager.transformRequest(c,s.ResourceType.Image),(a,d)=>{n(a,d instanceof s.window.HTMLImageElement?s.exported.getImageData(d):d)})}listImages(){return this.style.listImages()}addLayer(c,n){return this._lazyInitEmptyStyle(),this.style.addLayer(c,n),this._update(!0)}moveLayer(c,n){return this.style.moveLayer(c,n),this._update(!0)}removeLayer(c){return this.style.removeLayer(c),this._update(!0)}getLayer(c){return this.style.getLayer(c)}setLayerZoomRange(c,n,a){return this.style.setLayerZoomRange(c,n,a),this._update(!0)}setFilter(c,n,a={}){return this.style.setFilter(c,n,a),this._update(!0)}getFilter(c){return this.style.getFilter(c)}setPaintProperty(c,n,a,d={}){return this.style.setPaintProperty(c,n,a,d),this._update(!0)}getPaintProperty(c,n){return this.style.getPaintProperty(c,n)}setLayoutProperty(c,n,a,d={}){return this.style.setLayoutProperty(c,n,a,d),this._update(!0)}getLayoutProperty(c,n){return this.style.getLayoutProperty(c,n)}setLight(c,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(c,n),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(c){return this._lazyInitEmptyStyle(),!c&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(c),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(c){return this._lazyInitEmptyStyle(),this.style.setFog(c),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(c){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.LngLat.convert(c),this.transform):0}setFeatureState(c,n){return this.style.setFeatureState(c,n),this._update()}removeFeatureState(c,n){return this.style.removeFeatureState(c,n),this._update()}getFeatureState(c){return this.style.getFeatureState(c)}_updateContainerDimensions(){if(!this._container)return;const c=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let a,d,_,g=this._container;for(;g&&(!d||!_);){const w=s.window.getComputedStyle(g).transform;w&&w!=="none"&&(a=w.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(d=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(_=a[3])),g=g.parentElement}this._containerWidth=d?Math.abs(c/d):c,this._containerHeight=_?Math.abs(n/_):n}_detectMissingCSS(){s.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const c=this._container;c.classList.add("mapboxgl-map"),(this._missingCSSCanary=q("div","mapboxgl-canary",c)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=q("div","mapboxgl-canvas-container",c);this._interactive&&n.classList.add("mapboxgl-interactive"),this._canvas=q("canvas","mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const a=this._controlContainer=q("div","mapboxgl-control-container",c),d=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{d[_]=q("div",`mapboxgl-ctrl-${_}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(c,n){const a=s.exported.devicePixelRatio||1;this._canvas.width=a*Math.ceil(c),this._canvas.height=a*Math.ceil(n),this._canvas.style.width=`${c}px`,this._canvas.style.height=`${n}px`}_addMarker(c){this._markers.push(c)}_removeMarker(c){const n=this._markers.indexOf(c);n!==-1&&this._markers.splice(n,1)}_setupPainter(){const c=s.extend({},V.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl",c)||this._canvas.getContext("experimental-webgl",c);n?(s.storeAuthState(n,!0),this.painter=new mu(n,this.transform),this.on("data",a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.exported$1.testSupport(n)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(c){c.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:c}))}_contextRestored(c){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:c}))}_onMapScroll(c){if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(c){return this.style?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_requestDomTask(c){!this.loaded()||this.loaded()&&!this.isMoving()?c():this._domRenderTaskQueue.add(c)}_render(c){let n;const a=this.painter.context.extTimerQuery,d=s.exported.now();if(this.listens("gpu-timing-frame")&&(n=a.createQueryEXT(),a.beginQueryEXT(a.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(c),this._domRenderTaskQueue.run(c),this._removed)return;this._updateProjectionTransition();let _=!1;const g=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const C=this.transform.zoom,k=this.transform.pitch,z=s.exported.now();this.style.zoomHistory.update(C,z);const R=new s.EvaluationParameters(C,{now:z,fadeDuration:g,pitch:k,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),j=R.crossFadingFactor();j===1&&j===this._crossFadingFactor||(_=!0,this._crossFadingFactor=j),this.style.update(R)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let w=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),w=this._updateAverageElevation(d),this.style._updateSources(this.transform),this._forceMarkerUpdate()):w=this._updateAverageElevation(d),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,g,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:g,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.Event("load"))),this.style&&(this.style.hasTransitions()||_)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const C=s.exported.now()-d;a.endQueryEXT(a.TIME_ELAPSED_EXT,n),setTimeout(()=>{const k=a.getQueryObjectEXT(n,a.QUERY_RESULT_EXT)/1e6;a.deleteQueryEXT(n),this.fire(new s.Event("gpu-timing-frame",{cpuTime:C,gpuTime:k})),s.window.performance.mark("frame-gpu",{startTime:d,detail:{gpuTime:k}})},50)}if(this.listens("gpu-timing-layer")){const C=this.painter.collectGpuTimers();setTimeout(()=>{const k=this.painter.queryGpuTimers(C);this.fire(new s.Event("gpu-timing-layer",{layerTimes:k}))},50)}if(this.listens("gpu-timing-deferred-render")){const C=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const k=this.painter.queryGpuTimeDeferredRender(C);this.fire(new s.Event("gpu-timing-deferred-render",{gpuTime:k}))},50)}const T=this._sourcesDirty||this._styleDirty||this._placementDirty||w;if(T||this._repaint)this.triggerRepaint();else{const C=!this.isMoving()&&this.loaded();if(C&&(w=this._updateAverageElevation(d,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),C&&(this.fire(new s.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const k=this._calculateSpeedIndex();this.fire(new s.Event("speedindexcompleted",{speedIndex:k})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||T||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const c of this._markers)c._update()}_updateAverageElevation(c,n=!1){const a=d=>(this.transform.averageElevation=d,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);if((n||c-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(c)){const d=this.transform.averageElevation;let _=this.transform.sampleAverageElevation(),g=!1;this.transform.elevation&&(g=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(_)?_=0:this._averageElevationLastSampledAt=c;const w=Math.abs(d-_);if(w>1){if(this._isInitialLoad||g)return this._averageElevation.jumpTo(_),a(_);this._averageElevation.easeTo(_,c,300)}else if(w>1e-4)return this._averageElevation.jumpTo(_),a(_)}return!!this._averageElevation.isEasing(c)&&a(this._averageElevation.getValue(c))}_authenticate(){s.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,c=>{if(c&&(c.message===s.AUTH_ERR_MSG||c.status===401)){const n=this.painter.context.gl;s.storeAuthState(n,!1),this._logoControl instanceof Au&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),s.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const c=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const a=this.painter.context.gl,d=a.createFramebuffer();function _(g){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,g,0);const w=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,w),w}return a.bindFramebuffer(a.FRAMEBUFFER,d),this._canvasPixelComparison(_(c),n.canvasCopies.map(_),n.timeStamps)}_canvasPixelComparison(c,n,a){let d=a[1]-a[0];const _=c.length/4;for(let g=0;g<n.length;g++){const w=n[g];let T=0;for(let C=0;C<w.length;C+=4)w[C]===c[C]&&w[C+1]===c[C+1]&&w[C+2]===c[C+2]&&w[C+3]===c[C+3]&&(T+=1);d+=(a[g+2]-a[g+1])*(1-T/_)}return d}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),s.window!==void 0&&(s.window.removeEventListener("resize",this._onWindowResize,!1),s.window.removeEventListener("orientationchange",this._onWindowResize,!1),s.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.removeEventListener("online",this._onWindowOnline,!1));const c=this.painter.context.gl.getExtension("WEBGL_lose_context");c&&c.loseContext(),Va(this._canvasContainer),Va(this._controlContainer),Va(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),s.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new s.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(c){this._renderNextFrame=this._renderNextFrame||c,this.style&&!this._frame&&(this._frame=s.exported.frame(n=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(n)}))}_preloadTiles(c){const n=this.style?Object.values(this.style._sourceCaches):[];return s.asyncAll(n,(a,d)=>a._preloadTiles(c,d),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(c){this._trackResize&&this.resize({originalEvent:c})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(c){this._showTerrainWireframe!==c&&(this._showTerrainWireframe=c,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(c){this._speedIndexTiming!==c&&(this._speedIndexTiming=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}_setCacheLimits(c,n){s.setCacheLimits(c,n)}get version(){return s.version}},NavigationControl:class{constructor(c){this.options=s.extend({},Md,c),this._container=q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),q("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),q("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:n}):a.resetNorth({},{originalEvent:n}))}),this._compassIcon=q("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const c=this._map;if(!c)return;const n=c.getZoom(),a=n===c.getMaxZoom(),d=n===c.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){const c=this._map;if(!c)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(c.transform.pitch*(Math.PI/180)),.5)}) rotateX(${c.transform.pitch}deg) rotateZ(${c.transform.angle*(180/Math.PI)}deg)`:`rotate(${c.transform.angle*(180/Math.PI)}deg)`;c._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),c.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&c.on("pitch",this._rotateCompassArrow),c.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ku(c,this._compass,this.options.visualizePitch)),this._container}onRemove(){const c=this._map;c&&(this._container.remove(),this.options.showZoom&&c.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&c.off("pitch",this._rotateCompassArrow),c.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(c,n){const a=q("button",c,this._container);return a.type="button",a.addEventListener("click",n),a}_setButtonTitle(c,n){if(!this._map)return;const a=this._map._getUIString(`NavigationControl.${n}`);c.setAttribute("aria-label",a),c.firstElementChild&&c.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends s.Evented{constructor(c){super(),this.options=s.extend({geolocation:s.window.navigator.geolocation},Id,c),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Da(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(c){return this._map=c,this._container=q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(c){this._supportsGeolocation!==void 0?c(this._supportsGeolocation):s.window.navigator.permissions!==void 0?s.window.navigator.permissions.query({name:"geolocation"}).then(n=>{this._supportsGeolocation=n.state!=="denied",c(this._supportsGeolocation)}):(this._supportsGeolocation=!!this.options.geolocation,c(this._supportsGeolocation))}_isOutOfMapMaxBounds(c){const n=this._map.getMaxBounds(),a=c.coords;return!!n&&(a.longitude<n.getWest()||a.longitude>n.getEast()||a.latitude<n.getSouth()||a.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",c)),this._finish()}}_updateCamera(c){const n=new s.LngLat(c.coords.longitude,c.coords.latitude),a=c.coords.accuracy,d=this._map.getBearing(),_=s.extend({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(a),_,{geolocateSource:!0})}_updateMarker(c){if(c){const n=new s.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const c=this._map.transform,n=s.mercatorZfromAltitude(1,c._center.lat)*c.worldSize,a=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",c)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(c){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=q("button","mapboxgl-ctrl-geolocate",this._container),q("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",c===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=q("div","mapboxgl-user-location"),this._dotElement.appendChild(q("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(q("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Zl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=q("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Zl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.Event("trackuserlocationend")))})}_onDeviceOrientation(c){this._userLocationDotMarker&&(c.webkitCompassHeading?this._heading=c.webkitCompassHeading:c.absolute===!0&&(this._heading=-1*c.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(c={maximumAge:6e5,timeout:0},this._noTimeout=!0):(c=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,c),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const c=()=>{s.window.addEventListener("ondeviceorientationabsolute"in s.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};s.window.DeviceMotionEvent!==void 0&&typeof s.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&c()}).catch(console.error):c()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),s.window.removeEventListener("deviceorientation",this._onDeviceOrientation),s.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Cu,ScaleControl:class{constructor(c){this.options=s.extend({},zu,c),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=Pu.bind(this)),s.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const c=this.options.maxWidth||100,n=this._map,a=n._containerHeight/2,d=n._containerWidth/2-c/2,_=n.unproject([d,a]),g=n.unproject([d+c,a]),w=_.distanceTo(g);if(this.options.unit==="imperial"){const T=3.2808*w;T>5280?this._setScale(c,T/5280,"mile"):this._setScale(c,T,"foot")}else this.options.unit==="nautical"?this._setScale(c,w/1852,"nautical-mile"):w>=1e3?this._setScale(c,w/1e3,"kilometer"):this._setScale(c,w,"meter")}_setScale(c,n,a){const d=Wl(n),_=d/n;this._map._requestDomTask(()=>{this._container.style.width=c*_+"px",this._container.innerHTML=a!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:a}).format(d):`${d}&nbsp;nm`})}onAdd(c){return this._map=c,this._language=c.getLanguage(),this._container=q("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(c){this._language=c,this._update()}setUnit(c){this.options.unit=c,this._update()}},FullscreenControl:class{constructor(c){this._fullscreen=!1,c&&c.container&&(c.container instanceof s.window.HTMLElement?this._container=c.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in s.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in s.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,s.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!s.window.document.fullscreenEnabled&&!s.window.document.webkitFullscreenEnabled)}_setupUI(){const c=this._fullscreenButton=q("button","mapboxgl-ctrl-fullscreen",this._controlContainer);q("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),s.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",c)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(s.window.document.fullscreenElement||s.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?s.window.document.exitFullscreen?s.window.document.exitFullscreen():s.window.document.webkitCancelFullScreen&&s.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.Evented{constructor(c){super(),this.options=s.extend(Object.create(Vp),c),s.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(c&&c.className?c.className.trim().split(/\s+/):[])}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&c.on("preclick",this._onClose),this.options.closeOnMove&&c.on("move",this._onClose),c.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(c.on("mousemove",this._onMouseEvent),c.on("mouseup",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")):c.on("move",this._update),this.fire(new s.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const c=this._map;return c&&(c.off("move",this._update),c.off("move",this._onClose),c.off("preclick",this._onClose),c.off("click",this._onClose),c.off("remove",this.remove),c.off("mousemove",this._onMouseEvent),c.off("mouseup",this._onMouseEvent),c.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new s.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(c){this._lngLat=s.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const c=this._map;return c&&(c.off("move",this._update),c.on("mousemove",this._onMouseEvent),c.on("drag",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(s.window.document.createTextNode(c))}setHTML(c){const n=s.window.document.createDocumentFragment(),a=s.window.document.createElement("body");let d;for(a.innerHTML=c;d=a.firstChild,d;)n.appendChild(d);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=q("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(c),this.options.closeButton){const a=this._closeButton=q("button","mapboxgl-popup-close-button",n);a.type="button",a.setAttribute("aria-label","Close popup"),a.setAttribute("aria-hidden","true"),a.innerHTML="&#215;",a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(c){return this._classList.add(c),this._updateClassList(),this}removeClassName(c){return this._classList.delete(c),this._updateClassList(),this}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){let n;return this._classList.delete(c)?n=!1:(this._classList.add(c),n=!0),this._updateClassList(),n}_onMouseEvent(c){this._update(c.point)}_getAnchor(c){if(this.options.anchor)return this.options.anchor;const n=this._map,a=this._container,d=this._pos;if(!n||!a||!d)return"bottom";const _=a.offsetWidth,g=a.offsetHeight,w=d.x<_/2,T=d.x>n.transform.width-_/2;if(d.y+c<g)return w?"top-left":T?"top-right":"top";if(d.y>n.transform.height-g){if(w)return"bottom-left";if(T)return"bottom-right"}return w?"left":T?"right":"bottom"}_updateClassList(){const c=this._container;if(!c)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),c.className=n.join(" ")}_update(c){const n=this._map,a=this._content;if(!n||!this._lngLat&&!this._trackPointer||!a)return;let d=this._container;if(d||(d=this._container=q("div","mapboxgl-popup",n.getContainer()),this._tip=q("div","mapboxgl-popup-tip",d),d.appendChild(a)),this.options.maxWidth&&d.style.maxWidth!==this.options.maxWidth&&(d.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Iu(this._lngLat,this._pos,n.transform)),!this._trackPointer||c){const _=this._pos=this._trackPointer&&c?c:n.project(this._lngLat),g=Hl(this.options.offset),w=this._anchor=this._getAnchor(g.y),T=Hl(this.options.offset,w),C=_.add(T).round();n._requestDomTask(()=>{this._container&&w&&(this._container.style.transform=`${Oa[w]} translate(${C.x}px,${C.y}px)`)})}if(!this._marker&&n._showingGlobe()){const _=s.isLngLatBehindGlobe(n.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const c=this._container.querySelector(Up);c&&c.focus()}_onClose(){this.remove()}_setOpacity(c){this._container&&(this._container.style.opacity=`${c}`),this._content&&(this._content.style.pointerEvents=c?"auto":"none")}},Marker:Zl,Style:Sr,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.pointGeometry,MercatorCoordinate:s.MercatorCoordinate,FreeCameraOptions:Pt,Evented:s.Evented,config:s.config,prewarm:function(){Pi().acquire(jt)},clearPrewarmedResources:function(){const c=ci;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(jt),ci=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return s.config.ACCESS_TOKEN},set accessToken(c){s.config.ACCESS_TOKEN=c},get baseApiUrl(){return s.config.API_URL},set baseApiUrl(c){s.config.API_URL=c},get workerCount(){return Qt.workerCount},set workerCount(c){Qt.workerCount=c},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){s.config.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage(c){s.clearTileCache(c)},workerUrl:"",workerClass:null,setNow:s.exported.setNow,restoreNow:s.exported.restoreNow};return Ua});var M=b;return M})})(Sb);const c_=Sb.exports;const Ab=(r,h)=>{const p=r.__vccOpts||r;for(const[y,b]of h)p[y]=b;return p},oI={__name:"Mapbox",setup(r){const h=Rt();return c_.accessToken="pk.eyJ1IjoicnViZW5kZWRpZWdvOTAiLCJhIjoiY2t5anF6M2ltMHYxdDJ2cW9lNHZmc3JteiJ9.-WS08Ja1iIvjKvBNRX_X9w",mr(()=>{try{const p=new c_.Map({container:h.value,style:"mapbox://styles/mapbox/streets-v11",center:[-3.3257027308061775,40.49381049145687],zoom:13,projection:"globe"}),y=new c_.Marker().setLngLat([-3.3257027308061775,40.49381049145687]).addTo(p);p.on("style.load",()=>{p.setFog({})})}catch(p){console.error(p)}}),(p,y)=>(nr(),la("div",{class:"map-container",ref_key:"mapContainer",ref:h},null,512))}},sI=Ab(oI,[["__scopeId","data-v-bcbcb3dd"]]),aI=ki("div",{class:"col-12 column",style:{padding:"1rem"}},[ki("p",{class:"text-justify"},[Mc("Os esperamos en "),ki("strong",null,[ki("u",null,"La Vega del Henares")]),Mc(" donde celebraremos nuestro matrimonio junto a nuestros seres queridos.")])],-1),lI={style:{display:"flex","justify-content":"center","align-items":"center","margin-top":"1rem"}},cI={href:"http://maps.google.com/?q=Carretera Madrid Barcelona, 0 Km 33, N-II, 28801 Alcal\xE1 de Henares, Madrid",style:{"text-decoration":"none"}},uI={__name:"Lugar",setup(r){return(h,p)=>(nr(),la(wr,null,[Ut(Oh,{title:"Lugar"}),aI,Ut(sI),ki("div",lI,[ki("a",cI,[Ut(Go,{color:"black",icon:"map",label:"Ir a Google Maps",rounded:""})])])],64))}},hI={},dI={class:"q-pa-md"},fI=z1('<div class="column"><h3>Musica</h3><div class="col-12" style="background-color:purple;height:100px;"></div></div><div class="column" style="height:150px;"><div class="col-4 col-md-6">.col-4 .col-md-6</div><div class="col-4 col-md-6">.col-4 .col-md-6</div><div class="col-4 col-md-6">.col-4 .col-md-6</div></div>',2),pI=[fI];function mI(r,h){return nr(),la("div",dI,pI)}const _I=Ab(hI,[["render",mI]]),gI=z1('<div class="col-12 column" style="padding:1rem;"><p class="text-justify">Vuestra presencia ser\xE1 nuestro mejor regalo. A\xFAn as\xED, si quieres contribuir en nuestra futura vida juntos, os facilitamos el n\xFAmero de cuenta.</p><div class="flex col-12" style="display:flex;justify-content:center;align-items:center;"><p class="text-justify"><strong>ES8801986139751066924632</strong></p></div><p class="text-justify">Tres cosas hay en la vida; salud, dinero y amor. Afortunadamente nos sobran salud y amor.</p></div><p style="color:red;">EL NUMERO DE CUENTA NO ES ESE, CAMBIAR</p>',2),yI={__name:"Regalos",setup(r){return(h,p)=>(nr(),la(wr,null,[Ut(Oh,{title:"Regalos"}),gI],64))}};function Mb(r,h){return function(){return r.apply(h,arguments)}}const{toString:Ib}=Object.prototype,{getPrototypeOf:bg}=Object,wg=(r=>h=>{const p=Ib.call(h);return r[p]||(r[p]=p.slice(8,-1).toLowerCase())})(Object.create(null)),xs=r=>(r=r.toLowerCase(),h=>wg(h)===r),yp=r=>h=>typeof h===r,{isArray:Vh}=Array,z_=yp("undefined");function vI(r){return r!==null&&!z_(r)&&r.constructor!==null&&!z_(r.constructor)&&Lc(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const kb=xs("ArrayBuffer");function xI(r){let h;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?h=ArrayBuffer.isView(r):h=r&&r.buffer&&kb(r.buffer),h}const bI=yp("string"),Lc=yp("function"),zb=yp("number"),Pb=r=>r!==null&&typeof r=="object",wI=r=>r===!0||r===!1,Bf=r=>{if(wg(r)!=="object")return!1;const h=bg(r);return(h===null||h===Object.prototype||Object.getPrototypeOf(h)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},TI=xs("Date"),EI=xs("File"),SI=xs("Blob"),CI=xs("FileList"),AI=r=>Pb(r)&&Lc(r.pipe),MI=r=>{const h="[object FormData]";return r&&(typeof FormData=="function"&&r instanceof FormData||Ib.call(r)===h||Lc(r.toString)&&r.toString()===h)},II=xs("URLSearchParams"),kI=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function vp(r,h,{allOwnKeys:p=!1}={}){if(r===null||typeof r>"u")return;let y,b;if(typeof r!="object"&&(r=[r]),Vh(r))for(y=0,b=r.length;y<b;y++)h.call(null,r[y],y,r);else{const E=p?Object.getOwnPropertyNames(r):Object.keys(r),M=E.length;let s;for(y=0;y<M;y++)s=E[y],h.call(null,r[s],s,r)}}function P_(){const r={},h=(p,y)=>{Bf(r[y])&&Bf(p)?r[y]=P_(r[y],p):Bf(p)?r[y]=P_({},p):Vh(p)?r[y]=p.slice():r[y]=p};for(let p=0,y=arguments.length;p<y;p++)arguments[p]&&vp(arguments[p],h);return r}const zI=(r,h,p,{allOwnKeys:y}={})=>(vp(h,(b,E)=>{p&&Lc(b)?r[E]=Mb(b,p):r[E]=b},{allOwnKeys:y}),r),PI=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),DI=(r,h,p,y)=>{r.prototype=Object.create(h.prototype,y),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:h.prototype}),p&&Object.assign(r.prototype,p)},LI=(r,h,p,y)=>{let b,E,M;const s={};if(h=h||{},r==null)return h;do{for(b=Object.getOwnPropertyNames(r),E=b.length;E-- >0;)M=b[E],(!y||y(M,r,h))&&!s[M]&&(h[M]=r[M],s[M]=!0);r=p!==!1&&bg(r)}while(r&&(!p||p(r,h))&&r!==Object.prototype);return h},BI=(r,h,p)=>{r=String(r),(p===void 0||p>r.length)&&(p=r.length),p-=h.length;const y=r.indexOf(h,p);return y!==-1&&y===p},RI=r=>{if(!r)return null;if(Vh(r))return r;let h=r.length;if(!zb(h))return null;const p=new Array(h);for(;h-- >0;)p[h]=r[h];return p},FI=(r=>h=>r&&h instanceof r)(typeof Uint8Array<"u"&&bg(Uint8Array)),OI=(r,h)=>{const y=(r&&r[Symbol.iterator]).call(r);let b;for(;(b=y.next())&&!b.done;){const E=b.value;h.call(r,E[0],E[1])}},VI=(r,h)=>{let p;const y=[];for(;(p=r.exec(h))!==null;)y.push(p);return y},UI=xs("HTMLFormElement"),NI=r=>r.toLowerCase().replace(/[_-\s]([a-z\d])(\w*)/g,function(p,y,b){return y.toUpperCase()+b}),A0=(({hasOwnProperty:r})=>(h,p)=>r.call(h,p))(Object.prototype),jI=xs("RegExp"),Db=(r,h)=>{const p=Object.getOwnPropertyDescriptors(r),y={};vp(p,(b,E)=>{h(b,E,r)!==!1&&(y[E]=b)}),Object.defineProperties(r,y)},qI=r=>{Db(r,(h,p)=>{const y=r[p];if(!!Lc(y)){if(h.enumerable=!1,"writable"in h){h.writable=!1;return}h.set||(h.set=()=>{throw Error("Can not read-only method '"+p+"'")})}})},$I=(r,h)=>{const p={},y=b=>{b.forEach(E=>{p[E]=!0})};return Vh(r)?y(r):y(String(r).split(h)),p},GI=()=>{},ZI=(r,h)=>(r=+r,Number.isFinite(r)?r:h),pt={isArray:Vh,isArrayBuffer:kb,isBuffer:vI,isFormData:MI,isArrayBufferView:xI,isString:bI,isNumber:zb,isBoolean:wI,isObject:Pb,isPlainObject:Bf,isUndefined:z_,isDate:TI,isFile:EI,isBlob:SI,isRegExp:jI,isFunction:Lc,isStream:AI,isURLSearchParams:II,isTypedArray:FI,isFileList:CI,forEach:vp,merge:P_,extend:zI,trim:kI,stripBOM:PI,inherits:DI,toFlatObject:LI,kindOf:wg,kindOfTest:xs,endsWith:BI,toArray:RI,forEachEntry:OI,matchAll:VI,isHTMLForm:UI,hasOwnProperty:A0,hasOwnProp:A0,reduceDescriptors:Db,freezeMethods:qI,toObjectSet:$I,toCamelCase:NI,noop:GI,toFiniteNumber:ZI};function Wi(r,h,p,y,b){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",h&&(this.code=h),p&&(this.config=p),y&&(this.request=y),b&&(this.response=b)}pt.inherits(Wi,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const Lb=Wi.prototype,Bb={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{Bb[r]={value:r}});Object.defineProperties(Wi,Bb);Object.defineProperty(Lb,"isAxiosError",{value:!0});Wi.from=(r,h,p,y,b,E)=>{const M=Object.create(Lb);return pt.toFlatObject(r,M,function(D){return D!==Error.prototype},s=>s!=="isAxiosError"),Wi.call(M,r.message,h,p,y,b),M.cause=r,M.name=r.name,E&&Object.assign(M,E),M};var WI=typeof self=="object"?self.FormData:window.FormData;function D_(r){return pt.isPlainObject(r)||pt.isArray(r)}function Rb(r){return pt.endsWith(r,"[]")?r.slice(0,-2):r}function M0(r,h,p){return r?r.concat(h).map(function(b,E){return b=Rb(b),!p&&E?"["+b+"]":b}).join(p?".":""):h}function HI(r){return pt.isArray(r)&&!r.some(D_)}const XI=pt.toFlatObject(pt,{},null,function(h){return/^is[A-Z]/.test(h)});function KI(r){return r&&pt.isFunction(r.append)&&r[Symbol.toStringTag]==="FormData"&&r[Symbol.iterator]}function xp(r,h,p){if(!pt.isObject(r))throw new TypeError("target must be an object");h=h||new(WI||FormData),p=pt.toFlatObject(p,{metaTokens:!0,dots:!1,indexes:!1},!1,function(ve,ze){return!pt.isUndefined(ze[ve])});const y=p.metaTokens,b=p.visitor||N,E=p.dots,M=p.indexes,D=(p.Blob||typeof Blob<"u"&&Blob)&&KI(h);if(!pt.isFunction(b))throw new TypeError("visitor must be a function");function V(_e){if(_e===null)return"";if(pt.isDate(_e))return _e.toISOString();if(!D&&pt.isBlob(_e))throw new Wi("Blob is not supported. Use a Buffer instead.");return pt.isArrayBuffer(_e)||pt.isTypedArray(_e)?D&&typeof Blob=="function"?new Blob([_e]):Buffer.from(_e):_e}function N(_e,ve,ze){let Ye=_e;if(_e&&!ze&&typeof _e=="object"){if(pt.endsWith(ve,"{}"))ve=y?ve:ve.slice(0,-2),_e=JSON.stringify(_e);else if(pt.isArray(_e)&&HI(_e)||pt.isFileList(_e)||pt.endsWith(ve,"[]")&&(Ye=pt.toArray(_e)))return ve=Rb(ve),Ye.forEach(function(Ue,Ge){!pt.isUndefined(Ue)&&h.append(M===!0?M0([ve],Ge,E):M===null?ve:ve+"[]",V(Ue))}),!1}return D_(_e)?!0:(h.append(M0(ze,ve,E),V(_e)),!1)}const U=[],q=Object.assign(XI,{defaultVisitor:N,convertValue:V,isVisitable:D_});function Y(_e,ve){if(!pt.isUndefined(_e)){if(U.indexOf(_e)!==-1)throw Error("Circular reference detected in "+ve.join("."));U.push(_e),pt.forEach(_e,function(Ye,we){(!pt.isUndefined(Ye)&&b.call(h,Ye,pt.isString(we)?we.trim():we,ve,q))===!0&&Y(Ye,ve?ve.concat(we):[we])}),U.pop()}}if(!pt.isObject(r))throw new TypeError("data must be an object");return Y(r),h}function I0(r){const h={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(y){return h[y]})}function Tg(r,h){this._pairs=[],r&&xp(r,this,h)}const Fb=Tg.prototype;Fb.append=function(h,p){this._pairs.push([h,p])};Fb.toString=function(h){const p=h?function(y){return h.call(this,y,I0)}:I0;return this._pairs.map(function(b){return p(b[0])+"="+p(b[1])},"").join("&")};function YI(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Ob(r,h,p){if(!h)return r;const y=r.indexOf("#");y!==-1&&(r=r.slice(0,y));const b=p&&p.encode||YI,E=pt.isURLSearchParams(h)?h.toString():new Tg(h,p).toString(b);return E&&(r+=(r.indexOf("?")===-1?"?":"&")+E),r}class k0{constructor(){this.handlers=[]}use(h,p,y){return this.handlers.push({fulfilled:h,rejected:p,synchronous:y?y.synchronous:!1,runWhen:y?y.runWhen:null}),this.handlers.length-1}eject(h){this.handlers[h]&&(this.handlers[h]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(h){pt.forEach(this.handlers,function(y){y!==null&&h(y)})}}const Vb={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},JI=typeof URLSearchParams<"u"?URLSearchParams:Tg,QI=FormData,ek=(()=>{let r;return typeof navigator<"u"&&((r=navigator.product)==="ReactNative"||r==="NativeScript"||r==="NS")?!1:typeof window<"u"&&typeof document<"u"})(),ms={isBrowser:!0,classes:{URLSearchParams:JI,FormData:QI,Blob},isStandardBrowserEnv:ek,protocols:["http","https","file","blob","url","data"]};function tk(r,h){return xp(r,new ms.classes.URLSearchParams,Object.assign({visitor:function(p,y,b,E){return ms.isNode&&pt.isBuffer(p)?(this.append(y,p.toString("base64")),!1):E.defaultVisitor.apply(this,arguments)}},h))}function ik(r){return pt.matchAll(/\w+|\[(\w*)]/g,r).map(h=>h[0]==="[]"?"":h[1]||h[0])}function nk(r){const h={},p=Object.keys(r);let y;const b=p.length;let E;for(y=0;y<b;y++)E=p[y],h[E]=r[E];return h}function Ub(r){function h(p,y,b,E){let M=p[E++];const s=Number.isFinite(+M),D=E>=p.length;return M=!M&&pt.isArray(b)?b.length:M,D?(pt.hasOwnProp(b,M)?b[M]=[b[M],y]:b[M]=y,!s):((!b[M]||!pt.isObject(b[M]))&&(b[M]=[]),h(p,y,b[M],E)&&pt.isArray(b[M])&&(b[M]=nk(b[M])),!s)}if(pt.isFormData(r)&&pt.isFunction(r.entries)){const p={};return pt.forEachEntry(r,(y,b)=>{h(ik(y),b,p,0)}),p}return null}function rk(r,h,p){const y=p.config.validateStatus;!p.status||!y||y(p.status)?r(p):h(new Wi("Request failed with status code "+p.status,[Wi.ERR_BAD_REQUEST,Wi.ERR_BAD_RESPONSE][Math.floor(p.status/100)-4],p.config,p.request,p))}const ok=ms.isStandardBrowserEnv?function(){return{write:function(p,y,b,E,M,s){const D=[];D.push(p+"="+encodeURIComponent(y)),pt.isNumber(b)&&D.push("expires="+new Date(b).toGMTString()),pt.isString(E)&&D.push("path="+E),pt.isString(M)&&D.push("domain="+M),s===!0&&D.push("secure"),document.cookie=D.join("; ")},read:function(p){const y=document.cookie.match(new RegExp("(^|;\\s*)("+p+")=([^;]*)"));return y?decodeURIComponent(y[3]):null},remove:function(p){this.write(p,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function sk(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function ak(r,h){return h?r.replace(/\/+$/,"")+"/"+h.replace(/^\/+/,""):r}function Nb(r,h){return r&&!sk(h)?ak(r,h):h}const lk=ms.isStandardBrowserEnv?function(){const h=/(msie|trident)/i.test(navigator.userAgent),p=document.createElement("a");let y;function b(E){let M=E;return h&&(p.setAttribute("href",M),M=p.href),p.setAttribute("href",M),{href:p.href,protocol:p.protocol?p.protocol.replace(/:$/,""):"",host:p.host,search:p.search?p.search.replace(/^\?/,""):"",hash:p.hash?p.hash.replace(/^#/,""):"",hostname:p.hostname,port:p.port,pathname:p.pathname.charAt(0)==="/"?p.pathname:"/"+p.pathname}}return y=b(window.location.href),function(M){const s=pt.isString(M)?b(M):M;return s.protocol===y.protocol&&s.host===y.host}}():function(){return function(){return!0}}();function Uh(r,h,p){Wi.call(this,r==null?"canceled":r,Wi.ERR_CANCELED,h,p),this.name="CanceledError"}pt.inherits(Uh,Wi,{__CANCEL__:!0});function ck(r){const h=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return h&&h[1]||""}const uk=pt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),hk=r=>{const h={};let p,y,b;return r&&r.split(`
`).forEach(function(M){b=M.indexOf(":"),p=M.substring(0,b).trim().toLowerCase(),y=M.substring(b+1).trim(),!(!p||h[p]&&uk[p])&&(p==="set-cookie"?h[p]?h[p].push(y):h[p]=[y]:h[p]=h[p]?h[p]+", "+y:y)}),h},z0=Symbol("internals"),jb=Symbol("defaults");function vh(r){return r&&String(r).trim().toLowerCase()}function If(r){return r===!1||r==null?r:String(r)}function dk(r){const h=Object.create(null),p=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let y;for(;y=p.exec(r);)h[y[1]]=y[2];return h}function P0(r,h,p,y){if(pt.isFunction(y))return y.call(this,h,p);if(!!pt.isString(h)){if(pt.isString(y))return h.indexOf(y)!==-1;if(pt.isRegExp(y))return y.test(h)}}function fk(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(h,p,y)=>p.toUpperCase()+y)}function pk(r,h){const p=pt.toCamelCase(" "+h);["get","set","has"].forEach(y=>{Object.defineProperty(r,y+p,{value:function(b,E,M){return this[y].call(this,h,b,E,M)},configurable:!0})})}function mh(r,h){h=h.toLowerCase();const p=Object.keys(r);let y=p.length,b;for(;y-- >0;)if(b=p[y],h===b.toLowerCase())return b;return null}function eo(r,h){r&&this.set(r),this[jb]=h||null}Object.assign(eo.prototype,{set:function(r,h,p){const y=this;function b(E,M,s){const D=vh(M);if(!D)throw new Error("header name must be a non-empty string");const V=mh(y,D);V&&s!==!0&&(y[V]===!1||s===!1)||(pt.isArray(E)?E=E.map(If):E=If(E),y[V||M]=E)}return pt.isPlainObject(r)?pt.forEach(r,(E,M)=>{b(E,M,h)}):b(h,r,p),this},get:function(r,h){if(r=vh(r),!r)return;const p=mh(this,r);if(p){const y=this[p];if(!h)return y;if(h===!0)return dk(y);if(pt.isFunction(h))return h.call(this,y,p);if(pt.isRegExp(h))return h.exec(y);throw new TypeError("parser must be boolean|regexp|function")}},has:function(r,h){if(r=vh(r),r){const p=mh(this,r);return!!(p&&(!h||P0(this,this[p],p,h)))}return!1},delete:function(r,h){const p=this;let y=!1;function b(E){if(E=vh(E),E){const M=mh(p,E);M&&(!h||P0(p,p[M],M,h))&&(delete p[M],y=!0)}}return pt.isArray(r)?r.forEach(b):b(r),y},clear:function(){return Object.keys(this).forEach(this.delete.bind(this))},normalize:function(r){const h=this,p={};return pt.forEach(this,(y,b)=>{const E=mh(p,b);if(E){h[E]=If(y),delete h[b];return}const M=r?fk(b):String(b).trim();M!==b&&delete h[b],h[M]=If(y),p[M]=!0}),this},toJSON:function(){const r=Object.create(null);return pt.forEach(Object.assign({},this[jb]||null,this),(h,p)=>{h==null||h===!1||(r[p]=pt.isArray(h)?h.join(", "):h)}),r}});Object.assign(eo,{from:function(r){return pt.isString(r)?new this(hk(r)):r instanceof this?r:new this(r)},accessor:function(r){const p=(this[z0]=this[z0]={accessors:{}}).accessors,y=this.prototype;function b(E){const M=vh(E);p[M]||(pk(y,E),p[M]=!0)}return pt.isArray(r)?r.forEach(b):b(r),this}});eo.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent"]);pt.freezeMethods(eo.prototype);pt.freezeMethods(eo);function mk(r,h){r=r||10;const p=new Array(r),y=new Array(r);let b=0,E=0,M;return h=h!==void 0?h:1e3,function(D){const V=Date.now(),N=y[E];M||(M=V),p[b]=D,y[b]=V;let U=E,q=0;for(;U!==b;)q+=p[U++],U=U%r;if(b=(b+1)%r,b===E&&(E=(E+1)%r),V-M<h)return;const Y=N&&V-N;return Y?Math.round(q*1e3/Y):void 0}}function D0(r,h){let p=0;const y=mk(50,250);return b=>{const E=b.loaded,M=b.lengthComputable?b.total:void 0,s=E-p,D=y(s),V=E<=M;p=E;const N={loaded:E,total:M,progress:M?E/M:void 0,bytes:s,rate:D||void 0,estimated:D&&M&&V?(M-E)/D:void 0};N[h?"download":"upload"]=!0,r(N)}}function L0(r){return new Promise(function(p,y){let b=r.data;const E=eo.from(r.headers).normalize(),M=r.responseType;let s;function D(){r.cancelToken&&r.cancelToken.unsubscribe(s),r.signal&&r.signal.removeEventListener("abort",s)}pt.isFormData(b)&&ms.isStandardBrowserEnv&&E.setContentType(!1);let V=new XMLHttpRequest;if(r.auth){const Y=r.auth.username||"",_e=r.auth.password?unescape(encodeURIComponent(r.auth.password)):"";E.set("Authorization","Basic "+btoa(Y+":"+_e))}const N=Nb(r.baseURL,r.url);V.open(r.method.toUpperCase(),Ob(N,r.params,r.paramsSerializer),!0),V.timeout=r.timeout;function U(){if(!V)return;const Y=eo.from("getAllResponseHeaders"in V&&V.getAllResponseHeaders()),ve={data:!M||M==="text"||M==="json"?V.responseText:V.response,status:V.status,statusText:V.statusText,headers:Y,config:r,request:V};rk(function(Ye){p(Ye),D()},function(Ye){y(Ye),D()},ve),V=null}if("onloadend"in V?V.onloadend=U:V.onreadystatechange=function(){!V||V.readyState!==4||V.status===0&&!(V.responseURL&&V.responseURL.indexOf("file:")===0)||setTimeout(U)},V.onabort=function(){!V||(y(new Wi("Request aborted",Wi.ECONNABORTED,r,V)),V=null)},V.onerror=function(){y(new Wi("Network Error",Wi.ERR_NETWORK,r,V)),V=null},V.ontimeout=function(){let _e=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const ve=r.transitional||Vb;r.timeoutErrorMessage&&(_e=r.timeoutErrorMessage),y(new Wi(_e,ve.clarifyTimeoutError?Wi.ETIMEDOUT:Wi.ECONNABORTED,r,V)),V=null},ms.isStandardBrowserEnv){const Y=(r.withCredentials||lk(N))&&r.xsrfCookieName&&ok.read(r.xsrfCookieName);Y&&E.set(r.xsrfHeaderName,Y)}b===void 0&&E.setContentType(null),"setRequestHeader"in V&&pt.forEach(E.toJSON(),function(_e,ve){V.setRequestHeader(ve,_e)}),pt.isUndefined(r.withCredentials)||(V.withCredentials=!!r.withCredentials),M&&M!=="json"&&(V.responseType=r.responseType),typeof r.onDownloadProgress=="function"&&V.addEventListener("progress",D0(r.onDownloadProgress,!0)),typeof r.onUploadProgress=="function"&&V.upload&&V.upload.addEventListener("progress",D0(r.onUploadProgress)),(r.cancelToken||r.signal)&&(s=Y=>{!V||(y(!Y||Y.type?new Uh(null,r,V):Y),V.abort(),V=null)},r.cancelToken&&r.cancelToken.subscribe(s),r.signal&&(r.signal.aborted?s():r.signal.addEventListener("abort",s)));const q=ck(N);if(q&&ms.protocols.indexOf(q)===-1){y(new Wi("Unsupported protocol "+q+":",Wi.ERR_BAD_REQUEST,r));return}V.send(b||null)})}const B0={http:L0,xhr:L0},R0={getAdapter:r=>{if(pt.isString(r)){const h=B0[r];if(!r)throw Error(pt.hasOwnProp(r)?`Adapter '${r}' is not available in the build`:`Can not resolve adapter '${r}'`);return h}if(!pt.isFunction(r))throw new TypeError("adapter is not a function");return r},adapters:B0},_k={"Content-Type":"application/x-www-form-urlencoded"};function gk(){let r;return typeof XMLHttpRequest<"u"?r=R0.getAdapter("xhr"):typeof process<"u"&&pt.kindOf(process)==="process"&&(r=R0.getAdapter("http")),r}function yk(r,h,p){if(pt.isString(r))try{return(h||JSON.parse)(r),pt.trim(r)}catch(y){if(y.name!=="SyntaxError")throw y}return(p||JSON.stringify)(r)}const Bc={transitional:Vb,adapter:gk(),transformRequest:[function(h,p){const y=p.getContentType()||"",b=y.indexOf("application/json")>-1,E=pt.isObject(h);if(E&&pt.isHTMLForm(h)&&(h=new FormData(h)),pt.isFormData(h))return b&&b?JSON.stringify(Ub(h)):h;if(pt.isArrayBuffer(h)||pt.isBuffer(h)||pt.isStream(h)||pt.isFile(h)||pt.isBlob(h))return h;if(pt.isArrayBufferView(h))return h.buffer;if(pt.isURLSearchParams(h))return p.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),h.toString();let s;if(E){if(y.indexOf("application/x-www-form-urlencoded")>-1)return tk(h,this.formSerializer).toString();if((s=pt.isFileList(h))||y.indexOf("multipart/form-data")>-1){const D=this.env&&this.env.FormData;return xp(s?{"files[]":h}:h,D&&new D,this.formSerializer)}}return E||b?(p.setContentType("application/json",!1),yk(h)):h}],transformResponse:[function(h){const p=this.transitional||Bc.transitional,y=p&&p.forcedJSONParsing,b=this.responseType==="json";if(h&&pt.isString(h)&&(y&&!this.responseType||b)){const M=!(p&&p.silentJSONParsing)&&b;try{return JSON.parse(h)}catch(s){if(M)throw s.name==="SyntaxError"?Wi.from(s,Wi.ERR_BAD_RESPONSE,this,null,this.response):s}}return h}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ms.classes.FormData,Blob:ms.classes.Blob},validateStatus:function(h){return h>=200&&h<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};pt.forEach(["delete","get","head"],function(h){Bc.headers[h]={}});pt.forEach(["post","put","patch"],function(h){Bc.headers[h]=pt.merge(_k)});function u_(r,h){const p=this||Bc,y=h||p,b=eo.from(y.headers);let E=y.data;return pt.forEach(r,function(s){E=s.call(p,E,b.normalize(),h?h.status:void 0)}),b.normalize(),E}function qb(r){return!!(r&&r.__CANCEL__)}function h_(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new Uh}function F0(r){return h_(r),r.headers=eo.from(r.headers),r.data=u_.call(r,r.transformRequest),(r.adapter||Bc.adapter)(r).then(function(y){return h_(r),y.data=u_.call(r,r.transformResponse,y),y.headers=eo.from(y.headers),y},function(y){return qb(y)||(h_(r),y&&y.response&&(y.response.data=u_.call(r,r.transformResponse,y.response),y.response.headers=eo.from(y.response.headers))),Promise.reject(y)})}function Lh(r,h){h=h||{};const p={};function y(V,N){return pt.isPlainObject(V)&&pt.isPlainObject(N)?pt.merge(V,N):pt.isPlainObject(N)?pt.merge({},N):pt.isArray(N)?N.slice():N}function b(V){if(pt.isUndefined(h[V])){if(!pt.isUndefined(r[V]))return y(void 0,r[V])}else return y(r[V],h[V])}function E(V){if(!pt.isUndefined(h[V]))return y(void 0,h[V])}function M(V){if(pt.isUndefined(h[V])){if(!pt.isUndefined(r[V]))return y(void 0,r[V])}else return y(void 0,h[V])}function s(V){if(V in h)return y(r[V],h[V]);if(V in r)return y(void 0,r[V])}const D={url:E,method:E,data:E,baseURL:M,transformRequest:M,transformResponse:M,paramsSerializer:M,timeout:M,timeoutMessage:M,withCredentials:M,adapter:M,responseType:M,xsrfCookieName:M,xsrfHeaderName:M,onUploadProgress:M,onDownloadProgress:M,decompress:M,maxContentLength:M,maxBodyLength:M,beforeRedirect:M,transport:M,httpAgent:M,httpsAgent:M,cancelToken:M,socketPath:M,responseEncoding:M,validateStatus:s};return pt.forEach(Object.keys(r).concat(Object.keys(h)),function(N){const U=D[N]||b,q=U(N);pt.isUndefined(q)&&U!==s||(p[N]=q)}),p}const $b="1.1.2",Eg={};["object","boolean","number","function","string","symbol"].forEach((r,h)=>{Eg[r]=function(y){return typeof y===r||"a"+(h<1?"n ":" ")+r}});const O0={};Eg.transitional=function(h,p,y){function b(E,M){return"[Axios v"+$b+"] Transitional option '"+E+"'"+M+(y?". "+y:"")}return(E,M,s)=>{if(h===!1)throw new Wi(b(M," has been removed"+(p?" in "+p:"")),Wi.ERR_DEPRECATED);return p&&!O0[M]&&(O0[M]=!0,console.warn(b(M," has been deprecated since v"+p+" and will be removed in the near future"))),h?h(E,M,s):!0}};function vk(r,h,p){if(typeof r!="object")throw new Wi("options must be an object",Wi.ERR_BAD_OPTION_VALUE);const y=Object.keys(r);let b=y.length;for(;b-- >0;){const E=y[b],M=h[E];if(M){const s=r[E],D=s===void 0||M(s,E,r);if(D!==!0)throw new Wi("option "+E+" must be "+D,Wi.ERR_BAD_OPTION_VALUE);continue}if(p!==!0)throw new Wi("Unknown option "+E,Wi.ERR_BAD_OPTION)}}const Gb={assertOptions:vk,validators:Eg},vc=Gb.validators;class ml{constructor(h){this.defaults=h,this.interceptors={request:new k0,response:new k0}}request(h,p){typeof h=="string"?(p=p||{},p.url=h):p=h||{},p=Lh(this.defaults,p);const y=p.transitional;y!==void 0&&Gb.assertOptions(y,{silentJSONParsing:vc.transitional(vc.boolean),forcedJSONParsing:vc.transitional(vc.boolean),clarifyTimeoutError:vc.transitional(vc.boolean)},!1),p.method=(p.method||this.defaults.method||"get").toLowerCase();const b=p.headers&&pt.merge(p.headers.common,p.headers[p.method]);b&&pt.forEach(["delete","get","head","post","put","patch","common"],function(Y){delete p.headers[Y]}),p.headers=new eo(p.headers,b);const E=[];let M=!0;this.interceptors.request.forEach(function(Y){typeof Y.runWhen=="function"&&Y.runWhen(p)===!1||(M=M&&Y.synchronous,E.unshift(Y.fulfilled,Y.rejected))});const s=[];this.interceptors.response.forEach(function(Y){s.push(Y.fulfilled,Y.rejected)});let D,V=0,N;if(!M){const q=[F0.bind(this),void 0];for(q.unshift.apply(q,E),q.push.apply(q,s),N=q.length,D=Promise.resolve(p);V<N;)D=D.then(q[V++],q[V++]);return D}N=E.length;let U=p;for(V=0;V<N;){const q=E[V++],Y=E[V++];try{U=q(U)}catch(_e){Y.call(this,_e);break}}try{D=F0.call(this,U)}catch(q){return Promise.reject(q)}for(V=0,N=s.length;V<N;)D=D.then(s[V++],s[V++]);return D}getUri(h){h=Lh(this.defaults,h);const p=Nb(h.baseURL,h.url);return Ob(p,h.params,h.paramsSerializer)}}pt.forEach(["delete","get","head","options"],function(h){ml.prototype[h]=function(p,y){return this.request(Lh(y||{},{method:h,url:p,data:(y||{}).data}))}});pt.forEach(["post","put","patch"],function(h){function p(y){return function(E,M,s){return this.request(Lh(s||{},{method:h,headers:y?{"Content-Type":"multipart/form-data"}:{},url:E,data:M}))}}ml.prototype[h]=p(),ml.prototype[h+"Form"]=p(!0)});class Sg{constructor(h){if(typeof h!="function")throw new TypeError("executor must be a function.");let p;this.promise=new Promise(function(E){p=E});const y=this;this.promise.then(b=>{if(!y._listeners)return;let E=y._listeners.length;for(;E-- >0;)y._listeners[E](b);y._listeners=null}),this.promise.then=b=>{let E;const M=new Promise(s=>{y.subscribe(s),E=s}).then(b);return M.cancel=function(){y.unsubscribe(E)},M},h(function(E,M,s){y.reason||(y.reason=new Uh(E,M,s),p(y.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(h){if(this.reason){h(this.reason);return}this._listeners?this._listeners.push(h):this._listeners=[h]}unsubscribe(h){if(!this._listeners)return;const p=this._listeners.indexOf(h);p!==-1&&this._listeners.splice(p,1)}static source(){let h;return{token:new Sg(function(b){h=b}),cancel:h}}}function xk(r){return function(p){return r.apply(null,p)}}function bk(r){return pt.isObject(r)&&r.isAxiosError===!0}function Zb(r){const h=new ml(r),p=Mb(ml.prototype.request,h);return pt.extend(p,ml.prototype,h,{allOwnKeys:!0}),pt.extend(p,h,null,{allOwnKeys:!0}),p.create=function(b){return Zb(Lh(r,b))},p}const zr=Zb(Bc);zr.Axios=ml;zr.CanceledError=Uh;zr.CancelToken=Sg;zr.isCancel=qb;zr.VERSION=$b;zr.toFormData=xp;zr.AxiosError=Wi;zr.Cancel=zr.CanceledError;zr.all=function(h){return Promise.all(h)};zr.spread=xk;zr.isAxiosError=bk;zr.formToJSON=r=>Ub(pt.isHTMLForm(r)?new FormData(r):r);const wk=()=>zr.create({baseURL:"https://bear-express-delta.vercel.app/api/"}),Tk=async()=>await wk().get("guest"),Ek={class:"column",style:{"z-index":"0"}},Sk={href:"https://api.whatsapp.com/send?phone=+34689529238",class:"col-6",style:{"text-decoration":"inherit"}},Ck={href:"https://api.whatsapp.com/send?phone=+34665091123",class:"col-6",style:{"text-decoration":"inherit"}},Ak={__name:"App",setup(r){const h=Rt("Inicio"),p=b=>{h.value=b},y=Rt("");return mr(async()=>{y.value=await Tk()}),(b,E)=>(nr(),ps(DC,{view:"hHh LpR lFf"},{default:Ln(()=>[Ut(bC,{elevated:"",class:"bg-primary text-white"},{default:Ln(()=>[Ut(vC,{class:"col-12",src:H_(sA),style:{height:"100px"},fit:"fill"},null,8,["src"])]),_:1}),Ut(SC,null,{default:Ln(()=>[Ut(EC,{style:{"z-index":"1"},position:"top-left",offset:[10,10]},{default:Ln(()=>[Ut(oA,{class:"column",onHandleTabSelected:E[0]||(E[0]=M=>p(M))})]),_:1}),ki("div",Ek,[h.value==="Asistencia"?(nr(),ps(IM,{key:0})):fc("",!0),h.value==="Inicio"?(nr(),ps(QM,{key:1})):fc("",!0),h.value==="Itinerario"?(nr(),ps(nI,{key:2})):fc("",!0),h.value==="Lugar"?(nr(),ps(uI,{key:3})):fc("",!0),h.value==="M\xFAsica"?(nr(),ps(_I,{key:4})):fc("",!0),h.value==="Regalos"?(nr(),ps(yI,{key:5})):fc("",!0)])]),_:1}),Ut(AC,{elevated:"",class:"q-pa-md bg-grey-8"},{default:Ln(()=>[Ut(CC,{class:"row justify-end"},{default:Ln(()=>[ki("a",Sk,[Ut(jx,{avatar:"https://cdn.quasar.dev/img/avatar1.jpg",text:["\xBFDudas?"],sent:""})]),ki("a",Ck,[Ut(jx,{avatar:"https://cdn.quasar.dev/img/avatar2.jpg",text:["\xA1Clicka!"],sent:""})])]),_:1})]),_:1})]),_:1}))}},Wb=OS(Ak);Wb.use(dC,{plugins:{}});Wb.mount("#app");
